<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>endm retvalue - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14479" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=14479">endm retvalue</a></p>
   <div class="post" id="post-111999">
    <div class="subject"><a href="#post-111999">endm retvalue</a></div>
    <div class="body">In MASM manuals I can see that subj is possible<br />(I assume it should work as exitm %value in regard of<br />usage the retvalue generated by macro)<br />yet I failed to make any use of it.<br />ml doens't mind if I write something like<br /><br />endm %statement<br />yet I can not use the return from it in any expression.<br />Could someone help me out and show if<br />it's possible to use such a construction in an example?</div>
    <div class="meta">Posted on 2003-07-26 20:46:48 by The Svin</div>
   </div>
   <div class="post" id="post-112007">
    <div class="subject"><a href="#post-112007">endm retvalue</a></div>
    <div class="body">Are you shure? I couldn't find such syntax in masm docs. Only endm without param.</div>
    <div class="meta">Posted on 2003-07-27 03:05:16 by Four-F</div>
   </div>
   <div class="post" id="post-112009">
    <div class="subject"><a href="#post-112009">endm retvalue</a></div>
    <div class="body">Yes, here is qoute:<br />name MACRO []]]...<br /><br />     statements<br /><br />ENDM []</div>
    <div class="meta">Posted on 2003-07-27 03:36:37 by The Svin</div>
   </div>
   <div class="post" id="post-112020">
    <div class="subject"><a href="#post-112020">endm retvalue</a></div>
    <div class="body">I see. I'm sure it's erratum.</div>
    <div class="meta">Posted on 2003-07-27 08:46:25 by Four-F</div>
   </div>
   <div class="post" id="post-112047">
    <div class="subject"><a href="#post-112047">endm retvalue</a></div>
    <div class="body">The why ml doesn't inform me of the error<br />when I type something after endm?<br />somemac macro par1<br />echo par1<br />endm par1<br /><br />Echo works OK, so the macro works and no error about<br />about endm par1?</div>
    <div class="meta">Posted on 2003-07-27 13:51:23 by The Svin</div>
   </div>
   <div class="post" id="post-112063">
    <div class="subject"><a href="#post-112063">endm retvalue</a></div>
    <div class="body">I use ml.exe 6.15.8803 and the doc was supplied with it.<br />Might be it can help somehow?</div>
    <div class="meta">Posted on 2003-07-27 15:41:40 by The Svin</div>
   </div>
   <div class="post" id="post-131461">
    <div class="subject"><a href="#post-131461">endm retvalue</a></div>
    <div class="body">It appears MASM ignores everything after the ENDM until the end of line.  Same as the multi-line COMMENT directive:<pre><code>COMMENT ~<br /><br />~ MASM ignores this text until the end of the line...</code></pre>I wouldn't be surprised to find similar &quot;holes&quot; in the syntax.  In the case of ENDM [] the manual is in error.  Similarly, MASM ignores line of text after EXITM:<pre><code>MyMACRO MACRO<br />  EXITM<br /><br />maybe type some documentation here?<br /><br />ENDM</code></pre>MASM is funny like this. :)</div>
    <div class="meta">Posted on 2004-01-23 18:30:48 by bitRAKE</div>
   </div>
   <div class="post" id="post-131467">
    <div class="subject"><a href="#post-131467">endm retvalue</a></div>
    <div class="body">Yes it's funny :)<br />Last two things I noticed was:<br />1. It doesn't differ base and index in pointer and<br />always codes  and  with  as base.<br />That's 1 byte longer compare with case when ebp placed in index field.<br />Solution is to write DS: in the case it places reg code for ebp in index field of SIB wich results in 1 byte shorter instruction.<br />But the method doesn't work with lea - no matter whether you wrote lea eax, or lea eax,DS: - masm always places code for ebp in base field and makes it 1 byte longer.<br />It forced to write macro wich places code for ebp in index field with lea.<br />2. $ operator returns invalid counter when reffers to labels inside code used &quot;invoke&quot; &quot;proc&quot; etc.</div>
    <div class="meta">Posted on 2004-01-24 00:10:35 by The Svin</div>
   </div>
   <div class="post" id="post-131503">
    <div class="subject"><a href="#post-131503">endm retvalue</a></div>
    <div class="body">The Svin,<br /> You won't get very far with ENDM &lt;var&gt; .  Try EXITM &lt;var&gt; instead.  You are defining a MACRO FUNCTION instead of a plain MACRO.  See example in ZIP file.  Ratch</div>
    <div class="meta">Posted on 2004-01-24 10:47:45 by Ratch</div>
   </div>
   <div class="post" id="post-131506">
    <div class="subject"><a href="#post-131506">endm retvalue</a></div>
    <div class="body">The Svin,<br /><br /><div class="quote">Last two things I noticed was:<br />1. It doesn't differ base and index in pointer and<br />always codes  and  with  as base.<br />That's 1 byte longer compare with case when ebp placed in index field.</div><br /><br />Could you post an example of the correct code and the incorrect code so I can understand what the problem is?  Thanks, Ratch</div>
    <div class="meta">Posted on 2004-01-24 11:09:15 by Ratch</div>
   </div>
   <div class="post" id="post-131508">
    <div class="subject"><a href="#post-131508">endm retvalue</a></div>
    <div class="body">The Svin,<br />OK, now I understand what you are saying.  Easy solution.  Always code the index with 1*REG.  This tells MASM explicitly what the index register is.  Ratch.<br /><br /><pre><code><br /> 00000000  8D 44 0D 00		 LEA EAX,&#91;ECX+EBP&#93;<br /> 00000004  8D 04 29		 LEA EAX,&#91;EBP+ECX&#93;<br /> 00000007  8D 04 29		 LEA EAX,&#91;ECX+1*EBP&#93;<br /> 0000000A  8D 44 0D 00		 LEA EAX,&#91;EBP+1*ECX&#93;<br /> 0000000E  8D 04 69		 LEA EAX,&#91;ECX+2*EBP&#93;<br /> 00000011  8D 44 4D 00		 LEA EAX,&#91;EBP+2*ECX&#93;<br /> 00000015  8D 04 69		 LEA EAX,&#91;2*EBP+ECX&#93;<br /> 00000018  8D 44 4D 00		 LEA EAX,&#91;2*ECX+EBP&#93;<br /></code></pre></div>
    <div class="meta">Posted on 2004-01-24 11:41:24 by Ratch</div>
   </div>
   <div class="post" id="post-131572">
    <div class="subject"><a href="#post-131572">endm retvalue</a></div>
    <div class="body">Thanks. That's easier than using macro.</div>
    <div class="meta">Posted on 2004-01-24 23:51:47 by The Svin</div>
   </div>
   <div class="post" id="post-131573">
    <div class="subject"><a href="#post-131573">endm retvalue</a></div>
    <div class="body"><div class="quote"><br />The Svin,<br /> You won't get very far with ENDM &lt;var&gt; .  Try EXITM &lt;var&gt; instead.  You are defining a MACRO FUNCTION instead of a plain MACRO.  See example in ZIP file.  Ratch </div><br />I know about EXITM and heavily use it.<br />Orignal question was about MASM docs where incorrectly stated that the same method can be used with ENDM &lt;value&gt;</div>
    <div class="meta">Posted on 2004-01-24 23:54:37 by The Svin</div>
   </div>
  </div>
 </body>
</html>