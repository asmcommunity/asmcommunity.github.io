<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Trouble with RIP relative addressing - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30536" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=117">Unix</a> &raquo; <a href="../?id=30536">Trouble with RIP relative addressing</a></p>
   <div class="post" id="post-214273">
    <div class="subject"><a href="#post-214273">Trouble with RIP relative addressing</a></div>
    <div class="body">Hi folks, <br /><br />I&#039;ve been playing with shared-libraries and x86_64 assembler and ran clean off the edge of the world as described in the begginers books I&#039;ve bought about learning assembly language. I&#039;ve done my best to get it working and appear to have reached what looks to me like a working set-up, but debugging through it shows that I&#039;m getting an error code from sys_write of -14, EFAULT (I think). I&#039;ve added some code below and some gdb pastes. I&#039;d appreciate any help anyone can give to get this working! <br /><br />At present, the code runs but doesn&#039;t print anything out, nor does it emit an error. As you can probably tell from the function name, I&#039;m trying to get JNI-&gt;Assembly working for a 64-bit shared library. The Java code (not included here) runs without exception, and similarly doesn&#039;t print the expected message to stdout. <br /><br />Regards<br /><br />Michael<br /><br />Test.c<br /><pre><code><br />extern void Java_HelloWorld_sayHello();<br /><br />int main() {<br /> &nbsp; &nbsp; &nbsp; &nbsp;Java_HelloWorld_sayHello();<br /> &nbsp; &nbsp; &nbsp; &nbsp;exit(0);<br />}<br /></code></pre><br /><br />HelloWorld.s<br /><pre><code><br /><br />.section .data<br /> &nbsp; &nbsp; &nbsp; &nbsp;hellomsg: &nbsp; &nbsp; &nbsp; .asciz &nbsp;&quot;Hello, World!!\n&quot;<br /><br />.section .text<br /> &nbsp; &nbsp; &nbsp; &nbsp;.type &nbsp; Java_HelloWorld_sayHello, @function<br /> &nbsp; &nbsp; &nbsp; &nbsp;.globl &nbsp;Java_HelloWorld_sayHello<br /><br />Java_HelloWorld_sayHello:<br /> &nbsp; &nbsp; &nbsp; &nbsp;pushq &nbsp; %rbp<br /> &nbsp; &nbsp; &nbsp; &nbsp;movq &nbsp; &nbsp;%rsp, %rbp<br /><br /> &nbsp; &nbsp; &nbsp; &nbsp;movq &nbsp; &nbsp;$4, %rax<br /> &nbsp; &nbsp; &nbsp; &nbsp;movq &nbsp; &nbsp;$1, %rbx<br /> &nbsp; &nbsp; &nbsp; &nbsp;leaq &nbsp; &nbsp;hellomsg(%rip), %rcx<br /> &nbsp; &nbsp; &nbsp; &nbsp;movq &nbsp; &nbsp;$15, %rdx<br /><br /> &nbsp; &nbsp; &nbsp; &nbsp;int &nbsp; &nbsp; $0x80<br /><br /> &nbsp; &nbsp; &nbsp; &nbsp;movq &nbsp; &nbsp;%rbp, %rsp<br /> &nbsp; &nbsp; &nbsp; &nbsp;popq &nbsp; &nbsp;%rbp<br /> &nbsp; &nbsp; &nbsp; &nbsp;ret<br /></code></pre><br /><br />Makefile<br /><pre><code><br />all: libhello.so Test<br /><br />Test: libhello.so<br /> &nbsp; &nbsp; &nbsp; &nbsp;gcc -g -o Test -L. -lhello Test.c<br /><br />libhello.so: HelloWorld.o<br /> &nbsp; &nbsp; &nbsp; &nbsp;ld -fPIC -shared -o libhello.so HelloWorld.o -lc<br /><br />HelloWorld.o:<br /> &nbsp; &nbsp; &nbsp; &nbsp;as --64 -g -o HelloWorld.o HelloWorld.s<br /><br />clean:<br /> &nbsp; &nbsp; &nbsp; &nbsp;rm *.o *.so Test<br /><br /></code></pre><br /><br />Various excerpts from my journey through gdb...<br /><pre><code><br /><br />(gdb) disassemble<br />Dump of assembler code for function main:<br />0x0000000000400558 &lt;main+0&gt;: &nbsp; &nbsp;push &nbsp; %rbp<br />0x0000000000400559 &lt;main+1&gt;: &nbsp; &nbsp;mov &nbsp; &nbsp;%rsp,%rbp<br />0x000000000040055c &lt;main+4&gt;: &nbsp; &nbsp;mov &nbsp; &nbsp;$0x0,%eax<br />0x0000000000400561 &lt;main+9&gt;: &nbsp; &nbsp;callq &nbsp;0x400490 &lt;Java_HelloWorld_sayHello@plt&gt;<br />0x0000000000400566 &lt;main+14&gt;: &nbsp; mov &nbsp; &nbsp;$0x0,%edi<br />0x000000000040056b &lt;main+19&gt;: &nbsp; callq &nbsp;0x400470 &lt;exit@plt&gt;<br />End of assembler dump.<br /><br />(gdb) break *0x400490<br />Breakpoint 3 at 0x400490<br />(gdb) nexti<br /><br />Breakpoint 3, 0x0000000000400490 in Java_HelloWorld_sayHello@plt ()<br />(gdb) disassemble<br />Dump of assembler code for function Java_HelloWorld_sayHello@plt:<br />0x0000000000400490 &lt;Java_HelloWorld_sayHello@plt+0&gt;: &nbsp; &nbsp;jmpq &nbsp; *2098298(%rip) &nbsp; &nbsp; &nbsp; &nbsp;# 0x600910 &lt;_GLOBAL_OFFSET_TABLE_+40&gt;<br />0x0000000000400496 &lt;Java_HelloWorld_sayHello@plt+6&gt;: &nbsp; &nbsp;pushq &nbsp;$0x2<br />0x000000000040049b &lt;Java_HelloWorld_sayHello@plt+11&gt;: &nbsp; jmpq &nbsp; 0x400460<br />End of assembler dump.<br /><br /># ...<br /><br />(gdb) nexti<br />0x00000030f78128fb in _dl_runtime_resolve () from /lib64/ld-linux-x86-64.so.2<br />(gdb) nexti<br />Java_HelloWorld_sayHello () at HelloWorld.s:11<br />11 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pushq &nbsp; %rbp<br />Current language: &nbsp;auto; currently asm<br />(gdb) disassemble<br />Dump of assembler code for function Java_HelloWorld_sayHello:<br />0x00002b8afa0b01e8 &lt;Java_HelloWorld_sayHello+0&gt;: &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; %rbp<br />0x00002b8afa0b01e9 &lt;Java_HelloWorld_sayHello+1&gt;: &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp;%rsp,%rbp<br />0x00002b8afa0b01ec &lt;Java_HelloWorld_sayHello+4&gt;: &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp;$0x4,%rax<br />0x00002b8afa0b01f3 &lt;Java_HelloWorld_sayHello+11&gt;: &nbsp; &nbsp; &nbsp; mov &nbsp; &nbsp;$0x1,%rbx<br />0x00002b8afa0b01fa &lt;Java_HelloWorld_sayHello+18&gt;: &nbsp; &nbsp; &nbsp; lea &nbsp; &nbsp;2097399(%rip),%rcx &nbsp; &nbsp; &nbsp; &nbsp;# 0x2b8afa2b02f8 &lt;hellomsg&gt;<br />0x00002b8afa0b0201 &lt;Java_HelloWorld_sayHello+25&gt;: &nbsp; &nbsp; &nbsp; mov &nbsp; &nbsp;$0xf,%rdx<br />0x00002b8afa0b0208 &lt;Java_HelloWorld_sayHello+32&gt;: &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp;$0x80<br />0x00002b8afa0b020a &lt;Java_HelloWorld_sayHello+34&gt;: &nbsp; &nbsp; &nbsp; mov &nbsp; &nbsp;%rbp,%rsp<br />0x00002b8afa0b020d &lt;Java_HelloWorld_sayHello+37&gt;: &nbsp; &nbsp; &nbsp; pop &nbsp; &nbsp;%rbp<br />0x00002b8afa0b020e &lt;Java_HelloWorld_sayHello+38&gt;: &nbsp; &nbsp; &nbsp; retq<br />End of assembler dump.<br /><br /># ...<br /><br />(gdb) nexti<br />(gdb) nexti<br />(gdb) nexti<br />23 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;movq &nbsp; &nbsp;$1, %rbx<br />(gdb) info reg<br />rax &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x4 &nbsp; &nbsp; &nbsp;4<br />rbx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x30f7a1bbc0 &nbsp; &nbsp; 210313001920<br />rcx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x400580 4195712<br />rdx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc166a8 &nbsp; 140735286437544<br />rsi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc16698 &nbsp; 140735286437528<br />rdi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1 &nbsp; &nbsp; &nbsp;1<br />rbp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc165a0 &nbsp; 0x7fff7cc165a0<br />rsp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc165a0 &nbsp; 0x7fff7cc165a0<br />r8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x30f7f522d0 &nbsp; &nbsp; 210318467792<br />r9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x30f780d660 &nbsp; &nbsp; 210310846048<br />r10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r11 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2b8afa0b01e8 &nbsp; 47875900506600<br />r12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r13 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc16690 &nbsp; 140735286437520<br />r14 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r15 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />rip &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2b8afa0b01f3 &nbsp; 0x2b8afa0b01f3 &lt;Java_HelloWorld_sayHello+11&gt;<br />eflags &nbsp; &nbsp; &nbsp; &nbsp; 0x202 &nbsp; &nbsp;[ IF ]<br />cs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x33 &nbsp; &nbsp; 51<br />ss &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x2b &nbsp; &nbsp; 43<br />ds &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />es &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />fs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />gs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br /><br />(gdb) nexti<br />(gdb) nexti<br />(gdb) nexti<br />27 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int &nbsp; &nbsp; $0x80<br />(gdb) info reg<br />rax &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x4 &nbsp; &nbsp; &nbsp;4<br />rbx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1 &nbsp; &nbsp; &nbsp;1<br />rcx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2b8afa2b02f8 &nbsp; 47875902604024<br />rdx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xf &nbsp; &nbsp; &nbsp;15<br />rsi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc16698 &nbsp; 140735286437528<br />rdi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1 &nbsp; &nbsp; &nbsp;1<br />rbp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc165a0 &nbsp; 0x7fff7cc165a0<br />rsp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc165a0 &nbsp; 0x7fff7cc165a0<br />r8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x30f7f522d0 &nbsp; &nbsp; 210318467792<br />r9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x30f780d660 &nbsp; &nbsp; 210310846048<br />r10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r11 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2b8afa0b01e8 &nbsp; 47875900506600<br />r12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r13 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc16690 &nbsp; 140735286437520<br />r14 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r15 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />rip &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2b8afa0b0208 &nbsp; 0x2b8afa0b0208 &lt;Java_HelloWorld_sayHello+32&gt;<br />eflags &nbsp; &nbsp; &nbsp; &nbsp; 0x202 &nbsp; &nbsp;[ IF ]<br />cs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x33 &nbsp; &nbsp; 51<br />ss &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x2b &nbsp; &nbsp; 43<br />ds &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />es &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />fs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />gs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br /><br />(gdb) x/c 0x2b8afa2b02f8<br />0x2b8afa2b02f8 &lt;hellomsg&gt;: &nbsp; &nbsp; &nbsp;72 &#039;H&#039;<br />(gdb) x/c 0x2b8afa2b02f9<br />0x2b8afa2b02f9 &lt;hellomsg+1&gt;: &nbsp; &nbsp;101 &#039;e&#039;<br />(gdb) x/c 0x2b8afa2b02fa<br />0x2b8afa2b02fa &lt;hellomsg+2&gt;: &nbsp; &nbsp;108 &#039;l&#039;<br /><br /># ...<br /><br />0x2b8afa2b0305 &lt;hellomsg+13&gt;: &nbsp; 33 &#039;!&#039;<br />(gdb) x/c 0x2b8afa2b0306<br />0x2b8afa2b0306 &lt;hellomsg+14&gt;: &nbsp; 10 &#039;\n&#039;<br />(gdb) x/c 0x2b8afa2b0307<br />0x2b8afa2b0307 &lt;hellomsg+15&gt;: &nbsp; 0 &#039;\0&#039;<br /><br />(gdb) nexti<br />29 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;movq &nbsp; &nbsp;%rbp, %rsp<br />(gdb) info reg<br />rax &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xfffffffffffffff2 &nbsp; &nbsp; &nbsp; -14<br />rbx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1 &nbsp; &nbsp; &nbsp;1<br />rcx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2b8afa2b02f8 &nbsp; 47875902604024<br />rdx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xf &nbsp; &nbsp; &nbsp;15<br />rsi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc16698 &nbsp; 140735286437528<br />rdi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1 &nbsp; &nbsp; &nbsp;1<br />rbp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc165a0 &nbsp; 0x7fff7cc165a0<br />rsp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc165a0 &nbsp; 0x7fff7cc165a0<br />r8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />r9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />r10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r11 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r13 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc16690 &nbsp; 140735286437520<br />r14 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r15 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />rip &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2b8afa0b020a &nbsp; 0x2b8afa0b020a &lt;Java_HelloWorld_sayHello+34&gt;<br />eflags &nbsp; &nbsp; &nbsp; &nbsp; 0x202 &nbsp; &nbsp;[ IF ]<br />cs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x33 &nbsp; &nbsp; 51<br />ss &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x2b &nbsp; &nbsp; 43<br />ds &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />es &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />fs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />gs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br /><br />(gdb) nexti<br />(gdb) nexti<br />31 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ret<br />(gdb) info reg<br />rax &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xfffffffffffffff2 &nbsp; &nbsp; &nbsp; -14<br />rbx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1 &nbsp; &nbsp; &nbsp;1<br />rcx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2b8afa2b02f8 &nbsp; 47875902604024<br />rdx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xf &nbsp; &nbsp; &nbsp;15<br />rsi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc16698 &nbsp; 140735286437528<br />rdi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1 &nbsp; &nbsp; &nbsp;1<br />rbp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc165b0 &nbsp; 0x7fff7cc165b0<br />rsp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc165a8 &nbsp; 0x7fff7cc165a8<br />r8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />r9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />r10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r11 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r13 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7fff7cc16690 &nbsp; 140735286437520<br />r14 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />r15 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp;0<br />rip &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2b8afa0b020e &nbsp; 0x2b8afa0b020e &lt;Java_HelloWorld_sayHello+38&gt;<br />eflags &nbsp; &nbsp; &nbsp; &nbsp; 0x202 &nbsp; &nbsp;[ IF ]<br />cs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x33 &nbsp; &nbsp; 51<br />ss &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x2b &nbsp; &nbsp; 43<br />ds &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />es &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />fs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br />gs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0 &nbsp; &nbsp; &nbsp;0<br /><br /><br /></code></pre><br /><br />I&#039;ve understood the RAX line<br /><pre><code><br />rax &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xfffffffffffffff2 &nbsp; &nbsp; &nbsp; -14<br />rbx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1 &nbsp; &nbsp; &nbsp;1<br />rcx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2b8afa2b02f8 &nbsp; 47875902604024<br />rdx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xf &nbsp; &nbsp; &nbsp;15<br /></code></pre><br />as showing an errno of -14, EFAULT. Is that correct? And if it is an EFAULT, why is it a bad address? Looks fine to me...</div>
    <div class="meta">Posted on 2011-04-12 08:34:42 by michaelg</div>
   </div>
   <div class="post" id="post-214274">
    <div class="subject"><a href="#post-214274">Re: Trouble with RIP relative addressing</a></div>
    <div class="body">Wild, wild guess! Apparently, if you use int 0x80 in 64-bit code, you get the old 32-bit interface. Perhaps it isn&#039;t comfortable with rip-relative addressing?<br /><br />Even wilder guess! Attempting to adapt from an example the late Chuck Crayne left for us to study, maybe something like this?<br /><br /><pre><code><br />...<br />&nbsp; &nbsp; movq $1, %rax&nbsp;  # 64-bit sys_write<br />&nbsp; &nbsp; movq $1, %rdi&nbsp;  # STDOUT<br />&nbsp; &nbsp; leaq hellomsg(%rip), %rsi<br />&nbsp; &nbsp; movq $15, %rdx&nbsp; # length<br />&nbsp; &nbsp; syscall<br />...<br /></code></pre><br /><br />I have no idea if that&#039;s even close...<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2011-04-12 13:14:46 by fbkotler</div>
   </div>
   <div class="post" id="post-214276">
    <div class="subject"><a href="#post-214276">Re: Trouble with RIP relative addressing</a></div>
    <div class="body">Frank is correct. Read <a target="_blank" href="http://callumscode.com/blog/3">THIS</a> for further details.</div>
    <div class="meta">Posted on 2011-04-12 14:20:46 by SpooK</div>
   </div>
   <div class="post" id="post-214277">
    <div class="subject"><a href="#post-214277">Re: Trouble with RIP relative addressing</a></div>
    <div class="body">Gents, <br /><br />You&#039;re amazing, thanks very much. <br /><br />One thing I find incredible is the absolute lack of resources online about this sort of thing. Oh well... <br /><br />Best wishes,<br /><br />Michael</div>
    <div class="meta">Posted on 2011-04-12 15:21:52 by michaelg</div>
   </div>
   <div class="post" id="post-214278">
    <div class="subject"><a href="#post-214278">Re: Trouble with RIP relative addressing</a></div>
    <div class="body"><div class="quote"><br />One thing I find incredible is the absolute lack of resources online about this sort of thing. Oh well... <br /></div><br /><br />Not surprising for me... unix jockeys tend to be C zealots as well :lol:</div>
    <div class="meta">Posted on 2011-04-12 15:36:14 by SpooK</div>
   </div>
   <div class="post" id="post-214385">
    <div class="subject"><a href="#post-214385">Re: Trouble with RIP relative addressing</a></div>
    <div class="body"><div class="quote"><br /><div class="quote"><br />One thing I find incredible is the absolute lack of resources online about this sort of thing. Oh well... <br /></div><br /><br />Not surprising for me... unix jockeys tend to be C zealots as well :lol:<br /></div>More like, why waste time writing documentation for assembly programmers, when that&#039;s going to be a <strong>very</strong> small part of your target audience? Especially when &quot;somebody who wants to do that really should know how to gdb the info himself?&quot; :-)</div>
    <div class="meta">Posted on 2011-05-18 18:05:58 by f0dder</div>
   </div>
   <div class="post" id="post-214392">
    <div class="subject"><a href="#post-214392">Re: Trouble with RIP relative addressing</a></div>
    <div class="body"><div class="quote"><br />More like, why waste time writing documentation for assembly programmers, when that&#039;s going to be a <strong>very</strong> small part of your target audience? Especially when &quot;somebody who wants to do that really should know how to gdb the info himself?&quot; :-)<br /></div><br /><br />I agree.</div>
    <div class="meta">Posted on 2011-05-18 20:04:58 by SpooK</div>
   </div>
  </div>
 </body>
</html>