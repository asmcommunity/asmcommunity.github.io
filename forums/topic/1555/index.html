<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>16-bit to 32-bit conversion??? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=1555" />
    <link rel="next" href="../?id=1555&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=1555">16-bit to 32-bit conversion???</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=1555&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=1555&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="1555" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=1555&amp;page=2">&gt;</a><a href="../?id=1555&amp;page=2">&raquo;</a></form>   <div class="post" id="post-9961">
    <div class="subject"><a href="#post-9961">16-bit to 32-bit conversion???</a></div>
    <div class="body">Just to get out in the air, I AM A NEWBIE to ASM. I have many years experience with VB and others, but no ASM.<br /><br />I have been given the task to convert a 16-bit DLL to a 32-bit DLL. The source code is in assembler and is very small. 4 macros and 4-5 procedures.<br /><br />Where can I find info on how to convert 16-bit instructions to 32-bit instructions easily??<br /><br />I converted the DllEntry procedure and got rid of the WEP at the end, but get the error:<br /><br />&quot;Cannot use 16-bit instruction with 32-bit addressing&quot;<br /><br />I understand this, but do not know how to convert the instructions.<br /><br />I am using MASM32... I got it from Iczelions. Is this a good suite to use??<br /><br />This DLL is only about 400 lines long...it has no complex instructions either. VERY SIMPLE... I am just very inexperienced!<br /><br /><br />ANY leads are GREALTY appreciated.</div>
    <div class="meta">Posted on 2001-10-22 10:16:05 by mikef</div>
   </div>
   <div class="post" id="post-9962">
    <div class="subject"><a href="#post-9962">16-bit to 32-bit conversion???</a></div>
    <div class="body">Your biggest problem will be around memory referencing, ie stuff<br />like<br />mov eax,  ... you'll basically have to convert the register references<br />to their extended parts (si-&gt;esi, di-&gt;edi, ax-&gt;eax, and so on). And<br />you must make sure that they are loaded with 32bit pointers ;).</div>
    <div class="meta">Posted on 2001-10-22 10:35:43 by f0dder</div>
   </div>
   <div class="post" id="post-9963">
    <div class="subject"><a href="#post-9963">16-bit to 32-bit conversion???</a></div>
    <div class="body">Yes, THAT IS IT!!!!  :) <br /><br />That is the only trouble I have... where can I find this info. I have looked at some VxD examples, but they are too complex for me yet. This DLL is super small... only a few instructions per proc... and the macros are like 4 instructions each.<br /><br />I read Iczelions DLL tutorial and folowed it to a T... no problems except for my 16bit registers in a 32bit address!<br /><br /><br />Thanks again!!</div>
    <div class="meta">Posted on 2001-10-22 10:40:29 by mikef</div>
   </div>
   <div class="post" id="post-9965">
    <div class="subject"><a href="#post-9965">4 macros contained in DLL source</a></div>
    <div class="body">These are my 4 macros. Also, 3 of the routines only are a call to one or more of these macros. It is simple but I AM NEWBIE!!<br /><br />Advice, direction, leads, info needed. Also hysterical laughter is appreciated to &quot;Ease the tension baby!&quot;<br /><br />thanks!!<br /><br /><br />;*****************************<br />;Macro routines<br />;*****************************<br />		P2L16   Macro   local16,passedptr<br />			push    ds<br />			LDS     si,passedptr<br />			MOV     AX,<br />			pop     ds<br />			MOV     local16,AX<br />			Endm<br /><br />		L2P16   Macro   passedptr,local16<br />			mov     AX,local16<br />			push    ds<br />			lds     SI,passedptr<br />			mov     ,AX<br />			pop     DS<br />			Endm<br /><br />		P2L32   Macro   local32,passedptr<br />			push    ds<br />			LDS     si,passedptr<br />			MOV     AX,<br />			MOV     CX,<br />			pop     ds<br />			MOV     local32,AX<br />			MOV     local32+2,CX<br />			Endm<br /><br />		L2P32   Macro   passedptr,local32<br />			mov     AX,local32<br />			mov     CX,local32+2<br />			push    ds<br />			lds     SI,passedptr<br />			mov     ,AX<br />			mov     ,CX<br />			pop     DS<br />			Endm</div>
    <div class="meta">Posted on 2001-10-22 11:05:40 by mikef</div>
   </div>
   <div class="post" id="post-10006">
    <div class="subject"><a href="#post-10006">16-bit to 32-bit conversion???</a></div>
    <div class="body">okay, you'll need a few explanations I guess :).<br /><br />lds si,    loads DS:SI with the four bytes from .<br />Under win32, you have a flat memory model, and thus do NOT want<br />to mess with segment registers ;). And all pointers are 32 (but linear,<br />not seg:ofs).<br /><br />I'll convert P2L16 for you...<br /><br /><pre><code><br />P2L16 Macro local16,passedptr <br />mov eax, passedptr<br />mov ax, &#91;eax&#93;<br />MOV local16, AX <br />Endm <br /></code></pre><br /><br />As you can see, the code is actually simpler :).<br /><br /><pre><code><br />L2P32 Macro passedptr,local32 <br />push local32<br />mov eax, passeptr<br />pop &#91;eax&#93;<br /></code></pre><br /><br />And it uses less registers :).</div>
    <div class="meta">Posted on 2001-10-22 16:37:46 by f0dder</div>
   </div>
   <div class="post" id="post-10017">
    <div class="subject"><a href="#post-10017">16-bit to 32-bit conversion???</a></div>
    <div class="body">I was about to post a general posting on Intel Architecture, but this post seems to have alot of the overtones :)<br /><br />Im in a course at Universtiy right now that study's this, and (since i never opened the notes till yesterday (exam was today), i never knew what resources are provided :)  )<br /><br />The notes are simple but to the point.  They do a decent job of describing the 16 bit and 32 bit modes for both real and protected.  Thus, why the DS is &quot;NOT&quot; to be used in 32 bit protected mode is also described to you.  There may be some worth in looking at the frist 40 odd slides for you problem.  (which describes the ins and outs of what you want to do).<br /><br />You can download them from the University web page <a target="_blank" href="http://www.doe.carleton.ca/~shams/94361">HERE.</a> <br /><br />As well, for anyone else in general, wanting to know more about protected mode, descripter tables, and segment selectors, with out pouring thu the Intel manuals, you might want to take a look at them.<br /><br />Enjoy...<br /><br />NaN</div>
    <div class="meta">Posted on 2001-10-22 17:32:55 by NaN</div>
   </div>
   <div class="post" id="post-10033">
    <div class="subject"><a href="#post-10033">16-bit to 32-bit conversion???</a></div>
    <div class="body">Thanks, <strong>NaN</strong> - there are some nice bits of code there as well.</div>
    <div class="meta">Posted on 2001-10-22 22:30:09 by bitRAKE</div>
   </div>
   <div class="post" id="post-10050">
    <div class="subject"><a href="#post-10050">16-bit to 32-bit conversion???</a></div>
    <div class="body">Glad to help...<br /><br />BTW:  Those code snippets are flawed.  Prof intentionally placed bugs in the source to &quot;challenge&quot; us.  Hehehe, like:<br /><br /><pre><code>LOOP&#58;<br />   mov al, 0<br />   ...<br />   je LOOP</code></pre><br /><br />As well, some of those files will work on a PC, but some wont.  We do our assembly tests on an 8086 evaluation board.  Like a custom motherboard with extra wing dings like D/A converters etc. etc.  As well, there is an LED display on the board (since there is no monitor) and its port and chip info will definitely NOT apply to a PC.<br /><br />NaN</div>
    <div class="meta">Posted on 2001-10-23 01:17:47 by NaN</div>
   </div>
   <div class="post" id="post-10068">
    <div class="subject"><a href="#post-10068">WOW!</a></div>
    <div class="body">Thanks for the GREAT help and leads. I am now fully aware of what is expected. I DID need some explanations... being a NEWBIE and all! :grin: <br /><br />hey f0dder.... you seem to be quite intelligent... to tell you the truth, if I cannot get to work, I am supposed to outsource it. I have placed a project on ANTS.com... and will be taking bids for 5 days...then if I don't have it working, I will need to pick someone..... you care to be that someone??<br /><br />thanks again for everything..</div>
    <div class="meta">Posted on 2001-10-23 07:32:16 by mikef</div>
   </div>
   <div class="post" id="post-10084">
    <div class="subject"><a href="#post-10084">16-bit to 32-bit conversion???</a></div>
    <div class="body">Ok, I have completed converting the other 2 macros with your help. Thanks.<br /><br />Now I have a different problem that is probably pretty easy. <br />When I compile now I get an error in the following sub on the line with the arrow.<br /><br />;**********************************<br />trinfo PROC FAR EXPORT USES SI DI ES AX BX CX DX ,drvrevptr:FAR PTR DWORD<br />;**********************************<br />	L2P16   drvrevptr,drvrev    &lt;---------<br />	ret<br /><br />trinfo    endp<br /><br /><br />The error is the following:<br /><br />error A2070: invalid instruction operands<br />L2P16(2): Macro Called From<br />C:\WINDOWS\Desktop\tracker\newtrackdll2.asm(116): Main Line Code<br /><br /><br />What am I doing wrong here. I tried it with the USES = ESI EDI EAX EBX ECX EDX... but same problem.<br /><br />Any help or leads appreciated. Thanks again!:alright:</div>
    <div class="meta">Posted on 2001-10-23 10:03:45 by mikef</div>
   </div>
   <div class="post" id="post-10086">
    <div class="subject"><a href="#post-10086">16-bit to 32-bit conversion???</a></div>
    <div class="body">First of all, you should indeed be USES'ing the 32bit registers, as<br />you'll save yourself from 66h opcode prefixes...<br /><br />I think it might be the &quot;far ptr&quot;. In dos mode, a far ptr means you<br />have both a segment and an offset in your pointer. In win32, with<br />the flat memory model, you don't need segments (well, selectors),<br />and thus you use *near* pointers, *always*. So, try declaring it as<br /><pre><code><br />trinfo PROC USES ESI EDI EAX EBX ECX EDX ,drvrevptr&#58;DWORD <br /></code></pre><br /><br />and see what happens :)</div>
    <div class="meta">Posted on 2001-10-23 10:12:16 by f0dder</div>
   </div>
   <div class="post" id="post-10089">
    <div class="subject"><a href="#post-10089">16-bit to 32-bit conversion???</a></div>
    <div class="body">f0dder,<br />to change the parameter type to dword is ok, but the assembling error comes from within macro L2P16 (line 2).<br /><br />mikef, I think you will need to replace all instances of L16xx or P16xx stuff to L32xx/P32xx. I am not sure, I simply guess it from the name &quot;passedptr&quot; because in Win32 there normally isn't any 16 bit pointer.<br /><br />japheth</div>
    <div class="meta">Posted on 2001-10-23 10:29:52 by japheth</div>
   </div>
   <div class="post" id="post-10091">
    <div class="subject"><a href="#post-10091">16-bit to 32-bit conversion???</a></div>
    <div class="body">Changed all of them to what you specified f0dder.... AND IT WORKED!!! I assembled the file with NO errors reported. <br /><br />Now I just have to figure out how to LINK it.<br /><br />Is there not certain switches... etc I have to specify for a DLL??<br /><br />Anyone know where I can find some info to research??<br /><br /><br />THANKS TO EVERYONE FOR ALL THE HELP!!!!!<br /><br />:alright:</div>
    <div class="meta">Posted on 2001-10-23 10:35:24 by mikef</div>
   </div>
   <div class="post" id="post-10092">
    <div class="subject"><a href="#post-10092">16-bit to 32-bit conversion???</a></div>
    <div class="body">Yeah, using &quot;whatever&quot;16&quot;whatever&quot; for pointer stuff under win32<br />is a baaaad idea :).<br /><br />As for DLLs... lemme look up some stuff... yep. There.</div>
    <div class="meta">Posted on 2001-10-23 10:38:11 by f0dder</div>
   </div>
   <div class="post" id="post-10102">
    <div class="subject"><a href="#post-10102">16-bit to 32-bit conversion???</a></div>
    <div class="body">I have completed the assmeble and link... and with no errors, but when I try to call the function from VB I get ERROR 48: File not found, but when I use the same command on a know working DLL I get a diferent error: DllEntry point not found...<br /><br />I think there is still something wrong<br /><br />here is my full code... any guesses would be great... otherwise I think I need to hire some help!! :-)<br /><br />;* Assembly-language source for tracker DLL.  trackw.DLL contains several<br />;* library routines, which any Windows process can call.<br />;*<br />;*****************************************************************************<br />;<br />; Examples of how to compile<br />; <br />;<br />;MASM /c /W3 Trackw03.asm;<br />;masm /c /W3 dllentry.asm;<br />;link dllentry Trackw03,trackw.dll,, libw.lib mnocrtdw.lib,trackw.def<br /><br />;*****************************************************************************<br />; rev 2.2     Mar 4, 1995<br />; rev 2.3     Mar 21,1995   fixed trsts command<br />; rev 3.0     Oct 22, 2001  converted to 32-bit instructions<br />;*****************************************************************************<br /><br />.386<br />.MODEL  flat,stdcall<br />option casemap:none<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />;;INCLUDE trdll2.inc<br />;;INCLUDE	win.inc<br /><br />;*****************************<br />;Macro routines<br />;*****************************<br />;P2L16 converted<br />		P2L16   Macro   local16,passedptr<br />			mov eax, passedptr<br />                  mov ax, <br />                  MOV local16, AX<br />                  Endm<br />;L2P16 converted<br />		L2P16   Macro   passedptr,local16<br />			mov     AX,local16<br />                  mov     eax, passedptr<br />                  mov     ,AX<br />			;push    ds<br />			;lds     SI,passedptr<br /> 			;mov     ,AX<br />			;pop     DS<br />			Endm<br /><br />		P2L32   Macro   local32,passedptr<br />			mov      eax, passedptr<br />                  pop      <br />                  push     local32<br /><br />                  ;push    ds<br />			;LDS     si,passedptr<br />			;MOV     AX,<br />			;MOV     CX,<br />			;pop     ds<br />			;MOV     local32,AX<br />			;MOV     local32+2,CX<br />			Endm<br /><br />;L2P32 converted<br />		L2P32   Macro   passedptr,local32<br />        		push local32<br />                  mov eax, passedptr<br />                  pop <br />			Endm<br /><br />;***************************<br /><br />.DATA<br />TaskHead	BYTE	16 DUP(0)		; 1st paragraph reserved<br />						;   for Windows task header<br />countenable     equ     0Ch<br />auxinputs       equ     0Ch<br /><br /><br />drvrev          dw     (23)                      ;revision * 10<br />returncode      dw (0)<br />counter         dw (0)<br />newcount        dw 2 dup (0)<br />count           dw 2 dup (0)<br />disable         dw (3)<br />Ipstatus          dw (0)<br />bitnum          dw (0)<br />polarity        dw (1)<br />syncsignal      db (0)<br /><br />M1count         dw 2 dup (?)<br />M2count         dw 2 dup (?)<br />M3count         dw 2 dup (?)<br />M4count         dw 2 dup (?)<br /><br />otbaseadr DW      0280h                   ;control card base address<br /><br /><br />; Array of processor types<br />;;procs		BYTE	WF_CPU086, WF_CPU186, WF_CPU286, WF_CPU386, WF_CPU486<br /><br /><br /><br />.CODE<br /><br />DllEntry proc hInstDLL:HINSTANCE, reason:DWORD, reserved1:DWORD<br />    mov     eax,TRUE<br />    ret<br />DllEntry Endp<br /><br />;**********************************<br />;trinfo PROC FAR EXPORT USES SI DI ES AX BX CX <br />;DX ,drvrevptr:FAR PTR DWORD<br />trinfo PROC USES ESI EDI EAX EBX ECX EDX,drvrevptr:dword<br />;**********************************<br />	L2P16   drvrevptr,drvrev<br />	ret<br /><br />trinfo    endp<br /><br />; *********************************<br />;trsetadr PROC FAR EXPORT USES ESI EDI ES EAX EBX ECX <br />;EDX ,otbaseadrptr:far Ptr<br />trsetadr PROC USES ESI EDI EAX EBX ECX EDX,otbaseadrptr:DWORD<br />;************************************<br /><br />	P2L16   otbaseadr,otbaseadrptr<br /><br />	ret<br />trsetadr       endp<br /><br /><br />; *********************************<br />;trchk PROC FAR EXPORT USES ESI EDI ES EAX EBX ECX <br />;EDX ,otbaseadrptr:far Ptr, returncodeptr:far Ptr<br />trchk PROC USES ESI EDI EAX EBX ECX EDX,otbaseadrptr:DWORD,returncodeptr:DWORD<br />;************************************<br /><br />	P2L16   otbaseadr,otbaseadrptr<br /><br />	mov     dx,otbaseadr<br />	in      al,dx<br />	mov     cl,al                   ;store what was in counter<br /><br />	mov     dx,otbaseadr<br />	mov     al,0A5h<br />	out     dx,al                  ;write A5h<br /><br />	in      al,dx                  ;read A5h<br />	cmp     al,0A5h<br />	je      doublecheck<br />	mov     returncode,0<br />	jmp     chkend<br /><br />doublecheck:<br />	mov     al,5Ah                 ;write 5Ah<br />	out     dx,al<br /><br />	in      al,dx                  ;read 5Ah<br />	cmp     al,5Ah<br />	je      otfound<br />	mov     returncode,0<br />	jmp     chkend<br /><br />otfound:<br />	mov     returncode,1<br />	mov     al,cl<br />	out     dx,al                   ;restore counter to pretest value<br /><br />chkend:<br />	L2P16   returncodeptr,returncode<br />	ret<br />trchk       endp<br /><br /><br />;**************************************************************************<br />;trclrpos PROC FAR EXPORT USES ESI EDI ES EAX EBX ECX <br />;EDX ,counterptr:far Ptr<br />trclrpos PROC USES ESI EDI EAX EBX ECX EDX,counterptr:DWORD<br />;***************************************************************************<br /><br />	P2L16   counter,counterptr<br /><br />	mov     dx,otbaseadr<br />	mov     al,0<br /><br />	cmp     counter,1<br />	je      clear<br />	cmp     counter,2<br />	je      clear2<br />	cmp     counter,3<br />	je      clear3<br />	cmp     counter,4<br />	je      clear4<br />	jmp     clearend<br /><br />clear2: add     dx,3<br />	jmp     clear<br /><br />clear3: add     dx,6<br />	jmp     clear<br /><br />clear4: add     dx,9<br />	jmp     clear<br /><br />clear:  out     dx,al<br />	inc     dx<br />	out     dx,al<br />	inc     dx<br />	out     dx,al<br /><br />clearend:       ret<br /><br />trclrpos        endp<br /><br />;****************************************************************************<br />;trsetpos PROC FAR EXPORT USES ESI EDI ES EAX EBX ECX <br />;EDX ,counterptr:far Ptr, newcountptr:far Ptr<br />trsetpos PROC USES ESI EDI EAX EBX ECX EDX,counterptr:DWORD,newcountptr:DWORD<br />;***************************************************************************<br /><br />	<br />	P2L16   counter,counterptr<br />	P2L32   newcount,newcountptr<br /><br />	mov     dx,otbaseadr<br />	mov     ax,newcount<br /><br />	cmp     counter,1<br />	je      write<br />	cmp     counter,2<br />	je      write2<br />	cmp     counter,3<br />	je      write3<br />	cmp     counter,4<br />	je      write4<br />	jmp     writeend<br /><br />write2: add     dx,3<br />	jmp     write<br /><br />write3: add     dx,6<br />	jmp     write<br /><br />write4: add     dx,9<br />	jmp     write<br /><br />write:  out     dx,al                     ;output LSB<br />	mov     cl,8<br />	shr     ax,cl<br />	inc     dx<br />	out     dx,al                     ;output middle SB<br />	mov     ax,newcount+2<br />	inc     dx<br />	out     dx,al                     ;output MSB<br /><br />writeend:       ret<br />trsetpos        endp<br /><br />;***************************************************************************<br />;trreadpos PROC FAR EXPORT USES ESI EDI ES EAX EBX ECX <br />;EDX ,counterptr:far Ptr, countptr:far Ptr<br />trreadpos PROC USES ESI EDI EAX EBX ECX EDX,counterptr:DWORD,countptr:DWORD<br />;***************************************************************************<br /><br />P2L16   counter,counterptr<br /><br />reread: mov     dx,otbaseadr<br /><br />	cmp     counter,1<br />	je      read<br />	cmp     counter,2<br />	je      read2<br />	cmp     counter,3<br />	je      read3<br />	cmp     counter,4<br />	je      read4<br />	jmp     readend<br /><br />read2:  add     dx,3<br />	jmp     read<br /><br />read3:  add     dx,6<br />	jmp     read<br /><br />read4:  add     dx,9<br />	jmp     read<br /><br />read:   cli<br />	in      al,dx                     ;input LSB<br />	mov     cl,al                     ;store LSB in cl<br />	add     dx,2<br />	in      al,dx                     ;input MSB<br />	mov     bl,al                     ;store MSB in bl<br />	dec     dx<br />	in      al,dx                     ;input middle SB<br />	mov     ch,al                     ;store middle SB in ch<br /><br />	dec     dx                        ;point to the LSB<br />	in      al,dx<br />	cmp     al,cl<br />	je      readdone                  ;reread if al = 0 or FF<br />	cmp     al,0FFh<br />	je      read<br />	cmp     al,0<br />	je      read<br />	mov     cl,al<br /><br />readdone:<br />	mov     count,cx<br />	mov     al,bl<br />	cbw<br />	mov     count+2,ax<br /><br />	L2P32   countptr,count<br />readend:        sti<br />		ret<br />trreadpos       endp<br />;***************************************************************************<br />;trreadall PROC FAR EXPORT USES ESI EDI ES EAX EBX ECX <br />;EDX ,M1countptr:Far Ptr, M2countptr:Far Ptr, M3countptr:Far Ptr, M4countptr:Far Ptr<br />trreadall PROC USES ESI EDI EAX EBX ECX EDX,M1countptr:DWORD,M2countptr:DWORD,M3countptr:DWORD,M4countptr:DWORD<br />;***************************************************************************<br /><br />readM1: cli                               ;READ FIRST COUNTER<br />	mov     dx,otbaseadr<br />	in      al,dx                     ;input LSB<br />	mov     cl,al                     ;store LSB in cl<br />	add     dx,2<br />	in      al,dx                     ;input MSB<br />	mov     bl,al                     ;store MSB in bl<br />	dec     dx<br />	in      al,dx                     ;input middle SB<br />	mov     ch,al                     ;store middle SB in ch<br /><br />	dec     dx                        ;point to the LSB<br />	in      al,dx<br />	cmp     al,cl<br />	je      M1done                  ;reread if al = 0 or FF<br />	cmp     al,0FFh<br />	je      readM1<br />	cmp     al,0<br />	je      readM1<br />	mov     cl,al<br /><br />M1done: mov     M1count,cx<br />	mov     al,bl<br />	cbw<br />	mov     M1count+2,ax<br /><br />readM2: mov     dx,otbaseadr              ;do counter 2<br />	add     dx,3<br />	in      al,dx                     ;input LSB<br />	mov     cl,al                     ;store LSB in cl<br />	add     dx,2<br />	in      al,dx                     ;input MSB<br />	mov     bl,al                     ;store MSB in bl<br />	dec     dx<br />	in      al,dx                     ;input middle SB<br />	mov     ch,al                     ;store middle SB in ch<br /><br />	dec     dx                        ;point to the LSB<br />	in      al,dx<br />	cmp     al,cl<br />	je      M2done                  ;reread if al = 0 or FF<br />	cmp     al,0FFh<br />	je      readM2<br />	cmp     al,0<br />	je      readM2<br />	mov     cl,al<br /><br />M2done: mov     M2count,cx<br />	mov     al,bl<br />	cbw<br />	mov     M2count+2,ax<br /><br />readM3: mov     dx,otbaseadr              ;do counter 3<br />	add     dx,6<br />	in      al,dx                     ;input LSB<br />	mov     cl,al                     ;store LSB in cl<br />	add     dx,2<br />	in      al,dx                     ;input MSB<br />	mov     bl,al                     ;store MSB in bl<br />	dec     dx<br />	in      al,dx                     ;input middle SB<br />	mov     ch,al                     ;store middle SB in ch<br /><br />	dec     dx                        ;point to the LSB<br />	in      al,dx<br />	cmp     al,cl<br />	je      doneM3                  ;reread if al = 0 or FF<br />	cmp     al,0FFh<br />	je      readM3<br />	cmp     al,0<br />	je      readM3<br />	mov     cl,al<br /><br />doneM3: mov     M3count,cx<br />	mov     al,bl<br />	cbw<br />	mov     M3count+2,ax<br /><br />readM4: mov     dx,otbaseadr              ;do counter 4<br />	add     dx,9<br />	in      al,dx                     ;input LSB<br />	mov     cl,al                     ;store LSB in cl<br />	add     dx,2<br />	in      al,dx                     ;input MSB<br />	mov     bl,al                     ;store MSB in bl<br />	dec     dx<br />	in      al,dx                     ;input middle SB<br />	mov     ch,al                     ;store middle SB in ch<br /><br />	dec     dx                        ;point to the LSB<br />	in      al,dx<br />	cmp     al,cl<br />	je      doneM4                  ;reread if al = 0 or FF<br />	cmp     al,0FFh<br />	je      readM4<br />	cmp     al,0<br />	je      readM4<br />	mov     cl,al<br /><br />doneM4: mov     M4count,cx<br />	mov     al,bl<br />	cbw<br />	mov     M4count+2,ax<br /><br />	L2P32   M1countptr,M1count<br />	L2P32   M2countptr,M2count<br />	L2P32   M3countptr,M3count<br />	L2P32   M4countptr,M4count<br /><br />readall:        sti<br />		ret<br />trreadall       endp<br /><br />;***************************************************************************<br />;trhld PROC FAR EXPORT USES ESI EDI ES EAX EBX ECX <br />;EDX ,disableptr:Far Ptr<br />trhld PROC USES ESI EDI EAX EBX ECX EDX,disableptr:DWORD<br />;***************************************************************************<br /><br />	P2L16   disable,disableptr<br /><br />	mov     dx,otbaseadr<br />	add     dx,countenable<br />	mov     ax,disable<br />	out     dx,al<br /><br />	ret<br />trhld      endp<br /><br />;***************************************************************************<br />;trsts PROC FAR EXPORT USES ESI EDI ES EAX EBX ECX <br />;EDX ,Ipstatusptr:Far Ptr<br />trsts PROC USES ESI EDI EAX EBX ECX EDX,Ipstatusptr:DWORD<br />;***************************************************************************<br /><br />	mov     dx,otbaseadr<br />	add     dx,auxinputs<br />;	mov     al,disable<br />	in      al,dx<br /><br />;      	xor     al,0FFh                   ;invert input byte<br />;      	xor     ah,ah<br /><br />	mov     cl,al<br />	xor     ch,ch<br />	mov     Ipstatus,cx<br /><br />	L2P16   Ipstatusptr,Ipstatus<br /><br />	ret<br />trsts      endp<br /><br />;***************************************************************************<br />;trsync PROC FAR EXPORT USES ESI EDI ES EAX EBX ECX <br />;EDX,bitnumptr:Far Ptr, polarityptr:Far Ptr<br />trsync PROC USES ESI EDI EAX EBX ECX EDX,bitnumptr:DWORD,polarityptr:DWORD<br />;***************************************************************************<br /><br />	P2L16   bitnum,bitnumptr<br />	P2L16   polarity,polarityptr<br /><br />	dec     bitnum                  ;make 1-8 into 0-7<br /><br />	cmp     polarity,1<br />	jne     negpolarity<br />	mov     syncsignal,0<br />	jmp     lookforsync<br /><br />negpolarity:<br />	mov     syncsignal,1<br /><br />lookforsync:<br />	mov     dx,otbaseadr<br />	add     dx,auxinputs<br />retest: in      al,dx<br /><br />	mov     cx,bitnum               ;put bit to be tested in least sig<br />	shr     al,cl                   ; bit<br />	and     al,1                    ;clear all other bits<br />	cmp     al,syncsignal<br />	jne     retest<br /><br />waitforend:<br />	in      al,dx<br /><br />	mov     cx,bitnum               ;put bit to be tested in least sig<br />	shr     al,cl                   ; bit<br />	and     al,1                    ;clear all other bits<br />	cmp     al,syncsignal<br />	je      waitforend<br /><br />	ret<br />trsync     endp<br /><br />End DllEntry</div>
    <div class="meta">Posted on 2001-10-23 11:51:30 by mikef</div>
   </div>
   <div class="post" id="post-10111">
    <div class="subject"><a href="#post-10111">16-bit to 32-bit conversion???</a></div>
    <div class="body">You have to place the dll in the VB project's folder (where the vbp file is), if this doesn't work try the windows\system directory. I haven't checked your code, but the File not found error can only be caused by placing the dll in the wrong folder or something else in your VB code.</div>
    <div class="meta">Posted on 2001-10-23 12:44:23 by Qweerdy</div>
   </div>
   <div class="post" id="post-10112">
    <div class="subject"><a href="#post-10112">16-bit to 32-bit conversion???</a></div>
    <div class="body">That is why I think there is something else wrong with my DLL.<br /><br />I have put it in the Windows System directory and also in the directory with my project file.<br /><br />Here is my old declaration for the 16-bit DLL:<br /><br />Private Declare Sub trinfo Lib &quot;h:\sdev\tracker\trackw.dll&quot; (rev%)<br /><br /><br />Here is the declaration for my new 32-bit DLL:<br /><br />Private Declare Sub trinfo Lib &quot;newtrackdll&quot; (rev%)<br /><br />Also tried:<br /><br />Private Declare Sub trinfo Lib &quot;newtrackdll.dll&quot; (rev%)<br /><br />Private Declare Sub trinfo Lib &quot;c:\windows\system\newtrackdll.dll&quot; (rev%)<br /><br />etc...etc..<br /><br /><br />I get FILE NOT FOUND error. But when I try the same Declaration statement with a different DLL I get no entry point found for trinfo.<br /><br />I did it like this:<br /><br />Private Declare Sub trinfo Lib &quot;c:\windows\system\Danim.dll&quot; (rev%)<br /><br />That is telling me that the VB code is ok... it is the DLL.....right??<br /><br /><br />Thanks again for everyone's tremendous help!!!!!</div>
    <div class="meta">Posted on 2001-10-23 12:52:58 by mikef</div>
   </div>
   <div class="post" id="post-10147">
    <div class="subject"><a href="#post-10147">16-bit to 32-bit conversion???</a></div>
    <div class="body">micef,  in explorer right click your newly created dll and start &quot;quick view&quot;. If signature is 00004550 and you are able to find your function names in export table (with suffix &quot;@xx&quot; appended) everything should be ok.<br /><br />Since your dll uses in/out instructions, it will not run in WinNT/2k<br /><br />And it will be better for your new dll having a name with 8 characters maximum.<br /><br />japheth</div>
    <div class="meta">Posted on 2001-10-24 02:59:04 by japheth</div>
   </div>
   <div class="post" id="post-10159">
    <div class="subject"><a href="#post-10159">16-bit to 32-bit conversion???</a></div>
    <div class="body">Hi,<br /><br />Thanks for the new info. I looked at the DLL in the Quick View just like you said. I see the Descriptors that have the @_ and then the names of the routines. <br /><br />I do not see the 00004550.... The only number I see is 1003852862. This number is seen throughout the Quick View screen.<br /><br />What does this mean?? Thanks again for your good info.:alright:</div>
    <div class="meta">Posted on 2001-10-24 07:24:32 by mikef</div>
   </div>
   <div class="post" id="post-10168">
    <div class="subject"><a href="#post-10168">16-bit to 32-bit conversion???</a></div>
    <div class="body">00004550 should be in image file header under &quot;signature&quot; and is hexadecimal representation of &quot;PE&quot; (just to ensure that you dont have created a &quot;NE&quot; file with a possibly old linker.</div>
    <div class="meta">Posted on 2001-10-24 08:44:47 by japheth</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=1555&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=1555&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="1555" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=1555&amp;page=2">&gt;</a><a href="../?id=1555&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>