<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Direct function calls without using invoke - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17566" />
    <link rel="next" href="../?id=17566&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=17566">Direct function calls without using invoke</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=17566&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=17566&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="17566" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=17566&amp;page=2">&gt;</a><a href="../?id=17566&amp;page=2">&raquo;</a></form>   <div class="post" id="post-135877">
    <div class="subject"><a href="#post-135877">Direct function calls without using invoke</a></div>
    <div class="body">Here is a new technique enabling function calls without using the invoke statement.<br />An example:<br /><pre><code><br />.386<br />.model flat, stdcall<br />option casemap&#58;none<br />include \masm32\include\windows.inc<br />include stcall.inc<br />include kernel32.inc<br />include user32.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />.data<br />MsgCaption      db &quot;Iczelion's tutorial no.2&quot;,0<br />MsgBoxText      db &quot;Win32 Assembly is Great!&quot;,0<br /><br />.code<br />start&#58;<br />	MessageBox, NULL,addr MsgBoxText, addr MsgCaption, MB_OK<br />	ExitProcess,NULL<br />end start<br /></code></pre><br /><br />The technique is based on using equates having the same name of API functions. All these equates are associated with a macro simulating the invoke statement. For this purpose, I coded a tool named convinc creating new ones from Hutch's include files:<br /><pre><code><br />EXTERNDEF MessageBoxA@16&#58;proc<br />MessageBox equ &lt;stcall MessageBoxA@16,4&gt;<br /><br />EXTERNDEF MessageBoxExA@20&#58;proc<br />MessageBoxEx equ &lt;stcall MessageBoxExA@20,5&gt;<br /><br />EXTERNDEF MessageBoxIndirectA@4&#58;proc<br />MessageBoxIndirect equ &lt;stcall MessageBoxIndirectA@4,1&gt;<br /></code></pre><br /><br />The stcall macro works like invoke,it creates the necessary push,lea and call instructions for every API function call in the source file. Plus, stcall checks the number of passed parameters and the user is notified if the number of parameters is incorrect.<br /><br />The macro for stdcall functions:<br /><pre><code><br />stcall MACRO funcname&#58;REQ,param,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14,p15,p16,p17,p18,p19,p20<br />local pos,counter<br />counter=0<br /><br />    FOR arg,&lt;p20,p19,p18,p17,p16,p15,p14,p13,p12,p11,p10,p9,p8,p7,p6,p5,p4,p3,p2,p1&gt;<br /><br />        IFNB &lt;arg&gt;<br />             counter=counter+1<br />             pos=@InStr&#40;1,arg,&lt;ADDR&gt;&#41; OR @InStr&#40;1,arg,&lt;addr&gt;&#41; OR @InStr&#40;1,arg,&lt;Addr&gt;&#41;<br /><br />             IF pos<br /><br />                IF &#40;OPATTR&#40;@SubStr&#40;arg,%pos+5&#41;&#41;&#41; EQ 98<br />                        lea eax,@SubStr&#40;&lt;arg&gt;,%pos+5&#41;<br />                        push eax<br />                ELSE<br />                        push OFFSET @SubStr&#40;&lt;arg&gt;,%pos+5&#41;<br />                ENDIF<br /><br />             ELSE<br />                        push arg<br />             ENDIF<br />        ENDIF<br />    ENDM<br />IF counter NE param<br />tmp TEXTEQU %&#40;@Line&#41;<br />% echo  Line &#58; tmp , funcname , invalid number of parameters<br />.ERR<br />ENDIF<br /><br />call funcname<br />ENDM<br /></code></pre><br /><br />I coded also two other macros ccall and ccallva ( variable arguments) for C functions. You can create your own functions to be called directly without using the invoke macro. Instead of declaring WinMain with proto, you can type the following:<br /><pre><code><br />WinMain equ &lt;stcall _WinMain,4&gt;<br /></code></pre><br /><br />Here, the underscore or any valid symbol is required to avoid conflicts / symbol redefinitions:<br /><pre><code><br />_WinMain proc hInst&#58;HINSTANCE,hPrevInst&#58;HINSTANCE,CmdLine&#58;LPSTR,CmdShow&#58;DWORD<br />.<br />.<br />_WinMain ENDP<br /></code></pre><br /><br />Even, it's possible to use Hutch's func macro to nest function calls in other direct function calls:<br /><pre><code><br />FUNC MACRO parameters&#58;VARARG<br />parameters<br />EXITM &lt;eax&gt;<br />ENDM<br />.<br />.<br />mov hInstance,FUNC&#40;GetModuleHandle,NULL&#41;<br />mov CommandLine,FUNC&#40;GetCommandLine&#41;<br /></code></pre><br /><br />The usage of convinc:<br /><pre><code><br />convinc incfile.inc &#91;-w&#93;  &#40; Optional -w for UNICODE &#41;<br /></code></pre><br /><br />An example:<br /><pre><code><br />convinc \masm32\include\kernel32.inc<br /></code></pre><br />The new kernel32.inc will be created at the current directory.<br />Statements like *.inc are O.K.<br /><br />You can check the attachment for various examples of direct function calls.</div>
    <div class="meta">Posted on 2004-03-14 09:23:54 by Vortex</div>
   </div>
   <div class="post" id="post-135934">
    <div class="subject"><a href="#post-135934">Direct function calls without using invoke</a></div>
    <div class="body">You just gave me a crazy idea.....<br /><br />What I was using:<br /><pre><code><br />	externdef	_imp__ExitProcess@4&#58;NEAR	<br /><br />	LCALL@4 TYPEDEF proto &#58;dword<br />	FCALL@4 TYPEDEF PTR LCALL@4<br /><br />	ExitProcess TEXTEQU &lt;FCALL@4 PTR _imp__ExitProcess@4&gt;<br /><br />.code <br />	invoke ExitProcess,0<br /></code></pre><br />My crazy idea:<br /><pre><code><br />	externdef	_imp__ExitProcess@4&#58;NEAR	<br /><br />	LCALL@4 TYPEDEF proto &#58;dword<br />	FCALL@4 TYPEDEF PTR LCALL@4<br /><br />	ExitProcess TEXTEQU &lt;invoke FCALL@4 PTR _imp__ExitProcess@4&gt;<br /><br />.code<br />	ExitProcess,0<br /></code></pre><br />:grin:</div>
    <div class="meta">Posted on 2004-03-14 19:55:25 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-135963">
    <div class="subject"><a href="#post-135963">Direct function calls without using invoke</a></div>
    <div class="body">; Create protos PR0..PR24, ; ptr's PPR0..PPR024<br />; and equates PROTO0 equ proto:dword...<br /><br />makeproto MACRO _COUNT<br />    $ARGS equ &lt;&gt;<br />    repeat _COUNT<br />        $ARGS catstr $ARGS, &lt;, :DWORD&gt;<br />    endm<br />    CNT@ textequ %_COUNT<br />    % PR&amp;CNT@ typedef PROTO $ARGS       ; PR0, PR1...<br />    % PPR&amp;CNT@ typedef ptr PR&amp;CNT@      ;  PPR0, PPR1...<br />    % PROTO&amp;CNT@ equ PROTO&amp;$ARGS     ; PROTO0, PROTO1...<br />ENDM<br /><br />I@ = 0<br />while I@ lt 25<br />    makeproto I@<br />    I@ = I@ + 1<br />endm<br /><br />Now we have general typedefs PPR0..PPR24<br /><br />Tip: Put the ',' in the equate<br /><br />externdef _imp__ExitProcess@4:NEAR	<br />ExitProcess TEXTEQU &lt;invoke PPR1 _imp__ExitProcess@4,&gt;<br /><br />externdef _imp__MessageBox@16:NEAR	<br />ExitProcess TEXTEQU &lt;invoke PPR4 _imp__MessageBox@16,&gt;<br /><br />.code<br />             MessageBox hwnd, text, cap, style<br />	ExitProcess 0</div>
    <div class="meta">Posted on 2004-03-15 05:07:56 by gfalen</div>
   </div>
   <div class="post" id="post-135964">
    <div class="subject"><a href="#post-135964">Direct function calls without using invoke</a></div>
    <div class="body">:grin: <br /><br />To make it C like,<br /><br />Why not<br /><br />externdef _imp__ExitProcess@4:NEAR <br />ExitProcess( TEXTEQU &lt;invoke PPR1 _imp__ExitProcess@4,&gt;<br /><br />externdef _imp__MessageBox@16:NEAR <br />ExitProcess( TEXTEQU &lt;invoke PPR4 _imp__MessageBox@16,&gt;<br /><br />) TEXTEQU &quot; &quot;<br /><br />.code<br />MessageBox( hwnd, text, cap, style)<br />ExitProcess(0)<br /><br />Or something like that.. Have not tested it though..</div>
    <div class="meta">Posted on 2004-03-15 05:43:50 by roticv</div>
   </div>
   <div class="post" id="post-135972">
    <div class="subject"><a href="#post-135972">Direct function calls without using invoke</a></div>
    <div class="body">externdef _imp__MessageBox@16:NEAR <br />ExitProcess MACRO params:VARARG<br />EXITM @CatStr(&lt;invoke PPR4 _imp__MessageBox@16,&gt;,params)<br />ENDM<br /><br />ExitProcess(0)<br /><br />...should work, or something similar.  One problem is that I like to put my INVOKE's split between lines, and this cannot be done with macros using EXITM.<br /><br /><pre><code>MessageBox&#40; hwnd, \<br />    text, \<br />    cap, \<br />    style&#41;</code></pre>...does not work.</div>
    <div class="meta">Posted on 2004-03-15 07:51:37 by bitRAKE</div>
   </div>
   <div class="post" id="post-135992">
    <div class="subject"><a href="#post-135992">Direct function calls without using invoke</a></div>
    <div class="body">Wow,<br /><br />That's great, maybe with just a little more work we can make assembler look like this :<br /><br /><pre><code>static LRESULT CALLBACK WindowProc&#40;HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam&#41;<br />&#123;<br />    switch &#40;msg&#41;<br />    &#123;<br />        case WM_KEYDOWN&#58;<br />            switch &#40;wParam&#41;<br />            &#123;<br />                case VK_ESCAPE&#58;<br />                    PostQuitMessage&#40;0&#41;;<br />                    break;<br />            &#125;<br />            break;<br /><br />        case WM_SETCURSOR&#58;<br />            SetCursor&#40;NULL&#41;;<br />            return 1;<br /><br />        case WM_DESTROY&#58;<br />            PostQuitMessage&#40;0&#41;;<br />            break;<br /><br />        default&#58;<br />            return DefWindowProc&#40;hwnd, msg, wParam, lParam&#41;;<br />            break;<br />    &#125;<br /><br />    return 0;<br />&#125;</code></pre><br /><br />Sorry, just couldn't resist. I tried but I couldn't stop myself :)</div>
    <div class="meta">Posted on 2004-03-15 11:50:15 by donkey</div>
   </div>
   <div class="post" id="post-136012">
    <div class="subject"><a href="#post-136012">Direct function calls without using invoke</a></div>
    <div class="body">ThoughtCriminal,<br /><br />Many thanks for your method using the TYPEDEF and  PTR operators. From your previous posts, I saw that you worked a lot on the PROTO problem. Nice works.<br />This one also works:<br /><pre><code><br />.386<br />.model flat, stdcall<br />option casemap&#58;none<br />include \masm32\include\windows.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />externdef _imp__ExitProcess@4&#58;NEAR	<br />externdef _imp__MessageBoxA@16&#58;NEAR<br /><br />LCALL@16 TYPEDEF PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />FCALL@16 TYPEDEF PTR LCALL@16<br />LCALL@4 TYPEDEF PROTO &#58;DWORD<br />FCALL@4 TYPEDEF PTR LCALL@4<br /><br />ExitProcess TEXTEQU &lt;invoke FCALL@4 PTR _imp__ExitProcess@4&gt;<br />MessageBox TEXTEQU &lt;invoke FCALL@16 PTR _imp__MessageBoxA@16&gt;<br /><br />.data<br />MsgCaption      db &quot;Iczelion's tutorial no.2&quot;,0<br />MsgBoxText      db &quot;Win32 Assembly is Great!&quot;,0<br /><br />.code<br />start&#58;<br />      MessageBox,NULL,addr MsgBoxText, addr MsgCaption, MB_OK<br />      ExitProcess,NULL<br />end start<br /></code></pre></div>
    <div class="meta">Posted on 2004-03-15 14:18:52 by Vortex</div>
   </div>
   <div class="post" id="post-136016">
    <div class="subject"><a href="#post-136016">Direct function calls without using invoke</a></div>
    <div class="body"><div class="quote"><br />Wow,<br /><br />That's great, maybe with just a little more work we can make assembler look like this :<br /><br /><pre><code><br />&lt;&lt;C code snipped&gt;&gt;<br /></code></pre><br /><br />Sorry, just couldn't resist. I tried but I couldn't stop myself :) </div><br /><br />Sorry, it takes a little be more effort that &quot;just a little more work&quot; :-).<br />Been there, done that. The HLA source code is well in excess of 100,000 lines of code.<br /><br />BTW, don't think I didn't try the MASM macro route a long time ago. Alas, there are a couple of problems if you keep pushing the envelope:<br /><br />1. The macros aren't very robust. Everything looks cool <strong>until</strong> you make a mistake in the source code. Then the bizarre set of error messages you get back make you truly realize that macros in MASM aren't, perhaps, the best way to do this.<br /><br />2. You discover real quick that MASM's macro facilities are just strong enough to let you do some really cool things, but they tend to be insufficient to carry the whole thing to it's logical conclusion (i.e., &quot;with just a little more effort&quot;).<br /><br />Of course, the last point I'd make is that although these macros are kind of cute, you can do all this stuff today with HLA, e.g.,<br /><pre><code><br />procedure WindowProc&#40; hwnd&#58;HWND_t; msg&#58;uns32; wParam&#58;WPARAM_t; lParam&#58;LPARAM_t&#41;<br />begin WindowProc;<br /><br />    mov&#40; msg, eax &#41;;<br />    switch &#40;eax&#41;<br /><br />        case&#40; WM_KEYDOWN &#41;<br />            if&#40; wParam, = VK_ESCAPE then<br /><br />                    PostQuitMessage&#40;0&#41;;<br /><br />            endif;<br /><br />        case&#40; WM_SETCURSOR &#41;<br />            SetCursor&#40;NULL&#41;;<br />            mov&#40; 1, eax &#41;;<br />            exit WindowProc;<br /><br />        case&#40; WM_DESTROY &#41;<br />            PostQuitMessage&#40;0&#41;;<br /><br /><br />        default<br />            DefWindowProc&#40;hwnd, msg, wParam, lParam&#41;;<br />            exit WindowProc;<br />    <br />    endswitch;<br />    mov&#40; 0, eax &#41;;<br /><br />end WindowProc;<br /></code></pre><br /><br />Note, btw, that &quot;switch/case/default/endswitch&quot; <strong>is</strong> a macro in HLA.  HLA does have slightly more powerful macro facilities than MASM :-).<br />Cheers,<br />Randy Hyde</div>
    <div class="meta">Posted on 2004-03-15 14:47:51 by rhyde</div>
   </div>
   <div class="post" id="post-136019">
    <div class="subject"><a href="#post-136019">Direct function calls without using invoke</a></div>
    <div class="body">Hi Randy,<br /><br />I was being facetious, I personally like assembler and see no need to make it more like C, if you want C there are many free compilers for it. If you want assembler then there are many free versions of that as well. I purposefully picked a peice of code with Switch/Case in it, you know exactly why ;)</div>
    <div class="meta">Posted on 2004-03-15 15:12:23 by donkey</div>
   </div>
   <div class="post" id="post-136044">
    <div class="subject"><a href="#post-136044">Direct function calls without using invoke</a></div>
    <div class="body">Thanks Vortex,<br /><br />The TYPEDEF idea came from  bitRAKE.  Way back when I was trying to figure out how to do an indirect call.<br /><br />The idea behind the TEXTEQUs it to pack as much needed information as possible into one statement.<br /><br />Rather than doing it this way: (from kernel32.inc)<br /><br />CopyFileExW PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />CopyFileW PROTO :DWORD,:DWORD,:DWORD<br /><br />I can just use:<br /><br />CopyFileExW TEXTEQU &lt;invoke FCALL@4 PTR _imp__CopyFileExW@24&gt;<br />CopyFileW TEXTEQU &lt;invoke FCALL@4 PTR _imp__ExitProcess@12&gt;<br /><br />Now you got the invoke, type checking ect. all in one line.<br /><br />I dont use the MASM32 includes much anymore.  This way is easier for me.<br /><br />gfalen:<br /><br />Regarding the ',', I guess it is a matter of personal preferance.  Adding the comma myself just seems right to me.  With your style only the first would not need a comma, but any additional would need a comma.  The first parameter is now a special case.  Also there are some APIs or even using this style for your own procedures, you might not have any paramaters.  That is another special case where you do not include the ',' in the definition.</div>
    <div class="meta">Posted on 2004-03-15 20:22:13 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-136046">
    <div class="subject"><a href="#post-136046">Direct function calls without using invoke</a></div>
    <div class="body">The limitation in MASM macros inside brackets that can only occur on a single line is a pain but you can do most of the HLL stuff with a few others that don't enclose whole function calls in brackets.<br /><pre><code><br />    Switch uMsg<br />      Case WM_INITDIALOG<br />        fn SendMessage,hWin,WM_SETICON,1, \<br />                           FUNC&#40;LoadIcon,NULL,IDI_ASTERISK&#41;<br />        m2m hWnd, hWin<br />        return 1<br />      Case WM_COMMAND<br />        Switch wParam<br />          Case IDOK<br />            fn MessageBox,hWnd,&quot;You clicked OK&quot;, \<br />                          &quot;Hi&quot;,MB_OK or MB_ICONINFORMATION<br />          Case IDCANCEL<br />            jmp quit_dialog<br />        EndSw<br />      Case WM_CLOSE<br />        quit_dialog&#58;<br />         invoke EndDialog,hWin,0<br />    EndSw<br /><br />    return 0<br /></code></pre><br />I actually don't care if assembler does not look like C, I prefer it to look like assembler and that can be done with MASM.</div>
    <div class="meta">Posted on 2004-03-15 21:20:32 by hutch--</div>
   </div>
   <div class="post" id="post-136051">
    <div class="subject"><a href="#post-136051">Direct function calls without using invoke</a></div>
    <div class="body">i agree with donkey though - <br /><br />There is no reason to make ASM look like C, or any other HLL for that matter. People use ASM for size, and speed, and when you add an excessive amount of overhead macros, it creates alot of code bloat. Besides, why use ASM at all if you're only trying to mimic HLL syntax? Why not just use C? You can create smaller binaries and more optimized code using HLL C, than you can using HLL ASM. <br /><br /><br />-drocon</div>
    <div class="meta">Posted on 2004-03-15 22:00:14 by Drocon</div>
   </div>
   <div class="post" id="post-136420">
    <div class="subject"><a href="#post-136420">Direct function calls without using invoke</a></div>
    <div class="body">Hi ThoughtCriminal,<br /><br />The method based on using TYPEDEF syntax to embed the &quot;invoke&quot; doesn't work with static libraries. It looks like that it's not possibe to declare functions from static libs with the TYPEDEF PROTO syntax. Is there any solution for this problem?</div>
    <div class="meta">Posted on 2004-03-19 13:05:55 by Vortex</div>
   </div>
   <div class="post" id="post-136423">
    <div class="subject"><a href="#post-136423">Direct function calls without using invoke</a></div>
    <div class="body">What's the problem with TYPEDEF PROTO for static libs? Perhaps a name decoration thing? STDCALL vs. C, probably... try doing &quot;TYPEDEF PROTO C ...&quot; instead of &quot;TYPEDEF PROTO ...&quot;?</div>
    <div class="meta">Posted on 2004-03-19 13:21:40 by f0dder</div>
   </div>
   <div class="post" id="post-136426">
    <div class="subject"><a href="#post-136426">Direct function calls without using invoke</a></div>
    <div class="body">Hi f0dder,<br /><br />First problem, the masm32 lib function declaration below doesn't work (linking error):<br /><pre><code><br />EXTERNDEF _imp__StdOut@4&#58;PROC<br />StdOut equ &lt;invoke ppr1 PTR _imp__StdOut@4&gt;<br /></code></pre><br /><br />So, changing it to:<br /><pre><code><br />EXTERNDEF szCatStr@8&#58;PROC<br />szCatStr equ &lt;invoke ppr2 PTR szCatStr@8&gt;<br /><br />EXTERNDEF StdOut@4&#58;PROC<br />StdOut equ &lt;invoke ppr1 PTR StdOut@4&gt;<br />.<br />.<br />.data<br />msg1 db 'Hello ',0<br />     db 11 dup&#40;0&#41;<br />msg2 db 'my friend!',0<br /><br />.code<br />start&#58;<br />szCatStr,ADDR msg1,ADDR msg2<br />StdOut,ADDR msg1<br />ExitProcess,0<br />END start<br /></code></pre><br /><br />This example seems to be builded O.K, but it crashes on running:<br /><pre><code><br />00401000 &gt;/$ 68 12304000    PUSH Console.00403012                    ;  ASCII &quot;my friend!&quot;<br />00401005  |. 68 00304000    PUSH Console.00403000                    ;  ASCII &quot;Hello &quot;<br />0040100A  |. FF15 30104000  CALL DWORD PTR DS&#58;&#91;401030&#93; &lt;---- Here<br />00401010  |. 68 00304000    PUSH Console.00403000                    ;  ASCII &quot;Hello &quot;<br />00401015  |. FF15 60104000  CALL DWORD PTR DS&#58;&#91;401060&#93; &lt;---- Here<br />0040101B  |. 6A 00          PUSH 0                                   ; /ExitCode = 0<br />0040101D  \. FF15 08204000  CALL DWORD PTR DS&#58;&#91;&lt;&amp;kernel32.ExitProces&gt;; \ExitProcess<br />00401023     CC             INT3<br />00401024     CC             INT3<br />00401025     CC             INT3<br />00401026     CC             INT3<br />00401027     CC             INT3<br />00401028     CC             INT3<br />00401029     CC             INT3<br />0040102A     CC             INT3<br />0040102B     CC             INT3<br />0040102C     CC             INT3<br />0040102D     CC             INT3<br />0040102E     CC             INT3<br />0040102F     CC             INT3<br />00401030   . 558BEC57       DD 57EC8B55 &lt;--- Here is the problem<br /></code></pre><br /><br />You can check the console example in the attachment ( included a new version of convinc )</div>
    <div class="meta">Posted on 2004-03-19 14:54:36 by Vortex</div>
   </div>
   <div class="post" id="post-136457">
    <div class="subject"><a href="#post-136457">Direct function calls without using invoke</a></div>
    <div class="body">I have never used masm32.lib, but I dumped the public symbols:<br /><br />If your are going to use this style, it helps to dump the symbols to make sure you are using the same syntactic form:<br /><br />     1CAA _szLeft@12<br />     1E0E _szCatStr@8<br />     1F96 _StrLen@4<br />     210C _StripRangeX@16<br />     2288 _StripLF@4<br />     23DE _StripRangeI@16<br />     2558 _StdOut@4<br />     2748 _StdIn@8<br /><br />All the Microsoft libs use the _imp__  form.  <br />That explains your linker error.<br /><br />I'll take a closer look later, but right now try this:<br /><pre><code><br />Change this&#58;<br /><br />EXTERNDEF szCatStr@8&#58;PROC<br />szCatStr equ &lt;invoke ppr2 PTR szCatStr@8&gt;<br /><br />EXTERNDEF StdOut@4&#58;PROC<br />StdOut equ &lt;invoke ppr1 PTR StdOut@4&gt;<br /><br />to this...<br /><br />EXTERNDEF &#91;COLOR=red&#93;_&#91;/COLOR&#93;szCatStr@8&#58;PROC<br />szCatStr equ &lt;invoke ppr2 PTR szCatStr@8&gt;<br /><br />EXTERNDEF &#91;COLOR=red&#93;_&#91;/COLOR&#93;StdOut@4&#58;PROC<br />StdOut equ &lt;invoke ppr1 PTR StdOut@4&gt;<br /></code></pre></div>
    <div class="meta">Posted on 2004-03-19 22:25:35 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-136468">
    <div class="subject"><a href="#post-136468">Direct function calls without using invoke</a></div>
    <div class="body">Also change this:<br /><pre><code><br />EXTERNDEF szCatStr@8&#58;PROC<br />szCatStr equ &lt;invoke &#91;COLOR=red&#93;pr2&#91;/COLOR&#93; PTR szCatStr@8&gt;<br /><br />EXTERNDEF StdOut@4&#58;PROC<br />StdOut equ &lt;invoke &#91;COLOR=red&#93;pr1&#91;/COLOR&#93; PTR StdOut@4&gt;<br /></code></pre><br />I cannot get your example to assemble. I'm using MASM32 v7.<br /><br />The problem is it is treating the proc entry point as a pointer:<br /><pre><code><br />0040100A  |. FF15 30104000  CALL DWORD PTR DS&#58;&#91;401030&#93; ---&gt;DD 57EC8B55<br />00401010  |. 68 00304000    PUSH Console.00403000                    ;  ASCII &quot;Hello &quot;<br />00401015  |. FF15 60104000  CALL DWORD PTR DS&#58;&#91;401060&#93; &lt;---- Here<br /></code></pre><br />The original reason for the TYPEDEFs was to get pointer style calls that start with FF.<br />Using just pr2 should get you the proper E8 or relative call for static code.</div>
    <div class="meta">Posted on 2004-03-20 00:21:30 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-136475">
    <div class="subject"><a href="#post-136475">Direct function calls without using invoke</a></div>
    <div class="body">ThoughtCriminal,<br /><br />This syntax works fine:<br /><pre><code><br />EXTERNDEF szCatStr@8&#58;PROC<br />szCatStr equ &lt;invoke pr2 PTR szCatStr@8&gt;<br /><br />EXTERNDEF StdOut@4&#58;PROC<br />StdOut equ &lt;invoke pr1 PTR StdOut@4&gt;<br /></code></pre><br /><br />Many thanks.<br /><br />Another thing, when I use your invoke &amp; TYPEDEF PROTO method,I  get direct function calls instead of the lookup table.</div>
    <div class="meta">Posted on 2004-03-20 02:39:54 by Vortex</div>
   </div>
   <div class="post" id="post-136483">
    <div class="subject"><a href="#post-136483">Direct function calls without using invoke</a></div>
    <div class="body">Seems like a few people are still confused about static libraries and import libraries :). The __imp__* convention is &quot;usually a pretty good indication&quot; :) that you're dealing with an import, at least in microsoft generated libraries. In theory you could call them anything you want, I dunno if there's tools that generate non-standard names (Borland? GNU?).<br /><br />Static libraries obviously don't generate IAT slots and jmp-indirect thunks, so you just call those funcs directly, as they get embedded in your executable (masm32.lib, d3d8x.lib, htmlhelp.lib ...).<br /><br />When generating includes from libraries, things can become tricky - a few libraries include both static code and imports, if nothing else a bunch of COM stuff has static IID's and imports from DLLs.<br /><br />My protoize tool currently chokes on libs like this, I really need to fix up the library parsing + symtab code a bit :)</div>
    <div class="meta">Posted on 2004-03-20 04:36:47 by f0dder</div>
   </div>
   <div class="post" id="post-136490">
    <div class="subject"><a href="#post-136490">Direct function calls without using invoke</a></div>
    <div class="body">f0dder,<br /><br />Did you release your protoize tool? I guess you are working since longtime on this tool.<br /><br />My original stcall macro handles successfully API functions and static lib functions.</div>
    <div class="meta">Posted on 2004-03-20 05:10:25 by Vortex</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=17566&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=17566&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="17566" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=17566&amp;page=2">&gt;</a><a href="../?id=17566&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>