<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ListView crashing on WinXP SP1? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=9548" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=9548">ListView crashing on WinXP SP1?</a></p>
   <div class="post" id="post-70711">
    <div class="subject"><a href="#post-70711">ListView crashing on WinXP SP1?</a></div>
    <div class="body">I am having a problem making a &quot;poplistview&quot; program (similar to the poplist example in the masm32 package) on Windows XP SP1.  The program runs fine until I add in theme support via a manifest file.  After adding the manifest file, the program quits immediately after displaying the window.  Right now I just want to know if this is normal behavior, so I'm asking if someone running Windows XP SP1 could assemble and run the following code and verify the failure. Thanks =)<br /><br />lv.asm<pre><code>.386<br />.model flat, stdcall<br />option casemap&#58;none<br />include \masm32\include\windows.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\comctl32.inc<br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\comctl32.lib<br /><br />WindowProc proto hwnd&#58;dword, uMsg&#58;dword, wParam&#58;dword, lParam&#58;dword<br /><br />.data<br />szClass       db &quot;SysListView32&quot;, 0<br />pfnWindowProc dd 0<br /><br />.code<br />Main proc<br />    local msg&#58;MSG<br />    invoke GetModuleHandle, 0<br />    invoke CreateWindowEx, 0, addr szClass, 0, WS_OVERLAPPEDWINDOW or WS_VISIBLE or LVS_REPORT, 0, 0, 300, 300, 0, 0, eax, 0<br />    invoke SetWindowLong, eax, GWL_WNDPROC, addr WindowProc<br />    mov pfnWindowProc, eax<br />@@&#58; invoke GetMessage, addr msg, 0, 0, 0<br />    cmp eax, 0<br />    je @F<br />    invoke TranslateMessage, addr msg<br />    invoke DispatchMessage, addr msg<br />    jmp @B<br />@@&#58; invoke ExitProcess, msg.wParam<br />    invoke InitCommonControls<br />Main endp<br /><br />WindowProc proc hwnd&#58;dword, uMsg&#58;dword, wParam&#58;dword, lParam&#58;dword<br />    cmp uMsg, WM_DESTROY<br />    je @F<br />    invoke CallWindowProc, pfnWindowProc, hwnd, uMsg, wParam, lParam<br />    ret<br />@@&#58; invoke PostQuitMessage, 0<br />    ret<br />WindowProc endp<br /><br />end Main</code></pre>lv.exe.manifest<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;<br />&lt;assembly xmlns=&quot;urn&#58;schemas-microsoft-com&#58;asm.v1&quot; manifestVersion=&quot;1.0&quot;&gt;<br />&lt;assemblyIdentity<br />version=&quot;1.0.0.0&quot;<br />processorArchitecture=&quot;X86&quot;<br />name=&quot;CompanyName.ProductName.YourApp&quot;<br />type=&quot;win32&quot;<br />/&gt;<br />&lt;description&gt;Your application description here.&lt;/description&gt;<br />&lt;dependency&gt;<br />&lt;dependentAssembly&gt;<br />&lt;assemblyIdentity<br />type=&quot;win32&quot;<br />name=&quot;Microsoft.Windows.Common-Controls&quot;<br />version=&quot;6.0.0.0&quot;<br />processorArchitecture=&quot;X86&quot;<br />publicKeyToken=&quot;6595b64144ccf1df&quot;<br />language=&quot;*&quot;<br />/&gt;<br />&lt;/dependentAssembly&gt;<br />&lt;/dependency&gt;<br />&lt;/assembly&gt;</code></pre></div>
    <div class="meta">Posted on 2002-12-12 22:35:07 by BubbaFate</div>
   </div>
   <div class="post" id="post-70716">
    <div class="subject"><a href="#post-70716">ListView crashing on WinXP SP1?</a></div>
    <div class="body">Works fine for me, I have XP pro SP1. I tried with the manifest incorporated in the exe as a resource and externally. I verified that CC version 6 was loaded with the following :<br /><br /><pre><code><br />CheckLibVersion proc <br />	LOCAL LibVersion		&#58;DLLVERSIONINFO<br />	LOCAL pComCtrllib		&#58;DWORD<br />	LOCAL pGetVersion		&#58;DWORD<br />	LOCAL buffer			&#58;BYTE<br /><br />	jmp @F<br />		LibName		BYTE	&quot;comctl32.dll&quot;,0<br />		FuncName	BYTE	&quot;DllGetVersion&quot;,0<br />	@@&#58;<br /><br />	mov LibVersion.cbSize,SIZEOF DLLVERSIONINFO<br />	invoke LoadLibrary,ADDR LibName<br />	mov pComCtrllib,eax<br />	.IF eax != NULL<br />		invoke GetProcAddress,pComCtrllib,ADDR FuncName<br />		mov pGetVersion,eax<br />		.IF eax != NULL<br />			lea eax,LibVersion<br />			push eax<br />			call pGetVersion<br />		.ENDIF<br />		invoke FreeLibrary,pComCtrllib<br />	.ENDIF<br /><br />	invoke dw2a,LibVersion.dwMajorVersion,ADDR buffer<br />	invoke MessageBox,NULL,ADDR buffer,NULL,MB_OK<br />	<br />	ret<br />CheckLibVersion endp<br /></code></pre><br /><br />I didn't try your manifest however, this is what I used, I don't know if it makes a diff.<br /><br /><pre><code><br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;<br />&lt;assembly xmlns=&quot;urn&#58;schemas-microsoft-com&#58;asm.v1&quot; manifestVersion=&quot;1.0&quot;&gt;<br />&lt;assemblyIdentity<br />    version=&quot;1.0.0.0&quot;<br />    processorArchitecture=&quot;X86&quot;<br />    name=&quot;CompanyName.ProductName.YourApp&quot;<br />    type=&quot;win32&quot;<br />/&gt;<br />&lt;description&gt;Test the manifest.&lt;/description&gt;<br />&lt;dependency&gt;<br />    &lt;dependentAssembly&gt;<br />        &lt;assemblyIdentity<br />            type=&quot;win32&quot;<br />            name=&quot;Microsoft.Windows.Common-Controls&quot;<br />            version=&quot;6.0.0.0&quot;<br />            processorArchitecture=&quot;X86&quot;<br />            publicKeyToken=&quot;6595b64144ccf1df&quot;<br />            language=&quot;*&quot;<br />        /&gt;<br />    &lt;/dependentAssembly&gt;<br />&lt;/dependency&gt;<br />&lt;/assembly&gt;<br /></code></pre><br /><br />it looks the same on a quick inspection.<br /><br />Donkey</div>
    <div class="meta">Posted on 2002-12-12 23:00:22 by donkey</div>
   </div>
   <div class="post" id="post-70720">
    <div class="subject"><a href="#post-70720">ListView crashing on WinXP SP1?</a></div>
    <div class="body">Thanks for checkin that out for me, looks like its time to visit format dot com</div>
    <div class="meta">Posted on 2002-12-12 23:32:21 by BubbaFate</div>
   </div>
  </div>
 </body>
</html>