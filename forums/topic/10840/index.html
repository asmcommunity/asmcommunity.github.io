<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>How would you copy a treeview to a treeview? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10840" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=10840">How would you copy a treeview to a treeview?</a></p>
   <div class="post" id="post-81672">
    <div class="subject"><a href="#post-81672">How would you copy a treeview to a treeview?</a></div>
    <div class="body">I am curious how you would copy a treeview from one tree to another.  Since there was nothing on the board and I needed this, here is what I came up with... anything better?<br /><br /><pre><code><br />CopyTree proc uses esi edi ebx SourceTree&#58;DWORD, DestTree&#58;DWORD<br />LOCAL	tvi&#58;TVITEM<br />LOCAL	tvis&#58;TV_INSERTSTRUCT<br />LOCAL	RootText&#91;50&#93;&#58;BYTE<br />LOCAL	ChildText&#91;50&#93;&#58;BYTE<br />LOCAL	hNode&#58;DWORD<br /><br />GetRoot&#58;<br />	; Get root node handle<br />	push	0<br />	push	TVGN_ROOT<br />	push	TVM_GETNEXTITEM<br />	push	SourceTree<br />	call	SendMessage<br />	test	eax, eax<br />	jz	Done			; Empty tree, leave<br />	<br />	mov	esi, eax		; esi = node handle<br />	mov	edi, eax		; edi = parent node handle<br />	<br />	push	esi<br />	push	TVGN_CHILD<br />	push	TVM_GETNEXTITEM<br />	push	SourceTree<br />	call	SendMessage<br />	mov	ebx, eax<br />	test	eax, eax<br />	jz	DeleteRoot		; No children, delete root and get next root node<br /><br />; #######################################<br />; ###### Copy root node<br />	mov	tvi._mask, TVIF_TEXT<br />	mov	tvi.hItem, esi<br />	mov	tvi.cchTextMax, 50<br />	lea	ecx, RootText<br />	mov	tvi.pszText, ecx<br />	lea	eax, tvi<br />	push	eax<br />	push	0<br />	push	TVM_GETITEM<br />	push	SourceTree<br />	call	SendMessage		; Get root text<br />	<br />	mov	tvis.hParent, TVI_ROOT<br />	mov	tvis.hInsertAfter, TVI_SORT<br />	mov	tvis.item._mask, TVIF_TEXT\<br />					or TVIF_IMAGE\<br />					or TVIF_SELECTEDIMAGE<br />	mov	tvis.item.iImage, ICON_FOLDER_CLOSED<br />	mov	tvis.item.iSelectedImage, ICON_FOLDER_OPEN <br />	lea	eax, RootText<br />	mov	tvis.item.pszText, eax	<br />	lea	ecx, tvis<br />	push	ecx<br />	push	0<br />	push	TVM_INSERTITEM<br />	push	DestTree<br />	call	SendMessage<br />	mov	hNode, eax<br />	<br />; #######################################<br />; ###### Copy 1st root child	<br />	mov	tvi._mask, TVIF_TEXT or TVIF_PARAM<br />	mov	tvi.hItem, ebx<br />	mov	tvi.cchTextMax, 50<br />	lea	ecx, ChildText<br />	mov	tvi.pszText, ecx<br />	lea	eax, tvi<br />	push	eax<br />	push	0<br />	push	TVM_GETITEM<br />	push	SourceTree<br />	call	SendMessage<br /><br />	push	hNode<br />	pop	tvis.hParent<br />	mov	tvis.hInsertAfter, TVI_SORT<br />	mov	tvis.item._mask, TVIF_TEXT\<br />					or TVIF_IMAGE\<br />					or TVIF_SELECTEDIMAGE\<br />					or TVIF_PARAM<br />	mov	tvis.item.iImage, ICON_ITEM<br />	mov	tvis.item.iSelectedImage, ICON_ITEM<br />	lea	eax, ChildText<br />	mov	tvis.item.pszText, eax<br />	push	tvi.lParam<br />	pop	tvis.item.lParam	<br />	lea	ecx, tvis<br />	push	ecx<br />	push	0<br />	push	TVM_INSERTITEM<br />	push	DestTree<br />	call	SendMessage<br />	<br />	jmp	GetRootChild<br /><br />DeleteRoot&#58;<br />	push	esi<br />	push	0<br />	push	TVM_DELETEITEM<br />	push	hTVConfig<br />	call	SendMessage<br />	jmp	GetRoot<br /><br />GetRootChild&#58;<br />; #######################################<br />; ###### Loop through each root child and copy info<br />	push	ebx<br />	push	TVGN_NEXT<br />	push	TVM_GETNEXTITEM<br />	push	SourceTree<br />	call	SendMessage<br />	mov	ebx, eax<br />	test	eax, eax<br />	jz	GetNextParent		; Done with root children, get next parent <br /><br />	mov	tvi._mask, TVIF_TEXT or TVIF_PARAM<br />	mov	tvi.hItem, ebx<br />	mov	tvi.cchTextMax, 50<br />	lea	ecx, ChildText<br />	mov	tvi.pszText, ecx<br />	lea	eax, tvi<br />	push	eax<br />	push	0<br />	push	TVM_GETITEM<br />	push	SourceTree<br />	call	SendMessage<br />	push	hNode<br />	pop	tvis.hParent<br />	mov	tvis.hInsertAfter, TVI_SORT<br />	mov	tvis.item._mask, TVIF_TEXT\<br />					or TVIF_IMAGE\<br />					or TVIF_SELECTEDIMAGE\<br />					or TVIF_PARAM<br />	mov	tvis.item.iImage, ICON_ITEM<br />	mov	tvis.item.iSelectedImage, ICON_ITEM<br />	lea	eax, ChildText<br />	mov	tvis.item.pszText, eax<br />	push	tvi.lParam<br />	pop	tvis.item.lParam	<br />	lea	ecx, tvis<br />	push	ecx<br />	push	0<br />	push	TVM_INSERTITEM<br />	push	DestTree<br />	call	SendMessage<br />	<br />        jmp	GetRootChild<br /><br />GetNextParent&#58;<br />; #######################################<br />; ###### Loop through tree and copy each non empty parent and child<br />	push	edi<br />	push	TVGN_NEXT<br />	push	TVM_GETNEXTITEM<br />	push	SourceTree<br />	call	SendMessage<br />	mov	esi, eax<br />	test	eax, eax<br />	jz	Done         <br /><br />	push	esi<br />	push	TVGN_CHILD<br />	push	TVM_GETNEXTITEM<br />	push	SourceTree<br />	call	SendMessage<br />	mov	ebx, eax<br />	test	eax, eax<br />	jz	DeleteParent<br /><br />	mov	tvi._mask, TVIF_TEXT<br />	mov	tvi.hItem, esi<br />	mov	tvi.cchTextMax, 50<br />	lea	ecx, RootText<br />	mov	tvi.pszText, ecx<br />	lea	eax, tvi<br />	push	eax<br />	push	0<br />	push	TVM_GETITEM<br />	push	SourceTree<br />	call	SendMessage   <br />	<br />; #######################################<br />; ###### Copy current parent<br />	mov	tvis.hParent, TVI_ROOT<br />	mov	tvis.hInsertAfter, TVI_SORT<br />	mov	tvis.item._mask, TVIF_TEXT\<br />					or TVIF_IMAGE\<br />					or TVIF_SELECTEDIMAGE<br />	mov	tvis.item.iImage, ICON_FOLDER_CLOSED<br />	mov	tvis.item.iSelectedImage, ICON_FOLDER_OPEN <br />	lea	eax, RootText<br />	mov	tvis.item.pszText, eax	<br />	lea	ecx, tvis<br />	push	ecx<br />	push	0<br />	push	TVM_INSERTITEM<br />	push	DestTree<br />	call	SendMessage<br />	mov	hNode, eax<br /><br />	mov	tvi._mask, TVIF_TEXT or TVIF_PARAM<br />	mov	tvi.hItem, ebx  <br />	mov	tvi.cchTextMax, 50<br />	lea	ecx, ChildText<br />	mov	tvi.pszText, ecx      <br />	lea	eax, tvi<br />	push	eax<br />	push	0<br />	push	TVM_GETITEM<br />	push	SourceTree<br />	call	SendMessage<br />	<br />; #######################################<br />; ###### Copy current parents 1st child<br />	push	hNode<br />	pop	tvis.hParent<br />	mov	tvis.hInsertAfter, TVI_SORT<br />	mov	tvis.item._mask, TVIF_TEXT\<br />					or TVIF_IMAGE\<br />					or TVIF_SELECTEDIMAGE\<br />					or TVIF_PARAM<br />	mov	tvis.item.iImage, ICON_ITEM<br />	mov	tvis.item.iSelectedImage, ICON_ITEM<br />	lea	eax, ChildText<br />	mov	tvis.item.pszText, eax<br />	push	tvi.lParam<br />	pop	tvis.item.lParam	<br />	lea	ecx, tvis<br />	push	ecx<br />	push	0<br />	push	TVM_INSERTITEM<br />	push	DestTree<br />	call	SendMessage<br /><br />	jmp	GetChild<br /><br />DeleteParent&#58;<br />	push	esi<br />	push	0<br />	push	TVM_DELETEITEM<br />	push	SourceTree<br />	call	SendMessage<br />	jmp	GetNextParent<br /><br />GetChild&#58;<br />; #######################################<br />; ###### Loop through each child of current parent and copy<br />	push	ebx<br />	push	TVGN_NEXT<br />	push	TVM_GETNEXTITEM<br />	push	SourceTree<br />	call	SendMessage<br />	mov	ebx, eax<br />	test	eax, eax<br />	jz	NoChildren<br />	<br />	mov	tvi._mask, TVIF_TEXT or TVIF_PARAM<br />	mov	tvi.hItem, ebx<br />	mov	tvi.cchTextMax, 50<br />	lea	ecx, ChildText<br />	mov	tvi.pszText, ecx  <br />	lea	eax, tvi<br />	push	eax<br />	push	0<br />	push	TVM_GETITEM<br />	push	SourceTree<br />	call	SendMessage<br /><br />	push	hNode<br />	pop	tvis.hParent<br />	mov	tvis.hInsertAfter, TVI_SORT<br />	mov	tvis.item._mask, TVIF_TEXT\<br />					or TVIF_IMAGE\<br />					or TVIF_SELECTEDIMAGE\<br />					or TVIF_PARAM<br />	mov	tvis.item.iImage, ICON_ITEM<br />	mov	tvis.item.iSelectedImage, ICON_ITEM<br />	lea	eax, ChildText<br />	mov	tvis.item.pszText, eax<br />	push	tvi.lParam<br />	pop	tvis.item.lParam	<br />	lea	ecx, tvis<br />	push	ecx<br />	push	0<br />	push	TVM_INSERTITEM<br />	push	DestTree<br />	call	SendMessage<br />	<br />	jmp	GetChild<br /><br />NoChildren&#58;<br />	mov	edi, esi<br />	jmp	GetNextParent<br />        <br />Done&#58;<br />	ret   <br />CopyTree endp  <br /></code></pre><br /><br />Usage is simple:<br /><pre><code><br />	push	hTVMain<br />	push	hTVConfig<br />	call	CopyTree<br /></code></pre><br /><br />Seems as if there is a lot of code to do this.  But then again, you have to get the root first, check for children, get the first child handle then loop through the other children....  and do the same for each node</div>
    <div class="meta">Posted on 2003-02-13 21:15:17 by Gunner</div>
   </div>
  </div>
 </body>
</html>