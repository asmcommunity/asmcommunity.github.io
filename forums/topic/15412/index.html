<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Richedit &amp; Graphics - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=15412" />
    <link rel="next" href="../?id=15412&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=15412">Richedit &amp; Graphics</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=15412&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=15412&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="15412" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=15412&amp;page=2">&gt;</a><a href="../?id=15412&amp;page=2">&raquo;</a></form>   <div class="post" id="post-119768">
    <div class="subject"><a href="#post-119768">Richedit &amp; Graphics</a></div>
    <div class="body">Hi Everyone,<br /><br />   Is it possible/easy to draw graphics into a normal Richedit control, after searching the internet for hours, i cant really find any examples that make much sense, especially not in asm.<br /><br />   I think its got something to do with IRichEditOleCallback.. but i dont know what this is or how to use it...<br /><br />   If anyone has got any idea's or source code i would be very grateful<br /><br />Thank you,<br />Lennon.</div>
    <div class="meta">Posted on 2003-09-27 23:40:51 by Lennon</div>
   </div>
   <div class="post" id="post-119858">
    <div class="subject"><a href="#post-119858">Richedit &amp; Graphics</a></div>
    <div class="body">Nobody got any idea's ? :confused:</div>
    <div class="meta">Posted on 2003-09-28 11:47:17 by Lennon</div>
   </div>
   <div class="post" id="post-119976">
    <div class="subject"><a href="#post-119976">Richedit &amp; Graphics</a></div>
    <div class="body">Been searching all day, still cant find anything<br /><br />:(</div>
    <div class="meta">Posted on 2003-09-29 11:53:39 by Lennon</div>
   </div>
   <div class="post" id="post-119989">
    <div class="subject"><a href="#post-119989">Richedit &amp; Graphics</a></div>
    <div class="body">Don't know much about this stuff so I'm not sure it will help you, but you can try using GetDC and draw directly on the richedit control.</div>
    <div class="meta">Posted on 2003-09-29 13:25:22 by Delight</div>
   </div>
   <div class="post" id="post-120000">
    <div class="subject"><a href="#post-120000">Richedit &amp; Graphics</a></div>
    <div class="body">huh. I thought I have seen at least 3 such threads here. I don't code any richedit, so I haven't saved them on my hdd. Maybe you should search better. &quot;richedit AND background&quot; ...</div>
    <div class="meta">Posted on 2003-09-29 14:34:53 by Ultrano</div>
   </div>
   <div class="post" id="post-120010">
    <div class="subject"><a href="#post-120010">Richedit &amp; Graphics</a></div>
    <div class="body">I dont want to draw text over some fancy background, i found those posts on the forum.<br /><br />I want to display graphics for a chat progam, as is in something like this : :alright: <br /><br />looking at this <a target="_blank" href="http://www.codeguru.com/richedit/richeditrc.html">http://www.codeguru.com/richedit/richeditrc.html</a><br /><br />it seems its possible...</div>
    <div class="meta">Posted on 2003-09-29 15:31:51 by Lennon</div>
   </div>
   <div class="post" id="post-120045">
    <div class="subject"><a href="#post-120045">Richedit &amp; Graphics</a></div>
    <div class="body">I understand. Then search for the Miranda IM . It's an open-source project, a wonderful ICQ client that I use. It has such images inside of the textfield. <br />In fact, no need to search - the site is <br /><a target="_blank" href="http://www.miranda-im.org/">http://www.miranda-im.org/</a></div>
    <div class="meta">Posted on 2003-09-29 23:45:40 by Ultrano</div>
   </div>
   <div class="post" id="post-120292">
    <div class="subject"><a href="#post-120292">Richedit &amp; Graphics</a></div>
    <div class="body">Hi,<br /><br />Just got back from a few days away, thanks for the link Ultrano i will have a look and see if i can find any usefull information/source code<br /><br />Thank you,<br />Lennon.</div>
    <div class="meta">Posted on 2003-10-02 10:48:06 by Lennon</div>
   </div>
   <div class="post" id="post-120574">
    <div class="subject"><a href="#post-120574">Richedit &amp; Graphics</a></div>
    <div class="body">arrgggg its no good :mad:<br /><br />i've been looking all over the place for info but nothing is making sense to me, unless its asm and strait win32 api  i just dont understand :rolleyes:<br /><br />I've managed to find this .....<br /><br /><a target="_blank" href="http://support.microsoft.com/default.aspx?scid=kb;en-us;220844">http://support.microsoft.com/default.aspx?scid=kb;en-us;220844</a> <br /><br />can anybody make sense of it and explain it to me?</div>
    <div class="meta">Posted on 2003-10-05 21:32:11 by Lennon</div>
   </div>
   <div class="post" id="post-120720">
    <div class="subject"><a href="#post-120720">Richedit &amp; Graphics</a></div>
    <div class="body">Hi<br />I'm still new at OOP, but I tried to convert the code at MSDN (and failed miserably :( ).<br />Here's the source... if anyone with some experience in this could point out my mistakes, I'll appreciate it.<br />It seems to run fine until OleCreateFromFile is called. It returns error &quot;incorrect tymed&quot;.<br />:confused: <br /><br />BTW, all the structures and equates were taken from VC and converted to MASM syntax &quot;by hand&quot;, so please look if there are any mistakes there...</div>
    <div class="meta">Posted on 2003-10-07 17:38:29 by QvasiModo</div>
   </div>
   <div class="post" id="post-120735">
    <div class="subject"><a href="#post-120735">Richedit &amp; Graphics</a></div>
    <div class="body">hi QvasiModo,<br /><br />   First of all, you dont know just how grateful i am that you took the time to actually try and convert the code, now that i have something to work with i might get somewhere, i will look over your code and see what i can learn from it, then hopefully i can help to try and find the fault.<br /><br />   My problem is i am too &quot;old school&quot; when people start talking MFC ...OOP ...COM ... i get totally lost, i really need to get my head down and learn something about this stuff, but as ever the problem is where to start.<br /><br />   Thank you VERY VERY much...<br /><br />Lennon.</div>
    <div class="meta">Posted on 2003-10-07 21:30:34 by Lennon</div>
   </div>
   <div class="post" id="post-120737">
    <div class="subject"><a href="#post-120737">Richedit &amp; Graphics</a></div>
    <div class="body"><pre><code><br />sc = &#58;&#58;OleCreateFromFile&#40;clsid, T2COLE&#40;lpszFileName&#41;,<br />IID_IUnknown, OLERENDER_DRAW, lpFormatEtc, m_lpClientSite, m_lpStorage,<br />&#40;void**&#41;&amp;m_lpObject&#41;;<br /></code></pre><br /><br />you put:<br /><pre><code><br />invoke OleCreateFromFile, offset IID_NULL, pFile, offset IID_IUnknown, OLERENDER_DRAW, addr formatEtc, addr pClientSite, addr pStorage, addr pObject<br /></code></pre><br /><br />I think, it is:<br /><pre><code><br />invoke OleCreateFromFile, offset IID_NULL, pFile, offset IID_IUnknown, OLERENDER_DRAW, addr formatEtc, pClientSite, pStorage, addr pObject<br /></code></pre><br /><br />But still it does not work :)</div>
    <div class="meta">Posted on 2003-10-07 21:38:12 by Jnrz</div>
   </div>
   <div class="post" id="post-120844">
    <div class="subject"><a href="#post-120844">Richedit &amp; Graphics</a></div>
    <div class="body">hi,<br /><br />   I've been checking over your code and so far i cant see anything wrong, altho i dont know why you call CreateTextServices after ExitProcess<br /><br />;invoke ExitProcess,eax<br />;invoke CreateTextServices,eax,eax,eax<br /><br />   The problem seems to be with OleCreateFromFile, so why not try and create the object from a resource instead?<br /><br />i think there is source to do it here <br /><a target="_blank" href="http://www.codeguru.com/richedit/richeditrc.html">http://www.codeguru.com/richedit/richeditrc.html</a> <br /><br />I will keep checking for any possible errors in your source, altho i dont really know what the hell i am doing :rolleyes: <br /><br />Thank you ,<br />Lennon.</div>
    <div class="meta">Posted on 2003-10-09 03:48:55 by Lennon</div>
   </div>
   <div class="post" id="post-120887">
    <div class="subject"><a href="#post-120887">Richedit &amp; Graphics</a></div>
    <div class="body">@Jnrz: You are right, that's what I meant to do... it's a silly typo :)<br /><br />@Lennon: Hey, no problem. I'm &quot;old school&quot; too, I've been programming in MASM for like a year now and I still have trouble to stop using 8 and 16 bits registers ;)<br /><br />The CreateTextServices is deliberately after ExitProcess so it doesn't get executed. I was too lazy to put the code to load the richedit library dynamically. :grin:<br /><br />I also was a little lost here... in my opinion some things are not necessary, like creating an object with an IUnknown interface and then getting the pointer to IRichEditOle... wouldn't it have been easier to get IRichEditOle in the first place? :confused: <br /><br />Anyway, since it doesn't work we don't loose anything by experimenting a bit, so let's try making our own changes to the code and see what happens...<br /><br />I'm also taking a look at the last link you posted. I'll be busy till next week, but I'll try to convert it to MASM to compare the differences with the code we have, that might reveal what's wrong with it.</div>
    <div class="meta">Posted on 2003-10-09 14:53:34 by QvasiModo</div>
   </div>
   <div class="post" id="post-120919">
    <div class="subject"><a href="#post-120919">Richedit &amp; Graphics</a></div>
    <div class="body">Hey Boyz<br /><br />Here some Basic sourcecode which does just that... I don't have time lately or else I'd have a look.</div>
    <div class="meta">Posted on 2003-10-09 22:05:18 by JimmyClif</div>
   </div>
   <div class="post" id="post-120930">
    <div class="subject"><a href="#post-120930">Richedit &amp; Graphics</a></div>
    <div class="body">here it is :)</div>
    <div class="meta">Posted on 2003-10-10 00:22:53 by Jnrz</div>
   </div>
   <div class="post" id="post-120984">
    <div class="subject"><a href="#post-120984">Richedit &amp; Graphics</a></div>
    <div class="body">oh wow....you've only gone and done it!,<br /><br />:grin:<br /><br />I owe you all a few pints down the local pub.<br /><br />I will have a go at putting the code into my chat source and see what i can come up with, i'll report back.<br /><br />Thanks again everyone.<br /><br />Lennon.</div>
    <div class="meta">Posted on 2003-10-10 06:08:46 by Lennon</div>
   </div>
   <div class="post" id="post-121012">
    <div class="subject"><a href="#post-121012">Richedit &amp; Graphics</a></div>
    <div class="body">Found 2 problems :confused: <br /><br />First, there seems to be a memory leak, every time a picture is inserted memory is lost, and this just keeps getting bigger and bigger...even if backspace is pressed and the object deleted, the memory is not made free.<br /><br />Second, every time a picture is inserted, MSPAINT loads up! (if you watch in Task Manager) and then closes again... this cant be good!<br /><br />I will have to try and work out what is going on...<br /><br />Lennon.<br /><br />*edit* probably really obviously, its the call to OleCreateFromFile that is taking the memory and loading MSPAINT....</div>
    <div class="meta">Posted on 2003-10-10 13:42:03 by Lennon</div>
   </div>
   <div class="post" id="post-121047">
    <div class="subject"><a href="#post-121047">Richedit &amp; Graphics</a></div>
    <div class="body">Oh dear, it seems that it isnt a memory leak, and nothing wrong with your code...<br /><br />Its just the way it works :eek:<br /><br />The same memory usage happens with the C++ examples you converted, also if you open Wordpad and paste bmp's into it, same problem again.<br /><br />Now i need to find a less memory hungry way of doing things :mad: <br /><br />and just when i thought the problem was over...</div>
    <div class="meta">Posted on 2003-10-10 22:39:26 by Lennon</div>
   </div>
   <div class="post" id="post-121065">
    <div class="subject"><a href="#post-121065">Richedit &amp; Graphics</a></div>
    <div class="body">I see said the blind man, thought i had found the answer, but it doesnt look like i have now...<br /><br />I thought that instead of creating a new object every time i wanted to insert an Emoticon, i would just create the object (so if i had 10 different Emoticons, i would create a new object for each of them) at the init stage of the chat client, and then whenever i need to insert an Emoticon into the richedit control i could just call -:<br /><br />;insert the object into richedit at the current selection point<br />	mov	eax,pRichEditOle<br />	mov	edx,OFFSET reo ;with a reo structure setup for each Emoticon<br />	push	edx<br />	push	eax<br />	mov	eax,<br />	call	.IRichEditOle.InsertObject<br /><br />...but...it just doesnt do anything after the first call to InsertObject, it seems it can only be used once.<br /><br />can anybody tell me why it was a really bad idea?</div>
    <div class="meta">Posted on 2003-10-11 07:08:58 by Lennon</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=15412&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=15412&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="15412" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=15412&amp;page=2">&gt;</a><a href="../?id=15412&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>