<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>is the TIMERS.ASM right? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25145" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25145">is the TIMERS.ASM right?</a></p>
   <div class="post" id="post-184138">
    <div class="subject"><a href="#post-184138">is the TIMERS.ASM right?</a></div>
    <div class="body"><pre><code>.686<br />.model flat,stdcall<br />option casemap:none<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\masm32.inc<br /><br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\masm32.lib<br />	<br />include \masm32\macros\macros.asm<br />include TIMERS.ASM<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />LOOP_COUNT EQU 1000000000<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.code<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />test1 proc <br />	<br />	print &quot;lea esp,&nbsp; : &quot;<br />	counter_begin LOOP_COUNT,HIGH_PRIORITY_CLASS<br />	lea esp,<br />	counter_end<br />	print ustr$(eax),&quot; cycles&quot;,13,10<br />	<br />	ret<br />test1 endp<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />test2 proc <br />	print &quot;7 * nop : &quot;<br />	counter_begin LOOP_COUNT,HIGH_PRIORITY_CLASS<br />	nop<br />	nop<br />	nop<br />	nop<br />	nop<br />	nop<br />	nop<br />	counter_end<br />	print ustr$(eax),&quot; cycles&quot;,13,10<br />	<br />	ret<br />test2 endp<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />start:<br />	mov eax,LOOP_COUNT<br />	print ustr$(eax),&quot; counts&quot;,13,10<br />	invoke test1<br />	invoke test2<br />	<br />	mov eax, input(13,10,13,10,&quot;Press ENTER key to exit...&quot;)<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke ExitProcess,NULL<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br /><br />end start</code></pre><br />f0dder said:<br />&quot;Interesting that they chose an instruction like &quot;mov edi, edi&quot; instead of just<br />two NOPs. Then again, you need a two-byte instruction to make sure no thread is <br />about to execute NOP#2 when the jump-destination is written.&quot;<br /><br />arafel asked<br />&quot;What is the reason behind MASM choosing stuff like &quot;lea?? ebx,&quot; for padding.<br />Wouldn&#39;t be better (for execution speed when aligning code) to do equivalent number<br />of nops instead?&quot;<br /><br />i tested:<br />;-----------------------------------------------------<br />1000000000 counts<br />lea esp,&nbsp; : 1 cycles<br />7 * nop : 1 cycles<br /><br />Press ENTER key to exit...<br />;-----------------------------------------------------<br />however you changed the LOOP_COUNT, the result is same<br />I think the Timers.asm has some problem.<br /><br />Hope you explain some detail.</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=1940" target="_blank">TIMERS.ASM</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2006-07-31 01:35:18 by dcskm4200</div>
   </div>
  </div>
 </body>
</html>