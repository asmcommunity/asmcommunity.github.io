<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Help plz - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=5411" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=5411">Help plz</a></p>
   <div class="post" id="post-38465">
    <div class="subject"><a href="#post-38465">Help plz</a></div>
    <div class="body">hi all<br />what i am trying to do is asking the user for  to input username and pass which declared as constant. With if/else procedure compare if the text is same if not, then another loop<br />so far i did get the user to input the username and pass and compared but i cant not see if the password is right.<br />------------------------------------------------<br /><pre><code>.486<br />.model flat, stdcall<br />option casemap &#58;none<br /><br />Main        proto   &#58;DWORD<br /><br />include     \masm32\include\windows.inc<br />include     \masm32\include\kernel32.inc<br />include     \masm32\include\masm32.inc<br /><br />includelib  \masm32\lib\kernel32.lib<br />includelib  \masm32\lib\masm32.lib<br /><br />.data<br />Login       db  &quot;welCome to Zion Network&quot;,13,10,0<br />UName       db  &quot;UserName&#58; &quot;,13,10,0<br />UPass       db  &quot;UserPass&#58; &quot;,13,10,0<br />Again       db  &quot;try again!&quot;,13,10,0<br />UNa             db &quot;k0d&quot;<br />UPa             db &quot;love&quot;<br /><br />.data?<br />hInstance       DWORD           ?<br /><br />.code<br />start&#58;<br />    invoke GetModuleHandle, NULL<br />    mov hInstance, eax<br />    invoke Main, hInstance<br />    invoke ExitProcess, eax<br /><br /><br />Main proc   hInst&#58;DWORD<br />    LOCAL kb&#58; WORD<br />    @@&#58;<br />    invoke ClearScreen<br />    invoke StdOut, ADDR Login<br />    invoke StdOut, ADDR UName<br />    invoke StdIn, ADDR kb, 128<br />    lea eax, kb<br />    invoke StdOut, ADDR UPass<br />    invoke StdIn, ADDR kb, 128<br />    lea ecx, kb<br />    cmp word ptr &#91;eax&#93;, 'UNa'<br />    cmp word ptr &#91;ecx&#93;, 'UPa'<br />    jmp @f<br />    invoke StdOut, ADDR Again<br />    jz @b<br /><br />    @@&#58;<br />    xor eax, eax<br />    ret<br />Main endp<br /><br />end start<br />-------------------------------------------<br /></code></pre><br /><br />thx<br /><br /><span style="font-size:9px>EDIT: <pre><code></span></div>
    <div class="meta">Posted on 2002-05-15 20:35:03 by k0d</div>
   </div>
   <div class="post" id="post-38471">
    <div class="subject"><a href="#post-38471">Help plz</a></div>
    <div class="body">um...  i'm not sure if this reply is allowed, but just to let you know...  it wouldn't be very difficult to recover the password from this program.<br /><br />but anyway, i think your problem lies here:<br /><br />cmp word ptr , 'UNa' <br />cmp word ptr , 'UPa' <br />jmp @f <br /><br />shouldn't you be doing two conditional jumps?  like this (where jc is a conditional jump):<br /><br />cmp word ptr , 'UNa'<br />jc @UNaFails <br />cmp word ptr , 'UPa' <br />jc @UPaFails</div>
    <div class="meta">Posted on 2002-05-15 21:03:27 by jademtech</div>
   </div>
   <div class="post" id="post-38477">
    <div class="subject"><a href="#post-38477">Help plz</a></div>
    <div class="body"><pre><code> <br />UNa             db &quot;k0d&quot;,0<br />UPa             db &quot;love&quot;,0<br /><br />BUFFER_SIZE equ 512<br /><br />buffer struct<br />data db BUFFER_SIZE dup &#40;&#41;<br />buffer ends<br /><br />Main proc hInst&#58;DWORD <br />local nick&#58;buffer<br />local pass&#58;buffer<br />@@&#58;<br />invoke ClearScreen<br />invoke StdOut, ADDR Login<br />invoke StdIn, ADDR nick, BUFFER_SIZE-4<br />invoke StdOut, ADDR UPass<br />invoke StdIn, ADDR pass, BUFFER_SIZE-4<br />invoke StrCmp, addr nick, addr UNa<br />jne @B<br />invoke StrCmp, addr pass, addr UPa<br />jne @B<br />xor eax, eax<br />ret<br /><br /></code></pre></div>
    <div class="meta">Posted on 2002-05-15 21:37:47 by bdjames</div>
   </div>
   <div class="post" id="post-38479">
    <div class="subject"><a href="#post-38479">Help plz</a></div>
    <div class="body">I wouldnt think there is anything wrong with this.  ;)<br /><br />As pointed out, you cant compare two things and expect the Processor to remember the first ;)<br /><br />As well, you *might* get away with the comparisons, since they are both 4 bytes or less, but this is not a good way of comparing strings in general.<br /><br />Its becoming quite clear to me you dont understand stings, so i will give you the run down ;).  But you do have the *idea's* in place so dont feel too bad.<br /><br /><ul><br />[*]You tried to make an input buffer, and as i gather it, you wanted it to be 128 bytes in length.  A good start, how your declairing the buffer is wrong.  Seing <strong>LOCAL kb: WORD</strong> will only declair 2 bytes (since a word is 2 bytes long).  Your on the right track, but you need to make a byte array on the local stack: <strong>LOCAL kb[128] :BYTE</strong> will do this.<br />[*]Your actual username and password should have a NULL character as the rest of your stings do.  This is so the comparison routines will know where to end.<br />[*]You understanding of the <strong>cmp</strong> in general needs work ;) .  *i* know what your trying to do by reading this, but the assembler doesnt.  To the assembler, the string <strong>&quot;cmp word ptr , 'UNa'</strong> says: compare the TWO bytes found at the address of EAX, to the THREE ascii bytes 'UNa' (respectively).  Well, somehow anyways.  Im surprised the assembler actually assembled this with out error.  Since your trying to compare two different sizes!.  I will show you how to compare strings further on.<br />[*]Another problem is that your should realize that EAX, ECX, and EDX are NOT transparent thru API calls and in general should NOT assume the same for LIB functions you didnt write ;) .  The line <strong>lea eax, kb</strong> followed by <strong>invoke StdOut, ADDR UPass</strong> will certainly change the value of EAX as soon as the StdOut function is called!! You can not assume that it will preserved!  As well, you can not assume by simply doing the 'LEA' you preserve the infor currently in the buffer, so you can reuse it later.  You need make two separate buffers to hold two types of information!<br />[*]A little for decptive, but the when using the MASM32.LIB routine &quot;StdIn&quot;, the text copied into the buffer will have the &quot;13,10&quot; line feed in it.  You should call <strong>StripLF</strong> also found in the MASM32.LIB.  It will replace this with a NULL char which will better suit the string comparison routine.<br /><br /><br />Here is a reworking of your source with new areas in bold:<br /><pre><code>.486 <br />.model flat, stdcall <br />option casemap &#58;none <br /><br />Main proto &#58;DWORD <br /><br />include \masm32\include\windows.inc <br />include \masm32\include\kernel32.inc <br />include \masm32\include\masm32.inc <br /><br />includelib \masm32\lib\kernel32.lib <br />includelib \masm32\lib\masm32.lib <br /><br />.data <br />Login db &quot;welCome to Zion Network&quot;,13,10,0 <br />UName db &quot;UserName&#58; &quot;,13,10,0 <br />UPass db &quot;UserPass&#58; &quot;,13,10,0 <br />Again db &quot;try again!&quot;,13,10,0 <br />UNa db &quot;k0d&quot;&#91;b&#93;,0&#91;/b&#93;<br />UPa db &quot;love&quot;&#91;b&#93;,0&#91;/b&#93;<br /><br />.data? <br />hInstance DWORD ? <br /><br />.code <br />start&#58; <br />&#91;b&#93;push esi<br />push edi&#91;/b&#93;<br />invoke GetModuleHandle, NULL <br />mov hInstance, eax <br />invoke Main, hInstance <br />&#91;b&#93;pop edi<br />pop esi&#91;/b&#93;<br />invoke ExitProcess, eax <br /><br /><br />Main proc hInst&#58;DWORD <br />LOCAL kb&#91;b&#93;&#91;128&#93; &#58;BYTE<br />LOCAL kb2&#91;128&#93; &#58;BYTE&#91;/b&#93;<br /><br />@@&#58; <br />invoke ClearScreen <br />invoke StdOut, ADDR Login <br />invoke StdOut, ADDR UName <br />invoke StdIn, ADDR kb, 128 <br />&#91;b&#93;invoke StripLF, addr kb&#91;/b&#93;<br /><br />&#91;b&#93;; remove this&#58; lea eax, kb &#91;/b&#93;<br />invoke StdOut, ADDR UPass <br />invoke StdIn, &#91;b&#93;ADDR kb2, 128&#91;/b&#93; <br />&#91;b&#93;; remove this&#58; lea ecx, kb <br />invoke StripLF, addr kb2&#91;/b&#93;<br /><br />&#91;b&#93;; remove this &#58; cmp word ptr &#91;eax&#93;, 'UNa' <br />; This will compare the username<br />invoke StrLen, addr kb        ; Get the number of bytes entered<br />mov ecx, eax                  ; Save the count in ECX<br />mov esi, offset kb            ; Set the SOURCE INDEX to the buffer kb<br />mov edi, offset UNa           ; Set the DEST INDEX to the UserName seeked<br />cld                           ; Indicate to count up the byte string<br />repz cmpsb                    ; repeate comparing the byte at ESI to EDI.<br />                              ;  If they are the same, ESI = ESI + 1,<br />                              ;   EDI = EDI +1, and ECX = ECX - 1.<br />                              ; When finished, ask, is ECX == 0 ?  No? Then<br />                              ; somewhere the bytes were not the same, since<br />                              ; not ALL the bytes were checked!<br />cmp ecx, 0<br />jne @Error<br /><br />invoke StrLen, addr kb2       ; Get the number of bytes entered<br />mov ecx, eax                  ; Save the count in ECX<br />mov esi, offset kb2           ; Set the SOURCE INDEX to the buffer kb2<br />mov edi, offset UPa           ; Set the DEST INDEX to the UserPass seeked<br />cld                           ; Indicate to count up the byte string<br />repz cmpsb                    ; repeate comparing the byte at ESI to EDI.<br />                              ;  If they are the same, ESI = ESI + 1,<br />                              ;   EDI = EDI +1, and ECX = ECX - 1.<br />                              ; When finished, ask, is ECX == 0 ?  No? Then<br />                              ; somewhere the bytes were not the same, since<br />                              ; not ALL the bytes were checked!<br /><br />cmp ecx, 0<br />jne @Error<br />jmp @F<br /><br />@Error&#58;&#91;/b&#93;<br />invoke StdOut, ADDR Again <br />&#91;b&#93;jmp&#91;/b&#93; @b <br /><br />@@&#58; <br />xor eax, eax <br />ret <br />Main endp <br /><br />end start <br /></code></pre><br /><br />Anyways, there you go.<br />Hope you can learn from it ;)<br />:NaN:</div>
    <div class="meta">Posted on 2002-05-15 21:44:36 by NaN</div>
   </div>
   <div class="post" id="post-38497">
    <div class="subject"><a href="#post-38497">error</a></div>
    <div class="body">Nan there is error <br />(58) : error A2098: invalid operand for OFFSET<br />(72) : error A2098: invalid operand for OFFSET<br />sorry but i am not really familiar with offset yet<br /><br />- gaining password from this program i was planning write simple encryption thats in another file that everytime user enter there name and password algorith i guess encrypt and compare it however i couldn't get to that part<br />but next thing i want to try is to display * instead of characters<br /><br />i am not zen of assembly so till then try my best  <br />thx everyone</div>
    <div class="meta">Posted on 2002-05-15 23:13:35 by k0d</div>
   </div>
   <div class="post" id="post-38504">
    <div class="subject"><a href="#post-38504">Help plz</a></div>
    <div class="body">Didn't check to see where lines 58 and 72 were, but I can guess they were at the LOCAL variables<br /><br />Now if I remeber correctly off hand... You can't use OFFSET for local variables, because they're based off the stack...<br /><br />remove the offset and use &quot;lea&quot; instead...<br /><br />Hope it helps,<br />Sliver<br /><br />ps. I think I'm right, but if not I'll give a closer look if Nan doesn't fix it first</div>
    <div class="meta">Posted on 2002-05-16 01:12:14 by Sliver</div>
   </div>
   <div class="post" id="post-38505">
    <div class="subject"><a href="#post-38505">Help plz</a></div>
    <div class="body">Quick question:<br /><br />How does one do this:<br /><br /><br />Enter User Name: Sliver<br />Enter Password: ********<br /><br />Basically is there a way to &quot;intercept&quot; the characters being typed to the screen and replace them with &quot;*&quot; so as to hide the characters?<br /><br />Sliver</div>
    <div class="meta">Posted on 2002-05-16 01:14:36 by Sliver</div>
   </div>
   <div class="post" id="post-38521">
    <div class="subject"><a href="#post-38521">Help plz</a></div>
    <div class="body">Ooooops my bad ;)<br /><br />Cant use offset cause it is only works for STATIC values. Ie) Addresses that can be determined at COMPILE-TIME.  Since the very nature of a stack (and local varialbes) are dynamic, this is why it failed.<br /><br />The fix is replace:<br /><br /><strong>mov esi, offset kb <br />mov edi, offset UNa</strong><br /><br />with:<br /><br /><strong>lea esi, kb<br />lea edi, UNa</strong><br /><br />In both sections.... sorry for this (guess its obvious now i didnt test it first ;) )<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-05-16 04:33:46 by NaN</div>
   </div>
   <div class="post" id="post-38676">
    <div class="subject"><a href="#post-38676">Help plz</a></div>
    <div class="body">thx NaN, everyone</div>
    <div class="meta">Posted on 2002-05-17 04:51:16 by k0d</div>
   </div>
   <div class="post" id="post-38681">
    <div class="subject"><a href="#post-38681">Help plz</a></div>
    <div class="body">i can't understand why NaN did<br /><pre><code>.code<br />start&#58;<br />&#91;B&#93;push esi<br />push edi&#91;/B&#93;<br />invoke GetModuleHandle, NULL<br />mov hInstance, eax<br />invoke Main, hInstance<br />&#91;B&#93;pop edi<br />pop esi&#91;/B&#93;<br />invoke ExitProcess, eax</code></pre><br />is the push, pop needed?!?! why ?!?!</div>
    <div class="meta">Posted on 2002-05-17 05:39:18 by NEMO</div>
   </div>
   <div class="post" id="post-38682">
    <div class="subject"><a href="#post-38682">Help plz</a></div>
    <div class="body">Can't see why it would be... APIs preserve registers. Ok, main can<br />trash registers if it wants to. Also, register preservation is only<br />necessary in callbacks, and &quot;entrypoint&quot; isn't really a callback. No,<br />ExitProcess will *not* fail on trashed registers ;).</div>
    <div class="meta">Posted on 2002-05-17 05:56:13 by f0dder</div>
   </div>
  </div>
 </body>
</html>