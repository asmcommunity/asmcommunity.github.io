<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>String output truncated - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29361" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29361">String output truncated</a></p>
   <div class="post" id="post-207319">
    <div class="subject"><a href="#post-207319">String output truncated</a></div>
    <div class="body">this is part of my code that works fine.<br /><br /> org 0x8000&nbsp; &nbsp;  ; code&#039;s start offset<br /> &nbsp; &nbsp;  ; 16 Bit Code <br /> ..<br /> ..<br /> ..<br /> ..<br /> mov si, msg_help<br /> call _out_print_si&nbsp; <br />&nbsp; &nbsp; <br /> mov si, msg_xdump_start<br /> call _out_print_si&nbsp; <br /> ..<br /> ..<br /> ..<br /> _out_print_si:<br />&nbsp; lodsb&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; <br />&nbsp; or al, al&nbsp; <br />&nbsp; jz .done&nbsp;  <br /><br />&nbsp; mov ah, 0x0E&nbsp; <br />&nbsp; mov bh, 0x00&nbsp; <br />&nbsp; mov bl, 0x00&nbsp; <br />&nbsp; int 0x10&nbsp; &nbsp; &nbsp; <br /><br />&nbsp; jmp _out_print_si<br />&nbsp; <br />.done:<br />&nbsp; ret<br />&nbsp; ..<br />&nbsp; ..<br />&nbsp; ..<br />&nbsp; ..<br />&nbsp; welcome&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; db &#039;Welcome to OSX - Operation System !&#039;, 0x0D, 0x0A, 0<br />&nbsp; copyright&nbsp; &nbsp; &nbsp; &nbsp; db &#039;Patrick Carvalho - Copyright 2009&#039;, 0x0D, 0x0A, 0<br />&nbsp; msg_helloworld&nbsp;  db &#039;OSX - Operation System!&#039;, 0x0D, 0x0A, 0<br />&nbsp; badcommand&nbsp; &nbsp; &nbsp;  db &#039;Command Unknown.&#039;, 0x0D, 0x0A, 0<br />&nbsp; prompt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  db &#039;&gt;&#039;, 0<br />&nbsp; cmd_hi&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  db &#039;hi&#039;, 0<br />&nbsp; cmd_help&nbsp; &nbsp; &nbsp; &nbsp;  db &#039;help&#039;, 0<br />&nbsp; cmd_shutdown	&nbsp;  db &#039;shutdown&#039;, 0<br />&nbsp; cmd_clear		&nbsp;  db &#039;clear&#039;, 0<br />&nbsp; cmd_load_a	&nbsp;  db &#039;load a&#039;, 0<br />&nbsp; msg_xdump_start&nbsp; db &#039;xDump Registers&#039;, 0x0D, 0x0A, 0<br />&nbsp; msg_help&nbsp; &nbsp; &nbsp; &nbsp;  db &#039;My OS: Commands: hi, help&#039;, 0x0D, 0x0A, 0&nbsp; &nbsp; &nbsp; <br />&nbsp; buffer times 32&nbsp; db 0 <br /><br /><br /><br />For this code above the output is:<br />&quot;My OS: Commands: hi, help<br />xDump Registers&quot;<br /><br />Everything OK !!<br /><br />but if i add this:<br /> msg_xdump_reg1&nbsp;  db &#039;AX = 0000 BX = 0000 CX = 0000&#039;, 0x0D, 0x0A, 0<br /><br />this way:<br />&nbsp; ...<br />&nbsp; msg_xdump_start&nbsp; db &#039;xDump Registers&#039;, 0x0D, 0x0A, 0<br />&nbsp; msg_xdump_reg1&nbsp;  db &#039;AX = 0000 BX = 0000 CX = 0000&#039;, 0x0D, 0x0A, 0<br />&nbsp; msg_help&nbsp; &nbsp; &nbsp; &nbsp;  db &#039;My OS: Commands: hi, help&#039;, 0x0D, 0x0A, 0&nbsp;  <br />&nbsp; ...<br /><br />so.. the output is:<br /> &quot;My OS: CommxDump Registers&quot;<br /><br />Why??<br /> </div>
    <div class="meta">Posted on 2009-04-14 15:51:25 by patrickniceboy</div>
   </div>
   <div class="post" id="post-207325">
    <div class="subject"><a href="#post-207325">Re: String output truncated</a></div>
    <div class="body">Is there any limit for variable declaration ??<br /><br />becuase to me it looks like i can use just for example 8 bytes...or something like this, so i can just use 8 vars.<br />just an example.</div>
    <div class="meta">Posted on 2009-04-15 23:41:25 by patrickniceboy</div>
   </div>
   <div class="post" id="post-207326">
    <div class="subject"><a href="#post-207326">Re: String output truncated</a></div>
    <div class="body">What OS and libraries are you using exactly?<br />It appears you are using 16-bit, but the functions like _out_print_si aren&#039;t familiar to me. It&#039;s not DOS at any rate.</div>
    <div class="meta">Posted on 2009-04-16 06:13:24 by Scali</div>
   </div>
   <div class="post" id="post-207329">
    <div class="subject"><a href="#post-207329">Re: String output truncated</a></div>
    <div class="body">1) You didn&#039;t post the complete source (at least the essential part). This aggravates analyzing.<br />2) You are using a &quot;non-standard&quot;-assembler (according to the hex digits: &quot;0x??&quot; instead of &quot;??h&quot;)<br /><br />For me there are two causes of failures:<br />1) The assembler has a bug.<br />2) Segment registers are messed up.<br /><br />Recommendation: Try to create a binary with a different offset which can be run by an independent debugger, then debug your binary step-by-step with this debugger.</div>
    <div class="meta">Posted on 2009-04-16 14:52:57 by TasmDev</div>
   </div>
   <div class="post" id="post-207330">
    <div class="subject"><a href="#post-207330">Re: String output truncated</a></div>
    <div class="body"><div class="quote"><br />1) You didn&#039;t post the complete source (at least the essential part). This aggravates analyzing.<br />2) You are using a &quot;non-standard&quot;-assembler (according to the hex digits: &quot;0x??&quot; instead of &quot;??h&quot;)<br /><br />For me there are two causes of failures:<br />1) The assembler has a bug.<br />2) Segment registers are messed up.<br /><br />Recommendation: Try to create a binary with a different offset which can be run by an independent debugger, then debug your binary step-by-step with this debugger.<br /></div><br /><br />I thought NASM allowed us to use 0x... That&#039;s what I was doing with NASM before. I don&#039;t know if it has changed now.<br /><br />From this bit of code:<br /><br />org 0x8000&nbsp; &nbsp;  ; code&#039;s start offset<br /> &nbsp; &nbsp;  ; 16 Bit Code <br /><br />I am actually pretty sure it is NASM.</div>
    <div class="meta">Posted on 2009-04-17 06:30:34 by XCHG</div>
   </div>
   <div class="post" id="post-207331">
    <div class="subject"><a href="#post-207331">Re: String output truncated</a></div>
    <div class="body">maybe part of msg_help gets pushed off to the next sector because you&#039;re adding msg_xdump_start before it and you aren&#039;t loading that sector when you load the file into memory?</div>
    <div class="meta">Posted on 2009-04-17 07:48:39 by lone_samurai5</div>
   </div>
   <div class="post" id="post-207333">
    <div class="subject"><a href="#post-207333">Re: String output truncated</a></div>
    <div class="body">how can i read a sector?</div>
    <div class="meta">Posted on 2009-04-17 14:15:37 by patrickniceboy</div>
   </div>
   <div class="post" id="post-207334">
    <div class="subject"><a href="#post-207334">Re: String output truncated</a></div>
    <div class="body"><div class="quote"><br />What OS and libraries are you using exactly?<br />It appears you are using 16-bit, but the functions like _out_print_si aren&#039;t familiar to me. It&#039;s not DOS at any rate.<br /></div><br /><br />It&#039;s my own function to print a string, from SI register, it uses int 10 to print !<br /><br />look:<br /><br /><br />_out_print_si:<br />&nbsp; lodsb&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; <br />&nbsp; or al, al&nbsp; <br />&nbsp; jz .done&nbsp;  <br /><br />&nbsp; mov ah, 0x0E&nbsp; <br />&nbsp; mov bh, 0x00&nbsp; <br />&nbsp; mov bl, 0x00&nbsp; <br />&nbsp; int 0x10&nbsp;  <br /> </div>
    <div class="meta">Posted on 2009-04-17 14:25:36 by patrickniceboy</div>
   </div>
   <div class="post" id="post-207335">
    <div class="subject"><a href="#post-207335">Re: String output truncated</a></div>
    <div class="body">post the complete code.. will be easier to look for the problem..</div>
    <div class="meta">Posted on 2009-04-17 14:43:10 by lone_samurai5</div>
   </div>
   <div class="post" id="post-207336">
    <div class="subject"><a href="#post-207336">Re: String output truncated</a></div>
    <div class="body">here is boot.asm:<br /><br />&nbsp; org 0x7C00&nbsp; ; set up start address of bootloader<br /><br />; setup a stack and segment regs ;<br /><br />&nbsp; &nbsp; xor ax, ax<br />&nbsp; &nbsp; mov ds, ax<br />&nbsp; &nbsp; mov es, ax<br />&nbsp; &nbsp; mov ss, ax<br />&nbsp; &nbsp; mov sp, ax<br />	<br />	<br />	mov bx, 0x8000&nbsp; &nbsp;  ; set up start address of kernel, the address to save return?<br />	call _sysio_read_floppy<br />	<br />	; Kernel<br />&nbsp; &nbsp; jmp 0x0000: 0x8000&nbsp;  ; address of kernel. &quot;jmp bx&quot; might also work.	<br /><br />; data&nbsp; &nbsp;  <br />&nbsp; &nbsp; times 480-($-$$) db 0 ;hlt<br />&nbsp; &nbsp; SIGNATURE DW 0xAA55	<br /><br /><br /><br /><br />now kernel.asm:<br /><br /><br /><br /> org 0x8000&nbsp; &nbsp;  ; code&#039;s start offset<br /> &nbsp; &nbsp;  ; 16 Bit Code<br /><br />SECTION .text		; code section<br /> <br />&nbsp; xor ax, ax&nbsp; &nbsp; &nbsp; &nbsp;  ; set up segments<br />&nbsp; mov es, ax<br />&nbsp; mov ds, ax<br />&nbsp; mov ss, ax<br />&nbsp; mov sp, ax<br /><br />&nbsp; mov si, welcome<br />&nbsp; call _out_print_si<br />&nbsp; <br />&nbsp; mov si, copyright<br />&nbsp; call _out_print_si<br /><br />loop:<br />&nbsp; ; constant initial words for console<br />&nbsp; mov si, prompt<br />&nbsp; call _out_print_si<br /> <br />&nbsp; mov di, buffer<br />&nbsp; call get_string<br /><br />&nbsp; mov si, buffer<br />&nbsp; cmp byte , 0&nbsp; ; blank line?<br />&nbsp; je loop&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; yes, ignore it<br /><br />&nbsp; mov si, buffer<br />&nbsp; mov di, cmd_hi&nbsp; ; &quot;hi&quot; command<br />&nbsp; call strcmp<br />&nbsp; jz .helloworld ;jc<br /><br />&nbsp; mov si, buffer<br />&nbsp; mov di, cmd_help&nbsp; ; &quot;help&quot; command<br />&nbsp; call strcmp<br />&nbsp; jz .help ; jc<br />&nbsp; <br />&nbsp; mov si, buffer<br />&nbsp; mov di, cmd_shutdown ;&nbsp; shutdown command<br />&nbsp; call strcmp<br />&nbsp; jz _reboot&nbsp; <br />&nbsp; <br />&nbsp; mov si, buffer<br />&nbsp; mov di, cmd_clear ;&nbsp; clear screen command<br />&nbsp; call strcmp<br />&nbsp; jz _clrscr<br /><br />&nbsp; mov si, buffer<br />&nbsp; mov di, cmd_load_a ;&nbsp; load floppy a<br />&nbsp; call strcmp<br />&nbsp; jz _load_a<br />&nbsp; &nbsp; <br />&nbsp; ; command not found<br />&nbsp; mov si,badcommand<br />&nbsp; call _out_print_si <br />&nbsp; <br />&nbsp; jmp loop&nbsp; <br /><br />.helloworld:<br />&nbsp; mov si, msg_helloworld<br />&nbsp; call _out_print_si<br />&nbsp; jmp loop<br /><br />.help:<br />&nbsp; mov si, msg_help<br />&nbsp; call _out_print_si<br />&nbsp; jmp loop<br />&nbsp; 	 <br /><br />;-----------------------------------------------------------------------------------------<br /><br />_reboot:<br />&nbsp; jmp 0xf000:0xfff0 ; Reboot is this right?<br />&nbsp;  <br />	<br />_clrscr: <br />&nbsp; mov ax, 0x0600 <br />&nbsp; xor cx, cx <br />&nbsp; mov dx, 0x174F <br />&nbsp; mov bh, 0x07 <br />&nbsp; int 0x10 <br />&nbsp; jmp loop<br /><br />; ================<br />; calls start here<br />; ================<br /><br />_out_print_si:<br />&nbsp; lodsb&nbsp; &nbsp; &nbsp; &nbsp; ; grab a byte from SI<br />&nbsp; <br />&nbsp; or al, al&nbsp; ; logical or AL by itself<br />&nbsp; jz .done&nbsp;  ; if the result is zero, get out<br /><br />&nbsp; ; VIDEO - TELETYPE OUTPUT,&nbsp; AL = character to write<br />&nbsp; mov ah, 0x0E&nbsp; ; parameter&nbsp; <br />&nbsp; mov bh, 0x00&nbsp; ; page number<br />&nbsp; mov bl, 0x00&nbsp; ; foreground color (graphics modes only)<br />&nbsp; int 0x10&nbsp; &nbsp; &nbsp; ; otherwise, print out the character!<br /><br />&nbsp; jmp _out_print_si<br />&nbsp; <br />.done:<br />&nbsp; ret<br /><br /><br />_out_print_ah:<br />		push&nbsp; &nbsp; ax&nbsp; &nbsp; &nbsp; ; store registers... <br />		push&nbsp; &nbsp; si&nbsp; &nbsp; &nbsp; ; <br /> <br /> .next_char:<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; jz&nbsp; &nbsp; &nbsp; printed<br />&nbsp; &nbsp; &nbsp; &nbsp; inc&nbsp; &nbsp;  si<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />		; VIDEO - TELETYPE OUTPUT,&nbsp; AL = character to write<br />		mov ah, 0eh ; teletype function. <br />		mov bh, 0x00&nbsp; ; page number<br />		mov bl, 0x00&nbsp; ; foreground color (graphics modes only)<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  10h<br />		<br />&nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  .next_char<br />printed:<br />		pop&nbsp; &nbsp;  si&nbsp; &nbsp; &nbsp; ; re-store registers... <br />		pop&nbsp; &nbsp;  ax&nbsp; &nbsp; &nbsp; ; <br />&nbsp; ret<br /><br />&nbsp; <br />&nbsp; <br /> <br /><br />get_string:<br />&nbsp; xor cl, cl ; the same character will not be printed again<br /><br />.loop:<br />&nbsp; mov ah, 0<br />&nbsp; int 0x16&nbsp;  ; wait for keypress, return = al<br /><br />&nbsp; cmp al, 0x08&nbsp; &nbsp; ; backspace pressed?<br />&nbsp; je .backspace&nbsp;  ; yes, handle it<br /><br />&nbsp; cmp al, 0x0D&nbsp; ; enter pressed?<br />&nbsp; je .done&nbsp; &nbsp; &nbsp; ; yes, we&#039;re done<br /><br />&nbsp; cmp cl, 0x3F&nbsp; ; 63 chars inputted?<br />&nbsp; je .loop&nbsp; &nbsp; &nbsp; ; yes, only let in backspace and enter<br /><br />&nbsp; mov ah, 0x0E<br />&nbsp; int 0x10&nbsp; &nbsp; &nbsp; ; print out character<br /><br />&nbsp; stosb&nbsp; ; put character in buffer<br />&nbsp; inc cl<br />&nbsp; jmp .loop<br /><br />.backspace:<br />&nbsp; cmp cl, 0	; beginning of string?<br />&nbsp; je .loop	; yes, ignore the key<br /><br />&nbsp; dec di<br />&nbsp; mov byte , 0	; delete character<br />&nbsp; dec cl		; decrement counter as well<br /><br />&nbsp; mov ah, 0x0E<br />&nbsp; mov al, 0x08<br />&nbsp; int 10h		; backspace on the screen<br /><br />&nbsp; mov al, &#039; &#039;<br />&nbsp; int 10h		; blank character out<br /><br />&nbsp; mov al, 0x08<br />&nbsp; int 10h		; backspace again<br /><br />&nbsp; jmp .loop	; go to the main loop<br /><br />.done:<br />&nbsp; mov al, 0	; null terminator<br />&nbsp; stosb<br /><br />&nbsp; mov ah, 0x0E<br />&nbsp; mov al, 0x0D<br />&nbsp; int 0x10<br />&nbsp; <br />&nbsp; mov al, 0x0A<br />&nbsp; int 0x10		; newline<br /><br />&nbsp; ret<br /><br /><br />_out_newline_feed:<br />&nbsp; <br />&nbsp;  ; cler carry<br />&nbsp; mov al, 0x0D<br />&nbsp; int 0x10<br />&nbsp; <br />&nbsp; ; newline<br />&nbsp; mov al, 0x0A<br />&nbsp; int 0x10		&nbsp; <br />&nbsp; <br />&nbsp; ret<br />&nbsp; <br />&nbsp; <br />&nbsp; <br />&nbsp; <br />strcmp:<br />.loop:<br />&nbsp; mov al, &nbsp;  ; grab a byte from SI<br />&nbsp; mov bl, &nbsp;  ; grab a byte from DI<br />&nbsp; cmp al, bl&nbsp; &nbsp;  ; are they equal?<br />&nbsp; jne .notequal&nbsp; ; nope, we&#039;re done.<br /><br />&nbsp; cmp al, 0&nbsp; ; are both bytes (they were equal before) null?<br />&nbsp; je .done&nbsp;  ; yes, we&#039;re done.<br /><br />&nbsp; inc di&nbsp; &nbsp;  ; increment DI<br />&nbsp; inc si&nbsp; &nbsp;  ; increment SI<br />&nbsp; jmp .loop&nbsp; ; loop!<br /><br />.notequal:<br />&nbsp; clc&nbsp; ; not equal, clear the carry flag<br />&nbsp; ret<br /><br />.done: 	<br />&nbsp; stc&nbsp; ; equal, set the carry flag<br />&nbsp; ret<br /><br />SECTION .data		; data section<br />&nbsp; <br />&nbsp; cmd_load_a	&nbsp;  db &#039;load a&#039;, 0<br />&nbsp; welcome&nbsp; &nbsp; &nbsp; &nbsp;  db &#039;Welcome to OSX - Operation System !&#039;, 0x0D, 0x0A, 0&nbsp; &nbsp;  <br />&nbsp; copyright&nbsp; &nbsp; &nbsp; &nbsp; db &#039;Patrick Carvalho - Copyright 2009&#039;, 0x0D, 0x0A, 0<br />&nbsp; msg_helloworld&nbsp;  db &#039;OSX - Operation System!&#039;, 0x0D, 0x0A, 0<br />&nbsp; badcommand&nbsp; &nbsp; &nbsp;  db &#039;Command Unknown.&#039;, 0x0D, 0x0A, 0<br />&nbsp; prompt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  db &#039;&gt;&#039;, 0<br />&nbsp; cmd_hi&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  db &#039;hi&#039;, 0<br />&nbsp; cmd_help&nbsp; &nbsp; &nbsp; &nbsp;  db &#039;help&#039;, 0<br />&nbsp; cmd_shutdown	&nbsp;  db &#039;shutdown&#039;, 0<br />&nbsp; cmd_clear		&nbsp;  db &#039;clear&#039;, 0<br />&nbsp; msg_help&nbsp; &nbsp; &nbsp; &nbsp;  db &#039;My OS: Commands: hi, help&#039;, 0x0D, 0x0A, 0&nbsp; &nbsp; &nbsp; <br />&nbsp; <br />&nbsp; buffer times 32&nbsp; db 0 <br />&nbsp; <br />&nbsp; &nbsp; <br />; Includes<br />%include &quot;sysio.asm&quot;<br /></div>
    <div class="meta">Posted on 2009-04-17 14:58:34 by patrickniceboy</div>
   </div>
   <div class="post" id="post-207337">
    <div class="subject"><a href="#post-207337">Re: String output truncated</a></div>
    <div class="body">Right off the bat, read-up on the <a target="_blank" href="http://wiki.osdev.org/Stack">Stack</a> and how to use it.</div>
    <div class="meta">Posted on 2009-04-17 15:18:59 by SpooK</div>
   </div>
   <div class="post" id="post-207338">
    <div class="subject"><a href="#post-207338">Re: String output truncated</a></div>
    <div class="body">so the problem is with the stack ?</div>
    <div class="meta">Posted on 2009-04-17 16:29:23 by patrickniceboy</div>
   </div>
   <div class="post" id="post-207342">
    <div class="subject"><a href="#post-207342">Re: String output truncated</a></div>
    <div class="body"><div class="quote"><br />so the problem is with the stack ?<br /></div><br /><br />In general. It probably isn&#039;t causing a problem as of yet. Setting SS/SP both to 0, IIRC, should cause a wrap-around to the top of the first 64KB on initial use. If this is intentional, then that is fine. However, if there are any mismatched PUSH/POP sequences, you could start overwriting the IVT. Also, PUSHing too much data will cause the same effect. Keep that in mind if things start to &quot;randomly&quot; fail.<br /><br />Another thing about traditional MBR&#039;s is that they are 512 bytes long, not 482 bytes long. You would want to use <strong>times 510-($-$$) db 0</strong>.<br /><br />The above statements were just some general comments. I will take a glance at your code and see if anything catches my eye.</div>
    <div class="meta">Posted on 2009-04-17 22:39:02 by SpooK</div>
   </div>
   <div class="post" id="post-207343">
    <div class="subject"><a href="#post-207343">Re: String output truncated</a></div>
    <div class="body">OK. One thing that immediately catches my attention, is that <strong>msg_help</strong> is at the end of kernel.asm. As lone_samurai5 mentioned, your symptom could be a result of a loading problem.<br /><br />Double check your loading process and make that the entire kernel.asm file is being loaded into RAM.</div>
    <div class="meta">Posted on 2009-04-17 22:53:24 by SpooK</div>
   </div>
   <div class="post" id="post-207345">
    <div class="subject"><a href="#post-207345">Re: String output truncated</a></div>
    <div class="body">Yes, i was loading just 1 sector, and my kernel has 2 !<br /><br />Problem Solved !!</div>
    <div class="meta">Posted on 2009-04-18 01:22:22 by patrickniceboy</div>
   </div>
  </div>
 </body>
</html>