<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Wierd stuff in TASM - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=2428" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=2428">Wierd stuff in TASM</a></p>
   <div class="post" id="post-15330">
    <div class="subject"><a href="#post-15330">Wierd stuff in TASM</a></div>
    <div class="body">Ok I don't know if I'm right or wrong but I found out some weird<br />&quot;bugs&quot;:<br /><br />1. SIZE - Doesn't give you the actual size, it returns 1<br />        - Im sorry for my ignorance if this one always returns 1<br />     <br />          ...<br />          SomeVariablesHere db &quot;Some Text Here&quot;, 0<br />          ...<br /><br />          EG: SIZE SomeVariablesHere ---&gt; returns 1<br /><br />          Expected Return Value: 14 (15 - plus the terminating<br />character)<br /><br />2. *    - By using this one you can multiply values<br />        - Again, Im sorry for my ignorance, if this one actually is <br />          allowed in TASM, because I was accustomed to using mul when<br />          multiplying values<br /><br />I was converting some win32 examples from masm(Tutorials from Iczelion) to tasm. The reason is that most of the tutorials<br />were incompatible with tasm (of course you can use the: masm - to use<br />masm commands). Anyway, I posted this similar code. The comments in<br />between codes will help clarify the things i've said.<br /><br />This is Tutorial 4: Painting with text<br /><br />You don't need a windows include here, i've translated those codes<br />such as WM_DESTROY to the appropriate hexadecimal values...<br /><br />;-----------------------------------------------------------------------------<br />; 004.asm<br />;-----------------------------------------------------------------------------<br />; This is a win32 paint example with colors<br />;<br />; tasm32.EXE /s /r /ml /m4 004.asm<br />; tlink32.EXE -x -Tpe -aa 004,,,import32.lib<br />;<br />;-----------------------------------------------------------------------------<br /><br />.386<br />.MODEL flat, stdcall<br /><br />WNDCLASSEX STRUC<br />    cbSize          DWORD ?<br />    Style           DWORD ?<br />    lpfnWndProc     DWORD ?<br />    cbClsExtra      DWORD ?<br />    cbWndExtra      DWORD ?<br />    hInstance       DWORD ?<br />    hIcon           DWORD ?<br />    hCursor         DWORD ?<br />    hbrBackground   DWORD ?<br />    lpszMenuName    DWORD ?<br />    lpszClassName   DWORD ?<br />    hIconSm         DWORD ?<br />WNDCLASSEX ENDS<br /><br />RECT STRUCT<br />  left              DD ?<br />  top               DD ?<br />  right             DD ?<br />  bottom            DD ?<br />RECT ENDS<br /><br />PAINTSTRUCT STRUC<br />  hdc               DWORD ?<br />  fErase            DWORD ?<br />  rcPaint           RECT &lt;&gt;<br />  fRestore          DWORD ?<br />  fIncUpdate        DWORD ?<br />  rgbReserved       BYTE 32 dup(?)<br />PAINTSTRUCT ENDS<br /><br />RGB MACRO red, green, blue<br />    xor eax,eax <br />    mov ah,blue <br />    shl eax,8 <br />    mov ah,green <br />    mov al,red <br />ENDM<br /><br />EXTRN GetModuleHandleA  : NEAR<br />EXTRN LoadIconA         : NEAR<br />EXTRN LoadCursorA       : NEAR<br />EXTRN CreateWindowExA   : NEAR<br />EXTRN RegisterClassExA  : NEAR<br />EXTRN GetMessageA       : NEAR<br />EXTRN DispatchMessageA  : NEAR<br />EXTRN PostQuitMessage   : NEAR<br />EXTRN DefWindowProcA    : NEAR<br />EXTRN ExitProcess       : NEAR<br /><br />EXTRN BeginPaint        : NEAR<br />EXTRN CreateFontA       : NEAR<br />EXTRN SelectObject      : NEAR<br />EXTRN SetTextColor      : NEAR<br />EXTRN SetBkColor        : NEAR<br />EXTRN TextOutA          : NEAR<br />EXTRN EndPaint          : NEAR<br /><br />.DATA<br /><br />    wcx WNDCLASSEX &lt;SIZE WNDCLASSEX, 1h or 2h, WndProc, 0, 0, 0, 0, 0,<br />5 + 1, 0, WndClassName, 0&gt;<br />    hWnd                DD 0<br />    MSG                 DD 0, 0, 0, 0, 0, 0, 0<br />    WndClassName        DB &quot;egi12&quot;, 0<br />    WindowTitle         DB &quot;Win32 ASM : Paint With Colors&quot;, 0<br />    <br />    rect RECT &lt;&gt;<br />    ps PAINTSTRUCT &lt;&gt;<br />    hDC                 DD 0<br />    PaintText           DB &quot;A Paint Example&quot;, 0<br />    <br />    hFont               DD 0<br />    FontType            DB &quot;script&quot;, 0<br />    <br /><br />    ;--------------------------------<br />    ;Use for debugging<br />    ;--------------------------------<br />    ;EXTRN MessageBoxA       : NEAR<br />    ;MsgTTL  db &quot;&quot;, 0<br />    ;MsgTXT  db &quot;&quot;, 0<br />    ;push    00h<br />    ;push    OFFSET MsgTTL<br />    ;push    OFFSET MsgTXT<br />    ;push    0<br />    ;call    MessageBoxA<br />    ;--------------------------------<br /><br />.CODE<br /><br />Start:<br /><br />    push    0<br />    call    GetModuleHandleA<br />    mov     , eax<br /><br />    push    32512<br />    push    <br />    call    LoadIconA<br />    mov     , eax<br />    push    32512<br />    push    <br />    call    LoadCursorA<br />    mov     , eax<br /><br />    push    OFFSET wcx<br />    call    RegisterClassExA<br /><br />    push    0<br />    push    <br />    push    0<br />    push    0<br />    push    600<br />    push    600<br />    push    75<br />    push    225<br />    push    10000000h or 0h or 0C00000h or 80000h or 40000h or 20000h<br />    push    OFFSET WindowTitle<br />    push    OFFSET WndClassName<br />    push    00000100h or 00000200h<br />    call    CreateWindowExA<br />    mov     , eax<br /><br />    WindowMSGs:<br /><br />        push    0<br />        push    0<br />        push    0<br />        push    OFFSET MSG<br />        call    GetMessageA<br />        or      eax, eax<br />        jz      WmQuit<br />        push    OFFSET MSG<br />        call    DispatchMessageA<br />        jmp     WindowMSGs<br /><br />        WmQuit:<br /><br />            push    0<br />            call    ExitProcess<br /><br />    WndProc:<br /><br />        cmp     DWORD ptr , 2h<br />        je      PQMSG<br />        cmp     DWORD ptr , 0Fh<br />        je      PaintMSG<br />        jmp     DefWindowProcA<br /><br />        PQMSG:<br /><br />            push    0<br />            call    PostQuitMessage<br />            xor     eax, eax<br />            ret     16<br /><br />        PaintMSG:<br /><br />            push    OFFSET ps<br />            push    <br />            call    BeginPaint<br />            mov     , eax<br />            <br />            push    OFFSET FontType<br />            push    64 or 0<br />            push    0<br />            push    0<br />            push    0<br />            push    255<br />            push    0<br />            push    0<br />            push    0<br />            push    400<br />            push    0<br />            push    0<br />            push    16<br />            push    24<br />            call    CreateFontA<br />            <br />            push    eax<br />            push    <br />            call    SelectObject<br />            mov     , eax<br />            <br />            RGB     200, 200, 50<br />            <br />            push    eax<br />            push    <br />            call    SetTextColor<br />            <br />            RGB     0, 0, 255<br />            <br />            push    eax<br />            push    <br />            call    SetBkColor<br />            <br />            ;This is the part. I have to count the string length.<br />            ;Because when using SIZE PaintText it always return 1,<br />            ;thus printing only the first character of the whole<br />            ;entire string<br />            ;<br />            ;Output: ecx<br /><br />            push    eax<br />            push    edi<br />            mov     edi, OFFSET PaintText<br />            xor     eax, eax<br />            mov     ecx, 0FFFFFFFFh<br />            cld<br />            repnz   scasb<br />            not     ecx<br />            dec     ecx<br />            pop     edi<br />            pop     eax<br />            <br />            ;In the tutorials example it is SIZEOF ...<br />            ;SIZEOF(MASM) == SIZE(TASM)<br />            ;If you try to put in SIZE PaintText, it returns 1<br />            ;<br />            ;push    SIZE PaintText<br /><br />            ;Now for some weirder stuff. If you try this<br />            ;push    SIZE PaintText * 3<br />            ;<br />            ;It will print out the first 3 characters of the string<br />            ;which is A P (A Space P)<br />            ;I didn't know that * could multiply values<br />            ;<br />            ;If you try push 3, this one will have the same output<br />            ;<br />            ;I really don't know, I wish somebody could clear this up<br /><br />            push    ecx<br /><br />            push    OFFSET PaintText<br />            push    0<br />            push    0<br />            push    <br />            call    TextOutA<br />            <br />            push    <br />            push    <br />            call    SelectObject<br />            <br />            push    OFFSET ps<br />            push    <br />            call    EndPaint<br /><br />            xor     eax, eax<br />            ret     16<br /><br />END Start<br /><br />The structures and equates were from Windows.inc provided by MASM32 v7.0<br /><br />Another weird bug: tasm crashes when using that include file. It gives me a heap error.<br /><br />Thanks!!!<br />:)  :grin:  :rolleyes:  :confused:  :stupid:</div>
    <div class="meta">Posted on 2001-12-18 17:40:04 by stryker</div>
   </div>
   <div class="post" id="post-15340">
    <div class="subject"><a href="#post-15340">Wierd stuff in TASM</a></div>
    <div class="body">1 - This could be because it is an array of bytes (each element is only 1 byte long). Try using SIZE on say a dword, if that is also 1, then there is a problem!<br /><br />2 - You can only use * at compile time. In the example below, you have on some occasions things like &quot;<strong>cmp DWORD ptr , 2h</strong>&quot;, and you cannot have 2 constant values in the instruction (+4 +4). The assembler knows that as they are constants, they can be rolled up into one, so the actual instruction is &quot;<strong>cmp , 2h</strong>&quot;. The multiply is the same! It is provided for our convenience. It is much more readable to say &quot;SIZEOF this_structure * number_of_elements&quot; than to have &quot;66&quot;, or some other arbitrary number that you the programmer must write (it also cuts down on errors too).<br />If you try to multiply some variable by another variable, the assembler will moan at you. You can of course multiply registers by 2, 4, and 8 (with certain exceptions) as in the lea instruction.<br /><br />Mirno</div>
    <div class="meta">Posted on 2001-12-18 18:55:16 by Mirno</div>
   </div>
   <div class="post" id="post-15341">
    <div class="subject"><a href="#post-15341">Wierd stuff in TASM</a></div>
    <div class="body">Ive tried<br /><br />push DWORD<br />or<br />push SIZE DWORD  ;Error In Compiling<br /><br />..Still doesnt work...<br /><br />I Still need to count the length of the string then push that value...<br /><br />For that DWORD ptr , 2h<br /><br />But anyway the code above still works.<br /><br />Thanks</div>
    <div class="meta">Posted on 2001-12-18 19:19:31 by stryker</div>
   </div>
   <div class="post" id="post-15348">
    <div class="subject"><a href="#post-15348">Wierd stuff in TASM</a></div>
    <div class="body">to get the size use following instruction:<br /><br />data 'example',0<br />dataSize EQU $-data</div>
    <div class="meta">Posted on 2001-12-18 21:31:03 by adapix</div>
   </div>
   <div class="post" id="post-15350">
    <div class="subject"><a href="#post-15350">Wierd stuff in TASM</a></div>
    <div class="body">Thanks I have a routine up there that counts the string length:<br /><br />            push    eax<br />            push    edi<br />            mov     edi, OFFSET PaintText<br />            xor     eax, eax<br />            mov     ecx, 0FFFFFFFFh<br />            cld<br />            repnz   scasb<br />            not     ecx<br />            dec     ecx<br />            pop     edi<br />            pop     eax<br /><br />Output: ecx now contains the length of the string<br /><br />:)</div>
    <div class="meta">Posted on 2001-12-18 22:22:15 by stryker</div>
   </div>
   <div class="post" id="post-15352">
    <div class="subject"><a href="#post-15352">Wierd stuff in TASM</a></div>
    <div class="body">Do you have <strong>SIZEOF</strong> in TASM?</div>
    <div class="meta">Posted on 2001-12-18 22:31:21 by bitRAKE</div>
   </div>
   <div class="post" id="post-15355">
    <div class="subject"><a href="#post-15355">Wierd stuff in TASM</a></div>
    <div class="body">TASM doesn't have SIZEOF. TASM equivalent of SIZEOF is SIZE.<br />And I'm sure that when using SIZEOF PaintText(MASM)...It returns the length of PaintText but in TASM it doesn't.<br /><br />:(</div>
    <div class="meta">Posted on 2001-12-18 23:51:33 by stryker</div>
   </div>
   <div class="post" id="post-15358">
    <div class="subject"><a href="#post-15358">Wierd stuff in TASM</a></div>
    <div class="body"><strong>MASM</strong>:<br /><br />SIZEOF <em>returns the byte length of a structure/label.</em><br /><br />LENGTHOF <em>returns the number of items.</em><br /><br /><strong>Example</strong>:<br /><br />What_Is_This  dd  1,1,2,3,5,8,13,21<br /><br />(SIZEOF What_Is_This) = 32<br /><br />(LENGTHOF What_Is_This) = 8<br /><br />(SIZE What_Is_This) = 4</div>
    <div class="meta">Posted on 2001-12-19 00:17:21 by bitRAKE</div>
   </div>
   <div class="post" id="post-15374">
    <div class="subject"><a href="#post-15374">Wierd stuff in TASM</a></div>
    <div class="body">hossa<br /><br />at last one who maybe uderstand my stupid questions :)<br />i often have problems when i convert stuff from masm to tasm.<br /><br />dont forget the hex2string convert in masm ,not aviable in tasm.<br />or some lib or inc files missing in tasm......<br /><br />if you need help find more of this ,i like to help.</div>
    <div class="meta">Posted on 2001-12-19 04:49:48 by Max</div>
   </div>
   <div class="post" id="post-15375">
    <div class="subject"><a href="#post-15375">Wierd stuff in TASM</a></div>
    <div class="body">i forget to say:<br /><br />to get the lenght of a string you can use &quot;lstrlen&quot;<br />call lstrlen ,offset STRING<br />eax = lenght<br /><br />lstrcpy to copy <br />lstrcat to add to</div>
    <div class="meta">Posted on 2001-12-19 04:52:32 by Max</div>
   </div>
   <div class="post" id="post-15377">
    <div class="subject"><a href="#post-15377">Wierd stuff in TASM</a></div>
    <div class="body">Why not just give up on tasm and use masm?</div>
    <div class="meta">Posted on 2001-12-19 05:04:27 by f0dder</div>
   </div>
   <div class="post" id="post-15385">
    <div class="subject"><a href="#post-15385">Wierd stuff in TASM</a></div>
    <div class="body">------<br />Why not just give up on tasm and use masm?<br />------<br /><br />lol hope not all think so :)<br />if there is a prob. with one then change to the next is not the way i like.<br /><br />i think first what should i learn....masm what most use and for what i can found most samples ,or tasm what not so much people use and where its hard to find infos about.<br />so i use tasm :)<br /><br />then try to disassemble with masm knowledge and then try it with tasm knowledge......tasm is much better !<br /><br />hm sound stupid if a newbie say : tasm is better<br />but i like it and i will use ...no matter how hard it is to learn this or that.<br />at last im shure i get it working ,like all the other stuff i today use.<br />most is bad coded or look bad but as long as it does what i want it is totaly ok for me.<br /><br />so i personal think there is no time to change to masm.<br /><br />its like 99 people speak spanish and i speak english...to make it easy i stop english and speak spanish.<br />so english get lost.......not what i want !<br /><br />i dont know enough about masm and why its not compatible to tasm or why tasm is not comp. to masm :)<br /><br />I WILL LEARN TO CODE *rofl*</div>
    <div class="meta">Posted on 2001-12-19 06:18:58 by Max</div>
   </div>
   <div class="post" id="post-15404">
    <div class="subject"><a href="#post-15404">Wierd stuff in TASM</a></div>
    <div class="body">Fodder, last time i took a look at it, it was TASM V.1 (1988).<br />At that time, it was clear that TASM was not so bad as MASM was.<br /><br />I don't know if the difference is yet effective today, as, since <br />that time, i never took any more any look at these two commercial <br />products, and i don't even care if they yet exist or not.<br /><br />Now, we have free (Open Sources or public Sources) Assemblers:<br />NASM, SpAsm, FASM, Pass32,...<br /><br />I feel free to push these ones because they are 'clean at a moral<br />point of vue'. I know that Hiro flames me down each time i raise<br />this Holly War argument, but i can't prevent, as this is my FIRST<br />choice criteria.<br /><br />Pushing a commercial product, whereas moral compatible products are<br />available for free, is fighting against freedom in the programming<br />area. Just like electing a serial killer as President of US is <br />fighting against against human dignity. Just like eating industrial <br />food is fighting for the destruction of nature by Dos-Santos and <br />friends. Just like having an  Panel up there,<br />after the candels enlightment in Manhattan, is fighting for the <br />destruction of Third World Countries by US... And so on...<br /><br />Now, if you mean to only talk of 'quality', this would be a lengthy<br />thread. I would not debate, as i have no idea of what others call<br />'quality', and because quality is a second hand problem in Open Source.<br />I mean, if the quality of an Open Source Assembler is not good enough<br />for the supposed great programmer you surely are, you just are allowed<br />to improve it. I am convinced that if you had spend half of the time <br />you spend at posting here, at improving one of the free Assemblers, it <br />would now be much better.<br /><br />Now, if one wants to use TASM, i really do not understand why, but i<br />will not shot graves... Good for him.<br /><br /><br />Betov.</div>
    <div class="meta">Posted on 2001-12-19 09:23:44 by Betov</div>
   </div>
   <div class="post" id="post-15405">
    <div class="subject"><a href="#post-15405">Wierd stuff in TASM</a></div>
    <div class="body">the behaviour of SIZE depends of whether you're using 'Ideal' or 'MASM' mode. example:<br /><br /><pre><code><br />.Data<br />SomeString      db &quot;This is a 29 character string&quot;,0<br /><br />.Code<br />Ideal<br />        mov     eax,SIZE SomeString<br />MASM<br />        mov     eax,SIZE SomeString<br /></code></pre><br /><br />this results in<br /><br /><pre><code><br />401000    mov eax, 0000001Dh<br />401005    mov eax, 00000001h<br /></code></pre></div>
    <div class="meta">Posted on 2001-12-19 09:41:19 by Tola</div>
   </div>
   <div class="post" id="post-15411">
    <div class="subject"><a href="#post-15411">Wierd stuff in TASM</a></div>
    <div class="body">Thanks everyone!!!<br /><br />I converted all my code in TASM's IDEAL mode...The SIZE actually worked, I thought it was a bug...<br /><br />Now I know that when using SIZE in ideal mode(TASM) actually gives you the same behaviour as the SIZEOF in MASM. But when using SIZE in MASM it returns 1.<br /><br />Though, in IDEAL mode you need an extra instruction for the window procedure(Nah!!! its only one line)<br /><br />E.G.: mov eax,  then compare...<br /><br />:-)</div>
    <div class="meta">Posted on 2001-12-19 11:24:54 by stryker</div>
   </div>
   <div class="post" id="post-15427">
    <div class="subject"><a href="#post-15427">Wierd stuff in TASM</a></div>
    <div class="body"><div class="quote">Though, in IDEAL mode you need an extra instruction for the window procedure(Nah!!! its only one line) <br /><br />E.G.: mov eax,  then compare...</div> <br /><br />you gotta change<br /><pre><code><br />cmp DWORD ptr &#91;esp+4+4&#93;, 2h<br /></code></pre><br />into<br /><pre><code><br />cmp &#91;DWORD ptr esp+4+4&#93;, 2h<br /></code></pre><br />for it to work in ideal mode (which i'm not using cause it'd be a major pain in the a** to convert the sources of my current projects ;))</div>
    <div class="meta">Posted on 2001-12-19 14:37:46 by Tola</div>
   </div>
  </div>
 </body>
</html>