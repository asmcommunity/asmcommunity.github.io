<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>need help with dx9 texture problem - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=22481" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=22481">need help with dx9 texture problem</a></p>
   <div class="post" id="post-168706">
    <div class="subject"><a href="#post-168706">need help with dx9 texture problem</a></div>
    <div class="body">I try a few polys first, before I start with meshgenerating code<br />but UV is wrong, I animate UV coordinates also<br />also after I have tested several times, it seems texture doesnt work at all, must be doing something wrong, wasting resources everytime its run, which adds up, I am using trianglestrips<br />floor is working, so is bg sky and one poly, but the other is stretching texture, so I tried and it stretches texture in the other direction<br />I have a few calls to render trianglestrips and few datasections<br />also wonder right settings for this partially transparent texture, to make hardware use transparency<br /><br /><img src="http://www.saber-x.com/magnus/wrong1.jpg" /><br /><pre><code> vertices2&nbsp;  CUSTOMVERTEX &lt;20.0f , 10.0f, 50.0f, 1.0f,0.0f,0.0f&gt;,\&nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;640.0f , 10.0f , 50.0f,1.0f, 1.0f,0.0f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;20.0f&nbsp; , 500.0f , 50.0f,1.0f, 0.0f, 1.0f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;640.0f,500.0f,50.0f,1.0f,1.0f,1.0f&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FLOAT 24 dup (1.0f) ;verticescliff is copied here after being tampered with<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FLOAT 24 dup (1.0f) ;so is verticescliff2 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FLOAT 6 dup (1.0f)<br />verticessky CUSTOMVERTEX &lt;0.0f , 0.0f, 1.0f, 1.0f,0.0f,0.0f&gt;,\&nbsp; &nbsp;  ;verticessky is not copied or tampered with<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;640.0f , 0.0f , 1.0f,1.0f, 1.0f,0.0f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;0.0f&nbsp; , 250.0f , 1.0f,1.0f, 0.0f, 0.5f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;640.0f,250.0f,1.0f,1.0f,1.0f,0.5f&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; verticessky2 CUSTOMVERTEX &lt;0.0f , 0.0f, 1.0f, 1.0f,0.0f,0.0f&gt;,\&nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;640.0f , 0.0f , 1.0f,1.0f, 1.0f,0.0f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;0.0f&nbsp; , 250.0f , 1.0f,1.0f, 0.0f, 0.5f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;640.0f,250.0f,1.0f,1.0f,1.0f,0.5f&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FLOAT 30 dup (1.0f)<br />&nbsp;  vertices&nbsp;  CUSTOMVERTEX &lt;-640.0f , 250.0f&nbsp; , 100.0f,1.0f, 0.0f,0.0f&gt;,\&nbsp;  ; Sealevel&nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;640.0f , 250.0f , 100.0f,1.0f, 1.0f,0.0f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;-640.0f&nbsp; , 500.0f ,1.0f,1.0f, 0.0f, 1.0f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;640.0f,500.0f,1.0f,1.0f,1.0f,1.0f&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;cliffs<br />&nbsp;  verticescliff CUSTOMVERTEX&nbsp; &lt;-640.0f,-200.0f,100.0f,1.0f,0.0f,0.0f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;-640.0f,500.0f,100.0f,1.0f,0.0f,1.0f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;-640.0f,-200.0f,1.0f,1.0f,1.0f,1.0f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;-640.0f,500.0f,1.0f,1.0f,1.0f,0.0f&gt;<br />&nbsp; verticescliff2 CUSTOMVERTEX&nbsp; &lt;630.0f,500.0f,100.0f,1.0f,0.0f,0.0f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;630.0f,-200.0f,100.0f,1.0f,1.0f,0.0f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;630.0f,-200.0f,1.0f,1.0f,0.0f,1.0f&gt;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;630.0f,500.0f,1.0f,1.0f,1.0f,1.0f&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /></code></pre><br />and here is api calls in render proc<br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; pcall lpd3dDevice.SetStreamSource, 0, lpVB, 0, sizeof(CUSTOMVERTEX)<br />&nbsp; &nbsp; &nbsp; &nbsp; pcall lpd3dDevice.SetFVF, D3DFVF_CUSTOMVERTEX<br />&nbsp; &nbsp; &nbsp; &nbsp; pcall lpd3dDevice.DrawPrimitive, D3DPT_TRIANGLESTRIP, 7,9;bgsky<br />&nbsp; &nbsp; &nbsp; &nbsp; pcall lpd3dDevice.SetTexture, 0, lpTexture<br />&nbsp; &nbsp; &nbsp; &nbsp; pcall lpd3dDevice.DrawPrimitive, D3DPT_TRIANGLESTRIP, 0,2 ;floorquad<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; pcall lpd3dDevice.DrawPrimitive, D3DPT_TRIANGLESTRIP, 3,4 ;left cliffs<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; pcall lpd3dDevice.DrawPrimitive, D3DPT_TRIANGLESTRIP, 4,6 ;right cliffs<br /></code></pre></div>
    <div class="meta">Posted on 2005-12-09 10:13:00 by daydreamer</div>
   </div>
   <div class="post" id="post-168708">
    <div class="subject"><a href="#post-168708">Re: need help with dx9 texture problem</a></div>
    <div class="body">The second and third parameters to DrawPrimitive seem to be messed up.<br /><br />Try<br /><pre><code>pcall lpd3dDevice.DrawPrimitive, D3DPT_TRIANGLESTRIP, 0*size CUSTOMVERTEX,2 ;floorquad<br />pcall lpd3dDevice.DrawPrimitive, D3DPT_TRIANGLESTRIP, 3*size CUSTOMVERTEX,1 ;left cliffs<br />pcall lpd3dDevice.DrawPrimitive, D3DPT_TRIANGLESTRIP, 4*size CUSTOMVERTEX,1 ;right cliffs</code></pre><br /><br />or anything similiar. The left cliffs should work now. Remember that the second param is a starting VERTEX not object. if you&#39;re drawing trianglestrips, then first triangle is 3 = vertices, but every next triangle requires only 1 additional vertex.<br /><br />consider switching to triangle list.</div>
    <div class="meta">Posted on 2005-12-09 10:57:32 by ti_mo_n</div>
   </div>
   <div class="post" id="post-168773">
    <div class="subject"><a href="#post-168773">Re: need help with dx9 texture problem</a></div>
    <div class="body">I found it: I only animate U coordinates, so V coordinates for anything than floorquad that had corrrect data was fixed at 1.0f,1.0f by those dup, I merely forgot to copy V coordinates in the part that animates/meddles with original meshes<br /></div>
    <div class="meta">Posted on 2005-12-11 10:24:58 by daydreamer</div>
   </div>
   <div class="post" id="post-168776">
    <div class="subject"><a href="#post-168776">Re: need help with dx9 texture problem</a></div>
    <div class="body">it works fine with loading 256mb a32r32g32b32 texture from file, but I try to write a header for a small 128bit texture in memory, but it generates a gp when I try with loadtexturefrommem, any help would be welcome and if it works I can share a spinoff from my project in form of platform for people who want to try write SSE code that renders such textures and a 3d assisted 2d, w all hardware filters applied making your 2d game look better, than with ddraw/GDI<br /><br /></div>
    <div class="meta">Posted on 2005-12-11 10:49:39 by daydreamer</div>
   </div>
   <div class="post" id="post-168781">
    <div class="subject"><a href="#post-168781">Re: need help with dx9 texture problem</a></div>
    <div class="body">Are you using <a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/directx9_c/D3DXCreateTextureFromFileInMemoryEx.asp">D3DXCreateTextureFromFileInMemoryEx</a> ? Check the return value.</div>
    <div class="meta">Posted on 2005-12-11 12:24:06 by ti_mo_n</div>
   </div>
  </div>
 </body>
</html>