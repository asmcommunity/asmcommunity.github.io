<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Rename file with 56h doesn't work? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=26021" />
  <link rel="prev" href="../?id=26021&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=26021">Rename file with 56h doesn't work?</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=26021&amp;page=1" style="">&laquo;</a><a href="../?id=26021&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="26021" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-189630">
    <div class="subject"><a href="#post-189630">Re: Rename file with 56h doesn't work?</a></div>
    <div class="body"><div class="quote"><br />2) Strings to be handled by the DOS interrupts all had to be terminated by the $ character).<br /></div><br />Only for function 9 &quot;print string&quot;. All other strings are ASCIIZ (zero-terminated).</div>
    <div class="meta">Posted on 2007-06-14 21:16:01 by sinsi</div>
   </div>
   <div class="post" id="post-189634">
    <div class="subject"><a href="#post-189634">Re: Rename file with 56h doesn't work?</a></div>
    <div class="body">If you&#39;re doing a standalone .com file in a Winbox don&#39;t forget to finish off with<br /><br />mov ax,4C00<br />int 21<br /><br />kinda thing.<br />Or it crashes.<br /></div>
    <div class="meta">Posted on 2007-06-16 05:31:26 by eek</div>
   </div>
   <div class="post" id="post-189635">
    <div class="subject"><a href="#post-189635">Re: Rename file with 56h doesn't work?</a></div>
    <div class="body">As far as I remember, you didn&#39;t need to issue the DOS trap for COM files and I believe the above source is for a COM file. RET will do&nbsp; 8)<br /><br />I remember having written a rename-file function in my OASML library like this:<br /><br /><pre><code>; ------------------------------<br />FileRename PROC<br />&nbsp; COMMENT *<br />&nbsp; &nbsp; Description : Renames a file given its full null-terminated path to another given path<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; which should be null-terminated too. See note(s).<br /><br />&nbsp; &nbsp; Calling Convention : Push from left to right.<br /><br />&nbsp; &nbsp; Parameter(s) :<br />&nbsp; &nbsp; &nbsp; WORD Param1 = Existing file path<br />&nbsp; &nbsp; &nbsp; WORD Param2 = New file path<br /><br />&nbsp; &nbsp; Stack Usage: 8 Bytes.<br /><br />&nbsp; &nbsp; Note : 1) The FileRename procedure can be used to move files from one location to<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; another as long as both files exist in the same disk.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  2) The AX register will be set to 0000h (Zero) if the procedure is through successfully<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; or to one of the below values if an error occurrs:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AX = 0002h (File not found)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AX = 0005h (Access denied)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AX = 0011h (Not the same device)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  3) Both Param1 and Param2 are assumed to have had been declared in the DS (Data segment).<br /><br />&nbsp; &nbsp; Example : Rename the file &#39;C:\Command.bak&#39; to &#39;C:\Com.bak&#39;<br /><br />&nbsp; &nbsp; .DATA<br />&nbsp; &nbsp; &nbsp; FileName&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;C:\Command.bak&#39;, 0<br />&nbsp; &nbsp; &nbsp; NewName&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;C:\Com.bak&#39;, 0<br />&nbsp; &nbsp; .CODE<br />&nbsp; &nbsp; &nbsp; PUSH&nbsp; &nbsp; OFFSET FileName ; Existing file<br />&nbsp; &nbsp; &nbsp; PUSH&nbsp; &nbsp; OFFSET NewName&nbsp; ; New file path<br />&nbsp; &nbsp; &nbsp; CALL&nbsp; &nbsp; FileRename&nbsp; &nbsp; &nbsp; ; Rename the file<br />&nbsp; &nbsp; &nbsp; ADD&nbsp; &nbsp;  SP , 0004h&nbsp; &nbsp; &nbsp; ; Remove both of the parameters off of the stack<br />&nbsp; &nbsp; &nbsp; TEST&nbsp; &nbsp; AX , AX&nbsp; &nbsp; &nbsp; &nbsp;  ; See if AX == 0 (Success)<br />&nbsp; &nbsp; &nbsp; JNE&nbsp; &nbsp;  @@Failed&nbsp; &nbsp; &nbsp; &nbsp; ; Jump to ... if not<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Success<br />&nbsp; &nbsp; &nbsp; @@Failed:<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Failure<br />&nbsp; *<br />&nbsp; PUSH&nbsp; &nbsp; DX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Push the data register onto the stack<br />&nbsp; PUSH&nbsp; &nbsp; DI&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Push the destination index onto the stack<br />&nbsp; PUSH&nbsp; &nbsp; BP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Push the base pointer onto the stack<br />&nbsp; PUSH&nbsp; &nbsp; ES&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Preserve the extra segment<br />&nbsp; MOV&nbsp; &nbsp;  AX , DS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Move the data segment to the AX register<br />&nbsp; MOV&nbsp; &nbsp;  ES , AX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Move the AX register to the extra segment<br />&nbsp; MOV&nbsp; &nbsp;  BP , SP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Move the stack pointer to the base pointer<br />&nbsp; MOV&nbsp; &nbsp;  AH , 56h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Request Rename File operation<br />&nbsp; MOV&nbsp; &nbsp;  DI , WORD PTR &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; DI = New file path<br />&nbsp; MOV&nbsp; &nbsp;  DX , WORD PTR &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; DX = Existing file path<br />&nbsp; DW&nbsp; &nbsp; &nbsp; 21CDh&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Issue the DOS interrupt<br />&nbsp; JC&nbsp; &nbsp; &nbsp; @@__FileRenameEP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Jump to ... if an error has occurred<br />&nbsp; XOR&nbsp; &nbsp;  AX , AX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; AX = 0000h (Success)<br />&nbsp; @@__FileRenameEP:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; End of the procedure routine<br />&nbsp; &nbsp; POP&nbsp; &nbsp;  ES&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Restore the extra segment<br />&nbsp; &nbsp; POP&nbsp; &nbsp;  BP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Restore the base pointer<br />&nbsp; &nbsp; POP&nbsp; &nbsp;  DI&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Restore the destination index<br />&nbsp; &nbsp; POP&nbsp; &nbsp;  DX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Restore the data register<br />&nbsp; RET&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Return to the calling procedure<br />FileRename ENDP<br />; ------------------------------</code></pre><br /><br />I hate DOS now. I&#39;m glad I am not coding anything for it anymore.</div>
    <div class="meta">Posted on 2007-06-16 08:21:19 by XCHG</div>
   </div>
   <div class="post" id="post-189636">
    <div class="subject"><a href="#post-189636">Re: Rename file with 56h doesn't work?</a></div>
    <div class="body"><div class="quote"><br /><br />I hate DOS now. I&#39;m glad I am not coding anything for it anymore.<br /></div><br /><br />What did you progress onto?<br /></div>
    <div class="meta">Posted on 2007-06-16 10:04:31 by eek</div>
   </div>
   <div class="post" id="post-189637">
    <div class="subject"><a href="#post-189637">Re: Rename file with 56h doesn't work?</a></div>
    <div class="body">Kind of off topic but I am coding my own OS. I&#39;ve got PIC, PIT, HDD Driver, Physical Memory Management, Scheduling and multitasking working up to this point. The next step is creating my own File System and also extending the HDD Driver to use UDMA for faster transfers. That way I will be able to get virtual memory working for my user processes too.</div>
    <div class="meta">Posted on 2007-06-16 13:09:45 by XCHG</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=26021&amp;page=1" style="">&laquo;</a><a href="../?id=26021&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="26021" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>