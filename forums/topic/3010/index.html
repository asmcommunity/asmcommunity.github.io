<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>SetMenuItemInfo - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3010" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=3010">SetMenuItemInfo</a></p>
   <div class="post" id="post-19639">
    <div class="subject"><a href="#post-19639">SetMenuItemInfo</a></div>
    <div class="body">Hi there.<br />I have another problem concerning onwer-drawn menus. What i do is the following:<br />Load a menu from a resource (all the items have the type MFT_STRING or MFT_SEPARATOR; they aren't set to owner-draw yet). when i got the menu handle, i change all menu items to owner drawn and set the item data to it's menu handle.<br />When i receive WM_MEASUREITEM, i use GetMenuItemInfo with the menu handle being the item data to receive the item's text (dwTypeData). when i received the item's string, i modify it and try to set the item's text to the new modified string using SetMenuItemInfo.<br />On WM_DRAWITEM i use GetMenuItemInfo again to receive the item's text to draw it later.<br /><br />But my program always runs into an exception fault. Sometimes, i can open the menu once, but nothing is shown. when i open it again, the exception fault occurs. by the time, the first exception fault has occured, nothin works anymore.<br />my computer sometimes starts to beep in fixed intervals. i don't know, but this code must be harming the system very hard. but i don't know why.<br /><br />My question is:<br />Could it be, that the menu item's text (dwTypeData) gets invalid after settings the item to owner drawn? i mean, at the beginning of the program, menu item's with strings have MFT_STRING and the string in dwTypeData. but when i set it to owner draw, does dwTypeData get lost or invalid or whatever? so if it gets lost, an attempt to write (and read???) would end in an exception faut crashing the whole system?<br /><br /><br />I could really need some help on this one please.<br />Or maybe someone can tell me about another good method about how to implement an owner drawn menu. i mean, maybe its not possible to load a menu with menu item strings from a resource and then changing the item types to owner drawn and trying to use the item's text.</div>
    <div class="meta">Posted on 2002-01-17 06:20:47 by darester</div>
   </div>
  </div>
 </body>
</html>