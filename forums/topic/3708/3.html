<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Quickk reference to MMX/SSE/SSE2 ... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3708" />
  <link rel="prev" href="../?id=3708&amp;page=2" />  <link rel="next" href="../?id=3708&amp;page=4" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=3708">Quickk reference to MMX/SSE/SSE2 ...</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=3708&amp;page=1" style="">&laquo;</a><a href="../?id=3708&amp;page=2" style="">&lt;</a><input type="hidden" name="id" value="3708" /><input type="number" name="page" min="1" max="5" step="1" value="3" onchange="this.form.submit();" /><a href="../?id=3708&amp;page=4">&gt;</a><a href="../?id=3708&amp;page=5">&raquo;</a></form>   <div class="post" id="post-104225">
    <div class="subject"><a href="#post-104225">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">No, in this version clipping is not implemented.<br />And in the current version it is, but there is a serious bug, but I have no time to work on the project, maybe in June.<br /><br />BTW: Geoff Crammond has announced STUNT CAR RACER PRO (sequel to SCR) for next year - I think I have to speed up!<br /><br />VShader</div>
    <div class="meta">Posted on 2003-05-21 14:10:19 by VShader</div>
   </div>
   <div class="post" id="post-108571">
    <div class="subject"><a href="#post-108571">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">O.k., full 3D-Clipping works.<br />(The &quot;serious&quot; bug was a silly bug, but it was serious hard to find it...)<br /><br />It uses mmx for point-plane-distance and fpu for dividing. There are two buffers while clipping for seperating mmx- and fpu-operations so it should be fast on first-generation mmx-machines.<br />It clipps now against the 6 VF-Planes, but it can clipp against up to 16 planes.<br /><br />Use &lt;F11&gt; to observe the clipping (outlined triangles).<br /><br />The issue with the accuracy while moving away from the center is gone because I do now (with mmx-matrix-transformation) only rotate/scale - translation is done by a simple mmx-add. So now you have everywhere in the scene max. accuracy.<br /><br />16 bit-colour rendering is optimized - It should even with full 3d-clipping be faster than the last version.<br /><br />You can dynamically move the farplane with &lt;pageup&gt; and &lt;pagedown&gt; (perhaps you must change the scale with &lt;u&gt; and &lt;i&gt; to avoid rendering-artefacts).<br /><br /><br />I attach a 16bit-colour exe (DX8 problem is NOT gone!) with the dog from above (picture). I modified it somewhat to stress the clipping-routine...<br /><br />Have fun.<br />VShader</div>
    <div class="meta">Posted on 2003-06-28 17:43:06 by VShader</div>
   </div>
   <div class="post" id="post-127920">
    <div class="subject"><a href="#post-127920">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">There seems to be a pitchbug in the triangle rasterizer, I just get nasty shifted scanlines...<br />Are you perchance assuming that a scanline in memory is always width*sizeof(pixel) bytes long? It's not, the real length is called 'pitch', and you obtain it when locking a DirectDraw surface. So if this is the case, perhaps you can fix the bug, so I can see the program aswell.</div>
    <div class="meta">Posted on 2003-12-15 15:17:59 by Bruce-li</div>
   </div>
   <div class="post" id="post-127924">
    <div class="subject"><a href="#post-127924">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">:(</div>
    <div class="meta">Posted on 2003-12-15 15:58:21 by Delight</div>
   </div>
   <div class="post" id="post-128045">
    <div class="subject"><a href="#post-128045">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">Delight, can you please start this version, make a screenshot and post it here? Please NO MOVEMENT before you make the screenshot (&quot;PRINT&quot;-key).<br /><br />Thanks, <br />VShader</div>
    <div class="meta">Posted on 2003-12-16 16:10:24 by VShader</div>
   </div>
   <div class="post" id="post-128046">
    <div class="subject"><a href="#post-128046">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">Here how it looks without the pitch-error:<br /><br />VShader</div>
    <div class="meta">Posted on 2003-12-16 16:11:34 by VShader</div>
   </div>
   <div class="post" id="post-128056">
    <div class="subject"><a href="#post-128056">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">i get this</div>
    <div class="meta">Posted on 2003-12-16 17:32:14 by evil__donkey</div>
   </div>
   <div class="post" id="post-140301">
    <div class="subject"><a href="#post-140301">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">We got a new computer @ work.<br />And there was that nasty graphics error (see above) too.<br />So now I could fix and test it: I think it was only the wrong pitch ( now I take the pitch-value from the direct draw surface, thank to Bruce-li ) - It should now run correct on all machines ?! (feedback please! Dx8? Dx9?)<br /><br />If you want to run the racetrack-scene: rename y1.asc to y.asc  .<br />Or you can start truespace 3.x , make your object and: ? File / Save object as /  3Dstudio ASCII *.asc ? ( name: y.asc )  to fly in your own scene.<br /><br />Have fun.<br /><br />(By the way: the only routine I now need to make a full game out of this is mixing wav-sound. Best way should be to use DirectSound from DirectX7 and above - Has anybody here a asm-file where DirectSound is initialized and used?)<br /><br />VShader</div>
    <div class="meta">Posted on 2004-04-27 17:16:14 by VShader</div>
   </div>
   <div class="post" id="post-140302">
    <div class="subject"><a href="#post-140302">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">And here is the new engine:<br /><br />VShader</div>
    <div class="meta">Posted on 2004-04-27 17:17:35 by VShader</div>
   </div>
   <div class="post" id="post-140306">
    <div class="subject"><a href="#post-140306">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">runs fine now (dx9.0b, winxpSP1, r9600xt, yaddayadda). Btw, even larger companies have made the infamous pitch error... I ended up writing a bugfix loader for the XCOM and TFTD windows ports because the developers hadn't considered reading the DirectX docs and used width instead of pitch :rolleyes:<br /><br /><br />PS: 800x600 version runs consitantly at 85fps (refresh rate) here - the wonders of a 2.53ghz P4 :). Planning on releasing source, or are you keeping it closed? And what about selecting the resolution dynamically? Would be fun to see how it does at 1280x1024 :P</div>
    <div class="meta">Posted on 2004-04-27 18:40:01 by f0dder</div>
   </div>
   <div class="post" id="post-140307">
    <div class="subject"><a href="#post-140307">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">Max. I can do (and test) here is 1152x864 .<br />But 16bit-integer-fixed-point-math is showing more and more in higher resolutions ...<br /><br />Source is in this thread (but not the latest version).<br />I you have the pitch error search for &quot;BytesProZeile&quot; (=BytesPerLine) and insert something like this at startup:<br /><br />--------------<br />;Linesize in Bytes (Pitch) from DirectDrawSourface<br /> INVOKE Lock_BackBuffer<br /> mov eax, ddsd.lPitch<br /> mov BytesProZeile, eax<br /> INVOKE Unlock_BackBuffer<br />--------------<br /><br />( put it right after &quot;;===_MyInit&quot; )<br /><br /><br />&quot;selecting the resolution dynamically&quot;: I have to set a parameter for fixedPointPrecision too, so: not in the near future ...  :=)<br /><br /><br />VShader</div>
    <div class="meta">Posted on 2004-04-27 19:42:49 by VShader</div>
   </div>
   <div class="post" id="post-140308">
    <div class="subject"><a href="#post-140308">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">I ran the 1152x864 version, and just for fun turned off vsync. Speed varies from ~125 to 235fps, and is usually around 190. I guess it would be interesting to see the same engine in a float and a SSE2 version - and yes, I'm aware that would mean rewriting most of the code :).<br /><br />PS: are you going to use this engine for a new version of 4D sports driving AKA stunts? :P</div>
    <div class="meta">Posted on 2004-04-27 19:51:51 by f0dder</div>
   </div>
   <div class="post" id="post-140321">
    <div class="subject"><a href="#post-140321">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">You might want to look into sub-pixel correction. This will make your edges 'flow' smoothly and give the whole scene a less 'jerky' look when moving around, because you will draw the lines at the actual fractional coordinates, and not just between two pixels onscreen.</div>
    <div class="meta">Posted on 2004-04-28 02:05:17 by Scali</div>
   </div>
   <div class="post" id="post-140324">
    <div class="subject"><a href="#post-140324">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">--------<br />and just for fun turned off vsync. <br />--------<br />( Sorry: ) How did you turn off vsync for DirectDraw (Matrox Mystique, Win95 here)?<br /><br />--------<br />...for a new version of 4D sports driving AKA stunts? :P<br />--------<br />No, Kennedy Approach 3D !<br /><br />--------<br />... float and a SSE2 version <br />--------<br />PMMX200 now, AMD64 soon: Not unlikely that I will add support for SSE2 then. (World can then be much bigger.)<br /><br />--------<br />... because you will draw the lines at the actual fractional coordinates, and not just between two pixels onscreen<br />--------<br />I do compute the actual fractional coordinates but I have to draw at actual pixels (where else?). Filtering or AA would be to slow.<br /><br /><br />VShader</div>
    <div class="meta">Posted on 2004-04-28 03:24:41 by VShader</div>
   </div>
   <div class="post" id="post-140334">
    <div class="subject"><a href="#post-140334">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body"><div class="quote">I do compute the actual fractional coordinates but I have to draw at actual pixels (where else?).</div><br /><br />Well, that's the point.<br />Say you have a line from point A( 0.01, 0.5 ) to B( 1.9, 10.0 )<br />You truncate the fractions, so you draw at A( 0.0, 0.0 ) to B( 1.0, 10.0 )<br />If you would draw out such a line on grid-paper, you will see that it passes through different cells than the first one.<br />With subpixel-correction, you can draw the actual line that passes through the proper cells (pixels).<br />This costs almost nothing extra, there is just an extra 'pre-step' required.<br />The idea is to define a hotspot inside a pixel. All hotspots are exactly 1 pixel apart.<br />So the trick is to align the start of the line to a hotspot. After that you can step one pixel at a time, as you normally do, because you will step exactly on the hotspots.<br />You might want to look closely at slowly rotating cubes or things, on hardware (they all have subpixel/texel/other gradient correction, and are therefore very smooth and stable), and compare it to yours. Your rasterizer will always divide a line up into an evenly spaced, evenly sized set of segments, like this:<br /><br /><pre><code><br />-----____<br /><br />--__<br />    --__<br /></code></pre><br /><br />And you will see it hop from one to the next.<br /><br />With subpixel correction you can also draw the other lines, such as:<br /><br /><pre><code><br />-<br /> _______<br /><br />---<br />   _____<br /></code></pre><br /><br />And this means that the edges will 'flow' more smoothly when rotating, because they are drawn more accurately.<br /><br />Hard to explain, easy once you understand the problem.<br />The same goes for textures and other things, you want to sample the textures at the hotspots, not randomly inside a pixel because you just discard the fractions.</div>
    <div class="meta">Posted on 2004-04-28 05:45:07 by Scali</div>
   </div>
   <div class="post" id="post-140366">
    <div class="subject"><a href="#post-140366">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">Woah, I get like 393 FPS on the 32-bit version, I'm using a Thunderbird 900Mhz and an ATI Radeon 8500LE. Nice piece of work! :D<br />Ran the 800x600 versin, get like 120 fps, nice piece of work, hey one question, I'm writing an SMS emu and I'm quite disappointed at the flip speed, and I'm trying different recommendations by people like f0dder and the like, but how are you able to flip so fast!?!? My SMS emu on my PC is a DRAG at 800x600 and unreasonably fast at 320x240 (maybe because I'm calling a function every time I need to read the Z80 memory space, ick.., anways I'll optimize that out later), do you use hardware flipping?</div>
    <div class="meta">Posted on 2004-04-28 15:18:06 by x86asm</div>
   </div>
   <div class="post" id="post-140416">
    <div class="subject"><a href="#post-140416">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">Yes, hardwareflipping.<br /><br />Rip out all the 3D-stuff from the source in this thread and use it for your emulator.<br /><br />Please tell me how you disable VSync to get 393 FPS.<br /><br />VShader</div>
    <div class="meta">Posted on 2004-04-29 02:54:32 by VShader</div>
   </div>
   <div class="post" id="post-140429">
    <div class="subject"><a href="#post-140429">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">Do you understand what subpixel-correction is/does now, or are you ignoring my post?</div>
    <div class="meta">Posted on 2004-04-29 05:08:15 by Scali</div>
   </div>
   <div class="post" id="post-140436">
    <div class="subject"><a href="#post-140436">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">-- ------<br />.... or are you ignoring my post?<br />--------<br /><br />Sorry, not all day online ...<br /><br />I get the idea by your explanation but I have first to check out the effect on a lowres unfiltered scene on a accelerator.<br /><br /><br />Rememeber that this engine is mmx-based (16bit signed fixed point used for 3D-transforming) so the question is, if the accuracy of the transform is high enough that it is worth to implement subpixel correction (or if the transform is so inaccurate that you don't notice subpixel correction ).<br /><br />VShader</div>
    <div class="meta">Posted on 2004-04-29 06:16:39 by VShader</div>
   </div>
   <div class="post" id="post-140437">
    <div class="subject"><a href="#post-140437">Quickk reference to MMX/SSE/SSE2 ...</a></div>
    <div class="body">VShader, whether you can turn off flip-sync will depend on your video drivers. NVidia drivers have some registry hack iirc, ATI radeon drivers have it somewhere in the advanced display settings.<br /><br />You should always leave it to the user whether to have flipsync or not, I personally hate games that disable it, as it causes ugly tearing. But it's useful enough when developing, to see what kind of framerates you are getting.</div>
    <div class="meta">Posted on 2004-04-29 06:47:10 by f0dder</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=3708&amp;page=1" style="">&laquo;</a><a href="../?id=3708&amp;page=2" style="">&lt;</a><input type="hidden" name="id" value="3708" /><input type="number" name="page" min="1" max="5" step="1" value="3" onchange="this.form.submit();" /><a href="../?id=3708&amp;page=4">&gt;</a><a href="../?id=3708&amp;page=5">&raquo;</a></form>  </div>
 </body>
</html>