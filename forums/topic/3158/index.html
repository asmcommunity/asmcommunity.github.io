<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Encrytion Method Testing - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3158" />
    <link rel="next" href="../?id=3158&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=3158">Encrytion Method Testing</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=3158&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=3158&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="3158" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=3158&amp;page=2">&gt;</a><a href="../?id=3158&amp;page=3">&raquo;</a></form>   <div class="post" id="post-20808">
    <div class="subject"><a href="#post-20808">Encrytion Method Testing</a></div>
    <div class="body">I just wrote a pretty crappy encrytion algorithm... 2 questions though:<br /><br />1) How can I tell if my encryption algorithm is any good?  How do people actually crack an encryption algorithm anyway?  Not sure how I'd even begin to wirte a bruteforce program to test my program... So if that is the only way (how do you write one)<br /><br />2) I want the program to encrypt/decryp the file &quot;itself&quot; when it is opened (so it can't be patched -- at least easily)... This is because I have a string &quot;Register&quot; in the program that anyone with a debugger can find... :( <br /><br />As for part 2 -- you use a delta offset and then encryt the size of the file?  I really want to learn this to protect my files so any help will be appreciated<br /><br />Sliver</div>
    <div class="meta">Posted on 2002-01-23 22:39:04 by Sliver</div>
   </div>
   <div class="post" id="post-20890">
    <div class="subject"><a href="#post-20890">Encrytion Method Testing</a></div>
    <div class="body">Bruteforcing? Loop through all the available keys. Usually not much<br />fun. Only useful if you have some idea what the original data is,<br />otherwise you'll have to look through too much data. A CRC is<br />perfect, but if you know that it's eg english text, there are some<br />possbilities as well.<br /><br />If the algorithm is lame, it can be attacked in other and much more<br />efficient ways. This, however, is more or less advanced, and I haven't<br />bothered to read much on it as I'm not going to do cryptanalysis.<br /><br />As for protecting your application, there is an old saying: &quot;If it runs,<br />it can be cr4cked&quot;. If you want to encrypt/decrypt stuff in your executable,<br />you will obviously need to have the decryption key somewhere as well.</div>
    <div class="meta">Posted on 2002-01-24 07:46:48 by f0dder</div>
   </div>
   <div class="post" id="post-20986">
    <div class="subject"><a href="#post-20986">Encrytion Method Testing</a></div>
    <div class="body">have the file encrypted by the application itself will prevent &quot;some&quot; people from hacking the serial number...  You are right that some people might be able to debug the active process, but it will be harder for them to patch it :-)<br /><br />So the question is again:<br /><br />How do you write an application that will encrypt some of its internal data? Inotherwords:<br /><br /><pre><code><br />Start&#58;<br /><br />invoke decrypt from offset main to end_main<br /><br />Main&#58;<br /><br />....<br />...<br />....<br />...<br /><br />End_Main&#58;<br /><br />invoke encrypt from offset main to end_main<br /><br />end start<br /></code></pre><br /><br />I've now seriosuly looked everywhere on the internet for something like this and all I've pulled up were virus's... hasn't anyone implemented this for an application?  <br /><br />If not how hard would it be to do a simple XOR encryption?  Such as I've described?<br /><br />Sliver</div>
    <div class="meta">Posted on 2002-01-24 18:02:01 by Sliver</div>
   </div>
   <div class="post" id="post-20988">
    <div class="subject"><a href="#post-20988">Encrytion Method Testing</a></div>
    <div class="body">It's very easy for data. A bit more annoying for code, as you need<br />to deal with page permissions and stuff. And if you use a wrapper<br />scheme and encrypt everything... well, it's not very hard to trace<br />to OEP and do a process dump :=).</div>
    <div class="meta">Posted on 2002-01-24 18:07:53 by f0dder</div>
   </div>
   <div class="post" id="post-20990">
    <div class="subject"><a href="#post-20990">Encrytion Method Testing</a></div>
    <div class="body">So how do virus writers do it so freely... even within the bounds of 32 bit protected mode?  I really don't want to have to learn virus techniques just to solve this silly problem...<br /><br />Sliver<br /><br />ps. But I thought it was possible to have a program that can modify it's own code at runtime... or is this something that was left back in the days of 16bit?</div>
    <div class="meta">Posted on 2002-01-24 18:18:46 by Sliver</div>
   </div>
   <div class="post" id="post-20991">
    <div class="subject"><a href="#post-20991">Encrytion Method Testing</a></div>
    <div class="body">I know of a basic way to encrypt. if you xor a byte with a number and then xor it with that number again it goese back to the origonal so you would xor all the bytes that contain your data with the encryption key and then to decrypt xor them again. A real encryption algorythum would be much more complex<br /><strong>EDIT<br /></strong><br /><br />I have sean vuris code that modifies its code. it dosen't modify the code on disk untill it writes the next copy of itself.</div>
    <div class="meta">Posted on 2002-01-24 18:22:40 by Quantum</div>
   </div>
   <div class="post" id="post-21013">
    <div class="subject"><a href="#post-21013">Encrytion Method Testing</a></div>
    <div class="body">Quantum,<br />       I already have an encryption procedure... I just wanted to see if someone had an encrytion routine that &quot;encrypted code within the application itself&quot;... <br /><br />The edited part of your respons relates to opcode alteration... which is out of the scope of the question...<br /><br />I just want to learn to code a program that encrypts its own code... The encryption it uses is superfluous to that end...<br /><br />So the quuestion is:  How do I start?<br /><br />Sliver</div>
    <div class="meta">Posted on 2002-01-24 21:12:13 by Sliver</div>
   </div>
   <div class="post" id="post-21017">
    <div class="subject"><a href="#post-21017">Encrytion Method Testing</a></div>
    <div class="body"><div class="quote">I just want to learn to code a program that encrypts its own code... The encryption it uses is superfluous to that end... </div><br /><br />I think to do this you have to aulter the programs opcodes so they are unreadable to somone using a disassembler and this is done by putting there values thru your algorythum. Why don't you try something like this, create a small procedure that you want to eycrypt then use your algorythum to encrypt all of the bytes that make up that procedure and then create another program that starts with the decrypter wich would work on the bytes following the decrypter code. After your decrypter do<br />encryptedcode db ...... and put in the encrypted procedures code.<br />I hope I have made sense and I hope I have understood what you wanted</div>
    <div class="meta">Posted on 2002-01-24 21:51:47 by Quantum</div>
   </div>
   <div class="post" id="post-21021">
    <div class="subject"><a href="#post-21021">Encrytion Method Testing</a></div>
    <div class="body">I once saw a program that decrypted ever proceedure on the stack before executing it. ;)</div>
    <div class="meta">Posted on 2002-01-24 22:25:37 by bitRAKE</div>
   </div>
   <div class="post" id="post-21022">
    <div class="subject"><a href="#post-21022">Encrytion Method Testing</a></div>
    <div class="body">Ok, found 1 and only 1 program after all my searching of the internet...<br /><br />I'm including the source and program itself... (since it was released by the programmer)<br /><br />Here is what the author says it does (it is also rated 4 in the crackme's hall of fame -- whatever that means)... I'm still trying to piece together it all :(  I'm afraid it may be over my head... I didn't know how hard this would be... It's also for tasm<br /><br /><br /><br /><div class="quote"><br /><br />; Title:              : CrueMe v1.0<br />; Author              : Cruehead<br />; Creation date       : 98-06-02<br />; Source release date : 99-02-13<br />;<br />; Description:<br />; This is the source code for yet another &quot;CrackMe&quot; program. This one<br />; has proven to be fairly hard to beat, and it took approx 8 months before<br />; I received five solutions. The most interesting among those solutions is the one I got<br />; from &quot;MerCuur&quot;. He wrote a generic brute forcer based on mutations and life forms.<br />; I included his source code (in C) in this zip archive...It's really interesting.<br />;<br />; The crackme features some polymorphic code to hide the real<br />; encryption and check routine. As soon as the real check has been executed<br />; the code will be overwritten with useless code, and a fake<br />; encryption/check routine will be executed. Every time the &quot;Check It!&quot;<br />; button is pressed the real encryption/check routine is beeing written<br />; to the correct place again. Before the real encryption/check routine is executed<br />; the string is fetched through the GetText message beeing sent.<br />; A breakpoint detection is made on the &quot;GetDlgItemTextA&quot; function as this<br />; is the routine that is used to fetch the string and then execute the fake test.<br />; All of this just to confuse the cracker into thinking he's on the right path<br />; when seeing the &quot;No breakpoint allowed...&quot; message. Also the file called &quot;CRUEME.DAT&quot; has<br />; nothing to do what so ever with the real check - it's only used as a red herring.<br />; Knowing this one can easily figure out that the &quot;FileMon&quot; detection is also only<br />; used as a red herring to distract the user from the real interesting piece of<br />; the code.<br />; Another thing is that all the functions used in the program are stored in a<br />; separate place thus making it a lookup table. This is only to confuse<br />; dead-listing crackers (and perhaps to cause some headaches for Sice users as well).<br />; Conclusion: Alot of things to draw the cracker's attention to other useless<br />; pieces of the code. Also the ability to hide the real psw checking routine so the<br />; cracker wont see anything suspicious when browsing through the program using softice.<br />;<br />; I wont comment much of the code, and it might be a bit hard to follow everything<br />; but the program works as I described above and that is - if you ask me - the really<br />; interesting thing to know.<br />;<br />;<br />;<br />; Oh yeah! Perhaps you'd be interested to know that the password I choosed was<br />; &quot;Cracking4U&quot;. Alot of other passwords will pass as well though, and I doubht<br />; that it's even possible to find the password I had in mind.<br />;-----------------------------------------------------------------------------------<br /></div> <br /><br />Now I don't need the program to be this complicated, but well I still would like to know how it works...<br /><br />Sliver</div>
    <div class="meta">Posted on 2002-01-24 22:34:22 by Sliver</div>
   </div>
   <div class="post" id="post-21029">
    <div class="subject"><a href="#post-21029">Encrytion Method Testing</a></div>
    <div class="body">Silver,<br />That Hall of Fame site's: <a target="_blank" href="http://crackmes.host.sk/halloffame.htm">http://crackmes.host.sk/halloffame.htm</a> <br />is pretty neat-----Thanks, B</div>
    <div class="meta">Posted on 2002-01-25 00:20:35 by BradB</div>
   </div>
   <div class="post" id="post-21039">
    <div class="subject"><a href="#post-21039">crueme</a></div>
    <div class="body"><div class="quote">RealRoutine		 db 052h,06ah,00eh,06ah,00dh,068h,0eah,003h,000h,000h,0ffh,075h,008h,0b0h,025h<br />				 db 0ffh,015h,064h,023h,040h,000h,0e8h,035h,009h,000h,000h,050h,0bfh,001h,000h<br />				 db 000h,000h,0e8h,0fdh,008h,000h,000h</div><br /><br />I guese this is an encrypted routine that is decrypted when needed wich makes things a lot harder</div>
    <div class="meta">Posted on 2002-01-25 02:27:42 by Quantum</div>
   </div>
   <div class="post" id="post-21047">
    <div class="subject"><a href="#post-21047">Encrytion Method Testing</a></div>
    <div class="body">sorry if i misunderstood something (iv didn't had the<br />time to read every post in thiis thread) but, you CAN<br />modify you code very easy... becuase of read-write<br />permissions you have to set a few linker options to<br />prevent windows from making gpf's... in my opinion<br />it was like:<br /><br />ml /c /coff %1.asm &lt;-compile as usual<br />Link /SUBSYSTEM:WINDOWS /SECTION:.text,CERW %1.obj<br /><br />.text (code section):<br />C - contains Code<br />E - code is Executable<br />R - you've got Read access<br />W - Write access<br /><br />you only need RW but then... who cares :)<br /><br />a simple xor encryption  does it as follows... <br />the first generation  is encrypted with xor - 0, that<br />means nothing happens coz the encryption key is zero...<br />if someone runs this thing, the  will add a value to<br />it's xor-key, say 10... then it copys itself into a buffer and<br />encrypts itself with xor-10... next thing to do is generating<br />a decryptiong routine (xor-10, too) in front of the <br />encrypted ... this whole mess is transfered into other<br />executables... and every time a new file will be infected the<br />xor-key will be changed again... this method can be used<br />for security-solutions, too... but like i stated above... this<br />method is very simple... so i could be cracked very fast...<br />you could add polymophism, metamorphism, more encr-<br />layers... whatever you need...<br /><br /><span style="font-size:9px>edit by f0dder to replace a bad word ;)</span></div>
    <div class="meta">Posted on 2002-01-25 04:19:46 by mob</div>
   </div>
   <div class="post" id="post-21048">
    <div class="subject"><a href="#post-21048">Encrytion Method Testing</a></div>
    <div class="body"><div class="quote"><br />this method can be used  for security-solutions, too... but like i stated above... this method is very simple... so i could be cracked very fast... <br /></div><br /><br />This is exactly what I want to learn... Do you know of any applications that use some form of simple xor encryption so I can learn from it?<br /><br />The code doesn't have to be portable so I shouldn't have to determine the offsets for anything except the portion of the code that is to be xor encrypted...<br /><br />I just don't want to have to use a virus to learn how it does it... Too risky... I just want to find out how to write the technique it uses...<br /><br />Sliver</div>
    <div class="meta">Posted on 2002-01-25 04:32:16 by Sliver</div>
   </div>
   <div class="post" id="post-21055">
    <div class="subject"><a href="#post-21055">Encrytion Method Testing</a></div>
    <div class="body">Sliver, a way to do it... in your executables, insert a special tag dword<br />before a block of code you want encrypted. Or perhaps 8 bytes -<br />enough that this sequence will not appear randomly in your file.<br />Place the length of the block after the tag (can be calculated with<br />some labels and simple OFFSET stuff).<br /><br />Then, write a little tool that scans your executable for these tags,<br />and does the encryption.<br />At runtime, you need to decrypt the code blocks before executing.<br /><br />You could also do a google search for &quot;pe crypter source&quot;, it ought<br />to come up with something... at least there's more than a few PE<br />crypters with released source.</div>
    <div class="meta">Posted on 2002-01-25 05:58:30 by f0dder</div>
   </div>
   <div class="post" id="post-21057">
    <div class="subject"><a href="#post-21057">Encrytion Method Testing</a></div>
    <div class="body">ok, time for pseudo-code :)<br /><br /><pre><code><br />EP&#58;                                                      ; ENTRY-POINT<br />        CALL            DELTA           <br />DELTA&#58;  POP             EBP<br />        SUB             EBP, DELTA                       ; EBP = DELTA OFFSET<br /><br />XOR_KEY&#58;MOV             DH,0                             ; WILL BE PATCHED LATER!<br />        LEA             ESI, &#91; EBP + E_START &#93;           <br />        PUSH            ESI                              ; LIL' TRICK TO RETURN...<br />        MOV             ECX, E_END - E_START             ; TO E_START AFTER...<br />                                                         ; DECRYPTION<br /><br />;________________ _ _ _ &#91;      -ENCRYPT-       &#93; _ _ _ __ <br />ENCRYPT&#58;XOR             BYTE PTR &#91; ESI &#93;, DH             ; ESI = OFFSET<br />        ROL             DH, 1                            ; DH  = XOR KEY<br />        INC             ESI                              ; ECX = SIZE<br />        DEC             ECX<br />        JNZ             ENCRYPT<br />        RET<br /><br />E_START&#58;<br />        ;// HERE STARTS YOUR REAL ENCRYPTED CODE<br />        <br />        ;// OK, A &#91;badword&#93; WOULD DO THE FOLLOWING<br />        <br />        ;// 0&#41; CHANGE XOR-KEY<br /><br />        ADD             BYTE PTR &#91; EBP + XOR_KEY + 1 &#93;, 10<br /><br />        ;// 1&#41; CREATE A BUFFER<br /><br />        ;// 2&#41; COPY EVERYTHING FROM &quot;EP&quot; - &quot;E_END&quot;<br />        ;//    INTO IT, THAT MEANS THE WHOLE PROG!<br />        <br />        ;// 3&#41; ENCRYPT THE BUFFER WITH THE NEW XOR-KEY<br />        <br />        MOV             DH, BYTE PTR &#91; EBP + XOR_KEY + 1 &#93;<br /><br />        LEA             ESI, BufferPointer<br />        MOV             ECX, E_END - E_START<br />        CALL            ENCRYPT ; yup, this routine above &#58;&#41;                          <br /><br />        ;// 4&#41; WRITE THE ENTIRE BUFFER CONTENT INTO SOME<br />        ;//    SOME OTHER FILES...<br /><br /><br />        ;// 5&#41; EXIT...<br /><br /><br />VARIABLES&#58;<br />        BLA     DD 0<br />        BLUB    DD 1<br /><br />E_END&#58;<br /></code></pre><br /><br />ok, note that if you use this way YOU MUST RECALCULATE<br />your offsets... you can't use regular api's, too... write me<br />if you want some routines to use api's anyhow...<br /><br />btw... to hiro, hutch and all the others... plaese note that<br />this i definitively not v1rus related... it's just a simple SMC<br />xor encryption... <br /><br /><span style="font-size:9px>edit by f0dder - bad words replaced</span></div>
    <div class="meta">Posted on 2002-01-25 06:26:31 by mob</div>
   </div>
   <div class="post" id="post-21059">
    <div class="subject"><a href="#post-21059">Encrytion Method Testing</a></div>
    <div class="body">mob, SMC is all peachy and stuff, but please don't use &quot;that word<br />you know&quot;, as the pages on this messageboard might get indexed<br />by search engines and turn up when not wanted.</div>
    <div class="meta">Posted on 2002-01-25 06:44:16 by f0dder</div>
   </div>
   <div class="post" id="post-21060">
    <div class="subject"><a href="#post-21060">Encrytion Method Testing</a></div>
    <div class="body">:) ok thank you...</div>
    <div class="meta">Posted on 2002-01-25 06:47:03 by mob</div>
   </div>
   <div class="post" id="post-21155">
    <div class="subject"><a href="#post-21155">Encrytion Method Testing</a></div>
    <div class="body"><div class="quote"><br />you can't use regular api's, too... write me<br />if you want some routines to use api's anyhow...</div><br /><br />Jumping in the thread, since I'm interested into this kind of stuff too.<br /><br />For hiding purposes, I don't want to statically link with any DLL. Currently I *must* link though with LoadLibrary, and (although I could avoid it if I wanted) also GetProcAddress.<br />Then I LoadLibrary() e.g. KERNEL32.DLL and USER32.DLL, and GetProcAddress the functions that I need. This way they won't show up in my PE (this is only half of the story though, since there are debuggers out there too).<br /><br />Anyway, the reason why I'm writing is that from what you wrote it may seem that you know e.g. how to get LoadLibrary's address without importing it in your PE.. is it right? If so, how do you do it?<br /><br />Moreover, perhaps I've already asked it in this forum (but got no answer anyway).. if I LoadLibrary KERNEL32.DLL (or others), do I have to use FreeLibrary to not leave memory leaks? Or when my program calls ExitProcess the OS will automagically Free all the libraries that I've opened through LoadLibrary?<br /><br />The SDK didn't really clear my doubts.. I wouldn't like to leave memory leaks around, but still I don't want to call FreeLibrary if it's redundant, because I'm also gonna write 4KB intros, and space is precious..<br /><br />Greets,<br />Maverick</div>
    <div class="meta">Posted on 2002-01-25 16:06:58 by Maverick</div>
   </div>
   <div class="post" id="post-21162">
    <div class="subject"><a href="#post-21162">Encrytion Method Testing</a></div>
    <div class="body">When you call ExitProcess all libraries are freed.<br />Well if you using LoadLibrary and GetProcAddress to get your functions, thse functions are in the Kernel32 so to call them you would have to have kernel32 imported allready. Well actually there is a way of getting Kernel32 without linking but I think this can only be used by viruses because it relies on kernel32 allready being n the address space of the program so I don't think I'll mention it.</div>
    <div class="meta">Posted on 2002-01-25 16:51:29 by Quantum</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=3158&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=3158&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="3158" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=3158&amp;page=2">&gt;</a><a href="../?id=3158&amp;page=3">&raquo;</a></form>  </div>
 </body>
</html>