<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Beta Testing ML(Math Language). ML takes math and converts i - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=15167" />
  <link rel="prev" href="../?id=15167&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=22">Recruitment</a> &raquo; <a href="../?id=15167">Beta Testing ML(Math Language). ML takes math and converts i</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=15167&amp;page=1" style="">&laquo;</a><a href="../?id=15167&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="15167" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-118464">
    <div class="subject"><a href="#post-118464">New Version</a></div>
    <div class="body">Hi, new version. Uses MOVS to convert now, cause I found it better then the old one.<br />It now includes error support. And I've removed that old error you spotted Victor.<br />It uses macros depending on the math.(Just like you said:grin:)<br />Note that there is only macros for Addition and Subtraction.<br />Should I make it for Division and Multiplying?<br />Suggestions very much appreciated.<br /><br />Julian</div>
    <div class="meta">Posted on 2003-09-17 12:45:35 by JulianS</div>
   </div>
   <div class="post" id="post-118465">
    <div class="subject"><a href="#post-118465">Exe!</a></div>
    <div class="body">Here is the exe.</div>
    <div class="meta">Posted on 2003-09-17 12:46:16 by JulianS</div>
   </div>
   <div class="post" id="post-118525">
    <div class="subject"><a href="#post-118525">Beta Testing ML(Math Language). ML takes math and converts i</a></div>
    <div class="body">Hey Julian,<br /><br />Did you really read through my comments? There are somethings that I have mentioned that are still not changed. Also you really should try compiling the generated output to get an idea of what is wrong.</div>
    <div class="meta">Posted on 2003-09-18 02:23:04 by roticv</div>
   </div>
   <div class="post" id="post-118560">
    <div class="subject"><a href="#post-118560">Is Macro a good choice or is there a better choice? Suggesti</a></div>
    <div class="body">Look, I've read it all but I want to try it out to see if it is working good.<br /><br />About testing:<br /><br />I will release a new version tommorow or the day after and then I've tested the code but I may still post a question like:<br /><br />***<br /><br />Why does that opcode error happen when I use....<br /><br />***<br /><br />Just to let you know.<br /><br />Anyway before I begin making macros for everything, I need to know is there a better/quicker/alike methode that I may want to use?<br /><br />Also:<br />I plan making Macros for something like: Cos, Sin, Sgn and Abs....<br /><br />I please tell me any suggestions conserning the macro function/methode.<br /><br />Any ideas wanted.<br /><br />Julian</div>
    <div class="meta">Posted on 2003-09-18 07:41:29 by JulianS</div>
   </div>
   <div class="post" id="post-118562">
    <div class="subject"><a href="#post-118562">Beta Testing ML(Math Language). ML takes math and converts i</a></div>
    <div class="body">Sorry for my harsh words, was tired. For Cos and Sin you need to make use of fpu. So you need to learn that if you want to add functionalities to them. (Not too sure about abs though). I got a cool snipplet for you for sgn:<br /><pre><code><br />sng&#40;x&#41; ; returns sign in -1, 0 or 1<br />;eax = input<br />;edx = output<br />cdq<br />cmp edx,eax<br />adc edx,0<br /></code></pre><br />I have no idea about any faster way.</div>
    <div class="meta">Posted on 2003-09-18 07:47:58 by roticv</div>
   </div>
   <div class="post" id="post-118563">
    <div class="subject"><a href="#post-118563">Any suggestions for making macros? How can I use macros?</a></div>
    <div class="body">Okay. But what shall I use macros for? &quot;+&quot;  &quot;*&quot;  &quot;-&quot;   &quot;/&quot;  &quot;Cos&quot;  &quot;Sin&quot;? <br />And one more thing? How do I use a macro when I have made one?<br />Please be accurate.<br /><br />Julian</div>
    <div class="meta">Posted on 2003-09-18 07:53:19 by JulianS</div>
   </div>
   <div class="post" id="post-118569">
    <div class="subject"><a href="#post-118569">Beta Testing ML(Math Language). ML takes math and converts i</a></div>
    <div class="body">Marcos are just aids to help you code lesser. However for me I do not really use them much, except for once in a while.<br /><br />Let me make a suggestion to you<br /><br />For code like<br /><pre><code><br />A = sgn&#40;B&#41;<br /></code></pre><br />You can try generating code like<br /><pre><code><br />mov eax, A<br />cdq<br />cmp edx, eax<br />adc edx, 0<br />mov B, edx<br /></code></pre><br />Like I did mention eariler that cos and sin needs fpu, so the return value would be on the fpu stack. Personally I do not like mixing fpu codes with normal &quot;integer&quot; codes. Just my personal opinions.</div>
    <div class="meta">Posted on 2003-09-18 08:23:40 by roticv</div>
   </div>
   <div class="post" id="post-118584">
    <div class="subject"><a href="#post-118584">Shall I make as many macros as nessecary? And please give me</a></div>
    <div class="body">So you think I shall make as many macros as nessecary?<br />I mean I could, I could even do like in my old release where the macros is only added if the there is use for them.<br /><br />Is that a good idea? Or shall I just make it so they are added no matter what? Or just a function that you can put on and they are added no matter what?<br /><br />:confused:<br /><br /><br />Could you also give me macros to multiply and to divide?<br /><br /><br />Thanks alot.</div>
    <div class="meta">Posted on 2003-09-18 11:32:40 by JulianS</div>
   </div>
   <div class="post" id="post-118594">
    <div class="subject"><a href="#post-118594">Release! Working Version!</a></div>
    <div class="body">No need for any macros anymore. I've made them myself.<br /><br />Features:<br /><br />###<br /><br />Variable creation for: 1, 2, 4, 6, 8, 10 bytes.<br />Math support for: Addition, Subtracting, Multiplying &amp; Division.<br />Support for error submiting(If an error appears then It will save the data to the clipboard and suggest that you post the data in this forum).<br />Refference Included.<br /><br />###<br /><br />Is there any place I should put this program so that people would notice it without getting the source code(Private;)), anyway it is gonna be freeware.<br /><br />Though the program may still have some mistakes, even though I tested it and found none.<br /><br />Help is as aways appreciated.<br /><br />Thanks alot for helping me (specially to you Victor;))<br /><br /><br /><strong>Julian</strong></div>
    <div class="meta">Posted on 2003-09-18 13:13:24 by JulianS</div>
   </div>
   <div class="post" id="post-118595">
    <div class="subject"><a href="#post-118595">Release! Working Version!</a></div>
    <div class="body">No need for any macros anymore. I've made them myself.<br /><br />Features:<br /><br />###<br /><br />Variable creation for: 1, 2 , 4, 6, 8, 10 bytes..<br />Math support for: Addition, Subtracting, Multiplying &amp; Division.<br />Support for error submiting(If an error appears then It will save the data to the clipboard and suggest that you post the data in this forum).<br />Refference Included.<br /><br />###<br /><br />If there is any place I should put this program so that people would notice it without getting the source code(Private;)), anyway it is gonna be freeware.<br /><br />Though the program may still have some mistakes, even though I tested it and found none.<br /><br />Help is as aways appreciated.<br /><br />Thanks alot for helping me (specially to you Victor;))<br /><br /><br /><strong>Julian</strong></div>
    <div class="meta">Posted on 2003-09-18 13:15:40 by JulianS</div>
   </div>
   <div class="post" id="post-118628">
    <div class="subject"><a href="#post-118628">Beta Testing ML(Math Language). ML takes math and converts i</a></div>
    <div class="body"><pre><code><br />A as &#40;10&#41;bytes<br />B as &#40;10&#41;bytes<br /><br />A = A + B<br /></code></pre><br />Generates<br /><pre><code><br />MOVML MACRO Dest, Sour<br />PUSH    Sour<br />POP     Dest<br />ENDM<br />ADDML MACRO Dest, Sour<br />MOV     EAX, Sour<br />ADD     Dest, EAX<br />ENDM<br /><br /><br />LOCAL A &#58;TBYTE<br />LOCAL B &#58;TBYTE<br /><br />ADDML B, A<br />MOVML A, B<br /></code></pre><br />A and B cannot fit into eax. eax is a 32bit register while A and B are 80bit. <br /><pre><code><br />A = A * B<br /></code></pre><br />Generates:<br /><pre><code><br />MOVML MACRO Dest, Sour<br />PUSH    Sour<br />POP     Dest<br />ENDM<br />MULML MACRO Dest, Sour<br />MOV     EAX, Sour<br />IDIV     Dest<br />MOVML     Dest, EDX&#58;EAX<br />ENDM<br /><br /><br />MULML B, A<br />MOVML A, B<br /></code></pre><br />idiv is signed division. You should be using either imul or mul instead. Looking at somemore generated code I realised that you have mixed up division and multiplication. imul/mul is for multiplication and div/idiv is for division. Also when doing divison remember to either do <strong>cdq</strong> or <strong>xor edx, edx</strong>, since division makes use of both eax and edx.</div>
    <div class="meta">Posted on 2003-09-19 00:08:23 by roticv</div>
   </div>
   <div class="post" id="post-118652">
    <div class="subject"><a href="#post-118652">Macros, Macros and Macros!!!</a></div>
    <div class="body">You mentioned that the macros where wrong.<br />I mean that's cause of the byte size, right?<br />Then how would you do it? Maybe using &quot;.If&quot; or somehow just manage the byte sizes?<br />Please show me how the macros should be made for: ADDML, SUBML, MULML, DIVML and MOVML(Only if it is not correct made already).<br /><br />Thank you.;) <br /><br />Julian</div>
    <div class="meta">Posted on 2003-09-19 06:52:25 by JulianS</div>
   </div>
   <div class="post" id="post-118655">
    <div class="subject"><a href="#post-118655">Beta Testing ML(Math Language). ML takes math and converts i</a></div>
    <div class="body">Generally in my life of programming (which was pretty short), I did not really mix data of different size. Let me give you a scenario, You have 2 variables, A and B. A is 4bytes while B is 2 bytes. <strong>B = B + A </strong>is stupid because the upper values of A would be lost. However of course A = B + A makes more sense.<br /><br />Also I see no point in mixing different data type. For example making using of 16bit register/memory takes up one more byte (for the prefix 66h). You are just making your life hard for yourselves. Regarding data type bigger than 32bit, so far I have yet to see anyone use FWORD. QWORD could be used for mmx, and fpu, but other than that I think it would be difficult to use. TBYTE is definitely used for fpu (eg REAL10). hmm what's the data type for xmm? I can't really recall...</div>
    <div class="meta">Posted on 2003-09-19 07:22:47 by roticv</div>
   </div>
   <div class="post" id="post-118656">
    <div class="subject"><a href="#post-118656">ALL ABOUT *MACROS* AND *ML*? NEW VERSION!</a></div>
    <div class="body">Hi, I have corrected that error you've spotted Victor about the macros:)<br /> <br />So you are actually think I should remove the other data types? I mean only allow DWORD?<br />Anyway you never answered my question about how to make the macros.<br />I still belive that there migth be some mistakes in the macros. Here they are:<br /><br />***<br /><br />MOVML MACRO Dest, Sour<br />PUSH    Sour<br />POP     Dest<br />ENDM<br /><br />ADDML MACRO Dest, Sour<br />MOV     EAX, Sour<br />ADD     Dest, EAX<br />ENDM<br /><br />SUBML MACRO Dest, Sour<br />MOV     EAX, Sour<br />SUB     Dest, EAX<br />ENDM<br /><br />MULML MACRO Dest, Sour<br />MOV     EAX, Sour<br />IMUL     Dest&quot; <br />MOVML Dest, EDX:EAX <br />ENDM<br /><br />DIVML MACRO Dest, Sour<br />MOV     EAX, Sour<br />IDIV     Dest&quot; <br />MOVML Dest, EDX:EAX <br />ENDM<br /><br />***<br /><br />Are they okay or what?<br />And can you tell me where I can upload the program but not the source?<br /><br />Maybe people will use my program for a macro tutorial instead of using it to do easy math. just kidding:grin:<br /><br /><br />I REALLY want some suggetions to ML.<br /><br />Julian</div>
    <div class="meta">Posted on 2003-09-19 07:46:57 by JulianS</div>
   </div>
   <div class="post" id="post-118657">
    <div class="subject"><a href="#post-118657">ALL ABOUT *MACROS* AND *ML*? NEW VERSION!</a></div>
    <div class="body">Hi, I have corrected that error you've spotted Victor about the macros:)<br /> <br />So you are actually think I should remove the other data types? I mean only allow DWORD?<br />Anyway you never answered my question about how to make the macros.<br />I still belive that there migth be some mistakes in the macros. Here they are:<br /><br />***<br /><br />MOVML MACRO Dest, Sour<br />PUSH    Sour<br />POP     Dest<br />ENDM<br /><br />ADDML MACRO Dest, Sour<br />MOV     EAX, Sour<br />ADD     Dest, EAX<br />ENDM<br /><br />SUBML MACRO Dest, Sour<br />MOV     EAX, Sour<br />SUB     Dest, EAX<br />ENDM<br /><br />MULML MACRO Dest, Sour<br />MOV     EAX, Sour<br />IMUL     Dest&quot; <br />MOVML Dest, EDX:EAX <br />ENDM<br /><br />DIVML MACRO Dest, Sour<br />MOV     EAX, Sour<br />IDIV     Dest&quot; <br />MOVML Dest, EDX:EAX <br />ENDM<br /><br />***<br /><br />Are they okay or what?<br />And can you tell me where I can upload the program but not the source?<br /><br />Maybe people will use my program for a macro tutorial instead of using it to do easy math. just kidding:grin:<br /><br /><br />I REALLY want some suggetions to ML.<br /><br />Julian</div>
    <div class="meta">Posted on 2003-09-19 07:57:21 by JulianS</div>
   </div>
   <div class="post" id="post-118673">
    <div class="subject"><a href="#post-118673">Error. In IsInTriangle proc. Is this my fault or MLs?</a></div>
    <div class="body">Hi, Look I've tried to make a function that tests if a point is within a triangle. Some of you may know about this.<br />Anyway here the code I used(Complete):<br /><br />***<br /><br />; #########################################################################<br />;<br />;          Build this DLL from the batch file called BldDLL.bat<br />;<br />; #########################################################################<br /><br />    .386<br />    .model flat, stdcall<br />    option casemap :none   ; case sensitive<br /><br />; #########################################################################<br /><br />    include \masm32\include\windows.inc<br />    include \masm32\include\user32.inc<br />    include \masm32\include\kernel32.inc<br /><br />    includelib \masm32\lib\user32.lib<br />    includelib \masm32\lib\kernel32.lib<br /><br />; #########################################################################<br /><br />    szText MACRO Name, Text:VARARG<br />      LOCAL lbl<br />        jmp lbl<br />          Name db Text,0<br />        lbl:<br />      ENDM<br /><br />    m2m MACRO M1, M2<br />      push M2<br />      pop  M1<br />    ENDM<br /><br />    return MACRO arg<br />      mov eax, arg<br />      ret<br />    ENDM<br /><br />.data<br /><br />;Defines the Pos2D Structure. The Pos2D Structure holdes a X and an Y Position, that makes a 2D cordinate<br />Pos2D STRUCT<br />	XPos	DWORD	?<br />	YPos	DWORD	?<br />Pos2D ENDS<br /><br />;Defines the Pos3D Structure. The Pos3D Structure holdes a X, Y and a Z Position, that makes a 3D cordinate<br />Pos3D STRUCT<br />	XPos	DWORD	?<br />	YPos	DWORD	?<br />	ZPos	DWORD	?<br />Pos3D ENDS<br /><br />;Defines the Triangle Structure. The Triangle Structure holdes 3 3D cordinates: FirstPosition, SecondPosition and ThirdPosition. The 3 3D Cordinates makes up a triangle<br />Triangle STRUCT<br />	FirstPosition	Pos3D 	&lt;&gt;<br />	SecondPosition	Pos3D 	&lt;&gt;<br />	ThirdPosition	Pos3D 	&lt;&gt;<br />Triangle ENDS<br /><br />;Defines the Camera Structure. The Camera Structure holdes 3D Cordinates and angles: AngleRightLeft and AngleUpDown. The 3D Cordinates makes up the camera position and the angles makes up the viewpoint<br />Camera STRUCT<br />	Position 	Pos3D 	&lt;&gt;<br />	AngleRightLeft	DWORD	&lt;&gt;<br />	AngleUpDown	DWORD	&lt;&gt;<br />Camera ENDS<br /><br />.data?<br />p2d Pos2D &lt;?&gt;<br /><br />.code<br /><br /><br /><br />MOVML MACRO Dest, Sour<br />PUSH    Sour<br />POP     Dest<br />ENDM<br /><br />ADDML MACRO Dest, Sour<br />MOV     EAX, Sour<br />ADD     Dest, EAX<br />ENDM<br /><br />SUBML MACRO Dest, Sour<br />MOV     EAX, Sour<br />SUB     Dest, EAX<br />ENDM<br /><br />MULML MACRO Dest, Sour<br />MOV     EAX, Sour<br />IMUL     Dest<br />MOVML     Dest, EDX:EAX<br />ENDM<br /><br />; ##########################################################################<br /><br />LibMain proc hInstDLL:DWORD, reason:DWORD, unused:DWORD<br /><br />            szText LmTitle,&quot;tstdll's LibMain Function&quot;<br /><br />        .if reason == DLL_PROCESS_ATTACH<br />;            szText ATTACHPROCESS,&quot;PROCESS_ATTACH&quot;<br />;            invoke MessageBox,NULL,ADDR ATTACHPROCESS,addr LmTitle,MB_OK<br /><br />            return TRUE<br />            ; -----------------------------<br />            ; If error at startup, return 0<br />            ; System will abort loading DLL<br />            ; -----------------------------<br /><br />        .elseif reason == DLL_PROCESS_DETACH<br />;            szText DETACHPROCESS,&quot;PROCESS_DETACH&quot;<br />;            invoke MessageBox,NULL,addr DETACHPROCESS,addr LmTitle,MB_OK<br /><br />        .elseif reason == DLL_THREAD_ATTACH<br />;            szText ATTACHTHREAD,&quot;THREAD_ATTACH&quot;<br />;            invoke MessageBox,NULL,addr ATTACHTHREAD,addr LmTitle,MB_OK<br /><br />        .elseif reason == DLL_THREAD_DETACH<br />;            szText DETACHTHREAD,&quot;THREAD_DETACH&quot;<br />;            invoke MessageBox,NULL,addr DETACHTHREAD,addr LmTitle,MB_OK<br />            <br />        .endif<br /><br />        ret<br /><br />LibMain Endp<br /><br />; ##########################################################################<br /><br />MakePos2D proc X:DWORD, Y:DWORD<br /><br />mov eax,OFFSET p2d<br />mov edx,X<br />mov .Pos2D.XPos, edx<br />mov edx,Y<br />mov .Pos2D.YPos, edx<br /><br />ret ; return the value in eax<br /><br />MakePos2D endp<br /><br />IsInTriangle proc PointX:DWORD, PointY:DWORD, TAX:DWORD, TAY:DWORD, TBX:DWORD, TBY:DWORD, TCX:DWORD, TCY:DWORD<br /><br />LOCAL bc  :DWORD<br />LOCAL ca  :DWORD<br />LOCAL ab  :DWORD<br />LOCAL ap  :DWORD<br />LOCAL bpr  :DWORD<br />LOCAL cp  :DWORD<br />LOCAL abc :DWORD<br /><br />MULML cy, bx<br />MOVML edx, cy<br /><br />MULML cx, by<br />MOVML ebx, cx<br /><br />SUBML ebx, edx<br />MOVML bc, ebx<br /><br /><br /><br />MULML ay, cx<br />MOVML edx, ay<br /><br />MULML ax, cy<br />MOVML ebx, ax<br /><br />SUBML ebx, edx<br />MOVML ca, ebx<br /><br /><br /><br />MULML by, ax<br />MOVML edx, by<br /><br />MULML bx, ay<br />MOVML ebx, bx<br /><br />SUBML ebx, edx<br />MOVML ab, ebx<br /><br /><br />MULML py, ax<br />MOVML edx, py<br /><br />MULML px, ay<br />MOVML ebx, px<br /><br />SUBML ebx, edx<br />MOVML ap, ebx<br /><br /><br />MULML py, bx<br />MOVML edx, py<br /><br />MULML px, by<br />MOVML ebx, px<br /><br />SUBML ebx, edx<br />MOVML bpr, ebx<br /><br /><br />MULML py, cx<br />MOVML edx, py<br /><br />MULML px, cy<br />MOVML ebx, px<br /><br />SUBML ebx, edx<br />MOVML cp, ebx<br /><br /><br />ADDML ca, bc<br />ADDML ab, ca<br />MOVML abc, ab<br /><br />;sng(x) ; returns sign in -1, 0 or 1<br />;eax = input<br />;edx = output<br />CDQ<br />CMP eax, edx<br />ADC eax, 0<br /><br />ret<br /><br />IsInTriangle endp<br /><br />TestProc proc bar:DWORD, ra:DWORD<br /><br />    mov eax, bar    ; start with eax, since the function return is there<br /><br />    dec eax         ; increment<br />    <br />    mov ra, eax<br /><br />    dec ra<br />    <br />    ret             ; return the value in eax<br />    <br />    ASSUME eax:nothing<br /><br />TestProc endp<br /><br />; ##########################################################################<br /><br />End LibMain<br /><br />***<br /><br />The code contains an example of a proc and then the IsInTriangle proc.<br />The IsInTriangle proc is the hole reason why I did this.<br /><br />If you try to compile you will get alot of errors. Most of the is saying: &quot;Instruction operands must be the same size&quot;.<br />It also says that I make an invalid use of the register.<br />And it mentions some undefined symbols.<br />Is this my fault or ML's fault(It's my fault anyway).<br /><br />What's wrong?<br />I really want to get this done, cause I still have another 10 procs to make.<br />And when they are made my 3D Engine is done and I will start making my first 3D Game.(Note that I already have the codes for the engine in VB but it is all to slow. That's where assembly comes in.)</div>
    <div class="meta">Posted on 2003-09-19 10:09:02 by JulianS</div>
   </div>
   <div class="post" id="post-118842">
    <div class="subject"><a href="#post-118842">Final Version Working!</a></div>
    <div class="body">You don't really have to answer the last thread(I've found the answer) nor this one.<br />The final version includes macros that has been tested and optimized perfectly.<br />It also features a new error handling system. That means that if there is an error the program will let you know and suggest that you email me athttp://www.asmcommunity.net/board/cryptmail.php?tauntspiders=in.your.face@nomail.for.you&amp;id=6234bc812276459eb27b9c3de33dbccc.<br />:)<br />Thanks to everybody for helping me with this project and feel free to upload this zip file to an server or alike so that more people can use it.<br /><br />Julian:grin:</div>
    <div class="meta">Posted on 2003-09-21 05:10:26 by JulianS</div>
   </div>
   <div class="post" id="post-118980">
    <div class="subject"><a href="#post-118980">Beta Testing ML(Math Language). ML takes math and converts i</a></div>
    <div class="body">I've attached a file containing an HLA macro that does this same thing as a macro inside HLA (i.e., you don't have to run a separate program to get the code). Here's the comments at the beginning of the file that explain the macro's use:<br /><br /><pre><code><br />// u32expr.hla<br />//<br />// This	program	demonstrates how to	write an &quot;expression compiler&quot;<br />// using the HLA compile-time language.	 This code defines a macro<br />// &#40;u32expr&#41; that accepts an arithmetic	expression as a	parameter.<br />// This	macro compiles that	expression into	a sequence of HLA<br />// machine language	instructions that will compute the result of<br />// that	expression at run-time.<br />//<br />//	The	u32expr	macro does have	some severe	limitations.<br />// First of	all, it	only support uns32 operands.<br />// Second, it only supports	the	following arithmetic<br />// operations&#58;<br />//<br />//	+, -, *, /,	&lt;, &lt;=, &gt;, &gt;=, =, &lt;&gt;.<br />//<br />//	The	comparison operators produce zero &#40;false&#41; or<br />// one &#40;true&#41; depending	upon the result	of the &#40;unsigned&#41;<br />// comparison.<br />//<br />//	The	syntax for a call to u32expr is<br />//<br />//	u32expr&#40; register, expression &#41;<br />//<br />//	The	macro computes the result of the expression	and<br />// leaves this result sitting in the register specified<br />// as the first	operand.  This register	overwrites the<br />// values in the EAX and EDX registers &#40;though these<br />// two registers are fine as the destination for the<br />// result&#41;.<br />//<br />//	This macro also	returns	the	first &#40;register&#41; parameter<br />// as its &quot;returns&quot;	value, so you may use u32expr anywhere<br />// a 32-bit	register is	legal, e.g.,<br />//<br />//		if&#40;	u32expr&#40; eax, &#40;i*3-2&#41; &lt;	j &#41;&#41; then<br />//<br />//			&lt;&lt; do something	if &#40;i*3-2&#41; &lt; j &gt;&gt;<br />//<br />//		endif;<br />//<br />// The statement above computes	true or	false in EAX and the<br />// &quot;if&quot;	statement processes	this result	accordingly.<br /><br /></code></pre><br /><br />Here's a short code sequence that does RPN to Asm translations:<br /><br /><pre><code><br />// This program translates user RPN input into an<br />// equivalent sequence of assembly language instrs &#40;HLA fmt&#41;.<br /><br />program RPNtoASM;<br /><br />#include&#40; &quot;stdlib.hhf&quot; &#41;;<br /><br />static<br /><br />    s&#58;              string;<br />    operand&#58;        string;<br />    StartOperand&#58;   dword;<br />    <br />    <br />#macro mark;<br /><br />    mov&#40; esi, StartOperand &#41;;<br />    <br />#endmacro;<br /><br />#macro delete;<br /><br />    mov&#40; StartOperand, eax &#41;;<br />    sub&#40; eax, esi &#41;;<br />    inc&#40; esi &#41;;<br />    sub&#40; s, eax &#41;;<br />    str.delete&#40; s, eax, esi &#41;;<br />    <br />#endmacro;<br /><br />procedure length&#40; s&#58;string &#41;; returns&#40; &quot;eax&quot; &#41;; @nodisplay;<br />begin length;<br /><br />    push&#40; ebx &#41;;<br />    mov&#40; s, ebx &#41;;<br />    mov&#40; &#40;type str.strRec &#91;ebx&#93;&#41;.length, eax &#41;;<br />    pop&#40; ebx &#41;;<br />    <br />end length;<br />    <br />    <br />begin RPNtoASM;<br /><br />    stdout.put&#40; &quot;-- RPN to assembly --&quot; nl &#41;;<br />    forever<br />    <br />        stdout.put&#40; nl nl &quot;Enter RPN sequence &#40;empty line to quit&#41;&#58; &quot; &#41;;<br />        stdin.a_gets&#40;&#41;;<br />        mov&#40; eax, s &#41;;<br />        breakif&#40; length&#40; s &#41; = 0 &#41;;<br />        while&#40; length&#40; s &#41; &lt;&gt; 0 &#41; do <br />        <br />            pat.match&#40; s &#41;;<br />            <br />				// Match identifiers and numeric constants<br />				<br />                mark;<br />                pat.zeroOrMoreWS&#40;&#41;;<br />                pat.oneOrMoreCset&#40; &#123;'a'..'z', 'A'..'Z', '0'..'9', '_'&#125; &#41;;<br />                pat.a_extract&#40; operand &#41;;<br />                stdout.put&#40; &quot;   pushd&#40; &quot;, operand, &quot; &#41;;&quot; nl &#41;;<br />                strfree&#40; operand &#41;;<br />                delete;<br />                <br />              pat.alternate;<br />              <br />			  	// Handle the &quot;+&quot; operator.<br />				<br />                mark;<br />                pat.zeroOrMoreWS&#40;&#41;;<br />                pat.oneChar&#40; '+' &#41;;<br />                stdout.put<br />                &#40; <br />                    &quot;   pop&#40; eax &#41;;&quot; nl<br />                    &quot;   add&#40; eax, &#91;esp&#93; &#41;;&quot; nl<br />                &#41;;<br />                delete;<br />                <br />              pat.alternate;<br />              <br />			  	// Handle the '-' operator.<br />				<br />                mark;<br />                pat.zeroOrMoreWS&#40;&#41;;<br />                pat.oneChar&#40; '-' &#41;;<br />                stdout.put<br />                &#40; <br />                    &quot;   pop&#40; eax &#41;;&quot; nl<br />                    &quot;   pop&#40; ebx &#41;;&quot; nl<br />                    &quot;   sub&#40; eax, ebx &#41;;&quot; nl<br />                    &quot;   push&#40; ebx &#41;;&quot; nl<br />                &#41;;<br />                delete;<br />                <br />              pat.alternate;<br />              <br />			  	// Handle the '*' operator.<br />				<br />                mark;<br />                pat.zeroOrMoreWS&#40;&#41;;<br />                pat.oneChar&#40; '*' &#41;;<br />                stdout.put<br />                &#40; <br />                    &quot;   pop&#40; eax &#41;;&quot; nl<br />                    &quot;   imul&#40; eax, &#91;esp&#93; &#41;;&quot; nl<br />                &#41;;<br />                delete;<br />                <br />              pat.alternate;<br />              <br />			  	// handle the '/' operator.<br />				<br />                mark;<br />                pat.zeroOrMoreWS&#40;&#41;;<br />                pat.oneChar&#40; '/' &#41;;<br />                stdout.put<br />                &#40; <br />                    &quot;   pop&#40; ebx &#41;;&quot; nl<br />                    &quot;   pop&#40; eax &#41;;&quot; nl<br />                    &quot;   cdq&#40;&#41;; &quot; nl<br />                    &quot;   idiv&#40; ebx, edx&#58;eax &#41;;&quot; nl<br />                    &quot;   push&#40; ebx &#41;;&quot; nl<br />                &#41;;<br />                delete;<br />                <br />              pat.if_failure<br />              <br />                // If none of the above, it must be an error.<br />				<br />				stdout.put&#40; nl &quot;Illegal RPN Expression&quot; nl &#41;;<br />                mov&#40; s, ebx &#41;;<br />                mov&#40; 0, &#40;type str.strRec &#91;ebx&#93;&#41;.length &#41;;<br />                <br />            pat.endmatch;<br />        <br />        endwhile;<br />        <br />    endfor; <br /><br />end RPNtoASM;<br /></code></pre><br /><br />Cheers,<br />Randy Hyde</div>
    <div class="meta">Posted on 2003-09-22 12:06:24 by rhyde</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=15167&amp;page=1" style="">&laquo;</a><a href="../?id=15167&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="15167" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>