<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title> Accessing Cmos ports - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29458" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=113">Low Level Concepts</a> &raquo; <a href="../?id=29458"> Accessing Cmos ports</a></p>
   <div class="post" id="post-207969">
    <div class="subject"><a href="#post-207969"> Accessing Cmos ports</a></div>
    <div class="body">Hello,<br /><br />I try to learn how to access Cmos ports.<br /><br />I found a sample that use port 70h/71h to read the first 128 bytes<br />of the cmos ram.<br /><br />The information I found for the extended memory is to use<br />the port 72h/73h and is able to read 256 bytes.<br /><br />I have found a freeware reading the ports of the cmos ram.<br /><br />When I use the ports 70h/71h, the 128 bytes are the same<br />result with my project.<br /><br />My problem is when I use ports 72h/73h with my project I do not<br />have the same result of the freeware.<br /><br /><br />ReadCmos proc near<br />	mov	di, offset Buffer<br />	mov	bx, 0<br />	mov	cx, 256<br />	cld <br />next:<br />	mov	al, bl<br />	out	72h,al<br />	nop<br />	nop<br />	nop<br />	in	al,73h<br />	stosb<br />	inc	bx<br />	loop	next<br />	ret<br />endp<br /><br />The result in the Buffer is 256 &quot;FF FF FF FF...&quot;<br /><br />Do I need to do something else before using the port 72h/73h to<br />be able to read the extended cmos ram ?<br /><br />Thank&#039;s for your help.</div>
    <div class="meta">Posted on 2009-07-01 22:21:14 by vulpes87</div>
   </div>
   <div class="post" id="post-207970">
    <div class="subject"><a href="#post-207970">Re:  Accessing Cmos ports</a></div>
    <div class="body">You trying to read BIOS memory? ALL YOUR RAM IS CMOS (noone but NASA and I use TTL anymore)</div>
    <div class="meta">Posted on 2009-07-02 01:14:00 by Homer</div>
   </div>
   <div class="post" id="post-207975">
    <div class="subject"><a href="#post-207975">Re:  Accessing Cmos ports</a></div>
    <div class="body">By what means does the freeware program achieve its reading of the CMOS? For example, does it run under 32-bit Windows with device driver assistance?<br /><br />How does the freeware program compare to your method of reading the CMOS?</div>
    <div class="meta">Posted on 2009-07-02 11:36:20 by SpooK</div>
   </div>
   <div class="post" id="post-208386">
    <div class="subject"><a href="#post-208386">Re:  Accessing Cmos ports</a></div>
    <div class="body">	070 CMOS RAM/RTC, also NMI enable/disable (AT,PS/2, see RTC)<br />	071 CMOS RAM data&nbsp; (AT,PS/2)<br />you&#039;d better find a way to communicate with them, using correct signal....<br /><br />but I find the <em>BDA - BIOS Data Area - PC Memory Map</em><br />(in real-time mode)<br /><div class="quote"><br />Address Size	&nbsp;  Description<br /><br />	00:00 256dwords Interrupt vector table<br />	30:00 256bytes	Stack area used during post and bootstrap<br />	40:00	word	COM1 port address<br />	40:02	word	COM2 port address<br />	40:04	word	COM3 port address<br />	40:06	word	COM4 port address<br />	40:08	word	LPT1 port address<br />	40:0A	word	LPT2 port address<br />	40:0C	word	LPT3 port address<br />	40:0E	word	LPT4 port address (except PS/2)<br />			Extended BIOS Data Area segment (PS/2, see EBDA)<br />	40:10&nbsp; 2 bytes	Equipment list flags (see INT 11)<br /><br />		|7|6|5|4|3|2|1|0| 40:10 (value in INT 11 register AL)<br />		 | | | | | | | `- IPL diskette installed<br />		 | | | | | | `-- math coprocessor<br />		 | | | | |-+--- old PC system board RAM &lt; 256K<br />		 | | | | | `-- pointing device installed (PS/2)<br />		 | | | | `--- not used on PS/2<br />		 | | `------ initial video mode<br />		 `--------- # of diskette drives, less 1<br /><br />		|7|6|5|4|3|2|1|0| 40:11&nbsp; (value in INT 11 register AH)<br />		 | | | | | | | `- 0 if DMA installed<br />		 | | | | `------ number of serial ports<br />		 | | | `------- game adapter<br />		 | | `-------- not used, internal modem (PS/2)<br />		 `----------- number of printer ports<br /><br />	40:12	byte	PCjr: infrared keyboard link error count<br />	40:13	word	Memory size in Kbytes&nbsp; (see INT 12)<br />	40:15	byte	Reserved<br />	40:16	byte	PS/2 BIOS control flags<br />	40:17	byte	Keyboard flag byte 0 (see KB FLAGS)<br /><br />		|7|6|5|4|3|2|1|0| keyboard flag byte 0<br />		 | | | | | | | `--- right shift key depressed<br />		 | | | | | | `---- left shift key depressed<br />		 | | | | | `----- CTRL key depressed<br />		 | | | | `------ ALT key depressed<br />		 | | | `------- scroll-lock is active<br />		 | | `-------- num-lock is active<br />		 | `--------- caps-lock is active<br />		 `---------- insert is active<br /><br />	40:18	byte	Keyboard flag byte 1 (see KB FLAGS)<br /><br />		|7|6|5|4|3|2|1|0| keyboard flag byte<br />		 | | | | | | | `--- left CTRL key depressed<br />		 | | | | | | `---- left ALT key depressed<br />		 | | | | | `----- system key depressed and held<br />		 | | | | `------ suspend key has been toggled<br />		 | | | `------- scroll lock key is depressed<br />		 | | `-------- num-lock key is depressed<br />		 | `--------- caps-lock key is depressed<br />		 `---------- insert key is depressed<br /><br />	40:19	byte	Storage for alternate keypad entry<br />	40:1A	word	Offset from 40:00 to keyboard buffer head<br />	40:1C	word	Offset from 40:00 to keyboard buffer tail<br />	40:1E&nbsp; 32bytes	Keyboard buffer (circular queue buffer)<br />	40:3E	byte	Drive recalibration status<br /><br />		|7|6|5|4|3|2|1|0| drive recalibration status<br />		 | | | | | | | `-- 1=recalibrate drive 0<br />		 | | | | | | `--- 1=recalibrate drive 1<br />		 | | | | | `---- 1=recalibrate drive 2<br />		 | | | | `----- 1=recalibrate drive 3<br />		 | `---------- unused<br />		 `----------- 1=working interrupt flag<br /><br />	40:3F	byte	Diskette motor status<br /><br />		|7|6|5|4|3|2|1|0| diskette motor status<br />		 | | | | | | | `-- 1=drive 0 motor on<br />		 | | | | | | `--- 1=drive 1 motor on<br />		 | | | | | `---- 1=drive 2 motor on<br />		 | | | | `----- 1=drive 3 motor on<br />		 | `---------- unused<br />		 `----------- 1=write operation<br /><br />	40:40	byte	Motor shutoff counter (decremented by INT 8)<br />	40:41	byte	Status of last diskette operation (see INT 13,1)<br /><br />		|7|6|5|4|3|2|1|0| status of last diskette operation<br />		 | | | | | | | `--- invalid diskette command<br />		 | | | | | | `---- diskette address mark not found<br />		 | | | | | `----- sector not found<br />		 | | | | `------ diskette DMA error<br />		 | | | `------- CRC check / data error<br />		 | | `-------- diskette controller failure<br />		 | `--------- seek to track failed<br />		 `---------- diskette time-out<br /><br />	40:42&nbsp; 7 bytes	NEC diskette controller status (see FDC)<br />	40:49	byte	Current video mode&nbsp; (see VIDEO MODE)<br />	40:4A	word	Number of screen columns<br />	40:4C	word	Size of current video regen buffer in bytes<br />	40:4E	word	Offset of current video page in video regen buffer<br />	40:50&nbsp; 8 words	Cursor position of pages 1-8, high order byte=row<br />			low order byte=column; changing this data isn&#039;t<br />			reflected immediately on the display<br />	40:60	byte	Cursor ending (bottom) scan line (don&#039;t modify)<br />	40:61	byte	Cursor starting (top) scan line (don&#039;t modify)<br />	40:62	byte	Active display page number<br />	40:63	word	Base port address for active 6845 CRT controller<br />			3B4h = mono, 3D4h = color<br />	40:65	byte	6845 CRT mode control register value (port 3x8h)<br />			EGA/VGA values emulate those of the MDA/CGA<br />	40:66	byte	CGA current color palette mask setting (port 3d9h)<br />			EGA and VGA values emulate the CGA<br />	40:67	dword	CS:IP for 286 return from protected mode<br />		dword	Temp storage for SS:SP during shutdown<br />		dword	Day counter on all products after AT<br />		dword	PS/2 Pointer to reset code with memory preserved<br />		5 bytes	Cassette tape control (before AT)<br />	40:6C	dword	Daily timer counter, equal to zero at midnight;<br />			incremented by INT 8; read/set by INT 1A<br />	40:70	byte	Clock rollover flag, set when 40:6C exceeds 24hrs<br />	40:71	byte	BIOS break flag, bit 7 is set if Ctrl-Break was<br />			*ever* hit; set by INT 9<br />	40:72	word	Soft reset flag via Ctl-Alt-Del or JMP FFFF:0<br /><br />			1234h&nbsp; Bypass memory tests &amp; CRT initialization<br />			4321h&nbsp; Preserve memory<br />			5678h&nbsp; System suspend<br />			9ABCh&nbsp; Manufacturer test<br />			ABCDh&nbsp; Convertible POST loop<br />			????h&nbsp; many other values are used during POST<br /><br />	40:74	byte	Status of last hard disk operation (see INT 13,1)<br />	40:75	byte	Number of hard disks attached<br />	40:76	byte	XT fixed disk drive control byte<br />	40:77	byte	Port offset to current fixed disk adapter<br />	40:78&nbsp; 4 bytes	Time-Out value for LPT1,LPT2,LPT3(,LPT4 except PS/2)<br />	40:7C&nbsp; 4 bytes	Time-Out value for COM1,COM2,COM3,COM4<br />	40:80	word	Keyboard buffer start offset (seg=40h,BIOS 10-27-82)<br />	40:82	word	Keyboard buffer end offset (seg=40h,BIOS 10-27-82)<br />	40:84	byte	Rows on the screen (less 1, EGA+)<br />	40:85	word	Point height of character matrix (EGA+)<br />		byte	PCjr: character to be repeated if the typematic<br />			repeat key takes effect<br />	40:86	byte	PCjr: initial delay before repeat key action begins<br />	40:87	byte	PCjr: current Fn function key number<br />		byte	Video mode options (EGA+)<br /><br />		|7|6|5|4|3|2|1|0| Video mode options (EGA+)<br />		 | | | | | | | `-- 1=alphanumeric cursor emulation enabled<br />		 | | | | | | `--- 1=video subsystem attached to monochrome<br />		 | | | | | `---- reserved<br />		 | | | | `----- 1=video subsystem is inactive<br />		 | | | `------ reserved<br />		 | `--------- video RAM&nbsp; 00-64K&nbsp; 10-192K&nbsp; 01-128K&nbsp; 11-256K<br />		 `---------- video mode number passed to INT 10, function 0<br /><br />	40:88	byte	PCjr: third keyboard status byte<br />			EGA feature bit switches, emulated on VGA<br /><br />		|7|6|5|4|3|2|1|0| EGA feature bit switches (EGA+)<br />		 | | | | | | | `-- EGA SW1 config (1=off)<br />		 | | | | | | `--- EGA SW2 config (1=off)<br />		 | | | | | `---- EGA SW3 config (1=off)<br />		 | | | | `----- EGA SW4 config (1=off)<br />		 | | | `------ Input FEAT0 (ISR0 bit 5) after output on FCR0<br />		 | | `------- Input FEAT0 (ISR0 bit 6) after output on FCR0<br />		 | `-------- Input FEAT1 (ISR0 bit 5) after output on FCR1<br />		 `--------- Input FEAT1 (ISR0 bit 6) after output on FCR1<br /><br />	40:89	byte	Video display data area (MCGA and VGA)<br /><br />		|7|6|5|4|3|2|1|0| Video display data area (MCGA and VGA)<br />		 | | | | | | | `-- 1=VGA is active<br />		 | | | | | | `--- 1=gray scale is enabled<br />		 | | | | | `---- 1=using monochrome monitor<br />		 | | | | `----- 1=default palette loading is disabled<br />		 | | | `------ see table below<br />		 | | `------- reserved<br />		 | `--------&nbsp; 1=display switching enabled<br />		 `--------- alphanumeric scan lines (see table below)<br /><br />	&nbsp; &nbsp; &nbsp; Bit7&nbsp; &nbsp; Bit4	Scan Lines<br />		0	0	350 line mode<br />		0	1	400 line mode<br />		1	0	200 line mode<br />		1	1	reserved<br /><br />	40:8A	byte	Display Combination Code (DCC) table index (EGA+)<br />	40:8B	byte	Last diskette data rate selected<br /><br />		|7|6|5|4|3|2|1|0| last diskette data rate selected<br />		 | | | | `--------- reserved<br />		 | | `------------ last floppy drive step rate selected<br />		 `-------------- last floppy data rate selected<br /><br />		Data Rate 			Step Rate<br />		00&nbsp; 500K bps		00&nbsp; step rate time of 0C<br />		01&nbsp; 300K bps		01&nbsp; step rate time of 0D<br />		10&nbsp; 250K bps		10&nbsp; step rate time of 0A<br />		11&nbsp; reserved		11&nbsp; reserved<br /><br />	40:8C	byte	Hard disk status returned by controller<br />	40:8D	byte	Hard disk error returned by controller<br />	40:8E	byte	Hard disk interrupt control flag(bit 7=working int)<br />	40:8F	byte	Combination hard/floppy disk card when bit 0 set<br />	40:90&nbsp; 4 bytes	Drive 0,1,2,3 media state<br /><br />		|7|6|5|4|3|2|1|0| drive media state (4 copies)<br />		 | | | | | `------- drive/media state (see below)<br />		 | | | | `------- reserved<br />		 | | | `------- 1=media/drive established<br />		 | | `------- double stepping required<br />		 `--------- data rate:	00=500K bps&nbsp; &nbsp; 01=300K bps<br />					10=250K bps&nbsp; &nbsp; 11=reserved<br />		Bits<br />		210&nbsp; Drive Media State<br />		000&nbsp; 360Kb diskette/360Kb drive not established<br />		001&nbsp; 360Kb diskette/1.2Mb drive not established<br />		010&nbsp; 1.2Mb diskette/1.2Mb drive not established<br />		011&nbsp; 360Kb diskette/360Kb drive established<br />		100&nbsp; 360Kb diskette/1.2Mb drive established<br />		101&nbsp; 1.2Mb diskette/1.2Mb drive established<br />		110&nbsp; Reserved<br />		111&nbsp; None of the above<br /><br />	40:94	byte	Track currently seeked to on drive 0<br />	40:95	byte	Track currently seeked to on drive 1<br />	40:96	byte	Keyboard mode/type<br /><br />		|7|6|5|4|3|2|1|0| Keyboard mode/type<br />		 | | | | | | | `--- last code was the E1 hidden code<br />		 | | | | | | `---- last code was the E0 hidden code<br />		 | | | | | `----- right CTRL key depressed<br />		 | | | | `------ right ALT key depressed<br />		 | | | `------- 101/102 enhanced keyboard installed<br />		 | | `-------- force num-lock if Rd ID &amp; KBX<br />		 | `--------- last char was first ID char<br />		 `---------- read ID in process<br /><br />	40:97	byte	Keyboard LED flags<br /><br />		|7|6|5|4|3|2|1|0| Keyboard LED flags<br />		 | | | | | | | `--- scroll lock indicator<br />		 | | | | | | `---- num-lock indicator<br />		 | | | | | `----- caps-lock indicator<br />		 | | | | `------ circus system indicator<br />		 | | | `------- ACK received<br />		 | | `-------- re-send received flag<br />		 | `--------- mode indicator update<br />		 `---------- keyboard transmit error flag<br /><br />	40:98	dword	Pointer to user wait complete flag<br />	40:9C	dword	User wait Time-Out value in microseconds<br />	40:A0	byte	RTC wait function flag<br /><br />		|7|6|5|4|3|2|1|0| INT 15,86 RTC wait function flag<br />		 | | | | | | | `--- 1= wait pending<br />		 | `-------------- not used<br />		 `--------------- 1=INT 15,86 wait time elapsed<br /><br />	40:A1	byte	LANA DMA channel flags<br />	40:A2&nbsp; 2 bytes	Status of LANA 0,1<br />	40:A4	dword	Saved hard disk interrupt vector<br />	40:A8	dword	BIOS Video Save/Override Pointer Table address<br />			(see VIDEO TABLES)<br />	40:AC&nbsp; 8 bytes	Reserved<br />	40:B4	byte	Keyboard NMI control flags (convertible)<br />	40:B5	dword	Keyboard break pending flags (convertible)<br />	40:B9	byte	Port 60 single byte queue (convertible)<br />	40:BA	byte	Scan code of last key (convertible)<br />	40:BB	byte	NMI buffer head pointer (convertible)<br />	40:BC	byte	NMI buffer tail pointer (convertible)<br />	40:BD&nbsp; 16bytes	NMI scan code buffer (convertible)<br />	40:CE	word	Day counter (convertible and after)<br />	40:F0&nbsp; 16bytes	Intra-Applications Communications Area (IBM Technical<br />			Reference incorrectly locates this at 50:F0-50:FF)<br /><br /><br />	Address Size	&nbsp;  Description	 (BIOS/DOS Data Area)<br /><br />	50:00	byte	Print screen status byte<br />			 00 = PrtSc not active,<br />			 01 = PrtSc in progress<br />			 FF = error<br />	50:01&nbsp; 3 bytes	Used by BASIC<br />	50:04	byte	DOS single diskette mode flag, 0=A:, 1=B:<br />	50:05&nbsp; 10bytes	POST work area<br />	50:0F	byte	BASIC shell flag; set to 2 if current shell<br />	50:10	word	BASICs default DS value (DEF SEG)<br />	50:12	dword	Pointer to BASIC INT 1C interrupt handler<br />	50:16	dword	Pointer to BASIC INT 23 interrupt handler<br />	50:1A	dword	Pointer to BASIC INT 24 disk error handler<br />	50:20	word	DOS dynamic storage<br />	50:22&nbsp; 14bytes	DOS diskette initialization table (INT 1E)<br />	50:30	4bytes	MODE command<br />	70:00		I/O drivers from IO.SYS/IBMBIO.COM<br /><br /><br />The following map varies in size and locus<br /><br />	07C0:0		Boot code is loaded here at startup (31k mark)<br />	A000:0		EGA/VGA RAM for graphics display mode 0Dh &amp; above<br />	B000:0		MDA RAM, Hercules graphics display RAM<br />	B800:0		CGA display RAM<br />	C000:0		EGA/VGA BIOS ROM (thru C7FF)<br />	C400:0		Video adapter ROM space<br />	C600:0 256bytes PGA communication area<br />	C800:0	 16K	Hard disk adapter BIOS ROM<br />	C800:5		XT Hard disk ROM format, AH=Drive, AL=Interleave<br />	D000:0	 32K	Cluster adapter BIOS ROM<br />	D800:0		PCjr conventionalsoftware cartridge address<br />	E000:0	 64K	Expansion ROM space (hardwired on AT+)<br />		 128K	PS/2 System ROM (thru F000)<br />	F000:0		System monitor ROM<br />			PCjr: software cartridge override address<br />	F400:0		System expansion ROMs<br />	F600:0		IBM ROM BASIC (AT)<br />	F800:0		PCjr software cartridge override address<br />	FC00:0		BIOS ROM<br />	FF00:0		System ROM<br />	FFA6:E		ROM graphics character table<br />	FFFF:0		ROM bootstrap code<br />	FFFF:5 8 bytes	ROM date (not applicable for all clones)<br />	FFFF:E	byte	ROM machine id	(see MACHINE ID)<br /></div></div>
    <div class="meta">Posted on 2009-08-07 12:05:36 by asmdna</div>
   </div>
  </div>
 </body>
</html>