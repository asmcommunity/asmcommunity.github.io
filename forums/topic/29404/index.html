<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Help changing values... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29404" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=113">Low Level Concepts</a> &raquo; <a href="../?id=29404">Help changing values...</a></p>
   <div class="post" id="post-207563">
    <div class="subject"><a href="#post-207563">Help changing values...</a></div>
    <div class="body">Well... there some exports in some DLLs wich I want to change...<br />I&#039;ve made a edited copy of the export and I want to patch the export in the original DLL with the copy in my own DLL...<br />I&#039;ve tried it and I fail miserably... :(<br /><br />My code looks like this:<br /><br /><strong>.data</strong><br /><br />abc_dll <strong>db</strong> &quot;abc.dll&quot;,<strong>0</strong><br /><br />function <strong>db</strong> &quot;abc_function&quot;,<strong>0</strong><br /><br /><strong>.code</strong><br /><br />abc_function_Edited <strong>proc</strong><br /><br /><strong>mov eax,0<br />ret</strong><br /><br />abc_function_Edited <strong>endp</strong><br /><br />;----------------------------------------------------------<br /><br />Changing <strong>proc</strong><br /><strong>LOCAL</strong> OLdProt<strong>:DWORD</strong><br /><strong>LOCAL</strong> abc_f<strong>:DWORD</strong><br /><br /><strong>pushad</strong><br /><strong>pushfd</strong><br /><br /><strong>invoke</strong> GetModuleHandle, <strong>addr </strong>abc_dll<br /><strong>invoke</strong> GetProcAddress, <strong>eax</strong>, <strong>addr </strong>function<br /><strong>mov</strong> abc_f,<strong>eax</strong><br /><br /><strong>invoke </strong>VirtualProtect, <strong>addr </strong>abc_f, <strong>96</strong>, <strong>PAGE_EXECUTE_READWRITE</strong>, OldProt<br /><strong>mov </strong>abc_f,<strong>eax</strong><br /><br /><strong>cld</strong><br /><strong>mov ecx</strong>,<strong>LENGTHOF</strong> abc_f<br /><strong>mov esi</strong>,abc_function_Edited<br /><strong>mov edi</strong>,abc_f<br /><strong>rep movsb</strong><br /><br /><strong>popfd</strong><br /><strong>popad</strong><br /><br />Changing <strong>endp</strong><br /><br /><br /><br />Nothing works :sad:<br /><br />What&#039;s wrong?&nbsp; :sad:<br /><br />can anyone help me?&nbsp; :D</div>
    <div class="meta">Posted on 2009-05-10 21:06:34 by GermainR27</div>
   </div>
   <div class="post" id="post-207576">
    <div class="subject"><a href="#post-207576">Re: Help changing values...</a></div>
    <div class="body">help?&nbsp; :sad:</div>
    <div class="meta">Posted on 2009-05-11 13:10:37 by GermainR27</div>
   </div>
   <div class="post" id="post-207577">
    <div class="subject"><a href="#post-207577">Re: Help changing values...</a></div>
    <div class="body"><div class="quote"><br />Well... there some exports in some DLLs wich I want to change...<br />I&#039;ve made a edited copy of the export and I want to patch the export in the original DLL with the copy in my own DLL...<br />I&#039;ve tried it and I fail miserably... :(<br /><br />My code looks like this:<br /><br /><strong>.data</strong><br /><br />abc_dll <strong>db</strong> &quot;abc.dll&quot;,<strong>0</strong><br /><br />function <strong>db</strong> &quot;abc_function&quot;,<strong>0</strong><br /><br /><strong>.code</strong><br /><br />abc_function_Edited <strong>proc</strong><br /><br /><strong>mov eax,0<br />ret</strong><br /><br />abc_function_Edited <strong>endp</strong><br /><br />;----------------------------------------------------------<br /><br />Changing <strong>proc</strong><br /><strong>LOCAL</strong> OLdProt<strong>:DWORD</strong><br /><strong>LOCAL</strong> abc_f<strong>:DWORD</strong><br /><br /><strong>pushad</strong><br /><strong>pushfd</strong><br /><br /><strong>invoke</strong> GetModuleHandle, <strong>addr </strong>abc_dll<br /><strong>invoke</strong> GetProcAddress, <strong>eax</strong>, <strong>addr </strong>function<br /><strong>mov</strong> abc_f,<strong>eax</strong><br /><br /><strong>invoke </strong>VirtualProtect, <strong>addr </strong>abc_f, <strong>96</strong>, <strong>PAGE_EXECUTE_READWRITE</strong>, OldProt<br /><strong>mov </strong>abc_f,<strong>eax</strong>&nbsp; &lt;&lt;&lt; YOU JUST OVERWROTE THE ADDRESS WITH THE RETURN VALUE FROM VIRTUALPROTECT...<br /><br /><strong>cld</strong><br /><strong>mov ecx</strong>,<strong>LENGTHOF</strong> abc_f&nbsp; &lt;&lt; UNSURE IF THIS IS RIGHT EITHER.. ITS PROBABLY &#039;TRANSLATED&#039; AS MOV ECX, 4... <br /><strong>mov esi</strong>,abc_function_Edited<br /><strong>mov edi</strong>,abc_f&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; THIS IS NOW SCREWED BECAUSE OF THE BUG ABOVE<br /><strong>rep movsb</strong><br /><br /><strong>popfd</strong><br /><strong>popad</strong><br /><br />Changing <strong>endp</strong><br /><br /><br /><br />Nothing works :sad:<br /><br />What&#039;s wrong?&nbsp; :sad:<br /><br />can anyone help me?&nbsp; :D<br /></div><br /><br />.data<br /><br />abc_dll db &quot;abc.dll&quot;,0<br /><br />function db &quot;abc_function&quot;,0<br /><br />.code<br /><br />abc_function_Edited proc<br /><br />mov eax,0<br />ret<br /><br />abc_function_Edited endp<br /><br />abc_function_edited_size equ $ - offset abc_function_Edited<br /><br />;----------------------------------------------------------<br /><br />Changing proc<br />LOCAL OLdProt:DWORD<br />LOCAL abc_f:DWORD<br /><br />pushad<br />pushfd<br /><br />invoke GetModuleHandle, addr abc_dll<br />invoke GetProcAddress, eax, addr function<br />mov ,eax<br /><br />invoke VirtualProtect, addr abc_f, 96, PAGE_EXECUTE_READWRITE, OldProt &lt;&lt; think this is wrong too, addr OldProt and  maybe.. i hate invoke :)<br /><br />cld<br />mov ecx, abc_function_edited_size<br />mov esi, offset abc_function_Edited<br />mov edi, <br />rep movsb<br /><br />popfd<br />popad<br /><br />Changing endp<br /><br />something like that.. try debugging it, also what you&#039;re doing might infringe on some of the board rules, but i suspect a mod will step in if that is the case</div>
    <div class="meta">Posted on 2009-05-11 13:29:11 by evlncrn8</div>
   </div>
  </div>
 </body>
</html>