<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Abstracting away 64-bit. - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29455" />
  <link rel="prev" href="../?id=29455&amp;page=2" />  <link rel="next" href="../?id=29455&amp;page=4" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=29455">Abstracting away 64-bit.</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=29455&amp;page=1" style="">&laquo;</a><a href="../?id=29455&amp;page=2" style="">&lt;</a><input type="hidden" name="id" value="29455" /><input type="number" name="page" min="1" max="4" step="1" value="3" onchange="this.form.submit();" /><a href="../?id=29455&amp;page=4">&gt;</a><a href="../?id=29455&amp;page=4">&raquo;</a></form>   <div class="post" id="post-208252">
    <div class="subject"><a href="#post-208252">Re: Abstracting away 64-bit.</a></div>
    <div class="body">Well, there isn&#039;t much to see, at this point.<br />I&#039;d like to work on the CPUInfo application for a bit now, then I&#039;ll get back to the D3D engine... I still haven&#039;t ported all my code over, so I can&#039;t actually load objects from disk yet. I&#039;ll post something eventually, when there&#039;s actually something more to see than just some spinning donut :)<br /><br />I&#039;ve been busy with reinstalling my laptop, getting a new home server and some other stuff, so I haven&#039;t actually done any coding recently.</div>
    <div class="meta">Posted on 2009-07-23 07:45:39 by Scali</div>
   </div>
   <div class="post" id="post-208263">
    <div class="subject"><a href="#post-208263">Re: Abstracting away 64-bit.</a></div>
    <div class="body">I&#039;ve been writing various components for my game engine for the better part of three years now, and I&#039;m only just now getting to the point where there is stuff to see beyond some simple rotating meshes.<br />Its easy to draw stuff, but thats the SMALLEST fraction of a 3D engine! People get frustrated if I refuse to release demos every other month, and they get disappointed if I do... you can&#039;t win.<br />It&#039;s all I can do to try to ignore that and keep rattling along at my own pace, and keeping that pace consistent.<br />I&#039;m guessing you&#039;re in the same boat.<br /></div>
    <div class="meta">Posted on 2009-07-24 00:07:26 by Homer</div>
   </div>
   <div class="post" id="post-208265">
    <div class="subject"><a href="#post-208265">Re: Abstracting away 64-bit.</a></div>
    <div class="body">Well, for me it&#039;s slightly different. I&#039;ve written various 3d engines over the years, and I do have all the code for many of the things that an engine could/should do... It&#039;s just spread out over different languages and different iterations of the engine.<br />Even if I port it all into the current codebase, it&#039;d only be the same demos that I&#039;ve already shown years ago. Lots of work, and pretty pointless really.<br /><br />I do have some ideas for new functionality, but at the moment I can only implement those using Cuda. I&#039;m basically just waiting for the final release of DX11, where I have hardware acceleration of all the features, including Compute Shaders.<br /><br />Aside from that, I&#039;ve lost most of my interest in developing 3D stuff in my spare time... and I haven&#039;t had a lot of spare time anyway, lately.<br />In fact, I hadn&#039;t touched my 3D code in years. I think the original D3D9 engine hasn&#039;t been touched since 2006 or so. Then in 2007 I had some time and tried to port it to D3D10, but it proved more difficult than I thought, so I just abandoned it.<br />Now it sorta works in D3D10, but that&#039;s about it. Lots of tedious work to do, without a lot of interesting results... I&#039;m not really motivated.<br /><br />Currently I&#039;m just trying to solve some of the user-interface things that have been there for years. Things that, thanks to DXGI, will hopefully remain useful for years to come. In the past I never really gave myself enough time for it, because my main goal was to work on functionality and some specific graphics effects or algorithms, rather than making a nice, robust, userfriendly application.</div>
    <div class="meta">Posted on 2009-07-24 04:27:41 by Scali</div>
   </div>
   <div class="post" id="post-208273">
    <div class="subject"><a href="#post-208273">Re: Abstracting away 64-bit.</a></div>
    <div class="body">Ah, I did actually fix *some* of the problems with the DX9 code...<br />I found that it didn&#039;t call Reset() properly in all cases. That would explain why it couldn&#039;t recover rendering. It always did in the old engine (it also didn&#039;t resize the rendertarget when resizing the window... it does now, as it always has).<br />Still doesn&#039;t solve the problem that your fullscreen window seems to get minimized by Windows automatically as soon as another window gets focus. I&#039;m not sure how to prevent that from happening, if it&#039;s possible at all.<br />But since you can now always maximize the window again, and it resumes rendering, I don&#039;t think it&#039;s a big problem.<br /><br />I&#039;ll worry about other things first, like how to get the fullscren resolution right in D3D10 :)</div>
    <div class="meta">Posted on 2009-07-24 20:41:31 by Scali</div>
   </div>
   <div class="post" id="post-208686">
    <div class="subject"><a href="#post-208686">Re: Abstracting away 64-bit.</a></div>
    <div class="body">Semi-related to this topic...<br />The new August 2009 DirectX SDK is out, and this time it contains an official release version of DirectX 11 rather than just beta runtimes:<br />http://www.microsoft.com/downloads/details.aspx?FamilyID=b66e14b8-8505-4b17-bf80-edb2df5abad4&amp;displaylang=en<br /><br />I&#039;ll be playing with that a bit, and fix my code up to run with the final binaries. Then it should run on any Vista and Windows 7 system without special developer runtimes.</div>
    <div class="meta">Posted on 2009-09-10 04:02:13 by Scali</div>
   </div>
   <div class="post" id="post-208695">
    <div class="subject"><a href="#post-208695">Re: Abstracting away 64-bit.</a></div>
    <div class="body">Hum... the actual DX11 runtimes for Vista are still in a public beta stage. Which meant that out-of-the-box, none of the August 2009 SDK DX11 examples worked. There just weren&#039;t any DX11 runtimes installed at all (they removed the beta ones that were in the earlier SDK releases).<br />So I had to download and install this script to get access to the Platform Update for Vista, which includes the DX11 runtimes:<br />http://support.microsoft.com/kb/971644<br /><br />For some reason it didn&#039;t work on my laptop with Intel graphics (the D3D11.dll is still missing), but it did work on my desktop with an nVidia card. I&#039;ll see if I can copy the missing files over, and get it working on the laptop aswell.<br /><br />Another surprise was that nVidia has released a new GPU Computing SDK, and they support DirectCompute aswell now. So for the first time I actually got to see the DX11CS samples with hardware acceleration. And the first impression was pretty good. It seemed to be much closer to Cuda performance than some of their OpenCL stuff.<br /><br />Anyway, I fixed up my code to work with the RTM runtimes rather than all the stuff with the _beta suffix. And now I have an official D3D11-capable engine :)<br />It should now run out-of-the-box on a Windows 7 machine, since they come with DX11 preinstalled. I just couldn&#039;t use that up to now, because the SDK only contained the beta stuff, which linked to files with a _beta suffix, so you had to install the beta runtime anyway on Windows 7. I still have the Windows 7 RC installed, so I&#039;ll check if it works on there.<br /><br />Anyway, this means that at this point I will be abandoning the DX10/10.1 part of my codebase. A lot of the code should be compatible between DX10 and DX11, but I don&#039;t really see a point in using the DX10 stuff anymore. If you can run DX10, you can run DX11.<br />I&#039;ll see if I can put some new binaries up, with the full DX9/DX10/DX11 and 32/64-bit stuff... and some of the fixes/improvements I&#039;ve done on them a while ago.<br />Then I&#039;ll probably continue work on the CPUInfo lib first, because I want to get that ball rolling, and the best way is with a nice free opensource application similar to CPU-Z, I think.<br />After that, I&#039;ll return to the 3D engine, and dig out the old scene loading code, and get some more inspiring visuals on screen.</div>
    <div class="meta">Posted on 2009-09-11 02:35:07 by Scali</div>
   </div>
   <div class="post" id="post-208708">
    <div class="subject"><a href="#post-208708">Re: Abstracting away 64-bit.</a></div>
    <div class="body">I think the problem with my laptop is that it has a Dutch version of Windows Vista installed. I copied some files over from my English Vista manually, and managed to get DX11 working on my Intel X3100 onboard chip. Sadly it cannot do DirectCompute though, will require a driver update I suppose.<br /><br />I fired up my Windows 7 RC installation, and uninstalled the March 2009 DirectX SDK and runtimes, and my D3D11 code still runs.<br />So it should indeed run out-of-the-box on a Windows 7 installation now. I did need to update to the latest nVidia driver to get DirectCompute working, but it didn&#039;t require a special beta driver or some registry hacks to get it working. Just the standard 190.62 WHQL drivers.</div>
    <div class="meta">Posted on 2009-09-11 16:45:17 by Scali</div>
   </div>
   <div class="post" id="post-208792">
    <div class="subject"><a href="#post-208792">Re: Abstracting away 64-bit.</a></div>
    <div class="body">Microsoft has confirmed that the public beta is only for English versions of Windows at this point. It&#039;s a bit of an oversight that they didn&#039;t make that more clear on the website or during installation.<br />They also hope to get the platform update out of the beta stage shortly after the public release of Windows 7 (which would be the 22nd of October).<br />So within about 2 months we should have final DX11 support on Vista, just like on Windows 7.<br /><br />A small caveat is that DX11 will require SP2, just like DX10.1 required SP1. I personally am not bothered by that, I think every user should have the latest servicepack installed... but sometimes I do run into people who deliberately do not install servicepacks. This will force some developers to continue supporting DX10 and DX10.1 aswell... Together with DX9 that still has to be supported because of people still using XP... that&#039;s a total of 4 different APIs to support.</div>
    <div class="meta">Posted on 2009-09-15 06:41:48 by Scali</div>
   </div>
   <div class="post" id="post-208854">
    <div class="subject"><a href="#post-208854">Re: Abstracting away 64-bit.</a></div>
    <div class="body">Fine by me - becoming an expert at version wrapping :)</div>
    <div class="meta">Posted on 2009-09-20 03:58:33 by Homer</div>
   </div>
   <div class="post" id="post-208869">
    <div class="subject"><a href="#post-208869">Re: Abstracting away 64-bit.</a></div>
    <div class="body"><div class="quote"><br />Fine by me - becoming an expert at version wrapping :)<br /></div><br /><br />Didn&#039;t you just support DX9 though?</div>
    <div class="meta">Posted on 2009-09-21 09:43:39 by Scali</div>
   </div>
   <div class="post" id="post-208871">
    <div class="subject"><a href="#post-208871">Re: Abstracting away 64-bit.</a></div>
    <div class="body">No good here (32 bit XP, D3D9 August 2009 runtimes)<br />Theres no GPF or anything, it terminates cleanly without apparently doing anything.<br /></div>
    <div class="meta">Posted on 2009-09-21 10:26:47 by Homer</div>
   </div>
   <div class="post" id="post-208873">
    <div class="subject"><a href="#post-208873">Re: Abstracting away 64-bit.</a></div>
    <div class="body">Well, that&#039;s the thing with this approach...<br />I just try to see if my DLL loads. If it does, I import some functions that I expect to be there, which I can then call to see if a DX device of that particular version can be built (you could have DX10/11 installed, but a videocard/driver that isn&#039;t capable).<br />If the DLL doesn&#039;t load, it&#039;s a missing import... That could be either a DX library, or something completely different, eg Visual C++ redistributables, fmod, etc.<br />It&#039;s very hard to try and give some meaningful error message at that point, but on the other hand it&#039;s very easy to check if &#039;it works&#039;.<br />I could do some generic message like &quot;Okay, I tried all versions, and nothing loaded&quot;, but normally that shouldn&#039;t happen. You should at least be able to run DX9.<br />I suspect your problem is a lack of VS2008 SP1 runtimes, not DX-related.</div>
    <div class="meta">Posted on 2009-09-21 11:22:23 by Scali</div>
   </div>
   <div class="post" id="post-208922">
    <div class="subject"><a href="#post-208922">Re: Abstracting away 64-bit.</a></div>
    <div class="body">I think I could create a simple internal log...<br />I can keep track of which DLLs I try to load, and then the result.<br />There are basically three ways in which each DLL can fail:<br />1) The DLL doesn&#039;t exist.<br />2) The DLL exists, but LoadLibrary() fails anyway. Apparently there are missing libraries, I just don&#039;t know which (could be missing D3D version, or something else).<br />3) The DLL exists, and loads, but my Test()-function failed to create a valid Direct3D environment.<br /><br />If I just log these errors, I could display them if I fail to get ANY DLL opened. Perhaps have some option to display it to the user even if it does load a DLL (so that if he falls into DX9 mode, he will be able to see why DX10 or DX11 didn&#039;t work). Then it would just be silent under normal conditions.<br />But it&#039;s always going to be hard to get meaningful errors. You can test if it works or not, but there could be a million different reasons why it won&#039;t work.<br />Even if you know which particular DLL failed to load, it&#039;s often difficult to figure out where to get it (eg the Visual C++ 2008 SP1 redistribution package).</div>
    <div class="meta">Posted on 2009-09-24 06:43:27 by Scali</div>
   </div>
   <div class="post" id="post-208923">
    <div class="subject"><a href="#post-208923">Re: Abstracting away 64-bit.</a></div>
    <div class="body">You could delay-load potentially troublesome DLLs, and use SEH to handle the situation - dunno if you get the DLL name in the exception handler, though.</div>
    <div class="meta">Posted on 2009-09-24 09:21:44 by f0dder</div>
   </div>
   <div class="post" id="post-208924">
    <div class="subject"><a href="#post-208924">Re: Abstracting away 64-bit.</a></div>
    <div class="body"><div class="quote"><br />You could delay-load potentially troublesome DLLs, and use SEH to handle the situation - dunno if you get the DLL name in the exception handler, though.<br /></div><br /><br />But that&#039;s exactly the thing... It&#039;s far too much work to figure out all the &#039;potentially troublesome DLLs&#039; and using delay-load and all that.<br />The reason why I chose this loader system is because it&#039;s very simple and robust. I just code my DLL with everything on it, not having to worry about anything... Then the loader will see if it works or not, in a clean and non-fatal way. So basically I reduced the problem to delay-loading a single DLL.</div>
    <div class="meta">Posted on 2009-09-24 09:32:46 by Scali</div>
   </div>
   <div class="post" id="post-208925">
    <div class="subject"><a href="#post-208925">Re: Abstracting away 64-bit.</a></div>
    <div class="body">Potentially troublesome DLLs is pretty easy; Visual C++ runtimes, DirectX DLLs, and anything you <strong>know</strong> won&#039;t be installed on a typical end-user system because it&#039;s stuff you&#039;ve specifically downloaded :)</div>
    <div class="meta">Posted on 2009-09-24 09:47:29 by f0dder</div>
   </div>
   <div class="post" id="post-208928">
    <div class="subject"><a href="#post-208928">Re: Abstracting away 64-bit.</a></div>
    <div class="body"><div class="quote"><br />Potentially troublesome DLLs is pretty easy; Visual C++ runtimes, DirectX DLLs, and anything you <strong>know</strong> won&#039;t be installed on a typical end-user system because it&#039;s stuff you&#039;ve specifically downloaded :)<br /></div><br /><br />If it really was that simple, I would have done it.<br />Reality is that with all the different versions of Windows, and all the servicepacks and hotfixes and all that, it&#039;s impossible to tell what is going to work where.<br />I don&#039;t have a large collection of machines and OS configurations to test on. I just have my own PC, which may have multiple versions of Windows installed, but all with at least two versions of Visual Studio installed aswell, and all the latest updates.<br />It&#039;s just impossible to track down every potential point-of-failure, let alone to try and handle each problem in an elegant way. Just look at how complicated my code was for simply checking for a 32-bit or 64-bit OS. You need different versions of the same API calls, which may or may not be available in the kernel library, depending on what Service Pack you have installed and all that... And that&#039;s just ONE operation.<br /><br />Besides, figuring out which DLL or function is just one part of the problem... then you still have to map it to some meaningful information to the end-user... eg missing function() in library.dll -&gt; Install Service Pack 2 or higher. That&#039;s just impossible to do.<br />I guess the best thing to do is just to tell the user that it didn&#039;t work, and then give a standard predefined message with requirements, hoping that you caught everything.</div>
    <div class="meta">Posted on 2009-09-24 09:52:17 by Scali</div>
   </div>
   <div class="post" id="post-208929">
    <div class="subject"><a href="#post-208929">Re: Abstracting away 64-bit.</a></div>
    <div class="body">Well, if you try to take it to function-call granularity, sure, things get a bit hairy - MSDN does have information (as long as you don&#039;t care about older Windows versions), but dunno if it&#039;s always correct. But imho logging missing-DLL would be a useful diagnostic. </div>
    <div class="meta">Posted on 2009-09-24 10:02:31 by f0dder</div>
   </div>
   <div class="post" id="post-208930">
    <div class="subject"><a href="#post-208930">Re: Abstracting away 64-bit.</a></div>
    <div class="body"><div class="quote"><br />Well, if you try to take it to function-call granularity, sure, things get a bit hairy - MSDN does have information (as long as you don&#039;t care about older Windows versions), but dunno if it&#039;s always correct. But imho logging missing-DLL would be a useful diagnostic. <br /></div><br /><br />Well, if you want a &#039;perfect&#039; solution, you have to take it to function-call granularity... Because older versions of a DLL may not have a particular function. That&#039;s different from the DLL not being installed at all.<br />Logging any DLL load failures would be useful, problem is that it&#039;s sadly not that straightforward to do. I wish I could just do LoadLibrary() and then get accurate info on why it didn&#039;t work. Which DLL failed, or which function?<br />The main problem here is that it isn&#039;t recursive. I could delay-load MY DLLs, but if these DLLs themselves also import other DLLs, I don&#039;t think I can get any info on those, because those DLLs were not built as delay-load.<br />And even so, converting my code to delay-load is not just a flick of a switch, I guess. I&#039;d also need to catch all the default libs and such, which I now take for granted. And I&#039;d need to craft my own handler etc.<br /><br />If you&#039;re going down that route, it might be better to just build your own lightweight Dependency Walker-routine. Just walk all the import tables yourself, and recursively check for problems. May actually be less work... in fact, might be a useful open source project :)</div>
    <div class="meta">Posted on 2009-09-24 10:08:21 by Scali</div>
   </div>
   <div class="post" id="post-209510">
    <div class="subject"><a href="#post-209510">Re: Abstracting away 64-bit.</a></div>
    <div class="body">Random thought:<br />I suppose I could do some simple pattern matching on DLLs that can&#039;t be found or where functions are missing.<br />Eg, for &quot;msvc*.*&quot; or &quot;mfc*.*&quot; I could suggest to install the VC++ redist.<br />For &quot;d3d*.*&quot; I could suggest installing the DirectX redist.<br />Since it&#039;s open source anyway... you could create lists of DLLs that map to certain messages. You could build default lists for whatever is in certain redistributable packages, and have anyone extend/customize it for whatever they want.<br />I might look into that this weekend.</div>
    <div class="meta">Posted on 2009-11-06 08:30:52 by Scali</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=29455&amp;page=1" style="">&laquo;</a><a href="../?id=29455&amp;page=2" style="">&lt;</a><input type="hidden" name="id" value="29455" /><input type="number" name="page" min="1" max="4" step="1" value="3" onchange="this.form.submit();" /><a href="../?id=29455&amp;page=4">&gt;</a><a href="../?id=29455&amp;page=4">&raquo;</a></form>  </div>
 </body>
</html>