<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Custom Cursor ? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17394" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=17394">Custom Cursor ?</a></p>
   <div class="post" id="post-134684">
    <div class="subject"><a href="#post-134684">Custom Cursor ?</a></div>
    <div class="body">Hi guys,<br /><br />This is driving me absolutly mad !!!<br /><br />I'm trying to make a custom cursor. I simply want the usual arrow with another icon mixed with it. The arrow icon is 32x32 and the one I wish to add is 16x16. It's so when the mouse is over a node in my prog, the cursor uses the<br />extra 16x16 icon to display a number 0-9. The numbers are already icons at this point, so I just need to combine the two !!<br /><br />I could just make 10 different cursors and that would be solved, but I would like to use other icons too. Maybe a cross<br />icon next to the arrow to show a node is not connected, etc.<br /><br />I've tried GetIconInfo and drawing the mask into a DC and Blting it onto the larger icon at an offset but I lose transparency. I've tried copying the color and mask array from the 16x16 into the 32x32 icon but it gets mashed. I've tried using imagelists and using an overlay for the 16x16 and end up with the correct result but on a white background. Aaaahhhrrrrggggg !!! Heh !!<br /><br />I'm sure this is only gonna be about 50 lines of code but I'm going around in circles and I'm gonna start kicking the dog for no reason if I dont solve it soon :)<br /><br />Anyone know of any code snippits around that might help me. I've googled a few examples but they only show how to mix icons of the same size, which doesnt help much !<br /><br />Thanks alot,<br /><br />Emerson</div>
    <div class="meta">Posted on 2004-02-24 08:05:45 by Emerson</div>
   </div>
   <div class="post" id="post-134695">
    <div class="subject"><a href="#post-134695">Custom Cursor ?</a></div>
    <div class="body">Cursors are a bit more difficult because the mask and data are stored in a single image but this is my OverlayIcon routine that will overlay one color icon on top of the other. The first icon is the bottom one, posx/y is the relative offset of the overlay from 0,0<br /><br /><pre><code>OverlayIcon FRAME hIcon1,hIcon2,posx,posy<br />	LOCAL	hWinDC		&#58;D<br />	LOCAL	hmemDC		&#58;D<br />	LOCAL	iinfo		&#58;ICONINFO<br />	LOCAL	hBitmap		&#58;D<br />	LOCAL	hMask		&#58;D<br />	<br />	invoke GetDC,NULL<br />	mov &#91;hWinDC&#93;,eax<br />	invoke CreateCompatibleDC,&#91;hWinDC&#93;<br />	mov &#91;hmemDC&#93;,eax<br />	<br />	invoke CreateCompatibleBitmap,&#91;hWinDC&#93;,32,32<br />	mov &#91;hBitmap&#93;,eax<br />	invoke ReleaseDC,NULL,&#91;hWinDC&#93;<br /><br />	invoke SelectObject,&#91;hmemDC&#93;,&#91;hBitmap&#93;<br />	push eax<br />	invoke DrawIconEx,&#91;hmemDC&#93;,0,0,&#91;hIcon1&#93;,0,0,0,0,DI_NORMAL<br />	invoke DrawIconEx,&#91;hmemDC&#93;,&#91;posx&#93;,&#91;posy&#93;,&#91;hIcon2&#93;,\<br />		0,0,0,0,DI_NORMAL<br />	pop eax<br />	invoke SelectObject,&#91;hmemDC&#93;,eax<br />	invoke DeleteDC,&#91;hmemDC&#93;<br /><br />	invoke CreateMask,&#91;hBitmap&#93;,0<br />	mov &#91;hMask&#93;,eax<br /><br />	mov D&#91;iinfo.fIcon&#93;,TRUE<br />	mov D&#91;iinfo.xHotspot&#93;,0<br />	mov D&#91;iinfo.yHotspot&#93;,0<br />	mov eax,&#91;hMask&#93;<br />	mov D&#91;iinfo.hbmMask&#93;,eax<br />	mov eax,&#91;hBitmap&#93;<br />	mov D&#91;iinfo.hbmColor&#93;,eax<br />	invoke CreateIconIndirect,OFFSET iinfo<br />	push eax<br />	invoke DeleteObject,&#91;hMask&#93;<br />	invoke DeleteObject,&#91;hBitmap&#93;<br />	pop eax<br /><br />	RET<br />ENDF<br /><br />CreateMask FRAME hIcoBmp,crTransparent<br />	LOCAL bmp 		&#58;BITMAP<br />	LOCAL hdc1		&#58;D<br />	LOCAL hdc2		&#58;D<br />	LOCAL hDC		&#58;D<br />	LOCAL OldObj1		&#58;D<br />	LOCAL OldObj2		&#58;D<br />	LOCAL hMaskBmp		&#58;D<br />	LOCAL crBkgnd		&#58;D<br />	LOCAL crText		&#58;D<br /><br />	invoke GetDC,NULL<br />	mov &#91;hDC&#93;,eax<br />	invoke CreateCompatibleDC,&#91;hDC&#93;<br />	mov &#91;hdc1&#93;,eax<br />	invoke CreateCompatibleDC,&#91;hDC&#93;<br />	mov &#91;hdc2&#93;,eax<br />	invoke ReleaseDC,NULL,&#91;hDC&#93;<br /><br />	invoke GetObject,&#91;hIcoBmp&#93;,SIZEOF BITMAP,OFFSET bmp<br /><br />	invoke CreateBitmap,&#91;bmp.bmWidth&#93;,&#91;bmp.bmHeight&#93;,1,1,NULL<br />	mov &#91;hMaskBmp&#93;,eax<br /><br />	invoke SelectObject,&#91;hdc1&#93;,&#91;hMaskBmp&#93;<br />	mov &#91;OldObj1&#93;,eax<br />	invoke SelectObject,&#91;hdc2&#93;,&#91;hIcoBmp&#93;<br />	mov &#91;OldObj2&#93;,eax<br />	invoke SetBkColor,&#91;hdc2&#93;,&#91;crTransparent&#93;<br />	mov &#91;crBkgnd&#93;,eax<br />	invoke BitBlt,&#91;hdc1&#93;,0,0,&#91;bmp.bmWidth&#93;,&#91;bmp.bmHeight&#93;,&#91;hdc2&#93;,0,0,SRCCOPY<br />	invoke SetTextColor,&#91;hdc2&#93;,0FFFFFFh<br />	mov &#91;crText&#93;,eax<br />	invoke SetBkColor,&#91;hdc2&#93;,0<br />	invoke BitBlt,&#91;hdc2&#93;,0,0,&#91;bmp.bmWidth&#93;,&#91;bmp.bmHeight&#93;,&#91;hdc1&#93;,0,0,SRCAND<br />	invoke SetBkColor,&#91;hdc2&#93;,&#91;crBkgnd&#93;<br />	invoke SetTextColor,&#91;hdc2&#93;,&#91;crText&#93;<br /><br />	invoke SelectObject,&#91;hdc1&#93;,&#91;OldObj1&#93;<br />	invoke SelectObject,&#91;hdc2&#93;,&#91;OldObj2&#93;<br />	invoke DeleteDC,&#91;hdc1&#93;<br />	invoke DeleteDC,&#91;hdc2&#93;<br /><br />	mov eax,&#91;hMaskBmp&#93;<br />	RET<br />ENDF</code></pre></div>
    <div class="meta">Posted on 2004-02-24 09:09:33 by donkey</div>
   </div>
   <div class="post" id="post-134712">
    <div class="subject"><a href="#post-134712">Custom Cursor ?</a></div>
    <div class="body">Hey thanks Donkey, thats a good start !!<br /><br />I understand a bit more about the mask now. I tested this code with LoadCursor and IDC_ARROW as one of the icons and IDC_CROSS for the other. It maintains transparency although the result is an inverted cursor. Close but not quite, I'll keep playing :)<br /><br />I wasnt using SetTextColor or SetBkColor at all in my efforts, I didnt think they would have any effect. You learn something new everyday :alright: <br /><br />Regards,<br /><br />Emerson</div>
    <div class="meta">Posted on 2004-02-24 10:51:19 by Emerson</div>
   </div>
   <div class="post" id="post-134713">
    <div class="subject"><a href="#post-134713">Custom Cursor ?</a></div>
    <div class="body">No probs Emerson,<br /><br />I never really thought there was much interest in this kind of thing so I never posted the demo. I have uploaded it to my site. It also shows how to use a different transparency color if necessary (I generally use 0FF00FFh as my transparency I am never likely to use pink in an icon :) ). You can find it in the GoAsm projects.</div>
    <div class="meta">Posted on 2004-02-24 10:56:06 by donkey</div>
   </div>
  </div>
 </body>
</html>