<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>filling gaps - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25326" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25326">filling gaps</a></p>
   <div class="post" id="post-185238">
    <div class="subject"><a href="#post-185238">filling gaps</a></div>
    <div class="body">I have this problem when drawing rectangles; when i resize the window gaps appear between the rectangles.<br /><br />http://wolfshade.home.ro/test.asm<br /><br />assemble and slowly resize the window and you&#39;ll see the gaps<br />i&#39;m sure i saw somewhere how to fix this but don&#39;t remember where</div>
    <div class="meta">Posted on 2006-09-11 04:55:39 by w0lfshad3</div>
   </div>
   <div class="post" id="post-185250">
    <div class="subject"><a href="#post-185250">Re: filling gaps</a></div>
    <div class="body">Try something like this. <br /><pre><code>; child windows 1..4<br />	&nbsp;  mov temp2, 4<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fild&nbsp; &nbsp; cxClient<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fidiv&nbsp;  temp2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; cxClient / 4&nbsp; &nbsp; &nbsp; ;;; shorter than (1/4 * cxClient)<br />	&nbsp;  fistp temp2			; temp2 = ST(0), FPU stack balanced<br /><br />	&nbsp;  mov temp3, 7<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fild&nbsp; &nbsp; cyClient<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fidiv&nbsp;  temp3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; cyClient / 7<br />	&nbsp;  fistp temp3			; temp3 = ST(0), FPU stack balanced<br /><br />	&nbsp;  mov ecx, 4<br />	&nbsp;  push esi<br />	&nbsp;  xor esi, esi<br />	&nbsp;  push edi<br />	&nbsp;  xor edi, edi<br />	label2::<br />	&nbsp;  mov i, edi<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fild i	<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fimul temp2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fistp temp1<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, cxClient&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  eax, temp1&nbsp; &nbsp; <br /><br />	&nbsp;  push ecx<br />	&nbsp;  invoke MoveWindow, , temp1, 0, eax, temp3, TRUE<br />	&nbsp;  inc edi<br />	&nbsp;  add esi, 4<br />	&nbsp;  pop ecx<br />	&nbsp;  loop label2</code></pre><br /><br />It&#39;s essentially the same for all other child controls.<br />* I wasn&#39;t sure whether you wanted a double pixel or one pixel border.. I assumed the second.	</div>
    <div class="meta">Posted on 2006-09-11 15:19:32 by arafel</div>
   </div>
   <div class="post" id="post-185257">
    <div class="subject"><a href="#post-185257">Re: filling gaps</a></div>
    <div class="body">Thank you, care to tell me how i would fix it for 2 pixels width? Add 1 to temp1?<br /><br />I read through<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax, cxClient<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub eax, temp1<br /><br />and i would get in &quot;sub eax, temp1&quot; &quot;cxClient - i*cxClient/4&quot; wich will give me the following widths: cxClient/4, cxClient/2, 3*cxClient/4, cxClient, but i need a constant width because i will use each child window as a button or something later.<br /><br />You&#39;ll notice with your code when hitting one of those child windows what happends.</div>
    <div class="meta">Posted on 2006-09-12 01:03:26 by w0lfshad3</div>
   </div>
   <div class="post" id="post-185258">
    <div class="subject"><a href="#post-185258">Re: filling gaps</a></div>
    <div class="body"><div class="quote"><br />You&#39;ll notice with your code when hitting one of those child windows what happends.<br /></div><br /><br />Uuups. I haven&#39;t read all the sourcecode.<br /><br />Ok, second try.. <br /><br /><pre><code>; child windows 1..4<br /><br />		mov temp2, 4<br />		fld1				; 1<br />		fild temp2			; 4, 1<br />		fdivp ST(1), ST(0)	; 1/4<br />		fild cxClient		; cxClient, (1/4)<br />		fmulp ST(1), ST(0)	; cxClient * (1/4)<br />		fistp temp2			; temp2 = ST(0), FPU stack balanced<br /><br />		mov temp3, 7<br />		fld1				; 1<br />		fild temp3			; 7, 1<br />		fdivp ST(1), ST(0)	; 1/7<br />		fild cyClient		; cxClient, (1/7)<br />		fmulp ST(1), ST(0)	; cxClient * (1/7)<br />		fistp temp3			; temp3 = ST(0), FPU stack balanced<br /><br />		mov ecx, 4<br />		push esi<br />		xor esi, esi<br />		push edi<br />		xor edi, edi<br />	label2::<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; eax, temp2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  imul eax, edi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; temp1, eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  cmp&nbsp; edi, 3&nbsp; &nbsp; &nbsp;  ; in case when window&#39;s width doesn&#39;t divide equally - set last child&#39;s width manually.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jne&nbsp; @f<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; eax, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  sub&nbsp; eax, temp1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; temp2, eax<br />@@:<br />	&nbsp;  push ecx<br />	&nbsp;  invoke MoveWindow, , temp1, 0, temp2, temp3, TRUE<br />	&nbsp;  inc edi<br />	&nbsp;  add esi, 4<br />	&nbsp;  pop ecx<br />	&nbsp;  loop label2<br /><br />		mov eax, temp2<br />		mov temp4, eax		; cxClient * (1/4)</code></pre></div>
    <div class="meta">Posted on 2006-09-12 03:23:49 by arafel</div>
   </div>
   <div class="post" id="post-185261">
    <div class="subject"><a href="#post-185261">Re: filling gaps</a></div>
    <div class="body">Thank you, it works now,<br /><br />I&#39;m wondering tough, the C code i took an example of this doesn&#39;t produce gaps and it doesn&#39;t have any &quot;helping code&quot;, is it because asm rounds up the value and C truncs? or vice-versa (did not check and forgot if i ever knew).<br /><br />Care you briefly explain where to modify to get a 1 pixel width and how come 1<br />width in the row of rectangles made them all have gaps?<br /><br />http://wolfshade.home.ro/checker3.c<br /><br />*i will step later through the C assembly, perhaps i&#39;ll get an insight of why it is happening.</div>
    <div class="meta">Posted on 2006-09-12 08:06:41 by w0lfshad3</div>
   </div>
   <div class="post" id="post-185271">
    <div class="subject"><a href="#post-185271">Re: filling gaps</a></div>
    <div class="body"><div class="quote"><br />I&#39;m wondering tough, the C code i took an example of this doesn&#39;t produce gaps and it doesn&#39;t have any &quot;helping code&quot;, is it because asm rounds up the value and C truncs? or vice-versa (did not check and forgot if i ever knew).<br /></div><br />The link doesn&#39;t work.<br />So I don&#39;t know how C version differs from asm version. But the way the element&#39;s width is calculated (window_width/elements_count) in that assembly code it doesn&#39;t matter whether the value is rounded up or down.<br /><br />e.g. take for example 607px wide window , divide by four and you will see that if you: <br />round up - last element&#39;s width will be 1 pixel shorter than others. <br />round down - and last lement&#39;s width will be 3 pixel wider than others. That is, it won&#39;t fit into the window entirely. (this is what the asm version does) <br /><br />Now when you do &quot;cxClient * (i/4)&quot; the element&#39;s offset will be wrongly calculated, hence the gaps.<br /><br />For example 3rd element offset will be: 607*(2/4) = 303 (it is rounded down in your code) and 4th will be : 607*(3/4)= 455.<br />But the previously calculated element width is 151. So 151*3= 453. 1 pixel gap between 3rd and 4th element!<br /><br /><div class="quote"><br />Care you briefly explain where to modify to get a 1 pixel width and how come 1<br />width in the row of rectangles made them all have gaps?<br /></div><br />Decrement the offset of all elements except the first one, and once again fix the width of last element since it will be shorter now.<br />I am not sure I understand second part of the question. </div>
    <div class="meta">Posted on 2006-09-12 23:48:38 by arafel</div>
   </div>
   <div class="post" id="post-185272">
    <div class="subject"><a href="#post-185272">Re: filling gaps</a></div>
    <div class="body">Ok, link: wolfshade.home.ro/checker3.c or wolfshade.home.ro/checker3.zip<br />COPY&amp;PASTE it in another browser window. I get a weird error when supplying C code in these forums. Besides that i can&#39;t even acces the ftp with my firewall on.<br /><br />EDIT(wrong not sure if its accurate at all): Anyway after more calculations i observed no matter the number now the width is never less than offsets thus the child windows overlap eachother even without the helping code. What really is happening even with rectangles is that after the rectangle is drawn the rectangle is marked invalid thus redrawn and filled with the current brush i think.<br />My code was producing width logic shorter than the offset logic.<br /><br />I&#39;m missing something, the code produces 2 pixel borders thus no overlap occurs.<br /><br />What i was asking is how fixing the 4th element width fixes the gaps or overlaps that happend between different elements on different cxClient values, for instance 605 wich produces an overlap between 2nd and 3rd element according to the round model(and appear as a 1 pixel width if i set a brush). An overlap would occur between 3rd and 4th again for the trunc model.<br /><br />For now i checked on paper assuming round(0.5) == 1 and trunc(0.5) == 0. AFAIK trunc( 0.999...) == 0 as well to PCs or at least trunc( 0.9 ).<br /><br />I run numbers(cxClient==607):<br /><br />1st element: offset:0 width:151.75 thus round(151.75)==152<br /><br />2nd element: offset:151.75 thus round(151.75)==152 width:152 element<br />0+152 = 152 1st element offset (1 pixel border)<br /><br />3rd element: offset:303.5 thus round(303.5)=304 width:152<br />152+152 = 304 2nd element offset (1 pixel border)<br /><br />4th element: offset: 455.25 thus round(455.25)==455 width:152<br />304+152 = 456 NOT 3rd element offset (+1 == 2 pixel border or overlap?) &lt;==========<br /><br />If they were all truncated this would&#39;ve been the result:<br /><br />1st offset:0 width:152<br /><br /><br />2nd offset:151 width: 152<br />0+152=152 NOT 2nd element offset (+1 == 2 pixel border or overlap?) &lt;=========<br /><br />3rd offset:303 width: 152<br />151+152=303(1 pixel border)<br /><br />4th offset:455 width: 152<br />303+152=455(1 pixel border)<br /><br />with rectangles:<br /><br />Ok, link: wolfshade.home.ro/checker1.c or wolfshade.home.ro/checker1.zip<br />COPY&amp;PASTE it in another browser window. I get a weird error when supplying C code in these forums. Besides that i can&#39;t even acces the ftp with my firewall on.</div>
    <div class="meta">Posted on 2006-09-13 01:59:09 by w0lfshad3</div>
   </div>
   <div class="post" id="post-185280">
    <div class="subject"><a href="#post-185280">Re: filling gaps</a></div>
    <div class="body">Hmm. Neither the C version calculates last element width correctly. No gaps there though.&nbsp; 8)<br /><br /><div class="quote"><br />What i was asking is how fixing the 4th element width fixes the gaps or overlaps that happend between different elements on different cxClient values, <br /></div><br />It doesn&#39;t. It fixes only the last element width, so it won&#39;t be too short or too long. It has nothing to do with gaps. <br />What fixes the gaps or overlaps is the method of offset calculation. <br />(this code:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov&nbsp; eax, temp2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;imul eax, edi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov&nbsp; temp1, eax)<br />Which is identical to its C version equivalent now that I see it.<br /><br /><br />I think you are just overcomplicating things ;).<br />There is a window with particular width and a number of child elemnts which have single pixel border.<br />Want them placed simply one next to each other and thus produce a &#39;double&#39; pixel border - multiply element width by its position index to get offset.<br />On other hand if one pixel border is required, just make every next element overlap it&#39;s previous neighbor by one pixel.<br />That&#39;s it, there isn&#39;t really any more than this.</div>
    <div class="meta">Posted on 2006-09-13 06:18:06 by arafel</div>
   </div>
   <div class="post" id="post-185282">
    <div class="subject"><a href="#post-185282">Re: filling gaps</a></div>
    <div class="body">Thanks, too many variables in my head, i think its clear now.<br /><br /><div class="quote">I think you are just overcomplicating things .</div><br /><br /> :D It has to be perrrfect because its my precious&nbsp; :D</div>
    <div class="meta">Posted on 2006-09-13 07:02:27 by w0lfshad3</div>
   </div>
  </div>
 </body>
</html>