<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>software adjustable accurate time PIC16f84-04 - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=16264" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=32">Electronics</a> &raquo; <a href="../?id=16264">software adjustable accurate time PIC16f84-04</a></p>
   <div class="post" id="post-126266">
    <div class="subject"><a href="#post-126266">software adjustable accurate time PIC16f84-04</a></div>
    <div class="body">Below is code to produce highly accurate seconds by using software as an adjustment as opposed to variable capacitor. No 32Khz Xtal needed only 4Mhz processor Xtal.<br /><br />0004  190B          btfsc  0xB,0x2          ; See if  Timer0 overflow interrupt             <br />0005  2B00          goto   0x300             ; If True call Timer ISR           <br />0006  0009          retfie                          ; If False ignore<br /><br /><br />0300  0A91          incf   0x11                ; rolling count register         <br />0301  0092          movwf  0x12             ; Store accumulator             <br />0302  3021          movlw  0x21             ; Primary fine tune software adjust             <br />0303  0211          subwf  0x11,W          ; When to jam load Secondary fine tune              <br />0304  1903          btfsc  0x3,0x2            ; value            <br />0305  2B0B          goto   0x30B                          <br />0306  0A90          incf   0x10                 ; TMR0 overflow interrupt count       <br />0307  3002          movlw  0x2                ; Set TMR0 value 1/244 of second           <br />0308  0081          movwf  0x1                ; Jam load TMR0 counter           <br />0309  0000          nop                                  <br />030A  2B10          goto   0x310             ; jump to maintenance seconds and minutes            <br />030B  3000          movlw  0x0               ; re-initialize             <br />030C  0091          movwf  0x11             ; rolling count register             <br />030D  0A90          incf   0x10                ; continue TMR0 interrupt count          <br />030E  3005          movlw  0x5               ; Jam load secondary fine tune            <br />030F  0081          movwf  0x1               ; into TMRO count register            <br />0310  2320          call   0x320                ; Min. and sec. subroutine         <br />0311  0812          movf   0x12,W           ; Restore accumulator              <br />0312  110B          bcf    0xB,0x2            ; Clear TMR0 interrupt flag            <br />0313  168B          bsf    0xB,0x5            ; Re-enable TMP0 interrupt            <br />0314  0009          retfie                           ; Return from interrupt     <br /><br /><br />0320  30F9          movlw  0xF9             ; F9h -2 = 247 (of second 244th secs correction)             <br />0321  0210          subwf  0x10,W          ; interrupt tics              <br />0322  1D03          btfss  0x3,0x2           ; test zero flag            <br />0323  2B2F          goto   0x32F             ; if not whole second get out            <br />0324  3000          movlw  0x0               ; reset interrupt counts            <br />0325  0090          movwf  0x10             ; place to count reg.             <br />0326  0AAE          incf   0x2E              ; increment seconds           <br />0327  0AAF          incf   0x2F            ; seconds shadow register can be modified by main            <br />0328  303B          movlw  0x3B           ; 3Bh = 59(0 to 59 or 60 seconds)              <br />0329  022E          subwf  0x2E,W                        <br />032A  1D03          btfss  0x3,0x2         ; test if one full minute              <br />032B  2B2F          goto   0x32F                         <br />032C  3000          movlw  0x0              ; reset seconds             <br />032D  00AE          movwf  0x2E                          <br />032E  0AC3          incf   0x43              ; increment minutes             <br />032F  0008          return</div>
    <div class="meta">Posted on 2003-12-02 07:26:13 by mrgone</div>
   </div>
  </div>
 </body>
</html>