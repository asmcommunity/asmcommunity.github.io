<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Problem with loading child dialog for Tabcontrol - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=1663" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=1663">Problem with loading child dialog for Tabcontrol</a></p>
   <div class="post" id="post-10613">
    <div class="subject"><a href="#post-10613">Problem with loading child dialog for Tabcontrol</a></div>
    <div class="body">Hey folks,<br />i got a little further with my Tab Control, but i have a problem again.<br />When i select the 2nd Tab it doesn't show the dialog that belongs to it<br />when i switch back it show the dialog for the 1st one again.<br />So i think my program doesn't load the second dialog...<br />Here's the code, with rc<br />test.asm<br /><pre><code><br />.386<br />.model flat,stdcall<br />option casemap&#58;none<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\gdi32.inc<br />include \masm32\include\masm32.inc<br />include \masm32\include\shell32.inc<br />include \masm32\include\comctl32.inc<br />include \masm32\include\comdlg32.inc<br />include \masm32\include\advapi32.inc<br />include \masm32\include\crypt32.inc<br /><br /><br />includelib \masm32\lib\shell32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\gdi32.lib<br />includelib \masm32\lib\masm32.lib<br />includelib \masm32\lib\comctl32.lib<br />includelib \masm32\lib\comdlg32.lib<br />includelib \masm32\lib\advapi32.lib<br />includelib \masm32\lib\crypt32.lib<br />includelib \masm32\lib\Strmbasd.lib<br />includelib \masm32\lib\Strmbase.lib<br /><br />DlgProc PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br /><br />.data<br /><br />DlgName         db &quot;EasyComp&quot;,0<br />Tab1            db &quot;Tab1&quot;,0<br />Tab2            db &quot;Tab2&quot;,0<br />TabTitle1       db &quot;Controls&quot;,0<br />TabTitle2       db &quot;Settings&quot;,0<br />MenuName        db &quot;EasyMenu&quot;,0<br />StatusText      db &quot;by |TyPhOoN|&quot;,0<br />Text            db &quot;Assembling&#58; button.asm&quot;,0<br />Openfiles       OFSTRUCT&lt;&gt;<br />FileName        db &quot;\masm32\bin\ml.exe&quot;,0 <br />CommandLine     db &quot; /nologo /c /coff /Cp \masm32\bin\button.asm&quot;,0<br />FileName2       db &quot;\masm32\bin\link.exe&quot;,0<br />CommandLine2    db &quot; /nologo /SUBSYSTEM&#58;WINDOWS /LIBPATH&#58;c&#58;\masm32\lib \masm32\bin\button.obj&quot;,0<br />processInfo     PROCESS_INFORMATION &lt;&gt; <br />TabStruct       TC_ITEM             &lt;&gt;<br />buffer          db 512 dup&#40;?&#41;<br /><br />.data?<br />hInstance       HINSTANCE ?<br />hWritten        dd ?<br />hInput          dd ?<br />hOutput         dd ?<br />hTab            HANDLE ?<br />hTab1   HANDLE ?<br />hTab2   HANDLE ?<br />WhichTabChosen	DWORD ?<br />Handles LABEL DWORD<br />.const<br />;&lt;&lt;&lt;&lt;Dialog&gt;&gt;&gt;&gt;<br />IDC_TAB1       equ     1001<br />IDC_GROUP      equ     1002<br />IDC_LIST       equ     1003<br /><br />;&lt;&lt;&lt;&lt;ChildDialog&gt;&gt;&gt;&gt;<br />IDC_EDIT1      equ     2001 <br />IDC_EDIT2      equ     2002<br />IDC_BROWSE1    equ     2003<br />IDC_BROWSE2    equ     2004<br />IDC_APPLY      equ     2005<br />IDC_CHECK1     equ     2006<br />IDC_CHECK2     equ     2007<br /><br />IDC_EDIT3      equ     2008<br />IDC_EDIT4      equ     2009<br />IDC_EDIT5      equ     2010<br />IDC_DONE       equ     2011<br /><br />;&lt;&lt;&lt;&lt;Menu&gt;&gt;&gt;&gt;<br />IDM_REG        equ     3001<br />IDM_EXIT       equ     3002<br />IDM_TASKBAR    equ     3003<br />IDM_HELP       equ     3004<br />IDM_README     equ     3005<br />IDM_ABOUT      equ     3006<br />	<br /><br />.code<br />start&#58;<br /><br />invoke GetModuleHandle, NULL<br />mov hInstance, eax<br />invoke DialogBoxParam, hInstance, ADDR DlgName,NULL, addr DlgProc, NULL <br />invoke ExitProcess,eax <br /><br />DlgProc proc hWin &#58;DWORD, uMsg &#58;DWORD, wParam &#58;DWORD, lParam &#58;DWORD<br /> LOCAL startInfo&#58;STARTUPINFO<br /><br />.IF uMsg==WM_COMMAND <br />      mov eax,wParam <br />      mov edx,wParam <br />      shr edx,16 <br />       .IF dx==BN_CLICKED <br />         <br />         .IF ax==IDM_EXIT<br />             invoke SendMessage,hWin,WM_CLOSE,0,0<br />         .ELSEIF ax==IDC_APPLY<br />             <br />             ;invoke GetStdHandle, STD_INPUT_HANDLE<br />             ;mov hInput, eax<br />             ;invoke GetStdHandle, STD_OUTPUT_HANDLE<br />             ;mov hOutput, eax<br />             ;invoke WriteConsole,hOutput,addr Text,8,addr hWritten,NULL         <br />              <br /><br />             invoke GetStartupInfo,ADDR startInfo<br />             mov startInfo.wShowWindow,SW_HIDE <br />             invoke CreateProcess,addr FileName,addr CommandLine,NULL,NULL,FALSE,\ <br />                                  NORMAL_PRIORITY_CLASS,\ <br />                                  NULL,NULL,ADDR startInfo,ADDR processInfo<br />             invoke CloseHandle,processInfo.hThread <br />             <br />             invoke CreateProcess,addr FileName2,addr CommandLine2,NULL,NULL,FALSE,\ <br />                                  NORMAL_PRIORITY_CLASS,\ <br />                                  NULL,NULL,ADDR startInfo,ADDR processInfo                      <br />             invoke CloseHandle,processInfo.hThread <br />             invoke FreeConsole<br />             invoke GetDlgItem,hWin,IDC_LIST<br />             invoke SendMessage,eax,LB_ADDSTRING,NULL,addr Text<br />                    <br />             <br />         .ENDIF<br />         <br />        .ENDIF      <br />.ELSEIF uMsg==WM_NOTIFY<br />        mov eax,lParam<br />	mov eax, &#40;NMHDR PTR &#91;eax&#93;&#41;.code<br />	<br />	.IF eax==TCN_SELCHANGE<br />	  mov eax,WhichTabChosen<br />	  .IF eax == 0<br />	  invoke ShowWindow,hTab1,SW_HIDE<br />	  invoke ShowWindow,hTab2,SW_SHOWDEFAULT<br />	  mov WhichTabChosen,1<br />	  <br />	  .ELSEIF eax != 0<br />	  invoke ShowWindow,hTab2,SW_HIDE<br />	  invoke ShowWindow,hTab1,SW_SHOWDEFAULT<br />	  mov WhichTabChosen,0<br />	  <br />	 .ENDIF <br />	.ENDIF<br />	<br /><br />.ELSEIF uMsg==WM_INITDIALOG<br />        invoke LoadMenu,hInstance,addr MenuName<br />        invoke SetMenu,hWin,eax<br />        <br />        <br />        <br />        invoke InitCommonControls		<br />	invoke GetDlgItem,hWin,IDC_TAB1		<br />	mov hTab,eax<br />	<br />	mov TabStruct.imask,TCIF_TEXT			<br />	mov TabStruct.lpReserved1,0			<br />	mov TabStruct.lpReserved2,0 			<br />	mov TabStruct.pszText,offset TabTitle1 	<br />	mov TabStruct.cchTextMax,sizeof TabTitle1	<br />  	mov TabStruct.iImage,0				<br /> 	mov TabStruct.lParam,0				<br />	invoke SendMessage,hTab,TCM_INSERTITEM,0,offset TabStruct<br />	<br />	mov TabStruct.pszText,offset TabTitle2<br />	mov TabStruct.cchTextMax,sizeof TabTitle2<br />	invoke SendMessage,hTab,TCM_INSERTITEM,1,offset TabStruct<br />	<br />	mov eax,offset DlgProc<br />	invoke CreateDialogParam,hInstance,offset Tab1,hTab,eax,0<br />	mov hTab1,eax<br /><br />        mov eax,offset DlgProc<br />	invoke CreateDialogParam,hInstance,offset Tab2,hTab,eax,0<br />	mov hTab2,eax<br />	<br /><br />	mov WhichTabChosen,0 				<br /><br />	invoke ShowWindow,hTab1,SW_SHOWDEFAULT<br />	<br />	<br />	<br />				<br />.ELSEIF uMsg==WM_CLOSE<br />        invoke EndDialog,hWin,NULL<br /><br />.ENDIF<br />ret<br />DlgProc endp<br />end start<br /><br />Resource<br />test.rc<br /><br />#include &quot;\masm32\include\resource.h&quot; <br /><br />;&lt;&lt;&lt;&lt;Dialog&gt;&gt;&gt;&gt;<br />#define IDC_TAB1            1001<br />#define IDC_GROUP           1002<br />#define IDC_LIST            1003<br /><br />;&lt;&lt;&lt;&lt;ChildDialog&gt;&gt;&gt;&gt;<br />#define IDC_EDIT1           2001 <br />#define IDC_EDIT2           2002<br />#define IDC_BROWSE1         2003<br />#define IDC_BROWSE2         2004<br />#define IDC_APPLY           2005<br />#define IDC_CHECK1          2006<br />#define IDC_CHECK2          2007<br /><br />#define IDC_EDIT3           2008<br />#define IDC_EDIT4           2009<br />#define IDC_EDIT5           2010<br />#define IDC_DONE            2011<br /><br />;&lt;&lt;&lt;&lt;Menu&gt;&gt;&gt;&gt;<br />#define IDM_REG             3001<br />#define IDM_EXIT            3002<br />#define IDM_TASKBAR         3003<br />#define IDM_HELP            3004<br />#define IDM_README          3005<br />#define IDM_ABOUT           3006<br /><br />EasyComp DIALOG DISCARDABLE 10, 10, 380, 140 <br />STYLE WS_CAPTION | WS_SYSMENU | WS_POPUP | DS_MODALFRAME  <br />CAPTION &quot;EasyComp v1.02&quot; <br />FONT 8, &quot;Arial&quot;<br />BEGIN<br />     CONTROL         &quot;Tab1&quot;  ,IDC_TAB1, &quot;SysTabControl32&quot;, 0x0 ,5,5,180,120<br />     GROUPBOX        &quot;Status&quot;,IDC_GROUP                        ,195,5,180,120<br />     LISTBOX                  IDC_LIST                         ,200,14,170,115<br />END<br />Tab1 DIALOG DISCARDABLE  1, 13, 178, 106<br />STYLE WS_CHILD<br />FONT 8, &quot;Arial&quot;<br />BEGIN<br />     GROUPBOX        &quot;Source&quot;,100                               ,  5,  0,166,85<br />     LTEXT           &quot;File .asm&quot;,200                            ,  9,  9, 30, 8<br />    LTEXT           &quot;File .rc&quot;,300                             ,  9, 21, 30, 8<br />     EDITTEXT        IDC_EDIT1                                  , 40,  8,100,10,ES_AUTOHSCROLL | ES_LEFT<br />     EDITTEXT        IDC_EDIT2                                  , 40, 20,100,10,ES_AUTOHSCROLL | ES_LEFT<br />     DEFPUSHBUTTON   &quot;...&quot;,IDC_BROWSE1                          ,153,  8, 12,10<br />     DEFPUSHBUTTON   &quot;...&quot;,IDC_BROWSE2                          ,153, 20, 12,10<br />     DEFPUSHBUTTON   &quot;Start&quot;,IDC_APPLY                          , 74, 91, 30,10<br />     GROUPBOX        &quot;Options&quot;,400                              ,  5, 33,166,52<br />     CHECKBOX        &quot;Show Console &#40;Recommended&#41;&quot;, IDC_CHECK1   ,  9, 42,140, 8,BS_AUTOCHECKBOX<br />     GROUPBOX        &quot;&quot;,500                                     ,  5, 51,166,34<br />     CHECKBOX        &quot;Run Executable after Assembly&quot;, IDC_CHECK2,  9, 60,140, 8,BS_AUTOCHECKBOX<br />     <br />END<br /><br />EasyMenu MENU MOVEABLE IMPURE LOADONCALL DISCARDABLE<br />BEGIN<br />     POPUP &quot;&amp;File&quot;<br />      BEGIN<br />      MENUITEM &quot;&amp;Registry Entries&quot;,IDM_REG<br />      MENUITEM SEPARATOR<br />      MENUITEM &quot;&amp;Exit&quot;,IDM_EXIT<br />      END<br />     POPUP &quot;&amp;View&quot;<br />      BEGIN<br />      MENUITEM &quot;&amp;Icon in TaskBar&quot;,IDM_TASKBAR<br />      END<br />     POPUP &quot;&amp;?&quot;<br />      BEGIN<br />      MENUITEM &quot;&amp;Help&quot;,IDM_HELP<br />      MENUITEM &quot;&amp;ReadMe&quot;,IDM_README<br />      MENUITEM SEPARATOR<br />      MENUITEM &quot;&amp;About&quot;,IDM_ABOUT<br />      END<br />END         <br />Tab2 DIALOG DISCARDABLE  1, 13, 178, 106<br />STYLE WS_CHILD<br />FONT 8, &quot;Arial&quot;<br />BEGIN<br />     GROUPBOX        &quot;Commandlines&quot;,600                               ,  5,  0,166,85<br />     LTEXT           &quot;ml&quot;,700                            ,  9,  9, 30, 8<br />     LTEXT           &quot;link&quot;,800                             ,  9, 21, 30, 8<br />     LTEXT           &quot;rc&quot;,900                             ,  9, 21, 30, 8<br />     EDITTEXT        IDC_EDIT3                                  , 40,  8,100,10,ES_AUTOHSCROLL | ES_LEFT<br />     EDITTEXT        IDC_EDIT4                                  , 40, 20,100,10,ES_AUTOHSCROLL | ES_LEFT<br />     EDITTEXT        IDC_EDIT5                                  , 40, 20,100,10,ES_AUTOHSCROLL | ES_LEFT<br />     DEFPUSHBUTTON   &quot;Done&quot;,IDC_DONE                           , 74, 91, 30,10<br />     GROUPBOX        &quot;Options&quot;,1000                             ,  5, 33,166,52<br />     ;CHECKBOX        &quot;Show Console &#40;Recommended&#41;&quot;, IDC_CHECK1   ,  9, 42,140, 8,BS_AUTOCHECKBOX<br />     GROUPBOX        &quot;&quot;,1100                                    ,  5, 51,166,34<br />     ;CHECKBOX        &quot;Run Executable after Assembly&quot;, IDC_CHECK2,  9, 60,140, 8,BS_AUTOCHECKBOX<br />END<br /></code></pre><br /><br />thanks in advance, Olli</div>
    <div class="meta">Posted on 2001-10-29 13:34:58 by Olli</div>
   </div>
   <div class="post" id="post-10616">
    <div class="subject"><a href="#post-10616">Dumb Me</a></div>
    <div class="body">Never mind folks,<br /><br />i forget to give each dialog a different procedure, i used the same one for all of'em.<br />If anybody is interested in the new code drop a post or a mail<br />I'll send it to you<br /><br />Regards Olli</div>
    <div class="meta">Posted on 2001-10-29 14:27:58 by Olli</div>
   </div>
  </div>
 </body>
</html>