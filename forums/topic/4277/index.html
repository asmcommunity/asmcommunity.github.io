<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>createwindowex - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4277" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=4277">createwindowex</a></p>
   <div class="post" id="post-29577">
    <div class="subject"><a href="#post-29577">createwindowex</a></div>
    <div class="body">i' m going crazy....<br /><br />what's wrong? there is an error, if i try to call CreateWindowEx<br />(i think:invalid parameter...57h)<br /><br /><br />    ;super shit by germax 2002-2008          <br /><br />     .686<br />     .mmx<br />     Locals<br />     jumps<br />    <br />     .Model Flat ,StdCall<br />     extrn          ExitProcess     : PROC<br />     extrn          MessageBoxA     : PROC<br />     extrn          LoadBitmapA     : PROC<br />     extrn          GetModuleHandleA: PROC<br />     extrn          RegisterClassA  : PROC<br />     extrn          MessageBeep     : PROC<br />     extrn          CreateWindowExA : PROC<br />     extrn          TranslateMessage: PROC<br />     extrn          DispatchMessageA: PROC<br />     extrn          PostQuitMessage : PROC<br />     extrn          DefWindowProcA  : PROC<br />     extrn          LoadCursorA     : PROC<br />     extrn          LoadIconA       : PROC<br />     extrn          ShowWindow      : PROC<br />     extrn          UpdateWindow    : PROC<br />     extrn          GetMessageA     : PROC<br /><br /><br /><br /><br />     .data<br />     newhwnd   dd     0<br />     hinstance dd     0<br />;msgstructur start: 401008<br />     msg       dd 0    ;8   mshwnd<br />               dd 0    ;c   msmessage<br />     msgwparam dd 0    ;10  mswparam<br />               dd 0    ;14  mslparam<br />               dd 0    ;18  mstime<br />               dd 0    ;1c  mspt<br />;struc wndclass start: 401020<br />     wc:<br />     clsStyle		  dd	 0	;20<br />     clsLpfnWndProc	  dd	 0      ;24<br />     clsCbClsExtra	  dd	 0      ;28<br />     clsCbWndExtra	  dd	 0      ;2c<br />     clsHInstance	  dd	 0	;30<br />     clsHIcon		  dd	 0	;34<br />     clsHCursor	          dd	 0	;38<br />     clsHbrBackground	  dd	 0	;3c<br />     clsLpszMenuName	  dd	 0	;40<br />     clsLpszClassName	  dd	 0	;44<br /><br /><br />     titlo    db       'flat asi usw',0    ;48<br />     class    db       'Fasmblabsal ',0    ;69<br />     caption  db       'Windowblabla',0    ;73<br />     message  db       'Lmb drueckt ',0    ;8a<br />                                   <br />              <br />  <br />     .code<br />start:<br />     push   0<br />     call   GetModuleHandleA<br />     mov    hinstance, eax<br /><br /><br /><br />     push   7f04h <br />     push   0<br />     call   LoadIconA<br />     mov    clshicon, eax<br />     cmp eax,0<br />     jz end_loop     <br /><br />     push   7f00h<br />     push   0<br />     call   LoadCursorA<br />     mov    clshcursor, eax<br />     cmp eax,0<br />     jz end_loop    <br /><br />     mov    clsstyle, 4003h<br />     mov    clsLpfnWndProc,offset windowproc<br />     mov    clsCbClsExtra,0<br />     mov    clsCbWndExtra,0<br />     mov    eax,hinstance<br />     mov    clsHInstance,eax<br />     mov    clsHbrBackground,10h<br />     mov    clsLpszMenuName,0<br />     mov    clsLpszClassName,offset class<br />     push   offset wc<br />     call   RegisterClassA<br /><br />     cmp eax,0<br />     jz end_loop<br />;-----------------------------------------------------------------------------<br />     push   0<br />     push   hinstance<br />     push   0<br />     push   0<br />     push   160<br />     push   192<br />     push   64h<br />     push   64h<br />     push   0480000h<br />     push   offset titlo<br />     push   offset class<br />     push   0<br /><br />:here is an error---------------------------------------------------!!!!<br />;     jmp end_loop<br />     call   CreateWindowExA<br />     mov    newhwnd, eax<br /><br />     cmp eax,0<br />     je end_loop<br /><br />     push   1<br />     push   newhwnd<br />     call   ShowWindow<br />     push   newhwnd<br />     call   UpdateWindow<br />    <br />     jmp end_loop<br /><br /><br />msg_loop:<br />     push   00h<br />     push   00h<br />     push   00h<br />     push   msg<br />     call   GetMessageA<br />     or     ax, ax<br />     jz     end_loop<br />     push   offset msg<br />     call   TranslateMessage<br />     push   offset msg<br />     call   DispatchMessageA<br />     jmp    msg_loop<br />end_loop:<br />     push   msgwparam<br />     call   ExitProcess<br /><br />windowproc:     <br />     enter  00h, 00h<br />     push   ebx esi edi<br />     cmp    dword ptr , 02h<br />     jz     wmdestroy<br />     cmp    dword ptr , 201h<br />     jz     wmlbuttondown<br />     cmp    dword ptr , 204h<br />     jz     wmrbuttondown<br />     push   dword ptr <br />     push   dword ptr <br />     push   dword ptr <br />     push   dword ptr <br />     call   DefWindowProcA<br />     jmp    finish<br /><br />wmdestroy:<br />     push   0<br />     call   PostQuitMessage<br />     xor    eax, eax<br />     jmp    finish<br /><br />wmlbuttondown:<br />     push   40h<br />     push   offset caption<br />     push   offset message<br />     push   dword ptr <br />     call   MessageBoxA<br />     jmp    finish<br />wmrbuttondown:<br />     push   0<br />     call   MessageBeep<br />finish:<br />     pop    edi esi ebx<br />;     leave  <br />     ret<br />;windowproc endp<br />end start</div>
    <div class="meta">Posted on 2002-03-17 12:04:24 by germax</div>
   </div>
   <div class="post" id="post-29587">
    <div class="subject"><a href="#post-29587">createwindowex</a></div>
    <div class="body">The problem is in your wndProc, consider making use of masm's built-in 'proc' for labels, then you do not need to worry about each parameter's offset. <br /><br /><br />The problem is that you have no idea what ebp is in the function.<br /><br /><br />WndProc:<br />push ebp<br />mov ebp, esp<br />...<br />pop ebp<br />ret</div>
    <div class="meta">Posted on 2002-03-17 13:00:53 by bdjames</div>
   </div>
   <div class="post" id="post-29799">
    <div class="subject"><a href="#post-29799">createwindowex</a></div>
    <div class="body">is this really true?<br />i tested my prog, seems it 's a problem with this line:<br /><br />push offset class <br />push 0 <br /><br /><br /><br />because the newhnd =0!<br /><br />:here is an error---------------------------------------------------!!!! <br />; jmp end_loop <br />call CreateWindowExA <br />mov newhwnd, eax</div>
    <div class="meta">Posted on 2002-03-18 13:45:28 by germax</div>
   </div>
   <div class="post" id="post-29834">
    <div class="subject"><a href="#post-29834">createwindowex</a></div>
    <div class="body">Yup, try it!<br /><br />&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;<br /><br />The CreateWindowEx function sends WM_NCCREATE, WM_NCCALCSIZE, and WM_CREATE messages to the window being created. <br /><br />&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;<br /><br />Put a break at the top of wndproc</div>
    <div class="meta">Posted on 2002-03-18 18:12:59 by bdjames</div>
   </div>
   <div class="post" id="post-29916">
    <div class="subject"><a href="#post-29916">to bdjames</a></div>
    <div class="body">you' re an expert???<br /><br />have changed it, so it seems to run well.   <br /><br />now it's time to show some bitmaps in my window.<br />i've loaded these bmps (with a ressource comp.) in my .exe.<br /><br />1. what's a good way to show my bitmaps (1 with LMB, the other with RMB,(for testing and get more skill))<br /><br />2. how can i get  pointers to my bitmaps (that's absolutely necessary)?<br /><br />because:<br />ie .................ie idb_id<br />347593....... 0123456789.........ie:idb_id1...........ie:idb_id1<br />var-----------&gt;charset-----------&gt;buffer------------&gt;showbuffer<br /><br /><br />     hbitmap    dd 0<br />     hbitmap1  dd 0  <br />      <br />     resorce        db &quot;IDB_ID&quot;,0               <br />     resorce1      db &quot;IDB_ID1&quot;,0          <br /><br />     <br />.code...<br />     .<br />     .<br />     push offset resorce<br />     push hinstance<br />     Call LoadBitmapA<br />     Mov hBitmap, eax<br /><br />;     call allout<br /><br />     push offset resorce1<br />     push hinstance<br />     Call LoadBitmapA<br />     Mov hBitmap1, eax<br /><br /><br />;     call allout <br /><br /><br /><br />besides i've the masm32 package, looked all the examples but it's to difficult for me to understand, cause the programming-style is quite differnet from mine.:confused:</div>
    <div class="meta">Posted on 2002-03-19 11:56:54 by germax</div>
   </div>
   <div class="post" id="post-30121">
    <div class="subject"><a href="#post-30121">createwindowex</a></div>
    <div class="body">Nah, I am pretty good in assembly, but new to windows api.<br /><br />I have not worked with bitmaps yet, but I see that you are pushing the offset of a string of the ID, try pushing the actual ID number. <br /><br /><br /><br />IDI_BMP equ 101 ; same number as in the rc file<br /><br />push IDI_BMP</div>
    <div class="meta">Posted on 2002-03-21 00:10:00 by bdjames</div>
   </div>
   <div class="post" id="post-30183">
    <div class="subject"><a href="#post-30183">createwindowex</a></div>
    <div class="body">with my method, i get really back a bmphandle(but i try your version, too).<br />the problem is, i don`t understand the way to show a bitmap.<br />i know the APIs GetDC, BeginPaint, BitBlt.....but i don't know how to use them,  what order they have to be. i know, that i need  hwnd, but i don't know where i can get it(msgstruc?).all i try fails(either i get zeroes back or prog crashes).<br /><br />my code so far:<br /><br /><br />msg_loop:<br />     push   00h<br />     push   00h<br />     push   00h<br />     push   offset msg<br />     call   GetMessageA<br />     or     ax, ax<br />     jz     end_loop<br />     push   offset msg<br />     call   TranslateMessage<br />     push   offset msg<br />     call   DispatchMessageA<br />     jmp    msg_loop<br />end_loop:<br />;-----------------------------<br />     call   GetTickCount<br />     mov    ebx,pstart<br />     sub    eax,ebx<br />;     call   allout<br />;-----------------------------<br />     xor    eax,eax<br />     call   ExitProcess<br /><br />windowproc: <br />     push ebp <br />     mov ebp, esp     <br />     cmp    dword ptr , 02h<br />     jz     wmdestroy<br />     cmp    dword ptr , 201h<br />     jz     wmlbuttondown<br />     cmp    dword ptr , 204h<br />     jz     wmrbuttondown<br />     push   dword ptr <br />     push   dword ptr <br />     push   dword ptr <br />     push   dword ptr <br />     call   DefWindowProcA<br />     jmp    finish<br />wmdestroy:<br />     push   0<br />     call   PostQuitMessage<br />     xor    eax, eax<br />     jmp    finish<br />wmlbuttondown:<br /><br />     mov     eax,<br />;     call    GetDC<br />;     mov     hdc,eax<br />     call    allout<br /><br /><br />     push   40h<br />     push   offset caption<br />     push   offset message<br />     push   dword ptr <br />     call   MessageBoxA<br />     jmp    finish<br />wmrbuttondown:<br />     push   40h<br />     push   offset caption<br />     push   offset message2<br />     push   dword ptr <br />     call   MessageBoxA<br />finish:<br />     pop ebp<br />     ret <br />;windowproc endp<br /><br /><br /><br />i hope you can do something for me............;)</div>
    <div class="meta">Posted on 2002-03-21 14:07:20 by germax</div>
   </div>
   <div class="post" id="post-30190">
    <div class="subject"><a href="#post-30190">createwindowex</a></div>
    <div class="body">push dword ptr  <br />push dword ptr  <br />push dword ptr  <br />push dword ptr  &lt;--<br /><br />aka <br /><br />push lParam <br />push wParam <br />push uMsg<br />push hWnd               &lt;--<br /><br /><br />Here is how the stack looks:<br /><br />???<br />lParam<br />wParam<br />uMsg   &lt;--ebp+c<br />hWnd   &lt;--ebp+8<br />IP     &lt;--ebp+4<br />ebp    &lt;--ebp,esp<br />???<br /><br />What assembler are you using?</div>
    <div class="meta">Posted on 2002-03-21 14:58:07 by bdjames</div>
   </div>
   <div class="post" id="post-30342">
    <div class="subject"><a href="#post-30342">createwindowex</a></div>
    <div class="body">i use tasm 5.3. <br />my problem seems to be, that i am not able to call GetDC<br />with the right hwnd.<br />you can see in my prog, i tried to use.<br />oh i see at this time, that i don't pushed dword ptr  <br />but moved it in eax before call GetDC.....<br />i have to check this!!!<br />but don't stop to help me further....:alright:</div>
    <div class="meta">Posted on 2002-03-22 12:30:38 by germax</div>
   </div>
  </div>
 </body>
</html>