<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Ownerdraw menubar - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=16070" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=16070">Ownerdraw menubar</a></p>
   <div class="post" id="post-124607">
    <div class="subject"><a href="#post-124607">Ownerdraw menubar</a></div>
    <div class="body">I figured out how to create ownerdraw popup menu, by processing WM_MEASUREITEM and WM_DRAWITEM messages. However now I'd like to create ownerdraw menubar with ownerdraw menu items. Somthing like Office XP has, or Opera browser. <br />I have no clue how can this be done. Also if I am not wrong, that menubar is created as custom window which is docked right below window title bar? Is this only way to make menu bar owner draw (since its basically custom control and involves a lot of work) or I can create regular menu bar (CreateMenu) and just draw on it?</div>
    <div class="meta">Posted on 2003-11-17 11:58:38 by Mikky</div>
   </div>
   <div class="post" id="post-124609">
    <div class="subject"><a href="#post-124609">Ownerdraw menubar</a></div>
    <div class="body">As far as I know the idea is to use a toolbar as a menu. There is an example at MSDN that apparently works though I have never managed to get it to pull down the menus properly on a mouse move. I have an example that shows it, but would have a hard time finding it because I just ended up archiving it somewhere. I'll look around.<br /><br />I did manage to find the link to the example that I used at MSDN but it seems my test is gone, too bad it was nearly complete but I lost it to the blaster worm and did not have a backup.<br /><br /><a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/commctls/faq/iemenubar.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/commctls/faq/iemenubar.asp</a></div>
    <div class="meta">Posted on 2003-11-17 12:29:14 by donkey</div>
   </div>
   <div class="post" id="post-124712">
    <div class="subject"><a href="#post-124712">Ownerdraw menubar</a></div>
    <div class="body">Hay doneky,<br />Thanks for the reference, I never did create toolbar so I need little time to work on in first.<br />What was the problem with your code with those menus? <br />Do you mean on showing menus when mouse is first clicked on one menu and then moved over others?</div>
    <div class="meta">Posted on 2003-11-18 17:59:09 by Mikky</div>
   </div>
   <div class="post" id="post-124719">
    <div class="subject"><a href="#post-124719">Ownerdraw menubar</a></div>
    <div class="body">The only thing I had left to figure out was when a menu was down and the user moved the mouse to another menu it would dismiss the first menu and pull down the second automatically. This is not an easy thing to do, you can see in software such as Mozilla they have given up trying to get it to work. I was very close - damn blaster worm. Besides that I had every thing working perfectly, I think that Roticv saw it, I am not sure if he noticed any other problems with it. I am still hopefull of finding it on some archive soemwhere, if I do I will post the source as the only source available that did what I had managed is pay-to-see.</div>
    <div class="meta">Posted on 2003-11-18 19:07:53 by donkey</div>
   </div>
   <div class="post" id="post-124771">
    <div class="subject"><a href="#post-124771">Ownerdraw menubar</a></div>
    <div class="body">Hi Mikky,<br /><br />No luck at all in finding it, I went through all of my archives and it is lost. I was working on it at about the same time I got the Blaster worm and at the time I only backed up once a month so it is not on any of my disks. Sorry, I may rewrite it one day but not soon.</div>
    <div class="meta">Posted on 2003-11-19 04:03:37 by donkey</div>
   </div>
   <div class="post" id="post-124773">
    <div class="subject"><a href="#post-124773">Ownerdraw menubar</a></div>
    <div class="body">Donkey thanks for the effort anyway, I see this is not that easy task so I might reconsider doing it at all. But if I do, I will post questions here since you have experience with this :)</div>
    <div class="meta">Posted on 2003-11-19 04:42:32 by Mikky</div>
   </div>
   <div class="post" id="post-124796">
    <div class="subject"><a href="#post-124796">Ownerdraw menubar</a></div>
    <div class="body">Hi Mikky,<br /><br />I threw this together from memory, it will help you get started if you want to tackle it. For the most part it works but it's still a little buggy.<br /><br />See the next post for the proggie</div>
    <div class="meta">Posted on 2003-11-19 07:50:40 by donkey</div>
   </div>
   <div class="post" id="post-124818">
    <div class="subject"><a href="#post-124818">Ownerdraw menubar</a></div>
    <div class="body">Hi Mikky,<br /><br />Well, I had a bit of time over lunch to fix it up a bit. This will demonstrate some of the things you can do with a toolbar as menu application. It's pretty nice. With this there are bitmaps in the menu bar, you can move a menu with shift-drag and double clicking the menu bar will open a customize dialog. Also because this is a toolbar you can put in any type of child control you like :)<br /><br />&lt;edit&gt;Forgot to relay the results of TrackPopupMenu to WM_COMMAND, not much of a change...&lt;/edit&gt;<br /><br /><img src="http://www.nt.net/donkey/images/mtb.gif" /><br /><br /><strong>See my website for the example</strong></div>
    <div class="meta">Posted on 2003-11-19 12:37:45 by donkey</div>
   </div>
   <div class="post" id="post-124834">
    <div class="subject"><a href="#post-124834">Ownerdraw menubar</a></div>
    <div class="body">Hiya Donkey,<br />This is awesome, I think I'll never use regular menus again :)<br />Combined with owner-drawn menus the result should look very cool.<br />Right now I dont have much time but I will defenetelly study your code tomorrow. <br />Is it possible to make this toolbar act completelly like real menu, like invoking it on ALT button, moving through it with arrow keys on keyboard etc...?</div>
    <div class="meta">Posted on 2003-11-19 15:30:07 by Mikky</div>
   </div>
   <div class="post" id="post-124839">
    <div class="subject"><a href="#post-124839">Ownerdraw menubar</a></div>
    <div class="body">Yes, all that is detailed in the MS article I referenced but as I said I built this from memory so I did not get around to rewriting the code for that part. This is the exact type of toolbar menu that MS uses in *all* of it's marquee software, Outlook, FrontPage, Word, IE etc... So as you can see from those programs it can react so much like a normal menu that it is difficult to notice the difference. For the keyboard I think you have only to check for the WM_MENUCHAR message in the DLL's message hook.<br /><br />If you want to see something really cool, try changing the style of the toolbar:<br /><br /><pre><code>&#91;b&#93;In CreateToolBar proc&#91;/b&#93;<br /><br />invoke GetWindowLong,hToolBar,GWL_STYLE<br />or eax,040h or CCS_ADJUSTABLE or CCS_BOTTOM<br />invoke SetWindowLong,hToolBar,GWL_STYLE,eax</code></pre><br /><br />Menus on the bottom of Windows ! You can also make them vertical left or right ! Put them into a ReBar and have multiple menus on the same line etc...</div>
    <div class="meta">Posted on 2003-11-19 16:42:43 by donkey</div>
   </div>
   <div class="post" id="post-124843">
    <div class="subject"><a href="#post-124843">Ownerdraw menubar</a></div>
    <div class="body">donkey, &quot;lost it to the blaster worm&quot;? I thought the blaster worm wasn't destructive? :confused:</div>
    <div class="meta">Posted on 2003-11-19 17:11:41 by f0dder</div>
   </div>
   <div class="post" id="post-124845">
    <div class="subject"><a href="#post-124845">Ownerdraw menubar</a></div>
    <div class="body"><div class="quote"><br />donkey, &quot;lost it to the blaster worm&quot;? I thought the blaster worm wasn't destructive? :confused: </div><br /><br />It wasn't - after they had discovered what it was. I got it before it became widely known and had uploads to do so I deleted all infected files just in case. I thought I had backups anyway so it turned out to be just another case of my un-natural stupidity merging with a lack of available information. If you remember around the time it came out I had posted that I already had gotten it :mad:</div>
    <div class="meta">Posted on 2003-11-19 17:23:05 by donkey</div>
   </div>
   <div class="post" id="post-124848">
    <div class="subject"><a href="#post-124848">Ownerdraw menubar</a></div>
    <div class="body">Ah, sorry to hear that :(<br />I noticed a lot of connection requests on my firewall, so I set up a honeypot and analyzed the exploit code before it was widely known - then sent the trojan code off to a couple of friends, went partying, and found one of my friends analysis on bugtraq a couple of days later :)</div>
    <div class="meta">Posted on 2003-11-19 17:35:24 by f0dder</div>
   </div>
   <div class="post" id="post-124873">
    <div class="subject"><a href="#post-124873">Ownerdraw menubar</a></div>
    <div class="body"><div class="quote"><br />Is it possible to make this toolbar act completelly like real menu, like invoking it on ALT button, moving through it with arrow keys on keyboard etc...? </div><br /><br />Hi Mikky,<br /><br />This one has the start of a few keyboard commands. I can't figure out how to underline the accelerators when you press ALT but the menus have accelerators 0,1,2 and 3. Left and right keys move the current hot item, escape dismisses the menu and F10 activates the menu bar at position 0. They all work but need a bit of tweaking to get them up to 100%. I put in code (commented out) to allow you to use the toolbar menu without a DLL, but the escape key does not work if you do and neither will anything else you decide to do in the DLL. Just check the comments in the source to find out which lines to change. I also colored the menus a bit for a cooler look.<br /><br />It' been fun coming back to this, I had originally planned on using it in ToolBar Paint but in the end thought it was too much for 3 menus :)<br /><br /><strong>See my website for the example</strong></div>
    <div class="meta">Posted on 2003-11-20 02:06:49 by donkey</div>
   </div>
  </div>
 </body>
</html>