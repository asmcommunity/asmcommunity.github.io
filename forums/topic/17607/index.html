<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>DialogBoxIndirectParam problem - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17607" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=17607">DialogBoxIndirectParam problem</a></p>
   <div class="post" id="post-136160">
    <div class="subject"><a href="#post-136160">DialogBoxIndirectParam problem</a></div>
    <div class="body">I am trying to create dialog with one button from memory template, here is how:<br /><br /><pre><code><br />.data?<br /><br />align 4	<br />	mydlg   DLGTEMPLATE			&lt;WS_VISIBLE or WS_SYSMENU or DS_CENTER, 0,1,0,0,150,70&gt;<br />	dw		0<br />	dw		0<br />	dw		0<br />align 4<br />	btnok	DLGITEMTEMPLATE		&lt;WS_VISIBLE or WS_CHILD,	0,0,0,20,10,675&gt;<br />	dw		0FFFFh<br />	dw		0080h<br />	DW  	0<br />	dw		0<br />.code<br />start&#58;<br />	invoke	GetModuleHandle,0<br />	mov		hInstance,eax<br />         invoke	DialogBoxIndirectParam,hInstance,addr mydlg,0,ADDR dlgproc,0		<br /></code></pre><br /><br />But DialogBoxIndirectParam, and GetLastError is of no help it returns &quot;The operation completed successfully&quot;. Can someone give me a hint how to do this (I need it done this way rather than using macros from dialog.asm)</div>
    <div class="meta">Posted on 2004-03-16 21:29:41 by Mikky</div>
   </div>
   <div class="post" id="post-136176">
    <div class="subject"><a href="#post-136176">DialogBoxIndirectParam problem</a></div>
    <div class="body">Here is how I did it:<br /><br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=14782">http://www.asmcommunity.net/board/index.php?topic=14782</a><br /><br />and here is a tool made by Vortex to simplify the process:<br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=16671">http://www.asmcommunity.net/board/index.php?topic=16671</a><br /><br />edit: Wrong link :tongue:</div>
    <div class="meta">Posted on 2004-03-17 03:19:09 by Delight</div>
   </div>
   <div class="post" id="post-136229">
    <div class="subject"><a href="#post-136229">DialogBoxIndirectParam problem</a></div>
    <div class="body"><pre><code>.686<br />.MMX<br />.XMM<br />.MODEL FLAT, STDCALL<br />OPTION SCOPED<br />OPTION CASEMAP&#58;NONE<br /><br />INCLUDE C&#58;\masm32\include\windows.inc<br />INCLUDE C&#58;\masm32\include\kernel32.inc<br />INCLUDELIB C&#58;\masm32\lib\kernel32.lib<br />INCLUDE C&#58;\masm32\include\user32.inc<br />INCLUDELIB C&#58;\masm32\lib\user32.lib<br /><br />LD MACRO lpStr&#58;REQ<br />    FORC wchar, &lt;lpStr&gt;<br />        DW &quot;&amp;wchar&quot;<br />    ENDM<br />    DW 0<br />ENDM<br /><br />.CONST<br /><br />    IDE_EDIT = 5000<br /><br />.DATA<br /><br />    ALIGN 4<br /><br />    pMainDlg DD WS_POPUP+WS_VISIBLE+WS_SYSMENU+WS_CAPTION+WS_MINIMIZEBOX+DS_MODALFRAME+DS_SETFONT   ;style<br />             DD 0       ;extended style<br />             DW 2       ;# of child controls<br />             DW 10      ;x<br />             DW 10      ;y<br />             DW 300     ;width<br />             DW 300     ;height<br /><br />             ;User Defined Data<br /><br />             DW 0       ;Do we have a menu? 0 = false; -1 = true<br />             ;DW MENUID ;Optional if above is -1<br />             DW 0       ;Class specifier. 0 = no custom class, -1 = custom class ---+<br />             ;DW ATOM   ;Optional if above is -1.                                   +&gt;&gt; I'm not quite sure<br />             ;or                                                                    +&gt;&gt; about this. &#58;&#41;<br />             ;LD &lt;text&gt; ;Optional if above is -1.                                ---+<br />             LD &lt;Test&gt;  ;Window caption<br />             DW 8       ;only if DS_SETFONT is used on one of the window styles. Font Size.<br />             LD &lt;MS Sans Serif&gt;     ;only if DS_SETFONT is used on one of the window styles. Font Face.<br /><br />    ALIGN 4<br />    pChild1 DD WS_CHILD+WS_VISIBLE  ;style<br />            DD 0        ;extended style<br />            DW 10       ;x<br />            DW 10       ;y<br />            DW 100      ;width<br />            DW 100      ;height<br />            DW 2000     ;Control ID = IDC_EDIT1 ... IDE_EDIT2 ... IDB_BUTTON1 ...<br /><br />            ;User Defined Data<br /><br />            DW -1       ;must be -1 then follow a value of a predefined class.<br />                        ;This can be also be a string specifying a window class.<br /><br />            DW 80h      ;Button = 80h<br />                        ;Edit = 81h<br />                        ;Static = 82h<br />                        ;Listbox = 83h<br />                        ;Scrollbar = 84h<br />                        ;Combobox = 85h<br />                        ;...<br /><br />            LD &lt;Click&gt;  ;If the control contains a text or<br />            ;DW 0       ;otherwise or<br />            ;DW -1      ;if the control is a resource then follow<br />            ;DW RES_ID  ;a word value containing the resource ID. string is not allowed.<br /><br />            ;Creation Data Here can be of any size.<br /><br />    ALIGN 4<br />    pChild2 DD WS_CHILD+WS_VISIBLE  ;style<br />            DD 0        ;extended style<br />            DW 10       ;x<br />            DW 150      ;y<br />            DW 100      ;width<br />            DW 100      ;height<br />            DW IDE_EDIT ;Control ID = IDC_EDIT1 ... IDE_EDIT2 ... IDB_BUTTON1 ...<br /><br />            ;User Defined Data<br /><br />            DW -1       ;must be -1 then follow a value of a predefined class.<br />                        ;This can be also be a string specifying a window class.<br /><br />            DW 81h      ;Button = 80h<br />                        ;Edit = 81h<br />                        ;Static = 82h<br />                        ;Listbox = 83h<br />                        ;Scrollbar = 84h<br />                        ;Combobox = 85h<br />                        ;...<br /><br />            LD &lt;Type&gt;   ;If the control contains a text or<br />            ;DW 0       ;otherwise or<br />            ;DW -1      ;if the control is a resource then follow<br />            ;DW RES_ID  ;a word value containing the resource ID. string is not allowed.<br /><br />            ;Creation Data Here can be of any size.<br /><br />.CODE<br /><br />MainProc PROC hDlg&#58;DWORD, uMsg&#58;DWORD, wParam&#58;DWORD, lParam&#58;DWORD<br /><br />    mov     eax, uMsg<br /><br />    .IF&#40;eax == WM_INITDIALOG&#41;<br /><br />    .ELSEIF&#40;eax == WM_CLOSE&#41;<br />        invoke  DestroyWindow, hDlg<br />    .ELSE<br />        mov     eax, FALSE<br />        ret<br />    .ENDIF<br /><br />    mov     eax, TRUE<br />    ret<br /><br />MainProc ENDP<br /><br />start&#58;<br /><br />    invoke  GetModuleHandle, 0<br />    invoke  DialogBoxIndirectParam, eax, OFFSET pMainDlg, 0, OFFSET MainProc, 0<br /><br />    invoke  ExitProcess, 0<br />    ret<br /><br />END start</code></pre>:grin:</div>
    <div class="meta">Posted on 2004-03-17 13:26:41 by arkane</div>
   </div>
   <div class="post" id="post-136231">
    <div class="subject"><a href="#post-136231">DialogBoxIndirectParam problem</a></div>
    <div class="body">:grin:<br /><br />This one can be coded with much more less pain.<br /><pre><code><br />.386<br />.model flat,stdcall<br />option casemap&#58;none<br /><br /><br />include	\masm32\include\windows.inc<br />include 	\masm32\include\user32.inc<br />include 	\masm32\include\kernel32.inc<br />includelib	\masm32\lib\user32.lib<br />includelib	\masm32\lib\kernel32.lib<br /><br />DlgProc PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br /><br />.data<br />DlgBoxTemplate	db 1,0,255,255,0,0,0,0,0,0,0,0,196,0,200,144 <br />		db 2,0,10,0,10,0,217,0,105,0,0,0,0,0,68,0<br />		db 105,0,97,0,108,0,111,0,103,0,32,0,98,0,111,0<br />		db 120,0,0,0,8,0,188,2,0,1,77,0,83,0,32,0<br />		db 83,0,97,0,110,0,115,0,32,0,83,0,101,0,114,0<br />		db 105,0,102,0,0,0,0,0,0,0,0,0,0,0,0,0<br />		db 0,0,1,80,72,0,19,0,78,0,31,0,186,11,0,0<br />		db 255,255,128,0,66,0,117,0,116,0,116,0,111,0,110,0<br />		db 0,0,0,0,0,0,0,0,0,0,0,0,128,0,129,80<br />		db 36,0,62,0,145,0,24,0,184,11,0,0,255,255,129,0<br />		db 0,0,0,0 ;Res2bin Rsrc.res + Bintodb tool<br />.code<br />start&#58;<br />	invoke GetModuleHandle, NULL<br />	invoke DialogBoxIndirectParam,eax,ADDR DlgBoxTemplate,NULL,ADDR DlgProc,NULL<br />	invoke ExitProcess,eax<br /><br />DlgProc proc hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br />	<br />        <br />	.IF uMsg==WM_CLOSE<br />	<br />	invoke EndDialog, hWnd,NULL<br /><br />	.ELSE<br />		mov eax,FALSE<br />		ret<br />	.ENDIF<br />	mov eax,TRUE<br />	ret<br />DlgProc endp<br />END start<br /></code></pre><br /><br />:grin:</div>
    <div class="meta">Posted on 2004-03-17 14:13:17 by Vortex</div>
   </div>
  </div>
 </body>
</html>