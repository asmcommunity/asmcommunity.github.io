<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Device I/O DCB structure error - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=21057" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=21057">Device I/O DCB structure error</a></p>
   <div class="post" id="post-159550">
    <div class="subject"><a href="#post-159550">Device I/O DCB structure error</a></div>
    <div class="body">I&#39;m a little bit confused regarding <strong>windows.inc</strong> and the <strong>DCB</strong> structure. In the windows.inc file teh declaration is the following:<br /><pre><code>BITRECORD RECORD fBinary:1,fParity:1,fOutxCtsFlow:1,fOutxDsrFlow:1,fDtrControl:2,fDsrSensitivity:1,fTXContinueOnXoff:1,fOutX:1,fInX:1,fErrorChar:1,fNull:1,fRtsControl:2,fAbortOnError:1,fDummy2:17<br /><br />DCB STRUCT<br />&nbsp; DCBlength&nbsp; &nbsp;  DWORD&nbsp; &nbsp; &nbsp; ?<br />&nbsp; BaudRate&nbsp; &nbsp; &nbsp; DWORD&nbsp; &nbsp; &nbsp;  ?<br />&nbsp; fbits&nbsp; &nbsp; &nbsp; &nbsp;  BITRECORD&nbsp; &nbsp; &nbsp; &lt;&gt;<br />&nbsp; wReserved&nbsp; &nbsp;  WORD&nbsp; &nbsp; &nbsp;  ?<br />&nbsp; XonLim&nbsp; &nbsp; &nbsp; &nbsp; WORD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ?<br />&nbsp; XoffLim&nbsp; &nbsp; &nbsp;  WORD&nbsp; &nbsp; &nbsp; &nbsp;  ?<br />&nbsp; ByteSize&nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp; &nbsp; ?<br />&nbsp; Parity&nbsp; &nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ?<br />&nbsp; StopBits&nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp; &nbsp; ?<br />&nbsp; XonChar&nbsp; &nbsp; &nbsp;  BYTE&nbsp; &nbsp; &nbsp; &nbsp;  ?<br />&nbsp; XoffChar&nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp; &nbsp; ?<br />&nbsp; ErrorChar&nbsp; &nbsp;  BYTE&nbsp; &nbsp; &nbsp;  ?<br />&nbsp; EofChar&nbsp; &nbsp; &nbsp;  BYTE&nbsp; &nbsp; &nbsp; &nbsp;  ?<br />&nbsp; EvtChar&nbsp; &nbsp; &nbsp;  BYTE&nbsp; &nbsp; &nbsp; &nbsp;  ?<br />&nbsp; wReserved1&nbsp; &nbsp; WORD&nbsp; &nbsp; &nbsp;  ?<br />DCB ENDS</code></pre><br />The problem is with the BITRECORD, because it&#39;s totally mirrored in comparison with the MSDN description:<br /><pre><code>typedef struct _DCB {<br />&nbsp; DWORD DCBlength;<br />&nbsp; DWORD BaudRate;<br />&nbsp; DWORD fBinary&nbsp; :1;<br />&nbsp; DWORD fParity&nbsp; :1;<br />&nbsp; DWORD fOutxCtsFlow&nbsp; :1;<br />&nbsp; DWORD fOutxDsrFlow&nbsp; :1;<br />&nbsp; DWORD fDtrControl&nbsp; :2;<br />&nbsp; DWORD fDsrSensitivity&nbsp; :1;<br />&nbsp; DWORD fTXContinueOnXoff&nbsp; :1;<br />&nbsp; DWORD fOutX&nbsp; :1;<br />&nbsp; DWORD fInX&nbsp; :1;<br />&nbsp; DWORD fErrorChar&nbsp; :1;<br />&nbsp; DWORD fNull&nbsp; :1;<br />&nbsp; DWORD fRtsControl&nbsp; :2;<br />&nbsp; DWORD fAbortOnError&nbsp; :1;<br />&nbsp; DWORD fDummy2&nbsp; :17;<br />&nbsp; WORD wReserved;<br />&nbsp; WORD XonLim;<br />&nbsp; WORD XoffLim;<br />&nbsp; BYTE ByteSize;<br />&nbsp; BYTE Parity;<br />&nbsp; BYTE StopBits;<br />&nbsp; char XonChar;<br />&nbsp; char XoffChar;<br />&nbsp; char ErrorChar;<br />&nbsp; char EofChar;<br />&nbsp; char EvtChar;<br />&nbsp; WORD wReserved1;<br />} DCB;</code></pre><br />In C++ a bitfield starts with the <strong>LSB</strong>. So fBinary is on the first bit position. In Assembly language a RECORD starts with the <strong>MSB</strong>, wich is totally opposed to the C++.<br /><strong>MASK fBinary</strong> is equal with <em>8000 0000h</em> and it should be equal with <strong>0000 0001h</strong>.<br />The correct line would be:<br /><pre><code>BITRECORD RECORD fDummy2:17,fAbortOnError:1,fRtsControl:2,fNull:1,fErrorChar:1,fInX:1,fOutX:1,fTXContinueOnXoff:1,fDsrSensitivity:1,fDtrControl:2,fOutxDsrFlow:1,fOutxCtsFlow:1,fParity:1,fBinary:1<br /></code></pre><br /><br />I think It would be great to change this in the future releases of the <strong>windows.inc</strong>.<br />BTW i&#39;m using the MASM package.</div>
    <div class="meta">Posted on 2005-05-04 13:27:27 by bszente</div>
   </div>
  </div>
 </body>
</html>