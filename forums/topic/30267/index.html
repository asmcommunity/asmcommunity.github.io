<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>56h Renaming - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30267" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=30267">56h Renaming</a></p>
   <div class="post" id="post-213289">
    <div class="subject"><a href="#post-213289">56h Renaming</a></div>
    <div class="body">Greetings!<br /><br />I was asked to make a &#039;rename&#039; command using INT 21h/56h by doing the following:<br />1. Ask the user to enter the file he wants the name to be changed<br />2. Ask the name of the file that will be used as the new filename.<br />3. Return error codes depending on the situation.<br /><br />With this code<br /><pre><code><br />;File fren<br />.model small<br />.code<br /><br />org 100h<br /><br />start:<br />jmp fren<br />prompt		db	&quot;File to rename? $&quot;<br />prompt2		db	&quot;Rename as what? $&quot;<br />rename_msg	db	&quot;File renamed. $&quot;<br />err_nf		db	&quot;File not found. $&quot;<br />err_ip		db	&quot;Invalid path. $&quot;<br />err_ad		db	&quot;Access denied. $&quot;<br />err_nsd		db	&quot;Not same device. $&quot;<br />characters&nbsp; db&nbsp; 50 dup(0)<br />bytes_typed db&nbsp; 0<br />old		&nbsp; &nbsp; db	30 dup,?, 30 DUP(&#039; &#039;)<br />new		&nbsp; &nbsp; db	30 dup,?, 30 DUP(&#039; &#039;)<br /><br />fren proc near<br />file1:<br />mov dx, offset prompt<br />mov ah, 9<br />int 21h<br />mov ah, 0ah<br />mov dx, offset old<br />int 21h<br />mov bh,0<br />mov bl, bytes_typed<br />add bx, offset characters<br />mov byte ptr, 0<br />mov dx, offset characters<br />jmp file2<br /><br />file2:<br />mov dx, offset prompt2<br />mov ah, 9<br />int 21h<br />mov ah, 0ah<br />mov dx, offset new<br />int 21h<br />mov bh,0<br />mov bl, bytes_typed<br />add bx, offset characters<br />mov byte ptr, 0<br />mov dx, offset characters<br />jmp rename<br /><br />rename:<br />mov ah,56h <br />lea dx,old&nbsp; <br />lea di,new&nbsp; <br />int 21h<br />cmp ax, 02h<br />je errnotfound<br />cmp ax, 03h<br />je errinvpath<br />cmp ax, 05h<br />je erraccden<br />cmp ax, 11h<br />je errnotsame<br />jmp display<br /><br />errnotfound: <br />lea dx, err_nf<br />mov ah, 9<br />int 21h<br />jmp end<br /><br />errinvpath: <br />lea dx, err_ip<br />mov ah, 9<br />int 21h<br />jmp end<br /><br />erraccden: <br />lea dx, err_ad<br />mov ah, 9<br />int 21h<br />jmp end<br /><br />errnotsame: <br />lea dx, err_nsd<br />mov ah, 9<br />int 21h<br />jmp end<br /><br />display:<br />lea dx, rename_msg <br />mov ah,09h <br />int 21h <br />jmp end<br /><br />end:<br />int 20h<br /><br />fren endp <br />end start<br /></code></pre><br /><br />The program will ask me the file to rename and what its new name should be. However, it will always return an invalid path error.<br /><br />I just based this rename program from a &#039;delete&#039; program (which works):<br /><br /><pre><code><br />.model small<br />.code<br /><br />org 100h<br /><br />start:<br />jmp rubout<br />the_buffer&nbsp; &nbsp;  db&nbsp; 50<br />bytes_typed&nbsp; &nbsp; db&nbsp; 0<br />characters&nbsp; &nbsp;  db&nbsp; 50 dup(0)<br />prompt&nbsp; &nbsp; &nbsp; &nbsp;  db&nbsp; &quot;File to delete? $&quot;<br />ok_msg&nbsp; &nbsp; &nbsp; &nbsp;  db&nbsp; &quot;baleeted, lulz $&quot;<br />not_found_msg&nbsp; db&nbsp; &quot;Not found. $&quot;<br />deny_msg&nbsp; &nbsp; &nbsp;  db&nbsp; &quot;Access denied. Close file to delete first. $&quot;<br /><br />rubout proc near<br />mov dx, offset prompt<br />mov ah, 9<br />int 21h<br />mov ah, 0ah<br />mov dx, offset the_buffer<br />int 21h<br />mov bh,0<br />mov bl, bytes_typed<br />add bx, offset characters<br />mov byte ptr, 0<br />mov dx, offset characters<br />mov ah, 41h<br />int 21h<br />jnc ok<br />cmp al, 2<br />je not_found<br />cmp al, 5<br />je deny<br /><br />not_found:<br />mov dh, 10<br />mov dl, 0<br />mov bh, 0<br />mov ah, 2<br />int 10h&nbsp;  <br />mov dx, offset not_found_msg<br />mov ah, 9<br />int 21h<br />jmp exit<br /><br />deny:<br />mov dh, 10<br />mov dl, 0<br />mov bh, 0<br />mov ah, 2<br />int 10h<br />mov dx, offset deny_msg<br />mov ah, 9<br />int 21h<br />jmp exit<br /><br />ok:<br />mov dh, 10<br />mov dl, 0<br />mov bh, 0<br />mov ah, 2<br />int 10h<br />mov dx, offset ok_msg<br />mov ah, 9<br />int 21h<br />jmp exit<br /><br />exit:<br />int 20h<br /><br />rubout endp<br />end start<br /></code></pre><br /><br />I hope someone could help. Many thanks.</div>
    <div class="meta">Posted on 2010-10-05 09:18:52 by cf1709</div>
   </div>
   <div class="post" id="post-213290">
    <div class="subject"><a href="#post-213290">Re: 56h Renaming</a></div>
    <div class="body"><strong>cf1709</strong>,<br /><br />How do you think, why the original delete code author bothers to do this:<br /><pre><code><br />mov bh,0<br />mov bl, bytes_typed<br />add bx, offset characters<br />mov byte ptr, 0<br /></code></pre><br /><br />or why does he pass <strong>characters</strong> in <strong>dx</strong> to int21/41, while he uses <strong>the_buffer</strong> for int21/0A?</div>
    <div class="meta">Posted on 2010-10-05 11:18:00 by baldr</div>
   </div>
  </div>
 </body>
</html>