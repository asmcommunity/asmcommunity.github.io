<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Using fs reg - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10722" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=10722">Using fs reg</a></p>
   <div class="post" id="post-80633">
    <div class="subject"><a href="#post-80633">Using fs reg</a></div>
    <div class="body">Why does this line of code ...<br /><br /><pre><code>mov eax, dword ptr fs&#58;&#91;30h&#93;</code></pre><br /><br />... generate this error ...<br /><br /><pre><code>error A2108&#58; use of register assumed to ERROR</code></pre><br /><br />... when, in fact, using FS is allowed by windows ?<br /><br /><br /><br />aweX &lt;-<br /><br />P.S.: Windows.inc of MASMv8 is still missing HFILE_ERROR EQU -1</div>
    <div class="meta">Posted on 2003-02-09 05:27:36 by aweX</div>
   </div>
   <div class="post" id="post-80651">
    <div class="subject"><a href="#post-80651">Using fs reg</a></div>
    <div class="body">assume fs: nothing</div>
    <div class="meta">Posted on 2003-02-09 07:10:38 by LaptoniC</div>
   </div>
   <div class="post" id="post-80654">
    <div class="subject"><a href="#post-80654">Using fs reg</a></div>
    <div class="body">Thanks very much.<br /><br />What's the standard assume for fs anyways? fs:code ?</div>
    <div class="meta">Posted on 2003-02-09 07:19:37 by aweX</div>
   </div>
   <div class="post" id="post-81796">
    <div class="subject"><a href="#post-81796">Using fs reg</a></div>
    <div class="body">assume fs:error - as the message suggests.</div>
    <div class="meta">Posted on 2003-02-14 13:27:05 by stormix</div>
   </div>
   <div class="post" id="post-83044">
    <div class="subject"><a href="#post-83044">Using fs reg</a></div>
    <div class="body">FYI: The FS is used by Windows differently in user and kernel mode. In kernel mode it points to the KPCR (kernel processor control region) that contains the global info about the current state of all processors in the compluter. In user mode it points to the TEB (Thread Environment Block) that contains info about the currently running thread. Both structures are almost undocumented and differs on 9x and NTs.<br /><br />I restored these structures for Win 2K, so if you are interested I can send you their description.<br /><br />Regards,<br />Yury</div>
    <div class="meta">Posted on 2003-02-21 22:21:11 by Yury Lukach</div>
   </div>
   <div class="post" id="post-83070">
    <div class="subject"><a href="#post-83070">Using fs reg</a></div>
    <div class="body"><div class="quote"><br />I restored these structures for Win 2K, so if you are interested I can send you their description.</div>Why not post it here? It's surely of general interest.</div>
    <div class="meta">Posted on 2003-02-22 03:03:44 by Maverick</div>
   </div>
   <div class="post" id="post-83216">
    <div class="subject"><a href="#post-83216">Using fs reg</a></div>
    <div class="body">Here is a very raw version of my &quot;Through The Window Glass&quot; project that will describe Windows NT kernel. Currently I've restored internal structures of the Win 2k kernel. Almost all of them were extracted from the Microsoft official symbol files and so are authentical. The rare exceptions are marked in my headers as &quot;Non-MS&quot;.<br /><br />This archive also contains the kernel function prototypes but this work have started<br />only some days ago...<br /><br />Regards,<br />Yury</div>
    <div class="meta">Posted on 2003-02-22 23:31:13 by Yury Lukach</div>
   </div>
   <div class="post" id="post-83391">
    <div class="subject"><a href="#post-83391">Using fs reg</a></div>
    <div class="body">Nice work, Yuri.<br /><br />I found out that there's an explanation of the Thread Information Block (fs:)<br />by Matt Pietrek: <a target="_blank" href="http://www.microsoft.com/msj/archive/s2ce.htm">http://www.microsoft.com/msj/archive/s2ce.htm</a><br />Includes header file and example source. This guy rules ...<br /><br />&quot;<em>Let's say that you've written the world's coolest exception handler.<br />When something bad happens, your handler diagnoses the problem,<br />logs relevant details, solves world hunger, and cancels the mind-numbing<br />weekly staff meeting. </em>&quot;<br />- Matt Pietrek in &quot;New Vectored Exception Handling in Windows XP&quot;<br /><br />aweX &lt;-</div>
    <div class="meta">Posted on 2003-02-24 00:00:45 by aweX</div>
   </div>
  </div>
 </body>
</html>