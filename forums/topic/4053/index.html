<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Need help with FPU storing fractional numbers - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4053" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=4053">Need help with FPU storing fractional numbers</a></p>
   <div class="post" id="post-27668">
    <div class="subject"><a href="#post-27668">Need help with FPU storing fractional numbers</a></div>
    <div class="body">Hello all,<br /><br />i coded a small routine to stretch bitmaps proporcionally, using FPU aritmethic instructions.<br /><br />The problem is when is stores the value (fistp var3_WidthRatio ;----Beginning 2.3625), it just record the integer (2), not the rest.<br /><br />How can i make them store the hole result for use on another part of the code ?<br /><br />The code is:<br /><br />; ##################################################<br />####################### <br /><br />Paint_Proc proc hWin:DWORD, hDC:DWORD <br /><br />LOCAL hOld:DWORD <br />LOCAL memDC :DWORD <br /><br />LOCAL rect:RECT <br />LOCAL bmpWdt :DWORD ; The value of the final Width of BMP <br />LOCAL bmpHdt :DWORD ; The value of the final Heigth of BMP <br />LOCAL var1_BmpWidthOriginal : REAL4 <br />LOCAL var2_BmpHeightOriginal : REAL4 <br />LOCAL var3_WidthRatio : REAL4 <br />LOCAL var4_HeightRatio : REAL4 <br /><br /><br />invoke CreateCompatibleDC,hDC ; create memory device context <br />mov memDC, eax <br /><br />invoke SelectObject,memDC,hBmp ; select bitmap handle into it <br />mov hOld, eax <br /><br />invoke GetClientRect,hWnd,addr rect <br /><br />.if movit == 0 <br />; ------------------- <br />; for normal repaint <br />; ------------------- <br /><br />; ----------Calculate the Width ratio (Client Width / Bmp Width) <br /><br />mov var1_BmpWidthOriginal,320 ; Original value of the bitmap width <br />mov eax,rect.right ; 02F4 (756) in my case for client width <br />mov WidthClient,eax ; WidthClient = 02F4 (756) <br />fild WidthClient ; Store it (756) <br />fidiv var1_BmpWidthOriginal ; divide 756/320 <br />fistp var3_WidthRatio ;----Beginning 2.3625 <br /><br /><br />; ----------Calculate the Height ratio (Client Height / Bmp Height) <br /><br />mov var2_BmpHeightOriginal,240 <br />mov ebx,rect.bottom ; 020E (526) in my case for client height <br />mov HeightClient,ebx <br />fild HeightClient <br />fidiv var2_BmpHeightOriginal ; 526/240 <br />fistp var4_HeightRatio ;----Beginning 2.1916666666666 <br /><br /><br /><br />mov bmpWdt,320 ; Width of the image = 320 <br /><br />mov bmpHdt,240 ; ---Height of the image <br /><br /><br />fild var3_WidthRatio ; Routine to put WidthRatio to RatioBuffer data (can be ripped) <br />fidiv RatioBufferWidthClient <br />fistp RatioBufferWidthClient <br /><br />fild var4_HeightRatio ; Routine to put HeigthRatio to RatioBuffer data (can be ripped) <br />fidiv RatioBufferHeightClient <br />fistp RatioBufferHeightClient <br /><br />.else <br />; -------------------------- <br />; when you resize the window <br />; -------------------------- <br />; **************************************************<br />****** <br /><br />mov eax,rect.right ; Grab the value of the new client width <br /><br />mov bmpWdt,eax ; Small routine to calc the new bmp width. ;  bmpwdt=EAX=Widthclient <br />fild bmpWdt ; Store the value of the new client width <br />fidiv RatioBufferWidthClient ; Divide for the ratio stored (2.3625). The problem is the ratio is 2 not 2.3625 <br />; It can be divided by var3_WidthRatio, but the value is aproximated (no frations) <br />fistp bmpWdt ;(New value of bmp) ; Store as a new value for bmp width <br /><br /><br /><br />mov ebx,rect.bottom <br /><br />mov bmpHdt,ebx <br />fild bmpHdt <br />fidiv RatioBufferHeightClient ; Divide for the ratio stored (2.1916666666666). The problem is the ratio is 2 not 2.1916666666666 <br />; It can be divided by var4_HeightRatio, but the value is aproximated (no frations) <br />fistp bmpHdt ;(New value of bmp) <br /><br />.endif <br /><br />mov eax,rect.right ; Routine to calc the coord of X point of the source (bitmap width) <br />sub eax,bmpWdt <br />shr eax,1 ; (ClientWidht-BitmapWidth)/2 <br /><br />mov ebx,rect.bottom ; Routine to calc the coord of Y point of the source (bitmap heigth) <br />sub ebx,bmpHdt <br />shr ebx,1 ; (ClientHeidht-BitmapHeidth)/2 <br /><br />invoke StretchBlt,hDC,eax,ebx,bmpWdt,bmpHdt,memDC,0,0,320<br />,240,SRCCOPY <br /><br />mov movit,1 <br /><br />invoke SelectObject,hDC,hOld ; reselect the old object <br />invoke DeleteDC,memDC ; delete the memory device context <br /><br />return 0 <br /><br /><br />Paint_Proc endp <br /><br /><br />________________________________ <br /><br />How to make fistp stores and frational number 2.3625 and 2.1916666666666  (for height ratio) ? <br />It just grabbs &quot;2&quot;, instead the rest after the dot. <br /><br />That's why the image seems to jump a little. But it alters all the ratio to 2, instead the proper values.<br /><br />The file with the original questions was posted at<br /><br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=3881">First Message</a></div>
    <div class="meta">Posted on 2002-03-07 11:38:47 by Beyond2000!</div>
   </div>
   <div class="post" id="post-27671">
    <div class="subject"><a href="#post-27671">Need help with FPU storing fractional numbers</a></div>
    <div class="body"><strong>fstp</strong> to store the real.<br /><strong>fistp</strong> to store the integer.</div>
    <div class="meta">Posted on 2002-03-07 11:48:54 by bitRAKE</div>
   </div>
   <div class="post" id="post-27680">
    <div class="subject"><a href="#post-27680">Need help with FPU storing fractional numbers</a></div>
    <div class="body">Tks Bitrake,<br /><br />but changing to fstp var3_WidthRatio, is not working.<br /><br />The image is gone after clicking on the windows.<br /><br />It?s not holding the hole value, it?s doing something else<br /><br />For instance:<br /><br />at fstp var3_WidthRatio<br />St=1,834999999 (according to my client rect now)<br />stack ss:[0064FAA8]=-1,351212e-36<br /><br /><br />Increasing a fild var3_WidthRatio (to see wich value he is grabbing)<br /><br />Shows that <br />stack ss:[0064FAA8]=3FEB3333 (decimal 1072378675)<br /><br />The stack ss:[0064FAA8] (var3_WidthRatio)<br />is grabbing a hugh value, instead 1,8439999<br /><br />I read about fstp (0) (2) and stuff....i don?t know how to make them work putting on the stack just 1,8439999.</div>
    <div class="meta">Posted on 2002-03-07 12:41:54 by Beyond2000!</div>
   </div>
   <div class="post" id="post-27681">
    <div class="subject"><a href="#post-27681">Need help with FPU storing fractional numbers</a></div>
    <div class="body">If you <strong>fstp</strong>, the FPU stores an IEEE floating point number - this is a special format.  To use this number you must not use the FPU instructions with the <strong>i</strong> - it is not an integer.  You might have to store both formats for your algo?  Use the floating point number internally, and the integer externally.</div>
    <div class="meta">Posted on 2002-03-07 12:48:10 by bitRAKE</div>
   </div>
   <div class="post" id="post-27682">
    <div class="subject"><a href="#post-27682">Need help with FPU storing fractional numbers</a></div>
    <div class="body">I used fstp. i typed wrong<br /><br /><br />can you show me how to do it in the code ?<br /><br />I still don?t get it</div>
    <div class="meta">Posted on 2002-03-07 12:51:24 by Beyond2000!</div>
   </div>
   <div class="post" id="post-27689">
    <div class="subject"><a href="#post-27689">Need help with FPU storing fractional numbers</a></div>
    <div class="body">I've add some comments to the code:<pre><code>Paint_Proc proc hWin&#58;DWORD, hDC&#58;DWORD<br /><br />LOCAL hOld&#58;DWORD<br />LOCAL memDC &#58;DWORD<br /><br />LOCAL rect&#58;RECT<br />LOCAL bmpWdt &#58;DWORD ; The value of the final Width of BMP<br />LOCAL bmpHdt &#58;DWORD ; The value of the final Heigth of BMP<br /><br />; Although defined as REAL4 here, intergers are put into these<br />; as if they were DWORDS.  The data types are all mixed in the<br />; code below.<br />LOCAL var1_BmpWidthOriginal &#58; REAL4<br />LOCAL var2_BmpHeightOriginal &#58; REAL4<br />LOCAL var3_WidthRatio &#58; REAL4<br />LOCAL var4_HeightRatio &#58; REAL4<br /><br /><br />invoke CreateCompatibleDC,hDC ; create memory device context<br />mov memDC, eax<br /><br />invoke SelectObject,memDC,hBmp ; select bitmap handle into it <br />mov hOld, eax <br /><br />invoke GetClientRect,hWnd,addr rect <br /><br />.if movit == 0 <br />; ------------------- <br />; for normal repaint <br />; ------------------- <br /><br />; ----------Calculate the Width ratio &#40;Client Width / Bmp Width&#41; <br /><br />; var1_BmpWidthOriginal is defined as &#91;b&#93;REAL4&#91;/b&#93;, but used for &#91;b&#93;DWORD&#91;/b&#93;!<br />mov var1_BmpWidthOriginal, 320<br />mov eax,rect.right ; 02F4 &#40;756&#41; in my case for client width <br />mov WidthClient,eax ; WidthClient = 02F4 &#40;756&#41; <br />fild WidthClient ; Store it &#40;756&#41; -- &#91;b&#93;integer&#91;/b&#93;<br />; var1_BmpWidthOriginal is defined as &#91;b&#93;REAL4&#91;/b&#93;, but used for &#91;b&#93;DWORD&#91;/b&#93;!<br />fidiv var1_BmpWidthOriginal ; divide 756/320 -- &#91;b&#93;integer&#91;/b&#93;<br />fstp var3_WidthRatio ; Store -- &#91;b&#93;REAL4&#91;/b&#93;<br /><br /><br />; ----------Calculate the Height ratio &#40;Client Height / Bmp Height&#41; <br /><br />mov var2_BmpHeightOriginal, 240<br />mov ebx,rect.bottom ; 020E &#40;526&#41; in my case for client height<br />mov HeightClient,ebx<br />fild HeightClient<br />fidiv var2_BmpHeightOriginal ; 526/240 <br />fstp var4_HeightRatio ; Store -- &#91;b&#93;REAL4&#91;/b&#93;<br /><br /><br />mov bmpWdt,320 ; Width of the image = 320 <br /><br />mov bmpHdt,240 ; ---Height of the image <br /><br /><br />fld var3_WidthRatio ; -- &#91;b&#93;REAL4&#91;/b&#93;<br />fidiv RatioBufferWidthClient ; is this a DWORD or a REAL4?<br />fstp RatioBufferWidthClient<br /><br />fld var4_HeightRatio ; Store -- &#91;b&#93;REAL4&#91;/b&#93;<br />fidiv RatioBufferHeightClient ; &#40;same question?&#41;<br />; Must store a REAL4 here, if you want to use REAL4 down further...<br />fstp RatioBufferHeightClient <br /><br />.else <br />; -------------------------- <br />; when you resize the window <br />; -------------------------- <br />; **************************************************<br /><br />****** <br /><br />mov eax,rect.right ; Grab the value of the new client width <br /><br />mov bmpWdt,eax ; Small routine to calc the new bmp width. ; bmpwdt=EAX=Widthclient <br />fild bmpWdt ; Store the value of the new client width <br />fdiv RatioBufferWidthClient ; use &#91;b&#93;REAL4&#91;/b&#93;!<br />; this has to be &#91;b&#93;integer&#91;/b&#93; for external code use<br />fistp bmpWdt ;&#40;New value of bmp&#41; ; Store as a new value for bmp width <br /><br /><br /><br />mov ebx,rect.bottom<br /><br />mov bmpHdt,ebx<br />fild bmpHdt<br />fdiv RatioBufferHeightClient ; use &#91;b&#93;REAL4&#91;/b&#93;!<br />; this has to be &#91;b&#93;integer&#91;/b&#93; for external code use<br />fistp bmpHdt ;&#40;New value of bmp&#41;<br /><br />.endif<br /><br />mov eax,rect.right ; Routine to calc the coord of X point of the source &#40;bitmap width&#41;<br />sub eax,bmpWdt<br />shr eax,1 ; &#40;ClientWidht-BitmapWidth&#41;/2<br /><br />mov ebx,rect.bottom ; Routine to calc the coord of Y point of the source &#40;bitmap heigth&#41;<br />sub ebx,bmpHdt<br />shr ebx,1 ; &#40;ClientHeidht-BitmapHeidth&#41;/2<br /><br />invoke StretchBlt,hDC,eax,ebx,bmpWdt,bmpHdt,memDC,0,0,320<br /><br />,240,SRCCOPY<br /><br />mov movit,1<br /><br />invoke SelectObject,hDC,hOld ; reselect the old object<br />invoke DeleteDC,memDC ; delete the memory device context<br /><br />return 0<br /><br />Paint_Proc endp</code></pre>I didn't have a lot of time to re-write this.  If you still don't understand then maybe I can add more later, or you should real the section in the Intel manual on FPU.</div>
    <div class="meta">Posted on 2002-03-07 14:12:12 by bitRAKE</div>
   </div>
   <div class="post" id="post-27695">
    <div class="subject"><a href="#post-27695">Need help with FPU storing fractional numbers</a></div>
    <div class="body">tks a lot, Bitrake,<br /><br />i guess it?s working properly now.<br /><br />I tryed what you said, but i am not skill enough to correct this kinda error.<br /><br />About<br />fidiv RatioBufferWidthClient ; is this a DWORD or a REAL4?<br /><br />It was a dword, but now i fixed it do Real4.<br /><br />Before you answer I was trying to decrease the code parsing this part, in orther to<br /><br />mov bmpWdt,eax ; Small routine to calc the new bmp width. ; bmpwdt=EAX=Widthclient <br />fild bmpWdt ; Store the value of the new client width <br />fdiv RatioBufferWidthClient , changed to goes directly to var3_WidthRatio <br /><br />But it was not helping either.<br /><br />Then i did what you said, changind a dword to a real4 value...<br /><br />And now all seems to be Ok.<br /><br />i?m checking the proportional values, and i think they are correct.<br /><br />When i come home  i?ll up the file.<br /><br />This step was succesfully thanks to you, and now i?ll try to remove the flickering that appears, when resizing.<br /><br />I?m checking the tutorial on ELF, and another posts on the board.<br /><br />Tks a lot.</div>
    <div class="meta">Posted on 2002-03-07 15:06:37 by Beyond2000!</div>
   </div>
   <div class="post" id="post-27701">
    <div class="subject"><a href="#post-27701">Need help with FPU storing fractional numbers</a></div>
    <div class="body">The key is the letter <strong><span style="font-size:24px>i</span></strong> in the instruction.  That letter means the source is a DWORD, or in the case of <strong>fistp</strong>, that the destination is an <strong>i</strong>nteger (DWORD).</div>
    <div class="meta">Posted on 2002-03-07 15:34:22 by bitRAKE</div>
   </div>
   <div class="post" id="post-27732">
    <div class="subject"><a href="#post-27732">Done it</a></div>
    <div class="body">Ok all done.<br /><br /><br />I made a few modification on the code, in orther to optimize it.<br /><br /><br />Here it:<br /><br />.data<br /><br />(...)<br />	var4_HeightRatio REAL4 1.0<br />	var3_WidthRatio REAL4 1.0<br /><br />	movit dd 0<br /><br />.code<br />(...)<br />    .elseif uMsg == WM_CREATE<br />	mov movit ,0<br />	mov var4_HeightRatio,1<br />	mov var3_WidthRatio,1<br />(...)<br /><br />Paint_Proc proc hWin:DWORD, hDC:DWORD <br /><br />    LOCAL hOld:DWORD<br />    LOCAL memDC :DWORD<br /><br />    LOCAL rect:RECT<br />    LOCAL bmpWdt :DWORD ; The value of the final Width of BMP<br />    LOCAL bmpHdt :DWORD ; The value of the final Heigth of BMP<br />    LOCAL var1_BmpWidthOriginal : DWORD<br />    LOCAL var2_BmpHeightOriginal : DWORD<br /><br /><br />    invoke CreateCompatibleDC,hDC   ; create memory device context<br />    mov memDC, eax<br />    <br />    invoke SelectObject,memDC,hBmp  ; select bitmap handle into it<br />    mov hOld, eax<br /><br />    invoke GetClientRect,hWnd,addr rect<br /><br />    .if movit == 0<br />  ; -------------------<br />  ; for normal repaint<br />  ; -------------------<br /><br />; ----------Calculate the Width ratio (Client Width / Bmp Width)<br /><br />	mov var1_BmpWidthOriginal,320 ; Original value of the bitmap width<br />	mov eax,rect.right		; 02F4 (756) in my case for client width<br />	mov WidthClient,eax		; WidthClient = 02F4 (756)<br />	fild WidthClient		; Store it (756) -- integer<br /><br /><br />	fidiv var1_BmpWidthOriginal	; divide 756/320 -- integer<br />	fstp var3_WidthRatio ;----Beginning 2.3625  Store -- REAL4<br /><br /><br />; ----------Calculate the Height ratio (Client Height / Bmp Height)<br /><br />	mov var2_BmpHeightOriginal,240<br />	mov ebx,rect.bottom		; 020E (526) in my case for client height<br />	mov HeightClient,ebx<br />	fild HeightClient<br />	fidiv var2_BmpHeightOriginal	; 526/240<br />	fstp var4_HeightRatio ;----Beginning 2.1916666666666  Store -- REAL4<br /><br /><br /><br />	mov bmpWdt,320	; Width of the image = 320<br /><br />	mov bmpHdt,240   ; ---Height of the image<br /><br /><br />    .else<br />  ; --------------------------<br />  ; when you resize the window<br />  ; --------------------------<br />    ; ********************************************************<br /><br />	mov eax,rect.right	;	Grab the value of the new client width<br /><br />	mov bmpWdt,eax	; Small routine to calc the new bmp width. bmpwdt=EAX=Widthclient<br />	fild bmpWdt	; Store the value of the new client width<br />	fdiv var3_WidthRatio ; Divide for the ratio stored (2.3625).<br />					; used REAL4!<br />					; this has to be integer for external code use<br />	fistp bmpWdt ;(New value of bmp) ; Store as a new value for bmp width<br /><br /><br /><br />	mov ebx,rect.bottom<br /><br />	mov bmpHdt,ebx<br />	fild bmpHdt<br />	fdiv var4_HeightRatio ; Divide for the ratio stored (2.1916666666666).<br />					; used REAL4!<br />					; this has to be integer for external code use<br />	fistp bmpHdt ;(New value of bmp)<br /><br />    .endif<br /><br />	mov eax,rect.right ; Routine to calc the coord of X point of the source (bitmap width)<br />	sub eax,bmpWdt<br />	shr eax,1	; (ClientWidht-BitmapWidth)/2<br /><br />	mov ebx,rect.bottom ; Routine to calc the coord of Y point of the source (bitmap heigth)<br />	sub ebx,bmpHdt<br />	shr ebx,1	; (ClientHeidht-BitmapHeidth)/2<br /><br />	invoke StretchBlt,hDC,eax,ebx,bmpWdt,bmpHdt,memDC,0,0,320,240,SRCCOPY<br /><br />	mov movit,1<br /><br />    invoke SelectObject,hDC,hOld    ; reselect the old object<br />    invoke DeleteDC,memDC           ; delete the memory device context<br /><br />    return 0<br /><br /><br />Paint_Proc endp<br /><br /> ------- ONLY problem with flickering on NT/2k ----- i'm trying to fix it right now<br /><br />Here is the final file</div>
    <div class="meta">Posted on 2002-03-07 19:11:33 by Beyond2000!</div>
   </div>
   <div class="post" id="post-27744">
    <div class="subject"><a href="#post-27744">Need help with FPU storing fractional numbers</a></div>
    <div class="body"><strong>Beyond2000!</strong>, looks really good - very solid code.<pre><code>	.data?<br />var4_HeightRatio REAL4 ?<br />var3_WidthRatio REAL4 ?<br /><br />movit dd ?</code></pre>These are always initialized during<br />execution - don't really need to do both.</div>
    <div class="meta">Posted on 2002-03-07 20:00:16 by bitRAKE</div>
   </div>
   <div class="post" id="post-27748">
    <div class="subject"><a href="#post-27748">Ok</a></div>
    <div class="body">Tks again  bitRAKE <br /> <br /> I changed to dd ?<br /><br /><br />Thanks for the complement too  :alright: <br /><br /><br />I'm trying to solve the flickering.<br /><br />I am checking the instructions that E?in post.<br /><br />The app flicks on Win2K/NT. I'll try to code a backbuffer for it.<br /><br />I don't now hot to do it now, but i am looking for it.<br /><br />it doesn't sems to be so hard, i hope.<br /><br />Oh,....<br />i removed <br />    .elseif uMsg == WM_CREATE<br />;	mov movit ,0<br />;	mov var4_HeightRatio,1<br />;	mov var3_WidthRatio,1<br /><br />too.<br /><br />just using<br /><br />    .elseif uMsg == WM_CREATE<br />(...)<br /><br /><br />Oh, and it's using 968k to 1008k in memory usage. I assume this is due to the bitmap loading. The bigger the bitmap in resource more memory used.<br /><br />I'll see if i can use less memory even with bigger bitmaps. Like the function invoke    DeleteObject</div>
    <div class="meta">Posted on 2002-03-07 20:26:50 by Beyond2000!</div>
   </div>
   <div class="post" id="post-27780">
    <div class="subject"><a href="#post-27780">Still flickering</a></div>
    <div class="body">Neither E?in, or Chris Hobbs tutorials are helping<br /><br /><br />I don't know what is doing wrong.<br /><br />The is the altered code for eliminating screen flicker</div>
    <div class="meta">Posted on 2002-03-08 01:00:40 by Beyond2000!</div>
   </div>
   <div class="post" id="post-27836">
    <div class="subject"><a href="#post-27836">Need help with FPU storing fractional numbers</a></div>
    <div class="body">The problem here is that the CS_HREDRAW and CS_VREDRAW styles force a complete redraw of the window which you try to do as well. So remove them and add in the following code which does all the drawing first to a back buffer and then blits it to your window.<br /><br />In the data? section add <br /><pre><code>bDc dd ?<br />bBm dd ?<br />bBw dd ?<br />bBh dd ?</code></pre> <br />In the WM_CREATE message put<br /><pre><code>invoke CreateCompatibleDC,0<br />mov bDc,eax</code></pre> <br />In WM_SIZE <br /><pre><code>invoke InvalidateRect,hWnd,0,0</code></pre> <br />And in Paint_Proc after <br />GetClientRect <pre><code>    mov eax,rect.right<br />    mov edx,rect.bottom<br />    or  eax,0Fh<br />    or  edx,0Fh<br />    cmp eax,bBw<br />    jne Chg<br />    cmp edx,bBh<br />    je nChg<br />Chg&#58;mov bBw,eax<br />    mov bBh,edx<br />    invoke DeleteObject,bBm<br />    invoke CreateBitmap,bBw,bBh,1,32,0<br />    mov bBm,eax<br />    invoke SelectObject,bDc,eax<br />nChg&#58;<br />	<br />    invoke FillRect,bDc,addr rect,0</code></pre> <br />And replace StretchBlt with<br /><pre><code>invoke StretchBlt,bDc,eax,ebx,bmpWdt,bmpHdt,memDC,0,0,320,240,SRCCOPY	<br />invoke BitBlt,hDC,0,0,rect.right,rect.bottom,bDc,0,0,SRCCOPY</code></pre>And finally in WM_DESTROY <pre><code>invoke DeleteDC,bDc<br />invoke DeleteObject,bBm</code></pre></div>
    <div class="meta">Posted on 2002-03-08 07:20:24 by Eóin</div>
   </div>
   <div class="post" id="post-27849">
    <div class="subject"><a href="#post-27849">Eoin</a></div>
    <div class="body">Tks a lot Eoin.<br /><br /><br />Is the backbuffer responsable for the white screen ? I mean , can i change to the windows color (gray, black etc) ?<br /><br />Or if i change the background with an menu, is this the responsable ?<br />	invoke CreateBitmap,bBw,bBh,1,32,0<br /><br />On win98 the central image is not being shown.<br /><br />I had to change to what Bitrake told<br /><br />.data?<br />	var4_HeightRatio REAL4 ?<br />	var3_WidthRatio REAL4 ?<br /><br />	movit dd ?<br />removed the related mov on  WM_CREATE.<br /><br />And changed<br /><br />	invoke StretchBlt,bDc,eax,ebx,bmpWdt,bmpHdt,memDC,0,0,320,240,SRCCOPY<br /><br />to<br />	invoke StretchBlt,hDC,eax,ebx,bmpWdt,bmpHdt,memDC,0,0,320,240,SRCCOPY.<br /><br />I didn?t test on win2k yet (i?m not at home now).<br /><br />If it stills don?t work on win2k after those changes, maybe The<br />Paint_Proc function should have another variable.<br /><br />Like:<br /><br />Paint_Proc proc hWin:DWORD, hDC:DWORD,bDC:DWORD<br /><br />and remove bDC from the data? section.<br /><br /><br />Or it could have 02 calls. Like (this work on W98):<br /><br />invoke StretchBlt,hDC,eax,ebx,bmpWdt,bmpHdt,memDC,0,0,320,240,SRCCOPY<br /><br />invoke StretchBlt,bDc,eax,ebx,bmpWdt,bmpHdt,memDC,0,0,320,240,SRCCOPY<br /><br />invoke BitBlt,hDC,0,0,rect.right,rect.bottom,bDc,0,0,SRCCOPY<br /><br />I?ll test it later. If anyone can test it now....it will be welcome to report any bugs on the code.</div>
    <div class="meta">Posted on 2002-03-08 09:03:17 by Beyond2000!</div>
   </div>
   <div class="post" id="post-27867">
    <div class="subject"><a href="#post-27867">Btw</a></div>
    <div class="body">Here is the altered file</div>
    <div class="meta">Posted on 2002-03-08 11:24:35 by Beyond2000!</div>
   </div>
   <div class="post" id="post-28051">
    <div class="subject"><a href="#post-28051">Need help with FPU storing fractional numbers</a></div>
    <div class="body">I noticed on the most recent file that you duplicated the StretchBlt function at the end of the Paint procedure. Once I commented one out it ran properly.<br /><br />Oh yeah I also had to remove the CS_xREDRAW styles from the WndClass struct at the start, that removed the flickering.<br /><pre><code>mov wc.style,          CS_BYTEALIGNWINDOW</code></pre> <br />As for the colour of the background, sure you can change it. I used FillRect with 0 as the brush parameter (the last one) so it defaulted to white. You can easily create your own brushs through the API, eg CreateSolidBrush .<br /><br />And if there was anything you want explained from the code just ask, I was busy yesterday so I didn't comment it. :rolleyes:</div>
    <div class="meta">Posted on 2002-03-09 12:52:08 by Eóin</div>
   </div>
  </div>
 </body>
</html>