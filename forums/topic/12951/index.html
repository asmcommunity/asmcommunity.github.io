<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Problems to build AsmCtrl.asm - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=12951" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=116">Windows</a> &raquo; <a href="../?id=12951">Problems to build AsmCtrl.asm</a></p>
   <div class="post" id="post-100684">
    <div class="subject"><a href="#post-100684">Problems to build AsmCtrl.asm</a></div>
    <div class="body">Hello guys,<br /><br />truth is that I'm new to COM but I have some experience with asm coding. I need to create small OCX webserver which will handle just file uploads. I tried to assemble Ernies and Japhets examples of AsmCtrl without success. My config is W2K SP3, MASM8, RadASM. By assembling Ernie's example I'm getting this:<br />in AsmCtrl.asm<br /><br />error A2111: conflicting parameter definition --&gt; line 336 = AboutBox  PROC this_:DWORD<br />error A2137: too few arguments to INVOKE --&gt; line 525 = invoke AboutBox,this_<br /><br />I tried to insert &quot;AboutBox PROTO :DWORD&quot; but without any luck. Still same error by make.<br /><br />with Japheth's example I got:<br />error A2004: symbol type conflict : LPSTREAM --&gt; objidl.inc, line 197 = LPSTREAM typedef ptr IStream<br />error A2004: symbol type conflict : PVOID --&gt; oaidl.inc, line 21 = PVOID	 typedef ptr<br />error A2004: symbol type conflict : LPWSTR --&gt; oaidl.inc, line 25 = LPWSTR typedef ptr WORD<br />error A2111: conflicting parameter definition --&gt; asmctrl.inc, line 99, DEFINE_COMHELPER macro on line 6<br /><br />after I changed names of LPSTREAM to newLPSTREAM and so on... I get rid of first A2004 errors but error in the macro was with definition of lstrlenW function in OleCntrl.inc like this:<br /><br />OleCntrl.inc line 1270 = lstrlenW proto pStr:ptr word<br />what I changed in lstrlenW proto :DWORD because this function is used in<br /><br />LocalToWideChar PROC public pWide:LPWSTR, pLocal:LPSTR,  dwChars:DWORD<br /><br />	mov	eax, pWide<br />	mov	WORD PTR , 0<br /><br />ifdef UNICODE<br />	invoke lstrcpyn, pWide, pLocal, dwChars<br />else<br />	invoke MultiByteToWideChar, CP_ACP, 0, pLocal, -1, pWide, dwChars<br />endif<br /><br />	invoke lstrlenW, pWide<br /><br />	ret<br />LocalToWideChar ENDP<br /><br />then I was able to assemble it without errors but by linking I got these errors:<br /><br />Creating library AsmCtrl.lib and object AsmCtrl.exp<br />asmctrl.obj : error LNK2001: unresolved external symbol _GUID_NULL<br />asmctrl.obj : error LNK2001: unresolved external symbol _IID_IUnknown<br />and so on... whole bunch of them<br /><br />Does anybody know what I'm doing wrong, problem is that examples will not even build in original state so if somebody succseded in that problem can be on my machine. I hope somebody can advice my.<br /><br />Thanks<br /><br />frankie</div>
    <div class="meta">Posted on 2003-05-02 02:28:33 by frankie</div>
   </div>
   <div class="post" id="post-100765">
    <div class="subject"><a href="#post-100765">hmm I succeed partially</a></div>
    <div class="body">well guys after some struggling I managed to build Ernie's example by fixing of AboutBox procedure definition to:<br /><br /><pre><code><br />myAboutBox PROTO &#58;DWORD<br /><br /></code></pre><br /><br />but there is problem with this ocx. When I try to insert it in MSVC TestContainer its crashing with err message &quot;referenced memory could not be written&quot;. What's wrong with this? Regarding Japheth's example I'm still getting bunch of &quot;error LNK2001: unresolved external symbol&quot; like this:<br /><br /><pre><code><br /> Assembling&#58; asmctrl.asm<br /> Assembling&#58; casmclass.asm<br />   Creating library AsmCtrl.lib and object AsmCtrl.exp<br />asmctrl.obj &#58; error LNK2001&#58; unresolved external symbol _GUID_NULL<br />asmctrl.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IUnknown<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IUnknown<br />asmctrl.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IClassFactory<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IPersist<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IPersistStorage<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IOleObject<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IOleWindow<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IOleInPlaceFrame<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IOleInPlaceObject<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IOleInPlaceActiveObject<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IViewObject<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IViewObject2<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IDispatch<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IProvideClassInfo<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IEnumConnections<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IConnectionPoint<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IEnumConnectionPoints<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IConnectionPointContainer<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IOleInPlaceSite<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IOleControl<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IOleControlSite<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IPersistStreamInit<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_IPersistPropertyBag<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _IID_ISpecifyPropertyPages<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _CLSID_StockFontPage<br />casmclass.obj &#58; error LNK2001&#58; unresolved external symbol _CLSID_StockColorPage<br />AsmCtrl.dll &#58; fatal error LNK1120&#58; 26 unresolved externals<br /></code></pre><br /><br />Well Japheth's build is not crashing TestContainer. I just can't build him :grin: <br />I would be really happy if some of our COM guru can point me what's wrong.<br /><br />Thanks in advance<br /><br />frankie</div>
    <div class="meta">Posted on 2003-05-02 09:23:20 by frankie</div>
   </div>
   <div class="post" id="post-100794">
    <div class="subject"><a href="#post-100794">Problems to build AsmCtrl.asm</a></div>
    <div class="body">Hi frankie,<br /><br />these - very annoying - errors are due to some incompatible changes made in MASM32 V8.0. The example was build with MASM32 V7. To get these missing IIDs dont use the libs from MASM32, but those from the SDK (or from MASM32 V7)<br /><br />Japheth</div>
    <div class="meta">Posted on 2003-05-02 11:46:17 by japheth</div>
   </div>
   <div class="post" id="post-100813">
    <div class="subject"><a href="#post-100813">thanks Japheth</a></div>
    <div class="body">I will surely try it,<br /><br />that was also my consideration, but I dint want to install complete MASM7 package just to try that.  Now when I know I will do that.  Thanks anyway. :alright:  Then when I will have time I try to optimize it for MASM8.  <br /><br />Thanks<br /><br />regards<br /><br />frankie</div>
    <div class="meta">Posted on 2003-05-02 15:50:59 by frankies</div>
   </div>
   <div class="post" id="post-101212">
    <div class="subject"><a href="#post-101212">Problems to build AsmCtrl.asm</a></div>
    <div class="body">Looks like I should revisit the samples and make some updates.<br /><br />Sorry, I'm still using MASM 7-something, and windows.inc 1.19<br /><br />They ain't broke so I don't fix em.</div>
    <div class="meta">Posted on 2003-05-04 22:51:59 by Ernie</div>
   </div>
  </div>
 </body>
</html>