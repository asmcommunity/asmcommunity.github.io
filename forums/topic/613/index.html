<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Creating a sphere in OpenGL - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=613" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=613">Creating a sphere in OpenGL</a></p>
   <div class="post" id="post-3668">
    <div class="subject"><a href="#post-3668">Creating a sphere in OpenGL</a></div>
    <div class="body">Hi Guys:<br /><br />My name is Michael.  I am a computer science student at<br />Purdue University.  Last semester I wrote, in C, an OpenGL<br />program that have two 3D balls in a room in motion.<br /><br />I now want to do this with MASM32.  My problem is how do I<br />create a sphere.  I can not get gluSphere to work.<br /><br />DrawGLScene proc<br />   invoke glClear, GL_COLOR_BUFFER_BIT or GL_DEPTH_BUFFER_BIT<br />   invoke glLoadIdentity                               ;reset modelview matrix<br />  _glMatrixMode GL_PROJECTION<br />  _glLoadIdentity<br />  _glFrustum -100.0f, 100.0f, -100.0f, 100.0f, 0.0f, 320.0f<br />  _glMatrixMode GL_MODELVIEW<br /> <br />   invoke gluNewQuadric<br />   mov quadricObj, eax<br /><br />      .if(eax == NULL)<br />         invoke MessageBox, 0, quadricObj, addr szError, MB_OK <br />      .else<br />         invoke gluQuadricTexture, quadricObj, GL_TRUE<br />         invoke gluQuadricDrawStyle, quadricObj, GLU_FILL<br />         _glColor3f 1.0f, 0.5f, 0.0f<br />         invoke gluSphere, quadricObj, 5, 5, 50, 50<br />      .endif<br />     <br />    mov eax, 1<br />    ret<br />DrawGLScene endp<br /><br />One strange problem:  The OpenGL shows the gluSphere<br />with 4 parameters.  But, the program, when assembled, complains<br />that there are too few parameters.  <br />I played with the gluSphere paramters and the _glFrustum.<br /><br />Question: When the gluNewQuadric create its pointer to the<br />quadricObj, is it in the eax register?  How do I reference it?<br />I tried addr quadricObj, , addr .<br />Do I use an &quot;assume&quot;, if yes, how?<br /><br /><br />Could someone help me here?  I am using MASM32 with:<br /><br />.586<br />.MODEL FLAT,STDCALL<br />option casemap:none<br />include \masm32\include\windows.inc<br />include \masm32\include\masm32.inc<br />include \masm32\include\mix.inc<br /><br />include \masm32\include\opengl\gl.def<br />include \masm32\include\opengl\glu.def<br /><br />include \masm32\include\opengl32.inc<br />include \masm32\include\glu32.inc<br />include \masm32\include\glaux.inc<br /><br />include \masm32\include\opengl\kernel32.inc<br />include \masm32\include\opengl\user32.inc<br />include \masm32\include\opengl\gdi32.inc<br />include \masm32\include\WinExtra\winextra.def<br />; include \masm32\m32lib\imalloc.asm<br /><br /><br />includelib \masm32\lib\masm32.lib<br />includelib \masm32\lib\opengl32.lib<br />includelib \masm32\lib\glu32.lib<br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\gdi32.lib<br />includelib \masm32\lib\mix.lib<br /><br />;------------------------------------------<br />thank you guys in advance.</div>
    <div class="meta">Posted on 2001-08-13 14:18:23 by Michael</div>
   </div>
   <div class="post" id="post-3677">
    <div class="subject"><a href="#post-3677">Creating a sphere in OpenGL</a></div>
    <div class="body">Afternoon, Michael.<br /><br />I don't know much about using OpenGL, however I'll see if I can help.;) <br /><br />First: 'gluNewQuadric' returns (in eax) a pointer to a 'GLUquadricObj'. Using 'mov quadricObj, eax ' is correct.<br />Question: Are you declaring 'quadricObj' as a PTR/DWORD?<br /><br />Second: There seems to be a problem with the 'gluSphere' proc. It's declared in the 'glu32.inc ' file as taking five arguments, however in the Platform SDK it only takes four.<br /><br /><pre><code>void gluSphere&#40;<br />  GLUquadricObj *qobj,<br />  GLdouble radius,<br />  GLint slices,<br />  GLint stacks<br />&#41;;</code></pre><br />This would mean that the declaration in the 'glu32.inc ' file should be:<br /><pre><code>gluSphere PROTO &#58;DWORD,&#58;QWORD,&#58;DWORD,&#58;DWORD</code></pre><br />... and to use it ...<br /><pre><code>invoke gluSphere, quadricObj, 5, 50, 50</code></pre><br /><br />To repeat:<br />The older versions of OpenGL may have used five arguments for the 'gluSphere' proc (don't know - don't care), however the latest version only uses four. This would depend on the version of the 'glu32.lib ' file you're using. If you're using the latest 'glu32.lib ' file from M$, then the declaration in 'glu32.inc '  will have to be changed.<br /><br />Hope some of this helps.<br /><br />Cheers,<br />Scronty</div>
    <div class="meta">Posted on 2001-08-13 17:23:35 by Scronty</div>
   </div>
   <div class="post" id="post-3689">
    <div class="subject"><a href="#post-3689">Creating a sphere in OpenGL</a></div>
    <div class="body">Fodders method should work grand if you wish to use memory variables to pass values. <br /><br />If however you wish to be ables to type numbers straight into your code as you can with the _glVertex MACROs you need to make one for gluSphere. Luckly for you I needed the same thing so I can give it to you:<br /><br />_gluSphere MACRO a,b,c,d<br />    push d				<br />    push c<br />    gl_dpush b<br />    push a<br />    mov eax, eax<br />    mov ecx, ecx<br />    call gluSphere<br />ENDM <br /><br />Example of use:<br />_gluSphere pQuad, 0.5f, 32, 32</div>
    <div class="meta">Posted on 2001-08-13 18:43:01 by Eóin</div>
   </div>
   <div class="post" id="post-3744">
    <div class="subject"><a href="#post-3744">Creating a sphere in OpenGL</a></div>
    <div class="body">Thank you Scronty:<br /><br />I define the quadricObj as a dword.  How do I define it as<br />a pointer?<br /><br />Also, I took the glu32.lib from my viual c++ 6.0 lib.  I then<br />used the l2inca command to get the glu32.inc.<br />Whe I check the glu32.inc it had 5 parameters, not 4 (by red book), for the gluSphere function.  If I try to use four parameters but the program will not link.  The assembler says there are too few parameters.  I need to know why.  Can you help?<br /><br />Michael</div>
    <div class="meta">Posted on 2001-08-14 11:08:56 by Michael</div>
   </div>
   <div class="post" id="post-3747">
    <div class="subject"><a href="#post-3747">Creating a sphere in OpenGL</a></div>
    <div class="body">Zadkiel thank you so much for the macro.<br /><br />Could you tell me more about fodder's method?<br /><br />Also, why did you move a register to itsel?  Are you zeroing<br />out the register?  I have seen:  xor eax, eax but not mov eax, eax<br /><br />Michael</div>
    <div class="meta">Posted on 2001-08-14 11:26:37 by Michael</div>
   </div>
   <div class="post" id="post-3753">
    <div class="subject"><a href="#post-3753">Creating a sphere in OpenGL</a></div>
    <div class="body">Actually I ment to say scronty, I had been just reading a reply by fodder and so I type in the wrong name. Sorry.<br /><br />Regarding the mov eax,eax I don't know why it has to be done acording to Serge Coban the author it has to done or the code won't work. Strange I know.</div>
    <div class="meta">Posted on 2001-08-14 12:33:53 by Eóin</div>
   </div>
   <div class="post" id="post-3757">
    <div class="subject"><a href="#post-3757">Creating a sphere in OpenGL</a></div>
    <div class="body">Correction:  The glu32.inc is showing five parameters (DWORD)<br />not four.  I used the l2inca from masm32 to build the<br />include file.  But the Opengl's red book shows four parameters<br />not five.  This is what I am trying to find out, why?<br /><br />I am now downloading the glsetup 1.2.1 from <a target="_blank" href="www.opengl.org">www.opengl.org</a> maybe the library file I borrowed from microsoft vc++ 6.0 was a old one.<br /><br />I am also wondering is there something wrong with the<br />l2inca from masm32.  I do not think so, because the program<br />will not link when I reduce the parameters from five to four<br />in the glu32.inc (made by l2inca).<br /><br />Also, why do the l2inca only make parameters with DWORD?<br />Some of the parameters are real (GLfloat), do I change these<br />parameters in the include files, or do I make use of Scronty's method to make a macro.<br /><br />Thank you all for helping me (and probably others).<br /><br />Michael</div>
    <div class="meta">Posted on 2001-08-14 13:22:51 by Michael</div>
   </div>
   <div class="post" id="post-3773">
    <div class="subject"><a href="#post-3773">Creating a sphere in OpenGL</a></div>
    <div class="body">Afternoon, Michael.<br /><br />It seems to me that the 'l2inca' utility checks the number of bytes associated with a given function, and then it generates parameters based on 'number-of-bytes / 4'.<br />i.e. (from Hutchs' utility 'L2extia':<br /><pre><code>externdef _imp__gluSphere@20&#58;PTR pr5<br />gluSphere equ &lt;_imp__gluSphere@20&gt;</code></pre><br />This is equivalent to:<br /><pre><code>gluSphere PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD</code></pre><br />The second parameter should be a QWORD (i.e. 2 x DWORD).<br /><br />The Macro that Zadkiel posted works because it's pushing a 'double' as the second parameter. This means that when using the '5 x DWORD' 'PROTO', the 'double' will be spread across the second and third DWORDs<br /><br />There's nothing wrong with the '*.lib's you're using. The 'PROTO' just needs a bit of adjustment.<br /><br />'invoke' has parameter-checking functionality, which means that it will check to see if you've supplied the same number of parameters as in the 'PROTO' declaration.<br /><br />In any case, if you wish to use an 'invoke', the 'PROTO' for 'gluSphere' will have to be changed.<br /><br />Hope this helps.<br /><br />Cheers,<br />Scronty</div>
    <div class="meta">Posted on 2001-08-14 17:33:21 by Scronty</div>
   </div>
   <div class="post" id="post-3778">
    <div class="subject"><a href="#post-3778">Creating a sphere in OpenGL</a></div>
    <div class="body">Hi Guys, what's missing?<br /><br /><br /><br />This is inside glu32.inc<br />-------------------------------------------<br />gluSphere PROTO :DWORD,:QWORD,:DWORD,:DWORD<br />-------------------------------------------<br />*<br /><br />This is in .data<br />-----------------------------<br />quadricObj  DWORD       NULL<br />-----------------------------<br /><br />*<br /><br />this is where gluSphere is invoked<br />----------------------------------------------------------------<br />DrawGLScene proc<br />   invoke glLoadIdentity                               <br />   _glMatrixMode GL_PROJECTION<br />   _glLoadIdentity<br />   _glFrustum -100.0f, 100.0f, -100.0f, 100.0f, 320.0f, 640.0f<br />   _glMatrixMode GL_MODELVIEW<br />   _glClear GL_DEPTH_BUFFER_BIT or GL_COLOR_BUFFER_BIT<br />   _glColor3f 1.0f, 1.0f, 0.0f<br />   invoke gluNewQuadric<br />   mov quadricObj, eax<br />   invoke gluSphere, quadricObj, 5, 50, 50<br />   mov eax, 1<br />   ret<br />DrawGLScene endp<br />--------------------------------------------------------------------<br />*<br /><br />this is the error message<br />-------------------------------------------------------------------<br />Microsoft (R) Macro Assembler Version 6.14.8444<br />Copyright (C) Microsoft Corp 1981-1997.  All rights reserved.<br /><br /> Assembling: c:\masm32\projects\ballroom\ballroom.asm<br />\masm32\include\glu32.inc(46) : error A2111: conflicting parameter definition<br />c:\masm32\projects\ballroom\ballroom.asm(485) : error A2137: too few arguments t<br />o INVOKE<br />_<br />Assembly Error<br />Press any key to continue . . .<br />--------------------------------------------------------------------<br />--------------------------------------------------------------------<br /><br />This is the macro<br />--------------------------------------------------------------------<br /> _gluSphere MACRO a,b,c,d <br />   push d <br />   push c <br />   gl_dpush b <br />   push a <br />   mov eax, eax <br />   mov ecx, ecx <br />   call gluSphere <br /> ENDM <br />----------------------------------------------------------------------<br /><br />*<br /><br />This is the macro version of gluSphere<br />----------------------------------------------------------------------<br />DrawGLScene proc<br />   invoke glLoadIdentity                               <br />   _glMatrixMode GL_PROJECTION<br />   _glLoadIdentity<br />   _glFrustum -100.0f, 100.0f, -100.0f, 100.0f, 320.0f, 640.0f<br />   _glMatrixMode GL_MODELVIEW<br />   _glClear GL_DEPTH_BUFFER_BIT or GL_COLOR_BUFFER_BIT<br />   _glColor3f 1.0f, 1.0f, 0.0f<br />   invoke gluNewQuadric<br />   mov quadricObj, eax<br />   _gluSphere quadricObj, 5, 50, 50<br />   mov eax, 1<br />   ret<br />DrawGLScene endp<br />-----------------------------------------------------------------------<br /><br />*<br /><br />Here is the error message<br />--------------------------------------------------------------------<br />Microsoft (R) Macro Assembler Version 6.14.8444<br />Copyright (C) Microsoft Corp 1981-1997.  All rights reserved.<br /><br /> Assembling: c:\masm32\projects\ballroom\ballroom.asm<br />\masm32\include\glu32.inc(46) : error A2111: conflicting parameter definition<br />_<br />Assembly Error<br />Press any key to continue . . .<br />-----------------------------------------------------------------------</div>
    <div class="meta">Posted on 2001-08-14 18:40:25 by Michael</div>
   </div>
   <div class="post" id="post-3785">
    <div class="subject"><a href="#post-3785">Creating a sphere in OpenGL</a></div>
    <div class="body">With the macro _gluSphere I can not even use a GLdouble<br />or GLfloat for the radius.<br /><br />With the invoke version of gluSphere, I realized I should had<br />use variables.  But, I still get the same error message even<br />with variables.<br /><br />How do we make a sphere in assembler language utilizing<br />OpenGL?<br /><br />Michael</div>
    <div class="meta">Posted on 2001-08-14 22:15:49 by Michael</div>
   </div>
   <div class="post" id="post-3833">
    <div class="subject"><a href="#post-3833">Creating a sphere in OpenGL</a></div>
    <div class="body">Michael,<br /><br />If the function prototype for gluSphere is the following, <br /><br /><pre><code><br />gluSphere PROTO &#58;DWORD,&#58;QWORD,&#58;DWORD,&#58;DWORD<br /></code></pre><br /><br />then,<br /><br />the calling syntax like <br /><br />invoke gluSphere, quadricObj, 5, 50, 50 <br /><br />will not work.<br /><br />Why?<br /><br />INVOKE always does a comparision of its parameter type.<br />You are passing an immediate value of 5. INVOKE in no way knows what its size is. So you get all error message.<br /><br />How to solve the problem?<br /><br />Method 1:<br /><br />Declare a variable in data section as DQ (8-byte) and use it.<br /><pre><code><br />.code<br />.386<br />.model flat, stdcall<br /><br />gluSphere PROTO &#58;DWORD,&#58;QWORD,&#58;DWORD,&#58;DWORD <br /><br />.data<br />d1	DQ	5.0<br /><br />.code<br /><br />start&#58;<br /><br />	Invoke	gluSphere, eax, d1, 50, 50<br /><br />end	start<br /></code></pre><br /><br />Method 2:<br /><br />If you don't want to use a variable then you can use stack directly as follows<br /><br /><pre><code><br /><br />        Push     50    ; stacks<br />        Push     50    ; slices<br />        Push     5      ; radius in 4-byte integer<br />        Fld      DWORD PTR &#91;esp&#93; ; Load 4-byte value to FPU<br />                                                ; in FPU you have 10-byte value<br />        ; We want to store 8-bytes value to stack for glusphere.<br />        ; At this point we have to remove 5 puhsed in the previous<br />        ; one. So we have 4-bytes in stack. Add 4 more bytes in <br />        ; stack.<br />        Sub      esp, 4   ;  4 more bytes<br />        Fstp     QWORD PTR &#91;esp&#93; ; Store as 8-byte value<br />        Push     eax    ; qObj<br />        Call     gluSphere ; OpenGL <br /><br /></code></pre><br /><br />Hope this helps.<br /><br />NOTE:<br />Before using MASM's built-in macro, first please try to understand what it does, then use it.</div>
    <div class="meta">Posted on 2001-08-15 17:51:39 by sjhenry</div>
   </div>
   <div class="post" id="post-3946">
    <div class="subject"><a href="#post-3946">Creating a sphere in OpenGL</a></div>
    <div class="body">Captain, we have whales!<br /><br />Thank you guys so much for helping me get off the ground.<br />I now know how to make a sphere in MASM using OpenGL.<br /><br />I will continue to update you all on the progress.<br />I will write a small program to share with everyone else<br />that may need this information.  Thank you so much!!!!!!!!!!!<br /><br /><br />Below is the fruit all of you help make. <br /><br /><br />inside glu.def<br />-------------------------------------------------------------<br />gluQuadricCallback PROTO :DWORD,:DWORD,:DWORD<br />gluQuadricDrawStyle PROTO :DWORD,:DWORD<br />gluQuadricNormals PROTO :DWORD,:DWORD<br />gluQuadricOrientation PROTO :DWORD,:DWORD<br />gluQuadricTexture PROTO :DWORD,:DWORD<br />gluSphere PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />-------------------------------------------------------------<br /><br /><br /><br />------- marco that works ------------------------------------<br />_gluSphere MACRO a,b,c,d <br />   push d <br />   push c <br />   push b <br />   fld   DWORD PTR  <br />   sub   esp, 4<br />   fstp  QWORD PTR <br />   push  a<br />   call gluSphere <br />ENDM<br />-------------------------------------------------------------<br /> <br /><br /><br />------------- data ---------------------------------------<br />quadricObj  DWORD       NULL<br />radius      GLfloat     2.0f<br />slices      DWORD       20<br />stacks      DWORD       20<br />-----------------------------------------------------------<br /><br /><br />------------ code -------------------------------------------<br />invoke gluNewQuadric<br />mov quadricObj, eax<br />invoke gluQuadricDrawStyle, quadricObj, GLU_LINE<br />invoke gluQuadricNormals, quadricObj, GLU_SMOOTH<br />invoke gluQuadricOrientation, quadricObj, GLU_OUTSIDE<br />invoke gluQuadricOrientation, quadricObj, GL_TRUE<br />_glColor3f   1.0f, 1.0f, 0.0f<br />_gluSphere quadricObj, radius, slices, stacks<br />------------------------------------------------------------</div>
    <div class="meta">Posted on 2001-08-17 02:19:30 by Michael</div>
   </div>
   <div class="post" id="post-4266">
    <div class="subject"><a href="#post-4266">Creating a sphere in OpenGL</a></div>
    <div class="body">I took an existing opengl program, lesson05, and added<br />the sphere.<br /><br />Michael</div>
    <div class="meta">Posted on 2001-08-20 17:22:31 by Michael</div>
   </div>
   <div class="post" id="post-5702">
    <div class="subject"><a href="#post-5702">Creating a sphere in OpenGL</a></div>
    <div class="body">wow this answered a lot of my questions.. thanks guys!</div>
    <div class="meta">Posted on 2001-09-01 12:15:26 by closed_casket</div>
   </div>
  </div>
 </body>
</html>