<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>data in .code section - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=18370" />
    <link rel="next" href="../?id=18370&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=18370">data in .code section</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=18370&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=18370&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="18370" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=18370&amp;page=2">&gt;</a><a href="../?id=18370&amp;page=3">&raquo;</a></form>   <div class="post" id="post-142325">
    <div class="subject"><a href="#post-142325">data in .code section</a></div>
    <div class="body">Can the following mixture of data into code section be possible??<br /><br />.code<br /><br />start:<br /><br />; ??????????????????????????????????????<br />invoke MessageBox,0,ADDR txt,ADDR cap,MB_OK<br /><br />txt db &quot;Hello! It WOrked!!&quot;,0<br />cap db &quot;Yeah!&quot;,0<br /><br />; ??????????????????????????????????????<br /><br />end start<br /><br />:stupid:</div>
    <div class="meta">Posted on 2004-05-28 14:01:09 by telophase</div>
   </div>
   <div class="post" id="post-142326">
    <div class="subject"><a href="#post-142326">.data in .code section</a></div>
    <div class="body">You can have code, data and whatnot in one section.<br />Just be careful to not execute data ;)  and to set section attributes to writable if necessary.</div>
    <div class="meta">Posted on 2004-05-28 14:04:42 by omega_red</div>
   </div>
   <div class="post" id="post-142327">
    <div class="subject"><a href="#post-142327">.data in .code section</a></div>
    <div class="body">how do i do the above thing i tried compiling the above posted code of mine but cant seem to get it<br /><br />I get errors while compiling can u elaborate more and post some example code too??</div>
    <div class="meta">Posted on 2004-05-28 14:07:20 by telophase</div>
   </div>
   <div class="post" id="post-142329">
    <div class="subject"><a href="#post-142329">.data in .code section</a></div>
    <div class="body">I don't use masm - post your errors please.</div>
    <div class="meta">Posted on 2004-05-28 14:35:27 by omega_red</div>
   </div>
   <div class="post" id="post-142331">
    <div class="subject"><a href="#post-142331">.data in .code section</a></div>
    <div class="body">original code:<br /><br />code<br /><br />; ?????????????????????????????????????????????????????????????????????????<br /><br />start:<br /><br />; ??????????????????????????????????????<br />invoke MessageBox,0,ADDR txt,ADDR cap,MB_OK<br />invoke ExitProcess,0<br />cap db &quot;Yeah!&quot;,0<br />txt db &quot;Hello! It WOrked!!&quot;,0<br />; ???????????????????????????????????????<br /><br />end start<br /><br />errors:<br />msg_txt.asm(62) : error A2006: undefined symbol : cap<br />msg_txt.asm(62) : error A2114: INVOKE argument type mismatch : argument : 3<br />msg_txt.asm(62) : error A2006: undefined symbol : txt<br />msg_txt.asm(62) : error A2114: INVOKE argument type mismatch : argument : 2<br />_<br />Assembly Error<br />Press any key to continue . . .<br /><br />I cant seem to get the file assembled itself :confused:</div>
    <div class="meta">Posted on 2004-05-28 14:40:52 by telophase</div>
   </div>
   <div class="post" id="post-142332">
    <div class="subject"><a href="#post-142332">.data in .code section</a></div>
    <div class="body">Hi telophase,<br /><br /><pre><code><br />.386<br />.model flat,stdcall<br />option casemap&#58;none<br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />.code<br /><br />txt db &quot;Hello! It WOrked!!&quot;,0<br />cap db &quot;Yeah!&quot;,0<br /><br />start&#58;<br />	invoke MessageBox,0,ADDR txt,ADDR cap,MB_OK	<br />	invoke ExitProcess,0<br /><br />END start<br /></code></pre></div>
    <div class="meta">Posted on 2004-05-28 14:43:37 by Vortex</div>
   </div>
   <div class="post" id="post-142333">
    <div class="subject"><a href="#post-142333">.data in .code section</a></div>
    <div class="body">MASM cannot resolve forward references to data.<br /><br />Mirno</div>
    <div class="meta">Posted on 2004-05-28 14:45:09 by Mirno</div>
   </div>
   <div class="post" id="post-142334">
    <div class="subject"><a href="#post-142334">Thank You</a></div>
    <div class="body">Thankyou for the code vortex<br /><br />But that means that i will have to declare all the variables before i call the functions itself eh?<br /><br />Also i want to modify the variables then i need to make the section writeable? :confused:</div>
    <div class="meta">Posted on 2004-05-28 14:47:41 by telophase</div>
   </div>
   <div class="post" id="post-142336">
    <div class="subject"><a href="#post-142336">.data in .code section</a></div>
    <div class="body"><div class="quote"><br />Hi telophase,<br /><br /><pre><code><br />.386<br />.model flat,stdcall<br />option casemap&#58;none<br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />.code<br /><br />txt db &quot;Hello! It WOrked!!&quot;,0<br />cap db &quot;Yeah!&quot;,0<br /><br />start&#58;<br />	invoke MessageBox,0,ADDR txt,ADDR cap,MB_OK	<br />	invoke ExitProcess,0<br /><br />END start<br /></code></pre> </div><br /><br /><br />You dont need to have it at the begining .. this is just one solution.  The key is to not have your program execute your text strings:<br /><br /><pre><code><br />.386<br />.model flat,stdcall<br />option casemap&#58;none<br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />.code<br />start&#58;<br />	invoke MessageBox,0,ADDR txt,ADDR cap,MB_OK	<br /><br />	jmp @F<br />	txt db &quot;Hello! It WOrked!!&quot;,0<br />	cap db &quot;Yeah!&quot;,0<br />	@@&#58;<br /><br />	invoke ExitProcess,0<br /><br />END start<br /></code></pre><br /><br />Regards,<br />:NaN:</div>
    <div class="meta">Posted on 2004-05-28 15:03:55 by NaN</div>
   </div>
   <div class="post" id="post-142337">
    <div class="subject"><a href="#post-142337">.data in .code section</a></div>
    <div class="body">If you want to write to section, it must have `writable' bit in section flags or you'll get access violations. Not sure how to do it in masm though.</div>
    <div class="meta">Posted on 2004-05-28 15:20:52 by omega_red</div>
   </div>
   <div class="post" id="post-142340">
    <div class="subject"><a href="#post-142340">.data in .code section</a></div>
    <div class="body">Hi NaN,<br /><br />Sorry but your code appears to be not correct:<br /><pre><code><br /> Assembling&#58; msgbox.asm<br />msgbox.asm&#40;12&#41; &#58; error A2006&#58; undefined symbol &#58; cap<br />msgbox.asm&#40;12&#41; &#58; error A2114&#58; INVOKE argument type mismatch &#58; argument &#58; 3<br />msgbox.asm&#40;12&#41; &#58; error A2006&#58; undefined symbol &#58; txt<br />msgbox.asm&#40;12&#41; &#58; error A2114&#58; INVOKE argument type mismatch &#58; argument &#58; 2<br /></code></pre><br /><br />You should define your variables before referencing them with ADDR.</div>
    <div class="meta">Posted on 2004-05-28 16:35:07 by Vortex</div>
   </div>
   <div class="post" id="post-142349">
    <div class="subject"><a href="#post-142349">.data in .code section</a></div>
    <div class="body">I supose that offset can calculate forward references?.<br /><br />By the way, addr is a diferent thing.<br /><br />Have a nice day or night.</div>
    <div class="meta">Posted on 2004-05-28 17:29:28 by rea</div>
   </div>
   <div class="post" id="post-142371">
    <div class="subject"><a href="#post-142371">Thankx</a></div>
    <div class="body">Hi! NaN,<br /><br />Your code gives error but when i try it using TASM method in MASM itself i get no errors :confused: <br /><br />push 0<br />push OFFSET txt<br />push OFFSET cap<br />push 0<br />call MessageBox<br /> <br /><br />The above code works out fine but then i cant use the invoke syntax:(</div>
    <div class="meta">Posted on 2004-05-28 22:46:05 by telophase</div>
   </div>
   <div class="post" id="post-142372">
    <div class="subject"><a href="#post-142372">.data in .code section</a></div>
    <div class="body">As opposed to having the data in the code section using jmp @F you can simply place it in an area that will not be executed, for example after ExitProcess or after RET in a procedure or even between procedures...<br /><br /><pre><code>.386<br />.model flat,stdcall<br />option casemap&#58;none<br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />.code<br />	txt db &quot;Hello! It WOrked!!&quot;,0<br />	cap db &quot;Yeah!&quot;,0<br /><br />start&#58;<br />	invoke MessageBox,0,offset txt,offset cap,MB_OK	<br /><br />	invoke ExitProcess,0<br /><br /><br />SomeProc proc<br /><br />	push MB_OK<br />	push offset testdata2<br />	push offset testdata1<br />	call MessageBox<br /><br />	ret<br />	testdata1 db &quot;Hello there&quot;,0<br />	testdata2 db &quot;How are you&quot;,0<br /><br />SomeProc endp<br /><br />testdata3 db &quot;Hello there&quot;,0<br />testdata4 db &quot;How are you&quot;,0<br /><br />SomeProc2 proc<br /><br />	invoke MessageBox,0,offset testdata3,offset testdata4,MB_OK	<br /><br />	ret<br />SomeProc2 endp<br /><br />END start</code></pre></div>
    <div class="meta">Posted on 2004-05-28 22:53:39 by donkey</div>
   </div>
   <div class="post" id="post-142373">
    <div class="subject"><a href="#post-142373">.data in .code section</a></div>
    <div class="body">Hey! Donkey,<br /><br />Tried compiling that code but i get the following errors in the code:<br />msg_txt.asm(59) : error A2006: undefined symbol : cap<br />msg_txt.asm(59) : error A2114: INVOKE argument type mismatch : argument : 3<br />msg_txt.asm(59) : error A2006: undefined symbol : txt<br />msg_txt.asm(59) : error A2114: INVOKE argument type mismatch : argument : 2<br />msg_txt.asm(68) : error A2006: undefined symbol : testdata2<br />msg_txt.asm(68) : error A2114: INVOKE argument type mismatch : argument : 3<br />msg_txt.asm(68) : error A2006: undefined symbol : testdata1<br />msg_txt.asm(68) : error A2114: INVOKE argument type mismatch : argument : 2<br /><br />Backward data is still not working :(</div>
    <div class="meta">Posted on 2004-05-28 22:57:02 by telophase</div>
   </div>
   <div class="post" id="post-142374">
    <div class="subject"><a href="#post-142374">.data in .code section</a></div>
    <div class="body">Sorry,<br /><br />I just typed it on the fly, in GoAsm which is what I use it is perfectly OK that way. I changed the code to allow for MASMs problem with forward references.</div>
    <div class="meta">Posted on 2004-05-28 22:58:25 by donkey</div>
   </div>
   <div class="post" id="post-142375">
    <div class="subject"><a href="#post-142375">.data in .code section</a></div>
    <div class="body">What is GoAsm is it a IDE or something?<br /><br />Where can i get it?</div>
    <div class="meta">Posted on 2004-05-28 23:02:15 by telophase</div>
   </div>
   <div class="post" id="post-142376">
    <div class="subject"><a href="#post-142376">.data in .code section</a></div>
    <div class="body">GoAsm is an assembler...<br /><br /><a target="_blank" href="http://www.godevtool.com/">http://www.godevtool.com/</a><br /><br />You can use forward references in MASM as long as you don't use INVOKE...<br /><br /><pre><code>SomeProc proc<br /><br />	push MB_OK<br />	push offset testdata2<br />	push offset testdata1<br />	call MessageBox<br />	;invoke MessageBox,0,offset testdata1,offset testdata2,MB_OK	<br /><br />	ret<br />	testdata1 db &quot;Hello there&quot;,0<br />	testdata2 db &quot;How are you&quot;,0<br /><br />SomeProc endp</code></pre><br /><br />Is just fine, pretty dumb IMHO.</div>
    <div class="meta">Posted on 2004-05-28 23:03:42 by donkey</div>
   </div>
   <div class="post" id="post-142377">
    <div class="subject"><a href="#post-142377">Ok.....</a></div>
    <div class="body">But then why is it that MASM has problems compiling it?<br /><br />And GoAsm dosent have any problems :confused:</div>
    <div class="meta">Posted on 2004-05-28 23:05:19 by telophase</div>
   </div>
   <div class="post" id="post-142378">
    <div class="subject"><a href="#post-142378">.data in .code section</a></div>
    <div class="body">GoAsm isn't MASM, it handles scoping much better and certainly handles invoke infinitely better. The problem is in the INVOKE macro in MASM, it has many other problems besides just that one, GoAsm does not.</div>
    <div class="meta">Posted on 2004-05-28 23:07:01 by donkey</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=18370&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=18370&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="18370" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=18370&amp;page=2">&gt;</a><a href="../?id=18370&amp;page=3">&raquo;</a></form>  </div>
 </body>
</html>