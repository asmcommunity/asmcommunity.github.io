<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>why doesn't it run under winXP? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10281" />
    <link rel="next" href="../?id=10281&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=10281">why doesn't it run under winXP?</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=10281&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=10281&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="10281" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=10281&amp;page=2">&gt;</a><a href="../?id=10281&amp;page=2">&raquo;</a></form>   <div class="post" id="post-77155">
    <div class="subject"><a href="#post-77155">why doesn't it run under winXP?</a></div>
    <div class="body">some time ago i started coding an mp3Player on my win98 system. i want to upgrade to winXP, but some tests showed me, that it doesn't run under winXP. the ownerdrawn windows and button appear, but the window itself is transparent (i can &quot;see&quot; throuh it). i cant move it and no button has a label. also, no button has any function (i.e nothing happens if i click on it). currently i use the mci-system to play the music.<br />before i used fmod for playing - on starting my mp3Player winXP just spits out this message:<br /><pre><code><br />&quot;diese anwendung ist keine zul?ssige Win32-Anwendung&quot;<br /><br />&#40;translation&#41;<br />&quot;this application is not a valid Win32-application&quot;<br /></code></pre><br />so, what the hell? winXP doesnt even allow me to start my prog?! but that happens to almost <strong>every</strong> assebler-application i wrote and i get.<br />is there any security-option activated which prevents to launch such &quot;minimalist&quot;-applics?<br />almost same to SoftIceNT - but thats another story...<br /><br />greets, hartyl</div>
    <div class="meta">Posted on 2003-01-19 04:55:02 by hartyl</div>
   </div>
   <div class="post" id="post-77158">
    <div class="subject"><a href="#post-77158">why doesn't it run under winXP?</a></div>
    <div class="body">maybe the PE alignement is too low... try to recompile using default settings.</div>
    <div class="meta">Posted on 2003-01-19 04:58:55 by JCP</div>
   </div>
   <div class="post" id="post-77187">
    <div class="subject"><a href="#post-77187">why doesn't it run under winXP?</a></div>
    <div class="body">May not be exactly the same issue but just in case...<br /><br />I had a similar problem when i tried to run an app on XP - worked fine on 98 but then the windows became transparent running on XP. These were windows with their own dialog proc...<br /><br />Adding XOR eax,eax to the end of the dialog proc stopped them from becoming see thru</div>
    <div class="meta">Posted on 2003-01-19 10:33:04 by MurkyT</div>
   </div>
   <div class="post" id="post-77190">
    <div class="subject"><a href="#post-77190">why doesn't it run under winXP?</a></div>
    <div class="body">nah! i just wanted to copy RadASM (my standard ide) on winXP to work there - but what the heck? same error? invalid win32-application? i can't get winXP!<br />@MurkyT: i'll try to add the xor eax,eax<br />@Readiosys: i'm used to use the default settings. any special options with the assembler of the masmv6-package?</div>
    <div class="meta">Posted on 2003-01-19 11:10:47 by hartyl</div>
   </div>
   <div class="post" id="post-77238">
    <div class="subject"><a href="#post-77238">why doesn't it run under winXP?</a></div>
    <div class="body">I think readiosys is right here, it seems win98 doesn't care about file alignment as NT systems do...<br />May you try to recompile it and even add garbage as padding ?</div>
    <div class="meta">Posted on 2003-01-19 16:23:02 by Axial</div>
   </div>
   <div class="post" id="post-77283">
    <div class="subject"><a href="#post-77283">why doesn't it run under winXP?</a></div>
    <div class="body"><div class="quote"><br />I think readiosys is right here, it seems win98 doesn't care about file alignment as NT systems do...<br />May you try to recompile it and even add garbage as padding ? </div><br />This must be related to XP systems not 2K/NT, because I have 2K and I use<br />small file alignment all the time. The smallest exe with a message-box I created<br />were about 720Bytes and it runs like a charm on 2K. I always thougt it was W/9X<br />systems wich didnt like alignment?</div>
    <div class="meta">Posted on 2003-01-19 19:32:28 by natas</div>
   </div>
   <div class="post" id="post-77317">
    <div class="subject"><a href="#post-77317">why doesn't it run under winXP?</a></div>
    <div class="body">filealign... has changed alot over 9x and NT versions. some 9x allow small align, some NT. just use 512 and you'll be alright.<br /><br />hartyl, do you use a non-standard linker or settings? i didn't run XP long before switching back to 2k, but I didn't have any problems with asm apps, as long as I didn't play around too much with the PE header.<br /><br />things to remembre on NT: register preservation is even more important than on 9x (though you wont get BSODs from not following it). stack must be 4-byte aligned (not a problem unless you're *messing* with the stack). and you must return 0 (&quot;xor eax, eax&quot;) in dlgproc if you don't handle the message. none of these should cause a &quot;invalid win32 app&quot; peldr messagebox though.</div>
    <div class="meta">Posted on 2003-01-20 03:34:18 by f0dder</div>
   </div>
   <div class="post" id="post-77341">
    <div class="subject"><a href="#post-77341">why doesn't it run under winXP?</a></div>
    <div class="body"><div class="quote"><br />I think readiosys is right here, it seems win98 doesn't care about file alignment as NT systems do...<br />May you try to recompile it and even add garbage as padding ? </div>Right. Additionally, an important thing I've not read anywhere is that on NT systems all data pointers you pass to the API must be DWORD aligned. This maybe wasn't documented explicitly because is no problem in C/C++, since the compiler takes care of it, but in asm it's an issue.<br /><br />Generally, the problem happens when one defines some structures in his/her source, and those structures aren't made DWORD aligned. A more common problem than it may seem.</div>
    <div class="meta">Posted on 2003-01-20 05:44:44 by Maverick</div>
   </div>
   <div class="post" id="post-77397">
    <div class="subject"><a href="#post-77397">why doesn't it run under winXP?</a></div>
    <div class="body">it seems to me that i'd be easier and better if i chose win2k? i also thought about it too, not only because i usually can't stand winXP... but i gave it a try. i'll get win2k tomorrow and set it up - i'll tell you my results<br /><br />greets, hartyl</div>
    <div class="meta">Posted on 2003-01-20 13:24:49 by hartyl</div>
   </div>
   <div class="post" id="post-77398">
    <div class="subject"><a href="#post-77398">why doesn't it run under winXP?</a></div>
    <div class="body">2k == NT5.0, XP == NT5.1.<br />Shouldn't differ much. XP is just somewhat uglier.</div>
    <div class="meta">Posted on 2003-01-20 13:28:36 by f0dder</div>
   </div>
   <div class="post" id="post-77434">
    <div class="subject"><a href="#post-77434">why doesn't it run under winXP?</a></div>
    <div class="body"><div class="quote"><br />2k == NT5.0, XP == NT5.1.<br />Shouldn't differ much. XP is just somewhat uglier. </div><br />They created XP for the people who care more about how a computer <br />looks! instead of how a computer works! Atleast that is my opinion.<br />I still have W/2K with the same old blue original background color. ( :grin: )</div>
    <div class="meta">Posted on 2003-01-20 18:14:12 by natas</div>
   </div>
   <div class="post" id="post-77480">
    <div class="subject"><a href="#post-77480">why doesn't it run under winXP?</a></div>
    <div class="body"><div class="quote"><em>Originally posted by natas </em><br />They created XP for the people who care more about how a computer <br />looks! instead of how a computer works! Atleast that is my opinion.<br />I still have W/2K with the same old blue original background color. ( :grin: ) </div>:stupid: Agreed.. and Mine is still the blue original background:grin:</div>
    <div class="meta">Posted on 2003-01-21 03:03:07 by roticv</div>
   </div>
   <div class="post" id="post-77484">
    <div class="subject"><a href="#post-77484">why doesn't it run under winXP?</a></div>
    <div class="body">I have a nice homemade background. <a target="_blank" href="http://f0dder.oldleetos.net/m_a_m.png">http://f0dder.oldleetos.net/m_a_m.png</a> at the moment.<br /><br />XP has some kernel improvement and stuff, but... any advantage seems to be gobbled up by the atrocious new GUI. and even in &quot;?berclassic&quot; mode with all the crap turned off, there's some stuff left. as it is now, I see no reason to upgrade to XP. win2k works fine.</div>
    <div class="meta">Posted on 2003-01-21 03:47:28 by f0dder</div>
   </div>
   <div class="post" id="post-77489">
    <div class="subject"><a href="#post-77489">why doesn't it run under winXP?</a></div>
    <div class="body"><div class="quote"><br />I have a nice homemade background. <a target="_blank" href="http://f0dder.oldleetos.net/m_a_m.png">http://f0dder.oldleetos.net/m_a_m.png</a> at the moment.<br /><br />XP has some kernel improvement and stuff, but... any advantage seems to be gobbled up by the atrocious new GUI. and even in &quot;?berclassic&quot; mode with all the crap turned off, there's some stuff left. as it is now, I see no reason to upgrade to XP. win2k works fine. </div><br />I especially liked this little fine reading: <a target="_blank" href="http://f0dder.oldleetos.net/xp-onering.txt">http://f0dder.oldleetos.net/xp-onering.txt</a>  ( :grin: )</div>
    <div class="meta">Posted on 2003-01-21 04:17:48 by natas</div>
   </div>
   <div class="post" id="post-77491">
    <div class="subject"><a href="#post-77491">why doesn't it run under winXP?</a></div>
    <div class="body">unfortunately I can't claim credit for that text - if it had been written by me, there would probably have been some differences too. XP isn't that bad, really, as long as you have corporate version, block out sa.windows.com in your firewall, and aren't stupid enough to run the devilsown cdkey :)<br /><br />Ohbtw, I have a legal copy of Office XP for small business here. We ordered some old version of wordperfect, but got OXP instead. There was also a note, &quot;packed by mohamed&quot;. *giggle*</div>
    <div class="meta">Posted on 2003-01-21 04:21:12 by f0dder</div>
   </div>
   <div class="post" id="post-77493">
    <div class="subject"><a href="#post-77493">I agree ... 250% !</a></div>
    <div class="body">You really <u>cannot</u> imagine how much I can second that!<br /><br />I've also had that problem so many times: asm app runs fine under<br />9x/ME, but won't run under XP and sometimes 2K, although they're<br />dealing with the API functions quite nicely and don't do any dirty stuff.<br /><br />You cannot create a toolhelpsnapshot of a suspended process,<br />you can't use non-dword aligned structs in API funcs, you have to restore<br />all the registers' contents in a DlgProc before leaving it (or the app crahses<br />if you're not lucky), ... you just CANT program asm for XP! But <u>everything<br />of the above works fine on 9x/ME</u> ... so it's nothing more than one big<br />chicanery under the excuse of &quot;security?&quot; ... HA! Nothing of it is mentioned<br />in the msdn or other dev help files.<br /><br />The above list grows and grows for every app I create, it's ridicolous.<br />We just want to code win32asm. Why do they make it so hard for us?!<br />What it really causes is that I don't have much time for creativity in designing<br />or programming ... because all of my time is wasted by searching for solutions<br />to make my apps work on 2k/xp.<br /><br />My current problem is that my app that displays information about ShellLinks<br />and also can save them to new link files. Guess what? Calling IPersistFile::Save<br />fails under XP with some error code which I can't find any explanation for.<br /><br />Oh, not to mention my other app, where I just want to set up winsock and send<br />some UDP data to some server... but I'm not even coming that far: socket() fails<br />with WSAEPROVIDERFAILEDINIT but it works fine under 9x/ME ... already tried<br />thousands of other ways (and I mean it!) to do it, but it just won't work!<br /><br />Oh, and I recently got the error &quot;not a valid Win32 application&quot; on XP after loading<br />an exe into a hex editor and cut off all NULLs at the end of the file (except one, which<br />was a string terminator). It worked under 9x though.<br /><br />Another thing is that some of my apps use usual MessageBoxes and on XP the<br />msgboxes are looking weird: no caption, no border. I tried to find the problem by<br />building a basic app displaying a msgbox and adding stuff until the problem occurs.<br />But it didnt!<br /><br />Now I know what they meant when they told me that asm was hard ... <br /><br />:mad: :mad: :mad: :mad:<br /><br />After all, I'm kinda 'glad' that it's not only me who suffers of XP.<br /><br /><br />aweX &lt;-</div>
    <div class="meta">Posted on 2003-01-21 04:32:26 by aweX</div>
   </div>
   <div class="post" id="post-77498">
    <div class="subject"><a href="#post-77498">why doesn't it run under winXP?</a></div>
    <div class="body">naweX, stuff like having to align on 4-byte boundary isn't really that bad, is it? especially considering you get poor performance on non-aligned data. ok, so MSDN doesn't really talk about this, nor about register preservation. MSDN was written for C programmers, and C compilers handle the tedious stuff of alignment and preservation. I guess they could have devoted a single chapter to this stuff, though (and perhaps they have some info somewhere - haven't searched for it).<br /><br />You don't have to restore all register contents in Dlg/WndProcs, just the standard ones. And only if used. And of course you have to return zer0 in your DlgProc if you don't handle the message - just like PSDK tells you to. That it works without this on 9x is your luck, not well-defined behaviour.<br /><br />I've had no problem with winsock coding under neither 9x nor NT. And NT even provides raw sockets. 95%, it's you doing something wrong.<br /><br />Not a valid win32 application? You messed with the file in a hex editor. Like it or not, but PEs should be padded to FileAlign. There isn't really *any* use of not doing this, as filesize will be a multiple of cluster size anyway, and these tend to be 4k, while filealign is normally either 4k or 512.<br /><br />MsgBoxes showing up all weird? sounds like your stack isn't 4byte aligned. been pushing word-sized data or manually messing with esp? you do *not* want a non-4byte aligned stack pointer.<br /><br />code clean and you will have less problems.</div>
    <div class="meta">Posted on 2003-01-21 04:45:33 by f0dder</div>
   </div>
   <div class="post" id="post-77499">
    <div class="subject"><a href="#post-77499">why doesn't it run under winXP?</a></div>
    <div class="body">...and one shall come, to free us all, from the claws of terror,<br />he will be the great penguin, that will defeat the evil lord,<br />and the shadow of darkness will be eternally gone...<br /><br />:grin:<br /><br />-Stealth</div>
    <div class="meta">Posted on 2003-01-21 04:46:38 by Stealth</div>
   </div>
   <div class="post" id="post-77501">
    <div class="subject"><a href="#post-77501">why doesn't it run under winXP?</a></div>
    <div class="body">hah</div>
    <div class="meta">Posted on 2003-01-21 04:48:31 by f0dder</div>
   </div>
   <div class="post" id="post-77957">
    <div class="subject"><a href="#post-77957">why doesn't it run under winXP?</a></div>
    <div class="body">f0dder, I was just wondering why XP restricts operations in an unnecessary way!<br />Does the CPU not allow access on non-dword-aligned mem addresses?<br />Of course it does ... and I really give a damn if it's a bit slower,because you wouldn't<br />really notice it anyways.<br />And the other two issues I mentioned are OS-related. They don't work on XP, but<br />work on 9x/ME. So please don't tell us that &quot;MSDN was written for C programmers&quot;.<br />You can't snapshot a suspended process, no matter if you program in C or ASM or<br />Brainf*ck (anyone know this language? ;) ) ...<br /><br />Also, I didn't say it's hard to dword align my data. The problem is all the time I had to<br />spend for searching for the origin of those errors... <strong>Now</strong> that I <strong>know</strong> about<br />them, I <strong>will</strong> avoid them. <br /><br />But, well try to find the bug in this small code...<br /><br /><pre><code><br />.386<br />.model flat, stdcall  ; 32 bit memory model<br />option casemap &#58;none  ; case sensitive<br /><br />include \MASM32\INCLUDE\windows.inc<br />include \MASM32\INCLUDE\kernel32.inc<br />include \MASM32\INCLUDE\user32.inc<br />include \MASM32\INCLUDE\wsock32.inc<br /><br />includelib \MASM32\LIB\kernel32.lib<br />includelib \MASM32\LIB\user32.lib<br />includelib \MASM32\LIB\wsock32.lib<br /><br />.data?<br /><br />  hSock     dd ?<br />  wsadata   WSADATA &lt;&gt;<br />  saddr     sockaddr_in &lt;&gt;<br />  <br />.data<br /><br />  szData  db &quot;somedata&quot;, 0<br />  szIP    db &quot;127.0.0.1&quot;, 0<br /><br />.code<br /><br />start&#58;<br />    invoke WSAStartup, 101h, ADDR wsadata<br />    invoke socket, AF_INET, SOCK_DGRAM, IPPROTO_UDP<br />    mov hSock, eax<br /><br />    invoke RtlZeroMemory, ADDR saddr, SIZEOF saddr<br />    mov saddr.sin_family, AF_INET<br />    invoke inet_addr, ADDR szIP<br />    mov saddr.sin_addr.S_un.S_addr, eax<br />    invoke htons, 12121<br />    mov saddr.sin_port, ax  <br /><br />    invoke sendto, hSock, ADDR szData, SIZEOF szData, NULL, ADDR saddr, SIZEOF saddr<br />    invoke WSACleanup<br /><br />    invoke ExitProcess,1<br /><br />end start<br /></code></pre><br /><br />... it will generate an ERROR_MOD_NOT_FOUND at the sendto-invoke.<br /><br />I also tried &quot;bind&quot;. That won't change a thing though  :(<br /><br /><br />aweX &lt;-</div>
    <div class="meta">Posted on 2003-01-23 09:42:58 by aweX</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=10281&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=10281&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="10281" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=10281&amp;page=2">&gt;</a><a href="../?id=10281&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>