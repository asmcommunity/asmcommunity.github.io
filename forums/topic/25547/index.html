<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ObjAsm32: MDI window creation problem - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25547" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25547">ObjAsm32: MDI window creation problem</a></p>
   <div class="post" id="post-186611">
    <div class="subject"><a href="#post-186611">ObjAsm32: MDI window creation problem</a></div>
    <div class="body">Can anyone help?<br /><br />I wanted to create a simple ObjAsm32 MDI application, with minimal functionality.<br /><br />First I copied the MDI example (Demo06) from the objasm32 package to to a new folder.<br />Then I copied the MdiApp.inc file from the \masm32\objasm32\code\objects folder to<br />the project folder, so I could add some debugging code to it if necessary.<br />Therefore in Demo06.asm I changed the line &quot;LoadObjects MdiApp&quot; to &quot;include MdiApp.inc&quot;.<br /><br />After building, and executing the project, everything was fine, as expected.<br /><br />Now I wanted to replace DemoApp06&#39;s by a much simpler object.<br />So I decided to remove the Demo06.inc file from the project, and instead use a new<br />file: &quot;MyMdiApp&quot;, which I added to the project<br /><br />The main file for the project now looks like this:<br /><br /><br /><pre><code>%include @Environ(OA32_PATH)\\Code\\Macros\\Model.inc&nbsp; &nbsp; &nbsp;  ;Include &amp; initialize standard modules<br />SysSetup OOP_WINDOWS;, DEBUG(WND, RESGUARD)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Loads OOP files and OS related objects<br /><br />include Demo06_Globals.inc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Includes application globals<br />% include &amp;MacPath&amp;UStrings.inc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Includes Unicode support for DlgTmpl<br />% include &amp;MacPath&amp;DlgTmpl.inc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Includes Dlg Template macros for XMenu<br />IncludeBoth HtmlHelp<br /><br />LoadObjects Stream, Collection&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Loads or builds the following objects<br />LoadObjects Button, Hyperlink<br />LoadObjects Dialog, DialogModal, DialogModalIndirect, DialogAboutIndirect<br />LoadObjects SimpleImageList, MaskedImageList<br />LoadObjects MsgInterceptor, XMenu<br />LoadObjects WinControl, Toolbar, Rebar, Statusbar, Tooltip<br />;LoadObjects MdiApp<br />include MdiApp.inc<br /><br />.code<br />;include Demo06.inc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Includes DemoApp06 object<br />include MyMdiApp.inc<br /><br />start:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Program entry point<br />&nbsp; &nbsp; SysInit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Runtime initialization of OOP model<br /><br />&nbsp; &nbsp; ResGuard_Start&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Activates ResGuard<br />;&nbsp; &nbsp; OCall @DemoApp06::DemoApp06.Init&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Initialize the object data<br />;&nbsp; &nbsp; OCall @DemoApp06::DemoApp06.Run&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Execute the application<br />;&nbsp; &nbsp; OCall @DemoApp06::DemoApp06.Done&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Finalize it<br />&nbsp; &nbsp; OCall @MyMdiApp::MyMdiApp.Init&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Initialize the object data<br />&nbsp; &nbsp; OCall @MyMdiApp::MyMdiApp.Run&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Execute the application<br />&nbsp; &nbsp; OCall @MyMdiApp::MyMdiApp.Done&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Finalize it<br />&nbsp; &nbsp; ResGuard_Show&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Shows ResGuard results<br /><br />&nbsp; &nbsp; SysDone&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Runtime finalization of the OOP model<br />&nbsp; &nbsp; invoke ExitProcess, 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Exits program returning 0 to the OS<br />end start</code></pre><br /><br />MyMdiApp.inc looks like this:<br /><br /><br /><pre><code>CLSSTYLE&nbsp; equ&nbsp;  CS_BYTEALIGNWINDOW or CS_BYTEALIGNCLIENT or CS_VREDRAW or CS_HREDRAW<br /><br />Object MyMdiApp,80000000,MdiApp<br />	BoundMethod		Startup<br />ObjectEnd<br /><br />CStr szMyMdiApp, &quot;MyMdiApp&quot;<br /><br />Method MyMdiApp.Startup<br />&nbsp; &nbsp; local WC:WNDCLASSEX<br />	<br />	@invoke MessageBox,NULL,&quot;Starting up...&quot;,&quot;MyMdiApp&quot;,MB_OK<br /><br />&nbsp; &nbsp; mov WC.cbSize, sizeof WNDCLASSEX<br />&nbsp; &nbsp; mov WC.style, CLSSTYLE<br />&nbsp; &nbsp; m2m WC.lpfnWndProc, $MethodAddr(MyMdiApp.WndProc)<br />&nbsp; &nbsp; mov WC.cbClsExtra, 0<br />&nbsp; &nbsp; mov WC.cbWndExtra, 0<br />&nbsp; &nbsp; m2m WC.hInstance, hInstance<br />&nbsp; &nbsp; mov WC.hbrBackground, NULL<br />&nbsp; &nbsp; mov WC.lpszMenuName, NULL<br />&nbsp; &nbsp; mov WC.lpszClassName, offset szMyMdiApp<br />&nbsp; &nbsp; mov WC.hIcon, $invoke(LoadImage, hInstance, &quot;ICON_APP_32&quot;, IMAGE_ICON, 0, 0, LR_LOADREALSIZE)<br />&nbsp; &nbsp; mov WC.hCursor, $invoke(LoadCursor, NULL, IDC_ARROW)<br />&nbsp; &nbsp; mov WC.hIconSm, $invoke(LoadImage, hInstance, &quot;ICON_APP_16&quot;, IMAGE_ICON, 0, 0, LR_LOADREALSIZE)<br /><br />&nbsp; &nbsp; invoke RegisterClassEx, addr WC<br />MethodEnd</code></pre><br /><br />Running this application I expected at least the frame window to show up. <br />The Startup method was executed, but the frame window didn&#39;t show up.<br />Now I put some debugging code in MdiApp.Init<br /><br /><br /><pre><code>Method MdiApp.Init, uses esi<br />&nbsp; &nbsp; local dWwd:dword, dWht:dword<br />&nbsp; &nbsp; local dWtx:dword, dWty:dword<br /><br />&nbsp; &nbsp; SetObject esi<br />&nbsp; &nbsp; ACall esi::MdiApp.Init, NULL, NULL<br />&nbsp; &nbsp; mov .pCommandLine, $invoke(GetCommandLine)<br /><br />&nbsp; &nbsp; ;Create the MDI Frame window<br />&nbsp; &nbsp; mov dWwd, 600<br />&nbsp; &nbsp; mov dWht, 450<br />&nbsp; &nbsp; mov dWtx, $invoke(CenterForm, dWwd, $invoke(GetSystemMetrics, SM_CXSCREEN))<br />&nbsp; &nbsp; mov dWty, $invoke(CenterForm, dWht, $invoke(GetSystemMetrics, SM_CYSCREEN))<br /><br />&nbsp; &nbsp; invoke CreateWindowEx, WS_EX_OVERLAPPEDWINDOW or WS_EX_APPWINDOW, \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  offset szMdiApp, offset szAppTitle, WS_OVERLAPPEDWINDOW, \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dWtx, dWty, dWwd, dWht, NULL, NULL, hInstance, esi&nbsp;  ;Pass instance pointer<br /><br /><br />	DbgDec eax		;This didn&#39;t produce any output, so I added the next few lines.<br />	.if eax == 0<br />		@invoke MessageBox,NULL,offset szMdiApp,offset szAppTitle,MB_OK<br />	.endif<br /><br /><br />&nbsp; &nbsp; invoke ShowWindow, .hWnd, SW_SHOWNORMAL<br />&nbsp; &nbsp; invoke UpdateWindow, .hWnd<br /><br />MethodEnd</code></pre><br /><br />The debugging code was executed, so the exit code of CreateWindowEx was zero.<br />That means: The frame window wasn&#39;t created at all.<br />At the same time the requested information on the strings was given:<br />	<br /><pre><code>szAppTitle&nbsp; Value: &quot;Demo06&quot;<br />szMdiApp&nbsp; &nbsp; Value: &quot;MdiApp&quot;</code></pre><br /><br />I don&#39;t understand why the frame window is not created. Am I forgetting something?<br />Does anyone have a clue?<br /><br />Friendly regard,<br />mdevries.</div>
    <div class="meta">Posted on 2006-11-18 14:01:11 by mdevries</div>
   </div>
   <div class="post" id="post-186612">
    <div class="subject"><a href="#post-186612">Re: ObjAsm32: MDI window creation problem</a></div>
    <div class="body">Hi mdevries<br />The answer is so easy that you will not believe it?<br />I give you a hint? enable debugging, put DbgApiError after CreateWindowEx in the MdiApp.inc file and run the app again. The answer will be displayed.<br /><br /><pre><code>?<br />invoke CreateWindowEx, WS_EX_OVERLAPPEDWINDOW or WS_EX_APPWINDOW, \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;offset szMdiApp, offset szAppTitle, WS_OVERLAPPEDWINDOW, \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dWtx, dWty, dWwd, dWht, NULL, NULL, hInstance, esi&nbsp; &nbsp;;Pass instance pointer<br />DbgApiError<br />?</code></pre><br /><br />Regards,<br /><br />Biterider<br /><br /></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=2167" target="_blank">MDI mdevries.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2006-11-18 15:39:15 by Biterider</div>
   </div>
   <div class="post" id="post-186622">
    <div class="subject"><a href="#post-186622">Re: ObjAsm32: MDI window creation problem</a></div>
    <div class="body">Hi Biterider,<br /><br />Now I see. The window class that was registered is &quot;MyMdiApp&quot;, while the creation of the window used &quot;MdiApp&quot; as classname.<br />So I changed<br /><br /><pre><code>CStr szMyMdiApp, &quot;MyMdiApp&quot;</code></pre><br /><br />to <br /><br /><pre><code>CStr szMyMdiApp, &quot;MdiApp&quot;</code></pre><br /><br />and now it works. Thanks!<br /><br />Friendly regards,<br />mdevries.<br /></div>
    <div class="meta">Posted on 2006-11-19 09:41:49 by mdevries</div>
   </div>
  </div>
 </body>
</html>