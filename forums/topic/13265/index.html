<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>tutorial #24 : Can't clear edit box with SetDlgItemText - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13265" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=17">Iczelion's Tutorials</a> &raquo; <a href="../?id=13265">tutorial #24 : Can't clear edit box with SetDlgItemText</a></p>
   <div class="post" id="post-102848">
    <div class="subject"><a href="#post-102848">tutorial #24 : Can't clear edit box with SetDlgItemText</a></div>
    <div class="body">Hi All,<br /><br />Why SetDlgItemText doesn't clear content of editboxs in tutorial #24 : Windows Hooks?<br /><br /><pre><code><br /><br />;--------------------------------------------- This is the source code of the main program -------------------------------------- <br />.386 <br />.model flat,stdcall <br />option casemap&#58;none <br />include \masm32\include\windows.inc <br />include \masm32\include\user32.inc <br />include \masm32\include\kernel32.inc <br />include mousehook.inc <br />includelib mousehook.lib <br />includelib \masm32\lib\user32.lib <br />includelib \masm32\lib\kernel32.lib <br /><br />wsprintfA proto C &#58;DWORD,&#58;DWORD,&#58;VARARG <br />wsprintf TEXTEQU <br /><br />.const <br />IDD_MAINDLG equ 101 <br />IDC_CLASSNAME equ 1000 <br />IDC_HANDLE equ 1001 <br />IDC_WNDPROC equ 1002 <br />IDC_HOOK equ 1004 <br />IDC_EXIT equ 1005 <br />WM_MOUSEHOOK equ WM_USER+6 <br /><br />DlgFunc PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD <br /><br />.data <br />HookFlag dd FALSE <br />HookText db &quot;&amp;Hook&quot;,0 <br />UnhookText db &quot;&amp;Unhook&quot;,0 <br />template db &quot;%lx&quot;,0 <br /><br />.data? <br />hInstance dd ? <br />hHook dd ? <br />.code <br />start&#58; <br />invoke GetModuleHandle,NULL <br />mov hInstance,eax <br />invoke DialogBoxParam,hInstance,IDD_MAINDLG,NULL,addr DlgFunc,NULL <br />invoke ExitProcess,NULL <br /><br />DlgFunc proc hDlg&#58;DWORD,uMsg&#58;DWORD,wParam&#58;DWORD,lParam&#58;DWORD <br />LOCAL hLib&#58;DWORD <br />LOCAL buffer&#91;128&#93;&#58;byte <br />LOCAL buffer1&#91;128&#93;&#58;byte <br />LOCAL rect&#58;RECT <br />.if uMsg==WM_CLOSE <br />.if HookFlag==TRUE <br />invoke UninstallHook <br />.endif <br />invoke EndDialog,hDlg,NULL <br />.elseif uMsg==WM_INITDIALOG <br />invoke GetWindowRect,hDlg,addr rect <br />invoke SetWindowPos, hDlg, HWND_TOPMOST, rect.left, rect.top, rect.right, rect.bottom, SWP_SHOWWINDOW <br />.elseif uMsg==WM_MOUSEHOOK <br />invoke GetDlgItemText,hDlg,IDC_HANDLE,addr buffer1,128 <br />invoke wsprintf,addr buffer,addr template,wParam <br />invoke lstrcmpi,addr buffer,addr buffer1 <br />.if eax!=0 <br />invoke SetDlgItemText,hDlg,IDC_HANDLE,addr buffer <br />.endif <br />invoke GetDlgItemText,hDlg,IDC_CLASSNAME,addr buffer1,128 <br />invoke GetClassName,wParam,addr buffer,128 <br />invoke lstrcmpi,addr buffer,addr buffer1 <br />.if eax!=0 <br />invoke SetDlgItemText,hDlg,IDC_CLASSNAME,addr buffer <br />.endif <br />invoke GetDlgItemText,hDlg,IDC_WNDPROC,addr buffer1,128 <br />invoke GetClassLong,wParam,GCL_WNDPROC <br />invoke wsprintf,addr buffer,addr template,eax <br />invoke lstrcmpi,addr buffer,addr buffer1 <br />.if eax!=0 <br />invoke SetDlgItemText,hDlg,IDC_WNDPROC,addr buffer <br />.endif <br />.elseif uMsg==WM_COMMAND <br />.if lParam!=0 <br />mov eax,wParam <br />mov edx,eax <br />shr edx,16 <br />.if dx==BN_CLICKED <br />.if ax==IDC_EXIT <br />invoke SendMessage,hDlg,WM_CLOSE,0,0 <br />.else <br />.if HookFlag==FALSE <br />invoke InstallHook,hDlg <br />.if eax!=NULL <br />mov HookFlag,TRUE <br />invoke SetDlgItemText,hDlg,IDC_HOOK,addr UnhookText <br />.endif <br />.else <br />invoke UninstallHook <br />&#91;COLOR=blue&#93;invoke SetDlgItemText,hDlg,IDC_HOOK,addr HookText &#91;/COLOR&#93;  ;Here it works <br />mov HookFlag,FALSE <br />&#91;COLOR=red&#93;invoke SetDlgItemText,hDlg,IDC_CLASSNAME,NULL ;Here it does't<br />invoke SetDlgItemText,hDlg,IDC_HANDLE,NULL <br />invoke SetDlgItemText,hDlg,IDC_WNDPROC,NULL &#91;/COLOR&#93;<br />.endif <br />.endif <br />.endif <br />.endif <br />.else <br />mov eax,FALSE <br />ret <br />.endif <br />mov eax,TRUE <br />ret <br />DlgFunc endp <br /><br />end start <br /><br /></code></pre><br /><br />Regards, GJ</div>
    <div class="meta">Posted on 2003-05-07 20:48:46 by Green Joe</div>
   </div>
   <div class="post" id="post-102844">
    <div class="subject"><a href="#post-102844">tutorial #24 : Can't clear edit box with SetDlgItemText</a></div>
    <div class="body">As far as I know, the SetDlgItemText function needs a valid address of a null-terminated string. Using NULL for that parameter does not seem to be a valid option according to the description of the function.<br /><br />I do agree that Tutorial 24 does show it as you posted it. If you want to verify if it is improper coding, check if an error is being reported after the call to the function with NULL as the parameter.<br /><br />My suggestion would be to use the address of a 0 byte for that parameter if you need to clear an edit control.<br /><br />Raymond</div>
    <div class="meta">Posted on 2003-05-07 21:59:03 by Raymond</div>
   </div>
   <div class="post" id="post-102847">
    <div class="subject"><a href="#post-102847">tutorial #24 : Can't clear edit box with SetDlgItemText</a></div>
    <div class="body">I will check it tomorrow. But in tutorial #10 it works just fine with NULL constant.<br /><br /><pre><code><br />.....<br />WndProc proc hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM <br />    .IF uMsg==WM_DESTROY <br />        invoke PostQuitMessage,NULL <br />    .ELSEIF uMsg==WM_COMMAND <br />        mov eax,wParam <br />        .IF lParam==0 <br />            .IF ax==IDM_GETTEXT <br />                invoke GetDlgItemText,hWnd,IDC_EDIT,ADDR buffer,512 <br />                invoke MessageBox,NULL,ADDR buffer,ADDR AppName,MB_OK <br />            .ELSEIF ax==IDM_CLEAR <br /> &#91;COLOR=blue&#93;invoke SetDlgItemText,hWnd,IDC_EDIT,NULL &#91;/COLOR&#93;   <br />            .ELSE <br />                invoke DestroyWindow,hWnd <br />            .ENDIF <br />....<br /></code></pre><br /><br />Maybe problem with styles in resource file:<br /><br /><pre><code><br />#define IDD_MAINDLG                     101<br />#define IDC_CLASSNAME                   1000<br />#define IDC_HANDLE                      1001<br />#define IDC_WNDPROC                     1002<br />#define IDC_HOOK                        1004<br />#define IDC_EXIT                        1005<br />#define IDC_STATIC                      -1<br />#define DS_MODALFRAME                   0x80<br />#define WS_POPUP                        0x80000000<br />#define WS_CAPTION                      0xC00000<br />#define WS_SYSMENU                      0x80000<br />#define ES_AUTOHSCROLL                  0x80<br />#define ES_READONLY                     0x800<br /><br />IDD_MAINDLG DIALOG DISCARDABLE  0, 0, 229, 85<br />STYLE DS_MODALFRAME |  WS_POPUP | WS_CAPTION | WS_SYSMENU<br />CAPTION &quot;Mouse Hook Demo&quot;<br />FONT 8, &quot;MS Sans Serif&quot;<br />BEGIN<br />    GROUPBOX        &quot;Window Information&quot;,IDC_STATIC,7,7,214,67<br />    LTEXT           &quot;Class name&#58;&quot;,IDC_STATIC,21,22,39,8<br />    EDITTEXT        IDC_CLASSNAME,69,20,139,12,ES_AUTOHSCROLL | ES_READONLY<br />    LTEXT           &quot;Handle&#58;&quot;,IDC_STATIC,33,37,26,8<br />    EDITTEXT        IDC_HANDLE,69,36,77,12,ES_AUTOHSCROLL | ES_READONLY<br />    LTEXT           &quot;Window Proc&#58;&quot;,IDC_STATIC,13,52,46,8<br />    EDITTEXT        IDC_WNDPROC,69,51,77,12,ES_AUTOHSCROLL | ES_READONLY<br />    DEFPUSHBUTTON   &quot;&amp;Hook&quot;,IDC_HOOK,159,35,50,14<br />    PUSHBUTTON      &quot;E&amp;xit&quot;,IDC_EXIT,159,50,50,14<br />END<br /><br /></code></pre><br /><br />Thank you for reply.<br />Regards,GJ</div>
    <div class="meta">Posted on 2003-05-07 22:37:52 by Green Joe</div>
   </div>
   <div class="post" id="post-102846">
    <div class="subject"><a href="#post-102846">tutorial #24 : Can't clear edit box with SetDlgItemText</a></div>
    <div class="body">I checked SetDlgItemText calls for errors with GetLastError. It returns 0.<br /><br />I found out that if to put a call for MessageBox before SetDlgItemText calls, they clearing edit boxes.<br /><br />like this:<br /><br /><pre><code><br />        invoke MessageBox, hDlg, addr buffer,NULL,MB_OK&#41;<br />        invoke SetDlgItemText,hDlg,IDC_CLASSNAME,NULL<br />        invoke SetDlgItemText,hDlg,IDC_HANDLE,NULL<br />        invoke SetDlgItemText,hDlg,IDC_WNDPROC,NULL<br /> </code></pre></div>
    <div class="meta">Posted on 2003-05-09 07:55:53 by Green Joe</div>
   </div>
   <div class="post" id="post-102845">
    <div class="subject"><a href="#post-102845">tutorial #24 : Can't clear edit box with SetDlgItemText</a></div>
    <div class="body">Anyone??<br /><br />At least give me a hint is my question too difficult or too simple (maybe silly).</div>
    <div class="meta">Posted on 2003-05-13 11:16:54 by Green Joe</div>
   </div>
   <div class="post" id="post-104593">
    <div class="subject"><a href="#post-104593">Can't clear message box</a></div>
    <div class="body">Hello Joe Green:<br />I've just been working through the Windows Hook demo and ran into your problem.<br />I could not find a solution either. Have you come with any other information regarding the problem of not being able to clear the edit boxes in Tutorial 24?<br />Regards, Fumio<br /><br />Edited a few minutes later: Green Joe something I forgot to mention if mouse if moved over a control, button, window etc and you press &quot;ALT-U&quot; the boxes are cleared as you would expect the code to do if the unhook key is clicked with the mouse. Regards, Fumio</div>
    <div class="meta">Posted on 2003-05-24 10:25:22 by Fumio</div>
   </div>
   <div class="post" id="post-104605">
    <div class="subject"><a href="#post-104605">tutorial #24 : Can't clear edit box with SetDlgItemText</a></div>
    <div class="body">Hi Fumio,<br /><br />No I have no new information. I posted my question 2 times, in HLA section and here, and planning to post it one more time, on Hutch's masmforum, to drive people around  crazy:)</div>
    <div class="meta">Posted on 2003-05-24 11:41:45 by Green Joe</div>
   </div>
   <div class="post" id="post-104608">
    <div class="subject"><a href="#post-104608">tutorial #24 : Can't clear edit box with SetDlgItemText</a></div>
    <div class="body">Hi Green Joe: You may have considered the following:<br /><br />From Windows API UnhookWindowsHookEx<br /><br />The hook procedure can be in the state of being called by another thread even after UnhookWindowsHookEx returns. If the hook procedure is not being called concurrently, the hook procedure is removed immediately before UnhookWindowsHookEx returns. <br /><br />If the the mouse positioned over the unhook button is creating a WM_MOUSEHOOK message at the same time the .dll is asked to unhook; would that somehow cause the problem we see? <br />Regards, Fumio</div>
    <div class="meta">Posted on 2003-05-24 12:36:12 by Fumio</div>
   </div>
   <div class="post" id="post-104622">
    <div class="subject"><a href="#post-104622">tutorial #24 : Can't clear edit box with SetDlgItemText</a></div>
    <div class="body">I think the problem in some specs of edit controls. Maybe styles .... anyway something trivial.<br />I believe in it becouse the same function in the same place behaves different (i.e. it changes text on the button<br />and at the same time refuses to change text in edit boxes).<br /><br />Edit:<br /><br /><div class="quote"><strong>If the the mouse positioned over the unhook button is creating a WM_MOUSEHOOK message at the same time the .dll is asked to unhook; would that somehow cause the problem we see?</strong> </div> <br /><br />You are right! When button clicked by mouse WM_MOUSEHOOK message also created and in response to <br />this message edit boxes show Classname, handle and Window proc of clicked button control AFTER<br /> they were already cleared. When button activated by keys (ALT+U or Enter) WM_MOUSEHOOK message isn't created, so text in edit boxes couldn't be updated and it disapears.<br /><br />The problem can be solved by adding one more <strong>.if</strong> to the WM_MOUSEHOOK section.<br /><br />like this:<br /><br /><pre><code><br />.elseif uMsg==WM_MOUSEHOOK <br />&#91;COLOR=BLUE&#93; .if HookFlag == TRUE&#91;/COLOR&#93;<br />    invoke GetDlgItemText,hDlg,IDC_HANDLE,addr buffer1,128 <br /> invoke wsprintf,addr buffer,addr template,wParam <br /> invoke lstrcmpi,addr buffer,addr buffer1 <br /> .if eax!=0 <br />    invoke SetDlgItemText,hDlg,IDC_HANDLE,addr buffer <br />  .endif <br />  invoke GetDlgItemText,hDlg,IDC_CLASSNAME,addr buffer1,128 <br />  invoke GetClassName,wParam,addr buffer,128 <br />  invoke lstrcmpi,addr buffer,addr buffer1 <br />  .if eax!=0 <br />  invoke SetDlgItemText,hDlg,IDC_CLASSNAME,addr buffer <br />  .endif <br />   invoke GetDlgItemText,hDlg,IDC_WNDPROC,addr buffer1,128 <br />   invoke GetClassLong,wParam,GCL_WNDPROC <br />   invoke wsprintf,addr buffer,addr template,eax <br />   invoke lstrcmpi,addr buffer,addr buffer1 <br />   .if eax!=0 <br />       invoke SetDlgItemText,hDlg,IDC_WNDPROC,addr buffer <br />   .endif <br />&#91;COLOR=BLUE&#93;.endif &#91;/COLOR&#93;<br /></code></pre><br /><br />Thank you a lot for your insight.<br />Regards, GJ</div>
    <div class="meta">Posted on 2003-05-24 14:38:20 by Green Joe</div>
   </div>
  </div>
 </body>
</html>