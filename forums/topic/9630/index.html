<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>NetShareAdd is not working under 2k. Why? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=9630" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=8">Networking</a> &raquo; <a href="../?id=9630">NetShareAdd is not working under 2k. Why?</a></p>
   <div class="post" id="post-71361">
    <div class="subject"><a href="#post-71361">NetShareAdd is not working under 2k. Why?</a></div>
    <div class="body">Hi!<br />This program for Win2k must share resource but it don't want... Why?<br /><br />Thanks to everybody who can help me.<br />Mike<br /><br />;*****************************<br /><br />.386<br />.model flat, stdcall<br />option casemap:none<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\masm32.inc<br />include \masm32\include\netapi32.inc<br /><br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\masm32.lib<br />includelib \masm32\lib\netapi32.lib<br /><br />.data<br />MsgCaption	db &quot;Error code&quot;,0<br />MsgCaption4	db &quot;Success&quot;,0<br />Msg1		db &quot;Net resource not found&quot;, 0<br />Msg3		db &quot;Resource become shared&quot;, 0<br />Msg4		db &quot;Duplicated net name&quot;, 0<br />retCode	db 16 dup (?)<br />netData	SHARE_INFO_502 &lt;&gt;<br />netName	db '1',0,'1',0,'1',0,0			; &quot;111&quot;, 0<br />netPath	db 'D',0,':',0,'\',0,'1',0,'1',0,'1',0,0,0	; &quot;D:\111&quot;, 0<br />netHost	db '\',0,'\',0,'M',0,'I',0,'S',0,'H',0,'A',0,0,0	; &quot;\Misha&quot;, 0<br /><br />.code<br />start:<br />	invoke lstrcpy, addr netData.shi502_netname, addr netName<br />	mov netData.shi502_type, STYPE_DISKTREE<br />	mov netData.shi502_permissions, ACCESS_ALL<br />	mov eax, offset netPath<br />	mov netData.shi502_path, eax<br /><br />	mov eax, SIZEOF netData<br />	invoke NetShareAdd,<br />		addr netHost,	; 0 = Local host<br />		502,		; Using SHARE_INFO_502<br />		addr netData,	; pointer<br />		eax		; length<br /><br />	.if eax != 0		; On error<br />		.if eax==2392<br />			invoke MessageBox, NULL,addr Msg1, addr MsgCaption, MB_OK<br />		.elseif eax==2118<br />			invoke MessageBox, NULL,addr Msg4, addr MsgCaption, MB_OK<br />		.else<br />			invoke dwtoa, eax, addr retCode<br />			invoke MessageBox, NULL,addr retCode, addr MsgCaption, MB_OK<br />		.endif<br /><br />	.else				; Success!<br />		invoke MessageBox, NULL,addr Msg3, addr MsgCaption4, MB_OK<br />	.endif<br /><br />	invoke ExitProcess,NULL<br />end start<br /><br />;******************</div>
    <div class="meta">Posted on 2002-12-17 05:22:22 by Mike</div>
   </div>
   <div class="post" id="post-71569">
    <div class="subject"><a href="#post-71569">NetShareAdd is not working under 2k. Why?</a></div>
    <div class="body">Thanks to everybody... who help me...<br /><br />There was some errors. This version works properly.<br /><br />;**********************************************************<br />.386<br />.model flat, stdcall<br />option casemap:none<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\masm32.inc<br />include \masm32\include\netapi32.inc<br />include \masm32\include\add\macros.inc<br /><br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\masm32.lib<br />includelib \masm32\lib\netapi32.lib<br /><br />lstrcpyW	PROTO :DWORD,:DWORD<br /><br />.data<br />MsgCaption	db &quot;NetShareAdd&quot;,0<br />netName		db '1',0,'1',0,'1',0,0,0		; &quot;111&quot;, 0<br />netPath		db 'D',0,':',0,'\',0,'1',0,'1',0,'1',0,0,0	; &quot;D:\111&quot;, 0<br /><br />.data?<br />netData	SHARE_INFO_2 &lt;&gt;<br />digBuf	db 16 dup (?)<br />res	dd ?<br /><br /><br />.code<br />start:<br />	mov netData.shi2_type, STYPE_DISKTREE<br />	mov netData.shi2_permissions, 0<br />	mov netData.shi2_max_uses, 4<br />	mov netData.shi2_current_uses, 0<br />	mov netData.shi2_passwd, 0		; no password<br />	m2m netData.shi2_path, offset netPath<br />	mov netData.shi2_netname, offset netName<br /><br />	invoke NetShareAdd,<br />		0,		; 0 = Local host     or    addr netHost<br />		2,		; Using SHARE_INFO_2<br />		addr netData,	; pointer<br />		offset res		; error<br /><br />	.if eax == 0		; Success!<br />		invoke MessageBox, NULL,CStr(&quot;Share created&quot;), addr MsgCaption, MB_OK<br />	.else				; On error<br />		.if eax==ERROR_ACCESS_DENIED<br />			invoke MessageBox, NULL,CStr(&quot;Access denied&quot;), addr MsgCaption, MB_OK<br />		.elseif eax==ERROR_INVALID_LEVEL<br />			invoke MessageBox, NULL,CStr(&quot;Invalid level&quot;), addr MsgCaption, MB_OK<br />		.elseif eax==ERROR_INVALID_NAME<br />			invoke MessageBox, NULL,CStr(&quot;Invalid name&quot;), addr MsgCaption, MB_OK<br />		.elseif eax==ERROR_INVALID_PARAMETER<br />			invoke MessageBox, NULL,CStr(&quot;Invalid parameter&quot;), addr MsgCaption, MB_OK<br />		.elseif eax==NERR_DuplicateShare<br />			invoke MessageBox, NULL,CStr(&quot;Duplicate Share&quot;), addr MsgCaption, MB_OK<br />		.elseif eax==NERR_RedirectedPath<br />			invoke MessageBox, NULL,CStr(&quot;Redirected Path&quot;), addr MsgCaption, MB_OK<br />		.elseif eax==NERR_UnknownDevDir<br />			invoke MessageBox, NULL,CStr(&quot;Unknown Device or Directory&quot;), addr MsgCaption, MB_OK<br />		.else<br />			invoke dwtoa, eax, addr digBuf<br />			invoke MessageBox, NULL,addr digBuf, addr MsgCaption, MB_OK<br />		.endif<br />	.endif<br /><br />	invoke ExitProcess,NULL<br />	end start<br />;**********************************************************</div>
    <div class="meta">Posted on 2002-12-18 04:33:15 by Mike</div>
   </div>
  </div>
 </body>
</html>