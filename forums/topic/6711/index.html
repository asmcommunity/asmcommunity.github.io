<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>mci wav recording/saving example - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=6711" />
    <link rel="next" href="../?id=6711&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=6711">mci wav recording/saving example</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=6711&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=6711&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="6711" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=6711&amp;page=2">&gt;</a><a href="../?id=6711&amp;page=2">&raquo;</a></form>   <div class="post" id="post-48450">
    <div class="subject"><a href="#post-48450">mci wav recording/saving example</a></div>
    <div class="body">Well it's just a simple example which records mic input and saves it as a wav file.  I hardcoded the 16bit, stereo, and 44.1khz flags but those are easily changed.  I just wanted to keep the example as simple as possible.<br /><br />Also, I added a readme to the zip but no comments in the source since it's so basic.  If anyone needs comments though I'll add some.</div>
    <div class="meta">Posted on 2002-01-07 20:39:32 by Will</div>
   </div>
   <div class="post" id="post-48460">
    <div class="subject"><a href="#post-48460">cool</a></div>
    <div class="body">Thanks<br /><br />or better cool :-)<br />in this moment im thinking if i should code a small tool to speak cheap with my friends over the net with your function.<br />simple client/server to transfer zip with wav.....<br />last this sounds like the start of a simple voice chat.<br /><br />and i wanted to go to bed first :-)<br /><br />ps: i test vote ;-)</div>
    <div class="meta">Posted on 2002-01-07 21:16:57 by Max</div>
   </div>
   <div class="post" id="post-48451">
    <div class="subject"><a href="#post-48451">mci wav recording/saving example</a></div>
    <div class="body">You're awfully welcome.  I'd like to whip up a couple of more mci examples to post as well.<br /><br />If you do code that voice chat app I'd love to take a look at it.  But as far as compressing the wav before you send it.....you may want to record at a lower quality to bring down the file size first.  Then maybe convert it to mp3 (though to do it in asm would be a challenge) instead of zipping it.  Just for grins I used the example I posted to record a 615kb wav.  Zipped w/ max compression it came to 163kb.  Converted to mp3 (128kbps, 44khz) it came down to 57kb (unzipped).  And that's without changing the quality level of the original wav at all.  You could speak for about 20 secs, save the wav, convert it to mp3, send it, and 57kb wouldn't bog any connection down.  Sounds great to me.  Although the mp3 conversion is easier said than done I think.</div>
    <div class="meta">Posted on 2002-01-08 12:07:26 by Will</div>
   </div>
   <div class="post" id="post-48457">
    <div class="subject"><a href="#post-48457">mci wav recording/saving example</a></div>
    <div class="body">Hi!<br /><br />Maybe you can use J?rgen Ibsen's aPLib compression library....or JCALG1 by Jeremy Collake. I believe there is an example using aPLib included with the masm32 package. That would be a lot easier!<br /><br /><br />/Delight</div>
    <div class="meta">Posted on 2002-01-08 13:43:02 by Delight</div>
   </div>
   <div class="post" id="post-48461">
    <div class="subject"><a href="#post-48461">mci wav recording/saving example</a></div>
    <div class="body">Hossa<br /><br />i have a small beta finish ,if you like to test it send me a message :-)<br />in the moment the tool is split in two files ...server/client.<br />if you and me have booth running whe can send small messages like icq and after i found your snippet whe can talk ,i hope that all works like on my pc...i will make a small beta test with some of my friends today :-)<br /><br />personal i know : yesterday it works ,today not.<br />hehehe ,so im looking forward to the beta test.<br /><br />for packing i want to use &quot;pkzip.exe&quot;<br />if you pack a 1.5 mb bitmap you get a 40kb packet file.<br />&quot;pkzip.exe&quot; has 24kb size so you can insert it easy as resource and then stream it to c:\temp for packing<br />to unpack you need pkunzip.exe.<br /><br />better where when i can youse jpg....but i dont have the time to learn how to implement jpg.<br /><br />next i would insert a notify if user is online so you dont have to send emails with the ip first.<br />i think i mail nocturnal and ask him if he like to help me on this ;-)<br /><br />thats why i love OPEN SOURCE !<br />some code a function ,you grab it and code some other stuff to it then you make it open source and another one grab it and so on and so on.......<br />only those : keepers of the code or master of talking nonsens<br />make open source growing slow !<br /><br />at last some people here in this board.<br />they mean if they dont speak about something it will be gone from this world ,or if there is a explosion they can say : whe have nothing to do with this ,only that whe do nothing against it.<br /><br />but thats another story :-)<br /><br />many thanks for the tip with the mci !!!<br />some time asm is more then easy :-)<br />try the same stuff with delphi.<br /><br />more people need to know this.....</div>
    <div class="meta">Posted on 2002-01-09 07:54:30 by Max</div>
   </div>
   <div class="post" id="post-48452">
    <div class="subject"><a href="#post-48452">mci wav recording/saving example</a></div>
    <div class="body">Max, keep in mind that the zip algo (or probably most any compression algo) doesn't compress all files at the same ratio.  For example, if the file is already compressed (i.e. a wav file) then it can't be compressed as much as an uncompressed file like a big text file or something.  A bitmap compresses much smaller then a wav file.  If you're dealing with users with a good connection (sadly not me) then it won't affect them much but I'd think that compressing it to mp3 before sending would be preferrable(sp?).  Although that's not an easy task.  Using pkzip or something similar is an easy alternative though since you can shell to it with cmd line params (at least the last time I used it).  Just make sure that everyone using your program has it.<br /><br />For the online notification issue....  Can't you just set up a listening port on the server on startup, and have the ......  Nevermind, I just realized that you might not have a static ip so that wouldn't work.  Hmmm....  Other than setting up a website and setting up your client to send its ip to it when the client is started, and then having the client get the list (cgi get maybe?) I can't offer any help.  That would work theoretically though eh?<br /><br />btw what's &quot;Hossa&quot; mean?</div>
    <div class="meta">Posted on 2002-01-09 12:58:51 by Will</div>
   </div>
   <div class="post" id="post-48462">
    <div class="subject"><a href="#post-48462">mci wav recording/saving example</a></div>
    <div class="body">Hossa  (in another language and another time this means Hi or Hello) *bg*<br /><br />sorry for the late reply but i sleep a whole day after coding a whole night ..im getting older :)<br /><br />youre right with the compression of wav files ,i simply forget that they are compressed as wav :-)<br />hm possible i can use a driver from the system to recored the wav.....i remember i use in delphi such a driver..1minute is 150 kb size.<br />but i need to remember the name of the driver first or fid my delphi source cd.....grmbl.<br /><br />when server/client connects i check if the user has enabled zip plugin ,if booth have it i use it.<br />if not ,normal wave will use.<br /><br />i use at this time a single server and a single client ,so if you like to get incomming messages or voices you must start the server ,if you only like to talk to someone just open the client.<br />i think so noone has a security problem running all the time a server.<br /><br />next i need to change that you dont need to be connected to send messages.<br />my idea is ,if you start the tool it read infos from a cgi where is online and write himself to the online list.<br />if you press now on a name in the list ,you can send a msg or voice msg.<br />your client connect the server ,send stuff and disconnect when you get all successfully.<br /><br />since this is my first network app i get everyday another problem i didnt think of first.<br />first i want to make a simple tool to talk to my friends ,now i want to make it free for all........<br />that need a real working tool without bugs and much more features and more handle of connections at the same time.<br /><br />the biggest problem is that im to lazy to code a file transfer function so i start using a old trojan source.<br />now i need to delete all strings and so on....so av soft will never call my app as possible trojan xyz.<br /><br />i come back at monday here and i hope i can post a working version what works for more then two users :-)</div>
    <div class="meta">Posted on 2002-01-11 02:42:10 by Max</div>
   </div>
   <div class="post" id="post-48458">
    <div class="subject"><a href="#post-48458">mci wav recording/saving example</a></div>
    <div class="body">Just some pointers that may help :<br /><br />Wav isnt (in its normal form) compressed.<br /><br />Mp3 would be a better compression method , but why not take a look at ogg ( <a target="_blank" href="http://www.vorbis.com/index.psp">http://www.vorbis.com/index.psp</a> ) - you should be able to get good speech quality at 16 to 24kbits !! which would enable almost no delay on modem setups therefore it would be like talking on the phone.<br /><br />I beleive its free and they have an api for programmers on their web page.Its a newer compression designed to beat mp3 especially on lower bitrates.Go for it!<br /><br />BUT if you want to stick with Mp3 then go for Lame, it decodes and encodes quick, has an api and produces good quality through use of variable bit rates as i think ogg does too.<br /><br />ie if you pause during talking it will use low bits because of a flat sound wave, it can then use the extra bits to get better quality when ur speaking thus averaging around the required bandwidth eg 24Kbits.<br /><br />Heck if you want to be really clever you could scan the wav data easily and check for values close to zero over a susatined period ( eg &gt; 0.1 sec ) and completely zero them, thus helping the compression algorythms further. This would apply to both mps and ogg.<br /><br />goodluck and keep us up to date, I'd like to try it with distant family, friends.<br /><br />Byee.</div>
    <div class="meta">Posted on 2002-01-11 03:08:18 by trancera</div>
   </div>
   <div class="post" id="post-48453">
    <div class="subject"><a href="#post-48453">mci wav recording/saving example</a></div>
    <div class="body">Good info trancera.  Thanks for the correction about the wav format.  It's definitely uncompressed raw data.  I'll be playing with lame and ogg over the weekend.  :)</div>
    <div class="meta">Posted on 2002-01-11 11:04:58 by Will</div>
   </div>
   <div class="post" id="post-48446">
    <div class="subject"><a href="#post-48446">mci wav recording/saving example</a></div>
    <div class="body">aPLib might be better than zip, but it still wont get nowhere<br />near mp3 compression. There are big differences between generic<br />lossless compression (aPLib, zip, rar, whatever) and specialized<br />lossy (mp3, jpeg/mpeg, whatever).<br /><br />Also, you can take a look at the LAME mp3 coder... it's available<br />in DLL form, which you should be able to plug directly into your<br />asm code. It's already used by a few realtime projects, I think.<br /><br />Max, how would you &quot;stream&quot; pkzip/pkunzip? I don't think any of<br />them allows using stdin/stdout... your method definitely wouldn't<br />be realtime. It would be quite clunky :). And embedding pkzip/pkunzip?<br />Icky icky! (If you really want to use zip for this, at least use<br />infozip or zlib...)<br /><br />Wav files are not usually compressed (well, WAV is just a container<br />and can really contain just about anything, but usually you're dealing<br />with 16bit 44khz stereo uncompressed PCM data). The reason typical<br />compression algorithms doesn't compress this well, is that they work<br />on repetitous byte/bit strings. Sound data is based on oscillations<br />from a &quot;base level&quot; or &quot;neutral level&quot;. Think about wave data as +/-<br />stuff that makes the membrane in your speaker swing. <br /><br />As trancera notes, you might want to go for OGG. OGG is free, while<br />MP3 these days require licensing if you want to use it. Dunno how<br />their policy is to freeware stuff, though.<br /><br />There, hope I added a few new things to the thread, and that I'm not<br />too flawed =).</div>
    <div class="meta">Posted on 2002-01-11 13:57:22 by f0dder</div>
   </div>
   <div class="post" id="post-48463">
    <div class="subject"><a href="#post-48463">mci wav recording/saving example</a></div>
    <div class="body">Hossa<br /><br />thanks for the help :-)<br />i now use WMA !<br />700KB wav = 11kb WMA clear quality !!!<br /><br />but for now im searching since yesterday night a way to play my x#X!?#X wma file *grmbl*<br />i use mci play ....waveaudio i cange to mpgvideo2 .like the wma settings in my system.ini<br />but it wont play.<br /><br />any ideas how to play wma files ?<br />i can use shellexecute to open the wma ,but then media player pop ups and thats not what i want :-)<br /><br />if someone like i post today a beta of SmallTalk.<br /><br />Ps : i seach my system for files containing the word : waveaudio<br />then i found win.ini<br />inside a entry  <br />wav=waveaudio <br />and<br />wma=MPEGVideo2 <br /><br />since i have to use waveaudio to play wave files with the mci ,i think i need to use now MPEGVideo2 to play a wma file.<br />but it wont work..........i only hear the MessageBeep :-(<br /><br /><br /><br />PS 2:<br />-----------<br />Max, how would you &quot;stream&quot; pkzip/pkunzip? <br />-----------<br />sorry i wrote a translation error ,i mean not stream to other users ,i mean &quot;extract&quot; the zip file from resources to the user hard drive :-)<br />like i use zip.exe as  zip.bin in resource.</div>
    <div class="meta">Posted on 2002-01-14 05:56:26 by Max</div>
   </div>
   <div class="post" id="post-48447">
    <div class="subject"><a href="#post-48447">mci wav recording/saving example</a></div>
    <div class="body">Max, it would be better to use LAME (for mp3) or perhaps Ogg Vorbis.<br />Recording a file, sending, playing... there will be so much lag in this<br />approach that it will be hard to keep up a conversation. Also, it will<br />be in the form of &quot;press a button to record / say a sentence / press<br />button to stop recording / send&quot;.  That will feel weird :). With LAME<br />(and possible Vorbis), it's possible to stream the data.<br /><br />Yes, this will take more coding, and you probably cannot use MCI<br />to do the playback. But the end results will be so much better.</div>
    <div class="meta">Posted on 2002-01-14 06:03:26 by f0dder</div>
   </div>
   <div class="post" id="post-48464">
    <div class="subject"><a href="#post-48464">mci wav recording/saving example</a></div>
    <div class="body">Hossa Fooder<br /><br />WMA can also stream :-)<br />i can send it from the converter direct to the user.<br />take a look at the windows media encoder.<br />the size of the converter is 860kb ,after upx take a look at it its only 320kb.<br /><br />so at this time you press the button for record ,then stop and seconds later you have the voice.<br />i test it with &quot;dsl&quot; users on normal wav (11khz 8bit mono) and the transfer is much fast on this big files.<br /><br />i test this night a lot functions on the media encoder and encoding a 1mb wav take on my 600mhz pc only 1 sec.<br /><br />so lets say you record 1 minute.<br />1.save wav to hd<br />2.open windows encoder with batch settings+start convert<br /><br />that takes 1or two seconds on my system.<br /><br />3.transfer file to user+check if file is ok(crc)<br />4.pop up dialog+play voice<br /><br />here its important that the user have fast connection or the filesize is small.<br /><br />when i use wma i can mix after step 2 ,step 3+4 to one step.<br />like:<br />3.send file to user and create a short buffer (lets 10% of the filesize) and start directly the playback.<br /><br />i take a look at ogg ,but im not familiar with C so it wont help me.<br />the lame dll has a big filesize and what when later times the author think of a registration ?<br />if i use WMA from &quot;microsoft&quot; i have the right to use it as long as i own windows :-)<br />thats simple and im shure the most users today can playback WMA ,so i dont need a new driver or something else.<br /><br />last after i see the filesize and hear the sound quality ,i wont use anything other then wma :-)<br />the goal is also its streamable.<br /><br />but hey :-)<br />first i start with a simple idea of connecting two users and let them talk ,now it looks and sounds like a big project.<br />if its a simple tool ,then it dosnt matter how long the transfer needs ,whats better fast phone with high bill or slow talk with no bill (because most have Flat Rate) ?<br /><br />but im very happy that others take interrest and try to help :-)<br /><br />if you dont get mad by watching my code i would happy if others join and whe can build up a team to make SmallTalk better and for more users useable.<br />last it would be a good thing for this community to talk cheap ,or :-) <br /><br />and hey whats when whe release it for free for all the other user ?<br />think of the fame &quot;ASM&quot; will become.<br />today all other voice communicators i found are big and most they spy on the users.<br />think of the multiplayer community, im shure they like to get a small takling tool for better gameplay.<br />if the game companys are not able to code such a tool ,why should whe not do it :-)<br />look at gamespy or mplayer.com and you see what i mean ,ugly voice chat and last it takes hours to send my speach.<br /><br />the project status is at this time:<br />1.client<br />2.server<br />the ready tool has booth in one tool ,i need it for testing and learning as two files for now.<br /><br />functions:<br />send text message<br />send voice message<br />send a file<br />record voice<br />play voice<br />set/get wav volume<br />set username<br />check if client/server are from same version (blocks hopefull scanning script kids)<br /><br />what i plan to insert next:<br />decrypt the text before i send it<br />convert wav to wma<br />stream wma to user<br />let user connect to a webservr with database of online users and ad him there<br /><br />and last...do all the style stuff.<br />at now i do more like this :<br />at day i fix all bugs i typed in late nights ,hehe<br /><br />so if someone has time and like to join ,i dont bite ;-)</div>
    <div class="meta">Posted on 2002-01-14 06:28:12 by Max</div>
   </div>
   <div class="post" id="post-48459">
    <div class="subject"><a href="#post-48459">mci wav recording/saving example</a></div>
    <div class="body">well its up to you, lame seems the easiest , i doubt he will ever stop people using it - he's been at it ages and MANY programs use it.<br /><br />I just think a lame decode to wav and playing the wav seems a lot easier.<br /><br />And what if Mircosoft change their mind ? not like them to do that is it ?<br /><br />GoodLuck!</div>
    <div class="meta">Posted on 2002-01-14 09:22:50 by trancera</div>
   </div>
   <div class="post" id="post-48465">
    <div class="subject"><a href="#post-48465">mci wav recording/saving example</a></div>
    <div class="body">Hossa<br /><br />now its working with WMA :-)<br />if the user talk some seconds the filesize of the voice.wma is mosttime not up to 20kb in 22khz 16bit.<br />converting takes not more then two seconds....<br /><br />i build the server in the client and then i release a beta.<br />im unshure if i should use the server in the client or should i do a server.dll or or or....<br /><br />sorry for talking so long about betas..if someone want a testversion i can post it ,but i like it more when i release something that works so this take some time again :-)<br /><br />@ 4oh4:<br />had you sen that if you record a wav ,with your sample source ,this file isnt a &quot;real wav&quot; file ?<br />do a right click on it and take a look ,or try double click it wont play on media player.<br />there is a misstake in the settings ,i try some different settings but i dont get it.<br />alltime the file looks like : PCM,<br />a normal file looks like : PCM ,44khz 16bit ......<br />possible thats why in the &quot;SET&quot; function are some things missing ,as i say i tryed a lot combinations but it wont work.<br />what a luck that Media Encoder encode it ,so i can finaly hear it as WMA.<br /><br />happy coding</div>
    <div class="meta">Posted on 2002-01-15 04:39:57 by Max</div>
   </div>
   <div class="post" id="post-48454">
    <div class="subject"><a href="#post-48454">mci wav recording/saving example</a></div>
    <div class="body">heya Max,<br /><br />I use winamp for most audio stuff.  I've never really used windows media player so I'm not sure what's wrong there.  There are several control settings that I don't set though so maybe there are other flags that have to be set for the wav to be played in the windows media player.  -shrugs-<br /><br /><br />This is what winamp says about wavrec.wav:<br /><br />Data format<br /><br />Size of Format: 16<br />Format: PCM<br />Channels: 2<br />Samplerate: 44100<br />Bytes/Sec: 11025<br />Block Align: 4<br /><br /><br />Output format<br /><br />Couldn't find<br />destination<br />format<br /><br /><br />So if you plan to use wmp maybe you'll have to set the other waveaudio control flags?  It seems that winamp is more forgiving.<br /><br />nevermind....  I just reread your post and you've already tried setting the other flags.</div>
    <div class="meta">Posted on 2002-01-15 11:49:06 by Will</div>
   </div>
   <div class="post" id="post-48456">
    <div class="subject"><a href="#post-48456">mci wav recording/saving example</a></div>
    <div class="body">For ogg vorbis, its clearly stated that is free open-source, the only thing is that the sample inplementation is GPL (also known as a legal virus :grin: ), so to use it on non-opensource you must make your own. But since you are not making something comercial you will have no problem with it. <br /><br />Since the author of ogg vorbis stated it on his web as FREE open-source, he cannot backup from that statement. <br /><br />As for WMA, how do you play one? <br />Which API is used? Is there an SDK?<br />How you encode  a WMA?</div>
    <div class="meta">Posted on 2002-01-15 19:04:28 by dxantos</div>
   </div>
   <div class="post" id="post-48448">
    <div class="subject"><a href="#post-48448">mci wav recording/saving example</a></div>
    <div class="body">dxantos, sometimes you can get away with using GPL stuff in a DLL<br />and not releasing source to the rest of your application :)</div>
    <div class="meta">Posted on 2002-01-16 03:32:20 by f0dder</div>
   </div>
   <div class="post" id="post-48466">
    <div class="subject"><a href="#post-48466">mci wav recording/saving example</a></div>
    <div class="body">-----------<br />As for WMA, how do you play one? <br />-----------<br />just simple ,like wave files.<br />i send the mci command PLAY with the filename xyz.wma<br /><br />you need those entrys:<br />1.SYSTEM.INI<br />  <br /> MPEGVideo2=mciqtz.drv<br /><br />2.WIN.INI <br />  <br /> wma=MPEGVideo2 <br /><br /><br />------------------------------<br />Which API is used? Is there an SDK? <br />------------------------------<br />MCI API is used.<br />tip: download the mci api help from dolphinz Homepage.<br /><br /><br />-----------------------------<br />How you encode a WMA?<br />-----------------------------<br />just simple ,there is a encoder from microsoft for this :<br />Windows Media 8 Encoding Utility<br />i use a batch file for converting the voice.<br />like : 	<br />wm8eutil.exe  -input song.wav -output song.wma -a_setting 48_44_2<br /><br />where a_setting 48_44_2 are the settings for the sample rate.<br /><br />encoding is also much fast :-)</div>
    <div class="meta">Posted on 2002-01-16 06:01:54 by Max</div>
   </div>
   <div class="post" id="post-48467">
    <div class="subject"><a href="#post-48467">betatest</a></div>
    <div class="body">Hossa<br /><br />dont know if here are people who thrust me after all the stuff about virus&amp;trojans in the code snippet i post.....but i like to introduce the worlds baddest coded and hopefull smallest voice communicator *rofl*<br /><br />all works like i want it so im shure some users find it usefull and also id like to hear if there are problems on other systems.<br /><br />i use windows98se + soundblaster128 + 600mhz<br />encoding works fast <br />filetransfer time... hm i have dsl so i cant say anything to it and like to hear the comment from other users.<br /><br />dont know what to say.......read the readme.txt.<br />i go to talk some lines with my friends......cant say how much fun i have talking with my own tool.<br />cant be !!!<br /><br />thanks to all who helped me here !<br /><br /><br />ARG...i had to split the files...filesize is 330kb because is use the windows media encoder to encode wav to wma.<br /><br />ok here is the first file:</div>
    <div class="meta">Posted on 2002-01-16 16:42:53 by Max</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=6711&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=6711&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="6711" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=6711&amp;page=2">&gt;</a><a href="../?id=6711&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>