<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Parseing - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30925" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=30925">Parseing</a></p>
   <div class="post" id="post-216291">
    <div class="subject"><a href="#post-216291">Parseing</a></div>
    <div class="body">Hi all,<br />I&#039;m trying to parse a text file to extract individual records. The file is an export print file. The problem is that the file is space padded. each line is lfcr terminated.<br /> <div class="quote"><br />Name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  lfcr<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; adddr1&nbsp; &nbsp; &nbsp; &nbsp;  lfcr<br />addr2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; addr2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; addr2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lfcr<br />town&nbsp; state&nbsp; &nbsp; town state&nbsp; &nbsp;  town&nbsp; state&nbsp;  lfcr<br />zip&nbsp;  cus#&nbsp; &nbsp; &nbsp; zip&nbsp; cus#&nbsp; &nbsp; &nbsp; zip&nbsp; cus#&nbsp; &nbsp;  lfcr<br /></div><br />Each record consists of 5 lines that may contain blank fields. Spaces are used as field delimiters. Also some fields contain 2 spaces between words. <br />I read each line into a buffer and then parse it into 3 buffers.<br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xor edx,edx		<br />			mov edi,&nbsp; &nbsp; ;dest<br />			call strend<br />			mov esi,buffer&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;scr<br />		 @next:&nbsp;  	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />		&nbsp; &nbsp; mov al,byte<br />		&nbsp; &nbsp; inc esi&nbsp; &nbsp; <br />		&nbsp; &nbsp; cmp al,20h<br />			je spc&nbsp; <br />		&nbsp; &nbsp; mov ,byte al <br />			inc edi&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />		&nbsp; &nbsp; dec ecx<br />		&nbsp; &nbsp; test ecx,ecx<br />		&nbsp; &nbsp; je end_word	<br />			jmp @next<br />		spc:<br />			inc dword<br />			cmp ,dword 3<br />		&nbsp; &nbsp; je end_word&nbsp; <br />			jmp @next<br />		end_word:<br />		dec edi<br />		mov byte, &#039;,&#039;<br />		add edx,1<br />		mov edi,<br />		xor ecx,<br />		add esi,ecx<br />		xor eax,eax<br />		mov ,dword 0<br />		cmp edx,3<br />		je end_<br />		jmp @next<br />		end_:<br />	cc printf,&quot;%s %0X %s&quot;,,,NewLine&nbsp; &nbsp; 		<br />	cc printf,&quot;%s %0X %s&quot;,,,NewLine		<br />	cc printf,&quot;%s %0X %s&quot;,,,NewLine		<br /></code></pre><br /><br />The code above explains better how I intend to do it. <br />Any help is greatly appreciated.<br /><br />Mich</div>
    <div class="meta">Posted on 2012-09-23 23:31:06 by mich</div>
   </div>
   <div class="post" id="post-216292">
    <div class="subject"><a href="#post-216292">Re: Parseing</a></div>
    <div class="body">mich, are you sure the fields are space-separated and not tab-separated? From your description it looks like parsing the rows reliably is impossible to achieve. For instance, what is preventing the 3rd row to be interpreted in the following manner?<pre><code>town&nbsp; state&nbsp; |&nbsp; town state&nbsp; &nbsp;  town | state&nbsp;  lfcr</code></pre>(I&#039;m using &quot;|&quot; as field delimiter)</div>
    <div class="meta">Posted on 2012-09-24 08:07:36 by LocoDelAssembly</div>
   </div>
   <div class="post" id="post-216293">
    <div class="subject"><a href="#post-216293">Re: Parseing</a></div>
    <div class="body">Thanks for your reply LocoDelAssembly<br />No tabs. The file will print in 80 chr width. I will try to find the column boundary and copy all characters into&nbsp; the buffers, append field delimiter&nbsp; (&#039;,&#039;). Once I have delimited fields, I will remove the extra spaces.<br /><div class="quote"><br />town&nbsp; state&nbsp; |&nbsp; town state&nbsp; &nbsp;  town | state&nbsp;  lfcr<br /></div><br />town&nbsp; state is padded with 2 spaces. The distance between State and town are space padded. It looks to me as if the columns are 26 or 27 characters wide. The longest field name is about that long with a single space separating it from the first letter in the second column etc.<br />I will change the loops in my routine and give this a try.<br />Mich</div>
    <div class="meta">Posted on 2012-09-24 14:50:05 by mich</div>
   </div>
   <div class="post" id="post-216294">
    <div class="subject"><a href="#post-216294">Re: Parseing</a></div>
    <div class="body">You shouldn&#039;t be parsing by spaces. You&#039;ve already said that there should be a length limit (80 chars) and that you&#039;ll be working on data in blocks of 5 lines at a time.<br /><br />So the easy solution for this is to create a buffer that is 410 bytes (80 chars * 5 lines + (2 chars * 5 lines)) and read the entire block into that buffer. Then just access a static set of offsets into that buffer since they are unlikely to change. For example, if each column was 26 characters long, we could handle this by using a pointer to the 410 byte buffer, then use (row * 80) + (col * 27) where both row and col are a zero-based indices for our &quot;table&quot;.<br /><br />We could then easily start at the end of each column&#039;s text (ie. [(row * 80) + (col * 27) + 26])&nbsp; and overwrite all the 0x20&#039;s (spaces) with 0x00 (null terminators) and then treat the entry as a normal C-string.<br /><br />Regards,<br />Bryant Keller</div>
    <div class="meta">Posted on 2012-09-24 20:10:44 by Synfire</div>
   </div>
   <div class="post" id="post-216295">
    <div class="subject"><a href="#post-216295">Re: Parseing</a></div>
    <div class="body">Thanks for your answer Synfire,<br /><div class="quote"><br />&nbsp; #0697667 GB LTD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #0719830 GB LTD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #0731990 GB LTD BDA LONA&nbsp; <br />PO BOX 3129&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  PO BOX 4530&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  	SG3 SITE 11 COMP 138&nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 			STN MAIN 14311 ALASKA VENUE&nbsp;  <br />BECIL CAKE&nbsp; NT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ECIL RAKE&nbsp; TB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  	FROZEN&nbsp; JOHN&nbsp; VA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />V04 1G0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  24860&nbsp; VTC 1G0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  24986&nbsp; 	VGJ 4M7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  26024&nbsp; <br /></div><br />Unfortunately the formatting is screwed up and the columns are not properly aligned but I think you will see what I mean.<br /><br />I have tried to remove multiple spaces but this causes severe distortions in the case of line 3. The fields for address2 are blank in column one and two, causing the field for column 3 to be shifted into column one. Furthermore, number companies all start with a space. Overwriting spaces with 0 would create strings for each word. Not sure how to get that straightened out at the end?<br />Further analyzing the file reveals that the first chr in column 1 starts at 1, first chr in column 2 starts at position 27, first chr in column 3 starts at 54. Line length is 79 chr with lfcr at the end for a total line length of 81 chr.<br />I like your suggestion to read a block of data and then using the indices to extract the strings. <br />I will work out something in the next few days.<br />Mich</div>
    <div class="meta">Posted on 2012-09-25 00:45:00 by mich</div>
   </div>
   <div class="post" id="post-216297">
    <div class="subject"><a href="#post-216297">Re: Parseing</a></div>
    <div class="body">Google for &#039;pretty printer&#039; - that&#039;s what you need to be doing.<br /></div>
    <div class="meta">Posted on 2012-09-27 00:46:09 by Homer</div>
   </div>
   <div class="post" id="post-216440">
    <div class="subject"><a href="#post-216440">Re: Parseing</a></div>
    <div class="body"><strong>mich</strong>,<br /><br />You may enclose monospaced text in <strong>[?code][?/code]</strong> BBCode tags:<br /><pre><code><br />1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  27&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  54&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  79<br />#0697667 GB LTD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #0719830 GB LTD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #0731990 GB LTD BDA LONA <br />PO BOX 3129&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  PO BOX 4530&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SG3 SITE 11 COMP 138&nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  STN MAIN 14311 ALASKA VENUE&nbsp;  <br />BECIL CAKE&nbsp; NT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ECIL RAKE&nbsp; TB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FROZEN&nbsp; JOHN&nbsp; VA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />V04 1G0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  24860&nbsp;  VTC 1G0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  24986&nbsp; VGJ 4M7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  26024<br /></code></pre><br />for proper alignment.<br /><br />There is something strange with this format. While it looks like strikingly similar to punched cards ;-), first column is 26 cells wide (according to your numbers for field starting positions), second is 27 cells wide and last is only 25 cells wide (your data example contains some extra characters in this column).<br /><br />Three columns of 26 cells each will yield 78 cells total, plus LF/CR (is it correct sequence?) for 80 bytes/line.<br /><br />With fixed record/field size parsing shouldn&#039;t pose any problems (if I got it right). As <strong>Synfire</strong> had already said, replace padding spaces at the end of fields with zeros (ASCII NUL), and treat the results as regular nul-terminated strings. Beware though that if field occupies its full width (it isn&#039;t specified whether this can occur), there isn&#039;t any space to replace with &#039;\0&#039;.</div>
    <div class="meta">Posted on 2012-12-24 05:03:53 by baldr</div>
   </div>
  </div>
 </body>
</html>