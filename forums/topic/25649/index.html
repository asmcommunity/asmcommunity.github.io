<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Drawing a circle without sine and/or cosine - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25649" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=25649">Drawing a circle without sine and/or cosine</a></p>
   <div class="post" id="post-187192">
    <div class="subject"><a href="#post-187192">Drawing a circle without sine and/or cosine</a></div>
    <div class="body">Lately I have been thinking about a way to draw a circle without the use of the sine and/or cosine and I thought of a way which I am not sure is the best way to do this.<br /><br />Let?s say we are given the center point of the circle and its radius. We can now create a loop which iterates from Center.x-Radius to Center.x+Radius or maybe even downwards from Center.x+Radius to Center.x-Radius. Now we have one point on the radius which is the center of the circle and one point which we have the X to, which is located on the circumference. We can then calculate the Y position of this point using the distance formula as in:<br /><br />Radius = Sqrt ((P1.x - P2.x) ^2 + (P1.y - P2.y) ^2)<br /><br />We have the radius and the x, y position of the first point and also the x position of the second point, therefore, we are only left to find the y position of the second point. The final x and y position of the second point would be a point on the circumference, wouldn?t it be?<br /></div>
    <div class="meta">Posted on 2006-12-29 23:06:00 by XCHG</div>
   </div>
   <div class="post" id="post-187193">
    <div class="subject"><a href="#post-187193">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body">Yes you can calculate circles this way, but be aware that you&#39;re still using trigonometry - you&#39;re merely expressing the trigonometric equations in a different way.<br /><br />SOH CAH TOA<br /></div>
    <div class="meta">Posted on 2006-12-29 23:37:46 by Homer</div>
   </div>
   <div class="post" id="post-187201">
    <div class="subject"><a href="#post-187201">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body">Its still a nice way of showing that numbers are just dimensionless ratios no matter how complex we think equations are. <br /><br />e.g <br />cos(x) = 1- (x^2/2!) + (x^4/4!) ......<br /><br />just the sum of ratios<br /><br />Nicely done XCHG<br /></div>
    <div class="meta">Posted on 2006-12-30 16:15:04 by IIwastitan</div>
   </div>
   <div class="post" id="post-187207">
    <div class="subject"><a href="#post-187207">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body">XCHG,<br /><br />&nbsp; &nbsp;  Wouldn&#39;t it be more concise to assume a radius of 1.&nbsp; Then define the x-range from -1 to +1 and step it in say 200 steps, so that you need to compute the corresponding y-value of x from -1,-.99,-.98,-97,...,0,.01,.02,.03,...,.97,.98,.99,1 .&nbsp; Then the y-values can be calculated simply by Pythagoras&#39;s theorem, which is plus or minus SQRT(1-X^2) for each x-value.&nbsp; If the radius is greater than 1, the x and y values can easily be scaled up.&nbsp; Ratch</div>
    <div class="meta">Posted on 2006-12-30 21:54:33 by Ratch</div>
   </div>
   <div class="post" id="post-187209">
    <div class="subject"><a href="#post-187209">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body">IIwastitan,<br /><br /><div class="quote">...&nbsp; sin(x) = 1- (x^2/2!) + (x^4/4!) ......&nbsp;  ...</div><br /><br />&nbsp; &nbsp;  The formula you gave is for the cos, not the sin.&nbsp; Ratch</div>
    <div class="meta">Posted on 2006-12-30 21:58:41 by Ratch</div>
   </div>
   <div class="post" id="post-187211">
    <div class="subject"><a href="#post-187211">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body">IIwastitan,<br /><br />Isn&#39;t that like a very twisted interpretation of taylor&#39;s expansion? </div>
    <div class="meta">Posted on 2006-12-30 22:23:33 by roticv</div>
   </div>
   <div class="post" id="post-187213">
    <div class="subject"><a href="#post-187213">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body">Look up Bresenham&#39;s Circle Algorithm.&nbsp; It&#39;s very simple and doesn&#39;t need anything more than bit shifting and addition/subtraction, so it&#39;s highly regarded as the fastest circle drawing algorithm.&nbsp; The more general version of the algorithm also applies to arbitrary curves, and the line-specific version is very fast.<br /><br />I hope this helps.&nbsp; :)</div>
    <div class="meta">Posted on 2006-12-30 22:49:32 by hackulous</div>
   </div>
   <div class="post" id="post-187234">
    <div class="subject"><a href="#post-187234">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body">Just to ditto Bresenham&#39;s algo.&nbsp; It is the most often used method.</div>
    <div class="meta">Posted on 2006-12-31 23:04:42 by drhowarddrfine</div>
   </div>
   <div class="post" id="post-187236">
    <div class="subject"><a href="#post-187236">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body">Ratch,<br /><br />I believe that the Pythagorean Theorem states that in the right triangle, the length of the hypotenuse squared is equal to the sum of the squares of the other two sides. Therefore, if I have the x position which is put in iteration for example from -1 to +1 in a unit circle and I also have centre point I don?t think that I would be merely able to calculate the y position using that formula.<br /><br />In that case, I will first have to find the line formula for the side of the right triangle with one point at the center and one at the x position in the iteration which is pretty easy with a fixed slope for infinite points on the vertical line. After that I have to find where the hypotenuse and the other side of the triangle intersect which would be a point on the circumference. Or maybe I?m wrong?!<br /><br /><br /><br />hackulous,<br /><br />I hadn?t heard about this algorithm but I sure will search for it in Google and see what comes up. Thank you.<br /><br /><br /><br />drhowarddrfine,<br /><br />I?ll look for that too, thanks.<br /><br /></div>
    <div class="meta">Posted on 2007-01-01 02:10:55 by XCHG</div>
   </div>
   <div class="post" id="post-187238">
    <div class="subject"><a href="#post-187238">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body"><br />i have seen an algo that claims to be faster than bresenham, although&nbsp; based on it.<br /><br />its called frith &#39;s algo.<br /><br />it was hidden in a pile of demoscene resources and now its not online anymore. i had that&nbsp; on a harddrive... tha crashed some time ago. lesson: donttrust the internet! grab what you can when you can. make backups! i found it again somewhere, but without some comments. they said there was an asm version with a big speed increase. there was also an asm line drawing based on ADC and i think it was 1 instruction/pixel.<br />the academic algos that everyone quotes are not necessarly the best ever crafted.<br /><br />demomakers rule!<br /><br />http://www.java-tutor.com/aufgaben/j/insel/additives/base/fcircle.txt<br /><br />and yeah, i know its based on setpixel. i guess its up to you to make an vram-address- based algo out of this and/ of to convert to&nbsp; assembly... :)<br /><br />bye.<br /></div>
    <div class="meta">Posted on 2007-01-01 06:05:41 by HeLLoWorld</div>
   </div>
   <div class="post" id="post-187239">
    <div class="subject"><a href="#post-187239">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body"><div class="quote">lesson: donttrust the internet! grab what you can when you can. make backups!</div>1000% agree!</div>
    <div class="meta">Posted on 2007-01-01 09:28:20 by drhowarddrfine</div>
   </div>
   <div class="post" id="post-187241">
    <div class="subject"><a href="#post-187241">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body">From working at D-Wave Systems on quantum-computer-related stuff, I&#39;m well aware that theoretical ideas quite often don&#39;t work nearly as well in practice.&nbsp; However, an algorithm is not its implementation.&nbsp; You can make implementations of Bresenham&#39;s algorithms that are <strong>much</strong> faster than coding them &quot;straight up&quot;, but it&#39;s just a good implementation of the same algorithm.&nbsp; That said, Frith&#39;s algorithm does appear not to be Bresenham&#39;s circle algorithm, but it is in the general class of Bresenham curve-drawing algorithms because it uses a balance variable that causes one action when below zero and another when above zero.&nbsp; From the looks of it, it might or might not be much faster than Bresenham&#39;s circle algorithm once both are optimized.&nbsp; Also, one instruction per pixel is impossible unless you&#39;ve got a horizontal line and do it with &quot;rep movsd&quot;, because to have a loop that draws a line, you need at least two instructions to update x and y, one instruction to set the pixel value, and one instruction to jump back.<br /><br />On a semi-related note, the code in fcircle.txt does use dangerous syntax for C/Java that may produce different execution from different compilers, namely using a prefix/postfix ++/-- operator on a variable that is used elsewhere in the line.&nbsp; Some compilers have the ++/-- executed in left-to-right order, some in right-to-left order, and some leave them until after everything else on the line has been evaluated, so I&#39;m not sure which his code is assuming.&nbsp; In Java I think it&#39;s standardized to left-to-right, and both VC++ and GCC do something different.&nbsp; Try out &quot;a += a++ + ++a + a;&quot; or something else crazy like that to see the differences.<br /><br />Edit: Sorry, my statement of &quot;highly regarded as the fastest&quot; is a gross generalization and shouldn&#39;t be given a lot of weight.&nbsp; It&#39;s just that it&#39;s hundreds of times faster than trying to use stuff with square roots or trigonometry.</div>
    <div class="meta">Posted on 2007-01-01 11:45:41 by hackulous</div>
   </div>
   <div class="post" id="post-187247">
    <div class="subject"><a href="#post-187247">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body"><div class="quote"><br />From working at D-Wave Systems on quantum-computer-related stuff,<br /></div><br /><br />man, is that cool or what :)<br /><br /><div class="quote"><br />However, an algorithm is not its implementation.&nbsp; You can make implementations of Bresenham&#39;s algorithms that are much faster than coding them &quot;straight up&quot;, but it&#39;s just a good implementation of the same algorithm<br /></div><br /><br />mmy views quite differ.i see noabsolute differencebetween algo and implementation, no clear line. you could write an algo in C.youcould write an implementation in C. its just you further refine the code,thinking at how the machine will execute it.to my eyes,if you switch from setpixel-based to vram-based, youve just changed your algo, or at least refined.. because then vith vram you can do things you couldnt otherwise.<br /><br /><div class="quote"><br />That said, Frith&#39;s algorithm does appear not to be Bresenham&#39;s circle algorithm<br /></div><br />i seem to recall the original file said the algo had been designed while trrying to improve on bresenham. yes that&nbsp; doesnt mean its based onto it.<br /><br /><div class="quote"><br />lso, one instruction per pixel is impossible unless you&#39;ve got a horizontal line and do it with &quot;rep movsd&quot;, because to have a loop that draws a line, you need at least two instructions to update x and y, one instruction to set the pixel value, and one instruction to jump back.<br /></div><br /><br />i suppose youre perfectly right and&nbsp; im&nbsp; wrong.:)<br />it must have&nbsp; been&nbsp; 3 or 4 ops.<br /><br /><div class="quote"><br />On a semi-related note, the code in fcircle.txt does use dangerous syntax for C/Java that may produce different execution from different compilers, namely using a prefix/postfix ++/-- operator on a variable that is used elsewhere in the line.&nbsp; Some compilers have the ++/-- executed in left-to-right order, some in right-to-left order, and some leave them until after everything else on the line has been evaluated, so I&#39;m not sure which his code is assuming.&nbsp; In Java I think it&#39;s standardized to left-to-right, and both VC++ and GCC do something different.&nbsp; Try out &quot;a += a++ + ++a + a;&quot; or something else crazy like that to see the differences.<br /></div><br /><br />i also think thistype of coding quite sucks, its confusing for me. if on&nbsp; top&nbsp; of that its ambiguous even to compiler as you say, its not kewl at all. but sems experienced coders liked it back in the days.<br />btw in the src it seems &quot;&amp;&quot;&nbsp; means &quot;&amp;&amp;&quot; and &quot;;=&quot; means &quot;!=&quot;<br /><br /><div class="quote">Edit: Sorry, my statement of &quot;highly regarded as the fastest&quot; is a gross generalization and shouldn&#39;t be given a lot of weight.&nbsp; It&#39;s just that it&#39;s hundreds of times faster than trying to use stuff with square roots or trigonometry.</div><br /><br />yes, ofcourse. no problem!<br /><br />btw&nbsp; my keyboardsucks bigtime. :)<br /><br /></div>
    <div class="meta">Posted on 2007-01-01 14:08:08 by HeLLoWorld</div>
   </div>
   <div class="post" id="post-187248">
    <div class="subject"><a href="#post-187248">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body"><div class="quote">btw in the src it seems &quot;&amp;&quot;&nbsp; means &quot;&amp;&amp;&quot; and &quot;;=&quot; means &quot;!=&quot;</div><br /><br />no... gt and lt dont look like variables...&nbsp; maybe greater&nbsp; than and&nbsp; lessthan?<br /><br />dont understand&nbsp; thecode anyhow :)<br />strange</div>
    <div class="meta">Posted on 2007-01-01 14:18:22 by HeLLoWorld</div>
   </div>
   <div class="post" id="post-187249">
    <div class="subject"><a href="#post-187249">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body"><div class="quote"><br /><div class="quote">btw in the src it seems &quot;&amp;&quot;&nbsp; means &quot;&amp;&amp;&quot; and &quot;;=&quot; means &quot;!=&quot;</div><br />no... gt and lt dont look like variables...&nbsp; maybe greater&nbsp; than and&nbsp; lessthan?</div><br /><br />It&#39;s escaped for HTML or something, because &amp;lt; and &amp;gt; are standard HTML/XML entities.&nbsp; &quot;&amp;lt;&quot; is &quot;&lt;&quot; and &quot;&amp;gt;&quot; is &quot;&gt;&quot;.&nbsp; So, it actually reads:<br /><pre><code>void FCircle(int x, int y, int radius, uchar color)<br />{<br />&nbsp; int balance, xoff, yoff;<br /><br />&nbsp; xoff = 0;<br />&nbsp; yoff = radius;<br />&nbsp; balance = -radius;<br /><br />&nbsp; do {<br />&nbsp; &nbsp; SetPixel(x+xoff, y+yoff, color);<br />&nbsp; &nbsp; SetPixel(x-xoff, y+yoff, color);<br />&nbsp; &nbsp; SetPixel(x-xoff, y-yoff, color);<br />&nbsp; &nbsp; SetPixel(x+xoff, y-yoff, color);<br />&nbsp; &nbsp; SetPixel(x+yoff, y+xoff, color);<br />&nbsp; &nbsp; SetPixel(x-yoff, y+xoff, color);<br />&nbsp; &nbsp; SetPixel(x-yoff, y-xoff, color);<br />&nbsp; &nbsp; SetPixel(x+yoff, y-xoff, color);<br /><br />&nbsp; &nbsp; if ((balance += xoff++ + xoff) &gt;= 0)<br />&nbsp; &nbsp; &nbsp; balance -= --yoff + yoff;<br /><br />&nbsp; } while (xoff &lt;= yoff);<br />}</code></pre><br /><br />I think it might be faster with the loop unrolled by octant, so with that in mind, the optimized function might be something like the following (assuming that the compiler does left-to-right evaluation of the prefix/postfix operators).&nbsp; If done with the single loop, all 8 buffer addresses would need to be calculated instead of just keeping track of one.<br /><br /><pre><code><br />FCircle		proc	x:DWORD,y:DWORD,Radius:DWORD,Colour:DWORD,BufferStart:DWORD,BytesPerRow:DWORD<br />	pusha<br />	xor	ebx,ebx<br />	mov	ecx,Radius<br />	mov	esi,ecx<br />	neg	ecx<br />	<br />	mov	eax,esi<br />	add	eax,y<br />	mul	BytesPerRow<br />	mov	edx,x<br />	lea	eax,	<br />	add	eax,BufferStart<br /><br />	mov	edi,Colour<br /><br />NextPixel0:<br />	mov	,edi<br />	<br />	lea	ecx,<br />	inc	ebx<br />	add	eax,4<br />	test	ecx,ecx<br />	js	NoYAdjust<br />	dec	esi<br />	sub	eax,BytesPerRow<br />	sub	ecx,esi<br />	sub	ecx,esi<br />NoYAdjust:<br />	cmp	ebx,esi<br />	jbe	NextPixel0<br /><br /><br />;other 7 octants<br />...<br /><br /><br />	popa<br />	ret<br />FCircle		endp<br /></code></pre><br /><br />Working at D-Wave on co-op was really awesome.&nbsp; They&#39;ve got their first big public demo sometime in January, February, or March 2007.&nbsp; It&#39;ll be the world&#39;s first demonstration of a quantum computer being used for practical problems, and also the world&#39;s first demonstration of a 16-qubit quantum computer.&nbsp; Check out <a target="_blank" href="http://dwave.wordpress.com/">http://dwave.wordpress.com/</a> for the latest.&nbsp; I was even fortunate enough to get to write one of the two applications they&#39;ll be demoing (the molecule comparison one).&nbsp; :D</div>
    <div class="meta">Posted on 2007-01-01 15:15:29 by hackulous</div>
   </div>
   <div class="post" id="post-187250">
    <div class="subject"><a href="#post-187250">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body"><br />cant yet&nbsp; understand what d-wave and co op is about, but itseems tremendous...<br /><br />we programmers maybe soon will be&nbsp; outdated when new methods, &quot;hardware &quot; and thinking will show up...<br /></div>
    <div class="meta">Posted on 2007-01-01 16:02:42 by HeLLoWorld</div>
   </div>
   <div class="post" id="post-187254">
    <div class="subject"><a href="#post-187254">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body"><div class="quote"><br />we programmers maybe soon will be&nbsp; outdated when new methods, &quot;hardware &quot; and thinking will show up...<br /></div><br /><br />Even once quantum computers are eventually able to do a lot, there will still be a lot of thinking for people to do, so don&#39;t worry.<br /><br />As for Frith&#39;s algorithm, I went through the derivation, and it is indeed just a simple transformation of Bresenham&#39;s Circle Algorithm.&nbsp; It starts with:<br /><br /><pre><code><br />d = 3 - (2*Radius);<br />x = 0;<br />y = Radius;<br />do {<br />&nbsp; &nbsp; SetPixels();<br />&nbsp; &nbsp; if (d &lt; 0) {<br />&nbsp; &nbsp; &nbsp; &nbsp; d += 4*x + 6;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; else {<br />&nbsp; &nbsp; &nbsp; &nbsp; d += 4*(x-y) + 10;<br />&nbsp; &nbsp; &nbsp; &nbsp; --y;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; ++x;<br />} while (x&lt;=y)<br /></code></pre><br /><br />Then divide all references to d by 2 and then subtract 1.5 from its value:<br /><pre><code><br />d = -Radius;<br />x = 0;<br />y = Radius;<br />do {<br />&nbsp; &nbsp; SetPixels();<br />&nbsp; &nbsp; if (d &lt; -1.5) {<br />&nbsp; &nbsp; &nbsp; &nbsp; d += 2*x + 3;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; else {<br />&nbsp; &nbsp; &nbsp; &nbsp; d += 2*(x-y) + 5;<br />&nbsp; &nbsp; &nbsp; &nbsp; --y;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; ++x;<br />} while (x&lt;=y)<br /></code></pre><br /><br />Then move the 2*x+3 out of the if and subtract that from the 2*(x-y)+10:<br /><pre><code><br />d = -Radius;<br />x = 0;<br />y = Radius;<br />do {<br />&nbsp; &nbsp; SetPixels();<br />&nbsp; &nbsp; d += 2*x + 3;<br />&nbsp; &nbsp; if (d-(2*x+3) &gt;= -1.5) {<br />&nbsp; &nbsp; &nbsp; &nbsp; d += -2*y + 2;<br />&nbsp; &nbsp; &nbsp; &nbsp; --y;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; ++x;<br />} while (x&lt;=y)<br /></code></pre><br /><br />Then subtract 2x+2 from the value of d by adding 2 fewer to it every iteration:<br /><pre><code><br />d = -Radius;<br />x = 0;<br />y = Radius;<br />do {<br />&nbsp; &nbsp; SetPixels();<br />&nbsp; &nbsp; d += 2*x + 1;<br />&nbsp; &nbsp; if (d-1 &gt;= -1.5) {<br />&nbsp; &nbsp; &nbsp; &nbsp; d += -2*y + 2;<br />&nbsp; &nbsp; &nbsp; &nbsp; --y;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; ++x;<br />} while (x&lt;=y)<br /></code></pre><br /><br />Then take into account that d being an integer makes &quot;d-1 &gt;= -1.5&quot; equivalent to &quot;d &gt;= 0&quot;, and put the &quot;--y&quot; into the updating of d:<br /><pre><code><br />d = -Radius;<br />x = 0;<br />y = Radius;<br />do {<br />&nbsp; &nbsp; SetPixels();<br />&nbsp; &nbsp; d += 2*x + 1;<br />&nbsp; &nbsp; if (d &gt;= 0) {<br />&nbsp; &nbsp; &nbsp; &nbsp; d -= 2*(--y);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; ++x;<br />} while (x&lt;=y)<br /></code></pre><br /><br />That&#39;s pretty much all, and now I know that he did intend left-to-right evaluation order.&nbsp; Fun stuff&nbsp; :)</div>
    <div class="meta">Posted on 2007-01-01 17:31:38 by hackulous</div>
   </div>
   <div class="post" id="post-187294">
    <div class="subject"><a href="#post-187294">Re: Drawing a circle without sine and/or cosine</a></div>
    <div class="body"><div class="quote"><br />IIwastitan,<br /><br />Isn&#39;t that like a very twisted interpretation of taylor&#39;s expansion? <br /></div><br /><br />No its the exponential form of cos(x)<br /><br />cos(x) = 1 - (x^2/2!) + (x^4/4!)-...&nbsp;  (An even function)<br />sin(x) = x -(x^3/3!) + (x^5/5!)....&nbsp; &nbsp; &nbsp; (An odd function)<br /><br />add both series together but keep all signs positive and you have<br /><br />e^x = 1 + x+ (x^2/2!) + (x^3/3!).....<br /><br />So e^ipi + 1 =0<br />Eulers famous paradox</div>
    <div class="meta">Posted on 2007-01-03 15:25:09 by IIwastitan</div>
   </div>
  </div>
 </body>
</html>