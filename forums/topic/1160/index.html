<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Objects.inc ( &lt;&lt; HERE &gt;&gt; ) - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=1160" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=116">Windows</a> &raquo; <a href="../?id=1160">Objects.inc ( &lt;&lt; HERE &gt;&gt; )</a></p>
   <div class="post" id="post-7578">
    <div class="subject"><a href="#post-7578">Objects.inc ( &lt;&lt; HERE &gt;&gt; )</a></div>
    <div class="body">You guys got me feeling all bad that i have to bail for a few days after I rally'd people's interest.. so im posting OBJECTS.INC here with an example program.<br /><br />There is two classes.. NO inheritance.  (keeping it simple)<br /><br />I wrote a DC class to handle the creation of DC's etc for drawing graphics.  Its (CHDC - Class HDC ).<br /><br />I wrote a CBButton class (Class Bitmapped Button) to create Owner drawn buttons (by the class).<br /><br />The rest is a basic message loop frame, to make a WinAmp type custom window (the way it roles up in minimized mode).<br /><br />I havent documented it all to much tho.  But OBJECTS.INC is very well documented!!! I suggest you read it over as you study the code.  I put hours into documenting each macro, crossing my 'i' and dotting my 't's.. heheh  :)<br /><br />I hope it will help you see how the moster works.<br /><br />Enjoy! Post messages, i *will* eventually get back to them.  Or perhaps Thomas will beat me to the punch... <br /><br /><br />The file is 100K of graphics and 8K code. Get it off my web site, as i cant upload over 30K here --&gt; <a target="_blank" href="http://www.angelfire.com/scifi/win32asm/Nan_Src.html">First Item On the Page - &quot;RockStar&quot;</a> <br /><br />:alright: <br />NaN</div>
    <div class="meta">Posted on 2001-09-20 01:13:47 by NaN</div>
   </div>
   <div class="post" id="post-7630">
    <div class="subject"><a href="#post-7630">Objects.inc ( &lt;&lt; HERE &gt;&gt; )</a></div>
    <div class="body">hehe... That's a pretty spiffy program... To bad I don't understand it yet :alright:</div>
    <div class="meta">Posted on 2001-09-20 13:17:12 by Kenny</div>
   </div>
   <div class="post" id="post-7700">
    <div class="subject"><a href="#post-7700">Objects.inc ( &lt;&lt; HERE &gt;&gt; )</a></div>
    <div class="body">Yea me neither.. but I really want to learn it! any chance for a nice n easy  tutorial sometime??</div>
    <div class="meta">Posted on 2001-09-21 16:10:06 by closed_casket</div>
   </div>
   <div class="post" id="post-7702">
    <div class="subject"><a href="#post-7702">Objects.inc ( &lt;&lt; HERE &gt;&gt; )</a></div>
    <div class="body">Thomas posted a good tutorial in one of the other topics. Seems as if everything is the same as writing a single GDI program, but the difference is where he makes stuff an object that can do many things. (Kind of taking the specialization of ASM away in a good way.)<br /><br />I suppose writing something using these classes would be pretty easy. Take the windows proc of the GDI examples and just build on those. I think the fastest way to learn would be to make an object that displays a message box. &quot;Hello world&quot; is always the easiest :)</div>
    <div class="meta">Posted on 2001-09-21 16:29:30 by Kenny</div>
   </div>
   <div class="post" id="post-7703">
    <div class="subject"><a href="#post-7703">Objects.inc ( &lt;&lt; HERE &gt;&gt; )</a></div>
    <div class="body">I posted a more simple example in this thread: <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=1142"></a>. It doesn't show all things that can be done with objects.inc, only the basic things, inheritance &amp; superclassing..<br />No comments or tutor either.. sorry for that, it's the usual problem: lack of time.. I'll <strong>try</strong> to write some tutor tomorrow.<br /><br />Thomas</div>
    <div class="meta">Posted on 2001-09-21 16:33:18 by Thomas</div>
   </div>
   <div class="post" id="post-7706">
    <div class="subject"><a href="#post-7706">Objects.inc ( &lt;&lt; HERE &gt;&gt; )</a></div>
    <div class="body">Kenny: you beat me with your post :) <br />It is a simple GDI program just because that's the first thing I could think of to demonstrate the objects in a good way.. The important part here is that you can see that each object has it's own properties, and although one method (move) is called the same way for each object in the array, all objects draw their sprites according to their own properties.<br />This is the most important thing about classes.<br />btw the example wastes a lot of resources as it loads the bitmaps again and again for each object, this could be optimized but to keep it simple I didn't.<br /><br />Thomas<br /><br />(p.s. the program is much more fun when you set the MAX_SMILIES value to 1000 :grin: )</div>
    <div class="meta">Posted on 2001-09-21 16:38:38 by Thomas</div>
   </div>
   <div class="post" id="post-7711">
    <div class="subject"><a href="#post-7711">Objects.inc ( &lt;&lt; HERE &gt;&gt; )</a></div>
    <div class="body">Give me an idea of what kinda tut you want... <br /><br />Heres a start tho:<br /><ul><br />[*]Objects must be instanciated, this is actually creating a new Object from the Class template.  You use the NEWOBJECT() or $NEW() macro's to do this.<br /><br />[*]Objects, are created on the HEAP.  So you should destroy them when your finished. (Test show that windows does for this if you dont, but its not recomended ~ cant promise you wont get memory leaks. You do this by using the DESTROY() macro.<br /><br />[*]Anything with a '$' before it is an accelerator macro.  They are to make code more readable (like a HLL line of code).  If they are a label name ($NEW) then it always replaces itself with the 'eax' register when the macro is resolved by the compiler.  $EAX(), $EBX(), $ESI(), and $EDI() are all METHOD() accelerators.  They act the same as METHOD(), except when resolved by the compiler, they are replaced by either eax, ebx, esi, or edi respectively.  I chose these as they are the least likely registers to be altered by any method code etc.  Long story short, they can make 2 lines of code into : mov hNewObject, $NEW( MyClass )<br />would be the same as: NEWOBJECT( MyClass ), mov hNewObject, eax.<br />[*]METHOD() is like invoke.  Except you have to give the Object you with use with the method fucntion you want to call, as well as give the class type the method is found in.  The rest is exactly like invoke, methodname, and optional parameters.<br /><br />[*]CLASS() macro is a MUST.  It tells the other macro (used later in the class file) the name of your class.<br />[*]CMETHOD() macro &quot;Class Method&quot;, builds the needed MASM32 layout for function pointing in the Class structure.  Is is only used here.  It also helps you visually distinguish the methods from the variables in the structure.<br /><br />[*]BEGIN_INIT and END_INIT are a must.  They set up pointers for the compiler as to where all the method offsets and initial values can be found for your class.  The method offsets MUST be in the same order as the CLASS structure.<br /><br />[*]SET_CLASS .... INHERITS ....  This is ONLY in the constructor of your class definition.  It will place needed code to intialize an instance of your class, settin all its method pointers and inital values.  As well, if the INHERITS SomeOtherClass is present, it will  call the constructor of the of the class it inherits (were its only SET_CLASS code will act further.  Long stoy short, it will recurse every level of inheritance back to the base class, and perform their constructors at each level.<br /><br />[*]SetObject() and ReleaseObject().  These are simple macros used to make your method coding easy, when refering to the classes own data members (variables etc).  In practice we have adopted the use of &quot;edi&quot; for this purpose, such that EDI can be assumed as the pointer to the intance's object.  (edi == lpTHIS). You must tell it what type of class it is to be assumed as.  And MUST release it when finished (or wierd bugs could creep up).  These allow users to do this:  mov eax, .FileSizeVariable.  Where as with out this you would have to do:  mov eax, (ClassType PTR ).FileSizeVariable.<br /><br />[*]OVERRIDE() can be used anywher, but SHOULD be used ONLY in the constructor.   It works with classes that inherit.  It adjusts an instances method pointer (Set by SET_CLASS), to point to a new method proc.  This produces POLYMORPHISM, as the method PROTO remains the same (and thus the new proc should have the same # of parameters).<br /><br />[*]SUPER() Is used for Polymorphic method procs.  If you decide you want to OVERRIDE a method inherited, and do the same thing plus a bit more as well, you can REUSE the old code with the SUPER() macro.  Calling SUPER( methodname ) will run the inherited proc, and return back into the proc it was called from.  From there you simply add the extra code to make the two Polymorphically different<br /><br />Knowing all this.. i can made a Class template now by hand quite simply:<br /><pre><code><br />; Class name&#58; Sample<br /><br />; NOTE&#58; constuctor and method proc's MUST have at least<br />;            one DWORD param.  This is because METHOD will<br />;            always pass the object instance's address in the <br />;            first param &#40;lpTHIS&#41;.<br /><br />; Constructor proc, not included in class structure. <br />; Must be&#58; ClassName + _Init<br /><br />Sample_Init PROTO &#58;DWORD<br /><br />; Method Proto's &#58;  MUST be named in the followin format<br />; Abreviated Name as specified by the CLASS macro with a &quot;_&quot;<br />; MethodName<br />; Followed by &quot;Pto&quot;<br />; &gt;&gt; Abv_MethodNamePto<br /><br />Sample_Method1Pto    TYPEDEF PROTO  &#58;DWORD, &#58;DWORD<br /><br />CLASS Sample       ; no second argument means Abv = &quot;Sample&quot;<br />   CMETHOD destructor   ; MUST BE FIRST IN ALL CLASSES!<br />   CMETHOD MethodName<br />   myData dd ?<br />Sample ENDS<br /><br />.data<br /><br />BEGIN_INIT<br />   dd offset DestructorProc<br />   dd offset MethodProc<br />   dd NULL        ; &lt;&lt; myData initial value when instance is created<br />END_INIT<br /><br />.code<br />; Now just code your method functions.<br />; You must have the Class_Init constructor function,<br />; and a &quot;destructor&quot; Proc in every class.<br />;<br />; NOTE&#58; the first param MUST be defined as &quot;lpTHIS&quot; to work<br /><br />DestructorProc PROC uses edi lpTHIS&#58;DWORD<br />   SetObject edi, Sample<br /><br />   ; return the myData when an instance is destroyed...<br />   mov eax, &#91;edi&#93;.myData   ; &#91;edi&#93; because of SetObject<br /><br />   ReleaseObject edi<br />   ret<br />DestructorProc ENDP<br /><br />Sample_Init PROC uses edi esi lpTHIS&#58;DWORD<br />  <br />  SET_CLASS Sample      ; fill instances with class method ptr's<br />  <br />  ; Any other inits you need to do..<br />  ret<br />Sample_Init ENDP<br /><br />MethodProc PROC uses edi lpTHIS&#58;DWORD<br />   SetObject edi, Sample<br /><br />  ; you method function...<br /><br />   ReleaseObject edi<br />  ret<br />MethodProc ENDP<br /></code></pre><br /><br />Thats it..  This is how a class template is defined..  Now to do all this manualy can be a bit, so I created the Creator Tool to do just this stuff for you.   But you should understand this, if you want to add more methods (ie.  Add a &quot;TYPDEF PROTO&quot;, Add a new CMETHOD entry, add a offset to the BEGIN_INIT/END_INIT area, build a method proc like the ones above. ).  Adding a variable only requires the Class and INIT entry's.<br /><br />Hope this is a helps...<br />NaN</div>
    <div class="meta">Posted on 2001-09-21 17:24:39 by NaN</div>
   </div>
   <div class="post" id="post-7725">
    <div class="subject"><a href="#post-7725">Objects.inc ( &lt;&lt; HERE &gt;&gt; )</a></div>
    <div class="body"><div class="quote">Thats it.. </div><br /><br />Seems like an aweful lot to do pretty much nothing :grin: (You know I'm just messing with ya right?)</div>
    <div class="meta">Posted on 2001-09-21 21:49:52 by Kenny</div>
   </div>
   <div class="post" id="post-7730">
    <div class="subject"><a href="#post-7730">Objects.inc ( &lt;&lt; HERE &gt;&gt; )</a></div>
    <div class="body">NAN<br />i just copied and pasted your last post in this thread<br /><br />Why<br /><br />Because i have go so much help from you its gotta mean something<br /><br /><br />an ounce of prevention is worth a pound of cure<br />:alright:</div>
    <div class="meta">Posted on 2001-09-21 22:30:17 by titan</div>
   </div>
   <div class="post" id="post-7732">
    <div class="subject"><a href="#post-7732">Objects.inc ( &lt;&lt; HERE &gt;&gt; )</a></div>
    <div class="body">I know your joking, and i do realize if you've never programmed objects the lingo can be a bit much.  All i can say is practice a bit, and ask questions.<br /><br />But it really isn't all too much to do the above nothing, when you chop out the comments its not that big (trust me, these macros make the needed suport code ALOT less (especially SET_CLASS and CMETHOD):<pre><code><br />Sample_Init PROTO &#58;DWORD<br />Sample_Method1Pto    TYPEDEF PROTO  &#58;DWORD, &#58;DWORD<br /><br />CLASS Sample<br />   CMETHOD destructor<br />   CMETHOD MethodName<br />   myData dd ?<br />Sample ENDS<br /><br />.data<br /><br />BEGIN_INIT<br />   dd offset DestructorProc<br />   dd offset MethodProc<br />   dd NULL<br />END_INIT<br /><br />.code<br /><br />DestructorProc PROC uses edi lpTHIS&#58;DWORD<br />   SetObject edi, Sample<br /><br />   mov eax, &#91;edi&#93;.myData   ; &#91;edi&#93; because of SetObject<br /><br />   ReleaseObject edi<br />   ret<br />DestructorProc ENDP<br /><br />Sample_Init PROC uses edi esi lpTHIS&#58;DWORD<br />   SET_CLASS Sample<br /> <br />  ret<br />Sample_Init ENDP<br /><br />MethodProc PROC uses edi lpTHIS&#58;DWORD<br />   SetObject edi, Sample<br /><br />   ReleaseObject edi<br />  ret<br />MethodProc ENDP</code></pre></div>
    <div class="meta">Posted on 2001-09-21 22:53:37 by NaN</div>
   </div>
  </div>
 </body>
</html>