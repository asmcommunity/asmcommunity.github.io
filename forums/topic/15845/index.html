<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Help with GetDIBits - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=15845" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=15845">Help with GetDIBits</a></p>
   <div class="post" id="post-122768">
    <div class="subject"><a href="#post-122768">Help with GetDIBits</a></div>
    <div class="body">Hi everyone, <br /><br />I'm trying to use GetDIBits to convert a DDB to DIB.<br />I'm having a problem with GetDIBits. When i include a pointer to receive the bitmap data, the function fails and i get a return of 0.<br />Where did i go wrong with my code? :confused: <br /><br />Thanks in advance! :alright: <br /> <br />CODE:<br />_________________________________________________________________________________________________________________<br /><br />    PrintSetUp proc hWnd:HWND, hDC:DWORD<br />        <br />        local   tmpval          :DWORD<br />		local   memDC           :DWORD<br />		local   cmpBM           :DWORD<br />		local	cmpDC			:DWORD<br />		local   s_logpixx       :DWORD<br />        local   s_logpixy       :DWORD<br />		local   d_logpixx       :DWORD<br />        local   d_logpixy       :DWORD	<br />		local   prvObj          :DWORD<br />		local   retVal          :DWORD<br />		local	pixels			:DWORD<br />		local	rgbq			:RGBQUAD<br /><br />        invoke GetDC, hWnd<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR GetDC_error,OFFSET AppName,MB_OK<br />        .else<br />			mov memDC, eax<br />		.endif<br /><br />		invoke CreateCompatibleDC, memDC<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR CreateCompatibleDC_error,OFFSET AppName,MB_OK<br />        .else<br />			mov cmpDC, eax<br />		.endif<br /><br />        invoke GetDeviceCaps, memDC, LOGPIXELSX<br />        mov s_logpixx, eax<br />        <br />        invoke GetDeviceCaps, memDC, LOGPIXELSY<br />        mov s_logpixy, eax<br />        <br />		mov tmpval, 4<br />        push sizeof BITMAPINFOHEADER<br />        pop bInfo.bmiHeader.biSize<br />        push bmWidth<br />        pop bInfo.bmiHeader.biWidth<br />        push bmHeight<br />        pop bInfo.bmiHeader.biHeight<br />        mov bInfo.bmiHeader.biPlanes, 1<br />		mov eax, 24<br />        mov bInfo.bmiHeader.biBitCount, ax<br />        mov bInfo.bmiHeader.biCompression, BI_RGB<br />        <br />		fild bmWidth<br />		fild bmHeight<br />		fmul<br />		fild tmpval<br />		fmul<br />		fistp tmpval<br />		push tmpval<br />		pop bInfo.bmiHeader.biSizeImage<br />        mov bInfo.bmiHeader.biXPelsPerMeter, 0                <br />        mov bInfo.bmiHeader.biYPelsPerMeter, 0                <br />        mov bInfo.bmiHeader.biClrUsed, 0                <br />        mov bInfo.bmiHeader.biClrImportant, 0                <br /><br />        invoke SelectObject, cmpDC, hBitmap;cmpBM<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR SelectObject_error,OFFSET AppName,MB_OK<br />            invoke GetLastError<br />            push eax<br />            pop ecx<br />            invoke NumberToString, ecx<br />            invoke MessageBox,NULL,ADDR StrNumBuf,OFFSET AppName,MB_OK<br />		.else<br />			mov prvObj, eax<br />        .endif<br /><br />		invoke BitBlt, cmpDC, 400, 0, bmWidth, bmHeight, memDC, 0, 0, SRCCOPY<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR BitBlt_error,OFFSET AppName,MB_OK<br />            invoke GetLastError<br />            push eax<br />            pop ecx<br />            invoke NumberToString, ecx<br />            invoke MessageBox,NULL,ADDR StrNumBuf,OFFSET AppName,MB_OK<br />		.else<br />			mov retVal, eax<br />        .endif<br /><br />		invoke GetDIBits, cmpDC, hBitmap, 0, bmHeight, NULL, addr bInfo, DIB_RGB_COLORS<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR GetDIBits_error,OFFSET AppName,MB_OK<br />            invoke GetLastError<br />            push eax<br />            pop ecx<br />            invoke NumberToString, ecx<br />            invoke MessageBox,NULL,ADDR StrNumBuf,OFFSET AppName,MB_OK<br />		.else<br />			mov retVal, eax<br />        .endif<br /><br />		invoke GetDIBits, cmpDC, hBitmap, 0, bmHeight, addr pixels, addr bInfo, DIB_RGB_COLORS<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR GetDIBits_error,OFFSET AppName,MB_OK<br />            invoke GetLastError<br />            push eax<br />            pop ecx<br />            invoke NumberToString, ecx<br />            invoke MessageBox,NULL,ADDR StrNumBuf,OFFSET AppName,MB_OK<br />		.else<br />			mov retVal, eax<br />        .endif<br /><br />        invoke StretchDIBits,memDC,500,0,bmWidth,bmHeight,0,0,bmWidth,bmHeight,pixels,ADDR bInfo,DIB_RGB_COLORS,SRCCOPY <br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR StretchDIBits_error,OFFSET AppName,MB_OK<br />            invoke GetLastError<br />            push eax<br />            pop ecx<br />            invoke NumberToString, ecx<br />            invoke MessageBox,NULL,ADDR StrNumBuf,OFFSET AppName,MB_OK<br />        .endif        <br /><br />        invoke DeleteDC,cmpDC        <br />        invoke DeleteDC,memDC        <br />        ret<br />    PrintSetUp endp<br />_________________________________________________________________________________________________________________</div>
    <div class="meta">Posted on 2003-10-29 02:29:06 by trexxz</div>
   </div>
   <div class="post" id="post-122771">
    <div class="subject"><a href="#post-122771">Help with GetDIBits</a></div>
    <div class="body">ok. i have managed to solve the GetDIBits error. But now, my StretchDIBits give me an error.. (returns 0)<br /><br />CODE:<br />    PrintSetUp proc hWnd:HWND, hDC:DWORD<br />        <br />        local   tmpval          :DWORD<br />		local   memDC           :DWORD<br />		local   cmpBM           :DWORD<br />		local	cmpDC			:DWORD<br />		local   s_logpixx       :DWORD<br />        local   s_logpixy       :DWORD<br />		local   d_logpixx       :DWORD<br />        local   d_logpixy       :DWORD	<br />		local   prvObj          :DWORD<br />		local   retVal          :DWORD<br />		local	pixels			:DWORD<br />		local	rgbq			:RGBQUAD<br /><br />        invoke GetDC, hWnd<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR GetDC_error,OFFSET AppName,MB_OK<br />        .else<br />			mov memDC, eax<br />		.endif<br /><br />		invoke CreateCompatibleDC, memDC<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR CreateCompatibleDC_error,OFFSET AppName,MB_OK<br />        .else<br />			mov cmpDC, eax<br />		.endif<br /><br />		invoke CreateCompatibleBitmap, memDC, 334, 207<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR CreateCompatibleBitmap_error,OFFSET AppName,MB_OK<br />        .else<br />			mov cmpBM, eax<br />		.endif<br /><br />        invoke GetDeviceCaps, memDC, LOGPIXELSX<br />        mov s_logpixx, eax<br />        <br />        invoke GetDeviceCaps, memDC, LOGPIXELSY<br />        mov s_logpixy, eax<br />        <br />		mov tmpval, 4<br />        push sizeof BITMAPINFOHEADER<br />        pop bInfo.bmiHeader.biSize<br />        push bmWidth<br />        pop bInfo.bmiHeader.biWidth<br />        push bmHeight<br />        pop bInfo.bmiHeader.biHeight<br />        mov bInfo.bmiHeader.biPlanes, 1<br />		mov eax, 24<br />        mov bInfo.bmiHeader.biBitCount, ax<br />        mov bInfo.bmiHeader.biCompression, BI_RGB<br />        <br />		fild bmWidth<br />		fild bmHeight<br />		fmul<br />		fild tmpval<br />		fmul<br />		fistp tmpval<br />		push tmpval<br />		pop bInfo.bmiHeader.biSizeImage<br />        mov bInfo.bmiHeader.biXPelsPerMeter, 0                <br />        mov bInfo.bmiHeader.biYPelsPerMeter, 0                <br />        mov bInfo.bmiHeader.biClrUsed, 0                <br />        mov bInfo.bmiHeader.biClrImportant, 0                <br /><br />        invoke SelectObject, cmpDC, cmpBM ;hBitmap<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR SelectObject_error,OFFSET AppName,MB_OK<br />            invoke GetLastError<br />            push eax<br />            pop ecx<br />            invoke NumberToString, ecx<br />            invoke MessageBox,NULL,ADDR StrNumBuf,OFFSET AppName,MB_OK<br />		.else<br />			mov prvObj, eax<br />        .endif<br /><br />		invoke BitBlt, cmpDC, 400, 0, bmWidth, bmHeight, memDC, 0, 0, SRCCOPY<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR BitBlt_error,OFFSET AppName,MB_OK<br />            invoke GetLastError<br />            push eax<br />            pop ecx<br />            invoke NumberToString, ecx<br />            invoke MessageBox,NULL,ADDR StrNumBuf,OFFSET AppName,MB_OK<br />	.else<br />			mov retVal, eax<br />        .endif<br /><br />		invoke GetDIBits, cmpDC, cmpBM, 0, bmHeight, NULL, addr bInfo, DIB_RGB_COLORS<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR GetDIBits_error,OFFSET AppName,MB_OK<br />            invoke GetLastError<br />            push eax<br />            pop ecx<br />            invoke NumberToString, ecx<br />            invoke MessageBox,NULL,ADDR StrNumBuf,OFFSET AppName,MB_OK<br />		.else<br />			mov retVal, eax<br />        .endif<br /><br />		invoke GetDIBits, cmpDC, cmpBM, 0, bmHeight, pixels, addr bInfo, DIB_RGB_COLORS<br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR GetDIBits_error,OFFSET AppName,MB_OK<br />            invoke GetLastError<br />            push eax<br />            pop ecx<br />            invoke NumberToString, ecx<br />            invoke MessageBox,NULL,ADDR StrNumBuf,OFFSET AppName,MB_OK<br />		.else<br />			mov retVal, eax<br />        .endif<br /><br />		lea ebx, pixels<br /><br />        invoke StretchDIBits,memDC,500,0,bmWidth,bmHeight,0,0,bmWidth,bmHeight,ebx,ADDR bInfo,DIB_RGB_COLORS,SRCCOPY <br />        .if eax == 0<br />            invoke MessageBox,NULL,ADDR StretchDIBits_error,OFFSET AppName,MB_OK<br />            invoke GetLastError<br />            push eax<br />            pop ecx<br />            invoke NumberToString, ecx<br />            invoke MessageBox,NULL,ADDR StrNumBuf,OFFSET AppName,MB_OK<br />        .endif        <br /><br />        invoke DeleteDC,cmpDC        <br />        invoke DeleteDC,memDC        <br />        ret<br />    PrintSetUp endp</div>
    <div class="meta">Posted on 2003-10-29 03:03:31 by trexxz</div>
   </div>
  </div>
 </body>
</html>