<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>strange first chance exception error in assembly code - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=24943" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=24943">strange first chance exception error in assembly code</a></p>
   <div class="post" id="post-182449">
    <div class="subject"><a href="#post-182449">strange first chance exception error in assembly code</a></div>
    <div class="body">Hello, a noob with a dumb question&nbsp; :D<br /><br />I&#39;m writing some optimized matrix code, and for whatever dumb reason, I can&#39;t understand why the following doesn&#39;t work. I am using inline assembly in visual c++, btw ;)<br /><br />Matrix4 matResult;<br /><br />__m128 row0, row1, row2, row3;<br />__m128 base0, base1, base2, base3;<br />__m128 result0, result1, result2, result3;<br />__m128 tmp1;<br /><br />tmp1.m128_i64[0] = 0;<br />tmp1.m128_i64[1] = 0;<br /><br />row0 = _mm_load_ps(m_fMatrix16); // first chance exception here<br />row1 = _mm_load_ps(m_fMatrix16+4);<br />row2 = _mm_load_ps(m_fMatrix16+8);<br />row3 = _mm_load_ps(m_fMatrix16+12);<br /><br />base0 = _mm_load_ps(mat.m_fMatrix16);<br />base1 = _mm_load_ps(mat.m_fMatrix16+4);<br />base2 = _mm_load_ps(mat.m_fMatrix16+8);<br />base3 = _mm_load_ps(mat.m_fMatrix16+12);<br /><br />result0 = _mm_add_ps(row0, base0);<br />result1 = _mm_add_ps(row1, base1);<br />result2 = _mm_add_ps(row2, base2);<br />result3 = _mm_add_ps(row3, base3);<br /><br />_mm_store_ps(matResult.m_fMatrix16, result0);<br />_mm_store_ps(matResult.m_fMatrix16+4, result1);<br />_mm_store_ps(matResult.m_fMatrix16+8, result2);<br />_mm_store_ps(matResult.m_fMatrix16+12, result3);<br /><br />return matResult;<br /><br />Here is the dissassembly that vc++ spews up from the above<br /><br />Matrix4 matResult;<br />004129CF&nbsp; lea&nbsp; &nbsp; &nbsp; &nbsp;  ecx, <br />004129D2&nbsp; call&nbsp; &nbsp; &nbsp; &nbsp; SkepWorks::Math::Matrix4::Matrix4 (411267h) <br /><br />				__m128 row0, row1, row2, row3;<br />				__m128 base0, base1, base2, base3;<br />				__m128 result0, result1, result2, result3;<br />				__m128 tmp1;<br /><br />				tmp1.m128_i64[0] = 0;<br />004129D7&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  dword ptr ,0 <br />004129E1&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  dword ptr ,0 <br />				tmp1.m128_i64[1] = 0;<br />004129EB&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  dword ptr ,0 <br />004129F5&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  dword ptr ,0 <br /><br />				row0 = _mm_load_ps(m_fMatrix16);<br />004129FF&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  eax,dword ptr  <br />00412A02&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  ;error here<br />00412A05&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />00412A0C&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412A13&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />				row1 = _mm_load_ps(m_fMatrix16+4);<br />00412A17&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  eax,dword ptr  <br />00412A1A&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412A1E&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />00412A25&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412A2C&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />				row2 = _mm_load_ps(m_fMatrix16+8);<br />00412A33&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  eax,dword ptr  <br />00412A36&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412A3A&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />00412A41&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412A48&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />				row3 = _mm_load_ps(m_fMatrix16+12);<br />00412A4F&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  eax,dword ptr  <br />00412A52&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412A56&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />00412A5D&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412A64&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br /><br />				base0 = _mm_load_ps(mat.m_fMatrix16);<br />00412A6B&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  eax,dword ptr  <br />00412A6E&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412A71&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />00412A78&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412A7F&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />				base1 = _mm_load_ps(mat.m_fMatrix16+4);<br />00412A86&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  eax,dword ptr  <br />00412A89&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412A8D&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />00412A94&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412A9B&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />				base2 = _mm_load_ps(mat.m_fMatrix16+8);<br />00412AA2&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  eax,dword ptr  <br />00412AA5&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412AA9&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />00412AB0&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412AB7&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />				base3 = _mm_load_ps(mat.m_fMatrix16+12);<br />00412ABE&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  eax,dword ptr  <br />00412AC1&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412AC5&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />00412ACC&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412AD3&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br /><br />				result0 = _mm_add_ps(row0, base0);<br />00412ADA&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412AE1&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm1,xmmword ptr  <br />00412AE5&nbsp; addps&nbsp; &nbsp; &nbsp;  xmm1,xmm0 <br />00412AE8&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm1 <br />00412AEF&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412AF6&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />				result1 = _mm_add_ps(row1, base1);<br />00412AFD&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412B04&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm1,xmmword ptr  <br />00412B0B&nbsp; addps&nbsp; &nbsp; &nbsp;  xmm1,xmm0 <br />00412B0E&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm1 <br />00412B15&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412B1C&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />				result2 = _mm_add_ps(row2, base2);<br />00412B23&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412B2A&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm1,xmmword ptr  <br />00412B31&nbsp; addps&nbsp; &nbsp; &nbsp;  xmm1,xmm0 <br />00412B34&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm1 <br />00412B3B&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412B42&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />				result3 = _mm_add_ps(row3, base3);<br />00412B49&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412B50&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm1,xmmword ptr  <br />00412B57&nbsp; addps&nbsp; &nbsp; &nbsp;  xmm1,xmm0 <br />00412B5A&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm1 <br />00412B61&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412B68&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br /><br />				_mm_store_ps(matResult.m_fMatrix16, result0);<br />00412B6F&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412B76&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />				_mm_store_ps(matResult.m_fMatrix16+4, result1);<br />00412B7A&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412B81&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />				_mm_store_ps(matResult.m_fMatrix16+8, result2);<br />00412B85&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412B8C&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br />				_mm_store_ps(matResult.m_fMatrix16+12, result3);<br />00412B90&nbsp; movaps&nbsp; &nbsp; &nbsp; xmm0,xmmword ptr  <br />00412B97&nbsp; movaps&nbsp; &nbsp; &nbsp; xmmword ptr ,xmm0 <br /><br />				return matResult;<br /><br />The areas that error above give the following first chance exception:<br /><br />Unhandled exception at 0x00412a02 in Test.exe: 0xC0000005: Access violation reading location 0x00000000.<br /><br />The variable m_fMatrix16 is indeed valid, and is an array of sixteen floats.<br /><br />I&#39;m new to assembly programming, so please tell me if i&#39;m missing something&nbsp; :mrgreen:<br /><br />Thanks for your assistance,<br />exorcist_bob</div>
    <div class="meta">Posted on 2006-06-24 20:09:58 by exorcist_bob</div>
   </div>
   <div class="post" id="post-182453">
    <div class="subject"><a href="#post-182453">Re: strange first chance exception error in assembly code</a></div>
    <div class="body">dang, i feel stupid, had to declare the variable with __declspec(align(16))</div>
    <div class="meta">Posted on 2006-06-24 20:35:00 by exorcist_bob</div>
   </div>
  </div>
 </body>
</html>