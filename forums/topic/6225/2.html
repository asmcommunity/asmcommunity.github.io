<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Why use 400000h instead of hInstance? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=6225" />
  <link rel="prev" href="../?id=6225&amp;page=1" />  <link rel="next" href="../?id=6225&amp;page=3" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=6225">Why use 400000h instead of hInstance?</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=6225&amp;page=1" style="">&laquo;</a><a href="../?id=6225&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="6225" /><input type="number" name="page" min="1" max="3" step="1" value="2" onchange="this.form.submit();" /><a href="../?id=6225&amp;page=3">&gt;</a><a href="../?id=6225&amp;page=3">&raquo;</a></form>   <div class="post" id="post-44983">
    <div class="subject"><a href="#post-44983">Why use 400000h instead of hInstance?</a></div>
    <div class="body">Hello stryker :)<br />Win9x supports any base &gt;= 400000h.. so all you've to worry about is <em>not going <strong>lower</strong></em> than that, and of course you should avoid also something extreme like ~70000000h.</div>
    <div class="meta">Posted on 2002-06-24 16:41:59 by Maverick</div>
   </div>
   <div class="post" id="post-45169">
    <div class="subject"><a href="#post-45169">use getmodulehandle</a></div>
    <div class="body">try to run the same exe (with fixed value: 4000000h, not hinst) two times on win98.</div>
    <div class="meta">Posted on 2002-06-25 14:02:59 by ti_mo_n</div>
   </div>
   <div class="post" id="post-45170">
    <div class="subject"><a href="#post-45170">Re: use getmodulehandle</a></div>
    <div class="body"><div class="quote"><br />try to run the same exe (with fixed value: 4000000h, not hinst) two times on win98. </div><br /><br />400000h not 4000000h :grin:</div>
    <div class="meta">Posted on 2002-06-25 14:26:48 by bazik</div>
   </div>
   <div class="post" id="post-45183">
    <div class="subject"><a href="#post-45183">Why use 400000h instead of hInstance?</a></div>
    <div class="body">Both 400000h and 4000000h work fine on 9x.<br />Tested: ran 2 instances of app with 400 0000h on 98.<br />without relocation.<br />Result: OK.</div>
    <div class="meta">Posted on 2002-06-25 18:23:35 by The Svin</div>
   </div>
   <div class="post" id="post-45185">
    <div class="subject"><a href="#post-45185">Why use 400000h instead of hInstance?</a></div>
    <div class="body">As long as we are picking a base address, maybe a more useful number should be used?  0C9C300h? 058C300h?  I think I'll use 0C30000h. :grin:</div>
    <div class="meta">Posted on 2002-06-25 18:57:15 by bitRAKE</div>
   </div>
   <div class="post" id="post-45188">
    <div class="subject"><a href="#post-45188">Why use 400000h instead of hInstance?</a></div>
    <div class="body">thanks for the tests :) Now, I can put this aside.</div>
    <div class="meta">Posted on 2002-06-25 21:24:49 by stryker</div>
   </div>
   <div class="post" id="post-45189">
    <div class="subject"><a href="#post-45189">Why use 400000h instead of hInstance?</a></div>
    <div class="body">I would guess that if you picked a very low base, then you <strong>must</strong> retain relocation information.</div>
    <div class="meta">Posted on 2002-06-25 21:35:56 by tenkey</div>
   </div>
   <div class="post" id="post-45231">
    <div class="subject"><a href="#post-45231">Why use 400000h instead of hInstance?</a></div>
    <div class="body">On NT based OS's, down to 10000h ought to work ok.<br />On Win9x, as I already wrote, it must be &gt;=400000h.<br /><br />bitRAKE: alignment must be 10000h minimum, so no ????C300h, I'm afraid. ;)</div>
    <div class="meta">Posted on 2002-06-26 02:10:25 by Maverick</div>
   </div>
   <div class="post" id="post-45257">
    <div class="subject"><a href="#post-45257">Why use 400000h instead of hInstance?</a></div>
    <div class="body"><div class="quote"><br />bitRAKE: alignment must be 10000h minimum, so no ????C300h, I'm afraid. ;)</div>Bummer, guess I'll have to stick with 0C30000h.  That way I can just to the stack and inbetween instruction - should really fool the disassemblers, but tracing will still be easy.</div>
    <div class="meta">Posted on 2002-06-26 07:06:47 by bitRAKE</div>
   </div>
   <div class="post" id="post-45261">
    <div class="subject"><a href="#post-45261">Why use 400000h instead of hInstance?</a></div>
    <div class="body">To fool disassemblers you should really crypt your code.<br /><br />Runtime SMC &quot;unfolding&quot; is even better.</div>
    <div class="meta">Posted on 2002-06-26 07:28:26 by Maverick</div>
   </div>
   <div class="post" id="post-45267">
    <div class="subject"><a href="#post-45267">Why use 400000h instead of hInstance?</a></div>
    <div class="body">The more the marrier - thanks, <strong>Maverick</strong>. :)</div>
    <div class="meta">Posted on 2002-06-26 08:02:20 by bitRAKE</div>
   </div>
   <div class="post" id="post-45268">
    <div class="subject"><a href="#post-45268">Why use 400000h instead of hInstance?</a></div>
    <div class="body">what does relocating mean?</div>
    <div class="meta">Posted on 2002-06-26 08:05:18 by nyook</div>
   </div>
   <div class="post" id="post-45272">
    <div class="subject"><a href="#post-45272">Why use 400000h instead of hInstance?</a></div>
    <div class="body"><div class="quote"><br />what does relocating mean? </div>The absolute addresses are 'fixed' to allow execution at any address.  This requires additional information to be store in the executable to know the offsets of addresses that need fixing.</div>
    <div class="meta">Posted on 2002-06-26 08:39:24 by bitRAKE</div>
   </div>
   <div class="post" id="post-45291">
    <div class="subject"><a href="#post-45291">Why use 400000h instead of hInstance?</a></div>
    <div class="body">What said that module handle must be an address of EXE in memory? The system should be able to restore this address from the handle, but it's possible, for example - because the addresses are always 4k aligned - to use the lowest 12 bits of module handle value for some additional module flags, etc.</div>
    <div class="meta">Posted on 2002-06-26 14:00:58 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-45444">
    <div class="subject"><a href="#post-45444">Why use 400000h instead of hInstance?</a></div>
    <div class="body">As far as I know, microsoft doesn't guarantee anything about HANDLEs;<br />they are supposed to be opaque &quot;objects&quot; which shouldn't be used directly<br />in any way. Depending on your base address to be your HINSTANCE works for<br />now, and probably will in all windows versions, but there's no guarantee.<br /><br />Or could you point me to an official article by microsoft that says otherwise?<br /><br />At last, what is so awful by doing one single call to GetModuleHandle(NULL),<br />which no user will ever be able to feel? Even hutch seems to agree here :).<br /><br />It's right what maverick says, 0x400000 should always be free for executable<br />loading (or else m$ will have serious trouble) - but there's still no guarantee<br />that your hinstance is your imagebase...<br /><br />But oh well, if you want to be elitists, so be it.</div>
    <div class="meta">Posted on 2002-06-27 13:24:49 by f0dder</div>
   </div>
   <div class="post" id="post-45489">
    <div class="subject"><a href="#post-45489">Why use 400000h instead of hInstance?</a></div>
    <div class="body">Help!  i'm in the dark...  what is the significance of ????C300h other than the fact that C3 looks kinda like a guy with a big nose?</div>
    <div class="meta">Posted on 2002-06-27 18:45:48 by jademtech</div>
   </div>
   <div class="post" id="post-45492">
    <div class="subject"><a href="#post-45492">Why use 400000h instead of hInstance?</a></div>
    <div class="body">assuming hInstance is the address of your base image... can't you use<br /><br /><pre><code><br />start&#58;                 call @F<br />@@&#58;                    pop eax<br />                       and eax,0FFFF0000h<br /><br /></code></pre><br /><br />or something similar?<br />The call should push the addr of @@ onto the stack, and the pop should put it into eax. <br /><br />It works on my program<br /><br />--Chorus</div>
    <div class="meta">Posted on 2002-06-27 19:02:06 by chorus</div>
   </div>
   <div class="post" id="post-45495">
    <div class="subject"><a href="#post-45495">Why use 400000h instead of hInstance?</a></div>
    <div class="body"><div class="quote"><br />Help!  i'm in the dark...  what is the significance of ????C300h other than the fact that C3 looks kinda like a guy with a big nose? </div>Actually, it's my girlfriend bent over. (The front end, not the back.) :tongue:<br />C3 is the <strong>retn</strong> instruction.</div>
    <div class="meta">Posted on 2002-06-27 19:23:57 by bitRAKE</div>
   </div>
   <div class="post" id="post-45632">
    <div class="subject"><a href="#post-45632">Why use 400000h instead of hInstance?</a></div>
    <div class="body">Couple of more questions re:HINSTANCE.<br /><br />1) When I load up my program in OllyDebug, the initial state of the registers says EAX = 401000h i.e., the ptr to start. Is the debugger doing this, or is this how windows starts off your program? I tried using eax right off the bat and it didn't work...<br /><br />2) If in your PE header you &quot;prefer&quot; your image base to be 400000h, don't all your items in .data etc, get hardcoded to this address. For example, if you disassemble or debug your app you see that mov hInstance,eax becomes mov [405580h],eax. Which is an absolute value. So if your program *was* loaded at a non-preferred location, wouldn't the app crash once you tried to move a dword to 405580h? After all, your data wouldn't be mapped to 405000h anymore (or wherever the linker decides it should go)<br /><br />--Chorus</div>
    <div class="meta">Posted on 2002-06-28 16:40:59 by chorus</div>
   </div>
   <div class="post" id="post-45638">
    <div class="subject"><a href="#post-45638">Why use 400000h instead of hInstance?</a></div>
    <div class="body">2) ..not if you provide a valid reloc section.. then all those istances like [405580h] will be known, and will be relocated to the new address.<br /><br />This is very common for DLL's.</div>
    <div class="meta">Posted on 2002-06-28 17:14:34 by Maverick</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=6225&amp;page=1" style="">&laquo;</a><a href="../?id=6225&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="6225" /><input type="number" name="page" min="1" max="3" step="1" value="2" onchange="this.form.submit();" /><a href="../?id=6225&amp;page=3">&gt;</a><a href="../?id=6225&amp;page=3">&raquo;</a></form>  </div>
 </body>
</html>