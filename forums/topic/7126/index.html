<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>mam and compiling to bin - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=7126" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=7126">mam and compiling to bin</a></p>
   <div class="post" id="post-51524">
    <div class="subject"><a href="#post-51524">mam and compiling to bin</a></div>
    <div class="body">how do i compile my assembly code into a raw bin file so i can use it in a boot loader?</div>
    <div class="meta">Posted on 2002-08-03 15:07:12 by Qages</div>
   </div>
   <div class="post" id="post-51525">
    <div class="subject"><a href="#post-51525">mam and compiling to bin</a></div>
    <div class="body">There was a thread about this already. Do a board search :)</div>
    <div class="meta">Posted on 2002-08-03 15:22:34 by comrade</div>
   </div>
   <div class="post" id="post-51528">
    <div class="subject"><a href="#post-51528">mam and compiling to bin</a></div>
    <div class="body">i did, it came up witth junk. i dont know what keywords to search for</div>
    <div class="meta">Posted on 2002-08-03 15:34:22 by Qages</div>
   </div>
   <div class="post" id="post-51530">
    <div class="subject"><a href="#post-51530">mam and compiling to bin</a></div>
    <div class="body">what I found is that you have an older version of link that can use 16 bit code. Masm handles that without problems.<br /><br />Correct me if I'm wrong.</div>
    <div class="meta">Posted on 2002-08-03 15:39:11 by phueghy</div>
   </div>
   <div class="post" id="post-51531">
    <div class="subject"><a href="#post-51531">mam and compiling to bin</a></div>
    <div class="body">where can i get this 16 bit compiler?</div>
    <div class="meta">Posted on 2002-08-03 15:42:04 by Qages</div>
   </div>
   <div class="post" id="post-51532">
    <div class="subject"><a href="#post-51532">mam and compiling to bin</a></div>
    <div class="body">as far as i understand it you compile with masm and use the old link version which you can download at iczelions site: <a target="_blank" href="http://www.win32asm.cjb.net">www.win32asm.cjb.net</a> <br />in the downloads section. <br /><div class="quote">Microsoft Linker for those who want to use MASM to code DOS programs. You MUST use this linker instead of the one from MASM32.</div></div>
    <div class="meta">Posted on 2002-08-03 15:45:29 by phueghy</div>
   </div>
   <div class="post" id="post-51533">
    <div class="subject"><a href="#post-51533">mam and compiling to bin</a></div>
    <div class="body">I seem to recall to have read that FASM is able to assemble raw code...</div>
    <div class="meta">Posted on 2002-08-03 16:11:01 by JCP</div>
   </div>
   <div class="post" id="post-51534">
    <div class="subject"><a href="#post-51534">mam and compiling to bin</a></div>
    <div class="body">im a loyal masm user. i dont go for non-standard hll-based compilers like fasm/nasm/spasm. but ive got it working. i seem to have to hex edit out 512 bytes of 0s before the code/boot seg wich is also 512 bytes. anyi deas how to get it only the code?</div>
    <div class="meta">Posted on 2002-08-03 16:17:32 by Qages</div>
   </div>
   <div class="post" id="post-51536">
    <div class="subject"><a href="#post-51536">mam and compiling to bin</a></div>
    <div class="body">&quot;hll-based compilers like fasm/nasm/spasm&quot; haha. Masm is the most hll of these... anyway, get 16bit linker from iczelions site, then exe2bin from somewhere (it's included in win2k, and it's not hard to write your own).</div>
    <div class="meta">Posted on 2002-08-03 16:26:54 by f0dder</div>
   </div>
   <div class="post" id="post-51537">
    <div class="subject"><a href="#post-51537">mam and compiling to bin</a></div>
    <div class="body"><div class="quote"><br />im a loyal masm user.<br /></div><br /><br />I'm loyal to what gets the job done the best... especially when it comes to compilers and assemblers...<br />Lots of good assembly programmers switched from MASM to FASM in the past weeks... loyalty is for relationship and work relations, not for programming imho. ;)<br />But I see what you mean... :)<br /><br /><div class="quote"><br />i dont go for non-standard hll-based compilers like fasm/nasm/spasm. <br /></div><br /><br />FASM, nasm and spasm HLL based? ?_o<br />Or did you mean that the hll of these assemblers is &quot;non-standard&quot; (then, to what ? MASM?) and afaik the HLL support in these assemblers is provided by macros, unlike MASM where they are built-in.<br /><br />Regards,</div>
    <div class="meta">Posted on 2002-08-03 16:29:11 by JCP</div>
   </div>
   <div class="post" id="post-51542">
    <div class="subject"><a href="#post-51542">mam and compiling to bin</a></div>
    <div class="body">im having trouble with my boot sector, it shows a jumble of letters, but not the message i want it to display<br /><pre><code><br />.286<br />.model tiny, stdcall<br /><br />      option casemap &#58;none<br />;-- --------------------------------------------------------------------<br />; Simple boot program that prints the letter 'H'<br />;  and then hangs<br />; Joel Gompert 2001<br />;<br />; Disclaimer&#58; I am not responsible for any results of the use of the contents<br />;   of this file<br />;----------------------------------------------------------------------<br /><br /><br /><br />.code<br /><br />		; This is where BIOS loads the bootloader<br /><br /><br />; Execution begins here<br /><br />entry&#58;<br />	jmp short begin ; jump over the DOS boot record data<br /><br /><br />; ----------------------------------------------------------------------<br />; data portion of the &quot;DOS BOOT RECORD&quot;<br />; ----------------------------------------------------------------------<br />brINT13Flag     DB      90H             ; 0002h - 0EH for INT13 AH=42 READ<br />brOEM           DB      'MSDOS5.0'      ; 0003h - OEM name &amp; DOS version &#40;8 chars&#41;<br />brBPS           DW      512             ; 000Bh - Bytes/sector<br />brSPC           DB      1               ; 000Dh - Sectors/cluster<br />brResCount      DW      1               ; 000Eh - Reserved &#40;boot&#41; sectors<br />brFATs          DB      2               ; 0010h - FAT copies<br />brRootEntries   DW      0E0H		; 0011h - Root directory entries<br />brSectorCount   DW      2880		; 0013h - Sectors in volume, &lt; 32MB<br />brMedia         DB      240		; 0015h - Media descriptor<br />brSPF           DW      9               ; 0016h - Sectors per FAT<br />brSPH           DW      18              ; 0018h - Sectors per track<br />brHPC           DW      2		; 001Ah - Number of Heads<br />brHidden        DD      0               ; 001Ch - Hidden sectors<br />brSectors       DD      0	        ; 0020h - Total number of sectors<br />		DB      0               ; 0024h - Physical drive no.<br />		DB      0               ; 0025h - Reserved &#40;FAT32&#41;<br />		DB      29H             ; 0026h - Extended boot record sig <br />brSerialNum     DD      404418EAH       ; 0027h - Volume serial number &#40;random&#41;<br />brLabel         DB      'randys disk'   ; 002Bh - Volume label  &#40;11 chars&#41;<br />brFSID          DB      'FAT12   '      ; 0036h - File System ID &#40;8 chars&#41;<br />;------------------------------------------------------------------------<br /><br /><br />; --------------------------------------------<br />;  Boot program code begins here<br />; --------------------------------------------<br />; boot code begins at 0x003E<br /><br /><br /><br />nop<br />nop<br />nop<br />nop<br />nop<br />nop<br />nop<br />begin&#58;<br />	xor	ax, ax		; zero out ax<br />	mov	ds, ax		; set data segment to base of RAM<br />    mov ss,ax<br />    mov	sp, 7D00h<br />	mov	bp, sp<br />	mov	si, offset msg		; load address of our message<br />	jmp	putstr		; print the message<br /><br />hang&#58;<br />	jmp	hang		; just loop forever.<br /><br /><br />putstr&#58;<br />	;lodsb		; AL = &#91;DS&#58;SI&#93;<br />    mov al, byte ptr DS&#58;&#91;SI&#93;<br />	or al, al	; Set zero flag if al=0<br />	je hang	; jump to putstrd if zero flag is set<br />	mov ah, 0Eh	; video function 0Eh &#40;print char&#41;<br />	mov bx, 0007h	; color<br />	int 10h<br />    inc si<br />	jmp putstr<br /><br />    <br /> msg	db	'Randys Operating system',0<br /><br />;---------------------------------------------<br />d&#58;<br /><br />	times	db &#40;512 - &#40;offset d - offset entry&#41; - 2&#41;  dup&#40;0&#41;<br /><br />	db	55h, 0AAh		;2  byte boot signature<br />    end entry<br /></code></pre></div>
    <div class="meta">Posted on 2002-08-03 16:48:08 by Qages</div>
   </div>
   <div class="post" id="post-51546">
    <div class="subject"><a href="#post-51546">mam and compiling to bin</a></div>
    <div class="body">i had to add 7c00 to the offset!!!!!i dont know the tiny memory model, how do i get the complete memory address?</div>
    <div class="meta">Posted on 2002-08-03 17:07:32 by Qages</div>
   </div>
   <div class="post" id="post-51594">
    <div class="subject"><a href="#post-51594">mam and compiling to bin</a></div>
    <div class="body">I anm glad there are still a few MASM purists who enjoy the sheer low level grunt of MASM.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-08-04 04:39:59 by hutch--</div>
   </div>
   <div class="post" id="post-51610">
    <div class="subject"><a href="#post-51610">mam and compiling to bin</a></div>
    <div class="body">Qages,<br /><br />   the boot sector is not read to the base of ram. It is read to 7C00h. You have to set DS accordingly, or add the 7C00h manually as you have done.<br /><br />You can look here for more info: <a target="_blank" href="http://www.nondot.org/sabre/os/articles/TheBootProcess/">http://www.nondot.org/sabre/os/articles/TheBootProcess/</a><br />specifically: <a target="_blank" href="http://www.nondot.org/sabre/os/files/Booting/BootSector.html">http://www.nondot.org/sabre/os/files/Booting/BootSector.html</a><br /><br />--Chorus</div>
    <div class="meta">Posted on 2002-08-04 08:30:01 by chorus</div>
   </div>
   <div class="post" id="post-51615">
    <div class="subject"><a href="#post-51615">mam and compiling to bin</a></div>
    <div class="body">Yep, better set up your segments manually, and don't reference anything through CS... some BIOSes are broken in the way they set up CS:IP (ie, some have 0:7C00, some have 7C0:0).</div>
    <div class="meta">Posted on 2002-08-04 10:23:07 by f0dder</div>
   </div>
   <div class="post" id="post-51685">
    <div class="subject"><a href="#post-51685">mam and compiling to bin</a></div>
    <div class="body">This is the start of a working boot sector code:<br /><br /><pre><code><br />		.386<br /><br /><br />@pushws	macro value<br />		db 6ah<br />		db value<br />		endm<br /><br />@pushdws	macro value<br />		db 66h<br />		db 6ah<br />		db value<br />		endm<br /><br />_TEXT	segment use16 'CODE'<br /><br />		assume ds&#58;_TEXT<br /><br />		org 7C00h<br /><br />L0100&#58;<br />		jmp L015A<br />		nop<br />L7C03	db &quot;MSWIN4.1&quot;<br />L7C0B&#58;<br />		db 11h dup&#40;0&#41;<br />L7C1C	dd 0<br />		db 27h dup&#40;0&#41;<br />		db 11 dup&#40;0&#41;		;label<br />		db 8 dup&#40;0&#41;			;&quot;FAT32   &quot;<br /><br />L015A&#58;<br />		cli<br />		xor   cx,cx<br />		mov   ss,cx<br />		mov   sp,7BF8h<br />		mov   es,cx<br />		mov   bp,0078h<br /></code></pre><br /><br />As f0dder tells, better dont use simplified segment directives.</div>
    <div class="meta">Posted on 2002-08-05 03:51:51 by japheth</div>
   </div>
   <div class="post" id="post-51691">
    <div class="subject"><a href="#post-51691">mam and compiling to bin</a></div>
    <div class="body">Also, you might want to use nasm for bootsector writing... direct binary output and better opcode controls are advantagous when dealing with code like this.</div>
    <div class="meta">Posted on 2002-08-05 05:50:45 by f0dder</div>
   </div>
   <div class="post" id="post-53743">
    <div class="subject"><a href="#post-53743">mam and compiling to bin</a></div>
    <div class="body">You can get the nice bootsector example here: <a target="_blank" href="http://fasm.sf.net/phboot.zip">http://fasm.sf.net/phboot.zip</a> (I'm sorry, it's written for fasm ;))</div>
    <div class="meta">Posted on 2002-08-17 06:41:29 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-53809">
    <div class="subject"><a href="#post-53809">mam and compiling to bin</a></div>
    <div class="body">used nasm for it, fasm is stupid!</div>
    <div class="meta">Posted on 2002-08-17 17:05:54 by Qages</div>
   </div>
   <div class="post" id="post-53824">
    <div class="subject"><a href="#post-53824">mam and compiling to bin</a></div>
    <div class="body"><div class="quote"><br />used nasm for it, fasm is stupid! </div><br /><br />This opinion is stupid, too. <br />What is stupid about FASM in your opinion?</div>
    <div class="meta">Posted on 2002-08-17 19:44:57 by bazik</div>
   </div>
  </div>
 </body>
</html>