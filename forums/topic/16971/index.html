<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Code Injection Help Needed(ASM-Advanced) - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=16971" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=16971">Code Injection Help Needed(ASM-Advanced)</a></p>
   <div class="post" id="post-131645">
    <div class="subject"><a href="#post-131645">Code Injection Help Needed(ASM-Advanced)</a></div>
    <div class="body">I am trying to develop a WebSite Filter,through Code Injection technique.<br />Whenever somebody tries to enter &quot;www.xxxx.com&quot;,then using GetHostByName API<br />Hooking log the Site Address and Access Time in a Log File.<br />Also,one can keep some Website addresses for Blocking.So that whenever these site name is entered,it<br />must not function and a MessageBox should Result.<br /><br />ie:I must go through the Blocked addresses(In a File) and compare it with the entered site address and <br />if it's Ok then a MsgBox saying &quot;You have no Right  to enter here&quot;. then Exit<br /><br />I am able to get the entered Site address in a variable.<br />But, as i am working in the Injected code, lot of errors aridsing.<br />The problem is how could i call another procedure from within an INJ.CODE<br />code goes just like,<br /><pre><code><br />Inj_Code&#58;			;new gethostbyname...<br /><br />	pushfd			;preserve regs and flags...<br />	pushad<br /><br />	call	get_delta_1<br />get_delta_1&#58;<br />	pop	ebp		<br />	sub	ebp,offset get_delta_1	;ebp = delta offset<br /><br />; ------------------- Log the call to API here -------------------------------<br />----------------------------------------------------------------------<br />---------Code for Opening the Log file is here------------------<br />-----------------------------------------------------------------------<br /><br />	;			push	   ecx -------------\<br />	;			pushfd ---------------\   |<br />	;			pushad -------\       |   |<br />	;			              |       |   |<br />lea	ebx,&#91; esp + sizeof PUSHA_STRUCT + 4 + 4 + 4 &#93;;ebx -&gt; ;argument of API<br />mov	ebx,&#91; ebx &#93;	;ebx = 1st argument&#58; website name<br />	<br />push	ebx				;save pointer to site name first...<br /><br /> </code></pre><br />Here i want to compare this value in 'ebx' with site names contained in another file.<br />There..the site names were previously enterd as follows<br /><pre><code><br />&#91;url&#93;www.sex.com&#91;/url&#93;<br />&#91;url&#93;www.fu**.com&#91;/url&#93;<br />&#91;url&#93;www.sc**t.com&#91;/url&#93;<br /></code></pre><br /><br />Please give a suggestion how to do that in Injected Code.</div>
    <div class="meta">Posted on 2004-01-25 13:18:47 by zakham</div>
   </div>
   <div class="post" id="post-131665">
    <div class="subject"><a href="#post-131665">Code Injection Help Needed(ASM-Advanced)</a></div>
    <div class="body">Hi, zakham :)<br /><br />My 0.02:<br /><br />I don't usually work with code injection, actually the only technique I know is through a hook library (the only documented way I know of). In that case things are much simpler, since code doesn't have to be relocatable -but installing global hooks is a priviledged operation on NT and 2K. Since it's a legit application you might want to support this technique as well... and use another one if for some reason you can't have a global hook.</div>
    <div class="meta">Posted on 2004-01-25 15:26:36 by QvasiModo</div>
   </div>
   <div class="post" id="post-131672">
    <div class="subject"><a href="#post-131672">Code Injection Help Needed(ASM-Advanced)</a></div>
    <div class="body">I have tested injection and posted a demo on the board <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=14044">in this thread</a>.<br /><br />Hope it can be of guidance.</div>
    <div class="meta">Posted on 2004-01-25 16:43:35 by minor28</div>
   </div>
  </div>
 </body>
</html>