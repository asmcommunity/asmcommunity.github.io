<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Reading Registry - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20511" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=20511">Reading Registry</a></p>
   <div class="post" id="post-156729">
    <div class="subject"><a href="#post-156729">Reading Registry</a></div>
    <div class="body">Just getting stuck with reading registry values like a string in sztext<br />Take for instance the key:<br /><br />HKEY_LOCAL_MACHINE\SYSTEM\Setup\SystemPartition<br /><br />I want to read the string value stored in 'SystemPartition' which isnt a subkey, but a key of type REG_SZ.... and im getting problems..<br />tried using RegQueryEx and stuff.. it returns 2 in eax.. and no value thats in the key i selected.. <br /><br />basically just to read values of a specific key in the registry.<br />not the whole key directory if possible.</div>
    <div class="meta">Posted on 2005-02-06 05:14:42 by pwn</div>
   </div>
   <div class="post" id="post-156733">
    <div class="subject"><a href="#post-156733">Reading Registry</a></div>
    <div class="body">this might be usefull:<br /><br /><pre><code><br />comment /<br />	;Valuename=NULL returns default value type and data<br /><br />	invoke SetRegString, HKEY_LOCAL_MACHINE,<br />                        chr$&#40;&quot;Software\MASM\Registry Test\&quot;&#41;,<br />                        chr$&#40;&quot;StringKeyName&quot;&#41;, <br />                        chr$&#40;&quot;aaa&quot;&#41; <br /><br />	invoke SetRegDword, HKEY_LOCAL_MACHINE, <br />                        chr$&#40;&quot;Software\MASM\Registry Test\&quot;&#41;, <br />                        chr$&#40;&quot;DwordKeyName&quot;&#41;, <br />                        4500<br /><br />	invoke GetRegString, addr szBigBuffer,<br />                        HKEY_LOCAL_MACHINE,<br />                        chr$&#40;&quot;Software\MASM\Registry Test\&quot;&#41;,<br />                        chr$&#40;&quot;StringKeyName&quot;&#41;<br /><br />   	invoke GetRegDword, HKEY_LOCAL_MACHINE, <br />                        chr$&#40;&quot;Software\MASM\Registry Test\&quot;&#41;, <br />                        chr$&#40;&quot;DwordKeyName&quot;&#41;, <br />                        addr dwValue<br />        invoke Reg_Delete_Value,HKEY_LOCAL_MACHINE,<br />        		chr$&#40;&quot;Software\MASM\Registry Test\&quot;&#41;,<br />        		chr$&#40;&quot;DwordKeyName&quot;&#41;             <br />	/<br /><br />SetRegString    proto &#58;dword, &#58;dword, &#58;dword, &#58;dword<br />GetRegString    proto &#58;dword, &#58;dword, &#58;dword, &#58;dword<br />SetRegDword     proto &#58;dword, &#58;dword, &#58;dword, &#58;dword<br />GetRegDword     proto &#58;dword, &#58;dword, &#58;dword, &#58;dword<br />Reg_Delete_Value proto &#58;dword, &#58;dword, &#58;dword<br /><br />.data<br /><br />.code<br /><br />SetRegString  proc reg_HKEY&#58;dword, lpszKeyName&#58;dword, lpszValueName&#58;dword, lpszString&#58;dword<br />    local Disp&#58; dword<br />    local pKey&#58; dword<br />    local dwSize&#58; dword<br />    invoke RegCreateKeyEx, reg_HKEY,<br />        lpszKeyName, NULL, NULL, <br />        REG_OPTION_NON_VOLATILE, <br />        KEY_ALL_ACCESS, NULL,<br />        addr pKey, addr Disp<br />    .if eax == ERROR_SUCCESS<br />        invoke lstrlen, lpszString<br />        mov dwSize, eax<br />        invoke RegSetValueEx, pKey, lpszValueName, <br />            NULL, REG_SZ, <br />            lpszString, dwSize <br />        push eax<br />        invoke RegCloseKey, pKey<br />        pop eax<br />    .endif<br />    ret<br />SetRegString endp<br /><br />Reg_Delete_Value  proc reg_HKEY&#58;dword, lpszKeyName&#58;dword, lpszValueName&#58;dword<br />    local Disp&#58; dword<br />    local pKey&#58; dword<br />    invoke RegCreateKeyEx, reg_HKEY,<br />        lpszKeyName, NULL, NULL, <br />        REG_OPTION_NON_VOLATILE, <br />        KEY_ALL_ACCESS, NULL,<br />        addr pKey, addr Disp<br />    .if eax == ERROR_SUCCESS<br />        invoke RegDeleteValue,pKey,lpszValueName<br />        push eax<br />        invoke RegCloseKey, pKey<br />        pop eax<br />    .endif<br />    ret<br />Reg_Delete_Value endp<br /><br />; -------------------------------------------------------------------------<br /><br />GetRegString proc lpszBuffer&#58;dword, reg_HKEY&#58;dword, lpszKeyName&#58;dword, lpszValueName&#58;dword<br />    local TType&#58; dword<br />    local pKey&#58; dword<br />    local dwSize&#58; dword<br />    mov TType, REG_SZ<br />    invoke RegOpenKey, reg_HKEY, lpszKeyName, addr pKey<br />    invoke RegQueryValueEx, pKey, lpszValueName, NULL, NULL, NULL, addr dwSize<br />    invoke RegCreateKeyEx, reg_HKEY, lpszKeyName, NULL, NULL, REG_OPTION_NON_VOLATILE, <br />        KEY_ALL_ACCESS, NULL, addr pKey, addr TType<br />    .if eax == ERROR_SUCCESS<br />        mov eax, REG_DWORD<br />        mov TType, eax<br />        inc dwSize<br />        invoke RegQueryValueEx, pKey, lpszValueName, <br />            NULL, addr TType, <br />            lpszBuffer, addr dwSize<br />        push eax<br />        invoke RegCloseKey, pKey<br />        pop eax<br />    .endif<br />    ret<br />GetRegString endp<br /><br />; -------------------------------------------------------------------------<br /><br />SetRegDword proc reg_HKEY&#58;dword, lpszKeyName&#58;dword, lpszValueName&#58;dword, lpdwValue&#58;dword<br />    local Disp&#58; dword<br />    local pKey&#58; dword<br />    local dwValue&#58; dword<br />    push lpdwValue<br />    pop dwValue<br />    DW_SIZE equ 4<br />    invoke RegCreateKeyEx, reg_HKEY,<br />        lpszKeyName, NULL, NULL, <br />        REG_OPTION_NON_VOLATILE, <br />        KEY_ALL_ACCESS, NULL,<br />        addr pKey, addr Disp<br />    .if eax == ERROR_SUCCESS<br />        invoke RegSetValueEx, pKey, lpszValueName, <br />        NULL, REG_DWORD_LITTLE_ENDIAN, <br />        addr dwValue, DW_SIZE<br />        push eax<br />        invoke RegCloseKey, pKey<br />        pop eax<br />    .endif<br />    ret<br />SetRegDword endp<br /><br />; -------------------------------------------------------------------------<br /><br />GetRegDword proc reg_HKEY&#58;dword, lpszKeyName&#58;dword, lpszValueName&#58;dword, lpdwValue&#58;dword<br />    local Temp&#58; dword<br />    local pKey&#58; dword<br />    local DWordSize&#58; dword<br />    DW_SIZE EQU 4<br />    mov DWordSize, DW_SIZE<br />    invoke RegCreateKeyEx, reg_HKEY, <br />        lpszKeyName, NULL, NULL, <br />        REG_OPTION_NON_VOLATILE, <br />        KEY_ALL_ACCESS, NULL,<br />        addr pKey, addr Temp<br />    .if eax == ERROR_SUCCESS<br />        mov eax, REG_DWORD<br />        mov Temp, eax<br />        invoke RegQueryValueEx, pKey, lpszValueName, <br />            NULL, addr Temp, <br />            lpdwValue, addr DWordSize <br />        push eax<br />        invoke RegCloseKey, pKey<br />        pop eax<br />    .endif<br />    ret<br />GetRegDword endp</code></pre></div>
    <div class="meta">Posted on 2005-02-06 08:04:10 by diablo2oo2</div>
   </div>
   <div class="post" id="post-156744">
    <div class="subject"><a href="#post-156744">Reading Registry</a></div>
    <div class="body">nice code very helpful easy crackmes thx.</div>
    <div class="meta">Posted on 2005-02-06 15:48:12 by pwn</div>
   </div>
  </div>
 </body>
</html>