<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>MASM slow with large arrays? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3580" />
    <link rel="next" href="../?id=3580&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=3580">MASM slow with large arrays?</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=3580&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=3580&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="3580" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=3580&amp;page=2">&gt;</a><a href="../?id=3580&amp;page=2">&raquo;</a></form>   <div class="post" id="post-23909">
    <div class="subject"><a href="#post-23909">MASM slow with large arrays?</a></div>
    <div class="body">I have a program with a .DATA? section like this:<br /><br />.DATA?<br />&lt;variables&gt;<br /><br />apoint struct<br />xpos word ?<br />ypos word ?<br />color dword ?<br />apoint ends<br /><br /><br />pts apoint 100000 dup({?,?,?})<br /><br />Everything works fine, except that when assembling this 100,000 element array, ML takes about 20 seconds on my 500 mhz computer. Interestingly enough, when i switch ML out of /coff mode, the program compiles almost instantaneously, but then LINK can't make the .obj file into a PE executable. Why does ML take so long? How can i speed it up? I intend to up the array size to 1,000,000 but dont want to wait 200 seconds for my program to compile.<br /><br />Thanks.<br />-LOLTH</div>
    <div class="meta">Posted on 2002-02-11 17:05:10 by LOLTH</div>
   </div>
   <div class="post" id="post-23912">
    <div class="subject"><a href="#post-23912">MASM slow with large arrays?</a></div>
    <div class="body">I have had the same problem.  If I still had SI installed I'd take a look to see what MASM is doing for a couple minutes of my time - this is unacceptable!  Serious bug here, IMO.</div>
    <div class="meta">Posted on 2002-02-11 17:15:03 by bitRAKE</div>
   </div>
   <div class="post" id="post-23916">
    <div class="subject"><a href="#post-23916">MASM slow with large arrays?</a></div>
    <div class="body">Hi<br /><br />Yes, that's an annoying feature of Masm. What I do is to create a separate module with your array in it and then just assemble it once. Use EXTERN in the main module. Then link them together and it's done. Don't forget to make your array PUBLIC. Hope it helps.<br /><br />Salieri</div>
    <div class="meta">Posted on 2002-02-11 17:27:09 by Salieri</div>
   </div>
   <div class="post" id="post-23918">
    <div class="subject"><a href="#post-23918">MASM slow with large arrays?</a></div>
    <div class="body">Or you could dynamically allocate the memory at run time....</div>
    <div class="meta">Posted on 2002-02-11 17:38:49 by sluggy</div>
   </div>
   <div class="post" id="post-23932">
    <div class="subject"><a href="#post-23932">MASM slow with large arrays?</a></div>
    <div class="body">I agree with Sluggy here, far better solution in code design and it should build faster as well.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-02-11 19:16:32 by hutch--</div>
   </div>
   <div class="post" id="post-23945">
    <div class="subject"><a href="#post-23945">MASM slow with large arrays?</a></div>
    <div class="body">Can someone give me a refresher course on that :) dynamically allocate arrays that is...<br /><br />Or a link will be fine too :-) I wish I had a 32 bit assembler book (*hint* *hint* *wink*wink*), like the one I use for C++.  I could then just open it to the &quot;dynamically created arrays&quot; capter and not bother you fine folks.<br /><br />Sliver<br /><br />----EDIT----<br />Ok I'm the worlds bigest ass... Maybe I should do a search first and then post the question later:<br /><br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=2879&amp;highlight=dynamically+array">http://www.asmcommunity.net/board/index.php?topic=2879&amp;highlight=dynamically+array</a></div>
    <div class="meta">Posted on 2002-02-11 22:44:14 by Sliver</div>
   </div>
   <div class="post" id="post-23946">
    <div class="subject"><a href="#post-23946">MASM slow with large arrays?</a></div>
    <div class="body">Not really the worlds biggest, <strong>Sliver</strong>.  In your defense: you honestly label yourself to help protect those unfamiliar with you, and more importantly you post the said found link here for others (which serves to prove the affore mentioned point :)).  Lesser men would cowardly let others do the work and post replies - all the while having the resources to solve his problem.  So, that makes you a productive member of the community. :alright:</div>
    <div class="meta">Posted on 2002-02-11 23:03:56 by bitRAKE</div>
   </div>
   <div class="post" id="post-23952">
    <div class="subject"><a href="#post-23952">MASM slow with large arrays?</a></div>
    <div class="body">Damn, i could have used that lib 6 months ago.... i ended up writing my own, it's a pain when you have to do the work yourself :rolleyes: :)<br /><br />LOLTH: here is another option: use a linked list. There are some cases where this may be preferable to an array.</div>
    <div class="meta">Posted on 2002-02-11 23:56:22 by sluggy</div>
   </div>
   <div class="post" id="post-23966">
    <div class="subject"><a href="#post-23966">MASM slow with large arrays?</a></div>
    <div class="body"><div class="quote"><em>Originally posted by bitRAKE </em><br />Not really the worlds biggest, Sliver</div><br /><br />Thanks Bitrake :)  I really appreciate that... <br /><br />Although it still would have been smarter to do the search first :) <br /><br /><br />Sliver<br /><br />ps. I have to say that so I can come down hard on those who don't do this in the future :) :) :)<br /><br />After taking a good look at Eoin's example I kinda wonder how C++ compilers hande he allocations for a dynamic arrays?</div>
    <div class="meta">Posted on 2002-02-12 02:02:42 by Sliver</div>
   </div>
   <div class="post" id="post-23988">
    <div class="subject"><a href="#post-23988">MASM slow with large arrays?</a></div>
    <div class="body">Big allocations, ho humm... if you need dynamic stuff, look at Eo?n's<br />dynamic array stuff. Or HeapAlloc/HeapRealloc if you want to try<br />to make your own stuff. If you just need one huge old array that<br />will never be resized, VirtualAlloc is the way to go (4k aligned, size<br />rounded to 4k). Both Heap* and VirtualAlloc zeroes the memory blocks.</div>
    <div class="meta">Posted on 2002-02-12 09:40:30 by f0dder</div>
   </div>
   <div class="post" id="post-24022">
    <div class="subject"><a href="#post-24022">MASM slow with large arrays?</a></div>
    <div class="body">OK, Thanks!<br /><br />I will go with dynamic allocation.<br />I am writing a program which graphs a search space of different algorithms based on their fitness at solving a given problem. The graph is an array of points on the screen, each with a different color, representing different fitnesses. As you all know there are large numbers of points on a screen and so I have to have a large array to hold all those points. <br />Is there a big difference in the speed of VirtualAlloc and HeapAlloc? Ideally I could allocate different amounts of memory for different graph sizes, but if HeapAlloc is really slow I may as well just VirtualAlloc the maximum amount of memory needed once.<br /><br />Thanks again.<br />-LOLTH</div>
    <div class="meta">Posted on 2002-02-12 15:32:07 by LOLTH</div>
   </div>
   <div class="post" id="post-24023">
    <div class="subject"><a href="#post-24023">MASM slow with large arrays?</a></div>
    <div class="body"><div class="quote">Both Heap* and VirtualAlloc zeroes the memory blocks</div><br /><br />Then is HEAP_ZERO_MEMORY (for HeapAlloc) useless ?<br /><br />According to the Platform SDK November 2001 Edition :<br /><div class="quote">HEAP_ZERO_MEMORY : Specifies that the allocated memory will be initialized to zero. Otherwise, the memory is not initialized to zero.</div><br /><br />Thanks.</div>
    <div class="meta">Posted on 2002-02-12 15:38:17 by JCP</div>
   </div>
   <div class="post" id="post-24025">
    <div class="subject"><a href="#post-24025">MASM slow with large arrays?</a></div>
    <div class="body">The thing is not about whether to use or not dynamically allocated<br />arrays<br />The thing is that MASM work slooooooooow with big data.<br />I have a lot of cases in my programming when:<br />1. You can not solve your problems using allocated arrays -<br />'cause it is special big tables of some system data and it sould be<br />initialised (of course I can write some code that would fill this tables but the code it self will take almost the same size as data)<br />2. I use case calculations (especially with coding\decoding well<br />cripted data) and if some data not in predrfined places it would take ~1000 times more to complete the job.<br /><br />So it is big minus of MASM.<br />I like MASM, the only worthy proof of it - I use it as main instrument in my work. And I'm ready to close my eyes on all<br />other things in MASM.<br />But working with large piece of data in MASM is painfull headake.<br />It is not a problem only for those who never had a task that needs big chunk of predefined data.</div>
    <div class="meta">Posted on 2002-02-12 16:03:11 by The Svin</div>
   </div>
   <div class="post" id="post-24033">
    <div class="subject"><a href="#post-24033">MASM slow with large arrays?</a></div>
    <div class="body"><div class="quote"><em>The graph is an array of points on the screen, each with a different color, representing different fitnesses.</em></div><br /><br />Here is another brilliant idea from left-field: use a bitmap to directly store the graph points. You would need to write a quick algo that would translate array positioning to/from a certain pixel, but that should not be hard. After all, your graph stored in memory is going to end up as a picture anyway, isn't it? Or are you going to send the data to some other 3rd party app?<br />Another advantage to using a bitmap to store your data is that there are already some APIs for dealing with them (i.e. saving/loading), that will save you some work.<br /><br />:grin:<br />Now, lets see what comments this generates :)</div>
    <div class="meta">Posted on 2002-02-12 16:52:35 by sluggy</div>
   </div>
   <div class="post" id="post-24123">
    <div class="subject"><a href="#post-24123">MASM slow with large arrays?</a></div>
    <div class="body">Svin, I've made a tool to convert binary data to linkable coff .obj,<br />perhaps that would be of use to you? I can post it here (again ;))<br />one of the following days, after I clean up the source a bit.</div>
    <div class="meta">Posted on 2002-02-13 12:47:31 by f0dder</div>
   </div>
   <div class="post" id="post-24139">
    <div class="subject"><a href="#post-24139">MASM slow with large arrays?</a></div>
    <div class="body">Ok, now im *really* confused.  <br /><br />How is MASM to be the fault of slow access for predefined data, when all it does is properly builds the PE header entries, and copys the data to a location in the final exe???<br /><br />To me it sounds like its the PE thats the problem... Which raises the questions, how does other compilers make this process &quot;faster&quot;... To me the code sound be the same regardless, as well as the binary data packed into the exe...<br /><br />I *really* think im missing something here... <br />NaN</div>
    <div class="meta">Posted on 2002-02-13 13:45:48 by NaN</div>
   </div>
   <div class="post" id="post-24141">
    <div class="subject"><a href="#post-24141">MASM slow with large arrays?</a></div>
    <div class="body">So, I guess I'm not the only one here experiencing this problem.<br /><br />use TASM :) . assembles faster than MASM  he! he! he! (here's umberg6007 again on his quest on promoting TASM :grin: )</div>
    <div class="meta">Posted on 2002-02-13 14:07:24 by stryker</div>
   </div>
   <div class="post" id="post-24143">
    <div class="subject"><a href="#post-24143">MASM slow with large arrays?</a></div>
    <div class="body">to umberg6007:<br />Yes, TASM is faster in such a case.<br />I just get used to MASM.<br />to f0dder:<br />Thank you.<br />I would love to try it.</div>
    <div class="meta">Posted on 2002-02-13 14:41:54 by The Svin</div>
   </div>
   <div class="post" id="post-24189">
    <div class="subject"><a href="#post-24189">MASM slow with large arrays?</a></div>
    <div class="body">Sluggy,<br /><br />The idea of using a bitmap to store the graph is an excellent idea. It will use less space and be far faster to display. I will get to work on doing that as soon as i have a valid graph to display and as soon as i learn how to deal with bitmaps ;) .</div>
    <div class="meta">Posted on 2002-02-13 19:21:44 by LOLTH</div>
   </div>
   <div class="post" id="post-24199">
    <div class="subject"><a href="#post-24199">MASM slow with large arrays?</a></div>
    <div class="body"><div class="quote"><em>The idea of using a bitmap to store the graph is an excellent idea.</em></div><br />Glad you like the idea. Just be aware that with the bitmap, you can only have one value in any particular pixel position, but then again you would have the same problem with using a standard array, you will just need to work out a rule for any values that collide like this.</div>
    <div class="meta">Posted on 2002-02-13 21:04:00 by sluggy</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=3580&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=3580&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="3580" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=3580&amp;page=2">&gt;</a><a href="../?id=3580&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>