<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>problem with pointers - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10637" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=10637">problem with pointers</a></p>
   <div class="post" id="post-80021">
    <div class="subject"><a href="#post-80021">problem with pointers</a></div>
    <div class="body">Hiya.<br /><br />The following code compiles without errors/warnings, but the output is not valid, or is so my brain? ;-)<br />I've put produced code (.asm file) into the comments<span style="font-size:9px><pre><code>&#91;B&#93;program&#91;/B&#93; _test_;<br /><br />    &#91;B&#93;procedure&#91;/B&#93; SomeProc1&#40; a&#58; &#91;B&#93;dword&#91;/B&#93; &#41;; &#91;B&#93;@external&#91;/B&#93;;<br />    &#91;B&#93;procedure&#91;/B&#93; SomeProc2&#40; a&#58; &#91;B&#93;dword&#91;/B&#93;; b&#58; &#91;B&#93;dword&#91;/B&#93; &#41;; &#91;B&#93;@external&#91;/B&#93;;<br /><br />&#91;B&#93;type&#91;/B&#93;<br />    proc_rec    &#58; &#91;B&#93;record&#91;/B&#93;<br />        Proc1   &#58; &#91;B&#93;pointer&#91;/B&#93; &#91;B&#93;to&#91;/B&#93; &#91;B&#93;procedure&#91;/B&#93; SomeProc1;<br />        Proc2   &#58; &#91;B&#93;pointer&#91;/B&#93; &#91;B&#93;to&#91;/B&#93; &#91;B&#93;procedure&#91;/B&#93; SomeProc2;<br />    &#91;B&#93;endrecord&#91;/B&#93;;<br /><br />&#91;B&#93;var&#91;/B&#93;<br />    rec     &#58; proc_rec;<br />    prec    &#58; &#91;B&#93;pointer&#91;/B&#93; &#91;B&#93;to&#91;/B&#93; proc_rec;<br /><br />&#91;B&#93;begin&#91;/B&#93; _test_;<br />    &#91;B&#93;lea&#91;/B&#93;&#40; rec, eax &#41;;<br />&#91;COLOR=royalblue&#93;//      lea eax, &#91;ebp-12&#93;   ;/* rec */&#91;/COLOR&#93;<br />    &#91;B&#93;mov&#91;/B&#93;&#40; eax, prec &#41;;<br />&#91;COLOR=royalblue&#93;//      mov dword ptr &#91;ebp-16&#93;, eax ;/* prec */&#91;/COLOR&#93;<br />    <br />    rec.Proc1&#40; eax &#41;;<br />&#91;COLOR=royalblue&#93;//      push    eax&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      call    dword ptr &#91;ebp-12&#93;  ;/* rec.Proc1 */&#91;/COLOR&#93;<br />    rec.Proc2&#40; eax, edx &#41;;<br />&#91;COLOR=royalblue&#93;//      push    eax&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      push    edx&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      call    dword ptr &#91;ebp-8&#93;   ;/* rec.Proc2 */&#91;/COLOR&#93;<br /><br />    prec.Proc1&#40; eax &#41;;<br />&#91;COLOR=royalblue&#93;//      push    eax&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      call    dword ptr &#91;ebp-16&#93;  ;/* prec.Proc1 */&#91;/COLOR&#93;<br />    prec.Proc2&#40; eax, edx &#41;;<br />&#91;COLOR=royalblue&#93;//      push    eax&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      push    edx&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      call    dword ptr &#91;ebp-12&#93;  ;/* prec.Proc2 */&#91;/COLOR&#93;<br /><br />&#91;B&#93;end&#91;/B&#93; _test_;<br /></code></pre></span><br /><br />Regards,<br />clone-d.</div>
    <div class="meta">Posted on 2003-02-05 07:22:43 by clone-d</div>
   </div>
   <div class="post" id="post-80447">
    <div class="subject"><a href="#post-80447">Re: problem with pointers</a></div>
    <div class="body"><div class="quote"><br />Hiya.<br /><br />The following code compiles without errors/warnings, but the output is not valid, or is so my brain? ;-)<br />I've put produced code (.asm file) into the comments<span style="font-size:9px><pre><code>&#91;B&#93;program&#91;/B&#93; _test_;<br /><br />    &#91;B&#93;procedure&#91;/B&#93; SomeProc1&#40; a&#58; &#91;B&#93;dword&#91;/B&#93; &#41;; &#91;B&#93;@external&#91;/B&#93;;<br />    &#91;B&#93;procedure&#91;/B&#93; SomeProc2&#40; a&#58; &#91;B&#93;dword&#91;/B&#93;; b&#58; &#91;B&#93;dword&#91;/B&#93; &#41;; &#91;B&#93;@external&#91;/B&#93;;<br /><br />&#91;B&#93;type&#91;/B&#93;<br />    proc_rec    &#58; &#91;B&#93;record&#91;/B&#93;<br />        Proc1   &#58; &#91;B&#93;pointer&#91;/B&#93; &#91;B&#93;to&#91;/B&#93; &#91;B&#93;procedure&#91;/B&#93; SomeProc1;<br />        Proc2   &#58; &#91;B&#93;pointer&#91;/B&#93; &#91;B&#93;to&#91;/B&#93; &#91;B&#93;procedure&#91;/B&#93; SomeProc2;<br />    &#91;B&#93;endrecord&#91;/B&#93;;<br /><br />&#91;B&#93;var&#91;/B&#93;<br />    rec     &#58; proc_rec;<br />    prec    &#58; &#91;B&#93;pointer&#91;/B&#93; &#91;B&#93;to&#91;/B&#93; proc_rec;<br /><br />&#91;B&#93;begin&#91;/B&#93; _test_;<br />    &#91;B&#93;lea&#91;/B&#93;&#40; rec, eax &#41;;<br />&#91;COLOR=royalblue&#93;//      lea eax, &#91;ebp-12&#93;   ;/* rec */&#91;/COLOR&#93;<br />    &#91;B&#93;mov&#91;/B&#93;&#40; eax, prec &#41;;<br />&#91;COLOR=royalblue&#93;//      mov dword ptr &#91;ebp-16&#93;, eax ;/* prec */&#91;/COLOR&#93;<br />    <br />    rec.Proc1&#40; eax &#41;;<br />&#91;COLOR=royalblue&#93;//      push    eax&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      call    dword ptr &#91;ebp-12&#93;  ;/* rec.Proc1 */&#91;/COLOR&#93;<br />    rec.Proc2&#40; eax, edx &#41;;<br />&#91;COLOR=royalblue&#93;//      push    eax&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      push    edx&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      call    dword ptr &#91;ebp-8&#93;   ;/* rec.Proc2 */&#91;/COLOR&#93;<br /><br />    prec.Proc1&#40; eax &#41;;<br />&#91;COLOR=royalblue&#93;//      push    eax&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      call    dword ptr &#91;ebp-16&#93;  ;/* prec.Proc1 */&#91;/COLOR&#93;<br />    prec.Proc2&#40; eax, edx &#41;;<br />&#91;COLOR=royalblue&#93;//      push    eax&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      push    edx&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      call    dword ptr &#91;ebp-12&#93;  ;/* prec.Proc2 */&#91;/COLOR&#93;<br /><br />&#91;B&#93;end&#91;/B&#93; _test_;<br /></code></pre></span><br /><br />Regards,<br />clone-d. </div><br /><br /><br />My guess would be that you haven't initialized the procedure pointer variables.<br />Note that &quot;pointer to procedure someproc1&quot; only creates a template for use by HLA in determining the parameters to check for, it does *not* initialize those fields with the address of these routines.  You have to do that with instructions like<br /><pre><code><br />mov&#40; &amp;SomeProc1, rec.Proc1 &#41;;<br />mov&#40; &amp;SomeProc2, rec.Proc2 &#41;;<br /></code></pre><br /><br />Then you should be able to call the procedures.<br />Randy Hyde</div>
    <div class="meta">Posted on 2003-02-07 20:28:58 by rhyde</div>
   </div>
   <div class="post" id="post-80498">
    <div class="subject"><a href="#post-80498">Re: Re: problem with pointers</a></div>
    <div class="body"><div class="quote"><br /><br />T<br /><br />My guess would be that you haven't initialized the procedure pointer variables.<br />Note that &quot;pointer to procedure someproc1&quot; only creates a template for use by HLA in determining the parameters to check for, it does *not* initialize those fields with the address of these routines.  You have to do that with instructions like<br /><pre><code><br />mov&#40; &amp;SomeProc1, rec.Proc1 &#41;;<br />mov&#40; &amp;SomeProc2, rec.Proc2 &#41;;<br /></code></pre><br />Then you should be able to call the procedures.<br />Randy Hyde </div><br /><br />Actually I was talking about this piece of code:<span style="font-size:9px><pre><code>    prec.Proc1&#40; eax &#41;;<br />&#91;COLOR=royalblue&#93;//      push    eax&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      call    dword ptr &#91;ebp-16&#93;  ;/* prec.Proc1 */&#91;/COLOR&#93;<br />    prec.Proc2&#40; eax, edx &#41;;<br />&#91;COLOR=royalblue&#93;//      push    eax&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      push    edx&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      call    dword ptr &#91;ebp-12&#93;  ;/* prec.Proc2 */&#91;/COLOR&#93;<br /></code></pre></span>prec is a pointer to record, so even if I initialize rec's fields, this two calls will be invalid. You should fix this someway - either making compiler generate valid code or forbidding such code, like it is done in case of &quot;mov( eax, prec.Proc1)&quot;(Illegal use of pointer variable.)<br /><br />clone-d.</div>
    <div class="meta">Posted on 2003-02-08 06:15:47 by clone-d</div>
   </div>
   <div class="post" id="post-81004">
    <div class="subject"><a href="#post-81004">Re: Re: Re: problem with pointers</a></div>
    <div class="body"><div class="quote"><br /><br /><br />Actually I was talking about this piece of code:<span style="font-size:9px><pre><code>    prec.Proc1&#40; eax &#41;;<br />&#91;COLOR=royalblue&#93;//      push    eax&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      call    dword ptr &#91;ebp-16&#93;  ;/* prec.Proc1 */&#91;/COLOR&#93;<br />    prec.Proc2&#40; eax, edx &#41;;<br />&#91;COLOR=royalblue&#93;//      push    eax&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      push    edx&#91;/COLOR&#93;<br />&#91;COLOR=royalblue&#93;//      call    dword ptr &#91;ebp-12&#93;  ;/* prec.Proc2 */&#91;/COLOR&#93;<br /></code></pre></span>prec is a pointer to record, so even if I initialize rec's fields, this two calls will be invalid. You should fix this someway - either making compiler generate valid code or forbidding such code, like it is done in case of &quot;mov( eax, prec.Proc1)&quot;(Illegal use of pointer variable.)<br /><br />clone-d. </div><br /><br />Oh, okay.<br />Gotcha.<br />I'll definitely look into this one.<br />That is something that needs to be fixed, fer sure.<br />Randy Hyde</div>
    <div class="meta">Posted on 2003-02-10 22:54:43 by rhyde</div>
   </div>
  </div>
 </body>
</html>