<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>windows console app help - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=6728" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=6728">windows console app help</a></p>
   <div class="post" id="post-48630">
    <div class="subject"><a href="#post-48630">windows console app help</a></div>
    <div class="body">how would i create a windows console app? how to i create the window and output/imput text from it?</div>
    <div class="meta">Posted on 2002-04-26 19:19:08 by Qages</div>
   </div>
   <div class="post" id="post-48627">
    <div class="subject"><a href="#post-48627">windows console app help</a></div>
    <div class="body">in the examples directory of masm32 you'll find an example of what you need. It's called TextIO and is found in \masm32\example3</div>
    <div class="meta">Posted on 2002-04-27 05:17:32 by Hiroshimator</div>
   </div>
   <div class="post" id="post-48636">
    <div class="subject"><a href="#post-48636">windows console app help</a></div>
    <div class="body">Just remember to link with the <em>/subsystem:console</em> option.<br /><br />/Flyke</div>
    <div class="meta">Posted on 2002-04-27 07:50:09 by Flyke</div>
   </div>
   <div class="post" id="post-48635">
    <div class="subject"><a href="#post-48635">Hi</a></div>
    <div class="body">If you use QEditor, instead of Project...Build All click on Project...Console Build All</div>
    <div class="meta">Posted on 2002-04-27 11:22:27 by Ronin Magus</div>
   </div>
   <div class="post" id="post-48631">
    <div class="subject"><a href="#post-48631">windows console app help</a></div>
    <div class="body">hi, im trying to make a text command thing, well im im putting 'cls' as text into the console, is there a termanating null at the end of that in the buffer? if there isnt then it might mistake it for another command</div>
    <div class="meta">Posted on 2002-04-27 19:12:53 by Qages</div>
   </div>
   <div class="post" id="post-48632">
    <div class="subject"><a href="#post-48632">windows console app help</a></div>
    <div class="body">nevermind about that above, ive gotten away around that, how do i pass paramters to my program? ,like if i ran 'c:\console.exe path.exe' and it will open up and show path.exe</div>
    <div class="meta">Posted on 2002-04-27 20:23:11 by Qages</div>
   </div>
   <div class="post" id="post-48633">
    <div class="subject"><a href="#post-48633">windows console app help</a></div>
    <div class="body">i also have a nother problem, i cant seem to clear my buffer of text, it will show rememnetns of the other text imput<br /><br /><pre><code><br />   ; ------------<br />    ; Local macros<br />    ; ------------<br />      print MACRO Quoted_Text&#58;VARARG<br />        LOCAL Txt<br />          .data<br />            Txt db Quoted_Text,0<br />          .code<br />        invoke StdOut,ADDR Txt<br />      ENDM<br /><br />      input MACRO Quoted_Prompt_Text&#58;VARARG<br />        LOCAL Txt<br />        LOCAL Buffer<br />          .data<br />            Txt db Quoted_Prompt_Text,0<br />            Buffer db 1024 dup&#40;?&#41;<br />          .code<br />        invoke StdOut,ADDR Txt<br />        invoke StdIn,ADDR Buffer,LENGTHOF Buffer<br />        mov eax, offset Buffer<br />      ENDM<br /><br />      cls MACRO<br />        invoke ClearScreen<br />      ENDM<br /><br />      Main   PROTO<br />      CRLF equ 13,10<br />          ;print &quot;Console function test&quot;,13,10,13,10<br /><br />; #########################################################################<br /><br />    .data<br />      Msg1        db &quot;Type something &gt; &quot;,0<br />      Msg2        db &quot;You typed &gt; &quot;,0<br />      DCLSD       db &quot;Screen Cleared.&quot;,CRLF<br />      .data?<br />      iBuffer db 128 dup&#40;?&#41;<br /><br />; #########################################################################<br /><br />    .code<br /><br />    start proc<br />      invoke Main<br />      ;invoke ExitProcess,0<br />      ret<br />    start endp<br /><br />; #########################################################################<br /><br />Main proc<br />    LOCAL InputBuffer&#91;128&#93;&#58;BYTE<br />    LOCAL ISSCR&#58;DWORD<br />    ;first run<br />    mov ISSCR,0<br />    cls<br />    print &quot;Qages Command Shell v1 Alpha&quot;,CRLF,&quot;&#40;C&#41; Copyright 1999-2002 Qages Software.&quot;,CRLF,CRLF<br />    <br />    @STARTJ&#58;<br />    cmp ISSCR,1<br />    je @1<br />    jmp @2<br />    @1&#58;<br />    cls<br />    ;screen cleared<br />    print &quot;Qages Command Shell v1 Alpha&quot;,CRLF,&quot;&#40;C&#41; Copyright 1999-2002 Qages Software.&quot;,CRLF,CRLF<br />    input &quot;Screen Cleared.&quot;,CRLF,CRLF,&quot;Command &gt; &quot;<br />    mov ISSCR,0<br />    jmp @3<br />    @2&#58; ; regular<br />    input &quot;Command &gt; &quot;<br />    @3&#58;<br />    ; see if were first command<br />;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />cmp BYTE PTR &#91;eax&#93;, 'c'<br />je @F<br />jmp @4<br />@@&#58;<br />cmp BYTE PTR &#91;eax+1&#93;, 'l'<br />je @F<br />jmp @4<br />@@&#58;<br />cmp BYTE PTR &#91;eax+2&#93;, 's'<br />je @F<br />jmp @4<br />@@&#58;<br />cmp BYTE PTR &#91;eax+3&#93;, 0dh<br />je @clearscreenj<br />jmp @4<br />@clearscreenj&#58; ; execute the command<br />cls<br />invoke StdOut, addr DCLSD<br />mov ISSCR,1<br />jmp @STARTJ<br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />@4&#58; ; next command req<br />cmp BYTE PTR &#91;eax&#93;, 'e'<br />je @F<br />jmp @5<br />@@&#58;<br />cmp BYTE PTR &#91;eax+1&#93;, 'x'<br />je @F<br />jmp @5<br />@@&#58;<br />cmp BYTE PTR &#91;eax+2&#93;, 'i'<br />je @F<br />jmp @5<br />@@&#58;<br />cmp BYTE PTR &#91;eax+3&#93;, 't'<br />je @F<br />jmp @5<br />@@&#58;<br />cmp BYTE PTR &#91;eax+4&#93;, 0dh<br />je @F<br />jmp @5<br />@@&#58;<br />invoke ExitProcess,0<br />jmp @STARTJ<br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />@5&#58;<br />cmp BYTE PTR &#91;eax&#93;, 'e'<br />je @F<br />jmp @6<br />@@&#58;<br />cmp BYTE PTR &#91;eax+1&#93;, 'c'<br />je @F<br />jmp @6<br />@@&#58;<br />cmp BYTE PTR &#91;eax+2&#93;, 'h'<br />je @F<br />jmp @6<br />@@&#58;<br />cmp BYTE PTR &#91;eax+3&#93;, 'o'<br />je @F<br />jmp @6<br />@@&#58;<br />cmp BYTE PTR &#91;eax+4&#93;, 20h<br />je @F<br />jmp @6<br />@@&#58;<br />add eax, 5<br />invoke StdOut,eax<br />sub eax, 5<br /><br />jmp @STARTJ<br />;;;;;;;;;;;;;;;;;;;;;;;;;<br /><br />@6&#58;<br />@7&#58;<br />@8&#58;<br />;noting yet, we went thro all return to start<br />push eax<br />print &quot;'&quot;<br />pop eax<br />push eax<br />invoke StrLen,eax<br />mov ebx,eax<br />pop eax<br />sub ebx,2<br />mov DWORD PTR &#91;eax+ebx&#93;,0h;isnt the best but ive tryed every thing and thisis how i have it<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br />add ebx,4<br />mov DWORD PTR &#91;eax+ebx&#93;,0h<br /><br />invoke StdOut,eax<br />print &quot;'&quot;<br />print &quot; is not recognized as an internal or external command, operable program or CMD file.&quot;,CRLF,CRLF<br />jmp @STARTJ<br /><br /><br />    ret<br />Main endp</code></pre></div>
    <div class="meta">Posted on 2002-04-27 22:21:46 by Qages</div>
   </div>
   <div class="post" id="post-48628">
    <div class="subject"><a href="#post-48628">windows console app help</a></div>
    <div class="body">Well there is alot to be said, but in short here is the fix your looking for.  You had one problem, and one oversight :)<br /><br />The problem is that your were declairing a new 1024 buffer everytime you used the macro.  And then the buffer is 'left' to retain memory never used again.  This is because you were using the LOCAL to make a 'unique' name for the 1024 buffer every time the macro was called.  <br /><br />To fix this, i put a one time condition around it:  If not yet defined, define an equate that says you have now a buffer.  Then delair the buffer in the .data? segment.  The next time the macro is called, the equate will be false, cause the buffer now exists, and it will be reused.<br /><br />The oversight was that you need to also call <strong>StripLF</strong> to remove the &quot;enter&quot; key and replace it with a null character, so that the buffer will know where the end is.<br /><br />With these two things in place, you code needed to be modified to stop checking for the '0D' character (cause its now not in the buffer). <br /><br />As well, your forgetting that calling anything is 99% likely to change the value of eax.  In your echo, you were adding 5 to eax, to adjust the buffer starting point, calling the StdOut, and then sub eax.  EAX will change after this call, so i PUSHED/POPPED eax and then did two line returns (since the 0d is now not in the buffer data).<br /><br />Here you go back.. :)<br />:alright:<br />NaN<br /><br />PS: The way your checking for 'commands' is very cumbersome, and can be done in much more efficent ways.  I can give you some help on this if your interested, but i get the feeling this is a learning project so i dont want to 'impose' on what your still learning. :)</div>
    <div class="meta">Posted on 2002-04-27 23:12:23 by NaN</div>
   </div>
   <div class="post" id="post-48634">
    <div class="subject"><a href="#post-48634">windows console app help</a></div>
    <div class="body">i would like another way of checkin for commands<br /><br />ive gotten every thing in working order<br />id like to learn somtin new or how to do somting in a new way, <br />also how do i pass paramters to my program from outside</div>
    <div class="meta">Posted on 2002-04-27 23:22:01 by Qages</div>
   </div>
   <div class="post" id="post-48629">
    <div class="subject"><a href="#post-48629">windows console app help</a></div>
    <div class="body">Here is a full source framework.  Its how i would go about doing what your looking to do.  It will parse command lines, as well as handle 'commands'.<br /><br />I wrote only a few commands to show you.  As well, i have a pretty powerful macro that does the 'dirty work' of dealing with text strings.  It will enter the string into memory, and then provide a check algo for that string, and jmp to a specified offset if the string is a match.  Its not 'optomal' for speed, but you shouldnt notice any lag anyways (since your running in a command window).<br /><br />The macro is called <strong>ON</strong>.  Its used like so:<br /><br /><strong>ON -VER THEN Do_Version</strong><br /><br />This will create a string and enter &quot;-VER&quot;,0 in the .data section<br />Then it will add the code lines to compare the 'Buffer' to this string<br />If they are equal, it will jump to &quot;Do_Version&quot;.<br /><br />If none are valid, it will do the default message (error).<br /><br />So, in short, to add a new command, simply add another &quot;ON command THEN Do_Command_Handler&quot; and provide a label to jump to.<br /><br /><br />In the file arguments, i make use of the existing framework, and compar them in the same fashion, except seing that some commandline args might be different from normal commands, they are in a separate handler.  I also show how to forward a commandline arg to the normal command handle so that you dont have to re-write the same code into two handlers.<br /><br />Lastly, i tweeked it by making the commands case insensitive, so EcHo, ecHO, ecHo, etc will all work.<br /><br />Im pretty happy with this, and will keep it for myself, its a good starting &quot;template&quot;, hope you think so to.<br /><br /><strong>PS:  When you check it out, test it with this command line :)<br />Command2.exe -CLS -VER -NaN</strong><br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-04-28 03:01:17 by NaN</div>
   </div>
  </div>
 </body>
</html>