<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>How to load bitmap from memory? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=11474" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=11474">How to load bitmap from memory?</a></p>
   <div class="post" id="post-86772">
    <div class="subject"><a href="#post-86772">How to load bitmap from memory?</a></div>
    <div class="body">Here's an intriguing little problem....<br />I want to load some BMP bitmaps as checkmarks in a menu.<br />Ok, the app can use LoadBitmap() or LoadImage() to get it from<br />the resource section or from file.<br /><br />But, what if the bitmaps are already in memory? That is, the files have<br />been opened and the bitmaps copied into memory (not necessarily in separate<br />memory blocks, maybe inside a single block created by GlobalAlloc()).<br />How on earth do you get a handle to a bitmap image already in memory?<br /><br />I know of two solutions, but neither seem elegant...<br /><br />1. <br />Write the bitmap to a temp file, use LoadImage() to get it, with handle.<br />-- messy!<br /><br />2. Donkey wrote in a thread Feb 23, 2003:<br /><br />If you want to move a bitmap from memory into your resource section you can use UpdateResource:<br /><br />invoke UpdateResource,hFile,RT_BITMAP,lpResName,wLanguage<br />,lpData,cbData<br /><br />You should note that lpData point to the data to be stored in the resource file, it only points to the raw data, a handle will not do. You have to convert the handle to a memory position then use that to point to the data.<br /><br />------------<br />I haven't tried either, but surely there is some simple elegant way to get a<br />handle to the bitmap, if you have the address of the bitmap,<br />then use that handle to upload to the menu item.<br />In my case I will use SetMenuItemBitmaps() to upload the checkmarks.<br />Does LoadImage() just create a simple memory image of the<br />file, or does it put in other stuff? -- if the latter, then the problem should be <br />easy to solve.<br /><br />This is an interesting little problem.<br />I wonder what the relationship is between handle and address...<br /><br />Regards,<br />Barry Kauler</div>
    <div class="meta">Posted on 2003-03-12 17:52:09 by bkauler</div>
   </div>
   <div class="post" id="post-86777">
    <div class="subject"><a href="#post-86777">How to load bitmap from memory?</a></div>
    <div class="body">I found a solution of sorts:<br /><br /><a target="_blank" href="http://groups.google.com.au/groups?hl=en&amp;lr=&amp;ie=UTF-8&amp;oe=UTF-8&amp;threadm=3964C15F.A3109055%40nospam.telex.com&amp;rnum=13&amp;prev=/groups%3Fq%3D%2522load%2Ba%2Bbitmap%2Bfrom%2Bmemory%2522%2Bwin32%26start%3D10%26hl%3Den%26lr%3D%26ie%3DUTF-8%26oe%3DUTF-8%26selm%3D3964C15F.A3109055%2540nospam.telex.com%26rnum%3D13">http://groups.google.com.au/groups?hl=en&amp;lr=&amp;ie=UTF-8&amp;oe=UTF-8&amp;threadm=3964C15F.A3109055%40nospam.telex.com&amp;rnum=13&amp;prev=/groups%3Fq%3D%2522load%2Ba%2Bbitmap%2Bfrom%2Bmemory%2522%2Bwin32%26start%3D10%26hl%3Den%26lr%3D%26ie%3DUTF-8%26oe%3DUTF-8%26selm%3D3964C15F.A3109055%2540nospam.telex.com%26rnum%3D13</a><br /><br />...umm, that's a mighty long URL.<br />Has code to read BMP to memory and create a DIB. Can later get a handle to it<br />whenever required.<br /><br />Anyway, I was wondering. Say I used LoadImage() to load my bitmaps into<br />memory. This func supplies handles.<br />Would it be possible to get a pointer to the loaded image, then copy the image<br />to where I want to save it. The requirement is at a later time want to get a handle of that copy...<br /><br />Regards,<br />Barry Kauler<br />P.S. will be away for a couple of days, so can't respond immediately to any postings.</div>
    <div class="meta">Posted on 2003-03-12 18:31:34 by bkauler</div>
   </div>
   <div class="post" id="post-86778">
    <div class="subject"><a href="#post-86778">How to load bitmap from memory?</a></div>
    <div class="body">Oh, the URL got truncated.<br />Go to Google Groups and search on subject &quot;Bitmaps in memory&quot;<br />it was in group : comp.os.ms-windows.programmer.win32<br /><br />Regards,<br />Barry Kauler</div>
    <div class="meta">Posted on 2003-03-12 18:33:56 by bkauler</div>
   </div>
   <div class="post" id="post-87040">
    <div class="subject"><a href="#post-87040">How to load bitmap from memory?</a></div>
    <div class="body">Hi,<br />I've tried this, it works:<br /><br />;..........................<br />&lt;pre&gt;<br />;open a temp file for loading of the bmp checkmarks...  v3.45<br />   invoke CreateFile,ADDR sztempbmp,GENERIC_READ OR GENERIC_WRITE, \<br />     FILE_SHARE_READ OR FILE_SHARE_WRITE,0,CREATE_ALWAYS, \<br />     FILE_ATTRIBUTE_NORMAL,0<br />     mov htempfile,eax<br /><br />;....<br />;this code is in a loop, loading bitmaps to menuitems...<br />    mov eax,(OBJECT PTR ).ximage ;handle of bitmap image.<br />    .IF eax==0 ;bmp not loaded.<br />      ;we have bmp file in library-data-element.sztext+128, need to call<br />      ;LoadImage(), so need to write to a temp file 1st..<br />      invoke SetFilePointer,htempfile,0,0,FILE_BEGIN<br />      invoke SetEndOfFile,htempfile<br />      mov eax,(OBJECT PTR ).nshape ;size of file.<br />      lea ebx,(OBJECT PTR ).sztext<br />      add ebx,128 ;address of file in memory.<br />      invoke WriteFile,htempfile,ebx,eax,ADDR nbyteswrote,0<br />      invoke LoadImage,0,ADDR sztempbmp,IMAGE_BITMAP,0,0, \<br />        LR_LOADFROMFILE ;OR LR_LOADREALSIZE  ;ret eax=0 if fail.<br />      mov (OBJECT PTR ).ximage,eax ;handle of loaded bitmap.<br />    .ENDIF<br />    ;now load the checkmark to the menuitem...<br />    .IF eax != 0<br />      invoke SetMenuItemBitmaps,helementsmenu,menuitemid,MF_BYCOMMAND,eax,eax<br />    .ENDIF<br />;.......<br /><br />;finally...<br />    invoke CloseHandle,htempfile ;close temp bmp file. v3.45<br />    invoke DeleteFile,ADDR sztempbmp<br />&lt;/pre&gt;<br />;..................................<br /><br />I've got all these BMP files, tiny 12x12 mono files (110 bytes) read into memory,<br />and they have to be loaded as checkmark bitmaps to the menuitems.<br /><br />I wondered if it would be possible to save to a temp file, as I've done above,<br />use LoadImage() and when finished delete the file, without Windows cache<br />management even writing to physical disk -- no such luck though, its not that<br />clever!<br /><br />This method is not very satisfactory, because is inherently slow.<br />I'll look at what Ernie has done. It has to become a &quot;bitmap&quot; compatible<br />with SetMenuItemBitmaps().<br /><br />Incidentally, I'm using this &quot;checkmark&quot; function not for displaying checkmarks<br />as such, but as a simple method of displaying a picture before each menu item,<br />rather than going for owner-draw.<br />Limitation is the bitmap must be small and monochrome.<br /><br />Regards,<br />Barry Kauler</div>
    <div class="meta">Posted on 2003-03-14 05:47:50 by bkauler</div>
   </div>
   <div class="post" id="post-87060">
    <div class="subject"><a href="#post-87060">How to load bitmap from memory?</a></div>
    <div class="body"><div class="quote"><br />But, what if the bitmaps are already in memory?<br /></div><br />Do you mean bitmap is already loaded but you want to<br />use as gfx object?<br />CreateBitmapIndirect<br />in BITMAP struct fill size and pointer to memory of bits of loaded BMP.</div>
    <div class="meta">Posted on 2003-03-14 06:44:40 by The Svin</div>
   </div>
   <div class="post" id="post-87195">
    <div class="subject"><a href="#post-87195">How to load bitmap from memory?</a></div>
    <div class="body">Hi,<br />The bitmap file is read as-is from memory, later I want to convert it to a<br />GDI bitmap handle.<br />The method I have given, write back out to file, then use LoadImage()<br />works but not elegant.<br /><br />The light suddenly came on. I have previously used OleLoadPicture()<br />to load and display BMP, GIF and JPG files (see my website<br /><a target="_blank" href="http://www.goosee.com/x86/">http://www.goosee.com/x86/</a> ).<br />However I had this vague memory, and checked it out -- there is a method<br />of the IPicture interface called get_Handle(), that gets a GDI bitmap handle<br />from a IPicture.<br /><br />Don't worry if that reads like gobbledy-gook, and you haven't got a clue about<br />COM. I have placed the code in the following file:<br /><br /><a target="_blank" href="http://www.goosee.com/x86/bitmap_handle_from_memory.txt">http://www.goosee.com/x86/bitmap_handle_from_memory.txt</a><br /><br />You don't need any COM include files or anything to use the code.<br /><br />There is a document that I once read on the MSDN site, that did the same<br />thing. Ernie has done similar stuff also.<br /><br />Regards,<br />Barry Kauler</div>
    <div class="meta">Posted on 2003-03-15 07:51:14 by bkauler</div>
   </div>
  </div>
 </body>
</html>