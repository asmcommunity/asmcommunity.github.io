<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>compile to binary - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=16735" />
  <link rel="prev" href="../?id=16735&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=34">OS Development</a> &raquo; <a href="../?id=16735">compile to binary</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=16735&amp;page=1" style="">&laquo;</a><a href="../?id=16735&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="16735" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-130350">
    <div class="subject"><a href="#post-130350">compile to binary</a></div>
    <div class="body">newest idea:<br />i gave up playing around with the little test-code and went over to the real conditions. i made a small 16bit-init-code (clear memory, enable a20, copy gdt, load gdt) which jumps into the c-code. you might guess it, i fail.<br /><br />newest try:<br />i tried the whole thing with jloc instead of ld. i think i understood how the controlfile and the map-file work, but jloc generates completely wrong adresses.<br />for example in at the end of the assembler-init-code i have a &quot;jmp _init@0&quot;, but the <strong>adress</strong> jloc references to is 00000000 (so, base+offset+relative jump = 00000000); obviously jloc seems to calculate something, but it somehow believes that the void init() is at 00000000... (no need to think about that, i'm just reporting).<br /><br />another try:<br />ld links somehow correct (i think, don't rememer exactly), but i have to output into a pe-file and strip the code into binary with objcopy. the output is 5kb, but the code is in binary as i wanted - leaving soo much space between the code of the obj-files... any way to prevent this? can i tell ld the order of the obj-files?<br /><br />and: gcc doesn't support that nice inline-assembly, eh?</div>
    <div class="meta">Posted on 2004-01-11 09:12:30 by hartyl</div>
   </div>
   <div class="post" id="post-130352">
    <div class="subject"><a href="#post-130352">compile to binary</a></div>
    <div class="body">Check my JLOC control file inside SOLOS source code ;)<br />It might give you some ideas, but you must know the segments generated by your c++ compiler</div>
    <div class="meta">Posted on 2004-01-11 09:35:44 by BogdanOntanu</div>
   </div>
   <div class="post" id="post-130362">
    <div class="subject"><a href="#post-130362">compile to binary</a></div>
    <div class="body">gcc suport inline <a target="_blank" href="http://www.delorie.com/djgpp/doc/brennan/brennan_att_inline_djgpp.html">at delorie</a>   <a target="_blank" href="http://www.ibm.com/developerworks/linux/library/l-ia.html">at ibm</a>   <a target="_blank" href="http://www.gnu.org/software/binutils/manual/gas-2.9.1/as.html">gas manual in gnu.org</a></div>
    <div class="meta">Posted on 2004-01-11 12:29:02 by rea</div>
   </div>
   <div class="post" id="post-130413">
    <div class="subject"><a href="#post-130413">compile to binary</a></div>
    <div class="body">well, since i can't send files via pm i post the kernel.o (generated from kernel1.zip) for <strong>hgb</strong>.<br /><br />i played around with jloc as well, getting just useless output (even if linking just 2 c-files (gnu coff-output), one function calling the other in another file...) when i try with fasm (<strong>format coff</strong>) the output is completely correct<br />are the MS COFF-files wrong for jloc? (well, i think so)<br /><br />it just seems difficult to get a binary output...<br /><br /><strong>hgb</strong>: what i meant was inline assembly in intel-format, like the visual-cpp-compiler (not the at&amp;t-style i don't like...)</div>
    <div class="meta">Posted on 2004-01-12 01:32:58 by hartyl</div>
   </div>
   <div class="post" id="post-130418">
    <div class="subject"><a href="#post-130418">compile to binary</a></div>
    <div class="body"><div class="quote"><br />i played around with jloc as well, getting just useless output (even if linking just 2 c-files (gnu coff-output), one function calling the other in another file...) when i try with fasm (format coff) the output is completely correct<br />are the MS COFF-files wrong for jloc? (well, i think so)<br /></div><br />If jloc works with fasm output but not gnu, then it's more likely it's the GNU coff format it chokes on... probably the relocation stuff that screws stuff up.<br /><br />Still think it's weird you're having all this trouble, wasn't too hard to get working for me 'back in the days' :P<br /><br />Newer versions of GAS supports intel-style assembly, so GCC might support it inline too? Read compiler docs.</div>
    <div class="meta">Posted on 2004-01-12 03:40:11 by f0dder</div>
   </div>
   <div class="post" id="post-130451">
    <div class="subject"><a href="#post-130451">compile to binary</a></div>
    <div class="body">i've just managed to enter the c-code from a fasm-init code; so what i'll do now is to write the initialisation-code (copy gdt, create idt, enter pm, create pagetable, enable paging) in fasm as i did it before too; then i'll enter the c-code with paging enabled at 0xF0000000 base.<br />since there's only one transfer from fasm to gcc it sould work then.<br />i'll need some time to accomplish this (since i have other things to do), but you'll hear me screaming if it works :tongue: (ok, i'll post the results here as well :))</div>
    <div class="meta">Posted on 2004-01-12 13:19:14 by hartyl</div>
   </div>
   <div class="post" id="post-130462">
    <div class="subject"><a href="#post-130462">compile to binary</a></div>
    <div class="body">Nice, I test the o file that you put, the error tht I get is the same that I say before, that is be a no specification of the assembler that the symbol start is global.... or if you prefer, there in the original file, dosent exist a mark that say the symbol is &quot;public&quot;.<br /><br />the error that I get from your kernel.o is the same that I obtain when I not add the line &quot;global start&quot; in the asm file.<br /><br />By the way, I attach the kernel.o assembled with nasm and that have added the line global start ld no giveme errors with this file.<br /><br /><br />Still working.<br /><br />Have a nice day or night.</div>
    <div class="meta">Posted on 2004-01-12 16:01:37 by rea</div>
   </div>
   <div class="post" id="post-130491">
    <div class="subject"><a href="#post-130491">compile to binary</a></div>
    <div class="body">hmmm, obviously the only difference between your file, <strong>hgb</strong> and mine is at adress 0x28; you have 0x05 there and i 0x04.<br />i've played around with a minimal-core and got the entry from fasm into gcc-code; i'm so glad - it works, somehow; i even can do classes which are built onto the stack. i hope i can relocate the gcc-part to 0xF0000000 (so that jloc makes it correct - once you understand jloc its so powerful)</div>
    <div class="meta">Posted on 2004-01-13 02:35:37 by hartyl</div>
   </div>
   <div class="post" id="post-130941">
    <div class="subject"><a href="#post-130941">compile to binary</a></div>
    <div class="body">well, a final word: i think it's done.<br /><br />i started recoding the whole kernel beginning with the memory management (which works now) and now go on with the main gui-functions. everything is in classes now (CMemory, CScreen), i don't know if its the perfect solution i've been searching for (the compiler has to push the adress of the class for every function...).<br />the solution was now to use fasm for the asm-initializing-stuff and <strong>one</strong> c-file compiled with gcc (two made incorrect offsets for all references of the second file...).<br />well, thanks for all replies; you brought me back to os-coding i paused half a year ago.</div>
    <div class="meta">Posted on 2004-01-18 03:36:37 by hartyl</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=16735&amp;page=1" style="">&laquo;</a><a href="../?id=16735&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="16735" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>