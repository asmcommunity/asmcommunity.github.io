<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>push/pop vs invoke - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13696" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=13696">push/pop vs invoke</a></p>
   <div class="post" id="post-106086">
    <div class="subject"><a href="#post-106086">push/pop vs invoke</a></div>
    <div class="body">I have this piece of code, how would I use push/pop on it? <br /><pre><code><br />INVOKE TranslateMessage, ADDR msg <br />INVOKE DispatchMessage, ADDR msg <br /></code></pre><br />I tried <br /><pre><code><br />push offset msg <br />call TranslateMessage <br /><br />push offset msg <br />call DispatchMessage <br /></code></pre><br />But I get 'error A2098: invalid operand for OFFSET' <br /><br />Also, is using push/pop faster then invoke? and how do I set the stack size.</div>
    <div class="meta">Posted on 2003-06-05 09:15:48 by KewLexX</div>
   </div>
   <div class="post" id="post-106089">
    <div class="subject"><a href="#post-106089">push/pop vs invoke</a></div>
    <div class="body">invoke makes use of pushes<br /><br /><pre><code>INVOKE TranslateMessage, ADDR msg </code></pre><br />becomes<br /><pre><code>lea eax,msg<br />push eax<br />call TranslateMessage<br /></code></pre><br />Your error is probably due to the fact that msg is a local variable.<br /><br />Define what you mean by stack size.<br />You can change stack size by <br />changing dword ptr fs:[4] and dword ptr fs:[8]</div>
    <div class="meta">Posted on 2003-06-05 09:38:09 by roticv</div>
   </div>
   <div class="post" id="post-106092">
    <div class="subject"><a href="#post-106092">push/pop vs invoke</a></div>
    <div class="body">KewLexX,<br /><br />You won't find it any more concise than the following.  Ratch<br /><br /><pre><code><br />				.686<br />				.MMX<br />				.K3D<br />				.XMM<br />				 .MODEL FLAT,STDCALL<br />				      option casemap &#58;none   ; case sensitive<br /><br /> = OFFSET			@ EQU OFFSET<br /><br />				 .LISTMACROALL<br />				; #########################################################################<br />				.NOLIST<br />				.LIST     <br />				      includelib \masm32\lib\user32.lib<br />				      includelib \masm32\lib\kernel32.lib<br />				      includelib \masm32\lib\gdi32.lib<br /><br /> 00000000			.DATA?<br /> 00000000			.DATA<br /> 00000000  00000004		 DD 4,5,6<br />	   00000005<br />	   00000006<br /> 0000000C 54 48 49 53 20	msg DB &quot;THIS IS A MESSAGE&quot;,0<br />	   49 53 20 41 20<br />	   4D 45 53 53 41<br />	   47 45 00<br /> 0000001E  07 08 09		 DB 7,8,9<br /> 00000000			.CODE<br />				 .LISTALL<br /> 00000000			START&#58;<br />				 INVOKE TranslateMessage,@ msg<br /> 00000000  68 0000000C R   *	    push   dword  ptr OFFSET FLAT&#58;msg<br /> 00000005  E8 00000000 E   *	    call   TranslateMessage<br />				 INVOKE DispatchMessage, @ msg<br /> 0000000A  68 0000000C R   *	    push   dword  ptr OFFSET FLAT&#58;msg<br /> 0000000F  E8 00000000 E   *	    call   DispatchMessageA<br />				 END START</code></pre></div>
    <div class="meta">Posted on 2003-06-05 10:20:07 by Ratch</div>
   </div>
   <div class="post" id="post-106097">
    <div class="subject"><a href="#post-106097">push/pop vs invoke</a></div>
    <div class="body">that was extrange for me....<br /><br />Ok, i need say that some guy near the computer close thereply that i was writing, then i will reply but a little less...<br /><pre><code><br />push dword&#91;esp+4&#93; ;valid, you are pushing the content&#40;value&#41; in the address esp+4<br />push dword esp+4 ;invalid, you are trying push the direction esp+4<br />push dword&#91;ebp+4&#93; ;VALID, you are pushing the content&#40;value&#41; in the addres ebp+4<br />push dword ebp+4 ;INVALID, pushing the address ebp+4<br />push eax+4 ;Invalid, yu are trying push eax+4 i later explain a little<br />lea eax, ebp+4 ;invalid, you are trying load in eax the efective address of ebp+4 &#40;that is other address&#41;<br />lea eax, &#91;ebp+4&#93; ; you are loading the effective address of ebp+4... &#40;i explain later&#41;<br />mov eax, &#91;ebp&#93; ;valid<br /></code></pre><br /><br /><br />First:<br /><br />The assembler any assembler can calculate some things and others cant, the thing that can calculate is the size of structures, the offset or displacement of a label in a section (.data, .code), you provide onlyothers constant values, like:<br /><br /> invoke aFunction, NULL, 23, &quot;hola Mundo&quot;<br /><br />in the case above, &quot;hola mundo&quot; is in the data section and the offset is pushed to the stack. NULL is 0, 23 is another constant, and aFunciton is too a constant, for example, ii you have:<br /><br /><pre><code><br />x dd 1<br />aFunction proc<br />endp<br />afunction have the value 4 &#91;i&#93;&#40;in the instruction pointer, <br />starting at 0, because at 0 are reserved 4 bytes&#41;&#91;/i&#93;<br /></code></pre><br />Like you see, the assembler can only manipulate values that can know his content, or the value, or the constant.<br />All the other values are calculated in the run-time. This values are addres maybe other things...<br /><br /><br /><br />for example.. maybe you now are questioning, the for what this:<pre><code><br />push dword&#91;esp+4&#93; </code></pre><br /><br />is valid and this<br /><pre><code><br />push dword esp+4 </code></pre><br /><br />no<br /><br />the answer is:<pre><code><br />push dword&#91;esp+4&#93; ; &#91;i&#93;you are only pushing the value at esp+4, <br />;that can only know in the run-time, but is the content&#91;/i&#93;.</code></pre><br /><br />push dword esp+4 , you are pushing the value of esp and a addition, like you see, you are pushing the direction pointed by esp+4 ;that cannot be know in the asemble time, but in the run-time too cannot be know.. why?, is for example esp can point to 2000, 300 or any other number, and you can push this value.. try..<br /><br />push esp<br /><br />now what append if you push esp+4, <em>you are saying that you want to push the address plus 4</em>, like you see no is the same that push dword in this case you are only saying that you want the value at that direction, in words, you only want one operation (get the value at that direction), but in push dword esp+4 you are saying that you whan push the address plus 4, <em>then in words is 2 instruction</em>, the push instruction can manipulate only one instruction.<br /><br />then, lea (load effective address) can load complex address, that can not be calculated in the assembly-time and that can not be calculated in run-time in one instruction like push esp.<br /><br />now, addr se firts if the var that you are working is local or is definied for example in the data section or other section.. this is can be calculated be the assembler, if is this, only is converted in push var, but if the var is a local variable, it do two operations:<br /><pre><code><br />lea eax, &#91;esp+4&#93;<br />push eax ;only one value<br /></code></pre><br />lea can be replaced, only for catch a little more what do lea..<br /><pre><code><br />mov eax, esp<br />add eax,4<br /></code></pre><br />like you see esp can have the addres 2000,3000, and you can add 4 (bytes) to this addres, and you have the direction 2004, now you can push easely this addres.. push eax, or push the content at that addres push dword<br /><br /><br />The code of Ratch work with offset (@) only for msg is definied in the data section of the file<br /><br /><br />I think that was a little large, but i hope this can help you.<br /><br />If I confuse you, or my english still to bad, let us know. :D<br /><br />Nice day.</div>
    <div class="meta">Posted on 2003-06-05 11:45:01 by rea</div>
   </div>
  </div>
 </body>
</html>