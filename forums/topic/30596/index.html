<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Any guidelines for converting from NASM to JWasm? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30596" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=30596">Any guidelines for converting from NASM to JWasm?</a></p>
   <div class="post" id="post-214598">
    <div class="subject"><a href="#post-214598">Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body">Hi guys. I know Frank hangs out here so I will say right up front I love NASM and the NASM guys and my question is not about not using NASM. Ok!<br /><br />I never used MASM and I am coding on Linux 32 bit for now. I prefer to work from listings instead of source and I saw JWasm has a more extensive listing than other Intel assemblers I have found. But I don&#039;t know MASM syntax and I don&#039;t know how to convert a simple NASM program to JWasm. The sample code on the JWasm site for Linux didn&#039;t help me because I have global and extern and I don&#039;t see them used in those samples. I did get my macros and structs converted but I didn&#039;t see how to create instances of a structure but I will keep going over the old MASM 6.1 doc and try to figure that out.<br /><br />Is there any discussion or doc/examples on the topic of converting NASM to JWasm or more comprehensive JWasm examples for Linux so I can see where I am going wrong?<br /></div>
    <div class="meta">Posted on 2011-07-13 05:06:03 by JoeCoder</div>
   </div>
   <div class="post" id="post-214619">
    <div class="subject"><a href="#post-214619">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body">Hi Joe,<br /><br />No replies, eh? Why don&#039;t you show us what you&#039;ve tried, and what Jwasm has to say about it, and that may enable Masm users to help? My experience has mostly been Masm-&gt;Nasm, and mostly long ago, but maybe I can &quot;reverse the process&quot;...<br /><br />Of what you mention, &quot;global&quot;-&gt;&quot;public&quot;, and &quot;extern&quot; may be spelled &quot;extrn&quot;. I imagine they&#039;re used the same way - &quot;public&quot; for something that exists in this file, and needs to be made known to the linker, and &quot;extrn&quot;(?) for something that&#039;s used in this file, and we need the linker to go find it for us.<br /><br />I don&#039;t recall the syntax for defining a structure, but if you&#039;ve got that, I believe we initialize a structure with a comma delimited list of numbers (symbols/expressions) between angle brackets, something like...<br /><br /><pre><code><br />my_instance my_structure &lt;1, 3, 5, offset my_func, foo+bar&gt;<br /></code></pre><br /><br />Might need to reverse &quot;instance&quot; name and structure name. See which one Jwasm doesn&#039;t barf on.<br /><br />I think the most trouble I&#039;d have is figuring out where to put &quot;offset&quot; and where not. Remember in Nasm syntax, just &quot;myvar&quot; is the address/offset, and &quot;&quot; is the contents. In Jwasm syntax, you need &quot;offset&quot;, the unadorned &quot;myvar&quot; means contents! (if it&#039;s a variable - otherwise sometimes not!) Leaving the square brackets in from your Nasm code shouldn&#039;t hurt, even where Jwasm doesn&#039;t need &#039;em. You may need a &quot;byte(word/dword) ptr&quot; in some places. Since Jwasm &quot;remembers&quot; that you said &quot;myvar&quot; was db/dw/dd, where Nasm doesn&#039;t, I think you can get away without many &quot;dword ptr&quot;s. Masm programmers used to use a lot of &#039;em, and seemed to prefer uppercase, but I think Jwasm can hear you without having to &quot;shout&quot;. :)<br /><br />Something I noticed with (some versions) of Masm...<br /><br /><pre><code><br />mov cl, byte ptr [81h]<br /></code></pre><br /><br />insisted on generating the &quot;immediate&quot;:<br /><br /><pre><code><br />mov cl, 81h<br /></code></pre><br /><br />The trick was:<br /><br /><pre><code><br />mov cl, ds:[81h]<br /></code></pre><br /><br />The &quot;ds&quot; prefix doesn&#039;t appear in the code, but is/was apparently a necessary part of the syntax. If you told Nasm, &quot;ds&quot; (would have to be inside the square brackets), you&#039;d get the (probably redundant) &quot;ds&quot; prefix! I doubt if you&#039;ll run into that one.<br /><br />That&#039;s about all I can think of... try posting examples (Nasm syntax or even pseudocode) of what you&#039;re trying to do, and what Jwasm thinks of &#039;em. I&#039;ll bet if you could come up with a decently-commented example for Linux, fairly simple, but using macros and/or structures, Japheth might include it in his package. I&#039;m guessing he&#039;d welcome more examples.<br /><br />(for those who don&#039;t know Joe, he&#039;s a &quot;newbie&quot; to x86 and our quaint operating systems, but has considerable experience on others, so you don&#039;t have to be too &quot;gentle&quot; on him)<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2011-07-15 23:43:45 by fbkotler</div>
   </div>
   <div class="post" id="post-214626">
    <div class="subject"><a href="#post-214626">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body">JWASM has some problems in its ELF backend which make it not viable as a crossplatform option - see NASMX !!!<br />To qualify that - I notified Japheth a couple of years ago about this and he has done nothing about it... in fact at the time he suggested that until he was hassled enough it was not a priority - evidently so.<br /></div>
    <div class="meta">Posted on 2011-07-17 09:30:09 by Homer</div>
   </div>
   <div class="post" id="post-214628">
    <div class="subject"><a href="#post-214628">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body">What issues are you having with Jwasm&#039;s ELF back end, Homer? I&#039;ve used it very little (as you know, I&#039;m a &quot;devout Nasmist&quot;) but it &quot;seemed to work&quot;...<br /><br />Looking at it from the other end, what do you like about Jwasm&#039;s &quot;listings&quot; that you don&#039;t get from Nasm, Joe?<br /><br />There must be some way to work this out...<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2011-07-17 12:30:50 by fbkotler</div>
   </div>
   <div class="post" id="post-214630">
    <div class="subject"><a href="#post-214630">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body"><div class="quote"><br />What issues are you having with Jwasm&#039;s ELF back end, Homer?<br /></div><br /><br />Generally broken, as I <a target="_blank" href="http://developers.slashdot.org/submission/1161120/Introducing-JWASM---MASMs-unofficial-successor">reported</a> quite some time ago.</div>
    <div class="meta">Posted on 2011-07-17 13:00:51 by SpooK</div>
   </div>
   <div class="post" id="post-214631">
    <div class="subject"><a href="#post-214631">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body">I see mostly &quot;Wikipedia wars&quot; there. Are you speaking of the fact that Jwasm&#039;s ELF output won&#039;t convert to Mach-o? Could be true - I&#039;m not able to test MacOS, nor 64-bit output. Seems a little unfair to say that an assembler is &quot;broken&quot; without saying what&#039;s wrong with it. I may have to obtain the latest version and cook up some examples to try (painful, as I personally consider the syntax &quot;horrid&quot;, but some people like it). It would be easier if I knew what I was lookin&#039; for...<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2011-07-17 13:40:39 by fbkotler</div>
   </div>
   <div class="post" id="post-214632">
    <div class="subject"><a href="#post-214632">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body"><div class="quote"><br />Are you speaking of the fact that Jwasm&#039;s ELF output won&#039;t convert to Mach-o? Could be true - I&#039;m not able to test MacOS, nor 64-bit output. Seems a little unfair to say that an assembler is &quot;broken&quot; without saying what&#039;s wrong with it.<br /></div><br /><br />I do note that it seemingly works fine under Windows.<br /><br />OBJCONV is fairly robust... there has to be something pretty jacked-up for it to fail on conversion of a simple &quot;Hello, World!&quot; app.<br /><br />In shorter words, it <em>is</em> broken... as far as cross-platform support is concerned. With respect to what Homer said, it sounds like that is still the case.<br /><br /><div class="quote"><br />I may have to obtain the latest version and cook up some examples to try (painful, as I personally consider the syntax &quot;horrid&quot;, but some people like it). It would be easier if I knew what I was lookin&#039; for...<br /></div><br /><br />Yes, please do independent review... perhaps you can find the root of the cause and suggest a patch/fix!</div>
    <div class="meta">Posted on 2011-07-17 14:34:47 by SpooK</div>
   </div>
   <div class="post" id="post-214633">
    <div class="subject"><a href="#post-214633">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body">Okay. Unlikely I&#039;ll be able to create a patch, but maybe can narrow down where to look. I visited the JWasm board at SF (it butchered my post, as usual) and put in a link back to here asking for help, and grabbed the latest version while I was there. Haven&#039;t tried to build/install it yet.<br /><br />While I am highly impressed with &quot;objcopy&quot;, it doesn&#039;t like some of &quot;my&quot; files either, so I might not consider that a show-stopper. I&#039;ll see what I see, if/when I get around to it...<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2011-07-17 15:46:01 by fbkotler</div>
   </div>
   <div class="post" id="post-214634">
    <div class="subject"><a href="#post-214634">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body"><div class="quote"><br />Okay. Unlikely I&#039;ll be able to create a patch, but maybe can narrow down where to look.<br /></div><br /><br />-JWasm Windows Binary: ELF works fine<br />-JWasm Windows from Source via OW19: ELF works fine<br />-JWasm Windows from Source via PellesC: ELF works fine<br />-JWasm Windows from Source via MinGW (GCC 3.4.5): ELF works fine<br />-JWasm Linux Binary: ELF works fine<br />-JWasm Linux from Source via OW20b: ELF works fine<br />-JWasm Linux from Source via GCC (4.5.2): ELF is broken<br />-JWasm Mac from Source via XCode (GCC 4.2.1): ELF is broken<br /><br />Looks like the use of  GCC to build JWasm is the root of the issues I have experienced.<br /><br />The example I&#039;ve used is quite simple, just syscall/print and syscall/exit, so saying &quot;<em>ELF works fine</em>&quot; above is only relevant in that context. </div>
    <div class="meta">Posted on 2011-07-17 20:02:05 by SpooK</div>
   </div>
   <div class="post" id="post-214637">
    <div class="subject"><a href="#post-214637">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body">Wow, you&#039;ve done some research on this thing!<br /><br />As a WAG, without even looking at the code: uninitialized variables. We ran into something similar with Nasm, some time back - Chuck&#039;s build worked, mine did not (bogus addresses, IIRC). Initializing some variables fixed it.<br /><br />Compiling JWasm 2.06 with gcc (linux) 4.2.1, gcc produced only one warning. Adding the &quot;-Wall&quot; switch in the makefile generated a whole pantload of &#039;em - &quot;err.log&quot; runs almost 460k! No way I&#039;m going to try to fix all that!<br /><br />The resulting jwasm seemed to &quot;work okay&quot;... but I couldn&#039;t get it to emit any listing file at all! Jwasm didn&#039;t complain about &quot;-Fl=linux2.lst&quot;, but didn&#039;t create the file. Adding various &quot;-S&quot; switches didn&#039;t help.<br /><br />I stand corrected. You guys are right, JWasm is not currently suitable for cross-platform work. Joe, maybe try Yasm and see if you like its list file better.<br /><br />Sorry I mentioned it.<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2011-07-18 01:15:49 by fbkotler</div>
   </div>
   <div class="post" id="post-214639">
    <div class="subject"><a href="#post-214639">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body"><div class="quote"><br />Hi Joe,<br /><br />No replies, eh? Why don&#039;t you show us what you&#039;ve tried, and what Jwasm has to say about it, and that may enable Masm users to help? My experience has mostly been Masm-&gt;Nasm, and mostly long ago, but maybe I can &quot;reverse the process&quot;...&quot;</div><br /><br />Hi Frank,<br /><br />Sorry I didn&#039;t come back to this very fast, I was on the road for a few days and was pretty busy. Actually I am getting over the humps one by one when I have a few minutes to work on it. I believe I have the structure stuff converted over (minimal, once you know how!). My main areas in my small example are I don&#039;t know they do .bss (obviously not critical but nice to have) and the instruction syntax is different so stuff like mov byte or mov word gives me error messages. I&#039;m sure I&#039;ll figure it out if I spend enough time on it. The NASM 6.1 programmer&#039;s manual and reference do help but some JWasm specific doc would have been even better. I didn&#039;t &quot;resolve&quot; (hah, pun intended) the extern and global issues but I can probably get it from the doc when I pay attention. Thanks for all your comments and help, as usual!<br /><br /><br /><div class="quote">That&#039;s about all I can think of... try posting examples (Nasm syntax or even pseudocode) of what you&#039;re trying to do, and what Jwasm thinks of &#039;em. I&#039;ll bet if you could come up with a decently-commented example for Linux, fairly simple, but using macros and/or structures, Japheth might include it in his package. I&#039;m guessing he&#039;d welcome more examples.</div><br /><br />I have a hard time believing anything I do on x86 is going to be &quot;example worthy&quot; for another decade or so but a conversion guide would be helpful. You know alot of these projects are more about letting people who were already using/liking something (Watcom assembler in this case) continue using it on Windows/Linux etc more than they are about advocating so the people who already used it know what to do. Anybody coming to it new who didn&#039;t use MASM will find NASM, FASM, etc easier because of the great support and doc. JWasm seems to be relying on MASM doc which might be ok on Windows but isn&#039;t exactly relevant on Linux.<br /></div>
    <div class="meta">Posted on 2011-07-18 05:44:37 by JoeCoder</div>
   </div>
   <div class="post" id="post-214640">
    <div class="subject"><a href="#post-214640">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body">Thanks Homer and Spook for the help, nice to meet you guys. I am not interested in &quot;cross platform&quot; as in wanting to be able to use the same source on more than one platform (I&#039;m not against it of course but have no particular need for it) but if &quot;cross platform&quot; means JWasm doesn&#039;t work except on Windows then &quot;Houston, we have a problem!&quot;&nbsp; I&#039;ll take Frank&#039;s advice and look at YASM. I didn&#039;t think it would be any different from NASM as far as the listings go. I&#039;m satisifed NASM seems to be the best general purpose multiplatform x86 assembler according to what I&#039;ve read, and the support can&#039;t be beat and the doc is quite good. I like FASM because it&#039;s so fast and written in assembly. That makes you go &quot;yeah!&quot; when you realize it. The support is also great, there are a few guys who have been around along time and know how to get stuff working with FASM. The only thing &quot;lacking&quot; is just from my point of view since I work from listings and rely on them heavily but from what I have seen people on Intel are working almost exclusively from source and disassembly.</div>
    <div class="meta">Posted on 2011-07-18 05:52:15 by JoeCoder</div>
   </div>
   <div class="post" id="post-214641">
    <div class="subject"><a href="#post-214641">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body"><div class="quote"><br />Thanks Homer and Spook for the help, nice to meet you guys.<br /></div><br /><br />You know me from the NASM forum by my real name ;)<br /><br /><div class="quote"><br />I am not interested in &quot;cross platform&quot; as in wanting to be able to use the same source on more than one platform (I&#039;m not against it of course but have no particular need for it) but if &quot;cross platform&quot; means JWasm doesn&#039;t work except on Windows then &quot;Houston, we have a problem!&quot;<br /></div><br /><br />If you continue to use the precompiled JWasm binaries, you should be mostly OK.</div>
    <div class="meta">Posted on 2011-07-18 08:56:24 by SpooK</div>
   </div>
   <div class="post" id="post-214645">
    <div class="subject"><a href="#post-214645">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body"><div class="quote"><br />As a WAG, without even looking at the code: uninitialized variables.<br /></div><br /><br />That would be my initial assumption as well, as comparisons of the object dumps suggest a lot of garbled/junk data is being after/between relevant portions of the ELF structure(s) when using the GCC compiled version.</div>
    <div class="meta">Posted on 2011-07-18 22:15:01 by SpooK</div>
   </div>
   <div class="post" id="post-214753">
    <div class="subject"><a href="#post-214753">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body"><div class="quote"><br />You know me from the NASM forum by my real name ;)</div><br /><br />Well then Hello! Whoever you are ;-)<br /><br />and thanks for the help!</div>
    <div class="meta">Posted on 2011-07-28 05:05:41 by JoeCoder</div>
   </div>
   <div class="post" id="post-214768">
    <div class="subject"><a href="#post-214768">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body">I haven&#039;t talked to Japheth in a fairly long time, and to be honest I can&#039;t exactly remember what it was that is messed up with the ELF output format. I vaguely remember it having to do with his &quot;minimal implementation&quot; of the ELF format and creation of archive files. This was brought up when I was trying to help Homer &amp; Biterider port OA32 to JWASM/Linux. However, this has really been a few years ago and I&#039;ve noticed JWASM does support a lot more (from the demos) since then, so Japheth may have already fixed it. I&#039;ll download a copy later and see if I can&#039;t try a few build tests to see if I can refresh myself on what limitations (if any) it has.<br /><br />Frank:<br />Btw, you&#039;re probably more likely to get a response from Japheth if you send him an email (should be available on his site). He was always really prompt when I emailed him.<br /></div>
    <div class="meta">Posted on 2011-07-29 23:28:00 by Synfire</div>
   </div>
   <div class="post" id="post-214770">
    <div class="subject"><a href="#post-214770">Re: Any guidelines for converting from NASM to JWasm?</a></div>
    <div class="body">Hi Bryant,<br /><br />Actually, JWasm works fine for me on Linux, except that I can&#039;t get a &quot;list&quot; file out of it (which was Joe&#039;s entire purpose for trying JWasm, as I understand it). Apparently &quot;some&quot; builds of JWasm compiled with &quot;some&quot; versions of GCC give screwed up ELF output. The &quot;workaround&quot; is just don&#039;t use those builds! OpenWatcom C will probably compile a working version - haven&#039;t tried it...<br /><br />A higher priority for me is to get back to that &quot;libxcb&quot; issue that you tried to help me with! :)<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2011-07-30 08:25:52 by fbkotler</div>
   </div>
  </div>
 </body>
</html>