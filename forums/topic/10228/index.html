<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Self Extracting Archive - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10228" />
    <link rel="next" href="../?id=10228&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=10228">Self Extracting Archive</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=10228&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=10228&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="10228" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=10228&amp;page=2">&gt;</a><a href="../?id=10228&amp;page=2">&raquo;</a></form>   <div class="post" id="post-76736">
    <div class="subject"><a href="#post-76736">Self Extracting Archive</a></div>
    <div class="body">Hi,<br /><br />attachment below is an example of creating a self extracting archive.<br /><br />This one was coded using FASM. Uses .rar decompression.<br /><br />Here's an overview how this works:<br /><br />1. execute sfx.exe<br />2. unpack unrar.dll<br />3. unpack sfx.rar<br />4. extract sfx.rar<br />5. delete sfx.rar<br /><br />you can get your copy of the library here: <a target="_blank" href="http://www.rarlabs.com/rar_add.htm">http://www.rarlabs.com/rar_add.htm</a> UnRARDLL.exe - also includes examples for C, VB and Delphi<br /><br />What's good about this, is that you can create your own custom installer. You will have full control over everything what the installer does.<br /><br />Good Luck! :alright:<br /><br /><br /><br /><br />tested on win2k... rename to .exe ... I'll test this on win98 later...<br /><br />and also when you see this line <strong>include '\dev\include\fasm\windows.inc'</strong> - you can get this include at the FASM forum... what I did here is: I joined all the includes(dtypes.inc, equates.inc...) to one file (windows.inc), so don't be surprised if you don't see the windows.inc<br /><br />change the path btw!... :grin:</div>
    <div class="meta">Posted on 2003-01-16 16:55:31 by arkane</div>
   </div>
   <div class="post" id="post-76743">
    <div class="subject"><a href="#post-76743">Self Extracting Archive</a></div>
    <div class="body">what's really bad about this is... you have to include unrar.dll everytime... anyway, I'll create another sample without the use of dll's later... if I can find some &quot;info&quot;... :grin:<br /><br />you can still use the code to create your own .rar decompression program. :grin:</div>
    <div class="meta">Posted on 2003-01-16 17:53:28 by arkane</div>
   </div>
   <div class="post" id="post-76749">
    <div class="subject"><a href="#post-76749">Self Extracting Archive</a></div>
    <div class="body"><strong>Nice to see some front-ends for unrar</strong>. :alright: But as far as an installation<br />system goes, im pretty satisfied with the one from Nullsoft.<br /><a target="_blank" href="http://www.nullsoft.com/free/nsis/">http://www.nullsoft.com/free/nsis/</a>  Its free and let you script<br />and define alot(looks good to). The installer doesnt support rar <br />tho! but it use zlib/bzip2 compression. For me that is sufficent<br />enough.</div>
    <div class="meta">Posted on 2003-01-16 18:41:11 by natas</div>
   </div>
   <div class="post" id="post-76752">
    <div class="subject"><a href="#post-76752">Self Extracting Archive</a></div>
    <div class="body">actually, I have a lot of free installers plus I have a wise installer pro but I hate it when you can't control everything from the coding of the .exe up to the design of the installer.<br /><br />these installers are HLL to me. No offense to HLL coders, because I too code in HLL but sometimes you just don't feel safe with those &quot;other&quot; installers. ;)<br /><br />ideas: Custom-windows, custom-buttons... even installers with DirectX or OpenGL intros... :alright:<br /><br />anyway, I'm happy with visual studio installer for small installations...<br /><br /><br />p.s.: I hate installers personally... I think they are installing files I don't know and modifying the registry without consulting me :grin: ... the good 'ol .zip or .rar is still the best IMO. :alright:</div>
    <div class="meta">Posted on 2003-01-16 18:48:01 by arkane</div>
   </div>
   <div class="post" id="post-76818">
    <div class="subject"><a href="#post-76818">Self Extracting Archive</a></div>
    <div class="body">eeek, extracting archives and DLLs and... uff. Include decompression library statically in your app (there's free unrar source code out there that doesn't require DLLs), and extract .rar archive directly from your exe. There's no point in doing something in assembly if you don't do it better...</div>
    <div class="meta">Posted on 2003-01-17 02:36:45 by f0dder</div>
   </div>
   <div class="post" id="post-76821">
    <div class="subject"><a href="#post-76821">Self Extracting Archive</a></div>
    <div class="body">Hi Arkane,<br />I like it also the rar file format.<br />I was used to modify the resources of the rar.sfx modules and give the commands on the archive comments:<br /><span style="font-size:12px><pre><code><br />MAIN<br />&#123;<br />  SetPath &quot;%%PProggy&quot;<br />  Dialog SETUP<br />  Exit<br />&#125;<br /><br />SETUP&#58;INIT<br />&#123;<br />  SetText $0,&quot;Proggy Setup&quot;<br />  SetText $101,&quot;&amp;Read First&quot;<br />  SetText $102,&quot;&amp;Install&quot;<br />  SetText $103,&quot;&amp;Cancel&quot;<br />  SetText $104,&quot;Bro&amp;wse&quot;<br />  SetText $300,&quot;%%D&quot;<br />  SetText $202,&quot;&amp;Folder to install&quot;<br />  SetFont $200,&quot;MS Sans Serif&quot;,12,&quot;B&quot;<br />  &#125;<br />&#125;<br /></code></pre> </span> <br /><br />But having the full control over it is better and will also useful as *own* file format. The main drawback of this is that the decompression is in the public domain but the compression is still propietary (I wonder if RarSoft will change this in the future, maybe this will help in the difussion of rar).<br /><br />Regards,</div>
    <div class="meta">Posted on 2003-01-17 03:03:40 by pelaillo</div>
   </div>
   <div class="post" id="post-76829">
    <div class="subject"><a href="#post-76829">Self Extracting Archive</a></div>
    <div class="body">How can I get a static library for unrar?<br /><br />Regards,<br /><br />Vortex</div>
    <div class="meta">Posted on 2003-01-17 04:27:28 by Vortex</div>
   </div>
   <div class="post" id="post-76844">
    <div class="subject"><a href="#post-76844">Self Extracting Archive</a></div>
    <div class="body">try googling. &quot;unrar library&quot;, for instance.</div>
    <div class="meta">Posted on 2003-01-17 07:41:11 by f0dder</div>
   </div>
   <div class="post" id="post-76860">
    <div class="subject"><a href="#post-76860">Self Extracting Archive</a></div>
    <div class="body">f0dder:<div class="quote">eeek, extracting archives and DLLs and... uff. Include decompression library statically in your app (there's free unrar source code out there that doesn't require DLLs), and extract .rar archive directly from your exe. There's no point in doing something in assembly if you don't do it better...</div>yes I know there is one it's called Unique Rar Lib, this has been used on the demo scene but it only supports winrar 2.x not 3.x which I'm currently using.<br /><br />Anyway, I'll try to downgrade to 2.x - not a big deal. :tongue: An exampe wouldn't hurt. :grin:<br /><br /><br />pelaillo:<div class="quote">But having the full control over it is better and will also useful as *own* file format. The main drawback of this is that the decompression is in the public domain but the compression is still propietary (I wonder if RarSoft will change this in the future, maybe this will help in the difussion of rar).</div>I hope it will change. :alright:<br /><br /><br /><br /><br />btw I think there is some source code on rar labs... I'll check it out but I have not time to go through all the source code since it has a dozens of files.</div>
    <div class="meta">Posted on 2003-01-17 10:14:34 by arkane</div>
   </div>
   <div class="post" id="post-76884">
    <div class="subject"><a href="#post-76884">Self Extracting Archive</a></div>
    <div class="body">Arkane,<br /><br />you can try the static library from:<br /><br /><a target="_blank" href="http://www.unrarlib.org/download.html">http://www.unrarlib.org/download.html</a><br /><br />Regards,<br /><br />Vortex</div>
    <div class="meta">Posted on 2003-01-17 12:12:14 by Vortex</div>
   </div>
   <div class="post" id="post-76889">
    <div class="subject"><a href="#post-76889">Self Extracting Archive</a></div>
    <div class="body">that library requires me to downgrade... to 2.x from 3.x :)<br /><br />anyway, I'm using .zip on the next example, there are more info on zip format than .rar. :grin:<br /><br />I'm having second thoughts on downgrading. :grin:<br /><br />I'll probably change to PPMD if free time allows me. :grin:</div>
    <div class="meta">Posted on 2003-01-17 13:01:24 by arkane</div>
   </div>
   <div class="post" id="post-76970">
    <div class="subject"><a href="#post-76970">Self Extracting Archive</a></div>
    <div class="body">Arkane,<br /><br />That library is suitable for practical works.<br />Sometimes,we are not forced to use the latest technology. :)<br /><br />Regards,<br /><br />Vortex</div>
    <div class="meta">Posted on 2003-01-18 04:25:36 by Vortex</div>
   </div>
   <div class="post" id="post-76974">
    <div class="subject"><a href="#post-76974">Self Extracting Archive</a></div>
    <div class="body">doesn't the source at rarlabs.com work with rar3 archives? Also, don't even consider going zip - nonsolid compression, ick!</div>
    <div class="meta">Posted on 2003-01-18 04:37:16 by f0dder</div>
   </div>
   <div class="post" id="post-77031">
    <div class="subject"><a href="#post-77031">Self Extracting Archive</a></div>
    <div class="body"><div class="quote">That library is suitable for practical works.<br />Sometimes,we are not forced to use the latest technology.</div>ok! ok! I'll downgrade but I'll try it later cause I have other things to do. :grin:<div class="quote">doesn't the source at rarlabs.com work with rar3 archives? Also, don't even consider going zip - nonsolid compression, ick!</div>yes it works on rar3 - I still haven't checked the source code, I'll create a static library for it later.<br /><br />I'll try the rarlabs source first but if I'm not &quot;elite enough&quot; :grin: to correct the codes to compile then I think I'll consider downgrading then use rar 2.x.  + unrarlib :grin:</div>
    <div class="meta">Posted on 2003-01-18 11:04:38 by arkane</div>
   </div>
   <div class="post" id="post-77051">
    <div class="subject"><a href="#post-77051">Self Extracting Archive</a></div>
    <div class="body">Good luck Arkane! :)<br />:alright: <br /><br />Regards,<br /><br />Vortex</div>
    <div class="meta">Posted on 2003-01-18 14:38:38 by Vortex</div>
   </div>
   <div class="post" id="post-77076">
    <div class="subject"><a href="#post-77076">fasm-code to masm-code</a></div>
    <div class="body">In the example of arkane he coded the following<br /><br />icldata FILE &quot;sfx.rar&quot;<br /><br />and<br /><br />dlldata FILE &quot;unrar.dll&quot;<br /><br />So, what I am searching for is the command that I have to use in MASM instead of FILE what is used in FASM only, I think. Because the FILE command doesn't seem to work with MASM.<br /><br />thanx ChigpA</div>
    <div class="meta">Posted on 2003-01-18 17:49:37 by ChigpA</div>
   </div>
   <div class="post" id="post-77081">
    <div class="subject"><a href="#post-77081">Self Extracting Archive</a></div>
    <div class="body">You need bin2asm.exe - try searching google.<br /><br />Binary 2 ASM Converter v1.00 (32bit) by : Peter Quiring<br />BIN2ASM &lt;binary_filename&gt; &lt;asm_filename&gt; &lt;label&gt;<br /><br />bin2asm produces an include file.<br /><br />edit the include file like this<pre><code>rardata_start&#58;<br /> db 052h,061h, ...<br /> ...<br /> db 019h,01eh, ...<br />rardata_end&#58;</code></pre>remove the .data directive if you plan to include the 'include' on the code section if not then probably using the 'label' directive will allow you to create labels on the data section - haven't tried using 'label'<pre><code>&#91;size=9&#93;;ml /c /coff sfx.asm<br />;link /section&#58;.text,rwe /subsystem&#58;windows sfx.obj<br /><br />.686<br />.MODEL FLAT, STDCALL<br />OPTION CASEMAP&#58;NONE<br /><br />INCLUDE \dev\include\masm\windows.inc<br />INCLUDE \dev\include\masm\kernel32.inc<br />INCLUDELIB \dev\lib\masm\kernel32.lib<br />INCLUDE \dev\include\masm\user32.inc<br />INCLUDELIB \dev\lib\masm\user32.lib<br />    <br />.CODE<br /><br />    ;=========================<br />    ;main application<br />    ;=========================<br /><br />    msgcaption      DB &quot;sfx&quot;,0<br />    msgboxtext      DB &quot;Do you want to extract the file/s?&quot;,0<br />    bytewritten     DD ?<br />    <br />    ;=========================<br />    ;.rar details<br />    ;=========================<br />    <br />    rarout          DB &quot;unrar_o.rar&quot;, 0<br />    INCLUDE unrar.asm<br />    <br />start&#58;<br /><br />    invoke  MessageBox, NULL, OFFSET msgboxtext, OFFSET msgcaption, MB_YESNO or MB_ICONQUESTION<br />    cmp     eax, IDNO<br />    je      exit<br />    <br />    ;=========================<br />    ;unpack .rar<br />    ;=========================<br />    <br />    invoke  CreateFile, OFFSET rarout, GENERIC_WRITE, 0, NULL, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL<br />    push    eax<br />    invoke  WriteFile, eax, rardata_start, &#40;rardata_end - rardata_start&#41;, OFFSET bytewritten, NULL <br />    call    CloseHandle<br />    <br />    ;=========================<br />    ;extract .rar<br />    ;=========================<br />    <br />exit&#58;<br />    <br />    invoke  ExitProcess, NULL<br /><br />END start&#91;/size&#93;</code></pre>Unrar.asm is the output created by bin2asm.<br /><br />You know, I'm thinking of rewriting the rar library in assembly cause this is going nowhere. :grin:<br /><br />The source code for unrar is so convoluted. I tried &quot;dll to lib&quot; but this softwares requires me to pay $99 and the static lib produced by the unregistered version :grin: includes an annoying message box everytime the app runs.<br /><br />Anyway, I think converting to asm is fun :grin: plus I can add optimizations (I guess) :grin:</div>
    <div class="meta">Posted on 2003-01-18 18:24:57 by arkane</div>
   </div>
   <div class="post" id="post-77085">
    <div class="subject"><a href="#post-77085">Self Extracting Archive</a></div>
    <div class="body">7zip code is open source, and has better encryption algorithms.</div>
    <div class="meta">Posted on 2003-01-18 19:10:26 by JCP</div>
   </div>
   <div class="post" id="post-77184">
    <div class="subject"><a href="#post-77184">Self Extracting Archive</a></div>
    <div class="body">use my nifty bin2o instead of bin2inc :). fun to see somebody mention Peter Quiring, btw. I had a great time with qlib.<br /><br />dll2lib is rather bugged. Ok, it's not _the_ easiest task to convert dll to lib, but still. I wouldn't register it.<br /><br />Nice to see that they at least chose LGPL instead of the atrocious GPL.</div>
    <div class="meta">Posted on 2003-01-19 09:59:09 by f0dder</div>
   </div>
   <div class="post" id="post-77303">
    <div class="subject"><a href="#post-77303">Self Extracting Archive</a></div>
    <div class="body">Here is a an example of Self Extracting Archive.<br />The compression software belongs to Jeremy Collake.<br />Compared to zip,the JC routines provides better compression.<br /><br /><pre><code><br /><br />.386<br />.model flat,stdcall<br />option casemap&#58;none<br /><br />extractfile PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD<br />JCALG1_Decompress_Fast PROTO &#58;DWORD, &#58;DWORD<br />JCALG1_GetUncompressedSizeOfCompressedBlock PROTO &#58;DWORD<br /><br />include         \masm32\include\windows.inc<br />include         \masm32\include\user32.inc<br />include         \masm32\include\kernel32.inc<br />includelib      \masm32\lib\user32.lib<br />includelib      \masm32\lib\kernel32.lib<br />.data<br />savefile        db 'Graph.exe',0<br />include         graph.inc<br /><br />.data?<br />fh               dd ?<br />hMem         dd ?<br />fSize           dd ?<br /><br />.code<br />start&#58;<br />invoke  JCALG1_GetUncompressedSizeOfCompressedBlock,addr graph<br />mov     fSize,eax<br />invoke 	GlobalAlloc,GMEM_FIXED,eax<br />mov     hMem,eax<br /><br />invoke  JCALG1_Decompress_Fast,addr graph,eax<br />invoke  extractfile,addr savefile,hMem,fSize<br />invoke  GlobalFree,hMem<br /><br />invoke  ExitProcess,0<br /><br /><br />extractfile PROC filename&#58;dword,fileloc&#58;dword,filelen&#58;dword<br /><br />LOCAL   fHandle&#58;dword<br />invoke _lcreat,filename,0<br />mov     fHandle,eax<br />invoke _lwrite,fHandle,fileloc,filelen   <br />invoke _lclose,fHandle<br />ret<br /><br />extractfile ENDP<br /><br />end start<br /><br /></code></pre></div>
    <div class="meta">Posted on 2003-01-20 02:42:32 by Vortex</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=10228&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=10228&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="10228" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=10228&amp;page=2">&gt;</a><a href="../?id=10228&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>