<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>a wierd question - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=397" />
  <link rel="prev" href="../?id=397&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=397">a wierd question</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=397&amp;page=1" style="">&laquo;</a><a href="../?id=397&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="397" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-2479">
    <div class="subject"><a href="#post-2479">a wierd question</a></div>
    <div class="body">Maybe Vecna can give you a better definition..but afaik the delta offset is the following:<br /><br />When your code will be injected in binaries which are unknown to you (ie if you are coding a virii) ,you cannot know which will be the virtual address where your variables and labels will fall.<br /><br />So you need to calculate the addresses at runtime using the 'delta offset trick'<br /><br />-------------------------snip---------------------------------------<br />CALL DeltaHandle<br />DeltaHandle:<br />POP EBP<br />SUB EBP,OFFSET DeltaHandle<br /><br />JMP CodeStart<br /><br />CryptedSize			DWORD	34H	EntryPoint			DWORD	1000H	<br />ImageBase			DWORD	400000H	<br /><br />CodeStart:<br /><br />MOV EAX,<br />XOR EAX,45H<br />BLAH , BLAH<br /><br />-------------------------snip---------------------------------------<br /><br />Now EBP holds the address of the beginning of your injected code. To achieve this a call is done to a label and then the return address is popped of the stack and placed in EBP.<br />Then we skip the variables definition (data inside code, does it ring a bell dear board members? :) ) and proceed to execute the instructions. Since EBP holds the address of the BEGINNING of your injected code,you can know the virtual address of your variables adding the contents of EBP to the relative offset of your variables.<br />I have coded a couple of programs of mine using this technique. If you want them i can send them to you.<br />I hope i was clear :)<br /><br />Cheers<br /><br />Latigo</div>
    <div class="meta">Posted on 2001-07-30 11:43:57 by latigo</div>
   </div>
   <div class="post" id="post-2480">
    <div class="subject"><a href="#post-2480">a wierd question</a></div>
    <div class="body">thanks, that was fine</div>
    <div class="meta">Posted on 2001-07-30 11:46:14 by SubHuman</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=397&amp;page=1" style="">&laquo;</a><a href="../?id=397&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="397" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>