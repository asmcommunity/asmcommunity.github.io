<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Segmentation fault??? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=28959" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=28959">Segmentation fault???</a></p>
   <div class="post" id="post-204759">
    <div class="subject"><a href="#post-204759">Segmentation fault???</a></div>
    <div class="body">I&#039;m trying to copy a string to another and I receive the message &quot;Segmentation fault&quot;<br /><br />I did this code following indications from my teacher but causes me the error &quot;Segmentation fault&quot;<br />Can you help me, please?<br /><br />I have a string that I do not know the length, and I have to copy it to another variable:<br /><pre><code><br />		mov		eax, dinamicString	<br />		mov		,eax<br /><br />		mov		esi, dinamicString<br />		mov		edi, destinationString<br />		mov		ecx, stringlenght<br /><br />		ciclo:<br />			lodsb<br />			stosb<br />		loopnz ciclo<br /></code></pre></div>
    <div class="meta">Posted on 2008-02-10 00:33:55 by nmpsantos</div>
   </div>
   <div class="post" id="post-204761">
    <div class="subject"><a href="#post-204761">Re: Segmentation fault???</a></div>
    <div class="body">I just wrote this function for you. Take a close look at the instructions and post back if you have problems understanding them.<br /><br /><pre><code>; ——————————————————————————————————————————————————<br />&nbsp; __SegmentedCopyString:<br />&nbsp; &nbsp; ; DWORD __SegmentedCopyString (DWORD SourceSegment, SourceOffset, DestinationSegment, DestinationOffset); StdCall;<br /><br />&nbsp; &nbsp; ; Returns the number of bytes copied to the destination string (Including the null-terminator)<br />&nbsp; &nbsp; ; Returns zero upon any of the below conditions:<br />&nbsp; &nbsp; ;&nbsp;  • You don&#039;t have read permission to the  segment selector<br />&nbsp; &nbsp; ;&nbsp;  • You don&#039;t have write permission to the  segment selector<br />&nbsp; &nbsp; ;&nbsp;  •  has its high order WORD set to some value<br />&nbsp; &nbsp; ;&nbsp;  •  is NULL<br />&nbsp; &nbsp; ;&nbsp;  •  has its high order WORD set to some value<br />&nbsp; &nbsp; ;&nbsp;  •  is NULL<br /><br /><br />&nbsp; &nbsp; PUSH&nbsp; &nbsp; EBX<br />&nbsp; &nbsp; PUSH&nbsp; &nbsp; ECX<br />&nbsp; &nbsp; PUSH&nbsp; &nbsp; EDX<br />&nbsp; &nbsp; PUSH&nbsp; &nbsp; ESI<br />&nbsp; &nbsp; PUSH&nbsp; &nbsp; EDI<br />&nbsp; &nbsp; PUSH&nbsp; &nbsp; EBP<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EBP , ESP<br /><br /><br />&nbsp; &nbsp; ;  = SourceSegment<br />&nbsp; &nbsp; ;  = SourceOffset<br />&nbsp; &nbsp; ;  = DestinationSegment<br />&nbsp; &nbsp; ;  = DestinationOffset<br /><br />&nbsp; &nbsp; ; Predict Failure<br />&nbsp; &nbsp; XOR&nbsp; &nbsp;  EAX , EAX<br />&nbsp; &nbsp; XOR&nbsp; &nbsp;  EBX , EBX<br />&nbsp; &nbsp; XOR&nbsp; &nbsp;  ECX , ECX<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  ESI , DWORD PTR  ; SourceSegment<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EDI , DWORD PTR  ; DestinationSegment<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EDX , ESI<br />&nbsp; &nbsp; OR&nbsp; &nbsp; &nbsp; EDX , EDI<br />&nbsp; &nbsp; TEST&nbsp; &nbsp; EDX , 0xFFFF0000<br />&nbsp; &nbsp; SETNZ&nbsp;  BL<br />&nbsp; &nbsp; VERR&nbsp; &nbsp; SI<br />&nbsp; &nbsp; SETNZ&nbsp;  CL<br />&nbsp; &nbsp; OR&nbsp; &nbsp; &nbsp; EBX , ECX<br />&nbsp; &nbsp; VERW&nbsp; &nbsp; DI<br />&nbsp; &nbsp; SETNZ&nbsp;  CL<br />&nbsp; &nbsp; OR&nbsp; &nbsp; &nbsp; EBX , ECX<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EDX , DWORD PTR  ; SourceOffset<br />&nbsp; &nbsp; TEST&nbsp; &nbsp; EDX , EDX<br />&nbsp; &nbsp; SETZ&nbsp; &nbsp; CL<br />&nbsp; &nbsp; OR&nbsp; &nbsp; &nbsp; EBX , ECX<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EDX , DWORD PTR  ; DestinationOffset<br />&nbsp; &nbsp; TEST&nbsp; &nbsp; EDX , EDX<br />&nbsp; &nbsp; SETZ&nbsp; &nbsp; CL<br />&nbsp; &nbsp; OR&nbsp; &nbsp; &nbsp; EBX , ECX<br />&nbsp; &nbsp; JNZ&nbsp; &nbsp;  .EP<br /><br /><br />&nbsp; &nbsp; ; ESI = SourceSegment<br />&nbsp; &nbsp; ; EDI = DestinationSegment<br /><br />&nbsp; &nbsp; PUSH&nbsp; &nbsp; DS<br />&nbsp; &nbsp; PUSH&nbsp; &nbsp; ES<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  DS , ESI<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  ES , EDI<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  ESI , DWORD PTR  ; SourceOffset<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EDI , DWORD PTR  ; DestinationOffset<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EDX , 0x000000FF<br />&nbsp; &nbsp; XOR&nbsp; &nbsp;  ECX , ECX<br />&nbsp; &nbsp; .Loop:<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  EAX , DWORD PTR <br />&nbsp; &nbsp; &nbsp; INC&nbsp; &nbsp;  ESI<br />&nbsp; &nbsp; &nbsp; INC&nbsp; &nbsp;  ECX<br />&nbsp; &nbsp; &nbsp; AND&nbsp; &nbsp;  EAX , EDX<br />&nbsp; &nbsp; &nbsp; JZ&nbsp; &nbsp; &nbsp; .EndLoop<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  DWORD PTR  , EAX<br />&nbsp; &nbsp; &nbsp; INC&nbsp; &nbsp;  EDI<br />&nbsp; &nbsp; &nbsp; JMP&nbsp; &nbsp;  .Loop<br />&nbsp; &nbsp; .EndLoop:<br />&nbsp; &nbsp; &nbsp; POP&nbsp; &nbsp;  ES<br />&nbsp; &nbsp; &nbsp; POP&nbsp; &nbsp;  DS<br />&nbsp; &nbsp; .SetResult:<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  EAX , ECX<br /><br />&nbsp; &nbsp; .EP:<br />&nbsp; &nbsp; &nbsp; POP&nbsp; &nbsp;  EBP<br />&nbsp; &nbsp; &nbsp; POP&nbsp; &nbsp;  EDI<br />&nbsp; &nbsp; &nbsp; POP&nbsp; &nbsp;  ESI<br />&nbsp; &nbsp; &nbsp; POP&nbsp; &nbsp;  EDX<br />&nbsp; &nbsp; &nbsp; POP&nbsp; &nbsp;  ECX<br />&nbsp; &nbsp; &nbsp; POP&nbsp; &nbsp;  EBX<br />&nbsp; &nbsp; RET&nbsp; &nbsp;  (4*0x04)<br />; ——————————————————————————————————————————————————</code></pre><br /><br />The code is written in NASM. Oh Gosh! I&#039;m so talented :shock:</div>
    <div class="meta">Posted on 2008-02-10 04:29:06 by XCHG</div>
   </div>
   <div class="post" id="post-204763">
    <div class="subject"><a href="#post-204763">Re: Segmentation fault???</a></div>
    <div class="body">My good............<br />It&#039;s to complex to me, I think!<br /><br />There have a lot of many instructions that I have never seen in class.<br /><br />I&#039;m completely disoriented! <br />This is what I am doing:<br /><br /><pre><code><br />&nbsp; &nbsp; &nbsp; .<br />&nbsp; &nbsp; &nbsp; .<br />&nbsp; &nbsp; &nbsp; .<br />	mov		esi, data<br />	mov		edi, currentLine<br />	mov		edx, 0x000000FF<br />	loop1:<br />		mov		ebx, 0x0000000A<br />		mov		eax, DWORD <br />		and		eax, edx<br />		inc		esi<br />		cmp		eax, ebx			;verifica se é o caracter 0xA<br />		je		proccessline<br /><br />		mov		DWORD , eax<br />		inc		edi<br />		jmp		loop1<br /><br />proccessline:<br /><br />	mov 	eax, <br />	add		eax, 1<br />	mov 	, eax<br /><br />	mov		ebx, lineCount<br />	mov		al, byte<br />	cmp		al, 1<br />	je		assignLine1	<br /><br />	mov		ebx, lineCount<br />	mov		al, byte<br />	cmp		al, 2<br />	je		assignLine2<br /><br />	mov		ebx, lineCount<br />	mov		al, byte<br />	cmp		al, 3<br />	je		assignLine3<br /><br /><br />	jmp		fim		<br /><br />assignLine1:<br /><br />	; Converte line1 (first Line is numeric)<br />	push	dword<br />	push	linha<br />	call	conv2num<br />	add		esp, 8<br />	mov		, eax<br />assignLine2:<br />	; Converte line 2 (second Line is numeric)<br />	push	dword<br />	push	linha<br />	call	conv2num<br />	add		esp, 8<br />	mov		, eax<br />assignLine3:<br />	mov	ebx, currentLine<br />	mov	al, byte<br />	cmp	al, &#039;+&#039;<br />	je	Sum<br />	cmp	al, &#039;-&#039;<br />	je	Subtraction<br />	cmp	al, &#039;*&#039;<br />	je	Multiplication<br />	cmp	al, &#039;/&#039;<br />	je	Division<br /><br />&nbsp; &nbsp; &nbsp; .<br />&nbsp; &nbsp; &nbsp; .<br />&nbsp; &nbsp; &nbsp; .<br /></code></pre><br /><br />Is working to a certain part ...<br />First jumps to proccessline is ok, I return to loop 1 and then gives the following error Segmentation fault</div>
    <div class="meta">Posted on 2008-02-10 06:14:40 by nmpsantos</div>
   </div>
   <div class="post" id="post-204764">
    <div class="subject"><a href="#post-204764">Re: Segmentation fault???</a></div>
    <div class="body"><pre><code><br />mov		eax, dinamicString	<br />mov		,eax<br /></code></pre><br />Umm, you store the offset of <em>dinamicString</em> in <em>stringlenght</em>? What is that supposed to achieve? You need to call a strlen() function when working with ASCIZ strings.<br /><br /><pre><code><br />mov		esi, dinamicString<br />mov		edi, destinationString<br />mov		ecx, stringlenght<br /></code></pre><br />This code is OK, <strong>if you fix the string length thing</strong>. Oh, and you might possibly need  and , if those are dynamically allocated (malloc() / whatever), and not static-sized strings in .data or .bss .<br /><br /><pre><code><br />ciclo:<br />	lodsb<br />	stosb<br />loopnz ciclo<br /></code></pre><br />replace this with <strong>rep movsb</strong>.<br /><br />PS: &quot;length&quot; and &quot;dynamic&quot;, not &quot;lenght&quot; and &quot;dinamic&quot; :)<br /></div>
    <div class="meta">Posted on 2008-02-10 06:53:49 by f0dder</div>
   </div>
   <div class="post" id="post-204767">
    <div class="subject"><a href="#post-204767">Re: Segmentation fault???</a></div>
    <div class="body">	<br />I know that my questions may seem a stupid and lazy ...<br />But I&#039;m a student worker and had only one 5 classes of NASM ... <br /><br />Now I have to read a file,<br />get 2 operands,<br />get the operator,<br />and clear the file I read and write the result in the same file.<br /><br />I am completely disoriented and desperate!<br /><br />Thanks for your help</div>
    <div class="meta">Posted on 2008-02-10 07:18:26 by nmpsantos</div>
   </div>
   <div class="post" id="post-204768">
    <div class="subject"><a href="#post-204768">Re: Segmentation fault???</a></div>
    <div class="body"><pre><code><br />	mov		esi, data<br />	mov		edi, currentLine<br />	mov		edx, 0x000000FF<br />	loop1:<br />		mov		ebx, 0x0000000A<br />		mov		eax, DWORD <br />		and		eax, edx<br />		inc		esi<br />		cmp		eax, ebx			;check character 0xA<br />		je		proccessline<br /><br />		lodsb<br />		cmp		al, &#039;#&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;check end of the file ( I put this Character in the last line of my file)<br />		je		fileend<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />		mov		DWORD , eax<br />		inc		edi<br />		jmp		loop1<br /></code></pre><br />I don&#039;t understand! <br />This has worked but now I do not know why it is always the return Segmentation fault ... <br />	<br />He does not seem to be doing the inc&#039;s...<br /></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=2553" target="_blank">fileToRead.txt</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2008-02-10 08:37:36 by nmpsantos</div>
   </div>
  </div>
 </body>
</html>