<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>WinAsm 3.0.0.1 - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17081" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=41">WinAsm Studio</a> &raquo; <a href="../?id=17081">WinAsm 3.0.0.1</a></p>
   <div class="post" id="post-132501">
    <div class="subject"><a href="#post-132501">WinAsm 3.0.0.1</a></div>
    <div class="body">Hi akyprian,<br />First of all i would like to thank you for your good work. WinAsm is - indeed - a very good IDE.<br /><br />Within your Version 3.0.0.1 it should be possible to display structure members by pressing &quot;.&quot;, but it seems not to work correctly:<br /><br />-&gt; If i use the structurename (e.g. PROCESSENTRY32) and press &quot;.&quot;, it works.<br /><pre><code><br />    PROCESSENTRY32.  -&gt; the memberlist appears &#40;but that's not the goal&#41;<br /></code></pre><br /><br />-&gt; These examples <strong>didn't</strong> work:<br /><pre><code><br />    .data?<br />    myProcess  PROCESSENTRY32 &lt;&gt;<br />    ...<br />    .code<br />    ...<br />    lea     esi, myProcess<br />    assume  esi&#58;ptr PROCESSENTRY32<br />    mov     &#91;esi&#93;.          -&gt; nothing appears<br /><br />    OR<br /><br />    mov     eax, myProcess. -&gt; nothing appears<br /></code></pre><br /><br />During coding, i found some constants etc. that where missing. Here are the &quot;updates&quot;<br /><br />FILE: MasmApiConst.vaa (INSERT)<br /><br />dwFreeType'=MEM_DECOMMIT,MEM_RELEASE<br /><br />dwFlags''=TH32CS_INHERIT,TH32CS_SNAPALL,TH32CS_SNAPHEAPLIST,TH32CS_SNAPMODULE,TH32CS_SNAPPROCESS,TH32CS_SNAPTHREAD<br /><br />flAllocationType'=MEM_COMMIT,MEM_RESERVE,MEM_RESET,MEM_TOP_DOWN<br /><br />flProtect'=PAGE_READONLY,PAGE_READWRITE,PAGE_EXECUTE,PAGE_EXECUTE_READ,PAGE_EXECUTE_READWRITE,PAGE_GUARD,PAGE_NOACCESS,PAGE_NOCACHE<br /><br />flNewProtect'=PAGE_READONLY,PAGE_READWRITE,PAGE_EXECUTE,PAGE_EXECUTE_READ,PAGE_EXECUTE_READWRITE,PAGE_GUARD,PAGE_NOACCESS,PAGE_NOCACHE<br /><br /><br />FILE: MasmApiCall.vaa (CHANGE)<br /><br />OLD: CreateToolhelp32Snapshot,dwFlags,th32ProcessID<br />NEW: CreateToolhelp32Snapshot,dwFlags'',th32ProcessID<br /><br />OLD: VirtualAlloc,lpAddress,dwSize,flAllocationType,flProtect<br />NEW: VirtualAlloc,lpAddress,dwSize,flAllocationType',flProtect'<br /><br />OLD: VirtualAllocEx,hProcess,lpAddress,dwSize,flAllocationType,flProtect<br />NEW: VirtualAllocEx,hProcess,lpAddress,dwSize,flAllocationType',flProtect'<br /><br />OLD: VirtualFree,lpAddress,dwSize,dwFreeType<br />NEW: VirtualFree,lpAddress,dwSize,dwFreeType'<br /><br />OLD: VirtualFreeEx,hProcess,lpAddress,dwSize,dwFreeType<br />NEW: VirtualFreeEx,hProcess,lpAddress,dwSize,dwFreeType'<br /><br />OLD: VirtualProtect,lpAddress,dwSize,flNewProtect,lpflOldProtect<br />NEW: VirtualProtect,lpAddress,dwSize,flNewProtect',lpflOldProtect<br /><br />OLD: VirtualProtectEx,hProcess,lpAddress,dwSize,flNewProtect,lpflOldProtect<br />NEW: VirtualProtectEx,hProcess,lpAddress,dwSize,flNewProtect',lpflOldProtect<br /><br /><br />FILE: MasmApiStruct.vaa (INSERT)<br /><br />HICON   ; in the end of this file<br /><br />As told already in masmforum, the ThreadEnvironmentBlock has the wrong size in windows.inc. The correct size is 34h (NT AND 9X!) Here are the correct structures (for implementation in windows.inc):<br /><pre><code><br />;-----------------------------------------------------------------------------<br />;-- Thread Environment Block &#40;TEB aka TIB&#41;<br />;-- OS&#58; Windows NT/2K/XP/2K3<br />;-----------------------------------------------------------------------------<br />NT_THREADENVIRONMENTBLOCK struct               ; size = 34h<br />  ExceptionList                   DWORD ?      ; 00h end of SEH chain<br />  StackBase                       DWORD ?      ; 04h<br />  StackLimit                      DWORD ?      ; 08h<br />  SubSystemTIB                    DWORD ?      ; 0Ch<br />  FiberData                       DWORD ?      ; 10h<br />  ArbitraryUser                   DWORD ?      ; 14h<br />  pSelf                           DWORD ?      ; 18h pointer to TEB &#40;7FFDE000h&#41;<br />  pEnvironmentPtr                 DWORD ?      ; 1Ch<br />  ProcessID                       DWORD ?      ; 20h &#40;see Taskmanager!&#41;<br />  ThreadID                        DWORD ?      ; 24h<br />  pRPCHandle                      DWORD ?      ; 28h<br />  TLSStorage                      DWORD ?      ; 2Ch<br />  PEBAddress                      DWORD ?      ; 30h pointer to PEB &#40;7FFDF000h&#41;<br />NT_THREADENVIRONMENTBLOCK ends<br /><br />;-----------------------------------------------------------------------------<br />;-- Thread Environment Block &#40;TEB aka TIB&#41;<br />;-- OS&#58; Windows 95/98/98SE/ME<br />;-----------------------------------------------------------------------------<br />WX_THREADINFORMATIONBLOCK struct               ; size = 34h<br />  ExceptionList                   DWORD ?      ; 00h end of SEH chain<br />  StackBase                       DWORD ?      ; 04h<br />  StackLimit                      DWORD ?      ; 08h max stack value<br />  pTDB                            WORD  ?      ; 0Ch<br />  pThunkSS                        WORD  ?      ; 0Eh<br />  Unknown                         DWORD ?      ; 10h<br />  ArbitraryUser                   DWORD ?      ; 14h<br />  pSelf                           DWORD ?      ; 18h pointer to TIB<br />  TIBFlags                        WORD  ?      ; 1Ch<br />  Win16MutexCount                 WORD  ?      ; 1Eh<br />  DebugContext                    DWORD ?      ; 20h<br />  pCurrentPriority                DWORD ?      ; 24h<br />  pQueue                          DWORD ?      ; 28h<br />  TLSStorage                      DWORD ?      ; 2Ch<br />  pProcess                        DWORD ?      ; 30h pointer to process database<br />WX_THREADINFORMATIONBLOCK ends<br /></code></pre><br /><br />To use this structures in WinASM;<br />FILE: MasmApiStruct.vaa (INSERT)<br /><br />NT_THREADENVIRONMENTBLOCK,ExceptionList,StackBase,StackLimit,SubSystemTIB,FiberData,ArbitraryUser,pSelf,pEnvironmentPtr,ProcessID,ThreadIS,pRPCHandle,TLSStorage,PEBAddress<br /><br />WX_THREADENVIRONMENTBLOCK,ExceptionList,StackBase,StackLimit,pTDB,pThunkSS,Unknown,ArbitraryUser,pSelf,TIBFlags,Win16MutexCount,DebugContext,pCurrentPriority,pQueue,TLSStorage,pProcess<br /><br />Regards, Pegasus</div>
    <div class="meta">Posted on 2004-02-04 09:40:01 by cu.Pegasus</div>
   </div>
   <div class="post" id="post-132555">
    <div class="subject"><a href="#post-132555">Re: WinAsm 3.0.0.1</a></div>
    <div class="body">Hi cu.Pegasus,<br /><br /><div class="quote"><br />First of all i would like to thank you for your good work. WinAsm is - indeed - a very good IDE.<br /></div><br />Thanks for your good words. With constructive feedback it can only get better<br /><br /><div class="quote"><br />Within your Version 3.0.0.1 it should be possible to display structure members by pressing &quot;.&quot;, but it seems not to work correctly:<br /></div><br />It does work as intended to do. There are some cases (like the ones you mention below) that I haven't considered YET.<br /><br /><div class="quote"><br />-&gt; If i use the structurename (e.g. PROCESSENTRY32) and press &quot;.&quot;, it works.<br /><pre><code><br />    PROCESSENTRY32.  -&gt; the memberlist appears &#40;but that's not the goal&#41;<br /></code></pre><br /></div><br />It is one of the goals. Why not?<br /><br /><div class="quote"><br />-&gt; These examples <strong>didn't</strong> work:<br /><pre><code><br />    .data?<br />    myProcess  PROCESSENTRY32 &lt;&gt;<br />    ...<br />    .code<br />    ...<br />    lea     esi, myProcess<br />    assume  esi&#58;ptr PROCESSENTRY32<br />    mov     &#91;esi&#93;.          -&gt; nothing appears<br /><br />    OR<br /><br />    mov     eax, myProcess. -&gt; nothing appears<br /></code></pre><br /></div><br />As already said these two cases are not bugs. I haven't implemented them yet. Will take care of them soon. Thanks very much. Just a small note(just in case you didn't know): If <strong>myProcess</strong> is a local (and not a global ), your second example works.<br /><br />I also want to thank you very much for the update suggestions of MasmApiConst.vaa, MasmApiCall.vaa and MasmApiStruct.vaa<br /><br />This is a very useful kind of feedback,<br /><br />akyprian</div>
    <div class="meta">Posted on 2004-02-04 15:17:49 by akyprian</div>
   </div>
  </div>
 </body>
</html>