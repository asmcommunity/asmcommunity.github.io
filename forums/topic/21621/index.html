<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>How to add a newline in the editbox? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=21621" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=21621">How to add a newline in the editbox?</a></p>
   <div class="post" id="post-163208">
    <div class="subject"><a href="#post-163208">How to add a newline in the editbox?</a></div>
    <div class="body">&nbsp; hi ,all. how can i add a new line or new message in the editbox,not replace the messages that the editbox had.<br /><br />can SetWindowText works?<br /><br /><br /></div>
    <div class="meta">Posted on 2005-08-13 14:55:36 by Abuseyourdna</div>
   </div>
   <div class="post" id="post-163209">
    <div class="subject"><a href="#post-163209">Re: How to add a newline in the editbox?</a></div>
    <div class="body">Assuming my edit box had the message as follow:<br /><br />&nbsp; &nbsp; &nbsp;  1.Hello,baby<br />&nbsp; &nbsp; &nbsp;  2.I like linkin park<br /><br />i want to add :&quot;3.I am from china&quot;,<br />i had tried this:<br />&nbsp; &nbsp;  <br />&nbsp; &nbsp;  invoke SendMessage,hwndEdit,EM_REPLACESEL,0,addr szText&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;szText db &quot;3.I am from china&quot;,13,10,0<br /><br /><br /><br />but the result just as follow:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3.I am from china<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.Hello,baby<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2.I like linkin park<br /><br /><br /><br /><br />how can i add the message after &quot;2.I like linkin park&quot; ?</div>
    <div class="meta">Posted on 2005-08-13 15:15:59 by Abuseyourdna</div>
   </div>
   <div class="post" id="post-163210">
    <div class="subject"><a href="#post-163210">Re: How to add a newline in the editbox?</a></div>
    <div class="body">Use WM_GETTEXT to get the Text into a Buffer, then use lstrcat to append strings to it and use WM_SETTEXT to set the text back.<br /><pre><code><br />.data<br />NewLine db 13,10,0<br />AddedData db &quot;Hello World&quot;,0<br />.code<br />invoke SendMessage, hEdit, WM_GETTEXT, addr Buffer, Sizeof Buffer<br />invoke lstrcat, addr Buffer, addr Newline<br />invoke lstrcat, addr Buffer, addr Added Data<br />invoke SendMessage, hEdit, WM_SETTEXT, addr Buffer,0<br /></code></pre><br />Code Not Verified.</div>
    <div class="meta">Posted on 2005-08-13 15:16:40 by JimmyClif</div>
   </div>
   <div class="post" id="post-163211">
    <div class="subject"><a href="#post-163211">Re: How to add a newline in the editbox?</a></div>
    <div class="body">The idea is to use the EM_SETSEL message to deselect everything and then set caret position to the end of text.<br />Try something like this:<br /><br /><pre><code><br />invoke SendMessage,hwndEdit,EM_SETSEL, -1, -1<br />invoke SendMessage,hwndEdit,EM_REPLACESEL,0,addr szText<br /></code></pre><br /><br />Regards.<br /><br />Kecol.-<br /><br />PS: read some documentation if it doesn&#39;t work (MSDN).<br /></div>
    <div class="meta">Posted on 2005-08-13 15:32:50 by Kecol</div>
   </div>
   <div class="post" id="post-163216">
    <div class="subject"><a href="#post-163216">Re: How to add a newline in the editbox?</a></div>
    <div class="body">oh,it doesnt work.<br /><br />but i have another question,how can i undo the editbox operations?<br />i have defined a submenu named &quot;UNDO&quot;<br /><br /><br />.const<br />.....<br />IDM_UNDO equ 1<br /><br />.........<br />invoke CreateMenu<br />mov hwndMenu,eax<br />invoke CreatePopupMenu<br />mov esi,eax<br />invoke AppendMenu,hwndMenu,MF_POPUP,esi,addr MenuName<br />invoke AppendMenu,esi,MF_STRING,IDM_UNDO,addr submenu<br /><br />.....<br />......<br />if ax==IDM_UNDO<br />&nbsp; invoke SendMessage,hwndEdit,EM_UNDO,0,0&nbsp; &nbsp; ;but it doesnt work,tell me why?<br /><br />..........<br />....</div>
    <div class="meta">Posted on 2005-08-13 16:41:56 by Abuseyourdna</div>
   </div>
   <div class="post" id="post-163219">
    <div class="subject"><a href="#post-163219">Re: How to add a newline in the editbox?</a></div>
    <div class="body">Hey, you didn&#39;t check the API documentation. The idea was good but I made a mistake in the code.<br />This will work:<br /><br /><pre><code><br />invoke SendMessage,hwndEdit,EM_SETSEL, -1, 0<br />invoke SendMessage,hwndEdit,EM_REPLACESEL,0,addr szText<br /></code></pre><br /><br />Search the forum before asking. I will do the same before answering.<br /><br />Kecol.-</div>
    <div class="meta">Posted on 2005-08-13 17:59:06 by Kecol</div>
   </div>
   <div class="post" id="post-163228">
    <div class="subject"><a href="#post-163228">Re: How to add a newline in the editbox?</a></div>
    <div class="body">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ............<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke EnableMenuItem,hwndMenu,IDM_ADDRESS,MF_GRAYED<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke EnableMenuItem,hwndMenu,IDM_CLEAR,MF_ENABLED<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke SetWindowText,hwndEdit,addr buffer <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke SendMessage,hwndEdit,EM_SETSEL,-1,0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke SendMessage,hwndEdit,EM_REPLACESEL,0,addr try&nbsp;  <br /><br />it doesnt work yet,why?<br /><br /><br />i have search the forum before asking question.but now, what i want to know is how to use&nbsp; the EM_UNDO<br /><br /></div>
    <div class="meta">Posted on 2005-08-14 00:00:14 by Abuseyourdna</div>
   </div>
   <div class="post" id="post-163229">
    <div class="subject"><a href="#post-163229">Re: How to add a newline in the editbox?</a></div>
    <div class="body">i have tested the edit`control undo queue,it return false?why?<br /><br />my program as follow:<br /><br /><br />.386 <br />.model flat,stdcall <br />option casemap:none <br />WinMain proto :DWORD,:DWORD,:DWORD,:DWORD <br /><br />include \masm32\include\windows.inc <br />include \masm32\include\user32.inc <br />include \masm32\include\kernel32.inc <br />includelib \masm32\lib\user32.lib <br />includelib \masm32\lib\kernel32.lib <br /><br />.data <br />ClassName db &quot;SimpleWinClass&quot;,0 <br />AppName&nbsp; db &quot;Kernel Tools&quot;,0 <br />MenuName db &quot;&amp;Function&quot;,0<br />MenuName1 db &quot;&amp;Edit&quot;,0<br />submenu1 db &quot;&amp;Kernel/PE Addr&quot;,0<br />submenu2 db &quot;&amp;Clear&quot;,0<br />submenu3 db &quot;E&amp;xit&quot;,0 <br />submenu4 db &quot;&amp;Undo&quot;,0<br />outformat db &quot;Base address of kernel:0x%XH&quot;,13,10<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; db &quot;Address of PE header&nbsp;  :0x%XH&quot;,0<br />try db &quot;Haha,you make it!&quot;,13,10,0<br />EditClassName db &quot;edit&quot;,0 <br />szWarning db &quot;Failure.:(&quot;,0<br /><br /><br />.data? <br />hInstance HINSTANCE ? <br />CommandLine LPSTR ? <br />hwndMenu DWORD ?<br />hwndEdit HWND ? <br />buffer db 1024 dup(?)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br /><br />.const <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />IDM_ADDRESS equ 1 <br />IDM_CLEAR equ 2 <br /><br />IDM_EXIT equ 3<br />IDM_UNDO equ 4<br /><br />.code <br />start: <br />&nbsp; &nbsp; mov eax,<br />&nbsp; &nbsp; .while word ptr !=&quot;ZM&quot;<br />&nbsp; &nbsp; dec eax<br />&nbsp; &nbsp; .endw<br />&nbsp; &nbsp; mov edx,<br />&nbsp; &nbsp; add edx,eax<br />&nbsp; &nbsp; invoke wsprintf,addr buffer,addr outformat,eax,edx<br />&nbsp; &nbsp; invoke GetModuleHandle, NULL <br />&nbsp; &nbsp; mov&nbsp; &nbsp; hInstance,eax <br />&nbsp; &nbsp; invoke GetCommandLine<br />&nbsp; &nbsp; mov CommandLine,eax <br />&nbsp; &nbsp; invoke WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT <br />&nbsp; &nbsp; invoke ExitProcess,eax <br /><br />WinMain proc hInst:HINSTANCE,hPrevInst:HINSTANCE,CmdLine:LPSTR,CmdShow:DWORD <br />&nbsp; &nbsp; LOCAL wc:WNDCLASSEX <br />&nbsp; &nbsp; LOCAL msg:MSG <br />&nbsp; &nbsp; LOCAL hwnd:HWND <br />&nbsp; &nbsp; mov&nbsp;  wc.cbSize,SIZEOF WNDCLASSEX <br />&nbsp; &nbsp; mov&nbsp;  wc.style, CS_HREDRAW or CS_VREDRAW <br />&nbsp; &nbsp; mov&nbsp;  wc.lpfnWndProc, OFFSET WndProc <br />&nbsp; &nbsp; mov&nbsp;  wc.cbClsExtra,NULL <br />&nbsp; &nbsp; mov&nbsp;  wc.cbWndExtra,NULL <br />&nbsp; &nbsp; push&nbsp; hInst <br />&nbsp; &nbsp; pop&nbsp;  wc.hInstance <br />&nbsp; &nbsp; mov&nbsp;  wc.hbrBackground,COLOR_BTNFACE+1 <br />&nbsp; &nbsp; mov&nbsp;  wc.lpszMenuName,OFFSET MenuName <br />&nbsp; &nbsp; mov&nbsp;  wc.lpszClassName,OFFSET ClassName <br />&nbsp; &nbsp; invoke LoadIcon,NULL,IDI_APPLICATION <br />&nbsp; &nbsp; mov&nbsp;  wc.hIcon,eax <br />&nbsp; &nbsp; mov&nbsp;  wc.hIconSm,eax <br />&nbsp; &nbsp; invoke LoadCursor,NULL,IDC_ARROW <br />&nbsp; &nbsp; mov&nbsp;  wc.hCursor,eax <br />&nbsp; &nbsp; invoke RegisterClassEx, addr wc <br />&nbsp; &nbsp; invoke CreateMenu<br />&nbsp; &nbsp; mov hwndMenu,eax<br />&nbsp; &nbsp; invoke CreatePopupMenu<br />&nbsp; &nbsp; mov esi,eax<br />&nbsp; &nbsp; invoke AppendMenu,hwndMenu,MF_POPUP,esi,addr MenuName<br />&nbsp; &nbsp; invoke AppendMenu,esi,MF_STRING,IDM_ADDRESS,addr submenu1<br />&nbsp; &nbsp; invoke AppendMenu,esi,MF_STRING,IDM_CLEAR,addr submenu2<br />&nbsp; &nbsp; invoke AppendMenu,esi,MF_STRING,IDM_UNDO,addr submenu4<br />&nbsp; &nbsp; invoke AppendMenu,esi,MF_SEPARATOR,NULL,NULL<br />&nbsp; &nbsp; invoke AppendMenu,esi,MF_STRING,IDM_EXIT,addr submenu3<br />&nbsp;  <br />&nbsp; &nbsp; invoke CreateWindowEx,WS_EX_CLIENTEDGE,ADDR ClassName, \ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ADDR AppName, WS_OVERLAPPED,\ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 360, 280,\ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  400,300,NULL,hwndMenu, hInst,NULL <br />&nbsp; &nbsp; mov&nbsp;  hwnd,eax <br />&nbsp; &nbsp; invoke ShowWindow, hwnd,SW_SHOWNORMAL <br />&nbsp; &nbsp; invoke UpdateWindow, hwnd <br />&nbsp; &nbsp; .WHILE TRUE <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke GetMessage, ADDR msg,NULL,0,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; .BREAK .IF (!eax) <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke TranslateMessage, ADDR msg <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke DispatchMessage, ADDR msg <br />&nbsp; &nbsp; .ENDW <br />&nbsp; &nbsp; mov&nbsp; &nbsp;  eax,msg.wParam <br />&nbsp; &nbsp; ret <br />WinMain endp <br /><br />WndProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM <br />&nbsp; &nbsp; .IF uMsg==WM_DESTROY <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke PostQuitMessage,NULL <br />&nbsp; &nbsp; .ELSEIF uMsg==WM_CREATE <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke CreateWindowEx,WS_EX_CLIENTEDGE, ADDR EditClassName,NULL,\ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WS_CHILD or WS_VISIBLE or WS_BORDER or WS_VSCROLL or ES_LEFT or\ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ES_READONLY or ES_MULTILINE or ES_AUTOVSCROLL,\ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 15,25,360,150,hWnd,8,hInstance,NULL <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; hwndEdit,eax <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke EnableMenuItem,hwndMenu,IDM_CLEAR,MF_GRAYED<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ELSEIF uMsg==WM_COMMAND <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,wParam <br />&nbsp; &nbsp; &nbsp; &nbsp; .IF lParam==0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .IF ax==IDM_ADDRESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke EnableMenuItem,hwndMenu,IDM_ADDRESS,MF_GRAYED<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke EnableMenuItem,hwndMenu,IDM_CLEAR,MF_ENABLED<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke SetWindowText,hwndEdit,addr buffer <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;invoke SendMessage,hwndEdit,EM_SETSEL,0,-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke SendMessage,hwndEdit,EM_REPLACESEL,0,addr try&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ELSEIF ax==IDM_CLEAR <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SetWindowText,hwndEdit,NULL <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke EnableMenuItem,hwndMenu,IDM_ADDRESS,MF_ENABLED<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke EnableMenuItem,hwndMenu,IDM_CLEAR,MF_GRAYED<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .ELSEIF ax==IDM_UNDO<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage,hwndEdit,EM_CANUNDO,0,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .if eax!=0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage,hwndEdit,EM_UNDO,0,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .else<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke MessageBox,NULL,addr szWarning,addr AppName,MB_ICONERROR<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .endif<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .ELSE <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke DestroyWindow,hWnd <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ENDIF <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; .ENDIF <br />&nbsp; &nbsp; .ELSE <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke DefWindowProc,hWnd,uMsg,wParam,lParam <br />&nbsp; &nbsp; &nbsp; &nbsp; ret <br />&nbsp; &nbsp; .ENDIF <br />&nbsp; &nbsp;  xor&nbsp; &nbsp; eax,eax <br />&nbsp; &nbsp; ret <br />WndProc endp <br />end start <br /><br /><br /><br /><br />who can help me to solve the problem?</div>
    <div class="meta">Posted on 2005-08-14 00:15:18 by Abuseyourdna</div>
   </div>
   <div class="post" id="post-163230">
    <div class="subject"><a href="#post-163230">Re: How to add a newline in the editbox?</a></div>
    <div class="body">mov eax,<br />&nbsp; &nbsp; .while word ptr !=&quot;ZM&quot;<br />&nbsp; &nbsp; dec eax<br />&nbsp; &nbsp; .endw<br />&nbsp; &nbsp; mov edx,<br />&nbsp; &nbsp; add edx,eax<br />&nbsp; &nbsp; invoke wsprintf,addr buffer,addr outformat,eax,edx<br />&nbsp; &nbsp; invoke GetModuleHandle, NULL <br /><br /><br />what the hell is the point in doing your little scan to find the kernel32 base address when you&#39;re using apis from it right after (GetModuleHandle)<br />is it to look leet or something?, if so you failed, a simple invoke GetModuleHandleA, offset kernel32text (where kernel32text = db &#39;kernel32.dll&#39;,00h) would do the same, and if you are going to do such a scan then it would be wise to do an exception handler to handle the possibility that the dword @ esp might not be inside kernel32 (forwarded/redirected import could cause this).. and try and use msdn as a reference too as previously advised</div>
    <div class="meta">Posted on 2005-08-14 01:46:47 by evlncrn8</div>
   </div>
  </div>
 </body>
</html>