<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Image Resize with GDI+ - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20654" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=20654">Image Resize with GDI+</a></p>
   <div class="post" id="post-157414">
    <div class="subject"><a href="#post-157414">Image Resize with GDI+</a></div>
    <div class="body">Dear Gentlemans from Win32ASM<br /><br />Greeting to every body.<br /><br />I have a problem and I want to know if some one can help me solve it!<br /><br />I am working on a program that loads jpeg's pictures and display then in a static control which works fine, but I need to create a resized second picture so you can view it a control and the control doesn't have to resize to the full size of the picture. I found acouple of samples but they are all in .NET, C++ which I don't know how to use, so here is the code i have!<br /><br /> IF uMsg==WM_CREATE<br />     INVOKE     CreateWindowEx, WS_EX_CLIENTEDGE, addr StaticClass, NULL,SS_BITMAP or WS_CHILD or WS_VISIBLE,\<br />                10, 50, 350,350, hWnd, NULL, hInstance, NULL<br />    mov hImageTestL,eax<br />    Invoke GdipCreateFromHWND,hImageTestL,ADDR grafico    <br />    invoke MultiByteToWideChar,CP_OEMCP,MB_PRECOMPOSED,addr NombreArchivo,-1,addr NombreW,255<br />    invoke GdipLoadImageFromFile,ADDR NombreW,ADDR imagen1<br />invoke GdipDrawImage,grafico,imagen1,0,0<br /><strong>invoke GdipCreateBitmapFromGraphics,200,200,grafico,addr imagen2</strong><br /><br />The first part works perfectly but in last line is supposed to create a second image (imagen2) with a resize image of imagen1 but when I try to draw imagen2 it just show me a black box (no picture) does any body have an idea why?</div>
    <div class="meta">Posted on 2005-02-23 23:35:44 by alonsomm</div>
   </div>
   <div class="post" id="post-157729">
    <div class="subject"><a href="#post-157729">Resize working code</a></div>
    <div class="body">First of all I want to thank every body that help me solve this problem, I want to share what I have learn after spending about 3 days looking every where in the internet for info on how to use GDI+ in MASM with very little luck but any way here it is:<br /><br />; Create VB Picture box to draw imagen later On<br />     INVOKE     CreateWindowEx,WS_EX_CLIENTEDGE,addr StaticClass, NULL,SS_BITMAP or WS_CHILD or WS_VISIBLE,\<br />                10, 50, 350,350, hWnd, NULL, hInstance, NULL<br />; Save Control handle for later use    <br />    mov hImageTestL,eax<br />; Convert Image Filename to Wide character other wise it will return error <br />    invoke MultiByteToWideChar,CP_OEMCP,MB_PRECOMPOSED,addr NombreArchivo,-1,addr NombreW,255<br />; Load image from file and save bitmap to imagen1<br />    invoke GdipLoadImageFromFile,ADDR NombreW,ADDR imagen1<br />; Get original image pixel format (usually 32 Bit color) and save it to lFormat    <br />    invoke GdipGetImagePixelFormat,imagen1,addr lFormat  <br />; Get original image Width and save it to sngWidth<br />    invoke GdipGetImageWidth,imagen1,addr sngWidth<br />; Get original image Height and save it to sngHeight    <br />    invoke GdipGetImageHeight,imagen1,addr sngHeight<br />; Set W variable to 400 (pixels) this would be new picture width<br />    mov W,400<br />; Set H variable to 400 (pixels) this would be new picture height<br />    mov H,400<br />; C++ Bitmap::Bitmap(width, height, format) Create new bitmap with widht and height just set and same pixel format as the original image and save it to imagen2<br />    invoke GdipCreateBitmapFromScan0,W,H,0,lFormat,0,addr imagen2<br />; Set graphic interpolation mode to high quality output<br />;   Shrink the image using low-quality interpolation.(InterpolationModeNearestNeighbor)<br />;   Shrink the image using medium-quality interpolation. (InterpolationModeHighQualityBilinear)<br />;   Shrink the image using high-quality interpolation. (InterpolationModeHighQualityBicubic)<br />    invoke GdipSetInterpolationMode,grafico,InterpolationModeHighQualityBilinear  ; equ	6<br />; Get original image Horizontal resolution and save it to HorRes variable<br />    invoke GdipGetImageHorizontalResolution,imagen1,addr HorRes<br />; Get original image Vertical resolution and save it to VerRes variable<br />    invoke GdipGetImageVerticalResolution,imagen1,addr VerRes<br />; Set new image vertical and horizontal resolution to match orignal image resolution<br />    invoke GdipBitmapSetResolution,imagen2,HorRes,VerRes<br />; Create new graphics object from new image<br />    invoke GdipGetImageGraphicsContext,imagen2,addr grafico<br />;    RGB 0,0,0<br />; Set image background to Black color<br />    invoke GdipGraphicsClear,grafico,0<br />; Draw resized original image to graphic object of new bitmap<br />    invoke GdipDrawImageRectI,grafico,imagen1,0,0,W,H<br />; Destroy orignal image<br />    invoke GdipDisposeImage,imagen1<br />; Delete new image graphic object    <br />    invoke GdipDeleteGraphics,grafico<br />; Create standard GDI Bitmap from Gdi+ Bitmap and save bitmap handle in hBitmap variable     <br />; If you want to rotate image use: <br />;invoke GdipImageRotateFlip,imagen2,Rotate90FlipNone<br />    invoke GdipCreateHBITMAPFromBitmap,imagen2,addr hBitmap,0<br />; Set VB Picture box control image to our new resized image<br />    invoke SendMessage,hImageTestL,STM_SETIMAGE,IMAGE_BITMAP,hBitmap</div>
    <div class="meta">Posted on 2005-03-05 13:03:20 by alonsomm</div>
   </div>
  </div>
 </body>
</html>