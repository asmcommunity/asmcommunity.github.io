<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Parsing an address - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=6625" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=8">Networking</a> &raquo; <a href="../?id=6625">Parsing an address</a></p>
   <div class="post" id="post-47800">
    <div class="subject"><a href="#post-47800">Parsing an address</a></div>
    <div class="body">Is there a windows function or something that will parse an address?<br /><br />Take something like &quot;http://www.whatever.com/user/test.zip&quot;<br />and turn it into...<br />&quot;http&quot;, &quot;whatever.com&quot; and &quot;/user/test.zip&quot;?<br /><br />I could write it myself, but i was never good at writing parsers.</div>
    <div class="meta">Posted on 2002-07-15 18:15:48 by ChimpFace9000</div>
   </div>
   <div class="post" id="post-47807">
    <div class="subject"><a href="#post-47807">Parsing an address</a></div>
    <div class="body">Sorry if it looks stupid, but I am really tired :(<br /><br /><pre><code><br />; #################################################<br /><br />        .486<br />        .model flat, stdcall<br />        option casemap &#58;none<br /><br />; #################################################<br /><br />        include \masm32\include\windows.inc<br />        include \masm32\include\user32.inc<br />        include \masm32\include\kernel32.inc<br /><br />        includelib \masm32\lib\user32.lib<br />        includelib \masm32\lib\kernel32.lib<br /><br />; #################################################<br /><br />    .data<br />        szTest          db &quot;http&#58;//www.whatever.com/user/test.zip&quot;, 0<br /><br />; #################################################<br /><br />    .data?<br />        szBuffer1       db 128 dup &#40;?&#41;<br />        szBuffer2       db 128 dup &#40;?&#41;<br />        szBuffer3       db 128 dup &#40;?&#41;<br /><br /><br />; #################################################<br /><br />    .code<br /><br />start&#58;<br />    <br />    push esi<br />    push edi<br /><br />    lea esi, szTest<br />    lea edi, szBuffer1<br />@@&#58;<br />    mov al, byte ptr &#91;esi&#93;<br />    inc esi<br />    or al, al<br />    jz _1<br />    cmp al, '&#58;'<br />    je @F<br />    mov byte ptr &#91;edi&#93;, al<br />    inc edi<br />    jmp @B<br />@@&#58;<br />    lea edi, szBuffer2<br />    add esi, 2 ; skip '//'<br />@@&#58;<br />    mov al, byte ptr &#91;esi&#93;<br />    inc esi<br />    or al, al<br />    jz _1<br />    cmp al, '/'<br />    je @F<br />    mov byte ptr &#91;edi&#93;, al<br />    inc edi<br />    jmp @B<br />@@&#58;<br />    inc esi ; skip '/'<br />@@&#58;<br />    mov al, byte ptr &#91;esi&#93;<br />    inc esi<br />    or al, al<br />    jz _1<br />    cmp al, '/'<br />    jne @B<br />    lea edi, szBuffer3<br />@@&#58;<br />    mov al, byte ptr &#91;esi&#93;<br />    inc esi<br />    or al, al<br />    jz @F<br />    mov byte ptr &#91;edi&#93;, al<br />    inc edi<br />    jmp @B<br />@@&#58;<br /><br />    invoke MessageBox, 0, addr szBuffer1, 0, 0<br />    invoke MessageBox, 0, addr szBuffer2, 0, 0<br />    invoke MessageBox, 0, addr szBuffer3, 0, 0<br /><br />_1&#58;<br />   <br />    pop edi<br />    pop esi<br />    <br />    call ExitProcess<br /><br />end start<br /><br />; #################################################<br /></code></pre></div>
    <div class="meta">Posted on 2002-07-15 18:42:18 by bazik</div>
   </div>
   <div class="post" id="post-47832">
    <div class="subject"><a href="#post-47832">Parsing an address</a></div>
    <div class="body">Iczelion has an URL parser in his Download example.</div>
    <div class="meta">Posted on 2002-07-15 22:53:03 by comrade</div>
   </div>
   <div class="post" id="post-47885">
    <div class="subject"><a href="#post-47885">InternetCrackUrl</a></div>
    <div class="body">In the wininet library, there's a function called InternetCrackUrl, that does exactly what you want:<pre><code>.386	<br />.model flat, stdcall<br /><br />include user32.inc<br />include kernel32.inc<br />include wininet.inc<br /><br />includelib user32.lib<br />includelib kernel32.lib<br />includelib wininet.lib<br /><br />include windows.inc<br /><br />.data<br />szUrl			db &quot;http&#58;//www.whatever.com/user/test.zip&quot;,0<br /><br />.data?<br />szScheme		db INTERNET_MAX_SCHEME_LENGTH	 dup &#40;?&#41;<br />szHostName		db INTERNET_MAX_HOST_NAME_LENGTH dup &#40;?&#41;<br />szUserName		db INTERNET_MAX_USER_NAME_LENGTH dup &#40;?&#41;<br />szPassword		db INTERNET_MAX_PASSWORD_LENGTH	 dup &#40;?&#41;<br />szUrlPath		db INTERNET_MAX_PATH_LENGTH	 dup &#40;?&#41;<br />szExtraInfo		db 255 dup &#40;?&#41;<br />URLComponents		URL_COMPONENTS&lt;&gt;<br /><br />.code<br />start&#58;<br /><br />lea edx, URLComponents				;set up URL_COMPONENTS struct<br />assume edx&#58; ptr URL_COMPONENTS<br />mov &#91;edx&#93;.dwStructSize, sizeof URLComponents<br />mov &#91;edx&#93;.lpszScheme, offset szScheme<br />mov &#91;edx&#93;.dwSchemeLength, sizeof szScheme<br />mov &#91;edx&#93;.nScheme, INTERNET_SCHEME_DEFAULT<br />mov &#91;edx&#93;.lpszHostName, offset szHostName<br />mov &#91;edx&#93;.dwHostNameLength, sizeof szHostName<br />mov &#91;edx&#93;.nPort, 0 ;--<br />mov &#91;edx&#93;.lpszUserName, offset szUserName<br />mov &#91;edx&#93;.dwUserNameLength, sizeof szUserName<br />mov &#91;edx&#93;.lpszPassword, offset szPassword<br />mov &#91;edx&#93;.dwPasswordLength, sizeof szPassword<br />mov &#91;edx&#93;.lpszUrlPath, offset szUrlPath<br />mov &#91;edx&#93;.dwUrlPathLength, sizeof szUrlPath<br />mov &#91;edx&#93;.lpszExtraInfo, offset szExtraInfo<br />mov &#91;edx&#93;.dwExtraInfoLength, sizeof szExtraInfo<br />assume edx&#58; nothing<br /><br />invoke lstrlen, addr szUrl<br />invoke InternetCrackUrl, addr szUrl, eax, ICU_DECODE, addr URLComponents<br /><br />invoke MessageBox, 0, addr szScheme, 0, 0	;protocol scheme name - 'http'<br />invoke MessageBox, 0, addr szHostName, 0, 0	;hostname - 'www.whatever.com'<br />invoke MessageBox, 0, addr szUrlPath, 0, 0	;url path - '/user/test.zip'<br /><br />invoke ExitProcess, 0<br /><br />end start</code></pre>for more info see:<a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/workshop/networking/wininet/reference/functions/internetcrackurl.asp">http://msdn.microsoft.com/library/default.asp?url=/workshop/networking/wininet/reference/functions/internetcrackurl.asp</a></div>
    <div class="meta">Posted on 2002-07-16 06:21:22 by savage</div>
   </div>
   <div class="post" id="post-47887">
    <div class="subject"><a href="#post-47887">Parsing an address</a></div>
    <div class="body">Isn't it a bit overkill to use a API for that?<br /><br />If you want REAL overkill, use Instr &amp; Mid functions from Masm32.lib :tongue:</div>
    <div class="meta">Posted on 2002-07-16 06:36:14 by bazik</div>
   </div>
   <div class="post" id="post-47888">
    <div class="subject"><a href="#post-47888">Parsing an address</a></div>
    <div class="body">ChimpFace9000 was asking if there was a windows function for it. And InternetCrackUrl does exactly that.<br /><br />It is indeed kinda overkill<br />but hey, it does the job :grin:</div>
    <div class="meta">Posted on 2002-07-16 06:44:10 by savage</div>
   </div>
   <div class="post" id="post-47890">
    <div class="subject"><a href="#post-47890">Parsing an address</a></div>
    <div class="body">Hehe :)<br /><br />Well, I posted this source, because I am sure he wants to learn more about parsing. Basically, you just move bytes until you found a sort of &quot;delimiter&quot;. Then you skip it and move on with moving bytes (in another buffer of course).<br /><br />I know, that my above code has some space for improvments, because the basic loop is repeating. But I prefer it that way.<br />It's easy to understand, looks clear, doesn't use any &quot;strange&quot; instructions and is a lot faster than the same function in *any* HLL :)<br /><br />Just my ?0.02 worth...</div>
    <div class="meta">Posted on 2002-07-16 06:55:23 by bazik</div>
   </div>
   <div class="post" id="post-51495">
    <div class="subject"><a href="#post-51495">in c</a></div>
    <div class="body">hello, i tried translating it to C but seems i missed something InternetCrackUrl returns 0 and GetLastError says i have on parameter incorrect, here is the source<br /><br />#include &lt;stdio.h&gt;<br />#include &lt;stdlib.h&gt;<br />#include &lt;string.h&gt;<br />#include &lt;windows.h&gt;<br />#include &lt;wininet.h&gt;<br /><br />#define MAXBUF 255<br />URL_COMPONENTSA url;<br />char buffer[200]={0};<br /><br />main()<br />{<br />url.dwStructSize = sizeof(URL_COMPONENTSA);<br />url.lpszScheme=INTERNET_MAX_SCHEME_LENGTH;<br />url.dwSchemeLength=sizeof(INTERNET_MAX_SCHEME_LENGTH);<br />url.nScheme=INTERNET_SCHEME_DEFAULT;<br />url.lpszHostName=INTERNET_MAX_HOST_NAME_LENGTH;<br />url.dwHostNameLength=sizeof(INTERNET_MAX_HOST_NAME_LENGTH);<br />url.nPort =0;<br />url.lpszUserName=INTERNET_MAX_USER_NAME_LENGTH;<br />url.dwUserNameLength=sizeof(INTERNET_MAX_USER_NAME_LENGTH);<br />url.lpszPassword=INTERNET_MAX_PASSWORD_LENGTH;<br />url.dwPasswordLength=sizeof(INTERNET_MAX_PASSWORD_LENGTH);<br />url.lpszUrlPath=INTERNET_MAX_PATH_LENGTH;<br />url.dwUrlPathLength=sizeof(INTERNET_MAX_PATH_LENGTH);<br />url.lpszExtraInfo=MAXBUF;<br />url.dwExtraInfoLength=sizeof(MAXBUF);<br /><br />InternetCrackUrl(&quot;http://www.whatever.com/user/test.zip&quot;,strlen(&quot;http://www.whatever.com/user/test.zip&quot;),ICU_DECODE,&amp;url);<br />wsprintf(buffer,&quot;%s-%s-%s&quot;,url.lpszScheme,url.lpszHostName,url.lpszUrlPath);<br />MessageBox(0,buffer,buffer,0);<br /><br /><br />	return 0;<br />}<br /><br />if someone sees anything wrong with the parameters please tell me, thanks in advance =)</div>
    <div class="meta">Posted on 2002-08-03 10:39:09 by The Keeper</div>
   </div>
   <div class="post" id="post-51598">
    <div class="subject"><a href="#post-51598">Parsing an address</a></div>
    <div class="body">You see it seems to me that InternetCrackUrl is very strange API. For example when I parse  <a target="_blank" href="http://www.hostname.com/index.html">http://www.hostname.com/index.html</a><br />it puts me:<br />protocol = <a target="_blank" href="http://">http://</a><br />host=www.hostname.com<br />path=/index.html<br />Good. But when I change url to <a target="_blank" href="www.hostname.com/index.html">www.hostname.com/index.html</a><br />it returns me only empty strings.<br />In my programs I use this code:<br /><br />**************************<br />; ###############################################################################<br />ParseUrl proc<br />	LOCAL bBuf[260]:BYTE<br />	;LOCAL protLen:DWORD, hostLen:DWORD, pathLen:DWORD, fileLen:DWORD<br /><br />	; Detect protocol presence<br />	push esi<br />      mov esi, offset szUrl<br />	.while (eax)<br />		.if byte ptr  == ':'<br />			.break<br />		.endif<br />     	      dec	eax<br />           	inc	esi<br />      .endw<br />	.if eax!=0 &amp;&amp; byte ptr  == '/' &amp;&amp; byte ptr  == '/'<br />		add esi, 3<br />	.else<br />		invoke lstrcpy, addr bBuf, CStr(&quot;http://&quot;)<br />		invoke lstrcat, addr bBuf, offset szUrl<br />		invoke lstrcpy, offset szUrl, addr bBuf<br />	      mov esi, offset szUrl<br />		add esi, 7<br />	.endif<br />	;invoke MessageBox, 0, esi, offset appName, 0<br /><br />	; Find file name<br />      invoke lstrlen, addr szUrl<br />      mov	esi, offset szUrl<br />      add	esi, eax<br />	.while (eax)<br />		.if byte ptr  == '/' || byte ptr == '\'<br />			.break<br />		.endif<br />     	      dec	eax<br />           	dec	esi<br />      .endw<br />	inc esi<br />	invoke lstrcpy, offset fileName1, esi<br />	pop esi<br /><br />	ret<br />ParseUrl endp<br />**************************<br />Please note that it's a minimal version of this program but everybody can add another strings. E.g. if you must know name of protocol add<br />cmp dword ptr , &quot;PTTH&quot;     ; for HTTP<br />cmp dword ptr , &quot;:PTF&quot;       ; for FTP<br />and so on.<br /><br />Mike</div>
    <div class="meta">Posted on 2002-08-04 05:25:50 by Mike</div>
   </div>
  </div>
 </body>
</html>