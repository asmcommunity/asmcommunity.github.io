<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Treeview with Background Image - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13691" />
  <link rel="prev" href="../?id=13691&amp;page=4" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=13691">Treeview with Background Image</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=13691&amp;page=1" style="">&laquo;</a><a href="../?id=13691&amp;page=4" style="">&lt;</a><input type="hidden" name="id" value="13691" /><input type="number" name="page" min="1" max="5" step="1" value="5" onchange="this.form.submit();" /></form>   <div class="post" id="post-116300">
    <div class="subject"><a href="#post-116300">Treeview with Background Image</a></div>
    <div class="body">QvasiModo,<br />can u show me the code for changing an item's default blue surrounding rectangle color? (not item's text color/bk)<br />u have too many inc files :D<br />i want to implement that in a listview control.<br /><br />btw,<br />you app crashes when setting the 4th algorithm on WinXP SP1<br />thnx</div>
    <div class="meta">Posted on 2003-08-30 17:15:49 by wizzra</div>
   </div>
   <div class="post" id="post-116458">
    <div class="subject"><a href="#post-116458">Treeview with Background Image</a></div>
    <div class="body">In TreeProc.inc you have all code related to handling the treeview window procedure. There you will find in the TreeProc procedure, the code to process WM_NOTIFY messages. I't's the items owner drawn messages that you have to handle. Listviews work exactly the same way, but the constant and structure names are slightly different, you will find all the differences in MSDN.<br /><br />Remember that in this particular project, WM_NOTIFY in handled in the treeview procedure because <em>I made the the dialog proc forwards those messages</em>. In a normal situation you would handle them in the <em>parent<em> window's procedures instead (no need to subclass).</div>
    <div class="meta">Posted on 2003-09-01 09:46:46 by QvasiModo</div>
   </div>
   <div class="post" id="post-116924">
    <div class="subject"><a href="#post-116924">Treeview with Background Image</a></div>
    <div class="body"><div class="quote"><br />btw,<br />you app crashes when setting the 4th algorithm on WinXP SP1<br />thnx </div><br />I was unable to reproduce the bug... could you please give more info? (exactly how and when this happens, etc.). It would also be nice if you load the program with a debugger and tell me where in the code is the GPF. :)</div>
    <div class="meta">Posted on 2003-09-04 12:46:37 by QvasiModo</div>
   </div>
   <div class="post" id="post-116944">
    <div class="subject"><a href="#post-116944">Treeview with Background Image</a></div>
    <div class="body">after reboot the app didn't crashed anymore..</div>
    <div class="meta">Posted on 2003-09-04 14:13:17 by wizzra</div>
   </div>
   <div class="post" id="post-116950">
    <div class="subject"><a href="#post-116950">Treeview with Background Image</a></div>
    <div class="body">Vain attempt at converting this into a RadAsm custom control... it GPFs right after WM_CREATE is processed.<br />Any help? :(</div>
    <div class="meta">Posted on 2003-09-04 14:24:58 by QvasiModo</div>
   </div>
   <div class="post" id="post-124508">
    <div class="subject"><a href="#post-124508">Blow the dust off.</a></div>
    <div class="body"><div class="quote"><br />Hi, I'm back from a nearly one week episode of flu (not completely over yet :grin: ).<br />I'm posting here my (probably last) version of the treeview thing. I got bored, really. If someone comes up with the solution to the double click problem I'll update, but I don't feel like working on it anymore. :( <br />As for the listview problems, how is it going? Are you implementing the FAT idea? We could do it here in the board, since code for a custom heap could be reusable, it would help a lot of people (and sure would be fun to code it :) ). </div><br /><br />You're back, or were SOOO long ago, so am I, on and off.  I've been overbusy, plus had a slight difficulty in connecting (operation on shoulder, prevented me from being at keyboard a lot).  And I got into programming other projects further.  Finished one (not the one I wanna finish), but one that needed to be, another is on the go (an ack, anti spam filter).  I do want to get to that FAT (or RAT since it's ram really), actually prototyped the structures, figured out how they're used, what functions are needed to add/delete/cleanup the table, etc.<br /><br />Just to get time to start writing the code.<br /><br />Sorry to hear you're giving up on that treeview.  (I guess you have to try something new too.)<br /><br />Wow, it's been months.  :(  Atleast now I can be back at a regular interval.</div>
    <div class="meta">Posted on 2003-11-16 09:01:07 by FunkyMeister</div>
   </div>
   <div class="post" id="post-124597">
    <div class="subject"><a href="#post-124597">Re: Blow the dust off.</a></div>
    <div class="body">Long time no see... :)<br /><br /><div class="quote"><br /><br /><br />You're back, or were SOOO long ago, so am I, on and off.  I've been overbusy, plus had a slight difficulty in connecting (operation on shoulder, prevented me from being at keyboard a lot).</div><br />Sorry to hear that... :( Hope you get well soon.<br /><div class="quote"><strong><br />  And I got into programming other projects further.  Finished one (not the one I wanna finish), but one that needed to be, another is on the go (an ack, anti spam filter).  I do want to get to that FAT (or RAT since it's ram really), actually prototyped the structures, figured out how they're used, what functions are needed to add/delete/cleanup the table, etc.<br /><br />Just to get time to start writing the code.<br /></div><br />Sure, it's a great idea to have a high performance virtual list view. Post the structures, I'm really interested! :alright:<br /><div class="quote"><strong><br />Sorry to hear you're giving up on that treeview.  (I guess you have to try something new too.)<br /></div><br />Well, that treeview thing was pretty much of a dead end, since each version of the common controls had so many little differences, and one had to handle them all. Coding a fully custom draw treeview was much safer, and maybe not so much more trouble... ;)<br /><div class="quote"><strong><br />Wow, it's been months.  :(  Atleast now I can be back at a regular interval. </div><br />Hey, welcome back. We've been missing you. :)</div>
    <div class="meta">Posted on 2003-11-17 11:27:22 by QvasiModo</div>
   </div>
   <div class="post" id="post-124602">
    <div class="subject"><a href="#post-124602">Treeview with Background Image</a></div>
    <div class="body">I did not read all replies (6 pages :) ) but i wanted to make a mark about the painting process.<br /><br />I think that you should draw the bitmap during WM_ERASEBKGND.<br />Use GetClipBox() api to determine invalid range and draw that part onto the DC.<br /><br />Let Windows paint the items itself..</div>
    <div class="meta">Posted on 2003-11-17 11:37:18 by Edwin Knoppert</div>
   </div>
   <div class="post" id="post-124604">
    <div class="subject"><a href="#post-124604">Treeview with Background Image</a></div>
    <div class="body">Don't worry, I don't remember all replies (6 pages :grin: )<br />Anyway I vaguely remember that wasn't working because the treeview control was overwriting anything you did during WM_ERASEBKGND. But it's worth trying anyway. :)</div>
    <div class="meta">Posted on 2003-11-17 11:39:48 by QvasiModo</div>
   </div>
   <div class="post" id="post-124626">
    <div class="subject"><a href="#post-124626">Re: Re: Blow the dust off.</a></div>
    <div class="body"><div class="quote"><br />Long time no see... :)<br /><br />Sorry to hear that... :( Hope you get well soon.<br /></div><br /><br />Only time will tell on that I'm afraid.  But, I'm optimistic that I can atleast keep computing, other stuff will be with pain, but, life is pain so I just keep living.  :)<br /><br /><div class="quote"><br />Sure, it's a great idea to have a high performance virtual list view. Post the structures, I'm really interested! :alright:<br /></div><br /><br />Here it is:  (No committing suicide over it, please!)<br /><br />Memory RAT:<br /><br /><br />Control Block:<br /><br />	Comment:  Block used to record memory usage of Data &amp; Data Control blocks<br />		Size:  1024k Static<br />	 Format:<br /><br />	00000000h	Pointer to next Control Block.<br />	00000004h	Pointer to next Data Control Block.<br />	00000008h	Next location of NEW Data Element structure.<br />	0000000Ch	to 000FFFFFh contains Data Element structures.<br /><br />Data Control Block:<br /><br />	Comment:  Block used to keep track of memory allocs. 2,147,483,647 max per chunk.<br />		Size:  64k Static<br />	 Format:<br /><br />	0000h				Next location of NEW Data Usage structure.<br />	0004h	to FFFFh Contains Data Usage structures.<br /><br /><br />Data Usage Structure<br /><br />	0000h	Alloc		Address of the allocated chunk<br />	0004h	Pointer	Address to the next available large chunk<br />	0008h	Size		Size of the available chunk<br /><br />Data Element Structure<br /><br />	0000h	Pointer	Pointer to the chunk (within a Data block)<br />	0004h	Size		Size of chunk.<br />	0008h	Flags		Flags consisting of only 1 bit (31 reserved, else available).<br />						<br />						Bit 31 used to denote if the data chunk is used (1 if used, 0 if not).<br /><br /><br />Notes:<br /><br />Using 1 meg alloc sizes for Data Blocks, with one Data Control block, you can handle 22,905,094,144 bytes in Data Blocks.<br />The large Control Block size allows for 87380 entries before a new block is needed.<br />Data Control Blocks will rarely need to be added due to their size and how much information they can control.<br /><br /><br />Routines needed:<br /><br />Internal:<br /><br />	Cleanup	Scan Control Blocks and merge data chunks if possible, moving all &quot;unallocated&quot; memory chunks to the end of the LAST Control Block.<br />				(ICB)<br />	cAlloc	Alloc a new Control Block and link to previous (if ICB is not null).<br />				(ICB)<br />	bAlloc	Alloc Data Control Block for the last Control Block (or first if no next).  Always do this, no return code if this finds no unalloced Control Blocks.<br />				(CB)<br />	dAlloc	Alloc Data Block for the next Data Control Block's Data Usage (or first if no next).  This will get called if the first Data Control Block has no Data Block or the element prior has no free space for the new element.<br />				(CB)<br />	mAlloc	Scan Control Blocks for available Data Block space for requested size, doing the following:<br />				Check ICB for a Data Control Block, if not, call bAlloc(CB)<br />				Check LAST Data Control Blocks for a Data Block, if not, call dAlloc(CB)<br />				Check LAST Data Control Block's Data Block for space, if not, call dAlloc(CB) for a new one.<br />				Repeat <br />				Check Control Block for space on where to put Length, if no space available, call cAlloc(ICB).<br />				Repeat <br />				(ICB, Length)<br />				Calls AddEntry to retrieve the pointer of the newly created Data Element structure to return.<br />	AddEntry	Calls Cleanup to clean up the Control Blocks before attempting to find a new Data Element location.<br />				Returns the LAST Control Block's pointer to the next Data Element (OR creates a new Data Control Block if no space exists for one).<br />				(CB, Pointer, Length)<br />	Find		Finds the Item # throughout the Control Blocks.<br />				(ICB, Item #)<br />				Returns a pointer to the Data Element or null if it didn't find it.<br />	DelEntry	Takes the current item, adds it to the end of the LAST Data Control Block, then moves ALL entries up one position, cross Data Control Block moving, until the last item is reached (which is &quot;unallocated&quot; before it's moved).<br />				(ICB, Item #)<br />				Returns TRUE if it found it, NULL if it didn't.<br />	InsEntry Checks LAST Data Control Block for entry space, if not, call cAlloc.  <br />				Checks LAST Data Control Block for entry space, if not, fail.  (Memory constraints)<br />				Rolls last item of full Control Block onto the next one (and repeats) until the entire list is rolled up one item #.<br />				(ICB, Item #, Length)<br />				Returns either the pointer to the Data Element structure or null if it couldn't insert (Memory constraints)<br /><br />External:<br /><br />	Init		Setup the Initial Control Block ONLY, the allocs of new Data Control blocks is done when an item is added.  As is the Data block.  The first element added will be the slowest.<br />				(AllocSize)  AllocSize should be 1 meg or higher, it'll cut down on massive allocs.  If null, defaults to 1 meg.<br />				Returns pointer to Initial Control Block (used when you communicate with it, called ICB).<br />	Add		Add element (this is a 1D array).  The user can break the data up using nulls, since the Add requires a length. <br />				(ICB, Pointer, Length)<br />				Returns TRUE if it worked or FALSE if it failed (fails usually only with memory or length at 0).<br />	Edit		Edit the element that is selected, the current element can be smaller or larger, when larger, the original memory chunk is &quot;freed&quot; and new memory is &quot;allocated&quot; for that slot.<br />				(ICB, Item #, Pointer, Length)<br />				Returns TRUE if it worked or FALSE if it failed (fails usually only with memory or length at 0).  If a failure happens, the original is untouched.<br />	Get		Retrieve the item #, returns either null if it couldn't find it, or a pointer to the Data Element structure of the item.<br />				(ICB, Item #)<br /><br />	GetBits	Retrieve the item #'s bits (0 to 30, 31 reserved), this is used instead of retrieving them via the internal structure.<br />				(Item Pointer)  &lt;-  Must be an Item Pointer, from the Get function (since using the find more than once on an item is stupid).<br />				Returns TRUE if it worked, or FALSE if it didn't work (invalid Item Pointer).<br /><br />	SetBits	Set the item #'s bits (0 to 30, 31 reserved).  Same as GetBits.<br />				(Item Pointer)  &lt;-  Must be an Item Pointer, from the Get function (since using the find more than once on an item is stupid).<br />				Returns TRUE if it worked, or FALSE if it didn't work (invalid Item Pointer).<br /><br />		Insert an item at the Item # location.<br />				(ICB, Item #, Pointer, Length) See Add for info.  <br /><br />	Delete	Delete the item #, returns either null if it failed (couldn't find it) or TRUE if it deleted the item.<br />				(ICB, Item #)<br /><br />	Destroy	Destroy the entire set of data (the fast part, it goes through all of the Data Blocks present, removing them, then all the Data Control Blocks and finally all the Control Blocks).<br />				(ICB)<br />				Returns TRUE if it found the ICB and destroyed it, or FALSE if it didn't.<br /><br />----<br /><br />Just some light reading.  :D  (I've attached the RATproto.txt file, since this seems to eat the formatting.  Feel free to mull it over and see if there's any better way to do this.)<br /><br />Above is the RAT Prototyping I did, basically it's how the memory storage/retrieval system works.  Well, in theory anyways.  :)  I've not actually delved into that brain intensive work yet.<br /><br /><div class="quote"><br />Well, that treeview thing was pretty much of a dead end, since each version of the common controls had so many little differences, and one had to handle them all. Coding a fully custom draw treeview was much safer, and maybe not so much more trouble... ;)<br /></div><br /><br />Does that mean you're going to make a custom treeview?  (Possibly work RAT into it?)  I know, RAT.  FAT for files, RAT for ram.  (MAT just sounded, silly, RAT sounds nasty, nasty is better than silly.  Well, in most cases.)<br /><br /><div class="quote"><br />Hey, welcome back. We've been missing you. :) </div><br /><br />I've been missing this place because of the work I still have yet to do.  I want to get winsock patching done still, so I can check for calls going in and out, but I also need to interject urls, so I can tell what url is being asked for.  Thats the hard one.<br /><br />FM.</div>
    <div class="meta">Posted on 2003-11-17 15:24:39 by FunkyMeister</div>
   </div>
   <div class="post" id="post-124660">
    <div class="subject"><a href="#post-124660">Treeview with Background Image</a></div>
    <div class="body">O, ok..<br /><br />I can imagne, for listview and treeview is so differently handled by the common controls.<br />The ownerdraw part should be used instead i guess.<br /><br />I ever wrote a treeview similar as the OutLook Express message counter (the colored number near the newsgroup entry).<br /><br />But it seems it works ok at this time?</div>
    <div class="meta">Posted on 2003-11-18 05:05:58 by Edwin Knoppert</div>
   </div>
   <div class="post" id="post-124849">
    <div class="subject"><a href="#post-124849">Treeview with Background Image</a></div>
    <div class="body"><div class="quote"><br />O, ok..<br /><br />I can imagne, for listview and treeview is so differently handled by the common controls.<br />The ownerdraw part should be used instead i guess.<br /><br />I ever wrote a treeview similar as the OutLook Express message counter (the colored number near the newsgroup entry).<br /><br />But it seems it works ok at this time? </div><br /><br />Without doing the ownerdrawn part, it's only capable of handling 32767 entries (sanely), when I have files that have over 150,000 entries.  Somewhat won't work with anything else.<br /><br />So a method of recording mass data storage fast, is necessary to ensure how fast it works.</div>
    <div class="meta">Posted on 2003-11-19 17:40:09 by FunkyMeister</div>
   </div>
   <div class="post" id="post-128976">
    <div class="subject"><a href="#post-128976">Update</a></div>
    <div class="body">Updated version. Some silly changes and fixes.<br />The big change is that it's now located in it's own DLL file, so it should be easier to include it in your apps without having to mess with the sources.</div>
    <div class="meta">Posted on 2003-12-26 11:27:59 by QvasiModo</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=13691&amp;page=1" style="">&laquo;</a><a href="../?id=13691&amp;page=4" style="">&lt;</a><input type="hidden" name="id" value="13691" /><input type="number" name="page" min="1" max="5" step="1" value="5" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>