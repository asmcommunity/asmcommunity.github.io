<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Macro for string concantenation - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=6392" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=6392">Macro for string concantenation</a></p>
   <div class="post" id="post-45979">
    <div class="subject"><a href="#post-45979">Macro for string concantenation</a></div>
    <div class="body">Something I have to do a lot is append strings to other strings and while I know how to do it, its still a lot of typing so in conjunction with the szMultiCat procedure that Alexander Yackubtchik (The Svin) wrote , I have popped a small macro that takes a lot of the drudgery out of concntenating strings.<br /><pre><code><br />  ; ------------------------------------------------------<br />  ; macro for concantenating strings using the szMultiCat<br />  ; procedure written by Alexander Yackubtchik.<br />  ;<br />  ; USAGE strcat buffer,str1,str2,str3 etc ...<br />  ; <br />  ; buffer must be large enough to contain all of the<br />  ; strings to append. Limit is set by maximum line<br />  ; length in MASM.<br />  ; ------------------------------------------------------<br />    strcat MACRO arguments&#58;VARARG<br />        txt equ &lt;invoke szMultiCat,&gt;        ;; lead string<br />        pcount = 0<br />          FOR arg, &lt;arguments&gt;<br />            pcount = pcount + 1             ;; count arguments<br />          ENDM<br />        % pcount = pcount - 1               ;; dec 1 for 1st arg<br />        txt CATSTR txt,%pcount              ;; append number to lead string<br />          FOR arg, &lt;arguments&gt;<br />              txt CATSTR txt, &lt;,ADDR arg&gt;   ;; append 'ADDR' + args<br />          ENDM<br />        txt                                 ;; put result in code<br />    ENDM<br /></code></pre><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-07-01 12:41:27 by hutch--</div>
   </div>
   <div class="post" id="post-45987">
    <div class="subject"><a href="#post-45987">Macro for string concantenation</a></div>
    <div class="body">Good idea - i have done this too.  However to avoid bloat i wrote a &quot;C&quot; library functin and modified the macro like so...<br /><br /><pre><code>strcat macro _dest&#58;req, _src&#58;req, _list&#58;vararg<br />    ifb &lt;_list&gt;<br />        invok lstrcat, _dest, _src<br />    else<br />        invok _strcat, _dest, $argc&#40;_src, _list&#41;, _src, _list<br />    endif<br />endm<br /><br />then i modified my strcpy macro also<br /><br />strcpy macro _dest&#58;req, _src&#58;req, _list&#58;vararg<br />    ifnb &lt;_list&gt;<br />        push eax<br />        invok lstrcpy, _dest, _src<br />        pop eax<br />        invok _strcat, _dest, $argc&#40;_list&#41;, _list<br />    else<br />        invok lstrcpy, _dest, _src<br />    endif<br />endm<br /><br />** the push/pop eax is needed to allow for a macro function in the list<br /><br />strcpy dest, v1, v2, func&#40;v3&#41;<br /><br />the lstrcpy call would trash eax - the return vlue.</code></pre><br /><br />Actually i have wrappers for all the str*** functions (strcmp, strdel ...) because they're so common.</div>
    <div class="meta">Posted on 2002-07-01 13:27:09 by gfalen</div>
   </div>
   <div class="post" id="post-46014">
    <div class="subject"><a href="#post-46014">Macro for string concantenation</a></div>
    <div class="body">I have had a bit of time to play with this macro and added a few others. The extra 2 are str$() and hex$() ALA basic commands. I have modified the strcat macro so it will take either the name of a string buffer or ADDR name so that it can accept other macros that return ADDR name.<br /><br />The macro is case sensitive with ADDR and as mentioned before, the MASM line limit is the limit on how much can be appended to the original string buffer.<br /><br />It can do stuff like,<br /><pre><code><br />    mov buffer&#91;0&#93;, 0<br />    strcat buffer, SADD&#40;&quot;hInstance = &quot;&#41;, hex$&#40;hInstance&#41;, SADD&#40;&quot; hex&quot;&#41;<br />    invoke SetWindowText,hWnd,ADDR buffer<br /></code></pre><br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a><br /><pre><code><br />  ; ------------------------------------------------------<br />  ; macro for concantenating strings using the szMultiCat<br />  ; procedure written by Alexander Yackubtchik.<br />  ;<br />  ; USAGE strcat buffer,str1,str2,str3 etc ...<br />  ; <br />  ; buffer must be large enough to contain all of the<br />  ; strings to append. Limit is set by maximum line<br />  ; length in MASM.<br />  ; ------------------------------------------------------<br />    strcat MACRO arguments&#58;VARARG<br />      txt equ &lt;invoke szMultiCat,&gt;        ;; lead string<br />      pcount = 0<br />        FOR arg, &lt;arguments&gt;<br />          pcount = pcount + 1             ;; count arguments<br />        ENDM<br />      % pcount = pcount - 1               ;; dec 1 for 1st arg<br />      txt CATSTR txt,%pcount              ;; append number to lead string<br />        FOR arg, &lt;arguments&gt;<br />          IF @InStr&#40;1,&lt;arg&gt;,&lt;ADDR&gt;&#41; ne 0<br />            txt CATSTR txt, &lt;,arg&gt;<br />          ELSE<br />            txt CATSTR txt, &lt;,ADDR arg&gt;   ;; append 'ADDR' + args<br />          ENDIF<br />        ENDM<br />      txt                                 ;; put result in code<br />    ENDM<br /><br />  ; ----------------------------------------------------------<br />  ; function position macros that takes a DWORD parameter and<br />  ; returns the address of the buffer that holds the result<br />  ; ----------------------------------------------------------<br />    str$ MACRO DDvalue<br />      LOCAL rvstring<br />      .data<br />        rvstring db 20 dup &#40;0&#41;<br />      .code<br />      invoke dwtoa,DDvalue,ADDR rvstring<br />      EXITM &lt;ADDR rvstring&gt;<br />    ENDM<br /><br />    hex$ MACRO DDvalue<br />      LOCAL rvstring<br />      .data<br />        rvstring db 12 dup &#40;0&#41;<br />      .code<br />      invoke dw2hex,DDvalue,ADDR rvstring<br />      EXITM &lt;ADDR rvstring&gt;<br />    ENDM<br /><br /></code></pre></div>
    <div class="meta">Posted on 2002-07-01 17:27:46 by hutch--</div>
   </div>
   <div class="post" id="post-46024">
    <div class="subject"><a href="#post-46024">Macro for string concantenation</a></div>
    <div class="body">When you go to write another macro that calls a C routine you gotta get the argcount again.  And when you wanna write strcmp, strdel, strstr... you're gonna have to do more for/endm loops.  Better you should have some &quot;helper&quot; macros to do all this routine housekeeping for you.  Like<br /><br />$argc() - returns arg count<br />invok    - combines args and &quot;invokes&quot; function<br />@invok - &quot;function&quot; form of invok<br /><br />... just to name a few.  Also it woulld'nt hurt to have invoke check for &quot;literals&quot; and declare them on the fly.<br /><br />In the recent thtead on &quot;switch/case&quot; i posted my 2 macro files - masm.inc &amp; macs32.inc.  They have all this in them and much more.  Let me know if you don't have them.  I'll repost &amp; you can scavenge from there and save yourself a lot of typing.</div>
    <div class="meta">Posted on 2002-07-01 18:14:55 by gfalen</div>
   </div>
   <div class="post" id="post-46050">
    <div class="subject"><a href="#post-46050">Macro for string concantenation</a></div>
    <div class="body">Greg,<br /><br />I think your idea is a good one but I have to keep in mind the people who are going to use the macros and interdependent macros are very hard for beginners to understand.<br /><br />I know there is a trend around to HIDE as much as possible from the programmer but it is exactly the opposite of what I designed in the first place with MASM32 to reveal as much as possible to programmers who are using it.<br /><br />Much of what many people hate about the modern C++ include files is thw near imppossibility of tracking how they hang together because of the multiple dependencies.<br /><br />What I am inclined to do with macros is keep them as self contained as possible so that each one makes sense in itself. The excellent set of macros you designed for the &quot;switch/case&quot; functionality is a self contained set of macros that do not have any great interdependence on outside functions.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-07-02 02:09:56 by hutch--</div>
   </div>
  </div>
 </body>
</html>