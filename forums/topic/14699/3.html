<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>PE optimizing - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14699" />
  <link rel="prev" href="../?id=14699&amp;page=2" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=14699">PE optimizing</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=14699&amp;page=1" style="">&laquo;</a><a href="../?id=14699&amp;page=2" style="">&lt;</a><input type="hidden" name="id" value="14699" /><input type="number" name="page" min="1" max="3" step="1" value="3" onchange="this.form.submit();" /></form>   <div class="post" id="post-139350">
    <div class="subject"><a href="#post-139350">PE optimizing</a></div>
    <div class="body">Ok, the bug is caused by SizeOfImage. I couldn't determine what values exactly don't work, but everything over 0FFh is dangerous. It will reboot or generate a BLUE SCREEN of DEATH on most/every machine, as far as I can see all of them had SP1 (Service Pack 1 for XP) installed.<br /><br />I lowered SoI to a apperently safer value. However by doing this some space for code was lost and the Messagebox has less functionality now.<br /><br />There are about 30-40 bytes of space available in the 97 byte PE file. Although they aren't available in one piece and have to be connected by jumps. The largest blocks are 14 bytes and 12 bytes. Some additional tricks (add al, 0 ... load Gdi32 instead of User32 ... use IMAGEBASE for code) can be used to get a few more bytes, but that won't be a big help.<br /><br />It is basicly impossible to make a GUI/Msgbox version that works for every XP release. Every Service Pack and also the Bugfixes change the offset of kernel32/user32 functions, so direct addressing is specific to ONE release only. There simply isn't enough space to dynamicly load User32 and MsgBoxA. The strings alone take half the space.<br /><br />Therefore I made 3 EXE files, compiled for different XP versions. The sources states all the offsets I have found.<br /><br />USE AT OWN RISK (like always)<br /><br />H4ve Phun</div>
    <div class="meta">Posted on 2004-04-18 15:39:20 by pmpch</div>
   </div>
   <div class="post" id="post-139351">
    <div class="subject"><a href="#post-139351">PE optimizing</a></div>
    <div class="body">Greetings <strong>n u M I T_o r</strong>, Thanks for uploading <strong>133</strong>. I tested it on <strong>Win2kSp4</strong> and it runs perfectly!</div>
    <div class="meta">Posted on 2004-04-18 15:51:11 by Poimander</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=14699&amp;page=1" style="">&laquo;</a><a href="../?id=14699&amp;page=2" style="">&lt;</a><input type="hidden" name="id" value="14699" /><input type="number" name="page" min="1" max="3" step="1" value="3" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>