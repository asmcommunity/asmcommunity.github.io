<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>indexing html pages algo, expert help needed!! - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4933" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=4933">indexing html pages algo, expert help needed!!</a></p>
   <div class="post" id="post-34602">
    <div class="subject"><a href="#post-34602">indexing html pages algo, expert help needed!!</a></div>
    <div class="body">Hi there, <br /><br />i have an idea of making an indexing tool to index all words in a html document or something like that. But the point is i want to get this indexing algorithm working fast and good, i self think it's a good algo but it won't work yet because i'm not enough experienced in asm. The idea is to skip everything between the '&lt;' and '&gt;' tags and get the words that are separated by blank spaces ('  '). Like you can see below I can't filter well these to be indexed words from the html to the allocated memory and write it to an index file. But it will work with some assistent of you folks!! Here it comes: <br /><pre><code><br />&#91;code&#93;<br />.386<br />.model flat,stdcall<br />option casemap:none<br />WinMain proto :DWORD,:DWORD,:DWORD,:DWORD<br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\comdlg32.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\comdlg32.lib<br /><br />.const<br />IDM_OPEN equ 1<br />IDM_EXIT equ 2<br />MAXSIZE equ 260<br /><br />.data<br />ClassName db &quot;Index&quot;,0<br />AppName  db &quot;Index&quot;,0<br />MenuName db &quot;FirstMenu&quot;,0<br />ofn   OPENFILENAME &lt;&gt;<br />FilterString db &quot;All Files&quot;,0,&quot;*.*&quot;,0<br />             db &quot;Text Files&quot;,0,&quot;*.txt&quot;,0,0<br />buffer db &quot;c:\index.htm&quot;,0<br />buffer2 db &quot;c:\index2.htm&quot;,0<br />hMapFile HANDLE 0<br /><br />.data?<br />hInstance HINSTANCE ?<br />CommandLine LPSTR ?<br />hFileRead HANDLE ?<br />hFileWrite HANDLE ?<br />hMenu HANDLE ?<br />pMemory DWORD ?<br />SizeWritten DWORD ?<br /><br />mijnPointer DWORD ?<br />fileSize DWORD ?<br />hMem dd ?<br />pMem dd ?<br /><br />.code<br />start:<br />    invoke GetModuleHandle, NULL<br />    mov    hInstance,eax<br />    invoke GetCommandLine<br />    mov CommandLine,eax<br />    invoke WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT<br />    invoke ExitProcess,eax<br /><br />WinMain proc hInst:HINSTANCE,<br />             hPrevInst:HINSTANCE,<br />             CmdLine:LPSTR,<br />             CmdShow:DWORD<br />    LOCAL wc:WNDCLASSEX<br />    LOCAL msg:MSG<br />    LOCAL hwnd:HWND<br />    mov   wc.cbSize,SIZEOF WNDCLASSEX<br />    mov   wc.style, CS_HREDRAW or CS_VREDRAW<br />    mov   wc.lpfnWndProc, OFFSET WndProc<br />    mov   wc.cbClsExtra,NULL<br />    mov   wc.cbWndExtra,NULL<br />    push  hInst<br />    pop   wc.hInstance<br />    mov   wc.hbrBackground,COLOR_WINDOW+1<br />    mov   wc.lpszMenuName,OFFSET MenuName<br />    mov   wc.lpszClassName,OFFSET ClassName<br />    invoke LoadIcon,NULL,IDI_APPLICATION<br />    mov   wc.hIcon,eax<br />    mov   wc.hIconSm,eax<br />    invoke LoadCursor,NULL,IDC_ARROW<br />    mov   wc.hCursor,eax<br />    invoke RegisterClassEx, addr wc<br />    invoke CreateWindowEx,WS_EX_CLIENTEDGE,ADDR ClassName,<br />                          ADDR AppName,WS_OVERLAPPEDWINDOW,<br />                          CW_USEDEFAULT, CW_USEDEFAULT,<br />                          300,200,NULL,NULL,hInst,NULL<br />    mov   hwnd,eax<br />    invoke ShowWindow, hwnd,SW_SHOWNORMAL<br />    invoke UpdateWindow, hwnd<br />    .WHILE TRUE<br />        invoke GetMessage, ADDR msg,NULL,0,0<br />        .BREAK .IF (!eax)<br />        invoke TranslateMessage, ADDR msg<br />        invoke DispatchMessage, ADDR msg<br />    .ENDW<br />    mov     eax,msg.wParam<br />    ret<br />WinMain endp<br />WndProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />    .IF uMsg==WM_CREATE<br />        invoke GetMenu,hWnd<br />        mov  hMenu,eax<br />    .ELSEIF uMsg==WM_DESTROY<br />        .if hMapFile!=0<br />          invoke CloseHandle,hMapFile<br />          mov    hMapFile,0<br />          invoke CloseHandle,hFileRead<br />        .endif<br />        invoke PostQuitMessage,NULL<br />    .ELSEIF uMsg==WM_COMMAND<br />        mov eax,wParam<br />        .if lParam==0<br />            .if ax==IDM_OPEN<br />                invoke EnableMenuItem,hMenu,IDM_OPEN,MF_GRAYED<br />                invoke CreateFile,ADDR buffer,GENERIC_READ,0,NULL,OPEN_EXISTING,<br />                                  FILE_ATTRIBUTE_ARCHIVE,NULL<br />                mov hFileRead,eax<br />                invoke CreateFileMapping,hFileRead,NULL,PAGE_READONLY,0,0,NULL<br />                mov  hMapFile,eax<br />                mov    eax,OFFSET buffer<br />                movzx  edx,ofn.nFileOffset<br />                add    eax,edx<br />                invoke SetWindowText,hWnd,eax<br />                invoke CreateFile,ADDR buffer2,GENERIC_READ or GENERIC_WRITE,<br />                                  FILE_SHARE_READ or FILE_SHARE_WRITE,NULL,<br />                                  CREATE_NEW,FILE_ATTRIBUTE_ARCHIVE,NULL<br />                mov hFileWrite,eax<br />                invoke MapViewOfFile,hMapFile,FILE_MAP_READ,0,0,0<br />                mov pMemory,eax<br />                mov mijnPointer,eax<br />                invoke GetFileSize,hFileRead,NULL<br />                mov fileSize,eax<br />                mov ecx,fileSize<br />                mov al,&quot;&lt;&quot;<br />                mov edi,mijnPointer<br />                repnz scasb<br />                mov al,&quot;&gt;&quot;<br />                repnz scasb<br />                INVOKE GlobalAlloc,0,65535<br />                        mov hMem,eax<br />                        INVOKE GlobalLock,hMem<br />                        mov pMem,eax<br />                mov al,&quot;&lt;&quot;<br />                mov esi,edi<br />                mov edi,pMem<br />                rep movsb<br />                INVOKE GlobalUnlock,pMem<br />                        INVOKE GlobalFree,hMem<br />                invoke WriteFile,hFileWrite,pMemory,<br />                                 fileSize,ADDR SizeWritten,NULL<br />                invoke UnmapViewOfFile,pMemory<br />                invoke CloseHandle,hMapFile<br />                    mov    hMapFile,0<br />                    invoke CloseHandle,hFileRead<br />                invoke CloseHandle,hFileWrite<br />            .else<br />                invoke DestroyWindow, hWnd<br />            .endif<br />        .endif<br />    .ELSE<br />        invoke DefWindowProc,hWnd,uMsg,wParam,lParam<br />        ret<br />    .ENDIF<br />    xor    eax,eax<br />    ret<br />WndProc endp<br />end start<br />&#91;/code&#93;<br /><br />Added the formatting notation &quot;[&quot;,&quot;code&quot;,&quot;]&quot; and &quot;&quot; and changed the indenting so it reads more easily.</div>
    <div class="meta">Posted on 2002-04-23 03:15:49 by eisodur</div>
   </div>
   <div class="post" id="post-34624">
    <div class="subject"><a href="#post-34624">indexing html pages algo, expert help needed!!</a></div>
    <div class="body">Have a look at the procedure in the MASM32 library called &quot;StripRangeI&quot; as it will remove HTML tags with no problems. Just set the tweo bytes as &quot;&lt;&quot; and &quot;&gt;&quot; and it will remove everything betwen them and the &lt; &gt;.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-04-23 07:24:58 by hutch--</div>
   </div>
  </div>
 </body>
</html>