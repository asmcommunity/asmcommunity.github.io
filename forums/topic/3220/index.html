<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>I need a favour. - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3220" />
    <link rel="next" href="../?id=3220&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=3220">I need a favour.</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=3220&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=3220&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="3220" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=3220&amp;page=2">&gt;</a><a href="../?id=3220&amp;page=2">&raquo;</a></form>   <div class="post" id="post-21189">
    <div class="subject"><a href="#post-21189">I need a favour.</a></div>
    <div class="body">I have attached a zip file that has 2 EXE files in it that I need to test on both win2k and XP. I have tested them both on 95/98 and NT4 and they work fine and I need to see if they work on 2k/xp as well.<br /><br />To test them, unzip the file into a single directory which will leave you with 2 EXE files, MMFS.EXE and TESTMMF.EXE. Start MMFS.EXE and click on the 1st button on the toolbar. It should start the other EXE file TESTMMF.EXE.<br /><br />Click on the second button in MMFS.EXE and it should close the file TESTMMF.EXE.<br /><br />What I am testing is a combination of using a memory mapped file that is opened by both EXE files, passing the handles of both files to a location in the MMF and then direct messaging the TESTMMF.EXE app with a message to activate code that closes it using the handle passed to the MMF by TESTMMF.EXE.<br /><br />Any help here would be appreciated. Note that it will not work the other way around.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-01-25 19:44:39 by hutch--</div>
   </div>
   <div class="post" id="post-21194">
    <div class="subject"><a href="#post-21194">I need a favour.</a></div>
    <div class="body">Hutch, I'm sure you know this----but curiously looked at it in '98---and it opens multiple multiple instances of test window---yet only closes the last opened-----B</div>
    <div class="meta">Posted on 2002-01-25 20:00:13 by BradB</div>
   </div>
   <div class="post" id="post-21195">
    <div class="subject"><a href="#post-21195">I need a favour.</a></div>
    <div class="body"><strong>WinXP</strong>:<br />TESTMMF executes and closes, but with an error:<pre><code>---------------------------<br />Test File&#58; testmmf.exe - Application Error<br />---------------------------<br />The instruction at &quot;0x0040262d&quot; referenced memory at &quot;0x0040262d&quot;. The memory could not be &quot;read&quot;.<br /><br /><br />Click on OK to terminate the program<br />Click on CANCEL to debug the program<br />---------------------------<br />OK   Cancel   <br />---------------------------</code></pre>Then when I exit MMFS, I get another error:<pre><code>---------------------------<br />Memory mapped files&#58; MMFS.EXE - Application Error<br />---------------------------<br />The instruction at &quot;0x00402561&quot; referenced memory at &quot;0x00402561&quot;. The memory could not be &quot;read&quot;.<br /><br /><br />Click on OK to terminate the program<br />Click on CANCEL to debug the program<br />---------------------------<br />OK   Cancel   <br />---------------------------</code></pre></div>
    <div class="meta">Posted on 2002-01-25 20:00:26 by bitRAKE</div>
   </div>
   <div class="post" id="post-21196">
    <div class="subject"><a href="#post-21196">I need a favour.</a></div>
    <div class="body">Hi Hutch--<br /><br />Works well on XP. I have some trouble wit my 2k installation so I was not able to test it on 2k.<br /><br />KetilO</div>
    <div class="meta">Posted on 2002-01-25 20:02:33 by KetilO</div>
   </div>
   <div class="post" id="post-21200">
    <div class="subject"><a href="#post-21200">I need a favour.</a></div>
    <div class="body">no prb with w2k..<br />like bradb said, it close last instance only.</div>
    <div class="meta">Posted on 2002-01-25 20:25:00 by kamilh</div>
   </div>
   <div class="post" id="post-21202">
    <div class="subject"><a href="#post-21202">I need a favour.</a></div>
    <div class="body">Got exactly the same error that <strong>bitRake</strong> on Win2K<br /><br /><pre><code><br />---------------------------<br />Test File&#58; TESTMMF.EXE - Application Error<br />---------------------------<br />The instruction at &quot;0x0040262d&quot; referenced memory at &quot;0x0040262d&quot;. The memory could not be &quot;read&quot;.<br /></code></pre><br /><br /><pre><code><br />---------------------------<br />Memory mapped files&#58; MMFS.EXE - Application Error<br />---------------------------<br />The instruction at &quot;0x00402561&quot; referenced memory at &quot;0x00402561&quot;. The memory could not be &quot;read&quot;.<br /></code></pre><br /><br />Both where at the exit of the programs.</div>
    <div class="meta">Posted on 2002-01-25 20:25:56 by dxantos</div>
   </div>
   <div class="post" id="post-21204">
    <div class="subject"><a href="#post-21204">I need a favour.</a></div>
    <div class="body">Guys,<br /><br />Thanks for testing this stuff for me, the multiple instance on is no problem as the last one opened will overwrite the handle at the address set aside for the handle of the second prog.<br /><br />I am shutting down the MMF according to the documentation I have so it looks like win2k does something different in the way it handles memory mapped files so I will have to look for a work around to test if the memory mapped file is still valid when either or both apps close.<br /><br />Regards &amp; Thanks<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-01-25 20:37:20 by hutch--</div>
   </div>
   <div class="post" id="post-21306">
    <div class="subject"><a href="#post-21306">I need a favour.</a></div>
    <div class="body">I tested it on winXP prof. and it works ok for me.</div>
    <div class="meta">Posted on 2002-01-26 15:05:42 by Zcoder</div>
   </div>
   <div class="post" id="post-21360">
    <div class="subject"><a href="#post-21360">Next attempt for Win2k</a></div>
    <div class="body">I have added a couple of dialog boxes to the two EXE files to see where the failure occurs on win2k.<br /><br />What I need is for bitrake and dxantos to run these two modified versions on their setup of win2k to see what API is triggering the read fault.<br /><br />The two APIs are in the WM_CLOSE message processing and are respectively,<br /><pre><code><br />        UnmapViewOfFile lpMemFile<br />        CloseHandle hFile<br /></code></pre><br />The handle and the starting address of the memory mapped file are correct anfd the two variables have GLOBAL scope so there is no problems here.<br /><br />What I don't understand is why some versions of Win2k work OK with it and others do not.<br /><br />Any help here would be appreciated.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-01-26 21:15:32 by hutch--</div>
   </div>
   <div class="post" id="post-21363">
    <div class="subject"><a href="#post-21363">I need a favour.</a></div>
    <div class="body">Hutch,<br />Just tested your 2nd version on my W2K machine.<br />Version 5.0 build 2195 service pack 2.<br />The MMFS.EXE correctly opens TESTMMF.EXE :grin: <br />But, when I click on the 2nd button in MMFS.EXE, the<br />button just 'sticks' in the down position and the prog hangs :( <br />I don't see any popup messages from the prog OR windows.</div>
    <div class="meta">Posted on 2002-01-26 21:57:50 by anon</div>
   </div>
   <div class="post" id="post-21390">
    <div class="subject"><a href="#post-21390">I need a favour.</a></div>
    <div class="body">Both versions crash on my machine as well (win2k, sp2).<br /><br />This is what your second version outputs:<br /><pre><code><br />---------------------------<br />Test File&#58; testmmf.exe - Application Error<br />---------------------------<br />The instruction at &quot;0x0040267f&quot; referenced memory at &quot;0x0040267f&quot;. The memory could not be &quot;read&quot;.<br /><br />Click on OK to terminate the program<br />Click on CANCEL to debug the program<br />---------------------------<br />OK   Cancel   <br />---------------------------<br /></code></pre><br /><pre><code><br />---------------------------<br />Memory mapped files&#58; MMFS.EXE - Application Error<br />---------------------------<br />The instruction at &quot;0x004025b3&quot; referenced memory at &quot;0x004025b3&quot;. The memory could not be &quot;read&quot;.<br /><br />Click on OK to terminate the program<br />Click on CANCEL to debug the program<br />---------------------------<br />OK   Cancel   <br />---------------------------<br /></code></pre><br /><br />Thomas</div>
    <div class="meta">Posted on 2002-01-27 03:13:34 by Thomas</div>
   </div>
   <div class="post" id="post-21414">
    <div class="subject"><a href="#post-21414">I need a favour.</a></div>
    <div class="body"><strong>Hutch--</strong>, same here on WinXP.</div>
    <div class="meta">Posted on 2002-01-27 09:28:37 by bitRAKE</div>
   </div>
   <div class="post" id="post-21419">
    <div class="subject"><a href="#post-21419">I need a favour.</a></div>
    <div class="body">Hi Hutch--<br /><br />Still works well on my XP. Msg boxes pops up.<br />Strange that some have problems, some not.<br /><br />anon: You need to click OK on the msg box in 2nd window.<br /><br />KetilO</div>
    <div class="meta">Posted on 2002-01-27 11:40:26 by KetilO</div>
   </div>
   <div class="post" id="post-21422">
    <div class="subject"><a href="#post-21422">I need a favour.</a></div>
    <div class="body">Both apps crash after the &quot;UnmapViewOfFile&quot; msgbox has been shown.</div>
    <div class="meta">Posted on 2002-01-27 13:06:31 by f0dder</div>
   </div>
   <div class="post" id="post-21427">
    <div class="subject"><a href="#post-21427">I need a favour.</a></div>
    <div class="body">KetilO is right, I did not see the popup. The program<br />does seem to work correctly on my machine.</div>
    <div class="meta">Posted on 2002-01-27 13:19:11 by anon</div>
   </div>
   <div class="post" id="post-21452">
    <div class="subject"><a href="#post-21452">I need a favour.</a></div>
    <div class="body">Worked on ME: no errors, but only closes last. But then you didn't actually ask us to check it there.</div>
    <div class="meta">Posted on 2002-01-27 16:58:31 by peterverstappen</div>
   </div>
   <div class="post" id="post-21464">
    <div class="subject"><a href="#post-21464">Ah Micro$oft, U've dunnit again !</a></div>
    <div class="body">Guys,<br /><br />Thanks for doing this extra testing, from what has been reported, the &quot;UnmapViewOfFile&quot; function is buggy in Win2k sp2 and there seems to be nothing wrong with the code that calls it as I did a search through the available Microsoft documentation and I have used it correctly.<br /><br />It could probably be made to work by simply omitting it but this would lead to a memory leak which is unacceptable coding practice. Unfortunate as it has the potential to be a very useful interface between EXE files that removes the dependence on both the stack and on using DLLs.<br /><br />I will keep looking around to see if there is a workaround for it but it has all the hallmarks of a Microsoft bug in win2k/sp2.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-01-27 17:57:31 by hutch--</div>
   </div>
   <div class="post" id="post-21467">
    <div class="subject"><a href="#post-21467">I need a favour.</a></div>
    <div class="body">quote:  &quot;Ah Micro$oft, U've dunnit again !&quot;<br />Intentually I'm sure!!!!</div>
    <div class="meta">Posted on 2002-01-27 18:04:11 by BradB</div>
   </div>
   <div class="post" id="post-21470">
    <div class="subject"><a href="#post-21470">I need a favour.</a></div>
    <div class="body">I've had no problems with UnmapViewOfFile in my code. win2ksp2.<br />While microsoft certainly have made a lot of buggy things, I'm inclined<br />to believe that there's something wrong with your code, El Hutchesson.<br />I was about to disassemble the app to trace your code, but you<br />seem to have run an exepacker on it, and I couldn't be bothered<br />to do a manual unpack.</div>
    <div class="meta">Posted on 2002-01-27 18:11:36 by f0dder</div>
   </div>
   <div class="post" id="post-21473">
    <div class="subject"><a href="#post-21473">I need a favour.</a></div>
    <div class="body">A little late but. it gives:<br /><br /><pre><code><br />---------------------------<br />WM_CLOSE in MMFS.EXE<br />---------------------------<br />Next API is UnmapViewOfFile<br />---------------------------<br />OK   <br />---------------------------<br /></code></pre><br /><br />Before crashing.<br /><br />Using OllyDebug, I found that your app calls UnmapViewOfFile with an address of 4042B8h and after that the executable area of memory is invalid, thus giving a GPF <strong>AFTER</strong> the call to UnmapViewOfFile (address 4025B3h is the next instruction after the call to UnmapViewOfFile). Why Is that the executable address is invalid after the UnmapViewOfFile. I dont know since I dont have the original code and the exe is packed so I cannot do a dissasembly.<br /><br />The function UnmapViewOfFile itself is successfull, since eax has a value of 1 after the call is made.</div>
    <div class="meta">Posted on 2002-01-27 18:21:25 by dxantos</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=3220&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=3220&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="3220" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=3220&amp;page=2">&gt;</a><a href="../?id=3220&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>