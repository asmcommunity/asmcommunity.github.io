<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>I need a favour. - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3220" />
  <link rel="prev" href="../?id=3220&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=3220">I need a favour.</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=3220&amp;page=1" style="">&laquo;</a><a href="../?id=3220&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="3220" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-21617">
    <div class="subject"><a href="#post-21617">I need a favour.</a></div>
    <div class="body">By tracing with softice I found out it passes a fixed memory address to UnmapViewOfFile, as dxantos already said (it first puts 40xxxx in ebx, then pushes ebx), shouldn't you pass the contents of that variable (push dword ptr )?<br />I tried and the call succeeds and doesn't crash anymore.<br />It's strange others don't have problems though, do you check if the call succeeds? Maybe it doesn't crash but doesn't succeed either.<br /><br />Thomas</div>
    <div class="meta">Posted on 2002-01-28 13:41:52 by Thomas</div>
   </div>
   <div class="post" id="post-21619">
    <div class="subject"><a href="#post-21619">I need a favour.</a></div>
    <div class="body">Hmm, if UnmapViewOfFile is done on the address of the pointer<br />variable and not the contents of the pointer variable... you might<br />actually be unmapping your executable :P. Yay for &quot;hallmarks of a<br />Microsoft bug in win2k/sp2.&quot;</div>
    <div class="meta">Posted on 2002-01-28 13:45:39 by f0dder</div>
   </div>
   <div class="post" id="post-21629">
    <div class="subject"><a href="#post-21629">I need a favour.</a></div>
    <div class="body">Okay guys, tell me... if you have the return value from MapViewOfFile<br />in a variable called &quot;mapPtr&quot;... how would you call UnmapViewOfFile?<br />&quot;invoke UnmapViewOfFile, OFFSET mapPtr&quot; or &quot;invoke UnmapViewOfFile, &quot;<br />-  C equivalents &quot;UnmapViewOfFile(mapPtr);&quot; and &quot;UnmapViewOfFile(&amp;mapPtr);&quot;?<br />Perhaps *you* can get through to hutch, coz I can't. He still firmly believes<br />it's a microsoft bug, *grin*.</div>
    <div class="meta">Posted on 2002-01-28 14:22:47 by f0dder</div>
   </div>
   <div class="post" id="post-21645">
    <div class="subject"><a href="#post-21645">I need a favour.</a></div>
    <div class="body">Interestingly enough, f0dder actually managed to be useful here, the prototype for the UnmapViewOfFile in the compiler I was writing the test with was incorrect and it was using reference instead of the value returned by MapViewOfFile API. I rewrote the prototype and the return value is correct.<br /><br />It did not happen in the MASM version as it uses DWORD as the prototype. Sad about win2k being the only version to crash the example, perhaps Micro$oft will debug it eventually. :tongue: Those of us who like more or less reliable operating systems still use versions that are far less prone to later Micro$oft bugz.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-01-28 15:38:29 by hutch--</div>
   </div>
   <div class="post" id="post-21652">
    <div class="subject"><a href="#post-21652">I need a favour.</a></div>
    <div class="body">hmmmm,<br /><br />The 2 test pieces. :)<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-01-28 15:50:53 by hutch--</div>
   </div>
   <div class="post" id="post-21655">
    <div class="subject"><a href="#post-21655">I need a favour.</a></div>
    <div class="body">Works without any problems now, shows '1' in the message box.<br /><br />Thomas</div>
    <div class="meta">Posted on 2002-01-28 16:10:34 by Thomas</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=3220&amp;page=1" style="">&laquo;</a><a href="../?id=3220&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="3220" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>