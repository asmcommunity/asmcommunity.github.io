<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>file overwriting - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20833" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=20833">file overwriting</a></p>
   <div class="post" id="post-158379">
    <div class="subject"><a href="#post-158379">file overwriting</a></div>
    <div class="body">looking for a simple process to overwrite a textfile so it is non-recoverable<br />can someone help out with this code.. i just either want to fill data with junk or just like some random data before it is deleted<br /><br /><pre><code><br />.386<br />.model flat,stdcall<br />option casemap:none<br />include \masm32\include\windows.inc<br />include \masm32\include\kernel32.inc<br />includelib \masm32\lib\kernel32.lib<br /><br />OverWrite PROTO<br />.data<br />&nbsp; &nbsp; szJunkData db &quot;JuNk&quot;,0<br />&nbsp; &nbsp; szFile&nbsp; &nbsp;  db &quot;c:\blah.txt&quot;,0<br />.code<br />start:<br />&nbsp; &nbsp;  invoke OverWrite<br />&nbsp; &nbsp;  invoke ExitProcess, 0<br />&nbsp; &nbsp;  <br />OverWrite Proc<br />&nbsp; &nbsp; local hFile:DWORD<br />&nbsp; &nbsp; local BytesWritten:DWORD<br />&nbsp; &nbsp;  mov edi,9<br />@@:<br />&nbsp; &nbsp;  invoke CreateFile,addr szFile, GENERIC_WRITE, FILE_SHARE_READ, 0, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov hFile, eax<br />&nbsp; &nbsp;  invoke GetFileSize,eax,0<br />&nbsp; &nbsp;  invoke WriteFile, hFile, addr szJunkData,eax, addr BytesWritten, 0<br />&nbsp; &nbsp;  invoke CloseHandle, hFile<br />&nbsp; &nbsp;  dec edi<br />&nbsp;  jnz @B<br />&nbsp; &nbsp; &nbsp; ret<br />OverWrite endp<br />end start<br /></code></pre></div>
    <div class="meta">Posted on 2005-03-24 14:51:36 by illwill</div>
   </div>
   <div class="post" id="post-158386">
    <div class="subject"><a href="#post-158386">Re: file overwriting</a></div>
    <div class="body">If the file size you are trying to overwrite is larger than the system allocates for your data section, your program will crash due to a GPF. I would suggest the following after you get the file size:<br /><br /><pre><code><br />&nbsp; &nbsp; shr&nbsp; eax,2&nbsp; &nbsp;  ;divide by 4 to write 4 bytes at a time<br />@@:<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; invoke WriteFile, hFile, addr szJunkData,4, addr BytesWritten, 0<br />&nbsp; &nbsp; pop&nbsp; eax<br />&nbsp; &nbsp; dec&nbsp; eax<br />&nbsp; &nbsp; jnz&nbsp; @B</code></pre><br /><br />Your file will then be entirely filled with <strong>JuNk</strong> except for the last few bytes which were not a multiple of 4.<br /><br />Raymond<br /></div>
    <div class="meta">Posted on 2005-03-24 20:25:14 by Raymond</div>
   </div>
   <div class="post" id="post-158388">
    <div class="subject"><a href="#post-158388">Re: file overwriting</a></div>
    <div class="body">You&#39;re trying to write &quot;filesize&quot; bytes of data, but the &quot;szJunkData&quot; points to only 5 bytes: &#39;J&#39; &#39;u&#39; &#39;N&#39; &#39;k&#39; &#39;NULL&#39; (and some possible bytes after it). this may cause GP fault.<br /><br />and also this technique you&#39;re using isn&#39;t clever - for 2GB file you&#39;d need to allocate 2GB of RAM.<br /><br /><br />[ /edit: Raymond was faster :P ]<br /><br /><br />after Raymond&#39;s post, I&#39;d like to add, that writing 4 bytes at a time will be dead-slow :P</div>
    <div class="meta">Posted on 2005-03-24 20:28:50 by ti_mo_n</div>
   </div>
   <div class="post" id="post-158391">
    <div class="subject"><a href="#post-158391">Re: file overwriting</a></div>
    <div class="body">what would be a better way to do this as far as speed and memory usage</div>
    <div class="meta">Posted on 2005-03-24 21:54:37 by illwill</div>
   </div>
   <div class="post" id="post-158392">
    <div class="subject"><a href="#post-158392">Re: file overwriting</a></div>
    <div class="body">Write 4bytes at a time and keep doing that till you overwritten the whole file with &quot;Junk&quot;. Like what Raymond have suggested..<br /><br />Modify it to something like<br /><pre><code><br />&nbsp; &nbsp; mov esi, eax<br />&nbsp; &nbsp; shr&nbsp; eax,2&nbsp; &nbsp;  ;divide by 4 to write 4 bytes at a time<br />@@:<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; invoke WriteFile, hFile, addr szJunkData,4, addr BytesWritten, 0<br />&nbsp; &nbsp; pop&nbsp; eax<br />&nbsp; &nbsp; dec&nbsp; eax<br />&nbsp; &nbsp; jnz&nbsp; @B<br />&nbsp; &nbsp; and esi, 111b<br />&nbsp; &nbsp; jz done<br />&nbsp; &nbsp; invoke WriteFile, hFile, addr szJunkData,esi, addr BytesWritten, 0<br />done:<br /></code></pre><br /><br />Another suggestion would be to reduce the file size, then overwrite it. It might work, if I am not wrong.</div>
    <div class="meta">Posted on 2005-03-24 22:24:08 by roticv</div>
   </div>
   <div class="post" id="post-158396">
    <div class="subject"><a href="#post-158396">Re: file overwriting</a></div>
    <div class="body">ok it now writes junk to the file&nbsp; :D<br />so would i have to do this process 9 times in order to make the file unrecoverable by DOD standards?<br /><br /><pre><code><br />.386<br />.model flat,stdcall<br />option casemap:none<br />include \masm32\include\windows.inc<br />include \masm32\include\kernel32.inc<br />includelib \masm32\lib\kernel32.lib<br /><br />OverWrite PROTO<br />.data<br />&nbsp; &nbsp; szJunkData db &quot;JuNk&quot;,0<br />&nbsp; &nbsp; szFile&nbsp; &nbsp;  db &quot;c:\blah.txt&quot;,0<br />.code<br />start:<br />&nbsp; &nbsp;  invoke OverWrite<br />&nbsp; &nbsp;  invoke ExitProcess, 0<br />&nbsp; &nbsp;  <br />OverWrite PROC<br />&nbsp; &nbsp; local hFile:DWORD<br />&nbsp; &nbsp; local dwWritten:DWORD<br />&nbsp; &nbsp; local dwFileSize:DWORD<br />&nbsp; &nbsp;  invoke CreateFile,addr szFile, GENERIC_WRITE, FILE_SHARE_WRITE, 0,OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0<br />&nbsp; &nbsp;  mov hFile, eax<br />&nbsp; &nbsp;  invoke GetFileSize,eax,0<br />&nbsp; &nbsp; shr&nbsp; eax,2&nbsp; &nbsp;  ;divide by 4 to write 4 bytes at a time<br />@@:<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; invoke WriteFile, hFile, addr szJunkData,4, addr dwWritten, 0<br />&nbsp; &nbsp; pop&nbsp; eax<br />&nbsp; &nbsp; dec&nbsp; eax<br />&nbsp; &nbsp; jnz&nbsp; @B<br />&nbsp; &nbsp; and esi, 111b<br />&nbsp; &nbsp; jz done<br />&nbsp; &nbsp; invoke WriteFile, hFile, addr szJunkData,esi, addr dwWritten, 0<br />done:<br />&nbsp; &nbsp; invoke CloseHandle, hFile<br />&nbsp; &nbsp; &nbsp; ret<br />OverWrite endp<br />end start<br /></code></pre><br /><br />also<br />&nbsp; &nbsp; and esi, 111b<br />&nbsp; &nbsp; jz done<br />&nbsp; &nbsp; invoke WriteFile, hFile, addr szJunkData,esi, addr dwWritten, 0<br />done:<br /><br />what does that extra at the end do?</div>
    <div class="meta">Posted on 2005-03-25 00:30:34 by illwill</div>
   </div>
   <div class="post" id="post-158401">
    <div class="subject"><a href="#post-158401">Re: file overwriting</a></div>
    <div class="body">To fill up overwrite the file completely with &quot;junk&quot;. The main loop just fill it up to the multiple of 4. </div>
    <div class="meta">Posted on 2005-03-25 05:28:55 by roticv</div>
   </div>
   <div class="post" id="post-158402">
    <div class="subject"><a href="#post-158402">Re: file overwriting</a></div>
    <div class="body">There is an example from Sysinternals wich is coded in C but it gives you the idea of implementation (source included): http://www.sysinternals.com/ntw2k/source/sdelete.shtml</div>
    <div class="meta">Posted on 2005-03-25 06:03:33 by jNz</div>
   </div>
   <div class="post" id="post-158403">
    <div class="subject"><a href="#post-158403">Re: file overwriting</a></div>
    <div class="body">For DoD standards, I found a document that stated a random pattern must be written over every addressable sector on the disk a total of 18 times.? But this was to declassify a harddrive needless to say.<br /><br />If you want something that will follow DoD standards, you are going to have to google for that.</div>
    <div class="meta">Posted on 2005-03-25 07:09:04 by gorshing</div>
   </div>
   <div class="post" id="post-158433">
    <div class="subject"><a href="#post-158433">Re: file overwriting</a></div>
    <div class="body">yea i have to preserve the file size pointer it for some reason keepswriting over itself making it bigger and bigger<br />im not good with c code enough to try to tranlate that code into asm</div>
    <div class="meta">Posted on 2005-03-25 22:20:40 by illwill</div>
   </div>
   <div class="post" id="post-158434">
    <div class="subject"><a href="#post-158434">Re: file overwriting</a></div>
    <div class="body">You could try including class32.inc or later and using my Fstream class for easy file io.<br />Ask me for the latest version.<br />After opening a file with it, you can use Put and Get methods to access file data, and can set the filepointer by hand if need be.<br />It will automatically catch the existing filesizse when opening existing files, etc.<br /></div>
    <div class="meta">Posted on 2005-03-26 01:50:28 by Homer</div>
   </div>
   <div class="post" id="post-158437">
    <div class="subject"><a href="#post-158437">Re: file overwriting</a></div>
    <div class="body">Here&#39;s the code I come up with illwill<br /><br /><pre><code><br />.386<br />.model flat,stdcall<br />option casemap:none<br /><br />include \masm32\include\WINDOWS.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\comdlg32.inc<br /><br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\comdlg32.lib<br /><br />NumTimesOverWrite&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; equ&nbsp; &nbsp;  9&nbsp; &nbsp; &nbsp; &nbsp; ;Or Whatever DOD requires<br />Multiple_Of_2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; equ&nbsp; &nbsp;  256&nbsp; &nbsp; &nbsp; ;Or 2,4,8,16,32,64,128,256,etc<br />Multiple_Of_2_Minus_1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; equ&nbsp; &nbsp;  255&nbsp; &nbsp; &nbsp; ;Or 1,3,7,15,31,63,127,255,etc<br />Depends_On_Value_Of_Multiple_Of_2&nbsp; &nbsp; equ&nbsp; &nbsp;  8&nbsp; &nbsp; &nbsp; &nbsp; ;Or 1,2,3, 4, 5, 6,&nbsp; 7,&nbsp; 8,etc<br /><br />OverWrite&nbsp; &nbsp; &nbsp;  PROTO<br /><br />.data<br /><br />szFilter&nbsp; &nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp; &nbsp;  &quot;Text Files&quot;,0,&quot;*.txt&quot;,0,0<br />szTitle&nbsp; &nbsp; &nbsp; &nbsp;  BYTE&nbsp; &nbsp; &nbsp; &nbsp;  &quot;OverWrite and Delete A File&quot;,0<br />szQuestion&nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp; &nbsp;  &quot;Delete Another File?&quot;,0<br /><br />.data?<br /><br />hFile&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  HANDLE&nbsp; &nbsp; &nbsp;  ?<br />BytesWritten&nbsp; &nbsp; DWORD&nbsp; &nbsp; &nbsp; &nbsp; ?<br />OpenProgram&nbsp; &nbsp;  OPENFILENAME &lt;&gt;<br />szFile&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp; &nbsp;  256 dup (?)<br />szJunkData&nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp; &nbsp;  Multiple_Of_2 dup (?)<br /><br />.code<br /><br />Start:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  OpenProgram.lStructSize,76<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  OpenProgram.nMaxFile,256<br />&nbsp; &nbsp; &nbsp; &nbsp; lea&nbsp; &nbsp;  edx,szFilter<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  OpenProgram.lpstrFilter,edx<br />&nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  edx,13<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  OpenProgram.lpstrDefExt,edx<br />&nbsp; &nbsp; &nbsp; &nbsp; lea&nbsp; &nbsp;  edx,szTitle<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  OpenProgram.lpstrTitle,edx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  OpenProgram.Flags,OFN_FILEMUSTEXIST or OFN_PATHMUSTEXIST<br />S0000:<br />&nbsp; &nbsp; &nbsp; &nbsp; lea&nbsp; &nbsp;  edx,szFile<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  BYTE PTR,0<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  OpenProgram.lpstrFile,edx<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE&nbsp; GetOpenFileName,ADDR OpenProgram&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;comdlg32.dll<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE&nbsp; OverWrite<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ;INVOKE&nbsp; DeleteFile,ADDR szFile&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;kernel32.dll<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE&nbsp; MessageBox,NULL,ADDR szQuestion,ADDR szTitle,MB_OKCANCEL&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;user32.dll<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  eax,IDOK<br />&nbsp; &nbsp; &nbsp; &nbsp; je&nbsp; &nbsp; &nbsp; S0000<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE&nbsp; ExitProcess,eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;kernel32.dll<br /><br />OverWrite Proc<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; edi<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edi,NumTimesOverWrite<br />OW0000:<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE&nbsp; CreateFile,ADDR szFile,GENERIC_WRITE,FILE_SHARE_READ,0,OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,0 ;kernel32.dll<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  hFile,eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE&nbsp; GetFileSize,eax,0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;kernel32.dll<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  BytesWritten,0<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; shr&nbsp; &nbsp;  eax,Depends_On_Value_Of_Multiple_Of_2<br />OW0001:<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE&nbsp; WriteFile,hFile,ADDR szJunkData,Multiple_Of_2,ADDR BytesWritten,0&nbsp; &nbsp; ;kernel32.dll<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; dec&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; jnz&nbsp; &nbsp;  OW0001<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; and&nbsp; &nbsp;  esi,Multiple_Of_2_Minus_1<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE&nbsp; WriteFile,hFile,ADDR szJunkData,esi,ADDR BytesWritten,0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;kernel32.dll<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE&nbsp; CloseHandle,hFile&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;kernel32.dll<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; dec&nbsp; &nbsp;  edi<br />&nbsp; &nbsp; &nbsp; &nbsp; jnz&nbsp; &nbsp;  OW0000<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  edi<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br /><br />OverWrite ENDP<br /><br />END Start</code></pre><br /><br />Also on roticv&#39;s recommendation:<br /><br />and esi, 111b? ? ? ;should be 3 as opposed to 7<br /><br />Hope this helps,<br /><br />Darrel<br /><br />EDIT:<br /><br />Should use Yes/No MessageBox as opposed to OK/CANCEL.<br />More Smooth :lol:<br /><br />EDIT2:<br /><br />corrected variable spelling? ?;had leftout a &quot;t&quot; in word Multiple</div>
    <div class="meta">Posted on 2005-03-26 03:42:38 by Darrel</div>
   </div>
   <div class="post" id="post-158454">
    <div class="subject"><a href="#post-158454">Re: file overwriting</a></div>
    <div class="body">compile but youre having the same problem as me when it overwrites the filesize pointer gets messed up and the file just gets bigger and bigger<br /></div>
    <div class="meta">Posted on 2005-03-26 15:06:18 by illwill</div>
   </div>
   <div class="post" id="post-158458">
    <div class="subject"><a href="#post-158458">Re: file overwriting</a></div>
    <div class="body">The code in my first post is now correct. I compiled and tested it.<br /><br />Note I have commented out the DeleteFile function so I could check and make sure it was the same file size and filled with zeroes.<br /><br />Regards,<br /><br />Darrel</div>
    <div class="meta">Posted on 2005-03-26 19:22:31 by Darrel</div>
   </div>
   <div class="post" id="post-169413">
    <div class="subject"><a href="#post-169413">Re: file overwriting</a></div>
    <div class="body">You ought to overwrite with a few more patterns than just zeroes, and you should probably open the file in UNBUFFERED mode as well, just to be on the safe side...<br /></div>
    <div class="meta">Posted on 2006-01-09 16:43:09 by f0dder</div>
   </div>
   <div class="post" id="post-169446">
    <div class="subject"><a href="#post-169446">Re: file overwriting</a></div>
    <div class="body">will,<br /><br />This should come close to doing what you want. Its just a rough test piece but the splatit procedure is pretty straight forward.<br /><br /><span class="mono"><br />; «««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««<br />&nbsp; &nbsp; include \masm32\include\masm32rt.inc<br />; «««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««<br /><br />comment * -----------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Build this&nbsp; template with<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &quot;CONSOLE ASSEMBLE AND LINK&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ----------------------------------------------------- *<br /><br />&nbsp; &nbsp; splatit PROTO :DWORD<br /><br />&nbsp; &nbsp; .code<br /><br />start:<br />&nbsp;  <br />; «««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««<br /><br />&nbsp; &nbsp; call main<br /><br />&nbsp; &nbsp; exit<br /><br />; «««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««<br /><br />main proc<br /><br />&nbsp; &nbsp; LOCAL pbuf&nbsp; :DWORD<br />&nbsp; &nbsp; LOCAL buffer[260]:BYTE<br /><br />&nbsp; &nbsp; mov pbuf, ptr$(buffer)<br /><br />&nbsp; &nbsp; invoke GetCL,1,pbuf<br /><br />&nbsp; &nbsp; invoke splatit,pbuf<br /><br />&nbsp; &nbsp; ret<br /><br />main endp<br /><br />; «««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««<br /><br />splatit proc lpfile:DWORD<br /><br />&nbsp; &nbsp; LOCAL hFile :DWORD<br />&nbsp; &nbsp; LOCAL flen&nbsp; :DWORD<br />&nbsp; &nbsp; LOCAL blen&nbsp; :DWORD<br />&nbsp; &nbsp; LOCAL pbuf1 :DWORD<br />&nbsp; &nbsp; LOCAL pbuf2 :DWORD<br />&nbsp; &nbsp; LOCAL bwrt&nbsp; :DWORD<br />&nbsp; &nbsp; LOCAL cloc&nbsp; :DWORD<br />&nbsp; &nbsp; LOCAL icnt&nbsp; :DWORD<br /><br />&nbsp; &nbsp; mov hFile, fopen(lpfile)<br />&nbsp; &nbsp; mov flen, fsize(hFile)<br /><br />&nbsp; &nbsp; mov pbuf1, alloc(flen)<br />&nbsp; &nbsp; mov pbuf2, alloc(flen)<br /><br />&nbsp; &nbsp; push esi<br /><br />&nbsp; &nbsp; mov esi, pbuf1<br />&nbsp; &nbsp; mov ecx, flen<br />&nbsp; @@:<br />&nbsp; &nbsp; mov BYTE PTR , 00000000b<br />&nbsp; &nbsp; add esi, 1<br />&nbsp; &nbsp; sub ecx, 1<br />&nbsp; &nbsp; jnz @B<br /><br />&nbsp; &nbsp; mov esi, pbuf2<br />&nbsp; &nbsp; mov ecx, flen<br />&nbsp; @@:<br />&nbsp; &nbsp; mov BYTE PTR , 11111111b<br />&nbsp; &nbsp; add esi, 1<br />&nbsp; &nbsp; sub ecx, 1<br />&nbsp; &nbsp; jnz @B<br /><br />&nbsp; &nbsp; mov esi, 8&nbsp; &nbsp; &nbsp; ; change the count here if you need to<br />&nbsp; &nbsp; mov icnt, 1<br /><br />&nbsp; lpst:<br />&nbsp; &nbsp; print &quot;Iteration &quot;<br />&nbsp; &nbsp; print str$(icnt),13,10<br />&nbsp; &nbsp; add icnt, 1<br />&nbsp; &nbsp; mov cloc, fseek(hFile,0,FILE_BEGIN) ; set pointer to start of file<br />&nbsp; &nbsp; mov bwrt, fwrite(hFile,pbuf1,flen)&nbsp; ; write filler to file<br />&nbsp; &nbsp; invoke FlushFileBuffers,hFile&nbsp; &nbsp; &nbsp;  ; flush file to disk<br /><br />&nbsp; &nbsp; print &quot;Iteration &quot;<br />&nbsp; &nbsp; print str$(icnt),13,10<br />&nbsp; &nbsp; add icnt, 1<br />&nbsp; &nbsp; mov cloc, fseek(hFile,0,FILE_BEGIN)<br />&nbsp; &nbsp; mov bwrt, fwrite(hFile,pbuf2,flen)<br />&nbsp; &nbsp; invoke FlushFileBuffers,hFile<br /><br />&nbsp; &nbsp; sub esi, 1<br />&nbsp; &nbsp; jnz lpst<br /><br />&nbsp; &nbsp; pop esi<br /><br />&nbsp; &nbsp; fclose hFile<br /><br />&nbsp; &nbsp; test fdelete(lpfile), eax<br /><br />&nbsp; &nbsp; free pbuf2<br />&nbsp; &nbsp; free pbuf1<br /><br />&nbsp; &nbsp; ret<br /><br />splatit endp<br /><br />; «««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««««<br /><br />end start<br /></span></div>
    <div class="meta">Posted on 2006-01-10 21:49:10 by hutch--</div>
   </div>
   <div class="post" id="post-169455">
    <div class="subject"><a href="#post-169455">Re: file overwriting</a></div>
    <div class="body">Hutch, you should still use FILE_FLAG_NO_BUFFERING - while FlushFileBuffers &quot;ought to&quot; do what the name indicates, using unbuffered I/O keeps you from using filesystem cache for the &quot;nuking&quot; process. FlushFileBuffers should still be used, though. Quoting MSDN: <em><strong>To open a file for unbuffered I/O, call the CreateFile function with the FILE_FLAG_NO_BUFFERING flag. This prevents the file contents from being cached. However, the file metadata may still be cached. To flush the metadata to a disk, use FlushFileBuffers.</strong></em>.<br /><br />Oh, and if you&#39;re really paranoid you should consider renaming the file as well - to as many chars as original filename, filled with random chars.<br /></div>
    <div class="meta">Posted on 2006-01-11 05:56:15 by f0dder</div>
   </div>
   <div class="post" id="post-169467">
    <div class="subject"><a href="#post-169467">Re: file overwriting</a></div>
    <div class="body">Isn&#39;t illwill in prison anyway?</div>
    <div class="meta">Posted on 2006-01-11 13:13:31 by stormix</div>
   </div>
   <div class="post" id="post-169468">
    <div class="subject"><a href="#post-169468">Re: file overwriting</a></div>
    <div class="body"><div class="quote"><br />Isn&#39;t illwill in prison anyway?<br /></div><br /><br />I don&#39;t think so - at least he&#39;s been on IRC after all that mess, the little fool he is :)<br /></div>
    <div class="meta">Posted on 2006-01-11 15:42:10 by f0dder</div>
   </div>
  </div>
 </body>
</html>