<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>bin2hex - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=22143" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=22143">bin2hex</a></p>
   <div class="post" id="post-166669">
    <div class="subject"><a href="#post-166669">bin2hex</a></div>
    <div class="body">I&#39;ve been searching like crazy for a bin2hex function but couldn&#39;t find one anywhere... I wonder if anyone could post one? Maybe even a speed contest :p<br /><br /><div class="quote"><br />It&#39;s pretty trivial to convert binary data to hex strings, though. Process byte-by-byte, and process each byte as two nibbles. Use a 16-character &quot;0123456789ABCDEF&quot; lookupstring, and index it with the nibble.<br /></div><br /><br />I wonder if someone can also explain to me how to use a lookupstring.</div>
    <div class="meta">Posted on 2005-10-04 11:19:31 by Lenin</div>
   </div>
   <div class="post" id="post-166670">
    <div class="subject"><a href="#post-166670">Re: bin2hex</a></div>
    <div class="body">try something like this... coded off top of my head, not tested :)<br /><br /><pre><code><br />.data<br />szHexLookup db &quot;0123456789ABCDEF&quot;<br /><br />.code<br /><br />bin2hex:<br />mov		esi, <br />mov		edi, <br />mov		ecx, <br /><br />.process:<br />	lodsb<br />	mov		ah, al<br />	and		al, 0xF<br />	movzx	edx, al<br />	mov		al, <br />	stosb<br /><br />	shr		ah, 4<br />	movzx	edx, ah<br />	mov		al, <br />	stosb<br /><br />	dec		ecx<br />	jnz		.process<br /></code></pre><br /></div>
    <div class="meta">Posted on 2005-10-04 12:01:55 by f0dder</div>
   </div>
   <div class="post" id="post-166671">
    <div class="subject"><a href="#post-166671">Re: bin2hex</a></div>
    <div class="body">Thanks :) Would you help me with one more thing... I&#39;m coding a notepad, the reason I needed this bin2hex function was so that I could open binary files... I wonder if you could tranform your code into a function.... Something like:<br /><pre><code>bin2hex proc uses esi, edi sourcedata:DWORD, targetstring:DWORD, sourcelenght:DWORD<br />mov		esi, <br />mov		edi, <br />mov		ecx, <br /><br />.process:<br />	lodsb<br />	mov		ah, al<br />	and		al, 0xF<br />	movzx	edx, al<br />	mov		al, <br />	stosb<br /><br />	shr		ah, 4<br />	movzx	edx, ah<br />	mov		al, <br />	stosb<br /><br />	dec		ecx<br />	jnz		.process<br />&nbsp; &nbsp; &nbsp;  ; what would I return?<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />bin2hex endp</code></pre><br /><br />Would this be correct? I need it to be a function so I can use it here:<br /><br /><pre><code>LoadTextFileToEdit proc FilePath:DWORD<br />&nbsp; &nbsp; LOCAL hFile:HANDLE, dwFileSize:DWORD, pszFileText:LPSTR, dwRead:DWORD<br /><br />&nbsp; &nbsp; invoke CreateFile,FilePath,GENERIC_READ,FILE_SHARE_READ,NULL,OPEN_EXISTING,0,NULL<br />&nbsp; &nbsp; .if eax != INVALID_HANDLE_VALUE<br />&nbsp; &nbsp; &nbsp; &nbsp; mov hFile, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke GetFileSize, hFile, NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; .if eax != 0ffffffffh<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov dwFileSize, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke HeapAlloc, ProcessHeap, HEAP_ZERO_MEMORY, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .if eax != NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov pszFileText, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke ReadFile, hFile, pszFileText, dwFileSize, addr dwRead, NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .if eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax,pszFileText<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add eax,dwFileSize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov byte ptr, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 	invoke SetWindowText, hwndEdit, pszFileText<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 	<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 	invoke GetFileName, FilePath<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 	invoke wsprintf, addr TitleBuff, addr lpFmt, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 	invoke SetWindowText, hwnd, addr TitleBuff<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .endif<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke HeapFree, ProcessHeap, 0, pszFileText<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .endif<br />&nbsp; &nbsp; &nbsp; &nbsp; .endif<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke CloseHandle, hFile<br />&nbsp; &nbsp; .endif<br />&nbsp; &nbsp; xor eax, eax<br />&nbsp; &nbsp; ret<br />LoadTextFileToEdit endp</code></pre></div>
    <div class="meta">Posted on 2005-10-04 12:49:58 by Lenin</div>
   </div>
   <div class="post" id="post-166679">
    <div class="subject"><a href="#post-166679">Re: bin2hex</a></div>
    <div class="body">Assuming that my code is correct :P, your function looks okay (good you remember the register preservation). You don&#39;t really need to return anything...<br /></div>
    <div class="meta">Posted on 2005-10-04 15:56:28 by f0dder</div>
   </div>
   <div class="post" id="post-166687">
    <div class="subject"><a href="#post-166687">Re: bin2hex</a></div>
    <div class="body">If you work on the binary data one chunk at a time ie one DWORD at a time you can streamline the process by not having to mess with nibbles.<br />Also using a lookup table of 256 words (if memory isn&#39;t an issue would also be faster. 512bytes<br /><br /><pre><code><br />B2HLUT db &quot;000102030405060708090A0B0C0D0E0F&quot;<br />            db &quot;101112131415161718191A1B1C1D1E1F&quot;<br />            db &quot;202122232425262728292A2B2C2D2E2F&quot;<br />            db &quot;303132333435363738393A3B3C3D3E3F&quot;<br />            db &quot;404142434445464748494A4B4C4D4E4F&quot;<br />            db &quot;505152535455565758595A5B5C5D5E5F&quot;<br />            db &quot;606162636465666768696A6B6C6D6E6F&quot;<br />            db &quot;707172737475767778797A7B7C7D7E7F&quot;<br />            db &quot;808182838485868788898A8B8C8D8E8F&quot;<br />            db &quot;909192939495969798999A9B9C9D9E9F&quot;<br />            db &quot;A0A1A2A3A4A5A6A7A8A9AAABACADAEAF&quot;<br />            db &quot;B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF&quot;<br />            db &quot;C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF&quot;<br />            db &quot;D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF&quot;<br />            db &quot;E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF&quot;<br />            db &quot;F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF&quot;<br /><br />Bin2Hex:<br />;IN ptr to array of dwords IE read a file to a buffer or making a filemapping obj<br />;IN ptr to output string<br />;IN size of array of dwords, IE number of dwords to make into hex<br />PUSH EBX<br />PUSH ESI<br />PUSH EDI<br />XOR EBX,EBX<br />MOV ECX, dword ;len<br />MOV EDI, dword ; outstr<br />MOV ESI, dword ;dwords<br />.LP:<br />DEC ECX<br />JS .ALLDONE<br />MOV EAX, dword<br />MOV BL, AL<br />MOV DX, word<strong><br />SHR EAX,8<br />MOV word,DX<br />MOV BL,AL<br />MOV DX, word<strong><br />SHR EAX,8<br />MOV word, DX<br />MOV BL,AL<br />MOV DX, word<strong><br />SHR EAX,8<br />MOV word,DX<br />MOV BL, AL<br />MOV DX, word<strong><br />MOV word,DX<br />JMP .LP<br />.ALLDONE:<br />POP EDI<br />POP ESI<br />POP EBX<br />RET 12<br /><br />AlternatveCodeBin2Hex:<br />;IN ptr to array of binary BYTES<br />;IN ptr to output string<br />;IN size of array in BYTES<br />PUSH EBX<br />PUSH ESI<br />XOR EBX,EBX<br />MOV ECX, dword ;len<br />MOV EDX, dword ; outstr<br />MOV ESI, dword ;bytes<br />DEC ECX<br />JS .ALLDONE<br />MOV BL, byte<br />.LP:<br />MOV AX, word<strong><br />MOV BL, byte<br />MOV word,AX<br />DEC ECX<br />JS .ALLDONE<br />JMP .LP<br />.ALLDONE:<br />POP ESI<br />POP EBX<br />RET 12<br /></code></pre><br /><br />If it works, there&#39;s still a lot of room for minor speed optimizations</div>
    <div class="meta">Posted on 2005-10-04 19:17:03 by r22</div>
   </div>
  </div>
 </body>
</html>