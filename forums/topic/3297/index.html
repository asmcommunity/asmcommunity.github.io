<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Help with coding - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3297" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=3297">Help with coding</a></p>
   <div class="post" id="post-21788">
    <div class="subject"><a href="#post-21788">Help with coding</a></div>
    <div class="body">Hello there i have some code that i need to make it easier to understand.I mean transforming the jne .... onto .if .....==....   instructions, or .elseif or else instructions.<br /><br /><br /><br />The problem is no matter what i try when i disaqssemble my own code it is t not the same, and the program not work properly.<br /><br />Therer are few conditional jumps inside, that are hard to undertand in what part of the block they are. I jut want to rebuild it and uderstand what exactly works with .else instructios, .if (!eax) ; .if ; .else if and stuff...and how the ml assembler deals with it if they are deep inside the main code.<br /><br />Here is the coding<br />____________________________________________________<br /><br />WndProc proc	hWnd   :DWORD,<br />		Msg   :DWORD,<br />		wParam   :DWORD,<br />		lParam   :DWORD,<br /><br /><br />		(...some code)<br />		cmp	eax, WM_CLOSE<br />		jnz	short loc_40125C ; It is .If eax==WM_CLOSE<br /><br />		(...some code)<br />		jmp	IsEndIf<br /><br /><br />loc_40125C:<br />		cmp	eax, WM_INITDIALOG	; It is .elseif WM_INITDIALOG<br />		jnz	loc_401303<br />		(...some code)<br />		jmp	IsEndIf<br /><br /><br />loc_401303:<br />		cmp	eax, WM_COMMAND<br />		jnz	loc_4013B0<br />		(...some code)<br />		cmp	ax, IDC_CancelBtn<br />		jnz	short loc_401324<br /><br />		(...some code)<br />		jmp	IsEndIf<br /><br />loc_401324:<br />		cmp	ax, IDC_PushBtn<br />		jnz	short loc_401350<br />		(...some code)<br />		cmp	ax, TRUE<br />		jnz	IsEndIf<br /><br />		(...some code)<br />		jmp	IsEndIf<br /><br /><br />loc_401350:<br />		cmp	ax, IDC_TextBtn<br />		jnz	short loc_401394<br />		shr	eax, 16<br />		cmp	ax, WM_CUT<br />		jnz	short loc_401390<br /><br />		invoke	GetDlgItemText, hWnd, IDC_TextBtn, addr Sz_GrabFileName, 257<br />		xor	eax, eax<br />		cmp	byte ptr , 0<br /><br />		setnz	al<br /><br />		invoke	EnableWindow, dhWnd, eax<br />		jmp	short IsEndIf<br /><br /><br />loc_401390:<br />		jmp	short elseif_endif<br /><br />		jmp	short IsEndIf<br /><br /><br />loc_401394:<br />		cmp	ax, IDC_UnpackBtn<br />		jnz	short IsEndIf<br /><br />		(...some code)<br />		jmp	short IsEndIf<br /><br /><br />loc_4013B0:<br />		cmp	eax, WM_SYSCOMMAND<br />		jnz	short IsEndIf<br />		mov	eax, wParam<br />		and	ax, 0FFF0h<br />		cmp	ax, WM_CLOSE<br />		jnz	short elseif_endif<br /><br />		(...some code)<br /><br />		jmp	short IsEndIf<br /><br /><br />elseif_endif:				It is .else<br /><br />		(...some code)<br />		retn<br /><br /><br />IsEndIf:				It is .endif<br />		xor	eax, eax<br />		retn<br />WndProc		endp<br /><br />____________________________________________________<br /><br /><br />Can anyone help me, please ?</div>
    <div class="meta">Posted on 2002-01-29 09:06:03 by Beyond2000!</div>
   </div>
   <div class="post" id="post-21789">
    <div class="subject"><a href="#post-21789">Help with coding</a></div>
    <div class="body">jnz = jne = Jump if Not Equal. Thus, a compare is made. If it's not<br />the right case, jump on to the next compare. If it's the right case,<br />execute the code, and skip the rest of the comparisons.<br /><br />The &quot;cmp eax, whatever&quot; and &quot;jnz loc_blablabla&quot; can be replaced<br />by &quot;.IF EAX == whatever&quot;, and the &quot;jmp isEndIF&quot; by a .ELSEIF.<br />(Well, not *exactly* that way, but you should see what I mean).<br /><br />Also, realize that posting disassembled stuff here can be a dangerous<br />thing to do :). However, the disassembly looks just like a normal<br />masm program, so... I'll let it live. It's not like disassembly automatically<br />means &quot;bad stuff&quot;.</div>
    <div class="meta">Posted on 2002-01-29 09:12:10 by f0dder</div>
   </div>
   <div class="post" id="post-21794">
    <div class="subject"><a href="#post-21794">Thanks</a></div>
    <div class="body">Yep, the code is a regular masm, it's just a part of a dialog proc.<br /><br />I didn't wrote the main code...I just tryiong to recreate it on a better way...<br /><br />The jmp isEndIF can be replaced by .elseif....<br /><br />The problem is i tryed to follow the instructions and replacing them, but the result is not the same one.<br /><br />He has an else instructin before isEndIF, that it called 02 times before the end of the code.<br /><br />Just like:<br /><br />.if bla bla bla.<br /><br />.elsif bla bla bba</div>
    <div class="meta">Posted on 2002-01-29 09:31:54 by Beyond2000!</div>
   </div>
   <div class="post" id="post-21796">
    <div class="subject"><a href="#post-21796">Help with coding</a></div>
    <div class="body">Sotty, i as said<br /><br />it just have other places inside the code before the else instruction.<br /><br />Like<br /><br />.if ,,,,,<br /><br />.elseif.....<br />     .if.....<br />        .if.......<br />         .endif<br />      .else<br />      .endif<br />.elseif...<br />.endif<br /><br /><br />See, i followed the code replacing the proper instructions, but a tryed many times, and it seems to not be the same.<br /><br />I am tryong to understand exactly how it works without any errors.</div>
    <div class="meta">Posted on 2002-01-29 09:37:17 by Beyond2000!</div>
   </div>
   <div class="post" id="post-21828">
    <div class="subject"><a href="#post-21828">Help with coding</a></div>
    <div class="body">Here is a translation of .if-.elseif-.else-.endif. The .elseif block can be repeated as often as necessary. I show two .elseif's, but there can be as few as none. If there is no .else block, the jump before the .endif is redundant and needn't be generated.<br /><br /><pre><code>.if eax == 1<br />    ...case 1...<br />.elseif eax == 2<br />    ...case 2...<br />.elseif eax == 3<br />    ...case 3...<br />.else<br />    ...default case...<br />.endif<br /></code></pre><pre><code>; .if block<br />    cmp eax,1<br />    jne not_case1<br />    ...case 1...<br />    jmp endcase<br />not_case1&#58;<br /><br />; .elseif block<br />    cmp eax,2<br />    jne not_case2<br />    ...case 2...<br />    jmp endcase<br />not_case2&#58;<br /><br />; .elseif block<br />    cmp eax,3<br />    jne not_case3<br />    ...case 3...<br />    jmp endcase<br />not_case3&#58;<br /><br />; .else block<br />    ...default case...<br />endcase&#58;<br /></code></pre></div>
    <div class="meta">Posted on 2002-01-29 13:39:10 by tank</div>
   </div>
   <div class="post" id="post-21865">
    <div class="subject"><a href="#post-21865">Help with coding</a></div>
    <div class="body">Thanks tank, i tryed that kinda before, but i got stucked on block3.<br /><br />Right above the else block there is some code that cannot be .elseif instructions due to the order of the jumps, that's why i assume they are .if instructions, but they are inside other instructions that i cannot translate.<br /><br /><br />Just like that:<br /><br />code:<br />_____________________<br /><br />.if eax==WM_CLOSE<br />      ...case 1...<br /><br />.elseif eax==WM_INITDIALOG<br />      ...case 2...<br /><br />.elseif eax==WM_COMMAND<br />      ...case 3... This is where i got stuck<br /><br />.else<br />      ...default case...<br />.endif<br /><br /><br />That looks exactly as<br /><br />code:<br /><br />_____________<br /><br />; .if block    -1st block this is OK<br /><br />       cmp     eax, WM_CLOSE<br />       jnz     not_case1 <br />      ...case 1...<br />      jmp endcase<br /><br />not_case1:<br /><br />; .elseif block	-2nd block this is OK<br /><br />      cmp     eax, WM_INITDIALOG<br />       jnz     not_case2<br />      ...case 2...<br />      jmp endcase<br /><br />not_case2:<br /><br />; .elseif block	-3nd block this is where the trouble begins<br /><br /><br />      cmp     eax, WM_COMMAND ; .elseif eax==WM_COMMAND<br />       jnz     not_case3, The end (not_case3) seems not to be elseif<br />      ...case 3...<br /><br />      cmp     ax, IDC_CancelBtn ; The firts .if inside.<br />       jnz     not_case_inside1<br />      ...case 4...<br />      jmp endcase<br /><br />not_case_inside1: ; The 1st .elseif inside ?<br />      cmp     ax, IDC_PushBtn<br />       jnz     not_case_inside2<br />      ...case 5...<br />      cmp     ax, TRUE ; Probably .if ax==TRUE<br />      jnz endcase<br />      ...case 6...	; .endif<br />      jmp endcase<br /><br />not_case_inside2: ; The 2nd .elseif inside ?<br />      cmp     ax, IDC_TextBtn<br />       jnz     not_case_inside3<br />      ...case 7...<br />      cmp     ax, WM_CUT<br />       jnz     not_case_inside_inside ; ???? How that happens ?<br />      ...case 8...; another .elseif or just .if followed by an end ?<br />      jmp endcase<br /><br />not_case_inside_inside:<br /><br />      jmp else ; How ????<br />      jmp endcase ; How ???<br /><br />not_case_inside3:<br />      cmp     ax, IDC_UnpackBtn; an .elseif here ? how ?<br />      jnz endcase<br />      ...case 9...<br />      jmp endcase ; Maybe an .endif here ?<br /><br />not_case3:<br />       cmp     eax, WM_SYSCOMMAND<br />       jnz     endcase ;(1) Not elseif because the jumps 1 and 2<br />			; probably it is .if Inside the case3<br />			; without .endif<br />       ...some case...<br /><br />       cmp     eax, WM_CLOSE<br />       jnz     else    ; (2)<br />       ...some case...	; probably it is .if Inside the case3<br />			; with .endif that is due to jmp endcase<br />      jmp endcase<br /><br /><br />; .else block<br /><br />else:<br />    ...default case...<br /><br />endcase:<br /><br />I don't know how it jumps in the middle of the code to outside the main block and how therer are 02 points to the else instruction.</div>
    <div class="meta">Posted on 2002-01-29 17:14:33 by Beyond2000!</div>
   </div>
   <div class="post" id="post-21912">
    <div class="subject"><a href="#post-21912">Help with coding</a></div>
    <div class="body">In hand-coded stuff, a programmer may take shortcuts and jump directly to the very end of the nested case structure if no other processing is needed.<br /><br />WM_COMMAND will usually look like this:<br /><pre><code>.elseif eax == WM_COMMAND<br />    ; case 3<br />    .if ax == control1<br />        ...case 3.1...<br />    .elseif ax == control2<br />        ...case 3.2...<br />    ; other .elseif's<br />    .endif<br />    ; Hand-coded source may skip jumping to here<br />    ; One may guess that MASM will generate a JMP here<br />.elseif eax == &#40;next WM_ code&#41;<br />    ; case 4<br /></code></pre></div>
    <div class="meta">Posted on 2002-01-29 21:19:21 by tank</div>
   </div>
  </div>
 </body>
</html>