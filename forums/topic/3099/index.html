<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>BUFFER Data Buffer - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3099" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=3099">BUFFER Data Buffer</a></p>
   <div class="post" id="post-20352">
    <div class="subject"><a href="#post-20352">BUFFER Data Buffer</a></div>
    <div class="body">I am wondering if i got a string that is going to always be used in a program can i eliminate the MyString db LINE and write the string inline with the code.<br /><br />This way there is only one copy of the string and it is in a buffer....<br /><br />.............................................. THIS IS THE NORMAL WAY<br /><br />MyString db &quot;Text Text Text Text Text Text &quot;,0<br />StringBuffer DD 0<br /><br />.code<br /><br />mov esi, &quot;offset MyString&quot;<br />mov edi, offset StringBuffer<br />mov ecx, 128<br />rep movsd<br /><br />:::::::::::::::::::::::::::::: <span style="font-size:9px>THIS IS HOW I WANT TO DO IT BUT IT DON'T WORK</span> <br /><br />StringBuffer DD 0<br /><br />.code<br />mov esi, &quot;Text Text Text Text Text Text &quot;<br />mov edi, offset StringBuffer<br />mov ecx, 128<br />rep movsd<br /><br />::::::::::::::::::::::::: How do i correct this or is it even possible<br /><br />Thanks</div>
    <div class="meta">Posted on 2002-01-21 22:32:38 by cmax</div>
   </div>
   <div class="post" id="post-20354">
    <div class="subject"><a href="#post-20354">BUFFER Data Buffer</a></div>
    <div class="body">cmax,<br /><br />The register is not big enough to put the string directly into it, you must pass the eddress to the register. You can insert 4 bytes into a 32 bit register,<br /><pre><code><br />    mov eax, &quot;4321&quot;<br /></code></pre><br />But once you string is longer than 4 bytes, you must work off the address of the buffer it is stored in.<br /><br />You can directly store string data in the .CODE section but keep in mind that it is only READ ONLY data, you cannot write to it.<br /><pre><code><br />    jmp @F<br />      MyString db &quot;This is a string&quot;,0<br />    @@&#58;<br /></code></pre><br />To copy either this string or any other to another buffer, you must get the address of both the source string and the destination buffer, then you can copy one to another.<br /><pre><code><br />    mov esi, offset MyString<br />    mov edi, offset MyBuffer<br />    mov ecx, lengthof MyString<br />    rep movsb<br /></code></pre><br />Just note that depending on how you allocate the buffer to write to, you may need to use,<br /><pre><code><br />    lea edi, MyBuffer<br /></code></pre><br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-01-21 22:47:43 by hutch--</div>
   </div>
   <div class="post" id="post-20355">
    <div class="subject"><a href="#post-20355">BUFFER Data Buffer</a></div>
    <div class="body">I been tring to do this for the past 4 hours. Now I know why it did not work. This is the icing on the cake back when you explaned to me before about DWORDS...Now i think I really understand.  Everything is feed in by pieces.  What was i thinking... <br /> <br /><strong>&quot;mov ecx, lengthof MyString&quot;</strong> <span style="font-size:9px>I was looking for how to do this also</span> <br /><br /><br />Thanks Again  Hutch</div>
    <div class="meta">Posted on 2002-01-21 23:11:23 by cmax</div>
   </div>
   <div class="post" id="post-20356">
    <div class="subject"><a href="#post-20356">BUFFER Data Buffer</a></div>
    <div class="body">Maybe I've overlooked something.. but I'm posting anyway..<br />I wonder why Hutch doesn't remember his own set of macros ??? <br /><br />;)<br /><br /><pre><code><br />; Hutch's SADD Macro<br />; Use&#58; invoke MessageBox,hwnd,SADD&#40;&quot;The Message&quot;&#41;,SADD&#40;&quot;The Title&quot;&#41;,MB_OK<br />; Use&#58; mov eax,CTXT&#40;&quot;Whatever&quot;&#41;<br />; ---------------------<br />; literal string MACRO<br />; ---------------------<br />literal MACRO quoted_text<br />LOCAL local_text<br />    .data<br />    	local_text db quoted_text,0<br />    .code<br />	    EXITM &lt;local_text&gt;<br />ENDM<br />; --------------------------------<br />; string address in INVOKE format<br />; --------------------------------<br />SADD MACRO quoted_text<br />	EXITM &lt;ADDR literal&#40;quoted_text&#41;&gt;<br />ENDM<br />; --------------------------------<br />; string OFFSET for manual coding<br />; --------------------------------<br />CTXT MACRO quoted_text<br />	EXITM &lt;offset literal&#40;quoted_text&#41;&gt;<br />ENDM<br /></code></pre></div>
    <div class="meta">Posted on 2002-01-21 23:59:45 by JimmyClif</div>
   </div>
   <div class="post" id="post-20430">
    <div class="subject"><a href="#post-20430">BUFFER Data Buffer</a></div>
    <div class="body">Thanks JimmyClif, I'll go back and test this in a few minutes, but i am now posting a full example that f0dder requested that i do in an previous post:<br /><br />cmax String to Buffer Copy Tute.. This will show you how to copy a string to a buffer without calling lstrcopy if i can ever get it working right...Test it and you will see the problem...as you go down the line 4 byte will be adding from previous...i don't want that to happen...What am i'm doing wrong.<br /><br />.386<br />.model flat,stdcall<br />option casemap:none<br />WinMain proto :DWORD,:DWORD,:DWORD,:SWORD<br /><br /><br />      include \MASM32\INCLUDE\windows.inc<br />      include \MASM32\INCLUDE\gdi32.inc<br />      include \MASM32\INCLUDE\user32.inc<br />      include \MASM32\INCLUDE\kernel32.inc<br /><br />      includelib \MASM32\LIB\gdi32.lib<br />      includelib \MASM32\LIB\user32.lib<br />      includelib \MASM32\LIB\kernel32.lib<br /> <br /><br />MessageBoxA PROTO :DWORD,:DWORD,:DWORD,:DWORD<br /><br />wsprintfA PROTO C :DWORD,:VARARG<br />wsprintf equ &lt;wsprintfA&gt;<br /><br />    szText MACRO Name, Text:VARARG<br />        LOCAL lbl<br />          jmp lbl<br />            Name db Text,0<br />          lbl:<br />        ENDM<br /><br />.data<br /><br />BufferCaption1      db      'Here The Text to Test if   Buffer 1   Has Anything In It',0<br />BufferCaption2      db      'Here The Text to Test if   Buffer 2   Has Anything In It',0<br />BufferCaption3      db      'Here The Text to Test if   Buffer 3   Has Anything In It',0<br />BufferCaption4      db      'Here The Text to Test if   Buffer 4   Has Anything In It',0<br />BufferCaption5      db      'Here The Text to Test if   Buffer 5   Has Anything In It',0<br />BufferCaption6      db      'Here The Text to Test if   Buffer 6   Has Anything In It',0<br /><br /><br />.data?<br /><br />Buffer1         DWORD ?<br />Buffer2         DWORD ?<br />Buffer3         DWORD ?<br />Buffer4         DWORD ?<br />Buffer5         DWORD ?<br />Buffer6         DWORD ?<br /><br />.code<br /> Main:<br /><br />szText String1,  &quot;String1&quot;, 0<br />szText String2,  &quot;String2&quot;, 0<br />szText String3,  &quot;String3&quot;, 0<br />szText String4,  &quot;String4&quot;, 0<br />szText String5,  &quot;String5&quot;, 0<br />szText String6,  &quot;String6&quot;, 0<br /><br />;...................................      ;  Copy String To Buffer WITHOUT lstrcpy  01<br />mov esi, offset String1<br />mov edi, offset Buffer1<br />mov ecx, lengthof String1<br />rep movsd<br />;...................................      ;  Copy String To Buffer WITHOUT lstrcpy  02<br />mov esi, offset String2<br />mov edi, offset Buffer2<br />mov ecx, lengthof String2<br />rep movsd<br />;...................................      ;  Copy String To Buffer WITHOUT lstrcpy  03<br />mov esi, offset String3<br />mov edi, offset Buffer3<br />mov ecx, lengthof String3<br />rep movsd<br />;...................................      ;  Copy String To Buffer WITHOUT lstrcpy  04<br />mov esi, offset String4<br />mov edi, offset Buffer4<br />mov ecx, lengthof String4<br />rep movsd<br />;...................................      ;  Copy String To Buffer WITHOUT lstrcpy  05<br />mov esi, offset String5<br />mov edi, offset Buffer5<br />mov ecx, lengthof String5<br />rep movsd<br />;...................................      ;  NOTICE THE HAS BEEN COMMENTED OUT IS IT STILL SHOWING SOMETHING<br />;mov esi, offset String6<br />;mov edi, offset Buffer6<br />;mov ecx, lengthof String6<br />;rep movsd<br /><br /><br />invoke    MessageBoxA, NULL, offset Buffer1, offset BufferCaption1, NULL<br />invoke    MessageBoxA, NULL, offset Buffer2, offset BufferCaption2, NULL<br />invoke    MessageBoxA, NULL, offset Buffer3, offset BufferCaption3, NULL<br />invoke    MessageBoxA, NULL, offset Buffer4, offset BufferCaption4, NULL<br />invoke    MessageBoxA, NULL, offset Buffer5, offset BufferCaption5, NULL<br />invoke    MessageBoxA, NULL, offset Buffer6, offset BufferCaption6, NULL<br /><br />invoke    ExitProcess,0<br /><br />                end     Main</div>
    <div class="meta">Posted on 2002-01-22 11:12:57 by cmax</div>
   </div>
   <div class="post" id="post-20441">
    <div class="subject"><a href="#post-20441">BUFFER Data Buffer</a></div>
    <div class="body">JimmyClif i read that when you use macro, is it true that it is best to call that macro only once during start up of a program because if you call it again it will expand your program in size.  <br /><br />The main thing that i am concerned about is would this continue to happen if you call that same macro again and again while the program is running.  This is the real question...<br /><br />If anyone know? What do they mean expand in size, and by how much ( in Size ) each time.....Double, Triple or what...</div>
    <div class="meta">Posted on 2002-01-22 12:10:24 by cmax</div>
   </div>
   <div class="post" id="post-20443">
    <div class="subject"><a href="#post-20443">BUFFER Data Buffer</a></div>
    <div class="body">Macro expansion is done at assemble-time. If you use a macro like<br />CTEXT three times, you get three strings. It doesn't matter if you<br />put it inside a loop or not (except of course if it's a macro loop).<br /><br />Your code sample is pretty flawed. You try to copy a seven (or 8,<br />including the NUL character) byte string into a 4-byte DWORD...<br />this just will not work :). If you use HeapAlloc (or whatever dynamic<br />memory allocation function) to allocate memory for a buffer, you<br />should use &quot;mov edi &quot;, not &quot;mov edi, offset buffer&quot;.<br /><br />You will also want to remember that &quot;rep movsd&quot; copies dwords,<br />not bytes. You can either use &quot;rep movsb&quot;, or do the copy in two<br />parts: first dwords, then the remaining bytes.<br /><br />Anyway, what is this whole deal with buffers? I'm a bit confused<br />about your first post:<br /><div class="quote"><br />I am wondering if i got a string that is going to always be used in a program can i eliminate the MyString db LINE and write the string inline with the code. <br />This way there is only one copy of the string and it is in a buffer.... <br /></div><br /><br />if you copy strings into buffers, there will obviously be *two* copies<br />of the string. One is the source, the other is in the buffer.</div>
    <div class="meta">Posted on 2002-01-22 12:23:18 by f0dder</div>
   </div>
   <div class="post" id="post-20511">
    <div class="subject"><a href="#post-20511">So you don't Know What I am Talking About Again</a></div>
    <div class="body">f0dder, i tried all that you said and it don't work or it don't make any sense.  YOU TRY IT...<br /><br /><span style="font-size:18px>&quot;memory allocation &quot; </span>   <span style="font-size:9px>I thought a Buffer Was Memory...am i'm wrong....The string is in there is it not...</span> <br /><br />So no one know what cmax is taking about...<br /><strong>Now I post an FULL EXAMPLE.. ....</strong>  <br /><br />What you see here complys and execute with no problem other than what i posted it for....flawed or not it RUNS...<br /><br /><strong>Comply it, Run it, Change it, Than tell me about it....</strong> <br /><br />PS:<br />Strings and Buffers is all i usually ask about.  This subject is very hot to me...You can also comply only one buffer and see how perfecly it works.  The problem is when you do more than one... It make no since to me that it don't work when it should...I am to close to stop now....</div>
    <div class="meta">Posted on 2002-01-22 20:27:54 by cmax</div>
   </div>
   <div class="post" id="post-20525">
    <div class="subject"><a href="#post-20525">BUFFER Data Buffer</a></div>
    <div class="body">Hello cmax,<br />Try this, instead of:<br />Buffer1 DWORD ?<br />Buffer2 DWORD ?<br />...<br />Use this:<br />Buffer1 db 128 dup (?)<br />Buffer2 db 128 dup (?)<br />...<br /><br />Using this, you are &quot;allocating&quot; 128 bytes. Now you can copy your strings into this buffers. Using DWORDs you only have 4 bytes.<br />I hope this helps.</div>
    <div class="meta">Posted on 2002-01-22 21:22:32 by dilau</div>
   </div>
   <div class="post" id="post-20531">
    <div class="subject"><a href="#post-20531">BUFFER Data Buffer</a></div>
    <div class="body">I forgot about that.  See i knew it worked and have did that before, than days latter i forgot how i did it.  Now I know what allocation means.  It don't have to be as serious as HEAPS and all its friends.<br />Just a plain old db dup(128)<br /><br />Plain Terninolgy is my main problem<br /><br />Thanks dilau<br /><br /><br />f0dder<br /><br /><strong>&quot;Anyway, what is this whole deal with buffers? I'm a bit confused &quot;</strong> <br /><br />I use to do everything with edit boxes.  Than I got wise and wanted to do it like an real Assembler...with buffers and 32 bit register.  Than i got serious about the M32LIB....<br />I figure that Assembler is all about calling codes that you created within YOUR program with less calls as possible OUTSIDE the program....If you can eliminate even a few calls to the API because ASM can do it on it's on...and you got time to work with it than DO THAT... I like Windows and the API but if I have my way with the help of the Board, M32LIB,  and Will Power the only call outside my program would be EXIT PLEASE to the Kernel... I have gotten very greedy with what i think ASM can do<br /><br />I don't plan to tell the whole secerte of my program, than the crakers will have nothing else to do in life, But crossing out some api calls and coding it within your own app are codes that I want to share with all coders so if their program is running on my machine I know it would be the best that it can be....ASM FOREVER  Plus if you got data that you going to be using often its better to me that it live in a small buffer.  No major work to get back to it when needed....Not required for all programs but maybe for some...The only thing it does is take up space, Soooooo i was hoping  for a way not to write the string DIRECTLY to the 32bit Regesters than to buffer this way I not only got it in the buffer but now I only have ONE COPY,,,,,, Now Would'n that be the Greatest.....<br /><br />That's the whole deal about Buffers.  Can't wait to lay it all out so i can move on to the next HEAD BUSTER... All of this Did it for me....I'm sure now....and i read little artical where ever i find them....<br /><br />Thanks f0dder <br />Thanks again dilau<br />Thanks Hutch<br /><br />Hey JimmyClif, Will be Studying that Macro Tonight..Thanks</div>
    <div class="meta">Posted on 2002-01-22 22:24:52 by cmax</div>
   </div>
  </div>
 </body>
</html>