<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Coding style using FASM - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=8936" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=8936">Coding style using FASM</a></p>
   <div class="post" id="post-65785">
    <div class="subject"><a href="#post-65785">Coding style using FASM</a></div>
    <div class="body">Hello all, I am wondering if anyone wanted to discuss their personal coding style<br />using FASM's (really good) pre-processor capabilities.<br /><br />I'm curious how many people use virtual &amp; struc. Have any of you ome up with<br />interesting methods that help clean up code or make it easier to manage? How<br />many of you have taken advantage of FASM's large multipass capability?<br /><br />I _already_ know how they work, I would just like to learn how others use them in<br />their coding regime. I'm sure we all have our own unique coding style, and this isn't<br />meant to start a war over which way is best. <br /><br />For example:<br /><br />Since I switched to FASM I was able to start coding my operating system using only<br />one file. Mainly do to the ability of FASM's org directive to be used &quot;intelligently.&quot; This<br />has a number of advantages. I'm now able to avoid using makefiles and cumbersome<br />directory hierarchies. This lets me save a lot of time when I need to reorganize code.<br /><br />I haven't started using virtual/struc too much yet, but will probably get into them a<br />good deal. <br /><br />For the possible comment or forty-two on how style doesn't matter...<br />Legibility is a big issue not only for others reading your source but for you as well.<br />The line-by-line iterative programming style of assembly language is a main reason I<br />use asm to do all my coding. I found myself spending 50% of my time reorganizing HLL<br />code instead of actually programming it. (There goes the 80/20 theory!)<br /><br />Keep up the assembling!<br /> Joseph</div>
    <div class="meta">Posted on 2002-11-14 08:24:07 by jwm</div>
   </div>
   <div class="post" id="post-66564">
    <div class="subject"><a href="#post-66564">Coding style using FASM</a></div>
    <div class="body">OK, let's make this thread active, because it's interesting theme. <br /><br />So, I am strange bird: Assembler and Pascal programmer. I never write on C and I don't like C. As Pascal programmer, I prefere to use clear data definitions and clear structured data and programs at all.<br /><br />Began to use fasm, I try to use (and I am using) &quot;struc&quot; constructions very offen (more than &quot;macro&quot; constructions, because I don't like macroses very much, I think they makes source very unreadable. But struct is another deal. Using struct I can make my data very structured and readable almost like Pascal code and it's good. :)<br /><br />But in fasm, sometimes, my noble intentions conflict with some syntax constructions. For example:<br /><br />Using standard include files, appended to the fasm package, all structures are defined without data (using only rd, rw etc. constructions). This means, that if I use them, I must write program to fill actual data in the data structures. But WHY??? I must write following if I need only one constant data structure (This case is very common in Win32 programming):<br /><br />section '.data' data readable writeable<br />...<br />MyWinClass    WNDCLASS<br />...<br />section '.code' code readable executable<br />...???<br />        mov     ,eax<br />        mov     ,0<br />        mov     ,WindowProc<br />        mov     ,0<br />        mov     ,0<br />...<br /><br />It's a very bad method to make static data. I think and I began to make some structures with parameters, because to make them self defineable in compile time. <br /><br />Example:<br /><br />struc TPoint x,y {<br />  .X       dd    x<br />  .Y       dd    y<br />  .Size  =      $ - .X<br />}<br /><br />virtual at 0<br />  TPoint TPoint ?,? <br />end virtual<br /><br />Point1 TPoint 10,10<br />Point2 TPoint 20,20<br />Point3 TPoint 30,40<br />Point4 TPoint 0,0<br /><br />So, how I use this in program. Let's we have some pointer to the array of points. And lets loop through this array and call some subroutine on every point. Array ends with Point 0,0<br /><br />       mov     esi,Point1<br />.arrloop:<br />       mov    eax,<br />       or       eax,<br />       jz        .EndLoop<br /><br />       call     WorkOnPoint         ;  is pointer to the TPoint structure<br />       <br />       add     esi,TPoint.Size <br />       jmp     .arrloop<br /><br />.EndLoop:<br /><br />This is simple. But how we can init more complex data structures:<br /><br />struc TPoint X1,Y1 {<br />  .X dd X1<br />  .Y dd Y1<br />}<br /><br /><br />struc TRect  ATopLeft, ABottomRight {<br />  .TopLeft   TPoint ATopLeft<br />  .BottomRight  TPoint ABottomRight<br />}<br /><br /><br />virtual at 0<br />  TPoint TPoint 0,0<br />end virtual<br /><br />virtual at 0<br />  TRect TRect 0,0,0,0<br />end virtual<br /><br />The above example not works at all! If we want to make it works we must use some &quot;rd&quot; form, and init data manualy with program code:<br /><br />struc TPoint {<br />  .X rd 1<br />  .Y rd 1<br />}<br /><br />struc TRect {<br />  .TopLeft   TPoint<br />  .BottomRight  TPoint<br />}<br /><br />virtual at 0<br />  TPoint TPoint<br />end virtual<br /><br />virtual at 0<br />  TRect TRect<br />end virtual<br /><br />MyRect  TRect<br /><br />        mov     eax,123<br />        mov     ,eax<br />        mov     eax,234<br />        mov     ,eax<br />        mov     eax,345<br />        mov     ,eax<br /><br />This works, but this needless code, (sometimes a hundreds lines) I think must be avoided.<br /><br />This difficulty to use &quot;struc&quot; with parameters are related to the struc and macro parameter passing syntax in fasm. Some of my suggestions are here:<br /><br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=8881">http://www.asmcommunity.net/board/index.php?topic=8881</a><span style="font-size:9px>small</span> <span style="font-size:9px>test</span></div>
    <div class="meta">Posted on 2002-11-20 04:27:05 by JohnFound</div>
   </div>
   <div class="post" id="post-66569">
    <div class="subject"><a href="#post-66569">Coding style using FASM</a></div>
    <div class="body">Why not:<br /><pre><code><br />struc TPoint X1,Y1<br />&#123; .X dd X1<br />  .Y dd Y1 &#125;<br /><br />struc TRect Top,Left, Bottom,Right<br />&#123; .TopLeft TPoint Top,Left<br />  .BottomRight TPoint Bottom,Right &#125;<br /><br />virtual at 0<br />  TPoint TPoint ?,?<br />end virtual<br /><br />virtual at 0<br />  TRect TRect ?,?,?,?<br />end virtual<br /><br /></code></pre>?<br /><br />BTW, I was also a Pascal programmer, I was learning assembly by writing assembly procedures for my Turbo Pascal programs, and when there started to be more assembly than Pascal code in my sources, I moved to TASM. And then (well, much later) I was trying to make my own compiler - I wanted something like C, but with simplier access to assembly (maybe something like C--, but my ideas were slightly different), it was never finished, but it was able to compile assembly language, so I renamed it to ASM32 and started to use it, because it had syntax I liked more than the TASM's (but it was based on the TASM's Ideal mode, with a little influence of NASM, but I was never using NASM, the realy versions of it were so terribly slow... but it had some nice syntax ideas), and no linking process was needed. Only raw binary output format was supported (handy only for .COM files), but I was also creating DOS32 executables, because I was using that extender for almost all my projects these days. But then I had made my own extender, based on the open-source PMODE, but heavily patched and extended by me, and I was back using TASM, because my ASM32 was too slow, buggy and incompatible for such big projects. When my extender came to version 2.0, it had support for my own format of executables (using the flat memory model), and it started to be too complicated to use TASM for this purpose, I was also trying to write my own OS, and it was terrible to do it with TASM (I hated &quot;db&quot;-built instructions). So I decided to write an assembler once again, and this time (having an experience from writing ASM32) do it good. And so the fasm was born, first version also with flat binary output only, but it was simple to create headers and code for my executable format in this mode; also first version of fasm was in this format, running under my extender. And I had implemented almost all what I wanted - the clean syntax with all rare syntax options for the OS/extender writing purposes, and also simple TASM-Ideal-like macroinstruction system, with the exception that I decided it's simplier to search for the &quot;}&quot; character than for the &quot;ENDM&quot; word, but it was not because of my sympathy to C (in fact, I don't like C), but because round and square brackets were already reserved for other purposes.<br />And when I finally decided to release fasm officially (about six months later), I removed the extender (because it was big, slow, and buggy) and changed the code to work in flat real mode (it's also flat memory model, so it was no problem). And released it as the 0.9.x series on the FreeDOS project pages (and it's still one of the FreeDOS projects today), then in 1.0 introduced ability to format the output (the new additional format was MZ), and then in 1.04 added PE support and Win32 version and... it was growing and growing. I see I have written much more that I wanted, and a little off-topic, forgive me, that's enough.</div>
    <div class="meta">Posted on 2002-11-20 05:31:26 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-66571">
    <div class="subject"><a href="#post-66571">Coding style using FASM</a></div>
    <div class="body">Thanks for a really good reply. I was beginning to think noone cared about coding style. :(<br /><br />When I used the struc {} I'd not initialize the data.<br /><br />I'd do:<br /><br />struc SECTION_DATA {<br /> .msg:<br />   db 'Hello'<br /> }<br /><br />my_code1:<br />mov bx, .data.msg<br />.data SECTION_DATA<br /><br />my_code2:<br />mov bx, my_code1.data.msg<br /><br />The above just kept data away from my code and let me put it at another place in the file. I'm sure there are a lot of other uses one could find.<br /><br />I look forward to dropping IA32 on its head and moving on to IA64/Itanium. it's going to be a little expensive but for my projects that I do I think it will be very beneficial. Just thinking about programming in assembly with EPIC and many many general purpose registers gets my mouth watering. The best of RISC &amp; CISC with the good of explicit CPU parallelization. ASM hackers dream! Compilers eat your heart out!<br /><br />Btw, is John Found a play on John Fine?<br />:tongue:</div>
    <div class="meta">Posted on 2002-11-20 05:45:54 by jwm</div>
   </div>
   <div class="post" id="post-66576">
    <div class="subject"><a href="#post-66576">Coding style using FASM</a></div>
    <div class="body">Hi Privalov!<br /><br />About your example:<br /><br />Yes, I know that this is one way to make this in my example with Points and rectangles. And this is way to make this in all complex structures. But imagine the structure with 3 or 4 levels of struc definitions:<br /><br />struc S1 {<br />...<br />} <br /><br />struc S2 {<br />...<br />  .s11 S1<br />  .s12 S1<br />...<br />}<br /><br />struc S3 {<br />  .s21 S2<br />  .s22 S2<br />  .s13 S1<br />}<br /><br />struc S4 {<br />  .s31 S3<br />  .s14 S1<br />  .s23 S2<br />  .s32 S3<br />}<br /><br />and now imagine all these parameters in one row separated with commas. This (IMHO) is very very unreadable. In other words, I think that fasm need some structured method of parameter passing. With brackets or with names. Note that every of this methods is optional, if I want, I will write:<br /><br />MyStr  MyStruc  1,2,3,4,5,6<br /><br />or<br /><br />MyStr  Mystruc  (1,2), (3,(4,5)), 6<br /><br />That is all.<br /><br />P.S. BTW I don't think that brackets &quot;{}&quot; is diference between C and Pascal. :) <br />Actually I think FASM is more &quot;Pascal like&quot; than C. And this is the reason I like it.<br /><br />:alright:</div>
    <div class="meta">Posted on 2002-11-20 06:35:43 by JohnFound</div>
   </div>
   <div class="post" id="post-66579">
    <div class="subject"><a href="#post-66579">Coding style using FASM</a></div>
    <div class="body">Maybe some other idea I had from the beginning of fasm project (but never implemented it) would be useful for such purpose. This is the idea of specifying the separators for arguments for macro, like in the following example (each example macro finally produce the same code)<br /><pre><code><br />; WARNING&#58; EXAMPLES OF UNIMPLEMENTED FEATURE&#58;<br /><br />macro mv arg1,arg2<br /> &#123; mv arg1,arg2 &#125;<br /><br />mv al,1<br /><br />macro mv arg1 arg2<br /> &#123; mv arg1,arg2 &#125;<br /><br />mv al 1<br /><br />macro mv arg1-&gt;arg2<br /> &#123; mv arg2,arg1 &#125;<br /><br />mv 1 -&gt; al<br /><br />macro mv &#40;arg1=arg2&#41;<br /> &#123; mv arg1,arg2 &#125;<br /><br />mv &#40;al=1&#41;<br /></code></pre><br />As I said, this is the idea I had when I was designing the macroinstructions system for fasm, but it has never got implemented, maybe in future... (some version 2.0?)</div>
    <div class="meta">Posted on 2002-11-20 06:49:38 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-66580">
    <div class="subject"><a href="#post-66580">Coding style using FASM</a></div>
    <div class="body">Hi <strong>Privalov</strong>, you wrote:<br /><div class="quote">I see I have written much more that I wanted, and a little off-topic, forgive me, that's enough.</div>Nope, very interesting reading instead. :alright:</div>
    <div class="meta">Posted on 2002-11-20 06:50:29 by Maverick</div>
   </div>
  </div>
 </body>
</html>