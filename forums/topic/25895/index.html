<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>NASM 64-bit Support is HERE!!! - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25895" />
    <link rel="next" href="../?id=25895&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=25895">NASM 64-bit Support is HERE!!!</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=25895&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=25895&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="25895" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=25895&amp;page=2">&gt;</a><a href="../?id=25895&amp;page=2">&raquo;</a></form>   <div class="post" id="post-188810">
    <div class="subject"><a href="#post-188810">NASM 64-bit Support is HERE!!!</a></div>
    <div class="body">My modifications to NASM for general x86-64/x64/AMD64/EM64T support have been uploaded to the <a target="_blank" href="http://sourceforge.net/cvs/?group_id=6208"><u>NASM CVS</u></a>.<br /><br />It will probably take some time for some possible bug fixes and various &quot;official&quot; testing before it will be considered a stable release, but you can be apart of this process to help bring it out as a full release by compiling the latest CVS version and testing various 64-bit code against it!!!<br /><br />Enjoy :)</div>
    <div class="meta">Posted on 2007-04-11 21:55:29 by SpooK</div>
   </div>
   <div class="post" id="post-188838">
    <div class="subject"><a href="#post-188838">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body">There has already been some major code overhaul due to NASM now trying to be c99 compliant. All significant warning/error messages have been suppressed and I&#39;ve confirmed this with Dev-Cpp 4.9.9.2 (MinGW 3.4.2), GCC4 for Linux and Pelles C for Win32.<br /><br />The <a target="_blank" href="http://sourceforge.net/cvs/?group_id=6208"><u>CVS</u></a> should reflect this change. However it seems to take SourceForge anonymous <a target="_blank" href="http://sourceforge.net/cvs/?group_id=6208"><u>CVS</u></a> from 24-48 hours to sync with the developer <a target="_blank" href="http://sourceforge.net/cvs/?group_id=6208"><u>CVS</u></a>.<br /><br />Also, Charles Crayne has volunteered to implement ELF64 support in NASM. With win64 (MS COFF) support already available, this should complete support for the mainstream 64-bit object formats. Not to mention that Flat Binary and RDOFF already support 64-bit :)</div>
    <div class="meta">Posted on 2007-04-14 11:57:16 by SpooK</div>
   </div>
   <div class="post" id="post-188839">
    <div class="subject"><a href="#post-188839">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body">Cool :)<br /></div>
    <div class="meta">Posted on 2007-04-14 12:46:49 by f0dder</div>
   </div>
   <div class="post" id="post-188855">
    <div class="subject"><a href="#post-188855">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body">is the syntax for 64bit code already decided, or are only your internal changes uploaded?</div>
    <div class="meta">Posted on 2007-04-15 16:16:31 by vid</div>
   </div>
   <div class="post" id="post-188856">
    <div class="subject"><a href="#post-188856">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body"><div class="quote"><br />is the syntax for 64bit code already decided, or are only your internal changes uploaded?<br /></div><br /><br />EDIT: I just remembered one of our previous conversations :!:<br /><br />If you are referring to how RIP-relative addressing will be handled, we are probably going to keep it consistent with the other segment-relative forms.<br /><br />In summary, we are shooting for <em></em> as the syntax of choice for RIP-relative addressing. Simple, yet effective ;)<br /><br />If <strong>THAT</strong> wasn&#39;t what you were referring to, vid, please let me know as to what you are asking and I&#39;ll try to respond as soon as I can :)</div>
    <div class="meta">Posted on 2007-04-15 16:23:19 by SpooK</div>
   </div>
   <div class="post" id="post-188871">
    <div class="subject"><a href="#post-188871">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body">yes, i was asking about RIP-relative addressing. But i don&#39;t really understand your response.<br /><br />You mean that &quot;mov eax, &quot; uses absolute addressing, and &quot;mov eax, &quot; uses RIP-relative addressing?<br /><br />If yes, i don&#39;t think it&#39;s really the best idea, RIP-relative addressing is what you want 99.99% times in 64bit code.<br /><br />Also, how will then look like instruction with segment prefix and RIP-relative addressing? &quot;mov eax, &quot;?</div>
    <div class="meta">Posted on 2007-04-16 07:41:39 by vid</div>
   </div>
   <div class="post" id="post-188872">
    <div class="subject"><a href="#post-188872">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body">From how I see it, I think it should be a flag, which selects the default behavior (so that one can choose his/her preferred style) and a method to override it. The flag should be changeable at any desired location in the source to allow easy mixing of functions written by different people.</div>
    <div class="meta">Posted on 2007-04-16 08:28:59 by ti_mo_n</div>
   </div>
   <div class="post" id="post-188873">
    <div class="subject"><a href="#post-188873">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body"><div class="quote"><br />yes, i was asking about RIP-relative addressing. But i don&#39;t really understand your response.<br /><br />You mean that &quot;mov eax, &quot; uses absolute addressing, and &quot;mov eax, &quot; uses RIP-relative addressing?<br /><br />If yes, i don&#39;t think it&#39;s really the best idea, RIP-relative addressing is what you want 99.99% times in 64bit code.<br /></div><br /><br />Then that is what the programmer must use when they want RIP-relative addressing. NASM doesn&#39;t ASSUME.<br /><br /><div class="quote"><br />Also, how will then look like instruction with segment prefix and RIP-relative addressing? &quot;mov eax, &quot;?<br /></div><br /><br />CS doesn&#39;t apply in long mode, just like DS/ES/SS... but FS and GS are still addressable. Nice catch vid. I&#39;ll let the others know about this little oversight. Not much of an issue though, NASM is internally capable of both ATM.</div>
    <div class="meta">Posted on 2007-04-16 08:31:38 by SpooK</div>
   </div>
   <div class="post" id="post-188874">
    <div class="subject"><a href="#post-188874">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body"><div class="quote"><br />From how I see it, I think it should be a flag, which selects the default behavior (so that one can choose his/her preferred style) and a method to override it. The flag should be changeable at any desired location in the source to allow easy mixing of functions written by different people.<br /></div><br /><br />I don&#39;t think this would be in tune with NASM philosophy. NASM, more or less, requires the programmer to specify, with an exactitude, what instructions they wish to use. I think one of the things people enjoy about NASM is that it does not make assumptions or hide anything from the programmer.<br /><br />However, 64-bit (long mode) might break this tradition. I guess we&#39;ll see which way things go ;)</div>
    <div class="meta">Posted on 2007-04-16 08:35:08 by SpooK</div>
   </div>
   <div class="post" id="post-188875">
    <div class="subject"><a href="#post-188875">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body">SpooK, nasm already added jump destination size optimization ages ago, RIP addressing would be a smart thing as well... <strong>ti_mo_n</strong>&#39;s suggestion sounds like the best way to handle it.<br /></div>
    <div class="meta">Posted on 2007-04-16 10:02:40 by f0dder</div>
   </div>
   <div class="post" id="post-188877">
    <div class="subject"><a href="#post-188877">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body"><div class="quote"><br />SpooK, nasm already added jump destination size optimization ages ago, RIP addressing would be a smart thing as well... <strong>ti_mo_n</strong>&#39;s suggestion sounds like the best way to handle it.<br /><br /></div><br /><br />All-in-all, it is not up to me... but I&#39;ve forwarded the request to the project managers :)</div>
    <div class="meta">Posted on 2007-04-16 10:55:33 by SpooK</div>
   </div>
   <div class="post" id="post-188884">
    <div class="subject"><a href="#post-188884">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body"><div class="quote">CS doesn&#39;t apply in long mode, just like DS/ES/SS</div><br />are you sure about this? No segmentation with CS/DS/ES/SS in longs mode, but yes for FS and ES? Sounds weird to me.</div>
    <div class="meta">Posted on 2007-04-16 14:43:01 by vid</div>
   </div>
   <div class="post" id="post-188887">
    <div class="subject"><a href="#post-188887">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body"><div class="quote"><br /><div class="quote">CS doesn&#39;t apply in long mode, just like DS/ES/SS</div><br />are you sure about this? No segmentation with CS/DS/ES/SS in longs mode, but yes for FS and ES? Sounds weird to me.<br /></div><br /><br />If you meant &quot;yes for FS and GS&quot;, then I am 100% positive as the others are &quot;allowed&quot; but <strong>ignored</strong> in long mode... and as per the official docs...<br /><br /><strong><u>AMD x86-64 Architecture Programmer&#39;s Manual, Volume III, Revision 3.12, Appendix C, Page 396 (absolute page 426 in Adobe Acrobat)</u></strong><br />Segmentation:<br />CS, DS, ES, SS segment bases are ignored<br />CS, DS, ES, FS, GS, SS segment limits are ignored<br />CS, DS, ES, SS Segment prefixes are ignored<br /><br />GoASM, YASM, diStorm and GAS agree... not sure about FASM, though.</div>
    <div class="meta">Posted on 2007-04-16 18:42:39 by SpooK</div>
   </div>
   <div class="post" id="post-188889">
    <div class="subject"><a href="#post-188889">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body"><div class="quote">&quot;mov eax, &quot;?</div><br /><br />That would be kinda weird, but don&#39;t forget that NASM also supports the regular prefixing syntax:<br /><br /><pre><code>cs mov eax,</code></pre><br /><br />Which wouldn&#39;t look as bad. I tend to use this method when working with structures in other segments that are pointed to by variables. ie (taken from some REALLY old code of mine) :lol:<br /><br /><pre><code>ES mov , AX ; store color in screen table.</code></pre><br /><br /><div class="quote">If you meant &quot;yes for FS and GS&quot;, then I am 100% positive as the others are &quot;allowed&quot; but ignored in long mode... and as per the official docs...</div><br /><br />Bleh, does it say why it ignores them now? Doesn&#39;t really make since to me to drop support for segment prefixes, as it does add for code clearity and organization.<br /></div>
    <div class="meta">Posted on 2007-04-16 23:49:41 by Synfire</div>
   </div>
   <div class="post" id="post-188891">
    <div class="subject"><a href="#post-188891">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body"><div class="quote"><br /><div class="quote">&quot;mov eax, &quot;?</div><br /><br />That would be kinda weird, but don&#39;t forget that NASM also supports the regular prefixing syntax:<br /><br /><pre><code>cs mov eax,</code></pre><br /><br />Which wouldn&#39;t look as bad. I tend to use this method when working with structures in other segments that are pointed to by variables. ie (taken from some REALLY old code of mine) :lol:<br /><br /><pre><code>ES mov , AX ; store color in screen table.</code></pre><br /><br /></div><br /><br />That would be kind of interesting... and I would have to re-train myself... again :O<br /><br />Right now we are leaning towards simply using . However, we are contemplating using , in the same manner that  works. In this case, FS/GS would be  and it should stay rather consistent. The catch being that we would also have to implement  for cases where  would look a bit bulky.<br /><br />However, I think we&#39;ve firmly decided to stay away from the over-complexity that YASM uses (e.g. ). The reason being is that NASM can (and does) internally make the distinction between labels (local and global addresses) and immediate values (numeric constants and assigns/defines)... and RIP-relative addressing is no exception.<br /><br />At any rate, some things are up in the air ATM and I will let people know if anything is decided before I go on my vacation :)<br /><br /><div class="quote"><br /><div class="quote">If you meant &quot;yes for FS and GS&quot;, then I am 100% positive as the others are &quot;allowed&quot; but ignored in long mode... and as per the official docs...</div><br /><br />Bleh, does it say why it ignores them now? Doesn&#39;t really make since to me to drop support for segment prefixes, as it does add for code clearity and organization.<br /></div><br /><br />Probably due to the fact that segmentation is all but deprecated (still used for privilege checks, but forced to be &quot;flat&quot;) in long mode. Personally, I think it is about time that they stop waisting their effort on an obsolete addressing mechanism. Though, as an OS developer who favors &quot;paging&quot; if anything, I am biased in that respect :P<br /><br />It almost seems FS/GS are still used to appease the please-don&#39;t-break-Microsoft-code gods :lol:</div>
    <div class="meta">Posted on 2007-04-17 00:27:22 by SpooK</div>
   </div>
   <div class="post" id="post-188892">
    <div class="subject"><a href="#post-188892">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body">Well, segmentation is a relic from the past, so that&#39;s why it&#39;s now deprecated ;) Paging is a lot more cool ^^ The stuff that SpooK quoted from AMD&#39;s manuals also holds true for Intel CPUs, obviously, since there is a similiar sentence in their manuals ^^</div>
    <div class="meta">Posted on 2007-04-17 02:07:45 by ti_mo_n</div>
   </div>
   <div class="post" id="post-188893">
    <div class="subject"><a href="#post-188893">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body">FS is useful enough for pointing at per-thread information, which is probably why it was kept - easier (and faster?) to change FS on a thread context switch instead of, say, remapping a virtual address.<br /></div>
    <div class="meta">Posted on 2007-04-17 03:14:09 by f0dder</div>
   </div>
   <div class="post" id="post-188896">
    <div class="subject"><a href="#post-188896">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body">True, this is precisely why <strong>fs</strong> and <strong>gs</strong> were kept ^^ They are, kind of, &quot;general purpose, OS-specific registers&quot; :)</div>
    <div class="meta">Posted on 2007-04-17 08:51:28 by ti_mo_n</div>
   </div>
   <div class="post" id="post-188897">
    <div class="subject"><a href="#post-188897">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body"><div class="quote"><br />True, this is precisely why <strong>fs</strong> and <strong>gs</strong> were kept ^^ They are, kind of, &quot;general purpose, OS-specific registers&quot; :)<br /></div><br /><br />Darn, I was hoping it was from all that hard work in adding FS and GS to the 386 :(</div>
    <div class="meta">Posted on 2007-04-17 08:59:07 by SpooK</div>
   </div>
   <div class="post" id="post-188898">
    <div class="subject"><a href="#post-188898">Re: NASM 64-bit Support is HERE!!!</a></div>
    <div class="body">Poor SpooK :(&nbsp;  :P</div>
    <div class="meta">Posted on 2007-04-17 09:16:49 by ti_mo_n</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=25895&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=25895&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="25895" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=25895&amp;page=2">&gt;</a><a href="../?id=25895&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>