<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>some dos asm code - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29256" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=115">DOS &amp; BIOS</a> &raquo; <a href="../?id=29256">some dos asm code</a></p>
   <div class="post" id="post-206704">
    <div class="subject"><a href="#post-206704">some dos asm code</a></div>
    <div class="body">this is some asm code use dos <br /><br />now, I don&#039;t use asm normal, welcode to talk with me.<br /><br />My msn is: mnzn2530@hotmail.com<br /><br /><br />this is a TSR, I write is in windows command, not dos, but it run ok<br />it&#039;s simple, isn&#039;s it?<br /><br /><br /><pre><code><br />code segment<br />assume cs:code<br />start:	<br />	jmp begin<br />	oldint9 dd ?<br />	mystack dw 100H dup(?)<br />	<br />begin:	<br />	mov ax, code<br />	mov ds, ax<br />	mov ss, ax<br />	mov sp, offset begin<br /><br />	mov ah, 35H<br />	mov al, 9<br />	int 21H<br /><br />	mov word ptr , bx<br />	mov bx, es<br />	mov word ptr , bx<br />	<br />	mov ah, 25H<br />	lea dx, newint9<br />	int 21H<br />	<br />	mov dx, offset enddata<br />	mov cx, 4<br />	shr dx, cl<br />	mov ah, 31H<br />	int 21H<br /><br />newint9:<br />	jmp newint9begin<br />	buffer db 4000 dup(?)<br />	color db 0<br />newint9begin:<br />	push ax<br />	push bx<br />	push cx<br />	push ds<br />	push es<br />	push si<br />	push di<br /><br />	in al, 60H<br /><br />	pushf<br /><br />	pushf<br />	pop bx<br />	and bh, 11111100B<br />	push bx<br />	popf<br />	call dword ptr <br />	<br />	mov bx, 0b800H<br />	mov ds, bx<br />	mov si, 1<br />	mov cx, 2000<br /><br />	mov bl, <br />	inc bl<br />	mov , bl<br />int9loop:<br />	mov , bl<br />	add si, 2<br />	loop int9loop<br /><br />	pop di<br />	pop si<br />	pop es<br />	pop ds<br />	pop cx<br />	pop bx<br />	pop ax<br />	<br />	iret<br />enddata:<br />	nop<br />code ends<br />end start<br /></code></pre><br /><br /><br />next is a miniminivi, yeah, it&#039;s a edit!!<br />but not complete, I hope someome can&#039;t write it and me.<br />joy it!<br /><br /><pre><code><br />assume cs:code, ds:data<br />data segment<br />&nbsp; &nbsp; showstr1 db &quot;This is my edit for dos&quot;, &#039;$&#039;<br />&nbsp; &nbsp; showstr2 db &quot;if you get any bug , please tell me&quot;, &#039;$&#039;<br />&nbsp; &nbsp; showstr3 db &quot;--------------- thank ! QQ:676361476&quot;, &#039;$&#039;<br />&nbsp; &nbsp; part db &#039;________________________________________________________________________________&#039;, &#039;$&#039;<br />&nbsp; &nbsp; login db &quot;please press any key to continue&quot;, &#039;$&#039;<br />&nbsp; &nbsp; line db 0<br />&nbsp; &nbsp; row db 0<br />&nbsp; &nbsp; ;; ????????? <br />&nbsp; &nbsp; m_e_begin db &quot;you are in begin........&quot;, &#039;$&#039;<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; numberofline db 23 dup(0)<br />&nbsp; &nbsp; buffer db 2000 dup (0)<br />data ends<br /><br />code segment<br />main:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ?????<br />&nbsp; &nbsp; call menu<br />&nbsp; &nbsp; call keyboard<br />&nbsp; &nbsp; call flushall<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; mov ax, 4c00H<br />&nbsp; &nbsp; int 21H&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ?????<br /><br />;;--------------------------------------------------------------------- <br />&nbsp; &nbsp; <br />menu proc near&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ??????<br />&nbsp; &nbsp; push ax<br />&nbsp; &nbsp; push bx<br />&nbsp; &nbsp; push dx<br />&nbsp; &nbsp; call flushclient<br />&nbsp; &nbsp; call flushmessage<br /><br />&nbsp; &nbsp; mov ax, data<br />&nbsp; &nbsp; mov ds, ax<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; mov ah, 2<br />&nbsp; &nbsp; mov bh, 0<br />&nbsp; &nbsp; mov dh, 12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ??<br />&nbsp; &nbsp; mov dl, 26&nbsp; &nbsp; &nbsp; &nbsp; ; ??<br />&nbsp; &nbsp; int 10H<br />&nbsp; &nbsp; lea dx, showstr1<br />&nbsp; &nbsp; mov al, 0<br />&nbsp; &nbsp; mov ah, 9<br />&nbsp; &nbsp; int 21H<br /><br />&nbsp; &nbsp; mov ah, 2<br />&nbsp; &nbsp; mov bh, 0<br />&nbsp; &nbsp; mov dh, 14&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ??<br />&nbsp; &nbsp; mov dl, 20&nbsp; &nbsp; &nbsp; &nbsp; ; ??<br />&nbsp; &nbsp; int 10H<br />&nbsp; &nbsp; lea dx, showstr2<br />&nbsp; &nbsp; mov al, 0<br />&nbsp; &nbsp; mov ah, 9<br />&nbsp; &nbsp; int 21H<br /><br />&nbsp; &nbsp; mov ah, 2<br />&nbsp; &nbsp; mov bh, 0<br />&nbsp; &nbsp; mov dh, 16&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ??<br />&nbsp; &nbsp; mov dl, 20&nbsp; &nbsp; &nbsp; &nbsp; ; ??<br />&nbsp; &nbsp; int 10H<br />&nbsp; &nbsp; lea dx, showstr3<br />&nbsp; &nbsp; mov al, 0<br />&nbsp; &nbsp; mov ah, 9<br />&nbsp; &nbsp; int 21H<br /><br />&nbsp; &nbsp; mov ah, 2<br />&nbsp; &nbsp; mov bh, 0<br />&nbsp; &nbsp; mov dh, 23&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ??<br />&nbsp; &nbsp; mov dl, 0&nbsp; &nbsp; &nbsp; &nbsp; ; ??<br />&nbsp; &nbsp; int 10H<br />&nbsp; &nbsp; lea dx, part<br />&nbsp; &nbsp; mov al, 0<br />&nbsp; &nbsp; mov ah, 9<br />&nbsp; &nbsp; int 21H<br /><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; mov ah, 2<br />&nbsp; &nbsp; mov bh, 0<br />&nbsp; &nbsp; mov dh, 24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ??<br />&nbsp; &nbsp; mov dl, 0&nbsp; &nbsp; &nbsp; &nbsp; ; ??<br />&nbsp; &nbsp; int 10H<br />&nbsp; &nbsp; lea dx, login<br />&nbsp; &nbsp; mov al, 0<br />&nbsp; &nbsp; mov ah, 9<br />&nbsp; &nbsp; int 21H<br /><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; mov ax, 0<br />&nbsp; &nbsp; int 16H<br /><br />&nbsp; &nbsp; mov ah, 2<br />&nbsp; &nbsp; mov bh, 0<br />&nbsp; &nbsp; mov dh, 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ??<br />&nbsp; &nbsp; mov dl, 0&nbsp; &nbsp; &nbsp; &nbsp; ; ??<br />&nbsp; &nbsp; int 10H<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; call flushclient&nbsp; &nbsp; &nbsp; &nbsp; ; ?????<br />&nbsp; &nbsp; call flushmessage&nbsp; &nbsp; &nbsp; &nbsp; ; ?????<br /><br />&nbsp; &nbsp; pop dx<br />&nbsp; &nbsp; pop bx<br />&nbsp; &nbsp; pop ax<br />&nbsp; &nbsp; ret<br />menu endp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ??????<br /><br />;;------------------------------------------------------------------ <br />&nbsp; &nbsp; <br />keyboard proc near&nbsp; &nbsp; &nbsp; &nbsp; ; ??????<br />keybegin:&nbsp; &nbsp; <br />&nbsp; &nbsp; push ax<br />get:<br />&nbsp; &nbsp; mov ah, 0<br />&nbsp; &nbsp; int 16H<br /><br />&nbsp; &nbsp; cmp ah, 53H<br />&nbsp; &nbsp; je keyboardend<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; cmp al, 20H<br />&nbsp; &nbsp; jb nochar<br />&nbsp; &nbsp; mov ah, 0&nbsp; &nbsp; &nbsp; &nbsp; ; ????<br />&nbsp; &nbsp; call charstack<br />&nbsp; &nbsp; mov ah, 2<br />&nbsp; &nbsp; mov dx, 0<br />&nbsp; &nbsp; call charstack&nbsp; &nbsp; &nbsp; &nbsp; ; ??????<br />&nbsp; &nbsp; jmp get<br /><br />nochar:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ?????<br />&nbsp; &nbsp; cmp ah, 0eH&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ???<br />&nbsp; &nbsp; je backspace<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; cmp ah, 53H&nbsp; &nbsp; &nbsp; &nbsp; ; ?????????<br />&nbsp; &nbsp; je keyboardend<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; jmp get&nbsp; &nbsp; &nbsp; &nbsp; ; ???????<br /><br />&nbsp; &nbsp; <br />backspace:<br />&nbsp; &nbsp; mov ah, 1<br />&nbsp; &nbsp; call charstack<br />&nbsp; &nbsp; mov ah, 2<br />&nbsp; &nbsp; mov dx, 0<br />&nbsp; &nbsp; call charstack<br />&nbsp; &nbsp; jmp get<br />&nbsp; &nbsp; <br />keyboardend:<br />&nbsp; &nbsp; pop ax<br />&nbsp; &nbsp; ret<br />keyboard endp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ??????<br />&nbsp; &nbsp; ;;<br /><br />;;-----------------------------------------------------<br />charstack proc near<br />&nbsp; &nbsp; jmp short charstart<br />&nbsp; &nbsp; table dw charpush, charpop, charshow<br />&nbsp; &nbsp; top dw 0<br />&nbsp; &nbsp; index dw 0<br />charstart:&nbsp; &nbsp; <br />&nbsp; &nbsp; push bx<br />&nbsp; &nbsp; push dx<br />&nbsp; &nbsp; push di<br />&nbsp; &nbsp; push es<br /><br />&nbsp; &nbsp; mov bx, data<br />&nbsp; &nbsp; mov ds, bx<br />&nbsp; &nbsp; lea si, buffer<br /><br />&nbsp; &nbsp; cmp ah, 2<br />&nbsp; &nbsp; ja sret<br />&nbsp; &nbsp; mov bl, ah<br />&nbsp; &nbsp; mov bh, 0<br />&nbsp; &nbsp; add bx, bx<br />&nbsp; &nbsp; jmp word ptr table<br /><br />charpush:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;?? ?????<br />&nbsp; &nbsp; mov bx, top<br />&nbsp; &nbsp; mov , al<br />&nbsp; &nbsp; inc top<br />&nbsp; &nbsp; jmp sret<br /><br />charpop:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ???????<br />&nbsp; &nbsp; cmp top, 0<br />&nbsp; &nbsp; je sret<br />&nbsp; &nbsp; dec top<br />&nbsp; &nbsp; mov bx, top<br />&nbsp; &nbsp; mov al, <br />&nbsp; &nbsp; jmp sret<br /><br />charshow:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ??????????<br />&nbsp; &nbsp; mov bx, 0b800H<br />&nbsp; &nbsp; mov es, bx<br />&nbsp; &nbsp; mov al, 160<br />&nbsp; &nbsp; mov ah, 0<br />&nbsp; &nbsp; mul dh<br />&nbsp; &nbsp; mov di, ax<br />&nbsp; &nbsp; add dl, dl<br />&nbsp; &nbsp; mov dh, 0<br />&nbsp; &nbsp; add di, dx<br /><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; mov bx, 0<br />charshows:<br />&nbsp; &nbsp; cmp bx, top<br />&nbsp; &nbsp; jne noempty<br />&nbsp; &nbsp; mov byte ptr es:, &#039; &#039;<br />&nbsp; &nbsp; jmp sret<br />noempty:<br />&nbsp; &nbsp; mov al, <br />&nbsp; &nbsp; mov es:, al<br />&nbsp; &nbsp; mov byte ptr es:, &#039; &#039;<br />&nbsp; &nbsp; inc bx<br />&nbsp; &nbsp; add di, 2<br />&nbsp; &nbsp; jmp charshows<br /><br />sret:<br />&nbsp; &nbsp; pop es<br />&nbsp; &nbsp; pop di<br />&nbsp; &nbsp; pop dx<br />&nbsp; &nbsp; pop bx<br />&nbsp; &nbsp; ret<br />charstack endp<br />;; --------------------------------------------------<br />&nbsp; &nbsp; <br /><br />showmessage proc near&nbsp; &nbsp; &nbsp; &nbsp; ; ??????<br />&nbsp; &nbsp; push es<br />&nbsp; &nbsp; push si<br />&nbsp; &nbsp; push di<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; mov ax, 0b800H+0f0H<br />&nbsp; &nbsp; mov es, ax<br />&nbsp; &nbsp; mov si, dx<br />&nbsp; &nbsp; mov di, 0<br />&nbsp; &nbsp; mov ax, 0<br />showmessages:<br />&nbsp; &nbsp; mov al, ds:<br />&nbsp; &nbsp; cmp al, &#039;$&#039;<br />&nbsp; &nbsp; je showover<br />&nbsp; &nbsp; mov es:, al<br />&nbsp; &nbsp; jmp showmessages<br /><br />showover:<br />&nbsp; &nbsp; pop di<br />&nbsp; &nbsp; pop si<br />&nbsp; &nbsp; pop es<br />&nbsp; &nbsp; ret&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ????????<br />&nbsp; &nbsp; <br />;;-------------------------------------------------------------- <br />&nbsp; &nbsp; <br />flushall proc near&nbsp; &nbsp; &nbsp; &nbsp; ; ????<br />&nbsp; &nbsp; push bx<br />&nbsp; &nbsp; push cx<br />&nbsp; &nbsp; push es<br /><br />&nbsp; &nbsp; mov bx, 0b800H<br />&nbsp; &nbsp; mov es, bx<br />&nbsp; &nbsp; mov bx, 0<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; mov cx, 2000<br />flushalls:<br />&nbsp; &nbsp; mov byte ptr es:, &#039; &#039;<br />&nbsp; &nbsp; add bx, 2<br />&nbsp; &nbsp; loop flushclients<br /><br />&nbsp; &nbsp; pop es<br />&nbsp; &nbsp; pop cx<br />&nbsp; &nbsp; pop bx<br />&nbsp; &nbsp; ret<br />flushall endp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ??????<br /><br /><br /><br />&nbsp; &nbsp; <br />flushclient proc near&nbsp; &nbsp; &nbsp; &nbsp; ; ?????<br />&nbsp; &nbsp; push bx<br />&nbsp; &nbsp; push cx<br />&nbsp; &nbsp; push es<br /><br />&nbsp; &nbsp; mov bx, 0b800H<br />&nbsp; &nbsp; mov es, bx<br />&nbsp; &nbsp; mov bx, 0<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; mov cx, 1840<br />flushclients:<br />&nbsp; &nbsp; mov byte ptr es:, &#039; &#039;<br />&nbsp; &nbsp; add bx, 2<br />&nbsp; &nbsp; loop flushclients<br /><br />&nbsp; &nbsp; pop es<br />&nbsp; &nbsp; pop cx<br />&nbsp; &nbsp; pop bx<br />&nbsp; &nbsp; ret<br />flushclient endp&nbsp; &nbsp; &nbsp; &nbsp; ; ???????<br /><br /><br /><br /><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />flushmessage proc near&nbsp; &nbsp; &nbsp; &nbsp; ; ?????<br />&nbsp; &nbsp; push bx<br />&nbsp; &nbsp; push cx<br />&nbsp; &nbsp; push es<br /><br />&nbsp; &nbsp; mov bx, 0b800H+0f0H<br />&nbsp; &nbsp; mov es, bx<br />&nbsp; &nbsp; mov bx, 0<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; mov cx, 80<br />flushmessages:<br />&nbsp; &nbsp; mov byte ptr es:, &#039; &#039;<br />&nbsp; &nbsp; add bx, 2<br />&nbsp; &nbsp; loop flushmessages<br /><br />&nbsp; &nbsp; pop es<br />&nbsp; &nbsp; pop cx<br />&nbsp; &nbsp; pop bx<br />&nbsp; &nbsp; ret<br />flushmessage endp&nbsp; &nbsp; &nbsp; &nbsp; ; ???????<br />&nbsp; &nbsp; <br /><br /><br /><br /><br /><br />&nbsp; &nbsp; <br />scroll proc near&nbsp; &nbsp; &nbsp; &nbsp; ; ????<br />&nbsp; &nbsp; push cx<br />&nbsp; &nbsp; push si<br />&nbsp; &nbsp; push di<br />&nbsp; &nbsp; push es<br />&nbsp; &nbsp; push ds<br /><br />&nbsp; &nbsp; mov si, 0b800H<br />&nbsp; &nbsp; mov es, si<br />&nbsp; &nbsp; mov ds, si<br />&nbsp; &nbsp; mov si, 160<br />&nbsp; &nbsp; mov di, 0<br />&nbsp; &nbsp; cld<br /><br />&nbsp; &nbsp; mov cx, 24<br />scrolls:<br />&nbsp; &nbsp; push cx<br />&nbsp; &nbsp; mov cx, 160<br />&nbsp; &nbsp; rep movsb<br />&nbsp; &nbsp; pop cx<br />&nbsp; &nbsp; loop scrolls<br /><br />&nbsp; &nbsp; mov cx, 80<br />&nbsp; &nbsp; mov si, 0<br />scrolls1:&nbsp; &nbsp; <br />&nbsp; &nbsp; mov byte ptr [160*24+si], &#039; &#039;<br />&nbsp; &nbsp; add si, 2<br />&nbsp; &nbsp; loop scrolls1<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; pop ds<br />&nbsp; &nbsp; pop es<br />&nbsp; &nbsp; pop di<br />&nbsp; &nbsp; pop si<br />&nbsp; &nbsp; pop cx<br />&nbsp; &nbsp; ret<br />scroll endp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ??????<br /><br /><br />show proc near&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; show??<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />code ends<br />end main<br /></code></pre></div>
    <div class="meta">Posted on 2009-01-13 06:59:35 by mnzn2530</div>
   </div>
  </div>
 </body>
</html>