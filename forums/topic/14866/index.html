<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>how to get the current ip(eip)? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14866" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=14866">how to get the current ip(eip)?</a></p>
   <div class="post" id="post-115362">
    <div class="subject"><a href="#post-115362">how to get the current ip(eip)?</a></div>
    <div class="body">can get it at running time?<br /><br />thanks</div>
    <div class="meta">Posted on 2003-08-25 02:19:13 by lube</div>
   </div>
   <div class="post" id="post-115363">
    <div class="subject"><a href="#post-115363">how to get the current ip(eip)?</a></div>
    <div class="body"><pre><code><br />call @F<br />@@&#58;<br />pop eax<br />sub eax, 5<br /></code></pre></div>
    <div class="meta">Posted on 2003-08-25 02:21:35 by roticv</div>
   </div>
   <div class="post" id="post-115364">
    <div class="subject"><a href="#post-115364">how to get the current ip(eip)?</a></div>
    <div class="body">could you tell me when the application is running <br />the relation between stack and ip(eip)?</div>
    <div class="meta">Posted on 2003-08-25 02:25:47 by lube</div>
   </div>
   <div class="post" id="post-115368">
    <div class="subject"><a href="#post-115368">how to get the current ip(eip)?</a></div>
    <div class="body">When you call an address, the return address is pushed onto the stack. pop eax just pop the return address into eax. That's the basic relationship between stack and eip. The sub eax,5 is because the call opcodes takes up 5 bytes (I think) with 4 byte displacement.</div>
    <div class="meta">Posted on 2003-08-25 02:32:24 by roticv</div>
   </div>
   <div class="post" id="post-115463">
    <div class="subject"><a href="#post-115463">how to get the current ip(eip)?</a></div>
    <div class="body">The current executed opcode is pointed by EIP <br />The current Stack location is pointed by ESP...<br /><br />So basically there is no relation between those two pointers<br /><br />However when a <strong>Call</strong> instuction is found the next addres to be executed is saved on stack ... so that the CPU knows where to return when it will  find the next <strong>RET</strong> instruction... this also happens on INT instructions etc<br /><br />So you might find EIP values stored on Stack at times</div>
    <div class="meta">Posted on 2003-08-25 17:34:21 by BogdanOntanu</div>
   </div>
   <div class="post" id="post-115472">
    <div class="subject"><a href="#post-115472">how to get the current ip(eip)?</a></div>
    <div class="body">thanks<br />but can i get it and change it to the branch that i want ?</div>
    <div class="meta">Posted on 2003-08-25 19:22:14 by lube</div>
   </div>
   <div class="post" id="post-115510">
    <div class="subject"><a href="#post-115510">how to get the current ip(eip)?</a></div>
    <div class="body"><pre><code><br />mov eax, address<br />jmp eax<br /><br /></code></pre><br /><br />of course there are other ways like retn, seh and so on.</div>
    <div class="meta">Posted on 2003-08-26 02:50:32 by roticv</div>
   </div>
   <div class="post" id="post-115613">
    <div class="subject"><a href="#post-115613">how to get the current ip(eip)?</a></div>
    <div class="body">Isn't the EIP pointer to instruction that should be executed next, rather than pointer to instruction being executed??<br />I mean this<br /><br /><div class="quote"><br /><pre><code><br />call @F                  ; eip is now ptr on &quot;pop eax&quot;<br />@@&#58;                     <br />pop eax                ; eip is now ptr on &quot;sub eax,5&quot;<br />sub eax, 5            ; eip ptr on next instruction<br /></code></pre> </div><br /><br />So if the question was how do we retrive EIP at &quot;call @F&quot; instruction, then we should remove &quot;sub eax,5&quot;.<br /><br />Please, correct me if I am wrong.</div>
    <div class="meta">Posted on 2003-08-26 18:31:57 by Mikky</div>
   </div>
  </div>
 </body>
</html>