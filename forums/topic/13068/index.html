<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Zooming problem - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13068" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=13068">Zooming problem</a></p>
   <div class="post" id="post-101447">
    <div class="subject"><a href="#post-101447">Zooming problem</a></div>
    <div class="body">Hi<br /><br />I have a prog whith a frame window (red color) and a child window (black color) much bigger than the frame window. The screen is marked with blue color. Now I draw a line on the child window with mouseclicking. The mouseclicking gives the startpoint and endpoint in screen coordinates. I convert the coordinates to client window coordinates and I have the green line. These APIs are used: GetDCOrgEx, MoveToEx and LineTo.<br /><br />Moving the child window also moves the line keeping the correct startpoint and endpoint. <br /><br />My problem is when the child window rectangle is changed (zooming). I have tryed different ways. I guess the endpoint of the line must be calculated in proportion of the new rectangle width/height to the old one. I have tryed MUL, DIV, FDIV and FMUL but can't handle these in a correct way like remainders etc. Or can it be done by APIs<br /><br />I would appreciate if somebody could tell me how to do it in a correct way, i.e. in principle.<br /><br />Regards</div>
    <div class="meta">Posted on 2003-05-06 03:07:58 by minor28</div>
   </div>
   <div class="post" id="post-101519">
    <div class="subject"><a href="#post-101519">Zooming problem</a></div>
    <div class="body">It's difficult to visualize what you're trying to do from your description.<br /><br />The child window seems to be larger than the screen size; is this for quick panning of something like a large 2D game board?<br /><br />Is your &quot;red frame window&quot; another child window of the main program where you can view a section of the black child window? Or is it THE main window?<br /><br />What controls your &quot;zooming&quot; in (or out) and its purpose? Is this for 3D animation?<br /><br />Do you draw directly on the screen (your main window's DC) or in a separate compatible DC?<br /><br />I guess I haven't answered too much of your question yet!:rolleyes: <br /><br />Raymond<br /><br />BTW If you are processing the WM_LBUTTONUP message to get mouse clicking coordinates, returned values are not in screen coordinates but in client area coordinates.</div>
    <div class="meta">Posted on 2003-05-06 08:53:26 by Raymond</div>
   </div>
   <div class="post" id="post-101565">
    <div class="subject"><a href="#post-101565">Zooming problem</a></div>
    <div class="body">Coordinate Space and Transformation Functions<br /><a target="_blank" href="http://msdn.microsoft.com/library/en-us/gdi/cordspac_0u43.asp">http://msdn.microsoft.com/library/en-us/gdi/cordspac_0u43.asp</a></div>
    <div class="meta">Posted on 2003-05-06 11:18:07 by Brad</div>
   </div>
   <div class="post" id="post-101639">
    <div class="subject"><a href="#post-101639">Zooming problem</a></div>
    <div class="body">Hi Raymond and Brad<br /><br />I will try to answer your questions.<br /><br />The child window is larger than the screen size; this is for quick panning of a large 2D map.<br /><br />The &quot;red frame window&quot; is the main program client area. It could be maximized but will never show the whole  map.<br /><br />I control the zooming with the mouse wheel and the purpose is to change the map scale.<br /><br />I draw the line directly on the screen on the map by a mouse click. The line is drawn between the mouse pointer position and a given point on the map given by a GPS.<br /><br />This is how it works so far.<br /><br />A mousehook process sends a hitpoint message in screen coordinates on a WM_LBUTTONUP.<br /><pre><code>.elseif eax==WM_MOUSEHOOKPOINT<br />	mov eax,wParam<br />	mov pointIN.x,eax<br />	mov eax,lParam<br />	mov pointIN.y,eax</code></pre><br />The same mousehook process also sends a handle message. If it is the correct window the screen coordinates are transformed and the line is drawn.<br /><pre><code>.elseif eax==WM_MOUSEHOOKWND<br />	mov eax,wParam<br />	.if hMap==eax<br />		.if flPointCourseBTN==TRUE ;a pushbutton is pushed<br />			invoke GetWindowDC,hMap<br />			.if eax!=0<br />				mov hDC,eax<br />				invoke GetDCOrgEx,hDC,addr pointOUT<br />				.if eax==TRUE <br />					invoke MoveToEx,hDC,pointPOS.x,pointPOS.y,NULL<br />					.if eax==TRUE  <br />						mov eax,pointIN.x<br />						sub eax,pointOUT.x<br />						mov pointTO.x,eax<br />						mov ecx,pointIN.y<br />						sub ecx,pointOUT.y<br />						mov pointTO.y,ecx<br />						invoke LineTo,hDC,pointTO.x,pointTO.y<br />					.endif<br />				.endif<br />			.endif<br />			mov flPointCourseBTN,FALSE<br />		.endif<br />	.endif</code></pre><br />This code retrieves the given position on the map and redraws the line when the map is panned or redrawn.<br /><pre><code>.if eax==hMap<br />	.if flPointCourseBTN==TRUE <br />		mov ecx,&#91;esp+&#40;1*4&#41;&#93;<br />		mov pointPOS.x,ecx<br />		mov ecx,&#91;esp+&#40;2*4&#41;&#93;<br />		mov pointPOS.y,ecx<br />	.else <br />		invoke MoveToEx,hDC,pointPOS.x,pointPOS.y,NULL<br />		invoke LineTo,hDC,pointTO.x,pointTO.y<br />	.endif<br />.endif</code></pre><br />So far all works well. The problem is when the map is zoomed i.e. the map window rectangle is changed. As the code now is made the line disappears but returns when the Window rectangle resume its size when the line was drawn.<br /><br />I have also succeded to hold the line but then it is fixed to the screen or client area. What I want is to have it fixed to the points on the map regardless of the map scale.<br /><br />Brad. I will look closer at the functions in your link. Thanks.<br /><br />Regards</div>
    <div class="meta">Posted on 2003-05-06 15:35:42 by minor28</div>
   </div>
   <div class="post" id="post-101706">
    <div class="subject"><a href="#post-101706">Zooming problem</a></div>
    <div class="body">I can't figure out yet what you mean by zooming. For example, if you increase the window size by a factor of 2, do you have to increase the line lenght by a factor of 2 and enlarge the current selection of your 2D map to fit into the enlarged window without showing any additional detail of the 2D map?<br /><br />Also, if you draw a line, can you draw a second line also? And if yes, do you have to erase the first line? Must the line(s) remain on the 2D map?<br /><br />In my opinion, regardless of the answers to the above, you should consider drawing to a compatible DC the size of the screen. Then, when you want to draw a line (or resize the window), you copy the required rectangle from the 2D map, draw the line (or lines) and transfer the required rectangle from that compatible DC to the screen at the appropriate location.<br /><br />A lot of maths involved, specially if you're really &quot;zooming&quot; into the 2D map.<br /><br />Raymond</div>
    <div class="meta">Posted on 2003-05-06 22:19:49 by Raymond</div>
   </div>
   <div class="post" id="post-101815">
    <div class="subject"><a href="#post-101815">Zooming problem</a></div>
    <div class="body">Hi Raymond<br /><br />Zoom like &quot;Zoom in&quot; or &quot;Zoom out&quot; are expressions used in several applications such as MSPaint, MSWord and so on. You are right there are no additional details showing up when zooming in, but the fact that  details beeing more readable. You are also right if the window size increases by a factor of 2 the line increases as well by a factor depending on if the factor is related to area or length and width. <br /><br />I can draw a second line but then the first line disappear. There is only one line at the time on the map.<br /><br />As for the compatible DC, I don't quite understand what you mean.<br /><br />Well I concentrated on as you said &quot;A lot of maths involved, specially if you're really &quot;zooming&quot; into the 2D map.&quot;. I don't think my zomming is what you call &quot;really zomming&quot; so the maths ought to be fairly simple which it turn out to be. I thank you for our discussion. A discussion always opens ones mind. The code in my previous contribution, the part concerning retrieving the given position on the map and redrawing the line when the map is panned or redrawn, is completed to the following code.<br /><pre><code>	.if eax==hMap<br />		.if flPointCourseBTN==TRUE <br />			mov ecx,&#91;esp+&#40;1*4&#41;&#93;<br />			mov pointPOS.x,ecx<br />			mov ecx,&#91;esp+&#40;2*4&#41;&#93;<br />			mov pointPOS.y,ecx<br />			<br />			invoke GetWindowRect,hMap,addr lpRect<br />			mov eax,lpRect.right<br />			sub eax,lpRect.left<br />			mov X,eax<br />			mov eax,lpRect.bottom<br />			sub eax,lpRect.top<br />			mov Y,eax<br />		.else <br />			invoke GetWindowRect,hMap,addr lpRectZOOM ;Map size after zooming<br />			mov eax,lpRectZOOM.right<br />			sub eax,lpRectZOOM.left<br />			mov Xzoom,eax<br />			mov eax,lpRectZOOM.bottom<br />			sub eax,lpRectZOOM.top<br />			mov Yzoom,eax<br />			<br />			fld Xzoom<br />			fdiv X<br />			fmul pointPOS.x<br />			fstp pointZOOM.x<br />			mov eax,pointZOOM.x<br />			<br />			fld Yzoom<br />			fdiv Y<br />			fmul pointPOS.y<br />			fstp pointZOOM.y<br />			mov ecx,pointZOOM.y<br />			<br />			invoke MoveToEx,hDC,eax,ecx,NULL<br />			<br />			fld Xzoom<br />			fdiv X<br />			fmul pointTO.x<br />			fstp pointZOOM.x<br />			mov eax,pointZOOM.x<br />			<br />			fld Yzoom<br />			fdiv Y<br />			fmul pointTO.y<br />			fstp pointZOOM.y<br />			mov ecx,pointZOOM.y<br />			invoke LineTo,hDC,eax,ecx<br />		.endif	<br />	.endif</code></pre><br />I woud appreciate if you could enlighten me on a better solution.<br /><br />Regards</div>
    <div class="meta">Posted on 2003-05-07 13:39:47 by minor28</div>
   </div>
   <div class="post" id="post-101898">
    <div class="subject"><a href="#post-101898">Zooming problem</a></div>
    <div class="body">Sorry about the question on zooming but I refered not to &quot;assume&quot; anything about your definition of it.<br /><br />Your application seems pretty static (i.e. no animation) and, on second thought, a separate compatible DC for the screen does not seem necessary.<br /><br />You probably had to select your large bitmap into a separate compatible DC anyway, and transfer the rectangles you need from there to the screen's DC, either with the BitBlt function if you need a &quot;straight&quot; copy, or with the StretchBlt function when you need zooming (in or out). <br /><br />The only small advantage of a separate DC would be for repainting the window (when it got hidden for some reason) or for paning a section of your bitmap which has a line; it may be just as easy to redraw everything on the screen whenever necessary.<br /><br />Not knowing exactly what you're trying to achieve, you probably have some good reason to &quot;hook&quot; the mouse input for the whole screen instead of processing mouse messages sent to the callback winproc of your window.<br /><br />The beauty of assembler!!! You can achieve the same result in so many ways.<br /><br />Raymond</div>
    <div class="meta">Posted on 2003-05-07 22:41:35 by Raymond</div>
   </div>
  </div>
 </body>
</html>