<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Int 10h Don't Print With Colors - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30043" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=30043">Int 10h Don't Print With Colors</a></p>
   <div class="post" id="post-212102">
    <div class="subject"><a href="#post-212102">Int 10h Don't Print With Colors</a></div>
    <div class="body">Hello,<br /> I have a function defined for print, it&#039;s called <strong>printf</strong>, and it&#039;s like this:<br /><pre><code>printf:<br />&nbsp; &nbsp; lodsb<br />&nbsp; &nbsp; mov ah, 0eh<br />&nbsp; &nbsp; mov bl, 0fh<br /><br />&nbsp; &nbsp; .nextchar:<br />&nbsp; &nbsp; 	lodsb<br />&nbsp; &nbsp; 	or al, al<br />&nbsp; &nbsp; &nbsp; &nbsp; jz .return<br />&nbsp; &nbsp; &nbsp; &nbsp; int 10h<br />&nbsp; &nbsp; &nbsp; &nbsp; jmp .nextchar<br /><br />&nbsp; &nbsp; .return:<br />&nbsp; &nbsp; &nbsp; &nbsp; ret</code></pre><br />But it isn&#039;t displaying blue as the foreground. What I got is that normal gray, but why I&#039;m getting this? What I need to do?<br /><br />Best Regards,<br /> Nathan Paulino Campos</div>
    <div class="meta">Posted on 2010-06-19 08:52:58 by nathanpc</div>
   </div>
   <div class="post" id="post-212103">
    <div class="subject"><a href="#post-212103">Re: Int 10h Don't Print With Colors</a></div>
    <div class="body"><strong>nathanpc</strong>,<br /><br />Read carefully. Foreground color in <strong>bl</strong> is for graphic modes <em>only</em>. For text modes, correct <strong>bh</strong> is much more significant.</div>
    <div class="meta">Posted on 2010-06-19 12:42:06 by baldr</div>
   </div>
   <div class="post" id="post-212104">
    <div class="subject"><a href="#post-212104">Re: Int 10h Don't Print With Colors</a></div>
    <div class="body">I&#039;m still having the same problem. :sad:</div>
    <div class="meta">Posted on 2010-06-19 12:58:23 by nathanpc</div>
   </div>
   <div class="post" id="post-212105">
    <div class="subject"><a href="#post-212105">Re: Int 10h Don't Print With Colors</a></div>
    <div class="body">From my &quot;experience&quot; (more what I&#039;ve &quot;heard&quot; than what I&#039;ve &quot;done&quot;), int 10h/0Eh is &quot;shakey&quot; on printing colors - some video biosen will, and some won&#039;t. Int 10h/09h may be better - it doesn&#039;t advance the cursor, so you&#039;ll have to do that (two more interrupts). Int 10h/13h (?) - the one that takes the &quot;string&quot; in es:bp(!) is probably a better bet for printing colors... You can make &quot;each character different&quot; or &quot;all characters what&#039;s in bl&quot; and advance the cursor or not, depending on what&#039;s in al. An &quot;odd&quot; interrupt, but powerful...<br /><br />Best,<br />Frank<br /><br /><br /><br /></div>
    <div class="meta">Posted on 2010-06-19 13:24:49 by fbkotler</div>
   </div>
   <div class="post" id="post-212106">
    <div class="subject"><a href="#post-212106">Re: Int 10h Don't Print With Colors</a></div>
    <div class="body"><strong>fbkotler</strong>,<br /><br /><strong>int10/0E</strong> is just as said, teletype-like output. It prints on the paper provided (unless you&#039;re in graphic mode where you <em>have</em> to have at least foreground color).<br /><br />If you don&#039;t have really weird videocontroller, why don&#039;t use plain-and-straightforward <strong>lodsb</strong> / <strong>stosw</strong>?<br /><br />----8&lt;----<br /><strong>nathanpc</strong>,<br /><br />Don&#039;t fiddle with <strong>print<u>f</u></strong> except you provide similar services (like &quot;%#*-.8x&quot;). ;-)</div>
    <div class="meta">Posted on 2010-06-19 14:15:46 by baldr</div>
   </div>
   <div class="post" id="post-212107">
    <div class="subject"><a href="#post-212107">Re: Int 10h Don't Print With Colors</a></div>
    <div class="body">I agree that lodsb/stosw is &quot;the way to go&quot;. Straightforward, and faster, besides (not that it matters - it&#039;ll print faster than we can read it in any case). It would meant that you&#039;d have to &quot;do something&quot; with CR/LF/TAB/BS etc... Have to do most of it anyway...<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2010-06-19 15:58:17 by fbkotler</div>
   </div>
   <div class="post" id="post-212108">
    <div class="subject"><a href="#post-212108">Re: Int 10h Don't Print With Colors</a></div>
    <div class="body">Ok, but being at text mode, what I can do? Without doing that strange, but useful use of the language that <strong>fbkotler</strong> said. :|</div>
    <div class="meta">Posted on 2010-06-19 17:51:25 by nathanpc</div>
   </div>
   <div class="post" id="post-212109">
    <div class="subject"><a href="#post-212109">Re: Int 10h Don't Print With Colors</a></div>
    <div class="body">What is it you *want* to do, Nathan? As baldr points out, you&#039;re using the &quot;teletype&quot; interrupt. I have been told that it actually *does* use the color in bl on some machines, but not on mine, and evidently not on yours. You&#039;re putting 0Fh in bl, which would give you &quot;bright white&quot;, not &quot;blue&quot;, anyway.<br /><br />If you don&#039;t want to use the bios ints that *do* print colors (9 and 13h, IIRC), try this:<br /><br /><pre><code><br />;---------------------------------<br />; nasm -f bin -o hwnoint.com hwnoint.asm<br /><br />org 100h<br /><br />&nbsp; &nbsp; push word 0B800h&nbsp; &nbsp; ; segment of video memory<br />&nbsp; &nbsp; pop es&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; (because stosw uses es:di)<br />&nbsp; &nbsp; mov di, (10 * 80 + 30) * 2&nbsp; ; offset into screen<br />&nbsp; &nbsp; &nbsp; &nbsp; ; (row * width + column) * 2 bytes/character<br />&nbsp; &nbsp; mov si, msg&nbsp; &nbsp; &nbsp; &nbsp;  ; offset of our string<br />&nbsp; &nbsp; mov ah, 0B0h&nbsp; &nbsp; &nbsp; &nbsp; ; color (blinking black on cyan)<br />top:<br />&nbsp; &nbsp; lodsb&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; get byte from  into al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; and increment si for next one<br />&nbsp; &nbsp; or al, al&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; this doesn&#039;t change al, but sets<br />&nbsp; &nbsp; jz depart&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; the flags - if zero, we&#039;re done<br />&nbsp; &nbsp; stosw&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; stores ax (char &amp; color) to <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; and add 2 to di for next one<br />&nbsp; &nbsp; jmp short top&nbsp; &nbsp; &nbsp;  ; do more<br />depart:<br />&nbsp; &nbsp; ret&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; return to dos (or other caller)<br /><br />msg db &quot; Look, Ma! No ints! &quot;,0&nbsp; ; note 0, not &#039;$&#039;, terminated<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; &#039;$&#039; is just for int 21h/9<br />;------------------------------------<br /></code></pre><br /><br />Heck, might as well give you my int 10h/13h example, too. This is more complicated than it needs to be - I &quot;rotate&quot; the colors (in a rather stupid way) - but you can probably extract the &quot;essence&quot;.<br /><br /><pre><code><br />org 100h<br /><br />segment .data<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; message in char,attrib,char,attrib... format<br />&nbsp; &nbsp; msg1 db &#039;M&#039;,01h,&#039;a&#039;,02h,&#039;n&#039;,03h,&#039;y&#039;,04h,&#039; &#039;,05h,&#039;T&#039;,06h<br />&nbsp; &nbsp; &nbsp; &nbsp;  db &#039;h&#039;,07h,&#039;a&#039;,08h,&#039;n&#039;,09h,&#039;k&#039;,0Ah,&#039;s&#039;,0Bh,&#039; &#039;,0Ch<br />&nbsp; &nbsp; &nbsp; &nbsp;  db &#039;t&#039;,0Dh,&#039;o&#039;,0Eh,&#039; &#039;,0Fh,&#039;R&#039;,01h,&#039;a&#039;,02h,&#039;l&#039;,03h<br />&nbsp; &nbsp; &nbsp; &nbsp;  db &#039;f&#039;,04h,&#039; &#039;,05h,&#039;B&#039;,06h,&#039;r&#039;,07h,&#039;o&#039;,08h,&#039;w&#039;,09h<br />&nbsp; &nbsp; &nbsp; &nbsp;  db &#039;n&#039;,0Ah,&#039;!&#039;,0Bh&nbsp; &nbsp; &nbsp; ; no need to terminate...<br />&nbsp; &nbsp; msg1len dw $-msg1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; let the assembler count &#039;em!<br /><br />segment .text<br /><br />&nbsp; &nbsp; mov ax, 3&nbsp; &nbsp; &nbsp; &nbsp;  ; reset video mode to 3 (cheesy CLS)<br />&nbsp; &nbsp; int 10h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; call bios video services<br />domore:<br />&nbsp; &nbsp; mov bp, msg1&nbsp; &nbsp; &nbsp; ; point to string<br />&nbsp; &nbsp; mov cx,  ; length of string - chars + attributes<br />&nbsp; &nbsp; shr cx, 1&nbsp; &nbsp; &nbsp; &nbsp;  ; div by two to get char-only len for the call<br />&nbsp; &nbsp; mov dh, 0Bh&nbsp; &nbsp; &nbsp;  ; row<br />&nbsp; &nbsp; mov dl, 1Ah&nbsp; &nbsp; &nbsp; ; column<br />&nbsp; &nbsp; mov bh, 0&nbsp; &nbsp; &nbsp; &nbsp;  ; video page &quot;usually&quot; (?) zero<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; don&#039;t care what BL is for this AL<br />&nbsp; &nbsp; mov ah, 13h&nbsp; &nbsp; &nbsp;  ; write string in ES:BP at DH,DL (row,column)<br />&nbsp; &nbsp; mov al, 2&nbsp; &nbsp; &nbsp; &nbsp;  ; char, attr,... format - no cursor update <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; 3 - char,attrib - update&nbsp; cursor<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; 1 - attrib in BL - update cursor<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; 0 - attrib in BL - no update<br />&nbsp; &nbsp; int 10h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; call video services (AT+,EGA+ ???)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; rather than alter the pallette, we just<br />&nbsp; &nbsp; mov bx, msg1&nbsp; &nbsp; &nbsp; ; change the colors in the string, and<br />&nbsp; &nbsp; mov cx,  ; reprint it (no cursor update :) ! )<br />&nbsp; &nbsp; shr cx, 1&nbsp; &nbsp; &nbsp; &nbsp;  ; number of colors<br />morecolors:<br />&nbsp; &nbsp; inc bx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; skip over character<br />&nbsp; &nbsp; mov al,&nbsp; &nbsp; &nbsp;  ; get current color<br />&nbsp; &nbsp; inc al&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; bump it<br />&nbsp; &nbsp; cmp al, 10h&nbsp; &nbsp; &nbsp;  ; we only change low nibble - high nibble<br />&nbsp; &nbsp; jnz colorok&nbsp; &nbsp; &nbsp;  ; is background (bit 7 set - FG blinks)<br />&nbsp; &nbsp; mov al, 1&nbsp; &nbsp; &nbsp; &nbsp;  ; we don&#039;t want color zero (black), or we<br />colorok:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; could just &quot;or al,0Fh&quot;<br />&nbsp; &nbsp; mov , al&nbsp; &nbsp; &nbsp; ; stuff it back in the string<br />&nbsp; &nbsp; inc bx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; point to next character<br />&nbsp; &nbsp; loop morecolors&nbsp;  ; do &#039;em all<br />&nbsp; &nbsp; mov cx, 2&nbsp; &nbsp; &nbsp; &nbsp;  ; BIOS is &quot;slow&quot;, but we still<br />&nbsp; &nbsp; call DELAYCX&nbsp; &nbsp; &nbsp; ; need some delay<br />&nbsp; &nbsp; mov ah, 1&nbsp; &nbsp; &nbsp; &nbsp;  ; check keyboard status<br />&nbsp; &nbsp; int 16h<br />&nbsp; &nbsp; jz domore&nbsp; &nbsp; &nbsp; &nbsp;  ; no key hit - do it again<br />&nbsp; &nbsp; mov ah, 0&nbsp; &nbsp; &nbsp; &nbsp;  ; get the key off the buffer<br />&nbsp; &nbsp; int 16h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; could clearscreen again here, but<br />exit:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; naw, let&#039;s leave it...<br />&nbsp; &nbsp; mov ah, 4Ch&nbsp; &nbsp; &nbsp;  ; scram<br />&nbsp; &nbsp; int 21h<br /><br />;----------------------------------------------------------<br />; twiddle thumbs for cx/18.2 seconds<br />DELAYCX<br />&nbsp; &nbsp; &nbsp; &nbsp; push ax<br />&nbsp; &nbsp; &nbsp; &nbsp; push bx<br />&nbsp; &nbsp; &nbsp; &nbsp; push ds<br />&nbsp; &nbsp; &nbsp; &nbsp; mov bx, 40h&nbsp; &nbsp; &nbsp; &nbsp; ; BIOS data segment<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ds, bx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov bx, 6Ch&nbsp; &nbsp; &nbsp; &nbsp; ; BIOS timer, 40:6C<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, <br />&nbsp; &nbsp; &nbsp; &nbsp; add ax, cx<br />DelayLoop:<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp ax, &nbsp; &nbsp; &nbsp; &nbsp; ; Is it the same?<br />&nbsp; &nbsp; &nbsp; &nbsp; jnc DelayLoop&nbsp; &nbsp; &nbsp;  ; No, try again.<br />&nbsp; &nbsp; &nbsp; &nbsp; pop ds&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Restore registers and exit.<br />&nbsp; &nbsp; &nbsp; &nbsp; pop bx<br />&nbsp; &nbsp; &nbsp; &nbsp; pop ax<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />;------------------------------------------------------------------<br /></code></pre><br /><br />I don&#039;t think I have an example of int 10h/9 at hand. It&#039;ll print the color in bl, but you&#039;ll need to update the cursor yourself (getcursor/setcursor). Look it up. You *do* know about Ralf Brown&#039;s Interrupt List,&nbsp; right? If not, look here:<br /><br />http://www.ctyme.com/rbrown.htm<br /><br />I think I like the lodsb/stosw method best...<br /><br />Best,<br />Frank<br /><br /><br /><br /></div>
    <div class="meta">Posted on 2010-06-19 20:28:51 by fbkotler</div>
   </div>
   <div class="post" id="post-212111">
    <div class="subject"><a href="#post-212111">Re: Int 10h Don't Print With Colors</a></div>
    <div class="body">The first one I understood very fast, because when I was designing my OS using C, I use that as a pointer to print things on the screen. Anyway, when I tried this now, my OS don&#039;t want to boot. :(</div>
    <div class="meta">Posted on 2010-06-19 21:28:09 by nathanpc</div>
   </div>
   <div class="post" id="post-212123">
    <div class="subject"><a href="#post-212123">Re: Int 10h Don't Print With Colors</a></div>
    <div class="body">Well, they won&#039;t run on Linux, either. As posted, they&#039;re intended to be .com files. If they&#039;re preventing your OS from booting... sounds like an OS problem to me! :)<br /><br />Any luck tracking it down, Nathan?<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2010-06-21 09:26:39 by fbkotler</div>
   </div>
  </div>
 </body>
</html>