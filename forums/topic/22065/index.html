<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Invalid use of register, heeeelp :( - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=22065" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=22065">Invalid use of register, heeeelp :(</a></p>
   <div class="post" id="post-166176">
    <div class="subject"><a href="#post-166176">Invalid use of register, heeeelp :(</a></div>
    <div class="body">ok I d/l&#39;ed masm and read a whole slew of tutorials, I&#39;ve even managed to write some really basic output-text stuff. Recently I modified the LCD cd played example. I stripped out all the cd stuff, patched in some mcisendstring stuff from some source someone posted on some site (for playing mp3&#39;s), and I managed to get some text to scroll fro left to right (eventually going off the window and out of site until it loops back to the begining of the string.. So I&#39;m making really good progress.. But I have a problem with part of my code that I been trying to fix for about 3 days now&nbsp; :cry: :cry: :cry:&nbsp;  I been trying to apply what I&#39;ve learned from the many tutorials on Mov and variables and arrays in assembly to my problem here, but the problem is the major lack of standards amongst the compilers *sigh*&nbsp; For reference I&#39;m using masm 6.14.8444&nbsp; &nbsp; If you think it may work on the newer version 8 one, let me know and I&#39;ll happily send it to you to test it<br /><br /> I decided I wanted to try to make the text simulate a sine-wave with each letter going up and down independantly but in synch with each other, with the sine-wave being a maximum of +4 and -4 from the starting y coord of (300), so this means every 4 letters (since each letter moves up 1 whoule pixel every 1 step) it has to start from the begining of an array I made of positions (initialized all to 0) and bump the position offset up by 1 (by setting the position table element to the next higher value in the array of offsets [0,1,2,3,4,3,2,1,0,-1,-2,-3,-4,-3,-2,-1]<br />if none of that made sense basically here is the psuedo-code of what I want to do<br /><br /><ul><br /><li>define an array of offsets called TextPosOffsetMatrix (and as a db data type??)</li><br /><li>set the value of the elements to 0,1,2,3,4,3,2,1,0,-1,-2,-3,-4,-3,-2,-1&nbsp;  *each element seperated by a comma</li><br /><li>define another array that contains the actual positions of each of the 44 lettesr and call this array TextPositionTable, declare it as (a byte??) and set the elements to 01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,<br />01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,<br />01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h,01h</li><br /><li> declare a db variable called TextCounter initialize it to 0 and do the same for TempVariable</li><br /><li>As the program is already scanning each letter at a time (adding 1 to textcounter each loop through) for the lcd effect, set the Y-coordinate(variable called dwY) for the<br />output of the character t, to the proper y value (to simulate a sine-wave just) just before the procedure to draw the character is called</li><br /><li>Because we have from 0 to -1 in our offset matrix, we know that every 16 loops through we need to reset the<br />element index variable that were using which is (now) cl, (used to be TempVariable, changed it to a register in hopes it was just the compiler did not like me not working with a register instead of a variable)</li><br /><li> through each loop after the offset index has been increased put the element&#39;s value into the TextPositionTable(TextCounter)</li><br /><li> call the drawcharacter function and supply the y coordinate paramater dwY + (the position of the element in TextPositionTable cooresponding to TextCounter&nbsp;  * (Using the rules of algebra to our advantage we know this works because + and - equals&nbsp; a -,&nbsp; and + and + equals a +, so we don&#39;t have to bother with any special routines to for neg or positive since our offset matrix builds that in for us) </li><br /></ul><br /><br />ok now for the code I came up with (declarations removed in an attempt to keep an already long post from getting longer<br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov cl, 00h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov TextCounter, 00h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .WHILE TextCounter &lt; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc TextCounter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov bl, TextCounter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc cl<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .IF cl&gt; 16<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov cl, 01<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov al,TextPosOffsetMatrix+bl<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov TextPositionTable, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ENDIF<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ENDW<br /><br /></code></pre><br /><br /><ul><br /><li>Why does the above code produce the error:<br />c:\masm32\src\demo1\Demo1.asm(755) : error A2032: invalid use of register<br />c:\masm32\src\demo1\Demo1.asm(756) : error A2031: must be index or base register<br />c:\masm32\src\demo1\Demo1.asm(757) : error A2070: invalid instruction operands<br /></li><li>What&#39;s the difference between db and BYTE?</li><br /><li>Why can I not use db inside a procedure?</li><br /></ul> <br /><br />Please keep in mind if some of the code is really way off it&#39;s prolly because I been fighting this problem for about 3 days now, and is the result of change after change after change after change after change trying to get it to work<br /></div>
    <div class="meta">Posted on 2005-09-23 00:13:13 by EtErNiTy</div>
   </div>
   <div class="post" id="post-166177">
    <div class="subject"><a href="#post-166177">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">1.some registers can be used in hll-constructions, like while or invoke, it is possible of usage of cx<br />2.if you are using register as pointer you should use register of same scale as your addressing mode: if there is 16 bit, you should use &quot;bx&quot; etc., if mode is 32-bit, you should use &quot;ebx&quot; - never &quot;bl&quot;<br />3.not all registers can be used as indexing in 16-bit mode, only bx,di,si and bp (i did not understand mode from your part of source, it seems you are using 32-bit because of esi)</div>
    <div class="meta">Posted on 2005-09-23 00:22:45 by Shoo</div>
   </div>
   <div class="post" id="post-166180">
    <div class="subject"><a href="#post-166180">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">holy s#*t dude that&#39;s huge... I didn&#39;t know that about the while stuff and the restrictions on registers for indexing... I guess my next attempt will prolly be pushing registers onto the stack to free some temporary storage up, and then popping them back off.. I&#39;ll let ya know how I made out. Thanks for the fast reply! :)</div>
    <div class="meta">Posted on 2005-09-23 01:25:20 by EtErNiTy</div>
   </div>
   <div class="post" id="post-166182">
    <div class="subject"><a href="#post-166182">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">advise: use fasm&nbsp; ;)</div>
    <div class="meta">Posted on 2005-09-23 03:37:27 by Shoo</div>
   </div>
   <div class="post" id="post-166188">
    <div class="subject"><a href="#post-166188">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">interesting... never even heard of fasm... I&#39;ve heard of nasm. Reason I shy&#39;ed away from nasm is it was open source and I figured it probably was like in beta stages or something, but reading some of the wikipedia info on fasm it sounds like the little compiler that could. The fact it&#39;s cross-platform earns at least a fair shot by me.. That&#39;s one of the big things I did not like about masm, is spending the time to learn how the compiler behaves and acts all the while knowing it&#39;s not cross platform.. That advice you gave on the register stuff btw worked like a charm! :)&nbsp;  Problem comes in now, is that I get a windows xp equivalent of the 98 close-and-details box, making it now harder to debug.. My new code looks like this<br /><br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov ecx, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov TextCounter, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .WHILE TextCounter &lt; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add TextCounter,1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .IF ecx &gt; 16<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Correct Line - Remmed to fiddle with an experiemental line in hope to remove crash<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;mov , eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov TextPositionTable+ecx, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov ecx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ENDIF<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ENDW<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov esi, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke	DrawSmallChar, edx, dwY+, eax 	;draw one small char<br /></code></pre><br />It seems like it&#39;s on&nbsp; the invoke line at least according to w32dsm89.. Thinking I might wanna run it through olydbg and see what that comes up with.. Anyhow thanks for the advice on fasm, I&#39;m definately gonna look into it! :)<br /></div>
    <div class="meta">Posted on 2005-09-23 08:12:39 by EtErNiTy</div>
   </div>
   <div class="post" id="post-166191">
    <div class="subject"><a href="#post-166191">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">I am impressed by your code<br /><br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov TextPositionTable+ecx, dword ptr <br /></code></pre><br /><br />Will surely fail in any assembler. You can&#39;t use mov to move data from memory to memory. Such a opcode does not exist.<br /><br />Personally I would recommend you to not use .while or .if Learn the conditional jump and it would give you insights and probably better looking code.<br /><br />PS: I moved your thread to the correct location (aka forum).</div>
    <div class="meta">Posted on 2005-09-23 08:42:08 by roticv</div>
   </div>
   <div class="post" id="post-166198">
    <div class="subject"><a href="#post-166198">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">by fail do you mean it&#39;ll crash when the app is ran or by fail do you mean it won&#39;t even compile? &#39;Cause it compiles just fine<br /><br /><br />EDIT: nm I took it out of the hll consutrctions and it came back with an error... last time I use those things... for those that are starting out and wanted to know what the end code looked like to fix it, here it is:<br /><br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  push edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov ecx, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov TextCounter, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @SineCharacters<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />		.ELSEIF	dwSize==LCDTEXTSIZE_BIG<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />		.ENDIF<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @SineCharacters:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add TextCounter, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp TextCounter, esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne @notfinished<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; je @OutputText&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @notfinished:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp ecx, 17<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; je @resetoffset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne @dontresetoffset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @resetoffset:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Correct Line<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov , eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov ecx, 1<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov esi, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @OutputText<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @dontresetoffset:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Correct Line<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov , eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov esi, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @SineCharacters<br />	.ENDW<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @OutputText:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke	DrawSmallChar, edx, dwY+, eax 	;draw one small char<br /><br />&nbsp; &nbsp; &nbsp; @nextchar:<br />		&nbsp; &nbsp; .IF		dwSize==LCDTEXTSIZE_SMALL<br />			&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add		edi, 8							;small char takes 8 pixels<br />		&nbsp; &nbsp; .ELSEIF	dwSize==LCDTEXTSIZE_BIG<br />			&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add		edi, 22							;big char takes 22 pixels<br />		&nbsp; &nbsp; .ENDIF<br /><br /></code></pre><br />Only problem is I&#39;m loosing my text somewhere in that mess.. Well at least it runs now, before it&#39;d run but just crash<br /><br />And yeah I know there are still some hll-constructions in use.. It&#39;s because the original example I started with had them all over, and it&#39;s gonna take time now to convert it over..</div>
    <div class="meta">Posted on 2005-09-23 10:42:11 by EtErNiTy</div>
   </div>
   <div class="post" id="post-166211">
    <div class="subject"><a href="#post-166211">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">He means it&#39;ll crash when you run it. Either do:<br /><br /><pre><code><br />mov ebx, dword ptr <br />mov TextPositionTable+ecx, ebx<br /></code></pre><br /><br />or<br /><br /><pre><code><br />push dword ptr <br />pop TextPositionTable+ecx<br /></code></pre><br /><br />The first trashes EBX but I prefer that method. The second uses the stack rather than registers.<br />It&#39;s really up to you.<br /><br />Shoo,<br />Btw, nice to see ya again mate :)<br /><br />Regards,<br />Bryant Keller</div>
    <div class="meta">Posted on 2005-09-23 16:15:42 by Synfire</div>
   </div>
   <div class="post" id="post-166219">
    <div class="subject"><a href="#post-166219">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">*sigh* this is starting to feel like the problem that never goes away<br /><br />I took out all of the HLL constructions, it&#39;s horrible and&nbsp; monterious looking. I&#39;m not happy at all with it but to humour the possibility that the probem is stem&#39;ed from specific registers being used inside the hll blocks, I had to remove them. Here it is<br /><br /><em>Original LCD CD Player code:<br />;===============================================================================<br />; LCD CD Player - (C) 2000 by Thomas Bleeker . http://exagone.cjb.net<br />;===============================================================================<br /></em><br /><br /><pre><code><br />DrawLCDText	proc	uses esi edi ebx dwX:DWORD, dwY:DWORD, dwSize:DWORD, lpText:DWORD<br /><br />	; This procedure reads a null-terminated string character for character and<br />	; looks each char up in the LCDChars table. When found, it displays the character<br />	; and proceeds to the next. dwX and dwY are the start coordinates (left-top).<br />	; dwSize can be LCDTEXTSIZE_SMALL or LCDTEXTSIZE_BIG (small or big characters).<br />	; lpText is the pointer to the string.	<br /><br />&nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  TextCounter, 1<br />&nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  TempVariable, 1<br />&nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  ecx, 1<br />	mov		esi, lpText<br />	xor		edi, edi<br />	;.WHILE	TRUE<br />&nbsp; &nbsp; &nbsp; jmp @CharacterLoop<br /><br />&nbsp; &nbsp; &nbsp; @CharacterLoop:<br />		; get one char:<br />		xor		eax, eax<br />		mov		al, <br />		inc		esi<br />		<br />		; stop if 0 terminator found:<br />		test al, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; je @ExitProcedure<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />		; --- Map character into LCDChars (ascii -&gt; LCDChars index) ---<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 30h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_number<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 31h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_number<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 32h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_number<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 33h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_number<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 34h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_number<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 35h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_number<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 36h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_number<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 37h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_number<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 38h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_number<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 39h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_number<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 41h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 42h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 43h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 44h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 45h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 46h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 47h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 48h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 49h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 4Ah<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 4Bh<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 4Ch<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 4Dh<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 4Eh<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 4Fh<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 50h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 51h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 52h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 53h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 54h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 55h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 56h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 57h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 58h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 59h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 5Ah<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_upperletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 61h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 62h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 63h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 64h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 65h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 66h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 67h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 68h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 69h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 6Ah<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 6Bh<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 6Ch<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 6Dh<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 6Eh<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 6Fh<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 70h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 71h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 72h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 73h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 74h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 75h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 76h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 77h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 78h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 79h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 7Ah<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_lowerletter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp;  al, 2Eh ; .<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_period<br />		test&nbsp; &nbsp; &nbsp; &nbsp;  al, 2Ch ; ,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_comma<br />		test&nbsp; &nbsp; &nbsp; &nbsp;  al, 3Ah ; :<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_colon<br />		test&nbsp; &nbsp; &nbsp; &nbsp;  al, 28h ; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_leftparen<br />		test&nbsp; &nbsp; &nbsp; &nbsp;  al, 29h ; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_rightparen<br />		test&nbsp; &nbsp; &nbsp; &nbsp;  al, 3Dh ; =<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_equals<br />		test&nbsp; &nbsp; &nbsp; &nbsp;  al, 2Dh ; -<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_minus<br />		;test&nbsp; &nbsp; &nbsp; &nbsp;  al, A9h ; ©<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;jnz @al_copyright<br />		test&nbsp; &nbsp; &nbsp; &nbsp;  al, 20h ; &quot; &quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz @al_space<br />		jmp @nextchar ; else...<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @al_number:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub		al, &quot;0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @contchar_routine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @al_upperletter:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub		al, (&quot;A&quot;-10)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @contchar_routine<br />&nbsp; 		@al_lowerletter:<br />			&nbsp; sub		al, (&quot;a&quot;-10)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @contchar_routine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @al_period:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov		al, 36<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @contchar_routine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @al_comma:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov		al, 37<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @contchar_routine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @al_colon:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov		al, 38<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @contchar_routine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @al_leftparen:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov		al, 39<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @contchar_routine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @al_rightparen:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov		al, 40<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @contchar_routine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @al_equals:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov		al, 41<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @contchar_routine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @al_minus:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov		al, 42<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @contchar_routine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @al_copyright:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov		al, 43<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @contchar_routine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @al_space:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @nextchar;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @contchar_routine:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		; --- draw char ---<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		mov		edx, dwX<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		add		edx, edi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; &nbsp; &nbsp; dwSize, LCDTEXTSIZE_SMALL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; je&nbsp; &nbsp; &nbsp; &nbsp;  @PreSineCharacters<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp; &nbsp; &nbsp; @PreSineCharacters ;Eventually we&#39;ll have another routine setup for large text<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @PreSineCharacters:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov TextCounter, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @SineCharacters<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @SineCharacters:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push ecx;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov ecx, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add TextCounter, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test TextCounter, esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne @notfinished<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; je @OutputText&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @notfinished:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test ecx, 17<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; je @resetoffset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne @Step2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @resetoffset:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov ecx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @Step2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @Step2:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov , eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov esi, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp @OutputText<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @OutputText:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke	DrawSmallChar, edx, dwY+, eax 	;draw one small char<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @nextchar:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; dwSize, LCDTEXTSIZE_SMALL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; je @SetSmallText<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne @SetBigText<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @SetSmallText:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add edi, 8&nbsp; &nbsp; ;small char takes 8 pixels<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @SetBigText:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add edi, 22&nbsp;  ;big char takes 22 pixels<br />	;.ENDW<br />&nbsp; &nbsp; &nbsp; test eax, 0<br />&nbsp; &nbsp; &nbsp; je @ExitProcedure<br />&nbsp; &nbsp; &nbsp; jne @CharacterLoop<br /><br />&nbsp; &nbsp; &nbsp; @ExitProcedure:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ret <br />ret<br />DrawLCDText	endp<br /></code></pre><br /><br />produces an XP generated an error box, (98 equivalent of a close and details). It&#39;s pretty sure it&#39;s got something to do with I&#39;m using an opcode incorrectly (like before moving memory to memory), but I think to spot that kind of thing it&#39;s above my ability (at least for now). Another quick question I have, is there a tutorial on labels that I can read up on? I&#39;m still not 100% certain on how they behave.. if a label is right after a set of text, does it automatically jump into it do do I need to jmp into it even though it&#39;s the next line in the source? and does a ret return to the calling procedure or can you use that to return to the very next line of the calling label-block?<br />My guess is, si these 2 questions are heavily compiler dependant and vary from compiler to compiler...<br /><br />EDIT: nm I did a little reading on the cmp and test functions, I had remember that they do the same thing but arrive differently.. I realized<br />I tested if something was not equal while using a cmp changing the cmp to test fixed it. Syntaxually it was correct, but logically it wasn&#39;t<br /><br />EDIT2: nm again.. I had it right the first time, only reason it didn&#39;t crash when I made the cmp tests is because nothing tested positive and performed because it was working off the wrong flag bit<br />My questions on labels still exist though (at least until I find the answer, I supposed I could write another program to test it...<br /></div>
    <div class="meta">Posted on 2005-09-23 23:01:42 by EtErNiTy</div>
   </div>
   <div class="post" id="post-166230">
    <div class="subject"><a href="#post-166230">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">Wow that&#39;s hard work man. <br /><br />You could have shortened the code into to conditional jumps for to test whether they are number, two conditional jumps to test whether they are lowercase and 2 conditional jumps to test whether they are upper case. You can read this if you have the time. http://www.asmcommunity.net/board/index.php?topic=4419.0<br /><br />OKay, I really thought the line above I stated would not pass masm, but apparently it did. So I was wrong, but I am really interested to use the opcodes generated for that line. One more thing, test is different from cmp. I think you should basically use cmp most of the time, unless you know what you are doing. For example test eax, 1 is not the same as cmp eax,1 but test eax, eax is the same as cmp eax, 0. Basically cmp does substraction but does not update the registers, it just updates the EFLAG while for test bitwise and is done, but registers are not updated, only EFLAG.<br /><br />In your posted code, I think you are using test wrongly.<br /></div>
    <div class="meta">Posted on 2005-09-24 08:03:58 by roticv</div>
   </div>
   <div class="post" id="post-166241">
    <div class="subject"><a href="#post-166241">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">It acctually wasn&#39;t too bad, it&#39;s one of those things where I&#39;m determined to get it to work no matter what, but this ongoing problem is pretty discouraging towards my view of eventually getting the hang on which registers are <em>specifically</em> for what and what the brackets mean (since mov&#39;ing a variable without brackets into a register, seems to move the contents into the register, I think that&#39;s because of masm though.. I need too lose this compiler...)  Anyhow at best I can get this thing to compile and run, but no text comes shows up in the window.. Here&#39;s what I got it down too<br /><br /><pre><code><br />WndProc proc uses ebx hWnd:DWORD, uMsg:DWORD, wParam:DWORD, lParam:DWORD<br />&lt;blah blah&gt;<br />.ELSEIF	eax==WM_TIMER<br />	; --- display update timer ---<br />	.IF    wParam==MAINTIMERID<br />	            add tSmallTextCounter, 1<br />                            cmp tSmallTextCounter, 45<br />                            jne @InvalidateWindow<br />                            mov tSmallTextCounter, 1<br />                            jmp @InvalidateWindow<br />            <br />                           @InvalidateWindow:<br />		                       ; Invalidate the window to force a repaint<br />		                       invoke	 InvalidateRect, hWnd, NULL, FALSE<br />	.ENDIF<br /><br />&lt;blahblah&gt;<br />.ELSEIF eax==WM_PAINT<br />	; Start painting:<br />	invoke	BeginPaint, hWnd, ADDR ps<br />	mov	hDC, eax<br />	<br />	; Draw the LCD on the backbuffer:<br />	invoke	DrawLCD<br />	<br />	; Draw the backbuffer onto the main window:<br />                invoke	BitBlt, hDC,0,0,+WindowWidthSizeOffset, +WindowHeightSizeOffset, hBackDC, 0,0, SRCCOPY<br /><br />	; Stop painting:<br />	invoke	EndPaint, hWnd, ADDR ps<br />.ELSE<br />	invoke DefWindowProc, hWnd, uMsg, wParam, lParam<br />.ENDIF<br /><br />&lt;blahblah&gt;<br /><br />DrawLCD	proc uses edi esi ebx<br />LOCAL   hDC:DWORD<br />LOCAL   CharacterCounter:DWORD<br />LOCAL   SubCharacterCounter: DWORD<br /><br />; Get DC of main window to create compatible DCs:<br />invoke	GetDC, hwnd<br />mov	hDC, eax<br /><br /><br />      ; --- draw background ---<br />      ; The background is drawn by randomly drawing pixels with color<br />      ; indexes 0-6. Note that this is done every time the LCD is drawn.<br />      ; But because of the fixed randomseed used, the (pseudo)random <br />      ; function will always draw the same pixels and thus always keeping <br />      ; the background the same. <br />      mov         RandSeed, RANDOMSEED<br />      xor          ebx, ebx<br />	<br />     mov         ecx, lpLCDBmp 	;ecx points to raw bitmap data<br />     xor          edi, edi<br />      .WHILE             edi&lt;+WindowHeightSizeOffset<br />	             xor esi, esi<br /><br />                             .WHILE    esi&lt;+WindowWidthSizeOffset<br />		      invoke	PseudoRandom<br />		      mov		, al    ;add random pixel<br />		      inc      ebx<br />		      inc      esi<br />                             .ENDW<br />	             inc edi<br />       .ENDW<br /><br />push ecx<br />mov ecx, 0        ;Prime the loop<br />jmp @UpdateCharacters<br />	<br />@UpdateCharacters:<br />                  ;This is where the positions of each character are updated from 1 to <br />                                                                                       ;tSmallTextCounter<br />                  inc ecx<br />                  cmp ecx, tSmallTextCounter<br />                  je @UpdateComplete<br />                  mov       EAX, TextElementIndex              ;Bounds-Check the index-pointer<br />                                                                                     ;array element<br />                  inc         EAX                                   ;Increase the element value by 1<br />                  cmp       EAX, 17                              ;Does it exceed 16?<br />                  je          @SetElementBackToOne      ;It does. Set it back to 1<br />                  jne        @ContinueLoop                   ;It does not, continue loop<br />                  <br />                  @ContinueLoop:<br />                                 mov    eax, TextPosOffsetMatrix          ;Because it did not, let&#39;s <br />                                                                                              ;apply that value<br />                                 mov    TextElementIndex, eax            ;Let&#39;s update the index-<br />                                                                                              ;pointer array element<br />                                                                                              ;Move the next letter into<br />                                                                                              ;the single character <br />                                                                                              ;register                              <br />                                 jmp @UpdateCharacters<br />                                <br />	                @SetElementBackToOne:<br />                                                              mov    TextPosOffsetMatrix, 1<br />                                                              mov    eax, TextPosOffsetMatrix                 <br />                                                              mov    TextElementIndex, eax<br />                                                                                     <br />                                                              jmp    @UpdateCharacters<br /><br />@UpdateComplete:<br />;Now we loop to display the text<br />push ecx<br />mov ecx, 0        ;Prime the loop<br />jmp @ReLoop<br />	<br />    @ReLoop:<br />            inc ecx<br />            cmp ecx, <br />            je @FinishSineEffect<br />            mov eax, TextElementIndex<br />            mov edx, tSmallText1<br />            invoke DrawLCDText, 6, 300 + TextElementIndex, LCDTEXTSIZE_SMALL, ADDR tSmallText1<br />            jmp @ReLoop         <br /><br />    @FinishSineEffect:<br />                ;invoke MessageBox,hwnd,ADDR tSmallText1,ADDR tmpText,MB_OK<br />                pop ecx<br />                ; --- Blit the drawn LCD onto the back buffer ---<br />                invoke	BitBlt, hBackDC,0,0,+WindowWidthSizeOffset, +WindowHeightSizeOffset, hLCDDC, 0,0, SRCCOPY<br />                                 	<br />                ; --- Blit the monochrome label onto the back buffer ---<br />                invoke	BitBlt, hBackDC,0,0,+WindowWidthSizeOffset, +WindowHeightSizeOffset, hLabelDC, 0, 0, SRCAND<br /><br />ret<br />DrawLCD endp<br /></code></pre><br /><br />I know I know... still lots of HLL Constructions.. eventually I&#39;ll get rid of them all, but I haven&#39;t had the time to read the link on ranges that Roticv posted, plus I&#39;ve been so busy trying to figure out where I missed up on the usage of registers and register contents that I haven&#39;t had free time to rework the code for more of a linear flow (over an event-driven flow). Unfortunately the code window kinda botched my indents a bit, I pasted the code in and spent some time re-indenting it but alas it seems like my effort was in vain.. Hope the code can still be followed..</div>
    <div class="meta">Posted on 2005-09-24 15:52:27 by EtErNiTy</div>
   </div>
   <div class="post" id="post-166291">
    <div class="subject"><a href="#post-166291">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">EtErNiTy - common advises<br />1.could you put sources into zips - this long bands make topic unreadable :( or place only exact line where error occured.<br />2.do not work with complex examples: you will definitely fail and bring us a headake with answering the question :)<br />3.you placed a lot of source, but it is not clear what &quot;WindowWidthSizeOffset&quot; and &quot;WINDOW_WIDTH&quot; mean - mb try to place them into brackets together: <br />4.HLL constructions are invented to prettify source looking, but you should not start from them in assembler: firstly you should have success without them, and when you will understand clear how it all works, then you may decide which style to use.<br /><br />regards!<br /><br />Hi, Syn!<br />I&#39;m glad to meet you in one topic together ;) :)<br /></div>
    <div class="meta">Posted on 2005-09-26 00:40:12 by Shoo</div>
   </div>
   <div class="post" id="post-166352">
    <div class="subject"><a href="#post-166352">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">hehehe yeah I had a feeling it might have been generating alot of headaches, I appologize for that.. Ask and ye shall receieve. Was saving giving out the source until it was finished, but here goes (the zip is attached to this post. I included both the MASM source, don&#39;t worry about coding it over the FASM, I can take care of that (I think lol)&nbsp;  At best I can get it to scroll the text accrossed the backdrop, but all on the same Y coord&nbsp;  Oh also, take out the mp3 song, i&#39;d like to upload it witht he zip because I really like it and think it would work great for a demo background song but alas the server only allows 256kb per post (meant for just source upload).<br /><br />Unpack them to this directory to mimic it more close to what I&#39;m looking at (You may have to make a few directories, yes directory. NOT folders, I refuse to call them folders lol)<br /><br />C:\masm32\MySource\ASMDemos<br /><br />Oh yeah, also on here I go by the name EtErNiTy, but I typically use the the nick StakFallT.. That&#39;s why you&#39;ll see the text in the demo &quot;StakFallT presents[...]&quot; At first, I decided against using StakFallT, &#39;cause it was kinda a neat hacker type of handle I thought, and in a way implying knowledge, but then I realized how many issues I have with asm so I decided against using it here, but thinking about it some more I may change my display name to show up as that now as it&#39;s more literally correct lol</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=996" target="_blank">ASMDemo1.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2005-09-27 20:39:31 by EtErNiTy</div>
   </div>
   <div class="post" id="post-166371">
    <div class="subject"><a href="#post-166371">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">is lcd.rc/res same with demo1.rc/res? if yes - i do not see anything - will check far (w2k i&#39;m using)<br />-----<br />i see - i have no soundcard and have no audio-cd near me :)<br />-----<br />and have a crash after i saw the window - will dig deeper</div>
    <div class="meta">Posted on 2005-09-28 02:07:16 by Shoo</div>
   </div>
   <div class="post" id="post-166372">
    <div class="subject"><a href="#post-166372">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">now have no crash:<br /><pre><code>.ELSEIF eax==WM_TIMER<br />&nbsp; &nbsp; ; --- display update timer ---<br />&nbsp; &nbsp; .IF		wParam==MAINTIMERID<br />	&nbsp; &nbsp; ;add tSmallTextCounter, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc tSmallTextCounter<br /><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .IF tSmallTextCounter &gt; 220<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov tSmallTextCounter, 1<br />;&nbsp; &nbsp; &nbsp;  @InvalidateWindow:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Invalidate the window to force a repaint<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke	InvalidateRect, hWnd, NULL, FALSE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ENDIF</strong>&nbsp; &nbsp; ;.ELSEIF&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wParam==TextScroll<br /><br />	.ENDIF<br /></code></pre></div>
    <div class="meta">Posted on 2005-09-28 02:28:22 by Shoo</div>
   </div>
   <div class="post" id="post-166381">
    <div class="subject"><a href="#post-166381">Re: Invalid use of register, heeeelp :(</a></div>
    <div class="body">yeah lcd.res is in essence the same as demo1.res</div>
    <div class="meta">Posted on 2005-09-28 07:07:13 by EtErNiTy</div>
   </div>
  </div>
 </body>
</html>