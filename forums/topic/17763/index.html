<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Fast dwtohex Version? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17763" />
    <link rel="next" href="../?id=17763&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=17763">Fast dwtohex Version?</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=17763&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=17763&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="17763" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=17763&amp;page=2">&gt;</a><a href="../?id=17763&amp;page=2">&raquo;</a></form>   <div class="post" id="post-137140">
    <div class="subject"><a href="#post-137140">Fast dwtohex Version?</a></div>
    <div class="body">Hello,<br /><br />I have written a dwtohex-Verison and testet it against the version in the masm-lib.<br /><br />It seems up to 10 times faster on my PIV.<br /><br /><br />Only on my PIV?<br /><br /><br /><pre><code><br />_dwtohex proc USES EDI num&#58; DWORD, buffer&#58; DWORD<br /><br />  MOV EAX, num<br />  MOV EDI, buffer<br />  MOV ECX, 8<br /> <br /><br />@@loop&#58;<br />  ROL EAX, 4<br />  MOV EDX, EAX<br />  AND EDX, 0Fh<br />  ADD EDX, '0'<br />  CMP EDX, '9'  <br />  JBE @@SkipChar<br />  ADD EDX, 'A' - '9' - 1<br />  <br />@@SkipChar&#58;<br />  MOV &#91;EDI&#93;, EDX<br />  INC EDI    <br />  DEC ECX<br />  JNZ @@loop <br />  MOV &#91;EDI&#93;, BYTE PTR 0<br /> <br />  ret<br />_dwtohex endp<br /></code></pre><br /><br />MfG Manuel.</div>
    <div class="meta">Posted on 2004-03-27 09:07:28 by other</div>
   </div>
   <div class="post" id="post-137145">
    <div class="subject"><a href="#post-137145">Fast dwtohex Version?</a></div>
    <div class="body">Hello other<br />I tested the performance of your procedure against the original dw2hex with the performance monitoring object of ObjAsm32 called TickCounter on my PIII 500 and found a time  improvement of ca. 14% using the following code:<br /><br /><pre><code>    mov pTC, $New&#40;TickCounter, Init, NULL&#41;<br /><br />    mov ebx, RETRIES<br />    OCall pTC&#58;&#58;TickCounter.Start<br />    .while ebx != 0<br />      invoke _dwtohex, 0FFFFAAAAh, addr Buffer      <br />      dec ebx<br />    .endw<br />    OCall pTC&#58;&#58;TickCounter.Stop<br />    OCall pTC&#58;&#58;TickCounter.GetTicks<br />    PrintHex eax<br />    PrintString Buffer<br />    <br />    OCall pTC&#58;&#58;TickCounter.Reset<br />    mov ebx, RETRIES<br />    OCall pTC&#58;&#58;TickCounter.Start<br />    .while ebx != 0<br />      invoke dw2hex, 0FFFFAAAAh, addr Buffer      <br />      dec ebx<br />    .endw<br />    OCall pTC&#58;&#58;TickCounter.Stop<br />    OCall pTC&#58;&#58;TickCounter.GetTicks<br />    PrintHex eax<br />    PrintString Buffer<br /><br />    Destroy pTC<br /></code></pre><br /><br /><br />If you consider to use the stosb instruction you can achieve ca. 20% of time reduction using the following code:<br /><br /><pre><code><br />_dwtohex proc uses edi num&#58; DWORD, buffer&#58; DWORD<br />    mov edx, num<br />    mov edi, buffer<br />    mov ecx, 8<br /><br />@@loop&#58;<br />    rol edx, 4<br />    mov eax, edx<br />    and eax, 0Fh<br />    add eax, '0'<br />    cmp eax, '9'  <br />    jbe @@SkipChar<br />    add eax, 'A' - '9' - 1<br />  <br />@@SkipChar&#58;<br />    stosb <br />    dec ecx<br />    jnz @@loop<br />    xor eax, eax<br />    stosb<br /> <br />    ret<br />_dwtohex endp<br /></code></pre><br /><br /><br />Regards,<br /><br />Biterider</div>
    <div class="meta">Posted on 2004-03-27 10:50:48 by Biterider</div>
   </div>
   <div class="post" id="post-137146">
    <div class="subject"><a href="#post-137146">Fast dwtohex Version?</a></div>
    <div class="body">Hello,<br /><br /><div class="quote"><em>Originally posted by Biterider </em><br /><br />If you consider to use the stosb instruction you can achieve ca. 20% of time reduction using the following code:<br /><br /><pre><code><br />_dwtohex proc uses edi num&#58; DWORD, buffer&#58; DWORD<br />    mov edx, num<br />    mov edi, buffer<br />    mov ecx, 8<br /><br />@@loop&#58;<br />    rol edx, 4<br />    mov eax, edx<br />    and eax, 0Fh<br />    add eax, '0'<br />    cmp eax, '9'  <br />    jbe @@SkipChar<br />    add eax, 'A' - '9' - 1<br />  <br />@@SkipChar&#58;<br />    stosb <br />    dec ecx<br />    jnz @@loop<br />    xor eax, eax<br />    stosb<br /> <br />    ret<br />_dwtohex endp<br /></code></pre><br /><br /></div><br /><br />Nice but on my PIV is stosb very slow. You code was 20% slower then the first one :-).<br /><br /><br />MfG Manuel.</div>
    <div class="meta">Posted on 2004-03-27 11:06:15 by other</div>
   </div>
   <div class="post" id="post-137149">
    <div class="subject"><a href="#post-137149">Fast dwtohex Version?</a></div>
    <div class="body">That's a major problem with optimization. You may get better results with a given algo on some processors but worse results on others. <br /><br />Newer processors are not necessarily backward compatible with the older ones when it comes to their architecture having an effect on how instructions are processed.<br /><br />And you also get differences between architectures from different manyfacturers to compound the problem.<br /><br />On top of that, some people occasionally waste their time and energy trying to save a few nanoseconds when the result will then stay on display for a relative eternity waiting for user input.<br /><br />Raymond</div>
    <div class="meta">Posted on 2004-03-27 11:33:48 by Raymond</div>
   </div>
   <div class="post" id="post-137150">
    <div class="subject"><a href="#post-137150">Fast dwtohex Version?</a></div>
    <div class="body">Hello,<br /><br /><pre><code><br />__dwtohex proc USES EDI num&#58; DWORD, buffer&#58; DWORD<br /><br />  MOV EAX, num<br />  BSWAP EAX<br />  MOV EDI, buffer<br />  MOV ECX, 4<br />  INC EDI <br />  <br />@@loop&#58;<br />  MOV EDX, EAX<br />  AND EDX, 0Fh<br />  ADD EDX, '0'<br />  CMP EDX, '9'  <br />  JBE @F<br />  ADD EDX, 'A' - '9' - 1<br />  <br />@@&#58;<br />  MOV &#91;EDI&#93;, DL<br />  DEC EDI <br />  <br />  SHR EAX, 4<br />  MOV EDX, EAX<br />  AND EDX, 0Fh<br />  ADD EDX, '0'<br />  CMP EDX, '9'  <br />  JBE @F<br />  ADD EDX, 'A' - '9' - 1<br />  <br />@@&#58;<br />  MOV &#91;EDI&#93;, DL<br />  <br />  ADD EDI, 3  <br />  SHR EAX, 4 <br />  DEC ECX<br />  JNZ @@loop <br />  <br />  DEC EDI<br />  MOV &#91;EDI&#93;, BYTE PTR 0<br /> <br />  ret<br />__dwtohex endp<br /></code></pre><br /><br />It is 30% faster than the first version (on PIV).<br /><br />MfG Manuel.</div>
    <div class="meta">Posted on 2004-03-27 11:58:40 by other</div>
   </div>
   <div class="post" id="post-137152">
    <div class="subject"><a href="#post-137152">Fast dwtohex Version?</a></div>
    <div class="body">^ Ditto what Raymond said.</div>
    <div class="meta">Posted on 2004-03-27 12:32:43 by iblis</div>
   </div>
   <div class="post" id="post-137153">
    <div class="subject"><a href="#post-137153">Fast dwtohex Version?</a></div>
    <div class="body">Hello,<br /><br /><div class="quote"><br />^ Ditto what Raymond said. </div><br /><br />Ditto?<br />Yes i know, that there are different results on different processors.<br /><br />Here my last version:<br /><br /><pre><code><br />_dwtohex2 proc USES EDI num&#58; DWORD, buffer&#58; DWORD<br /><br />  MOV EAX, num<br />  MOV EDI, buffer<br />  MOV ECX, 3<br />  MOV &#91;EDI+8&#93;, BYTE PTR 0<br />  <br />@@loop&#58;<br />  MOV EDX, EAX<br />  AND EDX, 0Fh<br />  ADD EDX, '0'<br />  CMP EDX, '9'  <br />  JBE @F<br />  ADD EDX, 'A' - '9' - 1<br />  <br />@@&#58;<br />  MOV &#91;EDI+ECX*2+1&#93;, DL<br />  <br />  SHR EAX, 4<br />  MOV EDX, EAX<br />  AND EDX, 0Fh<br />  ADD EDX, '0'<br />  CMP EDX, '9'  <br />  JBE @F<br />  ADD EDX, 'A' - '9' - 1<br />  <br />@@&#58;<br />  MOV &#91;EDI+ECX*2&#93;, DL<br />  SHR EAX, 4 <br />  DEC ECX<br />  JNS @@loop <br />  <br />  ret<br />_dwtohex2 endp<br /></code></pre><br /><br />This is finally ca. 15 times faster than the version in the masm32.lib.<br /><br /><br />MfG Manuel.</div>
    <div class="meta">Posted on 2004-03-27 12:47:15 by other</div>
   </div>
   <div class="post" id="post-137162">
    <div class="subject"><a href="#post-137162">Fast dwtohex Version?</a></div>
    <div class="body"><strong>other,</strong><br /><br /><strong>&quot;..and testet it against the version in the masm-lib.<br />It seems up to 10 times faster on my PIV.&quot;</strong><br /><br />Most of them are written by HLL pseudo programmers,<br />hence to beat them isn't a big deal<br /><br /><strong>&quot;..This is finally ca. 15 times faster than the version in the masm32.lib.&quot;</strong><br /><br />Your algo is too short to be fast... <br />Try that:<br /><pre><code>OPTION PROLOGUE&#58;NONE                        ; turn it off<br />OPTION EPILOGUE&#58;NONE                        ;<br />Align 16                                    ; <br />Dwtohex3 proc num&#58; DWORD, lpBuffer&#58; DWORD<br />         mov  eax, &#91;esp+2*4&#93;                ; eax-&gt;lpBufer<br />         mov  ecx, &#91;esp+1*4&#93;                ; ecx-&gt;num<br />         add  eax, 8                        ; eax-&gt; end of the string<br />         mov  edx, &#91;esp+0*4&#93;                ; edx-&gt;return address<br />         mov  &#91;esp+2*4&#93;, edx                ; save return address<br />         mov  edx, ecx                      ; ecx=edx=num<br />         mov  &#91;esp+1*4&#93;, esi                ; save esi<br />         add  esp, 1*4   <br />         mov  byte ptr &#91;eax&#93;, 0             ; zero ended string<br />Dwloop&#58;<br />         and  edx, 0Fh<br />         add  eax, -1<br />         cmp  edx, 0Ah<br />         sbb  esi, esi<br />         add  edx, 37h<br />         and  esi, 7<br />         sub  edx, esi<br />         shr  ecx, 4<br />         mov  &#91;eax&#93;, dl<br />         mov  edx, ecx<br />         jnz  Dwloop<br />         pop  esi                           ; restore esi<br />         ret                                ; eax-&gt; starting string's address <br />Dwtohex3 endp                               ;       without leading zeroes<br />OPTION PROLOGUE&#58;PROLOGUEDEF                 ; turn back on the defaults<br />OPTION EPILOGUE&#58;EPILOGUEDEF</code></pre><br /><br />Regards,<br />Lingo</div>
    <div class="meta">Posted on 2004-03-27 18:41:04 by lingo12</div>
   </div>
   <div class="post" id="post-137171">
    <div class="subject"><a href="#post-137171">Fast dwtohex Version?</a></div>
    <div class="body">Hello,<br /><br /><div class="quote"><br /><strong>other,</strong><br /><br />Most of them are written by HLL pseudo programmers,<br />hence to beat them isn't a big deal<br /></div><br /><br />:-). Sorry, but i haven't known that.<br />I thought, that the Algos in the masm32.lib are very fast.<br /><br /><div class="quote"><br /><strong>&quot;..This is finally ca. 15 times faster than the version in the masm32.lib.&quot;</strong><br /><br />Your algo is too short to be fast... <br /></div><br /><br />:-)<br /><br /><div class="quote"><br />Try that:<br /><br />...<br /></div><br /><br />Your algos is ca 300% faster then my last one. Very Nice :-).<br /><br /><br />MfG Manuel.</div>
    <div class="meta">Posted on 2004-03-28 00:56:55 by other</div>
   </div>
   <div class="post" id="post-137176">
    <div class="subject"><a href="#post-137176">Fast dwtohex Version?</a></div>
    <div class="body">Hi,<br />How to know the procedure is 10 times faster, 300% faster...<br />Which monitor program should I used and where can I get it.<br /><br />TQ</div>
    <div class="meta">Posted on 2004-03-28 02:18:45 by QS_Ong</div>
   </div>
   <div class="post" id="post-137178">
    <div class="subject"><a href="#post-137178">Fast dwtohex Version?</a></div>
    <div class="body">Hello,<br /><br /><div class="quote"><em>Originally posted by lingo12 </em><br />Your algo is too short to be fast... <br />Try that:<br /><pre><code>OPTION PROLOGUE&#58;NONE                        ; turn it off<br />OPTION EPILOGUE&#58;NONE                        ;<br />Align 16                                    ; <br />Dwtohex3 proc num&#58; DWORD, lpBuffer&#58; DWORD<br />         mov  eax, &#91;esp+2*4&#93;                ; eax-&gt;lpBufer<br />         mov  ecx, &#91;esp+1*4&#93;                ; ecx-&gt;num<br />         add  eax, 8                        ; eax-&gt; end of the string<br />         mov  edx, &#91;esp+0*4&#93;                ; edx-&gt;return address<br />         mov  &#91;esp+2*4&#93;, edx                ; save return address<br />         mov  edx, ecx                      ; ecx=edx=num<br />         mov  &#91;esp+1*4&#93;, esi                ; save esi<br />         add  esp, 1*4   <br />         mov  byte ptr &#91;eax&#93;, 0             ; zero ended string<br />Dwloop&#58;<br />         and  edx, 0Fh<br />         add  eax, -1<br />         cmp  edx, 0Ah<br />         sbb  esi, esi<br />         add  edx, 37h<br />         and  esi, 7<br />         sub  edx, esi<br />         shr  ecx, 4<br />         mov  &#91;eax&#93;, dl<br />         mov  edx, ecx<br />         jnz  Dwloop<br />         pop  esi                           ; restore esi<br />         ret                                ; eax-&gt; starting string's address <br />Dwtohex3 endp                               ;       without leading zeroes<br />OPTION PROLOGUE&#58;PROLOGUEDEF                 ; turn back on the defaults<br />OPTION EPILOGUE&#58;EPILOGUEDEF</code></pre><br /><br />Regards,<br />Lingo </div><br /><br />Is it possible, that this algorithmus contains errors?<br /><br /><pre><code><br />         shr  ecx, 4<br />         mov  &#91;eax&#93;, dl<br />         mov  edx, ecx<br />         jnz  Dwloop<br /></code></pre><br /><br />0x00001234<br /><br />After the pointer (eax) reaches 1 then you leave the loop.<br /><br /><br />Or i am tired to overlook a important location?<br /><br />MfG Manuel.</div>
    <div class="meta">Posted on 2004-03-28 02:52:56 by other</div>
   </div>
   <div class="post" id="post-137179">
    <div class="subject"><a href="#post-137179">Fast dwtohex Version?</a></div>
    <div class="body">Hello,<br /><br /><div class="quote"><br /><br />How to know the procedure is 10 times faster, 300% faster...<br /></div><br /><br />I use QueryPerformanceCounter(RTDSC?) -&gt; Win32-&gt;API.<br /><br /><br />MfG Mnauel.</div>
    <div class="meta">Posted on 2004-03-28 02:54:10 by other</div>
   </div>
   <div class="post" id="post-137181">
    <div class="subject"><a href="#post-137181">Fast dwtohex Version?</a></div>
    <div class="body">Hello other<br />I agree that there are substantial differences on each machine were the test is performed, but another important point is how the code performance is measured. <br /><br />I tested last proposed alternative procedures for ?dw2hex? on my machine and found that a little unrolling helped to achieve a bit more speed using this code:<br /><br /><pre><code><br />MakeHexChar macro reg&#58;req, pos&#58;req<br />    cmp reg, &quot;9&quot;<br />    jbe @F<br />    add reg, 7<br />@@&#58; <br />    mov byte ptr &#91;eax + pos&#93;, reg<br />endm<br /><br />dwtohex proc dNum&#58; DWORD, pBuffer&#58; DWORD<br />    mov edx, dNum<br />    mov ecx, edx<br />    shr edx, 4<br /><br />    and edx, 0F0F0F0Fh<br />    and ecx, 0F0F0F0Fh<br />    add edx, &quot;0000&quot;<br />    add ecx, &quot;0000&quot;<br />    <br />    mov eax, pBuffer<br />    <br />    MakeHexChar cl, 7<br />    MakeHexChar dl, 6<br />    MakeHexChar ch, 5<br />    MakeHexChar dh, 4<br />    shr ecx, 16<br />    shr edx, 16<br />    MakeHexChar cl, 3<br />    MakeHexChar dl, 2<br />    MakeHexChar ch, 1<br />    MakeHexChar dh, 0<br />    mov byte ptr &#91;eax + 8&#93;, 0<br /><br />    ret<br />dwtohex endp<br /></code></pre><br /><br />Can you test it on your machine?<br /><br />Regards,<br /><br />Biterider</div>
    <div class="meta">Posted on 2004-03-28 03:01:27 by Biterider</div>
   </div>
   <div class="post" id="post-137182">
    <div class="subject"><a href="#post-137182">Fast dwtohex Version?</a></div>
    <div class="body">Hello,<br /><br /><div class="quote"><br /><br />I agree that there are substantial differences on each machine were the test is performed, but another important point is how the code performance is measured. <br /><br />I tested last proposed alternative procedures for ?dw2hex? on my machine and found that a little unrolling helped to achieve a bit more speed using this code:<br /></div><br /><br />Funn, because i want tried to write a simliar code in a few minutes :-).<br /><br /><pre><code><br />dwtohex2 proc num&#58; DWORD, buffer&#58; DWORD<br /><br />  MOV EAX, num<br />  MOV EDX, buffer<br />  MOV BYTE PTR &#91;EDX+8&#93;, 0<br />  <br />  MOV ECX, EAX<br />  SHR EAX, 4<br />  AND EAX, 0F0F0F0F0h<br />  AND ECX, 0F0F0F0F0h<br /><br />  ADD EAX, 30303030h<br />  ADD ECX, 30303030h<br />        <br /> ...<br />  <br />  ret<br />dwtohex2 endp<br /></code></pre><br /><br />Now i have tried to find a fast way, to convert to hex.<br /><br /><div class="quote"><br /><pre><code><br />MakeHexChar macro reg&#58;req, pos&#58;req<br />    cmp reg, &quot;9&quot;<br />    jbe @F<br />    add reg, 7<br />@@&#58; <br />    mov byte ptr &#91;eax + pos&#93;, reg<br />endm<br /><br />dwtohex proc dNum&#58; DWORD, pBuffer&#58; DWORD<br />    mov edx, dNum<br />    mov ecx, edx<br />    shr edx, 4<br /><br />    and edx, 0F0F0F0Fh<br />    and ecx, 0F0F0F0Fh<br />    add edx, &quot;0000&quot;<br />    add ecx, &quot;0000&quot;<br />    <br />    mov eax, pBuffer<br />    <br />    MakeHexChar cl, 7<br />    MakeHexChar dl, 6<br />    MakeHexChar ch, 5<br />    MakeHexChar dh, 4<br />    shr ecx, 16<br />    shr edx, 16<br />    MakeHexChar cl, 3<br />    MakeHexChar dl, 2<br />    MakeHexChar ch, 1<br />    MakeHexChar dh, 0<br />    mov byte ptr &#91;eax + 8&#93;, 0<br /><br />    ret<br />dwtohex endp<br /></code></pre><br /><br />Can you test it on your machine?<br /></div><br /><br />Yes and it is very fast.<br />Ca. 30% faster as my last algo.<br /><br />Nice work.<br /><br />MfG Manuel.</div>
    <div class="meta">Posted on 2004-03-28 04:10:46 by other</div>
   </div>
   <div class="post" id="post-137189">
    <div class="subject"><a href="#post-137189">Fast dwtohex Version?</a></div>
    <div class="body">Hallo,<br /><br />;) ... long is beautiful ;)<br /><br /><br /><pre><code><br />dwtohex2 proc num&#58; DWORD, buffer&#58; DWORD<br /><br />  PUSH EBX<br />  PUSH ESI<br /><br />  MOV EDX, buffer<br />  MOV EAX, num<br />  MOV BYTE PTR &#91;EDX+8&#93;, 0<br /><br />  MOV ECX, EAX<br /><br />  SHR EAX, 4<br />  AND EAX, 0F0F0F0Fh<br />  AND ECX, 0F0F0F0Fh<br /><br />  ADD EAX,  37373737h<br />  ADD ECX,  37373737h<br />  <br />  ; -- --------------<br /><br />  MOV EBX, EAX<br />  AND EBX, 40404040h<br /><br />  MOV ESI, EBX<br />  SHR ESI, 4<br />  SHR EBX, 5<br />  OR ESI, EBX<br />  SHR EBX, 1<br />  OR ESI, EBX<br />  <br />  SUB EAX, 07070707h<br />  ADD EAX, ESI<br /><br />  ; ----------------<br />  <br />  MOV EBX, ECX<br />  AND EBX, 40404040h<br /><br />  MOV ESI, EBX<br />  SHR ESI, 4<br />  SHR EBX, 5<br />  OR ESI, EBX<br />  SHR EBX, 1<br />  OR ESI, EBX<br />  <br />  SUB ECX, 07070707h<br />  ADD ECX, ESI<br />   <br />  ; ----------------<br />   <br />  MOV BL, AL<br />  MOV BH, CL<br /> <br />  SHL EBX, 16<br /> <br />  MOV BL, AH<br />  MOV BH, CH<br /><br />  MOV &#91;EDX+4&#93;, EBX<br /><br />  ; ----------------<br />  <br />  SHR EAX, 16<br />  SHR ECX, 16<br /><br />  ; ----------------<br />  <br />  MOV BL, AL<br />  MOV BH, CL<br /> <br />  SHL EBX, 16<br /> <br />  MOV BL, AH<br />  MOV BH, CH<br /><br />  MOV &#91;EDX&#93;, EBX<br /><br />  PUSH ESI<br />  POP EBX<br /><br />  ret<br />dwtohex2 endp<br /></code></pre><br /><br /><br />MfG Manuel.</div>
    <div class="meta">Posted on 2004-03-28 06:02:08 by other</div>
   </div>
   <div class="post" id="post-137193">
    <div class="subject"><a href="#post-137193">Fast dwtohex Version?</a></div>
    <div class="body">Hello other<br />Notice the bug in the last lines of your code (push pop should be pop pop).<br />I tested it on my machine and don?t achieve any improvement. I fall down to the performance of the first routines. How are the results on your machine? Have you considered to use the rdtsc instruction for performance measuring?<br /><br />Regards,<br /><br />Biterider</div>
    <div class="meta">Posted on 2004-03-28 06:50:50 by Biterider</div>
   </div>
   <div class="post" id="post-137194">
    <div class="subject"><a href="#post-137194">Fast dwtohex Version?</a></div>
    <div class="body">Hello,<br /><br /><div class="quote"><em>Originally posted by Biterider </em><br />Hello other<br />Notice the bug in the last lines of your code (push pop should be pop pop).<br /></div><br /><br />Thank you. <br /><br /><div class="quote"><br />I tested it on my machine and don?t achieve any improvement. I fall down to the performance of the first routines. How are the results on your machine? Have you considered to use the rdtsc instruction for performance measuring?<br /></div><br /><br />It is a slower on my machine than yours (ca. 20%) but it can extremely optimized.<br />I have some ideas, but don't know how i put in pratice.<br /><br /><br />MfG Manuel.</div>
    <div class="meta">Posted on 2004-03-28 06:58:47 by other</div>
   </div>
   <div class="post" id="post-137197">
    <div class="subject"><a href="#post-137197">Fast dwtohex Version?</a></div>
    <div class="body"><strong>other,</strong><br /><br /><strong>Is it possible, that this algorithmus contains errors?</strong><br /><br />No<br /><br /><strong>0x00001234<br />After the pointer (eax) reaches 1 then you leave the loop.</strong><br /><br />Yes<br /><br />I dont't  need leading zeroes in the final string<br />[see the comment for eax-&gt; at the last line)<br /><br />Regards,<br />Lingo</div>
    <div class="meta">Posted on 2004-03-28 08:11:01 by lingo12</div>
   </div>
   <div class="post" id="post-137199">
    <div class="subject"><a href="#post-137199">Fast dwtohex Version?</a></div>
    <div class="body">Sorry,<br /><br /><div class="quote"><br />0x00001234<br />After the pointer (eax) reaches 1 then you leave the loop.</strong><br /><br />Yes<br /><br />I dont't  need leading zeroes in the final string<br /><br /><br />But i haven't read the comment :-(.<br /><br /><br />MfG Manuel.</div>
    <div class="meta">Posted on 2004-03-28 08:34:30 by other</div>
   </div>
   <div class="post" id="post-137228">
    <div class="subject"><a href="#post-137228">Fast dwtohex Version?</a></div>
    <div class="body">Hello,<br /><br /><pre><code><br />dwtohexf proc dwNumber&#58; DWORD, buffer&#58; DWORD<br /><br />  PUSH EBX<br />  <br />  MOV EBX, dwNumber<br />  MOV ECX, EBX<br /> <br />  SHR EBX, 4<br />  AND ECX, 0F0F0F0Fh   <br />  AND EBX, 0F0F0F0Fh				; mask hex-digit<br />  MOV EAX, ECX<br />  MOV EDX, EBX<br /><br />  ADD EDX, 80808080h - 0A0A0A0Ah	; build mask to discern digit &gt; 9<br />  ADD EAX, 80808080h - 0A0A0A0Ah <br />  SHR EDX, 4						<br />  SHR EAX, 4 <br />  NOT EDX<br />  NOT EAX<br />  <br />  AND EDX, 07070707h				; mask digit &gt; 9 ... mask = 0111<br />  AND EAX, 07070707h<br />  ADD EDX, EBX						; add 'A' - '9' if digit &gt; 9<br />  ADD EAX, ECX<br />  ADD EDX, 30303030h				; add ascii '0'<br />  ADD EAX, 30303030h<br />  <br />  MOV EBX, buffer 					<br />  MOV BYTE PTR &#91;EBX + 8&#93;, 0<br />  									; &lt;-- not optimized swap &#40; there are surly better wasy &#41; ---&gt; ;<br />  MOV CH, AL<br />  MOV CL, DL<br />  SHL ECX, 16<br />  MOV CH, AH<br />  MOV CL, DH<br />  MOV &#91;EBX+4&#93;, ECX<br /><br />  SHR EAX, 16<br />  SHR EDX, 16<br />  <br />  MOV CH, AL<br />  MOV CL, DL<br />  SHL ECX, 16<br />  MOV CH, AH<br />  MOV CL, DH<br />  MOV &#91;EBX+0&#93;, ECX<br /> <br />  POP EBX<br />  <br />  ret<br />dwtohexf endp<br /></code></pre><br /><br />The swap is ... ;)<br /><br /><br />MfG Manuel.</div>
    <div class="meta">Posted on 2004-03-28 14:39:24 by other</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=17763&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=17763&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="17763" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=17763&amp;page=2">&gt;</a><a href="../?id=17763&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>