<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>need help wth ths program - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29610" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=115">DOS &amp; BIOS</a> &raquo; <a href="../?id=29610">need help wth ths program</a></p>
   <div class="post" id="post-209089">
    <div class="subject"><a href="#post-209089">need help wth ths program</a></div>
    <div class="body">i dont know what happn it always says &quot;invalid input!&quot; but my codes are right. <a target="_blank" href="http://www.4shared.com/file/139850350/830bb162/wcalcu.html">here</a> is my code.<br /><br />.please help me. coz im just new to ths language. tnx</div>
    <div class="meta">Posted on 2009-10-10 08:49:33 by xxxlancedxxx</div>
   </div>
   <div class="post" id="post-209090">
    <div class="subject"><a href="#post-209090">Re: need help wth ths program</a></div>
    <div class="body">Hey LanceD,<br /><br />Welcome to the forum. First I would like to say that if you are going to post code you&#039;ll get more responses if you either post it inline using the <span class="mono">[</span><span class="mono">CODE</span><span class="mono">][</span><span class="mono">/CODE</span><span class="mono">]</span> or uploaded as an attachment. If you simply must use an offsite post, try using a source post repository like http://www.sourcepod.com/ which allows you to post an example online for a period of time.<br /><br />Now, for your code.<br /><br /><pre><code>	XOR BX, BX		; clear BX<br /><br />	<br /><br />	CMP time_out, 2	; is the first digit of the input greater than 2?<br /><br />	JG HANDLE_ERROR2	; if yes, ERROR!<br /><br />	JE CHECK_NEXTD2		; if it is equal to 2, check the second digit<br /><br />	JL CHECK_UNDERTIME2	; if less than, check undertime.<br /><br /><br /><br />	CHECK_NEXTD2:<br /><br />	INC BX			; increment BX<br /><br />	CMP time_out, 4	; if the second digit greater than 4?<br /><br />	JG HANDLE_ERROR2	; if yes, handle error <br /><br />	JMP CHECK_UNDERTIME2	; if no error, check for possible undertime (when employee goes home before 17:00)<br /><br /><br /><br />	;handling errors<br /><br />	HANDLE_ERROR2:<br /><br />	lea dx, ERROR	;load effect data<br /><br />	mov ah, 9	;displays data input<br /><br />	int 21h		; execute<br /><br />	JMP EXIT	; jump to exit</code></pre><br /><br />This is where your program has problems. When you read in your values, they are in the form of character codes, here you test if the first value read is above 2, if so an error occurs. But since you are dealing with character codes the value entered is always going to be above 2. Same goes for the test against the second value being above 4, although this is not reached. what you need to do is convert these values or test them against the character codes themselves, eg Cmp time_out, &#039;2&#039; and Cmp time_out, &#039;4&#039;. Same goes for the time_in checks. Another error is in your CHECK_UNDERTIME code, you Pop Bx however looking through the code which gets executed before hand I don&#039;t see a single Push instruction which leads me to believe this code will also error (however your &quot;Invalid Input!&quot; error occurs before you get to this point. <br /><br />As an optimization note, you don&#039;t need to use BX in your read loop to index the array, since CX constantly the same value as BX you can just use it and save the register and a few instructions:<br /><br /><pre><code>;input time-in<br /><br />	MOV AH, 1		; read character function<br /><br />	XOR CX, CX		; clear CX<br /><br />	<br /><br />	INPUT:<br /><br />	INT 21H			; execute<br /><br />	MOV time_in, AL	; move contents of AL to array<br /><br />	INC CX			; increment CX by 1<br /><br />	CMP CX, 2		; is CX = 2?<br /><br />	JE NEXT			; if yes, go to NEXT<br /><br />	JMP INPUT		; if not, loop until all digits are placed in array<br /><br /><br /><br />	NEXT:<br /><br /><br /><br />;go to new line<br /><br />	MOV AH, 2 	;display char function<br /><br />	MOV DL, 0DH 	;carriage return<br /><br />	INT 21H 	;execute<br /><br /><br /><br />	MOV DL, 0AH 	;line feed<br /><br />	INT 21H 	;execute<br /><br /><br /><br />;display second message (for time out)<br /><br />	lea dx, msg_out	;load effect data<br /><br />	mov ah, 9	;displays data input<br /><br />	int 21h<br /><br /><br /><br />;input time-out<br /><br />	MOV AH, 1		; read character function<br /><br />	XOR CX, CX		; clear CX	<br /><br /><br /><br />	OUTPUT:<br /><br />	INT 21H			; execute<br /><br />	MOV time_out, AL	; move contents of AL to array<br /><br />	INC CX			; increment CX<br /><br />	CMP CX, 2		; is CX = 2?<br /><br />	JE NEXT2		; if yes, go to NEXT2<br /><br />	JMP OUTPUT		; if not, loop until all digits are placed in array<br /><br /><br /><br />	NEXT2:<br /><br />;go to new line<br /><br />	MOV AH, 2 	;display char function<br /><br />	MOV DL, 0DH 	;carriage return<br /><br />	INT 21H 	;execute<br /><br /><br /><br />	MOV DL, 0AH 	;line feed<br /><br />	INT 21H 	;execute</code></pre><br /><br />I just glanced over the code because I have no way of building it at the moment, so I&#039;ll leave more detailed analysis to others.</div>
    <div class="meta">Posted on 2009-10-10 10:43:12 by Synfire</div>
   </div>
   <div class="post" id="post-209106">
    <div class="subject"><a href="#post-209106">Re: need help wth ths program</a></div>
    <div class="body">..tnx so much for the help..<br /><br />..but thre stll an error in the code...<br /><br /><pre><code>;PROJECT SUMMARY:&nbsp; user inputs time-in and time-out (by hour).&nbsp; the usual time-in is 8AM and the time-out is 5PM.<br />;Base Salary is Php270.00<br />;A deduction of Php30.00 from the base salary will be done for every hour late<br />;An additional Php50.00 is given for every hour overtime (until 10PM only)<br />;Output the daily salary and the monthly salary (daily salary * 30)<br /><br />TITLE wcalcu.asm WAGE CALCULATOR<br />.MODEL SMALL<br />.STACK 100H<br />.DATA<br />	NOTE db &#039;DO take note a 24-hour format is followed.&nbsp; $&#039;<br />	EXAMPLE db &#039;Ex: 08 corresponds to 8AM while 13 is 1pm.$&#039;<br />	MSG_IN db &#039;Enter time-in: $&#039;<br />	MSG_OUT db &#039;Enter time-out: $&#039;<br />	MSG_MIN db &#039;Enter minimum wage in your company.$&#039;<br />	DAILY_SAL db &#039;Your daily salary is $&#039;<br />	MONTHLY_SAL db &#039;Your monthly salary is $&#039;<br />	ERROR1 db &#039;Invalid Input (time-in!) $&#039;<br />	ERROR db &#039;Invalid Input (time-out!) $&#039;<br />	daily_wage db ?<br />	monthly_wage db ?<br />	time_in db ?<br />	time_out db ?<br />	<br />.CODE<br />main proc<br />;initialize ds<br />	mov ax, @data	<br />	mov ds, ax			;initialize data segment<br /><br />;**************************************************************************;<br />;---------------------------&nbsp; OPENING MSGS&nbsp; -------------------------------;<br />;**************************************************************************;<br /><br />;display NOTE<br />	lea dx, NOTE	;load effect data<br />	mov ah, 9	;displays data input<br />	int 21h<br /><br />;go to new line<br />	MOV AH, 2 	;display char function<br />	MOV DL, 0DH 	;carriage return<br />	INT 21H 	;execute<br /><br />	MOV DL, 0AH 	;line feed<br />	INT 21H 	;execute<br />	;execute<br /><br />;display example<br />	lea dx, EXAMPLE	;load effect data<br />	mov ah, 9	;displays data input<br />	int 21h<br /><br />;go to new line<br />	MOV AH, 2 	;display char function<br />	MOV DL, 0DH 	;carriage return<br />	INT 21H 	;execute<br /><br />	MOV DL, 0AH 	;line feed<br />	INT 21H 	;execute<br /><br />;display msg1 (asking for time-in)<br />	lea dx, msg_in	;load effect data<br />	mov ah, 9	;displays data input<br />	int 21h<br /><br />;**************************************************************************;<br />;------------------------- INPUT and STORING&nbsp; -----------------------------;<br />;**************************************************************************;<br /><br />;input and storing time-in<br />	MOV ah, 1		; read character function<br />	XOR BX, BX		; clear BX<br />	MOV CX, 0		; CX = 0<br />	<br />	INPUT:<br />	INT 21H			; execute<br />	MOV time_in, AL	; move contents of AL to BL<br />	INC CX			; increment CX by 1<br />	INC BX			; increase BX<br />	CMP CX, 2		; is CX = 2?<br />	JE NEXT			; if yes, go to NEXT<br />	JMP INPUT		; if not, loop until all digits are placed in array<br /><br />	NEXT:<br /><br />;go to new line<br />	MOV AH, 2 	;display char function<br />	MOV DL, 0DH 	;carriage return<br />	INT 21H 	;execute<br /><br />	MOV DL, 0AH 	;line feed<br />	INT 21H 	;execute<br /><br />;display second message (for time out)<br />	lea dx, msg_out	;load effect data<br />	mov ah, 9	;displays data input<br />	int 21h<br /><br />;input and storing time-out<br />	MOV ah, 1		; read character function<br />	XOR BX, BX		; clear BX<br />	MOV CX, 0		; CX = 0	<br /><br />	OUTPUT:<br />	INT 21H			; execute<br />	MOV time_out, AL	; move contents of AL to BL<br />	INC CX			; increment CX<br />	INC BX			; increase BX<br />	CMP CX, 2		; is CX = 2?<br />	JE NEXT2		; if yes, go to NEXT2<br />	JMP OUTPUT		; if not, loop until all digits are placed in array<br /><br />	NEXT2:<br />;go to new line<br />	MOV AH, 2 	;display char function<br />	MOV DL, 0DH 	;carriage return<br />	INT 21H 	;execute<br /><br />	MOV DL, 0AH 	;line feed<br />	INT 21H 	;execute<br /><br />;display third message (for minimum wage)<br />	lea dx, msg_min	;load effect data<br />	mov ah, 9	;displays data input<br />	int 21h<br /><br />;input and storing min wage<br />	MOV ah, 1		; read character function<br />	XOR BX, BX		; clear BX<br />	MOV CX, 0		; CX = 0	<br /><br />	WAGE:<br />	INT 21H			; execute<br />	MOV daily_wage, AL	; move contents of AL to BL<br />	INC CX			; increment CX<br />	INC BX			; increase BX<br />	CMP CX, 3		; is CX = 3?<br />	JE NEXT3		; if yes, go to NEXT3<br />	JMP WAGE		; if not, loop until all digits are placed in array<br /><br />	NEXT3:<br />;go to new line<br />	MOV AH, 2 	;display char function<br />	MOV DL, 0DH 	;carriage return<br />	INT 21H 	;execute<br /><br />	MOV DL, 0AH 	;line feed<br />	INT 21H 	;execute<br /><br />	<br /><br /><br />;**************************************************************************;<br />;---------------- CHECKING FOR VALIDITY OF INPUT (TIME-IN)-----------------;<br />;**************************************************************************;<br /><br />;checking for validity by comparing each digit in the array:<br /><br />	INPUT1_VALIDITY:<br />	XOR BX, BX		; clear BX<br />	<br />	MOV AL, time_in	; move contents of time_in to AL<br />	CMP AL, 31H		; is the first digit of the input less than or equal to 1?<br />	JG HANDLE_ERROR		; if not, ERROR!<br />	JL CHECK_UNDERTIME	; if less than, check undertime.<br />	JE CHECK_NEXTD		; if first digit = 1, check 2nd digit<br /><br />	CHECK_NEXTD:<br />	INC BX			; increment BX<br />	MOV AL, time_in	; move the contents of time_in to AL<br />	CMP AL, 37H		; is the second digit greater than 7?<br />	JG HANDLE_ERROR		; if yes, handle error <br />	JMP CHECK_UNDERTIME	; if no error in input1, check undertime due to tardiness<br />	<br />;handling errors<br />	HANDLE_ERROR:<br />	lea dx, ERROR1	;load effect data<br />	mov ah, 9	;displays data input<br />	int 21h<br />	JMP EXIT	; jump to exit!<br /><br /><br /><br />;**************************************************************************;<br />;----------------- CHECKING IF UNDERTIME DUE TO TARDINESS -----------------;<br />;**************************************************************************;<br /><br />; check if employee is late<br />	CHECK_UNDERTIME:<br />	XOR AX, AX		; clear AX<br />	XOR BX, BX		; clear BX<br />	<br />	MOV AL,time_in 	; move to AL<br />	CMP AL, 31H		; is the first digit = 1?<br />	JE GET_NEXTD		; if yes, compute the number of hours late<br />	INC BX			; if no, incerement BX<br />	MOV AL, time_in	; move contents to AL<br />	CMP AL, 37H		; if the first digit is not 1, is the next digit greater than 7?<br />	JG COMPUTE_LATE		; if yes, compute the number of hours late<br />	JMP INPUT2_VALIDITY	; if not, check if employee had an overtime<br /><br />; if time in is 1*<br />	GET_NEXTD:<br />	INC BX			; increment BX<br />	MOV AL, time_in	; AL = time_in<br />	CMP AL, 38h		; is the second digit greater than 8?<br />	JG BORROW		; if yes, go to function borrow (subtraction through borrowing)<br />	JLE COMPUTE_LATE	; if not, subtract the simple way<br />	<br />; subtracting the simple way (no borrwing)<br />	COMPUTE_LATE:<br />	MOV AL, time_in	; AX = time_in[1]<br />	SUB AL, 8h		; AX = AX - 8<br />	JMP UNDERTIME		; subtract salary per hour late		<br /><br />; subtracting through borrowing<br />	BORROW:<br />	MOV AL, 9h		; AX = 9<br />	ADD AL, 1h		; AX = 10<br />	MOV DL, time_in	; DL = time_in<br />	ADD AL, DL		; AX = AX + DL<br />	SUB AL, 8h		; AX = AX - 8<br />	JMP UNDERTIME		; subtract salary per time late	<br /><br />; deducting per hour LATE<br />	UNDERTIME:<br />	MOV BX, 2h		; BX = 2<br /><br />	MOV AL, daily_wage	; move to AL<br />	SUB AL, 3h		; subtract the digit 3 from the 2nd digit of the wage<br />	MOV daily_wage, AL	; copy to BX<br />	CMP AL, 33H		; is the digit less than 3?<br />	DEC BX			; BX = 0<br />	JL BORROW2		; if yes, borrow from the 1st digit<br />	<br />	BORROW2:<br />	MOV AL, daily_wage	; move to AL<br />	DEC AL			; subtract 1 from AL<br />	MOV daily_wage, AL	; copy to array<br />	 <br />	JMP INPUT2_VALIDITY	; check validity of input 2<br /><br /><br />;**************************************************************************;<br />;---------------- CHECKING FOR VALIDITY OF INPUT (TIME-OUT)----------------;<br />;**************************************************************************;<br /><br />;checking for validity by comparing each digit in the array:<br />	INPUT2_VALIDITY:<br />	XOR BX, BX		; clear BX<br />	<br />	MOV AL, time_out	; move the contents of time_out to AL<br />	CMP AL, 32H		; is the first digit of the input equal to 2?<br />	JE CHECK_IF1		; if equal to 2, check if the next digit is &lt;= 3<br />	JG HANDLE_ERROR2	; if greater than, handle error<br />	JMP PRINT<br />	;JL CHECK_OVERTIME	; if it starts with 1, check if employee has OT<br />	<br />	CHECK_IF1:<br />	INC BX			; increase BX by 1<br />	MOV AL, time_out	; move the contents to AL<br />	CMP AL, 33H		; check if 2nd digit is less than or equal to 4<br />	JG HANDLE_ERROR2	; cut off time is 23:00<br />	JMP PRINT<br />	;JMP COMPUTE_OT		; compute no. of hours overtime<br />	<br />;handling errors<br />	HANDLE_ERROR2:<br />	lea dx, ERROR	; load effect data<br />	mov ah, 9	; displays data input<br />	int 21h		; execute<br />	JMP EXIT	; jump to exit!<br />	<br /><br />;**************************************************************************;<br />;------------------------PROCESSING OVERTIME ------------------------------;<br />;**************************************************************************;<br />;check for overtime<br />	<br />;**************************************************************************;<br />;------------------------ENDING THE PROGRAM&nbsp; ------------------------------;<br />;**************************************************************************;<br />PRINT:<br />;print output<br />	;display daily salary<br />	ADD_30H:<br />	MOV AL, daily_wage	; move to AL<br />	ADD AL, 30H		; add 30H to each character<br />	INC BX			; increment BX<br />	CMP BX, 33H		; is BX = 3?<br />	JE display_char		; if equal, display character<br />	JMP ADD_30H		; if not, loop	<br /><br />	display_char:<br />	;MOV DL, BL		; retrieve character<br />	INT 21H<br />	;LEA DX,daily_wage<br />	MOV AH,2<br />	INT 21h<br />; display character<br />	;MOV DL, BL		; retrieve character<br />	;INT 21H<br /><br /><br />;go to new line<br />	MOV AH, 2 	;display char function<br />	MOV DL, 0DH 	;carriage return<br />	INT 21H 	;execute<br /><br />	MOV DL, 0AH 	;line feed<br />	INT 21H 	;execute<br />	<br />EXIT:			<br />;return to DOS<br />	EXIT:<br />	mov ah,4ch	;DOS exit function<br />	int 21h		;execute<br />main endp<br />	end main</code></pre><br /><br />..hope you could help me figure ths out..<br /><br />..tnx agen..</div>
    <div class="meta">Posted on 2009-10-11 06:41:48 by xxxlancedxxx</div>
   </div>
   <div class="post" id="post-209113">
    <div class="subject"><a href="#post-209113">Re: need help wth ths program</a></div>
    <div class="body">Maybe you should team up <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=29612.0">lloydie</a> and figure this out for your class, together :idea:</div>
    <div class="meta">Posted on 2009-10-11 12:44:42 by SpooK</div>
   </div>
   <div class="post" id="post-209134">
    <div class="subject"><a href="#post-209134">Re: need help wth ths program</a></div>
    <div class="body">Heh. Yes...<br /><br />But SpooK, you&#039;ve been doing 32-bit code too long! &quot;mov in_time, al&quot; isn&#039;t going to be a valid effective address in 16-bit code... (aren&#039;t you glad you&#039;ve forgotten that? :)<br /><br />But Lance could use bx for both index and counter... (just an optimization - it&#039;ll work the way you&#039;ve got it... pretty much...)<br /><br />After displaying your prompts, you get a character with int 21h/1. Remember that this is a character, not the number it represents(!). You put it in &quot;in_time&quot;. Then you loop back for another number and put it in the next byte in the buffer... but you only allocated one byte for the buffer! A buffer overflow, in your very first program!!! :) Seriously, this is a real problem! Always think about what you&#039;re letting the pesky user put in your buffer! While we&#039;re at it, what are you going to do if the user enters &quot;x&quot;, or something else that&#039;s not a number? This is the time to catch it!!!<br /><br />A little later (okay, a lot) you do...<br /><br />;print output<br />	;display daily salary<br />	ADD_30H:<br />	MOV AL, daily_wage	; move to AL<br />	ADD AL, 30H		; add 30H to each character<br />	INC BX			; increment BX<br />	CMP BX, 33H		; is BX = 3?<br />	JE display_char		; if equal, display character<br />	JMP ADD_30H		; if not, loop	<br /><br />Here, you keep incrementing bx until it&#039;s 33h before printing anything. This is going to be way beyond the end of your buffer. This error makes me suspect that you don&#039;t &quot;get&quot; the difference between a number, and the character(s) representing the number. You get a character from the keyboard. If it&#039;s between &#039;0&#039; (ascii code 30h) and &#039;9&#039; (ascii code 39h), you can simply subtract 30h (you can write this as &#039;0&#039; - &quot;sub al, &#039;0&#039;&quot; may be clearer than &quot;sub al, 30h&quot;... tells us that 30h isn&#039;t the number of cars in the parking lot :) If it takes more than one character to represent the number... more complication! If the user types &quot;12&quot;, we get &#039;1&#039;, subtract &#039;0&#039; and add it to the &quot;result so far&quot; (zeroed, to start), then IFF we get another character, &#039;2&#039;... subtract &#039;0&#039;, we multiply the &quot;result so far&quot; by ten and add the new number. We&#039;re done, in this case, but we could keep going like that until the user hits &quot;enter&quot;... Now you&#039;ve got a number you can do arithmetic on - &quot;hours * wage&quot;, for example.<br /><br />When it comes time to print the results of your calculation, you&#039;ll need to convert the number back to a character - probably more than one! Add &#039;0&#039; (30h) to each digit to convert it to a character - the &quot;div&quot; instruction will help you isolate digits. Look it up - there are some &quot;strange&quot; features... If you&#039;re going to use int 21h/9 to print it, remember that it does a $-terminated string!<br /><br />Apparently, &quot;youse guys&quot; haven&#039;t gotten to &quot;call&quot; and &quot;ret&quot; yet. Pity, this assignment just begs for &#039;em! Your &quot;newline&quot; routine would make a nice subroutine, as well as the &quot;convert text to number&quot; and &quot;convert number to text&quot; routines - but you can do it repeatedly &quot;inline&quot; as you do with the &quot;newline&quot; if you have to. If it&#039;s &quot;allowed&quot;, this might be a good time to learn &#039;em! (See what Homer says in his sig? &quot;Build Bricks&quot;. That&#039;s the way to think about this!)<br /><br />Might also be a good time to learn to use a debugger. If you could step through your code instruction by instruction, you&#039;d probably find the errors (if any :) yourself. If not, try to &quot;think like a CPU&quot;. See if you can narrow the problem(s) down to more specific question(s) that we can help you with...<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2009-10-12 15:19:59 by fbkotler</div>
   </div>
   <div class="post" id="post-209195">
    <div class="subject"><a href="#post-209195">Re: need help wth ths program</a></div>
    <div class="body">...tnx so much guys..<br /><br />..my prog is now running completely..<br /><br />...tnx for your help...<br /><br />..god bless to all of you..</div>
    <div class="meta">Posted on 2009-10-15 20:28:03 by xxxlancedxxx</div>
   </div>
   <div class="post" id="post-209202">
    <div class="subject"><a href="#post-209202">Re: need help wth ths program</a></div>
    <div class="body">god had nothing to do with it, but thanks anyway :)</div>
    <div class="meta">Posted on 2009-10-16 08:03:44 by Homer</div>
   </div>
  </div>
 </body>
</html>