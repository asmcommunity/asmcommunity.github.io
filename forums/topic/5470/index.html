<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>mdi child window problem - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=5470" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=5470">mdi child window problem</a></p>
   <div class="post" id="post-38833">
    <div class="subject"><a href="#post-38833">mdi child window problem</a></div>
    <div class="body">im made a little test app that when you click on the menu a mdi child will be made. the problem is when i maximize the child the minimize and maximize buttons will no longer work. here is the code can someone take a look at it and tell me what im missing. you can cut and paste this or just download the asm file and use that. thanks.<br /><pre><code>.586<br />.model flat, stdcall<br /> option casemap &#58;none<br />      <br />   include      /masm32/include/windows.inc<br />   include      /masm32/include/kernel32.inc<br />   include      /masm32/include/user32.inc<br />   include      /masm32/include/comctl32.inc<br />   include      /masm32/include/Gdi32.inc<br />   <br />   includelib   /masm32/lib/kernel32.lib<br />   includelib   /masm32/lib/user32.lib<br />   includelib   /masm32/lib/comctl32.lib<br />   includelib   /masm32/lib/Gdi32.lib<br />      <br />   WinMain      PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />   WndProc      PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />   TopXY        PROTO &#58;DWORD,&#58;DWORD<br />   MakeMDIchild PROTO<br />   MDIclass     PROTO<br />      <br />.data<br />   ClassName      db &quot;Starting Template&quot;,0<br />   CaptionText    db &quot;Template&quot;,0<br />   tMenu          db &quot;Create New MDI Child&quot;,0<br />   mdiCl          db &quot;MDICLIENT&quot;,0<br />   MDIchildClass  db &quot;mdi_child&quot;,0<br />   tText          db &quot;We Just Made This&quot;,0<br />       <br />.data?<br />   hWnd         HANDLE ?<br />   hInstance    HANDLE ?<br />   hEdit1       HANDLE ?<br />   hMenu        HANDLE ?<br />   hClient      HANDLE ?<br />   cc           CLIENTCREATESTRUCT &lt;?&gt;<br />   mdi          WNDCLASSEX &lt;?&gt;<br /><br />.code<br /> start&#58;<br />   invoke GetModuleHandle, NULL<br />   mov    hInstance, eax<br />   invoke WinMain,hInstance,NULL,NULL,SW_SHOWDEFAULT<br />   invoke ExitProcess,eax<br /><br />; ####################################<br /><br />WinMain proc hInst&#58;DWORD, hPrevIns&#58;DWORD, CmdLine&#58;DWORD, CmdShow&#58;DWORD<br /><br />   LOCAL  wc   &#58;WNDCLASSEX<br />   LOCAL  msg  &#58;MSG<br />   LOCAL  Wwd  &#58;DWORD<br />   LOCAL  Wht  &#58;DWORD<br />   LOCAL  Wtx  &#58;DWORD<br />   LOCAL  Wty  &#58;DWORD<br />   <br />   mov    wc.cbSize,       SIZEOF WNDCLASSEX<br />   mov    wc.style,        CS_BYTEALIGNWINDOW<br />   mov    wc.lpfnWndProc,  OFFSET WndProc<br />   mov    wc.cbClsExtra,   NULL<br />   mov    wc.cbWndExtra,   NULL<br />   mov    eax,             hInstance<br />   mov    wc.hInstance,    eax<br />   invoke LoadIcon,        NULL,IDI_APPLICATION<br />   mov    wc.hIcon,        eax<br />   mov    wc.hIconSm,      eax<br />   invoke LoadCursor,      NULL,IDC_ARROW<br />   mov    wc.hCursor,      eax<br />   mov    wc.hbrBackground,COLOR_BTNFACE+1<br />   mov    wc.lpszMenuName, NULL<br />   mov    wc.lpszClassName,OFFSET ClassName<br />   invoke RegisterClassEx, addr wc<br />   <br />   mov    Wwd, 500<br />   mov    Wht, 350<br />   <br />   invoke GetSystemMetrics,SM_CXSCREEN<br />   invoke TopXY,Wwd,eax<br />   mov    Wtx, eax<br />   <br />   invoke GetSystemMetrics,SM_CYSCREEN<br />   invoke TopXY,Wht,eax<br />   mov    Wty, eax<br />   <br />   invoke CreateWindowEx, NULL,<br />                          ADDR ClassName,<br />                          ADDR CaptionText,<br />                          WS_OVERLAPPEDWINDOW,<br />                          Wtx,Wty,Wwd,Wht,<br />                          NULL,<br />                          NULL,<br />                          hInst,<br />                          NULL<br />   mov    hWnd,eax<br />   invoke ShowWindow,hWnd,SW_SHOWNORMAL<br />   invoke UpdateWindow,hWnd<br />   <br />   StartLoop&#58;<br />      invoke GetMessage,ADDR msg,NULL,0,0<br />      cmp eax, 0<br />      je ExitLoop<br />      invoke TranslateMessage, ADDR msg<br />      invoke DispatchMessage,  ADDR msg<br />      jmp StartLoop<br />   ExitLoop&#58;<br /><br />      mov eax,msg.wParam<br />      ret<br /><br />WinMain endp<br /><br />; #################################<br /><br />WndProc proc hWin&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br /><br />   .IF uMsg == WM_CREATE<br />      invoke InitCommonControls<br />      invoke CreateMenu<br />      mov hMenu,eax<br />      invoke AppendMenu,hMenu,MF_POPUP + MF_STRING,8000,addr tMenu<br />      invoke SetMenu,hWin,hMenu<br />      <br />      invoke MDIclass<br />      <br />      <br />      invoke GetSubMenu,hMenu,1<br />      mov cc.hWindowMenu,eax<br />      mov cc.idFirstChild,100<br />      invoke CreateWindowEx, WS_EX_CLIENTEDGE,<br />                             addr mdiCl,<br />                             0,<br />                             WS_CHILD + WS_VISIBLE,<br />                             0,0,0,0,<br />                             hWin,<br />                             0,<br />                             hInstance,<br />                             ADDR cc<br />        mov hClient, eax<br />    <br />   .ELSEIF uMsg == WM_COMMAND<br />      .if wParam == 8000<br />         invoke MakeMDIchild<br />      .endif<br />              <br />   .ELSEIF uMsg == WM_DESTROY<br />      invoke PostQuitMessage,NULL<br />   .ELSE<br />      invoke DefFrameProc,hWin,hClient,uMsg,wParam,lParam		<br />      ret<br />   .ENDIF<br />      xor eax,eax<br />      ret<br /><br />WndProc endp<br /><br />; ####################################<br /><br />MDIproc proc hwnd&#58;DWORD, uMsg&#58;DWORD, wParam&#58;DWORD, lParam&#58;DWORD<br />;// nothing to do here yet<br />   invoke DefMDIChildProc,hwnd,uMsg,wParam,lParam<br />ret<br />MDIproc endp<br /><br />; ####################################<br /><br />MDIclass proc<br />       <br />   mov    mdi.cbSize,       SIZEOF WNDCLASSEX<br />   mov    mdi.style,        CS_BYTEALIGNWINDOW<br />   mov    mdi.lpfnWndProc,  OFFSET MDIproc<br />   mov    mdi.cbClsExtra,   NULL<br />   mov    mdi.cbWndExtra,   NULL<br />   mov    eax,              hInstance<br />   mov    mdi.hInstance,    eax<br />   mov    mdi.hbrBackground,COLOR_WINDOW+1<br />   mov    mdi.lpszClassName,OFFSET MDIchildClass<br />   invoke RegisterClassEx,  addr mdi<br />   <br />ret<br /><br />MDIclass endp<br /><br />; ####################################<br /><br />MakeMDIchild proc<br />LOCAL hChild&#58;HANDLE<br />    invoke CreateWindowEx,WS_EX_MDICHILD,<br />                          ADDR MDIchildClass,<br />                          addr tText,<br />                          0,;WS_MAXIMIZE,<br />                          0,0,200,200,<br />                          hClient,<br />                          100,<br />                          hInstance,<br />                          0<br /><br />    mov hChild, eax<br />    invoke ShowWindow,hChild,SW_NORMAL<br /><br />ret<br />MakeMDIchild endp<br /><br /><br />; ####################################<br /><br />TopXY proc wDim&#58;DWORD, sDim&#58;DWORD<br /><br />    shr sDim, 1<br />    shr wDim, 1<br />    mov eax, wDim<br />    sub sDim, eax<br />    mov eax,sDim<br />    ret<br /><br />TopXY endp<br /><br />; ####################################<br /><br />end start</code></pre></div>
    <div class="meta">Posted on 2002-05-18 15:14:52 by smurf</div>
   </div>
   <div class="post" id="post-38847">
    <div class="subject"><a href="#post-38847">mdi child window problem</a></div>
    <div class="body">Thats a weird error you got there smurf, everything looks like it should work... Anyways, I've attached an MDI program I made for a group project I'm helping out with, It's just the all the required MDI stuff, I hope you find it useful.... might even beable to find your error with a closer look by some comparing.<br /><br /><br />James</div>
    <div class="meta">Posted on 2002-05-18 16:29:43 by JamesE</div>
   </div>
   <div class="post" id="post-38857">
    <div class="subject"><a href="#post-38857">mdi child window problem</a></div>
    <div class="body">after looking at your code i still couldnt figure out what was going on. so i was competely turned my program upside down making a complete rewrite and comparing to my old program as i went and it was the stupid ret i was using in in the WM_COMMAND message. well anyways 10 hours or so down the drain i finally can move on.</div>
    <div class="meta">Posted on 2002-05-18 19:24:03 by smurf</div>
   </div>
  </div>
 </body>
</html>