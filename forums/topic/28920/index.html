<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Sticky Forms Example! - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=28920" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=116">Windows</a> &raquo; <a href="../?id=28920">Sticky Forms Example!</a></p>
   <div class="post" id="post-204460">
    <div class="subject"><a href="#post-204460">Sticky Forms Example!</a></div>
    <div class="body">There are some windows which when are dragged around the screen, will get &quot;glued&quot; to certain edges of the screen. For example, if you drag the window to the rightmost point of the screen, it will get glued to the rightmost edge of the screen. I thought it was fun to make something like this in MASM. Besides, it had been a long time since I had coded anything in MASM with Win32 API so here it is. Ladies and gentlemen, please welcome: Sticky Form:<br /><br /><pre><code>.386<br />.MODEL FLAT, STDCALL<br />OPTION CASEMAP:NONE<br /><br /> INCLUDE Windows.inc<br /> INCLUDE User32.inc<br /> INCLUDE Kernel32.inc<br /><br />&nbsp; INCLUDELIB User32.lib<br />&nbsp; INCLUDELIB Kernel32.lib<br /><br />&nbsp; INITIAL_WINDOW_WIDTH&nbsp; &nbsp; &nbsp; &nbsp; EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  200<br />&nbsp; INITIAL_WINDOW_HEIGHT&nbsp; &nbsp; &nbsp;  EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  INITIAL_WINDOW_WIDTH<br />&nbsp; STICKY_FACTOR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  5<br /><br />.DATA<br />&nbsp; ClassName&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;#32770&quot;, 0<br />&nbsp; WindowName&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;Sticky Form&quot;, 0<br />&nbsp; Messages&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MSG&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;&gt;<br />.DATA?<br />&nbsp; hInstance&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  HINSTANCE&nbsp; &nbsp; &nbsp; &nbsp;  ?<br />&nbsp; CommandLine&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  LPSTR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ?<br />&nbsp; MainForm&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HWND&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ?<br />&nbsp; WindowClass&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  WNDCLASSEX&nbsp; &nbsp; &nbsp; &nbsp; &lt;&gt;<br />&nbsp; ScreenDevice&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DEVMODE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;&gt;<br />.CODE<br /><br />; ---------------------------------------------------------------------------<br /><br />WndProc PROC hWnd:DWORD, Msg:UINT, wParam:WPARAM, lParam:LPARAM<br /><br />&nbsp; LOCAL&nbsp;  WindowWidth:DWORD<br />&nbsp; LOCAL&nbsp;  WindowHeight:DWORD<br />&nbsp; LOCAL&nbsp;  ScreenWidth:DWORD<br />&nbsp; LOCAL&nbsp;  ScreenHeight:DWORD<br /><br /><br />&nbsp; MOV&nbsp; &nbsp;  ESI , Msg<br /><br /><br />&nbsp; @@:<br />&nbsp; &nbsp; CMP&nbsp; &nbsp;  ESI , WM_CLOSE<br />&nbsp; &nbsp; JNE&nbsp; &nbsp;  @F<br />&nbsp; &nbsp; INVOKE&nbsp; ExitProcess, 0<br /><br /><br />&nbsp; @@:<br />&nbsp; &nbsp; CMP&nbsp; &nbsp;  ESI , WM_MOVING<br />&nbsp; &nbsp; JNE&nbsp; &nbsp;  @F<br /><br />&nbsp; &nbsp; ASSUME&nbsp; EBX:PTR DEVMODE<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EBX , OFFSET ScreenDevice<br />&nbsp; &nbsp; INVOKE&nbsp; EnumDisplaySettings, NULL, 0FFFFFFFFh, EBX<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EAX , DWORD PTR .dmPelsWidth<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EDX , DWORD PTR .dmPelsHeight<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  ScreenWidth , EAX<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  ScreenHeight , EDX<br />&nbsp; &nbsp; ASSUME&nbsp; ESI:PTR RECT<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  ESI , lParam<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EAX , DWORD PTR .left<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EBX , DWORD PTR .right<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  ECX , DWORD PTR .top<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EDX , DWORD PTR .bottom<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EDI , EBX<br />&nbsp; &nbsp; SUB&nbsp; &nbsp;  EDI , EAX<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  WindowWidth , EDI<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  EDI , EDX<br />&nbsp; &nbsp; SUB&nbsp; &nbsp;  EDI , ECX<br />&nbsp; &nbsp; MOV&nbsp; &nbsp;  WindowHeight , EDI<br /><br />&nbsp; &nbsp; ; EAX = left<br />&nbsp; &nbsp; ; EBX = right<br />&nbsp; &nbsp; ; ECX = top<br />&nbsp; &nbsp; ; EDX = bottom<br />&nbsp; &nbsp; ; ESI = RECT<br />&nbsp; &nbsp; ; EDI = Free<br /><br />&nbsp; &nbsp; @@CheckStickingToTheLeftofScreen:<br />&nbsp; &nbsp; &nbsp; CMP&nbsp; &nbsp;  EAX , 0 + STICKY_FACTOR<br />&nbsp; &nbsp; &nbsp; JG&nbsp; &nbsp; &nbsp; @@CheckStickingToTheRightofScreen<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  DWORD PTR .left , 0000000h<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  EDI , EBX<br />&nbsp; &nbsp; &nbsp; SUB&nbsp; &nbsp;  EDI , EAX<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  DWORD PTR .right , EDI<br /><br />&nbsp; &nbsp; @@CheckStickingToTheRightofScreen:<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  EDI , ScreenWidth<br />&nbsp; &nbsp; &nbsp; SUB&nbsp; &nbsp;  EDI , STICKY_FACTOR<br />&nbsp; &nbsp; &nbsp; CMP&nbsp; &nbsp;  EBX , EDI<br />&nbsp; &nbsp; &nbsp; JL&nbsp; &nbsp; &nbsp; @@CheckStickingToTheTopofScreen<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  EDI , ScreenWidth<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  DWORD PTR .right , EDI<br />&nbsp; &nbsp; &nbsp; SUB&nbsp; &nbsp;  EDI , WindowWidth<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  DWORD PTR .left , EDI<br /><br />&nbsp; &nbsp; @@CheckStickingToTheTopofScreen:<br />&nbsp; &nbsp; &nbsp; CMP&nbsp; &nbsp;  ECX , 0 + STICKY_FACTOR<br />&nbsp; &nbsp; &nbsp; JG&nbsp; &nbsp; &nbsp; @@CheckStickingToTheBottomofScreen<br />&nbsp; &nbsp; &nbsp; XOR&nbsp; &nbsp;  EDI , EDI<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  DWORD PTR .top , EDI<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  EDI , WindowHeight<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  DWORD PTR .bottom , EDI<br /><br />&nbsp; &nbsp; @@CheckStickingToTheBottomofScreen:<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  EDI , ScreenHeight<br />&nbsp; &nbsp; &nbsp; SUB&nbsp; &nbsp;  EDI , STICKY_FACTOR<br />&nbsp; &nbsp; &nbsp; CMP&nbsp; &nbsp;  EDX , EDI<br />&nbsp; &nbsp; &nbsp; JL&nbsp; &nbsp; &nbsp; @F<br />&nbsp; &nbsp; &nbsp; ADD&nbsp; &nbsp;  EDI , STICKY_FACTOR<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  DWORD PTR .bottom , EDI<br />&nbsp; &nbsp; &nbsp; SUB&nbsp; &nbsp;  EDI , WindowHeight<br />&nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  DWORD PTR .top , EDI<br /><br /><br /><br />&nbsp; @@:<br />&nbsp; INVOKE&nbsp; DefWindowProc, hWnd, Msg, wParam, lParam<br />&nbsp; RET<br />WndProc ENDP<br /><br />; ---------------------------------------------------------------------------<br /><br />START:<br />&nbsp; INVOKE&nbsp; GetModuleHandle, NULL<br />&nbsp; MOV&nbsp; &nbsp;  hInstance, EAX<br />&nbsp; MOV&nbsp; &nbsp;  ESI , EAX<br /><br />&nbsp; ASSUME&nbsp; EDI:PTR WNDCLASSEX<br />&nbsp; MOV&nbsp; &nbsp;  EDI , OFFSET WindowClass<br />&nbsp; INVOKE&nbsp; RtlZeroMemory, EDI, SIZEOF WNDCLASSEX<br />&nbsp; MOV&nbsp; &nbsp;  DWORD PTR .cbSize , SIZEOF WNDCLASSEX<br />&nbsp; MOV&nbsp; &nbsp;  DWORD PTR .hbrBackground , COLOR_BTNFACE + 1<br />&nbsp; MOV&nbsp; &nbsp;  DWORD PTR .lpszClassName , OFFSET ClassName<br />&nbsp; MOV&nbsp; &nbsp;  DWORD PTR .lpfnWndProc , OFFSET WndProc<br />&nbsp; MOV&nbsp; &nbsp;  DWORD PTR .hInstance , ESI<br />&nbsp; INVOKE&nbsp; LoadCursor, 0, IDC_ARROW<br />&nbsp; MOV&nbsp; &nbsp;  DWORD PTR .hCursor , EAX<br />&nbsp; INVOKE&nbsp; LoadIcon, 0, IDI_APPLICATION<br />&nbsp; MOV&nbsp; &nbsp;  DWORD PTR .hIcon , EAX<br />&nbsp; MOV&nbsp; &nbsp;  DWORD PTR .hIconSm , EAX<br />&nbsp; INVOKE&nbsp; RegisterClassEx, OFFSET WindowClass<br /><br />&nbsp; ; Position the screen in the center of the screen<br />&nbsp; ASSUME&nbsp; EBX:PTR DEVMODE<br />&nbsp; MOV&nbsp; &nbsp;  EBX , OFFSET ScreenDevice<br />&nbsp; INVOKE&nbsp; EnumDisplaySettings, NULL, 0FFFFFFFFh, EBX<br />&nbsp; MOV&nbsp; &nbsp;  EAX , DWORD PTR .dmPelsWidth<br />&nbsp; SHR&nbsp; &nbsp;  EAX , 00000001h<br />&nbsp; SUB&nbsp; &nbsp;  EAX , (INITIAL_WINDOW_WIDTH SHR 1)<br />&nbsp; MOV&nbsp; &nbsp;  EDX , DWORD PTR .dmPelsHeight<br />&nbsp; SHR&nbsp; &nbsp;  EDX , 00000001h<br />&nbsp; SUB&nbsp; &nbsp;  EDX , (INITIAL_WINDOW_HEIGHT SHR 1)<br /><br />&nbsp; ; EAX = Center.X<br />&nbsp; ; EDX = Center.Y<br /><br />&nbsp; INVOKE&nbsp; CreateWindowEx, 0, OFFSET ClassName, OFFSET WindowName, WS_VISIBLE OR WS_OVERLAPPEDWINDOW, \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EAX, EDX, INITIAL_WINDOW_WIDTH, INITIAL_WINDOW_HEIGHT, 0, 0, ESI, 0<br /><br />&nbsp; MOV&nbsp; &nbsp;  DWORD PTR  , EAX<br />&nbsp; MOV&nbsp; &nbsp;  ESI , EAX<br />&nbsp; INVOKE&nbsp; ShowWindow , EAX, SW_SHOWNORMAL<br />&nbsp; INVOKE&nbsp; UpdateWindow , ESI<br /><br />&nbsp; @@:<br />&nbsp; &nbsp; INVOKE&nbsp; GetMessage, OFFSET Messages, 0, 0, 0<br />&nbsp; &nbsp; TEST&nbsp; &nbsp; EAX , EAX<br />&nbsp; &nbsp; JZ&nbsp; &nbsp; &nbsp; @F<br />&nbsp; &nbsp; INVOKE&nbsp; TranslateMessage, OFFSET Messages<br />&nbsp; &nbsp; INVOKE&nbsp; DispatchMessage, OFFSET Messages<br />&nbsp; &nbsp; JMP&nbsp; &nbsp;  @B<br />&nbsp; @@:<br /><br />&nbsp; INVOKE&nbsp; ExitProcess, 0<br /><br />END START<br /></code></pre></div>
    <div class="meta">Posted on 2008-01-12 23:50:28 by XCHG</div>
   </div>
   <div class="post" id="post-204462">
    <div class="subject"><a href="#post-204462">Re: Sticky Forms Example!</a></div>
    <div class="body">Is this more like those &quot;snap-to&quot; windows, ones that ride along a screen edge or something else completely?</div>
    <div class="meta">Posted on 2008-01-13 00:48:10 by SpooK</div>
   </div>
   <div class="post" id="post-204463">
    <div class="subject"><a href="#post-204463">Re: Sticky Forms Example!</a></div>
    <div class="body">Some of them stick to any adjacent window but this one only sticks to the borders of the screen and not any window. It could be extended to do that though. One more thing that the program does is that it won&#039;t get dragged outside the screen. :thumbsup:</div>
    <div class="meta">Posted on 2008-01-13 01:26:30 by XCHG</div>
   </div>
   <div class="post" id="post-204468">
    <div class="subject"><a href="#post-204468">Re: Sticky Forms Example!</a></div>
    <div class="body">handles multiple monitors?</div>
    <div class="meta">Posted on 2008-01-13 06:15:59 by evlncrn8</div>
   </div>
   <div class="post" id="post-204469">
    <div class="subject"><a href="#post-204469">Re: Sticky Forms Example!</a></div>
    <div class="body"><div class="quote"><br />handles multiple monitors?<br /></div><br /><br />Well I don&#039;t have more than one monitor so I would say &quot;yes it does&quot; :lol&quot; I don&#039;t really know if the code works on multiple monitors. Shouldn&#039;t the Operating System handle that for the application?</div>
    <div class="meta">Posted on 2008-01-13 06:46:45 by XCHG</div>
   </div>
   <div class="post" id="post-204473">
    <div class="subject"><a href="#post-204473">Re: Sticky Forms Example!</a></div>
    <div class="body"><div class="quote"><br /><div class="quote"><br />handles multiple monitors?<br /></div><br /><br />Well I don&#039;t have more than one monitor so I would say &quot;yes it does&quot; :lol&quot; I don&#039;t really know if the code works on multiple monitors. Shouldn&#039;t the Operating System handle that for the application?<br /></div><br />Depends on whether you&#039;re querying screen/desktop dimensions at any times... which you probably do if you support snapping to screen edge :)<br /><br />There&#039;s basically two ways that multi-monitor configs can be handled: stretching your desktop across all screens (meaning an app maximizes pretty uglily, you get start/process bar on both monitors, etc), or &quot;independent&quot; where your app maximizes to only one monitor... it&#039;s the &quot;independent&quot; mode some applications have trouble handling.</div>
    <div class="meta">Posted on 2008-01-13 08:01:34 by f0dder</div>
   </div>
   <div class="post" id="post-204483">
    <div class="subject"><a href="#post-204483">Re: Sticky Forms Example!</a></div>
    <div class="body"><div class="quote"><br />Depends on whether you&#039;re querying screen/desktop dimensions at any times... which you probably do if you support snapping to screen edge :)</div><br />Yes I am doing that with every WM_MOVING message that is sent to the window :P<br /><br />Well from your descriptions, I believe there are certain techniques that have to be used to allow this application to be working on multiple screens. I haven&#039;t tried it on multiple screens as I don&#039;t have them but I would appreciate it if somebody could try it out and give me some feedback.</div>
    <div class="meta">Posted on 2008-01-13 11:57:40 by XCHG</div>
   </div>
   <div class="post" id="post-204484">
    <div class="subject"><a href="#post-204484">Re: Sticky Forms Example!</a></div>
    <div class="body">I&#039;m on a laptop right now, but I have multiple monitors on my main box, so I can give it a spin there. And iirc, yeah, there&#039;s a couple of multi-monitor related APIs you&#039;ll want to use.</div>
    <div class="meta">Posted on 2008-01-13 12:33:11 by f0dder</div>
   </div>
   <div class="post" id="post-204491">
    <div class="subject"><a href="#post-204491">Re: Sticky Forms Example!</a></div>
    <div class="body">You indeed need some multi-monitor fixing, as expected I can&#039;t drag your window to my second desktop :). Also, it doesn&#039;t respect/snap-to the taskbar.</div>
    <div class="meta">Posted on 2008-01-14 06:59:53 by f0dder</div>
   </div>
   <div class="post" id="post-204492">
    <div class="subject"><a href="#post-204492">Re: Sticky Forms Example!</a></div>
    <div class="body">Yeah it doesn&#039;t stick to the task-bar. That&#039;s by design. It sticks to the bottom of the screen. Um about the multi monitor fixing, I am going to have to read more about it and I think it is going to be really difficult since I don&#039;t have multiple monitors :(</div>
    <div class="meta">Posted on 2008-01-14 08:02:45 by XCHG</div>
   </div>
   <div class="post" id="post-204493">
    <div class="subject"><a href="#post-204493">Re: Sticky Forms Example!</a></div>
    <div class="body">yup i&#039;ve been planning to add in multi monitor support for one of my tools... bit tricky considering i haven&#039;t got the hardware...<br />though i guess f0dder might be a good guinea pig hehe :)</div>
    <div class="meta">Posted on 2008-01-14 09:14:01 by evlncrn8</div>
   </div>
  </div>
 </body>
</html>