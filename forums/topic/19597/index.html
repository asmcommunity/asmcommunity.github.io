<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>WriteProcessMemory - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=19597" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=19597">WriteProcessMemory</a></p>
   <div class="post" id="post-150903">
    <div class="subject"><a href="#post-150903">WriteProcessMemory</a></div>
    <div class="body">hi coders<br />i  had just one question that is bugging me.when i put <br />the second parameter(lpaddress) in WriteProcessMemory dedined in a source code it works fine but when i try to get it from a user through an editbox it does not work. here is the code<br /><pre><code><br />targetfile db &quot;Bullseye game.exe&quot;,0 <br />bytestopatch db &quot;hello man its patched&quot;,0 <br />pstarted db &quot;Click to patch.&quot;,0<br />notloaded db &quot;It did not work &#58;-&#40;&quot;,0<br />Letsgo db &quot;The process is started&quot;,13,10,<br />	  &quot;Let's change smthg and run it now &#58;-&#41;&quot;,0<br /><br />Startup STARTUPINFO &lt;&gt;<br />processinfo PROCESS_INFORMATION &lt;&gt;<br /><br />RvaBuffer dd ?<br />byteswritten dd ?<br />..........<br />.........<br />invoke GetDlgItemInt,hWnd,IDC_EDIT,0h,FALSE<br />                        mov RvaBuffer, eax<br />                   	mov    hInstance,eax<br />                        invoke CreateProcess, ADDR Targetfile,NULL, NULL, NULL, NULL, CREATE_SUSPENDED,<br />			      NULL, NULL, ADDR Startup, ADDR processinfo<br />            	     .IF eax == NULL<br />      	            	invoke MessageBox, NULL, ADDR notloaded, NULL, MB_ICONEXCLAMATION<br />            	     .ELSE<br /> 	                       invoke MessageBox, NULL, ADDR Letsgo,ADDR pstarted,  MB_OK<br />                             invoke WriteProcessMemory, processinfo.hProcess,RvaBuffer,ADDR bytestopatch, 23, byteswritten <br />                             ; Let the process run happily ;&#41;<br />	                       invoke ResumeThread, processinfo.hThread<br /><br /></code></pre><br /><br />so is it that i cant just define lpaddress (2nd parameter in WriteProcessMemory) as a variable ????<br />please help.<br />thanks<br />nickdigital</div>
    <div class="meta">Posted on 2004-10-04 09:33:30 by nickdigital</div>
   </div>
   <div class="post" id="post-150904">
    <div class="subject"><a href="#post-150904">WriteProcessMemory</a></div>
    <div class="body">i tried this out on a game i designed for testing purposes of my program.<br /> sorry, this was missing up there.so please dont think as anything illegal its just for study purpose.</div>
    <div class="meta">Posted on 2004-10-04 09:38:25 by nickdigital</div>
   </div>
   <div class="post" id="post-150905">
    <div class="subject"><a href="#post-150905">WriteProcessMemory</a></div>
    <div class="body">This is a part of diassembled listing of the program i am talking about<br /><br /><pre><code><br />&#58;00401171 6A00                    push 00000000           <br />&#58;00401173 6A00                    push 00000000<br /><br />* Possible Reference to Dialog&#58; MYDIALOG, CONTROL_ID&#58;0BB8, &quot;&quot;<br />                                  |<br />&#58;00401175 68B80B0000              push 00000BB8  <br />&#58;0040117A FF7508                  push &#91;ebp+08&#93;<br />? Reference To&#58; USER32.GetDlgItemInt, Ord&#58;0101h<br /><br />&#58;0040117D E838010000              Call 004012BA                                   <br />------ above line  is diassembled listing of  'call GetDlgItemInt'<br />&#58;00401182 A324314000              mov dword ptr &#91;00403124&#93;, eax          --------above line  is diassembled listing of  'mov RvaBuffer, eax'<br /></code></pre><br />My question is if it stores it in dword ptr [00403124] why I cant use it in WriteProcessMemory. I actually debugged it and found the entered value 401264h at address 403124h of this program.Then why doesn?t it work if I push it as a parameter in WriteProcessMemory.<br />code continued here<br /><pre><code><br />&#58;00401187 6A00                    push 00000000<br /><br />* Reference To&#58; KERNEL32.GetModuleHandleA, Ord&#58;0111h<br />                                  |<br />&#58;0040119C E87F010000              Call 00401320<br />&#58;004011A1 A32C314000              mov dword ptr &#91;0040312C&#93;, eax<br />&#58;004011A6 6812314000              push 00403112<br />&#58;004011AB 68CE304000              push 004030CE<br />&#58;004011B0 6A00                    push 00000000<br />&#58;004011B2 6A00                    push 00000000<br />&#58;004011B4 6A04                    push 00000004<br />&#58;004011B6 6A00                    push 00000000<br />&#58;004011B8 6A00                    push 00000000<br />&#58;004011BA 6A00                    push 00000000<br />&#58;004011BC 6A00                    push 00000000<br /><br />* Possible StringData Ref from Data Obj -&gt;&quot;Bullseye game.exe&quot;<br />                                  |<br />&#58;004011BE 6844304000              push 00403044<br /><br />* Reference To&#58; KERNEL32.CreateProcessA, Ord&#58;0042h<br />                                  |<br />&#58;004011C3 E846010000              Call 0040130E<br />&#58;004011C8 0BC0                    or eax, eax<br />&#58;004011CA 7515                    jne 004011E1<br />&#58;004011CC 6A30                    push 00000030<br />&#58;004011CE 6A00                    push 00000000<br /><br />* Possible StringData Ref from Data Obj -&gt;&quot;It did not work &#58;-&#40;&quot;<br />                                  |<br />&#58;004011D0 687C304000              push 0040307C<br />&#58;004011D5 6A00                    push 00000000<br /><br />* Reference To&#58; USER32.MessageBoxA, Ord&#58;01BBh<br />                                  |<br />&#58;004011D7 E8FC000000              Call 004012D8<br />&#58;004011DC E9B5000000              jmp 00401296<br /><br />* Referenced by a &#40;U&#41;nconditional or &#40;C&#41;onditional Jump at Address&#58;<br />|&#58;004011CA&#40;C&#41;<br />|<br />&#58;004011E1 6A00                    push 00000000<br /><br />* Possible StringData Ref from Data Obj -&gt;&quot;Click to patch.&quot;<br />                                  |<br />&#58;004011E3 686C304000              push 0040306C<br /><br />* Possible StringData Ref from Data Obj -&gt;&quot;The process is started&quot;<br />                                  |<br />&#58;004011E8 6890304000              push 00403090<br />&#58;004011ED 6A00                    push 00000000<br /><br />* Reference To&#58; USER32.MessageBoxA, Ord&#58;01BBh<br />                                  |<br />&#58;004011EF E8E4000000              Call 004012D8<br />&#58;004011F4 FF3528314000            push dword ptr &#91;00403128&#93;<br />&#58;004011FA 6A17                    push 00000017<br /><br />* Possible StringData Ref from Data Obj -&gt;&quot;hello man its patched&quot;<br />                                  |<br />&#58;004011FC 6856304000              push 00403056                                   --------above line  is diassembled listing of  'push addr bytestopatch'<br />&#58;00401201 FF3524314000            push dword ptr &#91;00403124&#93;<br />above line  is diassembled listing of  'push RvaBuffer' <br /></code></pre><br /><br />Here is the problem .Why does it not take inputted value 401264h stored at 403124h as a parameter here.<br />JUST FOR NOTE: ADDRESS TO PATCH IS PUSHED HERE IN WRITEPROCESSMEMORY API <br />code continued<br /><pre><code><br />&#58;00401207 FF3512314000            push dword ptr &#91;00403112&#93;                <br /><br />* Reference To&#58; KERNEL32.WriteProcessMemory, Ord&#58;02C3h<br />                                  |<br />&#58;0040120D E81A010000              Call 0040132C                                  -----------above line  is diassembled listing of  'call WriteProcessMemory'<br />&#58;00401212 FF3516314000            push dword ptr &#91;00403116&#93;<br /><br />* Reference To&#58; KERNEL32.ResumeThread, Ord&#58;020Fh<br />                                  |<br />&#58;00401218 E809010000              Call 00401326<br />&#58;0040121D EB77                    jmp 00401296<br /></code></pre><br /><br />Please help me out guys. This code is driving me crazy.<br />Thank you for ur help in advance.<br />nickdigital</div>
    <div class="meta">Posted on 2004-10-04 09:44:17 by nickdigital</div>
   </div>
   <div class="post" id="post-150916">
    <div class="subject"><a href="#post-150916">WriteProcessMemory</a></div>
    <div class="body">Hey nickdigital<br />You may need to use GetDlgItemText to get text from the edit and use the MASM function &quot;htodw&quot;, which converts a string of hex to a dword, or &quot;atodw&quot; to convert a string of numbers to a dword. Last time I tried using GetDlgItemInt to get numbers from an edit to be used as a dword, it didn't work.<br />Try this:<br /><pre><code><br />......................<br />invoke GetDlgItemText,hWnd,IDC_EDIT,ADDR Buffer,6 ; or how many characters you want to copy<br />invoke htodw,ADDR Buffer ; buffer from edit<br />mov RvaBuffer,eax ; result is placed in eax<br />mov hInstance,eax<br />......................<br /></code></pre><br />Hope this helps, unless I misunderstood your question.</div>
    <div class="meta">Posted on 2004-10-04 16:32:20 by yo|dude|mon</div>
   </div>
   <div class="post" id="post-150935">
    <div class="subject"><a href="#post-150935">WriteProcessMemory</a></div>
    <div class="body">hi yo|dude|mon<br />first i tried like this.it works fine to show it in a mesagebox after getting it from edit box, but it did not work with writeprocessmemory api's second parameter.<br />please help if u can.<br />thank you<br />nickdigital<br /><pre><code><br />invoke GetDlgItemText,hWnd,IDC_EDIT1,ADDR buffer1,512 <br />             invoke GetDlgItemText,hWnd,IDC_EDIT2,ADDR buffer2,512 <br />             invoke GetDlgItemText,hWnd,IDC_EDIT3,ADDR buffer3,512 <br />                        <br />               invoke GetModuleHandleA, NULL <br />               mov    hInstance,eax <br />                 invoke CreateProcess, ADDR buffer1,NULL, NULL, NULL, NULL, CREATE_SUSPENDED, <br />               NULL, NULL, ADDR Startup, ADDR processinfo <br />               .IF eax == NULL <br />               invoke MessageBox, NULL, ADDR notloaded, NULL, MB_ICONEXCLAMATION <br />               .ELSE <br />                invoke MessageBox, NULL, ADDR Letsgo,ADDR pstarted,  MB_OK <br />                    invoke wsprintf,buf,addr format, addr buffer2 <br />                          <br />             invoke MessageBox,  NULL,addr buffer3,addr buffer2, MB_ICONEXCLAMATION <br />                  <br /><br />                  invoke WriteProcessMemory, processinfo.hProcess,addr buffer2,ADDR buffer3, 23, byteswritten <br />                     ; Let the process run happily ;&#41; <br />               invoke ResumeThread, processinfo.hThread <br />                  .ENDIF <br /><br /> where <br />format db '%lx',0 <br />buffer1   db 512 dup&#40;?&#41; <br />buffer2   dd 512 dup&#40;?&#41; <br />buffer3   dd 512 dup&#40;?&#41; <br />buf dd ?<br /></code></pre><br /><br />however, if i replace buffer2 with buffer21 which has a defined address <br />like this <br />buffer21 dd 401264h <br />and in writeprcessmemory addr buffer2 with buffer21 then it works .<br />but if i change it like addr buffer2 to addr buffer21 then it takes an adress<br />4030ba where buffer21 is stored.so i am bugged with this. if u have tried something like this earlier, please help<br />thank you once again<br />nickdigital</div>
    <div class="meta">Posted on 2004-10-05 02:58:09 by nickdigital</div>
   </div>
   <div class="post" id="post-150938">
    <div class="subject"><a href="#post-150938">WriteProcessMemory</a></div>
    <div class="body">look i dont know wtf you are trying to do but i can see 100 mistakes in less then a second.<br /><br />invoke WriteProcessMemory, processinfo.hProcess,addr buffer2,ADDR buffer3, 23, byteswritten <br /><br />1. processinfo.hProcess. great.<br />2. addr buffer2. you dont put the address of the variable. you put the actually memory address you want to change. so just buffer 2.<br />3. same as 2. if you have the pointer to buffer to be written in here, just push buffer 3. (not the address of bufffer 3 which hold the memory address)<br />4. 23. ok.<br />5. null optionaly. but if you are going to use this, do addr byteswritten, so it knows where to save number of bytes written. its not a telepathic compiler yet.<br /><br />invoke WriteProcessMemory, processinfo.hProcess, buffer2, buffer3, 23, addr byteswritten<br /><br />ok that should do it for that part. get a hold of your code with all the getdlgitem or whatever you are trying to do there its not so hard. hope you got all this understood and we will see whats your next error :)</div>
    <div class="meta">Posted on 2004-10-05 03:35:52 by pwn</div>
   </div>
   <div class="post" id="post-150945">
    <div class="subject"><a href="#post-150945">WriteProcessMemory</a></div>
    <div class="body">hi pwn<br />thanks for ur advice.but i feel u hv misunderstood me. <br />i know wat u are talking about and i also know that it is wrong.<br />please read the actual question which i am trying to ask in the first 2 posts<br />of this topic &quot;WriteProcessMemory&quot;<br />also you can have a look at &quot;general runtime patcher&quot; topic so tht u can get the actual idea of wat i am talking about.<br />anyway, thanks for replying.<br />nickdigital</div>
    <div class="meta">Posted on 2004-10-05 05:53:15 by nickdigital</div>
   </div>
  </div>
 </body>
</html>