<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>15+ min compile time....What the heck - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10062" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=10062">15+ min compile time....What the heck</a></p>
   <div class="post" id="post-75303">
    <div class="subject"><a href="#post-75303">15+ min compile time....What the heck</a></div>
    <div class="body">Ok, so I am working along on cleaning up a little fubar that I had in one of my include files (failed to remove some ; from struct / union names... Duh) and next thing I know is that when remove the offending ;'s from the below struct definition my compile times start to get very very very very slow and I was just wondering if anyone else out there has ran into this?<br /><br />Seems to me that either I have done something stupid (which would not be the first time, just ask my wife:grin:  or there is a bug in ML).<br /><br />Btw as a side note if I reduce the number of named nested structures by turning them into unamed structres then the compile time starts to speed up.<br /><br /><pre><code><br />IO_STACK_LOCATION Struct<br />   MajorFunction    BYTE    ?   ;+000h<br />   MinorFunction    BYTE    ?   ;+001h<br />   Flags            BYTE    ?   ;+002h<br />   Control          BYTE    ?   ;+003h<br /><br />   UNION Parameters<br /><br />    STRUCT _Create<br />      SecurityContext   pIO_SECURITY_CONTEXT            ?   ;+004h<br />      Options           DWORD                           ?   ;+008h<br />      FileAttributes    WORD                            ?   ;+00Ch<br />      ShareAccess       WORD                            ?   ;+00Eh<br />      EaLength          DWORD                           ?   ;+010h<br />    ENDS ; _Create<br /><br />    STRUCT _CreatePipe<br />      cpSecurityContext pIO_SECURITY_CONTEXT            ?   ;+004h<br />      cpOptions         DWORD                           ?   ;+008h<br />      cpReserved        WORD                            ?   ;+00Ch<br />      cpShareAccess     WORD                            ?   ;+00Eh<br />      Parameters        pNAMED_PIPE_CREATE_PARAMETERS   ?   ;+010h<br />    ENDS ; _CreatePipe<br /><br />    STRUCT _CreateMailslot<br />      cmSecurityContext pIO_SECURITY_CONTEXT            ?   ;+004h<br />      cmOptions         DWORD                           ?   ;+008h<br />      cmReserved        WORD                            ?   ;+00Ch<br />      cmShareAccess     WORD                            ?   ;+00Eh<br />      cmParameters      pMAILSLOT_CREATE_PARAMETERS     ?   ;+010h<br />    ENDS ; _CreateMailslot<br /><br />    STRUCT _Read<br />      rLength           DWORD                           ?   ;+004h<br />      rKey              DWORD                           ?   ;+008h<br />      rByteOffset       LARGE_INT                       &lt;&gt;  ;+00Ch<br />    ENDS ; _Read<br /><br />    STRUCT _Write<br />      wLength           DWORD                           ?   ;+004h<br />      wKey              DWORD                           ?   ;+008h<br />      wByteOffset       LARGE_INT                       &lt;&gt;  ;+00Ch<br />    ENDS ; _Write<br /><br />    STRUCT _QueryDirectory<br />      qdLength              DWORD                       ?   ;+004h<br />      FileName              pSTRING                     ?   ;+008h<br />      FileInformationClass  DWORD                       ?   ;+00Ch<br />      FileIndex             DWORD                       ?   ;+010h<br />    ENDS ; _QueryDirectory<br /><br />    STRUCT _NotifyDirectory<br />      ndLength          DWORD                           ?   ;+004h<br />      CompletionFilter  DWORD                           ?   ;+008h<br />    ENDS ; _NotifyDirectory<br /><br />    STRUCT _QueryFile<br />      qfLength                  DWORD                   ?   ;+004h<br />      qfFileInformationClass    DWORD                   ?   ;+008h<br />    ENDS ; _QueryFile<br /><br />    STRUCT _SetFile<br />      sfLength                  DWORD                   ?   ;+004h<br />      sfFileInformationClass    DWORD                   ?   ;+008h<br />      FileObject                pFILE_OBJECT            ?   ;+00Ch<br /><br />      UNION<br />        ReplaceIfExists       BYTE                      ?   ;+010h<br />        AdvanceOnly           BYTE                      ?   ;+011h<br /><br />        UNION<br />          ClusterCount        DWORD                     ?   ;+010h<br />          DeleteHandle        pVOID                     ?   ;+010h<br />        ENDS<br /><br />      ENDS<br /><br />    ENDS ; _SetFile<br /><br />    STRUCT _QueryEa<br />      qeLength      DWORD                               ?   ;+004h<br />      EaList        pVOID                               ?   ;+008h<br />      EaListLength  DWORD                               ?   ;+00Ch<br />      EaIndex       DWORD                               ?   ;+010h<br />    ENDS ; _QueryEa<br /><br />    STRUCT _SetEa<br />      seLength      DWORD                               ?   ;+004h<br />    ENDS ; _SetEa<br /><br />    STRUCT _QueryVolume<br />      qvLength              DWORD                       ?   ;+004h<br />      FsInformationClass    DWORD                       ?   ;+008h<br />    ENDS ; _QueryVolume<br /><br />    STRUCT _SetVolume<br />      svLength              DWORD                       ?   ;+004h<br />      svFsInformationClass  DWORD                       ?   ;+008h<br />    ENDS ; _SetVolume<br /><br />    STRUCT _FileSystemControl<br />      OutputBufferLength    DWORD                       ?   ;+004h<br />      InputBufferLength     DWORD                       ?   ;+008h<br />      FsControlCode         DWORD                       ?   ;+00Ch<br />     Type3InputBuffer      pVOID                       ?   ;+010h<br />    ENDS ; _FileSystemControl<br /><br />    STRUCT _LockControl<br />      lcLength      pLARGE_INT                          ?   ;+004h<br />      lcKey         DWORD                               ?   ;+008h<br />      lcByteOffset  LARGE_INT                           &lt;&gt;  ;+010h<br />    ENDS ; _LockControl<br /><br />    STRUCT _DeviceIoControl<br />      dicOutputBufferLength    DWORD                    ?   ;+004h<br />      dicInputBufferLength     DWORD                    ?   ;+008h<br />      dicIoControlCode         DWORD                    ?   ;+00Ch<br />      dicType3InputBuffer      pVOID                    ?   ;+010h<br />    ENDS ; _DeviceIoControl<br /><br />    STRUCT _QuerySecurity<br />      SecurityInformation   DWORD                       ?   ;+004h<br />      qsLength              DWORD                       ?   ;+008h<br />    ENDS ; _QuerySecurity<br /><br />    STRUCT _SetSecurity<br />      ssSecurityInformation DWORD                       ?   ;+004h<br />      ssSecurityDescriptor  pVOID                       ?   ;+008h<br />    ENDS ; _SetSecurity<br /><br />   STRUCT _MountVolume<br />      Vpb                   pVPB                        ?   ;+004h<br />      DeviceObject          pDEVICE_OBJECT              ?   ;+008h<br />    ENDS ; _MountVolume<br /><br />    STRUCT _VerifyVolume<br />      vvVpb                 pVPB                        ?   ;+004h<br />      vvDeviceObject        pDEVICE_OBJECT              ?   ;+008h<br />    ENDS ; _VerifyVolume<br /><br />    STRUCT _Scsi<br />      Srb                   DWORD                       ?   ;+004h<br />    ENDS ; _Scsi<br /><br />    STRUCT _QueryQuota<br />      qqLength              DWORD                       ?   ;+004h<br />      StartSid              pVOID                       ?   ;+008h<br />      SidList               pFILE_GET_QUOTA_INFORMATION ?   ;+00Ch<br />      SidListLength         DWORD                       ?   ;+010h<br />    ENDS ; _QueryQuota<br /><br />    STRUCT _SetQuota<br />      sqLength              DWORD                       ?   ;+004h<br />    ENDS ; _SetQuota<br /><br />    STRUCT _QueryDeviceRelations<br />      qdrType               DWORD                       ?   ;+004h<br />    ENDS ; _QueryDeviceRelations<br /><br />    STRUCT _QueryInterface<br />      InterfaceType         pGUID                       ?   ;+004h<br />      qiSize                WORD                        ?   ;+008h<br />      _Version              WORD                        ?   ;+00Ah<br />      Interface             pINTERFACE                  ?   ;+00Ch<br />      InterfaceSpecificData pVOID                       ?   ;+010h<br />    ENDS ; _QueryInterface<br /><br />    STRUCT _DeviceCapabilities<br />      Capabilities          pDEVICE_CAPABILITIES        ?   ;+004h<br />    ENDS ; _DeviceCapabilities<br /><br />    STRUCT _FilterResourceRequirements<br />      IoResourceRequirementList pIO_RESOURCE_REQUIREMENTS_LIST  ?;+004h<br />    ENDS ; _FilterResourceRequirements<br /><br />    STRUCT _ReadWriteConfig<br />      WhichSpace            DWORD                       ?   ;+004h<br />      Buffer                pVOID                       ?   ;+008h<br />      rwcOffset             DWORD                       ?   ;+00Ch<br />      rwcLength             DWORD                       ?   ;+010h<br />    ENDS ; _ReadWriteConfig<br /><br />    STRUCT _SetLock<br />      slLock                BYTE                        ?   ;+004h<br />    ENDS ; _SetLock<br /><br />    STRUCT _QueryId<br />      IdType                DWORD                       ?   ;+004h<br />    ENDS ; _QueryId<br /><br />    STRUCT _QueryDeviceText<br />      DeviceTextType        DWORD                       ?   ;+004h<br />      LocaleId              DWORD                       ?   ;+008h<br />    ENDS ; _QueryDeviceText<br /><br />    STRUCT _UsageNotification<br />      InPath                BYTE                        ?   ;+004h<br />      _Reserved             BYTE 3 DUP                 &#40;?&#41;  ;+005h<br />      unType                DWORD                       ?   ;+008h<br />    ENDS ; _UsageNotification<br /><br />    STRUCT _WaitWake<br />      PowerState            DWORD                       ?   ;+004h<br />    ENDS ; _WaitWake<br /><br />    STRUCT _PowerSequence<br />      PowerSequence         pPOWER_SEQUENCE             ?   ;+004h<br />    ENDS ; _PowerSequence<br /><br />    STRUCT _Power<br />      SystemContext         DWORD                       ?   ;+004h<br />      pType                 DWORD                       ?   ;+008h<br />      State                 POWER_STATE                &lt;&gt;   ;+00Ch<br />      ShutdownType          DWORD                       ?   ;+010h<br />    ENDS ; _Power<br /><br />    STRUCT _StartDevice<br />      AllocatedResources            pCM_RESOURCE_LIST   ?   ;+004h<br />      AllocatedResourcesTranslated  pCM_RESOURCE_LIST   ?   ;+008h<br />    ENDS ; _StartDevice<br /><br />    STRUCT _WMI<br />      ProviderId            DWORD                       ?   ;+004h<br />      DataPath              pVOID                       ?   ;+008h<br />      BufferSize            DWORD                       ?   ;+00Ch<br />      wmiBuffer             pVOID                       ?   ;+010h<br />    ENDS ; _WMI<br /><br />    STRUCT _Others<br />      Argument1             pVOID                       ?   ;+004h<br />      Argument2             pVOID                       ?   ;+008h<br />      Argument3             pVOID                       ?   ;+00Ch<br />      Argument4             pVOID                       ?   ;+010h<br />    ENDS ; _Others<br /><br />   ENDS<br /><br />   islDeviceObject          pDEVICE_OBJECT              ?   ;+014h<br />   islFileObject            pFILE_OBJECT                ?   ;+018h<br />   CompletionRoutine        pFunction                   ?   ;+01Ch<br />   Context                  pVOID                       ?   ;+020h<br />IO_STACK_LOCATION ENDS<br /></code></pre></div>
    <div class="meta">Posted on 2003-01-09 14:50:16 by madprgmr</div>
   </div>
   <div class="post" id="post-75307">
    <div class="subject"><a href="#post-75307">15+ min compile time....What the heck</a></div>
    <div class="body">:eek: BLOAT BLOAT BLOAT!<br /><br />Hello,<br /><br />In assembler we have very few types of data, as you well know: byte, word, dword, and pointers, wich are the same ones, but treated differently.<br /><br />I think this would only be usefull to you if it is really the labels that are slowing down your compiling time. ;)<br /><br />Since your project seems to be very big, you need many structures. <br /><br /><span style="font-size:9px>I thought of that just now, so don't flame me if it is really really stupid. :o</span><br /><br />Wouldn't it work if you &quot;blended&quot; together some equal structures?<br />You know that many types of data are in reality just DWORDs (the most common for us, now) So when you have structures with the same quantity of data, and this data is each one, in order, the same size, IMHO, you could treat both of them as each one, no matter wich, without any errors or anything, right?<br /><br />Let me know why it would be stupid to do so, if so... :)<br /><br />Regards,<br /><br />Wicr0s0ft</div>
    <div class="meta">Posted on 2003-01-09 15:18:09 by wicr0s0ft</div>
   </div>
   <div class="post" id="post-75310">
    <div class="subject"><a href="#post-75310">15+ min compile time....What the heck</a></div>
    <div class="body">Hi,<br /><br />I don't know if this is actually a problem, but my MASM Reference says:<br /><br />  Syntax:   name STRUCT  [, NONUNIQUE]<br />                    fielddeclarations<br />                name ENDS<br /><br />You seem to use something else..<br />IO_STACK_LOCATION Struct &amp; STRUCT _Create</div>
    <div class="meta">Posted on 2003-01-09 15:41:28 by Guerrilla</div>
   </div>
   <div class="post" id="post-75323">
    <div class="subject"><a href="#post-75323">15+ min compile time....What the heck</a></div>
    <div class="body">madprgmr,<br /><br />I have seen the situation where large amounts of data in the uninitialised data section makes ML slow but the quantity of data you have in the structures and unions probably does not ad up to all that much.<br /><br />Where I have tried it the data usually has to be over 200k or so before it really starts to slow things down.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-01-09 17:08:31 by hutch--</div>
   </div>
   <div class="post" id="post-75328">
    <div class="subject"><a href="#post-75328">15+ min compile time....What the heck</a></div>
    <div class="body">Are you trying to define an array of IO_STACK_LOCATION structures?<br /><br />MASM (in COFF mode) is known to be slow in creating large arrays -- even if doesn't contain any data! One possibility is to assemble in OMF mode, and then let the linker automatically invoke the OMF-&gt;COFF converter.<br /><br />It would also be nice if you could simply say<br /><br />ORG $+arraysize ; skip arraysize bytes<br /><br />to allocate it quickly.<br /><br />And since you cannot use any of the Win32 Alloc functions in a driver, you may want to use the kernel allocator functions: ExAllocatePool and ExFreePool. The extra headache is that you must ensure the pool is freed when needed under any (including error) conditions, as there is no background system to recover from memory leaks.<br /><br />If you want to avoid the headaches and allocate statically, and the assembly time is too annoying -- put the array in a separate ASM module and use externdef (?) to link it to the other ASM code. You'll only need to recreate the array when you change the number of entries (assuming the size of IO_STACK_LOCATION is correct).</div>
    <div class="meta">Posted on 2003-01-09 17:46:23 by tenkey</div>
   </div>
  </div>
 </body>
</html>