<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Hlls error - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10147" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=10147">Hlls error</a></p>
   <div class="post" id="post-76032">
    <div class="subject"><a href="#post-76032">Hlls error</a></div>
    <div class="body">Hi ! :) <br /><br />Fasmw 14_4<br /><pre><code><br />.if condition <br />    code<br />.elseif condition<br />    code<br />.elseif condition<br />    code<br />.else <br />    code<br />.endif <br />OK no problem<br /></code></pre><br />But if..<br /><pre><code><br />.if condition <br />    code<br />    .if condition<br />        code<br />    .elseif condition  ; &lt;==== ERROR MESSAGE IF.INC<br />        code<br />    .else <br />        code<br />    .endif<br />.elseif condition<br />    code<br />.elseif condition<br />    code<br />.else <br />    code<br />.endif <br /></code></pre><br />Friendly......Gges</div>
    <div class="meta">Posted on 2003-01-13 08:06:32 by Asmgges</div>
   </div>
   <div class="post" id="post-76034">
    <div class="subject"><a href="#post-76034">Hlls error</a></div>
    <div class="body">Sorry, but I wasn't able to reproduce that error. Please send the complete source.</div>
    <div class="meta">Posted on 2003-01-13 08:23:31 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-76035">
    <div class="subject"><a href="#post-76035">Hlls error</a></div>
    <div class="body">Hi Tomasz :) <br /><br /><pre><code><br />; Simple text editor - fasm example program<br /><br />format PE GUI 4.0<br />entry start<br /><br />include 'include\win32a.inc'<br />include 'include\macro\if.inc'<br /><br />IDM_NEW   = 101<br />IDM_EXIT  = 102<br />IDM_ABOUT = 901<br /><br />section '.data' data readable writeable<br /><br />  _class db 'MINIPAD32',0<br />  _edit db 'EDIT',0<br /><br />  _title db 'MiniPad',0<br />  _about_title db 'A propos de MiniPad',0<br />  _about_text db &quot;C'est un exemple Win32Asm cr?e avec Fasm.&quot;,0<br /><br />  hinstance dd ?<br />  edithwnd dd ?<br />  editfont dd ?<br /><br />  msg MSG<br />  wc WNDCLASS<br />  client RECT<br /><br />section '.code' code readable executable<br /><br />  start&#58;<br /><br />        invoke  GetModuleHandle,0<br />        mov     &#91;hinstance&#93;,eax<br />        invoke  LoadIcon,eax,17<br />        mov     &#91;wc.hIcon&#93;,eax<br />        invoke  LoadCursor,0,IDC_ARROW<br />        mov     &#91;wc.hCursor&#93;,eax<br />        mov     &#91;wc.style&#93;,0<br />        mov     &#91;wc.lpfnWndProc&#93;,WindowProc<br />        mov     &#91;wc.cbClsExtra&#93;,0<br />        mov     &#91;wc.cbWndExtra&#93;,0<br />        mov     eax,&#91;hinstance&#93;<br />        mov     &#91;wc.hInstance&#93;,eax<br />        mov     &#91;wc.hbrBackground&#93;,COLOR_WINDOW+1<br />        mov     &#91;wc.lpszMenuName&#93;,0<br />        mov     &#91;wc.lpszClassName&#93;,_class<br />        invoke  RegisterClass,wc<br /><br />        invoke  LoadMenu,&#91;hinstance&#93;,37<br />        invoke  CreateWindowEx,0,_class,_title,WS_VISIBLE+WS_OVERLAPPEDWINDOW,144,128,256,256,NULL,eax,&#91;hinstance&#93;,NULL<br /><br />  msg_loop&#58;<br />        invoke  GetMessage,msg,NULL,0,0<br />        or      eax,eax<br />        jz      end_loop<br />        invoke  TranslateMessage,msg<br />        invoke  DispatchMessage,msg<br /><br />        jmp     msg_loop<br /><br />  end_loop&#58;<br />        invoke  ExitProcess,&#91;msg.wParam&#93;<br /><br />proc WindowProc, hwnd, wmsg, wparam, lparam<br />    enter<br />    push    ebx esi edi<br />    .if &#91;wmsg&#93;,e,WM_CREATE<br />        invoke  GetClientRect,&#91;hwnd&#93;,client<br />        invoke  CreateWindowEx,WS_EX_CLIENTEDGE,_edit,0,WS_VISIBLE+WS_CHILD+WS_HSCROLL+\<br />                               WS_VSCROLL+ES_AUTOHSCROLL+ES_AUTOVSCROLL+ES_MULTILINE,\<br />                               &#91;client.left&#93;,&#91;client.top&#93;,&#91;client.right&#93;,&#91;client.bottom&#93;,\<br />                               &#91;hwnd&#93;,0,&#91;hinstance&#93;,NULL<br />        mov     &#91;edithwnd&#93;,eax<br />        invoke  CreateFont,16,0,0,0,0,FALSE,FALSE,FALSE,ANSI_CHARSET,OUT_RASTER_PRECIS,\<br />                           CLIP_DEFAULT_PRECIS,DEFAULT_QUALITY,FIXED_PITCH+FF_DONTCARE,NULL<br />        mov     &#91;editfont&#93;,eax<br />        invoke  SendMessage,&#91;edithwnd&#93;,WM_SETFONT,eax,FALSE<br />        xor     eax,eax<br />    .elseif &#91;wmsg&#93;,e,WM_SIZE<br />        invoke  GetClientRect,&#91;hwnd&#93;,client<br />        invoke  MoveWindow,&#91;edithwnd&#93;,&#91;client.left&#93;,&#91;client.top&#93;,&#91;client.right&#93;,\<br />                           &#91;client.bottom&#93;,TRUE<br />    .elseif &#91;wmsg&#93;,e,WM_SETFOCUS<br />        invoke  SetFocus,&#91;edithwnd&#93;<br />    .elseif &#91;wmsg&#93;,e,WM_COMMAND<br />        mov     eax,&#91;wparam&#93;<br />        and     eax,0FFFFh<br />        .if eax,e,IDM_NEW<br />            invoke  SendMessage,&#91;edithwnd&#93;,WM_SETTEXT,0,0<br />        .elseif   eax,e,IDM_ABOUT               ; &lt;================= ERROR<br />            invoke  MessageBox,&#91;hwnd&#93;,_about_text,_about_title,MB_OK<br />        .elseif   eax,e,IDM_EXIT<br />            jmp     wmdestroy<br />        .endif<br />     .elseif &#91;wmsg&#93;,e,WM_DESTROY<br /><br />  wmdestroy&#58;<br />        invoke  DeleteObject,&#91;editfont&#93;<br />        invoke  PostQuitMessage,0<br />        xor     eax,eax<br />    .else<br /><br />        defwndproc&#58;<br />        invoke  DefWindowProc,&#91;hwnd&#93;,&#91;wmsg&#93;,&#91;wparam&#93;,&#91;lparam&#93;<br />    .endif<br /><br />  finish&#58;<br />        pop     edi esi ebx<br />        return<br /><br />section '.idata' import data readable writeable<br /><br />  library kernel,'KERNEL32.DLL',\<br />          user,'USER32.DLL',\<br />          gdi,'GDI32.DLL'<br /><br />  import kernel,\<br />         GetModuleHandle,'GetModuleHandleA',\<br />         ExitProcess,'ExitProcess'<br /><br />  import user,\<br />         RegisterClass,'RegisterClassA',\<br />         CreateWindowEx,'CreateWindowExA',\<br />         DefWindowProc,'DefWindowProcA',\<br />         SetWindowLong,'SetWindowLongA',\<br />         RedrawWindow,'RedrawWindow',\<br />         GetMessage,'GetMessageA',\<br />         TranslateMessage,'TranslateMessage',\<br />         DispatchMessage,'DispatchMessageA',\<br />         SendMessage,'SendMessageA',\<br />         LoadCursor,'LoadCursorA',\<br />         LoadIcon,'LoadIconA',\<br />         LoadMenu,'LoadMenuA',\<br />         GetClientRect,'GetClientRect',\<br />         MoveWindow,'MoveWindow',\<br />         SetFocus,'SetFocus',\<br />         MessageBox,'MessageBoxA',\<br />         PostQuitMessage,'PostQuitMessage'<br /><br />  import gdi,\<br />         CreateFont,'CreateFontA',\<br />         DeleteObject,'DeleteObject'<br /><br />section '.rsrc' resource data readable<br /><br />  ; resource directory<br /><br />  directory RT_MENU,menus,\<br />            RT_ICON,icons,\<br />            RT_GROUP_ICON,group_icons,\<br />            RT_VERSION,versions<br /><br />  ; resource subdirectories<br /><br />  resource menus,\<br />           37,LANG_ENGLISH+SUBLANG_DEFAULT,main_menu<br /><br />  resource icons,\<br />           1,LANG_NEUTRAL,icon_data<br /><br />  resource group_icons,\<br />           17,LANG_NEUTRAL,main_icon<br /><br />  resource versions,\<br />           1,LANG_NEUTRAL,version_info<br /><br />  menu main_menu<br />       menuitem '&amp;Fichier',0,MFR_POPUP<br />                menuitem '&amp;Nouveau',IDM_NEW,0<br />                menuseparator<br />                menuitem '&amp;Quitter',IDM_EXIT,MFR_END<br />       menuitem '&amp;Aide',0,MFR_POPUP + MFR_END<br />                menuitem 'A &amp;propos...',IDM_ABOUT,MFR_END<br /><br />  icon main_icon,icon_data,'minipad.ico'<br /><br />  version version_info,VOS__WINDOWS32,VFT_APP,VFT2_UNKNOWN,LANG_ENGLISH+SUBLANG_DEFAULT,0,\<br />          'FileDescription','MiniPad - example program',\<br />          'LegalCopyright','No rights reserved.',\<br />          'FileVersion','1.0',\<br />          'ProductVersion','1.0',\<br />          'OriginalFilename','MINIPAD.EXE'<br />                                                    <br /></code></pre><br />But it works with an old version of if...<br /><pre><code><br />macro .if v1,c,v2<br />    &#123;<br />      __IF equ<br />      local ..endif<br />      __ENDIF equ ..endif<br />      local ..else<br />      __ELSE equ ..else<br />      cmp v1,v2<br />      jn#c __ELSE<br />    &#125;<br />macro .else<br />    &#123;<br />      jmp __ENDIF<br />      __ELSE&#58;<br />      restore __IF<br />      __IF equ ,<br />    &#125;<br />macro .elseif v1,c,v2<br />    &#123;<br />      local ..else_new<br />      jmp __ENDIF<br />      __ELSE&#58;<br />      restore __ELSE<br />      __ELSE equ ..else_new<br />      cmp v1,v2<br />      jn#c __ELSE<br />    &#125;<br />macro .endif<br />    &#123;<br />      if __IF eq<br />      __ELSE&#58;<br />      end if<br />      __ENDIF&#58;<br />      restore __ELSE<br />      restore __ENDIF<br />      restore __IF<br />    &#125;                     <br /></code></pre><br />Friendly......Gges</div>
    <div class="meta">Posted on 2003-01-13 08:44:48 by Asmgges</div>
   </div>
   <div class="post" id="post-76037">
    <div class="subject"><a href="#post-76037">Hlls error</a></div>
    <div class="body"><pre><code><br />        .if eax,e,IDM_NEW<br />            invoke  SendMessage,&#91;edithwnd&#93;,WM_SETTEXT,0,0<br />        .elseif   eax,e,IDM_ABOUT               ; &lt;================= ERROR<br />            invoke  MessageBox,&#91;hwnd&#93;,_about_text,_about_title,MB_OK<br />        .elseif   eax,e,IDM_EXIT<br />            jmp     wmdestroy<br />        .endif<br />     .elseif &#91;wmsg&#93;,e,WM_DESTROY<br /><br /></code></pre><br /><br />When the first IF is true, eax gets modified by the SendMessage call... that could cause a failure of the next ELSEIF (because it compares with the changed eax now). Try to use another register or push/pop eax before/after that SendMessage call. Just a guess,  I cant try it out now.</div>
    <div class="meta">Posted on 2003-01-13 08:48:11 by bazik</div>
   </div>
   <div class="post" id="post-76040">
    <div class="subject"><a href="#post-76040">Hlls error</a></div>
    <div class="body">Hi! Bazik :) <br />Thank you for the attempt<br />But the change of register does not make anything more<br />Problem has to be in the macro elseif.<br />Friendly....Gges</div>
    <div class="meta">Posted on 2003-01-13 09:05:30 by Asmgges</div>
   </div>
   <div class="post" id="post-76044">
    <div class="subject"><a href="#post-76044">Hlls error</a></div>
    <div class="body">Now I see...<br />The problem is in the &quot;.elseif&quot; macro, you should remove the last two lines from its definition. I'm updating it in the fasmw144.zip package, thanks for the report!</div>
    <div class="meta">Posted on 2003-01-13 09:31:49 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-76045">
    <div class="subject"><a href="#post-76045">Hlls error</a></div>
    <div class="body">OK :alright: <br />Everything is well now<br />Thank you<br />Friendly.......Gges</div>
    <div class="meta">Posted on 2003-01-13 09:40:06 by Asmgges</div>
   </div>
  </div>
 </body>
</html>