<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>NASM to EXE  no linker - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17117" />
    <link rel="next" href="../?id=17117&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=17117">NASM to EXE  no linker</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=17117&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=17117&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="17117" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=17117&amp;page=2">&gt;</a><a href="../?id=17117&amp;page=2">&raquo;</a></form>   <div class="post" id="post-132777">
    <div class="subject"><a href="#post-132777">NASM to EXE  no linker</a></div>
    <div class="body">%include &quot;\lab\vasm\inc\nagoa.inc&quot;<br /><br /><br /><br /><br />BEGIN_PE DEFAULT  ; --- Add the PE header <br /><br /><br />code:<br />nasm GetModuleHandleA,0<br />loccall WinMain,eax<br /><br /><br />proc WinMain,hInstance<br /><br />stack msgs,MSG_size<br />stack hWnd,4<br />stack WC, WNDCLASSEX_size<br /><br /><br />        nasm RtlZeroMemory,ADDR_ WC,WNDCLASSEX_size<br />        mov dword ,WNDCLASSEX_size<br />        mov dword ,CS_VREDRAW + CS_HREDRAW + CS_DBLCLKS<br />        mov dword ,WndProc+reloc<br />        mov dword ,15<br />        mov dword  ,ClassName+reloc<br />        m2m   ,<br />        nasm LoadIconA,,IDI_APPLICATION<br />        mov  , eax<br />	mov  , eax <br />        nasm LoadCursorA,,IDC_ARROW<br />        mov     , eax<br />        nasm  RegisterClassExA,ADDR_ WC<br /><br />        nasm CreateWindowExA, WS_EX_WINDOWEDGE + WS_EX_CLIENTEDGE,\<br />                                address ClassName,address WindowName,\<br />                                WS_OVERLAPPEDWINDOW,200,\<br />                                200,200, 200,\<br />                                NULL,NULL,,NULL<br /><br />       nasm ShowWindow,eax,TRUE<br />       nasm UpdateWindow,0<br /><br />       ; --- Get Messages User imput Lopp  (-:<br /><br />msg_loop:<br />    <br />        nasm GetMessageA,ADDR_ msgs ,0,0,0<br />        or      eax,eax<br />        jz      Fin_Bucle			<br />        nasm DispatchMessageA, ADDR_ msgs<br />        jmp     msg_loop<br /><br />Fin_Bucle:<br />	nasm	ExitProcess,0<br />endproc<br /><br /><br /><br />; ========================<br />; Procedimiento de ventana<br />; ========================<br /><br />proc WndProc, hwnd, msg, wParam, lParam<br /><br />stack hdc,4<br />stack rect,RECT_size<br />stack ps,PAINTSTRUCT_size<br /><br />	mov	eax, <br />        cmp     eax, WM_PAINT<br />        je      .WM_PAINT<br />        cmp   eax, WM_DESTROY<br />        je      .WM_DESTROY<br />        nasm DefWindowProcA,,,,<br />	return<br /><br />.WM_PAINT:<br />  <br />  <br />        nasm  BeginPaint,,ADDR_ ps ;eax<br />        mov     ,eax<br />        nasm    GetClientRect,,ADDR_ rect  <br />      <br />        nasm DrawTextA,,&quot;Hi everybody!!!&quot;,\<br />                                        -1,ADDR_ rect ,\<br />                                         DT_SINGLELINE + DT_CENTER + DT_VCENTER<br />      <br />        nasm EndPaint, ,ADDR_ ps<br />        return<br /><br />.WM_DESTROY:<br />        nasm PostQuitMessage,0<br />endproc<br /><br /><br /><br />;--------------- [ DATA ]<br /><br />_DATA_<br /><br />ClassName db &quot;NAGOA&quot;,0<br />WindowName db &quot;Window written in assembly (using only NASM)&quot;,0<br /><br /><br />; ------------ [ IMPORTS ]<br /><br />MODULES<br />	LIB kernel32.dll, &quot;kernel32.dll&quot;<br />	LIB user32.dll, &quot;user32.dll&quot;<br />ENDM<br /><br /><br />BEGIN_IMPORT kernel32.dll<br />	__api_  GetModuleHandleA, ExitProcess,RtlZeroMemory<br />	_IMPORT GetModuleHandleA, &quot;GetModuleHandleA&quot;, 0, ExitProcess, &quot;ExitProcess&quot;,0,RtlZeroMemory,&quot;RtlZeroMemory&quot;, 0<br />	 <br />END_IMPORT<br /><br /><br />BEGIN_IMPORT user32.dll<br />	__api_  MessageBoxA, LoadIconA, LoadCursorA, RegisterClassExA<br />	__api_	CreateWindowExA, ShowWindow, GetMessageA, DispatchMessageA<br />	__api_	DefWindowProcA, BeginPaint, GetClientRect, EndPaint<br />	__api_	DrawTextA, PostQuitMessage, UpdateWindow<br /><br />	_IMPORT MessageBoxA, &quot;MessageBoxA&quot;, 0, LoadIconA, &quot;LoadIconA&quot;, 0<br />	_IMPORT LoadCursorA, &quot;LoadCursorA&quot;, 0, RegisterClassExA, &quot;RegisterClassExA&quot;, 0<br />	_IMPORT CreateWindowExA, &quot;CreateWindowExA&quot;, 0, ShowWindow, &quot;ShowWindow&quot;, 0<br />	_IMPORT	GetMessageA, &quot;GetMessageA&quot;, 0, DispatchMessageA, &quot;DispatchMessageA&quot;, 0<br />	_IMPORT	DefWindowProcA, &quot;DefWindowProcA&quot;, 0, BeginPaint, &quot;BeginPaint&quot;, 0<br />	_IMPORT	GetClientRect, &quot;GetClientRect&quot;, 0, EndPaint, &quot;EndPaint&quot;, 0<br />	_IMPORT	DrawTextA, &quot;DrawTextA&quot;, 0, PostQuitMessage, &quot;PostQuitMessage&quot;, 0<br />	_IMPORT UpdateWindow, &quot;UpdateWindow&quot;, 0<br />END_IMPORT<br /><br />END_PE<br />;------------ [ end of exe ]<br /><br />only 1,50 KB  exe <br /><br />a painted window <br /><br /><br />this is the new nagoa.inc !!!<br /><br /><a target="_blank" href="http://visual-assembler.pt.vu">http://visual-assembler.pt.vu</a><br /><br />or<br /><br /><a target="_blank" href="http://groups.yahoo.com/group/win32-nasm-users/">http://groups.yahoo.com/group/win32-nasm-users/</a></div>
    <div class="meta">Posted on 2004-02-06 14:46:28 by Nguga</div>
   </div>
   <div class="post" id="post-132948">
    <div class="subject"><a href="#post-132948">NASM to EXE  no linker</a></div>
    <div class="body">Hi nguga:<br /><br />With the last PEMAC.INC now for the imports you can do:<br /><br /><pre><code><br />__LIBS_ kernel32,		&quot;kernel32.dll&quot;,	\<br />	user32,		&quot;user32.dll&quot;<br /><br /><br />__IMPORT_ kernel32, \<br />	GetModuleHandle, 	&quot;GetModuleHandleA&quot;, 		0, \<br />	ExitProcess,    	&quot;ExitProcess&quot;,    		0, \<br />	ZeroMemory,		&quot;RtlZeroMemory&quot;, 		0<br /><br />__IMPORT_ user32, \<br />	MessageBox,      	&quot;MessageBoxA&quot;,     		0, \<br />	LoadCursor,      	&quot;LoadCursorA&quot;,     		0, \<br />	RegisterClassEx,  	&quot;RegisterClassExA&quot;,  		0, \<br />	CreateWindowEx,  	&quot;CreateWindowExA&quot;, 		0, \<br />	ShowWindow,       	&quot;ShowWindow&quot;, 			0, \<br />	GetMessage,      	&quot;GetMessageA&quot;,     		0, \<br />	DispatchMessage,  	&quot;DispatchMessageA&quot;,  		0, \<br />	DefWindowProc,   	&quot;DefWindowProcA&quot;,  		0, \<br />	PostQuitMessage,  	&quot;PostQuitMessage&quot;,   		0, \<br />	TranslateMessage, 	&quot;TranslateMessage&quot;,  		0, \<br />	LoadIcon,	 	&quot;LoadIconA&quot;,       		0<br /><br /></code></pre><br /><br />You can specify the ordinal where is the zero.<br /><br />With the next version you won't need neither &quot;reloc&quot; nor &quot;nasm&quot; macro instructions.<br /><br />Try it:<br /><a target="_blank" href="http://mipagina.cantv.net/numator/PEMAC.zip">http://mipagina.cantv.net/numator/PEMAC.zip</a><br /><br />greetings<br />nmt</div>
    <div class="meta">Posted on 2004-02-08 19:58:18 by n u M I T_o r</div>
   </div>
   <div class="post" id="post-132961">
    <div class="subject"><a href="#post-132961">NASM to EXE  no linker</a></div>
    <div class="body">Look at this sample:<br /><br /><a target="_blank" href="http://mipagina.cantv.net/numator/NPEMAC.zip">http://mipagina.cantv.net/numator/NPEMAC.zip</a><br /><br />Neither &quot;reloc&quot; nor &quot;nasm&quot; macro instructions.</div>
    <div class="meta">Posted on 2004-02-08 22:46:06 by n u M I T_o r</div>
   </div>
   <div class="post" id="post-132962">
    <div class="subject"><a href="#post-132962">NASM to EXE  no linker</a></div>
    <div class="body">the sflat_pe is treated as a virus :-s<br />interesante informacion n u M I T_o r</div>
    <div class="meta">Posted on 2004-02-08 22:47:35 by Jnrz</div>
   </div>
   <div class="post" id="post-132991">
    <div class="subject"><a href="#post-132991">NASM to EXE  no linker</a></div>
    <div class="body">&gt; the sflat_pe is treated as a virus :-s<br /><br />Yes. This is when the import info is in the header. A<br />friend sended me a lot of similar examples<br />and happened the same. Possibly by chance the Bloodhound<br />virus has also the import info in the header :), but I have seen<br />some pe files where this does not happen. Anyway, I must not<br />try to explain here how avoid this :). One day I'll try to know why<br />this.</div>
    <div class="meta">Posted on 2004-02-09 06:27:47 by n u M I T_o r</div>
   </div>
   <div class="post" id="post-133090">
    <div class="subject"><a href="#post-133090">NASM to EXE  no linker</a></div>
    <div class="body">weel heheh for new people this posts must think that we are MAD lol<br /><br />well NAGOA = NASM GORC ALINK<br /><br />and that is great :)<br /><br /><br />but nuMIT_or is just a MAD :)<br /><br /><br />and he wants only NASM  ! no linker nor resource builder !<br /><br /><br />and exe is so litle man ! ;)<br /><br /><br /><br />thats great thing !<br /><br /><br /><br /><br /><br /><br /><br />for me i made this macros here an example , soon i will post this new nagoa.inc  , for ONLY NASM ;)<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />; -- --------------- FILE -----------------------<br />%include &quot;\lab\vasm\inc\nagoa.inc&quot;<br /> <br /><br />BEGIN_PE DEFAULT  ; --- Add the PE header <br /><br />data:<br /><br />var_   hInst ,   dd 0<br /><br />ClassName   db &quot;NaGoA&quot; , 0<br />WindowName  db &quot; only NASM no linker ! &quot; ,0<br /><br /><br />code:<br /><br />nasm GetModuleHandleA,0<br />mov ,eax<br />loccall WinMain,<br /><br /><br />proc WinMain,hInstance<br /><br />stack msgs,MSG_size<br />stack hWnd,4<br />stack WC, WNDCLASSEX_size<br /><br /><br />        nasm RtlZeroMemory,ADDR_ WC,WNDCLASSEX_size<br />        mov dword ,WNDCLASSEX_size<br />        mov dword ,CS_VREDRAW + CS_HREDRAW + CS_DBLCLKS<br />        mov dword ,addr WndProc<br />        mov dword ,15<br />        mov dword  , addr ClassName<br />        m2m   ,<br />        nasm LoadIconA,,IDI_APPLICATION<br />        mov  , eax<br />	mov  , eax <br />        nasm LoadCursorA,,IDC_ARROW<br />        mov  , eax<br />        nasm  RegisterClassExA, ADDR_ WC<br /><br />        nasm CreateWindowExA, WS_EX_WINDOWEDGE + WS_EX_CLIENTEDGE,\<br />                                addr ClassName,addr WindowName,\<br />                                WS_OVERLAPPEDWINDOW,200,\<br />                                200,200, 200,\<br />                                NULL,NULL,,NULL<br /><br />       nasm ShowWindow,eax,TRUE<br />       nasm UpdateWindow,0<br /><br />msg_loop:<br />            <br />        nasm GetMessageA,ADDR_ msgs ,0,0,0<br />        or      eax,eax<br />        jz      Fin_Bucle			<br />        nasm DispatchMessageA, ADDR_ msgs<br />        jmp     msg_loop<br /><br />Fin_Bucle:<br />	nasm	ExitProcess,0<br />endproc<br /><br />proc WndProc, hwnd, msg, wParam, lParam<br /><br />stack hdc,4<br />stack rect,RECT_size<br />stack ps,PAINTSTRUCT_size<br /><br />	mov	eax, <br />        cmp     eax, WM_PAINT<br />        je      .WM_PAINT<br />        cmp   eax, WM_DESTROY<br />        je      .WM_DESTROY<br />        nasm DefWindowProcA,,,,<br />	return<br /><br />.WM_PAINT:<br />  <br />  <br />        nasm  BeginPaint,,ADDR_ ps ;eax<br />        mov     ,eax<br />        nasm    GetClientRect,,ADDR_ rect  <br />      <br />        nasm DrawTextA,,&quot;Hi everybody!!!&quot;,\<br />                                        -1,ADDR_ rect ,\<br />                                         DT_SINGLELINE + DT_CENTER + DT_VCENTER<br />      <br />        nasm EndPaint, ,ADDR_ ps<br />        return<br /><br />.WM_DESTROY:<br />        nasm PostQuitMessage,0<br />endproc<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />; ------------ [ IMPORTS ]<br /><br /><br />__LIBS_  kernel32,		&quot;kernel32.dll&quot;,	\<br />	    user32,			&quot;user32.dll&quot;<br /><br />__IMPORT_ kernel32, \<br />	GetModuleHandleA, &quot;GetModuleHandleA&quot;, 0, \<br />	ExitProcess, &quot;ExitProcess&quot;, 0,\<br />        RtlZeroMemory,&quot;RtlZeroMemory&quot;,0<br /><br />__IMPORT_ user32, \<br />	MessageBox, &quot;MessageBoxA&quot;, 0, 		LoadIconA, &quot;LoadIconA&quot;, 0, \<br />	LoadCursorA, &quot;LoadCursorA&quot;, 0,		RegisterClassExA, &quot;RegisterClassExA&quot;, 0, \<br />	CreateWindowExA, &quot;CreateWindowExA&quot;, 0, 	ShowWindow, &quot;ShowWindow&quot;, 0, \<br />	GetMessageA, &quot;GetMessageA&quot;, 0, 		DispatchMessageA, &quot;DispatchMessageA&quot;, 0 ,\<br />	DefWindowProcA, &quot;DefWindowProcA&quot;, 0, 	BeginPaint, &quot;BeginPaint&quot;, 0, \<br />	GetClientRect, &quot;GetClientRect&quot;, 0, 	EndPaint, &quot;EndPaint&quot;, 0, \<br />	DrawTextA, &quot;DrawTextA&quot;, 0, 		PostQuitMessage, &quot;PostQuitMessage&quot;, 0, \<br />	UpdateWindow, &quot;UpdateWindow&quot;, 0, 	GetWindowRect, &quot;GetWindowRect&quot;, 0, \<br />	GetDesktopWindow, &quot;GetDesktopWindow&quot;, 0, MoveWindow, &quot;MoveWindow&quot;, 0<br /><br /><br />END_PE<br />;------------ [ end of exe ]<br /><br /><br /><br />;-------------      END FILE -------------<br /><br /><br /><br />exe is only  1,50 KB  :)<br /><br /><br /><br /><br /><br />well i prefer *nasm*   to call only nasm becouse<br />i will se right way its only nasm !<br /><br />and prefer <br /><br />nasm MessageBoxA,0,addr szMessage , &quot; title Nasm Rocks ! &quot; , 0<br /><br /><br />mov eax, addr szMessage <br /><br />lol know i see masm addr lol<br /><br /><br /><br />and prefer when a var is declared using stack<br /><br /><br />stack Buffer , 120   ; 120 bytes buffer<br /><br />or <br /><br />; ps is size of PAINTSTRUCT<br /><br />stack ps,PAINTSTRUCT_size   <br /><br /><br />and then using ADDR_ macro <br /><br />&quot;<br />lea eax,<br />push eax <br /><br />&quot;<br /><br />is   <br /><br />nasm  BeginPaint,,ADDR_ ps<br /><br /><br />i do not see any logic making<br /><br />nasm  BeginPaint,,ADDR_ <br /><br />[ ] here does not make logic :)<br /><br /><br />LEA, despite its syntax, does not access memory<br />it stores the calculated address into the register<br /><br />ps is a pointing  to the first element of  PAINTSTRUCT .  it can be seen as a label by logic :)<br /><br /><br /><br />its way a like more <br />nasm  BeginPaint,,ADDR_ ps<br /><br /><br />for ADDR_ macro<br /><br /><br />nuMIT_or :)<br />THANKS VERY MUCH FOR YOUR PEMAC MACROS !!!<br /><br />GRACIAS <br /><br />Nguga</div>
    <div class="meta">Posted on 2004-02-10 09:09:40 by Nguga</div>
   </div>
   <div class="post" id="post-133091">
    <div class="subject"><a href="#post-133091">NASM to EXE  no linker</a></div>
    <div class="body">Bloodhound is not exactly a virus. It is just that nav thinks that it is a virus but could not classify it. <br /><br />In my opinion, lea is useful for addition and stuffs like that.</div>
    <div class="meta">Posted on 2004-02-10 09:14:06 by roticv</div>
   </div>
   <div class="post" id="post-133251">
    <div class="subject"><a href="#post-133251">NASM to EXE  no linker</a></div>
    <div class="body">Hi nguga<br /><br />&gt; well i prefer *nasm* to call only nasm becouse<br /><br />Hey, listen please. The problem is that the original PEMAC.INC<br />macros all the objects are in raw or physical space: any address<br />is really a raw offset in the file. So that I have to calculate the<br />virtual address where will be the objects when the program is<br />executed. This is more complex when you use more than one<br />section: I like to use the .bss uninitialized data section.<br /><br />The &quot;nasm&quot; and the &quot;reloc&quot; macro instructions let solve this<br />problem, but break the original NASM syntax and introduce<br />complications that is best avoid it.<br /><br />Some guys sended me info about a project similar to PEMAC.INC.<br />They found a way to avoid to do relocations by hand: NASM<br />can do these relocations in assembling time. You must look at<br />NPEMAC.INC to discover the power of the NASM section<br />directive. Still I have to intend use the .bss section with this<br />new macros.<br /><br />I think that is not good break the original NASM syntax. Many<br />NASM users prefer use it and avoid HLL style macros.<br /><br />&gt; nuMIT_or is just a MAD <br />&gt; and he wants only NASM ! no linker nor resource builder<br /><br />Yes. With the original PEMAC.INC I wrote a complete system,<br />cybercafe style, to control the machines in my job. Still the<br />program has bugs, but soon I will upload it to everybody. <br /><br />&gt; lea eax,<br />&gt; push eax <br />&gt;<br />&gt; is <br />&gt; nasm BeginPaint,,ADDR_ ps<br />&gt;<br />&gt; i do not see any logic making<br />&gt; nasm BeginPaint,,ADDR_ <br />&gt; [ ] here does not make logic <br /><br />You are free to use any notation that you want. I don't<br />remember now what I do, but I'm sure that I always mantain<br />the dot -- [.ps] -- when I use local variables. Is important for my <br />to know when a variable is local, when is global intitialized and <br />when is global uninitialized because the relocations always<br />change. I wait that with the NPEMAC.INC I'll can forget this :)<br /><br />But I see that you are building a new language, not exactly<br />a classic assembly language. Of course, in a very pragmatic <br />way, but seems me a new language, so that you can select <br />the syntax and the lexic that best satisfies your criterions.<br /><br />&gt; Bloodhound is not exactly a virus<br /><br />Yes! I have discovered this. Is strange that the NAV antivirus<br />complains with some PE files with import info in the header<br />and not with other PE files still with import info in the header.</div>
    <div class="meta">Posted on 2004-02-11 22:27:25 by n u M I T_o r</div>
   </div>
   <div class="post" id="post-133291">
    <div class="subject"><a href="#post-133291">NASM to EXE  no linker</a></div>
    <div class="body">hi nuMIT_or !<br /><br /><br /><br />&quot;<br />but I'm sure that I always mantain<br />the dot -- [.ps] -- when I use local variables &quot;<br /><br /><br /><br />with NAGOA  proc endproc you can use that dot thing . <br /><br /><br />look here :)<br /><br /><br /><br />proc Message , .msg , .title<br /><br />call MessageBox ,NULL, [.msg] , [.title] , MB_OK<br /><br />endproc<br /><br /><br />wish makes more sense :)</div>
    <div class="meta">Posted on 2004-02-12 12:34:00 by Nguga</div>
   </div>
   <div class="post" id="post-133296">
    <div class="subject"><a href="#post-133296">example using proc endproc using only NASM</a></div>
    <div class="body">; NAGOA RAD IDE menu go to , project -&gt; build settings -&gt;    BIN <br /><br /><br />%include &quot;\lab\vasm\inc\nagoa.inc&quot;<br />    <br /><br /><br /><br />BEGIN_PE DEFAULT       <br />                        <br />data:<br /><br />ola db  &quot;ola&quot; ,0<br />ole db  &quot;ole&quot; ,0<br /><br />code:<br /><br />loccall Message , addr ola , addr ole<br />xor eax,eax<br />ret<br /><br /><br />proc Message , .msg , .title<br /><br />nasm MessageBoxA ,NULL, [.msg] , [.title] , MB_OK<br /><br />endproc<br />				<br /><br /><br />; ------------ [ IMPORTS ]<br /><br /><br />__LIBS_       user32.dll  ,  &quot;user32.dll&quot;<br /><br /><br /><br /> __IMPORT_  user32.dll, \<br />        	  MessageBoxA, &quot;MessageBoxA&quot;, 0<br /><br /><br /><br /><br />END_PE<br /><br /><br /><br /><br />i agree that that  *addr* is not nasm syntax :)<br /><br /><br />i use *addr* as you know  every time i need that<br /> + reloc  .<br /><br /><br />keep ON the Only Nasm work ! :)</div>
    <div class="meta">Posted on 2004-02-12 12:47:08 by Nguga</div>
   </div>
   <div class="post" id="post-133331">
    <div class="subject"><a href="#post-133331">NASM to EXE  no linker</a></div>
    <div class="body">nuMIT_or  !<br /><br />NAGOA.INC already working without that reloc thing !  :)  <br /><br /><br />want to thank vecna nuMIT_or and William Swanson<br /><br /><br /><br /><br />only NASM no compiler <br /><br /><br /><br /><br /><br /><br /><br />%include &quot;\lab\vasm\inc\nagoa.inc&quot;<br /><br /><br /><br /><br />section .data<br /><br />msg db &quot;message&quot;,0<br />title db &quot;title!&quot;,0<br /><br /><br />section .text<br /><br />__start:<br /><br /><br />nasm  MessageBoxA , 0 , &quot;ola&quot;,&quot;ola&quot;, MB_OK<br /><br />nasm  MessageBoxA , 0 ,  msg , title , MB_OK<br /><br />xor eax,eax<br />ret<br /><br /><br /><br /><br /><br /><br />section .text<br /><br />__LIBS_     user32,&quot;user32.dll&quot;<br />__IMPORT_ user32,  MessageBoxA, &quot;MessageBoxA&quot;, 0	<br /><br /><br />_end_import:<br />%define	import_size _end_import - import<br /><br /><br />end</div>
    <div class="meta">Posted on 2004-02-12 21:48:31 by Nguga</div>
   </div>
   <div class="post" id="post-133332">
    <div class="subject"><a href="#post-133332">NASM to EXE  no linker</a></div>
    <div class="body">its like this know :)<br /><br />%include &quot;\lab\vasm\inc\nagoa.inc&quot;<br /><br /><br />section .data<br /><br />msg db &quot;message&quot;,0<br />title db &quot;title!&quot;,0<br /><br /><br />section .text<br /><br />__start:<br /><br /><br />nasm  MessageBoxA , 0 , &quot;ola&quot;,&quot;ola&quot;, MB_OK<br /><br />nasm  MessageBoxA , 0 ,  msg , title , MB_OK<br /><br />xor eax,eax<br />ret<br /><br /><br /><br /><br /><br />IMPORT_BEGIN<br /><br />__LIBS_     user32,&quot;user32.dll&quot;<br />__IMPORT_ user32,  MessageBoxA, &quot;MessageBoxA&quot;, 0	<br /><br />IMPORT_END</div>
    <div class="meta">Posted on 2004-02-12 22:09:32 by Nguga</div>
   </div>
   <div class="post" id="post-133333">
    <div class="subject"><a href="#post-133333">NASM to EXE  no linker</a></div>
    <div class="body">only 1.039 bytes :)</div>
    <div class="meta">Posted on 2004-02-12 22:12:37 by Nguga</div>
   </div>
   <div class="post" id="post-133334">
    <div class="subject"><a href="#post-133334">NASM to EXE  no linker</a></div>
    <div class="body">&gt; NAGOA.INC already working without that reloc thing<br /><br />That is wonderful! Try now to use the .bss section. I<br />have not intended with the section directive.</div>
    <div class="meta">Posted on 2004-02-12 22:24:50 by n u M I T_o r</div>
   </div>
   <div class="post" id="post-133486">
    <div class="subject"><a href="#post-133486">NASM to EXE  no linker</a></div>
    <div class="body">Hi nguga!<br /><br />I used unitialized data with the NPEMAC.INC without problem.<br />The .bss section does not appears in the section header, but<br />the ImageSize field is correctly adjusted to alloc the <br />necessary memory in run time.<br /><br />So you can do<br /><br /><pre><code><br />    section .bss<br />buffer      resb     4000h<br /></code></pre><br /><br />And the size of the EXE will be the same as if you have not<br />defined such buffer.<br /><br />Another point. It is not necessary use &quot;apicall&quot; macro instruction<br />anymore. You can use any &quot;call&quot; instruction that you used with<br />linkers: invoke, stdcall, _call, etc. Is not necessary to do<br />relocations by hand anymore.</div>
    <div class="meta">Posted on 2004-02-14 07:44:21 by n u M I T_o r</div>
   </div>
   <div class="post" id="post-133501">
    <div class="subject"><a href="#post-133501">NASM to EXE  no linker</a></div>
    <div class="body">Btw numitor, what happens if the last section in the PE file is a read-only section and you just add to SizeOfImage?</div>
    <div class="meta">Posted on 2004-02-14 10:10:39 by f0dder</div>
   </div>
   <div class="post" id="post-133508">
    <div class="subject"><a href="#post-133508">NASM to EXE  no linker</a></div>
    <div class="body">hi !<br /><br /><br />nuMIT_or i can not use the same NAGOA *call* macro becouse that macro calls functions via IAT<br />without any import table jump.<br /><br /><br />its just a call directly to the function , it does not call the adress table .<br /><br />and nagoa *call*  makes this .<br /><br /><br /><br />push dword 0<br />extern ExitProcess<br />import ExitProcess kernel32.dll<br />CALL <br /><br />you can see the diference in olydbg :)  , there is no import table.<br /><br /><br />for every *call*  and us you know  BIN nasm option <br />does not suport that :(  .<br /><br /><br /><br />%idefine ADDR_ &quot;ADDR_&quot;,<br />%idefine addr_   &quot;ADDR_&quot;,<br /><br />%imacro call_ 1-*  <br />%assign i	%0<br />	%if %0 &gt; 1<br />		%rep %0 - 1<br />			%rotate -1  <br />			%assign i	i-1		                               <br />			%rotate -1<br />			%ifidni %1,&quot;ADDR_&quot;<br />			%rotate 1<br />			lea	eax,	[%1]<br />			push	eax<br />			%rotate -1<br />			%assign i	i-1<br />			%else		<br />			%rotate 1<br />			STDPUSH {%1}     <br />			%endif<br />			%if i &lt;=1<br />			%exitrep<br />			%endif<br />		%endrep		<br />		%rotate -1<br />	%endif<br />	%ifndef %1_definida<br />                ; ? uma fun?ao externa ?   ( hgb )<br />                extern %1     ; declare API function as external<br />                CALL [%1]          ; call API function via IAT<br />        %else<br />                ;? uma  fun?ao local<br />                CALL %1<br />        %endif<br />%endmacro<br /><br /><br />;=== [ end macro call_ ] =====================<br /><br /><br />%define CALL_  call_<br />%define stdcall call_<br />%define STDCALL call_<br />%define invoke call_<br />%define INVOKE call_</div>
    <div class="meta">Posted on 2004-02-14 10:28:30 by Nguga</div>
   </div>
   <div class="post" id="post-133510">
    <div class="subject"><a href="#post-133510">NASM to EXE  no linker</a></div>
    <div class="body"><div class="quote">there is no import table.</div><br />I hope you mean there are no &quot;call j_ExitProcess&quot; style thunks - without an import table you're going to get into trouble on at least a couple of windows versions :)</div>
    <div class="meta">Posted on 2004-02-14 10:36:51 by f0dder</div>
   </div>
   <div class="post" id="post-133517">
    <div class="subject"><a href="#post-133517">NASM to EXE  no linker</a></div>
    <div class="body">; method that NAGOA.INC uses in is RAD IDE<br />; implemented on is already made macro !<br />; nasm -f obj iat_message.asm<br />; alink -oPE iat_message.obj<br />; ------------------------------------------<br /><br />; here full hardcoded .<br /><br />;-------------------------------------------------<br /><br />segment data use32<br />    title1    db 'A Windows Program', 0<br />    string1   db 'Look, Ma! A Windows program!', 0<br /><br /><br /><br />segment code use32<br /><br />..start:<br /><br />    push dword 0       ; button type - supposed to be 0,<br />    push dword title1    ; but I need all the help I can get :)<br />    push dword string1<br />    push dword 0         ; our &quot;handle&quot;, I think<br />   extern MessageBoxA<br />   import MessageBoxA user32.dll<br />   call <br /><br /><br /><br />    push dword 0<br />    extern ExitProcess<br />    import ExitProcess kernel32.dll<br />    CALL <br /><br />;--------------------------------------------<br /><br /><br /><br /><br /><br /><br /><br />here is the IDA asm output :<br /><br /><br />; 	This file is generated by The Interactive Disassembler (IDA)	    <br />;==========================================================================<br /><br />; Segment type:	Pure data<br />data		segment	para public 'DATA' use32<br />		assume cs:data<br />		;org 401000h<br />aAWindowsProgra	db 'A Windows Program',0 ; DATA XREF: code:00402005o<br />aLookMaAWindows	db 'Look, Ma! A Windows program!',0 ; DATA XREF: code:0040200Ao<br />		align 1000h<br />data		ends<br /><br /><br />; Segment type:	Pure data<br />code		segment	para public 'DATA' use32<br />		assume cs:code<br />		;org 402000h<br /><br />		public start<br />start:<br />		push	0<br />		push	offset aAWindowsProgra ; &quot;A Windows Program&quot;<br />		push	offset aLookMaAWindows ; &quot;Look,	Ma! A Windows program!&quot;<br />		push	0<br />		call	ds:MessageBoxA<br />		push	0<br />		call	ds:ExitProcess<br /><br />code		ends<br /><br /><br />; Segment type:	Pure data<br />imports		segment	para public 'DATA' use32<br />		assume cs:imports<br />		;org 403000h<br />		db  58h	; X<br />		db  30h	; 0<br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db  3Ch	; &lt;<br />		db  30h	; 0<br />		db    0	;  <br />		db    0	;  <br />		db  60h	; `<br />		db  30h	; 0<br />		db    0	;  <br />		db    0	;  <br />		db  68h	; h<br />		db  30h	; 0<br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db  48h	; H<br />		db  30h	; 0<br />		db    0	;  <br />		db    0	;  <br />		db  70h	; p<br />		db  30h	; 0<br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db  75h	; u<br />		db  73h	; s<br />		db  65h	; e<br />		db  72h	; r<br />		db  33h	; 3<br />		db  32h	; 2<br />		db  2Eh	; .<br />		db  64h	; d<br />		db  6Ch	; l<br />		db  6Ch	; l<br />		db    0	;  <br />		db    0	;  <br />		db  6Bh	; k<br />		db  65h	; e<br />		db  72h	; r<br />		db  6Eh	; n<br />		db  65h	; e<br />		db  6Ch	; l<br />		db  33h	; 3<br />		db  32h	; 2<br />		db  2Eh	; .<br />		db  64h	; d<br />		db  6Ch	; l<br />		db  6Ch	; l<br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db  78h	; x<br />		db  30h	; 0<br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />imports		ends<br /><br /><br /><br /><br />; Segment type:	Pure data<br />imports		segment	para public 'DATA' use32<br />		assume cs:imports<br />		;org 403078h<br />		db    0	;  <br />		db    0	;  <br />		db  4Dh	; M<br />		db  65h	; e<br />		db  73h	; s<br />		db  73h	; s<br />		db  61h	; a<br />		db  67h	; g<br />		db  65h	; e<br />		db  42h	; B<br />		db  6Fh	; o<br />		db  78h	; x<br />		db  41h	; A<br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db  45h	; E<br />		db  78h	; x<br />		db  69h	; i<br />		db  74h	; t<br />		db  50h	; P<br />		db  72h	; r<br />		db  6Fh	; o<br />		db  63h	; c<br />		db  65h	; e<br />		db  73h	; s<br />		db  73h	; s<br />		db    0	;  <br />		align 1000h<br />imports		ends<br /><br /><br /><br />; Segment type:	Pure data<br />relocs		segment	para public 'DATA' use32<br />		assume cs:relocs<br />		;org 404000h<br />		db    0	;  <br />		db  20h	;  <br />		db    0	;  <br />		db    0	;  <br />		db  10h	;  <br />		db    0	;  <br />		db    0	;  <br />		db    0	;  <br />		db    6	;  <br />		db  30h	; 0<br />		db  0Bh	;  <br />		db  30h	; 0<br />		db  16h	;  <br />		db  30h	; 0<br />		db  21h	; !<br />		db  30h	; 0<br />		align 1000h<br />relocs		ends<br /><br /><br />		end start</div>
    <div class="meta">Posted on 2004-02-14 12:39:43 by Nguga</div>
   </div>
   <div class="post" id="post-133518">
    <div class="subject"><a href="#post-133518">NASM to EXE  no linker</a></div>
    <div class="body">NAGOA USES this:<br /><br />call dword <br /><br />example  call dword [0x00403000]<br /><br /><br /><br /><br />no table :)<br /><br /><br />and others use .<br /><br /><br />call   <br /><br />mem32:<br />jmp dword <br /><br /><br />no problem in any methods :)</div>
    <div class="meta">Posted on 2004-02-14 12:49:31 by Nguga</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=17117&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=17117&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="17117" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=17117&amp;page=2">&gt;</a><a href="../?id=17117&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>