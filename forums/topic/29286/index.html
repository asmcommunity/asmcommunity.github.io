<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Webbrowser using ATL and MFC events - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29286" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29286">Webbrowser using ATL and MFC events</a></p>
   <div class="post" id="post-206866">
    <div class="subject"><a href="#post-206866">Webbrowser using ATL and MFC events</a></div>
    <div class="body">Microsoft foundation classes are pretty much the stuff of high level languages, all documentation is pretty much based on Visual Studio and the MFC wizards, most of the useful helper functions are C++ source contained in header files. DISP interfaces appear difficult to work with and COM in general scares assembly people. However in its finite wisdom, Microsoft has the ATL, the Active Template Library that encapsulates MFC objects and allows those of us who use assembler to incorporate them into our applications. To create an ATL object is fairly simple, just initialize the library then use CreateWindowEx. From there it makes a shallow dive into COM, in the following example we must get the IUnknown interface from the control in order to query for IWebBrowser2 which is the COM interface that controls the WebBrowser MFC class. With that interface we can do just about anything we want with our browser, display pages, move forward or back etc... It gets a bit more complicated with Event Sinks, COM by itself has very little to no functionality when it comes to an object notifying its host of events, so Microsoft introduced DISP, which allows the object to notify your application if something happens. The difference is subtle but significant, with a DISP interface, you write the interface and the object calls it through IDispatch using a predefined dispatch ID for each event. To write a DISP interface you need to implement the IUnknown and IDispatch interfaces in your application then pass a pointer to the object via AtlAdvise. For IUnknown you have to implement all three methods, for IDispatch only Invoke is called but you should also implement at least the default handler for GetIDsOfNames according to Microsoft.<br /><br />The following is an example of an ATL based web browser with an event sink. You will have to download my latest header files to assemble it using GoAsm, for MASM users I doubt that there is a set of includes for ATL but translating the applicable GoAsm headers shouldn&#039;t a huge task.</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=2736" target="_blank">ATLDemo.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2009-02-18 12:08:11 by donkey</div>
   </div>
   <div class="post" id="post-206870">
    <div class="subject"><a href="#post-206870">Re: Webbrowser using ATL and MFC events</a></div>
    <div class="body">Hi Donkey<br />Thanks for sharing your work, which is a valuable reference.<br /><br />Biterider</div>
    <div class="meta">Posted on 2009-02-18 14:25:38 by Biterider</div>
   </div>
  </div>
 </body>
</html>