<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>MacroLib beta - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=15067" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=15067">MacroLib beta</a></p>
   <div class="post" id="post-117013">
    <div class="subject"><a href="#post-117013">MacroLib beta</a></div>
    <div class="body">After wanting to better learn the Masm macroing system,<br />I started to play around with some ideas I had floating<br />around.<br /><br />So far, there is no documentation and not all the controls<br />are supported, but it gives a fairly good representation of<br />what I would like to see this library achieve.  I dont think<br />it will be hard reading in any case.  So far it is still fairly<br />simple.<br /><br />Check out the example program provided and let me know<br />what yall think.  It uses a hybrid high speed dispatcher/<br />linked list approach.  Still rather fast, but allows multiple<br />hooks per hWnd/ message.<br /><br />Note: Currently I am more interested in optimizing the<br />macro code, but any feedback will be appriciated.<br />:alright:</div>
    <div class="meta">Posted on 2003-09-04 22:24:13 by Graebel</div>
   </div>
   <div class="post" id="post-118032">
    <div class="subject"><a href="#post-118032">MacroLib beta</a></div>
    <div class="body">I have worked off and on with a simular class object that does this sorta thing.  I think this is good work, but since its macros is not dynamic (run time useable functions).   As well, it appears that you are only able to register one window, correct me if im wrong here..<br /><br />However, i like the work you have done, and i might borrow from it with the work im doing, if you do not mind.<br /><br />Regards,<br />:NaN:</div>
    <div class="meta">Posted on 2003-09-13 22:00:45 by NaN</div>
   </div>
   <div class="post" id="post-118036">
    <div class="subject"><a href="#post-118036">MacroLib beta</a></div>
    <div class="body"><div class="quote"><br />I think this is good work, but since its macros is not dynamic (run time useable functions).<br /></div><br /><br />I am perhaps a little confused about this point.  Perhaps you might clarify it some<br />so I can understand your meaning?<br /><br /><div class="quote"><br />As well, it appears that you are only able to register one window, correct me if im wrong here..<br /></div><br /><br />The library itself only registers one window class, as far as I know thats all it needs.<br /><br />You can however create as many top level or child windows as you like.  The call to WinMain<br />is to start the message loop and know which window will close the application.<br /><br />I decided to code it this way on purpose, because if you register another windows class<br />with a different WndProc you will not be able to hook events which is the main thrust of<br />this macro library (besides easy use and control creation) :cool:<br /><br />Did I overlook something perhaps?<br /><br /><div class="quote"><br />and i might borrow from it with the work im doing, if you do not mind.<br /></div><br /><br />Borrow away, or take, or anything else  :) .  I am posting no claims of property, ownership,<br />or anything else.  Its completely free for any use.</div>
    <div class="meta">Posted on 2003-09-13 22:54:51 by Graebel</div>
   </div>
   <div class="post" id="post-118079">
    <div class="subject"><a href="#post-118079">MacroLib beta</a></div>
    <div class="body"><div class="quote"><br />I am perhaps a little confused about this point.  Perhaps you might clarify it some<br />so I can understand your meaning?</div><br /><br />LOL,  yup.  Im missing my point here too... well at least as written ;) .   I was trying to get at the fact that macros are compile time tools.  If you needed to dynamically create a child window at run time, by say a user inputing a set of parameters, your static macros wont work.   However, i realize work arounds can be done to limit user imput to selection constraints, and doing if/else case structures to choose the correct macro.  <br /><br />This was my only point here.<br /><br /><br />As for the multiple registering of windows.  Typically you do only register one, but i have made some programs where you register multpile windows. Typically custom controls, where each custom control you are using is also a window, and hence needs to be registered with in that process.<br /><br /><br />Lastly, thanks for sharing it.  I find your work very clean an tidy to follow...<br />:NaN:</div>
    <div class="meta">Posted on 2003-09-14 09:27:54 by NaN</div>
   </div>
   <div class="post" id="post-118099">
    <div class="subject"><a href="#post-118099">Hmm</a></div>
    <div class="body"><div class="quote"><br />Typically you do only register one, but i have made some programs where you register multpile windows. Typically custom controls, where each custom control you are using is also a window, and hence needs to be registered with in that process.<br /></div><br /><br />Ahh, its a custom control question.<br /><br />It should be obvious from the way it is set up that the end user will miss the WM_CREATE message.<br />During window creation I am posting to the loop a ML_CREATE message that <strong>can</strong> be captured<br />as im sure you noticed.  During the processing of this message, you can set up the hooks needed<br />for a custom control to work.  This is assuming of course youll have only one instance of such a<br />control.<br /><br />For more complicated work or custom controls, I would register a seperate class with its own<br />WndProc for the fine processing and at the end of WM_CREATE reset the WndProc to the Macro<br />Libs one.  All the code could be in an include file at the top and as a bonus, you can set up another<br />handler for the creation so it would look like any other control.  Am I a little fuzzy on this point,<br />but I believe (not tried it yet) that the DefWindowProc would continue to call the original proc<br />you set up.  Maybe not.  I have been busy with other things lately and havnt really tested this<br />code along those lines as yet.  Perhaps superclassing would be a better option if it didnt work as<br />I am expecting it will.</div>
    <div class="meta">Posted on 2003-09-14 11:26:39 by Graebel</div>
   </div>
   <div class="post" id="post-118101">
    <div class="subject"><a href="#post-118101">Ahh</a></div>
    <div class="body">Now I remember =)<br /><br />Just register your own class as normal with its own WndProc and dont worry<br />about resetting it.  As long as the custom control passes along pertinate<br />information along it would work like any other control.<br /><br />ie.  Make use of WM_COMMAND and perhaps custom message handlers<br />and just pass them along to thier respective parent windows.  They should<br />in all repects act and feel like any other control.</div>
    <div class="meta">Posted on 2003-09-14 11:33:37 by Graebel</div>
   </div>
   <div class="post" id="post-119672">
    <div class="subject"><a href="#post-119672">MacroLib beta</a></div>
    <div class="body">I dont know bout structure macro. Please explan for me<br />Example: i have  macro<br /><br />macro pushd arg<br /> { if _#arg in &lt;_addr arg,_ADDR arg&gt;<br />    local ..arg,..op                         //identifi ..arg,..op<br />    label ..arg at arg                     //label ..arg at arg<br />    virtual at 0                              // what is it mean?<br />     mov eax,..arg<br />     load ..opcode from 0             // what is it mean?<br />    end virtual<br />    if ..opcode = 0A1h<br />     push arg<br />    else<br />     lea edx,..arg<br />     push edx<br />    end if<br />   else if arg eqtype &quot;&quot;<br />    local ..continue<br />    call ..continue<br />    db arg,0<br />    ..continue:<br />   else<br />    push arg<br />   end if }<br /><br />Please help me....</div>
    <div class="meta">Posted on 2003-09-26 21:06:46 by boysoledad</div>
   </div>
   <div class="post" id="post-121827">
    <div class="subject"><a href="#post-121827">MacroLib beta</a></div>
    <div class="body">Graebel,<br /><br /> <div class="quote">Did I overlook something perhaps?</div><br /><br />     Yes, I think you have.  Every window in a multiple window program may have local variables.  If the window does, it should use its stack for local storage in order for each window to be multitasking, because each window owns its own stack.  This is usually done by a SUB ESP,4*(# of local variables) at the beginning of each windows dispatcher, and a ADD ESP,4*(# of local variables) to balance the stack at the end of the dispatcher.  I see no provision for this to happen in your one-dispatcher-fits-all implementation.<br /><br />     Below is your dispatcher code:<br />     How does the dispatcher get to the InitCommonControls call with a RET instruction before it?<br />     Why do you return back to the dispatcher and search again after a handler is found and CALLed?<br /><br /><pre><code>mlWndProc proc uses ebx hWnd&#58;DWORD, uMsg&#58;DWORD, wParam&#58;DWORD, lParam&#58;DWORD<br />		mov		eax, uMsg<br />		mov		ebx, DWORD PTR &#91;mlMsgs+eax*4&#93;<br />		cmp		ebx, 0<br />		jne		DISPATCH<br />	DEFAULT&#58;<br />		invoke	DefWindowProc, hWnd, uMsg, wParam, lParam<br />		ret<br />		invoke	InitCommonControls<br />	DISPATCH&#58;<br />		mov		ecx, hWnd<br />		cmp		&#40;mlMSGS PTR &#91;ebx&#93;&#41;.hWnd, ecx<br />		je		DOMESSAGE<br />		cmp		&#40;mlMSGS PTR &#91;ebx&#93;&#41;.Next, 0<br />		je		DONE<br />		mov		ebx, &#40;mlMSGS PTR &#91;ebx&#93;&#41;.Next<br />		jmp		DISPATCH<br />	DOMESSAGE&#58;<br />		push		lParam<br />		push		wParam<br />		push		uMsg<br />		push		hWnd<br />		call		&#40;mlMSGS PTR &#91;ebx&#93;&#41;.Handler<br />		cmp		&#40;mlMSGS PTR &#91;ebx&#93;&#41;.Next, 0<br />		je		DONE<br />		mov		ebx, &#40;mlMSGS PTR &#91;ebx&#93;&#41;.Next<br />		jmp		DISPATCH<br />	DONE&#58;<br />		ret<br />mlWndProc endp</code></pre><br /><br />     Getting rid of the redundancies, spaghetti, and PROC directives (they're evil).  I would write it this way:  Ratch<br /><pre><code><br /><br />mlMSGS struct<br />	hWnd          DWORD	?<br />	Handler       DWORD	?<br />mlMSGS ends<br />mlWndProc&#58;<br />		mov		eax, &#91;ESP+8&#93; ; uMsg<br />		mov		ebx, &#91;mlMsgs+eax*4&#93;<br />		cmp		ebx, 0<br />		JE		DefWindowProc<br />DISPATCH&#58;<br />		mov		ECX,&#91;ESP+4&#93; ; hWnd<br />		cmp		&#91;mlMSGS.hWnd+EBX&#93;,ECX<br />                JNE @F<br />		JMP		&#91;mlMSGS.Handler+EBX&#93;<br />@@&#58;<br />		cmp	        DWORD PTR &#91;TYPE mlMSGS+EBX&#93;, 0<br />		JE		@F<br />		ADD		EBX, TYPE mlMSGS<br />		jmp		DISPATCH<br />@@&#58;<br />		RET 4*DWORD<br /></code></pre></div>
    <div class="meta">Posted on 2003-10-20 07:37:48 by Ratch</div>
   </div>
   <div class="post" id="post-122050">
    <div class="subject"><a href="#post-122050">MacroLib beta</a></div>
    <div class="body"><div class="quote"><br />I see no provision for this to happen in your one-dispatcher-fits-all implementation.<br /></div><br /><br />Well it was not intended as such.  Although I am sure it could eventually be if someone<br />worked on it.  I only posted the code to get feedback on the macros actually.  What the<br />code itself did was interesting (I thought), but not the main thrust of what I was looking<br />for...<br /><br /><div class="quote"><br />Below is your dispatcher code:<br />How does the dispatcher get to the InitCommonControls call with a RET instruction before it?<br /></div><br /><br />Good eye, it does not actually.  I cant off the top of my head recall where I read it (perhaps<br />Iczelions great tuts?), but InitCommonControls itself (it seems) does not actually need to<br />be called.  When the linker see's InitCommonControls it will make sure the DLL is loaded.<br />Actually calling it is a waste of time.<br /><br /><div class="quote"><br />Why do you return back to the dispatcher and search again after a handler is found and CALLed?<br /></div><br /><br />Mainly for convenience and custom controls (of a different type).<br /><br />Say I have a main app window and capture its WM_SIZE message (to size a window to its client<br />area or something).  Later on - say I add a status bar, it also might need to capture the exact<br />same message from the same window.  Of course I *could* have just added the code to the end<br />of the first procedure.  I chose this method so I could seperate out each controls code to their own<br />seperate include file for both readability and maintenance purposes.<br /><br /><div class="quote"><br />Getting rid of the redundancies, spaghetti, and PROC directives (they're evil). I would write it this way: Ratch<br /></div><br /><br />Probably closer to the way I usually code things (for myself), but per above I need the redundancies and spaghetti :tongue:</div>
    <div class="meta">Posted on 2003-10-21 23:52:48 by Graebel</div>
   </div>
  </div>
 </body>
</html>