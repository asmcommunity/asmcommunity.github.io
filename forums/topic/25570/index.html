<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Accessing Array from ASM passed from C++? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25570" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25570">Accessing Array from ASM passed from C++?</a></p>
   <div class="post" id="post-186746">
    <div class="subject"><a href="#post-186746">Accessing Array from ASM passed from C++?</a></div>
    <div class="body">I&#39;ve been studying assemby for about a semester now. I am having a horrible time figuring out how to access the data I pass from C++ to ASM. The data is a array of strings which I will have to sort in ASM and return a sorted array back to C++. The biggest problem I am having is accessing the data itself. The array is being passed at ... Any help with this is appreciated. <br /><br />This is the C++ code I&#39;m working with;<br /><pre><code>extern &quot;C&quot; int Sort (char &#91;] [20], int, int);</code></pre><br /><br /><pre><code>	Sort (Strings, 10, 20);<br />	cout &lt;&lt; &quot;Sorted Strings are&quot; &lt;&lt; endl;<br />	for (i = 0; i &lt; 10; i++)<br />		cout &lt;&lt; &#39;\t&#39; &lt;&lt; Strings <em> &lt;&lt; endl;</code></pre><br /><br />You can probably ignore my code, but I figure I would put it anyways;<br /><pre><code>_Sort proc<br /><br />		push		ebp<br />		mov			ebp, esp <br />		push		edi<br />		<br />		mov			eax, <br />		mov			array_ptr, eax<br />		mov			eax, <br />		mov			array_length, eax<br />		mov			eax, <br />		mov			bytes_per_line, eax<br />	<br />		mov			eax, array_length<br />		cmp			eax, 0			;jump if array has length of 0<br />		jnae		EndTRow<br />		<br />		mov			ebx, found_length<br />		inc			ebx			;add 1 to found_length&#39;s sum<br />		cmp			ebx, eax	;jump if at last row<br />		ja			EndTrow<br />;		mov			found_length, ebx<br /><br />Tcolumns:<br />		mov			eax, char_position<br />		mov			ebx, bytes_per_line<br />		cmp			eax, ebx<br />		jnb			TRows<br /><br />... ...and it becomes useless jargon here<br /><br />EndTrow:<br />		pop			edi		<br />		pop			ebp<br />		ret<br />_Sort endp</code></pre><br /></div>
    <div class="meta">Posted on 2006-11-26 23:17:26 by of1983vintage</div>
   </div>
   <div class="post" id="post-186747">
    <div class="subject"><a href="#post-186747">Re: Accessing Array from ASM passed from C++?</a></div>
    <div class="body">The biggest problem you&#39;re going to have is that you should be sorting your strings into a temporary buffer..<br />This avoids trashing of the source buffer during sorting.<br />After sorting, you can simply overwrite the source buffer with the temporary one in order to return the sorted array in the input buffer.<br /><br />Unless you know EXACTLY what you&#39;re doing with ebp and esp, I&#39;d leave them alone .. the assembler can insert them for you :)<br /><br />Here&#39;s a typical asm procedure.. note that the input params at ebp+8,12,16 are equivalent to your first three input params ;)<br /><br /><pre><code><br />Sort proc uses esi edi ecx lpStrings:dword,cbSizeTotal:dword,dwBytes_per_line:dword<br />LOCAL array_length<br />;		Let the assembler set up the stackframe for us<br />;		push		ebp<br />;		mov			ebp, esp <br /><br />		push		edi<br />		mov			esi, lpStrings<br />		xor ecx,ecx<br />		.while ecx&lt;cbSizeTotal<br />			push ecx<br />			;<br />			;Perform sort operation here..<br />			;<br />			pop ecx<br />			inc ecx<br />		.endw<br />		pop			edi<br />;		;Let the assembler clean up the stackframe for us<br />;		pop			ebp<br />		ret<br />Sort endp<br /></code></pre><br /></div>
    <div class="meta">Posted on 2006-11-27 00:38:50 by Homer</div>
   </div>
   <div class="post" id="post-186752">
    <div class="subject"><a href="#post-186752">Re: Accessing Array from ASM passed from C++?</a></div>
    <div class="body">I appreciate your response but I still don&#39;t know how to access the information inside of the array, I tried to run your code and its telling me...<br /><div class="quote"> Assembling: .\Lab9.asm<br />.\Lab9.asm(26) : error A2119: language type must be specified<br />Project : error PRJ0019: A tool returned an error code from &quot;Assembling...&quot;</div><br /><br />line 26 is where your intiail line for the proc is. <pre><code>Sort proc uses esi edi ecx lpStrings:dword,cbSizeTotal:dword,dwBytes_per_line:dword</code></pre><br /><br />I see that you are storing the edi and ecx registers, I&#39;m assuming because most string compare functions use those for the strings, string length, and then use cx (ecx) as a counter...but how do i get it from the address  or in your examples case lpStrings (I think) to using the string itself. Sorry Im having a horrible time with this...I&#39;ve done excellent in the class until this.</div>
    <div class="meta">Posted on 2006-11-27 09:27:12 by of1983vintage</div>
   </div>
   <div class="post" id="post-186753">
    <div class="subject"><a href="#post-186753">Re: Accessing Array from ASM passed from C++?</a></div>
    <div class="body"> points to the start of your buffer<br /><br />A simple way to process each character is to write:<br /><br /><pre><code><br />.686p<br />.model flat, c<br />.code<br /><br />Sort proc Strings:ptr byte, nb_row:dword, nb_col:dword<br />p textequ &lt;eax&gt;<br />i textequ &lt;ecx&gt;<br />j textequ &lt;edx&gt;<br />&nbsp; cmp nb_col, 0<br />&nbsp; je&nbsp; Done<br />&nbsp; mov p, Strings<br />&nbsp; mov i, nb_row<br />&nbsp; jmp RowT<br />TRow:<br />&nbsp; mov j, nb_col<br />TCol:<br />&nbsp; ; ... process <br />&nbsp; inc p<br />&nbsp; dec j<br />&nbsp; jnz TCol<br />RowT:<br />&nbsp; dec i<br />&nbsp; jge TRow<br />Done:<br />&nbsp; ret<br />Sort endp<br /><br />end<br /></code></pre><br /><br />if needed reassign p, i, j, etc. to memory location (registers are better of course)<br /><br />To process each character sequentially (argument checking omitted) :<br /><br /><pre><code><br />Sort proc Strings:ptr byte, nb_row:dword, nb_col:dword<br />p textequ &lt;eax&gt;<br />p_limit textequ &lt;ecx&gt;<br />&nbsp; mov p, Strings<br />&nbsp; mov p_limit, p<br />&nbsp; add p_limit, nb_row<br />&nbsp; add p_limit, nb_col<br />TChar:<br />&nbsp; ; process <br />&nbsp; mov dl, <br />&nbsp; inc p<br />&nbsp; cmp p, p_limit<br />&nbsp; jnz TChar<br />&nbsp; ret<br />Sort endp<br /></code></pre><br /><br />You can also use a negative index to save a test<br /><br /><pre><code><br />Sort proc Strings:ptr byte, nb_row:dword, nb_col:dword<br />p textequ &lt;eax&gt;<br />i_neg textequ &lt;ecx&gt;<br />&nbsp; mov p, Strings<br />&nbsp; mov i_neg, nb_row<br />&nbsp; add i_neg, nb_col<br />&nbsp; add p, i_neg<br />&nbsp; neg i_neg<br />TChar:<br />&nbsp; ; process <em><br />&nbsp; mov dl, <em><br />&nbsp; inc i_neg<br />&nbsp; jnz TChar<br />&nbsp; ret<br />Sort endp<br /></code></pre><br /><br />The Art Of Assembly Language has a chapter on array access:<br /><br />http://webster.cs.ucr.edu/AoA/DOS/ch05/CH05-2.html#HEADING2-4</div>
    <div class="meta">Posted on 2006-11-27 12:34:41 by Dr. Manhattan</div>
   </div>
   <div class="post" id="post-186756">
    <div class="subject"><a href="#post-186756">Re: Accessing Array from ASM passed from C++?</a></div>
    <div class="body">Thank you for the clarification, I am at work right now but will try it out again as soon as I get back to my house. I&#39;ve read a number of different chapters about accessing arrays in assembly from different books and resources but none have really been much help for this problem at hand. I am probably making it more difficult than it really is, as everyhting is assembly has came to me easily until now... <br /><br />From what I see, I need a pointer to the address of the array, mov the pointer to a register and then use the newly assigned register to navigate the array?<br /><br /><pre><code><br />mov eax, dword ptr  ; you guys are using the proc to pull the variables instead of addressing them yourself.<br />mov ebx, <br /></code></pre><br /><br />if I wanted the X column and Y charater it would be<br />(rows being 20 bytes long, using dword&#39;s @ 4 bytes each, so a 5 elements per row)<br /><br />mov ebx,  <br /><br /><br /><pre><code><br />mov ecx, ;mov value derived from&nbsp; (row*20)+(column*4) in ecx<br />mov ebx, <br /></code></pre><br /><br />ebx would then be the char located at that position?<br /><br />Am I understanding this correctly? The only difference between traversing the array normally and doing so with the array coming from the C++ program is the initial pointer to the array? This is all still theory to me, since I am not at home I can&#39;t test any of this.<br /></div>
    <div class="meta">Posted on 2006-11-27 16:24:55 by of1983vintage</div>
   </div>
   <div class="post" id="post-186759">
    <div class="subject"><a href="#post-186759">Re: Accessing Array from ASM passed from C++?</a></div>
    <div class="body">In a rectangular array, arr<sub>ij</sub> is located at<br /><br />arr_base + i*row_byte_size + j*element_byte_size<br />= arr_base + i*column_declared_size*element_byte_size + j*element_byte_size<br /><br />If row size is 20 bytes, why do you believe the element (char) size is 4 bytes ?<br /><br />Have you looked at <a target="_blank" href="http://www.asmcommunity.net/x86book/index.php?title=All_About_Arrays"><u>All About Arrays</u></a>?</div>
    <div class="meta">Posted on 2006-11-27 19:19:27 by tenkey</div>
   </div>
   <div class="post" id="post-186760">
    <div class="subject"><a href="#post-186760">Re: Accessing Array from ASM passed from C++?</a></div>
    <div class="body">Well I&#39;ve been reading Assembly Language For Intel-Based Computers - Fourth Edition by Kip R. Irvine, plus looking at anything that googles up from &quot;Assembly Array&quot; &quot;Passing Array&quot; and so on... But I will read your link here in a bit...<br /><br />The reason I think that the element is 4 bytes is it is a dword, and the fact that I know what Im looking at as far as the array to be proccessed...but now after looking at the data defining section again I think i might be completely off with the assumption of the element being 4 bits (now im nto sure where I even came up with that at initially, probably some late night experiment that just held over. From my book it looks like a dword is 32 bit unsigned, so... in a couple hours I&#39;ll have to dig in again and see what I can come up with...Thanks for your comments and such guys... I&#39;ll be back in about 2 hours to start coding again.<br /><br />The array I am looking at is...<br /><br /><pre><code>	char Strings [10] [20]<br />					= {	&quot;One&quot;,<br />						&quot;Two&quot;,<br />						&quot;Three&quot;,<br />						&quot;Four&quot;,<br />						&quot;Five&quot;,<br />						&quot;Six&quot;,<br />						&quot;Seven&quot;,<br />						&quot;Eight&quot;,<br />						&quot;Nine&quot;,<br />						&quot;Ten&quot;	};</code></pre><br /><br />(maybe I got the 4 from this; Max elements is 5 -&gt; bits per row = 20 -&gt; 20/5=4 -&gt; each element in row = 4bits)<br />Completely wrong probably but thats the only explanation I can come up with right now...<br /></div>
    <div class="meta">Posted on 2006-11-27 20:04:38 by of1983vintage</div>
   </div>
   <div class="post" id="post-186811">
    <div class="subject"><a href="#post-186811">Re: Accessing Array from ASM passed from C++?</a></div>
    <div class="body">This is supposed to be spelled out somewhere in your C++ documentation. (Maybe I ought to start recommending the Kernighan &amp; Ritchie book <em>The C Programming Language</em>, if it&#39;s still in print.)<br /><br />The C++ array is the same as a C array. If you use two pairs of &#91;], then it is a rectangular matrix (or array of arrays), not an array of pointers. Each element in the matrix is a <strong>char</strong> according to your C++ declaration.<br /><br />Therefore, in reality, you are defining a 10 row by 20 column <strong>char</strong> matrix.<br /><br />To the compiler, an array name is a pointer value, not an array object (except when used with the <strong>sizeof</strong> operator).<br /><br />This ought to point you to the correct solution.</div>
    <div class="meta">Posted on 2006-11-30 16:12:08 by tenkey</div>
   </div>
   <div class="post" id="post-186812">
    <div class="subject"><a href="#post-186812">Re: Accessing Array from ASM passed from C++?</a></div>
    <div class="body">yup, C syntax is pretty messy with arrays</div>
    <div class="meta">Posted on 2006-11-30 19:40:38 by vid</div>
   </div>
   <div class="post" id="post-186813">
    <div class="subject"><a href="#post-186813">Re: Accessing Array from ASM passed from C++?</a></div>
    <div class="body">Thanks for the help, in actuality I was accessing them correctly, I just had then as dwords instead of as bytes so I didn&#39;t know I had already begun traversing the array...only problem Im having now is exchanging the data between the positions in the array. I keep copying one of them into the others position but then i&#39;ve lost the second string.</div>
    <div class="meta">Posted on 2006-11-30 21:11:56 by of1983vintage</div>
   </div>
  </div>
 </body>
</html>