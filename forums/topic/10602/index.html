<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Filename from handle (IFSMgr) - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10602" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=10602">Filename from handle (IFSMgr)</a></p>
   <div class="post" id="post-79728">
    <div class="subject"><a href="#post-79728">Filename from handle (IFSMgr)</a></div>
    <div class="body">File hooking in win9x. I'm trying to get a filename from a handle after  installing a IFSMgr hook.<br /><br />Hooking a IFSFN_OPEN returns a ptr to the unicode path in the ioreq structure.  But no such path is returned for a IFSFN_WRITE.<br /><br />One way I've seen to get the path (from IFSFN_WRITE), requires the address of enum procedure.<br /><br />The code snippet I've seen for this is:<br />;enumFunc = ifsr.ifs_hndl-&gt;hf_misc-&gt;hm_func;<br /><br />                .if     pEnumFunc==0           ;if already got it then<br />skip<br />                        mov   esi,ifs_hndl    ; esi ptr on hndlfunc<br />struct<br />                        add   esi,8h   ; esi ptr on ptr to hf_misc<br />                        mov   esi,dword ptr  ; esi ptr on hf_misc<br />                        add   esi,4       ; esi ptr on hm_func<br />                        add   esi,7*4     ; HM_ENUMHANDLE = 7<br />                        mov   esi,dword ptr      ; esi =<br />pEnumProc!!<br />                        mov   pEnumfunc,esi<br /> <br />Trouble is I've not got much documentation on any of this. :)<br /><br />1) I know about the ioreq structure (and where to access it from the stack when my hook gains control), but what is the ifsreq structure, and how do I access it?<br /><br />2) &quot;;enumFunc = ifsr.ifs_hndl&quot;  I'm lost as to this.  I take it has something to with ifsreq structure? What would be the numerical value of ifs_hndl?<br /><br />Any clarification would be most helpful!</div>
    <div class="meta">Posted on 2003-02-03 07:46:54 by Manxcat</div>
   </div>
  </div>
 </body>
</html>