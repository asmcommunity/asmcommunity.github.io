<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Dell Fan Control - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29041" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29041">Dell Fan Control</a></p>
   <div class="post" id="post-205179">
    <div class="subject"><a href="#post-205179">Dell Fan Control</a></div>
    <div class="body">Totally new to ASM, with that said, can someone point me in the right direction of figuring out how to compile this.<br />There is a GUI to this application, but I would just like to be able to call this directly.<br /><br />http://www.diefer.de/i8kfan/i8kfan.html<br /><br />Says on the site: &quot;If you want to compile it yourself, you need the DiceRTE environment&quot;<br />The DiceRTE env comes with DASM32, would I be able to compile this with NASM.<br />http://www.diefer.de/dicerte/<br /><br />Sorry fore the noob questions, but ya gota start somewhere right..<br /><br /><pre><code><br />; FANCTRL.ASM<br />; The fan control functions; extracted from NBFAN.MDM and NBSVC.MDM from <br />; the Dell Diagnostics 1052<br /><br />; Authors: Some unknown Dell engineers using Visual C++; stripped down<br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; and optimized by MH ;-)<br /><br />.386p<br />.model flat<br /><br />extrn _printf:near<br /><br />public _hlcontrol<br /><br />.code<br />;--------------------------------------<br />; _hlcontrol: high level fan control<br />;<br />;&nbsp; In: D:Fan No (0=outer,1=inner)<br />;&nbsp; &nbsp; &nbsp; D:Speed (2=high,1=slow,0=off)<br />; Out: 1:ok 0:error<br />;--------------------------------------<br /><br />_hlcontrol:<br />&nbsp; &nbsp; &nbsp; &nbsp; push ebp<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ebp,esp<br />&nbsp; &nbsp; &nbsp; &nbsp; sub esp,32<br />&nbsp; &nbsp; &nbsp; &nbsp; push ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; push esi<br />&nbsp; &nbsp; &nbsp; &nbsp; push edi<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword ptr [4*eax+speed]<br />&nbsp; &nbsp; &nbsp; &nbsp; push eax			; 3. arg: speed text<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword ptr [4*eax+fan]<br />&nbsp; &nbsp; &nbsp; &nbsp; push eax			; 2. arg: fan no<br />&nbsp; &nbsp; &nbsp; &nbsp; push offset setspeed		; 1. arg: format string<br />&nbsp; &nbsp; &nbsp; &nbsp; call _printf<br />&nbsp; &nbsp; &nbsp; &nbsp; add esp,12<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword ptr 	; fan speed<br />&nbsp; &nbsp; &nbsp; &nbsp; push eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword ptr 	; fan no<br />&nbsp; &nbsp; &nbsp; &nbsp; push eax<br />&nbsp; &nbsp; &nbsp; &nbsp; call genfanstruct<br />&nbsp; &nbsp; &nbsp; &nbsp; add esp,8<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp eax,1<br />&nbsp; &nbsp; &nbsp; &nbsp; je @a5<br />	<br />	push offset err1<br />	call _printf<br />	add esp,4<br />	xor eax,eax<br />	<br />;---------<br />@a5:&nbsp; &nbsp; pop edi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop esi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; leave<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br /><br />;--------------------------------------<br />; genfanstruct: create smbios structure for fan control<br />;<br />;&nbsp; In: D:Fan No (0=outer,1=inner)<br />;&nbsp; &nbsp; &nbsp; D:Speed (2=high,1=slow,0=off)<br />; Out: 1:ok &lt;&gt;1:error<br />;--------------------------------------<br />genfanstruct:<br />&nbsp; &nbsp; &nbsp; &nbsp; push ebp<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ebp, esp<br />&nbsp; &nbsp; &nbsp; &nbsp; sub esp, 20h<br />&nbsp; &nbsp; &nbsp; &nbsp; push ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; push esi<br />&nbsp; &nbsp; &nbsp; &nbsp; push edi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov byte ptr ,0a3h<br />&nbsp; &nbsp; &nbsp; &nbsp; mov byte ptr ,1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov al,byte ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov byte ptr ,al<br />&nbsp; &nbsp; &nbsp; &nbsp; mov al,byte ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov byte ptr ,al<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr ,0<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr ,0<br />&nbsp; &nbsp; &nbsp; &nbsp; lea eax,dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; push eax<br />&nbsp; &nbsp; &nbsp; &nbsp; call smbiosfct<br />&nbsp; &nbsp; &nbsp; &nbsp; add esp,4<br />&nbsp; &nbsp; &nbsp; &nbsp; pop edi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop esi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; leave<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br /><br />;--------------------------------------<br />; smbiosfct: execute commands in smbios structure<br />;<br />;&nbsp; In: D:Pointer to smbios structure<br />; Out: 1:ok &lt;&gt;1:error<br />;--------------------------------------<br />smbiosfct:<br />&nbsp; &nbsp; &nbsp; &nbsp; push ebp<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ebp, esp<br />&nbsp; &nbsp; &nbsp; &nbsp; sub esp, 14h<br />&nbsp; &nbsp; &nbsp; &nbsp; push ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; push esi<br />&nbsp; &nbsp; &nbsp; &nbsp; push edi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , 1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; pushad<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov bx, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov cx, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov dx, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; out 0b2h, al<br />&nbsp; &nbsp; &nbsp; &nbsp; out 084h, al<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , bx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , cx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , dx<br />&nbsp; &nbsp; &nbsp; &nbsp; popad<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; xor ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov cx, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; and eax, 0000FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp ecx, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; jne @c1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; xor ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov cx, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; and eax, 0000FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp ecx, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; jne @c1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; xor ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov cx, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; and eax, 0000FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp ecx, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; jne @c1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; xor ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov cx, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; and eax, 0000FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp ecx, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; jne @c1<br />&nbsp; &nbsp; &nbsp; &nbsp; push offset svc52A8<br />&nbsp; &nbsp; &nbsp; &nbsp; call _printf<br />&nbsp; &nbsp; &nbsp; &nbsp; add esp, 4<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , 0<br />;---------<br />@c1:&nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; and eax, 0000FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp eax, 0000FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; jne @c2<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; xor ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov cl, byte ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; push ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; push offset svc52DC<br />&nbsp; &nbsp; &nbsp; &nbsp; call _printf<br />&nbsp; &nbsp; &nbsp; &nbsp; add esp, 8<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , 0<br />;---------<br />@c2:&nbsp; &nbsp; mov ax, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ecx, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ecx, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ecx, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ecx, dword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ptr , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; movsx eax, word ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; test eax, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; je @c4<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; jmp @c5<br />;---------<br />@c4:&nbsp; &nbsp; mov eax, 5<br />;---------<br />@c5:&nbsp; &nbsp; pop edi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop esi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; leave<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />	<br />;******************************************************<br />.data<br />err1	db &#039;Failed to set fan speed&#039;,13,10,0<br /><br />setspeed db &#039;Setting %s fan to %s&#039;,13,10,0<br /><br />speed&nbsp;  dd offset off<br />&nbsp; &nbsp; &nbsp; &nbsp; dd offset slow<br />&nbsp; &nbsp; &nbsp; &nbsp; dd offset high<br /><br />fan	dd offset right<br />	dd offset left<br />	<br />left	db &#039;inner&#039;,0<br />right&nbsp;  db &#039;outer&#039;,0<br /><br />high&nbsp; &nbsp; db &#039;high&#039;,0<br />slow&nbsp; &nbsp; db &#039;slow&#039;,0<br />off&nbsp; &nbsp;  db &#039;off&#039;,0<br /><br />svc52A8	db &#039;Smbios: Function not supported&#039;,13,10,0<br />svc52DC db &#039;Smbios: Invalid device (%d)&#039;,13,10,0<br /><br />;******************************************************<br />end<br />&nbsp; &nbsp; &nbsp; &nbsp; <br /></code></pre></div>
    <div class="meta">Posted on 2008-04-27 16:57:11 by yfki</div>
   </div>
   <div class="post" id="post-205180">
    <div class="subject"><a href="#post-205180">Re: Dell Fan Control</a></div>
    <div class="body">and here is the C that it was originally compiled with..<br /><br /><br /><pre><code><br />// I8KFAN.C - just parse the arguments and call &#039;hlcontrol&#039;<br />// Author: MH<br />#include &lt;stdio.h&gt;<br /><br />extern int __cdecl hlcontrol( int fan, int speed );<br /><br />int main( int argc, char* argv&#91;] )<br />{<br />&nbsp; int i;<br />&nbsp; <br />&nbsp; if( argc != 3 )<br />&nbsp; {<br />&nbsp; &nbsp; printf( &quot;Inspiron 8000 fan control utility V1.0 - extracted and optimized by MH\n&quot; );<br />&nbsp; &nbsp; printf( &quot;\nUsage: I8KFAN &lt;inner fan speed&gt; &lt;outer fan speed&gt;\n&quot; );<br />&nbsp; &nbsp; printf( &quot;&nbsp; &nbsp; &nbsp;  Fan speeds: 2=high, 1=slow, 0=off, -=don&#039;t change\n&quot; );<br />&nbsp; &nbsp; printf( &quot;&nbsp; &nbsp; &nbsp;  Example: I8KFAN 1 1 -&gt; set both fans to slow speed\n\n&quot; );<br />&nbsp; &nbsp; return 0;<br />&nbsp; }<br /><br />&nbsp; for( i=1; i&lt;argc; i++ )<br />&nbsp; {<br />&nbsp; &nbsp; switch( *argv<em> )<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; case &#039;0&#039;: <br />&nbsp; &nbsp; &nbsp; case &#039;1&#039;:<br />&nbsp; &nbsp; &nbsp; case &#039;2&#039;: hlcontrol( i==1?1:0, *argv<em>-&#039;0&#039; );<br />&nbsp; &nbsp; &nbsp; 		break;<br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; case &#039;-&#039;:	break;<br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; default:&nbsp; printf( &quot;Ignoring unknown option &#039;%s&#039;\n&quot;, argv<em> );<br />&nbsp; &nbsp; &nbsp; 		break;<br />&nbsp; &nbsp; }<br />&nbsp; }<br />&nbsp; <br />&nbsp; return 0;	<br />}<br /><br /></code></pre></div>
    <div class="meta">Posted on 2008-04-27 17:22:48 by yfki</div>
   </div>
   <div class="post" id="post-205184">
    <div class="subject"><a href="#post-205184">Re: Dell Fan Control</a></div>
    <div class="body">If it&#039;s for Windows then it won&#039;t be trivial to make the &#039;out&#039; instructions work. On Win9x you could use it with no big problems, but on Windows NT you can&#039;t communicate with the devices directly (at least not in any easy/quick way).<br /><br />Or maybe I don&#039;t know something..?</div>
    <div class="meta">Posted on 2008-04-27 18:20:10 by ti_mo_n</div>
   </div>
   <div class="post" id="post-205186">
    <div class="subject"><a href="#post-205186">Re: Dell Fan Control</a></div>
    <div class="body">That ASM source looks like it needs MASM or TASM. It would need translation for NASM to assemble it.</div>
    <div class="meta">Posted on 2008-04-27 18:45:23 by SpooK</div>
   </div>
   <div class="post" id="post-205187">
    <div class="subject"><a href="#post-205187">Re: Dell Fan Control</a></div>
    <div class="body"><pre><code>; FANCTRL.ASM<br />; The fan control functions; extracted from NBFAN.MDM and NBSVC.MDM from <br />; the Dell Diagnostics 1052<br /><br />; Authors: Some unknown Dell engineers using Visual C++; stripped down<br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; and optimized by MH ;-)<br /><br /><br /><br />EXTERN _printf<br /><br />global _hlcontrol<br /><br /><br />;--------------------------------------<br />; _hlcontrol: high level fan control<br />;<br />;&nbsp; In: D:Fan No (0=outer,1=inner)<br />;&nbsp; &nbsp; &nbsp; D:Speed (2=high,1=slow,0=off)<br />; Out: 1:ok 0:error<br />;--------------------------------------<br /><br />_hlcontrol:<br />&nbsp; &nbsp; &nbsp; &nbsp; push ebp<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ebp,esp<br />&nbsp; &nbsp; &nbsp; &nbsp; sub esp,32<br />&nbsp; &nbsp; &nbsp; &nbsp; push ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; push esi<br />&nbsp; &nbsp; &nbsp; &nbsp; push edi<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword [4*eax+speed]<br />&nbsp; &nbsp; &nbsp; &nbsp; push eax			; 3. arg: speed text<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword [4*eax+fan]<br />&nbsp; &nbsp; &nbsp; &nbsp; push eax			; 2. arg: fan no<br />&nbsp; &nbsp; &nbsp; &nbsp; push dword setspeed		; 1. arg: format string<br />&nbsp; &nbsp; &nbsp; &nbsp; call _printf<br />&nbsp; &nbsp; &nbsp; &nbsp; add esp,12<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword 	; fan speed<br />&nbsp; &nbsp; &nbsp; &nbsp; push eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword 	; fan no<br />&nbsp; &nbsp; &nbsp; &nbsp; push eax<br />&nbsp; &nbsp; &nbsp; &nbsp; call genfanstruct<br />&nbsp; &nbsp; &nbsp; &nbsp; add esp,8<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp eax,1<br />&nbsp; &nbsp; &nbsp; &nbsp; je @a5<br />	<br />	push dword err1<br />	call _printf<br />	add esp,4<br />	xor eax,eax<br />	<br />;---------<br />@a5:&nbsp; &nbsp; pop edi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop esi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; leave<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br /><br />;--------------------------------------<br />; genfanstruct: create smbios structure for fan control<br />;<br />;&nbsp; In: D:Fan No (0=outer,1=inner)<br />;&nbsp; &nbsp; &nbsp; D:Speed (2=high,1=slow,0=off)<br />; Out: 1:ok &lt;&gt;1:error<br />;--------------------------------------<br />genfanstruct:<br />&nbsp; &nbsp; &nbsp; &nbsp; push ebp<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ebp, esp<br />&nbsp; &nbsp; &nbsp; &nbsp; sub esp, 20h<br />&nbsp; &nbsp; &nbsp; &nbsp; push ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; push esi<br />&nbsp; &nbsp; &nbsp; &nbsp; push edi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov byte ,0a3h<br />&nbsp; &nbsp; &nbsp; &nbsp; mov byte ,1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov al,byte <br />&nbsp; &nbsp; &nbsp; &nbsp; mov byte ,al<br />&nbsp; &nbsp; &nbsp; &nbsp; mov al,byte <br />&nbsp; &nbsp; &nbsp; &nbsp; mov byte ,al<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ,0<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word ,0<br />&nbsp; &nbsp; &nbsp; &nbsp; lea eax, <br />&nbsp; &nbsp; &nbsp; &nbsp; push eax<br />&nbsp; &nbsp; &nbsp; &nbsp; call smbiosfct<br />&nbsp; &nbsp; &nbsp; &nbsp; add esp,4<br />&nbsp; &nbsp; &nbsp; &nbsp; pop edi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop esi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; leave<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br /><br />;--------------------------------------<br />; smbiosfct: execute commands in smbios structure<br />;<br />;&nbsp; In: D:Pointer to smbios structure<br />; Out: 1:ok &lt;&gt;1:error<br />;--------------------------------------<br />smbiosfct:<br />&nbsp; &nbsp; &nbsp; &nbsp; push ebp<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ebp, esp<br />&nbsp; &nbsp; &nbsp; &nbsp; sub esp, 14h<br />&nbsp; &nbsp; &nbsp; &nbsp; push ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; push esi<br />&nbsp; &nbsp; &nbsp; &nbsp; push edi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , 1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; pushad<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov bx, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov cx, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov dx, word <br />&nbsp; &nbsp; &nbsp; &nbsp; out 0b2h, al<br />&nbsp; &nbsp; &nbsp; &nbsp; out 084h, al<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , bx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , cx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , dx<br />&nbsp; &nbsp; &nbsp; &nbsp; popad<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; xor ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov cx, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; and eax, 0000FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp ecx, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; jne @c1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; xor ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov cx, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; and eax, 0000FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp ecx, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; jne @c1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; xor ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov cx, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; and eax, 0000FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp ecx, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; jne @c1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; xor ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov cx, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; and eax, 0000FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp ecx, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; jne @c1<br />&nbsp; &nbsp; &nbsp; &nbsp; push dword svc52A8<br />&nbsp; &nbsp; &nbsp; &nbsp; call _printf<br />&nbsp; &nbsp; &nbsp; &nbsp; add esp, 4<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , 0<br />;---------<br />@c1:&nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; and eax, 0000FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp eax, 0000FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; jne @c2<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; xor ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov cl, byte <br />&nbsp; &nbsp; &nbsp; &nbsp; push ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; push dword svc52DC<br />&nbsp; &nbsp; &nbsp; &nbsp; call _printf<br />&nbsp; &nbsp; &nbsp; &nbsp; add esp, 8<br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , 0<br />;---------<br />@c2:&nbsp; &nbsp; mov ax, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ecx, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ecx, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ecx, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ax, word <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ecx, dword <br />&nbsp; &nbsp; &nbsp; &nbsp; mov word , ax<br />&nbsp; &nbsp; &nbsp; &nbsp; movsx eax, word <br />&nbsp; &nbsp; &nbsp; &nbsp; test eax, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; je @c4<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; jmp @c5<br />;---------<br />@c4:&nbsp; &nbsp; mov eax, 5<br />;---------<br />@c5:&nbsp; &nbsp; pop edi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop esi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; leave<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />	<br />;******************************************************<br /><br />err1	db &#039;Failed to set fan speed&#039;,13,10,0<br /><br />setspeed db &#039;Setting %s fan to %s&#039;,13,10,0<br /><br />speed&nbsp;  dd off<br />&nbsp; &nbsp; &nbsp; &nbsp; dd slow<br />&nbsp; &nbsp; &nbsp; &nbsp; dd high<br /><br />fan	dd right<br />	dd left<br />	<br />left	db &#039;inner&#039;,0<br />right&nbsp;  db &#039;outer&#039;,0<br /><br />high&nbsp; &nbsp; db &#039;high&#039;,0<br />slow&nbsp; &nbsp; db &#039;slow&#039;,0<br />off&nbsp; &nbsp;  db &#039;off&#039;,0<br /><br />svc52A8	db &#039;Smbios: Function not supported&#039;,13,10,0<br />svc52DC db &#039;Smbios: Invalid device (%d)&#039;,13,10,0<br /><br />;******************************************************</code></pre><br /><br />This will assemble, but I&#039;ve not tested it against your source to see if it works.. Partially cause I don&#039;t plan on trying out an I8K Dell fan control utility that&#039;s been hacked up by some random person, especially when I don&#039;t own a Dell. ;) Could be unforsen side effects from running such code and I&#039;m not a very trusting person. But it&#039;ll create the .obj you need.</div>
    <div class="meta">Posted on 2008-04-27 19:10:01 by Synfire</div>
   </div>
  </div>
 </body>
</html>