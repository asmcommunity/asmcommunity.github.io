<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Q for Nan : Constructor/Destructor call overhead - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=8038" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=116">Windows</a> &raquo; <a href="../?id=8038">Q for Nan : Constructor/Destructor call overhead</a></p>
   <div class="post" id="post-58782">
    <div class="subject"><a href="#post-58782">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body">Hey Nan<br /><br />I've been playing around with my own object framework which was inspired by the work you and Thomas did but I<br />was wondering about the constructor/destructor call overhead.<br /><br />If you have many objects with inheritance and empty constructors/destructors ( apart from the the superclass call )<br />how big would the performance hit be realistically? I thought the virtual calls that your object framework uses would<br />have a fairly heafty penalty but they don't, would the constructor/destructor overhead be similarly insignificant overall?<br /><br />Any insights welcome<br /><br />Maelstrom</div>
    <div class="meta">Posted on 2002-09-19 23:24:07 by Maelstrom</div>
   </div>
   <div class="post" id="post-58965">
    <div class="subject"><a href="#post-58965">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body">Constructors and Destructors are one-time deals.<br /><br />Yes, there is more processor overhead, nesting backwards thru the inheritance tree, but this is minor since its a one time sur-charge.  If you design an object to be created and destory *very* frequently, it shouldnt have an inheritance background to begin with, rather a new base class, writen to handle this kinda operation...<br /><br />I hope this is what your getting at?<br /><br />(( PS: Glad your *inspired* keep me informed if you like ;)  ))<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-09-20 22:51:56 by NaN</div>
   </div>
   <div class="post" id="post-58989">
    <div class="subject"><a href="#post-58989">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body">Cheers Nan :alright:<br /><br />Thats what I wanted to know and I have to agree with what you said.<br /><br />I was trying to eliminate any constructors/destructors that didn't do anything which<br />is fairly easy to do for constructors in my framework but destructors are another matter<br />entirely since they're virtual. I could do it by checking the destructor vptr but I don't <br />think it's worth it.<br /><br />Anyway my framework supports static, virtual, and inline methods as well as embedded and referenced objects.<br /><br /><pre><code><br />.CLASS name, base<br /><br />    m_data1 dd ?<br />    m_data2 dd ?<br /><br />    .OBJECT name, type<br /><br />    .OBJECT_PTR name, type<br /><br />    .STATIC name, argcount<br /><br />    .VIRTUAL name, argcount<br /><br />    .VIRTUAL_PTR name, argcount ; pure virtuals<br /><br />    .INLINE name, dest&#58;=&lt;eax&gt;<br />        mov dest, &#91;this&#93;.m_data1<br />        endm<br /><br />.ENDC<br /></code></pre><br /><br />The argument count doesn't include the 'this' ptr, that is automatically added by the framework.<br /><br />I've tried to automate as much as possible to reduce typing and human error, so :-<br /><br />- class templates are generated by a macro - used to initialize the object when created.<br />- constructors/destructors automatically superclass their base versions.<br />- constructors/destructors automatically initialize/destroy any embedded objects.<br />- methods are automatically found no matter where in the inheritance tree they exist.<br />- methods automatically setup the this ptr<br /><br />Methods are defined with macros to help with automation<br /><br /><pre><code><br />.METHOD class, method, args<br />    ; locals go here<br />    .ENTER<br />    ; your code goes here<br />    .RET val<br />.ENDM<br /></code></pre><br /><br />Objects can be created dynamically or statically and calling methods is easy<br /><br /><pre><code><br />.NEW class, dest<br /><br />.CREATE class, dest <br /><br />.CSomeClass this, method, args<br /></code></pre><br /><br />The same interface will call any method, if you change a static method to a virtual method, simply<br />recompile and it automatically updates - no need to change the code.<br /><br />Literal string and floating point arguments are also supported.<br /><br />:grin:<br />Maelstrom</div>
    <div class="meta">Posted on 2002-09-21 03:06:07 by Maelstrom</div>
   </div>
   <div class="post" id="post-59508">
    <div class="subject"><a href="#post-59508">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body">Im impressed... <br /><br />You truely seem to be on your own path ;) .  I follow what your doing, and would be interested in seeing it sometime...  At anyrate keep up the good work!! Im way to busy to continue my work at the moment, but if your model is superior to ours, you will have my fullest backing ;)<br /><br />My goal was to get the ASM community thinking &quot;objects doesnt *have* to come from M$&quot;, and getting highly tuned ASM classes produced for reusability for mondain things; such as writing an ASM equivalent to a HyperText Link in the client area of some application.  A simple Object can be created to accept a caption and a link on creation, and have the same template spew out as many links as you need.. with no worry of &quot;managing&quot; them all.<br /><br />At any rate, please keep up the work and keep me informed.<br /><br />Good Job.<br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-09-24 22:56:03 by NaN</div>
   </div>
   <div class="post" id="post-59526">
    <div class="subject"><a href="#post-59526">Philosophical discussion about OO implementations.</a></div>
    <div class="body">In my programming language, costructors/destructors are called only for the specified object but not for the ones it inherits.<br /><br />I came to this decision when in a object I needed to include two sub-objects, but only one was really used (basing on certain circumstances), while the other was eventually activated later. To remove the unnecessary overhead (of CPU and eventually allocated heap) I then decided to use this system by default.. which I also find more &quot;clear&quot; and &quot;intuitive&quot;, personally. I will call the constructors/destructors of the sub-objects in the constructor/destructor of the main object, if necessary. For me objects have to be simply data structs with associated inline methods (meant as &quot;macros&quot;), I don't want any extra overhead than I specify there to be. I don't keep any vtable.. for me methods are always simply macros to be <em>inlined</em>. These macros can then pass the &quot;this&quot; pointer to routines that do the big work.. or can call them indirectly via explicitly defined function pointers (here we return functionally to vtables, overriding, etc..). In substance the struct is totally defined by the programmer, and nothing is hiddenly added.<br /><br />A question now.. why languages like C++ don't share the same choice that I've made? I think that any automatism should be removed when it may be detrimental.. and that things should be kept as simple and basic as possible.<br /><br />But I'd like to hear other philosophical views on the subject.<br /><br /><strong>Maelstrom</strong>: congrats for your work.. that extends the already great work made by <strong>NaN</strong> and <strong>Thomas</strong>. :alright:</div>
    <div class="meta">Posted on 2002-09-25 04:16:17 by Maverick</div>
   </div>
   <div class="post" id="post-59600">
    <div class="subject"><a href="#post-59600">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body">Thanks for your comments.<br /><br />I'm still trying to iron out a few problems with my sledgehammer but it seems to work fairly well so far.<br /><br /><strong>Maverick</strong><br /><br />What you described for your OOP intrigues me and I would like to hear more if you don't mind.<br /><br />I'm also for removing as much overhead as possible which is why I implemented inline methods and was trying to eliminate any empty constructors/destructors.<br /><br />The automation I've included in my OOP was done to eliminate human error ( stop me from stuffing up ) in things like the object template which contains the virtual ptrs and is used to initialize the object when it's created - critcal stuff.<br /><br />Also do you think a macro framework is sufficient or should a more advanced object creator app be written to generate the code - without hiding anything of course?<br /><br />As for why C++ or others don't think this way, probably because they don't have to. It's not as if the competition is forcing them to be quicker, only more productive. The 'CPUs are fast enough' excuse seems to be recycled everytime a new processor is released. Just because the CPUs are fast enough to run bloated code doesn't mean that they should have to. Obviously, productivity is the number one concern since that costs money, but what about the end user, shouldn't we get quality code instead of quantity code. Now I'm not saying that these languages suck but imagine how much more powerful they could become with a little TLC in the OOP department.<br /><br />Anyway thats my rant over, I'll release the framework when it's more stable.<br /><br />:grin:<br />Maelstrom</div>
    <div class="meta">Posted on 2002-09-25 19:26:27 by Maelstrom</div>
   </div>
   <div class="post" id="post-59735">
    <div class="subject"><a href="#post-59735">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body">Hi <strong>Maelstrom</strong>,<br /><div class="quote">Also do you think a macro framework is sufficient or should a more advanced object creator app be written to generate the code - without hiding anything of course?</div><br />I would have said the second..but then I've seen the MACRO work of ingenious coders like you, NaN, Thomas, bitRAKE and others.. and I understood I can't reply to this question. ;)<br />I think MACROs would be more comfortable, but a preprocessor more powerful.. I don't know the limit of MACROs, because I've never been a big fan of them, since the most complex (and e.g. nested) implementations quite hide stuff (I prefer to look at a 1:1 source).<br /><br /><div class="quote">As for why C++ or others don't think this way, probably because they don't have to. It's not as if the competition is forcing them to be quicker, only more productive. The 'CPUs are fast enough' excuse seems to be recycled everytime a new processor is released.</div><br />Recently I've discovered the language Oberon, which &quot;impressed&quot; me because it has many important similarities with my own language, at least when it comes to modularity. One thing that disappointed me about it though was that Nicholas Wirth (the creator of Oberon*, Modula* and Pascal languages) **edit: no, it wasn't he the one that added most of the OOP bloat ;) ** went a lot far about OOP overhead when he added this functionality to the latest Oberon version.. killing (for some) an otherwise very interesting language. A lot of coders (wrongly) think that OOP = bloat, or anyway slower than non-OOP, which is not true at all. It's just a more modular, compact, cleaner and sometimes even more efficient (because of the nature of L1 caches, and the locality of reference that OOP promotes) way to express the same identical code.<br /><br /><div class="quote">Just because the CPUs are fast enough to run bloated code doesn't mean that they should have to.</div><br />I couldn't agree more.<br /><br /><div class="quote">Obviously, productivity is the number one concern since that costs money, but what about the end user, shouldn't we get quality code instead of quantity code.</div><br />Yup, but calling by yourself the constructors/destructors of &quot;sub-objects&quot; (sorry for the terminology, I'm quite self-taught) doesn't cost too much development time, in my experience.. and helps having a more direct and intuitive idea of what is really happening.<br /><br /><div class="quote">Now I'm not saying that these languages suck but imagine how much more powerful they could become with a little TLC in the OOP department.</div><br />TLC = ? :)</div>
    <div class="meta">Posted on 2002-09-27 03:32:30 by Maverick</div>
   </div>
   <div class="post" id="post-59738">
    <div class="subject"><a href="#post-59738">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body"><div class="quote"><br />TLC = ? :) </div><br /><br /><ul><br />[*]TLC  Tender Loving Care    <br />[*]TLC  The Learning Channel    <br />[*]TLC  Tables &amp; Ladders &amp; Chairs (pro wrestling)    <br />[*]TLC  Tactical Leaders Course    <br />[*]TLC  Tailored Logistics Corporation (defense contractor specializing in the development of component overhaul kits)    <br />[*]TLC  T-Boz, Left Eye, &amp; Chili (the group TLC)    <br />[*]TLC  Teacher Leadership Council (Mormon Church)    <br />[*]TLC  Teaching/Learning Center    <br />[*]TLC  Team Leadership Center    <br />[*]TLC  Teen Life Conference    <br />[*]TLC  Telecommunication Line Controller    <br />[*]TLC  Telecomunicazioni    <br />[*]TLC  Telephone Line Control    <br />[*]TLC  Ternary Linear Code    <br />[*]TLC  Texas Logistics Corporation    <br />[*]TLC  The Learning Company    <br />[*]TLC  The Library Corporation    <br />[*]TLC  Therapeutic Lifestyle Change    <br />[*]TLC  Thin Layer Chromatography    <br />[*]TLC  Thunderbird Language Center (AGSIM, Glendale, AZ, USA)  <br />[*]TLC  Toastmasters Learning Center    <br />[*]TLC  Tomatoes, Lettuce, and Cheese    <br />[*]TLC  Total Lack of Consideration    <br />[*]TLC  Total Logistic Control    <br />[*]TLC  Total Lung Capacity    <br />[*]TLC  Toyota Land Cruiser    <br />[*]TLC  Trades and Labor Council of Western Australia    <br />[*]TLC  Traffic Light Chart (integrated three-tiered reporting system/format)    <br />[*]TLC  Traffic Load Control    <br />[*]TLC  Trafikledningscentral    <br />[*]TLC  Transformer-rectifier Line Contactor    <br />[*]TLC  Transgender Liberation and Care    <br />[*]TLC  Transmission Line Coupler    <br />[*]TLC  Transport-, Informatik-, Logistik-Consulting GmbH    <br />[*]TLC  Tratado de Libre Comercio (English: NAFTA)    <br />[*]TLC  Trilateral Commission    <br />[*]TLC  Trinity Lutheran College  <br /><br /><br />:grin:</div>
    <div class="meta">Posted on 2002-09-27 03:59:15 by bazik</div>
   </div>
   <div class="post" id="post-59741">
    <div class="subject"><a href="#post-59741">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body">Ah.. now I get it. :grin:</div>
    <div class="meta">Posted on 2002-09-27 04:07:04 by Maverick</div>
   </div>
   <div class="post" id="post-59889">
    <div class="subject"><a href="#post-59889">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body"><strong>Maverick</strong><br /><br /><div class="quote">I would have said the second..but then I've seen the MACRO work of ingenious coders like you, NaN, Thomas, bitRAKE and others.. and I understood I can't reply to this question.</div><br /><br />Awww, you say the nicest things :grin:<br /><br />While it's true a lot can be done with macros, to achieve everything that I would like my object framework to handle will probably require an object creation app. It's not to say that macros couldn't do it, but as you stated, a preprocessor would be more powerful. Just looking for other opinions.<br /><br />When you talk about calling the constructors/destructors of sub-objects do you mean ...<br /><br />1. A class the object is derived from, or<br />2. A class that is embedded into the object<br /><br />In my framework the constructors are called automatically from inside the macro. At present my constructors don't take any arguments but I want them to. The problem with automatically calling them is it makes it difficult to pass arguments down the inheritance tree since the macro doesn't know what to pass. This can easily be fixed by manually calling the constructors, but that means I would need multiple constructors ( for different argument counts,  fairly easy with name mangling ) or always pass arguments even if unnecessary. The only downside is forgetting to call the constructors/destructors and wondering why the code turned into custard, but if that's all I stuffed up I'd be very happy.<br /><br />I think I'll have a play with an object app, I've got lots of ideas in my head and need to get some of them out ( need the room ) :grin:<br /><br />Squashed another bug in the OOP framework with my trusty sledgehammer so it's a little closer to being released, just want to thrash it a bit more.<br /><br />Maelstrom</div>
    <div class="meta">Posted on 2002-09-28 06:21:13 by Maelstrom</div>
   </div>
   <div class="post" id="post-59907">
    <div class="subject"><a href="#post-59907">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body">Hi <strong>Maelstrom</strong>,<br /><div class="quote">When you talk about calling the constructors/destructors of sub-objects do you mean ...<br /><br />1. A class the object is derived from, or<br />2. A class that is embedded into the object</div><br />I mean like having a struct inside another struct. Sorry for my English, it's not my native language. With struct, of course, I mean not only data but also methods.<br /><br />Good luck with your work :alright:<br /><br />Gotta run now. :(</div>
    <div class="meta">Posted on 2002-09-28 15:46:40 by Maverick</div>
   </div>
   <div class="post" id="post-60214">
    <div class="subject"><a href="#post-60214">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body"><div class="quote"><br />While it's true a lot can be done with macros, to achieve everything that I would like my object framework to handle will probably require an object creation app. It's not to say that macros couldn't do it, but as you stated, a preprocessor would be more powerful. Just looking for other opinions.</div><br /><br />Well my standing opinion is go for it ;)<br /><br />When we first designed our model, we deliberately avoided such things.  We wanted it to all be compile time and be more like how the world is use to it.  However, I think it took on a mild welcome cause because of the macro madness.  Its alot of 'new' symbols to get acustom to, and while they are simple, they can be enough to intimidate the currious.<br /><br />That being said, I say give it a try.  Our reasoning seemed sound at the time, we expected people to favour compile time over an EXE that will effectively hide a layer of abstraction from the programmer.  It made sence since we all program in ASM anyways, but perhaps having such things is just what people might prefer.<br /><br />At any rate, there will become more *unique* selection for someone new to all this to try out, and perhaps learn to like.  <br /><br />After all, my friend likes Crown Royal Wiskey, and I like Jameson's Irish Wiskey.  We both insist our's is better than the other's, but at the end of the day, we are both drunk ;)<br /><br />Keep up the good work...<br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-09-30 23:04:34 by NaN</div>
   </div>
   <div class="post" id="post-60632">
    <div class="subject"><a href="#post-60632">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body">Go, go, go, guys.  This is good stuff.</div>
    <div class="meta">Posted on 2002-10-05 09:42:02 by drhowarddrfine</div>
   </div>
   <div class="post" id="post-60641">
    <div class="subject"><a href="#post-60641">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body">Agreed :alright: <br /><br />Perhaps you could also write a convertor for old OOP files? :rolleyes:</div>
    <div class="meta">Posted on 2002-10-05 10:36:54 by Qweerdy</div>
   </div>
   <div class="post" id="post-61001">
    <div class="subject"><a href="#post-61001">Q for Nan : Constructor/Destructor call overhead</a></div>
    <div class="body">Hey guys check out my OOP framework progress thread ( how do you add thread links :confused: )<br /><br />I'll post the framework there when I'm happy with it.<br /><br />And give me some feedback.<br /><br /><strong>Qweerdy</strong><br /><br />I'll look into writing a simple converter, it depends on how much code exists out there that uses<br />NaNs OOP model<br /><br />:alright:<br />Maelstrom</div>
    <div class="meta">Posted on 2002-10-08 21:10:05 by Maelstrom</div>
   </div>
  </div>
 </body>
</html>