<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>What is the purpose of this piece of code? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30604" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=30604">What is the purpose of this piece of code?</a></p>
   <div class="post" id="post-214673">
    <div class="subject"><a href="#post-214673">What is the purpose of this piece of code?</a></div>
    <div class="body">I have this disassembled code generated by MSVC++ 2010. This code is generated everytime i do a function call. This code is placed right after the function finishes saving all the volatile registers onto the stack and right before executing any code inside the function. All i can see is that it tries to save a copy of certain values from one place to another but what is the point of it?<br /><br /><pre><code>009A13FC&nbsp; lea&nbsp; &nbsp; &nbsp; &nbsp;  edi,&nbsp; <br />009A1402&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  ecx,3Bh&nbsp; <br />009A1407&nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  eax,0CCCCCCCCh&nbsp; <br />009A140C&nbsp; rep stos&nbsp; &nbsp; dword ptr es:&nbsp; </code></pre></div>
    <div class="meta">Posted on 2011-07-22 02:23:14 by banzemanga</div>
   </div>
   <div class="post" id="post-214674">
    <div class="subject"><a href="#post-214674">Re: What is the purpose of this piece of code?</a></div>
    <div class="body">It is initializing some variable or variables (which are defined as Locals in this case, so exist in the Stack Frame of the procedure) to a default value, in this case it appears to be a &quot;canary value&quot; to indicate that these variables have not yet been set to a legal value, ie &quot;have not been touched&quot;.<br />It&#039;s quite unlikely that the value CCCCCCCCh would ever be generated accidentally&nbsp; - the odds are one in 4.3 billion, roughly.<br />This is typical behavior for a Debug build, to set things to &#039;some known value&#039; at the start of a run.<br />Some compilers ALWAYS do this - the idea is that there is some runtime debugger in the background who is watching for values who got changed or did not change so they can update their debugging context and/or debugger gui elements.<br />Over time, you&#039;ll end up seeing a lot of these &#039;canary values&#039;... programmers have a sense of humor:<br /><br />0xDEADBEEF<br />0xF00DF00D<br />0x05318008 (boobies, upside down and backwards)<br />etc etc<br /></div>
    <div class="meta">Posted on 2011-07-22 03:12:14 by Homer</div>
   </div>
   <div class="post" id="post-214675">
    <div class="subject"><a href="#post-214675">Re: What is the purpose of this piece of code?</a></div>
    <div class="body">Thanks. You were right about generating values for debugging. All those lines of codes disappeared when i compiled in &#039;release&#039; mode. Your explanation about watching values also made sense. And i liked the canary values you presented. XD</div>
    <div class="meta">Posted on 2011-07-22 05:04:28 by banzemanga</div>
   </div>
   <div class="post" id="post-214676">
    <div class="subject"><a href="#post-214676">Re: What is the purpose of this piece of code?</a></div>
    <div class="body">Somewhat related: You&#039;ll find 0xCAFEBABE used within Java&nbsp; ;)</div>
    <div class="meta">Posted on 2011-07-22 05:53:36 by p1ranha</div>
   </div>
   <div class="post" id="post-214678">
    <div class="subject"><a href="#post-214678">Re: What is the purpose of this piece of code?</a></div>
    <div class="body">I should have noticed straight away since I&#039;ve seen CC so many times.<br />This is the opcode for INT 3 (cpu step breakpoint).<br />So if somehow we try to execute code in memory filled with that value, it would trigger a break in the debugger, at that point. I guess this doesn&#039;t really apply to modern operating systems, it&#039;s one of those relics of the days when code could run from anywhere in memory without any effort.<br /><br />A lot of compilers use this as a filler/padding between procs in the exe, rather than putting zeroes in there, I guess they just shove CC everywhere and wait for the user&#039;s code to run into one :D<br /></div>
    <div class="meta">Posted on 2011-07-22 08:26:39 by Homer</div>
   </div>
  </div>
 </body>
</html>