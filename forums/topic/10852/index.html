<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>arrgh Idt help - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10852" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=10852">arrgh Idt help</a></p>
   <div class="post" id="post-81811">
    <div class="subject"><a href="#post-81811">arrgh Idt help</a></div>
    <div class="body">ive tried for at lest 5 months how? to get a working idt table, i have failed in all attempts, it gets an error and reboots. basicly what i want it to setup all the traps, and have it run my code what i will put in it to clean up say a divide by 0. then all the irq's, then after those i want to use the rest of my ints to use for whatever software code i need to make avalible to the system.<br />heres what i have now.<br /><pre><code><br />	MOV EAX, CR0<br />	OR AL, 1<br />	MOV CR0, EAX ; enter protected mode<br />; at this point every thing works fine.<br />;after here i am unsure of where the error is.<br />call  rerouteirqs<br /><br /> mov    edi,0<br />        mov    esi,offset sys_int<br />      setidtl1&#58;<br />        mov    ecx,&#91;esi&#93;<br />        mov    &#91;edi+idts+ 8 +0&#93;, cx<br />        mov   word ptr &#91;edi+idts+ 8 +2&#93;,  10h<br />        mov    cx,8f00h                                  ; D_TRAP<br />        mov  dword ptr &#91;edi+idts+ 8 +4&#93;, ecx<br />        add    esi,4<br />        add    edi,8<br />        cmp    edi,8*256                                  ; 256 entries<br />        jb     setidtl1<br />   <br />   <br />; LOAD IDT<br />         lidt fWORD PTR &#91;cs&#58;idts&#93;; load idt with 16&#58;32 pointer to IDT<br />    mov	ax,0010h	; #2 segment descriptor=data r/w 4G<br />	nop<br />	nop<br />	nop<br />;<br />	mov	ds,ax<br />	mov	es,ax<br />	mov	fs,ax<br />	mov	gs,ax<br />    mov	ss,ax<br />	mov	esp,&#40;2*1024*1024&#41;<br />    cli<br />    sti<br />    int 0FFh; should jmp then return<br />halt1&#58;<br />hlt<br />jmp halt1<br /><br />;;;;;;;;;;;;;;;;;;;;;;;<br />rerouteirqs&#58;<br />   <br />        cli<br />        in      al,21h<br />        mov     ah,al<br />        in      al,0A1h<br />        mov     cx,ax<br />   <br />        mov     al,11h          ; edge, cascade, icw4<br />        out     20h,al<br />        out     0EBh,al<br />        out     0A0h,al<br />        out     0EBh,al<br />   <br />        mov     al,20h<br />        out     21h,al<br />        out     0EBh,al<br />   <br />        add     al,8h<br />        out     0A1h,al<br />        out     0EBh,al<br />   <br />        mov     al,04h<br />        out     21h,al<br />        out     0EBh,al<br />        shr     al,1h<br />        out     0A1h,al<br />        out     0EBh,al<br />        shr     al,1<br />        out     21h,al<br />        out     0EBh,al<br />        out     0A1h,al<br />        out     0EBh,al<br />   <br />        mov     ax,cx<br />        out     0A1h,al<br />        mov     al,ah<br />        out     21h,al<br />        mov     ecx,1000h<br />        cld<br />picl1&#58;  out     0EBh,al<br />        loop    picl1<br />   <br />        cli<br />        mov     al,255              ; mask all irqs<br />        out     0a1h,al<br />        out     21h,al<br />   <br />        ret<br /><br />; ======================<br />; interupt handlers<br />; ======================<br />   idts&#58;<br />      dw  idte-$-1<br />      dd  idts+8<br />      dw  0<br />   <br />dd 8*256 dup&#40;0&#41;<br /><br />idte&#58;<br /><br />  sys_int&#58;<br />   <br />    dd   s0,s1,s2,s3,s4,s5,s6,s7,s8,s9,sa,sb,sc,sd,se,sf<br />   <br />    dd   s10        ,s11        ,i_unknown12,i_unknown13<br />    dd   i_unknown14,i_unknown15,i_unknown16,i_unknown17<br />    dd   i_unknown18,i_unknown19,i_unknown1a,i_unknown1b<br />    dd   i_unknown1c,i_unknown1d,i_unknown1e,i_unknown1f<br />   <br />    dd   irq0  ,irq1  ,p_irq2 ,p_irq3 ,p_irq4 ,p_irq5,p_irq6 ,p_irq7<br />    dd   p_irq8,p_irq9,p_irq10,p_irq11,p_irq12,irqD  ,p_irq14,p_irq15<br />   <br />    dd   i_unknown30,i_unknown31,i_unknown32,i_unknown33<br />    dd   i_unknown34,i_unknown35,i_unknown36,i_unknown37<br />    dd   i_unknown38,i_unknown39,i_unknown3a,i_unknown3b<br />    dd   i_unknown3c,i_unknown3d,i_unknown3e,i_unknown3f<br />   <br />    dd   i_unknown40       ,i_unknown41,i_unknown42,i_unknown43<br />    dd   i_unknown44,i_unknown45,i_unknown46,i_unknown47<br />    dd   i_unknown48,i_unknown49,i_unknown4a,i_unknown4b<br />    dd   i_unknown4c,i_unknown4d,i_unknown4e,i_unknown4f<br />   <br />    dd   i_unknown50,i_unknown51,i_unknown52,i_unknown53<br />    dd   i_unknown54,i_unknown55,i_unknown56,i_unknown57<br />    dd   i_unknown58,i_unknown59,i_unknown5a,i_unknown5b<br />    dd   i_unknown5c,i_unknown5d,i_unknown5e,i_unknown5f<br />   <br />    dd   i_unknown60,i_unknown61,i_unknown62,i_unknown63<br />    dd   i_unknown64,i_unknown65,i_unknown66,i_unknown67<br />    dd   i_unknown68,i_unknown69,i_unknown6a,i_unknown6b<br />    dd   i_unknown6c,i_unknown6d,i_unknown6e,i_unknown6f<br />   <br />    dd   i_unknown70,i_unknown71,i_unknown72,i_unknown73<br />    dd   i_unknown74,i_unknown75,i_unknown76,i_unknown77<br />    dd   i_unknown78,i_unknown79,i_unknown7a,i_unknown7b<br />    dd   i_unknown7c,i_unknown7d,i_unknown7e,i_unknown7f<br />   <br />    dd   i_unknown80,i_unknown81,i_unknown82,i_unknown83<br />    dd   i_unknown84,i_unknown85,i_unknown86,i_unknown87<br />    dd   i_unknown88,i_unknown89,i_unknown8a,i_unknown8b<br />    dd   i_unknown8c,i_unknown8d,i_unknown8e,i_unknown8f<br />   <br />    dd   i_unknown90,i_unknown91,i_unknown92,i_unknown93<br />    dd   i_unknown94,i_unknown95,i_unknown96,i_unknown97<br />    dd   i_unknown98,i_unknown99,i_unknown9a,i_unknown9b<br />    dd   i_unknown9c,i_unknown9d,i_unknown9e,i_unknown9f<br />   <br />    dd   i_unknowna0,i_unknowna1,i_unknowna2,i_unknowna3<br />    dd   i_unknowna4,i_unknowna5,i_unknowna6,i_unknowna7<br />    dd   i_unknowna8,i_unknowna9,i_unknownaa,i_unknownab<br />    dd   i_unknownac,i_unknownad,i_unknownae,i_unknownaf<br />   <br />    dd   i_unknownb0,i_unknownb1,i_unknownb2,i_unknownb3<br />    dd   i_unknownb4,i_unknownb5,i_unknownb6,i_unknownb7<br />    dd   i_unknownb8,i_unknownb9,i_unknownba,i_unknownbb<br />    dd   i_unknownbc,i_unknownbd,i_unknownbe,i_unknownbf<br />   <br />    dd   i_unknownc0,i_unknownc1,i_unknownc2,i_unknownc3<br />    dd   i_unknownc4,i_unknownc5,i_unknownc6,i_unknownc7<br />    dd   i_unknownc8,i_unknownc9,i_unknownca,i_unknowncb<br />    dd   i_unknowncc,i_unknowncd,i_unknownce,i_unknowncf<br />   <br />    dd   i_unknownd0,i_unknownd1,i_unknownd2,i_unknownd3<br />    dd   i_unknownd4,i_unknownd5,i_unknownd6,i_unknownd7<br />    dd   i_unknownd8,i_unknownd9,i_unknownda,i_unknowndb<br />    dd   i_unknowndc,i_unknowndd,i_unknownde,i_unknowndf<br />   <br />    dd   i_unknowne0,i_unknowne1,i_unknowne2,i_unknowne3<br />    dd   i_unknowne4,i_unknowne5,i_unknowne6,i_unknowne7<br />    dd   i_unknowne8,i_unknowne9,i_unknownea,i_unknowneb<br />    dd   i_unknownec,i_unknowned,i_unknownee,i_unknownef<br />   <br />    dd   i_unknownf0,i_unknownf1,i_unknownf2,i_unknownf3<br />    dd   i_unknownf4,i_unknownf5,i_unknownf6,i_unknownf7<br />    dd   i_unknownf8,i_unknownf9,i_unknownfa,i_unknownfb<br />    dd   i_unknownfc,i_unknownfd,i_unknownfe,i_unknownff<br /><br />s0&#58;<br />        push   0<br />        jmp   errorhandle<br />s1&#58;<br />        push   1<br />        jmp   errorhandle<br />s2&#58;<br />        push   2<br />        jmp   errorhandle<br />s3&#58;<br />        push   3<br />        mov   eax,3<br />        jmp   errorhandle<br />s4&#58;<br />        push   4<br />        mov   eax,4<br />        jmp   errorhandle<br />s5&#58;<br />        push   5<br />        jmp   errorhandle<br />s6&#58;<br />        push   6<br />        jmp   errorhandle<br />        s7&#58;<br />        push   7<br />        jmp   errorhandle<br />s8&#58;<br />        push   8<br />        jmp   errorhandle<br />s9&#58;<br />        push   9<br />        jmp   errorhandle<br />sa&#58;<br />        push  0Ah<br />        jmp   errorhandle<br />sb&#58;<br />        push  0bh<br />        jmp   errorhandle<br />sc&#58;<br />        push  0ch<br />        jmp   errorhandle<br />sd&#58;<br />        push  0dh<br />        jmp   errorhandle<br />se&#58;<br />        push  0eh<br />        jmp   errorhandle<br />sf&#58;<br />        push  0fh<br />        jmp   errorhandle<br />s10&#58;<br />        push  10h<br />        jmp   errorhandle<br />s11&#58;<br />        push  11h<br />        jmp   errorhandle<br />irqD&#58;<br />   <br />     cli<br />     pusha<br />   <br />     mov   cx,ds<br />     mov   ax,10h<br />     mov   ds,ax<br />     mov   es,ax<br />     mov   fs,ax<br />     mov   gs,ax<br />   <br />     mov   dx,0f0h<br />     mov   al,0<br />     out   dx,al<br />   <br />     mov   dx,0a0h<br />     mov   al,20h<br />     out   dx,al<br />     mov   dx,20h<br />     out   dx,al<br />   <br />     mov   ds,cx<br />     mov   es,cx<br />     mov   fs,cx<br />     mov   gs,cx<br />   <br />     popa<br />     iret<br />irq0&#58;<br />     cli                       ; 6-9<br />     pusha                     ; 5<br />     mov   edi,0               ; 1<br />     call  irqhandler          ; 2/5<br />     popa                      ; 5-9<br />     iret                      ; 5/8<br />irq1&#58;<br />     cli                       ; 6-9<br />     pusha                     ; 5<br />     mov   edi,1               ; 1<br />     call  irqhandler          ; 2/5<br />     popa                      ; 5-9<br />     iret                      ; 5/8<br /><br />p_irq2&#58;<br />     cli                       ; 6-9<br />     pusha                     ; 5<br />     mov   edi,2               ; 1<br />     call  irqhandler          ; 2/5<br />     popa                      ; 5-9<br />     iret                      ; 5/8<br />   <br />p_irq3&#58;<br />     cli<br />     pusha<br />     mov   edi,3<br />     call  irqhandler<br />     popa<br />     iret<br />   <br />p_irq4&#58;<br />     cli<br />     pusha<br />     mov   edi,4<br />     call  irqhandler<br />     popa<br />     iret<br />   <br />p_irq5&#58;<br />     cli<br />     pusha<br />     mov   edi,5<br />     call  irqhandler<br />     popa<br />     iret<br />   <br />p_irq6&#58;<br />     cli<br />     pusha<br />     mov   edi,6<br />     call  irqhandler<br />     popa<br />     iret<br />   <br />p_irq7&#58;<br />     cli<br />     pusha<br />     mov   edi,7<br />     call  irqhandler<br />     popa<br />     iret<br />   <br />p_irq8&#58;<br />     cli<br />     pusha<br />     mov   edi,8<br />     call  irqhandler<br />     popa<br />     iret<br />   <br />p_irq9&#58;<br />     cli<br />     pusha<br />     mov   edi,9<br />     call  irqhandler<br />     popa<br />     iret<br />   <br />p_irq10&#58;<br />     cli<br />     pusha<br />     mov   edi,10<br />     call  irqhandler<br />     popa<br />     iret<br />   <br />p_irq11&#58;<br />     cli<br />     pusha<br />     mov   edi,11<br />     call  irqhandler<br />     popa<br />     iret<br />   <br />p_irq12&#58;<br />     cli<br />     pusha<br />     mov   edi,12<br />     call  irqhandler<br />     popa<br />     iret<br />   <br />p_irq13&#58;<br />     cli<br />     pusha<br />     mov   edi,13<br />     call  irqhandler<br />     popa<br />     iret<br />   <br />p_irq14&#58;<br />     cli<br />     pusha<br />     mov   edi,14<br />     call  irqhandler<br />     popa<br />     iret<br />   <br />p_irq15&#58;<br />     cli<br />     pusha<br />     mov   edi,15<br />     call  irqhandler<br />     popa<br />     iret<br />     <br />irqhandler&#58;<br />   <br />     push   edi<br />   <br />     mov    cx,ds            ; 1<br />     mov    ax,10h       ; 1<br />     mov    ds,ax            ; 1<br />     mov    es,ax            ; 1<br />     mov    fs,ax            ; 1<br />     mov    gs,ax            ; 1<br />   <br />     mov    esi,edi          ; 1<br />     shl    esi,6            ; 1<br />     add    esi,irq00read    ; 1<br />     shl    edi,12           ; 1<br />     add    edi,2E0000h<br />   <br />   irqnewread&#58;<br />   <br />     mov    dx,&#91;esi&#93;         ; 2+<br />   <br />     cmp    dx,0             ; 1<br />     jz     irqover<br />     cmp   BYTE PTR &#91;esi+3&#93;, 1   ; 2     ; byte read<br />     jne    noirqbyte        ; 4-11<br />   <br />     in     al,dx<br />   <br />     mov    edx,&#91;edi&#93;<br />     cmp    edx,4000<br />     je     irqfull<br />     mov    ebx,edi<br />     add    ebx,10h<br />     add    ebx,edx<br />     mov    &#91;ebx&#93;,al<br />     add    edx,1<br />     mov    &#91;edi&#93;,edx<br />   <br />     add    esi,4<br />     jmp    irqnewread<br />   <br />   noirqbyte&#58;<br />   <br />   <br />     cmp   BYTE PTR &#91;esi+3&#93;, 2     ; word read<br />     jne    noirqword<br />   <br />     in     ax,dx<br />   <br />     mov    edx,&#91;edi&#93;<br />     cmp    edx,4000<br />     je     irqfull<br />     mov    ebx,edi<br />     add    ebx,10h<br />     add    ebx,edx<br />     mov    &#91;ebx&#93;,al<br />     add    edx,2<br />     mov    &#91;edi&#93;,edx<br />     add    esi,4<br />     jmp    irqnewread<br />   <br />   noirqword&#58;<br />   irqfull&#58;<br />   irqover&#58;<br />   <br />     mov    ds,cx<br />     mov    es,cx<br />     mov    fs,cx<br />     mov    gs,cx<br />   <br />     mov    al,20h            ; ready for next irq<br />     out    20h,al<br />   <br />     pop    ebx<br />     cmp    ebx,7<br />     jbe    noa0<br />     out    0a0h,al<br />   noa0&#58;<br />   <br />     ret<br /><br />i_unknown10&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown11&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown12&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown13&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown14&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown15&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown16&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown17&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown18&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown19&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown1a&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown1b&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown1c&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown1d&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown1e&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown1f&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />i_unknown20&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown21&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown22&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown23&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown24&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown25&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown26&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown27&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown28&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown29&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown2a&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown2b&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown2c&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown2d&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown2e&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown2f&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />i_unknown30&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown31&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown32&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown33&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown34&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown35&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown36&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown37&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown38&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown39&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown3a&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown3b&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown3c&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown3d&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown3e&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown3f&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />i_unknown40&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown41&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown42&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown43&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown44&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown45&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown46&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown47&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown48&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown49&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown4a&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown4b&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown4c&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown4d&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown4e&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown4f&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />   <br />i_unknown50&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown51&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown52&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown53&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown54&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown55&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown56&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown57&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown58&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown59&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown5a&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown5b&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown5c&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown5d&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown5e&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown5f&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />i_unknown60&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown61&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown62&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown63&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown64&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown65&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown66&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown67&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown68&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown69&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown6a&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown6b&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown6c&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown6d&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown6e&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown6f&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />i_unknown70&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown71&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown72&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown73&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown74&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown75&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown76&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown77&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown78&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown79&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown7a&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown7b&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown7c&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown7d&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown7e&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown7f&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />i_unknown80&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown81&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown82&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown83&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown84&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown85&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown86&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown87&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown88&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown89&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown8a&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown8b&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown8c&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown8d&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown8e&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown8f&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />i_unknown90&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown91&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown92&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown93&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown94&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown95&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown96&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown97&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown98&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown99&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown9a&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown9b&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown9c&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown9d&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown9e&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknown9f&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />i_unknowna0&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowna1&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowna2&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowna3&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowna4&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowna5&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowna6&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowna7&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowna8&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowna9&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownaa&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownab&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownac&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownad&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownae&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownaf&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />i_unknownb0&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownb1&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownb2&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownb3&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownb4&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownb5&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownb6&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownb7&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownb8&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownb9&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownba&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownbb&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownbc&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownbd&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownbe&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownbf&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />i_unknownc0&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownc1&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownc2&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownc3&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownc4&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownc5&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownc6&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownc7&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownc8&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownc9&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownca&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowncb&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowncc&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowncd&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownce&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowncf&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />i_unknownd0&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownd1&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownd2&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownd3&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownd4&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownd5&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownd6&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownd7&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownd8&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownd9&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownda&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowndb&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowndc&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowndd&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownde&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowndf&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />i_unknowne0&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowne1&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowne2&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowne3&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowne4&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowne5&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowne6&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowne7&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowne8&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowne9&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownea&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowneb&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownec&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknowned&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownee&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownef&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />   <br />   <br />   <br />i_unknownf0&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownf1&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownf2&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownf3&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownf4&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownf5&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownf6&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownf7&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownf8&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownf9&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownfa&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownfb&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownfc&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownfd&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownfe&#58;<br />        push   $<br />        jmp   i_u_errorhandle<br />i_unknownff&#58;<br />jmp f<br />f&#58;<br />iret<br />        <br />        <br />i_u_errorhandle&#58;<br />errorhandle&#58;<br />   <br />        iret<br />        <br /><br /><br />irq_owner&#58;       ; process id<br />   <br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />     dd   0<br />   <br />   <br />; on irq read ports<br />   <br />irq00read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq01read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq02read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq03read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq04read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq05read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq06read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq07read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq08read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq09read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq10read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq11read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq12read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq13read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq14read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br />irq15read  dd  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br /></code></pre></div>
    <div class="meta">Posted on 2003-02-14 15:30:27 by Qages</div>
   </div>
   <div class="post" id="post-81889">
    <div class="subject"><a href="#post-81889">arrgh Idt help</a></div>
    <div class="body">Qages ckeck my SOL OS source code<br /><br />at <a target="_blank" href="www.hostileencounter.com">www.hostileencounter.com</a> main page choose SOL OS link  then download source :)<br /><br />I do what you want to do ...<br /><br />i will comment on your code a little but honestly i do not know where the error is and i have no time to check your code as corectly as i should ... please excuse, below are just some tips:<br /><br /><br />Call rerouteirqs just after touching CR0 and switching to protected mode from real mode... most likely will fail! you should intercalate an absoloute jump there to clear CPU prefetch queue... also after switching to protected mode depending on your GDT Table addresses of procedures and labels might change :)<br /><br />SO i suggest you test GDT first and print some simple message on screen from protected mode code (after that jump stuff) to check out that everything is ok<br /><br />You should do this with Interupts Disabled! (the switch to protected mode also)...<br /><br />What is this : dd 8*256 dup(0) right after idts ? are you setting up Interupt Gates in other code...otherwise it looks like to me you have a lot of zero there... and you should not.<br /><br />Besides i dont find where you use the push 0 , push 1 etc in s0: s1: etc.. this could corupt your stack ...<br /><br />My advise : make very very simple tests and steeps, never asumme anything is working until you have some certain way of testing it... besides until you get into GFX mode you could test all in text mode and AFAIK this will work under Bochs or WMVare ... helping you debug it<br /><br />I will try to check it out more closely latter...but read my source code...it might not be as advanced as yours (aka ports array to be read/written on interupts :)  i detect some Meuet style here?) but i works and uses GDT and IDT and deals with IRQ's for mouse,timer,keyboard,FDD ... so at least that could be used</div>
    <div class="meta">Posted on 2003-02-15 01:56:20 by BogdanOntanu</div>
   </div>
   <div class="post" id="post-82024">
    <div class="subject"><a href="#post-82024">arrgh Idt help</a></div>
    <div class="body">thanks, ill check it out.</div>
    <div class="meta">Posted on 2003-02-15 18:02:25 by Qages</div>
   </div>
   <div class="post" id="post-82036">
    <div class="subject"><a href="#post-82036">arrgh Idt help</a></div>
    <div class="body">oh btw yes i was &quot;inspired&quot; from menuet code, i had to change most of it to work in nasm. btw how much time do you have to work on yer own os. i was thinking, wild question, but maby we could team up?, but for mine at least i was planning implementing the main os(features) first insted of gui etc.<br />heres a attachment of how an os project might start out off, feel free to comment on its design.</div>
    <div class="meta">Posted on 2003-02-15 19:39:42 by Qages</div>
   </div>
  </div>
 </body>
</html>