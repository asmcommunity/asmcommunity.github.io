<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>need a suggestion on how to parse this string - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3267" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=3267">need a suggestion on how to parse this string</a></p>
   <div class="post" id="post-21502">
    <div class="subject"><a href="#post-21502">need a suggestion on how to parse this string</a></div>
    <div class="body">i need to parse this string.<br /><br /><strong>111 this is just a test (198.178.42.6.24.235)</strong><br /><br />111 this is just a test (  ; i dont need this text at all<br /><br />198.178.42.6 ;i need this in a buffer<br /><br />24 ;this in another buffer<br /><br />235 ;and this in another buffer<br /><br />) ;i dont need this</div>
    <div class="meta">Posted on 2002-01-28 00:41:56 by smurf</div>
   </div>
   <div class="post" id="post-21506">
    <div class="subject"><a href="#post-21506">need a suggestion on how to parse this string</a></div>
    <div class="body">Hey smurf,  <br /><br />I don't know parsing, but i know how to rig stuff up now ...If all of the strings coming is in that style of format....If it was me I would use StrLen or Lenght and divide it up erase or dump the stuff i don't need into a small buffer and divide the string up that way...<br />Something like something like a copare to get to the next dot....I be back I got get an example maybe that would help..</div>
    <div class="meta">Posted on 2002-01-28 01:21:44 by cmax</div>
   </div>
   <div class="post" id="post-21509">
    <div class="subject"><a href="#post-21509">need a suggestion on how to parse this string</a></div>
    <div class="body">use the Masm32.lib functions, <br />szLeft, szRight, szMid, and Instring.  It makes string parsing very easy, it's almost like vb!<br /><br />JP</div>
    <div class="meta">Posted on 2002-01-28 01:41:37 by Asm_Freak</div>
   </div>
   <div class="post" id="post-21510">
    <div class="subject"><a href="#post-21510">need a suggestion on how to parse this string</a></div>
    <div class="body">Another way of looking at the problem is like:<pre><code>*&#40;N.N.N.N.N.N&#41;*</code></pre>Where <strong>*</strong> means anything, and <strong>N</strong> means a number between 0-255 - everything else is interpreted literally.  This representation helps lead us to an algorithm.  First you need to write a procedure that reads a number from a string and returns a byte, or an error if the number is out of range.  Then just find the &quot;(&quot; and loop six times insuring there is a &quot;.&quot; between the numbers.  Then check for a &quot;)&quot; at the end.  You might want to start over if you encounter and error, or just abort altogether.<br /><br />If you know the &quot;)&quot; comes at the end, then I'd start at the end. ;)</div>
    <div class="meta">Posted on 2002-01-28 01:41:43 by bitRAKE</div>
   </div>
   <div class="post" id="post-21511">
    <div class="subject"><a href="#post-21511">need a suggestion on how to parse this string</a></div>
    <div class="body">smurf,<br /><br />You can use the szMid function from masm32.lib. For example,<br /><pre><code><br />.386<br />.model flat, stdcall<br />option casemap&#58; none<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\masm32.inc<br />include \masm32\include\debug.inc<br /><br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\masm32.lib<br />includelib \masm32\lib\debug.lib<br /><br />.data<br />szText byte &quot;111 this is just a test &#40;198.178.42.6.24.235&#41;&quot;, 0<br />szBuff1 byte 13 dup&#40;0&#41;<br />szBuff2 byte 3 dup&#40;0&#41;<br />szBuff3 byte 4 dup&#40;0&#41;<br /><br />.code<br /><br />start&#58;<br />	invoke szMid, addr szText, addr szBuff1, 25, 12<br />	PrintString szBuff1<br />	invoke szMid, addr szText, addr szBuff2, 38, 2<br />	PrintString szBuff2<br />	invoke szMid, addr szText, addr szBuff3, 41, 3<br />	PrintString szBuff3	<br />    ret                <br />end start<br /></code></pre></div>
    <div class="meta">Posted on 2002-01-28 01:48:30 by vkim</div>
   </div>
   <div class="post" id="post-21514">
    <div class="subject"><a href="#post-21514">I found it</a></div>
    <div class="body">You can rig this up to your use i think..I combinded StrLen and SzCat  from the M32lib so its a straight run...I don't know how to make Szmulcat work but that would be a plus...vKim got the easyest way if you want to use API...I use Write file for double checking because i like it tight.  No Spaces<br /><br />.386<br />.model flat,stdcall<br />option casemap:none<br />WinMain proto :DWORD,:DWORD,:DWORD,:SWORD<br /><br />      include \MASM32\INCLUDE\windows.inc<br />      include \MASM32\INCLUDE\gdi32.inc<br />      include \MASM32\INCLUDE\user32.inc<br />      include \MASM32\INCLUDE\kernel32.inc<br /><br />      includelib \MASM32\LIB\gdi32.lib<br />      includelib \MASM32\LIB\user32.lib<br />      includelib \MASM32\LIB\kernel32.lib<br /> <br /><br />MessageBoxA PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />StrLen  PROTO :DWORD<br />CatString11 PROTO :DWORD<br />wsprintfA PROTO C :DWORD,:VARARG<br />wsprintf equ &lt;wsprintfA&gt;<br /><br />    szText MACRO Name, Text:VARARG<br />        LOCAL lbl<br />          jmp lbl<br />            Name db Text,0<br />          lbl:<br />        ENDM<br /><br />.data<br />MyText            db &quot;C:\What is Really in This Buffer.txt&quot;,0<br /><br />Caption1      db      'Buffer 1',0<br />Caption2      db      'Buffer 2',0<br />Caption3      db      'Buffer 3',0<br /><br />.data?<br /><br />Buffer1       db 12 dup(?)<br />Buffer2       db 12 dup(?)<br />Buffer3       db 5  dup(?)<br /><br />hFile dd ? <br />NumBytesWritten dd ? <br />Bytes dd ? <br />.code<br /> Main:<br /><br />szText String1,  &quot;12345678900&quot;<br />szText String2,  &quot;abcdefghijk&quot;<br />szText String3,  &quot;0123456789&quot;<br /><br />; ..................................................................................................<br /><br /><br />;...................................      ;  Copy String To Buffer WITHOUT lstrcpy  01<br />mov esi, offset String1<br />mov edi, offset Buffer1<br />mov ecx, 3<br />rep movsb<br /><br />mov esi, offset String2<br />mov edi, offset Buffer2<br />mov ecx, 11<br />rep movsb<br /><br /><br />mov eax, offset String3<br />add eax, lengthof String3<br />sub eax, 4<br />invoke lstrcpyA, offset Buffer3, eax<br /><br />invoke CatString11, offset Buffer1<br /><br /><br /><br /><br />invoke    MessageBoxA, NULL, offset Buffer1, offset Caption1, NULL<br /><br />invoke    MessageBoxA, NULL, offset Buffer2, offset Caption2, NULL<br /><br />invoke    MessageBoxA, NULL, offset Buffer3, offset Caption2, NULL<br /><br /><br /><br />invoke CreateFileA,offset MyText,GENERIC_WRITE,NULL,NULL,CREATE_ALWAYS,NULL,NULL<br />        mov hFile, eax<br />            invoke WriteFile, hFile, addr Buffer1, 22, offset NumBytesWritten, 0<br />                    invoke CloseHandle, hFile<br /><br />invoke    ExitProcess,0<br />; ################################<br />; #################################<br /><br />CatString11 proc item:DWORD<br /><br />    push    ebx<br />    mov     eax,item     ; get pointer to string<br />    lea     edx,              ; pointer+3 used in the end<br />  @@:     <br />    mov     ebx,              ; read first 4 bytes<br />    add     eax,11                  ; increment pointer<br />    lea     ecx,    ; subtract 1 from each byte<br />    not     ebx                    ; invert all bytes<br />    and     ecx,ebx                ; and these two<br />    and     ecx,80808080h    <br />;    jz      @B                     ; no zero bytes, continue loop<br />    test    ecx,00008080h          ; test first two bytes<br />    jnz     @F<br />    shr     ecx,16                 ; not in the first 2 bytes<br />   @@:<br />    shl     cl,1                   ; use carry flag to avoid branch<br />    sbb     eax,edx                ; compute length<br />    pop     ebx<br />;   ...............................................................<br />    mov edx, item<br />    mov ecx, offset Buffer2<br />    add edx, eax<br />  @@:<br />    mov al, <br />    mov , al<br />    inc ecx<br />    inc edx<br />    test al, al       ; test for zero<br />    jne @B<br /><br />XOR ECX,ECX<br />XOR EDX,EDX<br /><br /><br />invoke    MessageBoxA, NULL, edx, offset Caption3, NULL<br /><br />    ret<br /><br />CatString11 endp<br /><br />; ###############################<br /><br />;end<br /><br /><br />                end     Main</div>
    <div class="meta">Posted on 2002-01-28 02:00:20 by cmax</div>
   </div>
   <div class="post" id="post-21656">
    <div class="subject"><a href="#post-21656">need a suggestion on how to parse this string</a></div>
    <div class="body">ive came up with some code to do what parsing i needed done. vkim code worked well on a static string but the probelm is my string wont be the same and will change often so using that method wouldnt work well. so now im wondering how inefficient my code is.<br /><br /><pre><code>.586<br />.model flat, stdcall<br />option casemap&#58;none<br />include \masm32\include\windows.inc<br />include \masm32\include\kernel32.inc<br />includelib kernel32.lib<br />include \masm32\include\user32.inc<br />include \masm32\include\masm32.inc<br />includelib user32.lib<br />includelib \masm32\lib\masm32.lib<br /><br />.data<br />info    db &quot;227 Entering Passive Mode &#40;205,164,98,136,18,166&#41;.&quot;,0<br />SetFlag db 0<br /><br />.data?<br />StartPos     dd ?<br />EndPos       dd ?<br />EndPos1      dd ?<br />PeriodPos4   dd ?<br />PeriodBytes4 dd ?<br />PeriodPos5   dd ?<br />PeriodBytes5 dd ?<br />buffer       dd 32 dup &#40;?&#41;<br />buffer1      dd 32 dup &#40;?&#41;<br />buffer2      dd 32 dup &#40;?&#41;<br />buffer3      dd 32 dup &#40;?&#41;<br /><br />.code<br />start&#58;<br /><br />        xor ecx,ecx<br />        lea esi, info<br />MyLoop&#58;<br />        xor eax,eax       <br />        lodsb<br />        push ecx<br />           .if al == 0<br />              jmp StringEnd<br />           .elseif al == 28h<br />              mov StartPos,ecx<br />           .elseif al == 29h<br />              mov EndPos,ecx<br />              mov EndPos1,ecx<br />           .elseif al == 2ch<br />              mov byte ptr &#91;info + ecx&#93;,2eh<br />              inc SetFlag<br />                 .if SetFlag == 4<br />                    mov PeriodPos4,ecx<br />                    mov PeriodBytes4,ecx<br />                    mov edi,StartPos<br />                    sub PeriodBytes4,edi<br />                    dec PeriodBytes4<br />                                        <br />                 .elseif SetFlag == 5<br />                    inc PeriodPos4<br />                    mov PeriodPos5,ecx<br />                    mov PeriodBytes5,ecx<br />                    mov edi,PeriodPos4<br />                    sub PeriodBytes5,edi <br />                 .endif<br /><br />           .endif<br />        pop ecx<br />        inc ecx<br />        jmp MyLoop<br />StringEnd&#58;<br />        inc PeriodPos5<br />        mov edi,PeriodPos5<br />        sub EndPos1,edi<br />        <br />        mov edi,StartPos<br />        sub EndPos,edi<br />        inc StartPos<br />        dec EndPos<br />        invoke szMid, addr info, addr buffer,StartPos,EndPos<br />        invoke szMid, addr info, addr buffer1,StartPos,PeriodBytes4<br />        invoke szMid, addr info, addr buffer2,PeriodPos4,PeriodBytes5<br />        invoke szMid, addr info, addr buffer3,PeriodPos5,EndPos1<br />        invoke MessageBox,0,addr buffer,0,0<br />        invoke MessageBox,0,addr buffer1,0,0<br />        invoke MessageBox,0,addr buffer2,0,0<br />        invoke MessageBox,0,addr buffer3,0,0<br /><br />invoke ExitProcess,NULL<br />end start</code></pre><br /><br />aslo thanks cmax for the code.. just  alittle bit hard for me to follow right now.</div>
    <div class="meta">Posted on 2002-01-28 16:12:54 by smurf</div>
   </div>
   <div class="post" id="post-21679">
    <div class="subject"><a href="#post-21679">need a suggestion on how to parse this string</a></div>
    <div class="body">smurf, <br />please take a look at my (not optimized :) ) code. Looks a bit clearer than yours, and gives the same result :cool: <br /><br /><pre><code><br />; #################################################<br /><br />        .486<br />        .model flat, stdcall<br />        option casemap &#58;none<br /><br />; #################################################<br /><br />        include \masm32\include\windows.inc<br />        include \masm32\include\user32.inc<br />        include \masm32\include\kernel32.inc<br /><br />        includelib \masm32\lib\user32.lib<br />        includelib \masm32\lib\kernel32.lib<br /><br />; #################################################<br /><br /><br /><br />; #################################################<br /><br />    .data<br /><br />         szInfo    db &quot;227 Entering Passive Mode &#40;205,164,98,136,18,166&#41;&quot;, 0<br /><br /><br />; #################################################<br /><br />    .data?<br />          szBuffer1     db 128 dup &#40;?&#41;<br />          szBuffer2     db 128 dup &#40;?&#41;<br />          szBuffer3     db 128 dup &#40;?&#41;<br /><br /><br />; #################################################<br /><br />    .code<br /><br />start&#58;<br /><br />    lea esi, szInfo<br /><br /> @@&#58;<br />    mov al, byte ptr &#91;esi&#93;<br />    inc esi<br />    cmp al, &quot;&#40;&quot;<br />    jne @B<br /><br />    lea edi, szBuffer1<br />    xor ecx, ecx<br /> @@&#58;<br />    mov al, byte ptr &#91;esi&#93;<br />    mov byte ptr &#91;edi&#93;, al<br />    inc esi<br />    inc edi<br /><br />    .if al == &quot;,&quot;<br />        mov byte ptr &#91;edi-1&#93;, &quot;.&quot; ; comment out to use comma instead of dots<br />        inc ecx<br />    .endif<br /><br />    cmp ecx, 4<br />    jne @B<br /><br />    mov byte ptr &#91;edi-1&#93;, 0<br /><br />    lea edi, szBuffer2<br /> @@&#58;<br />    mov al, byte ptr  &#91;esi&#93;<br />    mov byte ptr &#91;edi&#93;, al<br />    inc esi<br />    inc edi<br /><br />    cmp al, &quot;,&quot;<br />    jne @B<br /><br />    mov byte ptr &#91;edi-1&#93;, 0<br /><br />    lea edi, szBuffer3<br /> @@&#58;<br />    mov al, byte ptr  &#91;esi&#93;<br />    mov byte ptr &#91;edi&#93;, al<br />    inc esi<br />    inc edi<br /><br />    cmp al, &quot;&#41;&quot;<br />    jne @B<br /><br />    mov byte ptr &#91;edi-1&#93;, 0<br /><br />    invoke MessageBox, 0, addr szBuffer1, 0, 0<br />    invoke MessageBox, 0, addr szBuffer2, 0, 0<br />    invoke MessageBox, 0, addr szBuffer3, 0, 0<br />    invoke ExitProcess, eax<br /><br />end start<br /><br />; #################################################<br /></code></pre></div>
    <div class="meta">Posted on 2002-01-28 19:04:13 by bazik</div>
   </div>
   <div class="post" id="post-21701">
    <div class="subject"><a href="#post-21701">need a suggestion on how to parse this string</a></div>
    <div class="body">Sounds like exactly what you need is strtok(), but that's in C and I don't think its in the MASM32 library.</div>
    <div class="meta">Posted on 2002-01-28 21:35:16 by peterverstappen</div>
   </div>
   <div class="post" id="post-21705">
    <div class="subject"><a href="#post-21705">need a suggestion on how to parse this string</a></div>
    <div class="body">thanks everyone for the help. bazik thanks for the code its alot better using all the registers instead of  all the varables i was using not only that your code is simply better.</div>
    <div class="meta">Posted on 2002-01-28 22:06:51 by smurf</div>
   </div>
  </div>
 </body>
</html>