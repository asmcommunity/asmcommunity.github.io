<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>STRUCTURE problem (Again !) - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10059" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=10059">STRUCTURE problem (Again !)</a></p>
   <div class="post" id="post-75240">
    <div class="subject"><a href="#post-75240">STRUCTURE problem (Again !)</a></div>
    <div class="body">Ok.. cap in hand time again :<br /><br />This is my STRUCT decleration in an .inc file :<br /><br />BIF                    STRUCT<br /><br />ih                      BITMAPINFOHEADER    &lt;&gt;<br />colours              RGBQUAD 16 dup (&lt;0,0,0,0&gt;)<br /><br />BIF                    ENDS<br /><br />Now I want to initialize such a structure in the .DATA section, And i want to override the default values for the BITMAPINFOHEADER with my own but accept the defaults for the 16 RGBQUADS,so I have tried this :<br /><br />mdibtemp                BIF           {&lt;SIZEOF mbidtemp.ih,BITMAPWIDTH,-BITMAPHEIGTH,1,4,0,0,0,0,16,16&gt;,&lt;&gt;}<br /><br />And this :<br /><br />mdibtemp                BIF           {&lt;SIZEOF mbidtemp.ih,BITMAPWIDTH,-BITMAPHEIGTH,1,4,0,0,0,0,16,16&gt;}<br /><br />And this :<br /><br />mdibtemp                BIF            {SIZEOF mbidtemp.ih,BITMAPWIDTH,-BITMAPHEIGTH,1,4,0,0,0,0,16,16}<br /><br />And various other failed attempts. MASM reports always reports :<br />error A2177: nested structure improperly initialized<br /><br />How do I initialise it correctly folks ?<br /><br />Thanks for your help,<br /><br />CodeBug</div>
    <div class="meta">Posted on 2003-01-09 06:40:49 by CodeBug</div>
   </div>
   <div class="post" id="post-75246">
    <div class="subject"><a href="#post-75246">STRUCTURE problem (Again !)</a></div>
    <div class="body">Well I dont know if you can predefine the structure in that way.<br />I think you need to set the structure inside the structure. <br />Although im not 100% shure that there is not other way.<br /><pre><code>BIF STRUCT<br />ih BITMAPINFOHEADER &lt;SIZEOF BITMAPINFOHEADER ,BITMAPWIDTH,-BITMAPHEIGTH,1,4,0,0,0,0,16,16&gt;<br />colours RGBQUAD 16 dup &#40;&lt;0,0,0,0&gt;&#41;<br />BIF ENDS<br />.data<br />mdibtemp BIF &lt;&gt;</code></pre></div>
    <div class="meta">Posted on 2003-01-09 07:18:59 by natas</div>
   </div>
   <div class="post" id="post-75262">
    <div class="subject"><a href="#post-75262">STRUCTURE problem (Again !)</a></div>
    <div class="body">natas,<br /><br />Thanks for you reply.. but I'm sure I can do it.. taking from my pages of MASM programmers guide ( and here reproduced from <strong>http://webster.cs.ucr.edu/Page_TechDocs/MASMDoc</strong> )<br /><br /><em>Structures as Field Initializers<br /><br />Initializers for structure variables must be enclosed in curly braces or angle brackets, but you can specify overrides with fewer elements than the defaults.<br /><br /><br />This example illustrates the use of default values with structures as field<br />initializers:<br /><br />DISKDRIVES      STRUCT<br />  a1            BYTE ?<br />  b1            BYTE ?<br />  c1            BYTE ?<br />DISKDRIVES      ENDS<br /><br />INFO            STRUCT<br />  buffer        BYTE    100 DUP (?)  <br />  crlf          BYTE    13, 10        <br />  query         BYTE    'Filename: ' ; String &lt;= can override<br />  endmark       BYTE    36           <br />  drives        DISKDRIVES &lt;0, 1, 1&gt;<br />INFO            ENDS<br /><br />info1   INFO    { , , 'Dir' }<br /><br />; Next line illegal since name in query field is too long:<br />; info2  INFO    {&quot;TESTFILE&quot;, , &quot;DirectoryName&quot;}<br /><br />lotsof  INFO    { , , 'file1', , {0,0,0} },<br />                { , , 'file2', , {0,0,1} },<br />                { , , 'file3', , {0,0,2} }</em><br /><br />To me, reading this.. I should be able to achieve my stated aim ?<br /><br />CodeBug</div>
    <div class="meta">Posted on 2003-01-09 09:02:25 by CodeBug</div>
   </div>
   <div class="post" id="post-75269">
    <div class="subject"><a href="#post-75269">STRUCTURE problem (Again !)</a></div>
    <div class="body">CodeBug,<br /><br />in your example from webster.cs.ucr.edu the INFO structure contains a DISKDRIVES structure. Note that the DISKDRIVES structure had been declared <strong>before</strong> its use inside the INFO structure. I guess you need to do the same with your structures. First declare a structure for the 16 RGBQUADs:<br /><pre><code><br />BIFCOLOURS STRUCT<br /><br />    colours RGBQUAD 16 dup &#40;&lt; 0,0,0,0 &gt;&#41;<br /><br />BIFCOLOURS ENDS<br /></code></pre> <br />then use it in the declaration of the BIF struct:<br /><pre><code><br />BIF STRUCT<br /><br />    ih      BITMAPINFOHEADER &lt; &gt;<br />    colrs   BIFCOLOURS &lt; &gt;<br /><br />BIF ENDS<br /></code></pre> <br />and now declare your variables just as you did:<br /><pre><code><br />.DATA<br /><br />mdibtemp BIF &#123;  &lt; SIZEOF BITMAPINFOHEADER,BITMAPWIDTH,-BITMAPHEIGTH,1,4,0,0,0,0,16,16 &gt; &#125;<br />;mdibtemp BIF &#123;  &lt; SIZEOF BITMAPINFOHEADER,BITMAPWIDTH,-BITMAPHEIGTH,1,4,0,0,0,0,16,16 &gt;, &lt;&gt; &#125;<br /></code></pre> <br />Both of these compile (but of course not at the same time).<br /><br /><br />By the way, I replaced the first member of mdibtemp as there was a typo in your original version:<br /><br />m<strong>dib</strong>temp BIF {&lt;SIZEOF m<strong>bid</strong>temp.ih, ...<br /><br />Regards<br /><br />    Frank</div>
    <div class="meta">Posted on 2003-01-09 10:06:26 by Frank</div>
   </div>
   <div class="post" id="post-75276">
    <div class="subject"><a href="#post-75276">STRUCTURE problem (Again !)</a></div>
    <div class="body">Thanks Frank !<br /><br />Got it to work.. BUT.. I don't understand why I had to declare a 'STRUCTURE-of-16 (RGB QUADS)STRUCTURES, before I could use them in the final BIF structure ...<br /><br />RGBQUAD is a standard win32 structure and by doing RGBQUAD 16 dup &lt;&gt;, am I not simply asking for 16 of these to be put into my BIF structure ?<br /><br />Anyhow.. thanks.. your reply got me going anyhow.. I undestand a little bit more now !<br /><br />Codebug</div>
    <div class="meta">Posted on 2003-01-09 11:36:42 by CodeBug</div>
   </div>
   <div class="post" id="post-75283">
    <div class="subject"><a href="#post-75283">STRUCTURE problem (Again !)</a></div>
    <div class="body"><div class="quote"><br />RGBQUAD is a standard win32 structure and by doing RGBQUAD 16 dup &lt;&gt;, am I not simply asking for 16 of these to be put into my BIF structure ?</div><br /><br />I would think so too, but MASM apparently doesn't. Expanding your initial BIF structure leads to this notation (as well as to 14 errors, as documented in the comments):<br /><pre><code><br />BIF STRUCT<br />    ih      BITMAPINFOHEADER &lt;  &gt;<br />    colours RGBQUAD  &lt; 0,0,0,0 &gt;<br />            RGBQUAD  &lt; 0,0,0,0 &gt;<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />            RGBQUAD  &lt; 0,0,0,0 &gt;    ; error A2005&#58; symbol redefinition &#58; rgbBlue<br />BIF ENDS<br /></code></pre><br />Surprisingly, I get no errors when I label each RGBQUAD with a unique name:<br /><pre><code><br />BIF STRUCT<br />    ih      BITMAPINFOHEADER &lt;  &gt;<br />    colour0 RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colour1 RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colour2 RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colour3 RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colour4 RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colour5 RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colour6 RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colour7 RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colour8 RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colour9 RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colourA RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colourB RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colourC RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colourD RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colourE RGBQUAD  &lt; 0,0,0,0 &gt;<br />    colourF RGBQUAD  &lt; 0,0,0,0 &gt;<br />BIF ENDS<br /></code></pre><br />Here everything compiles nicely. But don't ask me why  :-)<br /><br />Frank</div>
    <div class="meta">Posted on 2003-01-09 12:40:55 by Frank</div>
   </div>
   <div class="post" id="post-75286">
    <div class="subject"><a href="#post-75286">STRUCTURE problem (Again !)</a></div>
    <div class="body">Another MASM mystery then perhaps.<br /><br />Cheers Frank !<br /><br />Codebug</div>
    <div class="meta">Posted on 2003-01-09 12:51:06 by CodeBug</div>
   </div>
  </div>
 </body>
</html>