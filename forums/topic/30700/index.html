<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>8051 ASM program for drink mixer - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30700" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=30700">8051 ASM program for drink mixer</a></p>
   <div class="post" id="post-215191">
    <div class="subject"><a href="#post-215191">8051 ASM program for drink mixer</a></div>
    <div class="body">Hello all! I am brand new to this forum and I&#039;m looking to get help programming in assembly. I have an idea put together for a drink mixer machine in my bar/man cave area in my basement and I would like to have it electronically controlled using an 8051 microcontroller. I already have the program algorithm put together in a manner that I think will work but I have very little knowledge on how to actually translate it to any language. I&#039;ve done some JAVA, C, and assembly in the past but I am no where near proficient enough to successfully code my program. <br /><br />I&#039;m running PROVIEW32 for my compiler/assembler and I&#039;m running it on Windows XP 32-bit.<br /><br />What the device does is control a series of solenoid valve that allow/deny liquid slow from a separated set of bottles. I plan on being able to mix drinks for friends and have it set back built-in to the back shelving. You press a single button for a specific drink and the machine fills your cup with the corresponding, pre-programmed liquid mixture. It&#039;s really exiting, I&#039;ve seen similar ideas done before and it seems like an awesome project. I have a prototype built with most of the wiring done and I&#039;ve tested the outlet tubes for each bottle and it works great so far. My first design is to mix four bottles, here is the algorithm I have thus far:<br /><pre><code><br />&nbsp; /initialize main program<br /><br /><br />initialize inputs:<br /><br />	mix_drink_button_0 = p1.0&nbsp; /program addresses certain inputs/outputs to different i/o ports on the microcontroller<br />	mix_drink_button_1 = p1.1<br />	mix_drink_button_2 = p1.2<br />	mix_drink_button_3 = p1.3<br />	mix_drink_button_x = px.x&nbsp; /add as many mix_drink_button&#039;s as you need for output for future modular expansion<br /><br /><br />initialize outputs:<br /><br />	solenoid_valve_0 = p2.0&nbsp; /program addresses certain inputs/outputs to different i/o ports on the microcontroller<br />	solenoid_valve_1 = p2.1<br />	solenoid_valve_2 = p2.2<br />	solenoid_valve_3 = p2.3<br />	solenoid_valve_x = px.x&nbsp; /add as many solenoid_valve&#039;s as you need for output for future modular expansion<br /><br />	lcd_screen<br />		lcd_screen_outputs&nbsp; /program code for lcd screen <br /><br /><br /><br />input_scanner_loop:&nbsp; /program stays in input-scanning loop until drink_mix_button 0, 1, 2, or 3 is pressed, then jump to corresponding mix_drink_subroutine<br />	<br />	if mix_drink_button_0 = 1<br />		jump_to mix_drink_subroutine_0	<br /><br />	if mix_drink_button_1 = 1<br />		jump_to mix_drink_subroutine_1<br /><br />	if mix_drink_button_2 = 1<br />		jump_to mix_drink_subroutine_2<br /><br />	if mix_drink_button_3 = 1<br />		jump_to mix_drink_subroutine_3<br /><br />&nbsp; &nbsp; jump_to: input_scanner_loop<br /><br /><br /><br />mix_drink_subroutine_0:<br /><br />	store_solenoid_valve_#: x = 0&nbsp; /store predetermined solenoid valve number in memory location x, x = valve number<br />	store_solenoid_valve_time: y = ?&nbsp; /store predetermined amount of time in miliseconds in memory location y<br /><br />		jump_to: activate_solenoid_subroutine<br /><br />	store_solenoid_valve_#: x = 2&nbsp; /store predetermined solenoid valve number in memory location x, x = valve number<br />	store_solenoid_valve_time: y = ?&nbsp; /store predetermined amount of time in miliseconds in memory location y<br /><br />		jump_to: activate_solenoid_subroutine	<br /><br />&nbsp; &nbsp; jump_to: input_scanner_loop<br /><br /><br />mix_drink_subroutine_1:<br /><br />	store_solenoid_valve_#: x = 1&nbsp; /store predetermined solenoid valve number in memory location x, x = valve number<br />	store_solenoid_valve_time: y = ?&nbsp; /store predetermined amount of time in miliseconds in memory location y<br /><br />		jump_to: activate_solenoid_subroutine<br /><br />	store_solenoid_valve_#: x = 2&nbsp; /store predetermined solenoid valve number in memory location x, x = valve number<br />	store_solenoid_valve_time: y = ?&nbsp; /store predetermined amount of time in miliseconds in memory location y<br /><br />		jump_to: activate_solenoid_subroutine	<br /><br />	store_solenoid_valve_#: x = 3&nbsp; /store predetermined solenoid valve number in memory location x, x = valve number<br />	store_solenoid_valve_time: y = ?&nbsp; /store predetermined amount of time in miliseconds in memory location y<br /><br />		jump_to: activate_solenoid_subroutine<br /><br />&nbsp; &nbsp; jump_to: input_scanner_loop<br /><br /><br />mix_drink_subroutine_2:<br /><br />	store_solenoid_valve_#: x = 0&nbsp; /store predetermined solenoid valve number in memory location x, x = valve number<br />	store_solenoid_valve_time: y = ?&nbsp; /store predetermined amount of time in miliseconds in memory location y<br /><br />		jump_to: activate_solenoid_subroutine<br /><br />	store_solenoid_valve_#: x = 1&nbsp; /store predetermined solenoid valve number in memory location x, x = valve number<br />	store_solenoid_valve_time: y = ?&nbsp; /store predetermined amount of time in miliseconds in memory location y<br />		<br />		jump_to: activate_solenoid_subroutine<br /><br /><br />	store_solenoid_valve_#: x = 3&nbsp; /store predetermined solenoid valve number in memory location x, x = valve number<br />	store_solenoid_valve_time: y = ?&nbsp; /store predetermined amount of time in miliseconds in memory location y<br />		<br />		jump_to: activate_solenoid_subroutine	<br /><br />&nbsp; &nbsp; jump_to: input_scanner_loop<br /><br /><br />mix_drink_subroutine_3:<br />	<br />	store_solenoid_valve_#: x = 0&nbsp; /store predetermined solenoid valve number in memory location x, x = valve number<br />	store_solenoid_valve_time: y = ?&nbsp; /store predetermined amount of time in miliseconds in memory location y<br /><br />		jump_to: activate_solenoid_subroutine<br /><br />	store_solenoid_valve_#: x = 1&nbsp; /store predetermined solenoid valve number in memory location x, x = valve number<br />	store_solenoid_valve_time: y = ?&nbsp; /store predetermined amount of time in miliseconds in memory location y<br />		<br />		jump_to: activate_solenoid_subroutine<br />	store_solenoid_valve_#: x = 2&nbsp; /store predetermined solenoid valve number in memory location x, x = valve number<br />	store_solenoid_valve_time: y = ?&nbsp; /store predetermined amount of time in miliseconds in memory location y<br /><br />		jump_to: activate_solenoid_subroutine<br /><br />	store_solenoid_valve_#: x = 3&nbsp; /store predetermined solenoid valve number in memory location x, x = valve number<br />	store_solenoid_valve_time: y = ?&nbsp; /store predetermined amount of time in miliseconds in memory location y<br /><br />		jump_to: activate_solenoid_subroutine<br /><br />&nbsp; &nbsp; jump_to: input_scanner_loop<br /><br /><br /><br />activate_solenoid_subroutine:<br /><br />	get_solenoid_valve_#: x = solenoid_valve_x&nbsp; /get solenoid valve number from memory location x, set x as valve number<br />	open_solenoid_valve_x: solenoid_valve_x = 1&nbsp; /enable solenoid valve solenoid_valve_x, where x is the valve number<br />		jump_to: time_delay_subroutine<br /><br />	close_solenoid_valve_x: solenoid_valve_x = 0&nbsp; /disable solenoid valve solenoid_valve_x, where x is the valve number<br /><br />&nbsp; &nbsp; jump_to: <br /><br /><br />	<br />time_delay_subroutine:<br /><br />	count_down_delay = y /predetermined amount obtained from above<br /><br />&nbsp; &nbsp; jump_to: <br /><br /><br />&nbsp; /end of main program<br /></code></pre><br /><br />After this I&#039;m stuck. I&#039;ve coded simple programs using this microcontroller and PROVIEW32 before, but nothing this complicated. How would you guys translate this to something that could be assembled and uploaded to the MC? Any and all help will be greatly appreciated!! In the mean time I&#039;m going to try drilling further into this ASM programming manual I have at my desk. Thanks!</div>
    <div class="meta">Posted on 2011-10-10 19:20:51 by nikolia982003</div>
   </div>
   <div class="post" id="post-215233">
    <div class="subject"><a href="#post-215233">Re: 8051 ASM program for drink mixer</a></div>
    <div class="body">Does anyone have any clues on how to help me on this? Did I say something wrong? :( I&#039;m new here, I&#039;m sorry.</div>
    <div class="meta">Posted on 2011-10-15 09:46:02 by nikolia982003</div>
   </div>
   <div class="post" id="post-215241">
    <div class="subject"><a href="#post-215241">Re: 8051 ASM program for drink mixer</a></div>
    <div class="body">You said nothing wrong.&nbsp; In fact, I liked your idea!&nbsp; :D<br />However, getting help on programming an 8051, even in this community, may be slim pickings.</div>
    <div class="meta">Posted on 2011-10-15 20:01:23 by p1ranha</div>
   </div>
   <div class="post" id="post-215271">
    <div class="subject"><a href="#post-215271">Re: 8051 ASM program for drink mixer</a></div>
    <div class="body">Ohh... Do you guys have a better piece of hardware I might want to use? since posting this I&#039;ve learned a little about arduinos, I think this make work better. They seem to be based off similar tech, but have their own programming language which is easier for newcomers. I&#039;m considering getting the uno board, it seems to be the most popular, what do you guys think?</div>
    <div class="meta">Posted on 2011-10-23 05:35:18 by nikolia982003</div>
   </div>
   <div class="post" id="post-215273">
    <div class="subject"><a href="#post-215273">Re: 8051 ASM program for drink mixer</a></div>
    <div class="body">I have an Arduino (plus a couple bootloaded chips), and I&#039;d say that&#039;s the way to go.&nbsp; The Arduino IDE uses an extension of C, and there&#039;s a HUGE fan base for it, so it would probably give you less trouble and much more support if you had difficulties.&nbsp; Of course, AVR&#039;s can also be programmed in an assembly language too, which will take an AVR chip programmer.<br /><br />The thing is that, unlike C or Java, most microprocessors/controllers have their own unique form of assembly, so x86 assembly programming is very different from 8051 programming.</div>
    <div class="meta">Posted on 2011-10-23 12:24:40 by metallevel</div>
   </div>
   <div class="post" id="post-215277">
    <div class="subject"><a href="#post-215277">Re: 8051 ASM program for drink mixer</a></div>
    <div class="body">I love the Propeller for experiments !!! definitely worth a look for anything hobby related, its probably more powerful than you need, but being able to upload new programs by USB or ethernet is priceless!</div>
    <div class="meta">Posted on 2011-10-23 22:54:43 by Homer</div>
   </div>
   <div class="post" id="post-215278">
    <div class="subject"><a href="#post-215278">Re: 8051 ASM program for drink mixer</a></div>
    <div class="body">The Arduino &quot;programming language&quot; is just C++ with a little initialization code that gets inserted. If you don&#039;t like the Arduino initialization code getting in your way, you&#039;ll find that most AVR freaks use either GCC built for AVR (like WinAVR) or the free Avra assembler. If you are interested in learning more about AVR&#039;s or just want to search over some of the project archives, you should check out the <a target="_blank" href="http://www.avrfreaks.net">AVR Freaks Website</a>.</div>
    <div class="meta">Posted on 2011-10-23 23:45:25 by Synfire</div>
   </div>
   <div class="post" id="post-215282">
    <div class="subject"><a href="#post-215282">Re: 8051 ASM program for drink mixer</a></div>
    <div class="body">Does it have 8 cores? Oh.</div>
    <div class="meta">Posted on 2011-10-25 06:12:35 by Homer</div>
   </div>
   <div class="post" id="post-215283">
    <div class="subject"><a href="#post-215283">Re: 8051 ASM program for drink mixer</a></div>
    <div class="body"><div class="quote">The thing is that, unlike C or Java, most microprocessors/controllers have their own unique form of assembly, so x86 assembly programming is very different from 8051 programming.<br /></div> I think any assembler lang vs any high level lang is very different, but any assembler vs any other assembler not so much.<br />For example, this program, sounds trivial to me; basically a single table lookup with some&nbsp; port control. <br />From someone who has never worked with a MC, never read/wrote any 8051 asm before, here is what I came up with (just by skimming through a ref manual. I didn&#039;t download any emulator for this):<br /><br /><pre><code>; P1 input<br />; P2 display<br />; P3 valve control<br />MAX_NUM_OF_DRINKS equ 4; number of rows<br />NUMBER_OF_LIQUIDS equ 4; number of columns<br />TABLE_ROW_SIZE equ NUMBER_OF_LIQUIDS*1; all data is byte<br />DELAY_MULTIPLIER equ 1234; calculate it yourself<br />		cseg at 0<br />		ljmp Main<br />Main: 	<br /><br />waitLoop:<br />		mov A, P1<br />		jz waitLoop; <br /><br />		; check for for illegal input ( A&gt;MAX_NUM_OF_DRINKS )<br />		CLR C; clear carry<br />		mov B, A<br />		subb A,MAX_NUM_OF_DRINKS<br />		jnc waitLoop<br />		<br />		dec B; make B zero based index<br />		<br />		mov P2,#1 ; signal/print working...<br />		<br />		; calc table row offset<br />		mov A,TABLE_ROW_SIZE	<br />		mul AB<br /><br />		; set data pointer<br />		mov DPTR, #table<br />		<br />		; our number of liquids value<br />		clr R0<br />repeatLoop:<br />			<br />		push A; preserve row offset<br />		<br />		; get table row data<br />		movc A, @A + DPTR<br />		jz timeIs0<br /><br />		;if time not 0 {<br />		mov P3,R0 ; signal open valve N<br /><br />		; make delay<br />		mov B,DELAY_MULTIPLIER	<br />		mul AB<br />delay:<br />		djnz A, delay<br />		<br />		mov P3,R0 ; signal close valve N<br />		; }<br />timeIs0:<br /><br />		pop A; restore row offset<br />		inc A; for single byte data -&gt; inc by 1<br />		<br />		inc R0<br />		cjne R0, #NUMBER_OF_LIQUIDS, repeatLoop<br /><br />		mov P2,#0 ; signal/print finished<br />		<br />		ljmp Main<br />table:<br />&nbsp; &nbsp; &nbsp; &nbsp; ; row 0 - drink 1<br />			;	L0,	L1,	L2,	L3, ..., Ln - time for each liquid , 0 = do not pour<br />		db		2,	0,	1,	0<br />		; row 1 - drink 2<br />		db		5,	4,	2,	0<br />		; row 2 - drink 3<br />		db		1,	3,	3,	4<br />		; row 3 - drink 4<br />		db		1,	0,	2,	0<br />		;etc.<br />&nbsp; &nbsp; &nbsp; &nbsp; end<br /></code></pre><br /><strong>NOTE: THIS IS CODE IS NOT TESTED!</strong><br /><br />So instead of adding code for more drinks, just add a single row of data and change 1-2 equates.<br /><br /></div>
    <div class="meta">Posted on 2011-10-25 13:19:56 by drizz</div>
   </div>
  </div>
 </body>
</html>