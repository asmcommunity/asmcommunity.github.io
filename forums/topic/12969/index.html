<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>CreateDialogIndirectParam - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=12969" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=12969">CreateDialogIndirectParam</a></p>
   <div class="post" id="post-100797">
    <div class="subject"><a href="#post-100797">CreateDialogIndirectParam</a></div>
    <div class="body">Hi all,<br /><br />Okay I played with Hutch's dialog marcos, and butched up with some codes that did not use the api MultiByteToWideChar.<br /><br /><pre><code><br />	invoke	VirtualAlloc,0,1024,MEM_COMMIT,PAGE_READWRITE<br />	push	eax<br />	mov 	edi,eax<br />	mov		DWORD PTR&#91;edi&#93;,  DS_SETFONT or WS_OVERLAPPED or WS_SYSMENU or DS_CENTER<br />	mov		WORD PTR&#91;edi+8&#93;, 0 		;Number of controls<br />	mov		WORD PTR&#91;edi+10&#93;, 50 	;x<br />	mov		WORD PTR&#91;edi+12&#93;, 50 	;y<br />	mov		WORD PTR&#91;edi+14&#93;, 150	;width<br />	mov		WORD PTR&#91;edi+16&#93;, 80 	;height<br />	add		edi,22<br />	mov		ecx,15<br />	lea		esi,caption_<br />	rep		movsw<br />	mov		WORD PTR&#91;edi&#93;, 10<br />	add		edi,2<br />	mov		ecx,14<br />	lea		esi,font_<br />	rep		movsw<br /> 	pop		edi<br />	invoke	CreateDialogIndirectParam,400000h,edi,0,ADDR dlgproc,0<br /></code></pre><br /><br />Looking into the memory, the lpTemplate is the similar as hutch's<br /><div class="quote"><br />00134460  40 08 08 00 00 00 00 00 00 00 32 00 32 00 96 00  @.......2.2.?.<br />00134470  50 00 00 00 00 00 49 00 6E 00 70 00 75 00 74 00  P.....I.n.p.u.t.<br />00134480  20 00 70 00 61 00 73 00 73 00 77 00 6F 00 72 00   .p.a.s.s.w.o.r.<br />00134490  64 00 00 00 0A 00 4D 00 53 00 20 00 53 00 61 00  d.....M.S. .S.a.<br />001344A0  6E 00 73 00 20 00 53 00 65 00 72 00 69 00 66 00  n.s. .S.e.r.i.f.<br /><br />00790000  40 08 08 00 00 00 00 00 00 00 32 00 32 00 96 00  @.......2.2.?.<br />00790010  50 00 00 00 00 00 49 00 6E 00 70 00 75 00 74 00  P.....I.n.p.u.t.<br />00790020  20 00 50 00 61 00 73 00 73 00 77 00 6F 00 72 00   .P.a.s.s.w.o.r.<br />00790030  64 00 00 00 0A 00 4D 00 53 00 20 00 53 00 61 00  d.....M.S. .S.a.<br />00790040  6E 00 73 00 20 00 53 00 65 00 72 00 69 00 66 00  n.s. .S.e.r.i.f.<br /></div><br /><br />Though the CreateDialogIndirectParamA returns the function as ERROR_SUCCESS and eax != 0, my dialog box does not appear. Anyone have any idea? However using hutch's marco, mine does appear. <br /><br /><pre><code><br />004010BE  |&gt; 56             PUSH ESI<br />004010BF  |. 57             PUSH EDI<br />004010C0  |. 68 00040000    PUSH 400                                 ; /MemSize = 400 &#40;1024.&#41;<br />004010C5  |. 6A 40          PUSH 40                                  ; |Flags = GPTR<br />004010C7  |. E8 B0000000    CALL &lt;JMP.&amp;kernel32.GlobalAlloc&gt;         ; \GlobalAlloc<br />004010CC  |. 8BF0           MOV ESI,EAX<br />004010CE  |. 8BFE           MOV EDI,ESI<br />004010D0  |. C707 40080800  MOV DWORD PTR DS&#58;&#91;EDI&#93;,80840<br />004010D6  |. 66&#58;C747 08 000&gt;MOV WORD PTR DS&#58;&#91;EDI+8&#93;,0<br />004010DC  |. 66&#58;C747 0A 320&gt;MOV WORD PTR DS&#58;&#91;EDI+A&#93;,32<br />004010E2  |. 66&#58;C747 0C 320&gt;MOV WORD PTR DS&#58;&#91;EDI+C&#93;,32<br />004010E8  |. 66&#58;C747 0E 960&gt;MOV WORD PTR DS&#58;&#91;EDI+E&#93;,96<br />004010EE  |. 66&#58;C747 10 500&gt;MOV WORD PTR DS&#58;&#91;EDI+10&#93;,50<br />004010F4  |. 83C7 16        ADD EDI,16<br />004010F7  |. 6A 0F          PUSH 0F                                  ; /WideBufSize = F &#40;15.&#41;<br />004010F9  |. 57             PUSH EDI                                 ; |WideCharBuf<br />004010FA  |. 6A FF          PUSH -1                                  ; |StringSize = FFFFFFFF &#40;-1.&#41;<br />004010FC  |. 68 00304000    PUSH vodet.00403000                      ; |StringToMap = &quot;Input password&quot;<br />00401101  |. 6A 01          PUSH 1                                   ; |Options = MB_PRECOMPOSED<br />00401103  |. 6A 00          PUSH 0                                   ; |CodePage = CP_ACP<br />00401105  |. E8 7E000000    CALL &lt;JMP.&amp;kernel32.MultiByteToWideChar&gt; ; \MultiByteToWideChar<br />0040110A  |. 83C7 1E        ADD EDI,1E<br />0040110D  |. 66&#58;C707 0A00   MOV WORD PTR DS&#58;&#91;EDI&#93;,0A<br />00401112  |. 83C7 02        ADD EDI,2<br />00401115  |. 6A 0E          PUSH 0E                                  ; /WideBufSize = E &#40;14.&#41;<br />00401117  |. 57             PUSH EDI                                 ; |WideCharBuf<br />00401118  |. 6A FF          PUSH -1                                  ; |StringSize = FFFFFFFF &#40;-1.&#41;<br />0040111A  |. 68 0F304000    PUSH vodet.0040300F                      ; |StringToMap = &quot;MS Sans Serif&quot;<br />0040111F  |. 6A 01          PUSH 1                                   ; |Options = MB_PRECOMPOSED<br />00401121  |. 6A 00          PUSH 0                                   ; |CodePage = CP_ACP<br />00401123  |. E8 60000000    CALL &lt;JMP.&amp;kernel32.MultiByteToWideChar&gt; ; \MultiByteToWideChar<br />00401128  |. 83C7 1C        ADD EDI,1C<br />0040112B  |. 6A 00          PUSH 0                                   ; /lParam = NULL<br />0040112D  |. 68 50114000    PUSH vodet.00401150                      ; |DlgProc = vodet.00401150<br />00401132  |. 6A 00          PUSH 0                                   ; |hOwner = NULL<br />00401134  |. 56             PUSH ESI                                 ; |pTemplate<br />00401135  |. 68 00004000    PUSH vodet.00400000                      ; |hInst = 00400000<br />0040113A  |. E8 4F000000    CALL &lt;JMP.&amp;user32.DialogBoxIndirectParam&gt;; \DialogBoxIndirectParamA<br />0040113F  |. 50             PUSH EAX<br />00401140  |. 56             PUSH ESI                                 ; /hMem<br />00401141  |. E8 3C000000    CALL &lt;JMP.&amp;kernel32.GlobalFree&gt;          ; \GlobalFree<br />00401146  |. 58             POP EAX<br />00401147  |. 5F             POP EDI<br />00401148  |. 5E             POP ESI<br /></code></pre><br /><br />Anyone has any idea to solve my problem?</div>
    <div class="meta">Posted on 2003-05-02 12:00:50 by roticv</div>
   </div>
   <div class="post" id="post-100852">
    <div class="subject"><a href="#post-100852">CreateDialogIndirectParam</a></div>
    <div class="body">I really dont understand what your trying to do here.. but i can point out that the &quot;P&quot; in &quot;Password&quot; from you unicode dump is different...<br /><br />:grin:  Now aint I usefull :grin:<br />:NaN:</div>
    <div class="meta">Posted on 2003-05-02 21:11:56 by NaN</div>
   </div>
   <div class="post" id="post-100879">
    <div class="subject"><a href="#post-100879">CreateDialogIndirectParam</a></div>
    <div class="body">alignment problems?<br /><br />improper setup?<br /><br />Between DLGTEMPLATE and DLGITEMTEMPLATE structures, you need to DWORD align the memory.<br /><br />see source below, oh and btw, I don't use hutch's macros. If you want me to explain the source, post below. :)<br /><br /><pre><code>pmalign PROC lpMem&#58;DWORD<br />    mov     eax, lpMem<br />    add     eax, 3<br />    shr     eax, 2<br />    shl     eax, 2<br />    ret<br />pmalign ENDP</code></pre>this one needs a pointer to a memory, the one you allocated.<div class="quote">after the DLGTEMPLATE...<br />2 bytes - Menu... 0 for no menu... -1 if you have the menu ID ... or wide<br />character string name of the menu<br />optional 2 bytes - ID for the menu if -1 above<br />2 bytes - classname(set to 0)<br />X bytes - title(wide character string for the title)<br />2 bytes - font size if DS_SETFONT is specified<br />X bytes - Font face if DS_SETFONT is specified(wide character string)<br /><br />if cdit != 0 align here the continue with teh controls<br /><br />DLGITEMTEMPLATE<br />....</div>try also using GetLastError and check what the system error code means.<br /><br />tested on win2k sp3</div>
    <div class="meta">Posted on 2003-05-03 01:58:32 by arkane</div>
   </div>
   <div class="post" id="post-100906">
    <div class="subject"><a href="#post-100906">CreateDialogIndirectParam</a></div>
    <div class="body">Have you tried using WS_VISIBLE?</div>
    <div class="meta">Posted on 2003-05-03 05:49:21 by Jibz</div>
   </div>
   <div class="post" id="post-101029">
    <div class="subject"><a href="#post-101029">CreateDialogIndirectParam</a></div>
    <div class="body">Thanks, jibz. Solve my problem. The problem is with the flags. :)<br /><br />Anyway Arkane, your marco is cute. But I still prefer rep movsw to copy the unicode fields. :alright:</div>
    <div class="meta">Posted on 2003-05-04 01:03:30 by roticv</div>
   </div>
  </div>
 </body>
</html>