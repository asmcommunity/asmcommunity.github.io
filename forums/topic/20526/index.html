<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Irc Masm and You? Help me! please... Newbie - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20526" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=8">Networking</a> &raquo; <a href="../?id=20526">Irc Masm and You? Help me! please... Newbie</a></p>
   <div class="post" id="post-156801">
    <div class="subject"><a href="#post-156801">Irc Masm and You? Help me! please... Newbie</a></div>
    <div class="body">I ask you for a help to finish this version ,please<br /><br /><br />.386   <br />.model flat, stdcall <br />option casemap :none <br /><br />; #########################################################################<br /><br />     <br />      include \masm32\include\windows.inc<br /><br /> <br /><br />      include \masm32\include\user32.inc<br />      include \masm32\include\kernel32.inc<br />      include \MASM32\INCLUDE\gdi32.inc<br />       includelib \masm32\lib\wsock32.lib<br />        include \masm32\include\wsock32.inc<br />      includelib \masm32\lib\user32.lib<br />      includelib \masm32\lib\kernel32.lib<br />      includelib \MASM32\LIB\gdi32.lib<br />; #########################################################################<br /><br /><br /><br />      szText MACRO Name, Text:VARARG<br />        LOCAL lbl<br />          jmp lbl<br />            Name db Text,0<br />          lbl:<br />        ENDM<br /><br />   <br /><br />      m2m MACRO M1, M2<br />        push M2<br />        pop  M1<br />      ENDM<br /><br />     <br /><br />      return MACRO arg<br />        mov eax, arg<br />        ret<br />      ENDM<br /><br />; #########################################################################<br /><br /><br />        WinMain PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />        WndProc PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />        TopXY PROTO   :DWORD,:DWORD<br />        EditControl    PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />        EditSl PROTO  :DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD <br />        PushButton PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />        ; -------------------------------------------------------------------------<br />        midstr PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />        <br />; ?????????????????????????????????????????????????????????????????????????<br /><br />     .const<br /><br />        BUFFER_SIZE  equ 512<br />        ABCDES       equ 256<br />        WM_SOCKET    equ WM_USER+100 <br />        riched1      equ &lt;anytext&gt;<br />        edit_font    equ &lt;SYSTEM_FIXED_FONT&gt;<br /><br />; ?????????????????????????????????????????????????????????????????????????<br /><br />    .data<br />        szDisplayName db &quot;IrcTotaly&quot;,0<br />        CommandLine   dd 0<br />        hWnd          dd 0<br />        hInstance     dd 0<br />        hRichEd       dd ?<br />        HText         dd ?<br />        hBouton       dd ?<br />    ; -------------------------------------------------------------------------<br />        hostname         db &quot;your waiter IRC &quot;,0 <br />        Port             dd 6667<br />        sin sockaddr_in &lt;&gt;<br />        wsadata WSADATA &lt;&gt;<br />    ; -------------------------------------------------------------------------<br />        nick db &quot;NICK Brandy &quot;,10<br />        user db &quot;USER IrcTotaly &quot;,30,&quot;nick.com&quot;,30,&quot; &quot;,30,&quot;Charlie&quot;,30,&quot; :Masm32 Client irc by Fr_Masm_Nb&quot;,10<br />        ping db &quot;PING :&quot;,0<br />        pong db &quot;PONG &quot;,0<br />        Etat dd 0<br />        Confirm db 10<br />; ?????????????????????????????????????????????????????????????????????????<br /><br />    .data?<br />    <br />    sock     dd ? <br />    Dialogue db 256 dup(?)<br />    Buffer1  db 512 dup(?)<br />    Buffer2  db 512 dup(?)<br />    Buffer3  db 512 dup(?)<br />    Buffer4  db 512 dup(?)<br /><br />    .code<br /><br /><br /><br />start:<br />    invoke GetModuleHandle, NULL<br />    mov hInstance, eax<br /><br />    invoke GetCommandLine<br />    mov CommandLine, eax<br /><br />    invoke WinMain,hInstance,NULL,CommandLine,SW_SHOWDEFAULT<br />    <br />    invoke ExitProcess,eax <br /><br />; #########################################################################<br /><br />WinMain proc hInst     :DWORD,<br />             hPrevInst :DWORD,<br />             CmdLine   :DWORD,<br />             CmdShow   :DWORD<br /><br />      <br />        LOCAL wc   :WNDCLASSEX<br />        LOCAL msg  :MSG<br /><br />        LOCAL Wwd  :DWORD<br />        LOCAL Wht  :DWORD<br />        LOCAL Wtx  :DWORD<br />        LOCAL Wty  :DWORD<br /><br />        szText szClassName,&quot;Generic_Class&quot;<br /><br /><br /><br />        mov wc.cbSize,         sizeof WNDCLASSEX<br />        mov wc.style,          CS_HREDRAW or CS_VREDRAW \<br />                               or CS_BYTEALIGNWINDOW<br />        mov wc.lpfnWndProc,    offset WndProc      ; address of WndProc<br />        mov wc.cbClsExtra,     NULL<br />        mov wc.cbWndExtra,     NULL<br />        m2m wc.hInstance,      hInst               ; instance handle<br />        mov wc.hbrBackground,  COLOR_BTNFACE+1     ; system color<br />        mov wc.lpszMenuName,   NULL<br />        mov wc.lpszClassName,  offset szClassName  ; window class name<br />          invoke LoadIcon,hInst,500    ; icon ID   ; resource icon<br />        mov wc.hIcon,          eax<br />          invoke LoadCursor,NULL,IDC_ARROW         ; system cursor<br />        mov wc.hCursor,        eax<br />        mov wc.hIconSm,        0<br /><br />        invoke RegisterClassEx, ADDR wc     ; register the window class<br /><br />       <br /><br />        mov Wwd, 550<br />        mov Wht, 350<br /><br />        invoke GetSystemMetrics,SM_CXSCREEN ; get screen width in pixels<br />        invoke TopXY,Wwd,eax<br />        mov Wtx, eax<br /><br />        invoke GetSystemMetrics,SM_CYSCREEN ; get screen height in pixels<br />        invoke TopXY,Wht,eax<br />        mov Wty, eax<br /><br />      <br />        invoke CreateWindowEx,WS_EX_OVERLAPPEDWINDOW,<br />                              ADDR szClassName,<br />                              ADDR szDisplayName,<br />                              WS_OVERLAPPEDWINDOW,<br />                              Wtx,Wty,Wwd,Wht,<br />                              NULL,NULL,<br />                              hInst,NULL<br /><br />        mov   hWnd,eax  ; copy return value into handle DWORD<br /><br /><br /><br />        invoke ShowWindow,hWnd,SW_SHOWNORMAL      <br />        invoke UpdateWindow,hWnd                  <br /> <br /><br />    StartLoop:<br />      invoke GetMessage,ADDR msg,NULL,0,0         ; get each message<br />      cmp eax, 0                                  ; exit if GetMessage()<br />      je ExitLoop                                 ; returns zero<br />      invoke TranslateMessage, ADDR msg           ; translate it<br />      invoke DispatchMessage,  ADDR msg           ; send it to message proc<br />      jmp StartLoop<br />    ExitLoop:<br /><br />      return msg.wParam<br /><br />WinMain endp<br /><br />; #########################################################################<br /><br />WndProc proc hWin   :DWORD,<br />             uMsg   :DWORD,<br />             wParam :DWORD,<br />             lParam :DWORD<br /><br /><br /><br />    .if uMsg == WM_COMMAND<br />   <br />    <br />   <br /><br />        .if wParam == 1000<br />            invoke SendMessage,hWin,WM_SYSCOMMAND,SC_CLOSE,NULL<br />        .elseif wParam == 500<br />        <br />             invoke closesocket,sock<br />          invoke WSAStartup, 101h,addr wsadata<br />           invoke socket,PF_INET,SOCK_STREAM,0 <br />           mov sock,eax <br />           mov sin.sin_family, AF_INET <br />           invoke htons, Port                                                                                    ; pour r?seau <br />           mov sin.sin_port,ax<br />           invoke gethostbyname, addr hostname<br />           mov eax,<br />           mov eax,<br />           mov eax,<br />           mov sin.sin_addr,eax<br />           invoke WSAAsyncSelect, sock, hWin,WM_SOCKET, FD_ACCEPT+FD_READ+FD_CONNECT+FD_CLOSE<br />           invoke connect,sock,addr sin,sizeof sin<br /><br />        .endif<br /><br />  <br /><br />    .elseif uMsg == WM_CREATE<br /><br /><br />        IFDEF riched1<br />          szText ReDLL,&quot;RICHED32.DLL&quot;<br />        ELSE<br />          szText ReDLL,&quot;RICHED20.DLL&quot;<br />        ENDIF<br />     <br /><br />        invoke LoadLibrary,ADDR ReDLL<br />        <br />        invoke EditControl,hWin,0,0,400,250,800<br />        mov hRichEd, eax<br />        <br />        invoke EditSl,0,0,250,400,20,hWin,700<br />         mov HText, eax<br />   szText BoutonTexte,&quot;Connection&quot;<br />   invoke PushButton,ADDR BoutonTexte,hWin,410,10,100,18,500<br />   mov hBouton,eax<br />   <br /><br />    .elseif uMsg == WM_CLOSE<br /><br /><br />        szText TheText,&quot;Please Confirm Exit&quot;<br />        invoke MessageBox,hWin,ADDR TheText,ADDR szDisplayName,MB_YESNO<br />          .if eax == IDNO<br />            return 0<br />          .endif<br /><br /><br />   .elseif uMsg==WM_SOCKET<br />   <br />      mov eax,lParam<br />      <br />      .if ax==FD_READ<br />      <br />          invoke RtlZeroMemory, addr Buffer1, BUFFER_SIZE<br />          invoke recv, sock, addr Buffer1, BUFFER_SIZE, 0<br />          <br />        ; -------------------------------------------------------------<br /><br />          invoke SendMessage,hRichEd,WM_SETTEXT,0,ADDR Buffer1<br /><br />        ; -------------------------------------------------------------<br />        <br />; ?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?<br /><br />        invoke RtlZeroMemory, addr Buffer2, BUFFER_SIZE<br />        invoke lstrcpyn,ADDR Buffer2,ADDR Buffer1,SIZEOF ping<br />        invoke lstrcmpi,ADDR Buffer2,ADDR ping<br />        or eax,eax<br />        jnz Bon <br />                                                                ;TRAITEMENT DE PING <br />        invoke RtlZeroMemory, addr Buffer3, BUFFER_SIZE<br />        <br />      <br />mov Etat,0   <br />xor edx,edx<br />xor ecx,ecx<br />Label_2:<br /><br />mov al,byte ptr<br /><br />.if al==':'<br />mov Etat,5<br />.endif<br /><br />.if Etat == 5<br />mov byte ptr,al<br />inc edx<br />.endif<br /><br />inc ecx<br />cmp al,0<br />jne Label_2<br /><br /><br /><br />    <br />        invoke RtlZeroMemory, addr Buffer4, BUFFER_SIZE<br />        invoke lstrcat, addr Buffer4,addr pong<br />        invoke lstrcat, addr Buffer4,addr Buffer3<br />        invoke lstrcat, addr Buffer4,addr Confirm<br />        invoke send,sock,ADDR Buffer4,SIZEOF Buffer4,0<br />; ?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?<br />        <br />        Bon:<br />        <br /><br /><br /><br /><br /><br />      .elseif ax==FD_CONNECT<br />     invoke send,sock,ADDR nick,SIZEOF nick,0<br />      invoke send,sock,ADDR user,SIZEOF user,0<br />      .elseif ax==FD_CLOSE<br />     invoke closesocket,sock<br /><br />       .endif<br />      <br /><br /><br />    .elseif uMsg == WM_DESTROY<br /><br /><br />        invoke PostQuitMessage,NULL<br />        return 0 <br />    .endif<br /><br />    invoke DefWindowProc,hWin,uMsg,wParam,lParam<br />  <br /><br />    ret<br /><br />WndProc endp<br /><br />; ########################################################################<br /><br />TopXY proc wDim:DWORD, sDim:DWORD<br /><br /><br />    shr sDim, 1      ; divide screen dimension by 2<br />    shr wDim, 1      ; divide window dimension by 2<br />    mov eax, wDim    ; copy window dimension into eax<br />    sub sDim, eax    ; sub half win dimension from half screen dimension<br /><br />    return sDim<br /><br />TopXY endp<br /><br />; ########################################################################<br /><br />EditControl proc hParent:DWORD, x:DWORD, y:DWORD, wd:DWORD, ht:DWORD, ID:DWORD<br /><br />    LOCAL hEdit:DWORD<br />    LOCAL hFont:DWORD<br /><br />  <br />    IFDEF riched1<br />      szText EditMl,&quot;RICHEDIT&quot;<br />    ELSE<br />      szText EditMl,&quot;RichEdit20a&quot;<br />    ENDIF<br /> <br /><br />  <br />   invoke CreateWindowEx,0,ADDR EditMl,0,<br />                          WS_VISIBLE  or \<br />                          WS_CHILDWINDOW or WS_CLIPSIBLINGS or \<br />                          ES_MULTILINE  or \<br />                           ES_NOHIDESEL or ES_AUTOVSCROLL,<br />                         x,y,wd,ht,hParent,ID,hInstance,NULL<br /><br /><br /><br /><br /><br /><br /><br /><br />    mov hEdit, eax<br /><br />    ;invoke SetWindowLong,hEdit,GWL_WNDPROC,hEditProc<br />    ;mov lpfnhEditProc, eax<br /><br />    invoke GetStockObject,edit_font<br />    invoke SendMessage,hEdit,WM_SETFONT,eax,0<br /><br />    invoke SendMessage,hEdit,EM_EXLIMITTEXT,0,100000000<br />    invoke SendMessage,hEdit,EM_SETOPTIONS,ECOOP_XOR,ECO_SELECTIONBAR<br /><br />    mov eax, hEdit<br />    ret<br /><br />EditControl endp<br /><br />; ?????????????????????????????????????????????????????????????????????????<br /><br /><br />EditSl proc szMsg:DWORD,a:DWORD,b:DWORD,<br />               wd:DWORD,ht:DWORD,hParent:DWORD,ID:DWORD<br /><br /><br />    LOCAL hndle:DWORD<br /><br />    szText slEdit,&quot;EDIT&quot;<br /><br />    invoke CreateWindowEx,WS_EX_CLIENTEDGE,ADDR slEdit,szMsg,<br />                WS_VISIBLE or WS_CHILDWINDOW or \<br />                ES_AUTOHSCROLL or ES_NOHIDESEL,<br />              a,b,wd,ht,hParent,ID,hInstance,NULL<br /><br /> <br />    ret<br /><br />EditSl endp<br /><br />; ?????????????????????????????????????????????????????????????????????????<br /><br /><br />PushButton proc lpText:DWORD,hParent:DWORD,<br />                a:DWORD,b:DWORD,wd:DWORD,ht:DWORD,ID:DWORD<br /><br /><br />    LOCAL hndle:DWORD<br /><br />    szText btnClass,&quot;BUTTON&quot;<br /><br />    invoke CreateWindowEx,0,<br />            ADDR btnClass,lpText,<br />            WS_CHILD or WS_VISIBLE,<br />            a,b,wd,ht,hParent,ID,<br />            hInstance,NULL<br /><br />  <br /><br />    ret<br /><br />PushButton endp<br /><br />; ?????????????????????????????????????????????????????????????????????????<br /><br /><br />midstr proc source:DWORD, substring:DWORD, stPos:DWORD, ln:DWORD<br />push esi<br />push edi<br />cld<br />mov esi, source<br />mov edi, substring<br />add esi, stPos<br />mov ecx, ln<br />rep movsb<br />mov al, 0<br />stosb<br />pop edi<br />pop esi<br />ret<br />midstr endp<br /><br />end start</div>
    <div class="meta">Posted on 2005-02-08 07:31:50 by Fr_MasM_Nb</div>
   </div>
   <div class="post" id="post-156834">
    <div class="subject"><a href="#post-156834">Irc Masm and You? Help me! please... Newbie</a></div>
    <div class="body">What do you need help with?  I do not believe anybody is going to finish something for you, you will not learn that way.</div>
    <div class="meta">Posted on 2005-02-08 21:32:05 by gorshing</div>
   </div>
   <div class="post" id="post-156837">
    <div class="subject"><a href="#post-156837">Irc Masm and You? Help me! please... Newbie</a></div>
    <div class="body">I will help you finish your project on a per-bug basis.<br />Nobody will run with the ball just because you dropped it.<br />Ask for specific things and you will receive them.</div>
    <div class="meta">Posted on 2005-02-08 22:07:20 by Homer</div>
   </div>
   <div class="post" id="post-156856">
    <div class="subject"><a href="#post-156856">Irc Masm and You? Help me! please... Newbie</a></div>
    <div class="body">Fr_MasM_Nb Code Warrior:<br />hello,<br /><br />I want to learn your code, ML passed. but rc file has't been given. I don't know what your code to do.<br /><br />regards.</div>
    <div class="meta">Posted on 2005-02-09 07:24:39 by dcskm4200</div>
   </div>
   <div class="post" id="post-157176">
    <div class="subject"><a href="#post-157176">Irc Masm Progress...</a></div>
    <div class="body">.elseif uMsg==WM_SOCKET<br />   <br />      mov eax,lParam<br />      <br />      .if ax==FD_READ<br />      <br />   <br /><br />invoke RtlZeroMemory, addr Buffer1, 256<br />invoke recv, sock, addr Buffer1,256, 0<br /><br /><br />mov al,byte ptr<br />cmp al,'P'<br />jne NoPing<br />mov al,byte ptr<br />cmp al,'I'<br />jne NoPing<br />mov al,byte ptr<br />cmp al,'N'<br />jne NoPing<br />mov al,byte ptr<br />cmp al,'G'<br />jne NoPing<br />mov al,byte ptr<br />cmp al,' '<br />jne NoPing<br />mov al,byte ptr<br />cmp al,':'<br />jne NoPing<br /><br />mov byte ptr,'O'<br />mov byte ptr,'N'<br />mov byte ptr,'G'<br /><br />Invoke send,sock,addr Buffer1,256,0<br />invoke Beep,455,20<br /><br />NoPing:<br /><br /><br /><br /><br /><br /><br /><br /><br />push    -1<br />push    -1<br />invoke  SendMessage,hRichEd,EM_EXSETSEL,0,esp<br />invoke  SendMessage,hRichEd,EM_REPLACESEL,FALSE,addr Buffer1<br />invoke  SendMessage,hRichEd,EM_SCROLLCARET,0,0<br />invoke  UpdateWindow,hRichEd<br />add     esp,2*4<br /><br /><br /><br /><br /><br />; ?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?=?<br />        <br />      <br />        <br /><br /><br /><br /><br /><br />      .elseif ax==FD_CONNECT<br />     invoke send,sock,ADDR nick,SIZEOF nick,0<br />      invoke send,sock,ADDR user,SIZEOF user,0</div>
    <div class="meta">Posted on 2005-02-19 04:52:42 by Fr_MasM_Nb</div>
   </div>
   <div class="post" id="post-157177">
    <div class="subject"><a href="#post-157177">Irc Masm and You? Help me! please... Newbie</a></div>
    <div class="body">Fr_MasM_Nb,<br /><br />What are you trying to do or rather what help you need? If you are just pasting codes here, then this thread will be locked.</div>
    <div class="meta">Posted on 2005-02-19 05:36:23 by roticv</div>
   </div>
   <div class="post" id="post-157179">
    <div class="subject"><a href="#post-157179">help requetes</a></div>
    <div class="body">I seek a help to treat the requetes waiter IRC</div>
    <div class="meta">Posted on 2005-02-19 06:35:23 by Fr_MasM_Nb</div>
   </div>
   <div class="post" id="post-157184">
    <div class="subject"><a href="#post-157184">Irc Masm and You? Help me! please... Newbie</a></div>
    <div class="body">I see I see.<br /><br />What command do you need help in? I see that you have fixed the PING/PONG msg.</div>
    <div class="meta">Posted on 2005-02-19 09:47:00 by roticv</div>
   </div>
   <div class="post" id="post-157234">
    <div class="subject"><a href="#post-157234">help requetes</a></div>
    <div class="body">I need assistance for the requete:<br /><br />:nickname!guest@2021957900.fr PRIVMSG #channel :08,03What time is it?  -- --------&gt; Buffer2 db 256 dup(?)<br /><br /><br />how to make to find and treat PRIVMSG? <br /><br />xor edx,edx<br />Label:<br />mov al,byte ptr<br />cmp al,'P'<br />jnz Label<br /><br />The method below does not go....<br />I am lost, thank you to bring a help to me .</div>
    <div class="meta">Posted on 2005-02-20 13:05:47 by Fr_MasM_Nb</div>
   </div>
   <div class="post" id="post-157239">
    <div class="subject"><a href="#post-157239">Irc Masm and You? Help me! please... Newbie</a></div>
    <div class="body">xor edx, edx<br />dec ecx<br /><br />Label: <br />inc edx<br />mov al,byte ptr <br />cmp al,'P' <br />jnz Label<br /><br />;)</div>
    <div class="meta">Posted on 2005-02-20 14:31:23 by JimmyClif</div>
   </div>
  </div>
 </body>
</html>