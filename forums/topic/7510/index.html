<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>PROFILE v2.0 released - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=7510" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=7510">PROFILE v2.0 released</a></p>
   <div class="post" id="post-54574">
    <div class="subject"><a href="#post-54574">PROFILE v2.0 released</a></div>
    <div class="body">Here it is..<br /><br />Please, test it and report your CPU (I'm expecially curious about Pentium IV's) and how many cycles does it take on that CPU to execute:<br /><br />from 1 to 18 NOP's ( + a single RET, of course)<br /><br />and this routine:<br /><br />LEA EAX,   ; where n is from 1 to 18<br />.loop:<br />DEC EAX<br />JNZ .loop<br />RET<br /><br />That is, you should report 36 results.</div>
    <div class="meta">Posted on 2002-08-23 04:38:33 by Maverick</div>
   </div>
   <div class="post" id="post-54691">
    <div class="subject"><a href="#post-54691">My 2 cent</a></div>
    <div class="body">In the Licence world Have you ever had it this good.... I don't think so...<br /><br />LICENCE OF USE<br /><br /><span style="font-size:18px>INDIRECT AND DIRECT...</span> <br /><br />Now <strong>HOW FAIR CAN THAT BE :)</strong> <br /><br />Thanks   <strong>Maverick</strong> <br /><br /><span style="font-size:9px>I got a lot of past post reading to do</span> ... I don't think it can get much better than this ...</div>
    <div class="meta">Posted on 2002-08-23 20:56:04 by cmax</div>
   </div>
   <div class="post" id="post-54709">
    <div class="subject"><a href="#post-54709">PROFILE v2.0 released</a></div>
    <div class="body">Maverick:<br />On my Ahtalon 1400Mhz I setup your profile routine as described in the txt file (VirtualAlloc for 8k, copy, call offset 559, push address of routine, call offset 1. Routine was at start of my code segment to ensure page alignment). It worked fine for the 1 to 18 nops plus ret. Here are the results: (The last number is the number of cycles for the left number of nops plus ret )<br />; 0 - 0<br />nop ;1 - 1<br />nop ;2 - 1<br />nop ;3 - 1<br />nop ;4 - 2<br />nop ;5 - 2<br />nop ;6 - 2<br />nop ;7 - 3<br />nop ;8 - 3<br />nop ;9 - 3<br />nop ;10 - 4<br />nop ;11 - 4<br />nop ;12 - 4<br />nop ;13 - 5<br />nop ;14 - 5<br />nop ;15 - 5<br />nop ;16 - 6<br />nop ;17 - 6<br />nop ;18 - 6<br />ret<br /><br />However for the second routine of (Under MASM):<br />lea eax,DWORD PTR <br />_loop:<br />dec eax<br />jnz _loop<br />ret<br /><br />The results, while consistent did not seem valid:<br />n = 1 cycles=-2<br />n = 2 cyces=39<br />n = 3 cycles=40<br />.<br />.<br />.<br />But I didn't test beyond n=3<br /><br />If needed I have attached the source I used (a bit messy)</div>
    <div class="meta">Posted on 2002-08-24 02:12:56 by huh</div>
   </div>
   <div class="post" id="post-54712">
    <div class="subject"><a href="#post-54712">PROFILE v2.0 released</a></div>
    <div class="body">Hi <strong>cmax</strong>: <strong>?</strong> :)<br /><br />Hi <strong>huh</strong>: please, could you attach also the EXE? So before looking at the source I can be sure about how it behaves on my machine.</div>
    <div class="meta">Posted on 2002-08-24 02:25:30 by Maverick</div>
   </div>
   <div class="post" id="post-54786">
    <div class="subject"><a href="#post-54786">PROFILE v2.0 released</a></div>
    <div class="body">Here:</div>
    <div class="meta">Posted on 2002-08-25 01:18:56 by huh</div>
   </div>
   <div class="post" id="post-54868">
    <div class="subject"><a href="#post-54868">PROFILE v2.0 released</a></div>
    <div class="body"><strong>Maverick</strong> , beleive it or not i am not even finish yet... The reason is that i alway find better ways to do things while at the same time trying to really learn the new stuff about the difference between Masm, fasm and just plain old coding.  I got junk everywhere and waiting for my final desioin on how it got to be put back together properly.<br /><br />It's  really weard.... but interesting and it's all i know about ASM, my whole life work since getting involed with it.  It's just so many ways to do things and hard to besure of what to go with.  Give me just a little more time and i will post it.  I am trying to learn PE, and all the stuff that goes with it and i see what you mean by limitations.  Most of that stuff is written in Tasm, Nasm and it's hell to try to do it with Masm... at lease for me.... I been making promise for 2 years now but i got to have it at lease 99.9% prefect......FOR ME IT'S JUST TO MANY DESIONS TO MAKE, and have not mastered the first thing yet so i can't call it until i do.<br /><br />I really want to stick with Masm becauuse i think it is Windows itself that send most of the draw back and if i can do all that Nasm do by learning how to do it with Masm i would be more than happy.... I really want to beat it if POSSIBLE.  I don't know nothing else and afraid i might miss something.<br /><br />See ya soon<br /><br /><br />PS: Sorry i did not get back sooner.  I don't even have a phone now because of a $1200.00 bill....SBC ain't S*it... My bill was 69.00 a month 2500 min but when i moved 15 miles from my service provider (IN THE SAME CITY) SBC was chaging me .10 a minute or more depending on the time of day and i did not realize it.  So i say to he*l  with THEM i get a cell phone someday...<br /><br />Merges, and de-regulations is full of it...</div>
    <div class="meta">Posted on 2002-08-25 19:54:03 by cmax</div>
   </div>
   <div class="post" id="post-54886">
    <div class="subject"><a href="#post-54886">PROFILE v2.0 released</a></div>
    <div class="body">I should have provided in the archive a Test program.. I didn't do it because it was made with my programming language and I'm in the middle of a &quot;anti reverse engineering&quot; rewrite, so it wouldn't have been protected against curious eyes (of side structures).<br /><br />With my <strong>extremely little</strong> free time I thus wrote a FAsm sample application but it doesn't work as expected (while I got a non-releasable Test program perfectly working), so I am trying to understand why my FAsm program doesn't work as expected.<br /><br />Please understand the time I can dedicate to this is ridicolous at the moment, and I can't help it for now. :(</div>
    <div class="meta">Posted on 2002-08-26 01:49:13 by Maverick</div>
   </div>
   <div class="post" id="post-55006">
    <div class="subject"><a href="#post-55006">PROFILE v2.0 released</a></div>
    <div class="body"><div class="quote"><br />Please understand the time I can dedicate to this is ridicolous at the moment, and I can't help it for now. <br /></div><br /><br />I would not worry about that. The general opinion (I know mine is) is of the appreciation of the time and effot you do stick in for this great tool.<br /><br />And something else that may help explain things: (From the AMD manual 22007.pdf)<br /><div class="quote"><br />Although rare, do not place critical code at the border between<br />32-byte aligned code segments and a data segments. Code at<br />the start or end of a data segment should be executed as<br />seldomly as possible or simply padded with garbage.<br /></div><br /><br />This could be why my test2.exe is not working as im on an athalon processor.</div>
    <div class="meta">Posted on 2002-08-27 01:08:32 by huh</div>
   </div>
   <div class="post" id="post-55351">
    <div class="subject"><a href="#post-55351">PROFILE v2.0 released</a></div>
    <div class="body">its &quot;Athlon&quot; my friend :D I have one myself ;)</div>
    <div class="meta">Posted on 2002-08-29 08:13:16 by x86asm</div>
   </div>
   <div class="post" id="post-77004">
    <div class="subject"><a href="#post-77004">Profiler v2 revisited</a></div>
    <div class="body">I just rediscovered profiler 2.<br />I've set it up and it works for procedures which do not take any paameters.<br /><br />As soon as I try a procedure which takes parameters then esp becomes unbalanced.  <br />here's how I call it:<br /><br />for a function without parameters:<br />        push function<br />        call Profiler+1<br />this wokrs like a charm and it returns  the expected results.<br /><br />for a function without parameters:<br />       push param1<br />       push param2<br />       ....<br />       push function<br />       call profiler+1<br /><br />I've got profile defined in it's own sections which I've padded with NULLS to a total size of 8192 bytes.  <br /><br />the procedures are also in their own unique sections. so on loading, everthing is alinged on a page boundary...<br /><br />Anyone knows how to solve the problem It's definitely an unbalanced stack and it occurs inside profiler.<br /><br />thanks.</div>
    <div class="meta">Posted on 2003-01-18 07:37:23 by MArtial_Code</div>
   </div>
   <div class="post" id="post-77009">
    <div class="subject"><a href="#post-77009">PROFILE v2.0 released</a></div>
    <div class="body"><strong></strong><br />There's something damn weird with PROFILE v2.0, but I haven't had any time to investigate it, also because I feel it would take a lot of time.<br /><br />I will explain: I use it *a lot* and everyday, and *never* had *any* single problem or suspect result, it works like charme.. but this happens in my own development tools (a module for my compiler and OS, that is). I then, to share it with You all, wanted to make a version for the various assemblers out there, and here some problem begun. Yes, I noticed some misbehaviours in MASM, etc.. but that don't appear at all in my own internal development environments.<br />I guess it's a non trivial problem.. which needs some deep investigation. I haven't forgotten it, and I hope to fix it sooner or later (read: better sooner), when the load of work I have on my shoulders will give me the chance.<br /><br />In the while, if it works for you (I doubt in MASM), you may stick with the first version of PROFILE, it already worked well anyway, the V2 is there for some other reasons (universality of assembler, but maybe some bug was introduced?), but clearly fails in some program environment. Basically, what my compiler/development environment has in particular that may make it behave differently than an usual development environment for assembly language (in this context) is the separation of code and data in two different memory pages. But I thought I had addressed this aspect completely in V2 also for other assemblers.. perhaps some subtle bug got it. I don't use V2, you may have guessed, since I have my own internal version (but it's for my own compiler and OS and thus it's a bit particular).<br /><br />Anyway.. I should put my hands on it, I know. ;P<br /><br />I will try to save some free time for it.. but I better not promise anything, my life is a mess right now.<br />I'm committed to giving a fully working PROFILE V2 to You all though, don't doubt.<br /><br />PS: I'm sure there's no stack imbalance if used as explained in the docs, please check them carefully, and reports parts of the *docs* you're in doubt with. But, even if so, you report a stack imbalance, I will start investigating from there. Thank you. (maybe an error happened while uploading it :grin: )</div>
    <div class="meta">Posted on 2003-01-18 08:46:03 by Maverick</div>
   </div>
   <div class="post" id="post-77037">
    <div class="subject"><a href="#post-77037">PROFILE v2.0 released</a></div>
    <div class="body">Hi Maverick,  I understand you are very busy so don't sweat it...<br />here's the setup(for masm, I'm certain I followed your instructions to the letter.  <br /><pre><code><br />Each procedure to be profiled is in it own section aligned on a page boundary&#58;<br />Profiler is in it's own section which is two pages&#40;8192&#41; bytes long<br />Profiler is loaded at the begining of the section and the rest is zeroed out<br />Call code at offset 559 only once<br />push args and/or function to be profiled and call code at offset 1<br /></code></pre><br /><br /><pre><code><br />.586<br />.model flat, stdcall<br />option casemap &#58;none <br /><br />include standard.inc  ;<br />DBGWIN_DEBUG_ON =1;equates for vkims debug macros<br />DBGWIN_EXT_INFO =0  ;<br /><br />Main Proto<br /><br />PROFILERSIZE equ 660<br />PROFILERINITOFFSET equ 559<br />PROFILERRESULTOFFSET equ 4096<br /><br />_PROFILERRESULT struct<br />   lowdword dword 0<br />   hidword dword 0<br />_PROFILERRESULT ends<br /><br />externdef ProfilerResult&#58;_PROFILERRESULT<br />externdef Profiler&#58;proc<br /><br />Profile MACRO func&#58;req,args&#58;VARARG ;this macro takes care of things<br />  ifndef PROFILERINITED<br />%echo call Profiler+PROFILERINITOFFSET<br />    call Profiler+PROFILERINITOFFSET ;called only once<br />    PROFILERINITED equ 0<br />  endif<br />  PrintText &quot;Profiling &amp;func&quot;<br />  PrintHex esp,&quot;&#58;before profile&quot; ;print esp before args are pushed <br />  ifnb &lt;args&gt;<br />    y TEXTEQU &lt;&gt;<br />    FOR arg,&lt;&amp;args&gt; ;reverse the order of the parameters<br />      y CATSTR &lt;arg&gt;,&lt;!,&gt;,y<br />    ENDM<br />    y SUBSTR y,1,@SizeStr&#40;%y&#41; - 1<br /> %FOR arg,&lt;y&gt;<br />      push arg ;push parameters<br />%echo push arg<br />    ENDM<br />  endif<br />  push func ;push function address<br />  call &#91;Profiler+1&#93;<br />  PrintHex esp, &quot;&#58;after profile&quot; ;print esp after args are popped<br />  lea eax,&#91;Profiler+PROFILERRESULTOFFSET+0&#93;<br />  mov eax,&#91;eax&#93;<br />  mov ProfilerResult.lowdword,eax<br />  lea eax,&#91;Profiler+PROFILERRESULTOFFSET+4&#93;<br />  mov eax,&#91;eax&#93;<br />  mov ProfilerResult.hidword,eax<br />ENDM<br /><br />.data<br />ProfilerResult _PROFILERRESULT &lt;&gt;<br />text db &quot;move source string pointer into ecx &#40;cannot do memory indirection fromm emory operand&#41;&quot;,0<br />.data?<br />BigBuf db 1000 dup &#40;?&#41;<br />dst dd ?<br />src dd ?<br /><br />.code<br />start&#58;<br />  invoke Main<br />  invoke ExitProcess,0<br /><br />Main proc<br />  Profile aligned  ;profile function<br />  PrintDword ProfilerResult.lowdword,&quot;low dword&quot;<br />  PrintDword ProfilerResult.hidword,&quot;High dword&quot;<br />  PrintLine<br />  Profile RevStr ,offset text,offset BigBuf ;profile function<br />  PrintDword ProfilerResult.lowdword,&quot;low dword&quot;<br />  PrintDword ProfilerResult.hidword,&quot;High dword&quot;<br />  PrintLine<br />  ret<br />Main endp<br /><br />_CODE segment dword 'CODE' ;own section<br />aligned proc<br />  db 18 dup &#40;90H&#41;<br />  ret<br />aligned endp<br />_CODE ends<br /><br />_CODE2 segment dword 'CODE2' ;own section<br />RevStr proc _src&#58;ptr,_dst&#58;ptr<br />  db 18 dup &#40;90H&#41;<br />  ret<br />RevStr endp<br />_CODE2 ends<br /><br />_PROF1 segment dword 'PROFILER'  ;separate section<br />;Profiler proc ;<br />Profiler&#58; ;<br />db 0C3h, 089h, 02Dh, 038h, 000h, 000h, 000h, 0BDh, 000h, 000h, 000h, 000h       <br />db 09Ch, 08Fh, 045h, 03Ch, 089h, 07Dh, 034h, 089h, 075h, 030h, 089h, 055h<br />db 02Ch, 089h, 04Dh, 028h, 089h, 05Dh, 024h, 089h, 045h, 020h, 08Fh, 045h<br />db 010h, 08Bh, 045h, 008h, 00Bh, 045h, 00Ch, 075h, 048h, 0C7h, 005h, 0C1h<br />db 001h, 000h, 000h, 000h, 000h, 000h, 000h, 081h, 02Dh, 0C1h, 001h, 000h<br />db 000h, 0C5h, 001h, 000h, 000h, 0C7h, 045h, 05Ch, 000h, 000h, 000h, 000h<br />db 0C7h, 045h, 058h, 000h, 000h, 000h, 000h, 0C7h, 045h, 014h, 05Bh, 000h<br />db 000h, 000h, 0E9h, 0F6h, 000h, 000h, 000h, 0E8h, 0A8h, 000h, 000h, 000h<br />db 0FFh, 045h, 058h, 083h, 07Dh, 058h, 010h, 072h, 0E6h, 08Bh, 045h, 000h<br />db 08Bh, 055h, 004h, 089h, 045h, 008h, 089h, 055h, 00Ch, 058h, 0A3h, 0C1h<br />db 001h, 000h, 000h, 081h, 02Dh, 0C1h, 001h, 000h, 000h, 0C5h, 001h, 000h<br />db 000h, 0C7h, 045h, 05Ch, 000h, 000h, 000h, 000h, 0C7h, 045h, 058h, 000h<br />db 000h, 000h, 000h, 0C7h, 045h, 014h, 09Fh, 000h, 000h, 000h, 0E9h, 0B2h<br />db 000h, 000h, 000h, 0E8h, 064h, 000h, 000h, 000h, 0FFh, 045h, 058h, 083h<br />db 07Dh, 058h, 010h, 072h, 0E6h, 08Bh, 085h, 000h, 001h, 000h, 000h, 031h<br />db 0DBh, 0B9h, 001h, 000h, 000h, 000h, 039h, 084h, 08Dh, 000h, 001h, 000h<br />db 000h, 076h, 009h, 08Bh, 084h, 08Dh, 000h, 001h, 000h, 000h, 089h, 0CBh<br />db 041h, 03Bh, 04Dh, 05Ch, 072h, 0E8h, 08Bh, 084h, 0DDh, 080h, 000h, 000h<br />db 000h, 08Bh, 094h, 0DDh, 084h, 000h, 000h, 000h, 02Bh, 045h, 008h, 01Bh<br />db 055h, 00Ch, 089h, 045h, 000h, 089h, 055h, 004h, 08Bh, 045h, 040h, 08Bh<br />db 05Dh, 044h, 08Bh, 04Dh, 048h, 08Bh, 055h, 04Ch, 08Bh, 06Dh, 050h, 0FFh<br />db 035h, 054h, 000h, 000h, 000h, 09Dh, 0FFh, 025h, 010h, 000h, 000h, 000h<br />db 08Bh, 045h, 000h, 08Bh, 055h, 004h, 0B9h, 000h, 000h, 000h, 000h, 039h<br />db 084h, 0CDh, 080h, 000h, 000h, 000h, 075h, 012h, 039h, 094h, 0CDh, 084h<br />db 000h, 000h, 000h, 075h, 009h, 0FFh, 084h, 08Dh, 000h, 001h, 000h, 000h<br />db 0EBh, 022h, 041h, 03Bh, 04Dh, 05Ch, 072h, 0DFh, 089h, 084h, 0CDh, 080h<br />db 000h, 000h, 000h, 089h, 094h, 0CDh, 084h, 000h, 000h, 000h, 0C7h, 084h<br />db 08Dh, 000h, 001h, 000h, 000h, 001h, 000h, 000h, 000h, 0FFh, 045h, 05Ch<br />db 0C3h, 08Bh, 07Dh, 034h, 08Bh, 075h, 030h, 08Bh, 045h, 000h, 08Bh, 045h<br />db 020h, 08Bh, 045h, 040h, 0B9h, 004h, 000h, 000h, 000h, 083h, 0ECh, 020h<br />db 08Bh, 004h, 024h, 049h, 075h, 0F7h, 081h, 0C4h, 080h, 000h, 000h, 000h<br />db 0FFh, 075h, 03Ch, 09Dh, 09Bh, 0EBh, 005h, 090h, 090h, 090h, 090h, 090h<br />db 00Fh, 0A2h, 00Fh, 031h, 089h, 045h, 000h, 089h, 055h, 004h, 08Bh, 055h<br />db 02Ch, 08Bh, 04Dh, 028h, 08Bh, 05Dh, 024h, 08Bh, 045h, 020h, 08Bh, 06Dh<br />db 038h, 0C7h, 044h, 024h, 0FCh, 0C0h, 001h, 000h, 000h, 0FFh, 064h, 024h<br />db 0FCh, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h<br />db 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h<br />db 090h, 090h, 090h, 090h, 0E8h, 000h, 000h, 000h, 000h, 0C7h, 044h, 024h<br />db 0FCh, 000h, 002h, 000h, 000h, 0FFh, 064h, 024h, 0FCh, 090h, 090h, 090h<br />db 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h<br />db 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h<br />db 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h<br />db 090h, 090h, 090h, 090h, 090h, 090h, 090h, 090h, 089h, 02Dh, 050h, 000h<br />db 000h, 000h, 0BDh, 000h, 000h, 000h, 000h, 089h, 055h, 04Ch, 089h, 04Dh<br />db 048h, 089h, 05Dh, 044h, 089h, 045h, 040h, 09Ch, 08Fh, 045h, 054h, 09Bh<br />db 00Fh, 0A2h, 00Fh, 031h, 02Bh, 045h, 000h, 01Bh, 055h, 004h, 089h, 045h<br />db 000h, 089h, 055h, 004h, 0FFh, 065h, 014h, 056h, 057h, 0E8h, 05Ah, 000h<br />db 000h, 000h, 081h, 0E7h, 000h, 0F0h, 0FFh, 0FFh, 08Dh, 0B7h, 000h, 010h<br />db 000h, 000h, 001h, 07Fh, 02Fh, 001h, 07Fh, 033h, 001h, 07Fh, 039h, 001h<br />db 07Fh, 03Dh, 001h, 07Fh, 052h, 001h, 07Fh, 077h, 001h, 07Fh, 07Dh, 001h<br />db 0BFh, 081h, 000h, 000h, 000h, 001h, 0BFh, 096h, 000h, 000h, 000h, 001h<br />db 0BFh, 09Dh, 001h, 000h, 000h, 001h, 0BFh, 0C9h, 001h, 000h, 000h, 001h<br />db 077h, 003h, 001h, 077h, 008h, 001h, 0B7h, 0FDh, 000h, 000h, 000h, 001h<br />db 0B7h, 004h, 001h, 000h, 000h, 001h, 0B7h, 002h, 002h, 000h, 000h, 001h<br />db 0B7h, 007h, 002h, 000h, 000h, 05Fh, 05Eh, 0C3h, 08Bh, 03Ch, 024h, 0C3h<br />db 4096*2-PROFILERSIZE dup &#40;0&#41; ;combined size of section is 8192 bytes<br />_PROF1 ends<br /></code></pre><br /><br />this is the output I get:<br /><br />Profiling aligned<br />esp = 0012FFA0, :before profile<br />esp = 0012FFA0, :after profile<br />ProfilerResult.lowdword = 6, low dword<br />ProfilerResult.hidword = 0, High dword<br />-- --------------------------------------<br />Profiling RevStr<br />esp = 0012FFA0, :before profile<br />esp = 00130018, :after profile<br />ProfilerResult.lowdword = 8, low dword<br />ProfilerResult.hidword = 0, High dword<br />----------------------------------------<br /><br />the two functions are almost identical except RevStr takes two parameters so masm sets up the stack frame etc...<br /><br />For RevStr the stack isn't balanced it's off by 120 bytes! if it took only 1 parameter the stack would be off by 60 bytes. so there's definitely something systematic going on...<br /><br />BTW I've been using vkim's debug macros for ages so I know the problem isn't with them, besides they aren't part of the code being profiled.<br />I never had any luck with the previous version but I'll have a look and see.<br /><br />Any way all things considered it's a great piec of work.<br /><br />cheers</div>
    <div class="meta">Posted on 2003-01-18 12:06:27 by MArtial_Code</div>
   </div>
   <div class="post" id="post-77075">
    <div class="subject"><a href="#post-77075">PROFILE v2.0 released</a></div>
    <div class="body"><strong></strong><br />Are you sure the unbalance is not caused by your MASM macro?<br />If PROFILE doesn't cause stack unbalance with no arguments, it can't cause it with arguments. It doesn't see arguments at all, it just provide the upper stack memory locations to the routine to be profiled, whatever they contain. Thus I think the problem may be in your MASM macro. Please, try to test PROFILE with inline code first, it should work (I don't see how it would not cause a stack unbalance with no arguments in your MASM macro, and cause the stack unbalance with arguments in your MASM macro, when PROFILE doesn't even get to know about the difference.. only your MASM macro is aware of the presence of arguments.. for PROFILE it's just memory above ESP, which may have a meaning or not.. PROFILE just passes it to the routine to be profiled, it doesn't touch ESP nor any other register).</div>
    <div class="meta">Posted on 2003-01-18 17:48:18 by Maverick</div>
   </div>
   <div class="post" id="post-77188">
    <div class="subject"><a href="#post-77188">PROFILE v2.0 released</a></div>
    <div class="body"><strong>Hei Maverick!</strong><br />The macros he uses are not the problem. I have tested Profiler without<br />the macros and the result is still the same. The profiler seems to add<br />the size of each param used in the proc. everytime it calls the proc. its<br />going to profile. However when the profiler calls the proc. the very first time<br />it doesnt add anything, but after the first time it all starts.<br /><pre><code>&#91;color=sienna&#93;90                      nop&#91;color=red&#93;<br />E800000000              call XXXXXXXX&#91;/color&#93;<br />C74424FC00000000        mov &#91;esp-04&#93;, XXXXXXXX<br />FF6424FC                jmp &#91;esp-04&#93;<br />90                      nop<br />&#91;/color&#93;</code></pre><br />So after each call you see above it continues to increase by the size of params.<br />In the case above he use DWORDS wich are the size of 4. I have gathered <br />that profiler runs 15 times? then we can multiply each of the param. size <br />with 15. and we get DWORD*PARAM*15==120(Wich is the number he mentioned above).<br /><br />Another thing I noticed was that when I use more then two params. The<br />profiler doesnt return.  Sorry but this is all I have at the moment. Maybe it <br />can come of some use! :alright:</div>
    <div class="meta">Posted on 2003-01-19 10:48:24 by natas</div>
   </div>
  </div>
 </body>
</html>