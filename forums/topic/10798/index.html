<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>load jpeg from resource - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10798" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=10798">load jpeg from resource</a></p>
   <div class="post" id="post-81234">
    <div class="subject"><a href="#post-81234">load jpeg from resource</a></div>
    <div class="body">Hi everyone, <br /><br />I feel bad because i'm a frequent reader of this board, but seem to post very little these days, so in order to make amends here is a proc that will read a jpeg from a resource file, convert it to a bmp and return the handle to the bitmap.<br /><br />It is based on some code from someone at this board - i forget who, and am too lazy to look it up - so thanks to ..... you know who you are.      - update found the original writer - &quot;Senf - 03.04.2001&quot;<br />Anyway instead of reading from a disk jpeg,  it reads from a resource one<br />call the resource type whatever you like - same as normal.<br /><br />a little note in win 95/98 max bmp size is 16 meg - see note in code<br /><br />hope this helps in some way<br /><br /><pre><code><br />;################################################################################################<br /><br />LoadJPEGResource PROC	ResourceID&#58;DWORD    ;load a jpeg from the resource file<br /><br />local hDCImage&#58;DWORD<br />local mHDC&#58;DWORD<br /><br /><br /><br />;load in the resource data pointed to by the resource<br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br /><br />        invoke  FindResource,hInstance,ResourceID,addr RsrcTypeJ    ;call the resource whatever you want<br />        mov     RsrcHandJ, eax<br /><br />        invoke  LoadResource,hInstance,eax<br />        mov     RsrcPointJ, eax<br /><br />        invoke  SizeofResource,hInstance,RsrcHandJ<br />        mov     RsrcSizeJ, eax<br /><br />        invoke  LockResource,RsrcPointJ<br />        mov     RsrcPointJ, eax   <br /><br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br /><br />	; initalize Intel JPEG Library<br />	invoke	ijlInit, ADDR jcprops						; Intel JPEG Library initialization<br />	.IF eax != IJL_OK<br /><br />		invoke MessageBox,NULL,addr CantInitLib,addr AppName,MB_OK <br /><br /><br />	.ENDIF<br />	<br />	; open JPEG file<br />	mov		eax, RsrcPointJ ;ResourceID<br />	mov		jcprops.JPGBytes, eax<br />	mov eax,RsrcSizeJ<br />	mov jcprops.JPGSizeBytes,eax                         <br />	invoke	ijlRead, ADDR jcprops,IJL_JBUFF_READPARAMS 	; read parameters of JPEG file from a buffer - not file<br />	.IF eax != IJL_OK<br />		invoke MessageBox,NULL,addr badjpeg ,addr AppName,MB_OK <br /><br /><br />	.ENDIF<br />	<br />	; calculate size of buffer to hold 24bit image date &amp; allocate memory<br />	; determine the required size of 24bit buffer	<br />	mov		eax, jcprops.JPGWidth			; width of JPEG to eax<br />	add		eax, 7<br />	mov		ebx, 24							; bits per plane to ebx &#40;24bit&#41;<br />	mul		ebx								; multiply<br />	add		eax, 7							; add 7<br />	shr		eax, 3							; division by 8<br />	mov		ebx, jcprops.JPGHeight			; heigt of JPEG to eax<br />	mul		ebx<br />	mov		jbufsize24, eax<br />	invoke	GlobalAlloc, GHND, eax<br />	.IF	eax==FALSE<br /><br />		invoke MessageBox,NULL,addr nomem  ,addr AppName,MB_OK <br /><br />	.ELSE<br />		mov		hjbuffer24, eax				; handle to allocated memory<br />	.ENDIF<br />	invoke	GlobalLock, eax<br />	mov		jbuffer24, eax					; pointer to buffer<br /><br />	; fill DIB portion of the JPEG object <br />	push	jcprops.JPGWidth				<br />	pop		jcprops.DIBWidth				; DIBWidth &lt;- JPGWidth<br />	push	jcprops.JPGHeight				; implies a bottom-up DIB<br />	pop		jcprops.DIBHeight 				; DIBHeight &lt;- JPGHeight<br />	mov		jcprops.DIBChannels, 3			; 3 channels<br />	mov		jcprops.DIBColor, IJL_BGR		; colors are in reversed order BGR instead of RGB <br /><br />	; calculate DIBPadBytes<br />	mov		eax, jcprops.JPGWidth			; JPEG width to eax<br />	mov		ebx, 3          				; number of channels to ebx<br />	mul		ebx								; multiply width with number of <br /><br />channels<br />	push	eax								; store this value &#40;IJL_DIB_UWIDTH&#41;<br />	<br />	add		eax, IJL_DIB_ALIGN				; add IJL_DIB_ALIGN<br />	mov		ebx, IJL_DIB_ALIGN<br />	not		ebx<br />	and		eax, ebx          				; AND with IJL_DIB_ALIGN<br />											; eax holds IJL_DIB_AWIDTH<br />	pop		ebx								; restore IJL_DIB_UWIDTH to ebx<br />	sub		eax, ebx						; calculate IJL_DIB_PAD_BYTES<br />	mov		jcprops.DIBPadBytes, eax  		; store value<br /><br />	push	jbuffer24						; push 24bit jpeg buffer address <br />	pop		jcprops.DIBBytes				; pop address<br /><br />	mov		eax, jcprops.JPGChannels		; JPGChannels to eax<br />	.IF	eax==1								; is it 1 ?<br />		mov		jcprops.JPGColor, IJL_G		; yes, then JPGColor is grayscale color space <br />  	.ELSEIF eax==3							; is it 3 ?<br /> 		mov		jcprops.JPGColor, IJL_YCBCR ; yes, then JPGColor is luminance-chrominance color space<br />    .ELSE<br />		; This catches everything else, but no color twist will be<br />    	; performed by the IJL<br />    	mov		jcprops.DIBColor, IJL_OTHER<br />    	mov		jcprops.JPGColor, IJL_OTHER<br />    .ENDIF<br /><br />	; Read in image from file<br />	invoke	ijlRead, ADDR jcprops,IJL_JBUFF_READWHOLEIMAGE   ; IJL_JFILE_READWHOLEIMAGE<br />	.IF eax != IJL_OK<br /><br />		invoke MessageBox,NULL,addr badjpeg ,addr AppName,MB_OK <br /><br />	.ENDIF<br /><br />					; no, then once again<br /><br /><br /><br />	; create the bitmap and get a handle to it<br />	invoke	CreateBitmap, jcprops.JPGWidth, jcprops.JPGHeight, 1, 24, jcprops.DIBBytes  <br />	.IF	eax==NULL<br /><br /><br />;from msdn &quot;Windows 95/98&#58; The created bitmap cannot exceed 16MB in size.&quot;<br /><br />		invoke MessageBox,NULL,addr nocreate ,addr AppName,MB_OK <br /><br />	.ELSE<br />		mov		hBitmap, eax			; save handle of bitmap	<br />	.ENDIF<br /><br />   										; delete bitmap<br /><br /><br /><br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />	invoke GetDC,TWND         ;TWND is the window handle,  should actually be passed into this proc<br />	mov mHDC,eax<br /><br /><br /><br />            mov	bmi.bmiHeader.biSize, 40<br />		mov	eax, jcprops.DIBWidth<br />		mov	bmi.bmiHeader.biWidth, eax		<br />		mov	eax, jcprops.DIBHeight <br />		neg	eax<br />		mov	bmi.bmiHeader.biHeight, eax		<br />		mov	bmi.bmiHeader.biPlanes, 1<br />		mov	bmi.bmiHeader.biBitCount, 24<br />		mov	bmi.bmiHeader.biCompression, BI_RGB<br /><br />		INVOKE	CreateDIBitmap, mHDC, ADDR bmi, CBM_INIT, jcprops.DIBBytes, ADDR bmi, DIB_RGB_COLORS<br /><br />		.IF	eax==NULL<br /><br />			invoke MessageBox,NULL,addr cantmakebitmap,addr AppName,MB_OK <br /><br />	.ELSE<br />		mov		hBitmap, eax	; save handle of bitmap								<br /><br />			<br />	.ENDIF<br /><br />;max size seems about 6 or 8 meg<br /><br /><br /><br /><br />	<br />	; free memory of JPEG buffers<br />	invoke	GlobalUnlock, jbuffer24		<br />	invoke	GlobalFree, hjbuffer24<br />	<br /><br />	; release Intel JPEG Library Object<br />	invoke	ijlFree, ADDR jcprops	<br /><br />	mov eax,hBitmap<br /><br /><br /><br /><br />	ret<br />LoadJPEGResource	ENDP<br /><br /><br /><br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br /></code></pre><br /><br />I just added the <pre><code> </code></pre> tags to make the code easier to read.</div>
    <div class="meta">Posted on 2003-02-12 07:32:10 by Terab</div>
   </div>
   <div class="post" id="post-81248">
    <div class="subject"><a href="#post-81248">load jpeg from resource</a></div>
    <div class="body">Nice pice of code. :)<br />(It would look even nicer if you put it in &quot;[ CODE ]&quot;-tags w/o the spaces inbetween )</div>
    <div class="meta">Posted on 2003-02-12 08:12:48 by scientica</div>
   </div>
   <div class="post" id="post-81249">
    <div class="subject"><a href="#post-81249">load jpeg from resource</a></div>
    <div class="body"><div class="quote"><br />Nice pice of code. :)<br />(It would look even nicer if you put it in &quot;[ CODE ]&quot;-tags w/o the spaces inbetween ) </div><br /><br /><br />i didnt know about the code /code tags :) <br /><br />i use the above in most of my projects to keep the size down, as invariably a jpeg is small than aplibing a bmp - although for small images the aplib is better.<br /><br />another trick is to arrange all the little images on one big jpeg and then chop it up into pieces at run time.<br /><br />i'm currently working on a wavelet image compression in asm - although its gonna take some time.... a LOT of time :grin:</div>
    <div class="meta">Posted on 2003-02-12 08:17:18 by Terab</div>
   </div>
   <div class="post" id="post-81253">
    <div class="subject"><a href="#post-81253">load jpeg from resource</a></div>
    <div class="body"><div class="quote"><br />i didnt know about the code /code tags :) <br />...<br />i'm currently working on a wavelet image compression in asm - although its gonna take some time.... a LOT of time :grin: </div><br />Well, there's always something to learn in the begining, for instance, it took me a while before i found the new posts function. the code tags can be added like the other tags (it's the buttonw with the &quot;#&quot;, maybee we should ask Hiro to change the label to &quot;Code&quot; instead)<br /><br />Wavelet, isn't that some image compression/storage techinque that compresses images good? I read some paper on it but didn't understand what it's all about...</div>
    <div class="meta">Posted on 2003-02-12 08:27:31 by scientica</div>
   </div>
   <div class="post" id="post-81256">
    <div class="subject"><a href="#post-81256">load jpeg from resource</a></div>
    <div class="body">basically for the same file size as a jpeg your quality is much better - which implies you can use a smaller file :-)<br /><br />you can also control exactly what you want you bpp to be and hence control the filesize.<br /><br />i looked into laurawaves c-sdk  but at $2500 / license / per project its not really an option.<br /><br />there are a lot of wavelet resources out there so i dont think it going to be too dificult to make my own - famous last words :-)</div>
    <div class="meta">Posted on 2003-02-12 08:38:48 by Terab</div>
   </div>
   <div class="post" id="post-81732">
    <div class="subject"><a href="#post-81732">load jpeg from resource</a></div>
    <div class="body">Hey cool... my department head asked me to do a research project... and I decided on wavelets as my topic.... (no specific application yet though, maybe speech/phoneme recognition)<br /><br />Anyway wavelets (the 'continuous wavelet transform' or CWT at least) are kinda similar to Fourier transform, except you get both time and frequency info.  Of course Short Term Fourier Transform (STFT, which is simply that you split your signal into equal-time chunks and fourier each chunk) can also get you both time and frequency info, but wavelets are more flexible.<br /><br />This is because you have a Heidenberg uncertainty principle at work here too, more time accuracy=less freq accuracy, more freq accuracy=less time accuracy.  With STFT you get a constant time and freq accuracy, but with CWT you get better time accuracy with higher frequencies (and because of the logarithmic nature of all things, slight differences in high frequencies are not noticeable and therefore inaccuracies at high frequencies are OK), and get better frequency accuracy with low frequencies (and slight differences in low frequencies are more noticeable).<br /><br />DWT or Discrete Wavelet Transform, however, is used for image compression, not CWT.  The maths looks WAY different for the two (at least in my research), but the tradeoff remains: better time accuracy for high frequencies, better freq. accuracy for low frequencies.<br /><br /><br />To view this in the image compression thing, just think of a plain green field with flowers.  The green field is a 'low frequency' thing: it's the background, and between most pixels it hardly changes.  However it's very noticeable if the green background is off the proper shade in the original picture.  Now the flowers will be little splotches of color on the green field.  They are high frequencies things, and in most pixels the exact shades will change quite a bit.  However if the flowers are small enough, the exact color they have may not be all that noticeable, so a slight inaccuracy in their color is not too bad.  However, their proper position will be noticed, and if they are off position a couple of pixels, the image is seen as different from the original.<br /><br />Anyway... I suspect that wavelets would be VERY appropriate for encoding stuff like MIPMAPS... MIPMAPS are versions of a texture that are smaller than the original texture, and are less accurate.  These are used if the surface being projected is small.  However, if the surface being projected is larger than the original texture, the renderer may interpolate the pixels using pixels from the main texture and one or more of the mipmaps to fill in the pixels between.<br /><br />(dang, that was kinda longer than I thought....)</div>
    <div class="meta">Posted on 2003-02-14 04:56:58 by AmkG</div>
   </div>
   <div class="post" id="post-81734">
    <div class="subject"><a href="#post-81734">load jpeg from resource</a></div>
    <div class="body">Terab,nice work!:alright:</div>
    <div class="meta">Posted on 2003-02-14 04:58:57 by Vortex</div>
   </div>
   <div class="post" id="post-81755">
    <div class="subject"><a href="#post-81755">load jpeg from resource</a></div>
    <div class="body">Good idea on using wavelet compression for texture maps...<br /><br />The DWT looks quite tricky to implement in asm,  you gotta split all the channels and do some pretty funky maths.<br /><br />still in the end it will be worth it - maybe license it to nvidia for new texture mapping engine :grin: :grin:</div>
    <div class="meta">Posted on 2003-02-14 07:04:17 by Terab</div>
   </div>
   <div class="post" id="post-81759">
    <div class="subject"><a href="#post-81759">load jpeg from resource</a></div>
    <div class="body">Ernie Murphy has made a really good library that do that using only Win API functions (no external library like the Intel one)...<br /><br />It is somewhere on the board and there is an example in the latest MASM32 package.</div>
    <div class="meta">Posted on 2003-02-14 07:37:04 by JCP</div>
   </div>
   <div class="post" id="post-81898">
    <div class="subject"><a href="#post-81898">load jpeg from resource</a></div>
    <div class="body"><div class="quote"><br />Good idea on using wavelet compression for texture maps...<br /><br />The DWT looks quite tricky to implement in asm,  you gotta split all the channels and do some pretty funky maths.<br /></div><br /><br />Well by 'split'... isn't this simply done by filtering?  At least that's how the site I'm referring to explains it: two filters, one high-pass, one low pass, output of high-pass is decimated and saved, output of low pass is decimated and passed through the two filters again, until you end up with a two 2-length signals.  Results are concatenated from the final low-pass output, then the last high-pass output to the first high-pass output.<br /><br /><span style="font-size:9px>this is the reference I found, see part 4...</span><br /><a target="_blank" href="http://engineering.rowan.edu/~polikar/WAVELETS/WTtutorial.html">http://engineering.rowan.edu/~polikar/WAVELETS/WTtutorial.html</a><br /><br />AFAIK the filters needed for this are FIR ones, so you can simply convolve it.  Then decimate the outputs of the filters by 1/2.  Repeat for the next channel...<br /><br />I don't see how difficult this is.... but maybe you see something I don't....<br /><br /><br />BTW in preparation for my research project I am building a set of asm macros to help work with matrices... one of the macro kits will do convolution... He he he I wonder if my department head will understand asm ha ha ha, well I'm gonna have to make the macro kit look as HLL as possible...<br /><br /><div class="quote"><strong><br /><br />still in the end it will be worth it - maybe license it to nvidia for new texture mapping engine :grin: :grin: </div><br /><br />He he he.... but would nvidia want it...??<br /><br /><br />P.S.<br />You know what, I suddenly realized how in the heck DWT and CWT are the same.<br /><br />The IMPULSE RESPONSE of the filter is DA WAVELET in reverse (or FOLDED).<br /><br />In CWT you do correlation with the scaled mother wavelet to the signal.<br /><br />In DWT you do convolution with the impulse response of the filter.<br /><br />And Convolution=correlation, except you fold one of the signals in convolution.<br /><br />Dang.<br /><br />You're really a friend Terab....</div>
    <div class="meta">Posted on 2003-02-15 03:15:39 by AmkG</div>
   </div>
   <div class="post" id="post-82682">
    <div class="subject"><a href="#post-82682">load jpeg from resource</a></div>
    <div class="body">Hi,<br /><br /><div class="quote"><br />     mov jcprops.JPGSizeBytes,eax                         <br />                                      invoke  <strong>ijlRead</strong>, ADDR jcprops,IJL_JBUFF_READPARAMS      ; read parameters of JPEG file from a buffer - not file<br />                                      .IF eax != IJL_OK<br />                                              invoke MessageBox,NULL,addr badjpeg ,addr AppName,MB_OK <br /><br /></div> <br /><br />ehm, where is this <strong>ijlRead</strong> function? I suupose everybody know, since they have congrats. Anyhow, thanks.</div>
    <div class="meta">Posted on 2003-02-19 19:52:16 by cakmak</div>
   </div>
   <div class="post" id="post-82725">
    <div class="subject"><a href="#post-82725">load jpeg from resource</a></div>
    <div class="body">The intel jpeg library contains all these functions - ijl(version number).dll<br /><br />i think the masm install has the inc and the lib for them.<br /><br /><br />hope this helps</div>
    <div class="meta">Posted on 2003-02-20 02:14:37 by Terab</div>
   </div>
   <div class="post" id="post-84258">
    <div class="subject"><a href="#post-84258">load jpeg from resource</a></div>
    <div class="body">If you mean by &quot;masm install&quot; MASM32 - no<br />It doesn't have the lib and include.</div>
    <div class="meta">Posted on 2003-02-28 19:33:35 by The Svin</div>
   </div>
  </div>
 </body>
</html>