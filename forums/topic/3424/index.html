<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ReplaceString - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3424" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=3424">ReplaceString</a></p>
   <div class="post" id="post-22708">
    <div class="subject"><a href="#post-22708">ReplaceString</a></div>
    <div class="body">Hello everyone,<br />I made an function to replace substrings in a string for other substrings. I've been using it for a while and it's working very well. If anyone founds a bug or knows a way to optimize it, please let me know.<br />Hope it is useful for someone.<br />Use it like this:<br />invoke ReplaceString, addr String, addr OldSubString, addr NewSubString<br /><br /><pre><code><br />ReplaceString proc SourceString&#58;DWORD, SubString&#58;DWORD, NewSubString&#58;DWORD<br />LOCAL NewLenSourceString&#58;DWORD<br />LOCAL LenSourceString&#58;DWORD<br />LOCAL LenSubString&#58;DWORD<br />LOCAL LenNewSubString&#58;DWORD<br />LOCAL esi1&#58;DWORD<br />LOCAL movecount&#58;DWORD<br />LOCAL movemode&#58;DWORD<br /><br />pushad<br /><br />mov esi, SourceString<br />mov edi, SourceString<br />mov ebx, SubString<br />mov edx, NewSubString<br /><br />invoke lstrlen, SourceString<br />mov LenSourceString, eax<br />invoke lstrlen, SubString<br />mov LenSubString, eax<br />invoke lstrlen, NewSubString<br />mov LenNewSubString, eax<br />.IF eax&gt;LenSubString<br /> mov movemode, 1<br />.ELSE<br /> mov movemode, 0<br />.ENDIF<br /><br />compare1&#58;<br />mov ah, &#91;ebx&#93;<br />compare1loop&#58;<br />mov al, &#91;esi&#93;<br />inc esi<br />cmp al, 0<br />je theend<br />cmp al, ah<br />je compare2<br />jmp compare1loop<br /><br />compare2&#58;<br />dec esi<br />mov esi1, esi<br />compare2loop&#58;<br />mov al, &#91;esi&#93;<br />inc esi<br />mov ah, &#91;ebx&#93;<br />inc ebx<br />cmp ah, 0<br />je found<br />cmp al, ah<br />jne backtocompare1<br />jmp compare2loop<br /><br />backtocompare1&#58;<br />mov ebx, SubString<br />mov esi, esi1<br />inc esi<br />jmp compare1<br /><br />found&#58;<br />cmp movemode, 1<br />je found1<br />mov esi, esi1<br />copyloop0&#58;<br />mov al, &#91;edx&#93;<br />inc edx<br />cmp al, 0<br />je copydone0<br />mov &#91;esi&#93;, al<br />inc esi<br />jmp copyloop0<br />copydone0&#58;<br />xor eax, eax<br />xor ecx, ecx<br />mov ecx, LenSubString<br />sub ecx, LenNewSubString<br />mov eax, LenSourceString<br />sub eax, ecx<br />mov NewLenSourceString, eax<br />mov edi, esi<br />mov esi1, esi<br />add esi, ecx<br />moveloop0&#58;<br />mov al, &#91;esi&#93;<br />inc esi<br />mov &#91;edi&#93;, al<br />inc edi<br />cmp al, 0<br />je backtocompare3<br />jmp moveloop0<br /><br />found1&#58;<br />xor eax, eax<br />xor ecx, ecx<br />mov ecx, LenSubString<br />sub ecx, LenNewSubString<br />mov eax, LenSourceString<br />sub eax, ecx<br />mov NewLenSourceString, eax<br />mov esi, SourceString<br />add esi, LenSourceString<br />add edi, NewLenSourceString<br />xor eax, eax<br />xor ecx, ecx<br />mov eax, esi1<br />add eax, LenSubString<br />mov ecx, esi<br />sub ecx, eax<br />add ecx, 1<br />mov movecount, 0<br />moveloop&#58;<br />mov al, &#91;esi&#93;<br />dec esi<br />mov &#91;edi&#93;, al<br />dec edi<br />inc movecount<br />cmp ecx, movecount<br />je copynewsubstr<br />jmp moveloop<br /><br />copynewsubstr&#58;<br />mov esi, esi1<br />copyloop&#58;<br />mov al, &#91;edx&#93;<br />inc edx<br />cmp al, 0<br />je backtocompare2<br />mov &#91;esi&#93;, al<br />inc esi<br />jmp copyloop<br /><br />backtocompare3&#58;<br />mov esi, esi1<br />backtocompare2&#58;<br />mov edi, SourceString<br />mov ebx, SubString<br />mov edx, NewSubString<br />mov eax, NewLenSourceString<br />mov LenSourceString, eax<br />jmp compare1<br /><br />theend&#58;<br />popad<br />ret<br />ReplaceString endp<br /></code></pre></div>
    <div class="meta">Posted on 2002-02-03 18:19:29 by dilau</div>
   </div>
  </div>
 </body>
</html>