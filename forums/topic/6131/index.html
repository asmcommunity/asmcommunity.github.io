<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ODBC and local files - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=6131" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=6131">ODBC and local files</a></p>
   <div class="post" id="post-43952">
    <div class="subject"><a href="#post-43952">ODBC and local files</a></div>
    <div class="body">Hey ho. I'm working on a little project with ODBC lately (movie database<br />HTML exporter - yeah, I should use PHP for this, but I felt like playing<br />with ODBC, don't have the time to learn PHP, and anyway it's for a friend<br />who doesn't (yet) run apache with PHP).<br /><br />Now, my problem... I find ODBC somewhat messy, and not all that well<br />documented. The information in the MDAC SDK seems outdated, and written<br />more for &quot;database developers&quot; than &quot;normal&quot; programmers, and certainly<br />does not live up to the standard of the PlatformSDK.<br /><br />My data source is a local access database. I'd like the user to be able<br />to specify the path in the commandline, ie something like &quot;dbtool d:\docs\test.mdb&quot;.<br />I have, however, not figured out how to make ODBC open a database 'directly'<br />like that. I don't feel like setting up one of those DSN(?) thingies.<br />My current approach is a call to SQLDriverConnect(), which pops up a dialog<br />where the user has to go through a bunch of tedious steps to open the database.<br /><br />I'm developing this in C/C++, so I don't necessarily have to use ODBC (hiroshimator<br />suggested ADO), as long as the API is able to work with M$ Access databases and<br />can execute SQL statements - so no, using other database formats (eg tsunami) is<br />not an option (for now - I might change later... but for now it's nice being able<br />to use access instead of coding my own database frontend).<br /><br />If there's sometihng 'cleaner' than ODBC with better documentation that can<br />get the job done, lemme hear :). And no, programming in VB, Delphi or BCB isn't<br />an option, and I'd like to keep MFC out of the game, too.<br /><br />Thanks in advance for any suggestions :)</div>
    <div class="meta">Posted on 2002-06-18 10:41:35 by f0dder</div>
   </div>
   <div class="post" id="post-43953">
    <div class="subject"><a href="#post-43953">ODBC and local files</a></div>
    <div class="body">Hi!<br /><br />First of all you should get Iczelions ODBC tutorial at his homepage. <br />Look at the example program in the last Tutorial... it shows how to access a Access ( :) ) Database via ODBC.<br /><br />I think this should clear things up for you!</div>
    <div class="meta">Posted on 2002-06-18 10:52:12 by bazik</div>
   </div>
   <div class="post" id="post-43956">
    <div class="subject"><a href="#post-43956">ODBC and local files</a></div>
    <div class="body">Thanks bazik, that worked. Dunno how I missed icz' ODBC tutorials :).<br /><br />Still, if anybody has recommendations on other APIs, I'd like to hear -<br />I find ODBC pwetty damn ugly.</div>
    <div class="meta">Posted on 2002-06-18 11:11:06 by f0dder</div>
   </div>
   <div class="post" id="post-43957">
    <div class="subject"><a href="#post-43957">ODBC and local files</a></div>
    <div class="body">Sorry, I can't help, but I tried to do something using ODBC... and I encoutered the same problems as you... the documentation is messy, and unclear at many aspects...<br /><br />Iczelion's tutorials as good, but only an introduction...<br /><br />Personally, It was for fun, and I gived up this project for now... mainly because of the lack of clear documentation... (and lack of time to do time consuming tries researches)<br /><br />Just to tell you you are not alone...<br /><br />Btw, if you find a good information source about that, please let me know...<br /><br />FYI, I played a bit with php, to try how long it would take to do my site with it, and it was very fast to learn... and the information is good to not say everywhere...</div>
    <div class="meta">Posted on 2002-06-18 11:29:21 by JCP</div>
   </div>
   <div class="post" id="post-43958">
    <div class="subject"><a href="#post-43958">ODBC and local files</a></div>
    <div class="body">It's hidden deep, deep on MSDN:<br /><a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/odbc/htm/odbcabout_this_manual.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/odbc/htm/odbcabout_this_manual.asp</a><br /><a target="_blank" href="http://polimetla.tripod.com/vc/odbc1.htm">http://polimetla.tripod.com/vc/odbc1.htm</a></div>
    <div class="meta">Posted on 2002-06-18 11:40:34 by bazik</div>
   </div>
   <div class="post" id="post-43961">
    <div class="subject"><a href="#post-43961">ODBC and local files</a></div>
    <div class="body">bazik, that documentation is available for download in the MDAC sdk<br />somewhere at microsoft's site. But (at least) the ODBC part of the<br />documentation is rather sucky :/</div>
    <div class="meta">Posted on 2002-06-18 12:10:26 by f0dder</div>
   </div>
   <div class="post" id="post-43962">
    <div class="subject"><a href="#post-43962">ODBC and local files</a></div>
    <div class="body">Well, if you want ODBC easy, you must use VB :tongue:</div>
    <div class="meta">Posted on 2002-06-18 12:13:10 by bazik</div>
   </div>
   <div class="post" id="post-43963">
    <div class="subject"><a href="#post-43963">ODBC and local files</a></div>
    <div class="body">No, use MS Access to make your query's and copy/paste them into your program :) (select SQL view)</div>
    <div class="meta">Posted on 2002-06-18 12:20:16 by Qweerdy</div>
   </div>
   <div class="post" id="post-43966">
    <div class="subject"><a href="#post-43966">ODBC and local files</a></div>
    <div class="body">Constructing SQL queries is not the problem - the uglyness and bad<br />documentation of the ODBC api is :)</div>
    <div class="meta">Posted on 2002-06-18 12:24:43 by f0dder</div>
   </div>
   <div class="post" id="post-43967">
    <div class="subject"><a href="#post-43967">ODBC and local files</a></div>
    <div class="body"><div class="quote"><br />No, use MS Access to make your query's and copy/paste them into your program :) (select SQL view) </div><br /><br />Yeah, you get 100% Microsoft SQL code then, wich is 100% incompatibel with every SQL standard! :rolleyes:</div>
    <div class="meta">Posted on 2002-06-18 12:24:49 by bazik</div>
   </div>
   <div class="post" id="post-44031">
    <div class="subject"><a href="#post-44031">ODBC and local files</a></div>
    <div class="body">f0dder,<br />i endorse what Hiro said, use ADO. I use it extensively for both<br />Access and Oracle databases, and it really does make things easy. <br /><br />In ADO, create a Connection object, then call its Open <br />method with the following string:<br /><pre><code>&#91;size=12&#93;<br />&quot;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=&quot;&#91;color=red&#93;&lt;local database path&gt;&#91;/color&#93;&quot;;Persist Security Info=False&quot;&#91;/size&#93;</code></pre><br /><br />Once you have established the connection, you can just use the<br />Execute method of the Connection object to execute your <br />queries, in pseudocode it looks like this:<br /><pre><code><br />Set &lt;recordset name&gt; = &lt;connection object&gt;.Execute&#40;&lt;your sql string&gt;&#41;<br /><br />or just&#58;<br /><br />&lt;connection object&gt;.Execute &lt;your sql string&gt; <br /></code></pre><br /><br />As for the sql, i have never had a problem with it, Access<br />understands all the standard stuff (except the joins are a little<br />different). Just remember though, if you insert short dates, they<br />should be in American format (mm/dd/yy).<br /><br />If you do use ADO, use v2.5, there is little or no benefit in using<br />v2.6 or v2.7, and in fact v2.6 needs a service pack applied to make<br />it work properly. Also, if you need to create tables/indexes, etc.,<br />either swat up on the sql required, or use DAO instead.</div>
    <div class="meta">Posted on 2002-06-18 20:32:13 by sluggy</div>
   </div>
   <div class="post" id="post-44168">
    <div class="subject"><a href="#post-44168">ODBC and local files</a></div>
    <div class="body">sluggy,<br /><br />using ADO in VB is fine, but is it still fine coding in native C(++)? Without MFC/ATL? With all the VARIANT parms used by these interfaces?  <br /><br />japheth</div>
    <div class="meta">Posted on 2002-06-19 11:30:09 by japheth</div>
   </div>
   <div class="post" id="post-44232">
    <div class="subject"><a href="#post-44232">If you know C you know PHP</a></div>
    <div class="body">Hi Fodder really try PHP &amp; MYSQL<br /><br />I made this for my site<br /><br /><a target="_blank" href="http://www.pinklightning.com/connex.php">http://www.pinklightning.com/connex.php</a><br /><br />I use it because it's cheap and highly effective<br /><br />But if you really want to go ASM, try out my ASM CGI stuff, you may find some of the code, here and there could be optimized, you'll have to figure out the ODBC part, MayBe go for it, if you do I'll put it up on my host which is good till March 2003, you can run<br />ASM CGI's on it<br /><br />Andy981</div>
    <div class="meta">Posted on 2002-06-19 22:20:12 by andy981</div>
   </div>
   <div class="post" id="post-44243">
    <div class="subject"><a href="#post-44243">ODBC and local files</a></div>
    <div class="body">japheth,<br />without a doubt, using ADO in straight C or asm is a lot more difficult/time consuming than using it in VB, but can still be worth the effort. I have never done 'raw' COM in either of those languages, so i cannot say for sure how much work it would be, but having the ability to do something like this would be great:<br /><pre><code><br />lea     eax, &lt;buffer holding your sql string&gt;<br />push    eax<br />mov     eax, &lt;interface ptr&gt;<br />call    dword ptr &#91;eax + &lt;offset to 'execute' function entry&gt;&#93;<br /></code></pre><br /><br />There are not that many variants involved, and all you have to remember is that essentially they are just structs.....</div>
    <div class="meta">Posted on 2002-06-19 23:58:10 by sluggy</div>
   </div>
   <div class="post" id="post-44369">
    <div class="subject"><a href="#post-44369">A BoatLoad of ADO</a></div>
    <div class="body">Here is a boat load of ADO connection strings<br /><br /><br /><a target="_blank" href="http://www.able-consulting.com/ADO_Conn.htm">http://www.able-consulting.com/ADO_Conn.htm</a></div>
    <div class="meta">Posted on 2002-06-20 15:56:59 by andy981</div>
   </div>
   <div class="post" id="post-44376">
    <div class="subject"><a href="#post-44376">ODBC and local files</a></div>
    <div class="body">f0dder<br /><br />This came in the mail today.  I can't say enough about the possibilities of PHP &amp; MySQL.<br /><br /><div class="quote"><br />MySQL and ODBC<br />In MySQL: <a target="_blank" href="http://www.devshed.com/Server_Side/MySQL">http://www.devshed.com/Server_Side/MySQL</a><br /><br />Learn it from start to finish. Installing MyODBC, creating a<br />new data source through the ODBC Data Source Administrator,<br />linking a MySQL database into a new MS Access database, and<br />finally updating the MySQL database through an MS Access<br />GUI.<br /></div><br />farrier</div>
    <div class="meta">Posted on 2002-06-20 16:29:10 by farrier</div>
   </div>
   <div class="post" id="post-44389">
    <div class="subject"><a href="#post-44389">ODBC and local files</a></div>
    <div class="body"><div class="quote"><br /><br /><br />Yeah, you get 100% Microsoft SQL code then, wich is 100% incompatibel with every SQL standard! :rolleyes: </div><br /><br />almost all if not all RDBMS 'enhance' their SQL implementation. Most don't even succeed to implement the '92 standards completely, let alone the '99 one.<br /><br />There is nothing wrong with writing for a specific database.</div>
    <div class="meta">Posted on 2002-06-20 18:13:01 by Hiroshimator</div>
   </div>
   <div class="post" id="post-44395">
    <div class="subject"><a href="#post-44395">ODBC and local files</a></div>
    <div class="body">sluggy,<br /><br />heres an excerpt in ASM filling a listbox with ADO:<br /><br /><pre><code><br />OnInitDialog proc uses esi hWnd&#58;HWND, lParam&#58;LPARAM<br /><br />local hWndLB&#58;HWND<br />local pRS&#58;LPRECORDSET20<br />local pFs&#58;ptr Fields<br />local pF&#58;ptr Field<br />local vSource&#58;VARIANT<br />local vActiveConnection&#58;VARIANT<br />local vTemp&#58;VARIANT<br />local vbTemp&#58;VARIANT_BOOL<br />local szRow&#91;256&#93;&#58;byte<br />local szFld1&#91;80&#93;&#58;byte<br />local szFld2&#91;80&#93;&#58;byte<br /><br /><br />    lea eax,vTemp<br />    invoke VariantInit, eax<br /><br />    invoke GetDlgItem, hWnd, IDC_LIST1<br />    mov hWndLB,eax<br /><br />;--------------------------------- create recordset<br />    invoke CoCreateInstance, addr CLSID_Recordset, 0, CLSCTX_INPROC_SERVER, addr IID_Recordset20, addr pRS<br />    .if &#40;eax != S_OK&#41;<br />        invoke MessageBox, hWnd, CStr&#40;&quot;CoCreateInstance failed&quot;&#41;, 0, MB_OK<br />        ret<br />    .endif<br /><br />;--------------------------------- open recordset<br />    lea eax,vSource<br />    invoke VariantInit, eax<br />    mov vSource.vt,VT_BSTR<br />    mov vSource.bstrVal,offset wszSQLStatement<br /><br />    lea eax,vActiveConnection<br />    invoke VariantInit, eax<br />    mov vActiveConnection.vt,VT_BSTR<br />    mov vActiveConnection.bstrVal,offset wszFileDSN<br /><br />    invoke vf&#40;pRS, IRecordset20, Open&#41;, vSource, vActiveConnection, \<br />            adOpenForwardOnly, adLockReadOnly, -1<br />    .if &#40;eax != S_OK&#41;<br />        invoke MessageBox, hWnd, CStr&#40;&quot;IRecordset&#58;&#58;Open failed&quot;&#41;, 0, MB_OK<br />        invoke vf&#40;pRS, IRecordset20, Release&#41;<br />        ret<br />    .endif<br /><br />    xor esi,esi<br />    .while &#40;1&#41;<br />;--------------------------------- check for EOF <br />        invoke vf&#40;pRS, IRecordset20, get_EOF&#41;,addr vbTemp<br />        movsx eax,vbTemp<br />        .break .if &#40;eax&#41;<br />        mov szFld1,0<br />        mov szFld2,0<br />;--------------------------------- get fields collection<br />        invoke vf&#40;pRS, IRecordset20, get_Fields&#41;, addr pFs<br />        .if &#40;eax == S_OK&#41;<br /><br />;--------------------------------- get first field<br />            mov vTemp.vt,VT_I4<br />            mov vTemp.lVal,0<br />            invoke vf&#40;pFs, Fields, get_Item&#41;, vTemp, addr pF<br />            .if &#40;eax == S_OK&#41;<br />                invoke vf&#40;pF, Field, get_Value&#41;, addr vTemp<br />                .if &#40;vTemp.vt == VT_BSTR&#41;<br />                    invoke WideCharToMultiByte, CP_ACP, 0, \<br />                        vTemp.bstrVal, -1, addr szFld1, sizeof szFld1, NULL, NULL<br />                    invoke SysFreeString, vTemp.bstrVal<br />                .endif<br />                invoke vf&#40;pF, Field, Release&#41;<br />            .endif<br /><br />;--------------------------------- get second field<br />            mov vTemp.vt,VT_I4<br />            mov vTemp.lVal,1<br />            invoke vf&#40;pFs, Fields, get_Item&#41;, vTemp, addr pF<br />            .if &#40;eax == S_OK&#41;<br />                invoke vf&#40;pF, Field, get_Value&#41;, addr vTemp<br />                .if &#40;vTemp.vt == VT_BSTR&#41;<br />                    invoke WideCharToMultiByte, CP_ACP, 0, \<br />                        vTemp.bstrVal, -1, addr szFld2, sizeof szFld2, NULL, NULL<br />                    invoke SysFreeString, vTemp.bstrVal<br />                .endif<br />                invoke vf&#40;pF, Field, Release&#41;<br />            .endif<br /><br />            invoke vf&#40;pFs, Fields, Release&#41;<br />        .endif<br /><br />        inc esi<br />        invoke wsprintf, addr szRow, CStr&#40;&quot;%u., %s, %s&quot;&#41;, esi, addr szFld1, addr szFld2<br />        ListBox_AddString hWndLB, addr szRow<br /><br />;--------------------------------- move cursor to next row<br />        invoke vf&#40;pRS,IRecordset20,MoveNext&#41;<br />        .break .if &#40;eax != S_OK&#41;<br />    .endw<br />    invoke vf&#40;pRS, IRecordset20, Release&#41;<br /><br />    ret<br />OnInitDialog endp<br /></code></pre><br /><br />Same in VB:<br /><br /><pre><code><br />Private Sub Form_Load&#40;&#41;<br />    Set rs = New Recordset<br />    rs.Open &quot;select xxx,yyy from tablex&quot;, &quot;File Name=c&#58;\xxx\db1.dsn&quot;<br />    While Not rs.EOF<br />        List1.AddItem rs&#40;0&#41; &amp; &quot;,&quot; &amp; rs&#40;1&#41;<br />        rs.MoveNext<br />    Wend<br />        <br />End Sub<br /></code></pre><br /><br />The ASM version is really ugly. C++ will look a bit better though.</div>
    <div class="meta">Posted on 2002-06-20 19:15:39 by japheth</div>
   </div>
  </div>
 </body>
</html>