<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Batch file gurus : come on ! - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=12350" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=12350">Batch file gurus : come on !</a></p>
   <div class="post" id="post-95260">
    <div class="subject"><a href="#post-95260">Batch file gurus : come on !</a></div>
    <div class="body">Guys,<br /><br />I am designing some batch files to manage my VC project : delete the bunch of temporary files that MS Visual C creates etc...<br />All is working well and now I am writting the backup part...<br /><br />Basically, it uses the (very nice) 7-zip command-line tool to zip up the whole directory/subdirectories (avoiding of course the backup zip files to avoid &quot;recursive file growing&quot; syndrom).<br /><br />Now, I would like to have many of these backup files : not just overwriting the previous one in order to have a real coming back possible...<br /><br />So, I would like to append at the end of the file name the date and time...<br />Easy from any good programming langage, but from batch files : it is restrictive...<br />In fact, it could be fairly easy if I only used NT, but I switch from Win2k to Win98 and back all the time, so the backup batch must work on both 9x and NT.<br /><br />The best would be to be able to retrieve the hour, the minutes and even if possible the second in separate batch variables to avoid the &quot;:&quot; characters... it is forbidden for file names, as you all know...<br /><br />So, I wonder if somebody knows a nice, simple and clean (I thought about dirty things like making a C program to output the date/time in the batch file but that is very lame !) and 9x/NT compliant way to retrieve date and time to batch variables ?<br /><br />All the solution I found on google do not work or only work on NT...<br /><br />Some people will pobably wonder why I do not use a versionning system like CVS or even RCS : I tried them and I found this rather complicated for my needs...<br /><br />Thanks.</div>
    <div class="meta">Posted on 2003-04-10 17:36:08 by JCP</div>
   </div>
   <div class="post" id="post-95268">
    <div class="subject"><a href="#post-95268">Batch file gurus : come on !</a></div>
    <div class="body">IMHO, a little program would be the simplest solution.</div>
    <div class="meta">Posted on 2003-04-10 18:21:06 by bitRAKE</div>
   </div>
   <div class="post" id="post-95402">
    <div class="subject"><a href="#post-95402">Batch file gurus : come on !</a></div>
    <div class="body"><div class="quote"><br />IMHO, a little program would be the simplest solution. </div><br /><br />IMHO a makefile would be better :)<br />Or use a simple bash script... oh, I forgot you are on Windows :grin:</div>
    <div class="meta">Posted on 2003-04-11 01:12:02 by bazik</div>
   </div>
   <div class="post" id="post-95409">
    <div class="subject"><a href="#post-95409">Batch file gurus : come on !</a></div>
    <div class="body">Have you tried something like <strong>7z a &quot;test%date%.zip&quot; *.*</strong></div>
    <div class="meta">Posted on 2003-04-11 01:43:15 by donkey</div>
   </div>
   <div class="post" id="post-95427">
    <div class="subject"><a href="#post-95427">Batch file gurus : come on !</a></div>
    <div class="body">donkey : As far as I tried : there is no %date% variable on win9x...<br />On NT, it returns forbidden characters like /, so it is not useable in this form directly (possible to fix that with some batch &quot;code&quot; though), but  it has to work on 9x, too...<br /><br />Bazik : I knew you would say such a thing... :)<br />Makefiles would be a pain in the @$$ to do something as simple as I want and would require yet another external tool... I prefer to restrict tool dependancies as much as possible...<br /><br />bitRAKE : You are right, but I really prefer to avoid different tools profusion in the project directory : if no other solution is found, I will do that but it is a hacky way to make a program that outputs some &quot;set var= etc&quot; to a batch in the temp directory and CALL it after from the main batch file...</div>
    <div class="meta">Posted on 2003-04-11 02:52:51 by JCP</div>
   </div>
   <div class="post" id="post-95446">
    <div class="subject"><a href="#post-95446">Batch file gurus : come on !</a></div>
    <div class="body">use vbscript with the windows scripting host.</div>
    <div class="meta">Posted on 2003-04-11 03:56:50 by Hiroshimator</div>
   </div>
   <div class="post" id="post-95450">
    <div class="subject"><a href="#post-95450">Batch file gurus : come on !</a></div>
    <div class="body"><div class="quote"><br />use vbscript with the windows scripting host. </div><br /><br /><br />Argh, I was affraid someone would say this :P</div>
    <div class="meta">Posted on 2003-04-11 04:23:12 by bazik</div>
   </div>
   <div class="post" id="post-95459">
    <div class="subject"><a href="#post-95459">Batch file gurus : come on !</a></div>
    <div class="body">Or code some archive naming stuff and merge it with 7zip - it's open sores after all, isn't it?</div>
    <div class="meta">Posted on 2003-04-11 05:28:59 by f0dder</div>
   </div>
   <div class="post" id="post-95466">
    <div class="subject"><a href="#post-95466">Batch file gurus : come on !</a></div>
    <div class="body">Yeah, good idea : I looked at it, and achieved to compile it without too much trouble.<br />The source code is quite huge tough and I am not familiar with C++ (altough some code is in C).<br />It would be the most clean solution, but also the most time consuming : I don't feel like spending too much time on it though as it is supposed to make me save time.<br /><br />Btw, I think I have found the things to change, I will now try.<br /><br />Thanks ! ;)</div>
    <div class="meta">Posted on 2003-04-11 06:22:32 by JCP</div>
   </div>
   <div class="post" id="post-95562">
    <div class="subject"><a href="#post-95562">Batch file gurus : come on !</a></div>
    <div class="body">I finally choosen the way of the external utility : the easiest and the most reusable...<br />I changed my mind when I discovered that win9x del command had no /s switch to delete file inside subdirectories : I have to use an external tool for that anyway, so another one is not too much...<br /><br />It outputs a batch file inside the temp directory and it called after by the main batch file : the variables are then initialized and ready to be used...<br /><br />If somebody is interested, I can post the utilities and the C source to it (not a big deal to make yourself though)...<br /><br />Thanks anyway to everybody who helped !</div>
    <div class="meta">Posted on 2003-04-11 13:39:25 by JCP</div>
   </div>
   <div class="post" id="post-95565">
    <div class="subject"><a href="#post-95565">Batch file gurus : come on !</a></div>
    <div class="body"><div class="quote"><br />I changed my mind when I discovered that win9x del command had no /s switch to delete file inside subdirectories :</div><br /><br />Thats what deltree is made for.<br /><br />And if you use a external tool anyway, use nmake. :tongue:</div>
    <div class="meta">Posted on 2003-04-11 13:44:25 by bazik</div>
   </div>
   <div class="post" id="post-95566">
    <div class="subject"><a href="#post-95566">Batch file gurus : come on !</a></div>
    <div class="body"><div class="quote"><br /><br /><br />Thats what deltree is made for.<br /><br />And if you use a external tool anyway, use nmake. :tongue: </div><br /><br />I mad some tests with deltree today and it was not working as well as I wanted it to be...<br /><br />I used this tool :<br /><a target="_blank" href="http://www.gammadyne.com/cmdline.htm#dels">http://www.gammadyne.com/cmdline.htm#dels</a><br /><br />and with only one line :<br /><pre><code><br />@dels ..\*.obj;*.pch;*.ilk;*.idb;*.pdb;*.res;*.ncb;*.opt;*.aps;*.plg;*.sbr &gt;nul<br /></code></pre><br />I deleted all the temp files...<br />I am not sure deltree would have allowed myself to do such a thing (I would maybe have to make a separate line for every file type : annoying).<br /><br />Anyway, I wanted a quite generic solution : not to check environmental variable with a goto for 9x or NT and maintain two versions (yeah, I am lazy ^^).<br /><br /><pre><code><br />@Echo off<br />CALL Clean<br />SetTime<br />CALL %TEMP%\GetTime.bat<br />DEL %TEMP%\GetTime.bat<br /><br />7za.exe a -mx -tzip ..\Backup\test_%YEAR%-%MONTH%-%DAY%_%HOUR%-%MINUTE%-%SECOND%.zip &quot;..\*.*&quot; -r -x!..\Backup\*.*<br /></code></pre><br /><br />Not as nice I would have liked it to be, but small and straightforward...<br /><br />As for makefiles, I am not familiar with them : shame on me, probably, but could NMAKE have helped me with my date and time problem ? It seems beyond the scope of a make utility, at the first glance...</div>
    <div class="meta">Posted on 2003-04-11 13:55:13 by JCP</div>
   </div>
   <div class="post" id="post-95593">
    <div class="subject"><a href="#post-95593">Batch file gurus : come on !</a></div>
    <div class="body">use vbscript I tell you  :tongue:<br /><br />This script should do approximately what you want I think, if it doesnt completely just adapt it (be sure to set the correct path it's set to a testpath currently)<br /><br />just invoke it via commandline (cscript &lt;scriptname&gt;) or associate it with the scripting host runtime.</div>
    <div class="meta">Posted on 2003-04-11 16:01:38 by Hiroshimator</div>
   </div>
   <div class="post" id="post-95601">
    <div class="subject"><a href="#post-95601">Batch file gurus : come on !</a></div>
    <div class="body">Interesting example Hiro : thank you very much... it works fine...<br /><br />I Will study it more carefully when I will not be drunk anymore... :)</div>
    <div class="meta">Posted on 2003-04-11 16:46:14 by JCP</div>
   </div>
   <div class="post" id="post-95610">
    <div class="subject"><a href="#post-95610">Batch file gurus : come on !</a></div>
    <div class="body">Well, when I talked about dependencies it was about external tools...<br />I didn't want at first to put many utilities in the Tools subdirectory of my project (which is only about maintenance anyway, not directly related to the project).<br /><br />I used batch for years now and I know how to use them : I don't know anything about VBScript : the only thing I code in Basic now is Office VBA, mainly because I have no other choice....<br />I didn't want to learn a scripting language only for this, mainly because I am lacking of time right now...<br />Hiro's example is nice and show me that VBS can be a rather nice thing and I will really consider using it, now I have a &quot;real world&quot; example.</div>
    <div class="meta">Posted on 2003-04-11 16:59:13 by JCP</div>
   </div>
   <div class="post" id="post-95611">
    <div class="subject"><a href="#post-95611">Batch file gurus : come on !</a></div>
    <div class="body">it's not a problem but people aren't used to it.<br />it's an IE addition and MS never really promoted it like they should have.<br /><br />So most people know batch files and those are kind of limited in functionality.<br />On top of that WSH requires a bit of things to remember concerning objects to create etc...<br /><br />I think it's worth it for fairly large batch style operations in which you need extended functionality like regular expressions or XML handling for instance.<br />if it needs to be cross platform you could use python. (or perl or..... :grin: )<br /><br />o and the Windows Scripting Host can accept any language it's made for so vbscript, jscript, perlscript, etc...</div>
    <div class="meta">Posted on 2003-04-11 17:00:06 by Hiroshimator</div>
   </div>
   <div class="post" id="post-96773">
    <div class="subject"><a href="#post-96773">Date,time program</a></div>
    <div class="body">To use for your purpose in a batch file:  now &gt;&gt; file_you_want_date_on_end.txt<br /><br /><br /><br />; now.asm        Andrew Kennedy <br />;                       Com file<br />;<br />;                OUTPUT: Wednesday, 02-26-03  16:48:36     <br />;                    <br />.model  tiny<br />.code<br />.386<br /><br />ORG     100h<br /><br />start:<br />       jmp	begin<br /><br />days         LABEL        WORD<br /><br />dw offset su, offset mo, offset tu, offset we, offset th, offset fr, offset sa<br />su db 'Sunday, $'                                                                                                                                                <br />mo db 'Monday, $'<br />tu db 'Tuesday, $'<br />we db 'Wednesday, $'<br />th db 'Thursday, $'<br />fr db 'Friday, $'                                                                           <br />sa db 'Saturday, $'<br /><br />BEGIN:<br />       mov     ax, cs<br />       mov     ds, ax<br />       mov     ah,2ah        ; date, month in dh, day in dl, <br />       int     21h           ; year in cx<br />       movzx   bx,al<br />       add     bx,bx<br />       mov     dx,cs: ; print day of the week<br />       mov     ah,9<br />       int     21h<br /><br />       MOV     AH,2Ah<br />       INT     21h           ; Get Date<br />       MOV     AL,DH         ; DH contains month<br />       MOV     BL,'-'<br />       CALL    SHOWIT        ; call month<br />       MOV     AL,DL         ; DL has day<br />       CALL    SHOWIT<br />       MOV     AX,CX         ; CX contains year<br />       MOV     BL,64h        ; 64h = 100<br />       DIV     BL            ; Split year<br />       MOV     AL,AH         ; move year to al<br />       MOV     BL, 00        ; Used by 'JL Last_L'<br />       CALL    SHOWIT        ; call year<br />       MOV     DL,' '        ; 0D = CR<br />       INT     21h           ; Display 2 spaces<br />       INT     21h           ; <br /><br />       MOV     AH,2Ch<br />       INT     21h           ; Get Time<br />       MOV     BL,3Ah        ; 3Ah = ':'<br />       MOV     AL,CH         ; CH contains hour<br />       CALL    SHOWIT<br />       MOV     AL,CL         ; CL contains minutes<br />       CALL    SHOWIT<br />       MOV     BL,20h<br />       MOV     AL,DH         ; DH contains seconds<br />       CALL    SHOWIT<br />       MOV     DL,' '          <br />       INT     21h             <br />       MOV     AX,4C00h<br />       INT     21h             <br />SHOWIT:<br />       PUSH    DX            ; Save DX, holds date or time<br />       MOV     DL,0Ah        ; move 10 into DL<br />       XOR     AH,AH         ; Zero AH<br />       DIV     DL            ; Div by 10<br />       OR      AX,3030h      ; Convert to ASCII<br />       MOV     DX,AX<br />       MOV     AH,02h<br />       INT     21h           ; Display_character from DL, First charter<br />       MOV     DL,DH<br />       INT     21h           ; Display_character from DL, Second charter<br />       cmp     bl, 21h       ; Is it '/','-',or':'?<br />       JL      LAST_D        ; If not, quit<br />       MOV     DL,BL<br />       INT     21h           ; Display_character from DL, '/' or ':'<br />LAST_D:<br />       POP     DX            ; Restore DX<br />       RET                   ; End branch<br /><br />END  START</div>
    <div class="meta">Posted on 2003-04-14 21:52:11 by skywalker</div>
   </div>
  </div>
 </body>
</html>