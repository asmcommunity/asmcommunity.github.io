<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Fast a2dw - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=7265" />
  <link rel="prev" href="../?id=7265&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=7265">Fast a2dw</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=7265&amp;page=1" style="">&laquo;</a><a href="../?id=7265&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="7265" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-52758">
    <div class="subject"><a href="#post-52758">Fast a2dw</a></div>
    <div class="body">Please, remove my name from the test, damn you :)<br />I explicitly stated that I didn't give my own algo I just change KO to<br />expain him couple things.<br />As for my algo, I submit it several times already for MASM32 usage,<br />question to Hutch why he still hasn't include it.<br />It does more things, amoung converting itself it handles minus sign<br />and does negate if needed. <br />Though extra work done it runs faster (in PMMX at least) then all algos<br />used in KO test.<br />here is module:<br /><pre><code><br />;#########################################################################  <br />    ; ----------------------------------------- <br />    ; This procedure was written by Tim Roberts  and Svin<br />    ; -----------------------------------------       <br />      .386 <br />      .model flat, stdcall  ; 32 bit memory model <br />      option casemap &#58;none  ; case sensitive     <br />     .code <br /><br />; #########################################################################   <br />OPTION PROLOGUE&#58;NONE<br />OPTION EPILOGUE&#58;NONE<br />atodw proc FORCENOFRAME<br />;uses edi esi String&#58;PTR BYTE  <br /><br />      ;---------------------------------------- <br />      ; Convert decimal string into dword value       ; return value in eax <br />      ;----------------------------------------       <br />;String equ &#91;esp+4&#93;<br />	mov eax,&#91;esp+4&#93;<br />	push esi<br />	mov dl,&#91;eax&#93;<br />	xor ecx,ecx<br />	cmp dl,2Eh<br />	mov esi,eax<br />	sbb edx,edx<br />	mov eax,ecx<br />	adc esi,0<br />	jmp @F<br />again&#58;	lea eax,&#91;eax+4*eax&#93;<br />	inc esi<br />	lea eax,&#91;ecx+2*eax&#93;<br />@@&#58;	mov cl,&#91;esi&#93;<br />	sub cl,30h<br />	jns again<br />	add eax,edx<br />	pop esi<br />	xor eax,edx<br />	retn 4<br />        atodw endp  <br />OPTION PROLOGUE&#58;DefaultOption<br />OPTION EPILOGUE&#58;DefaultOption<br />; #########################################################################  <br /><br />end  <br /></code></pre><br /><br />here is KO test where the module replaces what was in it for m32lib.<br />I don't know what you see in your systems in my it is the fastest.</div>
    <div class="meta">Posted on 2002-08-11 19:29:51 by The Svin</div>
   </div>
   <div class="post" id="post-52762">
    <div class="subject"><a href="#post-52762">Fast a2dw</a></div>
    <div class="body">Alex,<br /><br />=================<br />As for my algo, I submit it several times already for MASM32 usage, question to Hutch why he still hasn't include it.<br />=================<br /><br />Its not a matter of laziness or indifference, its a workload that would kill most people and a bandwidth problem with MASM32 as it is taking up many gigabytes per month. With my own site, the log files are about 10 meg each couple of weeks and it is now going over its limits just as a referring site.<br /><br />I have just finished writing and debugging 250k of code for the new version of Quick Editor and I shortly have to write a compact version of MASM32v7 to try and reduce the bandwidth it is attracting.<br /><br />What I have in mind is producing a compact version and a service pack for people who have the current version so that there is no need to make the extra download.<br /><br />The work that you have done already is a valuable contribution to MASM32 that has been useful to many people and I would like to get all of you later versions into both so that everybody can easily get access at them.<br /><br />I also need to get Vladimir Kim's latest debugging library so that it can be used by people who use MASM32.<br /><br />Its just the normal problem that 48 hour days are not long enough to get everything done as fast as I would like it to be.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-08-11 20:08:19 by hutch--</div>
   </div>
   <div class="post" id="post-52772">
    <div class="subject"><a href="#post-52772">Fast a2dw</a></div>
    <div class="body"><div class="quote"><br />Please, remove my name from the test, damn you :)<br />I explicitly stated that I didn't give my own algo I just change KO to<br />expain him couple things.<br />As for my algo, I submit it several times already for MASM32 usage,<br />question to Hutch why he still hasn't include it.<br />It does more things, amoung converting itself it handles minus sign<br />and does negate if needed. <br />Though extra work done it runs faster (in PMMX at least) then all algos<br />used in KO test.<br />here is module:<br />&lt;..snip..&gt;<br />here is KO test where the module replaces what was in it for m32lib.<br />I don't know what you see in your systems in my it is the fastest. </div><br /><br />Hear ye, for this is the law (July 14th, 2001 until December 31st, 2030) <br />--------------------------------------------------------------------------------<br />There will be no cursing or swearing, not at each other nor casual. You come here to have fun or as a professional and swearing doesn't fit that category. Also words of certain nature like: w*rez, p*rn, f*ck, etc. could trigger 'webguards' at public institutions to block access to the site, which is something we don't wish to happen of course. (don't try to avoid the swearfilter by using substitute letters such as '@' for a etc... unless you want us to terminate your membership swiftly)</div>
    <div class="meta">Posted on 2002-08-11 22:23:30 by Qages</div>
   </div>
   <div class="post" id="post-52784">
    <div class="subject"><a href="#post-52784">Fast a2dw</a></div>
    <div class="body"><div class="quote"><br />Please, remove my name from the test, damn you :)<br />I explicitly stated that I didn't give my own algo I just change KO to expain him couple things.</div>Hahaha... :) Certainly - I'll change it to <em>Not Svin</em>. :)<br /><br />Here is <strong>buliaNaza</strong>'s previous posted effort:<pre><code><br />atodw	push	esi<br />	mov	eax,String<br />	mov	dl,&#91;eax&#93;<br />	xor	ecx,ecx<br />	cmp	dl,2Eh<br />	lea	esi,&#91;eax-1&#93;<br />	sbb	edx,edx<br />	mov	eax,ecx<br />@@	adc	esi,1<br />	lea	eax,&#91;eax+4*eax&#93;<br />	lea	eax,&#91;ecx+2*eax&#93;<br />	mov	cl,&#91;esi&#93; ; I'd change this to MOVZX<br />	sub	ecx,30h<br />	jns	@B<br />	add	eax,edx<br />	pop	esi<br />	xor	eax,edx<br />	ret</code></pre>So, far this gives the best time once it's in the cache:<pre><code>	OPTION PROLOGUE&#58;NONE<br />	OPTION EPILOGUE&#58;NONE<br />AsciiToDw5 proc lpAscii&#58;DWORD<br />	mov	ecx, &#91;esp+4&#93;<br />	movzx eax, BYTE PTR &#91;ecx&#93;<br /><br />	movzx edx, BYTE PTR &#91;ecx+1&#93;<br />	cmp edx, '0'<br />	jb _2<br />	lea	eax, &#91;eax*4+eax&#93;<br />	lea	eax, &#91;eax*2+edx-'0'*11&#93;<br /><br />	movzx	edx, BYTE PTR &#91;ecx+2&#93;<br />	sub edx, '0'<br />	jb @F<br />	lea	eax, &#91;eax*4+eax&#93;<br />	lea	eax, &#91;eax*2+edx&#93;<br /><br />	movzx	edx, BYTE PTR &#91;ecx+3&#93;<br />	sub edx, '0'<br />	jb @F<br />	lea	eax, &#91;eax*4+eax&#93;<br />	lea	eax, &#91;eax*2+edx&#93;<br /><br />	movzx	edx, BYTE PTR &#91;ecx+4&#93;<br />	sub edx, '0'<br />	jb @F<br />	lea	eax, &#91;eax*4+eax&#93;<br />	lea	eax, &#91;eax*2+edx&#93;<br /><br />	movzx	edx, BYTE PTR &#91;ecx+5&#93;<br />	sub edx, '0'<br />	jb @F<br />	lea	eax, &#91;eax*4+eax&#93;<br />	lea	eax, &#91;eax*2+edx&#93;<br /><br />	movzx	edx, BYTE PTR &#91;ecx+6&#93;<br />	sub edx, '0'<br />	jb @F<br />	lea	eax, &#91;eax*4+eax&#93;<br />	lea	eax, &#91;eax*2+edx&#93;<br /><br />	movzx	edx, BYTE PTR &#91;ecx+7&#93;<br />	sub edx, '0'<br />	jb @F<br />	lea	eax, &#91;eax*4+eax&#93;<br />	lea	eax, &#91;eax*2+edx&#93;<br /><br />	movzx	edx, BYTE PTR &#91;ecx+8&#93;<br />	sub edx, '0'<br />	jb @F<br />	lea	eax, &#91;eax*4+eax&#93;<br />	lea	eax, &#91;eax*2+edx&#93;<br /><br />	movzx	edx, BYTE PTR &#91;ecx+9&#93;<br />	sub edx, '0'<br />	jb @F<br />	lea	eax, &#91;eax*4+eax&#93;<br />	lea	eax, &#91;eax*2+edx&#93;<br />@@&#58;<br />	retn 4<br />_2&#58;<br />	sub eax,'0'<br />	retn 4<br />AsciiToDw5 endp<br />	OPTION PROLOGUE&#58;PROLOGUEDEF<br />	OPTION EPILOGUE&#58;EPILOGUEDEF</code></pre>:grin: (It is interesting to note <strong>Nexo</strong>'s PROC performs better than the unrolled version above, but has a higher initial cost - which in comparison, it is unable to overcome in ten characters.)</div>
    <div class="meta">Posted on 2002-08-11 23:19:17 by bitRAKE</div>
   </div>
   <div class="post" id="post-52811">
    <div class="subject"><a href="#post-52811">Fast a2dw</a></div>
    <div class="body">Hi all<br /><br />Well, I am going to use it in a real app with real users, and users are well known to not do what you want them to do. I need ridgid testing, no assumtions and I also need owerflow testing. The app imports text lines to a grid. I am testing with 20 000 lines, two text cells and two integer cells. This means 40 000 integer convertions. Lets say I optimize more and are able to save 20 cycles average. Total saved 800 000 cycles. Todays processors execute 100 000 000 cycles a second. Need I say that as long as I don't use masm32.lib it does not really matter, Here is the result.<br /><br /><pre><code><br />DecToBin proc lpStr&#58;DWORD<br />	LOCAL	fNeg&#58;DWORD<br /><br />	mov		ecx,lpStr<br />	xor		eax,eax<br />	xor		edx,edx<br />	mov		fNeg,eax<br />	cmp		byte ptr &#91;ecx&#93;,'-'<br />	jne		@1<br />	inc		ecx<br />	inc		fNeg<br />	jmp		@1<br />  @@&#58;<br />	cmp		eax,214748365<br />	jnb		Err<br />	lea		eax,&#91;eax*4+eax&#93;<br />	lea		eax,&#91;eax*2+edx&#93;<br />	inc		ecx<br />  @1&#58;<br />	mov		dl,&#91;ecx&#93;<br />	xor		dl,'0'<br />	cmp		dl,10<br />	jb		@b<br />	dec		fNeg<br />	je		@f<br />	or		eax,eax<br />	js		Err<br />	ret<br />  @@&#58;<br />	dec		eax<br />	js		Err<br />	inc		eax<br />	neg		eax<br />	clc<br />	ret<br />  Err&#58;<br />	xor		eax,eax<br />	dec		eax<br />	stc<br />	ret<br /><br />DecToBin endp<br /><br /></code></pre> <br />KetilO</div>
    <div class="meta">Posted on 2002-08-12 01:53:42 by KetilO</div>
   </div>
   <div class="post" id="post-52927">
    <div class="subject"><a href="#post-52927">Fast a2dw</a></div>
    <div class="body"><strong>BitRAKE</strong>.Thank you for test! :)<br />Cheat? :) I spin in my CPU and forgot about upper :(<br />Ha. The test environment may have a many cheats :)<br />Ok. I made correction:<br /><pre><code><br />AsciiToDw4 proc uses esi,lpAscii&#58;DWORD<br />	mov esi,lpAscii<br />	inc esi<br />	movzx eax,byte ptr &#91;esi-1&#93;<br />	sub eax,'0'<br />@@&#58;	movzx ecx,byte ptr &#91;esi+0&#93;<br />	movzx edx,byte ptr &#91;esi+1&#93;<br />	sub ecx,'0'<br />	sub edx,'0'<br />	cmp ecx,9<br />	ja @F<br />	lea eax,&#91;eax+4*eax&#93;<br />	lea eax,&#91;ecx+2*eax&#93;<br />	cmp edx,9<br />	ja @F<br />	add esi,2<br />	lea eax,&#91;eax+4*eax&#93;<br />	lea eax,&#91;edx+2*eax&#93;<br />	jmp @B<br />@@&#58;	ret<br />AsciiToDw4 endp<br /></code></pre><br /><br />Results (I reanimate Celeron at last :) ):<br /><pre><code><br /> -------------+--------------<br />  Celeron400  |AthlonXP1700+<br /> -------------+--------------<br />  K  T  B  N  | K  T  B  N<br />1 18 14 16 18 | 19 19 14 15<br />2 23 23 17 21 | 24 23 23 21<br />3 26 25 26 25 | 30 27 25 23<br />4 28 29 26 20 | 34 32 31 25<br />5 49 43 29 26 | 38 36 33 30<br />6 50 49 52 33 | 42 44 37 33<br />7 56 49 54 35 | 46 50 43 39<br />8 58 56 63 43 | 61 66 45 41<br />---------------------+--------------<br /></code></pre><br /><br />Intel have a strange clock gaps on some algo :)</div>
    <div class="meta">Posted on 2002-08-12 10:20:49 by Nexo</div>
   </div>
   <div class="post" id="post-52942">
    <div class="subject"><a href="#post-52942">Fast a2dw</a></div>
    <div class="body">The Svin. You again make <em>this</em>. STOP <em>THIS</em>. :grin: :grin: :grin: <br /><br /><a target="_blank" href="http://groups.google.com/groups?hl=ru&amp;lr=lang_en|lang_ru&amp;ie=UTF-8&amp;oe=CP1251&amp;inlang=ru&amp;th=7cdd3a603b2ec1fd&amp;seekm=997721454%40p47.f16.n5056.z2.FIDOnet.ftn#link1">http://groups.google.com/groups?hl=ru&amp;lr=lang_en|lang_ru&amp;ie=UTF-8&amp;oe=CP1251&amp;inlang=ru&amp;th=7cdd3a603b2ec1fd&amp;seekm=997721454%40p47.f16.n5056.z2.FIDOnet.ftn#link1</a><br /><br /><span style="font-size:9px> bitRAKE: Fix link for click - okay, I'm lazy enough for everyone. :)</span></div>
    <div class="meta">Posted on 2002-08-12 11:15:59 by Nexo</div>
   </div>
   <div class="post" id="post-52998">
    <div class="subject"><a href="#post-52998">Fast a2dw</a></div>
    <div class="body">Nexo, your link doesn't work.<br />Could you be so kind to explain what is it all about,<br />and what I did again?</div>
    <div class="meta">Posted on 2002-08-12 15:54:55 by The Svin</div>
   </div>
   <div class="post" id="post-53004">
    <div class="subject"><a href="#post-53004">Fast a2dw</a></div>
    <div class="body">Hi The Svin<br /><br />It works. Just copy both lines and pate it to the Adress field. It's in Russian so I cant read other than the code. :rolleyes: <br /><br />KetilO</div>
    <div class="meta">Posted on 2002-08-12 16:40:41 by KetilO</div>
   </div>
   <div class="post" id="post-53009">
    <div class="subject"><a href="#post-53009">Fast a2dw</a></div>
    <div class="body">Thanks Ketil.<br />It's discussion with Stepan about my algo,<br />he offers to rearange couple lines to make it shorter in<br />size (though a couple clocks slower).<br />I took finally his advise.<br />We discusses a lot of things with Stepan.<br /><br />Nexo, you can find better usage of your brain then trying to black me with plagiat.<br />You never secceed though keep talking  your &quot;again&quot;s.<br />Recalling old talks Stepan even had not had 64 bit dec convertion before I gave him my code. Then we discussed it alot exchanging by mail and in FidoNet.<br /><br />In your super lybrary carried by Stepan some procs with my changing and ideas, and I don't care that Stepan doesn't mention me, cause main ideas was his.<br /><br />You were witness when I change his MMX proc converting and he change it (updated) the super library and I mail him about it you, can ask him. Is there my name for the 2 changes? No, and I don't care. Main idea was his and I'm fine with it.<br />He helps me, I help him.<br />About 64 bit conversion and atodw main code and idea is mine so my name is here.<br /><br />He knows all about my activities, so if he cares he would say.<br />So stop playing his lower here. 'Cause the only effect it would have that I would stop submit any code or stop contact with Stepan, I know you don't care 'cause best of mycode anyway you'll get through his libs.<br />Is that what you want?<br /><br />Then you almost secceded - I just start regret that I ever shared my code with anybody.<br />GoodBye.</div>
    <div class="meta">Posted on 2002-08-12 17:18:45 by The Svin</div>
   </div>
   <div class="post" id="post-53042">
    <div class="subject"><a href="#post-53042">Fast a2dw</a></div>
    <div class="body">The Svin. You can use any code where you want and how you want. You make mark all line own (C) and e.t.c. It is you matter. I does known what about ideas you speak. Because Stepan use own optimizing tools where used a base rules of optimization and trick methods. I want create likewise tools, but need a big experience for this. Stepan can gave a suggest in the form of pie of code, but no terminated optimization code. I glad have such teacher. Really I dont known why you post here this slow (~17-20% from you super speed m32lib version). You inconsistently in code optimization or some other. You can regret shared code. Here a many other good programmers. The loss will be not so big. I still here, because like assembler and good company.</div>
    <div class="meta">Posted on 2002-08-12 22:02:09 by Nexo</div>
   </div>
   <div class="post" id="post-53055">
    <div class="subject"><a href="#post-53055">Fast a2dw</a></div>
    <div class="body">Guys,<br /><br />I know that both of you are very experienced programmers and I have seen some excellent code from both of you so I would hope that you both can find a way to get on with each other as the whole community benefits from the algorithm design that both of you have contributed.<br /><br />Surely small differences are not things worth arguing about as there will always be range and variation in assembly coding. I would hate to see either of you offended from things that were said in this forum when both of you have much to contribute.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-08-13 00:45:44 by hutch--</div>
   </div>
   <div class="post" id="post-53139">
    <div class="subject"><a href="#post-53139">Fast a2dw</a></div>
    <div class="body">Branch minimized algo :) It is only for get to know, not for use ;)<br />Number limits from 0 to 10^8-1<br /><pre><code><br />align 8<br />n2F	dq 2F2F2F2F2F2F2F2Fh<br />n39	dq 3939393939393939h<br />n30	dq 3030303030303030h<br /><br />mult label qword<br />dw 1,0,0,0		; 1<br />dw 10,1,0,0		; 2<br />dw 100,10,1,0	; 3<br />dw 1000,100,10,1	; 4<br /><br />mult2	dd 10,100,1000,10000<br /><br />	mov eax,&#91;lpAscii&#93;<br />	pxor mm7,mm7<br />	movq mm0,&#91;eax&#93;<br />	movq mm1,mm0<br />	movq mm2,mm0<br />	pcmpgtb mm1,&#91;n2F&#93;<br />	pcmpgtb mm2,&#91;n39&#93;<br />	psubb mm0,&#91;n30&#93;<br />	pandn mm2,mm1<br />	pand mm0,mm2<br />	pmovmskb eax,mm2<br />	not eax<br />	bsf ecx,eax<br />	test eax,11110000b<br />	je @F<br />	punpcklbw mm0,mm7<br />	pmaddwd mm0,&#91;mult+8*ecx-8&#93;<br />	pshufw mm1,mm0,1110b<br />	paddd mm0,mm1<br />	movd eax,mm0<br />	ret<br />@@&#58;	movq mm1,mm0<br />	punpcklbw mm0,mm7<br />	punpckhbw mm1,mm7<br />	pmaddwd mm0,&#91;mult+3*8&#93;<br />	pmaddwd mm1,&#91;mult+8*ecx-8*5&#93;<br />	pshufw mm2,mm0,1110b<br />	pshufw mm3,mm1,1110b<br />	paddd mm0,mm2<br />	paddd mm1,mm3<br />	movd edx,mm0<br />	movd eax,mm1<br />	imul edx,&#91;mult2+4*eax-4*5&#93;<br />	add eax,edx<br />	ret<br /></code></pre><br /><br />*Edit* little bug fixed :)</div>
    <div class="meta">Posted on 2002-08-13 09:57:53 by Nexo</div>
   </div>
   <div class="post" id="post-53180">
    <div class="subject"><a href="#post-53180">Fast a2dw</a></div>
    <div class="body"><div class="quote">The loss will be not so big.</div> <br /><br />:)<br />I just wondered when at the end you'd say it.<br /><br />OK Mr.Nexo I'll make you try your own medicin when I have a little time.<br />That is the promise.</div>
    <div class="meta">Posted on 2002-08-13 13:28:25 by The Svin</div>
   </div>
   <div class="post" id="post-53184">
    <div class="subject"><a href="#post-53184">Fast a2dw</a></div>
    <div class="body"><div class="quote">I modificate test.</div> <br />Nexo,<br />in your modified test, running on my machine your proc Still shows THE SLOWEST results.<br />For all strlengths!<br />And replaced m32lib version with what I posted here (you called it super slow) - the fastest.<br />Taking in mind your age, I will not make laugh on you, just give you a possible<br />explonation:<br />Most likely you test (and as susequense optimize) for Althon.<br />And what is fastest on Althon appeared to be slowest on original Pentium.<br />I'll give you my position:<br />I write for Pentium, for me Althon doesn't exist.<br />Not because I hate Althon, Oh NO, I absolutly indifferent to it.<br />There is very simple explonation: <br />all machines that run my code are Pentiums (from PMMX to PIII).<br />If in the future I'd need to write for Althon - I'd study it. Until the time I don't care.<br /><br />So next time you are going to say anything about wich is slow or fast:<br />just remember that you looking to the world through horse-blinders named &quot;Althon&quot;.<br />And what is true for Althon might be not true for brand Pentium.<br /><br />I mean several times you gave me advices to change my code, and all this times<br />your modifications ran slower on my machine then my original.<br /><br />Take care :)</div>
    <div class="meta">Posted on 2002-08-13 14:01:33 by The Svin</div>
   </div>
   <div class="post" id="post-53236">
    <div class="subject"><a href="#post-53236">Fast a2dw</a></div>
    <div class="body"><strong>Nexo</strong>, I think of same algo with MMX. :)  Very good.</div>
    <div class="meta">Posted on 2002-08-14 00:11:41 by bitRAKE</div>
   </div>
   <div class="post" id="post-53331">
    <div class="subject"><a href="#post-53331">Fast a2dw</a></div>
    <div class="body"><div class="quote"><br /> <br />all machines that run my code are Pentiums (from PMMX to PIII).<br />If in the future I'd need to write for Althon - I'd study it. Until the time I don't care.<br /></div><br />It is you problems.<br /><br /><div class="quote"><strong> <br />just remember that you looking to the world through horse-blinders named &quot;Althon&quot;.<br />And what is true for Althon might be not true for brand Pentium.<br /></div><br />I remark my proc what is special for Athlon. Get to know a problem of stability of tests.  But I made test also on <strong>Intel</strong> Celeron. Celeron 400Mhz is family of <strong>Pentium II</strong> processors (or you dont known about it?). I dont understand why you post it.<br /><br />If you write code for Pentium II and Pentium III (you write it above), then you must known how work it processors. Pentium and Pentium MMX have a very restriction possibility of superscalar execution. <strong>Other Pentuim</strong> processor have more piplines and at the same time execution units. For more learn you can look on results of VTune Prefomance Analyzer (i use it for optimization my algo!). And compare two algo. You presented algo will have very more stalls. It is true for all <strong>Intel</strong> CPU from <strong>Pentium Pro</strong> to <strong>Pentium 4</strong> (it is <strong>majority</strong> of all model of <strong>Intel</strong>). I dont say about <strong>AMD</strong>. And me hardly consider such rarely CPU (Pentium &amp; PMMX) in optimization. I lose my PMMX166 in trash can.<br /><br />In the last <strong>you</strong> test (file ta2w.zip) you make some strange change. All look here:<br /><pre><code><br />AsciiToDw2 proc lpAscii&#58;DWORD<br /><br />	mov		ecx,lpAscii<br />	xor		eax,eax<br />	xor		edx,edx<br />;	jmp		@1<br />  @@&#58;<br />	lea		eax,&#91;eax*4+eax&#93;		;Multiply by 5<br />	lea		eax,&#91;eax*2+edx&#93;		;Multiply by 2 and add digit in edx<br />	inc		ecx<br />  @1&#58;<br />	mov		dl,&#91;ecx&#93;<br />	sub		dl,'0'<br />	jb		@f<br />	cmp		dl,10<br />	jb		@b<br />  @@&#58;<br />	ret<br /><br />AsciiToDw2 endp<br /></code></pre><br />I think it is not work correctly on ANY processor.<br />I also more disappointed in you :(<br />You can continue make laugh on me.</div>
    <div class="meta">Posted on 2002-08-14 11:34:04 by Nexo</div>
   </div>
   <div class="post" id="post-53344">
    <div class="subject"><a href="#post-53344">Fast a2dw</a></div>
    <div class="body">Why the jb @f?<br />1 less instruction:<br /><br /><pre><code>&#91;b&#93;	mov	dl, &#91;ecx&#93;<br />	sub	dl,'0'<br />	cmp	dl,10<br />	jb	@b&#91;/b&#93;</code></pre></div>
    <div class="meta">Posted on 2002-08-14 12:39:10 by iblis</div>
   </div>
   <div class="post" id="post-53392">
    <div class="subject"><a href="#post-53392">Fast a2dw</a></div>
    <div class="body">Nexo,<br /><br />If I have learnt this much, if you have to write algorithms that are general purpose, you must test them on both Intel and AMD and average the end result across both.<br /><br />I keep an older AMD here to test against my PIII as they were about similar period technology. I have done some work on my PIV and it is different code to the PIII and to get later design algos going properly, they would need to be tested on an Athlon as well. The PIII is the easiest code to mess up and get bad results for, it behaves differently to older Intel processors and different to the PIV as well.<br /><br />When I last did some serious work that had to work on both, Intel processors had better branch prediction but had bad penalties for pipeline stalls, AMD had a shorter pipeline and a lower stall penalty but was slower in unpredictable branching.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-08-14 22:24:07 by hutch--</div>
   </div>
   <div class="post" id="post-53477">
    <div class="subject"><a href="#post-53477">Fast a2dw</a></div>
    <div class="body"><div class="quote"><br />If I have learnt this much, if you have to write algorithms that are general purpose, you must test them on both Intel and AMD and average the end result across both.<br /></div><br />Yes, you right. You can look on Intel and AMD results of tests in this thread of my posting. But I can't made tests on Intel 386,486,Pentium,PMMX and 386,486,586,K5 processors. In any case I prefer have several algo for different processors and make build of application on target CPU (or blind). I dont support oldest (look above), because it is rarely (they have low frequency). May be you make optimization also for Transmeta? I do then it is needs. Why you choose Intel and AMD for average tests? I think same causes for forget testing on oldest CPU.<br /><br />Thanks.</div>
    <div class="meta">Posted on 2002-08-15 10:48:21 by Nexo</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=7265&amp;page=1" style="">&laquo;</a><a href="../?id=7265&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="7265" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>