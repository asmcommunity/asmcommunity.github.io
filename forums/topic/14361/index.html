<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>environment variables in cmd - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14361" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=14361">environment variables in cmd</a></p>
   <div class="post" id="post-111082">
    <div class="subject"><a href="#post-111082">environment variables in cmd</a></div>
    <div class="body">Hi!<br /><br />I want to create a new environment var in the current cmd.exe. In order to do this, I wrote:<br /><br />invoke SetRegString, HKEY_LOCAL_MACHINE,<br />   CTEXT(&quot;System\CurrentControlSet\Control\Session Manager\Environment\&quot;),<br />   CTEXT(&quot;NewVar&quot;),<br />   CTEXT(&quot;g?fs&quot;)<br /><br />invoke SendMessage,HWND_BROADCAST,WM_WININICHANGE,0,CTEXT(&quot;Environment&quot;)<br /><br />The variable is not created in the actual window but, if I open another cmd.exe, the variable is visible.<br /><br />I need the to inspect the contents of that string after executing the program, in the same window. I had an old program that did it writing directly in the MCB of his father (in other words: I could execute a program in a DOS window that creates inmediately an env. variable to be examined in the next command inside a .BAT file). But this technique doesn't work in nt, 2000 or XP.<br /><br />Really, I want to do something like this (in a DOS window, of course, and inside a bat):<br /><br />cd &gt; myvar.txt<br />myprogram myvar &lt; myvar.txt<br />dir /s %myvar%\*.* &gt; \myfile.txt<br /><br />Anybody can help me?<br /><br />Thanks:cool: :cool:</div>
    <div class="meta">Posted on 2003-07-18 16:17:25 by miguelossa</div>
   </div>
   <div class="post" id="post-111175">
    <div class="subject"><a href="#post-111175">environment variables in cmd</a></div>
    <div class="body">dir &quot;%~dp0&quot;\*.* &gt; thefile.txt<br /><br />looks like to work fine. It was a pitty to lose time fitghting with assembler &amp; API's.<br /><br />But it was funny!! ;)</div>
    <div class="meta">Posted on 2003-07-19 10:42:52 by miguelossa</div>
   </div>
  </div>
 </body>
</html>