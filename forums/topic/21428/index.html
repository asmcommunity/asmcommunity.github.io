<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>How do you create a simple sniffer program? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=21428" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=8">Networking</a> &raquo; <a href="../?id=21428">How do you create a simple sniffer program?</a></p>
   <div class="post" id="post-161824">
    <div class="subject"><a href="#post-161824">How do you create a simple sniffer program?</a></div>
    <div class="body">Hi, I&#39;m trying to create a graphical shell for an online IRC game, and I was wondering how I could see what what exactly was being sent and recieved by mIRC, and I want to know how to do a simple program that would do that, but could you explain to me how to do this?<br /><br />Correction: Oh, this kind of program is called a &quot;sniffer&quot;. Also, I noticed that hitchhikr had created a program that did this job (look <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=15786.0">here</a>.) and I was wondering if it came with source code (the program was removed. :mad:) and if it did, could someone point me to it?<br /><br />P.S. Please don&#39;t point me to some site explaining the IRC protocol, I want to have a learning tool.? ;)<br /><br /></div>
    <div class="meta">Posted on 2005-07-08 14:00:45 by SecretSwampert67</div>
   </div>
   <div class="post" id="post-161825">
    <div class="subject"><a href="#post-161825">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">For your task, the IRC protocol <strong>would</strong> be the best reference.<br /><br />But you might want to have a look at http://www.winpcap.org/misc/links.htm</div>
    <div class="meta">Posted on 2005-07-08 14:09:01 by f0dder</div>
   </div>
   <div class="post" id="post-161862">
    <div class="subject"><a href="#post-161862">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">Err... If I didn&#39;t specify it well enough, I&#39;m just trying to create my own sniffer. I _don&#39;t_ want to have to install any drivers/files/etc to do that job. I just want to create my own.<br /><br />If that&#39;s not possible in Win32Asm without installing some kind of extra file, you can just tell me it&#39;s impossible.</div>
    <div class="meta">Posted on 2005-07-09 15:41:17 by SecretSwampert67</div>
   </div>
   <div class="post" id="post-161863">
    <div class="subject"><a href="#post-161863">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">Yes it is possible with Assembler.<br /></div>
    <div class="meta">Posted on 2005-07-09 17:47:57 by James_Ladd</div>
   </div>
   <div class="post" id="post-161872">
    <div class="subject"><a href="#post-161872">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">&quot;everything&quot; is possible in win32 assembly. What you want to do is possible in C or C++ as well. What you need to do is tell us WHAT exactly you want to do, and WHY you want to do it. There&#39;s too many script kiddies around, and we don&#39;t want to help those. What protocol level do you want to sniff? All ethernet, or just IP traffic?<br /></div>
    <div class="meta">Posted on 2005-07-09 21:05:15 by f0dder</div>
   </div>
   <div class="post" id="post-161877">
    <div class="subject"><a href="#post-161877">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">Here&#39;s a small example for raw socket for 2000/XP systems. It shows only download/upload speed.<br />Something like this I&#39;ve used in a bigger project to prevent browser connections with ad-servers, this look like real sniffer but has a &quot;ban/unban&quot; option :D<br /><br />language syntax: nasm :)<br />standard include file not attached</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=742" target="_blank">RawSocket demo.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2005-07-09 22:52:55 by sapero</div>
   </div>
   <div class="post" id="post-161882">
    <div class="subject"><a href="#post-161882">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">Hello Sapero,<br /><br />That&#39;s a really cool program&nbsp;  ;) Thanks for sharing</div>
    <div class="meta">Posted on 2005-07-09 23:48:26 by roticv</div>
   </div>
   <div class="post" id="post-161887">
    <div class="subject"><a href="#post-161887">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">That is interesting and nice-looking coding style, <strong>sapero</strong>. Could you post the ams.inc (et cetera) includes you are using, or if it&#39;s part of some bigger package, the link to the package?</div>
    <div class="meta">Posted on 2005-07-10 01:09:18 by f0dder</div>
   </div>
   <div class="post" id="post-161899">
    <div class="subject"><a href="#post-161899">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">sorry for the time, I had problem with dns<br />Uploaded <a target="_blank" href="http://people.freenet.de/sapero/RawSocket_demo_all.zip">all neccesary files</a> for compilling this example; including nasm and linker :)</div>
    <div class="meta">Posted on 2005-07-10 06:18:59 by sapero</div>
   </div>
   <div class="post" id="post-161907">
    <div class="subject"><a href="#post-161907">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">Man, am I slow.? :O<br /><br />Awesome work sapero, I&#39;m looking through your source code, maybe I could use that to make my sniffer.<br /><br />I was pretty sure that saying that it wouldn&#39;t be possible in Assembler might get a few posts.? ;)<br /><br />Alright, to explain:<br />Ok, I want to see inbound and outbound traffic being set to and from mIRC. I personally guess that it would have something to do with pipes, although that might not be it. Anyway, I want the data to be saved to two separate files, input and output (probably in TXT format). Also, I only want data from the IP Traffic.<br /><br />I want to do this because I want to create a graphical IRC application, and therefore need to understand at least the following...<br /><br />Signing in, Personal Messages, and the Server&#39;s User list.<br /><br />Whenever I saw a IRC application, it would only be able to sign in, but I need the other two functions as well. (Automated Bots take commands by personal messages and speaking on the server was disabled, and I need to know which bots are on.)<br /><br />I&#39;d give you the server and channel, but you guys wouldn&#39;t be interested. :P</div>
    <div class="meta">Posted on 2005-07-10 09:29:56 by SecretSwampert67</div>
   </div>
   <div class="post" id="post-161930">
    <div class="subject"><a href="#post-161930">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">so, what&#39;s wrong with internet today? I cannot update this example on freenet server, too many lags.<br />http://rapidshare.de/files/2954902/RawSocket_demo_all.zip.html<br />Received/sent data is splitted into two text files 8)<br />I leave the rest for you. Let me known all bugs ;)<br /><br />case (src_ip&lt;&gt;LOCAL_IP) and (dst_ip&lt;&gt;LOCAL_IP) is not handled (message not from/for you)</div>
    <div class="meta">Posted on 2005-07-10 16:27:17 by sapero</div>
   </div>
   <div class="post" id="post-162003">
    <div class="subject"><a href="#post-162003">Re: How do you create a simple sniffer program?</a></div>
    <div class="body"><br />Hi sapero,<br /><br />The program works as supposed on my Win2k SP4 regarding trafic monitoring, but when i click on the combo to choose the interface or on &quot;Stop&quot; button it crashes every time (it may be because of my Kerio firewall ..? )<br /><br />Eugen<br /></div>
    <div class="meta">Posted on 2005-07-12 18:01:56 by Eugen</div>
   </div>
   <div class="post" id="post-162007">
    <div class="subject"><a href="#post-162007">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">Eugen, <br /><br />try to debug this proggy, here on xp home/pro i have clean, no exceptions<br />Maybe memory access from thread to global variables schould be changed to Interlocked*()<br />The firewall has nothing to do with this proggy (99%), the name of raw socket handle is \Device\RawIp\0<br /><br />And try to compile with new import libraries (use libtool, alib from nagoa...)<br />or break the while loop in ThreadProc() - remove jmp .receive<br />do not run timer TIMER_UPDATESPEED in RawCreate()<br />change image base in make.bat</div>
    <div class="meta">Posted on 2005-07-12 19:49:49 by sapero</div>
   </div>
   <div class="post" id="post-162046">
    <div class="subject"><a href="#post-162046">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">Sapero,<br /><br />I have the same problem with your program as Eugen does, on Win2K SP4. If my analysis is correct, then one of your macros has a built-in error. Look at a disassembly of the dialog procedure:<br /><br /><pre><code><br />00401278&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; off_00401278:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Xref 00401254<br />00401278 55&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  push&nbsp; &nbsp; ebp<br />00401279 89E5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp;  ebp,esp<br />0040127B 53&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  push&nbsp; &nbsp; ebx<br />0040127C 57&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  push&nbsp; &nbsp; edi<br />0040127D 56&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  push&nbsp; &nbsp; esi<br />0040127E 81EC08000000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  sub&nbsp; &nbsp;  esp,8<br />00401284 817D0C10010000&nbsp; &nbsp; &nbsp; &nbsp;  cmp&nbsp; &nbsp;  dword ptr ,110h<br /></code></pre><br /><br />That part of the code sets up a stack frame, pushes EBX, EDI, and ESI, and then reserves 8 bytes for local variables. Note that the local variables are thus located at , i.e., at .<br /><br />Later in the code, the local variables are accessed. However, they are addressed with the wrong offset from EBP:<br /><br /><pre><code><br />004012FF&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loc_004012FF:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Xref 004012DA<br />004012FF 817D0C11010000&nbsp; &nbsp; &nbsp; &nbsp;  cmp&nbsp; &nbsp;  dword ptr ,111h<br />00401306 0F853B000000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jne&nbsp; &nbsp;  loc_00401347<br />0040130C 8B4510&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp;  eax,<br />0040130F 89C2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp;  edx,eax<br />00401311 C1EA10&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  shr&nbsp; &nbsp;  edx,10h<br />00401314 8955F8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp;  ,edx&nbsp; &nbsp; &nbsp; &nbsp; ; &lt;== this overwrites the saved value of EDI<br />00401317 25FFFF0000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  and&nbsp; &nbsp;  eax,0FFFFh<br />0040131C 8945FC&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp;  ,eax&nbsp; &nbsp; &nbsp; &nbsp; ; &lt;== this overwrites the saved value of EBX<br />0040131F 817DFCF3030000&nbsp; &nbsp; &nbsp; &nbsp;  cmp&nbsp; &nbsp;  dword ptr ,3F3h<br />00401326 0F8516000000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jne&nbsp; &nbsp;  loc_00401342<br />0040132C 817DF800000000&nbsp; &nbsp; &nbsp; &nbsp;  cmp&nbsp; &nbsp;  dword ptr ,0<br />00401333 7508&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jnz&nbsp; &nbsp;  loc_0040133D<br /></code></pre><br /><br /> and  would be the correct addresses if EBX / ESI / EDI had not been pushed. However, they have been pushed, and the pushed values on the stack get overwritten now. Which leads to problems on Win2K when later restoring EBX / ESI / EDI from the stack. WinXP is much more forgiving in that respect.<br /><br />Regards<br /><br />&nbsp; &nbsp; Frank<br /></div>
    <div class="meta">Posted on 2005-07-13 10:51:16 by Frank</div>
   </div>
   <div class="post" id="post-162047">
    <div class="subject"><a href="#post-162047">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">Not for me. *has XP SP2*<br /><br />Crashes whenever I click that bugger. X_X</div>
    <div class="meta">Posted on 2005-07-13 11:04:38 by SecretSwampert67</div>
   </div>
   <div class="post" id="post-162053">
    <div class="subject"><a href="#post-162053">Re: How do you create a simple sniffer program?</a></div>
    <div class="body">sub esp,8 - this must be macro SUB with folloved UINT (local variable)<br />Here is other macro PROC fn_name, stack_size {, parameters}, it uses only enter x,y; the &quot;sub esp&quot; is not applyed<br /><br />I&#39;ve replaced all SUB&#39;s (with local variables) with PROC macro, and fixed the if*equal macro :)<br />The SUB macro is good if you do not use local variables, in PROC macro you must specify the stack frame size<br /><br />http://www.qfile.de/dl/83301/rawsocket_demo_all.zip.html<br /></div>
    <div class="meta">Posted on 2005-07-13 12:48:48 by sapero</div>
   </div>
  </div>
 </body>
</html>