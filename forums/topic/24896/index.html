<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>GDI Background Painting - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=24896" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=24896">GDI Background Painting</a></p>
   <div class="post" id="post-181962">
    <div class="subject"><a href="#post-181962">GDI Background Painting</a></div>
    <div class="body">I am so naive about GDI painting so forgive me if my code is terribly wrong.&nbsp; Originally I was painting the background by just putting a really large brush in the background element of the window class I registered for the main window.&nbsp; My needs have outgrown that though.&nbsp; I am now trying to use a set of brushes to paint the background of my main window.&nbsp; I have a brush for top-left-corner, top-right-corner, top-span, side-span, etc.&nbsp; Everything I&#39;ve tried leaves me with a bunch of garbled up results as the background and I just can&#39;t figure out what I&#39;m doing wrong.&nbsp; Maybe someone can look at my code and spot a glaring problem.&nbsp; If the whole thing is just bad then let me know that too.&nbsp; Sorry for posting so much code but I don&#39;t know where the problem is.&nbsp; Here is the excerpt from my WNDPROC:<br /><br /><div class="quote"><br />&nbsp; &nbsp; .ELSEIF uMsg==WM_PAINT<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Check for an update region<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; GetUpdateRect, hWnd, ADDR rect, TRUE<br />&nbsp; &nbsp; &nbsp; &nbsp; .IF(eax==0)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  eax, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret<br />&nbsp; &nbsp; &nbsp; &nbsp; .ENDIF<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Setting the batch helps prevent flickering from the background erase<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; GdiSetBatchLimit ,25<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; Start the painting operation&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; BeginPaint, hWnd, ADDR ps<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; Blit the results into the DC using SRCCOPY<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; BitBlt ,ps.hdc,0,0,ps.rcPaint.right,ps.rcPaint.bottom,hDCBackgroundCopy,0,0,SRCCOPY<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; Flush the GDI cache to finish drawing onto the control<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; GdiFlush<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; EndPaint, hWnd, ADDR ps<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  eax, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br /><br />&nbsp; &nbsp; .ELSEIF uMsg==WM_SIZE<br />&nbsp; &nbsp; &nbsp; &nbsp; ;##: Delete the old DC and bitmap<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCBackgroundCopy, hBmpBackgroundCopy<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; DeleteObject, hBmpBackgroundCopy<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; ReleaseDC, hWnd, hDCBackgroundCopy<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; DeleteDC, hDCBackgroundCopy&nbsp; &nbsp; &nbsp; <br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; Get the size and the DC<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; GetWindowRect, hWnd, ADDR rect<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; CreateRoundRectRgn, rect.left, rect.top, rect.right, rect.bottom, dwMainWidth, dwMainHeight<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  hRegion, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; GetWindowRgn, hWnd, hRegion<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; GetRgnBox, hRegion, ADDR rect<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ;invoke&nbsp; dwtoa, rect.right, ADDR debugBuffer<br />&nbsp; &nbsp; &nbsp; &nbsp; ;invoke&nbsp; MessageBox, hWnd, ADDR debugBuffer, ADDR AppTitle, MB_OK<br />&nbsp; &nbsp; &nbsp; &nbsp; ;invoke&nbsp; dwtoa, rect.bottom, ADDR debugBuffer<br />&nbsp; &nbsp; &nbsp; &nbsp; ;invoke&nbsp; MessageBox, hWnd, ADDR debugBuffer, ADDR AppTitle, MB_OK&nbsp; &nbsp; &nbsp; &nbsp; <br /><br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; GetWindowDC, hWnd<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  hDCWin, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; ; Copy the DC and create a Bitmap for it and select it into it for drawing<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; CreateCompatibleDC, hDCWin<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  hDCCopy, eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; CreateCompatibleBitmap, hDCWin, rect.right, rect.bottom<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  hBmpCopy, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, hBmpCopy<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  hBmpCopy, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  hBmpBackgroundCopy, eax&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; ; Set the properties for the DC (font, text color) and fill the background to black<br />&nbsp; &nbsp; &nbsp; &nbsp; ;invoke&nbsp; SetBkColor, hDCCopy, 0ffeec1h<br />&nbsp; &nbsp; &nbsp; &nbsp; ;invoke&nbsp; CreateSolidBrush, 0ffeec1h<br />&nbsp; &nbsp; &nbsp; &nbsp; ;push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; ;invoke&nbsp; FillRect, hDCCopy, ADDR rect, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; ;pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; ;invoke&nbsp; DeleteObject, eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; Paint the left side span<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, hBmpBkgSideL<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, rect.top<br />&nbsp; &nbsp; &nbsp; &nbsp; .WHILE(eax&lt;rect.bottom)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; PatBlt, hDCCopy, 0, eax, 32, 2, PATCOPY<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  eax, 2<br />&nbsp; &nbsp; &nbsp; &nbsp; .ENDW<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; Paint the right side span<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, hBmpBkgSideR<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, rect.right<br />&nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  edx, 32<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, rect.top<br />&nbsp; &nbsp; &nbsp; &nbsp; .WHILE(eax&lt;rect.bottom)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; PatBlt, hDCCopy, edx, eax, 32, 2, PATCOPY<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  eax, 2<br />&nbsp; &nbsp; &nbsp; &nbsp; .ENDW<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; Paint the top span<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, hBmpBkgTop<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, rect.left<br />&nbsp; &nbsp; &nbsp; &nbsp; .WHILE(eax&lt;rect.right)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; PatBlt, hDCCopy, eax, 0, 2, 32, PATCOPY<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  eax, 2<br />&nbsp; &nbsp; &nbsp; &nbsp; .ENDW<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; Paint the bottom span<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, hBmpBkgBot<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, rect.bottom<br />&nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  edx, 32<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, rect.left<br />&nbsp; &nbsp; &nbsp; &nbsp; .WHILE(eax&lt;rect.right)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; PatBlt, hDCCopy, eax, edx, 2, 32, PATCOPY<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  eax, 2<br />&nbsp; &nbsp; &nbsp; &nbsp; .ENDW<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; ; Paint the top-left corner<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, hBmpBkgCornerTL<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; PatBlt, hDCCopy, 0, 0, 32, 32, PATCOPY<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; Paint the top-right corner<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, hBmpBkgCornerTR<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, rect.right<br />&nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  eax, 32<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; PatBlt, hDCCopy, eax, 0, 32, 32, PATCOPY<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; Paint the bottom-left corner<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, hBmpBkgCornerBL<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, rect.bottom<br />&nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  eax, 32<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; PatBlt, hDCCopy, 0, eax, 32, 32, PATCOPY<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; Paint the top-right corner<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, hBmpBkgCornerBR<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, rect.right<br />&nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  eax, 32<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, rect.bottom<br />&nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  edx, 32<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; PatBlt, hDCCopy, eax, edx, 32, 32, PATCOPY<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SelectObject, hDCCopy, eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /><br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; hDCCopy<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  hDCBackgroundCopy<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; ReleaseDC ,hWnd,hDCWin<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  eax, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; ret&nbsp; &nbsp; <br /><br />&nbsp; &nbsp; .ELSEIF uMsg==WM_ERASEBKGND<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Get the size and the DC<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; GetWindowRect, hWnd, ADDR rect<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, rect.right<br />&nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  eax, rect.left<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  rect.right, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, rect.bottom<br />&nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  eax, rect.top<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  rect.bottom, eax&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  rect.top, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  rect.left, 0<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; ; Set the properties for the DC (font, text color) and fill the background to black<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; SetBkColor, wParam, 0ffeec1h<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; CreateSolidBrush, 0ffeec1h<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; FillRect, wParam, ADDR rect, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; DeleteObject, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br /></div></div>
    <div class="meta">Posted on 2006-06-16 17:35:26 by rdaneel</div>
   </div>
   <div class="post" id="post-181967">
    <div class="subject"><a href="#post-181967">Re: GDI Background Painting</a></div>
    <div class="body">Hi rdaneel,<br /><br />I had a quick look at your code and I think I know what you&#39;re doing - but - to not confuse you with (wrong) assumptions could you describe what exactly you like to achieve?<br /><br />If I am not mistaken you only paint something on the DC besides painting it black on EraseBackground is during a WM_Size message. Is that how you want it? Is there other code painting those 4 corners somewhere else?<br /></div>
    <div class="meta">Posted on 2006-06-16 18:25:20 by JimmyClif</div>
   </div>
   <div class="post" id="post-181969">
    <div class="subject"><a href="#post-181969">Re: GDI Background Painting</a></div>
    <div class="body">That&#39;s close.&nbsp; What I am wanting to do is hold a buffer of the assembled background image and then blt from that buffer onto the hdc whenever a WM_PAINT is called.&nbsp; Since the window is resizable I just create the newly assembled background bmp once per WM_SIZE message and blt off of it during WM_PAINT.&nbsp; There are child controls on the window so I figured that assembling the complete background in a buffer and blt&#39;ing it into the clipped DC that BeginPaint returns was the only way to keep everything sane.&nbsp; It sounded like a good plan in my mind but if you know of a better way I&#39;d love to hear it.&nbsp; Here are a couple of screen shots if it will clarify.&nbsp; It looks almost good but when the window resizes it gets worse.<br /><br />The way it should look:<br /><img src="http://www.sector62.com/images/good.jpg" /><br /><br />The way it looks now:<br /><img src="http://www.sector62.com/images/bad.jpg" /><br /><br />Resized to small looks real bad:<br /><img src="http://www.sector62.com/images/bad-small.jpg" /></div>
    <div class="meta">Posted on 2006-06-16 18:59:27 by rdaneel</div>
   </div>
   <div class="post" id="post-181970">
    <div class="subject"><a href="#post-181970">Re: GDI Background Painting</a></div>
    <div class="body">Without trying anything it looks to me like your code is 1 pixel off that&#39;s where the black line comes in. You should prevent your window to be able to get resized smaller than at least 64 x 64 due to the 4 corners you paint.<br /><br /><u>But here&#39;s my scoop on the deal</u><br /><br />You can cut out a lot of baloney (Api calls) when you do the following:<br /><br />First add these two procs to your repertoire<br /><br /><pre><code><br />;======================================================================== <br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  GetBitmapDC <br />;======================================================================== <br />;&nbsp; Usage: <br />;&nbsp; invoke GetBitmapDC, ADDR BitmapDC, ADDR NameOfBitmap, ADDR hBitmap, hwnd <br />;This is used to create DC&#39;s for Bitmaps. Just pass : <br />;BitmapDC a dword - which will receive the DC you&#39;ll be working with later on. <br />;NameOfBitmap - the name of the Bitmap to take into the DC. <br />;HandleOfBitmap - an empty dword which will receive the handle of the Bitmap. <br />;Do not forget to DeleteDC and DeleteObject for the created Handle and DC at program exit.<br />;======================================================================== <br />GetBitmapDC proc AnotherDC:DWORD, BitmapADDR:DWORD,HandleOfBitmap:DWORD, hwnd:DWORD <br />&nbsp; &nbsp; invoke GetDC,hwnd <br />&nbsp; &nbsp; push eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;1 push DC for release later <br />&nbsp; &nbsp; invoke CreateCompatibleDC,eax <br />&nbsp; &nbsp; mov edx,AnotherDC <br />&nbsp; &nbsp; push eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;2 push DC for SelectObject <br />&nbsp; &nbsp; mov ,eax <br />&nbsp; &nbsp; invoke LoadBitmap,hInstance,BitmapADDR <br />&nbsp; &nbsp; mov edx,HandleOfBitmap <br />&nbsp; &nbsp; pop ecx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;2 pop Created DC <br />&nbsp; &nbsp; mov ,eax <br />&nbsp; &nbsp; invoke SelectObject,ecx,eax <br />&nbsp; &nbsp; pop eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;1 pop DC to release <br />&nbsp; &nbsp; invoke ReleaseDC,hwnd,eax <br />ret <br />GetBitmapDC endp<br /><br />;======================================================================== <br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  GetCompatibleBitmap <br />;======================================================================== <br />;&nbsp; Usage: <br />;&nbsp; invoke GetCompatibleDC, ADDR ImageDC, ADDR hImageDC, hwnd, 500, 300 <br />; This little function is used to create DC for BackBuffers, Images and so on. <br />; All there is to do is pass 2 dwords which will hold the DC (the one you&#39;ll be painting on) <br />; and the handleDC which both need to be deleted at program exit (with DeleteDC and DeleteObject)<br />;======================================================================== <br />GetCompatibleBitmap proc AnotherDC:DWORD, HandleOfDC:DWORD, hwnd:DWORD, xLenght:DWORD, yWidth:DWORD <br />&nbsp; &nbsp; invoke CreateCompatibleDC,NULL <br />&nbsp; &nbsp; mov edx,AnotherDC <br />&nbsp; &nbsp; push eax <br />&nbsp; &nbsp; mov ,eax <br />&nbsp; &nbsp; invoke GetDC,hwnd <br />&nbsp; &nbsp; push eax <br />&nbsp; &nbsp; invoke CreateCompatibleBitmap,eax,xLenght,yWidth <br />&nbsp; &nbsp; mov edx,HandleOfDC <br />&nbsp; &nbsp; mov ecx,&nbsp; &nbsp; &nbsp; &nbsp; ;pop ecx <br />&nbsp; &nbsp; mov ,eax&nbsp; &nbsp; &nbsp; &nbsp; ;push eax <br />&nbsp; &nbsp; mov ,eax <br />&nbsp; &nbsp; invoke ReleaseDC,hwnd,ecx <br />&nbsp; &nbsp; pop eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;HandleOfDC <br />&nbsp; &nbsp; pop ecx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;AnotherDC <br />&nbsp; &nbsp; invoke SelectObject,ecx,eax <br />&nbsp; &nbsp; ret <br />GetCompatibleBitmap endp<br /></code></pre><br />Load all your Bitmaps using GetBitmapDC inside your WM_CREATE handler and create a BackBufferDC there too.<br />Now on Resize, Destroy your old BackBufferDC and create a new one.<br />You can paint it there or move it inside your WM_PAINT handler. Anyway, paint it the way you like it. You can drop every call to SelectObject and all you need to do is BitBlt the BitmapDC&#39;s onto the BackBufferDC. Inside WM_PAINT all you need to do is BitBlt the BackBuffer onto the ps.hdc.<br /><br />I attach a little test of mine to it so that you can see on how easy my way would be. I tried to whop up a gradient test for you but my wife is going to crucify me if I spend anymore time painting gradients here. (Note: In my example I did not use a Backbuffer)</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=1708" target="_blank">GradTest060616.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2006-06-16 21:13:30 by JimmyClif</div>
   </div>
   <div class="post" id="post-181974">
    <div class="subject"><a href="#post-181974">Re: GDI Background Painting</a></div>
    <div class="body">Thankyou so much.&nbsp; I will try this all out tommorrow and post back any interesting results.&nbsp; For some reason I have always had a mental block against GDI stuff.&nbsp; I just can&#39;t seem to &quot;get it&quot;.&nbsp; Ditto the wife thing.&nbsp; Thanks again JimmyClif.&nbsp; </div>
    <div class="meta">Posted on 2006-06-17 00:32:18 by rdaneel</div>
   </div>
   <div class="post" id="post-182010">
    <div class="subject"><a href="#post-182010">Re: GDI Background Painting</a></div>
    <div class="body">If you&#39;re going to use a backbuffer and resize on WM_SIZE etc., you might want to consider resizing in increments - otherwise you might get a *lot* of resizes.<br /></div>
    <div class="meta">Posted on 2006-06-17 06:07:17 by f0dder</div>
   </div>
   <div class="post" id="post-182018">
    <div class="subject"><a href="#post-182018">Re: GDI Background Painting</a></div>
    <div class="body">rdaneel,<br /><br />If you attach (or mail) the gradients I&#39;ll try to get it worked out for you. It ain&#39;t that hard.</div>
    <div class="meta">Posted on 2006-06-17 10:25:28 by JimmyClif</div>
   </div>
   <div class="post" id="post-182022">
    <div class="subject"><a href="#post-182022">Re: GDI Background Painting</a></div>
    <div class="body">Here&#39;s my little test. I believe your gradient bitmaps are a lot better than my quick thrown together bunch.<br /><br />Also, it is not recommended to have this many calls loading each Bitmap, but it would be wiser creating one bigger bitmap having them all and then just selecting the part you need for blitting.<br /><br />Anyways, hope this helps.<br /><br /> <em>Removed attachment</em></div>
    <div class="meta">Posted on 2006-06-17 12:41:33 by JimmyClif</div>
   </div>
   <div class="post" id="post-182031">
    <div class="subject"><a href="#post-182031">Re: GDI Background Painting</a></div>
    <div class="body">f0dder: It actually only has 2 sizes.&nbsp; It has a small systray progress popup thingy and a bigger management interface.&nbsp; I&#39;m using the same window and just hiding and showing controls on it.&nbsp; You can download the app at <a target="_blank" href="http://www.sector62.com/cgi-bin/pl.cgi/software/podwrangler.html">http://www.sector62.com/cgi-bin/pl.cgi/software/podwrangler.html</a> to see what I mean.<br /><br />JimmyClif: I&#39;m going to attach the graphics in a zip to this post.&nbsp; I haven&#39;t looked at your stuff yet since I have been busy with work but I plan on it tonight when I get home.&nbsp; I seem to remember reading in the API docs that some of the Blt functions skip that last or first pixel row.&nbsp; Could that be a source of my 1 pixel mismatch?</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=1710" target="_blank">podwrangler-bitmaps.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2006-06-17 16:45:22 by rdaneel</div>
   </div>
   <div class="post" id="post-182035">
    <div class="subject"><a href="#post-182035">Re: GDI Background Painting</a></div>
    <div class="body">Hi rdaneel,<br /><br />That was fun :) I just replaced your bitmaps with my code and <em>voila</em> here&#39;s the finished product. ~ Well almost. There is lots of room for improvement but it kinda does what you want. </div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=1712" target="_blank">GradTest060617.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2006-06-17 17:39:32 by JimmyClif</div>
   </div>
   <div class="post" id="post-182047">
    <div class="subject"><a href="#post-182047">Re: GDI Background Painting</a></div>
    <div class="body">Beautiful work JimmyClif.&nbsp; I like your solution better.&nbsp; Now that I see a working solution it makes so much more sense.&nbsp; I think PatBlt was screwing me up too.&nbsp; That one GetBitmapDC function made it cleaner.&nbsp; Can I use that function and credit you in my code?</div>
    <div class="meta">Posted on 2006-06-18 08:38:47 by rdaneel</div>
   </div>
   <div class="post" id="post-182048">
    <div class="subject"><a href="#post-182048">Re: GDI Background Painting</a></div>
    <div class="body">No worries. If I didn&#39;t want someone to use it, I wouldn&#39;t have posted it.</div>
    <div class="meta">Posted on 2006-06-18 08:53:09 by JimmyClif</div>
   </div>
   <div class="post" id="post-182107">
    <div class="subject"><a href="#post-182107">Re: GDI Background Painting</a></div>
    <div class="body">I merged the code into mine in the appropriate way and it came out wonderful.&nbsp; I was able to cut my filesize way down by using the chopped up bitmap sections instead of the class brush.&nbsp; If you want to see the finished product you can grab it at my site: <a target="_blank" href="http://www.sector62.com">http://www.sector62.com</a>.&nbsp; The program is called PodWrangler.&nbsp; Thanks again.</div>
    <div class="meta">Posted on 2006-06-19 13:04:29 by rdaneel</div>
   </div>
   <div class="post" id="post-182653">
    <div class="subject"><a href="#post-182653">Re: GDI Background Painting</a></div>
    <div class="body">I finally got around to posting the source for this program.&nbsp; I didn&#39;t want to post it until I put in safer string handling than just plain ol&#39; lstr___ functions.&nbsp; Maybe someone will find this code useful since it brings together a bunch of different stuff I&#39;ve picked up from this forum over the years, not to mention the GDI stuff talked about here.&nbsp; I used the Windows HTTP functions rather than coding my own HTTP engine this time around.&nbsp; I did that once before with asynchronous sockets and the whole sh&#39;bang and I have to say that it was painful.&nbsp; Oh well, here is the link to the source and the binary versions: <a target="_blank" href="http://www.sector62.com/cgi-bin/pl.cgi/software/podwrangler.html">http://www.sector62.com/cgi-bin/pl.cgi/software/podwrangler.html</a></div>
    <div class="meta">Posted on 2006-06-29 16:34:46 by rdaneel</div>
   </div>
   <div class="post" id="post-182849">
    <div class="subject"><a href="#post-182849">Re: GDI Background Painting</a></div>
    <div class="body">Looks pretty decent :)<br /><br />A couple of suggestions... don&#39;t exit the app when you Alt+F4 the &quot;manage list&quot; window, just function like when pressing &quot;hide&quot; instead.<br /><br />Also, since the app is visual, what about setting a more pleasing font on the buttons?<br /></div>
    <div class="meta">Posted on 2006-07-03 12:30:24 by f0dder</div>
   </div>
   <div class="post" id="post-182866">
    <div class="subject"><a href="#post-182866">Re: GDI Background Painting</a></div>
    <div class="body">Good ideas.&nbsp; For that matter, the buttons should probably be graphical too instead of just regular Windows push buttons.&nbsp; Well here comes another night that my wife will hate me.&nbsp;  ;)<br /><br />In your opinion is it better to use owner-drawn buttons, subclass the buttons for painting or use GDI regions+hit testing as buttons?&nbsp; What gives the best balance between flexibility and complexity?</div>
    <div class="meta">Posted on 2006-07-03 16:51:48 by rdaneel</div>
   </div>
   <div class="post" id="post-182871">
    <div class="subject"><a href="#post-182871">Re: GDI Background Painting</a></div>
    <div class="body">SubClassing is probably the easiest and most flexible. You can paint a button on WM_PAINT and create effects on WM_MOUSEMOVE, WM_LBUTTONDOWN and WM_LBUTTONUP simulating a regular Button.<br /><br />Ewayne has made a little Button demo displaying a lot of styles on can have. Check them out at: http://spiff.tripnet.se/~iczelion/files/Buttons.zip<br /><br />BTW: I really like this line from your About Me page:<br /><br /><div class="quote"><br />I like writing software that is small, fast and very useful and every few hundred tries I manage to actually do that.<br /></div><br /><br />So true :)</div>
    <div class="meta">Posted on 2006-07-03 18:30:42 by JimmyClif</div>
   </div>
   <div class="post" id="post-182874">
    <div class="subject"><a href="#post-182874">Re: GDI Background Painting</a></div>
    <div class="body">haha, that is a pretty good quote, sums up about how often what I try to program actually works.</div>
    <div class="meta">Posted on 2006-07-03 20:04:09 by Bobbias</div>
   </div>
   <div class="post" id="post-184054">
    <div class="subject"><a href="#post-184054">Re: GDI Background Painting</a></div>
    <div class="body">I finally got around to making PodWrangler&#39;s buttons pretty like f0dder suggested.&nbsp; I posted the new source on my site if anyone is wanting to do something similar.&nbsp; It&#39;s too big to post here.&nbsp; I might not have done it the most efficient way (superclassing along with a thousand nearly identical variable names) but it seems pretty solid.&nbsp; The most important thing is that just like the window background, I can now just drop in any bitmaps and they will expand and contract correctly.&nbsp; I put in bitmaps for hover, up, and down button states.&nbsp; If there is a better way to do it I&#39;d like to know.<br /><br />*edit*<br />actually I just realized that f0dders original suggestion was just to make the button fonts better.&nbsp; any font suggestions?</div>
    <div class="meta">Posted on 2006-07-27 16:29:17 by rdaneel</div>
   </div>
   <div class="post" id="post-184060">
    <div class="subject"><a href="#post-184060">Re: GDI Background Painting</a></div>
    <div class="body">Nifty! :)<br /><br /><div class="quote"><br />I might not have done it the most efficient way (superclassing along with a thousand nearly identical variable names) but it seems pretty solid.<br /></div><br />If you need a variable per control you superclass, you should consider SetProp() and store your variable there (if you need multiple variables per control, HeapAlloc() a structure and store the pointer instead).<br /><br /><div class="quote"><br />actually I just realized that f0dders original suggestion was just to make the button fonts better. ?&nbsp;any font suggestions?<br /></div><br />The one windows uses by default on DIALOGs would be decent enough; can&#39;t remember which font it is, but iirc there&#39;s a way to specify the &quot;system default dialog font&quot; or something like that.<br /></div>
    <div class="meta">Posted on 2006-07-28 06:35:41 by f0dder</div>
   </div>
  </div>
 </body>
</html>