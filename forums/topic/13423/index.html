<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>HLA compile times... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13423" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=13423">HLA compile times...</a></p>
   <div class="post" id="post-104002">
    <div class="subject"><a href="#post-104002">HLA compile times...</a></div>
    <div class="body">During a recent compile of &quot;HLA Adventure&quot;, I discovered something unusual. The compiler took over 5 or 6 minutes to compile the file &quot;west.hla&quot;, which is the main source for the game. <br /><br />Someone over at the masmforum.com board suggested it was because somewhere in my source I was using initialized arrays (rather than global arrays). Could this contribute to a slower compiling time by HLA/MASM?<br /><br />I haven't looked at the assembly source for my game in ages (the source code to the game -- as well as the game itself -- can be found at):<br /><br /><a target="_blank" href="http://members.tripod.com/~panks/hlaadv.html">http://members.tripod.com/~panks/hlaadv.html</a><br /><br />or<br /><br /><a target="_blank" href="http://www.geocities.com/dunric/westfront.html">http://www.geocities.com/dunric/westfront.html</a><br />(just scroll down to &quot;12. HLA Adventure&quot; under &quot;DOS/Windows games&quot;)<br /><br />Just for fun, I uploaded version 2.08 of &quot;HLA Adventure&quot; for anyone who is interested. I spent about 15 minutes reworking and balancing the fighting engine. I also fixed an usual bug whereby someone might enter:<br /><br />&gt;dfsgfdssfd hobbit<br /><br />and the game would kick the player into a random room, like so:<br /><br />Intersection<br />You are facing an intersection in the forest. Paths head<br />off in four directions here. To the south, the forest becomes<br />oppressive and dark. To the east, there is far more sunlight.<br />There is a portal here, pulsating white light.<br />Exits: &lt;north,south,east,west&gt;<br />wolf<br />&gt;<br /><br />Oh yeah, that brings up another addition. I also added &quot;portals&quot; around the game whereby the player can &quot;teleport&quot; between them. Interesting concept I thought of while in a lucid dream state the other night. Sometimes the zen of nothing is better than the zen of everything. ;)<br /><br />Back to sleep I go. :)<br /><br />Sincerely,<br /><br />Paul Allen Panks (also known as &quot;dunric&quot; or &quot;pappy&quot;)<br /><a href="mailto:dunric@yahoo.com">dunric@yahoo.com</a><br />ICQ# 12234336</div>
    <div class="meta">Posted on 2003-05-20 06:10:19 by Paul Panks</div>
   </div>
   <div class="post" id="post-104059">
    <div class="subject"><a href="#post-104059">HLA compile times...</a></div>
    <div class="body">Hi Paul,<br /><br /><br /><br /><div class="quote">Someone over at the masmforum.com board suggested it was because somewhere in my source I was using initialized arrays (rather than global arrays). Could this contribute to a slower compiling time by HLA/MASM?</div> <br /><br />This paragraph from AoA gives an explanation:<br /><br /><a target="_blank" href="http://webster.cs.ucr.edu/Page_AoAWin/HTML/Arraysa3.html#1010610">http://webster.cs.ucr.edu/Page_AoAWin/HTML/Arraysa3.html#1010610</a><br /><br />Regards,GJ</div>
    <div class="meta">Posted on 2003-05-20 11:49:14 by Green Joe</div>
   </div>
   <div class="post" id="post-104063">
    <div class="subject"><a href="#post-104063">HLA compile times...</a></div>
    <div class="body">Cool, thanks Joe. That's right on with what others suggested. I think I'll try out MASM v6.11, and see if that improves the compile times. Waiting five minutes for a compile permits a coffee break and then some. About the only thing longer was waiting for the Commodore 64 BASIC interpreter to process decimal-to-hex numbers or Machine Language from BASIC. Wow, that was long!<br /><br />I do have several other adventures if anyone is interested. Although not written in HLA, they follow the same gameplay rules as &quot;HLA Adventure&quot;:<br /><br /><a target="_blank" href="http://www.geocities.com/dunric/westfront.html">http://www.geocities.com/dunric/westfront.html</a><br /><br />You can even find some C64/128 adventure games I wrote for play on the VICE or other Commodore emulators out there. In 9 years I've programmed more than I ever thought I would. Getting a Commodore 128 in 1985 did the trick. ;)<br /><br />Sincerely,<br /><br />Paul Panks<br /><a href="mailto:dunric@yahoo.com">dunric@yahoo.com</a></div>
    <div class="meta">Posted on 2003-05-20 12:00:36 by Paul Panks</div>
   </div>
   <div class="post" id="post-104231">
    <div class="subject"><a href="#post-104231">Re: HLA compile times...</a></div>
    <div class="body"><div class="quote"><br />During a recent compile of &quot;HLA Adventure&quot;, I discovered something unusual. The compiler took over 5 or 6 minutes to compile the file &quot;west.hla&quot;, which is the main source for the game. <br /><br />Someone over at the masmforum.com board suggested it was because somewhere in my source I was using initialized arrays (rather than global arrays). Could this contribute to a slower compiling time by HLA/MASM?<br /><br />I<br />Sincerely,<br /><br />Paul Allen Panks (also known as &quot;dunric&quot; or &quot;pappy&quot;)<br /><a href="mailto:dunric@yahoo.com">dunric@yahoo.com</a><br />ICQ# 12234336 </div><br /><br />I am almost sure that the problem is not static arrays, but the fact that you've got so many<br />invocations of the stdout.put macro in your source file (I count a little bit better than 1,500<br />invocations of this macro).<br /><br />Each invocation of stdout.put expands to approximately 400-500 lines of code (more, if you've got<br />multiple parameters, which you usually do).<br />Here's what HLA v1.49 reports for the number of lines and compile time-<br /><br />HLA (High Level Assembler)<br />Released to the public domain by Randall Hyde.<br />Version Version 1.49 build 8101 (prototype)<br />Win32 COFF output<br />Using MASM assembler<br />MASM output<br /><br />Files:<br />1: west.hla<br /><br />Compiling 'west.hla' to 'west.asm'<br />using command line <br />HLA (High Level Assembler) Parser<br />Released to the public domain by Randall Hyde.<br />Version Version 1.49 build 8099 (prototype)<br />File: west.hla<br />Output Path: &quot;&quot;<br /><br />Compiling &quot;west.hla&quot; to &quot;west.asm&quot;<br />Compilation complete, 1545291 lines, 305.908 seconds,    5051 lines/second<br /><br />Ouch! One and a half *Million* lines of code!<br />It's not surprising it took over five minutes to compile on my 2GHz machine at work.<br />Also note that 5051 lines/second compilation rate is about half what HLA normally<br />does; again, this is a result of the fact that the stdout.put macro contains a lot of<br />compile-time statements that HLA must interpret during compilation.<br /><br />Scanning through your code, I immediately notice two things that you can do to<br />dramatically speed up compilation.<br /><br />First of all, in many of your calls to stdout.put, you write code like the following:<br /><br />stdout.put( &quot;some line of text&quot;, nl ); // Notice the comma between the string and &quot;nl&quot;.<br /><br />When stdout.put has &quot;n&quot; parameters, it winds up expanding to n*(400 to 500) lines of<br />code. So this simple call typically expands to between 800 and 1,000 lines of code.<br /><br />As it turns out, there is no need to supply stdout.put with two parameters here.<br />The &quot;nl&quot; identifier is an HLA TEXT object, which means HLA expands nl to the text sequence<br />&quot;#$d #$a&quot; whenever it encounters &quot;nl&quot; in the source file; i.e., the above is equivalent to:<br /><br />stdout.put( &quot;some line of text&quot;, #$d #$a );<br /><br />Whenever HLA sees two adajent strings (or characters, or combinations of the two) it combines<br />them into a single string, hence the &quot;#$d #$a&quot; above gets concatenated to form a single<br />string containing the two characters &lt;cr&gt;&lt;lf&gt;.<br /><br />However, we could also write this statement as follows:<br /><br />stdout.put( &quot;some line of text&quot; nl );  // Note that there is no comma here.<br /><br />Now, HLA will concatenate that &lt;cr&gt;&lt;lf&gt; sequence to the end of the string and, voila, you have<br />only one operand instead of two. So HLA only has to compile *half* the number of statements inside<br />the stdout.put macro.<br /><br />Next Problem:<br /><br />When you want to print multiple lines of text, there is no need to call stdout.put for each<br />line of text - just create a single string with all the lines of text you want displayed.  This is a classic<br />example of &quot;thinking in assembly&quot; rather than thinking in a HLL.<br /><br />E.g.,<br /><br />stdout.put( &quot;line 1&quot; nl );<br />stdout.put( &quot;line 2&quot; nl );<br />stdout.put( &quot;line 3&quot; nl );<br /><br />becomes:<br /><br />stdout.put<br />(<br /><br />    &quot;line 1&quot; nl<br />    &quot;line 2&quot; nl<br />    &quot;line 3&quot; nl<br />);<br /><br />Note that this is still just *one* operand and *one* string because HLA concatenates<br />all adjacent strings (without any other intervening symbols) into a single string.<br />I would even argue that this scheme is *more readable* than a long sequence of stdout.put<br />invocations (much less clutter).  Because most of your stdout.put calls are part of a multiline<br />sequence printing &quot;room&quot; descriptions, I think you'll find that by using the two tricks I've given<br />you so far, you'll speed up compilation by an order of magnitude.<br />Also note: by using a single call to stdout.put, you'll reduce the size of your executable<br />program by a fair amount because you'll have only one call to stdout.put rather than multiple<br />invocations.<br /><br />The final improvement you can make is to note that most of the time you invoke stdout.put,<br />all you're doing is printing a single string (at least, once you follow the suggestions above).<br />That means you can skip the use of the stdout.put macro entirely and just call the stdout.puts<br />function (which stdout.put winds up calling for you). This means that HLA only has to process<br />a single statement rather than 400-500 statements to compile this single statement.<br />So if you go in and modify the stdout.put statements as I've just described, I think you'll find<br />that compilation times drop down to the sub-20 second range, or so (depends on how many other<br />macros you're processing).<br /><br />Cheers,<br />Randy Hyde</div>
    <div class="meta">Posted on 2003-05-21 15:19:17 by rhyde</div>
   </div>
  </div>
 </body>
</html>