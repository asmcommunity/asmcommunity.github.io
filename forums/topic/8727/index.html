<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>CGI programs in assembly (HLA) - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=8727" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=8727">CGI programs in assembly (HLA)</a></p>
   <div class="post" id="post-64127">
    <div class="subject"><a href="#post-64127">CGI programs in assembly (HLA)</a></div>
    <div class="body">I'm trying to use HLA to program CGI's.  I can write stuff to the screen using stdout.put, and figured out how to read environment variables using _GetEnvironmentVariableA@12, but I'm stuck on reading input from a POST method (I suppose if I wanted I could use GET, but now that I'm stuck I'm stubborn as a mule ;) )...I tried stdin.get, but it didn't work (I suspect maybe it's waiting for the enter key?).  After searching the archives here I tried importing MASM's stdin routine and adapting someone else's code, but that didn't work either.  Then I tried something else I found in the archives using a few windows procedures (GetStdHandle, SetConsoleMode, ReadFile).  It still doesn't work.<br /><br />I checked the windows procedures' returns...GetStdHandle successfully returns something, but SetConsoleMode and ReadFile are returning 0 in EAX.<br /><br />For any of you who know HLA here's my current code:<br /><pre><code><br />program CGItest;<br />#include&#40;&quot;stdlib.hhf&quot;&#41;;<br />#include&#40;&quot;win32.hhf&quot;&#41;;<br />#include&#40;&quot;win32more.hhf&quot;&#41;;  // additional windows procedures<br />#include&#40;&quot;masm.hhf&quot;&#41;;  // &#40;attempted&#41; MASM import<br />#asm<br />includelib \hla\hlalib\masm32.lib<br />#endasm<br /><br />/**********************************************************<br />		Main Program<br />**********************************************************/<br /><br />static<br />  env_buffer&#58; string;<br />  env_var&#58; string;<br />  blah&#58; uns32;<br /><br />begin CGItest;<br />	stralloc&#40;256&#41;;<br />	mov&#40;eax, env_buffer&#41;;<br />	stralloc&#40;80&#41;;<br />	mov&#40;eax, env_var&#41;;<br /><br />	stdout.put&#40;&quot;Content-type&#58; text/html&quot;,nl,nl&#41;;<br /><br />	stdout.put&#40;&quot;&lt;HTML&gt;&quot;,nl,&quot;&lt;BODY TEXT=&quot;&quot;FFFFFF&quot;&quot; BGCOLOR=&quot;&quot;000000&quot;&quot;&gt;&quot;,nl&#41;;<br /><br />  mov&#40;env_buffer,ebx&#41;;<br /><br />  str.cpy&#40;&quot;REQUEST_METHOD&quot;, env_var&#41;;<br />	winmore.GetEnv&#40;256,ebx,env_var&#41;;<br />	mov&#40;eax, &#40;type dword &#91;ebx-4&#93;&#41;&#41;;<br />	<br />  str.eq&#40;ebx, &quot;POST&quot;&#41;;<br />  if &#40;eax == 0&#41; then<br />  	stdout.put&#40;&quot;  Error&#58; Method must be &quot;&quot;POST&quot;&quot;.&lt;BR&gt;&quot;,nl,&quot;  &quot;&#41;;<br />  	stdout.puts&#40;env_buffer&#41;;<br />  	stdout.put&#40;&quot;&lt;BR&gt;&lt;BR&gt;&quot;,nl,nl&#41;;<br />//  	jmp endtest;<br />  endif;<br /><br />	str.cpy&#40;&quot;CONTENT_TYPE&quot;, env_var&#41;;<br />	winmore.GetEnv&#40;256,ebx,env_var&#41;;<br />	mov&#40;eax, &#40;type dword &#91;ebx-4&#93;&#41;&#41;;<br />	str.cpy&#40;&quot;application/x-www-form-urlencoded&quot;, env_var&#41;;<br />	str.eq&#40;ebx, env_var&#41;;<br />	if &#40;eax == 0&#41; then<br />		stdout.put&#40;&quot;  Error&#58; This CGI must be accessed from a form.&lt;BR&gt;&quot;,nl,&quot;  &quot;&#41;;<br />  	stdout.puts&#40;env_buffer&#41;;<br />  	stdout.put&#40;&quot;&lt;BR&gt;&lt;BR&gt;&quot;,nl,nl&#41;;<br />//		jmp endtest;<br />	endif;<br /><br />	str.cpy&#40;&quot;CONTENT_LENGTH&quot;, env_var&#41;;<br />	winmore.GetEnv&#40;256,ebx,env_var&#41;;<br />	mov&#40;eax, &#40;type dword &#91;ebx-4&#93;&#41;&#41;;<br /><br />	stdout.put&#40;&quot;Content length&#58; &quot;&#41;;<br />	stdout.puts&#40;ebx&#41;;<br />	stdout.put&#40;&quot;&lt;BR&gt;&lt;BR&gt;&quot;,nl,nl&#41;;<br /><br />	mov&#40;0,ecx&#41;;<br />	mov&#40;0,eax&#41;;<br />	while&#40;ecx &lt; &#40;type dword &#91;ebx-4&#93;&#41;&#41; do<br />		mov&#40;eax, edx&#41;;<br />		shl&#40;1,eax&#41;;<br />		shl&#40;3,edx&#41;;<br />		add&#40;edx,eax&#41;;<br />		add&#40;&#40;type dword &#40;type byte &#91;ebx&#93;&#41;&#41;, eax&#41;;<br />		sub&#40;'0',eax&#41;;<br />		inc&#40;ecx&#41;;<br />	endwhile;<br /><br />	mov&#40;0,ecx&#41;;<br />	mov&#40;eax,edx&#41;;<br />	inc&#40;eax&#41;;<br />	mov&#40;env_buffer, ebx&#41;;<br />	mov&#40;eax,&#40;type dword &#91;ebx-4&#93;&#41;&#41;;<br />	stdout.put&#40;eax, &quot; &quot;&#41;;<br />	masm.StdIn&#40;ebx,eax&#41;;<br />	stdout.put&#40;eax, &quot; &quot;&#41;;<br />	winmore.GetStdHandle&#40;winmore.STD_INPUT_HANDLE&#41;;<br />	stdout.put&#40;eax, &quot; &quot;&#41;;<br />	push&#40;eax&#41;;<br />	winmore.SetConsoleMode&#40;eax,winmore.ENABLE_LINE_INPUT | winmore.ENABLE_ECHO_INPUT | winmore.ENABLE_PROCESSED_INPUT&#41;;<br />	stdout.put&#40;eax, &quot; &quot;&#41;;<br />	pop&#40;eax&#41;;<br />	winmore.ReadFile&#40;eax,env_buffer,eax,&amp;blah,0&#41;;<br />	stdout.put&#40;eax, &quot; &quot;&#41;;<br />	stdout.put&#40;blah, &quot; &quot;&#41;;<br />	mov&#40;0, &#40;type byte &#91;ebx+ecx&#93;&#41;&#41;;<br /><br />	stdout.put&#40;&quot;  Content&#58; &quot;&#41;;<br />	stdout.puts&#40;env_buffer&#41;;<br />	stdout.put&#40;&quot;&lt;BR&gt;&lt;BR&gt;&quot;,nl,nl&#41;;<br />		<br /><br />endtest&#58;<br />	stdout.put&#40;&quot;  End of test CGI.&quot;,nl&#41;;<br />	stdout.put&#40;&quot;&lt;/BODY&gt;&quot;,nl,&quot;&lt;/HTML&gt;&quot;&#41;;<br /><br />	strfree&#40;env_var&#41;;<br />	strfree&#40;env_buffer&#41;;<br />end CGItest;<br /></code></pre><br /><br />Any help would be appreciated...I'm still learning HLA, and I don't know hardly any MASM, but if anyone has any ideas...<br /><br />P.S. - those of you not used to HLA, the instructions are backwards of MASM... mov(eax, ebx) is equivalent to mov ebx, eax (I think...)</div>
    <div class="meta">Posted on 2002-10-31 21:00:13 by sirchess2</div>
   </div>
   <div class="post" id="post-64154">
    <div class="subject"><a href="#post-64154">CGI programs in assembly (HLA)</a></div>
    <div class="body">first, is the filehandle (always) equal to the content-length?<pre><code>winmore.ReadFile&#40;eax,env_buffer,eax,&amp;blah,0&#41;;</code></pre> Maybe the second eax is supposec to be ebx?<br /><br />Second, does stdout.put, and the other calls, preserve eax,ebx, etc?<br /><pre><code><br />winmore.GetStdHandle&#40;winmore.STD_INPUT_HANDLE&#41;;<br />stdout.put&#40;eax, &quot; &quot;&#41;;<br />push&#40;eax&#41;;<br /></code></pre><br />I don't know the specifics of HLA, but most functions in other languages will return values, include success flags in eax. You should probably grab a value and save it into a well labeled memory location, that way your code will be more readable as a side effect.</div>
    <div class="meta">Posted on 2002-11-01 01:34:18 by eet_1024</div>
   </div>
   <div class="post" id="post-64268">
    <div class="subject"><a href="#post-64268">CGI programs in assembly (HLA)</a></div>
    <div class="body">I figured it out (partially).  The way I had my loop for extracting the content length from the env_buffer string, I wasn't zero-extending each character's value, giving me lengths of +/- 2 billion :eek: <br /><br />I'm also getting some text from stdin now (before I got nothing), so I think I'm almost set.<br /><br />Thanks a lot for the help...I'll try using variables more like you said, eet...Faster programs aren't any good if they dont run, right? ;) <br /><br />Does anyone know if HLA has a string-to-number function?  It'd probably be more reliable than my code...</div>
    <div class="meta">Posted on 2002-11-01 16:28:51 by sirchess2</div>
   </div>
   <div class="post" id="post-64279">
    <div class="subject"><a href="#post-64279">CGI programs in assembly (HLA)</a></div>
    <div class="body">Ok, I've got it mostly figured out now.  The only problem I have is that 2 bytes of stdin data get cut off, and it adds an &lt;ENTER&gt; character...so, for example:<br /><br />&quot;testtxt=test...&amp;submit=Subm&quot;, CRLF<br />-or-<br />&quot;submit=Submit&amp;testtxt=test.&quot;,CRLF<br /><br />Is there any way to retrieve the last two characters or should I just add an unimportant &quot;filler&quot; value at the end of my form?<br /><br />(BTW, I did a test and apparently stdout.put doesn't modify EAX...)<br /><br /><pre><code><br />program CGItest;<br />#include&#40;&quot;stdlib.hhf&quot;&#41;;<br />#include&#40;&quot;win32.hhf&quot;&#41;;<br />#include&#40;&quot;win32more.hhf&quot;&#41;;<br />#include&#40;&quot;masm.hhf&quot;&#41;;<br />#asm<br />includelib \hla\hlalib\masm32.lib<br />#endasm<br /><br />/**********************************************************<br />		Main Program<br />**********************************************************/<br /><br />static<br />  env_buffer&#58; string;<br />  env_var&#58; string;<br />  blah&#58; uns32;<br /><br />begin CGItest;<br />	stralloc&#40;256&#41;;<br />	mov&#40;eax, env_buffer&#41;;<br />	stralloc&#40;80&#41;;<br />	mov&#40;eax, env_var&#41;;<br /><br />	stdout.put&#40;&quot;Content-type&#58; text/html&quot;,nl,nl&#41;;<br /><br />	stdout.put&#40;&quot;&lt;HTML&gt;&quot;,nl,&quot;&lt;BODY TEXT=&quot;&quot;FFFFFF&quot;&quot; BGCOLOR=&quot;&quot;000000&quot;&quot;&gt;&quot;,nl&#41;;<br /><br />/*	stdout.put&#40;&quot;  &lt;I&gt;&quot;, nl&#41;;<br />	mov&#40;1,ebx&#41;;<br />	while&#40;ebx &lt; 5&#41; do<br />		stdout.put&#40;&quot;    1&lt;BR&gt;&quot;&#41;;<br />		stdout.put&#40;nl&#41;;<br />		inc&#40;ebx&#41;;<br />	endwhile;*/<br /><br />  mov&#40;env_buffer,ebx&#41;;<br /><br />  str.cpy&#40;&quot;REQUEST_METHOD&quot;, env_var&#41;;<br />	winmore.GetEnv&#40;256,ebx,env_var&#41;;<br />	mov&#40;eax, &#40;type dword &#91;ebx-4&#93;&#41;&#41;;<br />	<br />  str.eq&#40;ebx, &quot;POST&quot;&#41;;<br />  if &#40;eax == 0&#41; then<br />  	stdout.put&#40;&quot;  Error&#58; Method must be &quot;&quot;POST&quot;&quot;.&lt;BR&gt;&quot;,nl,&quot;  &quot;&#41;;<br />  	stdout.puts&#40;env_buffer&#41;;<br />  	stdout.put&#40;&quot;&lt;BR&gt;&lt;BR&gt;&quot;,nl,nl&#41;;<br />//  	jmp endtest;<br />  endif;<br /><br />	str.cpy&#40;&quot;CONTENT_TYPE&quot;, env_var&#41;;<br />	winmore.GetEnv&#40;256,ebx,env_var&#41;;<br />	mov&#40;eax, &#40;type dword &#91;ebx-4&#93;&#41;&#41;;<br />	str.cpy&#40;&quot;application/x-www-form-urlencoded&quot;, env_var&#41;;<br />	str.eq&#40;ebx, env_var&#41;;<br />	if &#40;eax == 0&#41; then<br />		stdout.put&#40;&quot;  Error&#58; This CGI must be accessed from a form.&lt;BR&gt;&quot;,nl,&quot;  &quot;&#41;;<br />  	stdout.puts&#40;env_buffer&#41;;<br />  	stdout.put&#40;&quot;&lt;BR&gt;&lt;BR&gt;&quot;,nl,nl&#41;;<br />//		jmp endtest;<br />	endif;<br /><br />	str.cpy&#40;&quot;CONTENT_LENGTH&quot;, env_var&#41;;<br />	winmore.GetEnv&#40;256,ebx,env_var&#41;;<br />	mov&#40;eax, &#40;type dword &#91;ebx-4&#93;&#41;&#41;;<br /><br />	stdout.put&#40;&quot;Content length&#58; &quot;&#41;;<br />	stdout.puts&#40;ebx&#41;;<br />	stdout.put&#40;&quot;&lt;BR&gt;&quot;,nl&#41;;<br /><br />	mov&#40;0,ecx&#41;;<br />	mov&#40;0,eax&#41;;<br />	while&#40;ecx &lt; &#40;type dword &#91;ebx-4&#93;&#41;&#41; do<br />		mov&#40;eax, edx&#41;;<br />		shl&#40;1,eax&#41;;<br />		shl&#40;3,edx&#41;;<br />		add&#40;edx,eax&#41;;<br />		movzx&#40;&#40;type byte &#91;ebx+ecx&#93;&#41;,edx&#41;;<br />		add&#40;edx, eax&#41;;<br />		sub&#40;'0',eax&#41;;<br />		inc&#40;ecx&#41;;<br />	endwhile;<br /><br />	stdout.put&#40;&quot;Extracted Content Length&#58; &quot;, &#40;type int32 eax&#41;,&quot;&lt;BR&gt;&lt;BR&gt;&quot;,nl,nl&#41;;<br /><br />	mov&#40;env_buffer, ebx&#41;;<br />	mov&#40;0, &#40;type byte &#91;ebx+eax&#93;&#41;&#41;;<br />	dec&#40;eax&#41;;<br />	dec&#40;eax&#41;;<br />	mov&#40;eax,&#40;type dword &#91;ebx-4&#93;&#41;&#41;;<br /><br />	stdout.put&#40;&quot;Stdin&#58; &quot;&#41;;<br />	mov&#40;0,ecx&#41;;<br />	while&#40;&#40;type int32 ecx&#41; &lt; &#40;type int32 eax&#41;&#41; do<br />		push&#40;eax&#41;;<br />		stdin.getc&#40;&#41;;<br />		mov&#40;al, &#40;type byte &#91;ebx+ecx&#93;&#41;&#41;;<br />		stdout.put&#40;&#40;type char al&#41;&#41;;<br />		inc&#40;ecx&#41;;<br />		pop&#40;eax&#41;;<br />	endwhile;<br />	stdout.put&#40;&quot;&lt;BR&gt;&lt;BR&gt;&quot;,nl,nl&#41;;<br /><br />	stdout.put&#40;&quot;  Content&#58; &quot;&#41;;<br />	stdout.puts&#40;env_buffer&#41;;<br />	stdout.put&#40;&quot;&lt;BR&gt;&lt;BR&gt;&quot;,nl,nl&#41;;<br />		<br /><br />endtest&#58;<br />	stdout.put&#40;&quot;  End of test CGI.&quot;,nl&#41;;<br />	stdout.put&#40;&quot;&lt;/BODY&gt;&quot;,nl,&quot;&lt;/HTML&gt;&quot;&#41;;<br /><br />	strfree&#40;env_var&#41;;<br />	strfree&#40;env_buffer&#41;;<br /><br />	mov&#40;0,eax&#41;;<br />end CGItest;<br /></code></pre></div>
    <div class="meta">Posted on 2002-11-01 18:32:05 by sirchess2</div>
   </div>
   <div class="post" id="post-64293">
    <div class="subject"><a href="#post-64293">CGI programs in assembly (HLA)</a></div>
    <div class="body">sirchess2,<br /><br />I would try for an answer from Randy Hyde on this one as he is the author. I don't think Randy has posted in this forum as yet but I know he posts in the alt lang asm newsgroup so you may have some success there.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-11-01 20:45:32 by hutch--</div>
   </div>
   <div class="post" id="post-64294">
    <div class="subject"><a href="#post-64294">CGI programs in assembly (HLA)</a></div>
    <div class="body">Forgive my idiocity, but what's a newsgroup, and how does one subscribe/browse to it?  :o</div>
    <div class="meta">Posted on 2002-11-01 21:11:27 by sirchess2</div>
   </div>
   <div class="post" id="post-64323">
    <div class="subject"><a href="#post-64323">CGI programs in assembly (HLA)</a></div>
    <div class="body">Network News is a web application that has thread forums, like this HTTP forum, but it has it's own protocal NNTP. A quick google, tucows, etc for a News Reader/Browser should find the app you're looking for. Most ISPs provide NNTP servers.  You can also do a google for servers.</div>
    <div class="meta">Posted on 2002-11-02 02:08:02 by eet_1024</div>
   </div>
  </div>
 </body>
</html>