<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>What are those _imp_blahblah@XX - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13904" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=13904">What are those _imp_blahblah@XX</a></p>
   <div class="post" id="post-107481">
    <div class="subject"><a href="#post-107481">What are those _imp_blahblah@XX</a></div>
    <div class="body">Hi there.<br />If you ever take a look inside blah.lib files you would encounter strings<br />like:	__imp_MesaageBoxA@16 or __imp__ExitProcess@4<br /><br />or if you forget to put an includelib blah.lib in a source code <br />or providing the blah.lib file to linker on command line you would get a<br />fatal error from linker saying that is was unable to resolve function<br />__imp__blah@x<br /><br />I know that they are necessary for dynamic linking and import table creation<br />but I want to know EXACTLY(in depth) what are these __imp__blah@NumByteArg<br />strings and what's the relation Between MessageBoxA and __imp__MessageBoxA@16<br />or better...What the hell are assembler and linker doing?<br /><br />here is another:you are familiar with following code...<br />externdef _imp_ExitProcess@4:DWORD(or :PROC or :ptr DWORD or ....)<br />why do we put only one underscore before imp?!!<br />(as you see im trying to know how this name mangling happens)<br /><br />thanks...<br /><br />ps:please dont refer me to MATT's PE article on MSDN. :cool:</div>
    <div class="meta">Posted on 2003-06-18 12:43:44 by titanwalker</div>
   </div>
   <div class="post" id="post-107506">
    <div class="subject"><a href="#post-107506">What are those _imp_blahblah@XX</a></div>
    <div class="body">If you use MASM with STDCALL calling convention as a default, MASM will add an underscore to the beginning of the name. If you originally wrote the name with one underscore at the beginning, the linker will see two underscores at the beginning.<br /><br />The &quot;imp&quot; names are labels to DWORDs that will hold the actual addresses of DLL functions. The data is initialized after the corresponding DLL is loaded.<br /><br />The .LIB files hold for each DLL function some code that looks something like this:<pre><code>    .code<br />_API_function@nn&#58;<br />    jmp   dword ptr &#91;__imp__API_function@nn&#93;    ; indirect jump, address in &quot;imp&quot; variable<br /><br />.icode segment<br />__imp__API_function@nn DWORD ?<br />.icode ends<br /></code></pre>The linker will create the .LIB file for you when you build your own DLL.</div>
    <div class="meta">Posted on 2003-06-18 16:01:23 by tenkey</div>
   </div>
   <div class="post" id="post-107511">
    <div class="subject"><a href="#post-107511">What are those _imp_blahblah@XX</a></div>
    <div class="body">extern externdef  &lt;--- what is this ??</div>
    <div class="meta">Posted on 2003-06-18 16:47:27 by AceEmbler</div>
   </div>
   <div class="post" id="post-107515">
    <div class="subject"><a href="#post-107515">What are those _imp_blahblah@XX</a></div>
    <div class="body">Here's a quicky explanation,<br /><br />__imp_MessageBoxA@16<br /><br /><strong>__imp_</strong> = import - this is the decorated C name prefix a function (ie the name in the lib file)<br /><strong>MessageBoxA</strong> = the name of the function<br /><strong>@16</strong> = the number of bytes it will remove from the stack<br /><br />When you use invoke MessageBox in your program it is translated to MessageBoxA by User32.inc then sent to the assembler. The assembler will check to see if the function exists in your program and if not it will affix the prefix and add it to the import table. When you link your program it will search the libs for the import and add the proper thunk for that function to the linked executable.<br /><br /><strong><em>EXTERNDEF [] name:type [[, [] name:type]]...</em></strong><br /><br />Defines one or more external variables, labels, or symbols called name whose type is type. If name is defined in the module, it is treated as PUBLIC. If name is referenced in the module, it is treated as EXTERN. If name is not referenced, it is ignored. The type can be ABS, which imports name as a constant. Normally used in include files.</div>
    <div class="meta">Posted on 2003-06-18 17:03:25 by donkey</div>
   </div>
   <div class="post" id="post-107577">
    <div class="subject"><a href="#post-107577">What are those _imp_blahblah@XX</a></div>
    <div class="body">here is the code generated by VC++(/FA):<br />?hMomRgn@@3PAUHRGN__@@A DD 01H DUP (?)			; hMomRgn<br />?sBitmap@@3UtagBITMAP@@A DB 018H DUP (?)		; sBitmap<br />?hMemDC@@3PAUHDC__@@A DD 01H DUP (?)			; hMemDC<br />_BSS	ENDS<br />PUBLIC	?WndProc@@YGJPAUHWND__@@IIJ@Z			; WndProc<br />EXTRN	__imp__BitBlt@36:NEAR<br />EXTRN	__imp__SendMessageA@16:NEAR<br />EXTRN	__imp__DefWindowProcA@16:NEAR<br />EXTRN	__imp__BeginPaint@8:NEAR<br />EXTRN	__imp__EndPaint@8:NEAR<br />EXTRN	__imp__PostQuitMessage@4:NEAR<br /><br />as you can see all of external defines got TWO underscore...!!!<br />But as i said before we use one with EXTERNDEF!!!<br />I'm driving mad:(</div>
    <div class="meta">Posted on 2003-06-19 06:51:02 by titanwalker</div>
   </div>
   <div class="post" id="post-107578">
    <div class="subject"><a href="#post-107578">What are those _imp_blahblah@XX</a></div>
    <div class="body">By the way as far as i know C name mangaling  is so: foo(int,int)-&gt;_foo@8<br />Why that __imp is appeared at the beginnig?</div>
    <div class="meta">Posted on 2003-06-19 06:53:19 by titanwalker</div>
   </div>
   <div class="post" id="post-107623">
    <div class="subject"><a href="#post-107623">What are those _imp_blahblah@XX</a></div>
    <div class="body">The __imp appears because in the C++ header files, the API functions are defined as DLL functions. I don't remember the underlying VC syntax extensions for doing this.</div>
    <div class="meta">Posted on 2003-06-19 15:14:36 by tenkey</div>
   </div>
   <div class="post" id="post-107640">
    <div class="subject"><a href="#post-107640">What are those _imp_blahblah@XX</a></div>
    <div class="body">something like __declspec(dllimport) but that is converted to __imp_<br /><br /><a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vccore/html/vcconImportingUsingDEFFiles.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vccore/html/vcconImportingUsingDEFFiles.asp</a></div>
    <div class="meta">Posted on 2003-06-19 16:47:47 by donkey</div>
   </div>
   <div class="post" id="post-107897">
    <div class="subject"><a href="#post-107897">What are those _imp_blahblah@XX</a></div>
    <div class="body">OK I GOT IT!!<br />Thx to donkey.I will make a summary and put it up there(ofcourse after exams  :grin:  )</div>
    <div class="meta">Posted on 2003-06-22 11:17:38 by titanwalker</div>
   </div>
  </div>
 </body>
</html>