<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Huffman Compression - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30278" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=30278">Huffman Compression</a></p>
   <div class="post" id="post-213380">
    <div class="subject"><a href="#post-213380">Huffman Compression</a></div>
    <div class="body">Hi,<br /><br />I am new to the forum, and wishing I found it earlier to be honest, but here goes.<br /><br />I am currently trying to write a Heap.asm and Huffman.asm for a project, but have no idea where to start.<br />(Using NASM on Ubuntu, Intel 32bit processor)<br />Basically all I was given is the 2 Skeleton files:<br /><br /><div class="quote"><strong>Heap.asm</strong><br />--------------------------------------------------------------------------------------------------------------<br />;*****************************************************************************<br />void heap_initialize(heap *H)<br />;*****************************************************************************<br /><br /><br /><br />;*****************************************************************************<br />void heap_insert(heap *H, heap_node *node)<br />;*****************************************************************************<br /><br /><br />;*****************************************************************************<br />void heap_remove(heap *H, heap_node *node)<br />;*****************************************************************************<br /><br />--------------------------------------------------------------------------------------------------------------</div><br /><br /><div class="quote"><strong>Huffman.asm</strong><br />--------------------------------------------------------------------------------------------------------------<br />;*****************************************************************************<br />void huffman_build_tree(heap *h, heap_node **t)<br />;*****************************************************************************<br /><br /><br />;*****************************************************************************<br />void huffman_initialize_table(huffman_node *t)<br />;*****************************************************************************<br /><br /><br />;*****************************************************************************<br />void huffman_build_table(heap_node *root, huffman_node *t, int code, int size)<br />;*****************************************************************************<br /><br />--------------------------------------------------------------------------------------------------------------</div><br /><br /><strong><br />I have written a delete node for a binary tree, but not too sure how to do it for the heap.</strong><br /><div class="quote">;*****************************************************************************<br />void delete_node(node **root, char *name);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />;*****************************************************************************<br />%define root <br />%define name <br />%define n&nbsp; &nbsp; <br />%define temp <br /><br />delete_node:<br />&nbsp; push&nbsp; ebp<br />&nbsp; mov&nbsp;  ebp, esp<br />&nbsp; sub&nbsp;  esp, 8<br /><br />&nbsp; mov&nbsp;  edx, root<br />&nbsp; mov&nbsp;  ebx, root<br />&nbsp; mov&nbsp;  edx, <br />&nbsp; cmp&nbsp;  edx, 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; if (*root != NULL) {<br />&nbsp; jz&nbsp; &nbsp; near .done<br /><br />&nbsp; cld<br />&nbsp; mov&nbsp;  ecx, 32<br />&nbsp; mov&nbsp;  esi, name<br />&nbsp; mov&nbsp;  edi, edx<br /><br />.while:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp; if (strcmp(name, (*root)-&gt;name) &lt; 0)<br />&nbsp; lodsb<br />&nbsp; scasb<br />&nbsp; jl&nbsp; &nbsp; .if<br />&nbsp; jg&nbsp; &nbsp; .else_1<br />&nbsp; cmp&nbsp;  al, 0<br />&nbsp; jz&nbsp; &nbsp; .else_2<br />&nbsp; dec&nbsp;  ecx<br />&nbsp; jnz&nbsp;  .while<br />&nbsp; jmp&nbsp;  .else_2<br /><br />.if:<br />&nbsp; push&nbsp; dword name<br />&nbsp; lea&nbsp;  ebx, <br />&nbsp; push&nbsp; ebx<br />&nbsp; call&nbsp; delete_node&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; delete_node(&amp;(*root)-&gt;left, name);<br />&nbsp; add&nbsp;  esp, 8<br />&nbsp; jmp&nbsp;  .done<br /><br />.else_1:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; <br />&nbsp; push&nbsp; dword name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;if (strcmp(name, (*root-&gt;name) &gt; 0)<br />&nbsp; lea&nbsp;  ebx, <br />&nbsp; push&nbsp; ebx<br />&nbsp; call&nbsp; delete_node&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;delete_node(&amp;(*root)-&gt;right, name);<br />&nbsp; add&nbsp;  esp, 8<br />&nbsp; jmp&nbsp;  .done<br /><br />.else_2:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; push&nbsp; edx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;temp = *root;<br />&nbsp; cmp&nbsp;  dword , 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;if ((*root)-&gt;left == NULL) <br />&nbsp; jnz&nbsp;  .else_3<br />&nbsp; mov&nbsp;  ecx, <br />&nbsp; mov&nbsp;  , ecx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;*root = (*root)-&gt;right;<br />&nbsp; jmp&nbsp;  .free&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /><br />.else_3:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; cmp&nbsp;  dword , 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;if ((*root)-&gt;right == NULL) {<br />&nbsp; jnz&nbsp;  .else_4<br />&nbsp; mov&nbsp;  ecx, <br />&nbsp; mov&nbsp;  , ecx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;*root = (*root)-&gt;left;<br />&nbsp; jmp&nbsp;  .free&nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />.else_4:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; lea&nbsp;  ecx, n<br />&nbsp; push&nbsp; ecx<br />&nbsp; lea&nbsp;  ecx, <br />&nbsp; push&nbsp; ecx<br />&nbsp; call&nbsp; remove_max&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;remove_max(&amp;(*root)-&gt;left, &amp;n);<br />&nbsp; add&nbsp;  esp, 8<br />&nbsp; mov&nbsp;  edx, root<br />&nbsp; mov&nbsp;  esi, <br />&nbsp; mov&nbsp;  ebx, n<br />&nbsp; mov&nbsp;  ecx, <br />&nbsp; mov&nbsp;  , ecx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;n-&gt;left = (*root)-&gt;left;<br />&nbsp; mov&nbsp;  ecx, <br />&nbsp; mov&nbsp;  , ecx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;n-&gt;right = (*root)-&gt;right;<br />&nbsp; mov&nbsp;  , ebx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; *root = n;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />.free:<br />&nbsp; call&nbsp; free&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;free(temp);<br />&nbsp; add&nbsp;  esp, 4<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />.done:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; mov&nbsp;  esp, ebp<br />&nbsp; pop&nbsp;  ebp<br />&nbsp; ret<br /></div><br /><br />Any and all help would be appreciated.<br />~Thanks<br /></div>
    <div class="meta">Posted on 2010-10-21 08:41:15 by Kevz</div>
   </div>
   <div class="post" id="post-213381">
    <div class="subject"><a href="#post-213381">Re: Huffman Compression</a></div>
    <div class="body"><strong>Kevz</strong>,<br /><br />Some comments:<br /><ul><br /><li>use recursion only as a last resort â€” iteration is better memory-wise;</li><br /><li>meaningful labels can somewhat remedy lack of comments;</li><br /><li>structure <strong>node</strong> has to be <em>defined</em>, not reverse-engineered or guessed from things like <strong></strong>;</li><br /><li><strong>near</strong> operator in <strong>jz near .done</strong> forces it to have 6-byte encoding; <strong>NASM</strong> can decide optimal jump type if you allow it to have multiple passes with <strong>-O</strong> option;</li><br /><li><strong>%define</strong>s for arguments probably should specify size together with address: <strong>%define root dword </strong>;</li><br /><li>misleading comment is much worse than no comment at all: <strong>if (strcmp(name, (*root-&gt;name) &gt; 0)</strong> has missing closing parenthesis (it&#039;s just an example, there are more to it in the source);</li><br /><li>0x80 is <em>less than</em> 0, but it&#039;s <em>above</em> 0;</li><br /><li>heap as a data structure doesn&#039;t manifest the same property as a tree (indeed it&#039;s quite contrary: for any heap node its childs&#039; keys <em>aren&#039;t greater</em> than this node&#039;s key);</li><br /><li>enforce zero-padding of the key, then <strong>repe cmpsb</strong> can be useful;</li><br /><li><strong>delete_node()</strong> looks like using <strong>cdecl</strong> calling conventions, yet it tampers <strong>ebx</strong>, <strong>esi</strong> and <strong>edi</strong>;</li><br /><li>how could <strong>free()</strong> guess the address of memory block to free?</li><br /></ul><br /><br />As I said above, heap node&#039;s childs are not greater than it. Keeping this property in mind, it&#039;s easy to implement basic operations on heap (if you don&#039;t care about it being imbalanced).</div>
    <div class="meta">Posted on 2010-10-21 10:33:06 by baldr</div>
   </div>
   <div class="post" id="post-213382">
    <div class="subject"><a href="#post-213382">Re: Huffman Compression</a></div>
    <div class="body">Thanks for the advice baldr, still new and always learning on the Assembly Scene.</div>
    <div class="meta">Posted on 2010-10-21 12:29:09 by Kevz</div>
   </div>
  </div>
 </body>
</html>