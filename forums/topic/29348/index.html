<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Can't get any output string,  what's wrong with my code? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29348" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29348">Can't get any output string,  what's wrong with my code?</a></p>
   <div class="post" id="post-207245">
    <div class="subject"><a href="#post-207245">Can't get any output string,  what's wrong with my code?</a></div>
    <div class="body">This is the main program:<br /><pre><code><br />extern&nbsp; &nbsp; &nbsp; &nbsp; concat:far<br /><br />stackseg&nbsp; &nbsp; segment&nbsp; &nbsp; stack<br />&nbsp; &nbsp; &nbsp; &nbsp; bBuffer&nbsp; &nbsp; &nbsp; &nbsp; byte&nbsp; &nbsp; &nbsp; 100 DUP(?)<br />stackseg&nbsp; &nbsp; ends<br /><br />dataseg&nbsp; &nbsp; &nbsp; &nbsp; segment <br />&nbsp; &nbsp; &nbsp; &nbsp; szMsg1&nbsp; &nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp; &#039; Hello World!&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; szMsg&nbsp; &nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp;  &#039;2 1&#039;, 13,10,&#039;$&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; iData&nbsp; &nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp; &#039;123456789012&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; szMsg2&nbsp; &nbsp; &nbsp;  BYTE&nbsp; &nbsp;  &#039; The Art of Assembly Language Programming&#039;,13,10,&#039;$&#039;<br />dataseg&nbsp; &nbsp; &nbsp; &nbsp; ends<br /><br />codeseg&nbsp; &nbsp; &nbsp; &nbsp; segment <br />&nbsp; &nbsp; assume&nbsp; &nbsp; &nbsp; &nbsp; cs:codeseg, ds:dataseg, es:dataseg, ss:stackseg<br />&nbsp; &nbsp; START:<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp; ax, dataseg<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  ds, ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp; es, ax<br />&nbsp; &nbsp; &nbsp; &nbsp; lea&nbsp; &nbsp; &nbsp; &nbsp; si, szMsg1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Set the first string&#039;s address and length<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp; BYTE ptr , 12&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; lea&nbsp; &nbsp; &nbsp; &nbsp; bx, szMsg2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Set the second string&#039;s address and length<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp; BYTE ptr , 43&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; lea&nbsp; &nbsp; &nbsp; &nbsp; di, szMsg&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Set the concatenated string&#039;s address<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; &nbsp; &nbsp; concat&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Call subprogram<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; lea&nbsp; &nbsp; &nbsp; &nbsp;  dx, szMsg&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; inc&nbsp; &nbsp; &nbsp; &nbsp; dx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  ah,9<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp; &nbsp; &nbsp;  21h<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  ah,1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp; &nbsp; &nbsp;  21h<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  ah,4ch&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp; &nbsp; &nbsp;  21h<br />codeseg&nbsp; &nbsp; &nbsp; &nbsp; ends&nbsp; &nbsp; <br />&nbsp; &nbsp; END START<br /></code></pre><br />Tihs is the subprogram:<br /><pre><code><br />; Concat- Copies the string pointed at by SI to the string<br />; rointed at byDI and then concatenates the string;<br />; pointed at by BX to the destination string.<br />;<br />; On entry-<br />;<br />; DS:SI- Points at the first source string<br />; DS:BX- Points at the second source string<br />; ES:DI- Points at the destination string.<br />;<br />; Error condition-<br />;<br />; The sum of the lengths of the two strings is greater than 255.<br />; In this event, the second string will be truncated so that the<br />; entire string is less than 256 characters in length.<br />public&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; concat<br /><br />dataseg&nbsp; &nbsp; &nbsp; &nbsp; segment<br />dataseg&nbsp; &nbsp; &nbsp; &nbsp; ends<br /><br />codeseg&nbsp; &nbsp; &nbsp; &nbsp; segment<br />&nbsp; &nbsp; assume&nbsp; &nbsp; cs:codeseg, ds:dataseg, es:dataseg<br />&nbsp; &nbsp; concat&nbsp; &nbsp;  proc far<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp; ax, dataseg<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp; ds, ax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp; es, ax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp;  si<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp;  di<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp;  cx<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp;  ax<br />&nbsp; &nbsp; &nbsp; &nbsp; pushf<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; Copy the first string to the destination string:<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  cl, al<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  ch, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  ah, ch<br />&nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp; &nbsp;  al, &nbsp; &nbsp; &nbsp; &nbsp;  ;Compute the sum of the string&#039;s<br />&nbsp; &nbsp; &nbsp; &nbsp; adc&nbsp; &nbsp; &nbsp; &nbsp;  ah, 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; lengths.<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp; &nbsp; &nbsp;  ax, 256<br />&nbsp; &nbsp; &nbsp; &nbsp; jb&nbsp; &nbsp; &nbsp; &nbsp;  SetNewLength<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  ah, &nbsp; &nbsp; &nbsp; &nbsp;  ;Save original string length.<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  al, 255&nbsp; &nbsp; &nbsp; &nbsp;  ;Fix string length at 255.<br />&nbsp; &nbsp; SetNewLength: <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  es:, al&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Save new string length.<br />&nbsp; &nbsp; &nbsp; &nbsp; inc&nbsp; &nbsp; &nbsp; &nbsp;  di&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Skip over length bytes.<br />&nbsp; &nbsp; &nbsp; &nbsp; inc&nbsp; &nbsp; &nbsp; &nbsp;  si<br />&nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp; &nbsp; &nbsp;  movsb&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Copy source1 to dest string.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ; If the sum of the two strings is too long, the second string<br />&nbsp; &nbsp; &nbsp; &nbsp; ; must be truncated.<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  cl, &nbsp; &nbsp; &nbsp; &nbsp;  ;Get length of second string.<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp; &nbsp; &nbsp;  ax, 256<br />&nbsp; &nbsp; &nbsp; &nbsp; jb&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  LengthsAreOK<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; &nbsp;  cl, ah&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Compute truncated length.<br />&nbsp; &nbsp; &nbsp; &nbsp; neg&nbsp; &nbsp; &nbsp; &nbsp;  cl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;CL := 256-Length(Str1).<br />&nbsp; &nbsp; LengthsAreOK: <br />&nbsp; &nbsp; &nbsp; &nbsp; lea si, 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Point at second string and<br />&nbsp; &nbsp; &nbsp; &nbsp; ; skip the string length.<br />&nbsp; &nbsp; &nbsp; &nbsp; cld<br />&nbsp; &nbsp; &nbsp; &nbsp; rep movsb&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Perform the concatenation.<br />&nbsp; &nbsp; &nbsp; &nbsp; popf<br />&nbsp; &nbsp; &nbsp; &nbsp; pop ax<br />&nbsp; &nbsp; &nbsp; &nbsp; pop cx<br />&nbsp; &nbsp; &nbsp; &nbsp; pop di<br />&nbsp; &nbsp; &nbsp; &nbsp; pop si<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />&nbsp; &nbsp; &nbsp; &nbsp; concat endp<br />codeseg&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ends<br />&nbsp; &nbsp; end&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; concat<br /></code></pre><br />After building, run the exe file, DOS command line window glint and disappeared quickly.<br /></div>
    <div class="meta">Posted on 2009-04-07 06:14:10 by qlmi</div>
   </div>
   <div class="post" id="post-207247">
    <div class="subject"><a href="#post-207247">Re: Can't get any output string,  what's wrong with my code?</a></div>
    <div class="body">You should open a command prompt window first, then execute your program from there.<br />It is standard behaviour for Windows to close a console window after the program exits. Your program prints a string, then exits, so Windows will close the console window, and you can&#039;t see the output.<br /><br />If you open a command prompt window first, then run it from there, the window will stay open until you exit the command prompt itself, so you can see the output.</div>
    <div class="meta">Posted on 2009-04-07 07:12:02 by Scali</div>
   </div>
   <div class="post" id="post-207258">
    <div class="subject"><a href="#post-207258">Re: Can't get any output string,  what's wrong with my code?</a></div>
    <div class="body">Hi, Scali. I have run the EXE file&nbsp; in command prompt window; but there still isn&#039;t any string output on my screen.&nbsp; <br /><br />When I search for help about this same question, someone&#039;s answer is data segment defination in the subprogram and the main program: both data segment combination type should be PUBLIC or COMMON.<br />After modified my code, the program works corretly. But this teacher also is&#039;t able to give me a logically explanation.&nbsp; </div>
    <div class="meta">Posted on 2009-04-08 06:54:09 by qlmi</div>
   </div>
   <div class="post" id="post-207259">
    <div class="subject"><a href="#post-207259">Re: Can't get any output string,  what's wrong with my code?</a></div>
    <div class="body">What exactly did you modify then?<br />Because as far as I can see, you use a separate data segment, and set the ds register to point to that data segment.<br />So at first sight, I don&#039;t see a problem there.</div>
    <div class="meta">Posted on 2009-04-08 07:37:53 by Scali</div>
   </div>
   <div class="post" id="post-207266">
    <div class="subject"><a href="#post-207266">Re: Can't get any output string,  what's wrong with my code?</a></div>
    <div class="body">In main program, give the&nbsp; data segment &#039;PUBLIC&#039; combination type<br /><pre><code><br />dataseg&nbsp; &nbsp; &nbsp; &nbsp; segment&nbsp; &nbsp; &nbsp; PUBLIC &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; szMsg1&nbsp; &nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp; &#039; Hello World!&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; szMsg&nbsp; &nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp;&#039;2 1&#039;, 13,10,&#039;$&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; iData&nbsp; &nbsp; &nbsp; &nbsp; BYTE&nbsp; &nbsp; &nbsp; &#039;123456789012&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; szMsg2&nbsp; &nbsp; &nbsp; &nbsp;BYTE&nbsp; &nbsp; &nbsp;&#039; The Art of Assembly Language Programming&#039;,13,10,&#039;$&#039;<br />dataseg&nbsp; &nbsp; &nbsp; &nbsp; ends<br /></code></pre><br />and in subprogram, also give the data segment &#039;PUBLIC&#039; combination type<br /><pre><code><br />dataseg&nbsp; &nbsp; &nbsp; &nbsp; segment&nbsp; &nbsp; PUBLIC<br />dataseg&nbsp; &nbsp; &nbsp; &nbsp; ends<br /></code></pre> <br /></div>
    <div class="meta">Posted on 2009-04-08 23:45:54 by qlmi</div>
   </div>
   <div class="post" id="post-207269">
    <div class="subject"><a href="#post-207269">Re: Can't get any output string,  what's wrong with my code?</a></div>
    <div class="body">I think your answer is here:<br />http://www.arl.wustl.edu/~lockwood/class/cs306/books/artofasm/Chapter_8/CH08-2.html<br /><div class="quote">The public and stack combine types essentially perform the same operation. They concatenate segments with the same name into a single contiguous segment, just as described earlier.</div><br /><br />Because you didn&#039;t have public, it didn&#039;t combine the two datasegs into a single segment, so I suppose that means that the two pieces of code weren&#039;t looking at the same data, so they weren&#039;t modifying the same string.</div>
    <div class="meta">Posted on 2009-04-09 07:32:19 by Scali</div>
   </div>
   <div class="post" id="post-207271">
    <div class="subject"><a href="#post-207271">Re: Can't get any output string,  what's wrong with my code?</a></div>
    <div class="body">Absolutely Correct!</div>
    <div class="meta">Posted on 2009-04-09 08:45:11 by qlmi</div>
   </div>
  </div>
 </body>
</html>