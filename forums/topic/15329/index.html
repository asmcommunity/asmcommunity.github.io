<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Editing DOS stub - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=15329" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=15329">Editing DOS stub</a></p>
   <div class="post" id="post-119067">
    <div class="subject"><a href="#post-119067">Editing DOS stub</a></div>
    <div class="body">Is there any way to edit the DOS stub of the output file in masm? Any linker swithches, something?</div>
    <div class="meta">Posted on 2003-09-23 02:52:37 by Ghirai</div>
   </div>
   <div class="post" id="post-119073">
    <div class="subject"><a href="#post-119073">Editing DOS stub</a></div>
    <div class="body">You can use your own stub, and use the /stub:mystub.exe option when linking your program.</div>
    <div class="meta">Posted on 2003-09-23 03:30:24 by f0dder</div>
   </div>
   <div class="post" id="post-119078">
    <div class="subject"><a href="#post-119078">Editing DOS stub</a></div>
    <div class="body">Cool, and in what can i write that stub? Say TASM or what?<br />All i want to do is call int 21h to exit...<br /><br />Ok, here's the code:<br /><br />.286<br />    DOSSEG<br />    .MODEL SMALL<br />    .STACK 200h<br />    .DATA<br />    .CODE<br /><br />START:<br />    INT 20<br />END START<br /><br />The problem is that link.exe returns: stub.exe : fatal error LNK1132: invalid format for MS-DOS stub file &quot;stub.exe&quot;<br />What's wrong? The exe works(exits) fine... :confused:</div>
    <div class="meta">Posted on 2003-09-23 04:13:41 by Ghirai</div>
   </div>
   <div class="post" id="post-119081">
    <div class="subject"><a href="#post-119081">Editing DOS stub</a></div>
    <div class="body">You can use whatever produces an EXE output - and yes, it must be an EXE file. Plus there is a minimum size, but the linker will take care of that.</div>
    <div class="meta">Posted on 2003-09-23 04:58:20 by f0dder</div>
   </div>
   <div class="post" id="post-119082">
    <div class="subject"><a href="#post-119082">Editing DOS stub</a></div>
    <div class="body">Well, my stub is an 4 bytes exe, conatining &quot;?L?!&quot;  :)<br />Do you think it's too small or something?</div>
    <div class="meta">Posted on 2003-09-23 05:01:38 by Ghirai</div>
   </div>
   <div class="post" id="post-119083">
    <div class="subject"><a href="#post-119083">Editing DOS stub</a></div>
    <div class="body">you have produced a COM file output - the file extension itself isn't enough.</div>
    <div class="meta">Posted on 2003-09-23 05:03:32 by f0dder</div>
   </div>
   <div class="post" id="post-119090">
    <div class="subject"><a href="#post-119090">Editing DOS stub</a></div>
    <div class="body">Ok, i got a exefile, but why is is 517 bytes??? It's a little huge for :<br /><br />mov     ax, 4C00h<br />int     21h<br /><br />It's bigger than the original stub that link.exe produces.</div>
    <div class="meta">Posted on 2003-09-23 05:41:51 by Ghirai</div>
   </div>
   <div class="post" id="post-119091">
    <div class="subject"><a href="#post-119091">Editing DOS stub</a></div>
    <div class="body">Hi, f0dder.<br /><br />I don't think above example is .COM file. Com file need &quot;org 100h&quot; and COM format doesn't allow setting stack size. In addition dos linkers creates only EXE files, you must convert it to COM (if such is possible).<br /><br />regards.</div>
    <div class="meta">Posted on 2003-09-23 05:43:23 by JohnFound</div>
   </div>
   <div class="post" id="post-119092">
    <div class="subject"><a href="#post-119092">Re: Editing DOS stub</a></div>
    <div class="body">Hi, <strong>Ghirai </strong><br />May be I'm wrong, but I belive that the bast way to write stub is to use a HEX editor.<br />Also you should search for some about PE format<br /><br />Here's my stub for example (I'm near MZ :) )<br /><pre><code>Offset      0  1  2  3  4  5  6  7   8  9  A  B  C  D  E  F<br />00000000   4D 5A 00 00 01 00 00 00  02 00 00 00 FF FF 00 00   MZ..........??..<br />00000010   40 00 00 00 00 00 00 00  40 00 00 00 53 54 41 53   @.......@...STAS<br />00000020   0E 1F B4 09 BA 0E 00 CD  21 B8 00 4C CD 21 50 45   ..?.?..?!?.L?!PE<br />00000030   20 66 6F 72 20 57 69 6E  33 32 07 24 00 00 00 00    for Win32.$.... </code></pre> <br /><br />Also link.exe adds some &quot;signature&quot; to yor file.<br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=14699&amp;highlight=optimization">Here's some info</a></div>
    <div class="meta">Posted on 2003-09-23 05:48:21 by S.T.A.S.</div>
   </div>
   <div class="post" id="post-119125">
    <div class="subject"><a href="#post-119125">Editing DOS stub</a></div>
    <div class="body">JohnFound, according to<br /><div class="quote"><br />Well, my stub is an 4 bytes exe, conatining &quot;?L?!&quot; <br />Do you think it's too small or something?<br /></div><br />the output was a com file - binary, headerless output, anyway.<br /><br />As for small stub construction... tjah.</div>
    <div class="meta">Posted on 2003-09-23 08:47:29 by f0dder</div>
   </div>
   <div class="post" id="post-119133">
    <div class="subject"><a href="#post-119133">Editing DOS stub</a></div>
    <div class="body">Thanks for the stub  S.T.A.S., i've already read your post.<br />I suppose files genrated by the patched link.exe will have no problems running on non NT boxes, right?</div>
    <div class="meta">Posted on 2003-09-23 09:01:05 by Ghirai</div>
   </div>
   <div class="post" id="post-119162">
    <div class="subject"><a href="#post-119162">Editing DOS stub</a></div>
    <div class="body">Ghirai,<br /><br />You can check my dialog box <a target="_blank" href="http://www.asmcommunity.net/board/attachment.php?s=&amp;postid=115210">example</a>,it's linked with a stub of 64 bytes.</div>
    <div class="meta">Posted on 2003-09-23 12:38:10 by Vortex</div>
   </div>
   <div class="post" id="post-119194">
    <div class="subject"><a href="#post-119194">Editing DOS stub</a></div>
    <div class="body"><div class="quote"><br />I suppose files genrated by the patched link.exe will have no problems running on non NT boxes, right? </div>I'm using link.exe v5 pathed.  No problems with my stub uneder Win98SE/2K SP3&amp;4/XP/XP SP1.<br />Don't know about Win95&amp;NT. Some time is passed after I've last seen these versions :tongue: <br /><br />IIRC, when we're using original stub, no signature is added.<br />I think these bytes are &quot;special signs&quot; showing that the prog is linked by ms linker.<br />Not sure is it legal or not to remove them, but there are other linkers available in inet.</div>
    <div class="meta">Posted on 2003-09-23 18:23:29 by S.T.A.S.</div>
   </div>
  </div>
 </body>
</html>