<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>How to find file size or end of file character? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25892" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25892">How to find file size or end of file character?</a></p>
   <div class="post" id="post-188788">
    <div class="subject"><a href="#post-188788">How to find file size or end of file character?</a></div>
    <div class="body">I&#39;m writing a program to print everything in a text file to the screen.<br /><br />Is there an interrupt or way, when opening a file, to get the file size or is there some sort of end of file character I can use to control the loop?<br /><br />I&#39;ve looked at The Art of Assembly and other source and I just seem to be missing it.<br /><br />Thanks<br /><br /><br /></div>
    <div class="meta">Posted on 2007-04-09 16:57:46 by Alklun</div>
   </div>
   <div class="post" id="post-188789">
    <div class="subject"><a href="#post-188789">Re: How to find file size or end of file character?</a></div>
    <div class="body">http://www.arl.wustl.edu/~lockwood/class/cs306/books/artofasm/Chapter_13/CH13-8.html</div>
    <div class="meta">Posted on 2007-04-09 17:45:27 by Synfire</div>
   </div>
   <div class="post" id="post-188790">
    <div class="subject"><a href="#post-188790">Re: How to find file size or end of file character?</a></div>
    <div class="body">The GetFileSize function retrieves the size, in bytes, of the specified file. <br /><br />DWORD GetFileSize(<br /><br />&nbsp; &nbsp; HANDLE hFile,	// handle of file to get size of<br />&nbsp; &nbsp; LPDWORD lpFileSizeHigh 	// address of high-order word for file size<br />&nbsp;  );</div>
    <div class="meta">Posted on 2007-04-09 18:50:45 by JimG</div>
   </div>
   <div class="post" id="post-188792">
    <div class="subject"><a href="#post-188792">Re: How to find file size or end of file character?</a></div>
    <div class="body">When dealing with DOS Interrupts as an API... keep a copy of <a target="_blank" href="http://www.ctyme.com/rbrown.htm"><u>RBIL</u></a> handy ;)</div>
    <div class="meta">Posted on 2007-04-09 19:49:52 by SpooK</div>
   </div>
   <div class="post" id="post-188793">
    <div class="subject"><a href="#post-188793">Re: How to find file size or end of file character?</a></div>
    <div class="body">read file<br /><br />mov ax,3F00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;ah actually<br />mov bx,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;bl actually<br />mov cx,<br />int 21<br /><br />Now.<br /><br />If we put FFFF into cx, it will read the file and put the actual number of bytes read into ax if the file is smaller than FFFF bytes.<br /><br />groovy. 8)<br /></div>
    <div class="meta">Posted on 2007-04-09 21:27:14 by eek</div>
   </div>
   <div class="post" id="post-188794">
    <div class="subject"><a href="#post-188794">Re: How to find file size or end of file character?</a></div>
    <div class="body">That&#39;s awsome everyone, Thanks so much. <br /><br />I had heard something about clearing cx and having the file size in ax, but didnt get details.<br /></div>
    <div class="meta">Posted on 2007-04-09 21:39:26 by Alklun</div>
   </div>
   <div class="post" id="post-188795">
    <div class="subject"><a href="#post-188795">Re: How to find file size or end of file character?</a></div>
    <div class="body">CX and DX are the DWORD seek position for the DOS trap. If you set these values to zero (0x0000), you will get the size of the file. We have this in Windows too (SetFilePointer). Here is the code that I have written that retrieves the size of a given file. It has enough documentation and comments for you to understand it.<br /><br /><br /><pre><code>; ------------------------------<br />FileGetSize PROC<br />&nbsp; COMMENT *<br />&nbsp; &nbsp; Description : Gets the 32-bit size of an open file. See note(s).<br /><br />&nbsp; &nbsp; Calling Convention : Push from left to right.<br /><br />&nbsp; &nbsp; Parameter(s) :<br />&nbsp; &nbsp; &nbsp; WORD Param1 = Target file&#39;s handle offset<br />&nbsp; &nbsp; &nbsp; WORD Param2 = File size variable (16-bit offset)<br /><br />&nbsp; &nbsp; Stack Usage: 8 Bytes.<br /><br />&nbsp; &nbsp; Note : 1) Param2 is a 32-bit long variable which will receive the size of the file<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if the procedure do its job successfully.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  2) The Param2, although a 32-bit variable, should have its 16-bit offset passed onto<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the procedure.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  3) Param1 is the offset to the variable which holds the handle to an open file.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  4) The AX register will be set to 0000h (Zero) if the procedure is through successfully<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; or one of the below values if an error occurred:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AX = 0001h (Invalid function - Would not happen if you didn&#39;t modify<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the procedure&#39;s code)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AX = 0006h (Invalid handle)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  5) The value of the Param2 parameter will remain unchanged if the value of the AX register<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is not set to zero when the procedure ends.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  6) The file should have been opened before invoking this procedure.<br /><br />&nbsp; &nbsp; Example : Retrieve an open file&#39;s size and put the result in a<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 32-bit DWORD variable called &#39;FileSize&#39;.<br /><br />&nbsp; &nbsp; .DATA?<br />&nbsp; &nbsp; &nbsp; FileHandle&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DW&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ?<br />&nbsp; &nbsp; &nbsp; FileSize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ?<br />&nbsp; &nbsp; .CODE<br />&nbsp; &nbsp; &nbsp; PUSH&nbsp; &nbsp; OFFSET FileHandle ; Push the file handle onto the stack<br />&nbsp; &nbsp; &nbsp; PUSH&nbsp; &nbsp; OFFSET FileSize&nbsp;  ; Push the receiver-variable onto the stack<br />&nbsp; &nbsp; &nbsp; CALL&nbsp; &nbsp; FileGetSize&nbsp; &nbsp; &nbsp;  ; Get the file size<br />&nbsp; &nbsp; &nbsp; ADD&nbsp; &nbsp;  SP , 0004h&nbsp; &nbsp; &nbsp; &nbsp; ; Remove both of the parameters<br />&nbsp; &nbsp; &nbsp; TEST&nbsp; &nbsp; AX , AX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; See if AX == 0 (Success)<br />&nbsp; &nbsp; &nbsp; JNE&nbsp; &nbsp;  @@Failed&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Jump to ... if not<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Success<br />&nbsp; &nbsp; &nbsp; &nbsp; ; FileSize = 0080FDA0h (For instance)<br />&nbsp; &nbsp; &nbsp; @@Failed:<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Failure<br />&nbsp; *<br />&nbsp; PUSH&nbsp; &nbsp; BX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Push the base index onto the stack<br />&nbsp; PUSH&nbsp; &nbsp; CX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Push the count register onto the stack<br />&nbsp; PUSH&nbsp; &nbsp; DX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Push the data register onto the stack<br />&nbsp; PUSH&nbsp; &nbsp; BP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Push the base pointer onto the stack<br />&nbsp; MOV&nbsp; &nbsp;  BP , SP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Move the stack pointer to the base pointer<br />&nbsp; MOV&nbsp; &nbsp;  AL , 02h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Seek from the end of the file<br />&nbsp; XOR&nbsp; &nbsp;  CX , CX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; High Order Word is equal to zero<br />&nbsp; XOR&nbsp; &nbsp;  DX , DX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Low Order Word is equal to zero<br />&nbsp; MOV&nbsp; &nbsp;  BX , WORD PTR &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; BX is the pointer to the file handle<br />&nbsp; MOV&nbsp; &nbsp;  BX , WORD PTR &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; BX is the file handle<br />&nbsp; MOV&nbsp; &nbsp;  AH , 042h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Request Seek operation<br />&nbsp; DW&nbsp; &nbsp; &nbsp; 21CDh&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Issue the DOS interrupt<br />&nbsp; JC&nbsp; &nbsp; &nbsp; @@__FileGetSizeEP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Jump to ... if an error has occurred<br />&nbsp; MOV&nbsp; &nbsp;  BX , WORD PTR &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; BX is the pointer to the new position variable<br />&nbsp; MOV&nbsp; &nbsp;  WORD PTR  , AX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Fill the Low Order Word of the variable<br />&nbsp; MOV&nbsp; &nbsp;  WORD PTR  , DX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Fill the High Order Word of the variable<br />&nbsp; XOR&nbsp; &nbsp;  AX , AX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; AX = 0000h (Success)<br />&nbsp; @@__FileGetSizeEP:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; End of the procedure routine<br />&nbsp; &nbsp; POP&nbsp; &nbsp;  BP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Restore the base pointer<br />&nbsp; &nbsp; POP&nbsp; &nbsp;  DX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Restore the data register<br />&nbsp; &nbsp; POP&nbsp; &nbsp;  CX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Restore the count register<br />&nbsp; &nbsp; POP&nbsp; &nbsp;  BX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Restore the base index<br />&nbsp; RET&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; Return to the calling procedure<br />FileGetSize ENDP<br />; ------------------------------</code></pre></div>
    <div class="meta">Posted on 2007-04-10 00:13:31 by XCHG</div>
   </div>
  </div>
 </body>
</html>