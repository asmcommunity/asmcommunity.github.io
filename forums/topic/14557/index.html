<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>combobox? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14557" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=14557">combobox?</a></p>
   <div class="post" id="post-112590">
    <div class="subject"><a href="#post-112590">combobox?</a></div>
    <div class="body">hi, trying to get to grips with comboboxes..<br />i created a combobox on my window during wm_create message, and also tried to &quot;invoke SendMessage,hCombo,CB_ADDSTRING,0,ADDR string&quot; below that.<br />now, the combo box shows; but nothing is added in the lists..:confused:  any idea?<br />here is my code snippet:<br /><pre><code>.IF uMsg==WM_CREATE<br /><br />	invoke CreateWindowEx,WS_EX_LEFT or WS_EX_LTRREADING or WS_EX_RIGHTSCROLLBAR,\<br />			ADDR cmbBox,0,CBS_HASSTRINGS or CBS_DROPDOWN or CBS_SIMPLE or WS_CHILD or WS_OVERLAPPED or WS_VISIBLE\<br />			,10,10,180,25,hWnd,NULL,hInstance,NULL<br /><br />			mov hCombo,eax<br /><br />invoke SendMessage,hCombo,CB_SETITEMDATA,0,ADDR string1<br />invoke SendMessage,hCombo,CB_ADDSTRING,0,ADDR string2<br />invoke SendMessage,hCombo,CB_ADDSTRING,0,ADDR string3</code></pre></div>
    <div class="meta">Posted on 2003-07-31 15:42:30 by wilson</div>
   </div>
   <div class="post" id="post-112602">
    <div class="subject"><a href="#post-112602">combobox?</a></div>
    <div class="body">Make your combobox large enough to display the information. A hieght of 25 pixels is not enough to display a line of text when you subtract the height of the edit box and it's border (25 - 10 - 3 - 3 = 9 pixels), try a value of 300 instead...<br /><pre><code>invoke CreateWindowEx,WS_EX_LEFT or WS_EX_LTRREADING or WS_EX_RIGHTSCROLLBAR,<br />	ADDR cmbBox,0,CBS_HASSTRINGS or CBS_DROPDOWN or CBS_SIMPLE or WS_CHILD or WS_OVERLAPPED or WS_VISIBLE,<br />	10,10,180,&#91;color=red&#93;&#91;b&#93;300&#91;/b&#93;&#91;/color&#93;,hWnd,NULL,hInstance,NULL</code></pre><br /><br />Also if the line ends in a comma no continuation character is required.</div>
    <div class="meta">Posted on 2003-07-31 17:22:36 by donkey</div>
   </div>
   <div class="post" id="post-112604">
    <div class="subject"><a href="#post-112604">combobox?</a></div>
    <div class="body">thanks donkey, working now:) <br /><br />is it possible to list the lines from a text file, or would i need to do OpenFile then load them from memory?</div>
    <div class="meta">Posted on 2003-07-31 17:39:25 by wilson</div>
   </div>
   <div class="post" id="post-112605">
    <div class="subject"><a href="#post-112605">combobox?</a></div>
    <div class="body">Well, there is no way to do that with an API command or message. You will have to read the text file in and parse the eol's yourself by looking for CRLF, then when you have a full line add that to the combo box... This should do it for ya :<pre><code>&#91;b&#93;;Open the file and pass the handle to this procedure.&#91;/b&#93;<br /><br />ReadTextFile Proc hFile&#58;DWORD<br />	LOCAL	fSize			&#58;DWORD<br />	LOCAL	nBytes			&#58;DWORD<br />	LOCAL	byteBuffer&#91;4&#93;		&#58;BYTE<br />	LOCAL	pBuffer			&#58;DWORD<br /><br />	invoke GetFileSize,hFile,NULL<br />	mov fSize,eax<br />	lea eax,TBUFFER<br />	mov pBuffer,eax<br />	mov eax,0<br />	.While eax &lt;= fSize<br />		; read a line from the file<br />		mov ecx,0<br />		; Keep reading until a CR is encountered<br />		.WHILE al != 0DH<br />			push ecx<br />			invoke ReadFile,hFile,ADDR byteBuffer,1,ADDR nBytes,NULL<br />			.IF nBytes == 0<br />				.BREAK<br />			.endif<br />			pop ecx<br />			lea edx,byteBuffer<br />			mov al,&#91;edx&#93;<br />			mov edx,pBuffer<br />			mov &#91;edx+ecx&#93;,al<br />			inc ecx<br />		.ENDW<br />		; set the buffer pointer to overwrite 0DH<br />		dec ecx<br />		; Null terminate the string<br />		mov &#91;edx+ecx&#93;,BYTE PTR 0<br />		;<br />		invoke SendMessage,hCombo,CB_ADDSTRING,0,pBuffer<br />		;<br />		; move the file pointer to the start of the next line<br />		invoke SetFilePointer,hFile,1,0,FILE_CURRENT<br />	.ENDW<br />	; Close the file when your done<br />	invoke CloseHandle,hFile<br />	ret<br />ReadTextFile endp</code></pre></div>
    <div class="meta">Posted on 2003-07-31 18:20:08 by donkey</div>
   </div>
   <div class="post" id="post-112655">
    <div class="subject"><a href="#post-112655">combobox?</a></div>
    <div class="body">hhm,<br />first thing this morning, i put your ReatTextFile process into my combobox app and it worked fine (the file was just a list of &quot;one&quot;,&quot;two&quot;,&quot;three&quot;)<br />then i changed the file to something with a bit more meat and again it worked, untill i made the combobox wider/higher.. then it would crash at startup..<br /><br />now i tried to put it back to how it was, and it wont work at all (even with original of this morning:( )..<br />line causing crash is:<br />mov ,BYTE PTR 0<br /><br />thanks for the code, it was working a treat :confused:</div>
    <div class="meta">Posted on 2003-08-01 05:33:17 by wilson</div>
   </div>
   <div class="post" id="post-112659">
    <div class="subject"><a href="#post-112659">combobox?</a></div>
    <div class="body">Just as an aside, rather than repeatedly invoking readfile to read a byte from the file you could map the entire file into your processes memory space and then simply read the bytes in the file by incrementing the pointer returned by MapViewOfFile. This should run a little quicker. For instance:<br /><br />include   windows.inc<br /><br />cr	equ	0Dh<br />Lf	equ	0Ah<br /><br />.data<br />        ; filename is the full path and filename of the file to open<br />       filename  byte &quot;C:\myFiles\......\myFile.txt&quot;,0<br />             .....<br />.data?<br />       lineBuffer   byte dup 100h (?)<br />       handle       dword ? <br />       filesize       dword ? <br />       hMapfile     dword ?        <br />       pMapFile    dword ?<br /><br /><br />.code<br />            ....<br /><br />                ;---------------------------------------------------------------	<br />	; Open the file <br />	;---------------------------------------------------------------<br /><br />                invoke CreateFile, offset filename, GENERIC_READ, FILE_SHARE_READ, 0,  <br />                                                           OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0<br /><br />	cmp                          eax, INVALID_HANDLE_VALUE<br />	je		fileOpenError<br /><br />	; Save the handle returned from CreateFile<br />	mov		handle, eax<br /><br /><br />	;---------------------------------------------------------------	<br />	; Get the file size (in bytes)<br />	;---------------------------------------------------------------	<br /><br />	invoke	                GetFileSize, handle, 0<br />	cmp		eax, INVALID_FILE_SIZE<br />	je		fileSizeError<br />	<br />	cmp		eax, 0<br />	je		zeroFileSizeError<br /><br />	; Save the filesize<br />	mov		filesize, eax<br /><br /><br />	;---------------------------------------------------------------	<br />	; Map the file into this process's memory space<br />	;---------------------------------------------------------------	<br /><br />	invoke	              CreateFileMapping, handle, 0, PAGE_READONLY, 0, 0, 0<br />	cmp		eax, 0<br />	je		createFileMapError<br /><br />	; Save the file mapping handle<br />	mov		hMapfile, eax<br />	<br />	invoke	                MapViewOfFile, hMapfile, FILE_MAP_READ, 0, 0, 0<br />	cmp		eax, 0<br />	je		mapFileError<br />	<br />	; Save the pointer to the mapped file<br />	mov		pMapFile, eax<br /><br />       .....<br /><br />               ;---------------------------------------------------------------<br />               ; Read the bytes<br />               ;---------------------------------------------------------------<br /><br />               mov		esi, pMapFile<br />               lea                            edi, lineBuffer<br />	mov		ecx, filesize<br /><br />WhileLoop:<br />	; While (ecx != 0)				<br />	mov		dl, byte ptr 	; move a byte<br />                cmp                          dl, cr<br />                je                             doWhateverComesNext<br />                mov                          byte ptr , dl<br />                dec                           ecx<br />                or                             ecx, ecx<br />                jnz                            WhileLoop<br />                <br />        .....<br /><br />               ;---------------------------------------------------------------<br />               ; Cleanup<br />               ;---------------------------------------------------------------<br /><br />	invoke	               UnmapViewOfFile, pMapFile<br />	invoke	               CloseHandle, hMapfile<br />	mov		hMapfile, 0<br />	invoke	                CloseHandle, handle<br />	mov		handle, 0<br /><br /><br />Hope this helps out a bit</div>
    <div class="meta">Posted on 2003-08-01 06:49:54 by andrew_k</div>
   </div>
   <div class="post" id="post-112687">
    <div class="subject"><a href="#post-112687">combobox?</a></div>
    <div class="body">Yup, if your doing big files it's best to use a memory mapped file. The sniplet was from a project that read a file with no more than 2 or 3 hundred bytes and I didn't see a practical reason to memory map it. I had just assumed that your files would be small as you are adding them to a combo box.<br /><br />For the size problem, I have no idea what could be wrong, it might be a buffer thing make sure TBUFFER is large enough to hold the string. I have found that XP is very picky about buffer sizes and will occasionally gpf where 2K and 9x will not. If not maybe try to send a CB_INITSTORAGE message with the number of bytes in the file before you start adding the items, could be that there is not enough storage in the combobox.</div>
    <div class="meta">Posted on 2003-08-01 12:48:15 by donkey</div>
   </div>
  </div>
 </body>
</html>