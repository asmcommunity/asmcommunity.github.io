<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>.BREAK .IF (!eax) - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=16202" />
  <link rel="prev" href="../?id=16202&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=16202">.BREAK .IF (!eax)</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=16202&amp;page=1" style="">&laquo;</a><a href="../?id=16202&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="16202" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-126140">
    <div class="subject"><a href="#post-126140">.BREAK .IF (!eax)</a></div>
    <div class="body">Phase Verocity,<br />DBUG is just a flag defined previously, and determines whether you want the debug code assembled or not.  After the program works OK, I usually turn off the debug code.  My example was meant to be a code snippet,  not a whole functioning program.  Lots of things are not shown.  A user defined window MUST be registered to specify the WINPROC. That code is missing from the snippet.  Also missing but still referenced is the WINMAIN structure, the BYTER macro function, and the code that shows the registers ESI, EBP being loaded.   I especially wanted to show the GetMessage loop and how it exits when the return is zero or less than zero.  Notice how much easier it is to read when the code is indented.  If you need to push a parameter more than once, try to use a register.  Only one byte of code to push a register.   I believe stack frames and the Proc directive are evil.  Just my opinion and available if you ask.  If you want to see the whole program, let me know.  Will reply if you have any other questions.  Ratch</div>
    <div class="meta">Posted on 2003-12-01 10:58:11 by Ratch</div>
   </div>
   <div class="post" id="post-126141">
    <div class="subject"><a href="#post-126141">.BREAK .IF (!eax)</a></div>
    <div class="body">Yep, I would love to look at the code.  I'm a newbie so anything to feed on is good for me.</div>
    <div class="meta">Posted on 2003-12-01 11:03:44 by Phase Verocity</div>
   </div>
   <div class="post" id="post-126161">
    <div class="subject"><a href="#post-126161">.BREAK .IF (!eax)</a></div>
    <div class="body">Okay, I've figured out what you were saying and implemented it into the code.. the sectoin is now debugable :alright: <br /><br />There is one thing that is buggin me but.. I couldn't understand the byter thing you did with the messagebox.. I tried it so that I wouldn't need extra variable space but it didn't work for me :rolleyes: <br /><br />here is the code.. I also used the IFDEF function so that I wouldn't need the extra variable space for the debug option if I didn't use it. i.e. I'll just comment it out.  <br /><br />I have fully commented it as far as I can tell how it works.  I will put it up in seperate thread in case anyone wants to see it.<br /><br /><pre><code><br />.386                                 ;This is the Machine type<br />.model flat,stdcall             ;This is the syntax to use for calls<br />option casemap&#58;none      ;This allows the keys to be case sensitive<br /><br /><br />include windows.inc         ;various include bits<br />include kernel32.inc<br />include user32.inc<br />includelib kernel32.lib       ;and there associated libraries<br />includelib user32.lib<br /><br /><br />;have to define the prototype before calling it as a procedure.<br />WinMain proto &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD  <br /><br />.CONST ;numerical variables that don't change.<br />;	DBUG equ 1  ;we uncomment this to run debug instructions on the program<br /><br />.DATA<br /><br />		AppName db &quot;An Application&quot;,0                         ;String variables that don't change<br />		ClassName db &quot;A Class Name&quot;,0                       ;always finish with a terminating 0 as <br />		ErrorHandle db &quot;Incorrect Parent Handle&quot;,0      ;it is in ascii format<br />		ErrorMsgBoxTitle db &quot;Critical Error&quot;,0<br />		ErrorWindow db &quot;Could not create or update the window&quot;,0<br />.DATA?<br /><br />		hInstance HINSTANCE ?     ;strings that change<br />		CommandLine LPSTR ?<br /><br />.code                ;start of code section<br /><br />start&#58;                ;our first label<br /><br />		invoke GetModuleHandle,NULL   ;grab the handle for our module<br />		mov hInstance,eax                     ;put it into hInstance<br />		invoke GetCommandLine            ;grab the command line<br />		mov CommandLine,eax               ;put it in CommandLine<br />		invoke WinMain,hInstance,NULL,CommandLine,SW_SHOWDEFAULT  ;invoke our procedure<br />		invoke ExitProcess,eax               ;then exit<br /><br /><br />;this is the beginning of our procedure<br />WinMain proc hInst&#58;HINSTANCE,<br />             hPrevInst&#58;HINSTANCE,<br />             CmdLine&#58;LPSTR,<br />             CmdShow&#58;DWORD<br /><br /><br />LOCAL wc&#58;WNDCLASSEX  ;set up local variables.  wc is our windows class, msg is the messenger variable <br />LOCAL msg&#58;MSG               ;and hWnd is the handle of our Main Window.<br />LOCAL hWnd&#58;HWND<br /><br />		mov wc.cbSize,SIZEOF WNDCLASSEX               ;set the variables for the wc class<br />		mov wc.style,CS_HREDRAW+CS_VREDRAW<br />		mov wc.lpfnWndProc,OFFSET WinProc<br />		mov wc.cbClsExtra,NULL<br />		mov wc.cbWndExtra,NULL<br />		push hInstance<br />		pop wc.hInstance<br />		invoke LoadIcon,NULL,IDI_APPLICATION<br />		mov wc.hIcon,eax<br />		mov wc.hIconSm,eax<br />		invoke LoadCursor,NULL,IDC_ARROW<br />		mov wc.hCursor,eax<br />		mov wc.hbrBackground,COLOR_WINDOW+1<br />		mov wc.lpszMenuName,NULL<br />		mov wc.lpszClassName,OFFSET ClassName<br />		invoke RegisterClassEx,addr wc                           ;register our class<br />                invoke CreateWindowEx,                                     ;begin the creation of the window<br />				NULL,                            ;this will give us our window handle<br />				ADDR ClassName,<br />				ADDR AppName,<br />				WS_OVERLAPPEDWINDOW,<br />				CW_USEDEFAULT,<br />				CW_USEDEFAULT,<br />				CW_USEDEFAULT,<br />				CW_USEDEFAULT,<br />				NULL,<br />				NULL,<br />				hInst,<br />				NULL <br />		mov hWnd,eax                                                   ;place the handle in hWnd<br />		invoke ShowWindow,hWnd,SW_SHOWNORMAL  ;make the window visible <br />		invoke UpdateWindow,hWnd                              ;keep the window refreshed<br />                                                                                          ;**** The window doesn't display if the procedure is not running<br /><br />	IFDEF DBUG ;This section is only attached to the code if the DBUG variable is defined. ;debug section only<br />                                                                                                                                 ;used to check for errors<br />  		.IF !EAX                                ;execute next instruction if there was an error creating the window<br />    		INVOKE MessageBox,ESI,addr ErrorWindow,addr ErrorMsgBoxTitle,MB_OK ;message and exit if failure<br />    		JMP EXIT           ;after creating a notification box we jump to the exit<br />  		.ENDIF<br /><br />	ENDIF                 ;not that the . in front of IF means it is run at run time.  No . means it is run at assembly time<br /><br />	.WHILE TRUE         ;enter the message loop<br /><br />			invoke GetMessage,addr msg,NULL,0,0  ;get our message. usually wm_paint first up.<br /><br />	IFDEF DBUG   ;more debug script.. only gets assembled if we create the variable DBUG<br />		.IF eax==-1       ;another way of checking for values.  check to see if eax is -1<br />			invoke MessageBox, NULL,addr ErrorHandle,addr ErrorMsgBoxTitle, MB_OK		<br />    		JMP EXIT      ;invoke a message box and exit<br />    	                   .ENDIF<br />	ENDIF ;end of our debug section which was used to check if there was an error in the window handle.<br /><br />		.BREAK .IF &#40;!EAX&#41;  ;this is realtime code.. breaks the loop if eax is 0.  i.e. program is finished.<br />			invoke TranslateMessage, ADDR msg  ;translate message to ansi code.<br />			invoke DispatchMessage, ADDR msg   ; dispatch the message and run the procedure<br />			mov eax,msg.wParam  ;load the message for the exit process<br />	 	.ENDW ;I'm not sure if this is how the procedure is run.. i'm just guessing at present.<br />EXIT&#58; ;our exit label.. so that we can jump to the end of the loop if there is an error.<br />	ret ;return to the calling function.. i.e.  top of this program after invoke WinMain.  The next line is invoke exitprocess<br /><br />WinMain endp ;the end of our WinMain procedure.. this probably never really gets executed.<br /><br />WinProc proc hWnd&#58;HWND,uMsg&#58;UINT,wParam&#58;WPARAM,lParam&#58;LPARAM  ;the start of the window procedure<br /><br />	.IF uMsg==WM_DESTROY ;if we got the exit message from getmessage in WinMain.<br />		invoke PostQuitMessage,NULL ;then we invoke the quitmessage grabber<br />	.ELSE ;otherwise we run the default window cleaning stuff which takes care of all the <br />		invoke DefWindowProc,hWnd,uMsg,wParam,lParam  ;other messages.<br />		ret  ;then we return to WinMain.. <br />	.ENDIF ;if we use post quitmessage we will end up here to exit the loop.<br /><br />xor eax,eax ;after recieving the post quit message, we execute a zero out of eax.  I.E. this makes it 0<br /><br />ret ;then we return control to WinMain So that it can exit, because it has a 0 message.<br /><br />WinProc endp  ;this is just the end of the procedure<br /><br />end start  ;and this is the end of our program, that displayed a window.<br /></code></pre></div>
    <div class="meta">Posted on 2003-12-01 13:04:41 by Phase Verocity</div>
   </div>
   <div class="post" id="post-126169">
    <div class="subject"><a href="#post-126169">.BREAK .IF (!eax)</a></div>
    <div class="body">Phase Verocity,<br /><div class="quote">There is one thing that is buggin me but.. I couldn't understand the byter thing you did with the messagebox.. I tried it so that I wouldn't need extra variable space but it didn't work for me  </div> <br />As I said in the previous post, BYTER is a function that is referenced but not defined.  It IS defined in the enclosed ZIP file.<br /><div class="quote">here is the code.. I also indented it so you can read it but my indenting isn't showing up in this message for some reason. I also used the IFDEF function so that I wouldn't need the extra variable space for the debug option if I didn't use it. i.e. I'll just comment it out.</div> <br />You need to put your code between &quot;left bracket&quot;CODE&quot;right bracket&quot; ..your code here..&quot;left bracket&quot;/CODE&quot;right bracket&quot; markers on this newsgroup to preserve spacing.  Use the Preview Reply function to see what it looks like.  Forget about IFDEF in this program. DBUG is defined.<br /><br />Be sure to read Readme.txt in the ZIP file.  Down with procs and stack frames!  Ratch</div>
    <div class="meta">Posted on 2003-12-01 13:50:51 by Ratch</div>
   </div>
   <div class="post" id="post-126170">
    <div class="subject"><a href="#post-126170">.BREAK .IF (!eax)</a></div>
    <div class="body">Phase Verocity,<br />I don't know why the ZIP file did not transfer with my last post.  Here's trying it again. Ratch</div>
    <div class="meta">Posted on 2003-12-01 13:52:47 by Ratch</div>
   </div>
   <div class="post" id="post-126184">
    <div class="subject"><a href="#post-126184">.BREAK .IF (!eax)</a></div>
    <div class="body">Thanks Ratch, I'm looking through it now.</div>
    <div class="meta">Posted on 2003-12-01 15:55:10 by Phase Verocity</div>
   </div>
   <div class="post" id="post-126348">
    <div class="subject"><a href="#post-126348">.BREAK .IF (!eax)</a></div>
    <div class="body">Phase Verocity,<br />I have to apologize for including a bum file with the last ZIP I sent you.  The file is Callback.inc.  It is  the WINPROC routine and it is not reentrant code because it stores EDI in a global storage.  I have updated it to make it smaller, faster, reentrant, and more straightforward.  If you have any questions about it, just ask.  Ratch</div>
    <div class="meta">Posted on 2003-12-02 21:59:57 by Ratch</div>
   </div>
   <div class="post" id="post-126353">
    <div class="subject"><a href="#post-126353">.BREAK .IF (!eax)</a></div>
    <div class="body">actually I had assembled it, I just had to comment out a true definition of -1 in you're personal own include file.. I thought it was a little funny that you put a whole lot of variables in the main section and nearly no code, but that just gave me more idea's, and that is really what I am looking for at the moment.  I have learn't so much in the last couple of days and remembered so much from my olden days that i'd almost stop calling myself a newbie soon.  I loved the opcode tables I found in the intel's programming manual vol. 2.  I figured they might make a good start to creating a debugger, seeing as how I haven't found any descent ones so far myself.  Anyway this is a bit past the scope of this subject so I'll just say<br /><br />thankyou to everyone who has replied to it.. <br /><br />I'm now starting to look at tutorial 4.  Its pretty much the same except that he uses some paint structures.</div>
    <div class="meta">Posted on 2003-12-02 23:32:01 by Phase Verocity</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=16202&amp;page=1" style="">&laquo;</a><a href="../?id=16202&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="16202" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>