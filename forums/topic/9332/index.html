<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>predefined structures - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=9332" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=9332">predefined structures</a></p>
   <div class="post" id="post-68890">
    <div class="subject"><a href="#post-68890">predefined structures</a></div>
    <div class="body">Today I've got an idea of some maybe a little complex, but very interesting way to define Win32 structures. Here's an example of WNDCLASSEX structure macro:<br /><pre><code><br />macro struc_setting field,setting<br /> &#123;<br />   field equ<br />   if ~setting eq<br />   if _#setting eq _#field setting<br />   value equ setting<br />   restore field<br />   defined.#field = value<br />   restore value<br />   end if<br />   end if<br /> &#125;<br /><br />struc WNDCLASSEX &#91;param&#93;<br /> &#123; common<br />     if param eq ?<br />      .cbSize        dd ?<br />      .style         dd ?<br />      .lpfnWndProc   dd ?<br />      .cbClsExtra    dd ?<br />      .cbWndExtra    dd ?<br />      .hInstance     dd ?<br />      .hIcon         dd ?<br />      .hCursor       dd ?<br />      .hbrBackground dd ?<br />      .lpszMenuName  dd ?<br />      .lpszClassName dd ?<br />      .hIconSm       dd ?<br />     else<br />      defined.cbSize        = .size<br />      defined.style         = 0<br />      defined.lpfnWndProc   = 0<br />      defined.cbClsExtra    = 0<br />      defined.cbWndExtra    = 0<br />      defined.hInstance     = 400000h<br />      defined.hIcon         = 0<br />      defined.hCursor       = 0<br />      defined.hbrBackground = COLOR_WINDOW+1<br />      defined.lpszMenuName  = 0<br />      defined.lpszClassName = 0<br />      defined.hIconSm       = 0<br />   forward<br />      struc_setting cbSize,param<br />      struc_setting style,param<br />      struc_setting lpfnWndProc,param<br />      struc_setting cbClsExtra,param<br />      struc_setting cbWndExtra,param<br />      struc_setting hInstance,param<br />      struc_setting hIcon,param<br />      struc_setting hCursor,param<br />      struc_setting hbrBackground,param<br />      struc_setting lpszMenuName,param<br />      struc_setting lpszClassName,param<br />      struc_setting hIconSm,param<br />   common<br />      .cbSize        dd defined.cbSize<br />      .style         dd defined.style<br />      .lpfnWndProc   dd defined.lpfnWndProc<br />      .cbClsExtra    dd defined.cbClsExtra<br />      .cbWndExtra    dd defined.cbWndExtra<br />      .hInstance     dd defined.hInstance<br />      .hIcon         dd defined.hIcon<br />      .hCursor       dd defined.hCursor<br />      .hbrBackground dd defined.hbrBackground<br />      .lpszMenuName  dd defined.lpszMenuName<br />      .lpszClassName dd defined.lpszClassName<br />      .hIconSm       dd defined.hIconSm<br />      .size = $-.cbSize<br />     end if &#125;<br /></code></pre><br />This macro can be used in three ways. If you use it without any parameters:<br /><pre><code><br />wc WNDCLASSEX<br /></code></pre><br />it will define the structure with fields filled with default values. If you use &quot;?&quot; parameter:<br /><pre><code><br />wc WNDCLASSEX ?<br /></code></pre><br />the structure will have undefined fields (this is the one you can put in .udata section). And finally you can define any fields you want with your values like in this example:<br /><pre><code><br />wc WNDCLASSEX,\<br />     lpfnWndProc WndProc,\<br />     cbWndExtra 4<br /></code></pre><br />It fills wc.lpfnWncProc with address of WndProc and wc.cbWndExtra with dword 4.<br /><br />If anyone finds this method useful, we can make a small program for converting standard structure macros (or MASM structure definitions) into this kind of stuff.</div>
    <div class="meta">Posted on 2002-12-03 16:30:04 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-68893">
    <div class="subject"><a href="#post-68893">predefined structures</a></div>
    <div class="body">Another variant:<br /><pre><code><br />macro struc_setting field,setting<br /> &#123;<br />   field equ<br />   if ~ &lt;setting&gt; eq &lt;&gt;<br />   if &lt;_#setting&gt; eq &lt;_#field setting&gt;<br />   value equ setting<br />   restore field<br />   defined.#field value<br />   restore value<br />   end if<br />   end if<br /> &#125;<br /><br />struc WNDCLASSEX &#91;param&#93;<br /> &#123; common<br />     if &lt;param&gt; eq &lt;?&gt;<br />      .cbSize        dd ?<br />      .style         dd ?<br />      .lpfnWndProc   dd ?<br />      .cbClsExtra    dd ?<br />      .cbWndExtra    dd ?<br />      .hInstance     dd ?<br />      .hIcon         dd ?<br />      .hCursor       dd ?<br />      .hbrBackground dd ?<br />      .lpszMenuName  dd ?<br />      .lpszClassName dd ?<br />      .hIconSm       dd ?<br />     else<br />      defined.cbSize        = .size<br />      defined.style         = 0<br />      defined.lpfnWndProc   = 0<br />      defined.cbClsExtra    = 0<br />      defined.cbWndExtra    = 0<br />      defined.hInstance     = 400000h<br />      defined.hIcon         = 0<br />      defined.hCursor       = 0<br />      defined.hbrBackground = 0<br />      defined.lpszMenuName  = 0<br />      defined.lpszClassName = 0<br />      defined.hIconSm       = 0<br />   forward<br />      struc_setting cbSize,param<br />      struc_setting style,param<br />      struc_setting lpfnWndProc,param<br />      struc_setting cbClsExtra,param<br />      struc_setting cbWndExtra,param<br />      struc_setting hInstance,param<br />      struc_setting hIcon,param<br />      struc_setting hCursor,param<br />      struc_setting hbrBackground,param<br />      struc_setting lpszMenuName,param<br />      struc_setting lpszClassName,param<br />      struc_setting hIconSm,param<br />   common<br />      .cbSize        dd defined.cbSize<br />      .style         dd defined.style<br />      .lpfnWndProc   dd defined.lpfnWndProc<br />      .cbClsExtra    dd defined.cbClsExtra<br />      .cbWndExtra    dd defined.cbWndExtra<br />      .hInstance     dd defined.hInstance<br />      .hIcon         dd defined.hIcon<br />      .hCursor       dd defined.hCursor<br />      .hbrBackground dd defined.hbrBackground<br />      .lpszMenuName  dd defined.lpszMenuName<br />      .lpszClassName dd defined.lpszClassName<br />      .hIconSm       dd defined.hIconSm<br />      .size = $-.cbSize<br />     end if &#125;<br /></code></pre><br />And then:<br /><pre><code><br />wc WNDCLASSEX,\<br />     lpfnWndProc = WndProc,\<br />     cbWndExtra = 4<br /></code></pre><br /><br />You won't believe how incredible playing with own program sometimes is. ;) :grin:</div>
    <div class="meta">Posted on 2002-12-03 16:38:08 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-68895">
    <div class="subject"><a href="#post-68895">predefined structures</a></div>
    <div class="body">Everytime you play we get more toys! :alright:</div>
    <div class="meta">Posted on 2002-12-03 16:51:38 by bitRAKE</div>
   </div>
   <div class="post" id="post-68897">
    <div class="subject"><a href="#post-68897">predefined structures</a></div>
    <div class="body">woow this is nice. :alright: I wish I had the time to explore FASMs macro capabilities. :)</div>
    <div class="meta">Posted on 2002-12-03 16:59:44 by stryker</div>
   </div>
   <div class="post" id="post-70066">
    <div class="subject"><a href="#post-70066">predefined structures</a></div>
    <div class="body">The MASM32 by Hutch has a good file of API-definition (WINDOWS.INC). It was <br />rather well to convert automatically him for the use in FASM, taking into account <br />foregoing.  :cool: <br />Certainly, from Hutch permission.<br />Thank You.</div>
    <div class="meta">Posted on 2002-12-09 11:54:24 by tserk</div>
   </div>
  </div>
 </body>
</html>