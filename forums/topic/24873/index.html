<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>calling methods in objects in dll's - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=24873" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=24873">calling methods in objects in dll's</a></p>
   <div class="post" id="post-181688">
    <div class="subject"><a href="#post-181688">calling methods in objects in dll's</a></div>
    <div class="body">Is there a way to directly call methods of objects that are located in a dll like functions are called?<br />I put together a dll to try and test this.<br />the .asm listing:<br /><pre><code>;========================================================================================<br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  Object Compilation Control File&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;<br />;========================================================================================<br />;&nbsp;  Title: OADllTest.asm<br />;&nbsp; Author:&nbsp; <br />; Version: 1.0.0<br />; Purpose: ObjAsm32 compilation control file for:OADllTest object<br />;&nbsp;  Notes:&nbsp; <br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; This is just for testing of making a dll using OA32<br />;========================================================================================<br />%include @Environ(OA32_PATH)\\Code\\Macros\\Model.inc&nbsp; &nbsp; &nbsp;  ;Include &amp; initialize standard modules<br />SysSetup OOP_WINDOWS;, DEBUG(WND, &quot;ResGuard&quot;)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Loads OOP files and OS related objects<br />include user32.inc<br />include OADllTest.inc<br /><br /><br />DllMain proc public hDllInstance:Handle, dReason:dword, dReserved:dword<br />&nbsp; &nbsp; mov eax, dReason<br />&nbsp; &nbsp; .if eax == DLL_PROCESS_ATTACH<br />&nbsp; &nbsp; &nbsp; SysInit hDllInstance<br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; .elseif eax == DLL_PROCESS_DETACH<br />&nbsp; &nbsp; &nbsp; SysDone<br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; .endif<br />&nbsp; &nbsp; xor eax, eax<br />&nbsp; &nbsp; inc eax<br />&nbsp; &nbsp; ret<br />DllMain endp<br /><br />; just a test function<br />TestFunc PROC pOwner:Pointer<br />&nbsp;  <br />&nbsp; &nbsp; LOCAL pObj1:Pointer<br />&nbsp; &nbsp; mov pObj1, $New(OADllTest)<br />&nbsp; &nbsp; OCall pObj1::OADllTest.Init, pOwner<br />&nbsp; &nbsp; OCall pObj1::OADllTest.TestMethod<br />&nbsp; &nbsp; Destroy pObj1<br />&nbsp; &nbsp; ret<br />TestFunc endp<br />end DllMain</code></pre><br /><br />The object include file:<br /><pre><code><br />;===================================================================<br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Object Implementation File&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;<br />;===================================================================<br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;<br />;-------------------------------------------------------------------;<br />;&nbsp;  Title: OADllTest<br />;&nbsp; Author: <br />; Version: 1.0.0<br />; Purpose:<br />;&nbsp;  Notes: just a test object<br />;------------------------------------------------------------------;<br />OADllTestID EQU 35000<br /><br />Object OADllTest, OADllTestID, Primer<br />&nbsp; &nbsp; StaticMethod TestMethod<br />ObjectEnd<br />;------------------------------------------------------------------;<br />;&nbsp; Method Implentation<br />;------------------------------------------------------------------;<br />; Method:&nbsp; &nbsp; OADllTest.TestMethod<br />; Purpose:&nbsp;  just a method to test object by calling a messagebox<br />; Arguments:<br />; Return:&nbsp; &nbsp; <br /><br />Method OADllTest.TestMethod, uses esi<br />&nbsp; &nbsp; SetObject esi<br />&nbsp; &nbsp; @invoke MessageBox,NULL ,&quot;this is a dll test message box&quot; ,&quot;dll test&quot; ,MB_OK<br />MethodEnd<br /></code></pre><br /><br />And the .def file:<br /><pre><code>LIBRARY&nbsp;  OADllTest<br />EXPORTS <br />&nbsp; &nbsp; &nbsp; &nbsp; TestFunc<br /></code></pre><br />I can call it with this code and it works fine.<br /><pre><code><br />__TestFunc typedef proto pOwner:Pointer<br /> _TestFunc typedef PTR __TestFunc<br /> <br /> .data?<br /> TestFunc _TestFunc ?<br />--------<br />-------<br />--------<br />&nbsp; &nbsp; &nbsp; &nbsp; @invoke LoadLibrary,&quot;OADllTest.dll&quot;<br />&nbsp; &nbsp; 	 mov pDll, eax<br />&nbsp;  	 invoke GetProcAddress,pDll,offset szTestFunc<br />&nbsp; &nbsp; 	 mov TestFunc, eax<br />&nbsp; &nbsp; &nbsp; &nbsp;  INVOKE TestFunc, esi <br />&nbsp; &nbsp; 	 invoke FreeLibrary,pDll<br /><br /></code></pre><br />Is there a way to call the method &#39;OADllTest.TestMethod&#39; directly without having to call it from another function in the dll?<br />I tried to put the method in the def file but I got unresolved external error. Thanks<br />Rags</div>
    <div class="meta">Posted on 2006-06-13 13:05:32 by rags</div>
   </div>
   <div class="post" id="post-181739">
    <div class="subject"><a href="#post-181739">Re: calling methods in objects in dll's</a></div>
    <div class="body"><br />Yes and no.<br />I created a project some time ago that contained objects in the exe, as well as objects in TWO DLLS, one of which loaded the other.. ouch!<br /><br />Basically I handled things similarly to you:<br />I exported a small function which created an instance of the object, like you did.<br />But I just returned the object pointer to the caller, who could then use it to call methods (and was responsible for destroying the object).<br /><br />The executable needed to know &#39;what the object definition looked like&#39; (so it could make method calls), but it did not require the CODE from that object.<br />I asked Biterider how best to handle this (I didn&#39;t want code to bloat my modules when it was duplicated in some DLL), and he reminded me about the IMPLEMENT switch that exists in all the standard OA32 object sources.. basically, it&#39;s possible to include &#39;an object&#39;s MethodTable Template&#39; in a project without necessarily including the CODE for that Object.. however I believe he&#39;s implemented some macros and/or switches especially for this in the 1.3e release, you&#39;d be best to check the Objects macro file and/or ask Biterider and/or someone else who&#39;s done this more recently.<br /><br /><br /></div>
    <div class="meta">Posted on 2006-06-14 01:19:44 by Homer</div>
   </div>
   <div class="post" id="post-182451">
    <div class="subject"><a href="#post-182451">Re: calling methods in objects in dll's</a></div>
    <div class="body">Homer,<br />Just wanted to give an update on my progress.<br />Well, I&#39;ve contacted Biterider, and he said he will come up with a demo, but he&#39;s real busy right now. He mentioned the use of VirtualObjects macro. So while I am waiting for the demo I decided to play around with the virtualobjects macro.<br />I placed the VirtualObjects macro in the compilation control file of the test app with the other MakeObjects/LoadObjects macros, ie:<br /><pre><code><br />LoadObjects SdiApp<br />VirtualObjects DllTestObj<br /></code></pre><br />Then I changed the exported function of the DLL to a small func that just creates a new instance of the dlls&#39; object, and returns a pointer to it to the caller.<br />Doing this I was able to directly call the methods of the dlls&#39;&nbsp; objects using the OCall macro like this:<br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OCall pDllObj::OADllTest.Init, esi&nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OCall pDllObj::DllTestObj.TestMethod<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OCall pDllObj::DllTestObj.MethodTwo<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OCall pDllObj::DllTestObj.MethodThree</code></pre><br />Then I destroyed that object from the caller using its pointer.<br />On the surface it seems to work. Though I&#39;m probably missing something along the way.<br />Rags</div>
    <div class="meta">Posted on 2006-06-24 20:27:45 by rags</div>
   </div>
   <div class="post" id="post-182878">
    <div class="subject"><a href="#post-182878">Re: calling methods in objects in dll's</a></div>
    <div class="body">Nope, you&#39;re not missing a thing - you&#39;ve got it :)<br />Just remember to always Destroy anything you Create and all is well !</div>
    <div class="meta">Posted on 2006-07-04 00:20:52 by Homer</div>
   </div>
   <div class="post" id="post-182908">
    <div class="subject"><a href="#post-182908">Re: calling methods in objects in dll's</a></div>
    <div class="body">Hi<br />Here is the promised Demo. I have not forgotten it! <br />Demo14 is build based on the objects of Demo01. I put these objects in a DLL and have written 2 procedures to create the object instances of TriangleShape and RectangleShape.<br />The main application loads the DLL and creates a TriangleShape, calculates its area and finally disposes it.<br /><br />The technique is easy to implement if you use the provided macros that set the internal switches to the proper values.<br /><br />Regards,<br /><br />Biterider<br /></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=1789" target="_blank">Demo14.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2006-07-04 13:20:21 by Biterider</div>
   </div>
  </div>
 </body>
</html>