<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Need help with something I'm sure is simple - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=1647" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=1647">Need help with something I'm sure is simple</a></p>
   <div class="post" id="post-10506">
    <div class="subject"><a href="#post-10506">Need help with something I'm sure is simple</a></div>
    <div class="body">Hello. I have been trying to seperate a little skeleton program into different source files, but I keep getting a linking error...<br /><br />DirectX.obj : error LNK2001: unresolved external symbol _WinMain@16<br /><br />I know what the error means, I just don't know how to fix it. I tried searching on the forum, but I couldn't find an example of someone putting WinMain and WinProc in seperate files outside the main program.  I would really appreciate it if someone could take a look at the code (Maybe a total of 100 lines) and tell me what I am doing wrong. Thanks a lot for any help.</div>
    <div class="meta">Posted on 2001-10-28 19:52:36 by AlexEiffel</div>
   </div>
   <div class="post" id="post-10507">
    <div class="subject"><a href="#post-10507">Here is mine</a></div>
    <div class="body">Hi<br /><br />here is our (Hostile Encounter) testing pad main programm.<br />its TASM oriented but it works the same for MASM, just ignore the TASM stuff :)<br /><br />There are lots of things here (its a big testing pad) but you can see how we split our project into multiple files in the includes section<br /><br />I was going to give this game making testing pad away for free in my RTS tutorials anyway...until then <br /><br /><pre><code><br />;********************************************<br />;<br />;	jocxxx.ASM for TESTING<br />;<br />;********************************************<br /><br />;	Assembler specific instructions for 32 bit ASM code<br /><br />.386			; minimum processor needed &#58;&#41;<br /><br />;================================<br />; TASM stuff<br />;================================<br />locals<br />nosmart<br />nojumps<br /><br /><br />;===========================================<br />;<br />; FLAT memory model and<br />; STDCALL  calling conventions<br />;<br />; used for&#58;<br />;======================<br />; all segments default to 32 bits<br />; all called procedures must clear the stack before exit<br />; params are pushed in right to left order &#40;reverse of reading&#41;	<br />;===========================================<br /><br />.model flat, STDCALL	<br />;==================================================<br />; TASM stuff<br />; activates a lots of  MASM styles and gadgets<br />; like @@&#58; temp labels<br />;==================================================<br />	quirks<br />	masm51<br /><br />;==========================================<br />;	ALL CODE IS CASE SENZITIVE!<br />;	win32api is anyway<br />;	option given directly to assembler&#58; /ml<br />;<br />; below option is for MASM only<br />;	option casemap &#58;none	<br />;==========================================<br /><br /><br />;*****************************************************<br />;	ALL LIBS WE USE TO LINK ARE HERE<br />;<br />; can also be given to linker comandline<br />; at link time, but comandline has a fixed length<br />; not funny if u link to many libs<br />; also much easy to keep track of them here &#58;&#41;<br />;******************************************************<br /><br />includelib	.\libs\import32.lib<br />includelib	.\libs\ddraw.lib<br />includelib	.\libs\dinput.lib<br />includelib	.\libs\dsound.lib<br />includelib	.\libs\dxguid.lib<br />includelib	.\libs\dplayx.lib<br /><br /><br /><br /><br /><br />;---------------------------------------------------------------------<br />; 1. szText<br />; A macro to insert TEXT into the code section for convenient and <br />; more intuitive coding of functions that use byte data as text.<br />;---------------------------------------------------------------------<br />szText MACRO Name, Text&#58;VARARG<br />	LOCAL lbl<br />	jmp lbl<br />		Name db Text,0<br />	lbl&#58;<br />ENDM<br /><br /><br /><br />;***********************************************<br />;	INCLUDES START HERE<br />;***********************************************<br /><br />;----------------------------------------------<br />; Win 32 Stuff<br />;----------------------------------------------<br />	include 	.\win32stuff\win32api_constants.asm<br />;--------------------------------------------<br />; most API external functions declared here<br />;--------------------------------------------<br />	include		.\win32stuff\extern.inc<br /><br />	include		.\win32stuff\win_main_setup.asm<br />	include		.\win32stuff\win_main_callback.asm<br />;----------------------------------------------------<br />; Multi Threading stuff<br />;----------------------------------------------------<br />	include		.\threads\thread_flip.asm<br />	include		.\threads\thread_paint.asm<br />;-------------------------------<br />; Clean Up <br />;--------------------------------<br />	include		.\cleanup\ExitGame.asm<br /><br /><br />;-------------------------------------------------------<br />; DIRECT DRAW FILES<br />;-------------------------------------------------------<br />	include 	.\ddraw\Direct_Draw_Include.asm<br />	INCLUDE		.\ddraw\DIRECT_DRAW_INIT.ASM<br />	INCLUDE		.\ddraw\DIRECT_DRAW_CORE.ASM<br />;--------------------------------------------------------<br />; DIRECT INPUT FILES<br />;--------------------------------------------------------<br />	include		.\dinput\direct_input_include.asm<br />	include		.\dinput\direct_input_init.asm<br />;---------------------------------------------------------<br />; direct sound structures and ecuates are here<br />;---------------------------------------------------------<br />	include		.\dsound\direct_sound_include.asm<br /><br />;-------------------------------------------<br />; UTILITY FUNCTIONS<br />;-------------------------------------------<br />	include		.\utils\UTIL.ASM<br />	include		.\utils\bmps_loops.asm<br /><br />;-------------------------------------------------<br />; MMX equates and macros for TASM<br />; just in case we will ever use them<br />;-------------------------------------------------<br />;	.\utils\include	ibmmx.inc<br /><br />;------------------------------------<br />; GraFiX<br />;------------------------------------<br />	include		.\gfx\util_gfx.asm<br />	include		.\gfx\colors.asm<br />	include		.\gfx\paint_text.asm<br />	include		.\gfx\paint_text001.asm<br />	include		.\gfx\paint_manually.asm<br />	include		.\gfx\paint_bground.asm<br /><br />;-------------------------------------------------<br />; Lightening<br />;-------------------------------------------------<br />	include		.\fulger\draw_line.asm<br />	include		.\fulger\draw_fulger.asm<br /><br />;-------------------------------------------------<br />; INTRO<br />;-------------------------------------------------<br />	include 	.\gfx\paint_intro.asm<br />;-------------------------------------------------<br />;	Keyboard and Mouse<br />;-------------------------------------------------<br />	include		.\mouse\mouse.asm<br /><br />	include		.\keyboard\keyboard.asm<br />	include		.\keyboard\edit_line.asm<br /><br /><br />;============================================<br />;RLE TEST<br />;============================================<br />	include .\rle\rle_main.asm<br /><br />;------------------------------------<br />; Loads of bitmaps, sounds etc<br />;------------------------------------<br />	include		.\loads\load_bmp_fonts.asm<br />	include		.\loads\load_bmp_galaxy.asm<br /><br /><br /><br />;------------------------------------<br />; GUI Tests<br />;------------------------------------<br />include			.\gui\gui_main.asm<br /><br />;*******************************************************<br />;	END of INCLUDES<br />;*******************************************************<br /><br /><br /><br />;===================================================<br />; some main vars for game and application<br />;===================================================<br />.data<br />	contor			dd	0	; main frame counter<br />	game_is_on		dd	0		<br />	surface_is_lost		dd	0		;we have to restore<br />	game_is_paused		dd	0		;no moving<br />;---------------------------------------------<br />;	1=stop the windows msg loop<br />;---------------------------------------------<br />	flag_no_messages	dd	0		<br />.code<br /><br /><br />;*********************************************<br />; 	MAIN PROGRAM ENTRY POINT<br />;	linker will jump us here<br />;*********************************************<br /><br /><br />Start&#58;<br /><br />;===========================================<br />;   get the module handle for this instance<br />;===========================================<br />	mov	eax,0			;NULL<br />	push	eax<br />	call	GetModuleHandleA<br />	mov	&#91;hinstmain&#93;, eax	; and store it<br /><br /><br />.data<br />	sz001	db	&quot;001=HE TestPad Started&quot;,13,10,0<br />.code<br />	call	OutputDebugStringA,offset sz001<br /><br /><br /><br /><br />.data<br />	ALIGN	4<br />	csection_flip	RTL_CRITICAL_SECTION	&lt;0&gt;<br /><br />	ALIGN	4<br />	csection_paint	RTL_CRITICAL_SECTION	&lt;0&gt;<br />.code<br /><br />;====================================================<br />; Initialize critical section for the Flip thread<br />;====================================================<br /><br /><br />.data<br />	sz002	db	&quot;Init Critical Sections Started&quot;,13,10,0<br />.code<br /><br />	call	OutputDebugStringA,offset sz002<br /><br />	mov	eax,offset csection_flip<br />	push	eax<br />	call	InitializeCriticalSection<br /><br />;=====================================================<br />; initialize critical section for paint thread<br />;=====================================================<br />	mov	eax,offset csection_paint<br />	push	eax<br />	call	InitializeCriticalSection<br /><br /><br /><br />;=========================================================<br />; setup main <br />;	-register main window class<br />;	-create main window <br />;	-show main window<br />;=========================================================<br /><br />.data<br />	sz003	db	&quot;Win Main Setup Started&quot;,13,10,0<br />.code<br /><br />	call	OutputDebugStringA,offset sz003<br /><br />	call	Win_Main_Setup<br /><br /><br />;===========================================================<br />; Direct DRAW initialization<br />;	app will go full screen exclusive here<br />;	notice that main message loop has't even started<br />;===========================================================<br /><br />.data<br />	sz004	db	&quot;DirectDraw Setup Started&quot;,13,10,0<br />.code<br /><br />	call	OutputDebugStringA,offset sz004<br /><br /><br />	call	Direct_Draw_Setup<br /><br />;=====================================<br />; clear system ram located back buffer<br />;=====================================<br />;	call	Clear_Back_Back<br /><br /><br />;=====================================<br />; clear video buffer to black<br />;=====================================<br />.data<br />	sz005	db	&quot;Clear Video Buffer&quot;,13,10,0<br />.code<br /><br />	call	OutputDebugStringA,offset sz005<br /><br />	call	Clear_Video_Buffer<br /><br /><br />;=====================================<br />; clear video ram located back buffer<br />;=====================================<br /><br />.data<br />	sz006	db	&quot;Clear Back Buffer&quot;,13,0<br />.code<br /><br />	call	OutputDebugStringA,offset sz006<br /><br />	call	ClearBack<br /><br /><br />;======================================<br />; paint our intro screen instead<br />;======================================<br />	call	paint_intro<br /><br /><br />;=============================<br />; Init Direct input system<br />;===========================<br />	Call	Direct_Input_Init<br /><br /><br /><br />;**********************************<br />; load bitmaps for sprites etc<br />;**********************************<br />	call	load_bmp_mouse<br /><br />	call	load_rle_colector<br />	call	load_rle_selection<br /><br />	call	load_bmp_fonts<br />	call	load_bmp_galaxy<br /><br />	call	init_msg<br /><br />	call	calc_proc_freq<br /><br />;========================================<br />; Setup Threads and start them<br />;========================================<br />	call	Thread_Flip_Setup<br />	mov	&#91;thread_can_flip&#93;,1<br /><br />	call	Thread_Paint_Setup<br />	mov	&#91;thread_can_paint&#93;,1<br /><br /><br />;************************************<br />; WinMain MESSAGE LOOP STARTS HERE<br />;************************************<br /><br />msg_loop&#58;<br /><br />;==========================================================<br />; we use PeekMessage in order to detect idle &#40;no messages&#41;<br />; time we can use<br />;========================================================<br />	push    PM_NOREMOVE<br />;push	PM_REMOVE<br />	push    0<br />	push    0<br />	push    0<br />	push    offset msg<br />	call    PeekMessageA<br /><br />;===============================<br />; test&#58; do we have messages?<br />;==============================<br />	cmp	eax, 0<br />	je	nu_sunt_msg			; happy jump if we dont<br /><br />; ===============================<br />; but no so happy.. <br />; if we have to handle them<br />; ===============================<br />	push	0<br />	push	0<br />	push	0<br />	push	offset msg<br />	call	GetMessageA<br /><br />;===================================<br />; test&#58; is this message  WM_QUIT ?<br />; =================================<br />	cmp	eax,0				; GetMessageA will return zero if it is...?<br />	je	end_loop			; EXIT PROGRAM IF TRUE!!!!<br /><br />;================================================<br />; default action &#40;let windows do it's dirty job&#41;<br />; for all other messages<br />;================================================<br />	push	offset msg<br />	call	TranslateMessage<br /><br />	push	offset msg<br />	call	DispatchMessageA<br /><br />;=========================================<br />; and jump back to do it all over again<br />;======================================<br />	jmp	msg_loop<br /><br />;=================================<br />; Here ENDS Our Program &#40;normaly&#41;<br />;==================================<br />end_loop&#58;<br />	push	&#91;msg.msWPARAM&#93;<br />	call	ExitProcess		;exit to windows<br /><br />;===================================<br />; we should never reach this point<br />; but who knows?<br />;===================================<br />	ret<br /><br /><br />;=========================================<br />; so...there are no win messages....<br />; HERE we do our GAME MAIN LOOP<br />;=========================================<br /><br />nu_sunt_msg&#58;<br />	push    eax			; save that eax stuff<br />	push	ebx<br />	push	ecx<br />	push	edx<br /><br />	push	esi<br />	push	edi<br /><br />;=========================================================<br />; test&#58; is game loop on? <br />; so that in future we dont make useless/dummy/dangerouse<br />; paint to screen/direct draw even on pause....<br />;=========================================================<br /><br />;==================================<br />; just return to WIN message loop<br />;=================================<br /><br />	pop	edi<br />	pop	esi<br /><br />	pop	edx<br />	pop	ecx<br />	pop	ebx<br />	pop	eax			<br /><br /><br />;====================================<br />; return to main Message Loop<br />;====================================<br />	cmp	&#91;flag_no_messages&#93;,1<br />	jz	nu_sunt_msg<br />	jmp	msg_loop<br /><br /><br /><br /><br /><br />;******************************<br />;  END OF PROGRAM TEXT<br />;******************************<br />	end Start<br /></code></pre></div>
    <div class="meta">Posted on 2001-10-28 20:18:52 by BogdanOntanu</div>
   </div>
   <div class="post" id="post-10512">
    <div class="subject"><a href="#post-10512">Need help with something I'm sure is simple</a></div>
    <div class="body">Thanks BogdanOntanu. I really appreciate the time you took to help, but I still do not know what I am doing wrong in my program :confused: Does anyone have another way of explaining it to me?</div>
    <div class="meta">Posted on 2001-10-28 20:57:06 by AlexEiffel</div>
   </div>
   <div class="post" id="post-10514">
    <div class="subject"><a href="#post-10514">Well</a></div>
    <div class="body">I guess that here is the problem:<br /><br /><pre><code><br />OPTION SCOPED        ; Local labels are enabled, global labels inside<br />                     ; PROC should be defined with double colons &#40;LABEL&#58;&#58;&#41;<br /><br />......<br /><br /></code></pre><br /><br />this makes your WinMain PROC below a local :)<br />so other modules can not know of its existence<br />either define it with :: or kill that SCOPED option<br /><br />i can tell for sure until i see your .bat used for compile and linking</div>
    <div class="meta">Posted on 2001-10-28 21:10:45 by BogdanOntanu</div>
   </div>
   <div class="post" id="post-10515">
    <div class="subject"><a href="#post-10515">Need help with something I'm sure is simple</a></div>
    <div class="body">While that was being posted, i studied your source.  <br /><br />There problem is the way you want to break things apart (WinMain and WinProc as separate obj's, and included only by its proto definitions in DirectX).<br /><br />Your on the right track but your method involved some extra work and care (why i dont prefer it, but many others do).<br /><br />When you separated out WinProc it compiled fine.  This is because you've fully supported it with needed includes and directives (as well as an END statement).<br /><br />You attempted the same format to WinMain but your ran into headaches...  The problem is by simply tearing funcitons out into files, you over looked the fact they use 'special' data declairations like &quot;ClassName&quot;, &quot;AppName&quot;, and &quot;hInstance&quot;.   WinProc doesnt use this so you got away without headaches here.  <br /><br />To fix things up, you need to add extra information in the WinMain file for the linker about these issues:<br /><br />EXTERN AppName:DWORD   ;used as a pointer<br />EXTERN ClassName:DWORD ;used as a pointer<br />EXTERN hInstance:DWORD  ; cause it is :)<br /><br />As well you need to define them in your DirectX.asm test program.  Since you overlooked them there too.<br /><br />  ClassName db &quot;Dx Class&quot;,0<br />  AppName db &quot;A DX App&quot;,0<br />  hInstance dd 0<br />  <br />And to make the whole shin-dig compile, this is still not enought, as they are now defined, but at the moment PRIVATE to the file they are defined in!!!  So linking this you still wont get the job done... the last thing to add in DirectX.asm is info to make them seen globally amungst the separate files:<br /><br />  PUBLIC ClassName<br />  PUBLIC AppName<br />  PUBLIC hInstance<br /><br />Now...<br /><br /> Compile All 3...<br /> Link *.obj<br /><br /> And your done:<br /><br /><br /><strong>PS:  You also had a spelling typo that didnt help matters.. On line 26 of the WinMain.asm file, you have 'offset WndProc' , but the file youre declairing for this role is being called 'WinProc'  (IN vs ND) in the spelling.  So this is why you got your posted error, the function is not found because there is NO proto that matches the function.</strong><br /><br />Anywho.. this is the fix...<br /><br />Enjoy!<br /><br />NaN</div>
    <div class="meta">Posted on 2001-10-28 21:11:42 by NaN</div>
   </div>
   <div class="post" id="post-10518">
    <div class="subject"><a href="#post-10518">Need help with something I'm sure is simple</a></div>
    <div class="body">Thank you very much both BogdanOntanu and NaN :alright: That was exactly what I needed to know :grin: I am in your debt.</div>
    <div class="meta">Posted on 2001-10-28 21:45:42 by AlexEiffel</div>
   </div>
   <div class="post" id="post-124930">
    <div class="subject"><a href="#post-124930">WinMain@16</a></div>
    <div class="body">I almost had the same error as you but the reasons on this list didn't help me so I thought I would tell you the error I ended up finding incase anyone else looked up the problem.<br /><br />unresolved external symbol _WinMain@16<br /><br />this got produced in the error codes when I put the end start directive before WinMain.<br /><br />I know most of you will think this is simple but I'm a beginner and getting the simple stuff right is important</div>
    <div class="meta">Posted on 2003-11-20 16:21:04 by Phase Verocity</div>
   </div>
   <div class="post" id="post-124931">
    <div class="subject"><a href="#post-124931">Need help with something I'm sure is simple</a></div>
    <div class="body">Hi<br /><br />the <strong>END </strong> directive <br /><br />should be the last thing in your source code<br />nothing beyound this point will be assembled anymore</div>
    <div class="meta">Posted on 2003-11-20 16:38:58 by BogdanOntanu</div>
   </div>
  </div>
 </body>
</html>