<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>DirectX: CreateSurface problem with structures - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3965" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=3965">DirectX: CreateSurface problem with structures</a></p>
   <div class="post" id="post-26946">
    <div class="subject"><a href="#post-26946">DirectX: CreateSurface problem with structures</a></div>
    <div class="body">Hello assembly-community !! :)<br /><br />I want to use DirectX with _NASM_ and now i run into some<br />little problems.<br />Setting a screen-resolution works fine, but i cant get<br />the CreateSurface Method to work.<br /><br />DirectDrawCreate...<br />SetCooperativeLevel...<br />SetDisplayMode...<br /><br />Everything is fine. I get my screen in the Resolution i want<br />(800x600x32 | 320x200x32 | 1600x1200x32 | ... ).<br /><br />Next step is to create a surface, but i get a DDERR_INVALIDEPARAMS<br />error -&gt; so it looks like my DDSURFACEDESC2 structure isnt right.<br /><br />Thats from the DX7-SDK:<br /><pre><code><br />typedef struct _DDSURFACEDESC2 &#123;<br />    DWORD         dwSize;<br />    DWORD         dwFlags;<br />    DWORD         dwHeight;<br />    DWORD         dwWidth;<br /><br />       union<br />       &#123;<br />           LONG      lPitch;<br />           DWORD     dwLinearSize;<br />       &#125; DUMMYUNIONNAMEN&#40;1&#41;;<br /><br />    DWORD         dwBackBufferCount;<br /><br />       union<br />       &#123;<br />           DWORD     dwMipMapCount;<br />           DWORD     dwRefreshRate;<br />       &#125; DUMMYUNIONNAMEN&#40;2&#41;;<br /><br />    DWORD         dwAlphaBitDepth;<br />    DWORD         dwReserved;<br />    LPVOID        lpSurface;<br /><br />       union<br />       &#123;<br />           DDCOLORKEY    ddckCKDestOverlay;<br />           DWORD         dwEmptyFaceColor;<br />       &#125; DUMMYUNIONNAMEN&#40;3&#41;;<br /><br />    DDCOLORKEY    ddckCKDestBlt;<br />    DDCOLORKEY    ddckCKSrcOverlay;<br />    DDCOLORKEY    ddckCKSrcBlt;<br />    DDPIXELFORMAT ddpfPixelFormat;<br />    DDSCAPS2      ddsCaps;<br />    DWORD         dwTextureStage;<br />&#125; DDSURFACEDESC2, FAR* LPDDSURFACEDESC2;<br /></code></pre><br /><br />Hmmmm... i cant use UNION in my program, so i read a text<br />about it -&gt; Thats what i understood:<br />-- UNIONS are references to the same memory, but mostly<br />-- used to access different data types on the same memory location.<br /><br />So i would translate:<br /><pre><code>       union<br />       &#123;<br />           DDCOLORKEY    ddckCKDestOverlay;<br />           DWORD         dwEmptyFaceColor;<br />       &#125; DUMMYUNIONNAMEN&#40;3&#41;;</code></pre><br /><br />to 2 simple DWORD values:<br /><br />dwColorSpaceLowValue:  RESD 1<br />dwColorSpaceHighValue:  RESD 1<br /><br />Now i think &quot;dwEmptyFaceColor&quot; is the same as &quot;dwColorSpaceLowValue&quot;.<br />Hope thats right so far...<br /><br />Can anybody help me with this little Problem please ??<br />I can only use NASM, and i want to know how this<br />UNIONS look _low-level_: is it only 1 dword, or is it 5 dwords ?? ;) <br /><br /><br /><br />Another Problem for a NASM user:<br /><br />I?m now using DirectDrawCreate() to make my DX-Object.<br />I dont know which Version of DX is used for this function<br />(i have DX8.0a installed), so i want to use DirectDrawCreateEx().<br /><br />Its the same like DirectDrawCreate(), but has a new<br />Parameter &quot;REFIID iid&quot; for compatibility.<br />I want to use DirectX 7, so i need to call this function<br />with &quot;IID_IDirectDraw7&quot;. I think thats a GUID (or so..).<br /><br />Now i found the following:<br />IID_IDirectDraw7 = &lt;{015e65ec0h,03b9ch,011d2h,{0b9h,02fh,000h,060h,097h,097h,0eah,05bh}}&gt;<br /><br />Nice... :confused:<br /><br />That looks like C/C++ or MASM, not like low level assembly.<br />How can i translate that to plain assembly - to simple bytes ??<br /><br />Is it a String i pass to DirectDrawCreateEx(), or is it<br />a pointer to a memory location where i write this<br />values to ??<br /><br />Hope somebody can tell me how i can simply use this<br />GUID the low-level-way.<br /><br />IID_IDirectDraw7: db &quot;{015e65ec0h,03b9ch,011d2h,{0b9h,02fh,000h,060h,097h,097h,0eah,05bh}}&quot;,0<br />doesnt seem to work... :confused:<br /><br /><br />And before you ask: :tongue:<br />Yes, i?ve read everything from Ernie and from Caleb etc...<br />...but most stuff is high-level MASM, not plain ASM like NASM -<br />so i have some little problems to understand some things.<br /><br />Keep up the good work, guys (greets to Ernie and Caleb) !! :alright:<br /><br />Thanks,<br />...Danilo</div>
    <div class="meta">Posted on 2002-03-03 12:59:00 by Danilo</div>
   </div>
   <div class="post" id="post-27034">
    <div class="subject"><a href="#post-27034">DirectX: CreateSurface problem with structures</a></div>
    <div class="body">Hi Danilo !<br /><br />The token UNION means that the structure-elements within a UNION-constructs refers all to the same position (and alloc the same memory-size (which is the one of the largest element within)) so instead of adding both elements you must take only one of them: namely the one with the biggest size !<br /><br />In your &quot;example&quot; both types are dwords, so it doesn't matter which one you use ...<br /><br />One of the possible mistakes with DirectDraw-&gt;CreateSurface is that the versions of both the method and the parameters (structures) must be the same. So if you have opened a DirectDraw7-interface and you call the method CreateSurface then you have to use the DDSURFACEDESC7 structure.<br />Another mistake could be that the structure isn't proper initialized. So the field dwsize must be filled with the right value (sizeof DDSURFACEDESC7) !<br /><br />Here is a list of fields, which must be initialized (ddsd is the surface description structure):<br /><br />    ddsd.dwSize<br />    ddsd.dwFlags<br />    ddsd.ddsCaps.dwCaps<br />    ddsd.dwWidth<br />    ddsd.dwHeight<br /><br />I hope this will help you ...<br /><br />Greetings, CALEB</div>
    <div class="meta">Posted on 2002-03-03 16:47:01 by Caleb</div>
   </div>
   <div class="post" id="post-27188">
    <div class="subject"><a href="#post-27188">DirectX: CreateSurface problem with structures</a></div>
    <div class="body">Hello Caleb !!<br /><br />&gt;One of the possible mistakes with DirectDraw-&gt;CreateSurface is that<br />&gt;the versions of both the method and the parameters (structures)<br />&gt;must be the same<br /><br />Sure, i know.<br /><br />But with DirectDrawCreate() i cant say which Version<br />of DX i want to use.<br />I got now DirectDrawCreateEx() to work with the<br />GUID &quot;IID_IDirectDraw7&quot; and everything works fine. :cool:<br />(Didnt know how the GUID is represented in memory)<br /><br />Thanks for your help, Caleb !! :alright:<br /><br />cya,<br />...Danilo</div>
    <div class="meta">Posted on 2002-03-04 14:28:24 by Danilo</div>
   </div>
  </div>
 </body>
</html>