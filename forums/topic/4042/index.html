<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>hexdump algo - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4042" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=4042">hexdump algo</a></p>
   <div class="post" id="post-27577">
    <div class="subject"><a href="#post-27577">hexdump algo</a></div>
    <div class="body">I prototyped this algo in PowerBASIC inline but as it was a simple port with only a few fiddles, I converted it to MASM notation as it may be useful to a few people.<br /><br />The algo takes a file read into a buffer, its length and the buffer to write the hex dump to.<br /><br />Important with this algo is to allocate the file length TIMES 4 as the destination buffer as the hex dump is longer than the original data.<br /><br />The formatting imposed limitations on the efficiency of this algo, every second WORD size write is misaligned which will reduce its speed but it is a lot fasater than the one I replaced and I could not se another way to maintain alighment without making the formatting unacceptable so I kept it as it is.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a><br /><pre><code><br />; #########################################################################<br /><br />HexDump proc lpString&#58;DWORD,lnString&#58;DWORD,lpbuffer&#58;DWORD<br /><br />    LOCAL lcnt&#58;DWORD<br /><br />    push ebx<br />    push esi<br />    push edi<br /><br />    jmp over_table<br />    align 16<br />  hex_table&#58;<br />    db &quot;00&quot;,&quot;01&quot;,&quot;02&quot;,&quot;03&quot;,&quot;04&quot;,&quot;05&quot;,&quot;06&quot;,&quot;07&quot;,&quot;08&quot;,&quot;09&quot;,&quot;0A&quot;,&quot;0B&quot;,&quot;0C&quot;,&quot;0D&quot;,&quot;0E&quot;,&quot;0F&quot;<br />    db &quot;10&quot;,&quot;11&quot;,&quot;12&quot;,&quot;13&quot;,&quot;14&quot;,&quot;15&quot;,&quot;16&quot;,&quot;17&quot;,&quot;18&quot;,&quot;19&quot;,&quot;1A&quot;,&quot;1B&quot;,&quot;1C&quot;,&quot;1D&quot;,&quot;1E&quot;,&quot;1F&quot;<br />    db &quot;20&quot;,&quot;21&quot;,&quot;22&quot;,&quot;23&quot;,&quot;24&quot;,&quot;25&quot;,&quot;26&quot;,&quot;27&quot;,&quot;28&quot;,&quot;29&quot;,&quot;2A&quot;,&quot;2B&quot;,&quot;2C&quot;,&quot;2D&quot;,&quot;2E&quot;,&quot;2F&quot;<br />    db &quot;30&quot;,&quot;31&quot;,&quot;32&quot;,&quot;33&quot;,&quot;34&quot;,&quot;35&quot;,&quot;36&quot;,&quot;37&quot;,&quot;38&quot;,&quot;39&quot;,&quot;3A&quot;,&quot;3B&quot;,&quot;3C&quot;,&quot;3D&quot;,&quot;3E&quot;,&quot;3F&quot;<br />    db &quot;40&quot;,&quot;41&quot;,&quot;42&quot;,&quot;43&quot;,&quot;44&quot;,&quot;45&quot;,&quot;46&quot;,&quot;47&quot;,&quot;48&quot;,&quot;49&quot;,&quot;4A&quot;,&quot;4B&quot;,&quot;4C&quot;,&quot;4D&quot;,&quot;4E&quot;,&quot;4F&quot;<br />    db &quot;50&quot;,&quot;51&quot;,&quot;52&quot;,&quot;53&quot;,&quot;54&quot;,&quot;55&quot;,&quot;56&quot;,&quot;57&quot;,&quot;58&quot;,&quot;59&quot;,&quot;5A&quot;,&quot;5B&quot;,&quot;5C&quot;,&quot;5D&quot;,&quot;5E&quot;,&quot;5F&quot;<br />    db &quot;60&quot;,&quot;61&quot;,&quot;62&quot;,&quot;63&quot;,&quot;64&quot;,&quot;65&quot;,&quot;66&quot;,&quot;67&quot;,&quot;68&quot;,&quot;69&quot;,&quot;6A&quot;,&quot;6B&quot;,&quot;6C&quot;,&quot;6D&quot;,&quot;6E&quot;,&quot;6F&quot;<br />    db &quot;70&quot;,&quot;71&quot;,&quot;72&quot;,&quot;73&quot;,&quot;74&quot;,&quot;75&quot;,&quot;76&quot;,&quot;77&quot;,&quot;78&quot;,&quot;79&quot;,&quot;7A&quot;,&quot;7B&quot;,&quot;7C&quot;,&quot;7D&quot;,&quot;7E&quot;,&quot;7F&quot;<br />    db &quot;80&quot;,&quot;81&quot;,&quot;82&quot;,&quot;83&quot;,&quot;84&quot;,&quot;85&quot;,&quot;86&quot;,&quot;87&quot;,&quot;88&quot;,&quot;89&quot;,&quot;8A&quot;,&quot;8B&quot;,&quot;8C&quot;,&quot;8D&quot;,&quot;8E&quot;,&quot;8F&quot;<br />    db &quot;90&quot;,&quot;91&quot;,&quot;92&quot;,&quot;93&quot;,&quot;94&quot;,&quot;95&quot;,&quot;96&quot;,&quot;97&quot;,&quot;98&quot;,&quot;99&quot;,&quot;9A&quot;,&quot;9B&quot;,&quot;9C&quot;,&quot;9D&quot;,&quot;9E&quot;,&quot;9F&quot;<br />    db &quot;A0&quot;,&quot;A1&quot;,&quot;A2&quot;,&quot;A3&quot;,&quot;A4&quot;,&quot;A5&quot;,&quot;A6&quot;,&quot;A7&quot;,&quot;A8&quot;,&quot;A9&quot;,&quot;AA&quot;,&quot;AB&quot;,&quot;AC&quot;,&quot;AD&quot;,&quot;AE&quot;,&quot;AF&quot;<br />    db &quot;B0&quot;,&quot;B1&quot;,&quot;B2&quot;,&quot;B3&quot;,&quot;B4&quot;,&quot;B5&quot;,&quot;B6&quot;,&quot;B7&quot;,&quot;B8&quot;,&quot;B9&quot;,&quot;BA&quot;,&quot;BB&quot;,&quot;BC&quot;,&quot;BD&quot;,&quot;BE&quot;,&quot;BF&quot;<br />    db &quot;C0&quot;,&quot;C1&quot;,&quot;C2&quot;,&quot;C3&quot;,&quot;C4&quot;,&quot;C5&quot;,&quot;C6&quot;,&quot;C7&quot;,&quot;C8&quot;,&quot;C9&quot;,&quot;CA&quot;,&quot;CB&quot;,&quot;CC&quot;,&quot;CD&quot;,&quot;CE&quot;,&quot;CF&quot;<br />    db &quot;D0&quot;,&quot;D1&quot;,&quot;D2&quot;,&quot;D3&quot;,&quot;D4&quot;,&quot;D5&quot;,&quot;D6&quot;,&quot;D7&quot;,&quot;D8&quot;,&quot;D9&quot;,&quot;DA&quot;,&quot;DB&quot;,&quot;DC&quot;,&quot;DD&quot;,&quot;DE&quot;,&quot;DF&quot;<br />    db &quot;E0&quot;,&quot;E1&quot;,&quot;E2&quot;,&quot;E3&quot;,&quot;E4&quot;,&quot;E5&quot;,&quot;E6&quot;,&quot;E7&quot;,&quot;E8&quot;,&quot;E9&quot;,&quot;EA&quot;,&quot;EB&quot;,&quot;EC&quot;,&quot;ED&quot;,&quot;EE&quot;,&quot;EF&quot;<br />    db &quot;F0&quot;,&quot;F1&quot;,&quot;F2&quot;,&quot;F3&quot;,&quot;F4&quot;,&quot;F5&quot;,&quot;F6&quot;,&quot;F7&quot;,&quot;F8&quot;,&quot;F9&quot;,&quot;FA&quot;,&quot;FB&quot;,&quot;FC&quot;,&quot;FD&quot;,&quot;FE&quot;,&quot;FF&quot;<br />  over_table&#58;<br /><br />    lea ebx, hex_table        ; get base address of table<br />    mov esi, lpString         ; address of source string<br />    mov edi, lpbuffer         ; address of output buffer<br />    mov eax, esi<br />    add eax, lnString<br />    mov ecx, eax              ; exit condition for byte read<br />    mov lcnt, 0<br /><br />    xor eax, eax              ; prevent stall<br /><br />  ; %%%%%%%%%%%%%%%%%%%%%%% loop code %%%%%%%%%%%%%%%%%%%%%%%%%%%%%<br /><br />  hxlp&#58;<br />    mov al, &#91;esi&#93;             ; get BYTE<br />    inc esi<br />    inc lcnt<br />    mov dx, &#91;ebx+eax*2&#93;       ; put WORD from table into DX<br />    mov &#91;edi&#93;, dx             ; write 2 byte string to buffer<br />    add edi, 2<br />    mov BYTE PTR &#91;edi&#93;, 32    ; add space<br />    inc edi<br />    cmp lcnt, 8               ; test for half to add &quot;-&quot;<br />    jne @F<br />    mov WORD PTR &#91;edi&#93;, &quot; -&quot;<br />    add edi, 2<br />  @@&#58;<br />    cmp lcnt, 16              ; break line at 16 characters<br />    jne @F<br />    dec edi                   ; overwrite last space<br />    mov WORD PTR &#91;edi&#93;, 0A0Dh ; write CRLF to buffer<br />    add edi, 2<br />    mov lcnt, 0<br />  @@&#58;<br />    cmp esi, ecx              ; test exit condition<br />    jl hxlp<br /><br />  ; %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%<br /><br />    inc edi<br />    mov BYTE PTR &#91;edi&#93;, 0     ; append terminator<br /><br />    pop edi<br />    pop esi<br />    pop ebx<br /><br />    ret<br /><br />HexDump endp<br /><br />; #########################################################################<br /></code></pre></div>
    <div class="meta">Posted on 2002-03-06 20:48:22 by hutch--</div>
   </div>
  </div>
 </body>
</html>