<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Simple win32 NASM program crashes - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=21793" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=21793">Simple win32 NASM program crashes</a></p>
   <div class="post" id="post-164429">
    <div class="subject"><a href="#post-164429">Simple win32 NASM program crashes</a></div>
    <div class="body">I&#39;ve been trying to make a simple win32 application with NASM for a little while, and after shamelessly ripping the source of another person&#39;s work, I have found that it crashes! After cleanly assembling and linking it at the command line:<br /><br /><span class="mono">C:\&gt;nasm -fwin32 hi.asm <br />C:\&gt;alink -oPE win32.lib -entry _WinMain@16 <br />C:\&gt;hi.exe</span><br /><br />and seeing it crash, I loaded it up in the debugger, and found that it simply crashes somewhere right inside of CreateWindowEx<br /><br /><pre><code>CALL &lt;JMP.&amp;user32.CreateWindowExA&gt; &lt;== Crashes inside this call, never returns <br /> <br />; Error: Don&#39;t know how to continue because&nbsp; <br />; memory at address 00000024 is not readable.&nbsp; <br />; Try to change EIP or pass exception to program. <br /> <br />TEST EAX,EAX ; Never gets here <br />JNZ SHORT hi.00401098 ; Never gets here</code></pre><br /><br />I do not have many thoughts on why this could have happened. One of my thoughts was that because the WNDCLASS in .DATA section, trying to modify it results in a crash. But, I also don&#39;t know how I might declare this locally on the stack, whether this is even needed or not I don&#39;t know. The source I used was found in this pack here:&nbsp; ftp://ftp.szif.hu/pub/demos/tool/gijnwt2.zip and the specific applications source is as follows:<br /><br /><pre><code>; Example.asm<br />; ===========<br />;<br />; example.asm, a part of the NASM Win32 Coding Toolkit.<br />; This File demonstrates the use of NASM to make win32 programs.<br />;<br />; Not very pretty but it demonstrates some importent points<br />; about coding with NASM.<br />;<br />; Coded By Gij<br />; If you need to contact me, my E-mail is: gij &lt;at&gt; bigfoot.com<br /><br />%include &quot;C:\Development\NASM\inc\win32n.inc&quot;<br /><br />extern RegisterClassA<br />extern CreateWindowExA<br />extern CreateWindow<br />extern ShowWindow<br />extern UpdateWindow<br />extern GetMessageA<br />extern TranslateMessage<br />extern DispatchMessageA<br />extern DefWindowProcA<br />extern ExitProcess<br />extern MessageBeep<br />extern GetLastError<br />extern LoadIconA<br />extern LoadCursorA<br />extern PostQuitMessage<br /><br />extern BeginPaint<br />extern EndPaint<br />extern DrawTextA<br /><br />global _WinMain@16<br /><br />SEGMENT .text USE32 class=code<br />_WinMain@16:<br /><br />%define ebp_hInstance&nbsp; &nbsp; &nbsp;  ebp+8	; handle of current instance<br />%define ebp_hPrevInstance&nbsp;  ebp+0ch	; handle of previous instance<br />%define ebp_lpszCmdLine&nbsp; &nbsp;  ebp+10h	; pointer to command line<br />%define ebp_nCmdShow&nbsp; &nbsp; &nbsp; &nbsp; ebp+14h	; show state of window<br /><br />	push ebp<br />	mov ebp,esp<br /><br />RegisterWindowClass:<br /><br />	mov eax,<br />	mov ,eax<br />	<br />	push LPCTSTR IDI_APPLICATION<br />	push HINSTANCE NULL<br />	call LoadIconA<br /><br />	mov ,eax<br /><br />	push LPCTSTR IDC_CROSS<br />	push HINSTANCE NULL<br />	call LoadCursorA<br /><br />	mov ,eax<br /><br />	push dword WindowClassStruc<br />	call RegisterClassA<br /><br />	test eax,eax<br />	jnz .Success<br /><br />.Fail:<br />	call GetLastError<br />	jmp FareWell<br /><br />.Success:<br /><br /><br />MakeWindow:<br /><br />	push LPVOID NULL<br />	push HINSTANCE <br />	push HMENU NULL<br />	push HWND NULL<br />	push INTEGER 50h<br />	push INTEGER 150h<br />	push INTEGER CW_USEDEFAULT&nbsp; ; <br />	push INTEGER CW_USEDEFAULT&nbsp; ; <br />	push DWORD WS_OVERLAPPEDWINDOW<br />	push LPCTSTR WindowTitle<br />	push LPCTSTR ClassName<br />	push DWORD WS_EX_OVERLAPPEDWINDOW<br />&nbsp; &nbsp; &nbsp; &nbsp; call CreateWindowExA<br /><br />	test eax,eax<br />	jnz .Success<br /><br />.Fail:<br />	call GetLastError<br />	jmp FareWell<br /><br />.Success:<br /><br />	mov ,eax<br /><br />	push INTEGER&nbsp; 0xa<br />	push HWND <br />	call ShowWindow<br /><br />	push eax<br />	call UpdateWindow<br />	<br />MsgLoop:<br /><br />	push UINT 0<br />	push UINT 0<br />	push HWND 0<br />	push LPMSG WindowMSG<br />	call GetMessageA<br /><br />	or eax,eax<br />	jz FareWell<br /><br />	push DWORD WindowMSG<br />	call TranslateMessage<br /><br />	push DWORD WindowMSG<br />	call DispatchMessageA<br />	<br />	jmp MsgLoop<br /><br />FareWell:<br /><br />	push UINT 0<br />	call ExitProcess<br /><br />WndProc:<br /><br />%define ebp_hWnd&nbsp;  ebp+8		; handle of window<br />%define ebp_Msg&nbsp; &nbsp; ebp+0ch		; message<br />%define ebp_wParam ebp+10h		; first message parameter<br />%define ebp_lParam ebp+14h		; second message parameter<br />%define ebp_DC	&nbsp; ebp-4<br /><br />	push ebp<br />	mov ebp,esp<br /><br />	cmp dword ,WM_DESTROY<br />	jz Destroy_Handler<br /><br />	cmp dword ,WM_PAINT<br />	jz Paint_Handler<br /><br />.DefMsgHandler:<br /><br />	push dword <br />	push dword <br />	push dword <br />	push dword <br />	call DefWindowProcA<br />.Exit:<br /><br />	mov esp,ebp<br />	pop ebp<br />	ret 0ch<br /><br />Destroy_Handler:<br /><br />	push INTEGER 0<br />	call PostQuitMessage<br />	jmp WndProc.Exit<br /><br />Paint_Handler:<br /><br />	push ebp<br />	mov ebp,esp<br />	sub esp,4<br /><br />	push dword PaintSt<br />	push HWND <br />	call BeginPaint<br /><br />	or eax,eax<br />	jz Paint_Handler.Exit<br /><br />	mov ,eax	<br />	<br />	push UINT DT_CENTER<br />	push LPRECT RectSt<br />	push INTEGER BOXTEXTLEN<br />	push LPCTSTR BoxText<br />	push HDC <br />	call DrawTextA<br /><br />	push dword PaintSt<br />	push HWND <br />	call EndPaint<br />.Exit:<br /><br />	mov esp,ebp<br />	pop ebp<br /><br />	jmp WndProc.DefMsgHandler<br /><br />SEGMENT .data USE32 class=data<br /><br />WindowTitle 		db &quot;NASM Win32 Coding Example by Gij&quot;,0<br />ClassName 		db &quot;NASM_WIN32&quot;,0<br />WindowHandle		dd 0<br /><br />BoxText 		db &quot;Got Milk?&quot;<br />BOXTEXTLEN		equ $-BoxText<br /><br />WindowClassStruc:<br />ISTRUC WNDCLASS<br />at WNDCLASS.style,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd&nbsp; &nbsp; 0<br />at WNDCLASS.lpfnWndProc,&nbsp; &nbsp; &nbsp; dd&nbsp; &nbsp; WndProc<br />at WNDCLASS.cbClsExtra,&nbsp; &nbsp; &nbsp;  dd&nbsp; &nbsp; 0<br />at WNDCLASS.cbWndExtra,&nbsp; &nbsp; &nbsp;  dd&nbsp; &nbsp; 0<br />at WNDCLASS.hInstance,&nbsp; &nbsp; &nbsp; &nbsp; dd&nbsp; &nbsp; 0<br />at WNDCLASS.hIcon,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd&nbsp; &nbsp; NULL<br />at WNDCLASS.hCursor,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd&nbsp; &nbsp; NULL<br />at WNDCLASS.hbrBackground,&nbsp; &nbsp; dd&nbsp; &nbsp; 1<br />at WNDCLASS.lpszMenuName,&nbsp; &nbsp;  dd&nbsp; &nbsp; NULL<br />at WNDCLASS.lpszClassName,&nbsp; &nbsp; dd&nbsp; &nbsp; ClassName<br />IEND<br /><br />WindowMSG:<br />ISTRUC MSG<br />at MSG.hwnd,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 	dd&nbsp; &nbsp; 0<br />at MSG.message, 	&nbsp; 	dd&nbsp; &nbsp; 0<br />at MSG.wParam,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 	dd&nbsp; &nbsp; 0<br />at MSG.lParam,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 	dd&nbsp; &nbsp; 0<br />at MSG.time,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 	dd&nbsp; &nbsp; 0<br />at MSG.x,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 	dd&nbsp; &nbsp; 0<br />at MSG.y,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 	dd&nbsp; &nbsp; 0<br />IEND<br /><br />PaintSt:<br />ISTRUC PAINTSTRUCT<br />IEND<br /><br />RectSt:<br />ISTRUC RECT<br />at RECT.left, 			dd 0<br />at RECT.top, 			dd 0<br />at RECT.right, 			dd 150h<br />at RECT.bottom,			dd 50h<br />IEND</code></pre><br /><br />All help is <strong>greatly</strong> appreciated :D</div>
    <div class="meta">Posted on 2005-09-10 14:53:41 by Tonto</div>
   </div>
   <div class="post" id="post-164438">
    <div class="subject"><a href="#post-164438">Re: Simple win32 NASM program crashes</a></div>
    <div class="body"><br />CreateWindowEx will call your window proc. So I would suggest to set a breakpoint inside WndProc and see if it is reached.</div>
    <div class="meta">Posted on 2005-09-11 01:11:55 by japheth</div>
   </div>
   <div class="post" id="post-164453">
    <div class="subject"><a href="#post-164453">Re: Simple win32 NASM program crashes</a></div>
    <div class="body">Ah, so it does indeed get to my WndProc, but now I find it is crashing somewhere inside DefWindowProc call. I am having trouble debugging it exactly because tracing into the DefWindowProc call just goes through 1,000&#39;s of whatever lines of kernel ASM where I see anything going anywhere. An interesting thing I saw said on MSDN, &quot;The WM_NCCREATE message is sent just after your window is created, but if an application responds to this message by returning FALSE, CreateWindowEx function fails. The WM_CREATE message is sent after your window is already created.&quot; I thought this was interesting, because that could possibly what my app is doing, but I don&#39;t know because DefWindowProc is handling these messages for me. I&#39;m not entirely sure where to go with this problem now, debugging is extremely difficult. As always, thank you for your help!</div>
    <div class="meta">Posted on 2005-09-11 13:50:23 by Tonto</div>
   </div>
   <div class="post" id="post-164454">
    <div class="subject"><a href="#post-164454">Re: Simple win32 NASM program crashes</a></div>
    <div class="body"><br />next step would be to find out at what message it crashes. That should be fairly easy, because there aren&#39;t that many message before CreateWindow returns (WM_NCCREATE and WM_CREATE are among them). It would be interesting as well if your WndProc is called just 1 time or at least twice.<br /></div>
    <div class="meta">Posted on 2005-09-11 14:22:54 by japheth</div>
   </div>
   <div class="post" id="post-164459">
    <div class="subject"><a href="#post-164459">Re: Simple win32 NASM program crashes</a></div>
    <div class="body">&gt;&gt; It would be interesting as well if your WndProc is called just 1 time or at least twice.<br /><br />Yep, it would appear as though it is only hit once.<br /><br /><pre><code>004010F0&nbsp; /. 55&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  PUSH EBP<br />004010F1&nbsp; |. 89E5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EBP,ESP<br />004010F3&nbsp; |. 817D 0C 020000&gt;CMP DWORD PTR SS:,2<br />004010FA&nbsp; |. 74 20&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; JE SHORT hi.0040111C<br />004010FC&nbsp; |. 817D 0C 0F0000&gt;CMP DWORD PTR SS:,0F<br />00401103&nbsp; |. 74 23&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; JE SHORT hi.00401128<br />00401105&nbsp; |&gt; FF75 14&nbsp; &nbsp; &nbsp; &nbsp; PUSH DWORD PTR SS:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; /lParam<br />00401108&nbsp; |. FF75 10&nbsp; &nbsp; &nbsp; &nbsp; PUSH DWORD PTR SS:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; |wParam<br />0040110B&nbsp; |. FF75 0C&nbsp; &nbsp; &nbsp; &nbsp; PUSH DWORD PTR SS:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; |Message<br />0040110E&nbsp; |. FF75 08&nbsp; &nbsp; &nbsp; &nbsp; PUSH DWORD PTR SS:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; |hWnd<br />00401111&nbsp; |. E8 2C1F0000&nbsp; &nbsp; CALL &lt;JMP.&amp;user32.DefWindowProcA&gt;&nbsp; &nbsp; &nbsp; &nbsp; ; \DefWindowProcA<br /><br />&nbsp;  ... etc etc with the WinProc, WM_PAINT and WM_DESTROY handling ...</code></pre><br /><br />I have a break on that PUSH EBP entry to the WinProc and it is only hit once, and then it goes into DefWindowProc and dies &quot;somewhere&quot;. Now the message that is first sent is a WM_GETMINMAXINFO message. The stack right at the call:<br /><br /><pre><code>0012F890&nbsp;  00401116&nbsp; /CALL to DefWindowProcA from hi.00401111<br />0012F894&nbsp;  001702D0&nbsp; |hWnd = 001702D0 (class=&#39;NASM_WIN32&#39;)<br />0012F898&nbsp;  00000024&nbsp; |Message = WM_GETMINMAXINFO<br />0012F89C&nbsp;  00000000&nbsp; |wParam = 0<br />0012F8A0&nbsp;  0012F9D0&nbsp; \pMinMax = 0012F9D0</code></pre><br /><br />From there, it jumps around in kernel32 code, and crashes somewhere, on this same DefWindowProc call. It&#39;s pretty confusing to me ;) and I don&#39;t know whereabotus in my debugging adventures I might go next. But again, thanks for your help!<br /></div>
    <div class="meta">Posted on 2005-09-11 17:59:20 by Tonto</div>
   </div>
   <div class="post" id="post-164461">
    <div class="subject"><a href="#post-164461">Re: Simple win32 NASM program crashes</a></div>
    <div class="body"><br />One strategy could be to &quot;disable&quot; calling the default window handler for WM_getminmaxinfo. this would at least show if it is this message which causes trouble or if your wndproc has some other problems so it is never called more than once.<br /><br />&quot;disable&quot; means that you should handle the message in your wndproc. I don&#39;t have the docs available, but just returning 0 is in most cases valid.<br /></div>
    <div class="meta">Posted on 2005-09-11 19:05:03 by japheth</div>
   </div>
   <div class="post" id="post-164466">
    <div class="subject"><a href="#post-164466">Re: Simple win32 NASM program crashes</a></div>
    <div class="body">Very well then, our good freinds at MSDN say this about the <a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmessages/wm_getminmaxinfo.asp">WM_GETMINMAXINFO</a>: <br />Return Value: If an application processes this message, it should return zero.<br /><br /><br />So I did:<br /><pre><code><br />	cmp dword ,WM_GETMINMAXINFO<br />	jz Minmax_Handler<br /><br />... etc ...<br /><br />Minmax_Handler:<br />	mov esp, ebp<br />	pop ebp<br />	ret</code></pre><br /><br />and that worked fine. Then we get up to our WM_NCCREATE message:<br /><br /><pre><code>0012F854&nbsp;  0040111F&nbsp; /CALL to DefWindowProcA from hi.0040111A<br />0012F858&nbsp;  000C0472&nbsp; |hWnd = 000C0472 (class=&#39;NASM_WIN32&#39;)<br />0012F85C&nbsp;  00000081&nbsp; |Message = WM_NCCREATE<br />0012F860&nbsp;  00000000&nbsp; |wParam = 0<br />0012F864&nbsp;  0012F9B8&nbsp; \pCreate = 0012F9B8</code></pre><br /><br />And it crashes. What odd behavior! I did the same thing for the WM_NCCREATE messge:<br /><br /><pre><code>Nccreate_Handler:<br />	mov esp, ebp<br />	pop ebp<br />	mov eax, 1<br />	ret</code></pre><br /><br />And then that works fine. And then we come around for a third DefWindowProc handle with a WM_NCCALCSIZE message:<br /><br /><pre><code>0012F8A8&nbsp;  00401128&nbsp; /CALL to DefWindowProcA from hi.00401123<br />0012F8AC&nbsp;  00260318&nbsp; |hWnd = 00260318 (class=&#39;NASM_WIN32&#39;)<br />0012F8B0&nbsp;  00000083&nbsp; |Message = WM_NCCALCSIZE<br />0012F8B4&nbsp;  00000000&nbsp; |CalcFlag = FALSE<br />0012F8B8&nbsp;  0012F9F0&nbsp; \Data = 0012F9F0</code></pre><br /><br />And it crashes. There seems to be something absolutely catastrophic with this call that is very confusing. I am push&#39;ing the arguments properly right? Is there anything I might be missing? Oh woe is me, I am so distraught ;) Again, thanks for yoru continued support ;)</div>
    <div class="meta">Posted on 2005-09-11 20:50:04 by Tonto</div>
   </div>
   <div class="post" id="post-164468">
    <div class="subject"><a href="#post-164468">Re: Simple win32 NASM program crashes</a></div>
    <div class="body">Why do you have 2 .Exit? <br /><br />If you process the message, you do not need to call DefWindowProc, so your last .Exit is wrong. Instead it should be replaced with jmp .Exit</div>
    <div class="meta">Posted on 2005-09-11 20:59:50 by roticv</div>
   </div>
   <div class="post" id="post-164469">
    <div class="subject"><a href="#post-164469">Re: Simple win32 NASM program crashes</a></div>
    <div class="body">Oh my dull head can&#39;t take that.<br /><br />&gt;&gt; Instead it should be replaced with jmp .Exit<br /><br />Of course I was just copying the code I was given from this tool pack. So, I see the second .Exit is referenced:<br /><br /><pre><code>	call BeginPaint<br /><br />	or eax,eax<br />	jz Paint_Handler.Exit<br /><br />&nbsp;  ...<br /><br />; This is Paint_Handler.Exit<br />.Exit:<br /><br />	mov esp,ebp<br />	pop ebp<br /><br />	jmp WndProc.DefMsgHandler</code></pre><br /><br />Which would I guess exit if that BeginPaint failed (returned 0). I guess you are saying that I should not have that .Exit there, and that I should merely jmp WndProc.Exit right then and there? I guess that would make sense, as you shouldn&#39;t need to DefWindowProc if yoru WM_PAINT handling failed. My code, I presume would then look something like:<br /><br /><pre><code>	call BeginPaint<br /><br />	or eax,eax<br />	jz WndProc.Exit</code></pre><br /><br />Well, it&#39;s certainly more logical now :D but it&#39;s still crashing, for some very very odd reason at DefWindowProc call every time. Oh well, thanks for your continued support.</div>
    <div class="meta">Posted on 2005-09-11 21:24:26 by Tonto</div>
   </div>
   <div class="post" id="post-164470">
    <div class="subject"><a href="#post-164470">Re: Simple win32 NASM program crashes</a></div>
    <div class="body"><pre><code><br />push HWND <br />	call ShowWindow<br />	push eax<br />	call UpdateWindow<br /></code></pre><br />is clearly wrong, pushes should be swapped. (btw, UpdateWindow after ShowWindow is an artifact from Win3.1, useless&nbsp; in 95/NT). Also, calling DefWindowProc after WM_PAINT should not be done. <br /><br />At least for now, try not linking with lcclink, lots of extra code is a no-no for debugging (unless you use VKDebug-like methods). <br /><br />in your Paint_handler, you forget to adjust the stack, if I&#39;m not wrong (here it&#39;s 6:33am now, all-nighter....) . <br /><br />I need to bookmark this code to stuff it in the face of &quot;.if/.elseif&quot; haters :P<br /><br />P.S:<br />Also, checking for impossible errors like not-registered wndclasses, not created windows, invalid eax after BeginPaint ... are a waste of time. If any of them ever happens, then the OS is currently in a terrible condition - and you will never be to blame. You&#39;d better save time for checking on things that could actually get wrong. But sure, a bit of training is good, too. </div>
    <div class="meta">Posted on 2005-09-11 22:39:19 by Ultrano</div>
   </div>
   <div class="post" id="post-164472">
    <div class="subject"><a href="#post-164472">Re: Simple win32 NASM program crashes</a></div>
    <div class="body"><div class="quote"><br />I need to bookmark this code to stuff it in the face of &quot;.if/.elseif&quot; haters<br /></div><br />It&#39;s more of a thing to shove in the throaths of invoke+proc haters... :)<br /></div>
    <div class="meta">Posted on 2005-09-11 22:49:28 by f0dder</div>
   </div>
   <div class="post" id="post-164474">
    <div class="subject"><a href="#post-164474">Re: Simple win32 NASM program crashes</a></div>
    <div class="body"><pre><code>	push dword PaintSt<br />	push HWND <br />	call EndPaint<br />.Exit:<br /><br />	mov esp,ebp<br />	pop ebp<br /><br />	jmp WndProc.DefMsgHandler</code></pre><br /><br />This is wrong. You are unwinding the stack one too many times. (Notice you have the POP EBP in the DefMsgHandler code.) As stated by others, there is no need to call DefWindowProc after WM_PAINT has been handled.<br /><br /><pre><code>	push dword PaintSt<br />	push HWND <br />	call EndPaint<br />.Exit:<br /><br />	mov esp,ebp<br />	pop ebp<br /><br />	ret 0ch</code></pre><br /></div>
    <div class="meta">Posted on 2005-09-11 23:18:28 by tenkey</div>
   </div>
   <div class="post" id="post-164475">
    <div class="subject"><a href="#post-164475">Re: Simple win32 NASM program crashes</a></div>
    <div class="body">Ah! Somewhere along the lines (actually, the exact one was changing ret 0ch to simply ret) it stopped crashing! Well that is infinitely nifty ;)<br /><br /><pre><code>WndProc:<br /><br />%define ebp_hWnd&nbsp;  ebp+8		; handle of window<br />%define ebp_Msg&nbsp; &nbsp; ebp+0ch		; message<br />%define ebp_wParam ebp+10h		; first message parameter<br />%define ebp_lParam ebp+14h		; second message parameter<br /><br />	push ebp<br />	mov ebp,esp<br /><br />	cmp dword , WM_DESTROY<br />	jz Destroy_Handler<br /><br /><br />.DefMsgHandler:<br /><br />	push dword <br />	push dword <br />	push dword <br />	push dword <br />	call DefWindowProcA<br />.Exit:<br /><br />	mov esp,ebp<br />	pop ebp<br />	ret<br /><br />Destroy_Handler:<br /><br />	push INTEGER 0<br />	call PostQuitMessage<br />	jmp WndProc.Exit</code></pre><br /><br />Well, now my alternate problem. When it first opens, it is minimized and when I click it there&#39;s no window. Perhaps this is like the curse mentioned by Ultrano. I changed my code to:<br /><br /><pre><code>	mov ,eax<br />	push INTEGER SW_SHOW<br />	push HWND eax<br />	call ShowWindow</code></pre><br /><br />Leaving out the UpdateWindow call (who cares about 95), throwing in SW_SHOW instead of whatever 0xa was. So now, it starts minimized and I can&#39;t get it to maximize even when I click it. A bit odd. Now this is merely a PEBKAC problem between me and the WINAPI, and me being too stupid too track down the problem. Maybe I&#39;ll find it at some point, if it&#39;s glaringly obvious maybe someone can shout it out at me. Thanks for the help, I&#39;m much clsoer than before!</div>
    <div class="meta">Posted on 2005-09-11 23:54:24 by Tonto</div>
   </div>
  </div>
 </body>
</html>