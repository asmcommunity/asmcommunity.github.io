<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Geochemistry project ? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=22736" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=22736">Geochemistry project ?</a></p>
   <div class="post" id="post-170283">
    <div class="subject"><a href="#post-170283">Geochemistry project ?</a></div>
    <div class="body">Someone was looking for help, so I cut and pasted part of it.<br />I recall that OR sets bits in the destination to that of the source.<br /><br /><br />Just to give you a little background on my project: I work in geochemistry and I have an Orion 950 titrator hooked up to an Orion 960 dispenser tower through a DB9 serial. Anyway the titrator is very limited in is abilities (for example time between dispensing is not long enough for the projects that the titrator is used for). So as a solution, I have decided to send the commands from a computer to the 960 tower using the very dumb terminal 2 in a program called Igor Pro 6, however I have run across some problems in identifying what programming language the dispenser uses, or if it is even a standard language. I am not very familiar with progamming language. I have added the document with the dispenser codes. Also I have not been able to figure out what the term Ored with 80Hex means and what it does, and therefore I have not been able to create functioning command strings. If someone could help me out in my ignorance and show me how to create a functioning command string for this, it would be greatly appreciated.<br /><br /><br />The following are the commands that the factory sent me:<br /><br />****************** disp_aux.doc *****************************<br />****** COMMANDS FOR AUXILIARY DISPENSERS 16 Mar, 1987 ****<br />Updated 8 July, 1988 cis<br />Updated 21 Sept, 1988 cis<br /><br />Replace \021 by &quot;Ctrl Q&quot; or &quot;^Q&quot; if requested by persons<br />who are not familiar with 960 codes. Sept. 19, 1991<br /><br />x = 0 - 7: auxiliary pump ID<br /><br />CAUTION: In order to distinguish a pump command from a SAMPLE CHANGER<br />command, each character in the following command strings is ORed<br />with 80Hex, i.e., the most significant bit of the ASCII character<br />is set before going out of the serial HOST port.<br /><br />960 SENDS DISPENSER x RESPONSE FUNCTION<br />========== ======================== ===============================<br /><br />To home the pump:<br />&quot;\021xH\r&quot; Request dispenser x to home<br />If home already, then do 1 more<br />revolution.<br /><br />To dispense:<br />&quot;\021xA\r&quot; Set dispenser x to AUTO mode<br />-- local PAUSE button active<br /><br />&quot;\021xDyyyy\r&quot; Request yyyy revolutions from<br />dispenser x.<br /><br />&quot;\021xS\r&quot; &quot;xc\r&quot; Request for dispenser x status.<br /><br />status character c has the following bit structure:<br /><br />bit 0 = 1: homing disk NOT found home<br />bit 1 = 1: AUTO mode, zero for MANUAL mode<br />bit 2 = 1: stirrer on.<br />bit 3 = 1: pumping now<br />bit 4 = 1: auxiliary tower pause pressed<br />bit 5 = 1: primary tower pause pressed<br />bit 6 = 1: handshake error in initialization.<br />bit 7 = 1: always high for auxiliary pumps.<br /><br />note: Bit 6 can only be tested by making a prom which contains a<br />false handshake word or by running the pump with two emulators.<br />The words used now are AA or 55.<br /><br />If pause during dispensing:<br />&quot;\021xP\r&quot; Tell dispenser x to PAUSE.<br />&quot;\021xG\r&quot; Tell dispenser x to RESUME.<br />&quot;\021xQ\r&quot; Tell dispenser x to Quit.<br />&quot;xyyyy\r&quot; Tell 960 that dispenser x has yyyy<br />revolutions remaining.<br />Dispensing completed:<br />&quot;\021xM\r&quot; Set dispenser x to MANUAL mode<br />-- all buttons active<br /><br />Stirrer:<br />&quot;\021xR\r&quot; Turn on stirrer x.<br />&quot;\021xT\r&quot; Turn off stirrer x.<br /><br />STACKED light:99999<br />&quot;\021xK\r&quot; Turn on STACKED light.<br />&quot;\021xC\r&quot; Turn off STACKED light. </div>
    <div class="meta">Posted on 2006-03-07 16:43:02 by skywalker</div>
   </div>
   <div class="post" id="post-170297">
    <div class="subject"><a href="#post-170297">Re: Geochemistry project ?</a></div>
    <div class="body"><br />The important information is all there.<br />Basically we have to create a &quot;formatted string&quot; which represents the command we want to send.<br /><br /><div class="quote"><br />Replace \021 by &quot;Ctrl Q&quot; or &quot;^Q&quot; if requested by persons<br />who are not familiar with 960 codes. Sept. 19, 1991<br /><br />x = 0 - 7: auxiliary pump ID<br /></div><br /><br />This is telling us that each Command we send is going to begin with the ascii value for &quot;control Q&quot; , which is 17 in decimal (21 in Octal, and 11 in Hex).<br />I believe the /r indicates a carriage return, which is control-M , ie, 13 in decimal. The x is &quot;device number 0 to 7&quot;.<br /><br />Finally, the string needs each character in it to have its high bit set by OR&#39;ing it with 80 Hex (128 decimal) as described.<br /><br />Let&#39;s show an example.<br />&quot;\021xR\r&quot; Turn on stirrer x.<br /><br />We replace the \021 with ascii value for control-Q (17)<br />We terminate the command string with control-M (13)<br />TurnOnStirrer5 db 17,5,13<br /><br />If we were to define those in Hex,<br />TurnOnStirrer5 db 11h,05h,0Dh<br /><br />and if we were to set all the high bits to avoid ORing anything,<br />TurnOnStirrer5 db 145,133,141 (Decimal)<br />TurnOnStirrer5 db 91h,85h,8Dh (Hex)<br /><br />Note that I&#39;ve added 80 hex (128 decimal) to each character value.<br />Note that these strings are not terminated with zero, as if &quot;know the length of the string we&#39;re sending&quot;.<br /><br />I&#39;m not sure what your implementation requirements are.. but that&#39;s how the command strings are encoded before being sent.<br /><br /></div>
    <div class="meta">Posted on 2006-03-08 00:44:46 by Homer</div>
   </div>
   <div class="post" id="post-170341">
    <div class="subject"><a href="#post-170341">Re: Geochemistry project ?</a></div>
    <div class="body">Thanks for helping Tom. Should I just refer him here for furthur questions ?<br /><br />: Re: Geochemistry project ?<br />: « Reply #1 on: March 08, 2006, 01:44:46 pm »<br />: Reply with quoteQuote<br /><br />Thanks Andy, this has been very helpful. However, there is one part that is still confusing. In the command strings (ie. \021xH\r) I understand converting \021 and \r to 80hex, but xH is a bit different. My pump id is 0 so x=0. The letters H, A, D, S, P, G, Q, M, R, T, K, and C all correspond to a certain function that the titrator must perform. For example to just dispense a certain amount of acid, I must do the following (not converted to 80hex):<br />*remember x=0 in reality, but leaving the x in here divides the sting up better.<br />\021xA\r this sets the dispenser to Auto mode<br />\021xDyyyy\r this tells the dispenser to run the pump for yyyy revolutions meaning dispense yyyy amount of acid.<br />\021xS\r requests the dispenser&#39;s status and it should respond with xc\r (x=0 still and c equals some bit that corresponds to a set of errors that could happen in the process)<br />\021xM\r this sets the dinspenser back to manual mode, terminating the dispensing period.<br /><br />I hope this all makes sense. Would I leave the letters in the string or do they need to be converted somehow. Also when they request the character to be ORed, is that done by putting a comma between them like you did with 91h,85h,8Dh?<br /><br />Once again thanks for your help.<br />Tom</div>
    <div class="meta">Posted on 2006-03-09 10:13:28 by skywalker</div>
   </div>
   <div class="post" id="post-170366">
    <div class="subject"><a href="#post-170366">Re: Geochemistry project ?</a></div>
    <div class="body">The comma is just how I&#39;ve shown each character separated and doesn&#39;t belong in the control string.. since these strings contain some &quot;non-printable character codes&quot;, I&#39;ve shown the ASCII VALUES for each character separated by commas.<br /><br />As for the OR operation, it needs to be applied to EVERY character in the string you made.<br /><br />Another way of saying OR with 80h is &quot;turn on the high bit of each character&quot;.<br /><br />If we A)build a control string, B)convert each character to 8 bit binary, C)set bit 7 (the leftmost or high bit) to 1, and D) convert each 8 bit binary value back to decimal or hexadecimal... then we&#39;ve achieved what is required.<br /><br />Clear as mud?<br /></div>
    <div class="meta">Posted on 2006-03-09 23:34:24 by Homer</div>
   </div>
   <div class="post" id="post-178580">
    <div class="subject"><a href="#post-178580">Re: Geochemistry project ?</a></div>
    <div class="body"><div class="quote"><br />The comma is just how I&#39;ve shown each character separated and doesn&#39;t belong in the control string.. since these strings contain some &quot;non-printable character codes&quot;, I&#39;ve shown the ASCII VALUES for each character separated by commas.<br /><br /></div><br /><br />In order to distinguish a pump command from a sampler <br />command, each character in the command strings is ORed <br />with 80Hex, i.e., the most significant bit of the ASCII character <br />is set before going out of the serial HOST port. <br /><br /><br />What exactly does it mean that the most significan bit of the ASCII character is set before going out of the serial Host port? Which is the most significan bit, and how do I know? Is it set by changing everything to hex? <br />Thanks for the help. <br /><br />Also another note, I am using terminal functions or macros to run these commands in a statistical/Excellike program called Igor Pro. Should I send each hex number separately or together in s string? <br /><br />Thanks a lot for your help. <br /><br />Tom <br /></div>
    <div class="meta">Posted on 2006-03-24 14:45:56 by skywalker</div>
   </div>
   <div class="post" id="post-178599">
    <div class="subject"><a href="#post-178599">Re: Geochemistry project ?</a></div>
    <div class="body"><br />You need to take a look at the ASCII TABLE to understand what I mean about setting the high bit in the ascii characters which comprise the command string.<br /><br />You can form a string and then send it as a string, as long as the string contains characters OR&#39;d as specified, and not simply plaintext characters.</div>
    <div class="meta">Posted on 2006-03-25 09:13:32 by Homer</div>
   </div>
  </div>
 </body>
</html>