<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Stack and registers - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=9340" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=9340">Stack and registers</a></p>
   <div class="post" id="post-68958">
    <div class="subject"><a href="#post-68958">Stack and registers</a></div>
    <div class="body">further to the thread <a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?threadid=9328/">Predefined WNDCLASSEX? Any dis-/advantage?</a> I ponder upon how it works. If I start a program hInstance points at address 400000h as the start position for the code. If I start another program that code also starts at address 400000h. At least I think so. If the first program is running in the background it uses stack and registers at the same time as I am running the other program. This means that both programs uses for example EAX at the same time. To my question. Are there more registers and stacks or are there one set for each program or how does it works. How can a program find its register, stack and code start point.</div>
    <div class="meta">Posted on 2002-12-04 03:00:21 by minor28</div>
   </div>
   <div class="post" id="post-68982">
    <div class="subject"><a href="#post-68982">Stack and registers</a></div>
    <div class="body">The OS saves and restores each program's registers when it switches tasks. :)</div>
    <div class="meta">Posted on 2002-12-04 04:43:05 by S/390</div>
   </div>
   <div class="post" id="post-68986">
    <div class="subject"><a href="#post-68986">Stack and registers</a></div>
    <div class="body">minor,<br /><br />What happens is that the operating system provides a seperate memory space for each running EXE file that has the same starting address for each program.<br /><br />The mechanics of this are done in the operating system's loader so you don't really have to worry much about it. With each PE EXE file you write, the starting address is almost always 400000h and this is how these EXE files run in a multitasking environment.<br /><br />A DLL is a different matter as it can be used by more than one program so it does not have a fixed starting address, this is determined at load time by the operating system. It is usually referred to as &quot;relocation&quot;.<br /><br />When you have a bit more work done and if you are interested, there is a lot of data available on the file format of PE files and that will give you a very good idea of how the OS loader and PE files work.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-12-04 04:54:32 by hutch--</div>
   </div>
   <div class="post" id="post-68998">
    <div class="subject"><a href="#post-68998">Stack and registers</a></div>
    <div class="body">An exe file almost always loads at 40000h in the memory. So therefore the hinstance is almost always 40000h.</div>
    <div class="meta">Posted on 2002-12-04 05:49:06 by roticv</div>
   </div>
   <div class="post" id="post-69072">
    <div class="subject"><a href="#post-69072">Stack and registers</a></div>
    <div class="body">Out of curiosity (though I suppose it probably doesn't make a difference) would using org 100000h (or anything other than 40000h) affect where your program would begin in memory?<br /><br />Speaking of the stack, I was looking at the thread about constructing strings on the stack <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=8367&amp;highlight=stack+string+ebp">(here)</a>.    I noticed he was doing<br /><br /><pre><code>mov ebp, esp<br />...<br />mov dword ptr&#91;ebp-8&#93;, &quot;TATS&quot;</code></pre> <br /><br />I tried it last night, but increasing from ebp instead of coming from underneath.  Ie, I was doing<br /><br /><pre><code>mov dword ptr&#91;ebp+4&#93;, &quot;lleH&quot;</code></pre><br /><br /><br />Is either way fine?  The stack pointer decreases when you use push, so maybe this isn't a good way to do it  :confused:</div>
    <div class="meta">Posted on 2002-12-04 12:22:32 by Miko</div>
   </div>
   <div class="post" id="post-69084">
    <div class="subject"><a href="#post-69084">Stack and registers</a></div>
    <div class="body">Thanks Hutch<br /><br />Interesting answer. I searched the web and found that PE means Portable executeble file format. Understood a few words.  I take your advice and don't worry and when I have a bit more work done I might come back to PE and OS loader.<br /><br />Regards</div>
    <div class="meta">Posted on 2002-12-04 13:31:46 by minor28</div>
   </div>
  </div>
 </body>
</html>