<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Drawing Pixels With VESA - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30006" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=30006">Drawing Pixels With VESA</a></p>
   <div class="post" id="post-211817">
    <div class="subject"><a href="#post-211817">Drawing Pixels With VESA</a></div>
    <div class="body">Hello,<br /> I&#039;m now wanting to do some things in Assembly using VESA. I&#039;ve already know how to set the mode that I want, in this case 103h, that will set the resolution to 800x600x256(all according to <a target="_blank" href="http://www.ctyme.com/intr/rb-0275.htm">Ralf Brown&#039;s Interrupt List</a>), like this:<br /><pre><code>mov ax, 4F02h<br />mov bx, 103h<br />int 10h</code></pre><br />I want to know how could I draw some pixels to the screen, things like a line, or an X..<br /><br />Best Regards,<br /> Nathan Paulino Campos</div>
    <div class="meta">Posted on 2010-05-23 14:30:06 by nathanpc</div>
   </div>
   <div class="post" id="post-211818">
    <div class="subject"><a href="#post-211818">Re: Drawing Pixels With VESA</a></div>
    <div class="body">I don&#039;t know if the bios putpixel routine works in hi-res modes or not. Too slow to use, in any case, even in mode 13h!<br /><br />You can throw pixels at A000:xxxx, just like in mode 13h (do you know how to do it in mode 13h?). The difference is that 64k won&#039;t cover the screen in hi-res modes. We have access to a 64k &quot;window&quot; or &quot;bank&quot; at a time. For the remainder of the screen, we have to &quot;switch banks&quot; (int 10h/4F05h), and start over at A000:0000. Switching banks is slow enough that you want to keep a &quot;current bank&quot; variable, and switch only if you have to. (an alternative is asking for a linear frame buffer - set a high bit in bx when doing int 10h/4F02h, but the address isn&#039;t accessable from &quot;regular real mode&quot;, and the bios int isn&#039;t available from 32-bit code... sigh... &quot;flat real mode&quot; will do it, but you have to start in &quot;real dos&quot; to get there)<br /><br />Drawing a horizontal line is easy. A vertical line is easy. A &quot;45 degree&quot; (depending on the shape of the pixels) line is easy. For an arbitrary line, look into &quot;Bresenham&#039;s Algorithm&quot; (last I knew, he had a homepage, but I can&#039;t find it now). He&#039;s got a circle algorithm, too.<br /><br />Lemme attach an example, I guess... This isn&#039;t exactly what you want, but may give you ideas. Not recently tested, but I think it used to work. Some dead code in it... needs cleaning up... not today...<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=3150" target="_blank">garfvid.asm</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2010-05-23 16:56:23 by fbkotler</div>
   </div>
   <div class="post" id="post-211825">
    <div class="subject"><a href="#post-211825">Re: Drawing Pixels With VESA</a></div>
    <div class="body"><pre><code><br />;&nbsp; line.asm Draw a line using Bresenham&#039;s algorithmn&nbsp; <br />;<br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />.model&nbsp;  small<br />.stack&nbsp;  200h&nbsp; &nbsp; ; 512 byte stack<br /><br />.data<br /><br />vid_mode&nbsp; db&nbsp; &nbsp; &nbsp; &nbsp; 0<br />start_x&nbsp;  dw&nbsp; &nbsp; &nbsp; &nbsp; 0<br />end_x&nbsp; &nbsp;  dw&nbsp; &nbsp; &nbsp; &nbsp; 319<br />start_y&nbsp;  dw&nbsp; &nbsp; &nbsp; &nbsp; 0<br />end_y&nbsp; &nbsp;  dw&nbsp; &nbsp; &nbsp; &nbsp; 199<br />color&nbsp; &nbsp;  db&nbsp; &nbsp; &nbsp; &nbsp; 2<br /><br />diagonal_y_increment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br />diagonal_x_increment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br />short_distance&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br />straight_x_increment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br />straight_y_increment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br />straight_count&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br />diagonal_count&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br /><br />.code<br /><br />start:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; ax,@data<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; ds,ax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ah,0fh&nbsp; &nbsp; &nbsp;  ; determine current video mode<br />&nbsp; &nbsp; &nbsp; &nbsp;  int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10h<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vid_mode,al&nbsp; ; move mode value into buffer<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;set screen mode<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; ah,0<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; al,4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; orig. value = 4<br />&nbsp; &nbsp; &nbsp; &nbsp;  int&nbsp; &nbsp; &nbsp; &nbsp; 10h<br /><br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; cx,1<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; dx,1<br /><br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; di,end_y<br />&nbsp; &nbsp; &nbsp; &nbsp;  sub&nbsp; &nbsp; &nbsp; &nbsp; di,start_y<br />&nbsp; &nbsp; &nbsp; &nbsp;  jge&nbsp; &nbsp; &nbsp; &nbsp; keep_y<br />&nbsp; &nbsp; &nbsp; &nbsp;  neg&nbsp; &nbsp; &nbsp; &nbsp; dx<br />&nbsp; &nbsp; &nbsp; &nbsp;  neg&nbsp; &nbsp; &nbsp; &nbsp; di<br />keep_y:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  diagonal_y_increment,dx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  si,end_x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp; &nbsp;  si,start_x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jge&nbsp; &nbsp; &nbsp;  keep_x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neg&nbsp; &nbsp; &nbsp;  cx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neg&nbsp; &nbsp; &nbsp;  si<br />keep_x:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  diagonal_y_increment,cx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp; &nbsp;  si,di<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jge&nbsp; &nbsp; &nbsp;  horz_seg<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  cx,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xchg&nbsp; &nbsp; &nbsp; si,di<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp; &nbsp;  save_values<br />horz_seg:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  dx,0<br />save_values:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  short_distance,di<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  straight_x_increment,cx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  straight_y_increment,dx<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  ax,short_distance<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shl&nbsp; &nbsp; &nbsp;  ax,1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  straight_count,ax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp; &nbsp;  ax,si<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  bx,ax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp; &nbsp;  ax,si<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  diagonal_count,ax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  cx,start_x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  dx,start_y<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc&nbsp; &nbsp; &nbsp;  si<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  al,color<br /><br />mainloop:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dec&nbsp; &nbsp; &nbsp;  si<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jz&nbsp; &nbsp; &nbsp; &nbsp; line_finished<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  ah,12<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp; &nbsp;  10h<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp; &nbsp;  bx,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jge&nbsp; &nbsp; &nbsp;  diagonal_line<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp;  cx,straight_x_increment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp;  dx,straight_y_increment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp;  bx,straight_count&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp; &nbsp;  mainloop<br /><br />diagonal_line:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp;  cx,diagonal_x_increment<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp;  dx,diagonal_y_increment <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp;  bx,diagonal_count<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp; &nbsp;  mainloop<br /><br />line_finished:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ah,0&nbsp; &nbsp;  ; function no. for read<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1ah&nbsp; &nbsp; &nbsp; ; get the time of day count<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  add&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dx,36&nbsp; &nbsp; ; add « second(9) delay to low word<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bx,dx&nbsp; &nbsp; ; store end of delay value in bx<br />repeat:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1ah<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  cmp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dx,bx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jne&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; repeat<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ah,0&nbsp; &nbsp; &nbsp; &nbsp;  ; restore original video mode<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; al,vid_mode&nbsp; ;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10h<br /><br />exit:<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ax,4c00h<br />&nbsp; &nbsp; &nbsp; &nbsp;  int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 21h<br /><br />end&nbsp; &nbsp;  start<br /></code></pre></div>
    <div class="meta">Posted on 2010-05-24 11:48:54 by skywalker</div>
   </div>
   <div class="post" id="post-211834">
    <div class="subject"><a href="#post-211834">Re: Drawing Pixels With VESA</a></div>
    <div class="body">I&#039;ve tried, but I got this errors:<br /><pre><code>C:\Documents and Settings\Nathan\Desktop&gt;nasm vesa.asm<br />vesa.asm:5: error: attempt to define a local label before any non-local labels<br />vesa.asm:5: error: parser: instruction expected<br />vesa.asm:6: error: attempt to define a local label before any non-local labels<br />vesa.asm:6: error: parser: instruction expected<br />vesa.asm:8: error: attempt to define a local label before any non-local labels<br />vesa.asm:121: error: parser: instruction expected<br /><br />C:\Documents and Settings\Nathan\Desktop&gt;</code></pre><br /><br />Any help?</div>
    <div class="meta">Posted on 2010-05-26 16:59:23 by nathanpc</div>
   </div>
   <div class="post" id="post-211836">
    <div class="subject"><a href="#post-211836">Re: Drawing Pixels With VESA</a></div>
    <div class="body"><div class="quote"><br />I&#039;ve tried, but I got this errors:<br /><pre><code>C:\Documents and Settings\Nathan\Desktop&gt;nasm vesa.asm<br />vesa.asm:5: error: attempt to define a local label before any non-local labels<br />vesa.asm:5: error: parser: instruction expected<br />vesa.asm:6: error: attempt to define a local label before any non-local labels<br />vesa.asm:6: error: parser: instruction expected<br />vesa.asm:8: error: attempt to define a local label before any non-local labels<br />vesa.asm:121: error: parser: instruction expected<br /><br />C:\Documents and Settings\Nathan\Desktop&gt;</code></pre><br /><br />Any help?<br /></div><br /><br />Perhaps it is not NASM syntax?</div>
    <div class="meta">Posted on 2010-05-26 18:54:54 by SpooK</div>
   </div>
   <div class="post" id="post-211837">
    <div class="subject"><a href="#post-211837">Re: Drawing Pixels With VESA</a></div>
    <div class="body">SpooK is correct. Skywalker&#039;s code is Masm/Tasm(?) syntax. I&#039;ll bet Japheth&#039;s JWASM would assemble it. (tries it... nope. Doesn&#039;t like &quot;repeat&quot; as a label name!?!? Macro command? Change to &quot;repeat_loop&quot;... yep!)<br /><br />But we can beat it into Nasm syntax fairly easily...<br /><br /><pre><code><br /><br />;&nbsp; line.asm Draw a line using Bresenham&#039;s algorithm<br />;<br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br /><br /><br />; Here&#039;s Nasm&#039;s first complaint. Masm/Tasm use &#039;.&#039; to begin directives,<br />; Nasm uses &#039;.&#039; to begin local labels. As it happens, I don&#039;t think we<br />; need it at all, in this case.<br /><br />;.model&nbsp;  small<br /><br />; Same here, but we do want a stack... (named &quot;stack&quot;,<br />; of type &quot;stack&quot;)<br /><br />;.stack&nbsp;  200h&nbsp; &nbsp; ; 512 byte stack<br />segment stack stack<br />&nbsp; &nbsp; resb 200h<br /><br />; .data<br />segment data ; defaults should be okay here<br /><br />vid_mode&nbsp; db&nbsp; &nbsp; &nbsp; &nbsp; 0<br />start_x&nbsp;  dw&nbsp; &nbsp; &nbsp; &nbsp; 0<br />end_x&nbsp; &nbsp;  dw&nbsp; &nbsp; &nbsp; &nbsp; 319<br />start_y&nbsp;  dw&nbsp; &nbsp; &nbsp; &nbsp; 0<br />end_y&nbsp; &nbsp;  dw&nbsp; &nbsp; &nbsp; &nbsp; 199<br />color&nbsp; &nbsp;  db&nbsp; &nbsp; &nbsp; &nbsp; 2<br /><br /><br />; Nasm doesn&#039;t know &#039;?&#039;. Use &quot;resw 1&quot;, or...<br /><br />%define ? 0<br /><br />diagonal_y_increment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br />diagonal_x_increment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br />short_distance&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br />straight_x_increment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br />straight_y_increment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br />straight_count&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br />diagonal_count&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw&nbsp; &nbsp; &nbsp; &nbsp; ?<br /><br />; .code<br /><br />segment code ; defaults okay?<br /><br />; Masm/Tasm use &quot;end start&quot; to define &quot;start&quot; as the entrypoint.<br />; Nasm uses the special symbol &quot;..start&quot;.<br /><br />;start:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /><br />..start:<br /><br />;&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; ax,@data<br />	mov ax, data<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; ds,ax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ah,0fh&nbsp; &nbsp; &nbsp;  ; determine current video mode<br />&nbsp; &nbsp; &nbsp; &nbsp;  int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10h<br /><br />; The distinction between a memory address and the contents<br />; of memory at that address is obviously an important one!<br />; Unfortunately, different assemblers do it differently!<br /><br />;&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vid_mode,al&nbsp; ; move mode value into buffer<br /><br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ,al&nbsp; ; move mode value into buffer<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;set screen mode<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; ah,0<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; al,4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; orig. value = 4<br />&nbsp; &nbsp; &nbsp; &nbsp;  int&nbsp; &nbsp; &nbsp; &nbsp; 10h<br />; this is not a vesa mode!<br /><br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; cx,1<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; dx,1<br /><br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; di,<br />&nbsp; &nbsp; &nbsp; &nbsp;  sub&nbsp; &nbsp; &nbsp; &nbsp; di,<br />&nbsp; &nbsp; &nbsp; &nbsp;  jge&nbsp; &nbsp; &nbsp; &nbsp; keep_y<br />&nbsp; &nbsp; &nbsp; &nbsp;  neg&nbsp; &nbsp; &nbsp; &nbsp; dx<br />&nbsp; &nbsp; &nbsp; &nbsp;  neg&nbsp; &nbsp; &nbsp; &nbsp; di<br />keep_y:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  ,dx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  si,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp; &nbsp;  si,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jge&nbsp; &nbsp; &nbsp;  keep_x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neg&nbsp; &nbsp; &nbsp;  cx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neg&nbsp; &nbsp; &nbsp;  si<br />keep_x:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  ,cx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp; &nbsp;  si,di<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jge&nbsp; &nbsp; &nbsp;  horz_seg<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  cx,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xchg&nbsp; &nbsp; &nbsp; si,di<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp; &nbsp;  save_values<br />horz_seg:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  dx,0<br />save_values:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  ,di<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  ,cx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  ,dx<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  ax,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shl&nbsp; &nbsp; &nbsp;  ax,1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  ,ax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp; &nbsp;  ax,si<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  bx,ax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp; &nbsp;  ax,si<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  ,ax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  cx,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  dx,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc&nbsp; &nbsp; &nbsp;  si<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  al,<br /><br />mainloop:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dec&nbsp; &nbsp; &nbsp;  si<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jz&nbsp; &nbsp; &nbsp; &nbsp; line_finished<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp;  ah,12<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp; &nbsp;  10h<br /><br />; slow as molases!!! Call your own putpixel (suitable to your mode)<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp; &nbsp;  bx,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jge&nbsp; &nbsp; &nbsp;  diagonal_line<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp;  cx,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp;  dx,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp;  bx,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp; &nbsp;  mainloop<br /><br />diagonal_line:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp;  cx,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp;  dx, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp;  bx,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp; &nbsp;  mainloop<br /><br />line_finished:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ah,0&nbsp; &nbsp;  ; function no. for read<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1ah&nbsp; &nbsp; &nbsp; ; get the time of day count<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  add&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dx,36&nbsp; &nbsp; ; add « second(9) delay to low word<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bx,dx&nbsp; &nbsp; ; store end of delay value in bx<br />repeat:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1ah<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  cmp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dx,bx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jne&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; repeat<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ah,0&nbsp; &nbsp; &nbsp; &nbsp;  ; restore original video mode<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; al,&nbsp; ;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10h<br /><br />exit:<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ax,4c00h<br />&nbsp; &nbsp; &nbsp; &nbsp;  int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 21h<br /><br />; end&nbsp; &nbsp;  start<br /></code></pre><br /><br />This assembles as &quot;nasm -f obj ...&quot;, and links with Alink (running under Linux) without complaints. This does *not* mean it is correct! I could have missed a spot or two. It has not been tested!<br /><br />I don&#039;t even remember what mode 4 is. I&#039;d have expected mode 13h. May need some modifications to upgrade it to VESA modes. Maybe a start...<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2010-05-26 20:01:28 by fbkotler</div>
   </div>
   <div class="post" id="post-211838">
    <div class="subject"><a href="#post-211838">Re: Drawing Pixels With VESA</a></div>
    <div class="body"><div class="quote"><br />I don&#039;t even remember what mode 4 is. <br /></div><br /><br />320x200x4 as per <a target="_blank" href="http://www.ctyme.com/intr/rb-0069.htm">RBIL Int 10/AH=00h</a>.</div>
    <div class="meta">Posted on 2010-05-26 21:40:36 by SpooK</div>
   </div>
   <div class="post" id="post-211839">
    <div class="subject"><a href="#post-211839">Re: Drawing Pixels With VESA</a></div>
    <div class="body">That&#039;s horrid. PITA to write a putpixel for, too. Mode 103h will be easier, actually...<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2010-05-26 21:51:20 by fbkotler</div>
   </div>
  </div>
 </body>
</html>