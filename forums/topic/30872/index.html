<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>How do i create a dialog box? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30872" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=30872">How do i create a dialog box?</a></p>
   <div class="post" id="post-215945">
    <div class="subject"><a href="#post-215945">How do i create a dialog box?</a></div>
    <div class="body">Ok, so i am attempting to create a dialog box. I read that working with dialog boxes was supposed to be easier than using CreateWindowEx but i seem to be pulling my hair more trying to make a dialog box.<br /><br />Well, first of all, i am trying to make a dialog box the raw way. No make resources. So i came up with a simple code:<br /><br /><pre><code>#include &lt;Windows.h&gt;<br /><br />LRESULT CALLBACK WindowProcedure<br />	(<br />		HWND WindowHandle,<br />		UINT Message,<br />		WPARAM WordParameter,<br />		LPARAM LongParameter<br />	)<br />{<br />	HDC DeviceContextHandle;<br />	PAINTSTRUCT PaintStructure;<br />	TRACKMOUSEEVENT MouseEvent;<br /><br />	switch(Message)<br />	{<br />	case WM_INITDIALOG:<br />		return TRUE;<br />	case WM_MOUSEMOVE:<br />		MouseEvent.cbSize = sizeof(TRACKMOUSEEVENT);<br />		MouseEvent.dwFlags = TME_HOVER | TME_LEAVE;<br />		MouseEvent.hwndTrack = WindowHandle;<br />		MouseEvent.dwHoverTime = 0;<br />		TrackMouseEvent(&amp;MouseEvent);<br />		break;<br />	case WM_MOUSEHOVER:<br />		SetClassLongPtr(WindowHandle, GCLP_HBRBACKGROUND, (LONG)CreateSolidBrush(RGB(255,0,0)));<br />		InvalidateRect(WindowHandle, NULL, TRUE);<br />		break;<br />	case WM_MOUSELEAVE:<br />		SetClassLongPtr(WindowHandle, GCLP_HBRBACKGROUND, (LONG)CreateSolidBrush(RGB(0,0,255)));<br />		InvalidateRect(WindowHandle, NULL, TRUE);<br />		break;<br />	case WM_PAINT:<br />		DeviceContextHandle = BeginPaint(WindowHandle, &amp;PaintStructure);<br />		EndPaint(WindowHandle, &amp;PaintStructure);<br />		break;<br />	case WM_DESTROY:<br />		EndDialog(WindowHandle, WM_QUIT);<br />		PostQuitMessage(WM_QUIT);<br />		return TRUE;<br />	}<br />	return DefWindowProc(WindowHandle, Message, WordParameter, LongParameter);<br />}<br /><br />int WINAPI wWinMain<br />	(<br />		HINSTANCE CurretnInstance,<br />		HINSTANCE PreviousInstance,<br />		LPWSTR CommandLine,<br />		int CommandShow<br />	)<br />{<br />	HGLOBAL GlobalHandle = malloc(sizeof(DLGTEMPLATE)*2);<br />	DLGTEMPLATE* DialogTemplate = (LPDLGTEMPLATE)GlobalLock(GlobalHandle);<br />	DialogTemplate-&gt;style =&nbsp; WS_POPUP | WS_BORDER | WS_SYSMENU | DS_MODALFRAME | WS_CAPTION | WS_VISIBLE;<br />	DialogTemplate-&gt;dwExtendedStyle = NULL;<br />	DialogTemplate-&gt;cdit = 0;<br />	DialogTemplate-&gt;x = CW_USEDEFAULT;<br />	DialogTemplate-&gt;y = CW_USEDEFAULT;<br />	DialogTemplate-&gt;cx = CW_USEDEFAULT;<br />	DialogTemplate-&gt;cy = CW_USEDEFAULT;<br /><br />	LRESULT DialogHandle = DialogBoxIndirect//CreateDialogIndirectParam<br />		(<br />			CurretnInstance,<br />			(LPDLGTEMPLATE)GlobalHandle,<br />			NULL,<br />			(DLGPROC)WindowProcedure,<br />			NULL<br />		);<br />	GlobalUnlock(GlobalHandle);<br />	delete Globalhandle;<br />	ShowWindow(DialogHandle, CommandShow);<br /><br />	return 0;<br />}</code></pre><br /><br />But of course, it doesn&#039;t work. Otherwise i would not be asking for help. So then i consult Microsoft&#039;s MSDN site and found a working code: http://msdn.microsoft.com/en-us/library/windows/desktop/ms644996(v=vs.85).aspx#template_in_memory<br /><pre><code>#include &lt;Windows.h&gt;<br />#include &quot;stdafx.h&quot;;<br /><br />//LRESULT CALLBACK WindowProcedure<br />//	(<br />//		HWND WindowHandle,<br />//		UINT Message,<br />//		WPARAM WordParameter,<br />//		LPARAM LongParameter<br />//	)<br />//{<br />//	HDC DeviceContextHandle;<br />//	PAINTSTRUCT PaintStructure;<br />//	TRACKMOUSEEVENT MouseEvent;<br />//<br />//	switch(Message)<br />//	{<br />//	case WM_INITDIALOG:<br />//		return TRUE;<br />//	case WM_MOUSEMOVE:<br />//		MouseEvent.cbSize = sizeof(TRACKMOUSEEVENT);<br />//		MouseEvent.dwFlags = TME_HOVER | TME_LEAVE;<br />//		MouseEvent.hwndTrack = WindowHandle;<br />//		MouseEvent.dwHoverTime = 0;<br />//		TrackMouseEvent(&amp;MouseEvent);<br />//		break;<br />//	case WM_MOUSEHOVER:<br />//		SetClassLongPtr(WindowHandle, GCLP_HBRBACKGROUND, (LONG)CreateSolidBrush(RGB(255,0,0)));<br />//		InvalidateRect(WindowHandle, NULL, TRUE);<br />//		break;<br />//	case WM_MOUSELEAVE:<br />//		SetClassLongPtr(WindowHandle, GCLP_HBRBACKGROUND, (LONG)CreateSolidBrush(RGB(0,0,255)));<br />//		InvalidateRect(WindowHandle, NULL, TRUE);<br />//		break;<br />//	case WM_PAINT:<br />//		DeviceContextHandle = BeginPaint(WindowHandle, &amp;PaintStructure);<br />//		EndPaint(WindowHandle, &amp;PaintStructure);<br />//		break;<br />//	case WM_DESTROY:<br />//		EndDialog(WindowHandle, WM_QUIT);<br />//		PostQuitMessage(WM_QUIT);<br />//		return TRUE;<br />//	}<br />//	return DefWindowProc(WindowHandle, Message, WordParameter, LongParameter);<br />//}<br /><br />#define ID_HELP&nbsp;  150<br />#define ID_TEXT&nbsp;  200<br /><br />BOOL CALLBACK DialogProc(HWND hwndDlg, UINT message, WPARAM wParam, LPARAM lParam)<br />{<br />&nbsp; &nbsp; switch (message)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; case WM_INITDIALOG:<br />&nbsp; &nbsp; &nbsp; &nbsp; return TRUE;<br /><br />&nbsp; &nbsp; case WM_COMMAND:<br />&nbsp; &nbsp; &nbsp; &nbsp; switch (LOWORD(wParam))<br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; case IDOK:<br />&nbsp; &nbsp; &nbsp; &nbsp; case IDCANCEL:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EndDialog(hwndDlg, LOWORD(wParam));<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return TRUE;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; return FALSE;<br />}<br /><br />LPWORD lpwAlign(LPWORD lpIn, ULONG dw2Power = 4)<br />{<br />&nbsp; &nbsp; ULONG ul;<br /><br />&nbsp; &nbsp; ul = (ULONG)lpIn;<br />&nbsp; &nbsp; ul += dw2Power-1;<br />&nbsp; &nbsp; ul &amp;= ~(dw2Power-1);<br />&nbsp; &nbsp; return (LPWORD)ul;<br />}<br /><br /><br />int WINAPI wWinMain<br />	(<br />		HINSTANCE CurretnInstance,<br />		HINSTANCE PreviousInstance,<br />		LPWSTR CommandLine,<br />		int CommandShow<br />	)<br />{<br />	//HGLOBAL GlobalHandle = malloc(sizeof(DLGTEMPLATE)*2);<br />	//DLGTEMPLATE* DialogTemplate = (LPDLGTEMPLATE)GlobalLock(GlobalHandle);<br />	//DialogTemplate-&gt;style =&nbsp; WS_POPUP | WS_BORDER | WS_SYSMENU | DS_MODALFRAME | WS_CAPTION | WS_VISIBLE;<br />	//DialogTemplate-&gt;dwExtendedStyle = NULL;<br />	//DialogTemplate-&gt;cdit = 0;<br />	//DialogTemplate-&gt;x = CW_USEDEFAULT;<br />	//DialogTemplate-&gt;y = CW_USEDEFAULT;<br />	//DialogTemplate-&gt;cx = CW_USEDEFAULT;<br />	//DialogTemplate-&gt;cy = CW_USEDEFAULT;<br /><br />	//LRESULT DialogHandle = DialogBoxIndirect//CreateDialogIndirectParam<br />	//	(<br />	//		CurretnInstance,<br />	//		(LPDLGTEMPLATE)GlobalHandle,<br />	//		NULL,<br />	//		(DLGPROC)WindowProcedure,<br />	//		NULL<br />	//	);<br />	//GlobalUnlock(GlobalHandle);<br />	//delete GlobalHandle;<br />	//ShowWindow(DialogHandle, CommandShow);<br /><br />	HGLOBAL hgbl;<br />&nbsp; &nbsp; LPDLGTEMPLATE lpdt;<br />&nbsp; &nbsp; LPDLGITEMTEMPLATE lpdit;<br />&nbsp; &nbsp; LPWORD lpw;<br />&nbsp; &nbsp; LPWSTR lpwsz;<br />&nbsp; &nbsp; LRESULT ret;<br />&nbsp; &nbsp; int nchar;<br /><br />&nbsp; &nbsp; hgbl = GlobalAlloc(GMEM_ZEROINIT, 512);<br />&nbsp; &nbsp; if (!hgbl)<br />&nbsp; &nbsp; &nbsp; &nbsp; return -1;<br /><br />&nbsp; &nbsp; lpdt = (LPDLGTEMPLATE)GlobalLock(hgbl);<br /><br />&nbsp; &nbsp; // Define a dialog box.<br /><br />&nbsp; &nbsp; lpdt-&gt;style = WS_POPUP | WS_BORDER | WS_SYSMENU | DS_MODALFRAME | WS_CAPTION;<br />&nbsp; &nbsp; lpdt-&gt;cdit = 3;&nbsp; &nbsp; &nbsp; &nbsp;  // Number of controls<br />&nbsp; &nbsp; lpdt-&gt;x&nbsp; = 10;&nbsp; lpdt-&gt;y&nbsp; = 10;<br />&nbsp; &nbsp; lpdt-&gt;cx = 100; lpdt-&gt;cy = 100;<br /><br />&nbsp; &nbsp; lpw = (LPWORD)(lpdt + 1);<br />&nbsp; &nbsp; *lpw++ = 0;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  // No menu<br />&nbsp; &nbsp; *lpw++ = 0;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  // Predefined dialog box class (by default)<br /><br />&nbsp; &nbsp; lpwsz = (LPWSTR)lpw;<br />&nbsp; &nbsp; nchar = MultiByteToWideChar(CP_ACP, 0, &quot;My Dialog&quot;, -1, lpwsz, 50);<br />&nbsp; &nbsp; lpw += nchar;<br /><br />&nbsp; &nbsp; //-----------------------<br />&nbsp; &nbsp; // Define an OK button.<br />&nbsp; &nbsp; //-----------------------<br />&nbsp; &nbsp; lpw = lpwAlign(lpw);&nbsp; &nbsp; // Align DLGITEMTEMPLATE on DWORD boundary<br />&nbsp; &nbsp; lpdit = (LPDLGITEMTEMPLATE)lpw;<br />&nbsp; &nbsp; lpdit-&gt;x&nbsp; = 10; lpdit-&gt;y&nbsp; = 70;<br />&nbsp; &nbsp; lpdit-&gt;cx = 80; lpdit-&gt;cy = 20;<br />&nbsp; &nbsp; lpdit-&gt;id = IDOK;&nbsp; &nbsp; &nbsp;  // OK button identifier<br />&nbsp; &nbsp; lpdit-&gt;style = WS_CHILD | WS_VISIBLE | BS_DEFPUSHBUTTON;<br /><br />&nbsp; &nbsp; lpw = (LPWORD)(lpdit + 1);<br />&nbsp; &nbsp; *lpw++ = 0xFFFF;<br />&nbsp; &nbsp; *lpw++ = 0x0080;&nbsp; &nbsp; &nbsp; &nbsp; // Button class<br /><br />&nbsp; &nbsp; lpwsz = (LPWSTR)lpw;<br />&nbsp; &nbsp; nchar = MultiByteToWideChar(CP_ACP, 0, &quot;OK&quot;, -1, lpwsz, 50);<br />&nbsp; &nbsp; lpw += nchar;<br />&nbsp; &nbsp; *lpw++ = 0;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  // No creation data<br /><br />&nbsp; &nbsp; //-----------------------<br />&nbsp; &nbsp; // Define a Help button.<br />&nbsp; &nbsp; //-----------------------<br />&nbsp; &nbsp; lpw = lpwAlign(lpw);&nbsp; &nbsp; // Align DLGITEMTEMPLATE on DWORD boundary<br />&nbsp; &nbsp; lpdit = (LPDLGITEMTEMPLATE)lpw;<br />&nbsp; &nbsp; lpdit-&gt;x&nbsp; = 55; lpdit-&gt;y&nbsp; = 10;<br />&nbsp; &nbsp; lpdit-&gt;cx = 40; lpdit-&gt;cy = 20;<br />&nbsp; &nbsp; lpdit-&gt;id = ID_HELP;&nbsp; &nbsp; // Help button identifier<br />&nbsp; &nbsp; lpdit-&gt;style = WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON;<br /><br />&nbsp; &nbsp; lpw = (LPWORD)(lpdit + 1);<br />&nbsp; &nbsp; *lpw++ = 0xFFFF;<br />&nbsp; &nbsp; *lpw++ = 0x0080;&nbsp; &nbsp; &nbsp; &nbsp; // Button class atom<br /><br />&nbsp; &nbsp; lpwsz = (LPWSTR)lpw;<br />&nbsp; &nbsp; nchar = MultiByteToWideChar(CP_ACP, 0, &quot;Help&quot;, -1, lpwsz, 50);<br />&nbsp; &nbsp; lpw += nchar;<br />&nbsp; &nbsp; *lpw++ = 0;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  // No creation data<br /><br />&nbsp; &nbsp; //-----------------------<br />&nbsp; &nbsp; // Define a static text control.<br />&nbsp; &nbsp; //-----------------------<br />&nbsp; &nbsp; lpw = lpwAlign(lpw);&nbsp; &nbsp; // Align DLGITEMTEMPLATE on DWORD boundary<br />&nbsp; &nbsp; lpdit = (LPDLGITEMTEMPLATE)lpw;<br />&nbsp; &nbsp; lpdit-&gt;x&nbsp; = 10; lpdit-&gt;y&nbsp; = 10;<br />&nbsp; &nbsp; lpdit-&gt;cx = 40; lpdit-&gt;cy = 20;<br />&nbsp; &nbsp; lpdit-&gt;id = ID_TEXT;&nbsp; &nbsp; // Text identifier<br />&nbsp; &nbsp; lpdit-&gt;style = WS_CHILD | WS_VISIBLE | SS_LEFT;<br /><br />&nbsp; &nbsp; lpw = (LPWORD)(lpdit + 1);<br />&nbsp; &nbsp; *lpw++ = 0xFFFF;<br />&nbsp; &nbsp; *lpw++ = 0x0082;&nbsp; &nbsp; &nbsp; &nbsp; // Static class<br /><br />&nbsp; &nbsp; lpwsz = (LPWSTR)lpw;<br />&nbsp; &nbsp; nchar = MultiByteToWideChar(CP_ACP, 0, &quot;Message&quot;, -1, lpwsz, 150);<br />&nbsp; &nbsp; lpw += nchar;<br />&nbsp; &nbsp; *lpw++ = 0;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  // No creation data<br /><br />&nbsp; &nbsp; GlobalUnlock(hgbl);<br />&nbsp; &nbsp; ret = DialogBoxIndirect(<br />		CurretnInstance,<br />&nbsp; &nbsp; &nbsp; &nbsp; (LPDLGTEMPLATE)hgbl,<br />&nbsp; &nbsp; &nbsp; &nbsp; NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; (DLGPROC)DialogProc);<br />&nbsp; &nbsp; GlobalFree(hgbl);<br /><br /><br />	return 0;<br />}</code></pre><br /><br />Then what is the problem? Well, i want to start from making a button-less dialog box so when i try to remove any, and i mean ANY even just one dialog item; the entire dialog box doesn&#039;t show. Just like my dialog box.</div>
    <div class="meta">Posted on 2012-04-11 11:44:46 by banzemanga</div>
   </div>
   <div class="post" id="post-215950">
    <div class="subject"><a href="#post-215950">Re: How do i create a dialog box?</a></div>
    <div class="body">After lot of documentation reading and experimenting, i found what the problem was.<br /><br />The &quot;cdit&quot; variable of the &quot;DLGTEMPLATE&quot; structure must be 0 for blank dialog windows. And for every control there is, that is the value in it. For example, if the dialog window has 3 controls then the value is 3.<br /><br />Also, it is important that the numbers of controls and the cdit value match. If there are 2 controls and the value is 3, the dialog box would not show. And if there are 4 controls but the value is 3, it will only parse the first three controls.</div>
    <div class="meta">Posted on 2012-04-11 19:47:53 by banzemanga</div>
   </div>
  </div>
 </body>
</html>