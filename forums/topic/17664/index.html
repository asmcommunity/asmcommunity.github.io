<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>first nasm window - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17664" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=17664">first nasm window</a></p>
   <div class="post" id="post-136527">
    <div class="subject"><a href="#post-136527">first nasm window</a></div>
    <div class="body">Hi everyone, I'm learning assembly with the NASM compiler and ALINK (to accompany and debug my C++ apps). I've tried to piece meal something together with my prior win32 background and the wee bit of ASM I know and came up with the below example. It compiles and links but does not run. I'm not entirely sure what the problem is, I'm suspecting maybe my entry or misuse of jumps? Thanks for the help!<br /><br /><pre><code><br />%INCLUDE &quot;..\inc\win32n.inc&quot;<br /><br />EXTERN GetModuleHandleA<br />EXTERN LoadIconA<br />EXTERN LoadCursorA<br />EXTERN GetStockObject<br />EXTERN RegisterClassA<br />EXTERN CreateWindowExA<br />EXTERN ShowWindow<br />EXTERN UpdateWindow<br />EXTERN GetMessageA<br />EXTERN TranslateMessage<br />EXTERN DispatchMessageA<br />EXTERN DestroyWindow<br />EXTERN PostQuitMessage<br />EXTERN DefWindowProcA<br />EXTERN GetLastError<br />EXTERN ExitProcess<br />EXTERN MessageBoxA<br /><br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />SECTION DATA USE32 CLASS=DATA<br />WindowClassStruc&#58;				ISTRUC WNDCLASS<br />AT WNDCLASS.style,         DD CS_HREDRAW | CS_VREDRAW<br />AT WNDCLASS.lpfnWndProc,   DD MainProc<br />AT WNDCLASS.cbClsExtra,    DD 0<br />AT WNDCLASS.cbWndExtra,    DD 0<br />AT WNDCLASS.hInstance,     DD 0<br />AT WNDCLASS.hIcon,         DD NULL<br />AT WNDCLASS.hCursor,       DD NULL<br />AT WNDCLASS.hbrBackground, DD NULL<br />AT WNDCLASS.lpszMenuName,  DD NULL<br />AT WNDCLASS.lpszClassName, DD ClassName<br />IEND<br /><br />WindowMSG&#58;<br />ISTRUC MSG<br />AT MSG.hwnd,    DD 0<br />AT MSG.message, DD 0<br />AT MSG.wParam,  DD 0<br />AT MSG.lParam,  DD 0<br />AT MSG.time,    DD 0<br />AT MSG.pt,      DD 0<br />IEND<br /><br />WindowTitle DB 'testing',0<br />ClassName DB 'asmprogthing',0<br />SECTION BSS USE32 CLASS=DATA<br />WindowHandle		RESD 1<br />g_hInst			RESD 1<br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />SECTION CODE USE32 CLASS=CODE<br />global main<br />main&#58;<br /><br />PUSH LPCTSTR NULL<br />CALL &#91;GetModuleHandleA&#93;<br />MOV &#91;WindowClassStruc+WNDCLASS.hInstance&#93;,EAX<br /><br />PUSH LPCTSTR IDI_APPLICATION<br />PUSH HINSTANCE NULL   <br />CALL &#91;LoadIconA&#93;<br />MOV &#91;WindowClassStruc+WNDCLASS.hIcon&#93;,EAX<br /><br />PUSH LPCTSTR IDC_ARROW<br />PUSH HINSTANCE NULL<br />CALL &#91;LoadCursorA&#93;<br />MOV &#91;WindowClassStruc+WNDCLASS.hCursor&#93;,EAX<br /><br />PUSH INTEGER WHITE_BRUSH<br />CALL &#91;GetStockObject&#93;<br />MOV &#91;WindowClassStruc+WNDCLASS.hbrBackground&#93;,EAX<br /><br />PUSH DWORD WindowClassStruc<br />CALL &#91;RegisterClassA&#93;<br />TEST EAX,EAX<br />JZ NEAR error<br /><br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />PUSH LPCTSTR NULL<br />CALL &#91;GetModuleHandleA&#93;<br /><br />PUSH LPVOID NULL<br />PUSH HINSTANCE EAX<br />PUSH HMENU NULL<br />PUSH HWND NULL<br />PUSH INTEGER CW_USEDEFAULT<br />PUSH INTEGER CW_USEDEFAULT<br />PUSH INTEGER CW_USEDEFAULT<br />PUSH INTEGER CW_USEDEFAULT<br />PUSH DWORD WS_OVERLAPPEDWINDOW<br />PUSH LPCTSTR WindowTitle<br />PUSH LPCTSTR ClassName<br />PUSH DWORD 0<br />CALL &#91;CreateWindowExA&#93;<br />TEST EAX,EAX<br />JZ NEAR error<br />MOV &#91;WindowHandle&#93;,EAX<br /><br />PUSH INTEGER SW_SHOW<br />PUSH HWND EAX<br />CALL &#91;ShowWindow&#93;<br />PUSH HWND &#91;WindowHandle&#93;<br />CALL &#91;UpdateWindow&#93;<br /><br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />msgloop_&#58;<br />PUSH UINT 0<br />PUSH UINT 0<br />PUSH HWND NULL<br />PUSH DWORD WindowMSG<br />CALL &#91;GetMessageA&#93;<br />TEST EAX,EAX<br />JZ quit<br />PUSH DWORD WindowMSG<br />CALL &#91;TranslateMessage&#93;<br />PUSH DWORD WindowMSG<br />CALL &#91;DispatchMessageA&#93;<br />JMP msgloop_<br />quit&#58;<br />PUSH WPARAM &#91;WindowMSG+MSG.wParam&#93;<br />CALL &#91;ExitProcess&#93;<br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />MainProc&#58;<br />%DEFINE EBP_hWnd   EBP+8  ; handle of window<br />%DEFINE EBP_Msg    EBP+12 ; message<br />%DEFINE EBP_wParam EBP+16 ; first message parameter<br />%DEFINE EBP_lParam EBP+20 ; second message parameter<br /><br />ENTER 0,0<br /><br />CMP UINT &#91;EBP_Msg&#93;,WM_CLOSE<br />JE CLS_<br /><br />PUSH LPARAM &#91;EBP_lParam&#93;<br />PUSH WPARAM &#91;EBP_wParam&#93;<br />PUSH UINT &#91;EBP_Msg&#93;<br />PUSH HWND &#91;EBP_hWnd&#93;<br />CALL &#91;DefWindowProcA&#93;<br /><br />LEAVE<br />RETN 16<br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />error&#58;<br />CALL &#91;GetLastError&#93;<br />PUSH UINT EAX<br />CALL &#91;ExitProcess&#93;<br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />CLS_&#58;<br />SUB EAX, EAX<br />LEAVE<br />RETN 16<br /></code></pre><br /><br />Also, I've been able to find examples of windows apps for nasm using nagoa, but not plain nasm. Could someone explain to me what nagoa is and differences in syntax maybe? Thanks again. :)</div>
    <div class="meta">Posted on 2004-03-20 10:57:23 by ben</div>
   </div>
   <div class="post" id="post-136614">
    <div class="subject"><a href="#post-136614">first nasm window</a></div>
    <div class="body">hi ! :)<br /><br /><br />you can write all  your nasm code like that always !  thats great  , you can play around with that , and evean try to simplify , things .<br /><br /><br />then read this NAGOA tutorial :<br /><br /><a target="_blank" href="http://194.65.3.199/win32asm/tutorial/nagoa-tutorial.html">http://194.65.3.199/win32asm/tutorial/nagoa-tutorial.html</a><br /><br /><br />nagoa is just a chain of NASM MACROS  that speeds the code wrinting us MASM macros do , more a lot of equates and STRUC?s etc.. .  and  IF , END IF  , PROC ENDPROC  , Locals var?s etc...     ONLY NASM MACROS .....<br /><br /><br /><br />the macros are all at   NAGOA.INC  , you can look at them :)  <br /><br /><br />its easy to understand them after read the:<br /><br /><a target="_blank" href="http://194.65.3.199/win32asm/tutorial/nagoa-tutorial.html">http://194.65.3.199/win32asm/tutorial/nagoa-tutorial.html</a><br /><br /><br />and download the all NAGOA NASM WIN32ASM package .<br /><br />NAGOA default is    NASM + GORC + ALINK<br /><br /><br />but NAGOA can use ONLY NASM :)<br /><br /><br />to ouput very litle EXE or DLL ... ect.. <br /><br /><br />after downloading all the package and after reading the above tutorial .<br /><br />look at the examples projects that are in NAGOA NASM PACKAGE<br /><br />you can also JOIN   WIN32NASM group here , there are a lot of examples there .<br /><br /><br /><a target="_blank" href="http://groups.yahoo.com/group/win32-nasm-users/">http://groups.yahoo.com/group/win32-nasm-users/</a><br /><br /><br /><br /><br />ha with NAGOA you can always use the real NASM without any macros .<br /><br /><br />NAGOA does not use librarys for linking with ALINK  , we call all API Functions <br /> VIA IAT .<br /><br /><br /><br />like this <br /><br /><br />in fact what this is doing is:<br /><br />push arg_N<br />.<br />.<br />push arg_1<br />import FubctionOfDLL fmod.dll<br />extern FubctionOfDLL<br />CALL <br /><br /><br /><br /><br />so no need of LOADLIBRARY ....  or librarys to link <br /><br /><br /><br /><br /><br /><br />example opening the OpenFileNameA dialog  NASM + ALINK<br />---------------------------------------------------------------------------<br /><br /><br />bss use32    ;  this section will no be in the exe :)<br /><br />ofn:<br />.lStructSize dd 0<br />.hwndOwner dd 0<br />.hInstance dd 0<br />.lpstrFilter dd 0<br />.lpstrCustomFilter dd 0<br />.nMaxCustFilter dd 0<br />.nFilterIndex dd 0<br />.lpstrFile dd 0<br />.nMaxFile dd 0<br />.lpstrFileTitle dd 0<br />.nMaxFileTitle dd 0<br />.lpstrInitialDir dd 0<br />.lpstrTitle dd 0<br />.Flags dd 0<br />.nFileOffset dd 0<br />.nFileExtension dd 0<br />.lpstrDefExt dd 0<br />.lCustData dd 0<br />.lpfnHook dd 0<br />.lpTemplateName dd 0,0<br /><br />ofn_size equ ofn.lpTemplateName - ofn<br /><br /><br /><br /><br /><br />code use32            ; code section<br /><br />..start:<br /><br /><br /><br /><br /><br />mov dword  , ofn_size<br />mov dword  , 1020<br />push ebx                           ; going to use ebx so better save it :)<br />sub ebx , 120                    ; making a bufer from ebx<br />mov  , ebx<br />pop ebx                              ; restore ebx<br /><br />call GetOpenFileNameA,ofn<br /><br />call ExitProcess , 0<br /><br /><br /><br /> <br /><br /><br />the same example another way :)<br />========================<br /><br />   bss use32<br />   ofn    db OPENFILEMNAME_size<br /><br />   code use32            ; code section<br /><br />..start:<br /><br /><br /><br /><br /><br />mov dword  ,OPENFILEMNAME_size<br />mov dword  , 1020<br />push ebx                              ; going to use ebx so better save it :)<br />sub ebx , 120                       ; making a bufer from ebx<br />mov  , ebx<br />pop ebx                              ; restore ebx<br /><br />call GetOpenFileNameA,ofn<br /><br />call ExitProcess , 0<br /><br /><br />this can seem bad but actualy can help you better to track you code :)<br /><br /><br /><br />look here :)<br /><br />   mov dword ,eax<br />   mov dword ,1<br />   mov word ,32<br /><br /><br /><br /> we look ther and knows right way what is happening :)<br /><br /><br /><br />another way of same example <br />=====================<br /><br /><br /><br />   code use32            ; code section<br /><br />..start:<br /><br /><br />loccall MyOpenFile , 120 , 1020 <br /><br /> <br /><br /><br />proc MyOpenFile , Buffer , nMaxFile<br /><br />   stack ofn , OPENFILEMNAME_size<br /><br />mov dword  , OPENFILEMNAME_size<br />m2m dword  , <br />m2m  , <br />call GetOpenFileNameA,addr ofn<br /><br />call ExitProcess,0<br /><br />endproc  MyOpenFile<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />here are   the addr macro    that makes<br /><br />lea eax , <br />push eax<br /><br /><br /><br />the proc    endproc macros  makes automatition of   ret 4*n arguments<br /><br />push ebp<br />mov ebp,esp<br />and %define arg_1 ebp+8 etc...<br />etc..<br /><br /><br />endmacro<br /><br />mov esp,ebp<br />pop ebp<br /><br />ret 4* n arguments<br /><br /><br /><br />the stack macro <br /><br />%define ofn  ebp-OPENFILEMNAME_size<br />sub esp,OPENFILEMNAME_size<br /><br /><br /><br />as you can see the NASM syntax is the SAME .<br /><br /><br /><br />look at this tutorial<br /><br /><br /><a target="_blank" href="http://194.65.3.199/win32asm/tutorial/nagoa-tutorial.html">http://194.65.3.199/win32asm/tutorial/nagoa-tutorial.html</a><br /><br />join this group :<br /><br /><a target="_blank" href="http://groups.yahoo.com/group/win32-nasm-users/">http://groups.yahoo.com/group/win32-nasm-users/</a><br /><br /><br />i hope i help you :)  , i hope there is not to much errors here...</div>
    <div class="meta">Posted on 2004-03-21 16:03:11 by Nguga</div>
   </div>
   <div class="post" id="post-136615">
    <div class="subject"><a href="#post-136615">just a POPUP MENU EXAMPLE</a></div>
    <div class="body">%include &quot;\lab\vasm\inc\nagoa.inc&quot;<br /><br />; - - - - - - - - - - - - - - - - - - - - -<br />bss use32<br /><br />menuhand      dd 0<br />hInstance      dd 0<br />CommandLine dd 0<br />hwnd            dd 0<br />hdc              dd 0<br />wtop            dd 0<br />wleft            dd 0<br />IDM_PICK1     equ 2<br />IDM_PICK2     equ 3<br />IDM_EXIT      equ 1<br />IDM_ABOUT   equ 4<br /><br />; - - - - - - - - - - - - - - - - - - - - -<br />data use32<br /><br />ClassName       db &quot;SimpleWinClass&quot;,0<br />AppName         db &quot;Popup Menu&quot;,0<br />pick1              db &quot;Pick Item 1 &quot;,0<br />pick1_size       equ $ - pick1<br />pick2              db &quot;Pick Item 2 &quot;,0<br />pick2_size       equ $ - pick2<br />about            db &quot;About&quot;,0<br />exit               db &quot;Exit&quot;,0<br />menu             db &quot;Right click for menu item&quot;,0<br />menu_size      equ $-menu<br />MenuName      db &quot;TheMenu&quot;,0<br />wabout          db &quot;Win32asm NaGoA  Nasm&quot; ,NEXT_LINE,NEXT_LINE,NEXT_LINE,\<br />                         &quot;Menu Example made :&quot;,NEXT_LINE,\<br />                         &quot;by Nguga  &quot;,NEXT_LINE,NEXT_LINE,NEXT_LINE,\<br />                         &quot;site  :&quot;,NEXT_LINE,NEXT_LINE,\<br />                         &quot;http://visual-assembler.pt.vu&quot;,0<br />aboutcap        db &quot;Menu Example&quot;,0<br /><br />; - - - - - - - - - - - - - - - - - - - - -<br />code use32<br /><br />..start:<br /><br />	call GetModuleHandle, NULL<br />	mov     ,eax<br />	call GetCommandLine<br />        loccall WinMain, ,NULL,eax, SW_SHOWDEFAULT<br />	call ExitProcess,eax<br /><br />proc WinMain,hInst,hPrevInstace,lpCmdLine,nCmdShow<br />        stack wc,WNDCLASSEX_size<br />	stack msg,MSG_size<br /><br />        mov  dword ,WNDCLASSEX_size<br />	mov  dword , CS_HREDRAW | CS_VREDRAW<br />	mov  dword , WndProc<br />	mov  dword ,NULL<br />	mov  dword ,NULL<br />        push dword <br />        pop  dword <br />	mov  dword ,COLOR_WINDOW+1<br />        mov  dword  , MenuName<br />	mov  dword , ClassName<br />        call LoadIcon,NULL,IDI_APPLICATION<br /><br />	mov ,eax<br />        mov dword ,0<br />        call LoadCursor,NULL,IDC_ARROW<br /><br />	mov   ,eax<br />        call RegisterClassEx, addr wc<br /><br /> .DoAndShow:<br /><br />	 call CreateWindowEx,NULL,ClassName, AppName,\<br />         WS_OVERLAPPEDWINDOW,CW_USEDEFAULT,CW_USEDEFAULT,\<br />         300,300, NULL,NULL,,NULL<br />         <br />         mov , eax<br />	 call ShowWindow, , SW_SHOWNORMAL<br />         call UpdateWindow, <br /><br />        .WHILE_TRUE<br />                call GetMessage, addr msg,NULL,0,0<br />                test eax,eax<br />                jz .ENDW<br />                call TranslateMessage, addr msg<br />                call DispatchMessage, addr msg<br />                jmp .WHILE_TRUE<br />        .ENDW<br />               mov  eax,<br />endproc WinMain<br />;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br /><br />;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br />proc WndProc ,hWnd , uMsg , wParam , lParam<br />        stack rect,RECT_size<br />        stack ps,PAINTSTRUCT_size<br />        stack wmenu,4<br /><br />	IF dword ,e,WM_DESTROY<br />		call PostQuitMessage,NULL<br />        ENDIF<br />        IF dword ,e,WM_PAINT<br />                call GetWindowRect,,addr rect<br />                mov eax,<br />                mov ,eax<br />                mov eax,<br />                mov ,eax<br />                call BeginPaint,, addr ps<br />                mov    ,eax<br />                call TextOut,,0,0,menu,menu_size -1<br />                call EndPaint,, addr ps<br />        ENDIF<br />        IF dword ,e,WM_MOVE<br />                call GetWindowRect,,addr rect<br />                mov eax,<br />                mov ,eax<br />                mov eax,<br />                mov ,eax<br />        ENDIF<br />        IF dword ,e,WM_COMMAND<br />                        IF dword ,e,IDM_PICK1<br />                                call GetDC,<br />                                mov    ,eax<br />                                call SendMessage,,WM_ERASEBKGND,,0<br />                                call TextOut,,0,0, pick1,pick1_size -1<br />                                call EndPaint,, addr ps<br />                        ENDIF<br />                        IF dword ,e,IDM_PICK2<br />                                call GetDC,<br />                                mov    ,eax<br />                                call SendMessage,,WM_ERASEBKGND,,0<br />                                call TextOut,,0,0, pick2,pick2_size -1<br />                                call EndPaint,, addr ps<br />                        ENDIF<br />                        IF dword ,e,IDM_ABOUT<br />                                call MessageBox,NULL,wabout,aboutcap,MB_OK<br />                        ENDIF<br />                        IF dword ,e,IDM_EXIT<br />                                call DestroyWindow,<br />                        ENDIF<br />         ENDIF<br />         IF dword ,e,WM_RBUTTONDOWN<br />                call CreatePopupMenu<br />                mov ,eax<br />                call AppendMenu,,MF_STRING,IDM_PICK1,pick1<br />                call AppendMenu,,MF_STRING,IDM_PICK2,pick2<br />                call AppendMenu,,MF_STRING,IDM_ABOUT,about<br />                call AppendMenu,,MF_STRING,IDM_EXIT,exit<br />                mov ebx,<br />                mov ecx,ebx<br />                and ebx,0ffffh<br />                shr ecx,16<br />                add ebx,<br />                add ecx,<br />                add ecx,20<br />                call TrackPopupMenu,,\<br />                TPM_CENTERALIGN + TPM_LEFTBUTTON,ebx,ecx,0,,NULL<br />         ENDIF<br />                call DefWindowProc,,,,	<br />endproc WndProc</div>
    <div class="meta">Posted on 2004-03-21 16:12:03 by Nguga</div>
   </div>
   <div class="post" id="post-136721">
    <div class="subject"><a href="#post-136721">first nasm window</a></div>
    <div class="body">I downloaded NAGOA and it is very nice, thanks so much for the resources and help.<br /><br />And you're right, those only NASM examples are amazingly small! :grin:</div>
    <div class="meta">Posted on 2004-03-22 18:17:10 by ben</div>
   </div>
   <div class="post" id="post-136726">
    <div class="subject"><a href="#post-136726">first nasm window</a></div>
    <div class="body">thanks BEN  !  :)</div>
    <div class="meta">Posted on 2004-03-22 18:53:10 by Nguga</div>
   </div>
  </div>
 </body>
</html>