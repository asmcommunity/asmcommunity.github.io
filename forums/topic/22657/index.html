<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>user account - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=22657" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=22657">user account</a></p>
   <div class="post" id="post-169896">
    <div class="subject"><a href="#post-169896">user account</a></div>
    <div class="body">Hey,all<br />the code can creat a user account. How can delete a user account?<br />;=============================<br />.586<br />.model flat, stdcall<br />option casemap :none&nbsp;  <br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />include \masm32\include\kernel32.inc <br />include \masm32\include\netapi32.inc <br /><br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\netapi32.lib<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.data<br />	USER&nbsp; &nbsp; &nbsp; &nbsp;  DW 078H&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; WCHAR *USER = L&quot;X&quot;;<br />	PASS&nbsp; &nbsp; &nbsp; &nbsp;  DW 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />	USERPOINTER&nbsp; DD OFFSET USER&nbsp;  ; PBYTE USERPOINTER = (PBYTE) &amp;USER;<br /><br />	D1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DD 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; DWORD D1 = 0;<br />	D2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DD 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; DWORD D2 = 0;<br /><br />	GP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DD 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; LOCALGROUP_INFO_1* GP = NULL;<br />	UI&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DB 32 DUP(0)&nbsp; &nbsp;  ; USER_INFO_1 U1 = {0};<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.code<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />start:<br />	MOV&nbsp; EDI, OFFSET UI<br /><br />	MOV&nbsp; dword ptr , OFFSET USER ; UI.usri1_name = USER;<br />	MOV&nbsp; dword ptr , OFFSET PASS ; UI.usri1_password = (LPWCSTR) ((DWORD)USER+2);<br />	MOV&nbsp; dword ptr , 00000001H&nbsp;  ; UI.usri1_priv = USER_PRIV_USER;<br />	MOV&nbsp; dword ptr , 00010021H&nbsp;  ; UI.usri1_flags = UF_SCRIPT | <br />	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp; &nbsp; UF_PASSWD_NOTREQD | UF_DONT_EXPIRE_PASSWD;<br />&nbsp; &nbsp; <br />	PUSH OFFSET USER&nbsp; &nbsp; &nbsp;  <br />	PUSH 00000000H<br />	CALL NetUserDel&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; NetUserDel(NULL, L&quot;X&quot;);<br />&nbsp; &nbsp;  <br />	PUSH OFFSET D2<br />	PUSH OFFSET UI<br />	PUSH 00000001H<br />	PUSH 00000000H<br />	CALL NetUserAdd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; if (NetUserAdd(NULL,1, &amp;UI, &amp;D2)<br />	CMP&nbsp; EAX, 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;&nbsp;  != 0) <br />	JNE&nbsp; ERR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; goto ERR;<br />&nbsp; &nbsp; <br />	PUSH 00000000H<br />	PUSH OFFSET D1<br />	PUSH OFFSET D2<br />	PUSH 0FFFFFFFH<br />	PUSH OFFSET GP<br />	PUSH 00000001H<br />	PUSH 00000000H<br />	CALL NetLocalGroupEnum&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; if (NetLocalGroupEnum(0,1,&amp;GP,0x0FFFFFFF,&amp;D2,&amp;D1,0)<br />	CMP&nbsp; EAX, 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;&nbsp;  != 0)<br />	JNE&nbsp; ERR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; goto ERR;<br />	MOV&nbsp; ECX, D2<br />&nbsp; &nbsp; <br />GO:	PUSH ECX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; for (D1=0;D1&lt;D2;D1++) {<br />&nbsp; &nbsp;  <br />	MOV&nbsp; EDX, DWORD PTR <br />	MOV&nbsp; EDX, DWORD PTR <br /><br />	PUSH 00000001H<br />	PUSH OFFSET USERPOINTER<br />	PUSH 00000003H&nbsp; &nbsp;  <br />	PUSH EDX<br />	PUSH 00000000H<br />&nbsp; &nbsp; <br />	CALL NetLocalGroupAddMembers&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp;  NetLocalGroupAddMembers(&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp; &nbsp;  NULL, GP.lgrpi1_name, 3,<br />	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp; &nbsp;  USERPOINTER, 1);<br />	POP&nbsp; ECX<br />	LOOP GO&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; }<br /><br />	PUSH dword ptr <br />	CALL NetApiBufferFree&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; NetApiBufferFree(GP);<br /><br />	PUSH 0<br />	JMP&nbsp; OK&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; goto OK;<br />&nbsp; &nbsp; <br />ERR:	PUSH 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ERR: ExitProcess(1);<br />OK:	CALL ExitProcess&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; OK:&nbsp; ExitProcess(0);<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br /><br />end start<br /><br />;=============================<br />Greets<br /></div>
    <div class="meta">Posted on 2006-02-13 03:25:01 by dcskm4200</div>
   </div>
   <div class="post" id="post-169901">
    <div class="subject"><a href="#post-169901">Re: user account</a></div>
    <div class="body">NetLocalGroupDelMembers</div>
    <div class="meta">Posted on 2006-02-13 10:17:56 by arafel</div>
   </div>
   <div class="post" id="post-169910">
    <div class="subject"><a href="#post-169910">Re: user account</a></div>
    <div class="body">OK!<br />Thanks</div>
    <div class="meta">Posted on 2006-02-13 18:36:40 by dcskm4200</div>
   </div>
  </div>
 </body>
</html>