<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>EXTERN question etc. - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25949" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25949">EXTERN question etc.</a></p>
   <div class="post" id="post-189145">
    <div class="subject"><a href="#post-189145">EXTERN question etc.</a></div>
    <div class="body">This compiles OK till it gets to RegCreateKey. Do I have to make those procs? <br /><br />I only have one file. Isn&#39;t this first statement a reference to an external file that may be needed.<br /><br />I know the code is old, but I need to learn how to convert useful stuff.<br /><br />Thanks.<br /><br />EXTRN wsprintfA:PROC<br /><br />.data<br /><br />.code<br /><br />WinMain proc hInst:HINSTANCE,hPrevInst:HINSTANCE,CmdLine:LPSTR,CmdShow:SDWORD<br />	LOCAL wc:WNDCLASSEX<br />	LOCAL msg:MSG<br /><br />	mov&nbsp;  wc.cbSize,SIZEOF WNDCLASSEX<br />	mov&nbsp;  wc.style, CS_HREDRAW or CS_VREDRAW<br />	mov&nbsp;  wc.lpfnWndProc, OFFSET WndProc<br />	mov&nbsp;  wc.cbClsExtra,NULL<br />	mov&nbsp;  wc.cbWndExtra,NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; hInstance<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp;  wc.hInstance<br />	mov&nbsp;  wc.hbrBackground,COLOR_WINDOW+1<br />	mov&nbsp;  wc.lpszMenuName,NULL<br />	mov&nbsp;  wc.lpszClassName,OFFSET ClassName<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke LoadIcon,NULL,IDI_APPLICATION<br /><br />	mov&nbsp;  wc.hIcon,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp;  wc.hIconSm,0<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke LoadCursor,NULL,IDC_ARROW<br /><br />	mov&nbsp;  wc.hCursor,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke RegisterClassEx, addr wc<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE CreateWindowEx,NULL,ADDR ClassName,ADDR AppName,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  WS_OVERLAPPEDWINDOW,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  CW_USEDEFAULT,CW_USEDEFAULT,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;postion<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 300,100,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NULL,NULL,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  hInst,NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp;  hwnd,eax<br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE ShowWindow, hwnd,SW_SHOWNORMAL<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE UpdateWindow, hwnd<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; .WHILE TRUE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INVOKE GetMessage, ADDR msg,NULL,0,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .BREAK .IF (!eax)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INVOKE TranslateMessage, ADDR msg<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INVOKE DispatchMessage, ADDR msg<br />&nbsp; &nbsp; &nbsp; &nbsp; .ENDW<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax,msg.wParam<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />WinMain endp<br />WndProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL hdc:HDC<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL ps:PAINTSTRUCT<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL Disp&nbsp; :DWORD<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL pKey&nbsp; :DWORD<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL Temp&nbsp; :DWORD<br /><br />	mov&nbsp;  eax,uMsg<br />	.IF eax==WM_DESTROY<br />		invoke PostQuitMessage,NULL<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; .ELSEIF eax==WM_CREATE<br />;----------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Create first key, who wrote the program<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCreateKeyEx, HKEY_LOCAL_MACHINE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  addr subkeyname, NULL, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  REG_OPTION_NON_VOLATILE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  KEY_ALL_ACCESS, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  addr pKey, addr Disp<br /></div>
    <div class="meta">Posted on 2007-05-09 14:54:48 by skywalker</div>
   </div>
   <div class="post" id="post-189151">
    <div class="subject"><a href="#post-189151">Re: EXTERN question etc.</a></div>
    <div class="body">include advapi32.inc<br />includelib advapi32.lib<br /><br /><br />job done...</div>
    <div class="meta">Posted on 2007-05-10 03:58:16 by evlncrn8</div>
   </div>
   <div class="post" id="post-189154">
    <div class="subject"><a href="#post-189154">Re: EXTERN question etc.</a></div>
    <div class="body">Thanks.</div>
    <div class="meta">Posted on 2007-05-10 07:55:53 by skywalker</div>
   </div>
   <div class="post" id="post-189155">
    <div class="subject"><a href="#post-189155">Re: EXTERN question etc.</a></div>
    <div class="body">RegCreateKeyEx resides in advapi32.dll as can be seen <a target="_blank" href="http://msdn2.microsoft.com/en-us/library/ms724844.aspx">here</a>.<br /><br />/edit<br />Looks like I&#39;m late ^^</div>
    <div class="meta">Posted on 2007-05-10 08:02:24 by ti_mo_n</div>
   </div>
   <div class="post" id="post-189156">
    <div class="subject"><a href="#post-189156">Re: EXTERN question etc.</a></div>
    <div class="body">Actually you aren&#39;t late. This still won&#39;t compile.<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\gdi32.inc<br />include \masm32\include\advapi32.inc<br />include \masm32\advapi32.inc<br /><br />includelib \masm32\lib\advapi32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\gdi32.lib<br />includelib \masm32\lib\advapi32.lib<br /><br />EXTRN wsprintfA:PROC<br /><br />.data<br /><br />ClassName&nbsp; &nbsp; &nbsp;  db &quot;SimpleWinClass&quot;,0<br />subkeyname&nbsp; &nbsp; &nbsp; db &quot;Software\&quot;<br />AppName&nbsp; &nbsp; &nbsp; &nbsp;  db &quot;Regi32&quot;,0<br />num&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  db &quot;%lu&quot;,0<br /><br />stringvalue&nbsp; &nbsp;  db &quot;Written by&quot;,0<br />regtext1&nbsp; &nbsp; &nbsp; &nbsp; db &quot;John Lyons&quot; ,0<br />regstring2&nbsp; &nbsp; &nbsp; db &quot;Number of times executed&quot;,0<br />regerror&nbsp; &nbsp; &nbsp; &nbsp; db &quot;Error accessing Registry&quot;,0<br /><br />regkey&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD ?<br />counter&nbsp; &nbsp; &nbsp; &nbsp;  DWORD ?<br /><br />times&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD ?<br /><br /><br />hInstance&nbsp; &nbsp; &nbsp;  HINSTANCE ?<br />CommandLine&nbsp; &nbsp;  LPSTR ?<br />hwnd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HWND ?<br /><br />buff&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; db 200 dup(0)<br /><br />.code<br /><br />WinMain proc hInst:HINSTANCE,hPrevInst:HINSTANCE,CmdLine:LPSTR,CmdShow:SDWORD<br />	LOCAL wc:WNDCLASSEX<br />	LOCAL msg:MSG<br /><br />	mov&nbsp;  wc.cbSize,SIZEOF WNDCLASSEX<br />	mov&nbsp;  wc.style, CS_HREDRAW or CS_VREDRAW<br />	mov&nbsp;  wc.lpfnWndProc, OFFSET WndProc<br />	mov&nbsp;  wc.cbClsExtra,NULL<br />	mov&nbsp;  wc.cbWndExtra,NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; hInstance<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp;  wc.hInstance<br />	mov&nbsp;  wc.hbrBackground,COLOR_WINDOW+1<br />	mov&nbsp;  wc.lpszMenuName,NULL<br />	mov&nbsp;  wc.lpszClassName,OFFSET ClassName<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke LoadIcon,NULL,IDI_APPLICATION<br /><br />	mov&nbsp;  wc.hIcon,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp;  wc.hIconSm,0<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke LoadCursor,NULL,IDC_ARROW<br /><br />	mov&nbsp;  wc.hCursor,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke RegisterClassEx, addr wc<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE CreateWindowEx,NULL,ADDR ClassName,ADDR AppName,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  WS_OVERLAPPEDWINDOW,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  CW_USEDEFAULT,CW_USEDEFAULT,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;postion<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 300,100,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NULL,NULL,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  hInst,NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp;  hwnd,eax<br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE ShowWindow, hwnd,SW_SHOWNORMAL<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE UpdateWindow, hwnd<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; .WHILE TRUE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INVOKE GetMessage, ADDR msg,NULL,0,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .BREAK .IF (!eax)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INVOKE TranslateMessage, ADDR msg<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INVOKE DispatchMessage, ADDR msg<br />&nbsp; &nbsp; &nbsp; &nbsp; .ENDW<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax,msg.wParam<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />WinMain endp<br />WndProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL hdc:HDC<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL ps:PAINTSTRUCT<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL Disp&nbsp; :DWORD<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL pKey&nbsp; :DWORD<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL Temp&nbsp; :DWORD<br /><br />	mov&nbsp;  eax,uMsg<br />	.IF eax==WM_DESTROY<br />		invoke PostQuitMessage,NULL<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; .ELSEIF eax==WM_CREATE<br />;----------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Create first key, who wrote the program<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCreateKeyEx, HKEY_LOCAL_MACHINE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  addr subkeyname, NULL, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  REG_OPTION_NON_VOLATILE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  KEY_ALL_ACCESS, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  addr pKey, addr Disp<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax,ERROR_SUCCESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegSetValueEx, pKey, ADDR stringvalue,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NULL, REG_SZ,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ADDR regtext1, SIZEOF stringvalue<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax,ERROR_SUCCESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCloseKey, pKey<br /><br />;----------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Get the value of &quot;number of time exectued&quot; from the reg<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCreateKeyEx, HKEY_LOCAL_MACHINE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ADDR subkeyname, NULL, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  REG_OPTION_NON_VOLATILE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  KEY_ALL_ACCESS, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  addr pKey, addr Disp<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax,ERROR_SUCCESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov Temp,4<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegQueryValueEx, pKey, ADDR regstring2,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  NULL, ADDR Disp,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ADDR times, ADDR Temp<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax,ERROR_SUCCESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok4<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCloseKey, pKey<br /><br />okok4:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc <br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Set the new time to the key &quot;number of times executed&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCreateKeyEx, HKEY_LOCAL_MACHINE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ADDR subkeyname, NULL, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  REG_OPTION_NON_VOLATILE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  KEY_ALL_ACCESS, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  addr pKey, addr Disp<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax,ERROR_SUCCESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegSetValueEx, pKey, ADDR regstring2,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  NULL, REG_DWORD_LITTLE_ENDIAN,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ADDR times, Temp<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax,ERROR_SUCCESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCloseKey, pKey<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp okok2<br />okok:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov ,-1<br />okok2:<br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; .ELSEIF eax==WM_PAINT<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke BeginPaint,hWnd, ADDR ps<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; hdc,eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp times,-1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok3<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke TextOut,hdc,0,0,ADDR regerror,(SIZEOF regerror) -1<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp endit<br />okok3:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke TextOut,hdc,0,0,ADDR regstring2,(SIZEOF regstring2) -1<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push offset num<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push offset buff<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call wsprintfA<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add esp,0ch<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lea esi,buff<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call count<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke TextOut,hdc,175,0,esi,counter<br />endit:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke EndPaint,hWnd, ADDR ps<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; .ELSE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke DefWindowProc,hWnd,uMsg,wParam,lParam<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret<br />	.ENDIF<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp; eax,eax<br />	ret<br />WndProc endp<br />count proc<br />&nbsp; &nbsp; &nbsp; &nbsp; push esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov eax,0<br />noc2:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp ,byte ptr 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; je noc1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp noc2<br />noc1:<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ,eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; pop esi<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />count endp<br /><br />start:<br /><br />	invoke GetModuleHandle, NULL<br />	mov&nbsp; &nbsp; hInstance,eax<br />	invoke GetCommandLine<br />&nbsp; &nbsp; &nbsp; invoke WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT<br />	invoke ExitProcess,eax<br /><br />end start<br /></div>
    <div class="meta">Posted on 2007-05-10 08:04:03 by skywalker</div>
   </div>
   <div class="post" id="post-189159">
    <div class="subject"><a href="#post-189159">Re: EXTERN question etc.</a></div>
    <div class="body"><pre><code><br />;add these 2 lines ----<br />.386<br />.model flat,stdcall<br />;---------------------<br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\gdi32.inc<br />include \masm32\include\advapi32.inc<br />;remove this line ---- include \masm32\advapi32.inc<br /><br />includelib \masm32\lib\advapi32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\gdi32.lib<br />includelib \masm32\lib\advapi32.lib<br /><br />;remove this line ---- EXTRN wsprintfA:PROC<br /></code></pre><br />Compiles OK for me<br /></div>
    <div class="meta">Posted on 2007-05-11 01:26:49 by sinsi</div>
   </div>
   <div class="post" id="post-189160">
    <div class="subject"><a href="#post-189160">Re: EXTERN question etc.</a></div>
    <div class="body">I followed your advice and it still won&#39;t compile.<br /><br />;regi32.asm<br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />; Written by: John A Lyons&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />; <br />; Purpose&nbsp;  : Program which records in the registry how many times it has&nbsp;  <br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  been run, and prints this out. Demonstrates the use of the&nbsp; &nbsp; <br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  registry access functions,RegCreateKeyEx,RegQueryValueEx,&nbsp; &nbsp;  <br />;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  RegSetValueEx,RegCloseKey.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /><br />;.386&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; 32-Bit when .386 appears before .MODEL<br />;.MODEL&nbsp; FLAT , STDCALL<br />.386<br />.model flat,stdcall<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\gdi32.inc<br />include \masm32\include\advapi32.inc<br />;include \masm32\advapi32.inc<br /><br />includelib \masm32\lib\advapi32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\gdi32.lib<br />;includelib \masm32\lib\advapi32.lib<br /><br />;EXTRN wsprintfA:PROC<br /><br />.data<br /><br />ClassName&nbsp; &nbsp; &nbsp;  db &quot;SimpleWinClass&quot;,0<br />subkeyname&nbsp; &nbsp; &nbsp; db &quot;Software\&quot;<br />AppName&nbsp; &nbsp; &nbsp; &nbsp;  db &quot;Regi32&quot;,0<br />num&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  db &quot;%lu&quot;,0<br /><br />stringvalue&nbsp; &nbsp;  db &quot;Written by&quot;,0<br />regtext1&nbsp; &nbsp; &nbsp; &nbsp; db &quot;John Lyons&quot; ,0<br />regstring2&nbsp; &nbsp; &nbsp; db &quot;Number of times executed&quot;,0<br />regerror&nbsp; &nbsp; &nbsp; &nbsp; db &quot;Error accessing Registry&quot;,0<br /><br />regkey&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD ?<br />counter&nbsp; &nbsp; &nbsp; &nbsp;  DWORD ?<br /><br />times&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD ?<br /><br /><br />hInstance&nbsp; &nbsp; &nbsp;  HINSTANCE ?<br />CommandLine&nbsp; &nbsp;  LPSTR ?<br />hwnd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HWND ?<br /><br />buff&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; db 200 dup(0)<br /><br />.code<br /><br />WinMain proc hInst:HINSTANCE,hPrevInst:HINSTANCE,CmdLine:LPSTR,CmdShow:SDWORD<br />	LOCAL wc:WNDCLASSEX<br />	LOCAL msg:MSG<br /><br />	mov&nbsp;  wc.cbSize,SIZEOF WNDCLASSEX<br />	mov&nbsp;  wc.style, CS_HREDRAW or CS_VREDRAW<br />	mov&nbsp;  wc.lpfnWndProc, OFFSET WndProc<br />	mov&nbsp;  wc.cbClsExtra,NULL<br />	mov&nbsp;  wc.cbWndExtra,NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; hInstance<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp;  wc.hInstance<br />	mov&nbsp;  wc.hbrBackground,COLOR_WINDOW+1<br />	mov&nbsp;  wc.lpszMenuName,NULL<br />	mov&nbsp;  wc.lpszClassName,OFFSET ClassName<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke LoadIcon,NULL,IDI_APPLICATION<br /><br />	mov&nbsp;  wc.hIcon,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp;  wc.hIconSm,0<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke LoadCursor,NULL,IDC_ARROW<br /><br />	mov&nbsp;  wc.hCursor,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke RegisterClassEx, addr wc<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE CreateWindowEx,NULL,ADDR ClassName,ADDR AppName,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  WS_OVERLAPPEDWINDOW,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  CW_USEDEFAULT,CW_USEDEFAULT,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;postion<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 300,100,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NULL,NULL,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  hInst,NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp;  hwnd,eax<br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE ShowWindow, hwnd,SW_SHOWNORMAL<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE UpdateWindow, hwnd<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; .WHILE TRUE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INVOKE GetMessage, ADDR msg,NULL,0,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .BREAK .IF (!eax)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INVOKE TranslateMessage, ADDR msg<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INVOKE DispatchMessage, ADDR msg<br />&nbsp; &nbsp; &nbsp; &nbsp; .ENDW<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax,msg.wParam<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />WinMain endp<br />WndProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL hdc:HDC<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL ps:PAINTSTRUCT<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL Disp&nbsp; :DWORD<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL pKey&nbsp; :DWORD<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL Temp&nbsp; :DWORD<br /><br />	mov&nbsp;  eax,uMsg<br />	.IF eax==WM_DESTROY<br />		invoke PostQuitMessage,NULL<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; .ELSEIF eax==WM_CREATE<br />;----------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Create first key, who wrote the program<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCreateKeyEx, HKEY_LOCAL_MACHINE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  addr subkeyname, NULL, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  REG_OPTION_NON_VOLATILE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  KEY_ALL_ACCESS, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  addr pKey, addr Disp<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax,ERROR_SUCCESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegSetValueEx, pKey, ADDR stringvalue,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NULL, REG_SZ,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ADDR regtext1, SIZEOF stringvalue<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax,ERROR_SUCCESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCloseKey, pKey<br /><br />;----------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Get the value of &quot;number of time exectued&quot; from the reg<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCreateKeyEx, HKEY_LOCAL_MACHINE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ADDR subkeyname, NULL, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  REG_OPTION_NON_VOLATILE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  KEY_ALL_ACCESS, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  addr pKey, addr Disp<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax,ERROR_SUCCESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov Temp,4<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegQueryValueEx, pKey, ADDR regstring2,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  NULL, ADDR Disp,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ADDR times, ADDR Temp<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax,ERROR_SUCCESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok4<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCloseKey, pKey<br /><br />okok4:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc <br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Set the new time to the key &quot;number of times executed&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCreateKeyEx, HKEY_LOCAL_MACHINE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ADDR subkeyname, NULL, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  REG_OPTION_NON_VOLATILE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  KEY_ALL_ACCESS, NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  addr pKey, addr Disp<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax,ERROR_SUCCESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegSetValueEx, pKey, ADDR regstring2,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  NULL, REG_DWORD_LITTLE_ENDIAN,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ADDR times, Temp<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax,ERROR_SUCCESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke RegCloseKey, pKey<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp okok2<br />okok:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov ,-1<br />okok2:<br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; .ELSEIF eax==WM_PAINT<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke BeginPaint,hWnd, ADDR ps<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; hdc,eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp times,-1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne okok3<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke TextOut,hdc,0,0,ADDR regerror,(SIZEOF regerror) -1<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp endit<br />okok3:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke TextOut,hdc,0,0,ADDR regstring2,(SIZEOF regstring2) -1<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push offset num<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push offset buff<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call wsprintfA<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add esp,0ch<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lea esi,buff<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call count<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke TextOut,hdc,175,0,esi,counter<br />endit:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke EndPaint,hWnd, ADDR ps<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; .ELSE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke DefWindowProc,hWnd,uMsg,wParam,lParam<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret<br />	.ENDIF<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp; eax,eax<br />	ret<br />WndProc endp<br />count proc<br />&nbsp; &nbsp; &nbsp; &nbsp; push esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov eax,0<br />noc2:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp ,byte ptr 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; je noc1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp noc2<br />noc1:<br />&nbsp; &nbsp; &nbsp; &nbsp; mov ,eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; pop esi<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />count endp<br /><br />start:<br /><br />	invoke GetModuleHandle, NULL<br />	mov&nbsp; &nbsp; hInstance,eax<br />	invoke GetCommandLine<br />&nbsp; &nbsp; &nbsp; invoke WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT<br />	invoke ExitProcess,eax<br /><br />end start<br /></div>
    <div class="meta">Posted on 2007-05-11 03:27:10 by skywalker</div>
   </div>
   <div class="post" id="post-189161">
    <div class="subject"><a href="#post-189161">Re: EXTERN question etc.</a></div>
    <div class="body"><div class="quote"><br />C:\asm\test\sky&gt;ml sky.asm<br />Microsoft (R) Macro Assembler Version 6.15.8803<br />Copyright (C) Microsoft Corp 1981-2000.&nbsp; All rights reserved.<br /><br /> Assembling: sky.asm<br />Microsoft (R) Incremental Linker Version 6.00.8168<br />Copyright (C) Microsoft Corp 1992-1998. All rights reserved.<br /><br />/subsystem:windows,4.0 /debug /debugtype:cv<br />&quot;sky.obj&quot;<br />&quot;/OUT:sky.exe&quot;<br /><br />C:\asm\test\sky&gt;sky<br /><br />C:\asm\test\sky&gt;<br /></div><br /><br />It now tells me &quot;Number of times executed 4&quot;<br /><br />I an using MASM32 v9 (I think)</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=2348" target="_blank">sky.asm</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2007-05-11 03:39:31 by sinsi</div>
   </div>
   <div class="post" id="post-189174">
    <div class="subject"><a href="#post-189174">Re: EXTERN question etc.</a></div>
    <div class="body">I left this out. I feel stupid.<br />I need to study TextOut some more because it&#39;s displaying the number over the text.<br /><br />option&nbsp; casemap:none<br /></div>
    <div class="meta">Posted on 2007-05-11 08:51:12 by skywalker</div>
   </div>
   <div class="post" id="post-189175">
    <div class="subject"><a href="#post-189175">Re: EXTERN question etc.</a></div>
    <div class="body"><div class="quote"><br />I left this out. I feel stupid.<br />I need to study TextOut some more because it&#39;s displaying the number over the text.<br /><br />option&nbsp; casemap:none<br /><br /></div><br /><br />I left it out too...I feel stupider.</div>
    <div class="meta">Posted on 2007-05-11 09:16:44 by sinsi</div>
   </div>
   <div class="post" id="post-189188">
    <div class="subject"><a href="#post-189188">Re: EXTERN question etc.</a></div>
    <div class="body">This get it to print where you can see it.<br /><br />invoke TextOut,hdc,245,1,esi,counter ;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; x co-ordinate, y co-ordinate,addr of string, no.of chars&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; -- ------&gt;x&nbsp; y<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |<br /></div>
    <div class="meta">Posted on 2007-05-11 19:13:18 by skywalker</div>
   </div>
  </div>
 </body>
</html>