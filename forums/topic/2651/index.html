<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Source - Multiple files with GetOpenFileName - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=2651" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=2651">Source - Multiple files with GetOpenFileName</a></p>
   <div class="post" id="post-16839">
    <div class="subject"><a href="#post-16839">Source - Multiple files with GetOpenFileName</a></div>
    <div class="body">Yeah, got it :) full unreadable sourcecode follows:<br /><br /><br /><pre><code><br />; in .data&#58;<br />&#91;...&#93;<br />        szPathMask          db &quot;%s%s&quot;, 0<br />        szOFNFilter         db &quot;Audio &#40;*.mp3, *.wav, *.wma&#41;&quot;, 0, &quot;*.mp3;*.wav;*.wma&quot;, 0,<br />                               &quot;Video &#40;*.avi, *.mpg, *.mpeg&#41;&quot;, 0, &quot;*.avi;*.mpg;*.mpeg&quot;, 0, 0<br />&#91;...&#93;<br />; in .data?&#58;<br />&#91;...&#93;<br />        szOFNBuffer         db 16384 dup &#40;?&#41;<br />        szFile01Buffer      db 512 dup &#40;?&#41;<br />        szFile02Buffer      db 512 dup &#40;?&#41;<br />        szFile03Buffer      db 512 dup &#40;?&#41;<br />        ofn                 OPENFILENAME &lt;?&gt;<br />&#91;...&#93;<br />; in .code&#58;<br />&#91;...&#93;<br />            mov ofn.lStructSize, sizeof OPENFILENAME<br />            push hWin<br />            pop ofn.hwndOwner<br />            mov ofn.hInstance, 40000h<br />            mov ofn.lpstrFilter, offset szOFNFilter<br />            mov ofn.lpstrFile, offset szOFNBuffer<br />            mov ofn.nMaxFile, 16384<br />            mov ofn.lpstrTitle, offset szAppName<br />            mov ofn.Flags, OFN_EXPLORER or OFN_FILEMUSTEXIST or OFN_HIDEREADONLY or OFN_ALLOWMULTISELECT<br /><br />            invoke GetOpenFileName, addr ofn<br /><br />            .if byte ptr &#91;szOFNBuffer&#93; != 0<br />                lea edi, szOFNBuffer<br />                lea esi, szFile01Buffer<br />             @@&#58;<br />                mov al, byte ptr &#91;edi&#93;<br />                mov byte ptr &#91;esi&#93;, al<br />                inc edi<br />                inc esi<br />                or al, al<br />                jnz @B<br />                cmp byte ptr &#91;edi+1&#93;, 0<br />                je @@sel_one<br />                    invoke lstrlen, addr szFile01Buffer<br />                    cmp eax, 3<br />                    je @@next<br />                    lea esi, szFile01Buffer<br />                    add esi, eax<br />                    mov byte ptr &#91;esi&#93;, &quot;\&quot;<br />                 @@next&#58;<br />                    lea esi, szFile02Buffer<br />                 @@&#58;<br />                    mov al, byte ptr &#91;edi&#93;<br />                    mov byte ptr &#91;esi&#93;, al<br />                    inc edi<br />                    inc esi<br />                    or al, al<br />                    jnz @B<br />                    invoke wsprintf, addr szFile03Buffer, addr szPathMask, addr szFile01Buffer, addr szFile02Buffer<br />                    invoke MessageBox, hWin, addr szFile03Buffer, 0, 0<br />                    cmp byte ptr &#91;edi+1&#93;, 0<br />                    jne @@next<br />                jmp @@exit<br />             @@sel_one&#58;<br />                    invoke MessageBox, hWin, addr szFile01Buffer, 0, 0<br />             @@exit&#58;<br />                invoke RtlZeroMemory, addr szFile01Buffer, 512<br />                invoke RtlZeroMemory, addr szOFNBuffer, 16384<br />            .endif<br />&#91;...&#93;<br /></code></pre><br /><br />P.S.: used wsprintf instead of lstrcat, because I didn't want to overwrite szFile01Buffer (wich contains the directory in this case)</div>
    <div class="meta">Posted on 2001-12-30 16:45:19 by bazik</div>
   </div>
  </div>
 </body>
</html>