<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Z-80 emulator me writing :D - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=12948" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=12948">Z-80 emulator me writing :D</a></p>
   <div class="post" id="post-100642">
    <div class="subject"><a href="#post-100642">Z-80 emulator me writing :D</a></div>
    <div class="body">Hi, for a summer project I would like to write a Master System emulator, very simple system to emulate. Anyway I have started the Z-80 CPU emulation core, everything is going fine I got around 45~50 instructions implemented so far. I'm sure some of you who have coded the Z-80 remember the Half-Carry flag. On many operations the half carry flag is set when there is a borrow from bit 4. I was wondering if there is an x86 instruction that does something similar so I won't have to write the code to detect it myself.</div>
    <div class="meta">Posted on 2003-05-01 21:19:12 by x86asm</div>
   </div>
   <div class="post" id="post-100652">
    <div class="subject"><a href="#post-100652">Z-80 emulator me writing :D</a></div>
    <div class="body">I don't know about z80 but you can do this on x86 to test if bit 4 on a register is set or not<pre><code>test eax, 10h<br />jnz __Bit4OfRegisterEAXisSet</code></pre>or if you want to set bit 4 of a register<pre><code>bts eax, 4</code></pre>this one also copies bit 4 of register EAX to the carry flag(CF) :)</div>
    <div class="meta">Posted on 2003-05-01 22:37:09 by arkane</div>
   </div>
   <div class="post" id="post-100688">
    <div class="subject"><a href="#post-100688">Z80</a></div>
    <div class="body">Hi x86asm,<br /><br /> I programmed long time ago z80 (under MSX based system) <br /><br /> <a target="_blank" href="http://www.zophar.net/Files/cpu/makez80.zip">http://www.zophar.net/Files/cpu/makez80.zip</a>  This packet usefull and included z80 to 32bit asm  (C code but nasm based) source code.  <br /><br /> And other examples <a target="_blank" href="http://www.zophar.net/z80.html">http://www.zophar.net/z80.html</a> <br /><br /> I hope help you :)<br /><br /><br />Edit: &quot;until&quot; --&gt;&quot;under&quot; (sorry my English)<br /><br /> Regards,</div>
    <div class="meta">Posted on 2003-05-02 02:51:36 by CYDONIA</div>
   </div>
   <div class="post" id="post-100729">
    <div class="subject"><a href="#post-100729">Z-80 emulator me writing :D</a></div>
    <div class="body">Hey x86, it was a project I wanted to do there is a long time : unfortunaly lacking of time to do it... :)<br /><br />Btw, I know there is already good z80 libraries written... have a look at some emulators and emu-websites....<br /><br />Also have a look at <a target="_blank" href="http://cgfm2.emuviews.com/segastuf.htm#sms">http://cgfm2.emuviews.com/segastuf.htm#sms</a> : it has some useful docs : the Megadrive - Genesis was very useful to me some time ago when I did some programming on it !<br /><br />I was around the emu-scene for a long time : at this time, there was a real need of a good sms emulator (Good old Meka doesn't work on NT based systems).<br /><br />Anyway, be ready to deal with strange things : example : some games not doing things in the *documented* way : creating delay problems with sound, graphics bugs etc... :)<br /><br />Keep up the good work : you will probably have great fun by writing this...</div>
    <div class="meta">Posted on 2003-05-02 05:57:49 by JCP</div>
   </div>
   <div class="post" id="post-100739">
    <div class="subject"><a href="#post-100739">Z-80 emulator me writing :D</a></div>
    <div class="body"><div class="quote"><br />Hey x86, it was a project I wanted to do there is a long time : unfortunaly lacking of time to do it... :)<br /><br />Btw, I know there is already good z80 libraries written... have a look at some emulators and emu-websites....<br /><br />Also have a look at <a target="_blank" href="http://cgfm2.emuviews.com/segastuf.htm#sms">http://cgfm2.emuviews.com/segastuf.htm#sms</a> : it has some useful docs : the Megadrive - Genesis was very useful to me some time ago when I did some programming on it !<br /><br />I was around the emu-scene for a long time : at this time, there was a real need of a good sms emulator (Good old Meka doesn't work on NT based systems).<br /><br />Anyway, be ready to deal with strange things : example : some games not doing things in the *documented* way : creating delay problems with sound, graphics bugs etc... :)<br /><br />Keep up the good work : you will probably have great fun by writing this... </div><br /><br />aww man thanks I needed this info :D, the info I have wasnt very descriptive!</div>
    <div class="meta">Posted on 2003-05-02 06:51:06 by x86asm</div>
   </div>
   <div class="post" id="post-100740">
    <div class="subject"><a href="#post-100740">Z-80 emulator me writing :D</a></div>
    <div class="body">Thanks Cydonia and Arkane I will look at trying both of ur suggestions :D</div>
    <div class="meta">Posted on 2003-05-02 06:52:17 by x86asm</div>
   </div>
   <div class="post" id="post-100743">
    <div class="subject"><a href="#post-100743">Z-80 emulator me writing :D</a></div>
    <div class="body">nice one, readiosys, could i got some more link / forum about those stuff? uhmm... that kinda suitable to my current job :grin: :grin:</div>
    <div class="meta">Posted on 2003-05-02 07:08:42 by dion</div>
   </div>
   <div class="post" id="post-100745">
    <div class="subject"><a href="#post-100745">Z-80 emulator me writing :D</a></div>
    <div class="body">Personally, not, but you can mail the emulators authors : they are most of the time very sympathic and do not hesitate to share their documentations, and sometimes even sources...</div>
    <div class="meta">Posted on 2003-05-02 07:29:55 by JCP</div>
   </div>
   <div class="post" id="post-100803">
    <div class="subject"><a href="#post-100803">Z-80 emulator me writing :D</a></div>
    <div class="body">you can also set bit 4 to 1 by<pre><code>xor eax, 10h</code></pre>or set bit 4 to 0 by<pre><code>and eax, 0FFFFFFEFh</code></pre>:)</div>
    <div class="meta">Posted on 2003-05-02 13:44:23 by arkane</div>
   </div>
   <div class="post" id="post-100829">
    <div class="subject"><a href="#post-100829">Z-80 emulator me writing :D</a></div>
    <div class="body">Erm, I'm sure he knows that.<br /><br />Anyway, the A flag is set when there's a carry from bit 3 to bit 4. This goes in bit 4 of our flag register. Incidentally, this is also bit 4 of the Z80's flag register.</div>
    <div class="meta">Posted on 2003-05-02 17:05:09 by Sephiroth3</div>
   </div>
   <div class="post" id="post-100980">
    <div class="subject"><a href="#post-100980">Z-80 emulator me writing :D</a></div>
    <div class="body"><div class="quote"><br />Erm, I'm sure he knows that.<br /><br />Anyway, the A flag is set when there's a carry from bit 3 to bit 4. This goes in bit 4 of our flag register. Incidentally, this is also bit 4 of the Z80's flag register. </div><br /><br />So after the resultant Z-80 operation, I move the status of bit 4 into the Half-Carry flag and thats it?</div>
    <div class="meta">Posted on 2003-05-03 16:51:43 by x86asm</div>
   </div>
   <div class="post" id="post-101006">
    <div class="subject"><a href="#post-101006">Z-80 emulator me writing :D</a></div>
    <div class="body">Yeah, and keep bit 0, too (the carry). Bit 11 (overflow) should be moved into bit 2. Bit 7 (sign) goes in bit 1.</div>
    <div class="meta">Posted on 2003-05-03 20:30:28 by Sephiroth3</div>
   </div>
  </div>
 </body>
</html>