<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>What's Wrong With This? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=19242" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=19242">What's Wrong With This?</a></p>
   <div class="post" id="post-148624">
    <div class="subject"><a href="#post-148624">What's Wrong With This?</a></div>
    <div class="body">does anyone know? im using this for a file compare program im making. im still learning and this is my first time working with opening files and comparing them. <br /><br />Compare_Strings proc Strin:DWORD,Strin2:DWORD<br />            mov eax,Strin<br />            mov ebx,Strin2<br />            <br />            xor ecx,ecx<br />            cmp eax,0<br />            je Different<br />            cmp ebx,0<br />            je Different<br />Continue:<br />            inc eax<br />            inc ecx<br />            inc ebx<br />            cmp eax,0<br />            je  Equal<br />            cmp eax,ebx<br />            je  Continue<br />Different:<br />            movzx eax,al<br />            push dword ptr <br />            push LB_ADDSTRING<br />            push 1002<br />            push 1000<br />            call SendDlgItemMessage<br />           <br />            movzx ebx,bl<br />            push dword ptr <br />            push LB_ADDSTRING<br />            push 1003<br />            push 1000<br />            call SendDlgItemMessage<br />Equal:<br />           ret<br />Compare_Strings endp</div>
    <div class="meta">Posted on 2004-08-27 23:09:49 by HeXeN</div>
   </div>
   <div class="post" id="post-148636">
    <div class="subject"><a href="#post-148636">What's Wrong With This?</a></div>
    <div class="body"><pre><code><br />Compare_Strings proc Strin&#58;DWORD,Strin2&#58;DWORD <br />push ebx ;best to preserve this register<br />mov eax,Strin <br />mov ebx,Strin2 <br /><br />@@&#58;<br />mov cl, &#91;eax&#93;<br />inc eax<br />cmp &#91;ebx&#93;, cl<br />jnz Different<br />inc ebx<br />test cl, cl<br />jnz @B<br />Equal&#58; <br />;...<br />Different&#58; <br />;...<br /><br /><br />;xor ecx,ecx <br />;cmp eax,0 <br />;je Different <br />;cmp ebx,0 <br />;je Different <br />;Continue&#58; <br />;inc eax <br />;inc ecx <br />;inc ebx <br />;cmp eax,0 <br />;je Equal <br />;cmp eax,ebx <br />;je Continue <br /><br />pop ebx<br />ret <br />Compare_Strings endp<br /></code></pre><br /><br />I don't understand what you are doing btw...</div>
    <div class="meta">Posted on 2004-08-28 04:15:01 by roticv</div>
   </div>
   <div class="post" id="post-148648">
    <div class="subject"><a href="#post-148648">What's Wrong With This?</a></div>
    <div class="body">Hexen, what you are trying in principle is ok, you have the idea.<br /><br />Dont know if a post to you where deleted by the thing that happend.<br />A number inside a register is only a number. You can manipulate this numbers, with the arithmetic instructions, logic ones, etc, but also there is a not considered diferent branch of manipulation, and this is:<br /><br />the number inside a register can be used for reference the content of the number (address) in the register, with [ and ] operators.<br /><br /><br />The things that I remark with red are the things that I consider to be uncorrect: first you move the address (masm sintaxis cant understand it completely), also you set up ecx to 0 (pheraphs first byte regarding the address of eax and ebx) then you compare the address against 0, and if is equal the strings are equal?, also when you increment eax and ebx, you are incrementing the number or the next accesible address, but you never are getting the number at that address, with [ and ], and thus, this code is never comparing the string, or content in the address against the other, like I see is a comparation about the address of the two strings, and this code only stop  when one of the registers is zero. Try follow the example that roticv give you, see that he uses the [ and ] operators, for get the content at the number of the register.<br /><br /><div class="quote">Compare_Strings proc Strin:DWORD,Strin2:DWORD <br /><br />mov eax,Strin <br />mov ebx,Strin2 <br /><br />xor ecx,ecx <br />cmp eax,0 je Different <br />cmp ebx,0 <br />je Different <br />Continue: <br />inc eax <br />inc ecx <br />inc ebx <br />cmp eax,0 <br />je Equal <br />cmp eax,ebx <br />je Continue <br />Different: <br />movzx eax,al <br />push dword ptr  <br />push LB_ADDSTRING <br />push 1002 <br />push 1000 <br />call SendDlgItemMessage <br /><br />movzx ebx,bl <br />push dword ptr  <br />push LB_ADDSTRING <br />push 1003 <br />push 1000 <br />call SendDlgItemMessage <br />Equal: <br />ret <br />Compare_Strings endp<br /></div></div>
    <div class="meta">Posted on 2004-08-28 09:46:25 by rea</div>
   </div>
   <div class="post" id="post-148654">
    <div class="subject"><a href="#post-148654">:)</a></div>
    <div class="body">thanks for your help ill look at these two examples and try to figure it out. but first i have another question how do i compare the bytes if i can't do something like this: cmp byte ptr ,byte ptr </div>
    <div class="meta">Posted on 2004-08-28 11:00:53 by HeXeN</div>
   </div>
   <div class="post" id="post-148664">
    <div class="subject"><a href="#post-148664">What's Wrong With This?</a></div>
    <div class="body">I was searching and dont found some of the post when you talk about strings.<br /><br />Anyway I will <em>mess you</em> with my personals points of views, hope I dont miss you.<br /><br />We do operations over memory, the memory can remember. Operations cant remember the previous state or the anterior source, but they &quot;remember&quot; how to do the operation (the process), because a &quot;+&quot; always can add two numbers, and in fact, the remembering is done inside the paths of execution of the processor, the processor can remember or follow the necesary paths for do the operation.<br /><br />The ram memory <strong>have addresses</strong>, and <em>inside</em> or <em>the content</em> of each address is one byte, and this value can be readed or writed using <strong>[</strong> and <strong>]</strong> , depending if is source or destiny.<br /><br />The registers (taked like memory), dosent have a address then you cannot obtain the addresses, but you can obtain/write <strong>the content</strong> of the address with his respective name: eax, ebx, esp, mmx1, mmx2, ... . Without the necesity of have the address of eax register and use [ and ] for read or write the content of the memory, only use the name and you can read/write the content.<br /><br />The registers in the point of view of the operations only &quot;see&quot; a &quot;number&quot; inside each one.<br /><br /><br /><br />But a important thing to note is that addresses of the ram memory can also have a representative name, because this address are only numbers or offsets, we use names for name a number address, like we do in math: 1 is one or *, 2 is two or **, ... ; but we give descriptive names normally: str1, str2, hWnd, ps, wc, etc.<br /><br /><br /><br />When you move a name of RAM memory to another register or other memory, you actually are moving the address (number) to the destination. examples:<br /><br /><pre><code><br />.data<br />str1 db &quot;hola mundo como estas&quot;, 0<br />str2 db &quot;hi worl I am OK&quot;, 0<br />address1 dd 0<br />address2 dd 0<br />.code<br />mov eax, str1<br />mov ebx, str2<br />mov &#91;address1&#93;, str1<br />mov &#91;address2&#93;, str2<br /></code></pre><br /><br />This instructions have the same impact, you are modificating the content of memory first in the registers and then in the RAM.<br /><br />When you move a address inside a register, you can add, substracts, andit, and all the operations, because the point of view of operations, but this operations are doing it to the number representing the address moved in, and for refer to the content of a number, you use <strong>[</strong> and <strong>]</strong> (with masm you should add two more words).<br /><br /><br />If you only whant to move 10 bytes above the a address dosent matter what contain or represent this address:<br /><br />mov eax, nameOfAddress<br />add eax, 10<br /><br />For example, you whant modify 5 continuos content of memory, add 1 dosent matter what mean that contents.<br /><br /><pre><code><br />mov eax, nameOfAddress<br />mov ecx, 4 ;Why 4 and not 5?<br />add eax, ecx<br />again&#58;<br /> add byte&#91;eax+ecx&#93;, 1<br /> dec ecx<br /> jnz again<br /></code></pre><br /><br /><br />You only whant to test if a memory is a number?, regarding if the number is 'a', 9, 'hi', etc?, only need be the same size against the size (number of bytes) that you are comparing against.<br /><br />number represent 'a', '9', 4, a mask of bits, or any other <em>inmediate</em> number<br /><br />size represent byte, word, dword, the number of bytes to take for comparation, if the other operand is a register, the size of the register is tacked automatically, and is for that, in the optional place is marked with orange.<br /><br /><div class="quote"><br />mov eax, addressName<br />jmp firstTest<br /> .again:<br /> .add eax, size<br /> .firstTest:<br />  ..cmp size, number<br />  ..jne again<br /></div><br />I only write the dots for keep a little the format.....<br /><br />If you only whant to get/write a content of memory you use []<br />mov eax, <br />mov eax, ebx<br /><br />this two move the content in memory to eax register, but remember that with registers, you dont have to use [] and because you dont know the address.<br /><br />By the end note:<br /><br />--addr 101-- number1 db 0x4C<br />01001100<br />--addr 102-- number2 dw 0x0770<br />00000111<br />--addr 103--<br />01110000<br />--addr 104-- number3 dw 0xDC3C<br />11011100<br />--addr 105--<br />00111100<br /><br />each one is a bit and each address a byte, you can get the number of the address only moving the name that represent the address.<br /><br />mov register/, numberN (this is the name of the addres)<br /><br />And you can modify the content of a memory saying how many bytes you whant to take from the contents of memory starting in an address, <br /><br />mov eax, number2<br />add dword, eax will modify the content of number2 and number3, because the size specified feet in this space.<br /><br />Hope this help you more or get the idea ;), keep going.<br /><br /><br />Have a nice day or night.</div>
    <div class="meta">Posted on 2004-08-28 13:23:34 by rea</div>
   </div>
   <div class="post" id="post-148668">
    <div class="subject"><a href="#post-148668">:X</a></div>
    <div class="body">here is exactly what im trying to do. i kinda get it but there are a few things im messing up. but here is what i have. you may need to post this in an editor or something it appears this window isn't large enough to show it all.<br /><br /><pre><code><br />Compare_Strings proc Strin&#58;DWORD,Strin2&#58;DWORD<br />            mov eax,Strin                    ;move Strin in Eax<br />            mov ebx,Strin2                   ;mov  Strin2 into Ebx<br />            xor ecx,ecx                      ;ecx = 0<br />Continue&#58;                                    ;jump to here so we can loop through the bytes<br />            inc eax                          ;increment eax<br />            inc ebx                          ;increment ebx<br />            inc ecx                          ;increment ecx &#40;ecx = ecx + 1&#41;<br />            cmp byte ptr &#91;eax+ecx&#93;,0         ;check if end of string in eax<br />            je  Done                         ;if end of string in eax stop comparing nothing left to do<br />            cmp byte ptr &#91;ebx+ecx&#93;,0         ;check if end of string in ebx<br />            je  Done                         ;if end of string in ebx stop comparing nothing left to do<br />            cmp byte ptr &#91;eax&#93;,byte ptr &#91;ebx&#93;;compare first byte in eax to ebx<br />            je  Continue                     ;if they are equal we just keep going we don't need to know the equal bytes<br />           <br />            movzx eax,al                     ;mov al into eax<br />            push dword ptr eax               ;add eax to our first listbox<br />            push LB_ADDSTRING                ;constant used to add the string to our listbox<br />            push 1002                        ;our first listbox<br />            push 1000                        ;our main dialog window<br />            call SendDlgItemMessage          ;call SendDlgItemMessage Because We Can't Use SendMessage ;x<br />           <br />            movzx ebx,bl                     ;mov bl into ebx<br />            push dword ptr ebx               ;add eax to our first listbox<br />            push LB_ADDSTRING                ;constant used to add the string to our listbox<br />            push 1003                        ;our second listbox<br />            push 1000                        ;our main dialog window<br />            call SendDlgItemMessage          ;call SendDlgItemMessage Because We Can't Use SendMessage ;x<br />            jmp Continue                     ;we aren't done comparing the string yet so jump to Continue&#58;<br />Done&#58;                                        ;if we are done comparing the string we will jump to here<br />            ret                              ;return and exit our function &#40;not sure if a return is needed<br />Compare_Strings endp                         ;if it's eax isn't used when we are done&#41;<br /></code></pre></div>
    <div class="meta">Posted on 2004-08-28 14:35:47 by HeXeN</div>
   </div>
   <div class="post" id="post-148676">
    <div class="subject"><a href="#post-148676">What's Wrong With This?</a></div>
    <div class="body">you dont need in your case increment the content in eax and ebx, because you are incrementing ecx, then when you do:<br /><br />inc eax<br />inc ebx      <br />inc ecx                    <br />cmp byte ptr ,0 <br /><br />You are actually comparing one byte more far that the one you need to first compare.<br /><br />You have two options, dont increment eax and ebx, and use them only like the base address, where the displacement is gived by ecx, and use a extra register, for the comparation of memory.<br /><br />the second is that you can only incremen eax and ebx, and not use ecx like a offset, instead use it like a temporal container, for compare both memory locations.<br /><br /><br />cmp byte ptr ,byte ptr <br /><br />Will not work, there is no direct comparation between memory content, instead use:<br /><br />mov tempReg8bits, <br />cmp , tempReg8bits<br /><br /><br /><br />Also what about if you first compare the content in the two strings, then check for the end of one of the strings?, if the first comparation is equal, and one of them have a zero, then boths should have a zero ;).</div>
    <div class="meta">Posted on 2004-08-28 19:52:49 by rea</div>
   </div>
   <div class="post" id="post-148677">
    <div class="subject"><a href="#post-148677">What's Wrong With This?</a></div>
    <div class="body"><div class="quote">Also what about if you first compare the content in the two strings, then check for the end of one of the strings?, if the first comparation is equal, and one of them have a zero, then boths should have a zero .</div><br /><br />because what if they didn't give me a string at all?</div>
    <div class="meta">Posted on 2004-08-28 19:56:14 by HeXeN</div>
   </div>
   <div class="post" id="post-148679">
    <div class="subject"><a href="#post-148679">ok well i changed it</a></div>
    <div class="body">Compare_Strings proc Strin:DWORD,Strin2:DWORD<br />            mov eax,Strin                    ;move Strin in Eax<br />            mov ebx,Strin2                   ;mov  Strin2 into Ebx<br />Continue:                                    ;jump to here so we can loop through the bytes<br />            inc eax                          ;increment eax<br />            inc ebx                          ;increment ebx<br />            cmp byte ptr ,0         ;check if end of string in eax<br />            je  Done                         ;if end of string in eax stop comparing nothing left to do<br />            cmp byte ptr ,0         ;check if end of string in ebx<br />            je  Done                         ;if end of string in ebx stop comparing nothing left to do<br />            mov cl,byte ptr <br />            cmp byte ptr ,cl            ;compare first byte in eax to ebx<br />            je  Continue                     ;if they are equal we just keep going we don't need to know the equal bytes<br />           <br />            movzx eax,al                     ;mov al into eax<br />            push dword ptr eax               ;add eax to our first listbox<br />            push LB_ADDSTRING                ;constant used to add the string to our listbox<br />            push 1002                        ;our first listbox<br />            push 1000                        ;our main dialog window<br />            call SendDlgItemMessage          ;call SendDlgItemMessage Because We Can't Use SendMessage ;x<br />           <br />            movzx ebx,bl                     ;mov bl into ebx<br />            push dword ptr ebx               ;add ebx to our first listbox<br />            push LB_ADDSTRING                ;constant used to add the string to our listbox<br />            push 1003                        ;our second listbox<br />            push 1000                        ;our main dialog window<br />            call SendDlgItemMessage          ;call SendDlgItemMessage Because We Can't Use SendMessage ;x<br />            jmp Continue                     ;we aren't done comparing the string yet so jump to Continue:<br />Done:                                        ;if we are done comparing the string we will jump to here<br />            ret                              ;return and exit our function (not sure if a return is needed<br />Compare_Strings endp                         ;if it's eax isn't used when we are done)<br /><br />now it doesnt crash or anything and i get my messagebox that says that there was no errors but for some strange reason its not adding anything to my listboxes.</div>
    <div class="meta">Posted on 2004-08-28 20:22:34 by HeXeN</div>
   </div>
   <div class="post" id="post-148687">
    <div class="subject"><a href="#post-148687">What's Wrong With This?</a></div>
    <div class="body">What are you trying to achieve with<br /><pre><code><br />movzx eax,al ;mov al into eax <br />push dword ptr eax ;add eax to our first listbox <br />push LB_ADDSTRING ;constant used to add the string to our listbox <br />push 1002 ;our first listbox <br />push 1000 ;our main dialog window <br />call SendDlgItemMessage ;call SendDlgItemMessage Because We Can't Use SendMessage ;x <br /><br />movzx ebx,bl ;mov bl into ebx <br />push dword ptr ebx ;add ebx to our first listbox <br />push LB_ADDSTRING ;constant used to add the string to our listbox <br />push 1003 ;our second listbox <br />push 1000 ;our main dialog window <br />call SendDlgItemMessage ;call SendDlgItemMessage Because We Can't Use SendMessage ;x <br /><br /></code></pre><br /><br />In your code, the apis will definitely modify the value in eax....</div>
    <div class="meta">Posted on 2004-08-29 00:30:08 by roticv</div>
   </div>
   <div class="post" id="post-148688">
    <div class="subject"><a href="#post-148688">What's Wrong With This?</a></div>
    <div class="body">im comparing 2 files and im trying to add all the different bytes in the 2 files to 2 different listboxes.  i have posted what the app looks like below</div>
    <div class="meta">Posted on 2004-08-29 00:53:19 by HeXeN</div>
   </div>
   <div class="post" id="post-148689">
    <div class="subject"><a href="#post-148689">What's Wrong With This?</a></div>
    <div class="body">Then, this is wrong<br /><pre><code><br />movzx eax,al ;mov al into eax <br />push dword ptr eax ;add eax to our first listbox <br />push LB_ADDSTRING ;constant used to add the string to our listbox <br />push 1002 ;our first listbox <br />push 1000 ;our main dialog window <br />call SendDlgItemMessage ;call SendDlgItemMessage Because We Can't Use SendMessage ;x <br /></code></pre><br />You should be doing something like<br /><br /><pre><code><br />movzx ecx, byte ptr&#91;eax&#93;<br />invoke dwtoh,ecx, offset buffer<br />invoke SendDlgItemMessage, 1000,1002, LB_ADDSTRING, offset buffer<br /></code></pre><br /><br />Also please use esi or edi instead of eax in the loop. The api will definitely modify the value in eax.</div>
    <div class="meta">Posted on 2004-08-29 01:42:53 by roticv</div>
   </div>
   <div class="post" id="post-148700">
    <div class="subject"><a href="#post-148700">What's Wrong With This?</a></div>
    <div class="body"><div class="quote">because what if they didn't give me a string at all? </div><br /><br />You are still quiting when you have a zero in one of both strings, doing first the comparation of the content of the string, can help in have 1 less comparation. And will still mark the diferent bytes.</div>
    <div class="meta">Posted on 2004-08-29 09:53:25 by rea</div>
   </div>
   <div class="post" id="post-148706">
    <div class="subject"><a href="#post-148706">:X</a></div>
    <div class="body">ok well i got it to kinda work but instead of giving me the correct bytes it appears its giving me the current location of the bytes so i commented what doesn't work out and now i think i give up on this. so here is the source code what works isn't commented out and what is commented out <br />doesn't work.<br /><br />~HeXeN</div>
    <div class="meta">Posted on 2004-08-29 12:00:23 by HeXeN</div>
   </div>
  </div>
 </body>
</html>