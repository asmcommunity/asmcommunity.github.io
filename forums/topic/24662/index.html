<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>search for words and sort out - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=24662" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=24662">search for words and sort out</a></p>
   <div class="post" id="post-180210">
    <div class="subject"><a href="#post-180210">search for words and sort out</a></div>
    <div class="body">Hello there :-)<br />i mess up with the search engine so i ask my beginner question here.<br /><br />i want to search a huge html file for links an sort them out in a listbox.<br />what is the best way as beginner to do so ?<br /><br />i found string search routines in archive here, but i didn&#39;t understand :-(<br /><br />do i have to search the text for the first char, if found get the rest of the word and seek again ?<br /><br />lets say i search for &quot;href&quot;<br />so i search for the char &quot;h&quot; and if found i read the next 3 chars after the found postion and then make lstrcmp if &quot;href&quot; found ?<br /><br />or do i have to search only 4 char text and compare them with &quot;href&quot; ?<br /><br />sorry if i waste your time reading this bad English, but i don&#39;t know where and who to ask, then here.<br /><br />very nice if you can point me to the right way, thank you.<br /><br /><br /><br /><br /><br /><br /><br /><br /></div>
    <div class="meta">Posted on 2006-04-28 15:22:04 by xanthos</div>
   </div>
   <div class="post" id="post-180212">
    <div class="subject"><a href="#post-180212">Re: search for words and sort out</a></div>
    <div class="body">heres my folish code, but worked :-)<br /><br /><br />&nbsp; &nbsp; invoke GlobalAlloc, GPTR, seeksize<br />&nbsp; &nbsp; mov&nbsp; &nbsp; hmem, eax<br />&nbsp; &nbsp; invoke InternetOpen, ADDR useragent, INTERNET_OPEN_TYPE_DIRECT, NULL, NULL, 0<br />&nbsp; &nbsp; mov&nbsp; &nbsp; hopen, eax<br />&nbsp; &nbsp; invoke InternetOpenUrl, hopen, ADDR url_buff, NULL, 0, INTERNET_FLAG_RELOAD, 0<br />&nbsp; &nbsp; mov&nbsp; &nbsp; hfile, eax<br />&nbsp; &nbsp; invoke InternetReadFile, hfile, hmem, seeksize, offset hresult<br />&nbsp; &nbsp; invoke InternetCloseHandle, hfile<br />&nbsp; &nbsp; invoke InternetCloseHandle, hopen<br /><br /><br />;-- search for links<br />&nbsp; &nbsp; mov&nbsp; &nbsp; esi, hmem&nbsp; ; html buffer<br /><br />&nbsp; &nbsp; invoke lstrlen,esi<br />&nbsp; &nbsp; mov&nbsp; &nbsp; f_size,eax ; size of html buffer<br /><br /> @seeknext:<br />&nbsp; &nbsp; lea edi, szBuffer1<br />&nbsp; &nbsp; xor ecx, ecx<br /> @1:<br />&nbsp; &nbsp; cmp f_size,0<br />&nbsp; &nbsp; je&nbsp; end_seek<br />&nbsp; &nbsp; mov al, byte ptr&nbsp; <br />&nbsp; &nbsp; mov byte ptr , al<br />&nbsp; &nbsp; inc esi<br />&nbsp; &nbsp; inc edi<br />&nbsp; &nbsp; dec f_size<br />&nbsp; &nbsp; cmp al, &#39;h&#39;<br />&nbsp; &nbsp; jne @1<br /><br />;-- get next chars if &quot;h&quot; is found<br />&nbsp; &nbsp; lea edi, szBuffer2<br />&nbsp; &nbsp; xor ecx, ecx<br />&nbsp; &nbsp; mov byte ptr , &#39;h&#39;<br />&nbsp; &nbsp; inc edi<br />&nbsp; &nbsp; mov al, byte ptr&nbsp; <br />&nbsp; &nbsp; mov byte ptr , al<br />&nbsp; &nbsp; inc esi<br />&nbsp; &nbsp; inc edi<br />&nbsp; &nbsp; dec f_size<br />&nbsp; &nbsp; mov al, byte ptr&nbsp; <br />&nbsp; &nbsp; mov byte ptr , al<br />&nbsp; &nbsp; inc esi<br />&nbsp; &nbsp; inc edi<br />&nbsp; &nbsp; dec f_size<br />&nbsp; &nbsp; mov al, byte ptr&nbsp; <br />&nbsp; &nbsp; mov byte ptr , al<br />&nbsp; &nbsp; inc esi<br />&nbsp; &nbsp; inc edi<br />&nbsp; &nbsp; dec f_size<br />&nbsp; &nbsp; mov al, byte ptr&nbsp; <br />&nbsp; &nbsp; mov byte ptr , al<br />&nbsp; &nbsp; inc esi<br />&nbsp; &nbsp; inc edi<br />&nbsp; &nbsp; dec f_size<br /><br />;-- compare with &quot;href=&quot;<br />&nbsp; &nbsp; invoke lstrcmp, addr szHttp,addr szBuffer2<br />&nbsp; &nbsp; .if !eax&nbsp; ; if found get link<br /><br />&nbsp; &nbsp; inc esi ; remove &quot; or &#39;<br />&nbsp; &nbsp; inc edi<br />&nbsp; &nbsp; dec f_size<br /><br />&nbsp; &nbsp; lea edi, szBuffer3<br />&nbsp; &nbsp; xor ecx, ecx<br /> @3:<br />&nbsp; &nbsp; mov al, byte ptr&nbsp; <br />&nbsp; &nbsp; mov byte ptr , al<br />&nbsp; &nbsp; inc esi<br />&nbsp; &nbsp; inc edi<br />&nbsp; &nbsp; dec f_size<br />&nbsp; &nbsp; .if al==&quot;&#39;&quot;<br />&nbsp; &nbsp; mov byte ptr , 0<br />&nbsp; &nbsp; invoke&nbsp; SendDlgItemMessageA,mainhwnd,2000,LB_ADDSTRING,0,addr szBuffer3 ; insert link in listbox<br />&nbsp; &nbsp; .elseif al==&#39;&quot;&#39;<br />&nbsp; &nbsp; mov byte ptr , 0<br />&nbsp; &nbsp; invoke&nbsp; SendDlgItemMessageA,mainhwnd,2000,LB_ADDSTRING,0,addr szBuffer3 ; insert link in listbox<br />&nbsp; &nbsp; .else<br />&nbsp; &nbsp;  jmp @3 <br />&nbsp; &nbsp; .endif<br /><br />;invoke MessageBox,0,addr szBuffer3,addr szBuffer3,0<br /><br />&nbsp; &nbsp; .endif&nbsp; &nbsp;  <br /><br />&nbsp; &nbsp; jmp @seeknext<br /><br />end_seek:<br />&nbsp; &nbsp;  invoke GlobalFree, hmem<br />&nbsp; &nbsp;  ret<br /><br /><br />but why is the website not full loaded when i use:<br />&nbsp; &nbsp; invoke InternetReadFile, hfile, hmem, seeksize, offset hresult<br /><br />and buffer: seeksize&nbsp; dd 50000&nbsp; &nbsp; ;&lt;- amount of chars to read from page<br /><br />seams the page is only half readet.<br />i size up the buffer and write the data to txt file, the page is not full loadet.<br /><br />how can i load the page full ?<br />do i forgot something ?<br /><br /><br /><br /></div>
    <div class="meta">Posted on 2006-04-28 17:39:47 by xanthos</div>
   </div>
   <div class="post" id="post-180213">
    <div class="subject"><a href="#post-180213">Re: search for words and sort out</a></div>
    <div class="body">xanthos,<br /><strong>lstrcmp</strong> is a case sensitive cmpare API, you need to use a none case sensitive<br />one like <strong>lstrcmpi</strong>. This way if the html tags are caped or not it will still work<br />right, I wrote this real quick and have not tested it but it should work<br />as this is a simple operation. It is in no way optimized :shock:<br /><br />This function will search (filesize) bytes for a string(pTo_Find)<br />searching in hMem$ for the string if it finds it it will return a<br />pointer into hMem$ where the string was found.<br />otherwise it returns -1 for not found in hMem$ anywhere.&nbsp; :lol:<br /><br /><pre><code><br /><br />;*************************************************************************<br />; This function will find the string in hMem$ and will search all bytes<br />; (filesize) for the tring pTo_Find. if it finds it will return a pointer<br />; to the start of that string. else eax == -1<br />;*************************************************************************<br />Find_String proc hMem$:DWORD,filesize:DWORD,pTo_Find:DWORD<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LOCAL i_pointer&nbsp;  :DWORD<br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov esi,hMem$ ;&lt;--- points to the html file data.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov <em>,eax&nbsp;  <br /><br />&nbsp;  .while filesize &gt; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov ecx,4<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov esi,<em><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov edi,offset buffer<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .while ecx &gt; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov al,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov ,al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  inc edi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  inc esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov byte ptr,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dec ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .endw<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke lstrcmpi,addr buffer,pTo_Find<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .if eax == 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp Found_It<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .endif<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc <em><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dec filesize<br />&nbsp;  .endw<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov eax,-1&nbsp; ; did not find it.<br />&nbsp; &nbsp; &nbsp; &nbsp;  ret<br />Found_It:<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov eax,<em>&nbsp; ; return with pointer to the start of the found string<br />&nbsp; &nbsp; &nbsp; &nbsp;  ret<br />Find_String endp<br /><br /></code></pre><br /><br />Zcoder....</div>
    <div class="meta">Posted on 2006-04-28 17:42:32 by Zcoder</div>
   </div>
   <div class="post" id="post-180214">
    <div class="subject"><a href="#post-180214">Re: search for words and sort out</a></div>
    <div class="body">xanthos ,<br />you must loop doing InternetReadFile until it returns TRUE<br />and lpdwNumberOfBytesRead param == 0<br /><br />that way you will have read in the whole file.<br /><br />Zcoder....</div>
    <div class="meta">Posted on 2006-04-28 17:56:20 by Zcoder</div>
   </div>
   <div class="post" id="post-180221">
    <div class="subject"><a href="#post-180221">Re: search for words and sort out</a></div>
    <div class="body">The problem with HTML is that the standard allows for a LOT of slack in how tags are generated. Case sensivity is just one thing, but you also have to consider/support whitespace, double-quotes or the lack of them, et cetera. If you need to do a fair amount of HTML processing, you should look into regular expressions :)</div>
    <div class="meta">Posted on 2006-04-29 03:15:10 by f0dder</div>
   </div>
   <div class="post" id="post-180224">
    <div class="subject"><a href="#post-180224">Re: search for words and sort out</a></div>
    <div class="body">thank you very much for the help :-)<br /><br /><div class="quote"> you must loop doing InternetReadFile until it returns TRUE<br />and lpdwNumberOfBytesRead param == 0 </div><br /><br />you are right, this little code now makes it.<br />&nbsp; &nbsp; &nbsp; &nbsp; InternetReadFile...<br />	mov eax,CurrentDataSize<br />	add eax,Bufferlen<br />	mov CurrentDataSize, eax<br /><br />	.if Bufferlen != 0&nbsp; &nbsp; &nbsp; &lt;--- check size<br />	&nbsp; &nbsp; invoke WriteFile, fHand, addr Buffer, Bufferlen, addr bwrite, NULL<br />	&nbsp; &nbsp; jmp download<br />	.endif <br /><br /><div class="quote">The problem with HTML is that the standard allows for a LOT of slack in how tags are generated.</div><br /><br />yes i dont know this before and wonder why only some links are shown up and when i look in html code, is see some start/ends with &quot; or &#39; so i search for booth.<br /><br /><div class="quote">This function will search (filesize) bytes for a string(pTo_Find)<br />searching in hMem$ for the string if it finds it it will return a<br />pointer into hMem$ where the string was found.<br />otherwise it returns -1 for not found in hMem$ anywhere.&nbsp; </div><br /><br />thanks a lot for the snippet :-)<br /><br />wish you a nice weekend, posting results the next days in hope of a finish link reader.<br /><br /><br /><br /><br /><br /><br /><br /></div>
    <div class="meta">Posted on 2006-04-29 07:02:01 by xanthos</div>
   </div>
  </div>
 </body>
</html>