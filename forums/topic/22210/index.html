<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ATL window &amp; ActiveX - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=22210" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=116">Windows</a> &raquo; <a href="../?id=22210">ATL window &amp; ActiveX</a></p>
   <div class="post" id="post-167036">
    <div class="subject"><a href="#post-167036">ATL window &amp; ActiveX</a></div>
    <div class="body">I was trying to use an activX control in a standatd window. I found documentation on ATL and<br />was pleased when my knoledge of COM bore fruit in producing a very simple peice of code displaying<br />an html file. The ms ATL documents are all c++ based and as I have no talent for this, I am finding it<br />dificult to to get on any further.<br />can anyone help?<br /><br />&nbsp; &nbsp; problem: I am wanting to use the HostWindow  methods<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  CreateControl and AttachControl.&nbsp; - I cannot find any vtable refrence to these<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  or a CLSID.<br /><br />I hope I am on the right track. This is the main part of code as far as Ive got. <br /><em><br /><br /><pre><code>;having run AtlAxWinInit<br />;&nbsp; .<br />;&nbsp; .<br />;&nbsp; .<br />.if uMsg == WM_CREATE<br />&nbsp; &nbsp; &nbsp; &nbsp;  ; will display the html page pointed to by the window text.<br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke CreateWindowEx,0,SADD(&quot;AtlAxWin&quot;),SADD(&quot;c:\win32.html&quot;),WS_CHILD or WS_VISIBLE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 120,20,512,384,hWin,NULL,hInstance,NULL<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov hWeb,eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; this window has no scroll, edges or borders<br /><br />; section 1 ------------<br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke RegisterWindowMessage,SADD(&quot;WM_ATLGETCONTROL&quot;)<br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke SendMessage,hWeb,eax,0,0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; get loaded object <br />&nbsp; &nbsp; &nbsp; &nbsp;  mov browserObject,eax<br />&nbsp; &nbsp; &nbsp; &nbsp;  ole32 browserObject,0,offset IID_IWebBrowser2,offset pIweb2obj ; QueryInterface<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; to IWebBrowser2 vtable<br />&nbsp;  ; I now can access methods in IWebBrowser2 successfuly,<br />&nbsp;  ;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ole32 pIweb2obj,IWebBrowser2_Navigate,offset uStringFullPath,0,0,0,0<br />&nbsp;  ;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ole32 pIweb2obj,IWebBrowser2_GoBack<br />&nbsp;  ;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ole32 pIweb2obj,IWebBrowser2_GoForward&nbsp; &nbsp; &nbsp; &nbsp;  ...etc<br /><br />; section 2 ------------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke RegisterWindowMessage,SADD(&quot;WM_ATLGETHOST&quot;)<br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke SendMessage,hWeb,eax,0,0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; get the host object <br />&nbsp; &nbsp; &nbsp; &nbsp;  mov HostObject,eax<br /><br />&nbsp;  ; my problem ***<br />&nbsp;  ;&nbsp; &nbsp; &nbsp; &nbsp;  ole32 HostObject,0,offset &#39;Missing_GUID_?&#39;,offset pIwebHost&nbsp; ; QueryInterface<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; to &#39;missing vtable&#39; ?<br />&nbsp;  ;&nbsp; &nbsp; &nbsp; &nbsp;  I want to access the methods ,<br />&nbsp;  ;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; **&nbsp; CreateControl and AttachControl&nbsp; **</code></pre><br /><br />thanks,<br />dougiem</div>
    <div class="meta">Posted on 2005-10-18 15:15:50 by dougiem</div>
   </div>
   <div class="post" id="post-167073">
    <div class="subject"><a href="#post-167073">Re: ATL window &amp; ActiveX</a></div>
    <div class="body">I have found the missing bits:<br /><br /><pre><code>sIID_IAxWinHostWindow&nbsp; MGUID (B6EA2050-048A-11d1-82B9-00C04FB9942E)<br />IID_IAxWinHostWindow&nbsp;  GUID sIID_IAxWinHostWindow<br /><br />;== IAxWinHostWindow ============================================<br />IAxWinHostWindow_QueryInterface&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  equ 000h&nbsp; &nbsp; &nbsp; ;riid,ppvObject<br />IAxWinHostWindow_AddRef&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  equ 004h<br />IAxWinHostWindow_Release&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; equ 008h<br />IAxWinHostWindow_CreateControl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; equ 00ch&nbsp; &nbsp; &nbsp; ;lpTricsData,hWnd,pStream<br />IAxWinHostWindow_CreateControlEx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; equ 010h&nbsp; &nbsp; &nbsp; ;lpTricsData,hWnd,pStream,ppUnk,riidAdvise,punkAdvise<br />IAxWinHostWindow_AttachControl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; equ 014h&nbsp; &nbsp; &nbsp; ;pUnkControl,hWnd<br />IAxWinHostWindow_QueryControl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  equ 018h&nbsp; &nbsp; &nbsp; ;riid,ppvObject<br />IAxWinHostWindow_SetExternalDispatch&nbsp; &nbsp; &nbsp; &nbsp; equ 01ch&nbsp; &nbsp; &nbsp; ;pDisp<br />IAxWinHostWindow_SetExternalUIHandler&nbsp; &nbsp; &nbsp;  equ 020h&nbsp; &nbsp; &nbsp; ;pDisp<br /><br />.data<br />WSTR uStringFullPath, &quot;c:\win32.html&quot;<br />.code<br />;having run AtlAxWinInit<br />;&nbsp; .<br />;&nbsp; .SADD(&quot;c:\win32.html&quot;)<br />;&nbsp; .<br />;.if uMsg == WM_CREATE<br />&nbsp; &nbsp; &nbsp; &nbsp;  ; will display the html page pointed to by unicode string uStringFullPath.<br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke CreateWindowEx,0,SADD(&quot;AtlAxWin&quot;),0,WS_CHILD or WS_VISIBLE,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 120,20,512,384,hWin,NULL,hInstance,NULL<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov hWeb,eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; this window has no scroll, edges or borders<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke RegisterWindowMessage,SADD(&quot;WM_ATLGETHOST&quot;)<br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke SendMessage,hWeb,eax,0,0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; get the host object <br />&nbsp; &nbsp; &nbsp; &nbsp;  mov HostObject,eax<br /><br />&nbsp; &nbsp; &nbsp; &nbsp;  ole32 HostObject,0,offset IID_IAxWinHostWindow,offset pIwebHost ; QueryInterface<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; to IAxWinHostWindow vtable<br /><br />&nbsp; &nbsp; &nbsp; &nbsp;  ole32 pIwebHost,IAxWinHostWindow_CreateControl,offset uStringFullPath,0<br /><br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke RegisterWindowMessage,SADD(&quot;WM_ATLGETCONTROL&quot;)<br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke SendMessage,hWeb,eax,0,0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; get loaded object <br />&nbsp; &nbsp; &nbsp; &nbsp;  mov browserObject,eax<br />&nbsp; &nbsp; &nbsp; &nbsp;  ole32 browserObject,0,offset IID_IWebBrowser2,offset pIweb2obj&nbsp; ; QueryInterface<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; to IWebBrowser2 vtable</code></pre><br />dougiem</div>
    <div class="meta">Posted on 2005-10-20 09:21:51 by dougiem</div>
   </div>
  </div>
 </body>
</html>