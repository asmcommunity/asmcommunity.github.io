<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>More about ranges - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4419" />
  <link rel="prev" href="../?id=4419&amp;page=4" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=4419">More about ranges</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=4419&amp;page=1" style="">&laquo;</a><a href="../?id=4419&amp;page=4" style="">&lt;</a><input type="hidden" name="id" value="4419" /><input type="number" name="page" min="1" max="5" step="1" value="5" onchange="this.form.submit();" /></form>   <div class="post" id="post-31278">
    <div class="subject"><a href="#post-31278">More about ranges</a></div>
    <div class="body">I've got an idea how to make code in my first post in the thread 3 bytes shorter:<br /><pre><code><br />	lea ecx,&#91;edx-30h&#93;<br />	cmp ecx,10<br />	salc<br />	lea ecx,&#91;edx-'A'&#93;<br />	cmp ecx ,&#40;'G'-'A'&#41;<br />	adc al,al<br />	lea ecx,&#91;edx-'a'&#93;<br />	cmp ecx,&#40;'g'-'a'&#41;<br />	adc al,al<br />	je @notvalid<br /></code></pre></div>
    <div class="meta">Posted on 2002-03-28 02:37:14 by The Svin</div>
   </div>
   <div class="post" id="post-31291">
    <div class="subject"><a href="#post-31291">More about ranges</a></div>
    <div class="body">A little bit different - size the same but less dependences:<br /><pre><code><br />	lea ecx,&#91;edx-30h&#93;<br />	mov ah,6		 <br />	cmp ecx,10		 <br />	lea ecx,&#91;edx-'A'&#93;<br />	db 0d6h			<br />	cmp cl,ah		<br />	lea ecx,&#91;edx-'a'&#93;<br />	adc al,al		<br />	cmp cl,ah		<br />	adc al,al		<br />	je @notvalid<br /></code></pre></div>
    <div class="meta">Posted on 2002-03-28 04:06:12 by The Svin</div>
   </div>
   <div class="post" id="post-31292">
    <div class="subject"><a href="#post-31292">More about ranges</a></div>
    <div class="body">Spent the last 30 minutes reading in detail the arguements :)<br /><br />I have just one thing to say...<br /><br />Maverick:  Nice Work... <br />BitRake: Nice Work...<br />Svin: Nice Work...<br />Jens:  You suck... but I like your StrLen example :alright: <br />:) :) :)<br /><br />I think we should all take it a bit easier on each other...<br />Tempers rise from time to time, but remember it is always for the greater good... Remember that before you post something<br /><br />Sliver (aka. The keeper of peace)<br /><br />ps. Jens you did great work too... :)</div>
    <div class="meta">Posted on 2002-03-28 04:15:14 by Sliver</div>
   </div>
   <div class="post" id="post-31312">
    <div class="subject"><a href="#post-31312">More about ranges</a></div>
    <div class="body"><div class="quote">I would hope that we can learn to communicate well, for there is much that we should learn from each other.  There is nothing more important for me!</div>I'm really glad to hear that.. but frankly I'm quite sick to have to reply to pedantic notes some times, as if one couldn't add a bounds checking routine by himself to my public domain routine, instead of saying that I was cheating something. I didn't attach copyrights and such, I showed some code and, unlike others, I gave precise step by step explanations of how and why it works and what to do with it and how to modify it, etc.. I'm not here to make competitions, although I'd have no problems to do them as well. But for me competitions are a job thing.. I see this place as a friendly forum instead.<br /><br /><div class="quote">I was very surprised of the BT mem,reg execution as well. The manual states a latency of 8 cycles. I can execute nine instructions before the BT without them having any additional cost, but none after without it costing more cycles! BT mem,reg takes 5 cycles to complete. This is on a Athlon TB - I know you have an XP. Of the 5 cycles, the first three can pair with other instructions, but the latter two execute alone.</div>I think it was me (my lawyer suggests me to add this disclaimer: &quot;I did <strong>not</strong> say me <em>exclusively</em>&quot; ;) ) who said &quot;do not delete any routine or method, you'll have a use for it someday&quot;, so..<br /><br />The Svin: just a remark (if you wish to read):<br /><br />Why wait 11 instructions to detect the error, when you can do it much sooner?<br />You could temporarily patch/hook the routine to build a statistic about, when the routine detects &quot;out of range&quot;, what is the range that causes this, and then sort what are the most frequent ranges.<br />Then insert various branch instructions instead of ADC, so to jump out sooner. Check first for the most probable &quot;out of range&quot; conditions, and so on with the others.<br /><br />Algorithm will perform equal in the worst case, and better depending on statistics.<br />Algorithm/routine/implementation will anyway perform even better, since instruction count will become shorter (adc -&gt; jxx, so no final jxx).<br />Try to use EAX/AL when using CMP, because it results in shorter code (SALC that you used is another idea. For who doesn't know this instruction, it's undocumented but to my best knowledge it is supported by all modern and semi-modern Intel and non-Intel CPU's, and it's equivalent to SBB AL,AL, but shorter, and doesn't update flags (not that that would count in this application)).<br /><br />BTW: SBB reg,reg can be expressed as a virtual instruction that I would call &quot;MOVX reg,CF&quot; (i.e. copy carry flag to all the bits of the specified register). We may also call it &quot;MOV reg,CF&quot;. bitRAKE: what about a macro to implement this and other &quot;virtual instructions&quot;? It would help many beginners when they want to set all bits of a reg depending on the carry flag.. easier to remember MOV reg,CF or MOVX reg,CF than SBB reg,reg.<br /><br /><br />The Svin: to return to our discussion, try this possible implementation (applies the statistic method I mentioned above (i.e. reorders ranges to exploit statistics)):<br /><pre><code><br />;ISHEX? Maverick's non-bitmap-register-lookup method &#40;which as I said wasn't the best way<br />;to implement a ISHEX? algorithm, here is a better method, given the rules of this test&#41;<br />                                CMP             AL,'g'                  ; AL = char<br />                                JNC             .not_a_hex_digit<br />                                CMP             AL,'0'<br />                                JC              .not_a_hex_digit<br />                                LEA             EAX,&#91;EAX-'G'&#93;<br />                                CMP             AL,'a'-'G'<br />                                JC              .not_a_hex_digit<br />                                LEA             EAX,&#91;EAX-&#40;'9'+1-'G'&#41;&#93;<br />                                CMP             AL,'A'-'9'-1<br />                                JC              .not_a_hex_digit<br /></code></pre><br /><br />Faster, shorter, etc.. etc..<br /><br />On my Athlon-XP it runs at (average for all 256 possible cases that cover the whole ASCII characters map) 1.64453125 cycles, vs 4.0000000 cycles of your last routines (both perform the same).<br /><br />On other CPU's (Intel maybe) you may encounter serious stalls using my above routine, so change all CMP's &quot;AL&quot; istances to &quot;EAX&quot;: speed is 1.73046875 cycles on my Athlon-XP.. and should be the same speed on those CPU's.<br /><br />I have to stress: make your own executable format, dynamically loaded/linked, and make automatic load of the right routine depending on the host CPU. There's no reason to use the 1.73046875 cycles routine on a Athlon-XP.. why should we squeeze our brains on optimizations when we then waste cycles in such a stupid way? Standard tools are a prison.<br /><br />As I said in my previous posts, I thought it was unfair to force me to use my bitmap register lookup method for HEX validation, since (although it was by far the fastest proposed one, in any case) I'd do it in a different way. My last routine should perform very well also on Pentiums (and is Pentium compatible), also, the same identical routine (changing only some operands) can validate also for alphanumeric, not just HEX.<br />Mine are just discussions of algorithms and techniques, I do not imply (disclaimer that I wish I didn't have to write.. but you never know now) that things in real applications couldn't be done better, or in a different way, I was the first one who stressed here the difference between theory and real world applications. Given the test rules, I wrote this code. I myself wouldn't even always use my ISHEX? routine, if you want to know. I hate to limit myself to a standard solution, in my programming language I even use normally a custom character set which is not ASCII, but is my custom one (I have ASCII support for import/export, though). I didn't like the rules you've set.<br />I use to seek for the most proper routine/solution _only_ after given a specific application (which is, probably, do things in a way that doesn't require any validation check at all).<br /><br />I have nothing to prove, you could have added the bounds checking to my bitmap register lookup method by yourself instead of accusing me of unfair comparisons, mine were just advices. I proved my affirmations this time, I think you will agree I know how to code in assembly as well as how to find optimal algorithms, next time though I may not bother even if you say I talk and don't prove (as in the nazi thread, you recall?). I have limited time for such things, but I feel I have nothing to prove to anybody, also because when I say something it's never to look smarter than I am, sometimes I don't even care about the opposite. I don't bother, I believe in honesty (not for religion, I'm atheist.. but for self-esteem) and I am fine with myself, that's all I really care about.<br /><br />I hope the polemic ends here.. I tryed to support you with some of my work, I hope you finally appreciate that.<br /><br /><br />PS: just for more completeness:<br /><br />ISALPHANUMERIC? (uppercase and lowercase supported, as quick as my ISHEX? routine.. besides slight branch misprediction differences, which in short gives me on this standard ASCII-range test 1.80078125 cycles on average per call)<br /><br />Again, change all AL to EAX for CPU's that suffer from eventual stalls. Things are always more tricky than CPU datasheets want to make you believe.. expecially on very modern CPU's. Don't believe to data sheets blindly.. PROFILE, PROFILE, PROFILE! That may make you discover a new thing every time, and anyway give you sureness that your code is ok as you think.<br /><pre><code><br />                                CMP             AL,'z'+1                ; AL = char<br />                                JNC             .not_alphanumeric<br />                                CMP             AL,'0'<br />                                JC              .not_alphanumeric<br />                                LEA             EAX,&#91;EAX-'Z'-1&#93;<br />                                CMP             AL,'a'-'Z'-1<br />                                JC              .not_alphanumeric<br />                                LEA             EAX,&#91;EAX-'9'+'Z'&#93;<br />                                CMP             AL,'A'-'9'-1<br />                                JC              .not_alphanumeric<br /></code></pre><br /><br />Mine was originally meant as a quick (and hopefully appreciated) contribution to the 64 bit bitmap register lookup method only, but all of this useless polemic made me use <strong>much</strong> more time on it. Worse than all, none of the routines showed until now can be considered ideal nor definitive if the specific application isn't taken into serious account. Like to say, it was all useless work.<br /><br />I wish I could contribute more, but I'll be off for some time. Too much job engagements to finish. :mad:</div>
    <div class="meta">Posted on 2002-03-28 07:48:19 by Maverick</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=4419&amp;page=1" style="">&laquo;</a><a href="../?id=4419&amp;page=4" style="">&lt;</a><input type="hidden" name="id" value="4419" /><input type="number" name="page" min="1" max="5" step="1" value="5" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>