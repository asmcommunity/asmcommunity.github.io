<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>More about ranges - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4419" />
  <link rel="prev" href="../?id=4419&amp;page=3" />  <link rel="next" href="../?id=4419&amp;page=5" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=4419">More about ranges</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=4419&amp;page=1" style="">&laquo;</a><a href="../?id=4419&amp;page=3" style="">&lt;</a><input type="hidden" name="id" value="4419" /><input type="number" name="page" min="1" max="5" step="1" value="4" onchange="this.form.submit();" /><a href="../?id=4419&amp;page=5">&gt;</a><a href="../?id=4419&amp;page=5">&raquo;</a></form>   <div class="post" id="post-31143">
    <div class="subject"><a href="#post-31143">More about ranges</a></div>
    <div class="body"><div class="quote"><br />That means that th code you compared can not be compared.<br />One checks 256 possibility range the other 64 possibilities.<br />In PMMX btw your profile shows 5 ticks for bt memory version. </div>It can be compared because Jens' code and bitRAKE reply was about a 64 bit lookup table method. Even adding a CMP/JAE makes my method faster, so what the heck?<br /><br />I hope you don't want to turn this thread into a compo about the fastest HEX validity check routine, I could join but I'd have a better use of my time than that.<br /><br />I gave you a method to perform 64 (or more) bit two state lookups, you're free to use or not to use it. If you want to make extra validity checks, by any means you're free to add them.. it'll still be fast.<br /><br />It was not me who wanted to make comparisons that specific way, I am here to contribute and help, not to make compos.</div>
    <div class="meta">Posted on 2002-03-27 07:40:44 by Maverick</div>
   </div>
   <div class="post" id="post-31145">
    <div class="subject"><a href="#post-31145">More about ranges</a></div>
    <div class="body">Also, if you want to be fair, you will notice that when I tested Jens's and bitRAKE's code to mine, I deliberately removed their extra instructions (like SUB '0') to make an *extremely* fair comparison. As well as I used the best case (perfectly cacheline aligned, 100% cached, etc..) for your BT ,ECX &quot;method&quot; (which rather than a method is, really, an Intel instruction). Also, it's not my &quot;fault&quot; if bitRAKE's method had &quot;incidentally&quot; out of bounds control, and I credited him for that.<br /><br />So I don't understand what do you complain against my &quot;fairness&quot;. Perhaps that I wasn't extremely fair (re-read all of the above), and you found a CPU where my Athlon cycles count was a bit worse? Again, if you re-read my posts you will find only extreme honesty in comparisons, and I clearly stated that the method was for P6 and not the old P5 (or 386, nor 8088 for the matter).<br /><br />Next time that I read your:<br /><br /><div class="quote"><br />Jens, I've analyzed your method. <br />Man... You are very talanted! <br />I'm glad I asked you for comments.</div><br /><br />and bitRAKE's:<br /><br /><div class="quote">Very creative approach Jens Duttke! I like it, and will be using something similar in the future. Eliminates two-state small table lookups.</div><br /><br />you teach me I better use my time for myself instead for you. Right?</div>
    <div class="meta">Posted on 2002-03-27 07:58:29 by Maverick</div>
   </div>
   <div class="post" id="post-31146">
    <div class="subject"><a href="#post-31146">More about ranges</a></div>
    <div class="body">First of all:<br />1. My credits was for his(Jens) comments not for code.<br />His code doesn't work, if you read my followed posts carefully.<br />2. Jens tried (though failed) to analyze whole 256 byte range.<br />Though his mask was just 64 bits he tried by prologue to using mask<br />and triky following code to handle all 256 possibilities.</div>
    <div class="meta">Posted on 2002-03-27 08:12:24 by The Svin</div>
   </div>
   <div class="post" id="post-31147">
    <div class="subject"><a href="#post-31147">More about ranges</a></div>
    <div class="body">1) I know that Jens code doesn't work - if you read my post carefully I (politely) stated that. I still think you appreciated the method.. that was what I meant, if you read between the lines.<br />2) I don't see what's special in 256 byte ranges. Do you limit yourself to lone ASCII (specific) applications? This method is &quot;bitmap register lookup&quot;, it has nothing to do per se with ASCII or any specific application. <br />3) I see I wasted enough of my time on this whole thing.<br /><br />Regards.<br />Maverick</div>
    <div class="meta">Posted on 2002-03-27 08:16:51 by Maverick</div>
   </div>
   <div class="post" id="post-31148">
    <div class="subject"><a href="#post-31148">More about ranges</a></div>
    <div class="body"><div class="quote">I see I wasted enough of my time on this whole thing</div> <br />You have a talant man to turn any sientific discussion into personal things :)<br />Meveric, when somebody tries to analyze(or critisize) my method (or thoughts) or beat my code I take it as sign of respect, 'cause it is ferm fact that he wasted his time (found worthy to waste it) to follow and study my things.<br />Why almost any negative comments about your things you take as a personal insults?<br /><br />I'll leave you alone if you want, but I thought we here is not as nominant for a Nobel medal, so the only advantage of this to seek for new thought, methods, analyze them, critisize them etc. in a single goal - to make our pro level better.<br /><br />Anyway if it's for good I'll leave the section for a while :)<br />It's been a long time since my last feedback Ewayne about bugs in his nice ResEdit :)<br />I 'm coming Ewayne!!! Ugly evel Svin is going to report a lot of bugs about your darm groupbox logic !!!! :) <br />He always thanks for critics (or maybe it's just template for <br />msg post? Steve always write Regards and Ewayne Thanks?!)<br />;)<br />be well...</div>
    <div class="meta">Posted on 2002-03-27 08:34:58 by The Svin</div>
   </div>
   <div class="post" id="post-31149">
    <div class="subject"><a href="#post-31149">More about ranges</a></div>
    <div class="body"><div class="quote"><br />Also, it's not my &quot;fault&quot; if bitRAKE's method had &quot;incidentally&quot; out of bounds control, and I credited him for that.</div>&quot;By Design&quot;, silly - it wasn't an accident. :cool:<br /><br />Also, two instructions are hard to get an accurate timing on<br />Athlon when three instruction can execute in parallel. :)</div>
    <div class="meta">Posted on 2002-03-27 08:39:46 by bitRAKE</div>
   </div>
   <div class="post" id="post-31151">
    <div class="subject"><a href="#post-31151">More about ranges</a></div>
    <div class="body">The Svin: <strong>constructive</strong> criticisms are always welcome. But it's not to waste my time that I write affirmations (like &quot;ecx must be 0..63&quot;), so I don't consider too much constructive a criticism that ignores what I explicitly wrote, or that makes seem less fair a comparison that I've made where extreme fairness was the very first goal.<br />Maybe you haven't read with enough attention the above, so I will repeat: <strong>constructive</strong> criticisms are always welcome.<br /><br />bitRAKE: I've put &quot;incidentally&quot; into quotes not by accident as well. :rolleyes:</div>
    <div class="meta">Posted on 2002-03-27 08:59:47 by Maverick</div>
   </div>
   <div class="post" id="post-31152">
    <div class="subject"><a href="#post-31152">More about ranges</a></div>
    <div class="body"><div class="quote">constructive criticisms are always welcome</div> <br />I always say what I mean without hidden allusions:<br />You compared things wich can not be compared - no more no less.<br />To compare things you need to bring it to one ethalon.<br />If you want to compare bt <table> to your code - you can do it<br />but bring table to 64 bits that's it.<br />Then compare.<br />That's all I said.<br />Not about what method is better or not, not about fairness or some personal shit.<br />Pure math logic - pointing out to incorrect compareson conditions.<br />Could you just concentrate on technical details and take all this personal reflection apart?</div>
    <div class="meta">Posted on 2002-03-27 09:10:54 by The Svin</div>
   </div>
   <div class="post" id="post-31155">
    <div class="subject"><a href="#post-31155">More about ranges</a></div>
    <div class="body"><div class="quote"><em>bitRAKE wrote:</em>Also, two instructions are hard to get an accurate timing on Athlon when three instruction can execute in parallel. </div>Do you mean your method is faster, or what? I don't follow you..<br /><br /><br /><div class="quote"><em>The Svin wrote:</em>I always say what I mean without hidden allusions: <br />You compared things wich can not be compared - no more no less. <br />To compare things you need to bring it to one ethalon. <br />If you want to compare bt <table> to your code - you can do it <br />but bring table to 64 bits that's it.</div>Are you blind or what? That's what I did.. I compared all methods on 64 iterations, not 256. So what are you trying to say now?<br /><br />You want to enforce me into making you buy that I would really use my method to do HEX validity check? Ok.. here you're served:<br /><br />ISHEX? (lowercase and uppercase supported, covers whole ASCII characters map)<br />;input: AL = character to test<br /><pre><code><br />                LEA     ECX,&#91;EAX-'0'&#93;<br />                MOV     EBX,MASK1<br />                CMP     CL,'g'-'0'<br />                JAE     .notvalid<br />                MOV     EAX,MASK2<br />                CMP     CL,32<br />                CMOVC   EAX,EBX<br />                BT      EAX,ECX<br />                JNC     .notvalid<br /></code></pre><br /><br />256 iterations: 2.34375 cycles on average per iteration.<br /><br />Happy now?<br /><br /><br /><div class="quote">Pure math logic - pointing out to incorrect compareson conditions. </div>Where did I ever do that?? I compared them on 64 iterations.. (shall I quote it? &quot;64 iterations of which, on my Athlon, take xxx cycles&quot;) now if you wanted to be blind, it's not my fault.</div>
    <div class="meta">Posted on 2002-03-27 09:48:43 by Maverick</div>
   </div>
   <div class="post" id="post-31156">
    <div class="subject"><a href="#post-31156">More about ranges</a></div>
    <div class="body"><div class="quote">Are you blind or what? That's what I did.. I compared all methods on 64 iterations</div> <br />Are you drunk or what?<br />64 bits is size not time.</div>
    <div class="meta">Posted on 2002-03-27 09:51:49 by The Svin</div>
   </div>
   <div class="post" id="post-31157">
    <div class="subject"><a href="#post-31157">More about ranges</a></div>
    <div class="body"><div class="quote"><br />Do you mean your method is faster, or what? I don't follow you..</div>No, I'm speaking of the method that <strong>buliaNaza</strong> has posted BT/JNC.  It is the only two instruction method posted above - I could call you 'blind' here, but it would only serve to admit my extreme dis-like for your words to <strong>Svin</strong> - he can take care of himself. :)</div>
    <div class="meta">Posted on 2002-03-27 09:56:23 by bitRAKE</div>
   </div>
   <div class="post" id="post-31159">
    <div class="subject"><a href="#post-31159">More about ranges</a></div>
    <div class="body"><div class="quote"><br /> <br />Are you drunk or what?<br />64 bits is size not time. </div>Dammit, you must be stupid.. 64 iterations test for all 64 possible bits in the bitmap.<br /><br />Hello? Is anybody home? :grin:<br /><br />;)</div>
    <div class="meta">Posted on 2002-03-27 10:02:40 by Maverick</div>
   </div>
   <div class="post" id="post-31160">
    <div class="subject"><a href="#post-31160">More about ranges</a></div>
    <div class="body"><div class="quote"><br />No, I'm speaking of the method that <strong>buliaNaza</strong> has posted BT/JNC.  It is the only two instruction method posted above - I could call you 'blind' here, but it would only serve to admit my extreme dis-like for your words to <strong>Svin</strong> - he can take care of himself. :) </div>Look bitRAKE, if you put a JNC after a BT then there's no many miracles the CPU can do to make it fast. JC will have to wait for BT to complete, simple as that.<br />Also, I wouldn't call an instruction that Intel has designed *precisely* for this purpose an &quot;algorithm&quot;, or a &quot;method&quot;. I didn't see buliaNaza claim anything like that, so I don't see why you should make it seem that way.<br /><br />About dis-liking words, you should take your own responsabilities, as well as The Svin against me. There are many posts above to attest how things went, who was blind and who called drunk who.</div>
    <div class="meta">Posted on 2002-03-27 10:06:36 by Maverick</div>
   </div>
   <div class="post" id="post-31161">
    <div class="subject"><a href="#post-31161">More about ranges</a></div>
    <div class="body"><div class="quote"><br />Also, I wouldn't call an instruction that Intel has designed *precisely* for this purpose an &quot;algorithm&quot;, or a &quot;method&quot;. I didn't see buliaNaza claim anything like that, so I don't see why you should make it seem that way.</div>True, but what should I call it?<br />Are there instructions before the BT?<br /><br />This discussion digresses quickly.  I am to blame as any.</div>
    <div class="meta">Posted on 2002-03-27 10:28:27 by bitRAKE</div>
   </div>
   <div class="post" id="post-31164">
    <div class="subject"><a href="#post-31164">More about ranges</a></div>
    <div class="body">bitRAKE:<br /><br />I see where all the problem arised: my fault is that I had too much<br />consideration for The Svin to believe that he doesn't understand such a<br />simple thing as:<br /><br />&quot;64 iterations of which on my Athlon runs at an average of 2.000 cycles per iteration.&quot;<br />in the very context of testing the average performance on all 64 possible checks.<br /><br />I do not want to think he's stupid (although he calls me &quot;drunk&quot;, this as<br />demonstration that is me who is being personal, not him), but I have it hard<br />to believe that he doesn't really understand a statement like the above which<br />was written several times (unless he didn't even bother to read it, hence my<br />&quot;if one wants to be blind it's not my fault&quot;).<br /><br />Not only he acts and writes as if I never wrote all those specifications, but<br />he even accuses me of doing the opposite of what I did. In fact I removed<br />instructions from yours and Jens's code to &quot;downsize&quot; them (so they run<br />faster) as much as possible to a simple, generic, 64 bit bitmap register<br />lookup method.. because that was I what explicitly comparing - and where it<br />wasn't fully possible, in your code's case, I credited the extra capabilities<br />(which were useless in that specific test I was interested in, anyway).<br /><br />But then all of the above gets ignored and The Svins forces it to be not a<br />generic bitmap register lookup method.. but a specific ASCII-validity one.<br /><br />He went off topic, and accused me of doing so.. while I always stated that<br />checking for out of bounds or subtracting '0' is a specific, and thus EXTRA,<br />application .. to which I wasn't interested.<br /><br />Even so, 2.34375 cycles per check on average on my method is still quite good,<br />maybe I could even improve it but I don't want nor need to bother.<br /><br />Also, bitRAKE, don't teach me education: it's you in some other thread that<br />went personal against me saying &quot;That is based on your level of paranoia&quot;,<br />in response to a simple question of mine with a big disclaimer &quot;I don't know<br />about the subject, I only heard rumors&quot;, so that the paranoia, if of anybody,<br />can't be mine anyway. Even if I was harsh against Microsoft, I wasn't against<br />anybody personally: but you were, calling me paranoid.<br /><br />As you used the adjective &quot;silly&quot; on me regarding an expression I used inside<br />quotes, and not for no reason. You read what you want to read, but you omit<br />what it's comfortable to omit.<br /><br />So, be clear, when you blame on my words read some posts above and see what<br />you write and what The Svin wrote before (no, I was not drunk.. I don't drink<br />alchoolics at all The Svin: think about yourself).<br /><br />Anyway, I gave you the technical satisfaction you asked: &quot;2.34375 cycles&quot; is<br />my last word on this subject, and my last reply to YOUR offensive and personal<br />assumptions or deliberate omissions and misreadings.<br /><br />It's sad anyway that there can't be friendship between me and The Svin: I've<br />always, although all of the past, tryed to be positive and polite towards him,<br />and to build instead of destroy.<br /><br />Same thing for you bitRAKE, that I esteem as coder but something I don't really<br />like how you act.. as calling me paranoid when I stated they were rumors I've<br />heard. Or in other occasions.<br /><br />I really had no time for that, but since The Svin and you seemed to be interested<br />in this kind of two-state lookups I really tryed to be friendly and help as much<br />as I could. Sure I've got my bad character at times, but I don't really think I'm<br />the one to blame for all of this situation. I was upset that my very explicit<br />specifications were ignored, as if I wrote for nothing, and opposite claims<br />were done where instead my goals were clearly others.</div>
    <div class="meta">Posted on 2002-03-27 11:01:23 by Maverick</div>
   </div>
   <div class="post" id="post-31167">
    <div class="subject"><a href="#post-31167">More about ranges</a></div>
    <div class="body"><div class="quote">Are there instructions before the BT?</div>Why are you and The Svin so unfair? When I was forced to test the Intel method I did so..<br />I tested only the BT/JNC, I removed the bound checking instructions that were before.<br />It took 12.421875 cycles per iteration, on average (all 64 possibilities).<br />I don't want to offend anybody, so I cheated and inverted JNC to JC.. result: 8.3125, which is less offensive to say the same advice &quot;stay away from this method, is not fast&quot;.<br />After all my lone goal was to help and give good advice, not to look like a smartass.<br /><br />So you are calling me unfair??? <br /><br />I think that enough is enough.. I better code my own stuff and do my own business.<br /><br />I have much work behind.</div>
    <div class="meta">Posted on 2002-03-27 11:20:13 by Maverick</div>
   </div>
   <div class="post" id="post-31171">
    <div class="subject"><a href="#post-31171">More about ranges</a></div>
    <div class="body"><strong>Maverick</strong>, I am not calling you anthing - I do not know you.  We are just speaking here of some code and the use of that code.  I am just curious of how you reach your conclusions.  My tests show that BT mem,reg has a latency of 3 cycles, where as BT reg,reg has a latency of 1 cycle.  Also, MOVcc performs very nicely on Athlons.  Hence, your combination of instructions is very favorable within the range where it works.  If more complete coverage of the input value is required, then the sequence of instructions I present perform well.  I would like to thank, <strong>Jens</strong> for moving the discussion in this direction of register bitmaps, for it lead to the other developments.</div>
    <div class="meta">Posted on 2002-03-27 11:59:48 by bitRAKE</div>
   </div>
   <div class="post" id="post-31178">
    <div class="subject"><a href="#post-31178">More about ranges</a></div>
    <div class="body">I've re-read all of the posts (a thing I advice you to do as well), and I<br />discovered that Jens code was meant to check for &gt;=64 bounds - I didn't notice<br />that before, I noticed it only for bitRAKE one (and credited for it).<br /><br />But I don't see where is the point: I've always said that extra features like<br />out of bounds checkings and SUB '0' are anyway extra, so since I've always<br />claimed I wasn't interested in any extra feature, but to talk about the generic<br />method itself, anyway I don't see why I had to be forced to implement these<br />extra features as well.<br /><br />If I got since the start that Jens's code attempted to do so, I would have<br />skipped directly my 2.000 cycles example and show since the start (also) the<br />2.34375 cycles version, which features extra things (like bound checkings)<br />that don't belong to the generic register bitmap method we were discussing.<br /><br />I thought that me and Jens were both doing it the &quot;generic way&quot;, and that<br />bitRAKE had extra features useful in certain specific applications. I thought<br />(I could be wrong) that he got the extra features for free, and that 2 vs 1 was<br />enough to not have to make a routine that checked for bound limits (then I did<br />it, as you know). I thought, if bitRAKE may get a generic routine (i.e. without<br />out of bound checks) faster than his one that features that extra thing, he<br />would surely post also that. Sure there are a lot of cases where the extra<br />out of bound checks aren't necessary.<br /><br />I always acted trying to be as much honest as possible, if I knew since the<br />start that Jens code attempted out of bounds protection, I would have posted<br />*both* of my routines at once, instead of posting the other later (which also<br />does SUB '0' that I had removed from both Jens and bitRAKE routines in my speed<br />tests .. but I'm not acting like a kid now and bothering about it and being<br />picky .. I wish I could say the same about others in this thread as well).<br /><br />Yet I thought it was pointless that The Svin attacked me, since my first<br />routine was so fast that even adding traditional bound checkings wasn't going<br />to change the scenario. Not that I wanted to claim better performances of my<br />routine than the real ones: the opposite, I removed as many instructions as<br />possible from the other 2 routines to test, so to make a fair compare (again,<br />I didn't know that Jens code attempted bound control, and I credited bitRAKE<br />because I knew his one did); my last routine does one more thing than Jens<br />and bitRAKE stripped down versions I used; I also said 8.3125 cycles for your<br />code, The Svin, (better, Intel code) while in reality it was 12.421875.<br /><br />Because of all of the above I was pissed to be attacked on the fairness side..<br />I think you could be indulgent a fraction of what I've been. Let away the &quot;just<br />want to be helpful&quot; extra stuff, of what personally I'm sick now. Never again.<br /><br />Anyway..</div>
    <div class="meta">Posted on 2002-03-27 12:18:16 by Maverick</div>
   </div>
   <div class="post" id="post-31227">
    <div class="subject"><a href="#post-31227">More about ranges</a></div>
    <div class="body"><div class="quote"><em>bitRAKE wrote:<br /></em>Maverick, I am not calling you anthing - I do not know you. We are just speaking here of some code and the use of that code. I am just curious of how you reach your conclusions. My tests show that BT mem,reg has a latency of 3 cycles, where as BT reg,reg has a latency of 1 cycle.</div>You are entitled to all the doubts that you want, but I'm quite sure I can profile code in a proper way. Anyway, here is how to finally test all of the four ISHEX? methods (uncomment one of the 4 routines to test it):<br /><br /><div class="quote">Also, MOVcc performs very nicely on Athlons. Hence, your combination of instructions is very favorable within the range where it works. If more complete coverage of the input value is required, then the sequence of instructions I present perform well.</div>You contraddict yourself: in a previous post you said that my method scales well, 1 cycle per additional DWORD mask, but now you said the opposite. Ehm?<br /><br /><br /><pre><code><br />MASK1 equ 007E03FFh<br />MASK2 equ 007E0000h<br />; let's make sure the table is cached in the best possible way<br />                                ALIGN           64<br />hexmask&#58; ;used only by routine 4<br />                                DD              0,1FF0000h,7Eh,7Eh,0,0,0,0<br /><br />; ---<br /><br />                                ALIGN           64<br />testme&#58;<br /><br />; ---<br /><br />;routine 1 &#40;Jens&#41;<br />                               ;sub             cl,48<br />                               ;xor             edx,edx<br />                               ;mov             eax,1<br />                               ;shld            edx,eax, cl<br />                               ;shl             eax,cl<br />                               ;and             eax,MASK1<br />                               ;and             edx,MASK2<br />                               ;or              eax,edx<br />                               ;jz              .not_a_hex_digit<br /><br />; ---<br /><br />;routine 2 &#40;bitRAKE&#41;<br />                               ;sub             ecx,'0'<br />                               ;mov             edx,MASK1<br />                               ;xor             eax,eax<br />                               ;bt              edx,ecx<br />                               ;mov             edx,MASK2<br />                               ;rcl             eax,1<br />                               ;bt              edx,ecx<br />                               ;rcl             eax,1<br />                               ;shr             ecx,5<br />                               ;bt              eax,ecx<br />                               ;jnc             .not_a_hex_digit   ;NOTE&#58; jc = .is_a_hex_digit<br /><br />; ---<br /><br />;routine 3 &#40;Maverick&#41;<br />                               ;LEA             ECX,&#91;ECX-'0'&#93;<br />                               ;MOV             EBX,MASK1<br />                               ;CMP             ECX,'g'-'0'<br />                               ;JAE             .not_a_hex_digit<br />                               ;MOV             EAX,MASK2<br />                               ;CMP             CL,32<br />                               ;CMOVC           EAX,EBX<br />                               ;BT              EAX,ECX<br />                               ;JNC             .not_a_hex_digit<br />; ---<br /><br />;routine 4 &#40;table and code provided by The Svin&#41;<br />; .data<br />; hexmask dd 0,1FF0000h,7Eh,7Eh,0,0,0,0<br />; .code<br />; bt  hexmask,edx<br />; jnc nothex<br />                               ;BT              U32 &#91;hexmask&#93;,ECX<br />                               ;JNC             .not_a_hex_digit<br /><br />; -----------------------------<br />; common code<br />                               RET<br />.not_a_hex_digit&#58;              RET<br /><br />; -----------------------------------------------------------------------------<br /><br />MAIN&#58;<br /><br />; perform all possible 256 cases and update a &quot;total cpu cycles&quot; counter.<br /><br />                XOR     ECX,ECX<br />                MOV     U32 &#91;total&#93;,ECX<br />.loop&#58;          PUSH    ECX<br />                PROFILE testme<br />                POP     ECX<br />                MOV     EAX,U32 &#91;PROFILE.CYCLES&#93;<br />                ADD     U32 &#91;total&#93;,EAX<br />                INC     ECX<br />                CMP     ECX,256     ; IMHO it should be 64, but no bother<br />                JNE     .loop<br />				<br />Now display  total/256  to get the average performance of the tested routine.<br /></code></pre><br /><br />Results (my machine is a Athlon-XP 1800+, DDR 292MHz):<br /><br />as a reference:<br />1 to 3 NOPs 1.00000000 cycles per call on average<br />4 NOP 2.00000000 cycles per call on average<br />etc..<br /><br />routine 1 (Jens) 7.00000000 cycles per call on average<br />routine 2 (bitRAKE) 4.25390625 cycles per call on average<br />routine 3 (Maverick) 2.21484375 cycles per call on average<br />routine 4 (The Svin) 15.74609375 cycles per call on average<br /><br />routine 4 assumes table is perfectly aligned and fully cached.. an unrealistic scenario.<br />I'm very disappointed by routine 4 though, I myself had foreseen it would have performed<br />decently++, given the ideal data cache scenario it was offered (intuitively I thought that<br />from 128 bit on, memory would be faster.. although I'd use for longer strings, due to<br />the fact that it's unrealistic to think that the table will be in the data cache all the<br />time, and loading memory can cost thousands cycles.. let away loading it from swap file.<br />Still carefully used, I strongly advocated in my previous post the use of BT ,reg).<br />I suspect that BT may stall the pipelines for some weird reason, since the execution<br />times are way too high. I will investigate more.<br /><br />Regards,<br />Maverick<br /><br /><span style="font-size:9px>(Edit bitRAKE: One long line was throwing the whole text off)</span></div>
    <div class="meta">Posted on 2002-03-27 17:15:34 by Maverick</div>
   </div>
   <div class="post" id="post-31264">
    <div class="subject"><a href="#post-31264">More about ranges</a></div>
    <div class="body"><div class="quote"><strong>Maverick</strong>, You contraddict yourself: in a previous post you said that my method scales well, 1 cycle per additional DWORD mask, but now you said the opposite. Ehm?</div>Solve this problem for me: How can both of my comments be correct? :)  I am not in the habit of contradicting myself.  You make broad assumptions of <strong>Svin</strong> and myself.  Not that I am not guilty of the same.  I would hope that we can learn to communicate well, for there is much that we should learn from each other. :)  There is nothing more important for me!<br /><br />I was very surprised of the BT mem,reg execution as well.  The manual states a latency of 8 cycles.  I can execute <u>nine</u> instructions before the BT without them having any additional cost, but <u>none after</u> without it costing more cycles!  BT mem,reg takes 5 cycles to complete. This is on a Athlon TB - I know you have an XP.  Of the 5 cycles, the first three can pair with other instructions, but the latter two execute alone.</div>
    <div class="meta">Posted on 2002-03-27 23:43:15 by bitRAKE</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=4419&amp;page=1" style="">&laquo;</a><a href="../?id=4419&amp;page=3" style="">&lt;</a><input type="hidden" name="id" value="4419" /><input type="number" name="page" min="1" max="5" step="1" value="4" onchange="this.form.submit();" /><a href="../?id=4419&amp;page=5">&gt;</a><a href="../?id=4419&amp;page=5">&raquo;</a></form>  </div>
 </body>
</html>