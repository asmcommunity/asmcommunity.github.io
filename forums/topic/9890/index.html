<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Win32(Win2K) thread issues(ESI register not preserved?) - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=9890" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=9890">Win32(Win2K) thread issues(ESI register not preserved?)</a></p>
   <div class="post" id="post-73740">
    <div class="subject"><a href="#post-73740">Win32(Win2K) thread issues(ESI register not preserved?)</a></div>
    <div class="body">Hi, I made my mixer into an infinitive looping Windows thread. But for some strange reason, the index register (ESI) that I use to reference variables gets changed to some weird value in Windows 2000 SP3. But in WIn98SE the thread always runs properly without any errors. So I checked to see if there was any mistakes I was making by altering the index register and I found none. Does anyone know a register (other than EDI, because I'm using that as an index into the sound buffer) that will be preserved? Or anything I can do to force it to preserve the registers?</div>
    <div class="meta">Posted on 2002-12-31 17:24:01 by x86asm</div>
   </div>
   <div class="post" id="post-73746">
    <div class="subject"><a href="#post-73746">Win32(Win2K) thread issues(ESI register not preserved?)</a></div>
    <div class="body">Don't expect any registers to be preserved in between threads.</div>
    <div class="meta">Posted on 2002-12-31 17:40:53 by comrade</div>
   </div>
   <div class="post" id="post-73747">
    <div class="subject"><a href="#post-73747">Win32(Win2K) thread issues(ESI register not preserved?)</a></div>
    <div class="body">IS there anyway I can do something similar but with the registers preserved?!?!</div>
    <div class="meta">Posted on 2002-12-31 17:41:42 by x86asm</div>
   </div>
   <div class="post" id="post-73792">
    <div class="subject"><a href="#post-73792">Win32(Win2K) thread issues(ESI register not preserved?)</a></div>
    <div class="body">Use <strong>GetThreadContext</strong> and <strong>SetThreadContext</strong> then.</div>
    <div class="meta">Posted on 2002-12-31 23:42:02 by comrade</div>
   </div>
   <div class="post" id="post-73905">
    <div class="subject"><a href="#post-73905">Win32(Win2K) thread issues(ESI register not preserved?)</a></div>
    <div class="body">But when Windows switches Thread context isnt it supposed to save the register state?! I know the THREAD_SET_CONTEXT flags would I set those? The only registers I thought were preserved are the ones that go inbetween Win32API function calls. I'm only counting on the state of two registers to be preserved (ESI and EDI), EDI seems to be saved, but I tried both ESI and ECX as index into data and they both dont work. I will try and use EBX, but please help me. <br /><br />I'm sorry Comrade but I'm really confused at the moment :confused: :confused:</div>
    <div class="meta">Posted on 2003-01-01 16:23:54 by x86asm</div>
   </div>
   <div class="post" id="post-73915">
    <div class="subject"><a href="#post-73915">Win32(Win2K) thread issues(ESI register not preserved?)</a></div>
    <div class="body">Never mind I fixed it</div>
    <div class="meta">Posted on 2003-01-01 17:37:17 by x86asm</div>
   </div>
   <div class="post" id="post-75474">
    <div class="subject"><a href="#post-75474">Could you tell me how you fixed it?</a></div>
    <div class="body">I got same problem in Windows 2000. It seems like the only registers I can retreave are the control registers even though I'm using CONTEXT_FULL</div>
    <div class="meta">Posted on 2003-01-10 11:40:47 by mrgone</div>
   </div>
   <div class="post" id="post-75499">
    <div class="subject"><a href="#post-75499">Win32(Win2K) thread issues(ESI register not preserved?)</a></div>
    <div class="body">hmm. Are you calling GetThreadContext from the target thread? The dox say not to, although I have working code that does this.</div>
    <div class="meta">Posted on 2003-01-10 13:43:28 by Jan Wassenberg</div>
   </div>
   <div class="post" id="post-81696">
    <div class="subject"><a href="#post-81696">Still can't get process thread context</a></div>
    <div class="body">When I have free time I play with it. Just in NT or Win2K the hThread handle dissapears. It first dissapears after EVENT_LOAD_DLL. I tried reloading the process information string with the previously saved values when CREAT_PROCESS first loaded them. Now when I go into SINGLE_STEP unstead of getting event code 80000004 I get 70. I see what's happening. I'm single stepping through a DLL. I wish I knew what 70 event code was. Hunche's Windows include file has several definitions. Two of them where ERROR_SHARING_PAUSED and  CONVERSATIONTOPIC.</div>
    <div class="meta">Posted on 2003-02-13 22:51:12 by mrgone</div>
   </div>
  </div>
 </body>
</html>