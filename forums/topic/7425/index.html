<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Convert RGB to HSL, and back. - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=7425" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=7425">Convert RGB to HSL, and back.</a></p>
   <div class="post" id="post-53978">
    <div class="subject"><a href="#post-53978">Convert RGB to HSL, and back.</a></div>
    <div class="body">Hi,  ;)<br /><br />I've been busy making my own color-choosing dialog to replace the standard Windows color dialog.  In the process of doing so, I wrote these two routines that do simple RGB-to-HSL and HSL-to-RGB conversion.  Since it doesn't use any floating point math, it's sure to be faster (maybe?) and smaller.  The disadvantage to this is slight inaccuracies.  Not very big though.  When I tested it against the standard floating point routine, (yes I tested it for every value, from 000000 to FFFFFF) the results were <em>at most</em> 1 value off - which, in the world of computer color, isn't a very noticeable difference.  ;)<br /><br />Comments are encouraged, and I would prefer suggestions to optimize size instead of speed.  Speed is unimportant here.<br /><br />Having said that, I hope this can be useful to somebody out there.  Enjoy. ;)<br /><br />-ib<br /><br /><br /><br /><pre><code>&#91;size=12&#93;<br />RGB2HSL proc uses esi edi ebx, dwRGB&#58;DWORD<br />  ;-- ------------------------------------------------------------;<br />  ; By Greg Hoyer aka &quot;Iblis&quot;                                    ;<br />  ;                                                              ;<br />  ; RGB2HSL converts a COLORREF  oriented dword filled with 8bit ;<br />  ; Red/Green/Blue  values  &#40;00ggbbrr&#41; to  a similarly  oriented ;<br />  ; dword filled with Hue/Saturation/Luminance values &#40;00llsshh&#41; ;<br />  ; This procedure  returns the  full range,  from 0-255.   This ;<br />  ; offers slightly more  precision over Windows' &quot;color picker&quot; ;<br />  ; common dialog, which displays HSL values ranging from 0-240. ;<br />  ;                                                              ;<br />  ; It is important to note  that true HSL  values are  normally ;<br />  ; represented as  floating point  fractions from  0.0 to  1.0. ;<br />  ; As such, this  algorithm cannot  be used to  do the precise, ;<br />  ; consistent conversions  that may  be required  by heavy-duty ;<br />  ; graphics  applications.  To  get the  decimal  fraction  for ;<br />  ; the  returned values,  convert  the Hue,  Saturation, and/or ;<br />  ; Luminance values to floating  point, and then divide by 255. ;<br />  ;--------------------------------------------------------------;<br />        movzx         esi, byte ptr &#91;dwRGB+2&#93;<br />        movzx         edi, byte ptr &#91;dwRGB+1&#93;<br />        movzx         ebx, byte ptr &#91;dwRGB+0&#93;<br />        mov           cl, -1<br />        cmp           esi, edi<br />        ja            @cmp1<br />        xchg          esi, edi<br />        neg           cl<br />        shl           cl, 1<br />@cmp1&#58;  cmp           edi, ebx<br />        jb            @cmp2<br />        xchg          edi, ebx<br />        neg           cl<br />@cmp2&#58;  cmp           esi, ebx<br />        ja            @cmp3<br />        xchg          esi, ebx<br />        not           cl<br />@cmp3&#58;  neg           ebx<br />        add           ebx, esi<br />        mov           eax, edi<br />        add           edi, esi<br />        jz            @done<br />        sub           esi, eax<br />        jz            @done<br />        mov           eax, esi<br />        shl           eax, 8<br />        sub           eax, esi<br />        push          edi<br />        cmp           edi, 0FFh<br />        jbe           @csat<br />        neg           edi<br />        add           edi, 510<br />@csat&#58;  xor           edx, edx<br />        div           edi<br />        pop           edi<br />        shr           edi, 1<br />        shl           eax, 8<br />        or            edi, eax<br />        add           cl, 3<br />        jnc           @noneg<br />        neg           ebx<br />@noneg&#58; shl           cl, 2<br />        mov           eax, 13135DB9h<br />        shr           eax, cl<br />        and           eax, 7<br />        mul           esi<br />        add           eax, ebx<br />        mov           ebx, eax<br />        shl           eax, 8<br />        sub           eax, ebx<br />        mov           ebx, esi<br />        shl           esi, 1<br />        lea           ebx, &#91;ebx*4+esi&#93;<br />        xor           edx, edx<br />        div           ebx<br />        shl           eax, 16<br />        or            eax, edi<br />@done&#58;  bswap         eax<br />        shr           eax, 8<br />        ret<br /><br />RGB2HSL endp<br /><br /><br /><br />HSL2RGB proc uses esi edi ebx, dwHSL&#58;DWORD<br />  ;--------------------------------------------------------------;<br />  ; By Greg Hoyer aka &quot;Iblis&quot;                                    ;<br />  ;                                                              ;<br />  ; HSL2RGB  does  the  opposite  of  RGB2HSL.   It  converts  a ;<br />  ; Hue/Saturation/Luminance  &#40;00llsshh&#41;  dword  back  into  its ;<br />  ; corresponding  RGB  COLORREF  &#40;00bbggrr&#41;.  This  function is ;<br />  ; intented  to be  used exclusively  with RGB2HSL  &#40;see above&#41; ;<br />  ;                                                              ;<br />  ; If  you're  using  this for  your own  custom  color-chooser ;<br />  ; dialog, remember that the  values are in the range of 0-255. ;<br />  ; If you MUST emulate the Windows'  color-chooser, convert HSL ;<br />  ; values this way before you display them&#58;                     ;<br />  ;                                                              ;<br />  ; display_value = &#40; x * 240 &#41; / 255                            ;<br />  ;                                                              ;<br />  ; ...where x represents any one of the HSL values.             ;<br />  ;--------------------------------------------------------------;<br /><br />        movzx         ebx, byte ptr &#91;dwHSL+2&#93;<br />        lea           esi, &#91;ebx*2&#93;<br />        movzx         edi, byte ptr &#91;dwHSL+1&#93;<br />        xor           eax, eax<br />        mov           cl, 1<br />        cmp           bl, 7Fh<br />        ja            @lcase<br />        dec           al<br />        xor           ecx, ecx<br />@lcase&#58; add           eax, edi<br />        mul           ebx<br />        or            ecx, ecx<br />        jz            @scase<br />        neg           eax<br />        add           eax, ebx<br />        add           eax, edi<br />@scase&#58; xor           edx, edx<br />        xor           ecx, ecx<br />        dec           cl<br />        mov           edi, ecx<br />        div           ecx<br />        jz            @done<br />        mov           ecx, eax<br />        sub           esi, eax<br />        movzx         eax, byte ptr &#91;dwHSL+0&#93;<br />        mov           ebx, eax<br />        shl           eax, 1<br />        lea           eax, &#91;ebx*4+eax&#93;<br />        xor           edx, edx<br />        div           edi<br />        mov           ebx, eax<br />        mov           eax, ecx<br />        sub           eax, esi<br />        mul           edx<br />        push          ebx<br />        mov           ebx, ecx<br />        shl           ebx, 8<br />        sub           ebx, ecx<br />        sub           ebx, eax<br />        xchg          eax, ebx<br />        xor           edx, edx<br />        div           edi<br />        shl           eax, 24<br />        or            ecx, eax<br />        mov           eax, esi<br />        shl           eax, 8<br />        sub           eax, esi<br />        shl           esi, 16<br />        or            ecx, esi<br />        add           eax, ebx<br />        xor           edx, edx<br />        div           edi<br />        mov           ch, al<br />        mov           eax, ecx<br />        pop           ecx<br />        cmp           cl, 6<br />        jz            @done<br />        or            ecx, ecx<br />        jz            @done<br />        bswap         eax<br />        rol           eax, 8<br />        xchg          ah, al<br />        dec           ecx<br />        jz            @done<br />        ror           eax, 8<br />        xchg          ah, al<br />        dec           ecx<br />        jz            @done<br />        rol           eax, 8<br />        xchg          ah, al<br />        dec           ecx<br />        jz            @done<br />        bswap         eax<br />        rol           eax, 8<br />        xchg          ah, al<br />        dec           ecx<br />        jz            @done<br />        ror           eax, 8<br />        xchg          ah, al<br />@done&#58;  and           eax, 0FFFFFFh<br />        ret<br /><br />HSL2RGB endp<br />&#91;/size&#93;</code></pre></div>
    <div class="meta">Posted on 2002-08-18 13:51:05 by iblis</div>
   </div>
   <div class="post" id="post-54020">
    <div class="subject"><a href="#post-54020">Convert RGB to HSL, and back.</a></div>
    <div class="body">Nice :alright:</div>
    <div class="meta">Posted on 2002-08-18 19:10:54 by comrade</div>
   </div>
   <div class="post" id="post-54160">
    <div class="subject"><a href="#post-54160">Convert RGB to HSL, and back.</a></div>
    <div class="body">Oops :(<br /><br />I relentlessly tested the first algo but it seems that I neglected the second one.   Please adjust the code between @scase and @lcase in HSL2RGB() to this:<br /><br /><pre><code>&#91;size=12&#93;<br />@lcase&#58;         add         eax, edi<br />                mul         ebx<br />                or          ecx, ecx<br />                jz          _scase<br />                neg         eax<br />                mov         ecx, ebx<br />                add         ecx, edi<br />                mov         edx, ecx<br />                shl         ecx, 8<br />                sub         ecx, edx<br />                add         eax, ecx<br />@scase&#58;         xor         edx, edx<br />&#91;/size&#93;</code></pre><br /><br />Sorry.  :/</div>
    <div class="meta">Posted on 2002-08-19 15:19:31 by iblis</div>
   </div>
   <div class="post" id="post-54165">
    <div class="subject"><a href="#post-54165">Convert RGB to HSL, and back.</a></div>
    <div class="body">Hi !<br /><br />Nice work !<br /><br />May I implement it into the next release of the <strong><em>X</em>-Filez</strong> ?<br /><br /><br />Greetings, Caleb</div>
    <div class="meta">Posted on 2002-08-19 17:09:49 by Caleb</div>
   </div>
   <div class="post" id="post-54202">
    <div class="subject"><a href="#post-54202">Convert RGB to HSL, and back.</a></div>
    <div class="body">Nice algo, I was going to implement one for my color picker but never got around to it. Also wanted to do CMYK. If you want to see what I've done previously, <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=4409&amp;highlight=choosecolor">Check out my post</a>. Maybe it can save you some time, or give you new ideas.</div>
    <div class="meta">Posted on 2002-08-19 23:08:32 by CsnWltr</div>
   </div>
   <div class="post" id="post-54226">
    <div class="subject"><a href="#post-54226">Convert RGB to HSL, and back.</a></div>
    <div class="body">Thanks all,<br /><br /><br /><br /><strong>Caleb</strong>,<br />I don't know what X-Filez is, but yes you may use it however you wish.  That's why I made this post, to share.<br /><br /><br /><strong>CsnWltr</strong>,<br /><br />I checked out your color picker and it's very nice! :alright:  I especially like how the gradient fills of the slider bars change with each value.  The color picker I'm currently making will be ultimately used for an art program (thus the need for HSL and CMYK)  I am going to need more functionality, but I thank you for your input and ideas.<br /><br /><br /><br /><div class="quote">Also wanted to do CMYK.</div><br /><br />I didn't post my CMYK routines because I didn't think anybody would care.  Maybe I am wrong.  Here they are.<br /><br /><br /><pre><code>&#91;size=12&#93;RGB2CMYK proc dwRGB&#58;DWORD<br />  ;--------------------------------------------------------------;<br />  ; By Greg Hoyer aka &quot;Iblis&quot;                                    ;<br />  ;                                                              ;<br />  ; RGB2CMYK converts  a COLORREF  oriented RGB value &#40;00bbggrr&#41; ;<br />  ; to  a  similarly  oriented  CMYK  value.  &#40;kkyymmcc&#41;         ;<br />  ; Black color adjustment is performed automatically.           ;<br />  ;--------------------------------------------------------------;<br /><br />       mov         ecx, dword ptr &#91;dwRGB+4&#93;<br />       not         ecx<br />       mov         edx, ecx<br />       bswap       ecx<br />       mov         cl, ch<br />       cmp         cl, dl<br />       jb          @cmp1<br />       mov         cl, dl<br />@cmp1&#58; cmp         cl, dh<br />       jb          @cmp2<br />       mov         cl, dh<br />@cmp2&#58; mov         eax, ecx<br />       or          al, al<br />       jz          @done<br />       mov         edx, 0x01010101<br />       movzx       eax, cl<br />       mul         edx<br />       xor         al, al<br />       xchg        eax, ecx<br />       sub         eax, ecx<br />@done&#58; bswap       eax<br />       ret<br /><br />RGB2CMYK endp<br /><br />; ################################################################<br /><br />CMYK2RGB proc dwCMYK&#58;DWORD<br />  ;--------------------------------------------------------------;<br />  ; By Greg Hoyer aka &quot;Iblis&quot;                                    ;<br />  ;                                                              ;<br />  ; CMYK2RGB converts a  reverse oriented CMYK  value &#40;kkyymmcc&#41; ;<br />  ; to  a  COLORREF  oriented  RGB  value.  &#40;00bbggrr&#41;           ;<br />  ;--------------------------------------------------------------;<br /><br />       mov         eax, dword ptr &#91;esp+4&#93;<br />       rol         eax, 16<br />       xor         ecx, ecx<br />       mov         ch, ah<br />       mov         edx, ecx<br />       mov         cl, 3<br />@jmp1&#58; mov         dl, -1<br />       add         al, ch<br />       jnc         @jmp2<br />       mov         dl, al<br />@jmp2&#58; dec         cl<br />       jz          @done<br />       rol         eax, 8<br />       shl         edx, 8<br />       jmp         @jmp1<br />@done&#58; xor         eax, edx<br />       ret<br /><br />CMYK2RGB endp&#91;/size&#93;</code></pre></div>
    <div class="meta">Posted on 2002-08-20 04:15:03 by iblis</div>
   </div>
   <div class="post" id="post-54278">
    <div class="subject"><a href="#post-54278">Convert RGB to HSL, and back.</a></div>
    <div class="body">Thanks ! It could be useful for the <em>D3DColor</em> include.<br /><br />The name <strong><em>X</em>-Filez</strong> is the (new) working title of the direct-x-includes. This sounds better ;)<br /><br />I want to free it from the <em>oaidl.inc</em> include because this one isn't freeware ( :mad: ) <br /><br />Greetings, Caleb</div>
    <div class="meta">Posted on 2002-08-20 14:09:00 by Caleb</div>
   </div>
   <div class="post" id="post-87434">
    <div class="subject"><a href="#post-87434">Convert RGB to HSL, and back.</a></div>
    <div class="body"><div class="quote"> jz          _scase</div> <br />Typo? Must have been:<br />jz @scase</div>
    <div class="meta">Posted on 2003-03-16 14:21:31 by The Svin</div>
   </div>
   <div class="post" id="post-88015">
    <div class="subject"><a href="#post-88015">Convert RGB to HSL, and back.</a></div>
    <div class="body">Yes, typo.  But I couldn't edited it.</div>
    <div class="meta">Posted on 2003-03-18 21:06:08 by iblis</div>
   </div>
   <div class="post" id="post-88092">
    <div class="subject"><a href="#post-88092">Convert RGB to HSL, and back.</a></div>
    <div class="body">Please post updated/corrected code.<br /><br />Thanks,  P1</div>
    <div class="meta">Posted on 2003-03-19 09:25:05 by Pone</div>
   </div>
   <div class="post" id="post-88112">
    <div class="subject"><a href="#post-88112">Convert RGB to HSL, and back.</a></div>
    <div class="body">Iblis<br /><br />For my curiosity, could you direct me to where I could find the information (formulas) indicating how to convert from RGB to HSL and vice-versa.<br /><br />Raymond</div>
    <div class="meta">Posted on 2003-03-19 10:29:04 by Raymond</div>
   </div>
   <div class="post" id="post-88185">
    <div class="subject"><a href="#post-88185">Convert RGB to HSL, and back.</a></div>
    <div class="body">bitRake gave a very good link in &quot;Light and Shadow&quot; thread Main forum.<br />iblis, you could ask Hiroshimator to edit it.</div>
    <div class="meta">Posted on 2003-03-19 15:03:54 by The Svin</div>
   </div>
   <div class="post" id="post-88192">
    <div class="subject"><a href="#post-88192">Convert RGB to HSL, and back.</a></div>
    <div class="body">Here's the full working source for all four procs,<br /><br />Attachment:</div>
    <div class="meta">Posted on 2003-03-19 15:41:25 by iblis</div>
   </div>
  </div>
 </body>
</html>