<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>I'm trying to make a Global Hotkey-I'm doing things wrong! - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=19625" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=19625">I'm trying to make a Global Hotkey-I'm doing things wrong!</a></p>
   <div class="post" id="post-151060">
    <div class="subject"><a href="#post-151060">I'm trying to make a Global Hotkey-I'm doing things wrong!</a></div>
    <div class="body">Hi all ;)<br /><br />This is my first post here :) and I am glad to be here.<br /><br />I'm trying to make a code for a Global Hotkey using masm , can you please take a look and tell me what is wrong with the code ?<br /><br /><pre><code>.386<br />.model flat,stdcall<br />.data<br />Iczelion23421433 db 0<br />.code<br />IczelionStart&#58;<br />include c&#58;\masm32\include\windows.inc<br />include c&#58;\masm32\include\user32.inc<br />include c&#58;\masm32\include\kernel32.inc<br />includelib c&#58;\masm32\lib\user32.lib<br />includelib c&#58;\masm32\lib\kernel32.lib<br /><br /><br /><br />.data?<br />hInstance HINSTANCE ?<br />waHwnd dd ?<br />hWnd dd ?<br />msg MSG &lt;?&gt;<br /><br /><br />.data<br />wc WNDCLASSEX &lt;size WNDCLASSEX, 0, WndProc, 0, 0, hInstance, 0, 0, COLOR_WINDOW, 0, windowClass, 0&gt;<br /><br />windowClass db &quot;Hotkey&quot;,0<br />waClass db &quot;Winamp v1.x&quot;,0<br /><br />hmsg db &quot;HotKey CTRL + ALT + A Works good!&quot;,0<br />hcap db &quot;Hotkey Example&quot;,0<br /><br /><br /><br />.code<br />start&#58;<br /><br />   invoke GetModuleHandle, NULL<br />   mov    hInstance,eax<br /><br />call	WinMain<br /><br />push	0<br />call	ExitProcess<br /><br /><br />WinMain proc<br /><br />push	offset wc<br />call	RegisterClassExA<br /><br />push	0<br />push	offset hInstance<br />push	0<br />push	0<br />push	0<br />push	0<br />push	0<br />push	0<br />push	0<br />push	0<br />push	offset windowClass<br />push	0<br />call	CreateWindowExA<br /><br />mov hWnd, eax<br /><br />msg_loop&#58;<br /><br />push	0<br />push	0<br />push	0<br />push	offset msg<br />call	GetMessageA<br /><br />or	eax,eax<br />jz	end_loop<br /><br />push	offset msg<br />call	DispatchMessageA<br />jmp	msg_loop<br /><br />end_loop&#58;<br /><br />WinMain endp<br /><br /><br /><br />WndProc proc hWin&#58;DWORD,uMsg&#58;DWORD,wParam &#58;DWORD,lParam &#58;DWORD<br /><br />  .if uMsg == WM_CREATE<br />    invoke RegisterHotKey,hWnd,065h,MOD_CONTROL or MOD_ALT, 041h<br /><br />.elseif uMsg == WM_HOTKEY<br />    invoke MessageBox,hWin,addr hmsg,addr hcap, MB_OK or MB_ICONINFORMATION<br /><br />.elseif uMsg == WM_DESTROY<br />    invoke UnregisterHotKey,hWin,065h<br />    invoke PostQuitMessage,NULL<br />    ret 0 <br />.endif  <br /><br />WndProc endp<br />end start <br />db 'IczelionMarker'<br />end IczelionStart</code></pre><br /><br />Thanks a lot for taking a look ... now answer me :D<br />I want the hotkey to be F7 ... i will look it out later.<br /><br />HACKERGY.</div>
    <div class="meta">Posted on 2004-10-07 07:12:29 by HACKERGY</div>
   </div>
   <div class="post" id="post-151074">
    <div class="subject"><a href="#post-151074">register hotkey</a></div>
    <div class="body">hi hackergy<br />i dont know wat u are trying to do coz u want the hotkey to be f7 and u are registering one for ctrl+alt+a.<br />anyway, i have fixed it, i guess.<br />instead of ur this code<br /><pre><code><br />.elseif uMsg == WM_HOTKEY <br />    invoke MessageBox,hWin,addr hmsg,addr hcap, MB_OK or MB_ICONINFORMATION <br /></code></pre><br />use this code. it will work.<br /><pre><code><br />   .ELSEIF uMsg == WM_HOTKEY<br />              mov eax,wParam<br />              .if eax==065h <br />               invoke MessageBox,hWin,addr hmsg,addr hcap, MB_OK<br />               .endif<br /></code></pre></div>
    <div class="meta">Posted on 2004-10-07 14:03:14 by nickdigital</div>
   </div>
   <div class="post" id="post-151108">
    <div class="subject"><a href="#post-151108">I'm trying to make a Global Hotkey-I'm doing things wrong!</a></div>
    <div class="body">Thank you very much man.<br /><br />What does mov eax,wParam means  :oops: ?<br /><br /><br />I'm trying to add this code to another EXE .... you know like code injection .... and I think there something wrong because it is not working :( <br /><br />You know Snippet Creator ? ... i'm trying to add my code using it .... but when I click on &quot;Patch Target&quot; ... Snippet Creator crashes !!! Why is that ?</div>
    <div class="meta">Posted on 2004-10-08 06:04:56 by HACKERGY</div>
   </div>
   <div class="post" id="post-151112">
    <div class="subject"><a href="#post-151112">I'm trying to make a Global Hotkey-I'm doing things wrong!</a></div>
    <div class="body">hi hackergy<br />i can only tell why snippet creator crashes when u show me ur code or else its dificult to get to know actually wat u want to do.<br />be specific and may be i ll help u if nothing fishy is goin in ur mind<br /><br />anyway i feel u can create ur own loader instead of using snippet creator.<br />it would be completely under ur control.<br /><br />nickdigital</div>
    <div class="meta">Posted on 2004-10-08 10:02:47 by nickdigital</div>
   </div>
   <div class="post" id="post-151113">
    <div class="subject"><a href="#post-151113">I'm trying to make a Global Hotkey-I'm doing things wrong!</a></div>
    <div class="body">Thanks a lot man.<br /><br />But I don't know how to make Loader !</div>
    <div class="meta">Posted on 2004-10-08 11:43:55 by HACKERGY</div>
   </div>
   <div class="post" id="post-151114">
    <div class="subject"><a href="#post-151114">I'm trying to make a Global Hotkey-I'm doing things wrong!</a></div>
    <div class="body">hi hackergy<br />if u wanna chat with me then u can do it in yahoo messenger.<br />my id is mastercode_digger <br />most of the time u can find me in programming rooms</div>
    <div class="meta">Posted on 2004-10-08 13:07:53 by nickdigital</div>
   </div>
   <div class="post" id="post-151115">
    <div class="subject"><a href="#post-151115">I'm trying to make a Global Hotkey-I'm doing things wrong!</a></div>
    <div class="body">Thanks man I apreciate it :)<br /><br />After the correction u made to my code ..... I assemble the code with no errors .... but when I try to run it it just crashes up ! ... what is the reason ?</div>
    <div class="meta">Posted on 2004-10-08 13:12:48 by HACKERGY</div>
   </div>
   <div class="post" id="post-151116">
    <div class="subject"><a href="#post-151116">I'm trying to make a Global Hotkey-I'm doing things wrong!</a></div>
    <div class="body">:)<br />Maybe you could use this instead of code injection (easier, less &quot;hacky&quot;):<br />http://www.asmcommunity.net/board/viewtopic.php?t=14463</div>
    <div class="meta">Posted on 2004-10-08 13:19:44 by QvasiModo</div>
   </div>
   <div class="post" id="post-151117">
    <div class="subject"><a href="#post-151117">I'm trying to make a Global Hotkey-I'm doing things wrong!</a></div>
    <div class="body">hi hackergy<br />i guess u are new to masm...<br />anyway ur code is full of errors like<br />u have defined .data and .code 2 times.<br />correct it first and then next time post ur <br />code<br />nickdigital</div>
    <div class="meta">Posted on 2004-10-08 13:22:33 by nickdigital</div>
   </div>
   <div class="post" id="post-151119">
    <div class="subject"><a href="#post-151119">I'm trying to make a Global Hotkey-I'm doing things wrong!</a></div>
    <div class="body">Hi guys ;)<br /><br />Thanks for you.<br /><br />Now this is the code corrected from errors as I think :<br /><pre><code>.386<br />.model flat,stdcall<br />.data<br />Iczelion23421433 db 0<br />.code<br />IczelionStart&#58;<br />include c&#58;\masm32\include\windows.inc<br />include c&#58;\masm32\include\user32.inc<br />include c&#58;\masm32\include\kernel32.inc<br />includelib c&#58;\masm32\lib\user32.lib<br />includelib c&#58;\masm32\lib\kernel32.lib<br /><br />jmp @F<br /><br />hInstance HINSTANCE ?<br />waHwnd dd ?<br />hWnd dd ?<br />msg MSG &lt;?&gt;<br />wc WNDCLASSEX &lt;size WNDCLASSEX, 0, WndProc, 0, 0, hInstance, 0, 0, COLOR_WINDOW, 0, windowClass, 0&gt;<br />windowClass db &quot;Hotkey&quot;,0<br />waClass db &quot;Winamp v1.x&quot;,0<br />hmsg db &quot;HotKey CTRL + ALT + A Works good!&quot;,0<br />hcap db &quot;Hotkey Example&quot;,0<br /><br />@@&#58;<br />   invoke GetModuleHandleA, NULL<br />   mov    hInstance,eax<br /><br />call	WinMain<br /><br />push	0<br />call	ExitProcess<br /><br /><br />WinMain proc<br /><br />push	offset wc<br />call	RegisterClassExA<br /><br />push	0<br />push	offset hInstance<br />push	0<br />push	0<br />push	0<br />push	0<br />push	0<br />push	0<br />push	0<br />push	0<br />push	offset windowClass<br />push	0<br />call	CreateWindowExA<br /><br />mov hWnd, eax<br /><br />msg_loop&#58;<br /><br />push	0<br />push	0<br />push	0<br />push	offset msg<br />call	GetMessageA<br /><br />or	eax,eax<br />jz	end_loop<br /><br />push	offset msg<br />call	DispatchMessageA<br />jmp	msg_loop<br /><br />end_loop&#58;<br /><br />WinMain endp<br /><br /><br /><br />WndProc proc hWin&#58;DWORD,uMsg&#58;DWORD,wParam &#58;DWORD,lParam &#58;DWORD<br /><br />  .if uMsg == WM_CREATE<br />    invoke RegisterHotKey,hWnd,065h,MOD_CONTROL or MOD_ALT, 041h<br /><br />   .ELSEIF uMsg == WM_HOTKEY<br />              mov eax,wParam<br />              .if eax==065h<br />               invoke MessageBoxA,hWin,addr hmsg,addr hcap, MB_OK<br />               .endif<br /><br />.elseif uMsg == WM_DESTROY<br />    invoke UnregisterHotKey,hWin,065h<br />    invoke PostQuitMessage,NULL<br />    ret 0 <br />.endif  <br /><br />WndProc endp<br /><br />db 'IczelionMarker'<br />end IczelionStart</code></pre><br /><br />Now what I am doing is using Snippet Creator is patching the target file with this code with the option of making a new section and &quot;Redirected EntryPoint RVA&quot; so as I think my code will be executed as soon as the program is loaded. The file is patched succesfully but when I run the EXE file the program crashes :( why is that ? Am I patching my code in the wrong place ?<br /><br />What I want is just the program to work and when I click on my Hotkey the message comes out.<br /><br /><br />Thanks.</div>
    <div class="meta">Posted on 2004-10-08 14:35:19 by HACKERGY</div>
   </div>
   <div class="post" id="post-151120">
    <div class="subject"><a href="#post-151120">I'm trying to make a Global Hotkey-I'm doing things wrong!</a></div>
    <div class="body">hi hackergy<br />i feel ur program still has a lot of bugs.<br />i am just giving you a small example of how a <br />hotkey is created.i guess it will help u .<br /><br />compile it, execute it and press ctrl+alt+a to activate the hotkey.<br /><pre><code><br />.386<br />.model flat,stdcall<br />option casemap&#58;none<br />WinMain proto &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br /><br />.data<br /><br />ClassName db &quot;DLGCLASS&quot;,0<br />DlgName db &quot;MyDialog&quot;,0<br />AppName db &quot;Hotkey example by Nickdigital&quot;,0<br />loaded db &quot;You pressed the hotkey Ctrl+Alt+A&quot;,0<br />Voila db &quot;Voila&quot;,0<br /><br />.data?<br />hInstance HINSTANCE ?<br />CommandLine LPSTR ?<br /><br />.code<br />start&#58;<br />	invoke GetModuleHandle, NULL<br />	mov    hInstance,eax                     <br />	invoke GetCommandLine<br />	mov CommandLine,eax<br />   	invoke WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT<br />     	invoke ExitProcess,eax<br />WinMain proc hInst&#58;HINSTANCE,hPrevInst&#58;HINSTANCE,CmdLine&#58;LPSTR,CmdShow&#58;DWORD<br />	LOCAL wc&#58;WNDCLASSEX<br />	LOCAL msg&#58;MSG<br />	LOCAL hWnd&#58;HWND<br />	mov   wc.cbSize,SIZEOF WNDCLASSEX<br />	mov   wc.style, CS_HREDRAW or CS_VREDRAW<br />	mov   wc.lpfnWndProc, OFFSET WndProc<br />	mov   wc.cbClsExtra,NULL<br />	mov   wc.cbWndExtra,NULL<br />	push  hInst<br />	pop   wc.hInstance<br />	mov   wc.hbrBackground,COLOR_WINDOW+1<br />	mov   wc.lpszMenuName,NULL<br />	mov   wc.lpszClassName,OFFSET ClassName<br />	invoke LoadIcon,NULL,IDI_APPLICATION<br />	mov   wc.hIcon,eax<br />	mov   wc.hIconSm,0<br />	invoke LoadCursor,NULL,IDC_ARROW<br />	mov   wc.hCursor,eax<br />	invoke RegisterClassEx, addr wc<br />	INVOKE CreateWindowEx,NULL,ADDR ClassName,ADDR AppName,\<br />           WS_OVERLAPPEDWINDOW,CW_USEDEFAULT,\<br />           CW_USEDEFAULT,CW_USEDEFAULT,CW_USEDEFAULT,NULL,NULL,\<br />           hInst,NULL<br />	mov   hWnd,eax<br />	INVOKE ShowWindow, hWnd,SW_SHOWNORMAL<br />	INVOKE UpdateWindow, hWnd<br /><br />	.WHILE TRUE<br />                INVOKE GetMessage, ADDR msg,NULL,0,0<br />                .BREAK .IF &#40;!eax&#41;<br />                invoke IsDialogMessage, hWnd, ADDR msg<br />                .if eax==FALSE<br />                        INVOKE TranslateMessage, ADDR msg<br />                        INVOKE DispatchMessage, ADDR msg<br />                .endif<br />	.ENDW<br />	mov     eax,msg.wParam<br />	ret<br />WinMain endp<br />WndProc proc hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br />         <br />    	.if uMsg==WM_CREATE<br />            invoke RegisterHotKey,hWnd,065h,MOD_CONTROL or MOD_ALT, 041h ; CTRL + ALT + A<br />      .ELSEIF uMsg==WM_DESTROY<br />            invoke UnregisterHotKey,hWnd,065h<br />		invoke PostQuitMessage,NULL<br />      .ELSEIF uMsg == WM_HOTKEY<br />              mov eax,wParam<br />              .if eax==065h <br />      	   	invoke MessageBox,NULL, ADDR loaded,ADDR Voila,  MB_ICONEXCLAMATION<br /><br />      .endif<br /><br />	.ELSE<br />		invoke DefWindowProc,hWnd,uMsg,wParam,lParam<br />		ret<br />	.ENDIF<br />	xor    eax,eax<br />	ret<br />WndProc endp<br />end start<br /><br /></code></pre></div>
    <div class="meta">Posted on 2004-10-08 15:45:45 by nickdigital</div>
   </div>
   <div class="post" id="post-151132">
    <div class="subject"><a href="#post-151132">I'm trying to make a Global Hotkey-I'm doing things wrong!</a></div>
    <div class="body">Afternoon, HACKERGY.<br /><br />Talking about Hot Keys is fine, however please refrain from talking about code injection.<br /><br />Cheers,<br />Scronty</div>
    <div class="meta">Posted on 2004-10-09 06:28:09 by Scronty</div>
   </div>
  </div>
 </body>
</html>