<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Useful little edit subclass - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=24555" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=24555">Useful little edit subclass</a></p>
   <div class="post" id="post-179321">
    <div class="subject"><a href="#post-179321">Useful little edit subclass</a></div>
    <div class="body">If you are using an edit control just to display text but can&#39;t use a static because the text may be too long for it all to display this subclassing procedure will allow copy and paste as well as scrolling. It also displays a tooltip with the complete text.<br /><br /><pre><code>SubClassEdit FRAME hwnd,uMsg,wParam,lParam<br />	uses ebx<br />	LOCAL hMenu	:D<br />	LOCAL pt	:POINT<br />	LOCAL ti	:TOOLINFO<br /><br />	cmp D,WM_SETTEXT<br />	jne &gt;<br />		// Add this control to the tooltip<br />		mov D,SIZEOF TOOLINFO<br />		mov D,TTF_IDISHWND + TTF_SUBCLASS<br />		mov eax,<br />		mov ,eax<br />		mov ,eax<br />		mov eax,<br />		mov ,eax<br />		mov D,LPSTR_TEXTCALLBACK<br />		// Remove the control if it is already added<br />		invoke SendMessage,,TTM_DELTOOL,0,ADDR ti<br />		invoke SendMessage,,TTM_ADDTOOL,0,ADDR ti<br />		jmp &gt;&gt;.DEFPROC<br />	:<br /><br />	cmp D,WM_DESTROY<br />	jne &gt;<br />		// Remove this control to the tooltip<br />		mov D,SIZEOF TOOLINFO<br />		mov eax,<br />		mov ,eax<br />		mov ,eax<br />		mov D,LPSTR_TEXTCALLBACK<br />		invoke SendMessage,,TTM_DELTOOL,0,ADDR ti<br />		jmp &gt;&gt;.DEFPROC<br />	:<br /><br />	cmp D,WM_NOTIFY<br />	jne &gt;<br />		mov ebx,<br />		cmp D,TTN_GETDISPINFO<br />		jne &gt;&gt;.DEFPROC<br />		invoke SendMessage,,WM_GETTEXT,MAX_PATH,offset szBuffer<br />		mov D, offset szBuffer<br />		ret<br /><br />	:<br />	cmp D,WM_PASTE<br />	jne &gt;<br />		// Pasting text is not allowed<br />		xor eax,eax<br />		ret<br />	:<br />	cmp D,WM_CHAR<br />	jne &gt;<br />		// Typing is not allowed<br />		xor eax,eax<br />		ret<br />	:<br />	cmp D,WM_CUT<br />	jne &gt;<br />		// Cutting text is not allowed<br />		xor eax,eax<br />		ret<br />	:<br />	cmp D,WM_CONTEXTMENU<br />	jne &gt;&gt;.DEFPROC<br />		// Do not allow anything but &quot;Select All&quot; and &quot;Copy&quot; to appear on edit context menu<br />		// For the start up folder allow also &quot;Open this folder&quot;<br />		mov eax,<br />		movzx edx,ax<br />		mov ,edx<br />		shr eax,16<br />		movzx edx,ax<br />		mov ,edx<br />		invoke CreatePopupMenu<br />		mov ,eax<br />		invoke AppendMenu,,MF_STRING + MF_ENABLED,100,&quot;Copy&quot;<br />		invoke AppendMenu,,MF_SEPARATOR,0,0<br />		invoke AppendMenu,,MF_STRING + MF_ENABLED,101,&quot;Select all&quot;<br />		invoke TrackPopupMenu,,TPM_LEFTALIGN + TPM_RETURNCMD, \<br />			,,NULL,,NULL<br />		mov ebx,eax<br /><br />		cmp ebx,100<br />		jne &gt;.SELALL<br />			invoke PostMessage,,WM_COPY,0,0<br />			jmp &gt;&gt;.MENUEND<br /><br />		.SELALL<br />		cmp ebx,101<br />		jne &gt;.MENUEND<br />			invoke PostMessage,,EM_SETSEL,0,-1<br /><br />		.MENUEND<br />		invoke DestroyMenu,<br />		xor eax,eax<br />		ret<br /><br />	.DEFPROC<br />	invoke CallWindowProc,,,,,<br />	RET<br />ENDF</code></pre><br /><br />To create the tool tip use the following at the start of your program...<br /><br /><pre><code>invoke InitCommonControls<br />invoke CreateWindowEx,0,&quot;tooltips_class32&quot;,&quot;tooltips_class32&quot;,TTS_ALWAYSTIP, \<br />	0,0,0,0,0,0,,0<br />mov ,eax<br />invoke SendMessage,,TTM_ACTIVATE,TRUE,0</code></pre><br /><br />Be sure to clean up when done by destroying the tooltip control<br /><br /><pre><code>invoke DestroyWindow,</code></pre><br /><br />Now, to subclass your edit control just add the following to your code, this can be used for multiple edit controls on the same dialog or window...<br /><br /><pre><code>invoke SetWindowLong,,GWL_WNDPROC,OFFSET SubClassEdit<br />mov ,eax</code></pre></div>
    <div class="meta">Posted on 2006-04-08 19:54:03 by donkey</div>
   </div>
  </div>
 </body>
</html>