<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>yet another switch/case macros - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14603" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=14603">yet another switch/case macros</a></p>
   <div class="post" id="post-112997">
    <div class="subject"><a href="#post-112997">yet another switch/case macros</a></div>
    <div class="body">Just when you thought everyone was tired of this... yes! Another lamer posts yet another example of switch macros! :grin:<br />I know, it's been done a thousand times already... but I felt tempted... :rolleyes:<br /><br />MikaelC has done <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=12637">something very similar</a>, also tried to use the .if/.elseif/.endif macros for this. This macros, however, do not assemble any extra code. And you can use the .break built-in macro.<br /><br />If you find this useful, you found a bug, you think my macros suck, anything, please let me know. I love to have feedback. :)<br /><br /><pre><code>;this macros are for switch/case support &#40;similar to C&#41;<br /><br />; mov eax,uMsg<br />; .switch eax<br />; .case WM_COMMAND<br />;   &#40;...&#41;<br />;   .break<br />; .case WM_NOTIFY<br />;   &#40;...&#41;<br />;   .break<br />; .default<br />;   &#40;...&#41;<br />; .endswitch<br /><br />; .switch &#123;register or variable&#125;<br />.switch macro regname&#58;req<br />    ifndef SwitchNesting<br />        SwitchNesting = 1<br />    else<br />        SwitchNesting = SwitchNesting + 1<br />    endif<br />    @CatStr &#40; &lt;SwitchRegister_&gt;, %SwitchNesting &#41; textequ &lt;&amp;regname&amp;&gt;<br />    @CatStr &#40; &lt;SwitchFirstCase_&gt;, %SwitchNesting &#41; = 1<br />    @CatStr &#40; &lt;SwitchLastCase_&gt;, %SwitchNesting &#41; = 0<br />    @CatStr &#40; &lt;SwitchNeedDefault_&gt;, %SwitchNesting &#41; = 0<br />    .repeat<br />endm<br /><br />; .case &#123;value 1&#125;, &#91;value 2&#93;, &#40;...&#41;, &#91;value n&#93;<br />.case macro var&#58;vararg<br />    local value,isfirst,cond<br /><br />    ifndef SwitchNesting<br />        .err &lt;.case cannot be outside of a .switch/.endswitch block.&gt;<br />        exitm<br />    endif<br />    if SwitchNesting lt 1<br />        .err &lt;Bad .switch/.endswitch block.&gt;<br />        exitm<br />    endif<br />    ife @CatStr &#40; &lt;SwitchLastCase_&gt;, %SwitchNesting &#41;<br />        ife @CatStr &#40; &lt;SwitchFirstCase_&gt;, %SwitchNesting &#41;<br />            .endif<br />        else<br />            @CatStr &#40; &lt;SwitchFirstCase_&gt;, %SwitchNesting &#41; = 0<br />        endif<br />        isfirst = 1<br />        for value, &lt;var&gt;<br />            if isfirst ne 0<br />                cond catstr &lt;&#40; SwitchRegister_&gt;, %SwitchNesting, &lt; == &amp;value&amp; &#41;&gt;<br />                isfirst = 0<br />            else<br />                cond textequ @CatStr &#40; %cond, &lt; || &#40; SwitchRegister_&gt;, %SwitchNesting, &lt; == &gt;, &lt;&amp;value&amp;&gt;, &lt; &#41;&gt; &#41;<br />            endif<br />        endm<br />        if isfirst eq 0<br />            .if cond<br />        endif<br />    else<br />        .err &lt;.case cannot follow .default.&gt;<br />    endif<br />endm<br /><br />; .between &#123;min 1&#125;, &#123;max 1&#125;, &#91;min 2&#93;, &#91;max 2&#93;, &#40;...&#41;, &#91;min n&#93;, &#91;max n&#93;<br />; values must always be given in pairs<br />.between macro var&#58;vararg<br />    local value,isfirst,iseven,cond,cond2<br /><br />    ifndef SwitchNesting<br />        .err &lt;.between cannot be outside of a .switch/.endswitch block.&gt;<br />        exitm<br />    endif<br />    if SwitchNesting lt 1<br />        .err &lt;Bad .switch/.endswitch block.&gt;<br />        exitm<br />    endif<br />    ife @CatStr &#40; &lt;SwitchLastCase_&gt;, %SwitchNesting &#41;<br />        ife @CatStr &#40; &lt;SwitchFirstCase_&gt;, %SwitchNesting &#41;<br />            .endif<br />        else<br />            @CatStr &#40; &lt;SwitchFirstCase_&gt;, %SwitchNesting &#41; = 0<br />        endif<br />        isfirst = 1<br />        iseven = 1<br />        for value, &lt;var&gt;<br />            if isfirst ne 0<br />                ;&#40; &#40; reg &gt;= value &#41;<br />                cond catstr &lt;&#40; &#40; SwitchRegister_&gt;, %SwitchNesting, &lt; !&gt;= &amp;value&amp; &#41;&gt;<br />                isfirst = 0<br />            else<br />                if iseven eq 1<br />                    ; || &#40; &#40; reg &gt;= value &#41;<br />                    cond2 catstr &lt;cond&gt;, &lt; || &#40; &#40; SwitchRegister_&gt;, %SwitchNesting, &lt; !&gt;= &amp;value&amp; &#41;&gt;<br />                    cond textequ cond2<br />                else<br />                    ; &amp;&amp; &#40; reg &lt;= value &#41; &#41;<br />                    cond2 catstr &lt;cond&gt;, &lt; &amp;&amp; &#40; SwitchRegister_&gt;, %SwitchNesting, &lt; !&lt;= &amp;value&amp; &#41; &#41;&gt;<br />                    cond textequ cond2<br />                endif<br />            endif<br />            iseven = -iseven<br />        endm<br />        if isfirst eq 0<br />            .if cond<br />        endif<br />    else<br />        .err &lt;.between cannot follow .default.&gt;<br />    endif<br />endm<br /><br />; .caseif &#123;condition&#125;<br />; The condition must be a text literal to be passed to the .if macro.<br />; Remember to escape angle brackets with an exclamation point.<br />.caseif macro cond&#58;req<br />    ifndef SwitchNesting<br />        .err &lt;.caseif cannot be outside of a .switch/.endswitch block.&gt;<br />        exitm<br />    endif<br />    if SwitchNesting lt 1<br />        .err &lt;Bad .switch/.endswitch block.&gt;<br />        exitm<br />    endif<br />    ife @CatStr &#40; &lt;SwitchLastCase_&gt;, %SwitchNesting &#41;<br />        ife @CatStr &#40; &lt;SwitchFirstCase_&gt;, %SwitchNesting &#41;<br />            .endif<br />        else<br />            @CatStr &#40; &lt;SwitchFirstCase_&gt;, %SwitchNesting &#41; = 0<br />        endif<br />        .if cond<br />    else<br />        .err &lt;.caseif cannot follow .default.&gt;<br />    endif<br />endm<br /><br />.default macro<br />    ifndef SwitchNesting<br />        .err &lt;.default cannot be outside of a .switch/.endswitch block.&gt;<br />        exitm<br />    endif<br />    if SwitchNesting lt 1<br />        .err &lt;Bad .switch/.endswitch block.&gt;<br />        exitm<br />    endif<br />    ifndef SwitchCount<br />        SwitchCount = 0<br />    endif<br />    ife @CatStr &#40; &lt;SwitchLastCase_&gt;, %SwitchNesting &#41;<br />        ife @CatStr &#40; &lt;SwitchFirstCase_&gt;, %SwitchNesting &#41;<br />            .endif<br />        else<br />            .err &lt;There should be at least one .case before .default.&gt;<br />        endif<br />        @CatStr &#40; &lt;SwitchLastCase_&gt;, %SwitchNesting &#41; = 1<br />    else<br />        .err &lt;There cannot be more that one .default in a .switch/.endswitch block.&gt;<br />    endif<br />    @CatStr &#40; &lt;SwitchNeedDefault_&gt;, %SwitchNesting &#41; = 0<br />    @CatStr &#40; &lt;SwitchLastCase_&gt;, %SwitchNesting &#41; = 1<br />    @CatStr &#40; &lt;SwitchDefault_&gt;, %SwitchCount, &lt;&#58;&gt; &#41;<br />    SwitchCount = SwitchCount + 1<br />endm<br /><br />.breakdef macro<br />    ifndef SwitchNesting<br />        .err &lt;.breakdef cannot be outside of a .switch/.endswitch block.&gt;<br />        exitm<br />    endif<br />    if SwitchNesting lt 1<br />        .err &lt;Bad .switch/.endswitch block.&gt;<br />        exitm<br />    endif<br />    ifndef SwitchCount<br />        SwitchCount = 0<br />    endif<br />    @CatStr &#40; &lt;SwitchNeedDefault_&gt;, %SwitchNesting &#41; = 1<br />    jmp @CatStr &#40; &lt;SwitchDefault_&gt;, %SwitchCount &#41;<br />endm<br /><br />.endswitch macro<br />    if SwitchNesting lt 1<br />        .err &lt;Bad .switch/.endswitch block.&gt;<br />        exitm<br />    endif<br />    ife @CatStr &#40; &lt;SwitchFirstCase_&gt;, %SwitchNesting &#41;<br />        ife @CatStr &#40; &lt;SwitchLastCase_&gt;, %SwitchNesting &#41;<br />            .endif<br />        endif<br />    else<br />        .err &lt;Empty .switch/.endswitch block?&gt;<br />    endif<br />    if @CatStr &#40; &lt;SwitchNeedDefault_&gt;, %SwitchNesting &#41; ne 0<br />        .err &lt;Unmatched .breakdef, could branch to unexpected location!&gt;<br />    endif<br />    .until TRUE<br />    SwitchNesting = SwitchNesting - 1<br />    if SwitchNesting lt 0<br />        .err &lt;Bad .switch/.endswitch block.&gt;<br />    endif<br />endm</code></pre></div>
    <div class="meta">Posted on 2003-08-04 13:06:48 by QvasiModo</div>
   </div>
  </div>
 </body>
</html>