<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Small challenge - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29696" />
  <link rel="prev" href="../?id=29696&amp;page=2" />  <link rel="next" href="../?id=29696&amp;page=4" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29696">Small challenge</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=29696&amp;page=1" style="">&laquo;</a><a href="../?id=29696&amp;page=2" style="">&lt;</a><input type="hidden" name="id" value="29696" /><input type="number" name="page" min="1" max="4" step="1" value="3" onchange="this.form.submit();" /><a href="../?id=29696&amp;page=4">&gt;</a><a href="../?id=29696&amp;page=4">&raquo;</a></form>   <div class="post" id="post-209716">
    <div class="subject"><a href="#post-209716">Re: Small challenge</a></div>
    <div class="body"><div class="quote"><br />My first solution was quite similar to this, it also used a rotational approach.<br />And yes, it was slowww.</div><br /><br />I think the rcr/rcl are the main culprit.</div>
    <div class="meta">Posted on 2009-11-24 11:21:16 by Scali</div>
   </div>
   <div class="post" id="post-209719">
    <div class="subject"><a href="#post-209719">Re: Small challenge</a></div>
    <div class="body"><div class="quote">In this version it&#039;s not very fast, not even if you consider that it actually does two numbers instead of one. Even if you take half the measurement, it&#039;s still not with the fastest routines.</div><br />True. MMX is not supposed to be used in &#039;single-iteration&#039; algorithms but in stream processing. The most costly thing, I guess, is the actual extraction of the return value. &quot;movd&quot; is kinda slow, IIRC. Please confirm, if possible.</div>
    <div class="meta">Posted on 2009-11-24 13:10:10 by ti_mo_n</div>
   </div>
   <div class="post" id="post-209723">
    <div class="subject"><a href="#post-209723">Re: Small challenge</a></div>
    <div class="body">I think both the movd and the emms required will cause some overhead.<br />Regardless, I&#039;ve tried this alternative MMX algo:<br /><pre><code>multiplier3 dq&nbsp; 0080000100800001h<br /><br />	movd		mm0, dword ptr <br />	pxor		mm1, mm1<br />	pand		mm0, <br />	punpcklbw	mm0, mm1<br />	pmaddwd		mm0, <br />	movq		mm1, mm0<br />	psrlq		mm0, 18<br />	paddd		mm0, mm1<br />	movd		eax, mm0</code></pre><br /><br />I get:<br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000655 ticks (effective 19.650 clk/iteration)<br /><br />So still not great, but it&#039;s got potential :)</div>
    <div class="meta">Posted on 2009-11-24 16:02:55 by Scali</div>
   </div>
   <div class="post" id="post-209724">
    <div class="subject"><a href="#post-209724">Re: Small challenge</a></div>
    <div class="body">Here&#039;s an even better one... Figured out a way to get around the limitations of pmaddubsw:<br /><pre><code>multiplier1	dq	8001800180018001h<br />multiplier2	dq	4000000140000001h<br /><br />	movd		mm0, dword ptr <br />	movq		mm1, <br />	pand		mm0, <br />	pmaddubsw	mm1, mm0<br />	pmaddwd		mm1, <br />	movd		eax, mm1</code></pre><br /><br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000608 ticks (effective 18.240 clk/iteration)<br /><br />The high part of mm1 is ignored in the output in this case, but theoretically a second number could be in there, if you load a qword rather than a dword at the start of the routine.<br />I think if you start unrolling this MMX routine, it could become a real winner, as it doesn&#039;t need a lot of registers to process the numbers. You can unroll it 4 times pretty easily.</div>
    <div class="meta">Posted on 2009-11-24 16:56:02 by Scali</div>
   </div>
   <div class="post" id="post-209725">
    <div class="subject"><a href="#post-209725">Re: Small challenge</a></div>
    <div class="body">I just answered my own problem...<br />emms causes the overhead. Why do we need emms? Because MMX shares the FPU stack.<br />What does SSE2 do? It allows us to use the dedicated SSE registers with regular MMX operations.<br /><br />So I made this:<br /><pre><code>	movd		xmm0, dword ptr <br />	movdqa		xmm2, xmmword ptr <br />	movdqa		xmm1, xmmword ptr <br />	movdqa		xmm3, xmmword ptr <br />	pand		xmm0, xmm2<br />	pmaddubsw	xmm1, xmm0<br />	pmaddwd		xmm1, xmm3<br />	movd		eax, xmm1</code></pre><br /><br />No more need for emms, which cuts lots of overhead...<br />I also found a small mistake... I accidentally had two emms instructions, so it was slowed down even more. I&#039;ve fixed that now, and MMX doesn&#039;t look *that* disastrous anymore:<br />test01-Scali1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000297 ticks (effective 8.910 clk/iteration)<br />test02-Scali2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000265 ticks (effective 7.950 clk/iteration)<br />test03-Scali3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000281 ticks (effective 8.430 clk/iteration)<br />test04-sysfce2-1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000515 ticks (effective 15.450 clk/iteration)<br />test05-Ultrano &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000359 ticks (effective 10.770 clk/iteration)<br />test06-ANSI C 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000312 ticks (effective 9.360 clk/iteration)<br />test07-ANSI C 2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000297 ticks (effective 8.910 clk/iteration)<br />test08-ANSI C 2 handoptimized ...000280 ticks (effective 8.400 clk/iteration)<br />test09-r22 LUT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000671 ticks (effective 20.130 clk/iteration)<br />test10-drizz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000265 ticks (effective 7.950 clk/iteration)<br />test11-sysfce2-2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000296 ticks (effective 8.880 clk/iteration)<br />test12-sysfce2-3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000920 ticks (effective 27.600 clk/iteration)<br />test13-ti_mo_n &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000484 ticks (effective 14.520 clk/iteration)<br />test14-Scali MMX &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000390 ticks (effective 11.700 clk/iteration)<br />test15-Scali SSE2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000265 ticks (effective 7.950 clk/iteration)<br /><br />It is already the fastest solution, and that is only counting one solution. In reality it is calculating 4 solutions in parallel (the registers are 128 bits wide now, instead of MMX&#039; 64-bits, which gave us two solutions).<br />So technically we only spend 1.875 clks on a single solution.<br /><br />I&#039;ve also tried the MMX code without any emms at all. It was about as fast as the SSE2 then, but obviously there were exceptions in the float code later.<br /><br />Edit: removed attachment, get the latest file elsewhere in the thread.</div>
    <div class="meta">Posted on 2009-11-24 17:46:03 by Scali</div>
   </div>
   <div class="post" id="post-209726">
    <div class="subject"><a href="#post-209726">Re: Small challenge</a></div>
    <div class="body">Look Up Table<br />It wasn&#039;t the MOVZX reg,  &nbsp;that was slowing the look up table solution down, <br />it was the MOVZX reg, word ptr  that caused the giant penalty.<br /><br />I think the LUT can be a little more competitive now...<br /><pre><code><br />align 16<br />Int32ToInt28:<br /> &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; eax, dword <br /> &nbsp; &nbsp; &nbsp; &nbsp;movzx &nbsp; ecx, ax<br /> &nbsp; &nbsp; &nbsp; &nbsp;shr &nbsp; &nbsp; eax, 16<br /> &nbsp; &nbsp; &nbsp; &nbsp;movzx &nbsp; ecx, word <br /> &nbsp; &nbsp; &nbsp; &nbsp;movzx &nbsp; eax, word <br /> &nbsp; &nbsp; &nbsp; &nbsp;shl &nbsp; &nbsp; eax, 14<br /> &nbsp; &nbsp; &nbsp; &nbsp;or &nbsp; &nbsp; &nbsp;eax, ecx<br /> &nbsp; &nbsp; &nbsp; &nbsp;ret &nbsp; &nbsp; 4<br /></code></pre><br /><br /><br />I figured a Multiply + Correction solution would be the fastest.<br /><br />I&#039;ve noticed for SSE2 using xmmreg, mem opcode variants can sometimes improve execution speed in comparison to loading into another register and then using the xmmreg, xmmreg variant of the opcode. You might want to try this for the SSE2 version.<br /></div>
    <div class="meta">Posted on 2009-11-24 20:52:03 by r22</div>
   </div>
   <div class="post" id="post-209728">
    <div class="subject"><a href="#post-209728">Re: Small challenge</a></div>
    <div class="body">That is indeed MUCH better, r22:<br />test01-Scali1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000296 ticks (effective 8.880 clk/iteration)<br />test02-Scali2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000281 ticks (effective 8.430 clk/iteration)<br />test03-Scali3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000280 ticks (effective 8.400 clk/iteration)<br />test04-sysfce2-1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000515 ticks (effective 15.450 clk/iteration)<br />test05-Ultrano &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000344 ticks (effective 10.320 clk/iteration)<br />test06-ANSI C 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000312 ticks (effective 9.360 clk/iteration)<br />test07-ANSI C 2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000281 ticks (effective 8.430 clk/iteration)<br />test08-ANSI C 2 handoptimized ...000265 ticks (effective 7.950 clk/iteration)<br />test09-r22 LUT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000234 ticks (effective 7.020 clk/iteration)<br />test10-drizz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000265 ticks (effective 7.950 clk/iteration)<br />test11-sysfce2-2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000281 ticks (effective 8.430 clk/iteration)<br />test12-sysfce2-3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000920 ticks (effective 27.600 clk/iteration)<br />test13-ti_mo_n &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000483 ticks (effective 14.490 clk/iteration)<br />test14-Scali MMX &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...000406 ticks (effective 12.180 clk/iteration)<br />test15-Scali SSE2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000234 ticks (effective 7.020 clk/iteration)<br /><br />Yours is now the fastest, together with the SSE2 code (and theoretically the MMX code if you divide the measurement by 2 since it calcs two numbers).<br /><br />Edit: removed attachment, get the latest file elsewhere in the thread.</div>
    <div class="meta">Posted on 2009-11-25 04:25:09 by Scali</div>
   </div>
   <div class="post" id="post-209730">
    <div class="subject"><a href="#post-209730">Re: Small challenge</a></div>
    <div class="body">Here are some results for the Pentium 4:<br />test01-Scali1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000422 ticks (effective 16.028 clk/iteration)<br />test02-Scali2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000391 ticks (effective 14.850 clk/iteration)<br />test03-Scali3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000610 ticks (effective 23.168 clk/iteration)<br />test04-sysfce2-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000610 ticks (effective 23.168 clk/iteration)<br />test05-Ultrano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000469 ticks (effective 17.813 clk/iteration)<br />test06-ANSI C 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000390 ticks (effective 14.812 clk/iteration)<br />test07-ANSI C 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000406 ticks (effective 15.420 clk/iteration)<br />test08-ANSI C 2 handoptimized ...000390 ticks (effective 14.812 clk/iteration)<br />test09-r22 LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000375 ticks (effective 14.243 clk/iteration)<br />test10-drizz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000421 ticks (effective 15.990 clk/iteration)<br />test11-sysfce2-2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000484 ticks (effective 18.382 clk/iteration)<br />test12-sysfce2-3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...001297 ticks (effective 49.260 clk/iteration)<br />test13-ti_mo_n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000718 ticks (effective 27.270 clk/iteration)<br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000734 ticks (effective 27.877 clk/iteration)<br />test15-Scali SSE2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000484 ticks (effective 18.382 clk/iteration)<br /><br />It would appear that I have cheated a bit. I used pmaddusbw, which isn&#039;t an MMX or SSE2 instruction, it is SSSE3, so only Core2 Duo and newer.<br />For these Pentium 4 results, I had to rewrite the algo a bit to avoid the pmaddusbw, making it a tad slower.<br />r22&#039;s LUT appears to be the best performer on Pentium 4 aswell... Gotta hand it to Intel, they sure know how to make caches. I didn&#039;t expect the CPUs to be this fast... The test cases are all random, so you need to rely on the whole table, which won&#039;t fit in L1 cache (especially not on Pentium 4, this model only has 16KB L1 cache). Apparently the L2 prefetching is so good that you barely notice.</div>
    <div class="meta">Posted on 2009-11-25 05:29:13 by Scali</div>
   </div>
   <div class="post" id="post-209731">
    <div class="subject"><a href="#post-209731">Re: Small challenge</a></div>
    <div class="body">Brute-force gives well thought-out and optimized solutions a kick in the shin :D<br />If you wanted to get crazy with wasting memory you could have 2 LUTs and the second would be 65536 Dwords ?????000h so you could avoid the SHL reg, 14 for the high half.<br /><br />That stack alignment penalty is really large, everyone should take note of that. <br />Word sized reads from stack memory need to be aligned on 4 bytes or you&#039;ll take a heck of a hit in performance.<br /><br />BAD<br />movzx eax, word<br />movzx ecx, word<br /><br />GOOD<br />mov eax, dword<br />movzx ecx, ax<br />shr eax, 16<br /></div>
    <div class="meta">Posted on 2009-11-25 07:42:39 by r22</div>
   </div>
   <div class="post" id="post-209732">
    <div class="subject"><a href="#post-209732">Re: Small challenge</a></div>
    <div class="body">I don&#039;t think the mega-LUT really works... The L2 cache is good, but not THAT good:<br />test01-Scali1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000296 ticks (effective 8.880 clk/iteration)<br />test02-Scali2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000265 ticks (effective 7.950 clk/iteration)<br />test03-Scali3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000280 ticks (effective 8.400 clk/iteration)<br />test04-sysfce2-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000515 ticks (effective 15.450 clk/iteration)<br />test05-Ultrano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000359 ticks (effective 10.770 clk/iteration)<br />test06-ANSI C 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000327 ticks (effective 9.810 clk/iteration)<br />test07-ANSI C 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000297 ticks (effective 8.910 clk/iteration)<br />test08-ANSI C 2 handoptimized ...000265 ticks (effective 7.950 clk/iteration)<br />test09-r22 LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000234 ticks (effective 7.020 clk/iteration)<br />test10-drizz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000281 ticks (effective 8.430 clk/iteration)<br />test11-sysfce2-2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000296 ticks (effective 8.880 clk/iteration)<br />test12-sysfce2-3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000905 ticks (effective 27.150 clk/iteration)<br />test13-ti_mo_n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000484 ticks (effective 14.520 clk/iteration)<br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000437 ticks (effective 13.110 clk/iteration)<br />test15-Scali SSE2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000265 ticks (effective 7.950 clk/iteration)<br />test16-Scali MMX+SSSE3&nbsp; &nbsp; &nbsp; &nbsp; ...000437 ticks (effective 13.110 clk/iteration)<br />test17-Scali SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000266 ticks (effective 7.980 clk/iteration)<br />test18-r22 mega-LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000265 ticks (effective 7.950 clk/iteration)<br /><br />Ofcourse another issue is the caching itself. In this case we just run tons of iterations of the same code, so the LUT remains in cache all the time. If you only need to call the function every now and then, and the cache contains other data in the meantime, the other options will probably be more attractive. They are better &#039;one shot&#039; functions so to say, since you won&#039;t get a penalty for a cache-miss.</div>
    <div class="meta">Posted on 2009-11-25 08:12:00 by Scali</div>
   </div>
   <div class="post" id="post-209737">
    <div class="subject"><a href="#post-209737">Re: Small challenge</a></div>
    <div class="body">Should be faster: :)<pre><code><br />option	 prologue:none<br />option	 epilogue:none<br />align 16<br />C32to28a proc num:dword<br />	 pop&nbsp; ecx<br />	 mov&nbsp; edx, 7Fh<br />	 pop&nbsp; eax 	<br />	 mov&nbsp; ecx, 7F00h<br />	 and&nbsp; edx, eax<br />	 and&nbsp; ecx, eax<br />	 lea&nbsp; edx, 		<br />	 mov&nbsp; ecx, 7F0000h	 	&nbsp; <br />	 and&nbsp; ecx, eax&nbsp; 		<br />	 and&nbsp; eax, 7F000000h<br />	 lea&nbsp; edx, <br />	 lea&nbsp; eax, <br />	 shr&nbsp; eax, 3<br />	 jmp&nbsp; dword ptr <br />C32to28a endp<br />;<br />align 16<br />C32to28b proc 	&nbsp;  num:dword<br />	 pop	&nbsp;  ecx<br />	 pop	&nbsp;  eax<br />	 pshufd	&nbsp;  xmm1, oword ptr , 0E4h<br />	 movd	&nbsp;  xmm0, eax<br />	 pand	&nbsp;  xmm0, oword ptr <br />	 pmaddubsw xmm1, xmm0<br />	 pmaddwd&nbsp;  xmm1, oword ptr <br />	 movd	&nbsp;  eax,&nbsp; xmm1<br />	 jmp	&nbsp;  ecx<br />C32to28b endp<br />option	 prologue:prologuedef<br />option	 epilogue:epiloguedef</code></pre><br /></div>
    <div class="meta">Posted on 2009-11-25 12:45:37 by lingo12</div>
   </div>
   <div class="post" id="post-209738">
    <div class="subject"><a href="#post-209738">Re: Small challenge</a></div>
    <div class="body">The mega-LUT seems to work better when both tables are dwords. Still it&#039;s no faster than the single LUT, but it&#039;s tied now.<br />lingo12&#039;s solution is also equally fast...<br /><br />Edit: sorry lingo12, I didn&#039;t see that you put two routines in your post. There was a scrollbar, but I didn&#039;t notice it because the first routine fit exactly into the code block.<br />I&#039;ve added the SSSE3 routine aswell:<br />test17-Scali SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000234 ticks (effective 7.020 clk/iteration)<br />test18-r22 mega-LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000234 ticks (effective 7.020 clk/iteration)<br />test19-lingo12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000234 ticks (effective 7.020 clk/iteration)<br />test20-lingo12 SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000234 ticks (effective 7.020 clk/iteration)<br />test09-r22 LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000249 ticks (effective 7.470 clk/iteration)<br />test10-drizz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000265 ticks (effective 7.950 clk/iteration)<br />test02-Scali2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000266 ticks (effective 7.980 clk/iteration)<br />test03-Scali3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000281 ticks (effective 8.430 clk/iteration)<br />test08-ANSI C 2 handoptimized ...000281 ticks (effective 8.430 clk/iteration)<br />test15-Scali SSE2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000281 ticks (effective 8.430 clk/iteration)<br />test01-Scali1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000296 ticks (effective 8.880 clk/iteration)<br />test11-sysfce2-2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000296 ticks (effective 8.880 clk/iteration)<br />test07-ANSI C 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000297 ticks (effective 8.910 clk/iteration)<br />test06-ANSI C 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000312 ticks (effective 9.360 clk/iteration)<br />test05-Ultrano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000359 ticks (effective 10.770 clk/iteration)<br />test16-Scali MMX+SSSE3&nbsp; &nbsp; &nbsp; &nbsp; ...000405 ticks (effective 12.150 clk/iteration)<br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000437 ticks (effective 13.110 clk/iteration)<br />test13-ti_mo_n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000484 ticks (effective 14.520 clk/iteration)<br />test04-sysfce2-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000514 ticks (effective 15.420 clk/iteration)<br />test12-sysfce2-3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000920 ticks (effective 27.600 clk/iteration)<br /><br />Apparently it just doesn&#039;t get faster than 7.020 clks... Quite a few routines get that result now.</div>
    <div class="meta">Posted on 2009-11-25 16:09:09 by Scali</div>
   </div>
   <div class="post" id="post-209780">
    <div class="subject"><a href="#post-209780">Re: Small challenge</a></div>
    <div class="body">Well, it&#039;s been quiet for a few days...<br />I&#039;ll upload the latest yodel package. If nobody has anything to add, I suppose we can just run the benchmarks on a few machines and call out winners in every category... or something :)<br /><br />Here&#039;s the latest version on Pentium 4:<br />test09-r22 LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000359 ticks (effective 13.635 clk/iteration)<br />test18-r22 mega-LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000375 ticks (effective 14.243 clk/iteration)<br />test02-Scali2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000391 ticks (effective 14.850 clk/iteration)<br />test06-ANSI C 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000391 ticks (effective 14.850 clk/iteration)<br />test07-ANSI C 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000391 ticks (effective 14.850 clk/iteration)<br />test04-sysfce2-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000406 ticks (effective 15.420 clk/iteration)<br />test08-ANSI C 2 handoptimized ...000406 ticks (effective 15.420 clk/iteration)<br />test03-Scali3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000421 ticks (effective 15.990 clk/iteration)<br />test19-lingo12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000421 ticks (effective 15.990 clk/iteration)<br />test10-drizz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000437 ticks (effective 16.597 clk/iteration)<br />test01-Scali1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000438 ticks (effective -1.#IO clk/iteration)<br />test15-Scali SSE2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000468 ticks (effective 17.775 clk/iteration)<br />test11-sysfce2-2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000484 ticks (effective 18.382 clk/iteration)<br />test05-Ultrano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000516 ticks (effective 19.598 clk/iteration)<br />test13-ti_mo_n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000719 ticks (effective 27.308 clk/iteration)<br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000734 ticks (effective 27.877 clk/iteration)<br />test12-sysfce2-3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...001297 ticks (effective 49.260 clk/iteration)</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=2966" target="_blank">yodel_06.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2009-11-30 09:17:17 by Scali</div>
   </div>
   <div class="post" id="post-209784">
    <div class="subject"><a href="#post-209784">Re: Small challenge</a></div>
    <div class="body">And here are the results on my old Athlon XP1800+:<br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000640 ticks (effective 9.882 clk/iteration)<br />test18-r22 mega-LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000661 ticks (effective 10.206 clk/iteration)<br />test09-r22 LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000671 ticks (effective 10.360 clk/iteration)<br />test04-sysfce2-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000711 ticks (effective 10.978 clk/iteration)<br />test02-Scali2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000771 ticks (effective 11.904 clk/iteration)<br />test07-ANSI C 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000771 ticks (effective 11.904 clk/iteration)<br />test08-ANSI C 2 handoptimized ...000771 ticks (effective 11.904 clk/iteration)<br />test10-drizz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000771 ticks (effective 11.904 clk/iteration)<br />test19-lingo12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000771 ticks (effective 11.904 clk/iteration)<br />test01-Scali1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000841 ticks (effective -1.#IO clk/iteration)<br />test03-Scali3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000841 ticks (effective 12.985 clk/iteration)<br />test13-ti_mo_n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000841 ticks (effective 12.985 clk/iteration)<br />test11-sysfce2-2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000842 ticks (effective 13.000 clk/iteration)<br />test06-ANSI C 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000901 ticks (effective 13.911 clk/iteration)<br />test05-Ultrano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...001042 ticks (effective 16.088 clk/iteration)<br />test12-sysfce2-3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...001101 ticks (effective 16.999 clk/iteration)<br /><br />I suppose the conclusion so far is something like this:<br />Core2 Duo:<br />- Plain:<br /> 1) lingo12<br /> 2) r22<br /> 3) drizz<br /><br />- MMX/SSE:<br /> 1) lingo12/Scali SSSE3<br /> 2) Scali SSE2<br /> 3) Scali MMX+SSSE3<br /><br />Pentium 4:<br />- Plain:<br /> 1) r22<br /> 2) Scali2/C compiler<br /> 3) sysfce2/C compiler<br /><br />- MMX/SSE:<br /> 1) Scali SSE2<br /> 2) ti_mo_n<br /> 3) Scali MMX<br /><br />Athlon XP:<br />- Plain:<br /> 1) r22<br /> 2) sysfce2-1<br /> 3) lingo12/Scali2/C compiler/drizz<br /><br />- MMX/SSE:<br /> 1) Scali MMX<br /> 2) ti_mo_n<br /><br />Well, the results are quite interesting at any rate... Some routines are quite consistent across these different architectures... Some are great on one architecture and horrible on another. You can also see quite clearly that the Athlon has an improved emms instruction. The MMX doesn&#039;t have the overhead that it has on Pentium 4 (and I believe you&#039;ll find much the same overhead with Pentium 2/3). They already had an &#039;femms&#039; for that purpose on the K6, but on Athlon they made emms as fast as femms. The result: suddenly the MMX routine is at the top, rather than at the bottom of the list.<br />The C compiler didn&#039;t even do all that badly, it managed to get into the top 3.<br />The routines that perform best are the LUT and the &#039;packed add&#039; routine.</div>
    <div class="meta">Posted on 2009-11-30 13:05:45 by Scali</div>
   </div>
   <div class="post" id="post-209785">
    <div class="subject"><a href="#post-209785">Re: Small challenge</a></div>
    <div class="body">Oh, and just for kicks, I figured I&#039;d write a C version of the LUT...<br />The compiler came up with the &#039;perfect&#039; code:<br />test21-ANSI C LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000234 ticks (effective 7.020 clk/iteration)<br /><br /><pre><code>_text:0002003C&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp;  ecx, <br />_text:00020040&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp;  eax, ecx<br />_text:00020042&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  shr&nbsp; &nbsp;  eax, 10h<br />_text:00020045&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  movzx&nbsp;  eax, ds:_LUT<br />_text:0002004D&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  movzx&nbsp;  ecx, cx<br />_text:00020050&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  movzx&nbsp;  edx, ds:_LUT<br />_text:00020058&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  shl&nbsp; &nbsp;  eax, 0Eh<br />_text:0002005B&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  or&nbsp; &nbsp; &nbsp; eax, edx</code></pre></div>
    <div class="meta">Posted on 2009-11-30 15:36:44 by Scali</div>
   </div>
   <div class="post" id="post-209790">
    <div class="subject"><a href="#post-209790">Re: Small challenge</a></div>
    <div class="body">Here&#039;s what I get on my work Pentium 4 (2.8 GHz).<br /><br /><pre><code>######## Yodel version 0.6, 2009/11/24, 11:00<br />## WARNING: unable to read coulomb.ini, using defaults<br />## Test parameters: 100000000 iterations of 2048 muls, total 100000000 muls<br />## Boosting priority: your computer might appear frozen - don&#039;t panic.<br />## Retrieving (NT) or calculating (9x) clockspeed...2793 MHz<br />/] running conformance tests<br />test01-Scali1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test02-Scali2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test03-Scali3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test04-sysfce2-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test05-Ultrano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test06-ANSI C 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test07-ANSI C 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test08-ANSI C 2 handoptimized ...conforms<br />test09-r22 LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test10-drizz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test11-sysfce2-2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test12-sysfce2-3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test13-ti_mo_n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test15-Scali SSE2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test16-Scali MMX+SSSE3&nbsp; &nbsp; &nbsp; &nbsp; ...func uses unsupported instructions<br />test17-Scali SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...func uses unsupported instructions<br />test18-r22 mega-LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test19-lingo12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test20-lingo12 SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...func uses unsupported instructions<br />/] running performance tests<br />test01-Scali1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000547 ticks (effective -1.#IO clk/iteration)<br />test02-Scali2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000531 ticks (effective 14.831 clk/iteration)<br />test03-Scali3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000578 ticks (effective 16.144 clk/iteration)<br />test04-sysfce2-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000562 ticks (effective 15.697 clk/iteration)<br />test05-Ultrano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000625 ticks (effective 17.456 clk/iteration)<br />test06-ANSI C 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000546 ticks (effective 15.250 clk/iteration)<br />test07-ANSI C 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000547 ticks (effective 15.278 clk/iteration)<br />test08-ANSI C 2 handoptimized ...000531 ticks (effective 14.831 clk/iteration)<br />test09-r22 LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000500 ticks (effective 13.965 clk/iteration)<br />test10-drizz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000594 ticks (effective 16.590 clk/iteration)<br />test11-sysfce2-2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000656 ticks (effective 18.322 clk/iteration)<br />test12-sysfce2-3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...001781 ticks (effective 49.743 clk/iteration)<br />test13-ti_mo_n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...001078 ticks (effective 30.109 clk/iteration)<br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...001000 ticks (effective 27.930 clk/iteration)<br />test15-Scali SSE2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000625 ticks (effective 17.456 clk/iteration)<br />test16-Scali MMX+SSSE3&nbsp; &nbsp; &nbsp; &nbsp; ...doesn&#039;t conform(!)...skipping<br />test17-Scali SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...doesn&#039;t conform(!)...skipping<br />test18-r22 mega-LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000515 ticks (effective 14.384 clk/iteration)<br />test19-lingo12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000578 ticks (effective 16.144 clk/iteration)<br />test20-lingo12 SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...doesn&#039;t conform(!)...skipping</code></pre><br /><br />Just out of curiosity, how long does the <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=29696.msg209687#msg209687">shld</a> version take?<br />I haven&#039;t been able to get it to compile (well, mostly link) as it seems I don&#039;t have the C libraries for it and I haven&#039;t had a chance to go through to rewrite those sections.</div>
    <div class="meta">Posted on 2009-12-01 14:12:20 by sysfce2</div>
   </div>
   <div class="post" id="post-209792">
    <div class="subject"><a href="#post-209792">Re: Small challenge</a></div>
    <div class="body">Here&#039;s what I got on my home Pentium 4.<br /><br /><pre><code>######## Yodel version 0.6, 2009/11/24, 11:00<br />## WARNING: unable to read coulomb.ini, using defaults<br />## Test parameters: 100000000 iterations of 2048 muls, total 100000000 muls<br />## Boosting priority: your computer might appear frozen - don&#039;t panic.<br />## Retrieving (NT) or calculating (9x) clockspeed...2400 MHz<br />/] running conformance tests<br />test01-Scali1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test02-Scali2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test03-Scali3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test04-sysfce2-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test05-Ultrano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test06-ANSI C 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test07-ANSI C 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test08-ANSI C 2 handoptimized ...conforms<br />test09-r22 LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test10-drizz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test11-sysfce2-2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test12-sysfce2-3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test13-ti_mo_n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test15-Scali SSE2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test16-Scali MMX+SSSE3&nbsp; &nbsp; &nbsp; &nbsp; ...func uses unsupported instructions<br />test17-Scali SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...func uses unsupported instructions<br />test18-r22 mega-LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test19-lingo12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test20-lingo12 SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...func uses unsupported instructions<br />/] running performance tests<br />test01-Scali1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000766 ticks (effective -1.#IO clk/iteration)<br />test02-Scali2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000766 ticks (effective 18.384 clk/iteration)<br />test03-Scali3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000937 ticks (effective 22.488 clk/iteration)<br />test04-sysfce2-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000765 ticks (effective 18.360 clk/iteration)<br />test05-Ultrano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000938 ticks (effective 22.512 clk/iteration)<br />test06-ANSI C 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000766 ticks (effective 18.384 clk/iteration)<br />test07-ANSI C 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000766 ticks (effective 18.384 clk/iteration)<br />test08-ANSI C 2 handoptimized ...000750 ticks (effective 18.000 clk/iteration)<br />test09-r22 LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000719 ticks (effective 17.256 clk/iteration)<br />test10-drizz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000922 ticks (effective 22.128 clk/iteration)<br />test11-sysfce2-2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000953 ticks (effective 22.872 clk/iteration)<br />test12-sysfce2-3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...001922 ticks (effective 46.128 clk/iteration)<br />test13-ti_mo_n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...001454 ticks (effective 34.896 clk/iteration)<br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...001281 ticks (effective 30.744 clk/iteration)<br />test15-Scali SSE2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000781 ticks (effective 18.744 clk/iteration)<br />test16-Scali MMX+SSSE3&nbsp; &nbsp; &nbsp; &nbsp; ...doesn&#039;t conform(!)...skipping<br />test17-Scali SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...doesn&#039;t conform(!)...skipping<br />test18-r22 mega-LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000687 ticks (effective 16.488 clk/iteration)<br />test19-lingo12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000750 ticks (effective 18.000 clk/iteration)<br />test20-lingo12 SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...doesn&#039;t conform(!)...skipping</code></pre><br /><br />And on an AMD Athlon 2100+:<br /><br /><pre><code>######## Yodel version 0.6, 2009/11/24, 11:00<br />## WARNING: unable to read coulomb.ini, using defaults<br />## Test parameters: 100000000 iterations of 2048 muls, total 100000000 muls<br />## Boosting priority: your computer might appear frozen - don&#039;t panic.<br />## Retrieving (NT) or calculating (9x) clockspeed...1734 MHz<br />/] running conformance tests<br />test01-Scali1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test02-Scali2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test03-Scali3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test04-sysfce2-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test05-Ultrano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test06-ANSI C 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test07-ANSI C 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test08-ANSI C 2 handoptimized ...conforms<br />test09-r22 LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test10-drizz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test11-sysfce2-2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test12-sysfce2-3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test13-ti_mo_n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test15-Scali SSE2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test16-Scali MMX+SSSE3&nbsp; &nbsp; &nbsp; &nbsp; ...func uses unsupported instructions<br />test17-Scali SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...func uses unsupported instructions<br />test18-r22 mega-LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...conforms<br />test19-lingo12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...conforms<br />test20-lingo12 SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...func uses unsupported instructions<br />/] running performance tests<br />test01-Scali1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000761 ticks (effective -1.#IO clk/iteration)<br />test02-Scali2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000691 ticks (effective 11.982 clk/iteration)<br />test03-Scali3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000751 ticks (effective 13.022 clk/iteration)<br />test04-sysfce2-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000641 ticks (effective 11.115 clk/iteration)<br />test05-Ultrano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000931 ticks (effective 16.144 clk/iteration)<br />test06-ANSI C 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000811 ticks (effective 14.063 clk/iteration)<br />test07-ANSI C 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000691 ticks (effective 11.982 clk/iteration)<br />test08-ANSI C 2 handoptimized ...000691 ticks (effective 11.982 clk/iteration)<br />test09-r22 LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000581 ticks (effective 10.075 clk/iteration)<br />test10-drizz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000691 ticks (effective 11.982 clk/iteration)<br />test11-sysfce2-2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000751 ticks (effective 13.022 clk/iteration)<br />test12-sysfce2-3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000982 ticks (effective 17.028 clk/iteration)<br />test13-ti_mo_n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000751 ticks (effective 13.022 clk/iteration)<br />test14-Scali MMX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000581 ticks (effective 10.075 clk/iteration)<br />test15-Scali SSE2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000581 ticks (effective -1.#IO clk/iteration)<br />test16-Scali MMX+SSSE3&nbsp; &nbsp; &nbsp; &nbsp; ...doesn&#039;t conform(!)...skipping<br />test17-Scali SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...doesn&#039;t conform(!)...skipping<br />test18-r22 mega-LUT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...000580 ticks (effective 10.057 clk/iteration)<br />test19-lingo12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...000691 ticks (effective 11.982 clk/iteration)<br />test20-lingo12 SSSE3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...doesn&#039;t conform(!)...skipping</code></pre></div>
    <div class="meta">Posted on 2009-12-01 21:53:07 by sysfce2</div>
   </div>
   <div class="post" id="post-209793">
    <div class="subject"><a href="#post-209793">Re: Small challenge</a></div>
    <div class="body">Here&#039;s another method:&nbsp; I combined a little bit of the partial registers, addition, and drizz&#039;s thinking.<br /><br /><pre><code>	add al,al<br />	mov esi,00000000011111110000000000000000b<br />	movzx edx,ax<br />	and esi,eax<br />	xor eax,esi<br />	add eax,edx<br />	lea eax,<br />	and eax,01111111000000011111111111111000b<br />	lea eax,<br />	shr eax,3</code></pre><br /><br />I think it still needs a little tweaking, but at least it&#039;s working:&nbsp; I&#039;ve been trying to think of a better way to do the xor/add/lea in the middle - you guys have some ideas?&nbsp; It works with some numbers without the xor, but once initial numbers with too many bits set are used it overflows.</div>
    <div class="meta">Posted on 2009-12-01 22:04:28 by sysfce2</div>
   </div>
   <div class="post" id="post-209794">
    <div class="subject"><a href="#post-209794">Re: Small challenge</a></div>
    <div class="body">oooh, thats a really interesting approach, I like </div>
    <div class="meta">Posted on 2009-12-02 01:32:46 by Homer</div>
   </div>
   <div class="post" id="post-209809">
    <div class="subject"><a href="#post-209809">Re: Small challenge</a></div>
    <div class="body"><div class="quote"><br />oooh, thats a really interesting approach, I like <br /></div><br />This is the original version:&nbsp; I was trying to figure out a way to eliminate a partial register.<pre><code>	add al,al<br />	mov edx,00000000011111111111111111111100b<br />	add ax,ax<br />	and edx,eax<br />	and eax,01111111000000000000000000000000b<br />	lea eax,<br />	shr eax,3</code></pre><br />I guess I&#039;ve got to try to get some timing code myself so I can try these out without relying on you guys (BTW, thanks a lot Scali for that).</div>
    <div class="meta">Posted on 2009-12-02 19:44:23 by sysfce2</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=29696&amp;page=1" style="">&laquo;</a><a href="../?id=29696&amp;page=2" style="">&lt;</a><input type="hidden" name="id" value="29696" /><input type="number" name="page" min="1" max="4" step="1" value="3" onchange="this.form.submit();" /><a href="../?id=29696&amp;page=4">&gt;</a><a href="../?id=29696&amp;page=4">&raquo;</a></form>  </div>
 </body>
</html>