<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>serial transmitter and receiver - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=28857" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=28857">serial transmitter and receiver</a></p>
   <div class="post" id="post-203923">
    <div class="subject"><a href="#post-203923">serial transmitter and receiver</a></div>
    <div class="body">Hi all i m new to this forum and new to assembly trying to learn the &quot;basics&quot;.<br />I ve been trying to transfer data over a serial cable to another pc.I m working under windows also.<br />Ive managed to script the transmitter but im having problems with the receiver and i don&#039;t know where to start.<br />Could someone advise me?<br />Here is the code for my transmitter in case it helps.<br />Thanks in advance<br /><pre><code><hr />#include &lt;stdio.h&gt;<br /><br />int main (void) {<br /><br />//Define Variables<br />&nbsp; char Textfile&#91;] = &quot;C:\\text.txt&quot;;&nbsp;  //File that holds the data to transmit<br />&nbsp; char Comport&#91;] =&quot;COM2&quot;;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  //Define Serial Port<br /><br /><br />&nbsp; FILE * readfile;<br />&nbsp; FILE * writecom;<br /><br /><br />&nbsp; char error&#91;] = &quot;Unable to open File/Comport\n\n&quot;; //TERMINATION with an error message<br />&nbsp; char chartosend;<br />&nbsp; char readaccess&#91;] =&quot;r&quot;;<br />&nbsp; char writeaccess&#91;] =&quot;wt&quot;;<br /><br />&nbsp; _asm {<br /><br />//check if the port can be accessed<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lea eax,writeaccess&nbsp;  //check acess a<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lea eax,Comport&nbsp; &nbsp; &nbsp;  //check port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  push eax<br /><br />&nbsp; &nbsp; &nbsp; call fopen<br />&nbsp; &nbsp; &nbsp; add esp,8&nbsp;  //Clean the stack<br /><br />&nbsp; &nbsp; &nbsp; cmp eax, 0<br />&nbsp; &nbsp; &nbsp; mov writecom, eax<br />&nbsp; &nbsp; &nbsp; je TERMINATION //If it doesn&#039;t writecom then run TERMINATION for handling errors<br /><br />//check if textfile is accessible<br />&nbsp; &nbsp; &nbsp; lea eax,readaccess&nbsp; //check for readaccess for the textfile and move it to the stack<br />&nbsp; &nbsp; &nbsp; push eax<br />&nbsp; &nbsp; &nbsp; lea eax, Textfile&nbsp; &nbsp;  //check for textfile and move it to the stack<br />&nbsp; &nbsp; &nbsp; push eax<br /><br /><br />&nbsp; &nbsp; &nbsp; call fopen<br />&nbsp; &nbsp; &nbsp; add esp, 8 //Clean the stack<br /><br />&nbsp; &nbsp; &nbsp; cmp eax, 0<br />&nbsp; &nbsp; &nbsp; mov readfile, eax<br />&nbsp; &nbsp; &nbsp; je TERMINATION&nbsp; &nbsp; //If it doesn&#039;t open readfile then run TERMINATION for handling errors<br /><br /><br /><br />WHILENOTEOF:<br />//IF no more data can be read from a data source get each character from the file<br />&nbsp; &nbsp;  mov eax, readfile<br />&nbsp; &nbsp;  push eax<br /><br />&nbsp; &nbsp;  call fgetc<br />&nbsp; &nbsp;  add esp, 4<br />&nbsp; &nbsp; <br />//check if EOF has been reached<br />&nbsp; &nbsp;  cmp al, EOF<br />&nbsp; &nbsp;  je FILECLOSE<br /><br />&nbsp; &nbsp;  mov chartosend, al<br /><br />&nbsp; &nbsp;  push eax<br />&nbsp; &nbsp;  add esp, 4<br />//write characters to comport<br />&nbsp; &nbsp;  mov eax, writecom<br />&nbsp; &nbsp;  push eax<br />&nbsp; &nbsp;  mov al, chartosend<br />&nbsp; &nbsp;  push eax<br />&nbsp; &nbsp;  call fputc<br />&nbsp; &nbsp;  add esp, 8<br /><br />jmp WHILENOTEOF<br /><br />FILECLOSE:<br />//Add closing value to the end of the string<br />&nbsp; &nbsp;  mov eax, writecom<br />&nbsp; &nbsp;  push eax<br /><br />&nbsp; &nbsp;  mov al, 80h&nbsp; //The receiver needs to know the EOF so closing value is 80h<br />&nbsp; &nbsp;  push eax<br /><br />&nbsp; &nbsp;  call fputc<br />&nbsp; &nbsp;  add esp,8<br /><br />//Start closing<br />&nbsp; &nbsp;  mov eax, readfile&nbsp; //readfile<br />&nbsp; &nbsp;  push eax<br /><br />&nbsp; &nbsp;  call fclose<br />&nbsp; &nbsp;  add esp, 4<br /><br />//writecom<br />&nbsp; &nbsp;  mov eax, writecom<br />&nbsp; &nbsp;  push eax<br /><br />&nbsp; &nbsp;  call fclose<br />&nbsp; &nbsp;  add esp, 4<br /><br />&nbsp; &nbsp;  jmp END<br /><br />TERMINATION:<br />&nbsp; &nbsp;  lea eax, error<br />&nbsp; &nbsp;  push eax<br /><br />&nbsp; &nbsp;  call printf<br />&nbsp; &nbsp;  add esp, 4<br /><br />END:<br />&nbsp; &nbsp;  } //_asm<br /><br />&nbsp; &nbsp; return 0;<br />&nbsp; &nbsp; } //void</code></pre></div>
    <div class="meta">Posted on 2007-12-15 08:56:35 by tyropitas</div>
   </div>
  </div>
 </body>
</html>