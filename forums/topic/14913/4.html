<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>reg code to name - size optimization - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14913" />
  <link rel="prev" href="../?id=14913&amp;page=3" />  <link rel="next" href="../?id=14913&amp;page=5" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=14913">reg code to name - size optimization</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=14913&amp;page=1" style="">&laquo;</a><a href="../?id=14913&amp;page=3" style="">&lt;</a><input type="hidden" name="id" value="14913" /><input type="number" name="page" min="1" max="5" step="1" value="4" onchange="this.form.submit();" /><a href="../?id=14913&amp;page=5">&gt;</a><a href="../?id=14913&amp;page=5">&raquo;</a></form>   <div class="post" id="post-116825">
    <div class="subject"><a href="#post-116825">reg code to name - size optimization</a></div>
    <div class="body">snq,<br />yes your code is an improvement for sure.<br />I wanted by my code just to give<br />idea about inner dependences in 16 bytes<br />table.<br />Firstly I tried to do it in math\logic way<br />but didn't see any reaction (might be my<br />explonation was akward one :) ?)<br />Then I tried to give sample code that used<br />what I meant.<br />And then reaction came :)<br />Might be coders better understand ideas through<br />code?<br />Thanks for taking part in the coding.</div>
    <div class="meta">Posted on 2003-09-03 20:02:55 by The Svin</div>
   </div>
   <div class="post" id="post-116826">
    <div class="subject"><a href="#post-116826">reg code to name - size optimization</a></div>
    <div class="body">Thanks everyone, I merely christalized your ideas. <br /><strong>Svin</strong>, your point regarding <strong>and al, 4</strong> is well taken. Therefore one<br />need only change <strong>mov al, dl</strong> to <strong>mov eax, edx</strong>.<br /><br /><strong>snq</strong>, your variation of <strong>bitRAKE's</strong> last entry was what I used as a basis.</div>
    <div class="meta">Posted on 2003-09-03 20:09:56 by Poimander</div>
   </div>
   <div class="post" id="post-116835">
    <div class="subject"><a href="#post-116835">reg code to name - size optimization</a></div>
    <div class="body">Incredible development <strong>Poimander</strong>. :)</div>
    <div class="meta">Posted on 2003-09-03 21:36:49 by bitRAKE</div>
   </div>
   <div class="post" id="post-116889">
    <div class="subject"><a href="#post-116889">reg code to name - size optimization</a></div>
    <div class="body">Who would've thought.... 56 bytes! :grin:<br /><pre><code>C70 proc Flags<br /><br />	pop eax<br />	xchg eax, &#91;esp&#93;<br />	<br />	push esi<br />	lea esi, &#91;2*edx&#93;&#91;OFFSET R70&#93;<br />	shl al, 7<br />	jns short @F      <br />	jc @noE<br />	mov al, 'E'<br />	stosb<br /><br />@noE&#58;<br />	movsw<br />	jmp short @1<br /><br />@@&#58;<br />	mov eax, edx<br />	and al, 4<br />	sub esi, eax<br />	sub esi, eax<br />	xor al, 'L'<br />	movsb<br />	stosb <br /><br />@1&#58;<br />	pop esi<br />	ret<br /><br />R70 BYTE 'AXCXDXBX','SPBPSIDI'<br /><br />C70 endp ; 40,16</code></pre></div>
    <div class="meta">Posted on 2003-09-04 04:31:21 by snq</div>
   </div>
   <div class="post" id="post-116893">
    <div class="subject"><a href="#post-116893">reg code to name - size optimization</a></div>
    <div class="body"><strong>55!</strong> :)<br /><pre><code>C71 proc Flags<br /><br />	pop eax<br />	xchg eax, &#91;esp&#93;<br />	<br />	push esi<br />	lea esi, &#91;2*edx&#93;&#91;OFFSET R71&#93;<br />	rcr al, 1<br />	jnc short @F<br />	jp short @noE<br />	mov al, 'E'<br />	stosb<br /><br />@noE&#58;<br />	movsw<br />	jmp short @1<br /><br />@@&#58;<br />	mov eax, edx<br />	and al, 4<br />	sub esi, eax<br />	sub esi, eax<br />	xor al, 'L'<br />	movsb<br />	stosb <br /><br />@1&#58;<br />	pop esi<br />	ret<br /><br />R71 BYTE 'AXCXDXBX','SPBPSIDI'<br /><br />C71 endp ; 39,16</code></pre><span style="font-size:9px>edit: typo..</span></div>
    <div class="meta">Posted on 2003-09-04 05:36:13 by snq</div>
   </div>
   <div class="post" id="post-116901">
    <div class="subject"><a href="#post-116901">reg code to name - size optimization</a></div>
    <div class="body"><div class="quote"><br />Who would've thought.... 56 bytes<br /></div><br />:)<br />If you ask me - I always had faith in your<br />bright head, and was sad to see when you were<br />about to give up<br />snq,<br />about last version(55 bytes):<br />Flags might have other then index 0,1 bits.<br />So rcr al,1 ..jp in not reliable.</div>
    <div class="meta">Posted on 2003-09-04 08:33:01 by The Svin</div>
   </div>
   <div class="post" id="post-116908">
    <div class="subject"><a href="#post-116908">reg code to name - size optimization</a></div>
    <div class="body"><div class="quote"><em>Originally posted by The Svin </em><strong>Flags might have other then index 0,1 bits.<br />So rcr al,1 ..jp in not reliable. </div><br />Is too :)<br />I OR the flags with 11111100111111001111110011111100b to test and it works fine.. Makes sense :)<br />Let's see:<pre><code><br />	pop eax<br />	xchg eax, &#91;esp&#93;  ; CF=? AL=000000XYb &lt;-- Flags in EAX<br />	rcr al, 1        ; CF=Y AL=?000000Xb PF=X<br /></code></pre>So it doesn't matter what the other bits are set to because CF and PF will be the same..</div>
    <div class="meta">Posted on 2003-09-04 10:14:02 by snq</div>
   </div>
   <div class="post" id="post-116938">
    <div class="subject"><a href="#post-116938">reg code to name - size optimization</a></div>
    <div class="body">al = 00000011b X = 1<br />rcr al,1    P=1<br />al = 00000101b X = 0<br />rcr al,1    P=1</div>
    <div class="meta">Posted on 2003-09-04 13:21:50 by The Svin</div>
   </div>
   <div class="post" id="post-116979">
    <div class="subject"><a href="#post-116979">reg code to name - size optimization</a></div>
    <div class="body">Am I missing something here? PF equals the value in the least significant bit, right?<br />How would al=00000101b followed with rcl al,1 result in the least significant bit being set to 1?<br />As I said earlier most of the flags are quite new to me as I've never really used most of them but I tested the code and it works in every case, no matter what the values of the rest of the bits in the flags are.<br />Here's what I use to test, it runs the rCode2Str function for all possible registers..<pre><code>.data?<br />    thong db 1024 dup&#40;?&#41;<br /><br />.code<br /><br />start&#58;<br /><br />    mov     edi, offset thong<br /><br />    xor     ecx, ecx<br />@loop&#58; <br />    mov     edx, ecx<br />    and     edx, 7<br />    mov     eax, ecx<br />    shr     eax, 3<br />    inc     eax<br />    ; anything value here ending with 00b...<br />    or      eax, 11111111111111111111111111111100b<br />    push    eax<br />    call    C71<br /><br />    mov     al, ' ' <br />    stosb<br /><br />    inc     ecx<br />    test    cl, 7<br />    jne     @F<br />    mov     al, 0Dh<br />    stosb<br />@@&#58;<br />    cmp     ecx, 24<br />    jnz     short @loop<br />    <br />    xor     eax, eax<br />    stosb<br /><br />    invoke  MessageBox, 0, ADDR thong, 0, MB_TOPMOST<br />    invoke  ExitProcess, 0</code></pre></div>
    <div class="meta">Posted on 2003-09-04 16:21:51 by snq</div>
   </div>
   <div class="post" id="post-116984">
    <div class="subject"><a href="#post-116984">reg code to name - size optimization</a></div>
    <div class="body"><div class="quote"><br />PF equals the value in the least significant bit, right?<br /></div><br />No.<br />PF is parity of 0s and 1s in low byte of result.<br />biside rcr doesn't change PF</div>
    <div class="meta">Posted on 2003-09-04 17:12:02 by The Svin</div>
   </div>
   <div class="post" id="post-116996">
    <div class="subject"><a href="#post-116996">reg code to name - size optimization</a></div>
    <div class="body"><div class="quote">How would al=00000101b followed with rcl al,1 result in the least significant bit being set to 1?</div> <br /><br />Actually <strong>rcl al, 1</strong> rotates al <strong>9 bits</strong> to the left via the <strong>CF</strong> flag as an extension. In other words the most significant bit is rotated through <strong>CF</strong> and <strong>CF</strong> on through to the least significant bit. <br /><br />Well, in anycase, kudos to you <strong>snq</strong>, your <strong>56</strong> byte version does work. <br /><br />Kudos to you <strong>bitRAKE</strong>, your solution had become a template on which further reduction was made possible. <br /><br />Kudos to you <strong>Svin</strong> for the fruitful discussion.</div>
    <div class="meta">Posted on 2003-09-04 19:45:41 by Poimander</div>
   </div>
   <div class="post" id="post-117066">
    <div class="subject"><a href="#post-117066">reg code to name - size optimization</a></div>
    <div class="body">Right :) I was a bit too quick when reading about the parity flag.. I was just bladdring around in my new intel books and came past this page where eflags is described and I read PF -&gt; &quot;lowest significant&quot;, my brain told me hmm shifting with 1 is small, I threw away the book, ran to my pc, edited the code and yess! it worked :) by coincidence hehe.. Thanks for clarifying!<br /><br />Kudos to everyone, this is a great thread.. I've even learned a bit! :)<br /><br />I'm still looking into squeezing out more bytes.. Perhaps this gives someone a bright idea:<pre><code>C70 proc Flags<br /><br />	pop eax<br />	xchg eax, &#91;esp&#93;<br />	<br />	push esi<br />	lea esi, &#91;2*edx&#93;&#91;OFFSET R70&#93;<br />	shl al, 7<br />	jns short @F      <br />	jc @noE<br />	mov al, 'E'<br />	stosb<br /><br />@noE&#58;<br />	movsb<br />	lodsb<br />	jmp short @1<br /><br />@@&#58;<br />	mov eax, edx<br />	and al, 4<br />	sub esi, eax<br />	sub esi, eax<br />	xor al, 'L'<br />	movsb<br />@1&#58;<br />	stosb <br /><br />	pop esi<br />	ret<br /><br />R70 BYTE 'AXCXDXBX','SPBPSIDI'<br /><br />C70 endp ; 40,16</code></pre>I guess regs named &quot;EXA&quot; or &quot;XA&quot; are not approved ;)</div>
    <div class="meta">Posted on 2003-09-05 06:37:50 by snq</div>
   </div>
   <div class="post" id="post-117102">
    <div class="subject"><a href="#post-117102">55 for real now :)</a></div>
    <div class="body">54 anyone? :grin:<br />Still working on it...<br /><pre><code>C72 proc Flags<br /><br />    pop eax<br />    xchg eax, &#91;esp&#93;<br /><br />    push esi<br />    mov esi, offset R72<br />    shl al, 7<br />    mov eax, edx<br />    jns short @F<br />;   jc short @noE<br />    mov byte ptr &#91;edi&#93;, 'E'<br />;   inc edi<br />    sbb edi, -1<br /><br />;@noE&#58;<br />    shr eax, 1<br />    mov al, byte ptr &#91;esi+8+eax&#93;<br />    jmp short @1<br /><br />@@&#58;<br />    and al, 4<br />    sub esi, eax<br />    xor al, 'L'<br /><br />@1&#58;<br />    add esi, edx<br />    movsb<br />    stosb<br /><br />    pop esi<br />    ret<br /><br />R72 BYTE 'ACDBSBSD', 'XXPI'<br /><br />C72 endp ; 43,12</code></pre></div>
    <div class="meta">Posted on 2003-09-05 11:59:46 by snq</div>
   </div>
   <div class="post" id="post-117128">
    <div class="subject"><a href="#post-117128">reg code to name - size optimization</a></div>
    <div class="body">Svin, I know you said don't change any registers other than EDI.. But what about changing EBP?<br />In that case there's another byte to strip here ;)</div>
    <div class="meta">Posted on 2003-09-05 16:27:35 by snq</div>
   </div>
   <div class="post" id="post-117137">
    <div class="subject"><a href="#post-117137">reg code to name - size optimization</a></div>
    <div class="body">55 bytes, SLICK!</div>
    <div class="meta">Posted on 2003-09-05 17:43:11 by Poimander</div>
   </div>
   <div class="post" id="post-117139">
    <div class="subject"><a href="#post-117139">reg code to name - size optimization</a></div>
    <div class="body"><div class="quote"><br />Svin, I know you said don't change any registers other than EDI.. But what about changing EBP?<br />In that case there's another byte to strip here ;) </div><br />Oh, no!</div>
    <div class="meta">Posted on 2003-09-05 18:02:05 by The Svin</div>
   </div>
   <div class="post" id="post-117239">
    <div class="subject"><a href="#post-117239">reg code to name - size optimization</a></div>
    <div class="body">It turns out <strong>55 bytes</strong> is achieveable with a 16-byte table, to wit (there are at least three other variations):<br /><pre><code><br />OPTION PROLOGUE&#58;NONE<br />OPTION EPILOGUE&#58;NONE<br />C74 proc Flags<br />    pop eax<br />    xchg eax, &#91;esp&#93;<br /><br />    push esi<br />    lea esi, &#91;edx&#93;&#91;OFFSET R74&#93;&#91;8&#93;<br />    shl al, 7<br />    js short @F<br /><br />    mov eax, edx<br />    and al, 4<br />    sub esi, eax<br />    xor al, 'L'<br />    jmp short @1<br /><br />@@&#58;<br />    mov BYTE PTR &#91;edi&#93;, 'E'<br />    sbb edi, -1<br />    mov al, BYTE PTR &#91;esi-8&#93;<br />        <br />@1&#58;<br />    movsb<br />    stosb<br /><br />    pop esi<br />    ret<br /><br />R74 BYTE 'XXXXPPII','ACDBSBSD' <br /><br />C74 endp ; 39,16<br />OPTION PROLOGUE&#58;PROLOGUEDEF<br />OPTION EPILOGUE&#58;EPILOGUEDEF<br /></code></pre></div>
    <div class="meta">Posted on 2003-09-06 11:45:53 by Poimander</div>
   </div>
   <div class="post" id="post-117321">
    <div class="subject"><a href="#post-117321">reg code to name - size optimization</a></div>
    <div class="body">Very nice Poimander :)<br />How about reversing the 'XXXXPPII' table (make it IIPPXXXX) and put it in front of the proc. saves an X, because pop eax happens to be X :grin:<br />I didn't get it smaller (yet) tho but it might be possible...</div>
    <div class="meta">Posted on 2003-09-07 05:52:05 by snq</div>
   </div>
   <div class="post" id="post-117356">
    <div class="subject"><a href="#post-117356">reg code to name - size optimization</a></div>
    <div class="body">That would save one byte, but then you would need two bytes for a jump.  But again there may be an unforseen advantage to reversing the entire table.</div>
    <div class="meta">Posted on 2003-09-07 14:37:53 by Poimander</div>
   </div>
   <div class="post" id="post-117421">
    <div class="subject"><a href="#post-117421">reg code to name - size optimization</a></div>
    <div class="body">No extra jump.. I meant like this:<pre><code>R74 BYTE 'ACDBSBSD','IIPPXXX'<br />C74 proc Flags<br />    pop eax<br />    xchg eax, &#91;esp&#93;<br />    .... etc<br /></code></pre></div>
    <div class="meta">Posted on 2003-09-08 06:04:16 by snq</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=14913&amp;page=1" style="">&laquo;</a><a href="../?id=14913&amp;page=3" style="">&lt;</a><input type="hidden" name="id" value="14913" /><input type="number" name="page" min="1" max="5" step="1" value="4" onchange="this.form.submit();" /><a href="../?id=14913&amp;page=5">&gt;</a><a href="../?id=14913&amp;page=5">&raquo;</a></form>  </div>
 </body>
</html>