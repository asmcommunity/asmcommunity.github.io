<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>reg code to name - size optimization - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14913" />
    <link rel="next" href="../?id=14913&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=14913">reg code to name - size optimization</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=14913&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=14913&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="14913" /><input type="number" name="page" min="1" max="5" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=14913&amp;page=2">&gt;</a><a href="../?id=14913&amp;page=5">&raquo;</a></form>   <div class="post" id="post-115722">
    <div class="subject"><a href="#post-115722">reg code to name - size optimization</a></div>
    <div class="body">Here is a proc that is linked to other my<br />opcode decoding procs.<br />The purpose of the proc is to decode into string<br />mnemonic of register.<br />Proc is given code of the register in EDX,<br />pointer to string to write mnemonic in EDI<br />and bits parameters in Flags (for the proc<br />only bits [0] and [1] is important - that<br />is for bit w and prefix 66h presence)<br />It should write name of the register and set EDI<br />to address of next to written name byte.<br />It can trash EAX, other regs should be unchaged<br />upon return.<br />I wander if one could find a way to optimize it<br />size. There is numerous vage thoughts in my head<br />about ways check bit in Flags, but I haven't caught<br />them yet :)<br />Might be your bright heads could help me ;)<br /><br /><pre><code><br />OPTION PROLOGUE&#58;NONE<br />OPTION EPILOGUE&#58;NONE<br />rCode2Str proc Flags ;IN EDI=String out,EDX = reg code<br />		 ;Flags bit&#91;0&#93;-bit w,bit&#91;1&#93;-if 66h<br />		 ;OUT EDI = next byte to output string<br />		 ;EAX trashed, All other regs unchaged<br />	pop eax<br />	xchg eax,&#91;esp&#93;<br />	pushr 16<br />	mov esi,offset regstr<br />	push 2<br />	lea esi,&#91;esi&#93;&#91;edx*2&#93; ;esi = Str+code*2<br />	popr 1<br />	test al,1 ;if w = 1<br />	je write<br />	lea esi,&#91;esi&#93;&#91;edx&#93;&#91;16&#93; ;esi=Str+16+code*3<br />	inc ecx<br />	test al,2 ;if prefix 66h<br />	je write<br />	inc esi<br />	dec ecx<br />write&#58;<br />	rep movsb	<br />	popr 61<br />	retn<br />regstr db 'ALCLDLBLAHCHDHBHEAXECXEDXEBXESPEBPESIEDI'<br />rCode2Str endp<br />OPTION PROLOGUE&#58;PROLOGUEDEF<br />OPTION EPILOGUE&#58;EPILOGUEDEF<br /><br /><br />pushr macro r<br />	irpc n,r<br />	db &#40;50h or n&#41;<br />	endm<br />endm<br /><br />popr macro r<br />	irpc n,r<br />	db &#40;58h or n&#41;<br />	endm<br />endm<br /></code></pre></div>
    <div class="meta">Posted on 2003-08-27 08:34:03 by The Svin</div>
   </div>
   <div class="post" id="post-115742">
    <div class="subject"><a href="#post-115742">reg code to name - size optimization</a></div>
    <div class="body">one byte shorter:<br /><pre><code><br />rCode2Str proc Flags ;IN EDI=String out,EDX = reg code<br />					 ;Flags bit&#91;0&#93;-bit w,bit&#91;1&#93;-if 66h<br />					 ;OUT EDI = next byte to output string<br />					 ;EAX trashed, All other regs unchaged						<br />	pop eax<br />	xchg eax,&#91;esp&#93;<br />	pushr 16<br />;	mov esi,offset regstr<br />	push 2<br />	lea esi,&#91;edx&#93;&#91;edx&#93;&#91;offset regstr&#93; ;esi = Str+code*2<br />	popr 1<br />	test al,1 ;if w = 1<br />	je write<br />	lea esi,&#91;esi&#93;&#91;edx&#93;&#91;16&#93; ;esi=Str+16+code*3<br />	inc ecx<br />	test al,2 ;if prefix 66h<br />	je write<br />	inc esi<br />	dec ecx<br />write&#58;<br />	rep movsb	<br />	popr 61<br />	retn<br />regstr db 'ALCLDLBLAHCHDHBHEAXECXEDXEBXESPEBPESIEDI'<br />rCode2Str endp<br />OPTION PROLOGUE&#58;PROLOGUEDEF<br />OPTION EPILOGUE&#58;EPILOGUEDEF<br /></code></pre></div>
    <div class="meta">Posted on 2003-08-27 09:30:35 by The Svin</div>
   </div>
   <div class="post" id="post-115855">
    <div class="subject"><a href="#post-115855">reg code to name - size optimization</a></div>
    <div class="body">Here is a start (I can do better):<pre><code>OPTION PROLOGUE&#58;NONE<br />OPTION EPILOGUE&#58;NONE<br />rCode2Str proc Flags ;IN EDI=String out,EDX = reg code<br />		 ;Flags bit&#91;0&#93;-bit w,bit&#91;2&#93;-if 66h<br />		 ;OUT EDI = next byte to output string<br />		 ;EAX trashed, All other regs unchaged<br />	pop eax<br />	popfd<br />	push esi<br />	lea esi,&#91;edx*2&#93; + offset regstr ;esi = Str+code*2<br />	jnc write2<br />	lea esi,&#91;esi&#93;&#91;edx&#93;&#91;16&#93; ;esi=Str+16+code*3<br />	jnp write3<br />	inc esi<br />	jmp write2<br />write3&#58;<br />	movsb	<br />write2&#58;<br />	movsb	<br />	movsb	<br />	pop esi<br />	jmp eax<br />regstr db \<br />	'AL','CL','DL','BL',\<br />	'AH','CH','DH','BH',\<br />	'EAX','ECX','EDX','EBX',\<br />	'ESP','EBP','ESI','EDI'<br />rCode2Str endp<br />OPTION PROLOGUE&#58;PROLOGUEDEF<br />OPTION EPILOGUE&#58;EPILOGUEDEF</code></pre>Your code is 36 bytes.  Mine is &lt; 26.<br /><br />If you want to use this flags method then two more bytes are saved by loading the flags outside of proc.</div>
    <div class="meta">Posted on 2003-08-27 22:31:56 by bitRAKE</div>
   </div>
   <div class="post" id="post-115864">
    <div class="subject"><a href="#post-115864">reg code to name - size optimization</a></div>
    <div class="body">Good move with popfd!<br />There are 2 things though<br />1. Bit 66h should have index 1<br />2. There might be problems using it in kernel<br />mode debuger.<br /><br />Thank you for your ideas.<br /><br />BTW: My heart is aking when I see ,<br />I know in the case compiler would make  from <br />yet just can't help it :)</div>
    <div class="meta">Posted on 2003-08-27 23:07:07 by The Svin</div>
   </div>
   <div class="post" id="post-115865">
    <div class="subject"><a href="#post-115865">reg code to name - size optimization</a></div>
    <div class="body">Looks like I'm dis-qualified. :(<pre><code>OPTION PROLOGUE&#58;NONE<br />OPTION EPILOGUE&#58;NONE<br />rCode2Str proc Flags ;IN EDI=String out,EDX = reg code<br />		 ;Flags bit&#91;2&#93;-bit w,bit&#91;0&#93;-if 66h<br />		 ;OUT EDI = next byte to output string<br />		 ;EAX trashed, All other regs unchaged<br />	pop eax	;return address<br />	popfd	; OF&#58;?&#58;?&#58;?&#58;SF&#58;ZF&#58;0&#58;?&#58;0&#58;PF&#58;1&#58;CF &#40;32 options in flags&#41;<br />	push esi<br />	lea esi,&#91;edx&#93;&#91;edx*4&#93;&#91;OFFSET regstr&#93;<br />	jnp write2<br />	inc esi<br />	inc esi<br />	movsb<br />	jnc write2<br />	dec edi<br />write2&#58;<br />	movsb<br />	movsb<br />	pop esi<br />	jmp eax<br />regstr BYTE \<br />	'ALEAX','CLECX','DLEDX','BLEBX',\<br />	'AHESP','CHEBP','DHESI','BHEDI'<br />rCode2Str endp<br />OPTION PROLOGUE&#58;PROLOGUEDEF<br />OPTION EPILOGUE&#58;EPILOGUEDEF</code></pre>This one doesn't count either then. :tongue:  You should save several bytes in yours with similar code.  I don't understand (2) - please explain.  For you, I did not put .</div>
    <div class="meta">Posted on 2003-08-27 23:20:16 by bitRAKE</div>
   </div>
   <div class="post" id="post-115898">
    <div class="subject"><a href="#post-115898">reg code to name - size optimization</a></div>
    <div class="body">About kernel mode debugger?<br />You see, there is parent controling<br />proc somewhere as you probably guessed already.<br />It sets numerous flags while decoding opcode.<br />Other procs including &quot;main&quot; one, frequently use<br />those flags and also frequently call for rCode2Str<br />so in many cases it's easy and efficient to use<br />the same flags value they usually having in some <br />temp register. rCode2Str uses just 2 flags to<br />determine size of operand, yet for economy other<br />flags are not reset to 0. Now if we run the code<br />in  CPL = 3, then nothing bad could happen if<br />for example popfd pops bits that relate to IOPL<br />and VM - they'd be ignored, not if CPL = 0 though,<br />you can change accedently IOPL and set VM etc.<br />I want kind'a universal piece that can be used anywhere.<br /><br /><div class="quote"><br /> For you, I did not put .<br /></div><br /><br />We are jocking aren't we :)<br /> can be encoded just one way. While <br />can be encoded two different ways, and &quot;true&quot; assembler would<br />encode it as 01 010 101 disp32, though MASM usualy as 00 010 010 disp32 or disp 8 if<br />possible.<br />Encoding with scale = 01 and no base could lead to 3 bytes longer code,<br />cause is no way to encode signed byte instead of dword if base is absent.<br />You know it of course - <br /><br />I'm a little bit suspiecius and paranoid about compilers,<br />and some unpleasent experience to treat them such a way.<br /><br />So to be on a save side I usually specifically write <br />instead of . In this particular proc it doesn't matter of course,<br />since displacement is 32 bit anyway.<br />Yet, I'd prefer write it my way - just in case when there are REALLY NO BASE<br />spelling would immedialy bring my attention to it.<br /><br />Yes, in you code several interesting ideas, tnks.<br /><br />First of all I'm sure now it was a wrong way to mess with counter and rep<br />with such short values and high dependency on conditions with such a short<br />range - it's much more efficient to go way of duplicating instructions.</div>
    <div class="meta">Posted on 2003-08-28 02:59:49 by The Svin</div>
   </div>
   <div class="post" id="post-115940">
    <div class="subject"><a href="#post-115940">reg code to name - size optimization</a></div>
    <div class="body">Yeah, I was just joking about . :)<br /><br />On (2): could just use: pushfd/mov , imm8.  I prefer SAHF and not to put value on stack.</div>
    <div class="meta">Posted on 2003-08-28 08:19:29 by bitRAKE</div>
   </div>
   <div class="post" id="post-115957">
    <div class="subject"><a href="#post-115957">reg code to name - size optimization</a></div>
    <div class="body"><div class="quote"><br />Your code is 36 bytes. Mine is &lt; 26<br /></div><br />it's 27 :)<br />so it's 36-27=9 bytes shorter<br />I separate it's to 2 ideas<br />1st saves 5 bytes<br />2nd saves 4 bytes.<br />1st is unacceptable.<br />2nd is well acceptable and flexible.<br /><br />1st is stack frame\exit and setting conditions<br /><pre><code><br />	pop eax	;1 - ret address<br />	popfd	;1 - free stack and set flags<br />	...<br />	jmp eax ;2 - return<br /></code></pre><br /><br />it's in oposite to mine:<br /><pre><code><br />	pop eax		;1<br />	xchg eax,&#91;esp&#93;	;3<br />	...<br />	ret		;1<br /></code></pre><br /><br />your way is 1 byte shorter + it's<br />setting conditions for wich I use<br />2 tests - 4 bytes, altogether it's 5 bytes<br /><br />But it's unacceptable - it doesn't meet conditions<br />on bit flag placement and could lead to trouble in ring0.<br /><br />The second idea is to eliminate need of ecx and rep<br />wich saves 4 bytes.<br /><br />It's good idea and I'm gonna use it. Thanks again.<br /><div class="quote"><br />Looks like I'm dis-qualified<br /></div><br />Oh NO!<br />You've been helpfull.<br /><br />About &quot;compitions&quot; I only could say - there never<br />were compitions - 'cause there were never real<br />good conditions for that.<br />You know, the way it is done in reliable places<br />like Hugi etc.<br />In compitions there need to be judge, format<br />and rules. And of course code can't be seen to<br />others before results is pronounced.<br /><br />Here we can see like most people changing<br />other body codes posted in prior, I could<br />tell (and tried to say it before when saw<br />this way testing when one written by some<br />body proc was with little changes test with<br />now other people names as authors)<br />what we do here mostly look like Team work,<br />collective work etc. It doesn't meet conditions<br />for real fair compition.<br /><br />So to me you not disqaulified also :)<br />You shared ideas, and thank you for that.<br /><br />P.S. If ones really want to compite - some<br />rules should be set, and organization<br />managed.</div>
    <div class="meta">Posted on 2003-08-28 09:42:30 by The Svin</div>
   </div>
   <div class="post" id="post-115971">
    <div class="subject"><a href="#post-115971">reg code to name - size optimization</a></div>
    <div class="body">The second one even much better.<br />I especially like how you handle 32\16 bit<br />case through overwriting</div>
    <div class="meta">Posted on 2003-08-28 11:35:37 by The Svin</div>
   </div>
   <div class="post" id="post-116009">
    <div class="subject"><a href="#post-116009">reg code to name - size optimization</a></div>
    <div class="body">Not big deal, yet another option,<br />you couple intructions:<br /><pre><code><br />	jnc write2<br />	dec edi<br />write2&#58;<br /></code></pre><br />could be replaced by one:<br /><pre><code><br />	sbb edi,0<br /></code></pre><br />No size benefits, just avoiding branch.</div>
    <div class="meta">Posted on 2003-08-28 17:01:27 by The Svin</div>
   </div>
   <div class="post" id="post-116031">
    <div class="subject"><a href="#post-116031">reg code to name - size optimization</a></div>
    <div class="body"><div class="quote"><em>Originally posted by The Svin </em><br />could be replaced by one:<br /><pre><code>	sbb edi,0</code></pre></div>Doh, should have seen this one.  Less instructions the better. :)<br /><br />I like the challenges - we may only improve by testing the limitations of our skills.  There is no one to test my ASM skills here besides me - without communicating on the internet my personal development would not be the same.  Is this part of another tool you are developing?<br /><br />Now I play by original requirements (rules of the game, if you will):<pre><code>OPTION PROLOGUE&#58;NONE<br />OPTION EPILOGUE&#58;NONE<br />rCode2Str proc Flags ;IN EDI=String out,EDX = reg code<br />		 ;Flags bit&#91;0&#93;-bit w,bit&#91;1&#93;-if 66h<br />		 ;OUT EDI = next byte to output string<br />		 ;EAX trashed, All other regs unchaged<br />	pop eax<br />	xchg eax,&#91;esp&#93; ; I like these two, btw ;&#41;<br /><br />	push esi<br />	shr eax,1<br />	lea esi,&#91;edx&#93;&#91;edx*4&#93;&#91;OFFSET regstr&#93;<br />	jnc write2<br />	inc esi<br />	inc esi<br />	movsb<br />	sub edi, eax<br />write2&#58;<br />	movsb<br />	movsb<br />	pop esi<br />	retn<br />regstr BYTE \<br />	'ALEAX','CLECX','DLEDX','BLEBX',\<br />	'AHESP','CHEBP','DHESI','BHEDI'<br />rCode2Str endp<br />OPTION PROLOGUE&#58;PROLOGUEDEF<br />OPTION EPILOGUE&#58;EPILOGUEDEF</code></pre>I am surprised by using only one jump - I thought at the start that this could not be.<br /><br />Did I say &quot;&lt; 26&quot;? :grin:</div>
    <div class="meta">Posted on 2003-08-28 20:56:34 by bitRAKE</div>
   </div>
   <div class="post" id="post-116056">
    <div class="subject"><a href="#post-116056">reg code to name - size optimization</a></div>
    <div class="body">Can you believe it gets better!  I had another one the same size, but this one is branchless!!<pre><code>OPTION PROLOGUE&#58;NONE<br />OPTION EPILOGUE&#58;NONE<br />rCode2Str proc Flags ;IN EDI=String out,EDX = reg code<br />		 ;Flags bit&#91;0&#93;-bit w,bit&#91;1&#93;-if 66h<br />		 ;OUT EDI = next byte to output string<br />		 ;EAX trashed, All other regs unchaged<br />	pop eax<br />	xchg eax,&#91;esp&#93;<br /><br />	push esi<br />	shr eax,1<br />	sbb esi,esi<br />	add eax,esi<br />	add esi,esi ; 0 &#40;w=0&#41; or -2 &#40;w=1&#41;<br />	lea esi,&#91;esi&#93;&#91;edx*4&#93;&#91;OFFSET regstr&#93;&#91;2&#93;<br /><br />	mov BYTE PTR &#91;edi&#93;, &quot;E&quot; ; 01y only ;&#41;<br />	sub edi, eax<br />	movsb<br />	movsb<br />	pop esi<br />	retn<br />regstr BYTE \<br />	'AXAL','CXCL','DXDL','BXBL',\<br />	'SPAH','BPCH','SIDH','DIBH'<br />rCode2Str endp<br />OPTION PROLOGUE&#58;PROLOGUEDEF<br />OPTION EPILOGUE&#58;EPILOGUEDEF</code></pre>You wouldn't do w=0 and prefix?<br /><br />I'm thinking of doing without the table and using a bit array inside a register to generate the characters -- should save a few bytes.  I have almost a dozen versions now.  Even one that only uses EAX - no registers need saving. :)</div>
    <div class="meta">Posted on 2003-08-29 00:40:40 by bitRAKE</div>
   </div>
   <div class="post" id="post-116064">
    <div class="subject"><a href="#post-116064">reg code to name - size optimization</a></div>
    <div class="body"><div class="quote"><br /> Less instructions the better<br /></div><br />Then you can replace two:<br /><pre><code><br /> movsb<br /> movsb<br /></code></pre><br />by one:<br /><pre><code><br /> movsw<br /></code></pre><br />the same size but 1 instruction less.</div>
    <div class="meta">Posted on 2003-08-29 02:27:10 by The Svin</div>
   </div>
   <div class="post" id="post-116075">
    <div class="subject"><a href="#post-116075">reg code to name - size optimization</a></div>
    <div class="body">bitRake,<br />other then bits 0,1 in Flags - undefind!<br />You need mask out them before using eax (and eax,11y)<br /><div class="quote"><br />You wouldn't do w=0 and prefix?<br /></div><br />Here is a rule inside Intel decoder<br />If w = 0 the prefix 66h is ignored in<br />both 16 and 32 bits address mode.<br />So if w = 0 the size of operand is always byte.<br />For us programmers the easy way treat size<br />of operand as three possible values 8,16 and 32.<br />But it is done different way in processor decoder<br />logic.<br />There are 2 major groups:<br /><br />1. Partial regs (always 8bits for both modes)<br />2. Full regs (can be 16 or 32)<br /><br />The second group is devided in two subgroups<br /><br />And they are not 32 and 16 bits subgroups, it's:<br />2.1 Full size (w=1 and no prefix 66h)<br />2.2 Alternative full size (w=1 and prefix 66h)<br />Full size have the same size as current address<br />mode in current code segment (segment! not instruction!<br />so prefix 67h wich is changing current address <br />for current instruction but doesn't do anything about<br />size of operand determination, while changing current CS does)<br /><br />Alternative is the other to current size.<br />In 32bit address mode:<br />Full size = 32<br />Alternative = 16<br />In 16 bit address mode:<br />Full size = 16<br />Alternative = 32<br /><br />So if we represent logically as bits presence of 66h and value of w<br />as w and p then<br />OneModeRules(p,w) = OtherModeRules(not p,w)<br />The same about 67h<br />So it makes possible to write one decoding proc<br />for both addressing modes -<br />For example write one for 32 bit usage and<br />if decoding in 16 bits mode just invert (xor by ones) flags<br />for 67, 66 prefixes before passing them to decoder as parameter.<br /><br />So prefix 66h is matter only if w=1.<br /><br /><div class="quote"><br />I'm thinking of doing without the table and <br />using a bit array inside a register to generate <br />the characters -- should save a few bytes. <br />I have almost a dozen versions now. <br />Even one that only uses EAX - no registers need saving<br /></div><br /><br />You amaze me with speed of ideas generating and implementation :)<br />I feel like my brain is getting old, slow and useless, and<br />I'm far behind :)<br /><br />I thought about do it without table but didn't work out<br />anything less in size then with table.<br />And I think you mean not working without table - just<br />working with some other then full strings table,<br />or you found some arithmetic dependency between codes<br />and characters?<br />I don't see fully line between the arrays as some kind<br />of function in math means.<br />Especialy about middle letters.<br />A,B,C,D but in code A,C,D,B<br />1-&gt;1<br />2-&gt;3<br />3-&gt;4<br />4-&gt;2<br /><br />EBX - EBP have the same middle,<br />the same about ESP,ESI EDX,EDI etc.<br />OK in w1 group we have<br />if code w1=1, pref=0 E**<br /> if code w1=1,pref=0, code &lt; 4 E*X<br /> elseif ......,code (4;5) E*P<br /> .............,code (6,7) E*I<br /><br />I'd better stop right here :)<br />Too many words about nothing.<br />No good idea in my head about it I mean.</div>
    <div class="meta">Posted on 2003-08-29 03:51:40 by The Svin</div>
   </div>
   <div class="post" id="post-116107">
    <div class="subject"><a href="#post-116107">reg code to name - size optimization</a></div>
    <div class="body"><pre><code>rCode2Str proc Flags ;IN EDI=String out,EDX = reg code<br />		 ;Flags bit&#91;0&#93;-bit w,bit&#91;1&#93;-if 66h<br />		 ;OUT EDI = next byte to output string<br />		 ;EAX trashed, All other regs unchaged<br />	pop eax<br />	mov BYTE PTR &#91;edi&#93;, &quot;E&quot; ; 01y only ;&#41;<br /><br />	xchg eax,&#91;esp&#93;<br /><br />	push esi<br />	shl al,7<br /><br />	lea esi,&#91;edx*4&#93;&#91;OFFSET regstr&#93;<br />	jns write2<br /><br />	sbb edi, 0<br />	lodsw<br />	inc edi<br />write2&#58;<br />	movsw<br />	pop esi<br />	retn<br />regstr BYTE \<br />	'ALAX','CLCX','DLDX','BLBX',\<br />	'AHSP','CHBP','DHSI','BHDI'<br />rCode2Str endp ; 30+32</code></pre></div>
    <div class="meta">Posted on 2003-08-29 07:41:21 by bitRAKE</div>
   </div>
   <div class="post" id="post-116111">
    <div class="subject"><a href="#post-116111">reg code to name - size optimization</a></div>
    <div class="body">and eax,011b<br />is needed after<br />xchg ,eax</div>
    <div class="meta">Posted on 2003-08-29 07:48:08 by The Svin</div>
   </div>
   <div class="post" id="post-116116">
    <div class="subject"><a href="#post-116116">reg code to name - size optimization</a></div>
    <div class="body"><div class="quote"><br />and eax,011b<br />is needed after<br />xchg ,eax </div>Sorry, I have changed it after posting.</div>
    <div class="meta">Posted on 2003-08-29 08:16:47 by bitRAKE</div>
   </div>
   <div class="post" id="post-116117">
    <div class="subject"><a href="#post-116117">reg code to name - size optimization</a></div>
    <div class="body">I see.</div>
    <div class="meta">Posted on 2003-08-29 08:21:23 by The Svin</div>
   </div>
   <div class="post" id="post-116293">
    <div class="subject"><a href="#post-116293">reg code to name - size optimization</a></div>
    <div class="body">Studied your last version.<br />Very well done.<br />Might be we try to improve whole mem/r decoder?<br />I'll send here first-draw version.<br />What'd you say?<br />It's works and all logic parts clear.<br />I think it's good material to work with for skill improvement, since it's works with complex data format, of dinamyc sizing.</div>
    <div class="meta">Posted on 2003-08-30 15:23:07 by The Svin</div>
   </div>
   <div class="post" id="post-116297">
    <div class="subject"><a href="#post-116297">reg code to name - size optimization</a></div>
    <div class="body">Greetings <strong>The Svin</strong> and <strong>bitRAKE</strong><br /><br />Here's my attempt at a shorter (by two bytes) solution:<br /><br /><pre><code><br />OPTION PROLOGUE&#58;NONE<br />OPTION EPILOGUE&#58;NONE<br />rCode2Str proc Flags   <br />; IN EDI=String out, EDX = reg code<br />; Flags&#58; PF = 1 if word operand, CF = 1 if 66h  <br />; OUT EDI = next byte to output string<br />; EAX trashed, All other regs unchanged<br /><br />        lea eax,&#91;4*edx&#93;&#91;edx&#93;<br />        lahf	     <br />        and ah, 3 <br />        db 0D5h, 1<br />        push esi<br />        lea esi, &#91;eax&#93;&#91;OFFSET regstr&#93;  <br />        movsb            <br /><br />        pop esi<br />        pop eax	 ; return address<br />        jmp eax<br /><br />regstr  BYTE 'ALEAX','CLECX','DLEDX','BLEBX',\<br />	     'AHESP','CHEBP','DHESI','BHEDI'<br />	     <br />rCode2Str endp<br />OPTION PROLOGUE&#58;PROLOGUEDEF<br />OPTION EPILOGUE&#58;EPILOGUEDEF<br /></code></pre></div>
    <div class="meta">Posted on 2003-08-30 16:40:30 by Poimander</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=14913&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=14913&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="14913" /><input type="number" name="page" min="1" max="5" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=14913&amp;page=2">&gt;</a><a href="../?id=14913&amp;page=5">&raquo;</a></form>  </div>
 </body>
</html>