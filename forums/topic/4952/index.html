<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Final Revison.. - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4952" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=4952">Final Revison..</a></p>
   <div class="post" id="post-34786">
    <div class="subject"><a href="#post-34786">Final Revison..</a></div>
    <div class="body">Ok, the last control got worked over a bit after seeing some NT problems.  This is the final control that i will refer to for the tut's purposes.  I might l8r make a second version that has &quot;hot tracking&quot;, but will then be limited to 98 and above.<br /><br />This version is full OS suported (as far as i've been told).  <br /><br />Read the README.TXT, there has been mild changes from the last version, basicall cleaned up the requirement to specify bitmap size, and a forced limit on the caption to only 28 bytes.<br /><br />Feedback and sugestions still welcome.<br />Here it is. Enjoy.<br />:alright:<br />NaN<br /><br /><strong>EDIT</strong> Attachment removed, see below.</div>
    <div class="meta">Posted on 2002-04-24 01:17:20 by NaN</div>
   </div>
   <div class="post" id="post-34789">
    <div class="subject"><a href="#post-34789">Final Revison..</a></div>
    <div class="body">Still doesn't support &quot;up-state on mouseexit&quot;, which isn't hottracking<br />related and can be done with normal SetCapture :].<br /><br />*whine whine*</div>
    <div class="meta">Posted on 2002-04-24 02:01:12 by f0dder</div>
   </div>
   <div class="post" id="post-34791">
    <div class="subject"><a href="#post-34791">Final Revison..</a></div>
    <div class="body">Fodder, i read the MSDN for 2 hours following our discussion, and I still have no clue how to keep *everything* together without the use of the 98 API.<br /><br />I encourage you to find solution, and will more than happy to credit you for your your efforts.  I did a test with SetCapture, and it doesnt give me events when the mouse button doenst change a state.  I used VKim's debug, and checked the WM_CAPTURECHANGED message (only message the MSDN says it will give up), and i only recieved dubug messages when the mouse button was pressed.  Which doesnt help solve the 'moving off the client rect' problem.<br /><br />Its frustrating to be honest, because I studied normal win95 button and it *can* recognize this.  So there is *something* that will fit the bill, but i can't find the <strong>needle</strong> in this haystack.<br /><br />Please, you give me something tangable, and i will work it in for you :)<br /><br />I will give you a head start, <a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/CommCtls/winui/mousinpt_6jz9.asp">heres all the &quot;mouse info&quot; the MSDN got to share on the topic</a>  . <br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-04-24 02:14:26 by NaN</div>
   </div>
   <div class="post" id="post-34793">
    <div class="subject"><a href="#post-34793">Final Revison..</a></div>
    <div class="body">well, when you have done SetCapture on a window (the foreground<br />window), you ought to receive WM_MOUSEMOVE messages even when<br />the mouse isn't above your control.<br /><br />So, in WM_MOUSEMOVE, check the state of &quot;being_clicked&quot;. If you're<br />currently being clicked, check if the cursor is on or outside the<br />control and update drawstate accordingly (of course only if it has<br />changed...)<br /><br />I think this should work, but please bear over with me if it doesn't,<br />I'm trying to skew my sleeping disorder forward and turn day back into<br />day ;).</div>
    <div class="meta">Posted on 2002-04-24 02:32:37 by f0dder</div>
   </div>
   <div class="post" id="post-34795">
    <div class="subject"><a href="#post-34795">Final Revison..</a></div>
    <div class="body">I feel so dumb that i didnt see that combination. <br /><br />I just did some tests with the debug.inc, and yes i can now track outside the client area!  Thanx for the tip.<br /><br />I will now add the missing piece for you... (the tut will have alot of do's and dont's and why's to learn from at this point).<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-04-24 02:53:26 by NaN</div>
   </div>
   <div class="post" id="post-34803">
    <div class="subject"><a href="#post-34803">Final Revison..</a></div>
    <div class="body">The above Download was nulled, as (thanx to f0dder's help), i now have it *exactly* like another button.<br /><br />As well, since i was *still* pumping revisions into it, i provided a catch for when there is an image, but no text.  In this case the image is directly centered into the button.<br /><br />Here it is.  It should be bug free, but please check it out. <br />Please let me know if there is no problems, so i will begin my tutorial on it.  It seems every time I draw the line, something comes up :)<br /><br />Anywho, my oppologies for the numberous 'final' products.  I can say that the MASM32 dir never changed if its any consolation :) , however, the other two dirs did.<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-04-24 04:08:52 by NaN</div>
   </div>
   <div class="post" id="post-34804">
    <div class="subject"><a href="#post-34804">Final Revison..</a></div>
    <div class="body">Thanks NaN<br /><br />Works great on my xp box.<br />BTW, I guess you know everyting about SetCapture now. Is there a way to set capture to non client area? I have a little problem with my menu emulator in RadASM.<br /><br />KetilO</div>
    <div class="meta">Posted on 2002-04-24 04:40:33 by KetilO</div>
   </div>
   <div class="post" id="post-34805">
    <div class="subject"><a href="#post-34805">Final Revison..</a></div>
    <div class="body">SetCapture will redirect all mouse-input to your <br />window-quene, it doesn't matter if the Mouse <br />curser is within your client-rect or not... but as<br />far i know only ONE application can capture the<br />mouse, if your app is loosing the capture you'll<br />get a WM_CAPTURECHANGED message... what<br />is your problem excatly about? i had never <br />problems with mouse-cap so...<br /><br /><br />according to the api-ref there are a couple of<br />limitations so if you really want to get ALL mouse<br />input (coordinates, clicks, ...) you should use<br />hooks instead...</div>
    <div class="meta">Posted on 2002-04-24 04:48:44 by mob</div>
   </div>
   <div class="post" id="post-34809">
    <div class="subject"><a href="#post-34809">Final Revison..</a></div>
    <div class="body">Hi mob<br /><br />Instead of poluting NaN's thread I will start my own.<br /><br />KetilO</div>
    <div class="meta">Posted on 2002-04-24 06:01:23 by KetilO</div>
   </div>
   <div class="post" id="post-34836">
    <div class="subject"><a href="#post-34836">Final Revison..</a></div>
    <div class="body">Heheh, there's *ONE* thing left that I can think of... when a button<br />is disabled, the menu dropdown is still non-disabled color :).</div>
    <div class="meta">Posted on 2002-04-24 09:21:04 by f0dder</div>
   </div>
   <div class="post" id="post-34874">
    <div class="subject"><a href="#post-34874">Final Revison..</a></div>
    <div class="body">:alright: Very nice control NaN! I'm sure people can use it.<br />Works fine on my win2k machine, I'll try later on some other machines.<br /><br />Thomas</div>
    <div class="meta">Posted on 2002-04-24 13:09:58 by Thomas</div>
   </div>
   <div class="post" id="post-34882">
    <div class="subject"><a href="#post-34882">Final Revison..</a></div>
    <div class="body">Great to hear it...<br /><br />I will get going on the tut, while its still fresh in my head.  <br /><br /><strong>f0dder</strong>, :grin: you found my dirty secret.  I found that too, but i decided it wasnt worth packing an extra DWORD's into the heap structure (as i would need to create pens, store them, and back up the DC's frist pen).  All just so 9 pixels can be greyed when disabled.<br /><br />And until now only you noticed it (which is no surprise ) :grin: .<br />( I will leave it for an excercise in the tut ) .<br /><br /><br /><strong>Thanx everyone else</strong>, glad it works well on your machines.  I will probabaly start more 'complicated' controlls in the future.  Custom edit is something i always wanted (I <em>H*a*t*e</em> using rich edit), but this will be a *very* big job to undertake.<br /><br />Oh, one last question, I originally was going to focus on 'makeing' a control, but Mob sounds interested in GDI stuff.  Do you all want some 'detailled' talk on GDI first?  To be honest, i didnt use a whole lot of GDI work (only one brush and backbuffer was created ~ to save memory).  But i can talk a bit more global if there are takers?<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-04-24 14:48:53 by NaN</div>
   </div>
   <div class="post" id="post-34901">
    <div class="subject"><a href="#post-34901">Final Revison..</a></div>
    <div class="body">I would just <em>brush</em> over the GDI for this one, and focus more on the messaging, design and structure of an owner drawn control.  Try to eliminate all the abiguities that you came across in existing documentation.  Your other tuts are great - can't wait to read this one.</div>
    <div class="meta">Posted on 2002-04-24 16:35:14 by bitRAKE</div>
   </div>
   <div class="post" id="post-34908">
    <div class="subject"><a href="#post-34908">Final Revison..</a></div>
    <div class="body">mh i wouldn't skip the gdi part... i mean gdi is the basis.<br />sure custom controls are cool and all that stuff but i think<br />it's more something you code for yourself... i definitively<br />would NOT use a control coded by someone else. and<br />yes, you could exemplify the basics of creating a custom<br />control and without question, it would be very good<br />but i think it would be useless for gdi-newbies... i for<br />myself wanted to learn all this stuff a while ago but i<br />realized that there's *nothing* except a load of sources.<br />a full-lenght gdi tut would be a enrichment for every<br />asm-programmer who want to get behind this stuff<br />without stumbling through million lines of uncommented <br />code.<br /><br />BTW: i saw very interesting programs written by E?in,<br />thomas, testdepartment and many many more, if you<br />just add the elementary things of those applications<br />plus a little introduction (what's a dc/...) you already <br />have the gdi part in your hands.</div>
    <div class="meta">Posted on 2002-04-24 17:15:16 by mob</div>
   </div>
   <div class="post" id="post-34929">
    <div class="subject"><a href="#post-34929">Final Revison..</a></div>
    <div class="body"><strong>NaN</strong>, another feature might be to allow the user to close the menu by clicking again on the arrow - like the Back button in IE.</div>
    <div class="meta">Posted on 2002-04-24 18:46:20 by bitRAKE</div>
   </div>
   <div class="post" id="post-34957">
    <div class="subject"><a href="#post-34957">Final Revison..</a></div>
    <div class="body">Well im about 1/3 done.  Im getting a we bit tired of word processing so im putting it down for today :)<br /><br />One of the reasons i wanted to write it up as a tutorial is so i can find a reason to learn how to make the .chm's.  Took me half the afternoon to get it going right, but its looking pretty good now.<br /><br />Its starting to look like it wont be geared towards GDI, but more towards the design, and related practices. <br /><br />However, i might make an 'appendix' topic on GDI and the various 'standard' aspects that relates to it like pens/brushes/DC's etc.<br /><br /><br /><strong>BitRake</strong>, thanx for the suggestion but I dont think i will implement it as it will add another degree of complexity in the mouse capturing.  The fact it does this is because the up-click that presents the menu, also resets the capture.  So clicking off the menu kills the menu (as it is designed) and at the same time starts another 'event' from the start.<br /><br />The only solution i can think of is having the menu no longer send back to the parent, but to the control, where it then forwards back to the parent.   By seing menu events (or the lack of an event) with state information and capture events, you can determine if the user clicked off the menu and back on the button.  In this case just do nothing as you want.<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-04-25 02:52:40 by NaN</div>
   </div>
  </div>
 </body>
</html>