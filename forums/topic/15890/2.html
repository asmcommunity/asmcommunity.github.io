<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>RadASM 2.0.3.6 released (11-01-2003) - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=15890" />
  <link rel="prev" href="../?id=15890&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=42">RadASM</a> &raquo; <a href="../?id=15890">RadASM 2.0.3.6 released (11-01-2003)</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=15890&amp;page=1" style="">&laquo;</a><a href="../?id=15890&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="15890" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-123976">
    <div class="subject"><a href="#post-123976">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">already no.</div>
    <div class="meta">Posted on 2003-11-10 16:59:21 by cakmak</div>
   </div>
   <div class="post" id="post-123982">
    <div class="subject"><a href="#post-123982">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">1. Another one:<br /><br />I removed all addins(added comment to all in  section) and tried again. And i get another crash.<br /><div class="quote"><br />RADASM  caused an invalid page fault in<br />module &lt;unknown&gt; at 0084:83776138.<br />Registers:<br />EAX=006cfc10 CS=015f EIP=83776138 EFLGS=00010282<br />EBX=000006f8 SS=0167 ESP=006cfbf4 EBP=006cfc20<br />ECX=cea062e0 DS=0167 ESI=005a0ee8 FS=4687<br />EDX=0001dce4 ES=0167 EDI=00000000 GS=0000<br />Bytes at  CS:EIP:<br /><br />Stack dump:<br />bfb88390 006cfc10 bfb897df 006cfc10 00000200 <br />00000000 005a0ee8 00000010 00000002 000006f8<br />0001dce4 006cfc8c bfb7389a 00000000 000006f8<br />00000200 <br /></div><br />but lately i noticed, this is becomes while mouse is coming over toolbar, with or w/o any project.<br /><br />Also i tested with addins too. I guess about last version.<br /><br />2. Docking Project:<br /><br />Intersting but if i remove &quot;tools.asm&quot; from project everything is alright. Nothing crashing. Except above situation. But this is not about any line in file. Because later i commented all file but nothing changed.<br /><br />- not about content<br /><br />- not about name (tried this)<br /><br />my guess only huge. Only ~40KB.<br /><br />...and yes i tested a little. &quot;33875 bytes&quot; ok but  &quot;33889 bytes&quot; is crashing.</div>
    <div class="meta">Posted on 2003-11-10 18:55:08 by cakmak</div>
   </div>
   <div class="post" id="post-123999">
    <div class="subject"><a href="#post-123999">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Hi cakmak<br /><br />Will you try this version of RAEdit?<br />Another request. Could you install OllyDbg as a JIT debugger? Then you will get more info if something goes wrong.<br /><br />KetilO</div>
    <div class="meta">Posted on 2003-11-11 01:09:31 by KetilO</div>
   </div>
   <div class="post" id="post-124009">
    <div class="subject"><a href="#post-124009">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Hi KetilO,<br />I have some of feature requests :)<br />1. For the project's treeview:<br /> key to select an item and<br /> to go up one level<br /><br />And keyboard shortcuts to access output, properties and project windows (maybe there are already, but I haven't found yet).<br /><br />This is to avoid using the mouse unnecessarily.<br /><br />Thanks for your excellent program :alright:</div>
    <div class="meta">Posted on 2003-11-11 04:03:02 by pelaillo</div>
   </div>
   <div class="post" id="post-124010">
    <div class="subject"><a href="#post-124010">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">KetilO,<br /><br />Sorry about &quot;mouse over toolbar&quot;. It is not a problem now, really confused.<br /><br />PS. i will test.</div>
    <div class="meta">Posted on 2003-11-11 04:17:33 by cakmak</div>
   </div>
   <div class="post" id="post-124013">
    <div class="subject"><a href="#post-124013">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Hi pelaillo<br /><br />Good idea. I will implement it.<br /><br />KetilO</div>
    <div class="meta">Posted on 2003-11-11 05:25:32 by KetilO</div>
   </div>
   <div class="post" id="post-124077">
    <div class="subject"><a href="#post-124077">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Hard to debug with olly. I can not step while crash because that proc is always in a loop and can not switch to radasm for trying crash. In first loop in proc, crashing is occur.<br /><br /><pre><code>1000164B   8B5D 08          MOV EBX,DWORD PTR SS&#58;&#91;EBP+8&#93;<br />1000164E   8BB3 AC000000    MOV ESI,DWORD PTR DS&#58;&#91;EBX+AC&#93;<br />10001654   8BBB BC000000    MOV EDI,DWORD PTR DS&#58;&#91;EBX+BC&#93;<br />1000165A   8B45 0C          MOV EAX,DWORD PTR SS&#58;&#91;EBP+C&#93;<br />1000165D   3B43 6C          CMP EAX,DWORD PTR DS&#58;&#91;EBX+6C&#93;<br />10001660   72 33            JB SHORT RAEDIT.10001695<br />10001662   8B43 6C          MOV EAX,DWORD PTR DS&#58;&#91;EBX+6C&#93;<br />10001665   8B4B 68          MOV ECX,DWORD PTR DS&#58;&#91;EBX+68&#93;<br />10001668   EB 07            JMP SHORT RAEDIT.10001671<br />1000166A   8B148E           MOV EDX,DWORD PTR DS&#58;&#91;ESI+ECX*4&#93;               ; &lt;- first loop <br />1000166D   03043A           ADD EAX,DWORD PTR DS&#58;&#91;EDX+EDI&#93;     ; &lt;- Crashing here!<br />10001670   41               INC ECX<br />10001671   3B45 0C          CMP EAX,DWORD PTR SS&#58;&#91;EBP+C&#93;<br />10001674  ^72 F4            JB SHORT RAEDIT.1000166A      ; &lt;- jmp above<br />10001676   3B45 0C          CMP EAX,DWORD PTR SS&#58;&#91;EBP+C&#93;<br />10001679   76 01            JBE SHORT RAEDIT.1000167C<br />1000167B   49               DEC ECX<br />1000167C   8BC1             MOV EAX,ECX<br />1000167E   C1E0 02          SHL EAX,2<br />10001681   3B83 B8000000    CMP EAX,DWORD PTR DS&#58;&#91;EBX+B8&#93;<br />10001687   72 20            JB SHORT RAEDIT.100016A9<br />10001689   8B8B B8000000    MOV ECX,DWORD PTR DS&#58;&#91;EBX+B8&#93;<br />1000168F   C1E9 02          SHR ECX,2<br />10001692   49               DEC ECX<br />10001693   EB 14            JMP SHORT RAEDIT.100016A9<br /> </code></pre><br />In loop, 2. parameter is comparing with eax.<br /><br /><br />while normal running, after loop finished<br /><br />either,<br />       eax = 100b<br />       ecx = A04<br />or,<br />       eax = 0<br />       ecx = 0<br /><br />but here in loop,<br /><br />       eax = 3ac2d<br />       ecx = 1000<br /><br />in<br />       1000166D   03043A           ADD EAX,DWORD PTR DS:<br /><br />line trying to add nothing in eax. That address only includes &quot;??????&quot;. Sorry but i can not commenting this situation, i do not know what for this proc and variables. And can not stepping before crash.<br /><br />If may give more specific info i can notice that.</div>
    <div class="meta">Posted on 2003-11-11 15:38:45 by cakmak</div>
   </div>
   <div class="post" id="post-124087">
    <div class="subject"><a href="#post-124087">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Hi cakmak<br /><br />Thanks for your help.<br />I'm pretty shure I found the bug.<br /><br />Will you try this version of RAEdit.dll?<br /><br />KetilO<br /><br />Edit: Attacment deleted</div>
    <div class="meta">Posted on 2003-11-11 17:27:59 by KetilO</div>
   </div>
   <div class="post" id="post-124095">
    <div class="subject"><a href="#post-124095">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Congratulations :alright:</div>
    <div class="meta">Posted on 2003-11-11 20:45:40 by cakmak</div>
   </div>
   <div class="post" id="post-124098">
    <div class="subject"><a href="#post-124098">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body"><strong>KetilO</strong>, I was looking over your code and maybe I found the source of a painting problem on NT based systems - <strong>Ranma_at</strong>'s image above for example.<pre><code>MakeBitmap proc<br />	LOCAL	hDC&#58;HDC<br />	LOCAL	bicx&#58;DWORD<br />	LOCAL	bicy&#58;DWORD<br />	LOCAL	hBit&#58;DWORD<br />	LOCAL	bi&#58;BITMAPINFO<br />	LOCAL	pBits&#58;DWORD<br />	LOCAL	nCol&#58;DWORD<br /><br />	invoke CreateCompatibleDC,NULL<br />	mov		hDC,eax<br />	mov		eax,Gridcx<br />	mov		bicx,eax<br />	.while bicx&lt;8<br />		add		bicx,eax<br />	.endw<br />	mov		eax,Gridcy<br />	mov		bicy,eax<br />	.while bicy&lt;8<br />		add		bicy,eax<br />	.endw<br />	mov		bi.bmiHeader.biSize,sizeof BITMAPINFOHEADER<br />	push	bicx<br />	pop		bi.bmiHeader.biWidth<br />	push	bicy<br />	pop		bi.bmiHeader.biHeight<br />	mov		bi.bmiHeader.biPlanes,1<br />	mov		bi.bmiHeader.biBitCount,32<br />	mov		bi.bmiHeader.biCompression,BI_RGB	<br />	mov		bi.bmiHeader.biXPelsPerMeter,0<br />	mov		bi.bmiHeader.biYPelsPerMeter,0<br />	mov		bi.bmiHeader.biClrUsed,0<br />	mov		bi.bmiHeader.biClrImportant,0<br />	mov		bi.bmiColors.rgbBlue,0<br />	mov		bi.bmiColors.rgbGreen,0<br />	mov		bi.bmiColors.rgbRed,0<br />	mov		bi.bmiColors.rgbReserved,0<br />	invoke CreateDIBSection,hDC,addr bi,DIB_RGB_COLORS,addr pBits,0,0<br />	mov		hBit,eax<br />	invoke GetSysColor,COLOR_BTNFACE<br />	mov		edx,eax<br />	shr		edx,16<br />	xchg	al,ah<br />	shl		eax,8<br />	and		eax,0FFFF00h<br />	or		eax,edx<br />	mov		nCol,eax<br />	mov		eax,bicx<br />	mov		ecx,bicy<br />	mul		ecx<br />	mov		ecx,eax<br />	push	edi<br />	mov		edi,pBits<br />	mov		eax,nCol<br />	rep stosd<br />	mov		eax,bicx<br />	shl		eax,2<br />	sub		edi,eax<br />	.while edi&gt;pBits<br />		push	eax<br />		call	Ln<br />		pop		eax<br />		mov		ecx,Gridcy<br />		.while ecx<br />			sub		edi,eax<br />			dec		ecx<br />		.endw<br />	.endw<br />	invoke DeleteDC,hDC<br />	pop		edi<br />	mov		eax,hBit<br />	ret<br /><br />  Ln&#58;<br />	mov		eax,bicx<br />	shl		eax,2<br />	mov		ecx,Gridcx<br />	shl		ecx,2<br />	push	edi<br />	.while eax<br />		mov		dword ptr &#91;edi&#93;,0<br />		add		edi,ecx<br />		sub		eax,ecx<br />	.endw<br />	pop		edi<br />	retn<br /><br />MakeBitmap endp<br /><br />CreateGridBrush proc<br /><br />	mov		eax,hGridBr<br />	.if eax<br />		invoke DeleteObject,eax<br />	.endif<br />	invoke MakeBitmap<br />	push	eax<br />	invoke CreatePatternBrush,eax<br />	mov		hGridBr,eax<br />	pop		eax<br />	invoke DeleteObject,eax<br />	ret<br /><br />CreateGridBrush endp</code></pre>Notice how MakeBitmap returns a handle to the bitmap, but the BITMAPINFO is lost because it was on the LOCAL stack of MakeBitmap.  The API states this structure must be constant for the life of the bitmap. Something that isn't clear to me: does the bitmap have to remain as long as the pattern is in use?  The API says deleting the pattern brush does not delete the bitmap, but it does not explicitly state the pattern bruch does not use the bitmap.<br /><br />Thank you for very easy to read code.</div>
    <div class="meta">Posted on 2003-11-11 21:52:49 by bitRAKE</div>
   </div>
   <div class="post" id="post-124101">
    <div class="subject"><a href="#post-124101">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">You can use a file mapping object to specify your DIB buffer, however if you put NULL in the last two parameters (file mapping object) Windows will allocate the memory for you. If you do not specify pDIBits you can get the offset to the bits as follows:<br /><br /><pre><code>invoke CreateDIBSection,hDC,addr bi,DIB_RGB_COLORS,0,0,0<br />mov hBmp,eax<br />invoke GetObject,hBmp,SIZEOF DIBSECTION,ADDR sbmp<br />mov eax,sbmp.dsBm.bmBits<br /><br />mov pDIBits,eax</code></pre><br /><br />In the case that you are refering to Bitrake, the file mapping object must exist during the life of the bitmap, The code above does not use file mapping. However in the case of NT4 I have found the value returned in pDIBits to be unreliable and prefer to use the GetObject method.<br /><br />Toolbar Paint creates all of it's bitmaps using the following routine without exception (all bitmaps in TBPaint are 32 bit DIB sections):<br /><br /><pre><code>CreateIndependantBitmap proc hDC&#58;DWORD,SizeX&#58;DWORD,SizeY&#58;DWORD<br />	LOCAL bmi			&#58;BITMAPINFO<br /><br />	mov bmi.bmiHeader.biSize,SIZEOF BITMAPINFOHEADER<br />	mov eax,SizeX<br />	mov bmi.bmiHeader.biWidth,eax<br />	mov eax,SizeY<br />	mov bmi.bmiHeader.biHeight,eax<br />	mov bmi.bmiHeader.biPlanes,1<br />	mov bmi.bmiHeader.biBitCount,32<br />	mov bmi.bmiHeader.biCompression,BI_RGB<br />	mov eax,SizeY<br />	mul SizeX<br />	shl eax,2<br />	mov bmi.bmiHeader.biSizeImage,eax<br />	invoke CreateDIBSection,hDC,ADDR bmi,DIB_RGB_COLORS,ADDR NULL,NULL,NULL<br />	push eax<br />	invoke GdiFlush<br />	pop eax<br /><br />	ret<br /><br />CreateIndependantBitmap endp</code></pre></div>
    <div class="meta">Posted on 2003-11-11 22:43:49 by donkey</div>
   </div>
   <div class="post" id="post-124108">
    <div class="subject"><a href="#post-124108">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Hi BitRake,<br /><br />the reason why the GetOBject method is more reliable is that it cause the GDI to flush. For all NT based systems drawing to a newly created DIB Bitmap must be synchronized by performing a GdiFlush first. By using GetObject to obtain the address to the bits it will flush the GDI command buffer. You will always experience sporatic problems writing to a DIB in NT/2K/XP if you do not flush the GDI before doing direct to bit operations.</div>
    <div class="meta">Posted on 2003-11-11 23:27:30 by donkey</div>
   </div>
   <div class="post" id="post-124110">
    <div class="subject"><a href="#post-124110">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body"><strong>donkey</strong>, you edited your post and now I look like an ass. :grin: I see the GDIFlush now - thanks for clarifying.  Do you know if the PatternBrush needs the bitmap, or can we delete the bitmap after the PatternBrush is created?</div>
    <div class="meta">Posted on 2003-11-11 23:46:27 by bitRAKE</div>
   </div>
   <div class="post" id="post-124111">
    <div class="subject"><a href="#post-124111">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Hi BitRake,<br /><br />Actually, I don't do it in that routine in TBPaint, I flush before drawing each time, I forgot to put it in originally so I added it afterwards. I didn't think that anyone had replied to it yet as I guess you were typing at the same time as I did, the edit and your post have the exact same times. I am very sorry. And BTW you can never look like an ass, you are easily one of the best coders on this board.<br /><br />I don't use pattern brushes prefering to paint myself but I think they have to have the bitmap for the life of the brush, can't be sure though the doc is not very clear.</div>
    <div class="meta">Posted on 2003-11-11 23:54:37 by donkey</div>
   </div>
   <div class="post" id="post-124114">
    <div class="subject"><a href="#post-124114">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body"><div class="quote"><br />I am very sorry. And BTW you can never look like an ass, you are easily one of the best coders on this board.</div>I meant that in a playful way. :)</div>
    <div class="meta">Posted on 2003-11-12 00:13:46 by bitRAKE</div>
   </div>
   <div class="post" id="post-124129">
    <div class="subject"><a href="#post-124129">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Hi bitRAKE<br /><br />Thanks for optimizing the code. A few adjustments was needed to make it compatible with old routine.<br /><br /><pre><code>.data<br /><br />bmiMakeBitmap		BITMAPINFO &lt;&lt;SIZEOF BITMAPINFOHEADER,,,1,32,BI_RGB&gt;,&gt;<br /><br />.code<br /><br />CreateGridBrush proc<br />	LOCAL	hDC&#58;HDC<br />	LOCAL	hBit&#58;DWORD<br />	LOCAL	pBits&#58;DWORD<br /><br />	mov		eax,hGridBr<br />	.if eax<br />		invoke DeleteObject,eax<br />	.endif<br />	invoke CreateCompatibleDC,NULL<br />	mov		hDC,eax<br />	mov		eax,Gridcx<br />	mov		ecx,eax<br />	.while ecx&lt;8<br />		add		ecx,eax<br />	.endw<br />	mov		eax,Gridcy<br />	mov		edx,eax<br />	.while edx&lt;8<br />		add		edx,eax<br />	.endw<br />	mov		bmiMakeBitmap.bmiHeader.biWidth,ecx<br />	mov		bmiMakeBitmap.bmiHeader.biHeight,edx<br />	invoke CreateDIBSection,hDC,addr bmiMakeBitmap,DIB_RGB_COLORS,addr pBits,0,0<br />	mov		hBit,eax<br />	invoke GdiFlush<br />	invoke GetSysColor,COLOR_BTNFACE<br />	xchg	al,ah	;ABDC<br />	ror		eax,16	;DCAB<br />	xchg	al,ah	;DCBA<br />	ror		eax,8	;ADCB<br />	mov		ecx,bmiMakeBitmap.bmiHeader.biWidth<br />	mov		edx,bmiMakeBitmap.bmiHeader.biHeight<br />	imul	ecx,edx						; total pixel count<br />	push	edi<br />	mov		edi,pBits<br />	shl		edx,2						; bytes per line<br />	rep stosd							; fill bitmap with COLOR_BTNFACE<br />	mov		ecx,Gridcy<br />	sub		edi,edx						; start on last line<br />	imul	ecx,edx<br />	shr		edx,2						; pixels per line<br />	.while edi&gt;pBits<br />		mov		eax,edx<br />	@@&#58;	sub		eax,Gridcx				; next horizontal dot in grid<br />		mov		dword ptr &#91;edi+eax*4&#93;,0	; black pixel for grid dot<br />		jne		@b<br />		sub		edi,ecx<br />	.endw<br />	invoke DeleteDC,hDC<br />	mov		edi,hBit<br />	invoke CreatePatternBrush,edi<br />	mov		hGridBr,eax<br />	invoke DeleteObject,edi<br />	pop		edi<br />	ret<br /><br />CreateGridBrush endp<br /><br /></code></pre> <br />KetilO</div>
    <div class="meta">Posted on 2003-11-12 04:04:30 by KetilO</div>
   </div>
   <div class="post" id="post-124136">
    <div class="subject"><a href="#post-124136">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Just a question for you Kjetil (a bit away from the topic but though): Can you edit RaEdit to trim (delete) spaces and tabs at the end of the lines when the WM_GETTEXT (or what message is used...?) message is sent? This will reduce the space when saving... For instance:<br />&quot;   mov eax,5   &quot; =&gt; &quot;   mov eax,5&quot;<br />and<br />&quot;   &quot; =&gt; &quot;&quot;<br />You see what I mean?<br /><br />Thanks!<br /><br />Regards,<br />Tommy</div>
    <div class="meta">Posted on 2003-11-12 05:12:33 by Tommy</div>
   </div>
   <div class="post" id="post-124144">
    <div class="subject"><a href="#post-124144">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Hi Tommy<br /><br />REM_TRIMSPACE message does that. Just loop through the text before using WM_GETTEXT or streaming the text out.<br /><br />KetilO</div>
    <div class="meta">Posted on 2003-11-12 06:26:02 by KetilO</div>
   </div>
   <div class="post" id="post-124166">
    <div class="subject"><a href="#post-124166">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Ok, thanks... but I thought if you could add an option to do that in RadAsm (if it's not already exists)?</div>
    <div class="meta">Posted on 2003-11-12 08:52:08 by Tommy</div>
   </div>
   <div class="post" id="post-124299">
    <div class="subject"><a href="#post-124299">RadASM 2.0.3.6 released (11-01-2003)</a></div>
    <div class="body">Just a small thing, &quot;Show proc in statusbar&quot; option is not working for fasm and the other assemblers if procedure is not finishing with the procedure name first at least.<br /><br />Proc maybe<br /><br />endp<br />;;<br />proc somebody<br /><br />return<br />;;<br />proc solved<br /><br />endp solved<br />;;<br />is working for first &quot;proc&quot; in entire file scope.</div>
    <div class="meta">Posted on 2003-11-13 20:29:30 by cakmak</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=15890&amp;page=1" style="">&laquo;</a><a href="../?id=15890&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="15890" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>