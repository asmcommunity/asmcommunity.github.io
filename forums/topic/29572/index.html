<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>WMI string arrays - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29572" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29572">WMI string arrays</a></p>
   <div class="post" id="post-208828">
    <div class="subject"><a href="#post-208828">WMI string arrays</a></div>
    <div class="body">Hi,<br />I am trying to get BiosVersion by using WMI. I have found example code at http://www.masm32.com/board/index.php?topic=6550.msg48779#msg48779 However because returned value is string array I can&#039;t print it easily. I don&#039;t want to write workaround code. So I am wondering what is the structure of string array? After I run my code I get below buffer at ecx register.<br /><pre><code><br />00233070&nbsp; 01 00 80 01 04 00 00 00 00 00 00 00 38 69 22 00&nbsp; .€.......8i&quot;.<br />00233080&nbsp; 01 00 00 00 00 00 00 00 AB AB AB AB AB AB AB AB&nbsp; .......««««««««<br />00233090&nbsp; 00 00 00 00 00 00 00 00 C0 5D DA 33 F3 2C 00 18&nbsp; ........À]Ú3ó,.<br />002330A0&nbsp; 14 00 00 00 48 00 50 00 51 00 4F 00 45 00 4D 00&nbsp; ...H.P.Q.O.E.M.<br />002330B0&nbsp; 20 00 2D 00 20 00 31 00 00 00 AD BA 0D F0 AD BA&nbsp;  .-. .1...­º.ð­º<br />002330C0&nbsp; AB AB AB AB AB AB AB AB 00 00 00 00 00 00 00 00&nbsp; ««««««««........<br />002330D0&nbsp; 25 58 D9 D0 FC 2C 00 00 C4 00 21 00 30 2D 23 00&nbsp; %XÙÐü,..Ä.!.0-#.</code></pre><br /><br />Here is the code I use.<br /><pre><code>.586<br />.MODEL FLAT,STDCALL<br />OPTION CASEMAP:NONE<br /><br />INCLUDE \masm32\include\windows.inc<br />INCLUDE \masm32\include\kernel32.inc<br />INCLUDE \masm32\include\ole32.inc<br />INCLUDE \masm32\include\msvcrt.inc<br />;INCLUDE \masm32\include\gel32.inc<br /><br />INCLUDELIB \masm32\lib\kernel32.lib<br />INCLUDELIB \masm32\lib\ole32.lib<br />INCLUDELIB \masm32\lib\msvcrt.lib<br />;INCLUDELIB \masm32\lib\gel32.lib<br /><br />INCLUDE c:\masm32\macros\ucmacros.asm<br /><br />; located in ObjIdl.h<br /><br />EOAC_NONE&nbsp;  EQU 0<br /><br />; located in RpcDce.h<br /><br />RPC_C_AUTHN_LEVEL_DEFAULT&nbsp;  EQU 0<br />RPC_C_IMP_LEVEL_DEFAULT&nbsp; &nbsp;  EQU 0<br /><br />RPC_C_IMP_LEVEL_IMPERSONATE EQU 3<br /><br />GUID2 STRUC<br />&nbsp; &nbsp;  dd1 DWORD ?<br />&nbsp; &nbsp;  dw1 WORD ?<br />&nbsp; &nbsp;  dw2 WORD ?<br />&nbsp; &nbsp;  db1 BYTE ?<br />&nbsp; &nbsp;  db2 BYTE ?<br />&nbsp; &nbsp;  db3 BYTE ?<br />&nbsp; &nbsp;  db4 BYTE ?<br />&nbsp; &nbsp;  db5 BYTE ?<br />&nbsp; &nbsp;  db6 BYTE ?<br />&nbsp; &nbsp;  db7 BYTE ?<br />&nbsp; &nbsp;  db8 BYTE ?<br />GUID2 ENDS<br /><br />IWbemLocator STRUCT<br />&nbsp; &nbsp; lpVtbl DWORD&nbsp;  ?<br />IWbemLocator ENDS<br /><br />IWbemLocatorVtbl STRUCT<br />&nbsp; &nbsp; QueryInterface DWORD&nbsp;  ?<br />&nbsp; &nbsp; AddRef&nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; Release&nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; ConnectServer&nbsp; DWORD&nbsp;  ?<br />IWbemLocatorVtbl ENDS<br /><br />IWbemServices STRUCT<br />&nbsp; &nbsp; lpVtbl DWORD&nbsp;  ?<br />IWbemServices ENDS<br /><br />IWbemServicesVtbl STRUCT<br />&nbsp; &nbsp; QueryInterface&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; AddRef&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; Release&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; OpenNamespace&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; CancelAsyncCall&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; QueryObjectSink&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetObject&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetObjectAsync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; PutClass&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; PutClassAsync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; DeleteClass&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; DeleteClassAsync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; CreateClassEnum&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; CreateClassEnumAsync&nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; PutInstance&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; PutInstanceAsync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; DeleteInstance&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; DeleteInstanceAsync&nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; CreateInstanceEnum&nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; CreateInstanceEnumAsync&nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; ExecQuery&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; ExecQueryAsync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; ExecNotificationQuery&nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; ExecNotificationQueryAsync DWORD&nbsp;  ?<br />&nbsp; &nbsp; ExecMethod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; ExecMethodAsync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />IWbemServicesVtbl ENDS<br /><br />IEnumWbemClassObject STRUCT<br />&nbsp; &nbsp; lpVtbl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />IEnumWbemClassObject ENDS<br /><br />IEnumWbemClassObjectVtbl STRUCT<br />&nbsp; &nbsp; QueryInterface DWORD&nbsp;  ?<br />&nbsp; &nbsp; AddRef&nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; Release&nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; Reset&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; Next&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; NextAsync&nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; Clone&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; Skip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />IEnumWbemClassObjectVtbl ENDS<br /><br />IWbemClassObject STRUCT<br />&nbsp; &nbsp; lpVtbl DWORD&nbsp;  ?<br />IWbemClassObject ENDS<br /><br />IWbemClassObjectVtbl STRUCT<br />&nbsp; &nbsp; QueryInterface&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; AddRef&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; Release&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetQualifierSet&nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; Get&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; Put&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; Delete&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetNames&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; BeginEnumeration&nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; Next&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; EndEnumeration&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetPropertyQualifierSet DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetObjectText&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; SpawnDerivedClass&nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; SpawnInstance&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; CompareTo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetPropertyOrigin&nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; InheritsFrom&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetMethod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; PutMethod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; DeleteMethod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; BeginMethodEnumeration&nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; NextMethod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; EndMethodEnumeration&nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetMethodQualifierSet&nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetMethodOrigin&nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />IWbemClassObjectVtbl ENDS<br /><br />.CONST<br />&nbsp;  <br />&nbsp; &nbsp; wszSelect&nbsp; WORD &quot;S&quot;,&quot;E&quot;,&quot;L&quot;,&quot;E&quot;,&quot;C&quot;,&quot;T&quot;,&quot; &quot;,&quot;*&quot;,&quot; &quot;,&quot;F&quot;,&quot;R&quot;,&quot;O&quot;,&quot;M&quot;,&quot; &quot;,0&nbsp; ; the WSTR macro can&#039;t handle the asterisk<br />&nbsp; &nbsp; wszCrLf&nbsp; &nbsp; WORD 13,10,0<br />&nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; WSTR&nbsp; &nbsp; &nbsp; &nbsp; wszClass,&nbsp; &nbsp; &quot;Win32_BIOS&quot;&nbsp; &nbsp; ;&lt;&lt;&lt; Set class here<br />&nbsp; &nbsp; WSTR&nbsp; &nbsp; &nbsp; &nbsp; wszProperty, &quot;BIOSVersion&quot;&nbsp; ;&lt;&lt;&lt; Set property here<br />&nbsp;  <br />&nbsp; &nbsp; WSTR&nbsp; &nbsp; &nbsp; &nbsp; wszNameSpace, &quot;root\cimv2&quot;<br />&nbsp; &nbsp; WSTR&nbsp; &nbsp; &nbsp; &nbsp; wszQueryLanguage, &quot;WQL&quot;<br />&nbsp;  <br />&nbsp; &nbsp; WSTR&nbsp; &nbsp; &nbsp; &nbsp; wszMsg, &quot;Bios Version: %s&quot;<br />&nbsp;  <br />WaitKeyW proto :PTR WORD<br />.DATA<br /><br />&nbsp; &nbsp; ; located in WbemCli.h<br />&nbsp;  <br />&nbsp; &nbsp; WBEM_FLAG_CONNECT_USE_MAX_WAIT&nbsp; EQU&nbsp; &nbsp;  80h<br />&nbsp; &nbsp; WBEM_FLAG_FORWARD_ONLY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EQU&nbsp; &nbsp;  20h<br />&nbsp; &nbsp; WBEM_INFINITE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  EQU&nbsp; &nbsp;  -1<br />&nbsp; &nbsp; WBEM_E_INVALID_QUERY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EQU&nbsp; &nbsp;  80041017h<br />&nbsp; &nbsp; WBEM_E_INVALID_QUERY_TYPE&nbsp; &nbsp; &nbsp;  EQU&nbsp; &nbsp;  80041018h<br />&nbsp;  <br />&nbsp; &nbsp; IID_IWbemLocator&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUID2&nbsp;  &lt;0dc12a687h,0737fh,011cfh,088h,04dh,000h,0aah,000h,04bh,02eh,024h&gt;<br />&nbsp;  <br />&nbsp; &nbsp; IID_IEnumWbemClassObject&nbsp; &nbsp; &nbsp; &nbsp; GUID2&nbsp;  &lt;027947e1h,0d731h,011ceh,0a3h,057h,000h,000h,000h,000h,000h,001h&gt;<br />&nbsp;  <br />&nbsp; &nbsp; IID_IWbemClassObject&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUID2&nbsp;  &lt;0dc12a681h,0737fh,011cfh,088h,04dh,000h,0aah,000h,04bh,02eh,024h&gt;<br />&nbsp;  <br />&nbsp; &nbsp; ; located in WbemProv.h<br />&nbsp;  <br />&nbsp; &nbsp; CLSID_WbemAdministrativeLocator GUID2&nbsp;  &lt;0cb8555cch,09128h,011d1h,0adh,09bh,000h,0c0h,04fh,0d8h,0fdh,0ffh&gt;<br />&nbsp;  <br />&nbsp; &nbsp; locator&nbsp; &nbsp;  IWbemLocator&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;&gt;<br />&nbsp; &nbsp; service&nbsp; &nbsp;  IWbemServices&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;&gt;<br />&nbsp; &nbsp; enumerator&nbsp; IEnumWbemClassObject&nbsp; &nbsp; &lt;&gt;<br />&nbsp; &nbsp; processor&nbsp;  IWbemClassObject&nbsp; &nbsp; &nbsp; &nbsp; &lt;&gt;<br />&nbsp;  <br />&nbsp; &nbsp; retCount&nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp;  <br />&nbsp; &nbsp; var_val&nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; pwszResult&nbsp; PWORD&nbsp;  ?&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; wszQuery&nbsp;  WORD 256 dup(?)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br /><br />.CODE<br /><br />&nbsp; main:<br />&nbsp;  <br />&nbsp; &nbsp; INVOKE CoInitializeEx, NULL, COINIT_MULTITHREADED<br />&nbsp;  <br />&nbsp; &nbsp; INVOKE CoInitializeSecurity, NULL, -1, NULL, NULL, RPC_C_AUTHN_LEVEL_DEFAULT, RPC_C_IMP_LEVEL_IMPERSONATE, NULL, EOAC_NONE, NULL<br />&nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; INVOKE CoCreateInstance, ADDR CLSID_WbemAdministrativeLocator, NULL, CLSCTX_INPROC_SERVER, ADDR IID_IWbemLocator, ADDR locator<br /><br />&nbsp; &nbsp; INVOKE lstrcatW, ADDR wszQuery, ADDR wszSelect<br />&nbsp; &nbsp; INVOKE lstrcatW, ADDR wszQuery, ADDR wszClass<br />&nbsp;  <br />&nbsp; &nbsp; mov esi, locator<br />&nbsp; &nbsp; lodsd<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET service<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; WBEM_FLAG_CONNECT_USE_MAX_WAIT<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET wszNameSpace<br />&nbsp; &nbsp; push&nbsp; &nbsp; DWORD PTR <br />&nbsp; &nbsp; call&nbsp; &nbsp; DWORD PTR <br /><br />&nbsp; &nbsp; mov esi, service<br />&nbsp; &nbsp; lodsd<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET enumerator<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; WBEM_FLAG_FORWARD_ONLY<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET wszQuery<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET wszQueryLanguage<br />&nbsp; &nbsp; push&nbsp; &nbsp; DWORD PTR <br />&nbsp; &nbsp; call&nbsp; &nbsp; DWORD PTR <br /><br />&nbsp; &nbsp; mov esi, enumerator<br />&nbsp; &nbsp; lodsd<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET retCount<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET processor<br />&nbsp; &nbsp; push&nbsp; &nbsp; TRUE<br />&nbsp; &nbsp; push&nbsp; &nbsp; WBEM_INFINITE<br />&nbsp; &nbsp; push&nbsp; &nbsp; DWORD PTR <br />&nbsp; &nbsp; call&nbsp; &nbsp; DWORD PTR <br />&nbsp;  <br />&nbsp; &nbsp; mov esi, processor<br />&nbsp; &nbsp; lodsd<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET var_val<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET wszProperty<br />&nbsp; &nbsp; push&nbsp; &nbsp; DWORD PTR <br />&nbsp; &nbsp; call&nbsp; &nbsp; DWORD PTR <br />&nbsp;  <br />&nbsp; &nbsp; mov esi, <br />&nbsp; &nbsp; mov edi, <br />&nbsp; &nbsp; mov ecx, <br />&nbsp;  <br />&nbsp; &nbsp; mov pwszResult, ecx<br />&nbsp;  <br />&nbsp; &nbsp; INVOKE crt_wprintf, ADDR wszCrLf<br />&nbsp; &nbsp; INVOKE crt_wprintf, ADDR wszMsg, pwszResult<br />&nbsp; &nbsp; INVOKE crt_wprintf, ADDR wszCrLf<br /><br />&nbsp; &nbsp; INVOKE CoUninitialize<br />&nbsp;  <br />&nbsp; &nbsp; INVOKE WaitKeyW, uni$(&quot;Press any key to exit ...&quot;)<br />&nbsp;  <br />&nbsp; &nbsp; INVOKE ExitProcess, 0<br /><br />WaitKeyW PROC pwszPrompt:PTR WORD<br />&nbsp; &nbsp; .DATA<br />&nbsp; &nbsp; &nbsp; &nbsp; IFNDEF wszCrLf<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wszCrLf WORD 13,10,0<br />&nbsp; &nbsp; &nbsp; &nbsp; ENDIF<br />&nbsp; &nbsp; .CODE&nbsp;  <br />&nbsp; &nbsp; .IF pwszPrompt == NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE crt_wprintf, ADDR wszCrLf<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE crt_wprintf, uni$(&quot;Press any key to continue ... &quot;)<br />&nbsp; &nbsp; .ELSE<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE crt_wprintf, ADDR wszCrLf<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE crt_wprintf, pwszPrompt<br />&nbsp; &nbsp; .ENDIF&nbsp;  <br />&nbsp; &nbsp; INVOKE crt__getch<br />&nbsp; &nbsp; .IF (eax == 0) || (eax == 0E0h)<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE crt__getch<br />&nbsp; &nbsp; .ENDIF<br />&nbsp; &nbsp; INVOKE crt_wprintf, ADDR wszCrLf<br />&nbsp; &nbsp; ret<br />WaitKeyW ENDP<br />;======================================================<br />&nbsp;  <br />END main</code></pre><br /><br />Here is the original vbs script that works.<br /><br /><pre><code>strComputer = &quot;.&quot;<br />Set objWMIService = GetObject(&quot;winmgmts:\\&quot; &amp; strComputer &amp; &quot;\root\CIMV2&quot;)<br />Set colItems = objWMIService.ExecQuery( _<br />&nbsp; &nbsp; &quot;SELECT * FROM Win32_BIOS&quot;,,48)<br />For Each objItem in colItems<br />&nbsp; &nbsp; If isNull(objItem.BIOSVersion) Then<br />&nbsp; &nbsp; &nbsp; &nbsp; Wscript.Echo &quot;BIOSVersion: Sorry. Unable to find that information.&quot;<br />&nbsp; &nbsp; Else<br />&nbsp; &nbsp; &nbsp; &nbsp; Wscript.Echo &quot;BIOSVersion: &quot; &amp; Join(objItem.BIOSVersion, &quot;,&quot;)<br />&nbsp; &nbsp; End If<br />Next<br />WScript.Quit</code></pre></div>
    <div class="meta">Posted on 2009-09-19 07:12:06 by LaptoniC</div>
   </div>
   <div class="post" id="post-208846">
    <div class="subject"><a href="#post-208846">Re: WMI string arrays</a></div>
    <div class="body">Thanks to one of masm32forum members, I have managed to fix it. Here is the working code.<br /><br /><pre><code>.586<br />.MODEL FLAT,STDCALL<br />OPTION CASEMAP:NONE<br /><br />INCLUDE \masm32\include\windows.inc<br />INCLUDE \masm32\include\kernel32.inc<br />INCLUDE \masm32\include\ole32.inc<br />INCLUDE \masm32\include\msvcrt.inc<br />;INCLUDE \masm32\include\gel32.inc<br /><br />INCLUDELIB \masm32\lib\kernel32.lib<br />INCLUDELIB \masm32\lib\ole32.lib<br />INCLUDELIB \masm32\lib\msvcrt.lib<br />;INCLUDELIB \masm32\lib\gel32.lib<br /><br />INCLUDE c:\masm32\macros\ucmacros.asm<br /><br />; located in ObjIdl.h<br /><br />EOAC_NONE&nbsp;  EQU 0<br /><br />; located in RpcDce.h<br /><br />RPC_C_AUTHN_LEVEL_DEFAULT&nbsp;  EQU 0<br />RPC_C_IMP_LEVEL_DEFAULT&nbsp; &nbsp;  EQU 0<br /><br />RPC_C_IMP_LEVEL_IMPERSONATE EQU 3<br /><br />GUID2 STRUC<br />&nbsp; &nbsp;  dd1 DWORD ?<br />&nbsp; &nbsp;  dw1 WORD ?<br />&nbsp; &nbsp;  dw2 WORD ?<br />&nbsp; &nbsp;  db1 BYTE ?<br />&nbsp; &nbsp;  db2 BYTE ?<br />&nbsp; &nbsp;  db3 BYTE ?<br />&nbsp; &nbsp;  db4 BYTE ?<br />&nbsp; &nbsp;  db5 BYTE ?<br />&nbsp; &nbsp;  db6 BYTE ?<br />&nbsp; &nbsp;  db7 BYTE ?<br />&nbsp; &nbsp;  db8 BYTE ?<br />GUID2 ENDS<br /><br />IWbemLocator STRUCT<br />&nbsp; &nbsp; lpVtbl DWORD&nbsp;  ?<br />IWbemLocator ENDS<br /><br />IWbemLocatorVtbl STRUCT<br />&nbsp; &nbsp; QueryInterface DWORD&nbsp;  ?<br />&nbsp; &nbsp; AddRef&nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; Release&nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; ConnectServer&nbsp; DWORD&nbsp;  ?<br />IWbemLocatorVtbl ENDS<br /><br />IWbemServices STRUCT<br />&nbsp; &nbsp; lpVtbl DWORD&nbsp;  ?<br />IWbemServices ENDS<br /><br />IWbemServicesVtbl STRUCT<br />&nbsp; &nbsp; QueryInterface&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; AddRef&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; Release&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; OpenNamespace&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; CancelAsyncCall&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; QueryObjectSink&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetObject&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetObjectAsync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; PutClass&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; PutClassAsync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; DeleteClass&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; DeleteClassAsync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; CreateClassEnum&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; CreateClassEnumAsync&nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; PutInstance&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; PutInstanceAsync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; DeleteInstance&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; DeleteInstanceAsync&nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; CreateInstanceEnum&nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; CreateInstanceEnumAsync&nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; ExecQuery&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; ExecQueryAsync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; ExecNotificationQuery&nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; ExecNotificationQueryAsync DWORD&nbsp;  ?<br />&nbsp; &nbsp; ExecMethod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; ExecMethodAsync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />IWbemServicesVtbl ENDS<br /><br />IEnumWbemClassObject STRUCT<br />&nbsp; &nbsp; lpVtbl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />IEnumWbemClassObject ENDS<br /><br />IEnumWbemClassObjectVtbl STRUCT<br />&nbsp; &nbsp; QueryInterface DWORD&nbsp;  ?<br />&nbsp; &nbsp; AddRef&nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; Release&nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; Reset&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; Next&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; NextAsync&nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; Clone&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; Skip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />IEnumWbemClassObjectVtbl ENDS<br /><br />IWbemClassObject STRUCT<br />&nbsp; &nbsp; lpVtbl DWORD&nbsp;  ?<br />IWbemClassObject ENDS<br /><br />IWbemClassObjectVtbl STRUCT<br />&nbsp; &nbsp; QueryInterface&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; AddRef&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; Release&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetQualifierSet&nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; Get&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; Put&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; Delete&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetNames&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; BeginEnumeration&nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; Next&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; EndEnumeration&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetPropertyQualifierSet DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetObjectText&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; SpawnDerivedClass&nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; SpawnInstance&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; CompareTo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetPropertyOrigin&nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; InheritsFrom&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetMethod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; PutMethod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; DeleteMethod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; BeginMethodEnumeration&nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; NextMethod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; EndMethodEnumeration&nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetMethodQualifierSet&nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; GetMethodOrigin&nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp;  ?<br />IWbemClassObjectVtbl ENDS<br /><br />SAFEARRAYBOUND struct<br />cElements dd ?<br />lLbound dd ?<br />SAFEARRAYBOUND ends<br />&nbsp;  <br />SAFEARRAY&nbsp; &nbsp; struct<br />cDims dw ?<br />fFeatures dw ?<br />cbElements dd ?<br />cLocks dd ?<br />pvData dd ?<br />rgsabound SAFEARRAYBOUND &lt;&gt;<br />SAFEARRAY ends<br /><br />.CONST<br />&nbsp;  <br />&nbsp; &nbsp; wszSelect&nbsp; WORD &quot;S&quot;,&quot;E&quot;,&quot;L&quot;,&quot;E&quot;,&quot;C&quot;,&quot;T&quot;,&quot; &quot;,&quot;*&quot;,&quot; &quot;,&quot;F&quot;,&quot;R&quot;,&quot;O&quot;,&quot;M&quot;,&quot; &quot;,0&nbsp; ; the WSTR macro can&#039;t handle the asterisk<br />&nbsp; &nbsp; wszCrLf&nbsp; &nbsp; WORD 13,10,0<br /><br /><br />&nbsp; &nbsp; WSTR&nbsp; &nbsp; &nbsp; &nbsp; wszClass,&nbsp; &nbsp; &quot;Win32_BIOS&quot;&nbsp; &nbsp; ;&lt;&lt;&lt; Set class here<br />&nbsp; &nbsp; WSTR&nbsp; &nbsp; &nbsp; &nbsp; wszProperty, &quot;BIOSVersion&quot;&nbsp; ;&lt;&lt;&lt; Set property here<br /><br />&nbsp; &nbsp; WSTR&nbsp; &nbsp; &nbsp; &nbsp; wszNameSpace, &quot;root\cimv2&quot;<br />&nbsp; &nbsp; WSTR&nbsp; &nbsp; &nbsp; &nbsp; wszQueryLanguage, &quot;WQL&quot;<br />&nbsp;  <br />&nbsp; &nbsp; WSTR&nbsp; &nbsp; &nbsp; &nbsp; wszMsg, &quot;Serial Number %i: %s&quot;<br />&nbsp;  <br />WaitKeyW proto :PTR WORD<br />.DATA<br /><br />&nbsp; &nbsp; ; located in WbemCli.h<br />&nbsp;  <br />&nbsp; &nbsp; WBEM_FLAG_CONNECT_USE_MAX_WAIT&nbsp; EQU&nbsp; &nbsp;  80h<br />&nbsp; &nbsp; WBEM_FLAG_FORWARD_ONLY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EQU&nbsp; &nbsp;  20h<br />&nbsp; &nbsp; WBEM_INFINITE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  EQU&nbsp; &nbsp;  -1<br />&nbsp; &nbsp; WBEM_E_INVALID_QUERY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EQU&nbsp; &nbsp;  80041017h<br />&nbsp; &nbsp; WBEM_E_INVALID_QUERY_TYPE&nbsp; &nbsp; &nbsp;  EQU&nbsp; &nbsp;  80041018h<br />&nbsp;  <br />&nbsp; &nbsp; IID_IWbemLocator&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUID2&nbsp;  &lt;0dc12a687h,0737fh,011cfh,088h,04dh,000h,0aah,000h,04bh,02eh,024h&gt;<br />&nbsp;  <br />&nbsp; &nbsp; IID_IEnumWbemClassObject&nbsp; &nbsp; &nbsp; &nbsp; GUID2&nbsp;  &lt;027947e1h,0d731h,011ceh,0a3h,057h,000h,000h,000h,000h,000h,001h&gt;<br />&nbsp;  <br />&nbsp; &nbsp; IID_IWbemClassObject&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUID2&nbsp;  &lt;0dc12a681h,0737fh,011cfh,088h,04dh,000h,0aah,000h,04bh,02eh,024h&gt;<br />&nbsp;  <br />&nbsp; &nbsp; ; located in WbemProv.h<br />&nbsp;  <br />&nbsp; &nbsp; CLSID_WbemAdministrativeLocator GUID2&nbsp;  &lt;0cb8555cch,09128h,011d1h,0adh,09bh,000h,0c0h,04fh,0d8h,0fdh,0ffh&gt;<br />&nbsp;  <br />&nbsp; &nbsp; locator&nbsp; &nbsp;  IWbemLocator&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;&gt;<br />&nbsp; &nbsp; service&nbsp; &nbsp;  IWbemServices&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;&gt;<br />&nbsp; &nbsp; enumerator&nbsp; IEnumWbemClassObject&nbsp; &nbsp; &lt;&gt;<br />&nbsp; &nbsp; processor&nbsp;  IWbemClassObject&nbsp; &nbsp; &nbsp; &nbsp; &lt;&gt;<br />&nbsp;  <br />&nbsp; &nbsp; retCount&nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp;  <br />&nbsp; &nbsp; var_val&nbsp; &nbsp;  DWORD&nbsp;  ?<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp;  ?<br /><br /><br />&nbsp; &nbsp; pwszResult&nbsp; PWORD&nbsp;  ?&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; wszQuery&nbsp;  WORD 256 dup(?)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br /><br />.CODE<br /><br />&nbsp; main:<br />&nbsp;  <br />&nbsp; &nbsp; INVOKE CoInitializeEx, NULL, COINIT_MULTITHREADED<br />&nbsp;  <br />&nbsp; &nbsp; INVOKE CoInitializeSecurity, NULL, -1, NULL, NULL, RPC_C_AUTHN_LEVEL_DEFAULT, RPC_C_IMP_LEVEL_IMPERSONATE, NULL, EOAC_NONE, NULL<br />&nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; INVOKE CoCreateInstance, ADDR CLSID_WbemAdministrativeLocator, NULL, CLSCTX_INPROC_SERVER, ADDR IID_IWbemLocator, ADDR locator<br /><br />&nbsp; &nbsp; INVOKE lstrcatW, ADDR wszQuery, ADDR wszSelect<br />&nbsp; &nbsp; INVOKE lstrcatW, ADDR wszQuery, ADDR wszClass<br />&nbsp;  <br />&nbsp; &nbsp; mov esi, locator<br />&nbsp; &nbsp; lodsd<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET service<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; WBEM_FLAG_CONNECT_USE_MAX_WAIT<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET wszNameSpace<br />&nbsp; &nbsp; push&nbsp; &nbsp; DWORD PTR <br />&nbsp; &nbsp; call&nbsp; &nbsp; DWORD PTR <br /><br />&nbsp; &nbsp; mov esi, service<br />&nbsp; &nbsp; lodsd<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET enumerator<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; WBEM_FLAG_FORWARD_ONLY<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET wszQuery<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET wszQueryLanguage<br />&nbsp; &nbsp; push&nbsp; &nbsp; DWORD PTR <br />&nbsp; &nbsp; call&nbsp; &nbsp; DWORD PTR <br /><br />&nbsp; &nbsp; mov esi, enumerator<br />&nbsp; &nbsp; lodsd<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET retCount<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET processor<br />&nbsp; &nbsp; push&nbsp; &nbsp; TRUE<br />&nbsp; &nbsp; push&nbsp; &nbsp; WBEM_INFINITE<br />&nbsp; &nbsp; push&nbsp; &nbsp; DWORD PTR <br />&nbsp; &nbsp; call&nbsp; &nbsp; DWORD PTR <br />&nbsp;  <br />&nbsp; &nbsp; mov esi, processor<br />&nbsp; &nbsp; lodsd<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; NULL<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET var_val<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; OFFSET wszProperty<br />&nbsp; &nbsp; push&nbsp; &nbsp; DWORD PTR <br />&nbsp; &nbsp; call&nbsp; &nbsp; DWORD PTR <br />&nbsp;  <br />&nbsp; &nbsp; mov esi, <br />&nbsp; &nbsp; mov edi, <br />&nbsp; &nbsp; mov ecx, <br />&nbsp;  <br />&nbsp; &nbsp; mov pwszResult, ecx<br /><br />mov esi,.SAFEARRAY.pvData<br />mov edi,.SAFEARRAY.rgsabound.cElements<br /><br />&nbsp; &nbsp; INVOKE crt_wprintf, ADDR wszCrLf<br />&nbsp;  <br />&nbsp;  <br /><br />&nbsp;  <br />.while edi<br />&nbsp; mov ecx,<br />&nbsp; INVOKE crt_wprintf, ADDR wszMsg, edi,ecx<br />&nbsp; INVOKE crt_wprintf, ADDR wszCrLf<br />dec edi<br />&nbsp;  add esi,4<br />.endw<br /><br /><br /><br />&nbsp; &nbsp; INVOKE crt_wprintf, ADDR wszCrLf<br /><br />&nbsp; &nbsp; INVOKE CoUninitialize<br />&nbsp;  <br />&nbsp; &nbsp; INVOKE WaitKeyW, uni$(&quot;Press any key to exit ...&quot;)<br />&nbsp;  <br />&nbsp; &nbsp; INVOKE ExitProcess, 0<br /><br />WaitKeyW PROC pwszPrompt:PTR WORD<br />&nbsp; &nbsp; .DATA<br />&nbsp; &nbsp; &nbsp; &nbsp; IFNDEF wszCrLf<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wszCrLf WORD 13,10,0<br />&nbsp; &nbsp; &nbsp; &nbsp; ENDIF<br />&nbsp; &nbsp; .CODE&nbsp;  <br />&nbsp; &nbsp; .IF pwszPrompt == NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE crt_wprintf, ADDR wszCrLf<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE crt_wprintf, uni$(&quot;Press any key to continue ... &quot;)<br />&nbsp; &nbsp; .ELSE<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE crt_wprintf, ADDR wszCrLf<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE crt_wprintf, pwszPrompt<br />&nbsp; &nbsp; .ENDIF&nbsp;  <br />&nbsp; &nbsp; INVOKE crt__getch<br />&nbsp; &nbsp; .IF (eax == 0) || (eax == 0E0h)<br />&nbsp; &nbsp; &nbsp; &nbsp; INVOKE crt__getch<br />&nbsp; &nbsp; .ENDIF<br />&nbsp; &nbsp; INVOKE crt_wprintf, ADDR wszCrLf<br />&nbsp; &nbsp; ret<br />WaitKeyW ENDP<br />;======================================================<br />&nbsp;  <br />END main</code></pre></div>
    <div class="meta">Posted on 2009-09-19 20:03:34 by LaptoniC</div>
   </div>
  </div>
 </body>
</html>