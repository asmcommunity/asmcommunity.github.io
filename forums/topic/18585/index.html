<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>If I had written Windows.... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=18585" />
    <link rel="next" href="../?id=18585&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=18585">If I had written Windows....</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=18585&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=18585&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="18585" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=18585&amp;page=2">&gt;</a><a href="../?id=18585&amp;page=3">&raquo;</a></form>   <div class="post" id="post-143893">
    <div class="subject"><a href="#post-143893">If I had written Windows....</a></div>
    <div class="body">I thought it would be fun to post what you would have done differently if you had written Windows. Here's some things I would change:<br /><br /><ul>[*]Set the flags for EAX on exiting a procedure, I mean just an <strong>or eax,eax</strong> would  have been nice<br />[*]Preserve ECX instead of EBX to allow for easier counting loops</div>
    <div class="meta">Posted on 2004-06-15 15:41:22 by donkey</div>
   </div>
   <div class="post" id="post-143897">
    <div class="subject"><a href="#post-143897">If I had written Windows....</a></div>
    <div class="body">I would have written it to be constantly buggy and exploitable and offer fixes for the problems little by little and when I needed money I would put out a new version that has all those fixes incorporated into the kernel as temporary hacks and put a new GUI on it.</div>
    <div class="meta">Posted on 2004-06-15 16:07:46 by SpooK</div>
   </div>
   <div class="post" id="post-143900">
    <div class="subject"><a href="#post-143900">If I had written Windows....</a></div>
    <div class="body"><div class="quote">Set the flags for EAX on exiting a procedure, I mean just an or eax,eax would have been nice</div><br /><br />Why would you want to do that? 99% of the time it is not required (not by any HLL anyway), and for the 1%, you can just place the or (or whatever else) after the call.<br /><br /><div class="quote">Preserve ECX instead of EBX to allow for easier counting loops</div><br /><br />Why not make loops with ebx instead of ecx, or even use a local variable? Besides, the real reason for this convention is because in the old days, bx had special functionality. It was the only 'x' register that could be used with addressing. So it is not a decision of MS, but of Intel (most other OSes work the same way on x86).<br /><br />I am not sure what I would have done differently. I have used Windows for so long now that I have no desire to change anything. I would rather want other OSes to change and be more like Windows.</div>
    <div class="meta">Posted on 2004-06-15 16:25:30 by Scali</div>
   </div>
   <div class="post" id="post-143906">
    <div class="subject"><a href="#post-143906">If I had written Windows....</a></div>
    <div class="body">I don't think that's why they chose to preserve EBX. Usually you won't work with 16-bit addresses in a 32-bit program, so it didn't matter much to them. They simply decided to not preserve the first three registers, and preserve the rest (ESP being treated somewhat specially, of course). The reason we usually use ECX as a loop counter is to save one byte.<br /><br />I'd use CF for boolean results. They could very well have incorporated this convention into Visual C++, and it would have saved a few bytes here and there. Usually after calling function returning a boolean result you're going to test it, so the 1% figure seems a bit too low to me.<br /><br />I'd use every available register to return values instead of storing them into an user specified memory address, in most cases, especially when it's obvious that the caller is going to use the result right away, if it's ever going to use it, like with GetFileSize and ReadFile. This could be implemented in a C compiler by declaring the function with a structured return type.</div>
    <div class="meta">Posted on 2004-06-15 16:52:36 by Sephiroth3</div>
   </div>
   <div class="post" id="post-143907">
    <div class="subject"><a href="#post-143907">If I had written Windows....</a></div>
    <div class="body">I would have separated kernel and GUI, but left enough hooks in the kernel for GUI, that performance wouldn't have been as utterly lame as linux+XFree86.<br /><br />I would have modularized things a bit more, and let people have more control of what gets installed and what doesn't. I would let adminstrators control the Windows File Protection completely - turn off, choose which files to protect (including 3rd party ones), etc.<br /><br />I would have chosen a somewhat different folder structure, and not thrown as much junk in \windows and \windows\system32. I would especially have isolated the legacy subsystem support.<br /><br />I would have worked towards NT/9x migration right after win95, since 9x is a horrible piece of shit that shouldn't really have existed.<br /><br />I wouldn't have supported other companies shit code in the kernel (ie, kernel hacks to support versions of eudora depending on internal workings.) - I would have put great effort into breaking 3rd-party software depending on undocumented behaviour.<br /><br />I would have put great effort into making _stable_ native APIs, and I would have documented those (but still adviced people to use win32, and adviced against depending on undocumented native APIs).<br /><br />...those are just some. I do think that the NT kernel is very good design, has good performance, and a much better security model than any of the unix junk... too bad that the application programmers have botched up the system as a whole.</div>
    <div class="meta">Posted on 2004-06-15 16:52:58 by f0dder</div>
   </div>
   <div class="post" id="post-143908">
    <div class="subject"><a href="#post-143908">If I had written Windows....</a></div>
    <div class="body"><div class="quote">Why would you want to do that? 99% of the time it is not required (not by any HLL anyway), and for the 1%, you can just place the or (or whatever else) after the call.</div><br /><br />Well, much of the time you check to see if a function was successful by looking for 0 in eax. To do this you OR EAX,EAX/ JZ &gt;.ERROR. Ofcourse if you don't bother checking return values it is not an issue :) Also many more than 1% of the API returns true or false, by setting the flags on exit it makes the check faster. After all, it does not always require that they be explicitly set, they may have been set by some previous operation, the idea is that the returned flags are indicative of the value in EAX, after all every API destroys them anyway.</div>
    <div class="meta">Posted on 2004-06-15 16:59:49 by donkey</div>
   </div>
   <div class="post" id="post-143909">
    <div class="subject"><a href="#post-143909">If I had written Windows....</a></div>
    <div class="body"><div class="quote">I don't think that's why they chose to preserve EBX. Usually you won't work with 16-bit addresses in a 32-bit program, so it didn't matter much to them.</div><br /><br />Newsflash: Windows existed before 32 bit x86 were commonplace.<br /><br /><div class="quote">The reason we usually use ECX as a loop counter is to save one byte.</div><br /><br />Would this be by use of the loop or jecxz instructions?<br />I'd rather use an extra byte than waste 5 or more clks for every iteration because of legacy instructions.</div>
    <div class="meta">Posted on 2004-06-15 16:59:59 by Scali</div>
   </div>
   <div class="post" id="post-143910">
    <div class="subject"><a href="#post-143910">If I had written Windows....</a></div>
    <div class="body"><div class="quote">Well, 99% of the time you check to see if a function was successful by looking for 0 in eax. To do this you OR EAX,EAX/ JZ &gt;.ERROR</div><br /><br />I beg to differ that 99% of the functions you call are even capable of failing at all. At any rate, what does it matter if the or is before or after the return? Especially if you use .IF, the size of the sourcecode will be equal whether you do .IF zero? or .IF eax == 0<br /><br /><div class="quote">by setting the flags on exit it makes the check faster. After all, it does not always require that they be explicitly set, they may have been set by some previous operation, the idea is that the returned flags are indicative of the value in EAX, after all every API destroys them anyway.</div><br /><br />That may have been nice in the DOS-age, but Windows was designed to be portable, and to work nicely with HLLs, so these things would not fit in the Windows design-philosophy very well.<br />I suppose the abandoning of such features was driven by forward movement.</div>
    <div class="meta">Posted on 2004-06-15 17:06:08 by Scali</div>
   </div>
   <div class="post" id="post-143911">
    <div class="subject"><a href="#post-143911">If I had written Windows....</a></div>
    <div class="body">The thing with the &quot;or eax, eax&quot; stuff is that it would require adding special code to their compiler, that only assembly programmers would use - or, in case they released that compiler to the public, would make it incompatible with other 32bit compilers (though, of course, yet a calling convention would be constructed.)<br /><br />How much would you gain by this anyway? In terms of speed, in terms of reduced code size. I would have focused on important things, not &quot;neat&quot; optimizations that wouldn't have much effect.</div>
    <div class="meta">Posted on 2004-06-15 17:08:24 by f0dder</div>
   </div>
   <div class="post" id="post-143912">
    <div class="subject"><a href="#post-143912">Re: If I had written Windows....</a></div>
    <div class="body"><div class="quote"><br />If i had written Windows ....<br /></div><br /><br />I would give up programming becouse im not suited for it :P<br /><br /><br />but seriously<br /><br /><div class="quote">  <em>fodder</em> <br />I would have modularized things a bit more, and let people have more control of what gets installed and what doesn't. I would let adminstrators control the Windows File Protection completely - turn off, choose which files to protect (including 3rd party ones), etc.   </div><br /><br />this one realy lacks in windows, especialy when you are also linux user.</div>
    <div class="meta">Posted on 2004-06-15 17:09:13 by AceEmbler</div>
   </div>
   <div class="post" id="post-143913">
    <div class="subject"><a href="#post-143913">If I had written Windows....</a></div>
    <div class="body"><div class="quote">I would have separated kernel and GUI, but left enough hooks in the kernel for GUI, that performance wouldn't have been as utterly lame as linux+XFree86.</div><br /><br />Isn't that exactly what MS has already done?<br /><br /><div class="quote">I would have worked towards NT/9x migration right after win95, since 9x is a horrible piece of shit that shouldn't really have existed.</div><br /><br />Newsflash: 9x WAS the NT migration. It just took way longer than planned because people are overly conservative and stupid.</div>
    <div class="meta">Posted on 2004-06-15 17:09:43 by Scali</div>
   </div>
   <div class="post" id="post-143914">
    <div class="subject"><a href="#post-143914">If I had written Windows....</a></div>
    <div class="body"><div class="quote"><br />Isn't that exactly what MS has already done?<br /></div><br />Not yet - although if you hack around enough, you can boot to a &quot;native state&quot; without win32, it still requires video mode though. And it's certainly not anything that's supported.<br /><br /><div class="quote"><br />Newsflash: 9x WAS the NT migration. It just took way longer than planned because people are overly conservative and stupid.<br /></div><br />Microsoft needed a bunch of 32bit applications to convince people to move to 95. That happened, and then they should have forced everybody to go NT by simply not releasing any more 9x versions. Not like there was anybody who could have done anything about it...</div>
    <div class="meta">Posted on 2004-06-15 17:13:44 by f0dder</div>
   </div>
   <div class="post" id="post-143915">
    <div class="subject"><a href="#post-143915">If I had written Windows....</a></div>
    <div class="body">Man, I didn't want to get into any arguments about this, it was just an &quot;it would be nice if&quot; kind of thread.<br /><br />BTW I don't use MASM and GoAsm has no .IF statement or equivalent, you cmp and jxx that's all.<br /><br />It would not break any HLLs to have the flags set to the value in EAX, that is a red herring argument, and I am not talking about explicitly setting the flags each time, just assuring that they would be indicative. At anyrate this already looks like it is heading for a flame war, should have known better than to post here again.</div>
    <div class="meta">Posted on 2004-06-15 17:16:13 by donkey</div>
   </div>
   <div class="post" id="post-143918">
    <div class="subject"><a href="#post-143918">If I had written Windows....</a></div>
    <div class="body"><div class="quote">Not yet - although if you hack around enough, you can boot to a &quot;native state&quot; without win32, it still requires video mode though. And it's certainly not anything that's supported.</div><br /><br />I don't see the relation between kernel/GUI integration and the fact that an OS cannot boot without a kernel.<br />If I hardcode startkde in init on *nix, it would still have the same kernel/GUI integration, but it could no longer boot without a GUI.<br />See what I mean?<br /><br /><div class="quote">Microsoft needed a bunch of 32bit applications to convince people to move to 95. That happened, and then they should have forced everybody to go NT by simply not releasing any more 9x versions. Not like there was anybody who could have done anything about it...</div><br /><br />Perhaps you don't really get the idea of &quot;The customer is always right&quot; :)<br />If the customer wants a new 9x, he shall get a new 9x (perhaps they figured that they would either stick it out with 95 or buy 98, but never buy NT).<br />Another factor could be that a lot of software was written badly, and did not run on NT properly (eg old DOS software or buggy Windows apps (hello VxD hax0rz? :))).<br />Games may have been a large factor. Even though NT4 supported DirectX, not many games worked on it. It took until Win2k to get DirectX-on-NT and game programmers in sync.<br />But I recall at the time that Win98 wasn't really planned. Win2k was supposed to be the 'final' Windows platform... I think an indication of that could be that the only non-server version is entitled &quot;Professional&quot;. Perhaps they already planned a Win2k &quot;Home&quot;, but instead Windows ME was released (why is it not called '2000' aswell?).<br />WinXP finally fixed it at last, anyway, so it is just a bad memory now.</div>
    <div class="meta">Posted on 2004-06-15 17:27:58 by Scali</div>
   </div>
   <div class="post" id="post-143920">
    <div class="subject"><a href="#post-143920">If I had written Windows....</a></div>
    <div class="body"><div class="quote">It would not break any HLLs to have the flags set to the value in EAX, that is a red herring argument</div><br /><br />Nobody said it would break HLLs. HLLs just won't be able to use this feature, so it is of little use to most programmers anyway.<br />It would break portability though, since flags are CPU-specific. And above all, Windows is a portable OS. With which I merely want to say: you may want this feature, but MS would not.<br />Let's just say that the people that work at MS have plenty of knowledge and experience, and their decisions are based on decent arguments. They don't really care about what some little asm programmers might want, and they shouldn't anyway, it's not their target audience. They have to aim at their target audience, and I think the success of MS through the years comes from the fact that they do this better than most people dare to admit.</div>
    <div class="meta">Posted on 2004-06-15 17:31:58 by Scali</div>
   </div>
   <div class="post" id="post-143921">
    <div class="subject"><a href="#post-143921">If I had written Windows....</a></div>
    <div class="body"><div class="quote"><br />Perhaps you don't really get the idea of &quot;The customer is always right&quot;<br /></div><br />As if microsoft always plays by this rule :p<br /><br />Yes, software was written badly, with direct port I/O etc, which shouldn't have been allowed, even on 9x. That software should simply have been forced to break, and software vendors release new versions. Microsoft could have helped companies rewrite VxDs before there were too many of them.<br /><br />Microsoft chickened out and did win98, shame on them, more legacy crap apps. And why isn't Me called 2000? Because it's still a stinking piece of 9x shit ;)</div>
    <div class="meta">Posted on 2004-06-15 17:33:47 by f0dder</div>
   </div>
   <div class="post" id="post-143924">
    <div class="subject"><a href="#post-143924">If I had written Windows....</a></div>
    <div class="body"><div class="quote">As if microsoft always plays by this rule :p</div><br /><br />Yes, I am of the opinion that they do. They listen to what the majority of customers want, and deliver that, I think. It's the only way I can explain why they have managed to keep a monopoly of ~95% for all these years, regardless of all these claims that it would be buggy, bloated, slow, overpriced etc. If there wasn't a decent foundation for the MS monopoly, I think it would have fallen apart overnight, with all the alternatives that have been offered (Mac, OS/2, BeOS, linux, etc).<br /><br /><div class="quote">And why isn't Me called 2000? Because it's still a stinking piece of 9x shit</div><br /><br />Well it is not called Windows 99 either, or something... The ME name doesn't relate to either product line.<br />What I meant was that nothing would have stopped them from calling it 2000 Home or such. I think the reason is that the 2000 Home name was reserved for another product, which was not released until 2 years later, but then called XP Home.</div>
    <div class="meta">Posted on 2004-06-15 17:41:38 by Scali</div>
   </div>
   <div class="post" id="post-143932">
    <div class="subject"><a href="#post-143932">If I had written Windows....</a></div>
    <div class="body">The calling convention used in Win16 APIs is irrelevant. In fact, BX is not preserved in Win16, and it is for exactly the same reason you suggested for preserving it ^_^. Also the order of stack parameters is reversed.<br /><br />Usually, the time taken by an API call far outweighs the few nanoseconds taken by a loop or jecxz instruction. I prefer making my programs as small as possible so an user won't have to spend ages downloading it or copying it from the diskette or CD-ROM and having to buy new, larger hard disks all the time. Regarding the flag issue, I think it would have been benificial to incorporate it for functions that return boolean results. There would be ways to make things portable with the invention of the right language or language extensions. The statement that HLLs wouldn't be able to make use of it is quite a bold one.</div>
    <div class="meta">Posted on 2004-06-15 18:55:09 by Sephiroth3</div>
   </div>
   <div class="post" id="post-143952">
    <div class="subject"><a href="#post-143952">If I had written Windows....</a></div>
    <div class="body"><div class="quote">The calling convention used in Win16 APIs is irrelevant. In fact, BX is not preserved in Win16, and it is for exactly the same reason you suggested for preserving it ^_^</div><br /><br />Whatever, bx had a special function in 16 bit. And that is why it is still saved today, regardless of whether the PASCAL calling convention was the most popular or not.<br /><br /><div class="quote">I prefer making my programs as small as possible so an user won't have to spend ages downloading it or copying it from the diskette or CD-ROM and having to buy new, larger hard disks all the time.</div><br /><br />Common misconception: The size of a program is mostly driven by the size of its data, not its code. Proof? Simple, take a program of say 1 mb. Disassemble it and count all loops. Let's stay on the generous side and say there are 10000 (that is quite a lot for a single program!). You say a loop with ecx will be 1 byte smaller. So you have just gained 10 kb on a program of 1 mb? That is not going to make any difference for speed of downloading or copying. QED.<br /><br /><div class="quote">There would be ways to make things portable with the invention of the right language or language extensions. The statement that HLLs wouldn't be able to make use of it is quite a bold one.</div><br /><br />You prove yourself wrong here. You say the languages need extensions. Apparently these extensions are necessary because HLLs indeed are not able to make use of it. And that is the trap right there: you will require compilers for HLLs that have these extensions to make use of the features. This breaks portability ofcourse. And how big is the chance that anyone other than MS will implement the extensions in their compilers?<br />Also, you seem like a naive programmer who has only ever seen x86 up close. x86 has flags that may or may not exist on other CPUs, and vice versa. It would come down to having to create a pseudo-flags register in memory somewhere, and having to emulate certain flags on certain CPUs. Not exactly what you want, because it is both slower and generates more code.</div>
    <div class="meta">Posted on 2004-06-16 02:07:56 by Scali</div>
   </div>
   <div class="post" id="post-143962">
    <div class="subject"><a href="#post-143962">If I had written Windows....</a></div>
    <div class="body">firstly maybe make the GUI and the Kernel act independant so when you want to move the app window the window doesn't have drawing problembs when entering a heavy msg loop etc etc.<br /><br />I would like to allow there to be a build in coding platform with a JIT debugger plus have all the libaries etc have comments linked to them to act as documentation ie compiled dll's etc have special resources geared at programmers. Also make it possible to customise nearly every aspect of the os.<br /><br />Another would be that there is an user that is the system and will not allow any form of login and it won't allow anybody to view things that belong to it... use to protect developed software by having ani-reverse engineering tactics built in... maby a little bit awaire. Each program will have something similar to a GUID to allow the coder to preform debugging on it but not allow others... and the GUID will have diffrent levels as to acommedate OPENSOURCE.<br />Installing software will be compiling the software, so it is 100% configured for your system... so you would obviously only need 1 copy of the package to run it on diffrent arcutectures and runtime dependantcies - but hopefully keeping it as easy as MSI to install. {sorry linux, mabe a bit sloppy there and rpm's don't really solve the problem}<br /><br />Oh btw, f0dder - the thing about dumping things in Windows and System... well i sortof agree but in linux there is no uniform install path so you you tend to spend time &quot;#su root&quot; then &quot;#updatedb&quot; and finally &quot;locate what-ever&quot; to see if or more where it is again....<br /><br />The users will only see their own files and their own common files, they will not in anyway be able to see the system files and the system's actions. {Namespace structure somethin akin to linux, yet Desktop still top of the Namespace ie no drive letters}. Or even better ... each application will have its own namespace and so users with access to the application will be able to see and use and interact with it.{ok once again something akin with linux}<br /><br />Also swap space will be in a seperate partition and will be treated as restricted... and only used as a last resort.<br /><br />mabe have the gui act in gl mode... give some real special effects and make it more interactive with the user.<br /><br />Mabe i should just try get back to windows... seems like i have spent some time on linux...</div>
    <div class="meta">Posted on 2004-06-16 04:34:01 by Black iCE</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=18585&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=18585&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="18585" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=18585&amp;page=2">&gt;</a><a href="../?id=18585&amp;page=3">&raquo;</a></form>  </div>
 </body>
</html>