<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Problem with trapping NM_DBLCLK Messages - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=16765" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=16765">Problem with trapping NM_DBLCLK Messages</a></p>
   <div class="post" id="post-130075">
    <div class="subject"><a href="#post-130075">Problem with trapping NM_DBLCLK Messages</a></div>
    <div class="body">I am subclassing a parent window of a listview control so that it sends messages from the listview directly to the main window for processing... that is not the real difficulty. The problem is trapping and identifying NM_DBLCLK messages. I want to know when the listview control is being doubleclicked. <br /><br />I looked up the value for NM_DBLCLK in the windows.inc file and it is (NM_FIRST - 3) which turns out to be 0xFFFFFFFD. Ok that's fine but why dosent it work? So I open the disassembler and read the actual NM_ message codes the program is generating when I doubleclick on the listview and they are nothing like 0xFFFFFFFD. They all start with 0012F... which is quite confusing. If anybody can help I would really appreciate it.<br /><br />Johnny</div>
    <div class="meta">Posted on 2004-01-08 14:05:03 by JohnnyQuest</div>
   </div>
   <div class="post" id="post-130173">
    <div class="subject"><a href="#post-130173">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">There is a problem with your attachment<br /><br />akyprian</div>
    <div class="meta">Posted on 2004-01-09 12:30:53 by akyprian</div>
   </div>
   <div class="post" id="post-130183">
    <div class="subject"><a href="#post-130183">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">Here it is:</div>
    <div class="meta">Posted on 2004-01-09 14:59:56 by JohnnyQuest</div>
   </div>
   <div class="post" id="post-130184">
    <div class="subject"><a href="#post-130184">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">I am subclassing a parent window of a listview control so that it sends messages from the listview directly to the main window for processing... that is not the real difficulty. The problem is trapping and identifying NM_DBLCLK messages. I want to know when the listview control is being doubleclicked.<br /><br />I looked up the value for NM_DBLCLK in the windows.inc file and it is (NM_FIRST - 3) which turns out to be 0xFFFFFFFD. Ok that's fine but why dosent it work? So I open the disassembler and read the actual NM_ message codes the program is generating when I doubleclick on the listview and they are nothing like 0xFFFFFFFD. They all start with 0012F... which is quite confusing. If anybody can help I would really appreciate it.<br /><br />Johnny</div>
    <div class="meta">Posted on 2004-01-09 15:06:01 by JohnnyQuest</div>
   </div>
   <div class="post" id="post-130193">
    <div class="subject"><a href="#post-130193">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">JohnnyQuest,<br />No one can help you easily if you don't post the source code.  Ratch</div>
    <div class="meta">Posted on 2004-01-09 16:31:23 by Ratch</div>
   </div>
   <div class="post" id="post-130195">
    <div class="subject"><a href="#post-130195">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">Perhaps it's a little obvious, but NM_DBLCLK is not a message, but a notification code. Check for WM_NOTIFY messages.<br />Other than that, there's not much one can do to help without the sources :(</div>
    <div class="meta">Posted on 2004-01-09 17:13:49 by QvasiModo</div>
   </div>
   <div class="post" id="post-130196">
    <div class="subject"><a href="#post-130196">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">Hi both Ratch and Qvasimodo are right :grin: <br /><br />I upoad a sample project to demonstrate the idea.<br /><br />Regards,<br /><br />akyprian</div>
    <div class="meta">Posted on 2004-01-09 17:16:26 by akyprian</div>
   </div>
   <div class="post" id="post-130197">
    <div class="subject"><a href="#post-130197">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">I upoad a sample project to demonstrate the idea.<br /><br />Regards,<br /><br />akyprian</div>
    <div class="meta">Posted on 2004-01-09 17:21:01 by akyprian</div>
   </div>
   <div class="post" id="post-130199">
    <div class="subject"><a href="#post-130199">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">:grin: Funny messagebox...</div>
    <div class="meta">Posted on 2004-01-09 17:38:18 by QvasiModo</div>
   </div>
   <div class="post" id="post-130200">
    <div class="subject"><a href="#post-130200">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">I'm sorry guys... I thought I had all the project files in there but I left out the asm by mistake. Here is the full project with the asm file. I really appreciate your help.<br /><br />Johhny</div>
    <div class="meta">Posted on 2004-01-09 17:46:44 by JohnnyQuest</div>
   </div>
   <div class="post" id="post-130201">
    <div class="subject"><a href="#post-130201">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">Akyprian thanks for the custom example man! lol<br /><br />regards,<br /><br />Johnny</div>
    <div class="meta">Posted on 2004-01-09 17:51:56 by JohnnyQuest</div>
   </div>
   <div class="post" id="post-130202">
    <div class="subject"><a href="#post-130202">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">IMO here's the problem:<br /><pre><code><br />	.elseif uMsg==WM_NOTIFY	<br />		.if wParam == PortListID ; Get doubleclicks from PortList<br />			&#91;COLOR=RED&#93;push lParam<br />			pop ptrNotifyStruct<br />			mov eax, &#40;NMHDR PTR &#91;ptrNotifyStruct&#93;&#41;.code<br /><br />			.if ax == NM_DBLCLK&#91;/COLOR&#93;; NM_DBLCLICK!!!!<br />				; Now determine which column was doubleclicked<br />				Invoke MessageBox,NULL,ADDR szTest, Offset szAppName, MB_OK<br />			<br />			.endif<br />		.endif<br /></code></pre><br />It should be something like:<br /><pre><code>mov edx,lParam<br />mov eax,&#91;edx&#93;.NMHDR.code<br />.if eax == NM_DBLCLK<br /></code></pre></div>
    <div class="meta">Posted on 2004-01-09 18:01:33 by QvasiModo</div>
   </div>
   <div class="post" id="post-130204">
    <div class="subject"><a href="#post-130204">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">It seems the problem I was having was not with NM_DBLCLK messages it was with using a local variable as a pointer. For some reason this doesnt work:<br /><br />  local structPointer:DWORD<br /><br />  push lParam<br />  pop structPointer<br />  mov eax, .NMHDR.code<br /><br />  .if eax == NM_DBLCLK <br />      ..do whatever...<br />   <br />When I replace the structPointer local variable with an actual register like in Akyprian's example the reference works fine.<br /><br />  PUSH EDI<br />  MOV EDI,lParam<br />  MOV EAX,.NMHDR.hwndFrom<br />  .If EAX==hList ....<br /><br />Johnny</div>
    <div class="meta">Posted on 2004-01-09 18:15:13 by JohnnyQuest</div>
   </div>
   <div class="post" id="post-130206">
    <div class="subject"><a href="#post-130206">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body">Man you guys respond FAST! Thanks for all your help!<br /><br />regards,<br /><br />Johnny</div>
    <div class="meta">Posted on 2004-01-09 18:16:50 by JohnnyQuest</div>
   </div>
   <div class="post" id="post-130207">
    <div class="subject"><a href="#post-130207">Problem with trapping NM_DBLCLK messages</a></div>
    <div class="body"><div class="quote"><em>Originally posted by JohnFound:</em><br /><strong>It seems the problem I was having was not with NM_DBLCLK messages it was with using a local variable as a pointer.</strong><br /></div><br />The CPU does not handle addressing that way. You need to use a hardcoded immediate value and/or a register. Since local variables are located in the stack and addressed using EBP, your code was interpreted by MASM as:<br /><br />mov eax,<br /><br />or something like that. Being  your local variable, and 0ch the offset to the struct member. (As if your local variable was holding the actual structure rather than a pointer to it).<br /><br />Hope that helps :)</div>
    <div class="meta">Posted on 2004-01-09 18:18:56 by QvasiModo</div>
   </div>
  </div>
 </body>
</html>