<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Croissant 9 remake - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30124" />
    <link rel="next" href="../?id=30124&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=30124">Croissant 9 remake</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=30124&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=30124&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="30124" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=30124&amp;page=2">&gt;</a><a href="../?id=30124&amp;page=2">&raquo;</a></form>   <div class="post" id="post-212472">
    <div class="subject"><a href="#post-212472">Croissant 9 remake</a></div>
    <div class="body">Okay, I&#039;ve been playing with this idea for a while now, time to dedicate its own thread to it, which I suppose implies something of a commitment to the project aswell. And hopefully some direction.<br /><br />To those who don&#039;t know what Croissant 9 is... It is a software-rendered Java demo that I released in 2003: http://pouet.net/prod.php?which=10808<br />For a long time I&#039;ve had the idea to create a hardware-accelerated version of it. I think it would be a good project for bringing some maturity to the D3D/OpenGL frameworks that I have made. I will need to implement all aspects of the Java demo system in the D3D/OpenGL framework in order to get a proper demo out.<br /><br />I have pretty much decided that I&#039;m going to do this with OpenGL, and have it work on Windows, linux, FreeBSD and possibly other OSes. That would be true to the spirit of the original Java demo, which ran &#039;everywhere&#039; (even without a 3D card).<br />However, since my OpenGL framework is based pretty closely on the D3D framework, I&#039;m playing with the idea to integrate the two into a single codebase. That would be much like the Unigine engine, which also supports DX9/10/11/OpenGL.<br />Currently there is a collection of code in the D3D codebase, which was written during the development of Croissant 9, and implements part of the same functionality as the Java engine. So I started working off that.<br /><br />So far, I can read the geometry and animation paths from the Croissant 9 dataset in D3D. I think I will do the .ogg music replayer next.<br /></div>
    <div class="meta">Posted on 2010-07-29 09:54:03 by Scali</div>
   </div>
   <div class="post" id="post-212507">
    <div class="subject"><a href="#post-212507">Re: Croissant 9 remake</a></div>
    <div class="body">I&#039;ve decided to try and get things working in OpenGL first... as that would be my end-goal, rather than D3D.<br />In the process I&#039;ve also merged some of the interfaces between OpenGL and D3D, so that they are closer together.<br /><br />The geometry is parsed correctly in OpenGL... however, there still appears to be a problem with the animation keys. It looks like the rotation keys aren&#039;t handled properly. I will have to look into that. They are stored slightly differently from the BHM file format, and require some quaternion operations that I had not yet tested. It could be that their implementation is slightly off.<br />I could cheat a bit, and use the D3DX library. The D3D version uses that, and that works. I&#039;ll have to compare it against what happens in OpenGL.<br />The geometry itself, the regular object matrices and position animation seems to work okay though.</div>
    <div class="meta">Posted on 2010-08-02 06:12:10 by Scali</div>
   </div>
   <div class="post" id="post-212510">
    <div class="subject"><a href="#post-212510">Re: Croissant 9 remake</a></div>
    <div class="body">Yay, with the help of the D3DX library, I managed to track down the bug in my own code. Very subtle... the D3DX functions allow you to use the same parameters as input and output, which my parser did. My own implementation performed the correct math, but it overwrote one of the input parameters if it was the same as the output. Now that is fixed, and in OpenGL the content can be parsed and displayed correctly.<br /><br />Here is the autobot cube from one of the first scenes:<br /><img src="http://bohemiq.scali.eu.org/Cube.png" /></div>
    <div class="meta">Posted on 2010-08-02 14:07:09 by Scali</div>
   </div>
   <div class="post" id="post-212515">
    <div class="subject"><a href="#post-212515">Re: Croissant 9 remake</a></div>
    <div class="body">Scali, is the functionality of your project similar to <a target="_blank" href="http://www.libsdl.org">http://www.libsdl.org</a> in terms of D3D and OpenGL? Is it simpler or more complex? I&#039;ve used libsdl before ( not extensively though) for some quick and dirty graphics programming in C and was curious as to your viewpoint on the comparison.</div>
    <div class="meta">Posted on 2010-08-02 17:03:33 by p1ranha</div>
   </div>
   <div class="post" id="post-212516">
    <div class="subject"><a href="#post-212516">Re: Croissant 9 remake</a></div>
    <div class="body">Scali, could you please post here the World/Model, View, and Projection matrices captured from any valid frame (it may be from the frame visible in the image you attached). I&#039;m somehow getting strange perspective artifacts in OpenGL so I&#039;d like to see a working set of matrices to compare them with my own ones. I copy-pasted my transformation functions directly from one of my D3D9 projects and that&#039;s the root of the problem, I think. Specifically I suspect row-major vs column-major order and -1.0 - +1.0 device-normalized space in OGL vs 0.0 - +1.0 in D3D9. What do you think? The other suspects are badly set up vertex arrays / VBOs, but I&#039;d like to confirm the matrices first.<br /><br />Please post the matrices in the order returned by glGetFloatv() or in the order you pass them to glLoadMatirix / glLoadTransposeMatrix / etc.</div>
    <div class="meta">Posted on 2010-08-02 17:10:11 by ti_mo_n</div>
   </div>
   <div class="post" id="post-212518">
    <div class="subject"><a href="#post-212518">Re: Croissant 9 remake</a></div>
    <div class="body"><div class="quote"><br />Scali, is the functionality of your project similar to <a target="_blank" href="http://www.libsdl.org">http://www.libsdl.org</a> in terms of D3D and OpenGL? Is it simpler or more complex? I&#039;ve used libsdl before ( not extensively though) for some quick and dirty graphics programming in C and was curious as to your viewpoint on the comparison.<br /></div><br /><br /><br />Check out <a target="_blank" href="http://www.sfml-dev.org/">SFML</a> if you don&#039;t want to deal with something as overly complex as SDL or the L/GPL.<br /></div>
    <div class="meta">Posted on 2010-08-02 17:50:32 by SpooK</div>
   </div>
   <div class="post" id="post-212525">
    <div class="subject"><a href="#post-212525">Re: Croissant 9 remake</a></div>
    <div class="body"><div class="quote"><br />Scali, is the functionality of your project similar to <a target="_blank" href="http://www.libsdl.org">http://www.libsdl.org</a> in terms of D3D and OpenGL? Is it simpler or more complex? I&#039;ve used libsdl before ( not extensively though) for some quick and dirty graphics programming in C and was curious as to your viewpoint on the comparison.<br /></div><br /><br />I think my goal is slightly different from SDL.<br />SDL tries to be a sort of DirectX (audio, video, input etc) API, where I work a level higher. What I do is closer to a 3D engine project such as Ogre.<br />I have wrapped the API-specific functionality into a few classes, so you don&#039;t have to deal with the D3D or OpenGL API directly, in many cases.<br /><br />So yes, with this framework it&#039;s simple to get things on screen, but if you want to extend the functionality, you still need to get down-and-dirty with the API directly. I don&#039;t try to abstract the API itself, I try to abstract it one level higher.</div>
    <div class="meta">Posted on 2010-08-03 03:23:52 by Scali</div>
   </div>
   <div class="post" id="post-212526">
    <div class="subject"><a href="#post-212526">Re: Croissant 9 remake</a></div>
    <div class="body"><div class="quote"><br />Scali, could you please post here the World/Model, View, and Projection matrices captured from any valid frame (it may be from the frame visible in the image you attached). I&#039;m somehow getting strange perspective artifacts in OpenGL so I&#039;d like to see a working set of matrices to compare them with my own ones. I copy-pasted my transformation functions directly from one of my D3D9 projects and that&#039;s the root of the problem, I think. Specifically I suspect row-major vs column-major order and -1.0 - +1.0 device-normalized space in OGL vs 0.0 - +1.0 in D3D9. What do you think? The other suspects are badly set up vertex arrays / VBOs, but I&#039;d like to confirm the matrices first.<br /><br />Please post the matrices in the order returned by glGetFloatv() or in the order you pass them to glLoadMatirix / glLoadTransposeMatrix / etc.<br /></div><br /><br />The row-major/column-major thing doesn&#039;t affect you in practice. It is cancelled out because OpenGL uses column vectors (M*v) where D3D uses row vectors (v*M).<br />This means that the matrices appear exactly the same in memory (they are implicitly transposed because of the storage difference).<br />The order in which you multiply matrices is reversed between OpenGL and D3D though. So if you do A*B in D3D, you need to do B*A in OpenGL and vice versa.<br /><br />I&#039;m at work now, so I can&#039;t access my code and put some dumps in.<br />However, it&#039;s open source, so you could do it yourself.<br />You can grab the source from SVN from this project: http://sourceforge.net/projects/bhmfileformat/<br />Then you can just add your matrix dump code yourself.<br /><br />I know one problem I ran into is that the gluPerspective function takes degrees where D3DX&#039;s perspective matrix generation function takes radians. So when I plugged the D3D values in, things looked weird :)<br /></div>
    <div class="meta">Posted on 2010-08-03 03:31:25 by Scali</div>
   </div>
   <div class="post" id="post-212527">
    <div class="subject"><a href="#post-212527">Re: Croissant 9 remake</a></div>
    <div class="body">Think I better disagree here, &nbsp;they are not the same memory layout, otherwise the order of multiplication would not matter.<br />You are right that you CAN use the same memory layout - but it is actually incorrect to do so.<br /><br />Row and Column Major are ARRAY ORDERING SYSTEMS, ie, they dictate the naming convention of the array cells.<br />The difference between left and right handed coordinate systems is simply that one is the Transpose of the other. <br />If you adjust your memory layout correctly, you won&#039;t need to reverse the order of the elements in multiplications.<br /><br /><br />Affine 4x4 Transformation Matrix Layouts:<br /><br />DirectX &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OpenGL<br />m00 m01 m02 m03 &nbsp; &nbsp;m00 &nbsp;m10 m20 m30<br />m10 m11 m12 m13 &nbsp; &nbsp;m01 &nbsp;m11 m21 m31<br />m20 m21 m22 m23 &nbsp; &nbsp;m02 &nbsp;m12 m22 m32<br />m30 m31 m32 m33 &nbsp; &nbsp;m03 &nbsp;m13 m23 m33<br /><br />Xx &nbsp; Xy &nbsp; Xz &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Xx &nbsp; Yx &nbsp; &nbsp; Zx &nbsp; &nbsp;Px<br />Yx &nbsp; Yy &nbsp; Yz &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Xy &nbsp; Yy &nbsp; &nbsp; Zy &nbsp; &nbsp;Py<br />Zx &nbsp; Zy &nbsp; Zz &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Xz &nbsp; &nbsp;Yz &nbsp; &nbsp;Zz &nbsp; &nbsp; Pz<br />Px &nbsp; Py &nbsp; Pz &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp;1<br /><br />Please feel free to disagree, if you choose, but if you take my word for this, and simply rename the fields in your structure, and your matrix functions address fields by name (as mine do), then your functions will work with no changes.<br />By renaming the fields / changing the memory layout, you are effectively pre-transposing the matrix.<br /><br />My matrix math function includefile has a simple switch I use to choose one matrix layout or the other, the functions will work in both systems :)<br /><br /></div>
    <div class="meta">Posted on 2010-08-03 07:26:20 by Homer</div>
   </div>
   <div class="post" id="post-212528">
    <div class="subject"><a href="#post-212528">Re: Croissant 9 remake</a></div>
    <div class="body">They ARE the same memory layout. If you look at the BHM parser, you can clearly see that.<br />The BHM format was aimed at D3D, and exports matrices as a blob of 16 floats in a D3DXMATRIX layout.<br />These are used as-is in the OpenGL code. They are not transposed, because there is no need to.<br /><br />Since OpenGL uses column vectors, technically you&#039;d need the transpose of the matrix used in D3D, which uses row vectors... as I said, M*v vs v*M.<br />Or more accurately: M*v and (v^T)*(M^T).<br />This is why the matrix multiplication order is different.<br />Namely (A*B)^T == (B^T)*(A^T).<br /><br />However, since OpenGL *also* uses column major storage (Fortran-style), it stores the elements in the array the other way around, compared to D3D (C/C++ style).<br />So, yes... From a mathematical point-of view, it looks like this:<br />DirectX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  OpenGL<br />m00 m01 m02 m03&nbsp; &nbsp; m00&nbsp; m10 m20 m30<br />m10 m11 m12 m13&nbsp; &nbsp; m01&nbsp; m11 m21 m31<br />m20 m21 m22 m23&nbsp; &nbsp; m02&nbsp; m12 m22 m32<br />m30 m31 m32 m33&nbsp; &nbsp; m03&nbsp; m13 m23 m33<br /><br />But when it is written to memory, they both write it out as a linear sequence, in both cases resulting in:<br />m00 m01 m02 m03 m10 m11 m12 m13 m20 m21 m22 m23 m30 m31 m32 m33.<br /><br />In other words, your array indices are the same in D3D and OpenGL, whether you use matrix(i) or matrix(x)(y). The memory layout is the same.<br /><br />The difference is the MEANING of x and y. In OpenGL, x are the columns, y are the rows. In D3D, x are the rows, and y are the columns.<br />As I say, transposition is implicit.<br /><br />Look at my GLUX library, which has nearly identical functionality to the D3DX library. You can see how it uses the matrices and vectors.<br />I actually have an important note in my GLMatrix definition in GLTypes.h:<br /><pre><code>/**<br /> * Column-major matrix, compatible with OpenGL single precision GLfloat matrices.<br /> * Note that C++ is row-major oriented, so indexing is like this:<br /> * m;<br /> */<br />struct GLMatrix<br />{<br />&nbsp; &nbsp; &nbsp; &nbsp; GLfloat m[4][4];<br />&nbsp; &nbsp; &nbsp; &nbsp; operator GLfloat*() { return (GLfloat*)this; }<br />};</code></pre><br /></div>
    <div class="meta">Posted on 2010-08-03 07:41:55 by Scali</div>
   </div>
   <div class="post" id="post-212529">
    <div class="subject"><a href="#post-212529">Re: Croissant 9 remake</a></div>
    <div class="body">Yeah ok, I&#039;ll agree with that, the cells are indeed written out to memory in sequential order according to their names, meaning we can&#039;t simply treat them as 4 x Vec4 - theres something else too.<br /><br />I said that the only difference b/w left and right coordinate systems is that one is transpose of the other.<br />Almost true.<br /><br />Some of the 3x3 orientation part of the matrix gets its sign flipped.<br /></div>
    <div class="meta">Posted on 2010-08-03 07:48:08 by Homer</div>
   </div>
   <div class="post" id="post-212530">
    <div class="subject"><a href="#post-212530">Re: Croissant 9 remake</a></div>
    <div class="body"><div class="quote"><br />I said that the only difference b/w left and right coordinate systems is that one is transpose of the other.</div><br /><br />But left-handed vs right-handed coordinate systems are another issue altogether. Both APIs support either way, depending on what projection matrix you use.</div>
    <div class="meta">Posted on 2010-08-03 07:51:39 by Scali</div>
   </div>
   <div class="post" id="post-212544">
    <div class="subject"><a href="#post-212544">Re: Croissant 9 remake</a></div>
    <div class="body">Your argument was actually helpful. Thanks guys ^^ You should argue more aften ;p<br /><br />Anyway, I managed to make things work correctly. Turned out to be a badly set up view matrix (the middle one between world/model and projection). I was loading it via LoadTransposeMatrix so its effect was exactly the opposite of what I wanted. I really don&#039;t know what was LoadTransposeMatrix doing there ^^&#039;<br /><br />Now I have another problem which is quite puzzling. I set up the projection matrix with D3DXMatrixPerspectiveFovLH. One of its parameters is aspect ratio. I put width divided by height there (both values converted to floats before the division). It works correctly when I increase the width (thus increasing the ratio), but seems to be broken when I increase the height (thus decreasing the ratio). Please try it yourself (attachment) and tell me what you think. Basically, I want the cube&#039;s size to remain unchanged when only one of the coordinates changes, just like it is now with width.<br /><br />The relevant parts of the code are:<br /><pre><code><br />// APPDATA (ad) is a superstructure which holds pretty much everything.<br /><br />// The following is called every time the window&#039;s size changes:<br />if (ad-&gt;newW || ad-&gt;newH) { // if there is new width or height<br /> &nbsp;glViewport(0, 0, ad-&gt;newW, ad-&gt;newH);<br /> &nbsp;ad-&gt;oldW = ad-&gt;newW;<br /> &nbsp;ad-&gt;oldH = ad-&gt;newH;<br /> &nbsp;ad-&gt;newW = ad-&gt;newH = 0;<br /> &nbsp;setupPerspective(ad);<br />}<br /><br />VOID setupPerspective(APPDATA *ad) {<br /> &nbsp;D3DXMATRIX tmpmat;<br /><br /> &nbsp;ad-&gt;aspect = (FLOAT)(((FLOAT)(ad-&gt;oldW)) / ((FLOAT)(ad-&gt;oldH)));<br /> &nbsp;ad-&gt;d3dxf.D3DXMatrixPerspectiveFovLH(&amp;(ad-&gt;proj), (FLOAT)ToRad(40.0), ad-&gt;aspect, 0.1f, 10.0f);<br /> &nbsp;glMatrixMode(GL_PROJECTION);<br /> &nbsp;glLoadMatrixf((ad-&gt;proj.m[0]));<br />}<br /></code></pre><br /><br />I also noticed that glFinish performs a busy-wait (consuming a CPU core). I think it&#039;s related to <a target="_blank" href="http://www.nvnews.net/vbulletin/showthread.php?t=131319">this bug</a>. Is there any known workaround except not using glFinish? Not that I need glFinish for anything. I&#039;m just curious if there is any way to make it sleep instead of wasting CPU cycles.</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=3232" target="_blank">ogltest2.zip</a></li>
      <li><a href="../../attachments/?id=3233" target="_blank">Image1.png</a></li>
      <li><a href="../../attachments/?id=3235" target="_blank">Image2.png</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2010-08-04 13:52:22 by ti_mo_n</div>
   </div>
   <div class="post" id="post-212576">
    <div class="subject"><a href="#post-212576">Re: Croissant 9 remake</a></div>
    <div class="body">Your sourcecode for the setupPerspective function has variables called &quot;oldW&quot; and &quot;oldH&quot; - are these the OLD width and height??<br />You should use the CURRENT values in your call to set the perspective.<br />But the size of the cube on the screen, in pixels, is based on more than just the aspect ratio.<br />It also depends on the viewing distance, of course, with respect to the dimensions of the render device.<br /></div>
    <div class="meta">Posted on 2010-08-08 05:01:47 by Homer</div>
   </div>
   <div class="post" id="post-212577">
    <div class="subject"><a href="#post-212577">Re: Croissant 9 remake</a></div>
    <div class="body">Hi! Thank you for answering :) OldW and oldH are being set with the values from newW and newH before calling setupPespective. The cube becomes bigger ONLY with aspect ratios lower than 1.3333. For aspect ratios 1.3333 and above, its size remains unchanged (it only centers itself). Pretty strange. I never hand such problem in Direct3D.</div>
    <div class="meta">Posted on 2010-08-08 08:07:58 by ti_mo_n</div>
   </div>
   <div class="post" id="post-212786">
    <div class="subject"><a href="#post-212786">Re: Croissant 9 remake</a></div>
    <div class="body">Have you found your problem yet?<br />I think the projection matrix is pretty much the only matrix that is not the same in D3D and OpenGL, because of the different &#039;device space&#039; coordinate systems.<br />I&#039;d have to look into what the differences were exactly, because I don&#039;t remember them off the top of my head, but I recall that using a custom projection matrix for z=infinity required custom code for both APIs.<br /><br />But have you tried just using gluPerspective instead of D3DXMatrixPerspectiveFovRH?<br />That&#039;s what I do in my code currently. You can feed them pretty much the same parameters. You could compare the different matrices that they generate from the same parameters.<br /><br />OpenGL generates it like such:<br />http://www.opengl.org/sdk/docs/man/xhtml/gluPerspective.xml<br /><pre><code><br />f=cotangent (fovy/2)<br /><br />f/aspect&nbsp;  0&nbsp;  0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0 <br />0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f&nbsp;  0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0 <br />0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp;  zFar+zNear / zNear&#8722;zFar&nbsp;  2&#215;zFar&#215;zNear / zNear&#8722;zFar <br />0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp;  -1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</code></pre><br /><br />And Direct3D generates it like such:<br />http://msdn.microsoft.com/en-us/library/bb205351(v=VS.85).aspx<br /><pre><code><br />xScale&nbsp;  0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br />0&nbsp; &nbsp; &nbsp; &nbsp; yScale&nbsp; &nbsp; &nbsp;  0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br />0&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; zf/(zn-zf)&nbsp; &nbsp; &nbsp; &nbsp; -1<br />0&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; zn*zf/(zn-zf)&nbsp; &nbsp; &nbsp; 0<br />where:<br />yScale = cot(fovY/2)<br />&nbsp; &nbsp; <br />xScale = yScale / aspect ratio</code></pre><br /><br />Rewriting OpenGL to D3D&#039;s syntax would yield:<br /><pre><code><br />xScale&nbsp;  0&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0 <br />0&nbsp; &nbsp; &nbsp; &nbsp; yScale&nbsp;  0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0 <br />0&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; zf+zn/(zn&#8722;zf)&nbsp;  2*zn*zf/(zn&#8722;zf) <br />0&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</code></pre><br /><br />So apart from the transpose notation, the only difference is these two entries:<br />zf/(zn-zf) -&gt; zf+zn/(zn&#8722;zf) (translated by a factor zn)<br />zn*zf/(zn-zf) -&gt; 2*zn*zf/(zn&#8722;zf) (scaled by a factor 2)<br />(These differences basically encode the different 0..1 and -1..1 depth-ranges between the two APIs).<br /><br />So gluPerspective is right-handed.<br />If you compare D3DMatrixPerspectiveFovLH vs RH, you&#039;ll see that basically only the sign of the third row is flipped (which would be the third column in OpenGL). In other words, the direction of the z-axis is inverted. The element at m32 is also rewritten to re-use the (zf-zn) term, but essentially does not change. So it&#039;s easy to construct a left-handed projection matrix for OpenGL as well:<br /><pre><code><br />xScale&nbsp;  0&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0 <br />0&nbsp; &nbsp; &nbsp; &nbsp; yScale&nbsp;  0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0 <br />0&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; zf+zn/(zf&#8722;zn)&nbsp;  -2*zn*zf/(zf&#8722;zn) <br />0&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0</code></pre></div>
    <div class="meta">Posted on 2010-08-18 04:27:54 by Scali</div>
   </div>
   <div class="post" id="post-212790">
    <div class="subject"><a href="#post-212790">Re: Croissant 9 remake</a></div>
    <div class="body">That&#039;s a great post, Scali :)<br />At some point, I know I&#039;m going to search here for that info (my brain is more like a sieve each year), and I certainly haven&#039;t ever posted that before, I figure this will be the top result :)<br /></div>
    <div class="meta">Posted on 2010-08-18 07:42:47 by Homer</div>
   </div>
   <div class="post" id="post-212792">
    <div class="subject"><a href="#post-212792">Re: Croissant 9 remake</a></div>
    <div class="body">I simply use D3DXMatrixPerspectiveFovLH in OpenGL. I recently had a problem with it resizing my geometry but I&#039;ve already solved it. The resize was because of X scale being calculated based on Y scale. That&#039;s why the geometry resized only when the height of the window changed.<br /><br />Anyway, Is there any reason not to use D3DXMatrixPerspectiveFovLH ? I know it&#039;s a simple matrix math function and can be easily hand-written. I&#039;m just curious if I should be aware of any problems one might encounter in the future.</div>
    <div class="meta">Posted on 2010-08-18 09:36:28 by ti_mo_n</div>
   </div>
   <div class="post" id="post-212793">
    <div class="subject"><a href="#post-212793">Re: Croissant 9 remake</a></div>
    <div class="body">Portability - it can only work on Windows operating systems.<br />And it&#039;s not a big deal to write your own, which I suggest will be better, having seen the kind of crud behind some DX matrix functions.</div>
    <div class="meta">Posted on 2010-08-18 10:03:32 by Homer</div>
   </div>
   <div class="post" id="post-212794">
    <div class="subject"><a href="#post-212794">Re: Croissant 9 remake</a></div>
    <div class="body">Well, I suppose using the D3D projection matrix will mean that you&#039;re only using half your zbuffer&#039;s resolution.</div>
    <div class="meta">Posted on 2010-08-18 11:34:07 by Scali</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=30124&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=30124&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="30124" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=30124&amp;page=2">&gt;</a><a href="../?id=30124&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>