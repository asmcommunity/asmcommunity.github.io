<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Virus protection. - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=300" />
    <link rel="next" href="../?id=300&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=300">Virus protection.</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=300&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=300&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="300" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=300&amp;page=2">&gt;</a><a href="../?id=300&amp;page=2">&raquo;</a></form>   <div class="post" id="post-1558">
    <div class="subject"><a href="#post-1558">Virus protection.</a></div>
    <div class="body">I know absolutely *nothing* about Virus and Trojans and<br />i would like to spend my time at other things that learning<br />these stupidities.<br /><br />Please, the great guys, here:<br /><br />As SpAsm will certainaly gender some files exchanges, i am<br />searching for a way to absolutely prevent a SpAsm produced<br />PE from ever being corrupted that way.<br /><br />Is the Checksum PE record a good way (i could store it with <br />another algo, if win doesn't care, or somewhere else...).<br /><br /><br />betov.</div>
    <div class="meta">Posted on 2001-07-21 09:51:42 by Betov</div>
   </div>
   <div class="post" id="post-1607">
    <div class="subject"><a href="#post-1607">Virus protection.</a></div>
    <div class="body">No answer? May be i asked the question a wrong way...<br /><br />-It seems that we can do what we want with the CheckSum<br />PE header record. Is it true?<br /><br />-Infected EXEs must have something changed inside. When<br />loading them intirely in memory, we should see this when<br />recomputing the CheckSum (with an 'unregular' algo, of<br />course). Is it true?<br /><br />betov.</div>
    <div class="meta">Posted on 2001-07-21 18:39:52 by Betov</div>
   </div>
   <div class="post" id="post-1610">
    <div class="subject"><a href="#post-1610">Virus protection.</a></div>
    <div class="body">Betov,<br /><br />For a binary virus to work, it must branch somewhere before the entry point and I think this is what you need to be able to detect. You have the advantage of setting up your own PE header and sections.<br /><br />The problem with a preset method of testing is that the virus can overwrite it and branch to where its own code is executed. Perhaps a checksum of the PE header and sections will be of some use but the problem is that it can be bypassed at startup.<br /><br />I think your idea is a good one in that if the virus attempts to return program execution to the original code after it has run, it should be able to be determined and present a warning to the user about it being modified.<br /><br />Most of the crude techniques can be detected by heuristic virus scanners these days so if you can get an idea ofd what there capacity is, you may be able to work out a method to protect the rest.<br /><br />Regards,<br /><br /><a href="mailto:hutch@pbq.com.au">hutch@pbq.com.au</a></div>
    <div class="meta">Posted on 2001-07-21 19:21:09 by hutch--</div>
   </div>
   <div class="post" id="post-1619">
    <div class="subject"><a href="#post-1619">Virus protection.</a></div>
    <div class="body">betov,<br /><br />if you still dont solved these problems, email me at <a href="mailto:vecna@antisocial.com">vecna@antisocial.com</a> and i can help you in this<br /><br />ancev</div>
    <div class="meta">Posted on 2001-07-21 20:55:05 by ancev</div>
   </div>
   <div class="post" id="post-1626">
    <div class="subject"><a href="#post-1626">Virus protection.</a></div>
    <div class="body">Betov, such a scheme would be of more annoyance than good.<br />First of all, there's no way you can prevent all virii. Second, you<br />make it impossible for the &quot;normal&quot; user to, for example, use an<br />exepacker on your files.<br /><br />False/flawed security (regarding virii) is, imho, worse than no security<br />at all. Because then you at least know that you're pretty damn<br />vulnerable.<br /><br />My advice is to let the end users run antiviral programs. They can<br />be upgraded easily, and it's then up to the end-user to find a<br />solution he likes.</div>
    <div class="meta">Posted on 2001-07-21 21:47:12 by f0dder</div>
   </div>
   <div class="post" id="post-1637">
    <div class="subject"><a href="#post-1637">Virus protection.</a></div>
    <div class="body">Thanks to all. There is a point i may have been missleading:<br /><br />My intent is not to setup any true anti-virus thing. The <br />problem i would like to suppress is bound to the fact that<br />SpAsm users will tend, in the futur, to exchange SpAsm<br />produced PE (instead of only the code, to have the whole<br />thing at once).<br /><br />When Asm programmers exchange PEs, there are a perfect target<br />for viruses'expand (for all the reasons you all know).<br /><br />As we can expect that nobody will ever write a virus specificly<br />designed to target SpAsm produced PEs, i could as well write a<br />naive and simple CheckSum computation to be done both when<br />compiling the file and when loading the file.  If the results<br />are different, SpAsm would just print a MessageBox telling it<br />to the programmer who opens the file (this does absolutely not <br />concern final users).<br /><br />This idea has any interrest if, and only if, a corrupted file<br />have something different, readable, inside. Reversing the <br />question: If we have 2 versions of one given file, first<br />not corrupted, second corrupted, is it possible that they<br />both have the same octets sum when intirely loaded in Memory.<br />(i hope never...).</div>
    <div class="meta">Posted on 2001-07-22 00:26:54 by Betov</div>
   </div>
   <div class="post" id="post-1643">
    <div class="subject"><a href="#post-1643">idea</a></div>
    <div class="body">Hi<br /><br />dont know if this works...just a idea.<br /><br />what if the file has inside a copy of itself and when execute it look if the original and the copy inside is the same....if not terminate.<br /><br />ok ,the size will double...but in asm i think it no problem :)<br /><br />cu</div>
    <div class="meta">Posted on 2001-07-22 04:00:43 by CodeMonkey</div>
   </div>
   <div class="post" id="post-1658">
    <div class="subject"><a href="#post-1658">Virus protection.</a></div>
    <div class="body">Or if the virus packs the exe and after loaded it runs the original exe as a different process and hides the original exe ?<br />That would be a problem .....;)</div>
    <div class="meta">Posted on 2001-07-22 06:52:48 by Rosky</div>
   </div>
   <div class="post" id="post-1663">
    <div class="subject"><a href="#post-1663">Virus protection.</a></div>
    <div class="body">Well, I think it's possible to do &quot;fancy stuff&quot; when using standard<br />CRC's. CRC16, CRC32 can be defeated this way. Probably also<br />microsofts checksum thing :/.</div>
    <div class="meta">Posted on 2001-07-22 10:27:28 by f0dder</div>
   </div>
   <div class="post" id="post-1683">
    <div class="subject"><a href="#post-1683">the man with the golden stub</a></div>
    <div class="body">what about custom stub?</div>
    <div class="meta">Posted on 2001-07-22 14:11:53 by disease_2000</div>
   </div>
   <div class="post" id="post-1702">
    <div class="subject"><a href="#post-1702">Virus protection.</a></div>
    <div class="body">i think that nearly al PE infectors will change either the entry point in the PE header, or will make the e_lfsanew part of the dos header point to a new PE header that the virus copies to the end of the host.<br /><br />checking both of these should do the trick</div>
    <div class="meta">Posted on 2001-07-22 18:36:34 by SubHuman</div>
   </div>
   <div class="post" id="post-1750">
    <div class="subject"><a href="#post-1750">Virus protection.</a></div>
    <div class="body">Since there is a helluva lot of ways to do the infections and entrupoint grabbing in a virus i don't really think there is a sure fire way to prevent or detect that part of it... checksums is a good idea but can be defeated... WinNT/2k uses it on some of the corefiles.... user32.dll, kernel32.dll and so on... there are a number of viruses that infect these files and they just update the checksum... same thing with cracks ad patches and stuff... good luck though... it would be nice to see somthing like this that actually works...<br /><br />P.S ancev.... are you who I think you are? (based on you e-mail)</div>
    <div class="meta">Posted on 2001-07-23 04:14:27 by NervGaz</div>
   </div>
   <div class="post" id="post-1820">
    <div class="subject"><a href="#post-1820">Virus protection.</a></div>
    <div class="body">what's the problem? the only thing you have to do<br />is to store the &quot;clean&quot; file-size in the exe file and<br />i would not use the checksum for this because nt<br />needs a valid value i think(?)... but there are several<br />reserved places in the pe-header you can use.<br />if the user loads a spasm pe just compare the actual<br />filesize with the clean size in the pe-header. <br /><br />disease, why should a custom stub help???</div>
    <div class="meta">Posted on 2001-07-23 18:54:34 by Unregistered</div>
   </div>
   <div class="post" id="post-1833">
    <div class="subject"><a href="#post-1833">Virus protection.</a></div>
    <div class="body">NervGaz,<br /><br />this depend of who you're thinking i am. but the e-mail addres is correct. :alright: <br /><br />ancev</div>
    <div class="meta">Posted on 2001-07-23 21:15:43 by ancev</div>
   </div>
   <div class="post" id="post-1853">
    <div class="subject"><a href="#post-1853">Virus protection.</a></div>
    <div class="body"><div class="quote"><br />NervGaz,<br /><br />this depend of who you're thinking i am. but the e-mail addres is correct. :alright: <br /><br />ancev </div><br /><br />Nevermind doesn't really matter anyhow.. :)<br /><br />Unregistered... there are ways to infect files without increasing the filesize... overwriting cavities (NULL bytes, large ammounts of NOP's and so on)and stuff like that... so your idea is not exactly foolproof.. and as far as i know NT only checks certain files for the checksum...</div>
    <div class="meta">Posted on 2001-07-24 02:27:26 by NervGaz</div>
   </div>
   <div class="post" id="post-1856">
    <div class="subject"><a href="#post-1856">Virus protection.</a></div>
    <div class="body">ancev,<br /><pre><code><br />    .data<br />      name1 db &quot;ancev&quot;,0<br />      name2 db &quot;     &quot;,0<br />      greet db &quot;Hi &quot;,0<br />      buffr db 32 dup &#40;0&#41;<br />      hello db &quot;Hello&quot;,0<br />    .code<br /><br />    invoke revstr,ADDR name1,ADDR name2<br />    invoke szMultiCat,2,ADDR buffr,ADDR greet,ADDR name2<br /><br />    invoke MessageBox,hWnd,ADDR buffr,ADDR hello,MB_OK<br /><br />    Output =&gt; Hi vecna<br /></code></pre><br /><br />Regards,<br /><br /><a href="mailto:hutch@pbq.com.au">hutch@pbq.com.au</a> :alright:</div>
    <div class="meta">Posted on 2001-07-24 02:44:42 by hutch--</div>
   </div>
   <div class="post" id="post-1872">
    <div class="subject"><a href="#post-1872">Virus protection.</a></div>
    <div class="body">Thanks to all, guys, choice done and applied.<br /><br />Got time to play the fool Hutch??? ;)<br /><br />betov.</div>
    <div class="meta">Posted on 2001-07-24 06:15:08 by Betov</div>
   </div>
   <div class="post" id="post-1876">
    <div class="subject"><a href="#post-1876">Virus protection.</a></div>
    <div class="body">nergaz,<br />yes it is true that some viruses check the alignment<br />first and decide if they are small enough to paste<br />themselves in that section but that is very seldom<br />i think (hm lord julus did it with rammstein i think).<br />what if betov stores a checksum of the clean size<br />instead of the filesize in the pe? this would be very<br />easy to do and a 100% save virus/manipulation <br />detection...</div>
    <div class="meta">Posted on 2001-07-24 07:01:51 by Unregistered</div>
   </div>
   <div class="post" id="post-1878">
    <div class="subject"><a href="#post-1878">Virus protection.</a></div>
    <div class="body">checksum of the clean FILE i meant :(</div>
    <div class="meta">Posted on 2001-07-24 07:04:44 by Unregistered</div>
   </div>
   <div class="post" id="post-1890">
    <div class="subject"><a href="#post-1890">Virus protection.</a></div>
    <div class="body">there are actually several that use cavity infection... and checksums are good better than filesize stuff.. but in no way foolproof...</div>
    <div class="meta">Posted on 2001-07-24 09:31:32 by NervGaz</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=300&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=300&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="300" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=300&amp;page=2">&gt;</a><a href="../?id=300&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>