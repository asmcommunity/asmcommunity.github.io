<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>.data Vs .data? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=19183" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=19183">.data Vs .data?</a></p>
   <div class="post" id="post-148316">
    <div class="subject"><a href="#post-148316">.data Vs .data?</a></div>
    <div class="body"><div class="quote">.DATA    This section contains initialized data of your program. <br />.DATA?  This section contains uninitialized data of your program. Sometimes you just want to preallocate some memory but don't want to initialize it. This section is for that purpose. The advantage of uninitialized data is: it doesn't take space in the executable file. For example, if you allocate 10,000 bytes in your .DATA? section, your executable is not bloated up 10,000 bytes. Its size stays much the same. You only tell the assembler how much space you need when the program is loaded into memory, that's all. <br /></div><br />O_o How is that possible? I come from C and there is nothing similar to this in C. Firsst of all in .DATA? how can you allocate memory and the executable and the executable's size will remain the same?  I don't get the explanation the writter gives there. <br /><br />Anybody to help me? In both cases you have bits. What if they are random and what if they are initialized... why is there that difference..?<br /><br />pls help thanks in advance.</div>
    <div class="meta">Posted on 2004-08-18 16:18:22 by patriziacharms993</div>
   </div>
   <div class="post" id="post-148320">
    <div class="subject"><a href="#post-148320">.data Vs .data?</a></div>
    <div class="body">I am not an expert on this but maby the exe tells the OS to allocate this memory on runtime, therefore the compiled exe should contain only info on the type of allocatation  and the number of times it should allocate it.<br /><br />So when the app is executed the following happend---<br /><div class="quote"><br />  00  01  02  03  04  05  06  07     ;*some data before .Data*<br /> <strong>00 00 00 00 00 00 00 00     ;.Data?</strong><br /> <strong>00 00 00 00 00 00 00 00</strong><br /> <strong>00 00 00 00 00 00 00 00</strong><br /> <strong>00 00 00 00 </strong> 08  09  0A  0B     ;*end of .Data*<br />  0C  0D  0E........................     ;App entry point<br /></div><br />(Side note: PE aka &quot;Portable Executable&quot; might play a big part in this -win32 apps- as i haven't look it up myself)<br /><div class="quote"><br />Source Code<br />.Data?<br />  SomeArray db 28 dup(?)  ;this could be one var or manny but the exe will not bloat.....<br /></div><br />Hence the program is placed in memory in the correct spaced ammounts. The exe therefore does not directly grow according to the needed memory ammount. (.Data? : runtime resolution of values and so no meaningfull values to store except for the size and type of var boundries )<br /><br />HLL - uses manny data types to help with resolving bugs on compiletime (VC++ especially has manny), but all can fall into the basic catogories of byte:word:dword<br /><br />In C/C++ this is hidden away from the coder - a HLL trait incomparison to ASM. HLL compilers can do this aswell but it has to do with the HLL compilers interpitation of the vars that you have declared - if it is smart enough and you allocate a 500kb of unitilized data as a var then it should use this approach.<br /><br /><strong>Initilized</strong> Data: Implies that the application is depended upon the first value upon execution time and therefore stores the value in the exe statically. Text would count towards that. Specific colour values that you want in you app. This is referred to as being Hard-coded.<br /><strong>Unitilized</strong> Data: HWND data type would be a example as you do not know the value upon execution but only at runtime but you need to store this value for later reference. Now take an array - purpose doesn't matter - but if the contents will only be obtained at runtime then it will be placed under the .data? section. Like an array of HWND data types.<br /><br />Black iCE</div>
    <div class="meta">Posted on 2004-08-18 17:14:37 by Black iCE</div>
   </div>
   <div class="post" id="post-148323">
    <div class="subject"><a href="#post-148323">.data Vs .data?</a></div>
    <div class="body">Indeed, this is related to the PE format. The .data? section in MASM will create a special type of section in the executable that instructs the OS to allocate memory on runtime. So all it needs is the total size in bytes of this memory, and the address where it's supposed to be placed (so pointers will work).</div>
    <div class="meta">Posted on 2004-08-18 17:44:20 by QvasiModo</div>
   </div>
   <div class="post" id="post-148328">
    <div class="subject"><a href="#post-148328">.data Vs .data?</a></div>
    <div class="body"><div class="quote"><br />and the address where it's supposed to be placed (so pointers will work).<br /></div><br />I agree.<br /><br />My understanding:<br /><br />Generally speaking - pointers are referred through DWORD values that contain the addess of the data consirned in *relative* relation to applications loaded address. So if 2 instances of the app is loaded they are kept separate and the pointer will refere to the data consirned using the loaded apps address space as a way to relate to it.<br /><br /><strong>Relative Pointer</strong>:Relates to data through the apps address space. (OFFSET and ADDR)<br /><ul><br />[*]Usally not placed in any vars as it is calculated at runtime.<br /> <br /><strong>External Pointer</strong>:Relates to data outside its own address space -usally returned through an api as in SHGetMalloc.<br /><ul><br />[*]Usally placed under the .data? section.<br /> <br /><strong>Static Pointer</strong>:Hardcoded value -techinically speaking not a true pointer- but usefull for certain situations, and usally the coder's own protection scheme (messhing up the exe) or data contained within the exe added without system methods. Also the root of most illeagal activities.<br /><ul><br />[*]Placed under .data or relate to it through runtime techniques and modifying the returned value accordingly as not to relate to it directly.<br /> <br /><br />Black iCE</div>
    <div class="meta">Posted on 2004-08-18 18:46:01 by Black iCE</div>
   </div>
   <div class="post" id="post-148331">
    <div class="subject"><a href="#post-148331">.data Vs .data?</a></div>
    <div class="body">&quot;.DATA?&quot; doesn't even need an extra section - if the last section is read+write, the peheader.sizeofimage can just be expanded.<br /><br />Also, C/C++ *does* have this kind of storage that doesn't bloat the EXE file: &quot;int bigarray[500000]&quot; should use BSS (other name for uninitialized data) storage.<br /><br />This kind of storage is guaranteed to be zero-filled, by the way.</div>
    <div class="meta">Posted on 2004-08-18 19:15:05 by f0dder</div>
   </div>
   <div class="post" id="post-148334">
    <div class="subject"><a href="#post-148334">.data Vs .data?</a></div>
    <div class="body">f0dder - the discussion was ment to be on general terms. <br /><div class="quote"><br />Also, C/C++ *does* have this kind of storage that doesn't bloat the EXE file: &quot;int bigarray[500000]&quot; should use BSS (other name for uninitialized data) storage.<br /></div><br />Yes - but look at the original post, i was attempting to explain and keep it ss (simple stupid) :grin:. Speaking in techincal would prove no point on explaining bron's post. <br /><div class="quote"><br />if it is smart enough and you allocate a 500kb of unitilized data as a var then it should use this approach.<br /></div><br />so i just said that HLL <strong>do</strong> this but depending on wether it realizes that it can compile it in that manner.<br /><div class="quote"><br /><em>MSDN</em><br /><strong>int</strong><br />The keyword int specifies a 32-bit signed integer on 32-bit platforms...<br /></div><br />ie 500000*4=2000000bytes:rolleyes:<br />better to use &quot;BYTE bigarray[500000]&quot; if you are using my givin example.<br /><br />Black iCE</div>
    <div class="meta">Posted on 2004-08-18 19:30:26 by Black iCE</div>
   </div>
   <div class="post" id="post-148335">
    <div class="subject"><a href="#post-148335">.data Vs .data?</a></div>
    <div class="body">bron,<br /><br />The distinction is simple stuff once you get it. Some data must be initialised, text is a good example.<br /><pre><code><br />.data<br />  MyText db &quot;This is my text&quot;,0<br /></code></pre><br />When you need data like this in your app, it must be stored somewhere and when you use &quot;.data&quot; it means the data is stored in the INITIALISED data section.<br /><br />When you have data that can only be filled at runtime, you don't need to store that info in the INITIALISED data section so you can put it in the UNINITIALISED data section and save some space. It is often useful to make a set of handles global so you allocate the spoace for them in the .DATA? uninitialised data section like as follows.<br /><pre><code><br />.data?<br />hwnd dd ?<br />hedit dd ?<br />htoolbar dd ?<br />hstatus dd ?<br /></code></pre><br />Another choice is to allocate the data locally if you only need the data within a procedure and not globally.<br /><pre><code><br />LOCAL hCtrl&#58;DWORD<br />LOCAL rct&#58;RECT<br />LOCAL buffer&#91;260&#93;&#58;BYTE<br /></code></pre><br /><br />Regards,<br /><br />hutch at movsd dot com</div>
    <div class="meta">Posted on 2004-08-18 19:42:27 by hutch--</div>
   </div>
   <div class="post" id="post-148336">
    <div class="subject"><a href="#post-148336">.data Vs .data?</a></div>
    <div class="body"><strong>ice</strong>, I was commenting on the &quot;<em>I come from C and there is nothing similar to this in C.</em>&quot;. I wonder why I picked 500000, though - if I wanted 500kb I'd have used an unsigned char array, and 500*1024 (yes, I'm explicit like that when I want kilobyte :)).<br /><br />bron, things to keep in mind:<br />&quot;.data&quot; is initialized to whatever you initialize it to<br />&quot;.data?&quot; is initialized to zero<br />local storage goes on the stack, and have &quot;totally random&quot; contents.</div>
    <div class="meta">Posted on 2004-08-18 19:57:19 by f0dder</div>
   </div>
   <div class="post" id="post-148342">
    <div class="subject"><a href="#post-148342">.data Vs .data?</a></div>
    <div class="body"><div class="quote">&quot;.data?&quot; is initialized to zero. </div>Be careful !  No warrant !<br /><br />Auto insert &quot;Memory Clear Routine&quot; not in every assembler/compiler. <br /><br />Auto &quot;Memory Clear Service&quot; not in every O.S. <br /><br />if sizeof(.data?) is big, CPU clear they, need cost many machine cycles.<br /><br />Ex:<br /><pre><code>    .data?<br />    <br />szOut       db  big_number dup&#40;?&#41; <br /><br />    .code<br />    <br />; First R/W szOut&#91;&#93; routine after load the exefile.<br />    invoke    lstrcpy, addr szOut, addr szSource </code></pre><br />Do You want O.S Auto clear szOut[] when load the exefile every time?</div>
    <div class="meta">Posted on 2004-08-18 21:29:39 by </div>
   </div>
   <div class="post" id="post-148343">
    <div class="subject"><a href="#post-148343">.data Vs .data?</a></div>
    <div class="body">Kestrel - i have came across that problem before (That might have been while programming in DOS).But when using .data? it is best practice to assume that the data isn't zeroed. Or to clarify, any memory related allocation should <strong>not</strong> be assumed as being zeroed - only if documentation states diffrently may you savely regard it as zeroed.<br /><br />The point of .data? is to initilize it during runtime - so to assume it to have a value can cause a great deal of loss sleep and headaces if you don't realize where your problem might be in you app.<br /><br />(Side Note: So as to state that my example in my first replay is just an example, and that the zeroed bytes was aimed at making it obvoius that it belongs to the .data? section - bolding was added afterwards to make it stand out easily.)<br /><br />Black iCE</div>
    <div class="meta">Posted on 2004-08-18 21:32:33 by Black iCE</div>
   </div>
   <div class="post" id="post-148345">
    <div class="subject"><a href="#post-148345">.data Vs .data?</a></div>
    <div class="body"><div class="quote">How is that posible? ... how can you allocate memory and the executable and the executable's size will remain the same?</div><br /><br />When you click on a icon to run a programm, or you use other way for run a programm, there is also called a loader, that depend on the OS, yes th PE format have a lot to do here, this is readed by the loader, the relocations are done, the sections are initialized, the necesary thing for run your programm under the control of the operative systems is done there.<br /><br />For example, when the loader find the unitialized section .bss .data?... unitialized... it see how many bytes there are, and it allocate this spece at run-time (but with a pre-request in your code), like I know is filled with zeros. The diference, is like hutch say, you normally whant some data initialized and other no, but see that there exist diference with the memory allocations at runtime, done in the heap, that this memory is not guarantee that is filled with zero, while you know exactly how unitialized data you whant, hwnd, otherunitialized, you dont know how many (or much) whant with allocations at run-time. (Hope you get the idea :)<br /><br /><div class="quote"><br />Auto insert &quot;Memory Clear Routine&quot; not in every assembler/compiler. </div><br /><br />I dont understand that... the .data? sections is handled by the OS loader, pheraphs you refer to local variables? in the stack.<br /><br /><br />Have a nice day or night.</div>
    <div class="meta">Posted on 2004-08-18 22:15:36 by rea</div>
   </div>
   <div class="post" id="post-148352">
    <div class="subject"><a href="#post-148352">.data Vs .data?</a></div>
    <div class="body"><div class="quote">I dont understand that... the .data? sections is handled by the OS loader, pheraphs you refer to local variables? in the stack.</div><br />OS Loaded -&gt; exefile entry point, right?<br /><br />OK....!  But some exefile entry point is door of Coat. <br /><br />The Coat maybe added by compiler (or Linker, or IDE, or packer, or other).<br /><br />the Coat done something -&gt; Entry point (writed by Programmer).<br /><br />most Compilers to be add Coat (or add Super Big Coat). <br /><br />most Assembler don't add Coat (or add super light Coat) , so Asm exefile is pure always.</div>
    <div class="meta">Posted on 2004-08-19 01:50:48 by </div>
   </div>
   <div class="post" id="post-148358">
    <div class="subject"><a href="#post-148358">.data Vs .data?</a></div>
    <div class="body">Thanks for all the replies! First of al about C:<br /><pre><code><br />double data&#91;100000000&#93;;<br />int main&#40;&#41;<br />&#123;<br />   <br />&#125;<br /></code></pre><br /><pre><code><br />int main&#40;&#41;<br />&#123;<br />   double data&#91;100000000&#93;;<br />&#125;<br /></code></pre><br /><pre><code><br />int main&#40;&#41;<br />&#123;<br />   double data&#91;100000000&#93; = &#123;0&#125;;<br />&#125;</code></pre><br /><br />All these programs have the same size ( 24.5KB ). So how does the size of the .exe blows up when the data arre initialized in C?<br /><br />Now about assembly. ( guys don't post code because i am new to this and i don't understand anything... and i don't get along very well with terms too.. )<br />So you mean that i get the memory from the heap (with  .data?) at run time? <br /><br />and second:<br />&gt;&quot;.data?&quot; is initialized to zero<br />The global data are initialized to 0 like in C, but the locals have the random values like in C again, but both take their memory at run time?</div>
    <div class="meta">Posted on 2004-08-19 03:45:40 by patriziacharms993</div>
   </div>
  </div>
 </body>
</html>