<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>asm-DLL for use of SIMD in Delphi - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=16544" />
    <link rel="next" href="../?id=16544&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=16544">asm-DLL for use of SIMD in Delphi</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=16544&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=16544&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="16544" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=16544&amp;page=2">&gt;</a><a href="../?id=16544&amp;page=2">&raquo;</a></form>   <div class="post" id="post-128648">
    <div class="subject"><a href="#post-128648">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">Hi, I'm trying to code a dll with masm that should export functions using SIMD-instructions (XMM). These functions should be especially for the use of vector and matrix calculations, because for 3D-stuff it would be good to speed them up.<br /><br />Pieces of asm-code come from the book&quot;Real-time rendering and software technology&quot; from Alan Watt/Fabio Policarto.<br /><br />This following code is the dll-code that should export a mult-matrix function.<br />I try to use the Dll in Delphi, where I've declared a matrix as an array of 16 &quot;Singles&quot;, that means the array allocates 16 times 4 bytes. <br />The returned matrix is declared in the .data segment as m2, allocationg also 16 times 4 bytes (m2 dd dup 16). &quot;ths&quot; and &quot;m2&quot; are the matrices to be multiplied.<br /><br />My problem is, that Delphi returns an exception, and I guess I've done sth. wrong in my dll... I hope you can help me finding my error.<br /><br /><pre><code>.586<br />.xmm<br />.model flat, stdcall<br />option casemap&#58; none<br /><br />.data<br />  <br />  m2 dd 16 dup &#40;0.0&#41;<br /><br />.code<br /><br />MultMatrix proc ths&#58; DWORD, m1&#58; DWORD 	;this should be the adresses<br />                                                                                ; of the passed matrices<br />  mov edi, m1						<br />  <br />  movaps xmm4, &#91;edi&#93;<br />  movaps xmm5, &#91;edi+16&#93;<br />  movaps xmm6, &#91;edi+32&#93;<br />  movaps xmm7, &#91;edi+48&#93;<br /> <br />  mov esi, ths<br />  mov eax, 0<br />  <br />  L1&#58;<br />  movaps xmm0, &#91;esi+eax&#93;<br />  movaps xmm1, xmm0<br />  movaps xmm2, xmm0<br />  movaps xmm3, xmm0<br /> <br />  shufps xmm0, xmm2, 000h<br />  shufps xmm1, xmm2, 055h<br />  shufps xmm2, xmm2, 0AAh<br />  shufps xmm3, xmm3, 0FFh<br /> <br />  mulps xmm0, &#91;edi&#93;<br />  mulps xmm1, &#91;edi+16&#93;<br />  mulps xmm2, &#91;edi+32&#93;<br />  mulps xmm3, &#91;edi+48&#93;<br />  <br />  addps xmm0, xmm1<br />  addps xmm0, xmm2<br />  addps xmm0, xmm3<br />  <br />  movaps m2+eax,  xmm0  ; by the way - whats wrong with this line of code?<br />                                          ; my masm says its wrong use of registers <br />  <br />  add eax, 16 <br />  cmp eax, 48<br />  jle L1<br />  <br />  mov eax, offset m2           ; m2 should be the resulting matrix<br />  ret<br />MultMatrix endp<br /><br />DllMain proc 	hInstDll		&#58;DWORD,<br />				dwNotification	&#58;DWORD,<br />				lpReserved		&#58;DWORD<br />  ret<br />DllMain endp<br /><br />end</code></pre></div>
    <div class="meta">Posted on 2003-12-22 11:32:32 by mathias l.</div>
   </div>
   <div class="post" id="post-128650">
    <div class="subject"><a href="#post-128650">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">It might help if you told exactly which part of the code faults...<br /><br />Other than that, a couple of suggestions:<br />*) preserve registers. I assume you're importing the functions as STDCALL in your delphi code, and thus you must preserve esi+edi+ebx+ebp (ie, add &quot;uses esi edi&quot; to your MultMatrix proc).<br /><br />*) iirc, SSE data has to be 16-byte aligned - otherwise you'll get exceptions (well, unless you fiddle with the SSE control flag, then you'll just suffer from slow speed).</div>
    <div class="meta">Posted on 2003-12-22 11:59:36 by f0dder</div>
   </div>
   <div class="post" id="post-128652">
    <div class="subject"><a href="#post-128652">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">movaps m2+eax,  xmm0 <br /><br />Well, this is not an addressing mode. You cannot just add eax to the label in this way, maybe you meant this:<br /><br />lea ecx,<br />movaps , xmm0</div>
    <div class="meta">Posted on 2003-12-22 12:13:18 by donkey</div>
   </div>
   <div class="post" id="post-128653">
    <div class="subject"><a href="#post-128653">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">a label is a variable name is an offset... as long as you're not dealing with locals (which m2 isn't).<br />try:<br /><pre><code><br />movaps &#91;m2+eax&#93;, xmm0<br /></code></pre></div>
    <div class="meta">Posted on 2003-12-22 12:17:58 by f0dder</div>
   </div>
   <div class="post" id="post-128656">
    <div class="subject"><a href="#post-128656">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">Hi,<br />I tried assembling with<br /><pre><code>movaps &#91;m2+eax&#93;, xmm0</code></pre>, that seems to be the right way, although I still don't know if it works, but at least it let's me create the dll without assembling errors.<br />I've tried to push the four registers esi,edi,ebx,ebp at the beginning of the code and popped them afterwards, but still the exception occurs. <br /><br />To see exactly the position where the code faults, I tried several versions of the dll.<br />Its at the point <br /><pre><code>movaps xmm4, &#91;edi&#93;</code></pre><br />just at the beginning of the code. It must be because of  because I've tried &quot;movaps xmm4, xmm4&quot;, to see if it's a problem with the instruction &quot;movaps&quot;, but that worked!<br />So perhaps its really because of the 16-bit Data alignment... By now, I don't know how to tell Delphi, that it should align its Data on 16-bit. But I'll consult a Delphi Forum for that. <br /><br />I'll try to translate the text from the Delphi-Exception:<br /><br />GERMAN:<br />&quot;EPrivilege wird ausgel?st, wenn eine Anwendung versucht, eine Prozessoranweisung auszuf?hren, die in der gegenw?rtigen Prozessor-Vorrangstufe nicht zul?ssig ist.&quot;<br /><br />My ENGLISH:<br />&quot;The EPrivilege-Exception happens, if an application tries to execute a processor-command that is not admitted in the actual processor-priority-mode&quot;<br /><br /><br /><br />Thank you very much for any idea!</div>
    <div class="meta">Posted on 2003-12-22 13:40:32 by mathias l.</div>
   </div>
   <div class="post" id="post-128657">
    <div class="subject"><a href="#post-128657">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">Privilege exception - then it seems like it's the 16 <strong>byte</strong> (not bit) thing that's the problem - especially since it's with a mov instruction :). There's surely a way to change data alignment in delphi, otherwise you'll have to do it with dynamically allocated memory and manual fixups.</div>
    <div class="meta">Posted on 2003-12-22 13:54:13 by f0dder</div>
   </div>
   <div class="post" id="post-128713">
    <div class="subject"><a href="#post-128713">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">Well, I've consulted some Delphi-Forums, but the compiler-directive that was recommended to me seems not to be available at my version of Delphi. <br />So I'll try it with allocating the memory dynamically. What do you mean with manual fixups?</div>
    <div class="meta">Posted on 2003-12-23 06:17:16 by mathias l.</div>
   </div>
   <div class="post" id="post-128715">
    <div class="subject"><a href="#post-128715">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">&quot;manual fixups&quot; as in allocating requiredmem+16 bytes, and adjusting the pointer manually for 16byte alignment (of course saving the original pointer so you can free the memory again). There's bound to be ready-made implementations of this floating around, even for delphi. Note that this is a rather wasteful method for small allocs, there's a lot of strategies for improving on this.</div>
    <div class="meta">Posted on 2003-12-23 06:26:04 by f0dder</div>
   </div>
   <div class="post" id="post-128718">
    <div class="subject"><a href="#post-128718">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">mathias,<br /><br />f0dder ir right if you are making many small allocations but if you are making larger ones, dynamically aligning memory is very simple.<br /><br />Here is a MASM macro for memory alignment by powers of 2.<br /><pre><code><br />      memalign MACRO reg, number<br />        add reg, number - 1<br />        and reg, -number<br />      ENDM<br /></code></pre><br />&quot;number&quot; in the macro is an immediate number. You should be able to code the 2 instructions in Delphi inline asm to align the memory you allocate.<br /><pre><code><br />    add eax, 15<br />    and eax, -16<br /></code></pre><br />eax is the address of the memory you allocate.<br /><br />Regards,<br />http://www.asmcommunity.net/board/cryptmail.php?tauntspiders=in.your.face@nomail.for.you&amp;id=2f46ed9f24413347f14439b64bdc03fd</div>
    <div class="meta">Posted on 2003-12-23 07:49:11 by hutch--</div>
   </div>
   <div class="post" id="post-128958">
    <div class="subject"><a href="#post-128958">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">Hi, after having some christmas-action, I'd like to thank you all for helping me to find a solution realizing my SIMD-Dll. The MultMatrix function does work now, and if anyone's intrested in it, heres the asm-dll and the delphi code, that uses the dll:<br /><pre><code>.586<br />.xmm<br />.model flat, stdcall<br />option casemap&#58; none<br /><br />.code<br /><br />MultMatrix proc ths&#58; DWORD, m1&#58; DWORD, m2&#58;DWORD  	; This are two adresses of 4x4Matrices<br />									                ; which are 16*4 Bytes long<br />  push esi<br />  push edi<br />  push eax<br />  push edx<br /><br />  mov edi, m1<br /><br />  movaps xmm4, &#91;edi&#93;<br />  movaps xmm5, &#91;edi+16&#93;<br />  movaps xmm6, &#91;edi+32&#93;<br />  movaps xmm7, &#91;edi+48&#93;<br /><br />  mov esi, ths<br />  mov eax, 0<br /><br />  L1&#58;<br />  movaps xmm0, &#91;esi+eax&#93;<br />  movaps xmm1, xmm0<br />  movaps xmm2, xmm0<br />  movaps xmm3, xmm0<br /><br />  shufps xmm0, xmm2, 000h<br />  shufps xmm1, xmm2, 055h<br />  shufps xmm2, xmm2, 0AAh<br />  shufps xmm3, xmm3, 0FFh<br /><br />  mulps xmm0, &#91;edi&#93;<br />  mulps xmm1, &#91;edi+16&#93;<br />  mulps xmm2, &#91;edi+32&#93;<br />  mulps xmm3, &#91;edi+48&#93;<br /><br />  addps xmm0, xmm1<br />  addps xmm0, xmm2<br />  addps xmm0, xmm3<br /><br />  mov edx, m2<br />  add edx, eax<br />  movaps &#91;edx&#93;, xmm0<br /><br />  add eax, 16<br />  cmp eax, 48<br />  jle L1<br /><br />  pop edx<br />  pop eax<br />  pop edi<br />  pop esi<br /><br />  ret<br />MultMatrix endp<br /><br />DllMain proc 	hInstDll		&#58;DWORD,<br />				dwNotification	&#58;DWORD,<br />				lpReserved		&#58;DWORD<br />  ret<br />DllMain endp<br /><br />end</code></pre><br /><br />Delphi:<br /><br /><pre><code>unit Unit1;<br /><br />interface<br /><br />uses<br />  Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms, Dialogs,<br />  StdCtrls;<br /><br />type<br />  TMyMatrix = array&#91;0..15&#93; of Single;<br />  PMyMatrix = ^TMyMatrix;<br /><br />  TForm1 = class&#40;TForm&#41;<br />    Button1&#58; TButton;<br />    procedure Button1Click&#40;Sender&#58; TObject&#41;;<br />  private<br />    &#123; Private-Deklarationen &#125;<br /><br />  public<br />    &#123; Public-Deklarationen &#125;<br />  end;<br /><br />var<br />  Form1&#58; TForm1;<br /><br />procedure MultMatrix&#40;x, y, z&#58; Pointer&#41;; stdcall; external 'test.dll';<br /><br />implementation<br /><br />&#123;$R *.DFM&#125;<br /><br />procedure TForm1.Button1Click&#40;Sender&#58; TObject&#41;;<br />var<br />  pa, pb, pc&#58;         PMyMatrix;<br />  p1, p2, p3&#58;         Pointer;<br />  i&#58;                  Integer;<br /> begin<br /><br /><br />  GetMem&#40;p1, SizeOf&#40;TMyMatrix&#41;+15&#41;;<br />  pa&#58;= PMyMatrix&#40;&#40;Integer&#40;p1&#41;+$0F&#41; and $FFFFFFF0&#41;;<br />  ZeroMemory&#40;pa, SizeOf&#40;TMyMatrix&#41;&#41;;<br /><br />  GetMem&#40;p2, SizeOf&#40;TMyMatrix&#41;+15&#41;;<br />  pb&#58;= PMyMatrix&#40;&#40;Integer&#40;p2&#41;+$0F&#41; and $FFFFFFF0&#41;;<br />  ZeroMemory&#40;pb, SizeOf&#40;TMyMatrix&#41;&#41;;<br /><br />  GetMem&#40;p3, SizeOf&#40;TMyMatrix&#41;+15&#41;;<br />  pc&#58;= PMyMatrix&#40;&#40;Integer&#40;p3&#41;+$0F&#41; and $FFFFFFF0&#41;;<br />  ZeroMemory&#40;pc, SizeOf&#40;TMyMatrix&#41;&#41;;<br /><br />  for i&#58;=0 to 15 do pc^&#91;i&#93;&#58;=0.0;       // pc is an empty matrix, pa, bb are<br />                                       // arbitrary 4x4 Matrices<br /><br />  pa^&#91;00&#93;&#58;= 1.0; pa^&#91;01&#93;&#58;= 2.0; pa^&#91;02&#93;&#58;= 3.0; pa^&#91;03&#93;&#58;= 1.0;<br />  pa^&#91;04&#93;&#58;= 2.0; pa^&#91;05&#93;&#58;= 3.0; pa^&#91;06&#93;&#58;= 1.0; pa^&#91;07&#93;&#58;= 2.0;<br />  pa^&#91;08&#93;&#58;= 3.0; pa^&#91;09&#93;&#58;= 1.0; pa^&#91;10&#93;&#58;= 2.0; pa^&#91;11&#93;&#58;= 3.0;<br />  pa^&#91;12&#93;&#58;= 1.0; pa^&#91;13&#93;&#58;= 2.0; pa^&#91;14&#93;&#58;= 3.0; pa^&#91;15&#93;&#58;= 1.0;<br /><br />  pb^&#91;00&#93;&#58;= 3.0; pb^&#91;01&#93;&#58;= 2.0; pb^&#91;02&#93;&#58;= 1.0; pb^&#91;03&#93;&#58;= 3.0;<br />  pb^&#91;04&#93;&#58;= 2.0; pb^&#91;05&#93;&#58;= 1.0; pb^&#91;06&#93;&#58;= 3.0; pb^&#91;07&#93;&#58;= 2.0;<br />  pb^&#91;08&#93;&#58;= 1.0; pb^&#91;09&#93;&#58;= 3.0; pb^&#91;10&#93;&#58;= 2.0; pb^&#91;11&#93;&#58;= 1.0;<br />  pb^&#91;12&#93;&#58;= 3.0; pb^&#91;13&#93;&#58;= 2.0; pb^&#91;14&#93;&#58;= 1.0; pb^&#91;15&#93;&#58;= 3.0;<br /><br /><br /><br /><br />  MultMatrix&#40;pa, pb, pc&#41;;<br /><br />  //pc is the Result<br /><br />  FreeMem&#40;p1&#41;;<br />  FreeMem&#40;p2&#41;;<br />  FreeMem&#40;p3&#41;;<br />end;<br /><br />end.</code></pre><br /><br />Merry Christmas!</div>
    <div class="meta">Posted on 2003-12-26 05:54:02 by mathias l.</div>
   </div>
   <div class="post" id="post-128960">
    <div class="subject"><a href="#post-128960">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">Have you tried using MMXasm?<br /><a target="_blank" href="http://www.yks.ne.jp/~hori/MMXasm-e.html">http://www.yks.ne.jp/~hori/MMXasm-e.html</a></div>
    <div class="meta">Posted on 2003-12-26 06:29:03 by Delight</div>
   </div>
   <div class="post" id="post-129022">
    <div class="subject"><a href="#post-129022">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">mathias, be sure to return TRUE in your dllmain when it's called with DLL_PROCESS_ATTACH...</div>
    <div class="meta">Posted on 2003-12-27 01:16:13 by f0dder</div>
   </div>
   <div class="post" id="post-129030">
    <div class="subject"><a href="#post-129030">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">Hi Mathias !<br />You have done a excellent job. But, sorry, I have some ideas.<br />Why do you not use BASM in Delphi. Are you using Delphi 5 or above. BASM in Delphi supports all instructions found in the Intel Pentium III, Intel MMX extensions, Streaming SIMD Extensions (SSE), and the AMD Athlon (including 3D Now!).  I extract some note from Delphi Help:<br />&quot;The built-in assembler supports all of the Intel-documented opcodes for general application use. Note that operating system privileged instructions may not be supported. Specifically, the following families of instructions are supported:<br /><br />Pentium family<br />	Pentium Pro and Pentium II<br />	Pentium III<br />	Pentium 4<br /><br />Note:	Pentium 4 instructions are only supported on Windows.<br /><br />In addition, the built-in assembler supports the following instruction sets<br /><br />AMD 3DNow! (from the AMD K6 onwards)<br />	AMD Enhanced 3DNow! (from the AMD Athlon onwards)&quot;<br /><br />From your code, i modify it to use BASM in Delphi.  It run OK.<br />program Test;<br /><br />{$APPTYPE CONSOLE}<br /><br />uses<br />  Windows, SysUtils;<br /><br />type<br />  PMyMatrix = ^TMyMatrix;<br />  TMyMatrix = array[0..15] of Single;<br /><br />procedure MultMatrix(ths, m1, m2: Pointer);<br />asm<br />    // According to fastcall convention in Delphi<br />    // eax = ths, edx = m1, ecx = m2<br />    // We do not need to reserve eax, ecx and edx, only reserve esi, edi, ebx<br /><br />    push esi<br />    push edi<br /><br />    mov edi, m1<br /><br />    movaps xmm4, <br />    movaps xmm5, <br />    movaps xmm6, <br />    movaps xmm7, <br /><br />    mov esi, ths<br />    mov eax, 0<br /><br />@@L1:<br />    movaps xmm0, <br />    movaps xmm1, xmm0<br />    movaps xmm2, xmm0<br />    movaps xmm3, xmm0<br /><br />    shufps xmm0, xmm2, 000h<br />    shufps xmm1, xmm2, 055h<br />    shufps xmm2, xmm2, 0AAh<br />    shufps xmm3, xmm3, 0FFh<br /><br />    mulps xmm0, <br />    mulps xmm1, <br />    mulps xmm2, <br />    mulps xmm3, <br /><br />    addps xmm0, xmm1<br />    addps xmm0, xmm2<br />    addps xmm0, xmm3<br /><br />    mov edx, m2<br />    add edx, eax<br />    movaps , xmm0<br /><br />    add eax, 16<br />    cmp eax, 48<br />    jle @@L1<br /><br />    pop edi<br />    pop esi<br />end;<br /><br />procedure DoMult();<br />var<br />  pa, pb, pc: PMyMatrix;<br />  p1, p2, p3: Pointer;<br />  i: Integer;<br />begin<br />  GetMem(p1, SizeOf(TMyMatrix) + 15);<br />  pa := PMyMatrix((Integer(p1) + $0F) and $FFFFFFF0);<br />  ZeroMemory(pa, SizeOf(TMyMatrix));<br /><br />  GetMem(p2, SizeOf(TMyMatrix) + 15);<br />  pb := PMyMatrix((Integer(p2) + $0F) and $FFFFFFF0);<br />  ZeroMemory(pb, SizeOf(TMyMatrix));<br /><br />  GetMem(p3, SizeOf(TMyMatrix) + 15);<br />  pc := PMyMatrix((Integer(p3) + $0F) and $FFFFFFF0);<br />  ZeroMemory(pc, SizeOf(TMyMatrix));<br /><br />  for i := 0 to 15 do pc^<em> := 0.0; // pc is an empty matrix, pa, bb are<br />                                       // arbitrary 4x4 Matrices<br /><br />  pa^[00] := 1.0; pa^[01] := 2.0; pa^[02] := 3.0; pa^[03] := 1.0;<br />  pa^[04] := 2.0; pa^[05] := 3.0; pa^[06] := 1.0; pa^[07] := 2.0;<br />  pa^[08] := 3.0; pa^[09] := 1.0; pa^[10] := 2.0; pa^[11] := 3.0;<br />  pa^[12] := 1.0; pa^[13] := 2.0; pa^[14] := 3.0; pa^[15] := 1.0;<br /><br />  pb^[00] := 3.0; pb^[01] := 2.0; pb^[02] := 1.0; pb^[03] := 3.0;<br />  pb^[04] := 2.0; pb^[05] := 1.0; pb^[06] := 3.0; pb^[07] := 2.0;<br />  pb^[08] := 1.0; pb^[09] := 3.0; pb^[10] := 2.0; pb^[11] := 1.0;<br />  pb^[12] := 3.0; pb^[13] := 2.0; pb^[14] := 1.0; pb^[15] := 3.0;<br /><br />  MultMatrix(pa, pb, pc);<br /><br />  //pc is the Result<br />  FreeMem(p1);<br />  FreeMem(p2);<br />  FreeMem(p3);<br />end;<br /><br />begin<br />  DoMult();<br />  ReadLn;<br />end.<br /><br />Best regards !<br />TQN</div>
    <div class="meta">Posted on 2003-12-27 02:34:39 by TQN</div>
   </div>
   <div class="post" id="post-129033">
    <div class="subject"><a href="#post-129033">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body"><div class="quote"><br />Hi Mathias !<br />You have done a excellent job. But, sorry, I have some ideas.<br />Why do you not use BASM in Delphi. Are you using Delphi 5 or above. BASM in Delphi supports all instructions found in the Intel Pentium III, Intel MMX extensions, Streaming SIMD Extensions (SSE), and the AMD Athlon (including 3D Now!).  I extract some note from Delphi Help:<br />&quot;The built-in assembler supports all of the Intel-documented opcodes for general application use. Note that operating system privileged instructions may not be supported. Specifically, the following families of instructions are supported:<br /><br />Pentium family<br />	Pentium Pro and Pentium II<br />	Pentium III<br />	Pentium 4<br /><br />Note:	Pentium 4 instructions are only supported on Windows.<br /><br />In addition, the built-in assembler supports the following instruction sets<br /><br />AMD 3DNow! (from the AMD K6 onwards)<br />	AMD Enhanced 3DNow! (from the AMD Athlon onwards)&quot;<br /><br />From your code, i modify it to use BASM in Delphi.  It run OK.<br /><br />...<br /><br />Best regards !<br />TQN </div><br /><br />Yep, and if he's not running Delphi5 or above he can use <a target="_blank" href="http://www.yks.ne.jp/~hori/MMXasm-e.html">MMXasm</a>. It's an extension than converts asm-code to db XX,XX,,XX statements.</div>
    <div class="meta">Posted on 2003-12-27 03:29:48 by Delight</div>
   </div>
   <div class="post" id="post-129159">
    <div class="subject"><a href="#post-129159">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">Hi, I've tried to to it on my Delphi 5 Enterprise Version with inline-asm, but &quot;movaps&quot; and the other SSE-instruction caused errors. Are you sure that Delphi 5 supports them?<br />In other case, I'll try the MMXasm-library.<br /><br />Thanks a lot for helping!</div>
    <div class="meta">Posted on 2003-12-28 12:50:59 by mathias l.</div>
   </div>
   <div class="post" id="post-129201">
    <div class="subject"><a href="#post-129201">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">Hi mathias l.<br />I am sorry. I have a mistake. You need Delphi 6 or 7 to build your code.<br />Best regards<br />TQN</div>
    <div class="meta">Posted on 2003-12-28 21:24:48 by TQN</div>
   </div>
   <div class="post" id="post-130739">
    <div class="subject"><a href="#post-130739">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">I apologize for exhumating this thread<br /><br />I'm really interested in that :<br /><br /><div class="quote"><em>Originally posted by f0dder </em><br /><br />*) iirc, SSE data has to be 16-byte aligned - otherwise you'll get exceptions (well, unless you fiddle with the SSE control flag, then you'll just suffer from slow speed). </div><br /><br />f0dder, could you explain a bit how to fiddle with that flag in order to have the cpu execute SSE instructions on non-16-bytes-aligned memory without complaining ?<br /><br />thanks a lot in advance</div>
    <div class="meta">Posted on 2004-01-16 05:12:37 by Chrishka</div>
   </div>
   <div class="post" id="post-130760">
    <div class="subject"><a href="#post-130760">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">Hm, I can't seem to find information on disabling exceptions on unaligned access, so perhaps I got some things confused when reading the references last time - at least there's no mention of it on LDMXCSR/STMXCSR - bleh. It would be slow anyway, so it's probably a good thing you can't disable the exceptions :)<br /><br />If you really need unaligned access, use movups, movupd.<br /><br />The MXCSR can be used for other SSE control, though... like rounding modes.</div>
    <div class="meta">Posted on 2004-01-16 06:38:24 by f0dder</div>
   </div>
   <div class="post" id="post-130761">
    <div class="subject"><a href="#post-130761">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">arg too bad, it would've helped me a lot. of course there's movups and so on, but my problem is with 'psadbw xmm,mem128'<br />think I'll have to do it in two times with the mmx version</div>
    <div class="meta">Posted on 2004-01-16 06:51:05 by Chrishka</div>
   </div>
   <div class="post" id="post-130763">
    <div class="subject"><a href="#post-130763">asm-DLL for use of SIMD in Delphi</a></div>
    <div class="body">Why not make sure your data is aligned?</div>
    <div class="meta">Posted on 2004-01-16 06:53:01 by f0dder</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=16544&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=16544&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="16544" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=16544&amp;page=2">&gt;</a><a href="../?id=16544&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>