<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Bogdan--This would be cool... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17804" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=17804">Bogdan--This would be cool...</a></p>
   <div class="post" id="post-137437">
    <div class="subject"><a href="#post-137437">Bogdan--This would be cool...</a></div>
    <div class="body">I was thinking about code readability today and thought that one of the biggest obstacles to reading assembly is figuring out what's in the registers at a given point. It would be very cool if you could <strong><em>alias</em></strong> the registers in the same way you assume them. For example if you had a proc that counted bytes you could do this:<br /><br /><pre><code>ECX ALIAS&#58;cbBytes<br />EDI ALIAS&#58;pArray<br /><br />mov pArray,offset MyArray<br />&#58;<br />mov al,&#91;pArray&#93;<br />inc pArray<br />or al,al<br />jz &gt;<br />inc cbBytes<br />jmp &lt;<br />&#58;<br /><br />ECX ALIAS&#58;nothing<br />EDI ALIAS&#58;nothing</code></pre><br /><br />Just a thought, feel free to point out how stupid the idea is :)</div>
    <div class="meta">Posted on 2004-03-31 00:48:33 by donkey</div>
   </div>
   <div class="post" id="post-137442">
    <div class="subject"><a href="#post-137442">Bogdan--This would be cool...</a></div>
    <div class="body">I think a little improvement can be... use a automatic alias :D, handled by scoopes, but that will be little hard when you will use more than one alias for the same register in the same scope. Interesting problem... the assembler must read your mind ;).<br /><br /><br /><br />By the way... is that the sintaxis that will use bogdan?<br />will be nice use jmp (arrow of pow, indicating jump above... this kb is xtrange for me...).. but I not think that exist a counterpart for go down.<br /><br />Have a nice day or night.</div>
    <div class="meta">Posted on 2004-03-31 01:09:39 by rea</div>
   </div>
   <div class="post" id="post-137450">
    <div class="subject"><a href="#post-137450">Bogdan--This would be cool...</a></div>
    <div class="body">As far as I understand, and I am not in any way given advance information by Bogdan, his assembler will be MASM/TASM compatible. But that does not mean he can't extend it a bit, with stuff like ALIAS. I am not sure how he would go about scoping the ALIAS but it should be done in the same way as ASSUME. Luckily it is not me who is writing the assembler so I just have to suggest, not worry about how to do it ;)</div>
    <div class="meta">Posted on 2004-03-31 01:44:00 by donkey</div>
   </div>
   <div class="post" id="post-137463">
    <div class="subject"><a href="#post-137463">Bogdan--This would be cool...</a></div>
    <div class="body">Bogdan's assembler will be very powerfull, it will support 16/32 and 64-bit coding.</div>
    <div class="meta">Posted on 2004-03-31 03:48:32 by Vortex</div>
   </div>
   <div class="post" id="post-137475">
    <div class="subject"><a href="#post-137475">Bogdan--This would be cool...</a></div>
    <div class="body">Hi Donkey,<br /><br />In FASM you can do <br /><br /><pre><code>cbBytes fix ecx<br />pArray fix edi<br /></code></pre></div>
    <div class="meta">Posted on 2004-03-31 07:16:54 by pelaillo</div>
   </div>
   <div class="post" id="post-137483">
    <div class="subject"><a href="#post-137483">Bogdan--This would be cool...</a></div>
    <div class="body">(I know this will probably sound like heresy) - but what about building a register allocator into the assembler? This would be an advantage for those people who do full-assembly coding and don't care to optimize every single routine. I'm not sure how exactly this should be done, perhaps by creating a range of &quot;pseudoregisters&quot;, like 16 of them, and have the assembler do register spilling etc.<br /><br />Of course these regs should have different names, and using the standard eax etc should do verbatim assembling of instructions, as is needed when optimizing things by hand.<br /><br />For those doing full-asm coding, I don't think the idea of an &quot;optimizing&quot; assembler is bad, as long as it only &quot;optimizes&quot; when you tell it to.<br /><br />Not like it will matter much to me personally, since I usually only do subroutines in assembly, but it might be worth considering.</div>
    <div class="meta">Posted on 2004-03-31 08:54:49 by f0dder</div>
   </div>
   <div class="post" id="post-137489">
    <div class="subject"><a href="#post-137489">Bogdan--This would be cool...</a></div>
    <div class="body">Hi f0dder,<br /><br />Pretty cool idea but maybe a bit too much for me. I geuss you could frame it in a block, like :<br /><br />USE EDI,ESI,EBX,EAX<br />LOCAL SomeVAR :DWORD<br />; Code here<br />ENDU<br /><br />It would attempt to replace variables local to the block with the registers specified and restore them on exit. That would handle scope problems.<br /><br />Hi pelaillo,<br /><br />I knew about FIX but wasn't aware that the alias was redefinable, a quick check of the manual shows me that it is exactly what I was asking for. Looks like someone thought of it first :)</div>
    <div class="meta">Posted on 2004-03-31 09:22:57 by donkey</div>
   </div>
   <div class="post" id="post-137491">
    <div class="subject"><a href="#post-137491">Bogdan--This would be cool...</a></div>
    <div class="body">Hm yes, it coudl be done both with &quot;virtual registers&quot; and by aliasing locals to registers. Dunno which would be easiest or most intuitive - it's important that such a feature would only be turned on if you explicitly enable it, though, to avoid confusion.</div>
    <div class="meta">Posted on 2004-03-31 09:32:22 by f0dder</div>
   </div>
   <div class="post" id="post-137516">
    <div class="subject"><a href="#post-137516">Bogdan--This would be cool...</a></div>
    <div class="body">You can always alias registers by using text macros, at least in MASM. Too bad you can't &quot;undefine&quot; them.<br /><br />cbBytes TEXTEQU &lt;ECX&gt;<br /><br />On machines where registers were referenced by number, many programmers would alias them with EQUs.<br /><br />R0 equ 0<br />R1 equ 1<br />cbBytes equ 2<br />etc.</div>
    <div class="meta">Posted on 2004-03-31 15:12:03 by tenkey</div>
   </div>
   <div class="post" id="post-137519">
    <div class="subject"><a href="#post-137519">Bogdan--This would be cool...</a></div>
    <div class="body">Hi all,<br /><br />Interesting ideas, i will give them a try when coding reaches that point.<br /><br />My first concern is beeing able to assemble old/existing TASM and MASM sourcecode so we will not loose all this code base allready written ;) Honestly my primary target is TASM in no-ideal mode but secondary target is MASM<br /><br />The only thing i do not like is jz &gt; and i find it much to cryptic and the same sign is used for comparations... i prefer more explicit notation like jz @@forward or something like that. <br /><br />I completly dislike cryptic and confusing notations...<br /><br />About register aliasing: well it should not be very hard to implement and FASM's style looks nice (aka using the &quot;fix&quot; keyword) and also MASM's text equ's should be &quot;undefinable&quot;<br /><br />I do full ASM codeing on big projects and i do not optimize every routine. I only optimize code that i believe it matters... however i never fellt like needing such an feature... keeping track of used/free registers inside a PROC was an prety easy task for my mind...<br /><br />Anyway i will give it a try when i reach that stage</div>
    <div class="meta">Posted on 2004-03-31 15:25:42 by BogdanOntanu</div>
   </div>
   <div class="post" id="post-137552">
    <div class="subject"><a href="#post-137552">Bogdan--This would be cool...</a></div>
    <div class="body">Register alias, invoke macro, other cool stuff. Don't you think that in a couple of years moving this way you're gonna invent an absolutely 'new' programming language and call it C.</div>
    <div class="meta">Posted on 2004-04-01 02:23:43 by Vaxon</div>
   </div>
   <div class="post" id="post-137595">
    <div class="subject"><a href="#post-137595">Bogdan--This would be cool...</a></div>
    <div class="body"><div class="quote">I think a little improvement can be... use a automatic alias :D, handled by scoopes, but that will be little hard when you will use more than one alias for the same register in the same scope. Interesting problem... the assembler must read your mind </div><br /><br /><br />I think now that I was wrong, I can not post in the past because there where a cut of electric power, then what I was thinking is that, for example, when you use:<br /><br />ECX ALIAS:cbBytes<br />EDI ALIAS:pArray<br />is because you in some moment (in fact in the next instructions) will be using this registers as that, but for a matter of fact, you will need first move the variable inside the registers.... because will not have sense do some like:<br /><br /><pre><code><br />&#91;color=red&#93;ECX ALIAS&#58;cbBytes<br />EDI ALIAS&#58;pArray&#91;/color&#93;<br /><br />mov pArray,offset &#91;color=red&#93;OnlyANumber&#91;/color&#93;<br />&#58;<br />mov al,&#91;pArray&#93;<br />inc pArray<br />or al,al<br />jz &gt;<br />inc cbBytes<br />jmp &lt;<br />&#58;<br /><br />&#91;color=red&#93;ECX ALIAS&#58;nothing<br />EDI ALIAS&#58;nothing&#91;/color&#93;</code></pre><br /><br />Because you are moving the direction of a single number, and you are aliasing like a pointer to an array... Get the idea?<br /><br />(I will judge a little :) ... dont care much, is only a point of view )<br /><br /><pre><code><br />ECX ALIAS&#58;cbBytes<br />EDI ALIAS&#58;pArray<br /><br />mov pArray,offset MyArray<br />&#58;<br />mov al,&#91;pArray&#93;<br />inc pArray<br />or al,al<br />jz &gt;<br />inc cbBytes<br />jmp &lt;<br />&#58;<br /><br />ECX ALIAS&#58;nothing<br />EDI ALIAS&#58;nothing</code></pre><br /><br />mmm... how to explain...??<br /><br /><br /><br />Think how or when you will change a alias. I think only in movement instructions, xcgh, <br />maybe when you where zeroising a register you whant to change the alias, But what<br /> I whant to say is that the thing I say &quot;scopes&quot; are defined automaticaly by the programmer,<br /> and the assembler in fact not need read your mind, because when a programmer put:<br /><br />mov eax, pArray<br /><br />Is defining that in the next instructions eax have the direction of pArray... and tada... <br />automatic alias for you ;), the scope and the thing: ecx alias:nothing is not necesary,<br /> because normally a programmer, first move the variable that he/she whant, <br />and you can use the name  of the variable like the alias.<br /><br />A little thing to point here, is how to diferentiate between the register and the real variable?<br /> maybe adding a single char(say not standar a-z pr A-Z) at start... indicating that you are using<br /> the alias, see that only one alias is in a moment for X register.<br /><br />Then the code... with the suposition that when you whant to change the alias of a register,<br /> is when you move a variable, or some diferent name of alias, that actually have inside.<br /><br /><pre><code><br /><br />xor ECX, ecx?&#91;b&#93;c&#91;/b&#93;Bytes ;Explicit rename or alias for ecx<br /><br />mov edi,offset MyArray<br />&#58;<br />mov al,&#91;#MyArray&#93; ;maybe here is not necesary alias al, <br />;because you knowthat you are using an alias for the mov.<br />inc #MyArray<br />or al,al<br />jz &gt;<br />inc &#40;#&#41;cbBytes ; I put &#40;#&#41; becuse is not necesary make <br />;a diference &#40;the suposition&#41; between a direction and the alias of the register.<br />jmp &lt;<br />&#58;<br /><br /><br />;not need the alias&#58;nothing, because in the next procedire or instructions,<br />; when you whant handle eax like other alias, you normally will <br />;move the variable inside..... of the register that you will whant to alias<br /></code></pre><br /><br /><br />The important thing here is that the pricipal assumption for the automatic alias, is that in general, you only whant manipulate a register in a diferent way, but only when you move a diferent variable that the one that you have previously.<br /><br /><br />Get the idea?, what you think, sure that maybe depending on how you implement it, will be easy or more hard... ;)<br /><br />Have a nice day or night.</div>
    <div class="meta">Posted on 2004-04-01 08:03:56 by rea</div>
   </div>
   <div class="post" id="post-138850">
    <div class="subject"><a href="#post-138850">Re: Bogdan--This would be cool...</a></div>
    <div class="body"><div class="quote"><br />I was thinking about code readability today and thought that one of the biggest obstacles to reading assembly is figuring out what's in the registers at a given point. It would be very cool if you could <strong><em>alias</em></strong> the registers in the same way you assume them. For example if you had a proc that counted bytes you could do this:<br /><br /><pre><code>ECX ALIAS&#58;cbBytes<br />EDI ALIAS&#58;pArray<br /></code></pre><br />Just a thought, feel free to point out how stupid the idea is :) </div><br /><br />If Bogdan's assembler is true to it's TASM roots, you should be able to write:<br /><br /><pre><code><br />pArray textequ &lt;byte ptr &#91;edi&#93;&gt;<br /></code></pre><br /><br />I use this trick all the time in HLA using text constants, e.g.,<br /><br /><pre><code><br />const<br />   attrEBX&#58; text &#58;= &quot;&#40;type attr &#91;ebx&#93;&#41;&quot;;<br />    .<br />    .<br />    .<br />   mov&#40; attrEBX.someAttrField, eax &#41;;<br /></code></pre><br /><br />The only comment I have, is that it's real easy to lose track of which registers you're using in a procedure if you don't include the register's name as part of the alias (which is why I tend to use names like &quot;attrEBX&quot; in the aliases I create).<br />Cheers,<br />Randy Hyde</div>
    <div class="meta">Posted on 2004-04-13 13:56:27 by rhyde</div>
   </div>
   <div class="post" id="post-138852">
    <div class="subject"><a href="#post-138852">Bogdan--This would be cool...</a></div>
    <div class="body"><div class="quote"><em>Originally posted by f0dder </em>(I know this will probably sound like heresy) - but what about building a register allocator into the assembler? This would be an advantage for those people who do full-assembly coding and don't care to optimize every single routine. I'm not sure how exactly this should be done, perhaps by creating a range of &quot;pseudoregisters&quot;, like 16 of them, and have the assembler do register spilling etc.<br /></div><br />The GCC in-line assembler actually does this sort of thing already.<br />I've heard of other assembler projects planning on providing register allocation, but I've not seen anything real yet. I'd added optimization and register allocation to the HLA roadmap (around v3.0), but at the rate things are going with HLA v2.0, I wouldn't hold my breath waiting for that feature :-).<br /><br /><div class="quote"><br />Of course these regs should have different names, and using the standard eax etc should do verbatim assembling of instructions, as is needed when optimizing things by hand.<br /></div><br />I think the general consensous among people who were having this dicussion a couple of years ago is that you would use something like @eax, @ebx, @ecx, etc., to give the assembler a hint about what registers it *ought* to use, and it could substitute a different register if it was more convenient. A special @reg syntax was chosen when the exact register didn't matter at all (or if you needed more than 6-7 registers in a given code sequence and you wanted the compiler to keep things straight for you).<br /><br /><br /><div class="quote"><br />For those doing full-asm coding, I don't think the idea of an &quot;optimizing&quot; assembler is bad, as long as it only &quot;optimizes&quot; when you tell it to.<br /></div><br />or, conversely, stops optimizing when you tell it not to.<br />For the average person, the default should probably be &quot;optimization on&quot;, as most people don't really count the cycles on each and every instruction they write. Of course, you do need the ability to turn optimization on or off on a line by line basis, or the &quot;purists&quot; scream bloody murder (and for those who don't want an optimizer touching their code at all, you simply include a pragma at the beginning of each source file that disables optimization from that point forward).<br /><br /><div class="quote"><br />Not like it will matter much to me personally, since I usually only do subroutines in assembly, but it might be worth considering. </div><br />Of course, local optimizations are probably the only kind you'll find in a typical assembler/optimizer. So in that since it would be of interest to you.<br />Cheers,<br />Randy Hyde</div>
    <div class="meta">Posted on 2004-04-13 14:04:37 by rhyde</div>
   </div>
   <div class="post" id="post-138853">
    <div class="subject"><a href="#post-138853">Bogdan--This would be cool...</a></div>
    <div class="body"><div class="quote"><br />Register alias, invoke macro, other cool stuff. Don't you think that in a couple of years moving this way you're gonna invent an absolutely 'new' programming language and call it C. </div><br /><br />Couple of years?  Try early 1990's. MASM (and a little later, TASM) has had most of this stuff since then. Certainly HLA has had this stuff since 1999. And, no, it's not called C.<br />Cheers,<br />Randy Hyde</div>
    <div class="meta">Posted on 2004-04-13 14:07:18 by rhyde</div>
   </div>
   <div class="post" id="post-138944">
    <div class="subject"><a href="#post-138944">Bogdan--This would be cool...</a></div>
    <div class="body"><div class="quote">The only comment I have, is that it's real easy to lose track of which registers you're using in a procedure if you don't include the register's name as part of the alias (which is why I tend to use names like &quot;attrEBX&quot; in the aliases I create).</div><br /><br /><br />But I think that thing will lost a little the way for use alias.<br /><br />I think that if really an assembler can use alias and if is usable the 'automatic alias', then in case that you are in dude for what alias is for example #cbBytes (in a first read of code), then you can question to the assembler and the  assembler necesarily will answer you ;) (in the out string ;) ), for example:<br /><br />who is #cbBytes    or<br />?#cbBytes <br /><br />and the  assembler say: ecx is #cbBytes<br /><br />Also and probabily, and more in the time of construction for test the rules that where aplied for 'automatic alias' (check if they are right), the assembler can give you a list of what alias and in what lines where used for each register.<br /><br />Also  see that I say that normally an alias is used only when you will manipulate (or handle) a register in X way, but normally <em>you  only whant handle in a diferent way, because you are moving other value to the register</em>, and in that case, the alias is obtained from the string name. Also there is the sugestion that when is not a movement exist a explicit alias more compact, some like register?alias.<br /><br /><br /><br /><br />I supose that will be necesary analize some codes, from short to larges ones, at less whit the ones (shorts) that I test on my mind with &quot;simple&quot; rules, the assembler should be able for handle them, by the way, the rules are the one that I mark with blue in the anterior post ;) and the explicit alias.<br /><br /><br />Also other thing to see is that this rules (that can be extended) aply well for single alias (only one register have a single diferent alias in determinate part of the code), but what happend with:<br /><br />mov eax, pArray ;eax can be referenced like #pArray<br />mov edx, pArray ; what happend to this code!!!... a collision?<br />inc #pArray ;what of the two??, in case that I accept the same name? for diferent registers? (this case is similar to mov edx, #pArray)<br /><br />A posible answer can be the one that randall say about put a prefix that identify the register.<br /><br />Also for not put the whole register, you can use some short of eax=a, ecx =c, edx=d, ebx=b, esi=s, edi=d and others... (maybe).<br /><br />And you can reference it with the normal #pArray only when one of the two (or more registers) are referenced with single diferent alias, and the one that dont lost the previous state will be the one with the alias #pArray.<br /><br /><br />And push and pop are interesting cases to analize... handle them or noth... in the way that they will change the alias or not?<br /><br />Have a nice day or night.</div>
    <div class="meta">Posted on 2004-04-14 09:24:27 by rea</div>
   </div>
  </div>
 </body>
</html>