<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Window handles of NC objects - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=5373" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=5373">Window handles of NC objects</a></p>
   <div class="post" id="post-38204">
    <div class="subject"><a href="#post-38204">Window handles of NC objects</a></div>
    <div class="body">is there a way to determine the window handle of a menu, or scroll bar or caption bar, etc? I know that when you create most of these things you'll get a handle returned (like HMENU or something), but I'm thinking more like the handle returned by CreateWindowEx (HWND) so that I could pass it to other functions.<br /><br />--Chorus</div>
    <div class="meta">Posted on 2002-05-14 12:37:19 by chorus</div>
   </div>
   <div class="post" id="post-38207">
    <div class="subject"><a href="#post-38207">Window handles of NC objects</a></div>
    <div class="body">well i can give you a solid answer for a menu. use the GetMenu api.<br /><br />for a scrollbar i dont think you can actually get the handle unless it was actually created with the scrollbar api's. but to get and set info about the system defined scrollbars you can use the GetScrollBarInfo and SetScrollInfo api's. using those you dont need to know the handle to the scrollbar but only the window it belongs to.<br /><br />as for the titlebar you can use the GetTitleBarInfo api. ive never really messed around with this one but to set the titlebar info you probably will need to use some gdi functions along with the info you get back from the GetTitleBarInfo api.</div>
    <div class="meta">Posted on 2002-05-14 12:54:39 by smurf</div>
   </div>
   <div class="post" id="post-38209">
    <div class="subject"><a href="#post-38209">Window handles of NC objects</a></div>
    <div class="body">Thanks smurf, but I think you got me backwards. GetMenu, for instance, returns the handle of a menu associated with a window. What I was looking for was to turn that menu handle into a *window* handle of the menu. For instance, I would like to grab the window handle of the title bar, subclass it and change the background brush to a different colour. As it stands, I believe the background colour is taken from the system default colours.<br /><br />PS. Couldn't find the GetTitleBarInfo API in my API guide. Is this old or new??<br />Thanks again,<br /><br />--Chorus</div>
    <div class="meta">Posted on 2002-05-14 13:04:03 by chorus</div>
   </div>
   <div class="post" id="post-38210">
    <div class="subject"><a href="#post-38210">Window handles of NC objects</a></div>
    <div class="body">I think for scrollbars (belonging to a listbox for example) the vertical bar has ID 1, the horizontal bar has id 2. So get the hwnd with GetDlgItem(hWndListBox,1).<br />I'm not sure if this is documented and if it works for other controls.<br /><br />japheth</div>
    <div class="meta">Posted on 2002-05-14 13:12:23 by japheth</div>
   </div>
   <div class="post" id="post-38212">
    <div class="subject"><a href="#post-38212">Window handles of NC objects</a></div>
    <div class="body">japheth, this seems to be exactly what I'm looking for!<br />However, can't seem to make it work, heheh...<br /><br />The WinAPI guide says<br /><br /><div class="quote">You can use the GetDlgItem function with any parent-child window pair, not just with dialog boxes. As long as the hDlg parameter specifies a parent window and the child window has a unique identifier (as specified by the hMenu parameter in the CreateWindow or CreateWindowEx function that created the child window), GetDlgItem returns a valid handle to the child window. </div> <br /><br />So, it seems that you can use it for pretty much anything you can get a handle for right? Anyways, what I wanted to do was change the background colour of the Menu bar, but it didn't work.<br /><br />If anyone can spot any errors, here's what I did:<br /><br /><pre><code><br /> MenuWindow DD ?<br /> OldWindowProc DD?<br /><br />                    invoke GetMenu,ParentHwnd<br />                    invoke GetDlgItem,ParentHwnd,eax<br />                    mov MenuWindow,eax<br />                    invoke SetWindowLong,eax,GWL_WNDPROC,addr MenuSubProc<br />                    mov OldWindowProc,eax<br />                    <br />                    invoke UpdateWindow,Parent.hwnd<br />....<br /><br />MenuSubProc         PROC hWin&#58;DWORD, uMsg&#58;DWORD, wParam&#58;DWORD, lParam&#58;DWORD<br />                    LOCAL rct&#58;RECT<br />                    LOCAL bkbrush&#58;DWORD<br />                    mov eax,uMsg<br />                    cmp eax,WM_ERASEBKGND<br />                    je @@EraseBkgnd<br />                    invoke CallWindowProc,OldWindowProc,hWin,uMsg,wParam,lParam<br />                    ret<br />@@EraseBkgnd&#58;       invoke GetClientRect,hWin,addr rct<br />                    invoke CreateSolidBrush,0ffffffh<br />                    mov bkbrush,eax<br />                    invoke FillRect,wParam,addr rct,bkbrush<br />                    invoke DeleteObject,bkbrush<br />                    xor eax,eax<br />                    ret<br />MenuSubProc          ENDP<br /><br /><br /><br /></code></pre><br /><br />Thanks again for the pointer<br /><br />--Chorus</div>
    <div class="meta">Posted on 2002-05-14 13:49:03 by chorus</div>
   </div>
   <div class="post" id="post-38240">
    <div class="subject"><a href="#post-38240">Window handles of NC objects</a></div>
    <div class="body">Hi chorus,<br /><br />Menus are a system global class and Windows takes care of creating its window and handling all its messages. When you create menus using Win32 APIs you don't get any information at all about its WINDOW handle. <br />I use hooks to trap all windows messages that belonged to the same thread.<br />Microsoft describes hooks as &quot;A point in the system message-handling mechanism where an application can install a subroutine to monitor the message traffic in the system and process certain types of messages before they reach the target window procedure&quot;.<br />In other words, a hook is a way of subclassing a whole thread. There are different hooks you can create, depending on the type of message you want to trap.<br />In order to detect when a menu-window is about to be created, you will use the WH_CALLWNDPROC hook. Here is a part of my program: <pre><code><br />CreatePMHook&#58;			                               ;<br />	mov	eax, hWnd	                               ;	<br />        push    0                                              ;<br />        push    eax                                            ; eax-&gt;hWnd<br />        call    GetWindowThreadProcessId                       ; call API<br />        push    eax                                            ; eax-&gt;hThreadID<br />        push    0                                              ; handle to application instance<br />        push    offset  pHookCallWndProc                       ; our hook proc<br />        push    WH_CALLWNDPROC                                 ; hook type<br />        call    SetWindowsHookEx                               ; call API<br />	mov	hHookID, eax	                               ; handle to hook procedure<br />        ret                                                    ;<br />;..............................................................; <br />KillPMHook&#58;			                               ;	<br />	mov	eax, hHookID	                               ; eax-&gt; handle to hook procedure<br />        xor     esi, esi                                       ; esi = 0<br />        push    eax                                            ; eax-&gt; handle to hook procedure<br />        call    UnhookWindowsHookEx                            ; call API<br />	mov	hHookID, esi	                               ; esi = 0<br />        ret                                                    ;<br />;..............................................................; <br />pHookCallWndProc&#58;                                              ; our hook proc<br />        pop     ecx                                            ; ecx-&gt;return address<br />        mov     eax, hHookID                                   ;<br />        push    eax                                            ; eax-&gt;hHookID<br />        push    ecx                                            ; ecx-&gt;return address<br />	mov	edx, &#91;esp+4+4&#93;	                               ; ncode<br />	mov	eax, &#91;esp+12+4&#93;	                               ; lParam-&gt; lp to CWPSTRUCT<br />	cmp	edx, HC_ACTION	                               ; edx-&gt;ncode = HC_ACTION = 0<br />        jnz     EndClN                                         ;<br />        cmp     &#91;eax&#93;.CWPSTRUCT.message, WM_CREATE             ; WM_CREATE = 1<br />        jnz     EndClN                                         ;<br />;Get ClassName of the window                                   ;<br />        mov     edi, offset buferClassName                     ;<br />        mov     esi, &#91;eax&#93;.CWPSTRUCT.hwnd                      ; esi-&gt;CWPSTRUCT.hwnd<br />        push    sizeof  buferClassName                         ; size of buferClassName = 16*4<br />        push    edi                                            ; edi-&gt;buferClassName<br />        push    esi                                            ; esi-&gt;CWPSTRUCT.hwnd<br />        call    GetClassName                                   ; call API<br />        mov     eax, &#91;edi+4&#93;                                   ; edi-&gt;bufer<br />        mov     edx, offset  popMenuClassName                  ; edx-&gt; string &quot;#32768&quot;,0,0<br />        mov     ecx, &#91;edi&#93;                                     ; edi-&gt;bufer<br />        and     eax, 0FFFFh                                    ; need ax only<br />        cmp     ecx, &#91;edx&#93;                                     ; edx-&gt;string &quot;#32768&quot;,0,0<br />        jnz     EndClN                                         ;<br />        cmp     eax, &#91;edx+4&#93;                                   ; edx-&gt;string &quot;#32768&quot;,0,0<br />        jnz     EndClN                                         ;       obtained with SI !!!<br />;ClassName of the window is #32768, and subclass it            ; it is a POPUP MENU class name<br />        push    offset  lpPopMenuSubclassWndProc               ; new popMenuWndProc address <br />        push    GWL_WNDPROC                                    ;<br />        push    esi                                            ; esi-&gt;CWPSTRUCT.hwnd<br />        call    SetWindowLong                                  ; call API<br />        mov     lpOldPopMenuWndProc, eax                       ; save original address<br />EndClN&#58;                                                        ;<br />        jmp     CallNextHookEx                                 ; call API<br />;..............................................................; <br />lpPopMenuSubclassWndProc&#58;                                      ;<br />;&#91;esp&#93;    -&gt;  return address                                   ;<br />;&#91;esp+4&#93;  -&gt;  hwnd                                             ;<br />;&#91;esp+8&#93;  -&gt;  uMsg                                             ;<br />;&#91;esp+12&#93; -&gt;  wParam                                           ;<br />;&#91;esp+16&#93; -&gt;  lParam                                           ;<br />        mov     eax, lpOldPopMenuWndProc                       ;<br />        pop     ecx                                            ; ecx-&gt;return address<br />        push    eax                                            ; eax-&gt;lpOldPopMenuWndProc<br />        push    ecx                                            ; ecx-&gt;return address<br />        mov     eax, &#91;esp+8+4&#93;                                 ; eax-&gt;uMsg<br />        mov     esi, &#91;esp+4+4&#93;                                 ; esi-&gt;hwnd<br />        cmp     eax,  WM_CREATE                                ; WM_CREATE = 1<br />        jnz     EndGlN2                                        ;<br />;..............................................................; <br />;WM_CREATE                                                     ; <br />        invoke  GetWindowLong, esi, GWL_STYLE                  ;  Example for you <br />        xor     eax, WS_BORDER                                 ;<br />        invoke  SetWindowLong, esi, GWL_STYLE, eax             ;            <br />        invoke  GetWindowLong, esi, GWL_EXSTYLE                ;<br />        xor     eax, WS_EX_WINDOWEDGE or \                     ; <br />                     WS_EX_DLGMODALFRAME                       ;<br />        invoke  SetWindowLong, esi, GWL_EXSTYLE, eax           ;<br />        ;......................................................;<br />EndGlN2&#58;                                                       ;  <br />        jmp     CallWindowProc                                 ; call API </code></pre><br /><br />:)</div>
    <div class="meta">Posted on 2002-05-14 18:51:22 by buliaNaza</div>
   </div>
   <div class="post" id="post-38404">
    <div class="subject"><a href="#post-38404">Window handles of NC objects</a></div>
    <div class="body">buliaNaza,<br />  Thanks alot for the code! It's more than I expected. I haven't tried it yet, but I will at the earliest opportunity.<br />   Just looking at it quickly, should I assume that the class name is actually &quot;#32768&quot;? If it is, do you think I could use FindWindow with this class name to get the window handle? I'll try it both ways...<br /><br />Thanks again<br /><br />--Chorus</div>
    <div class="meta">Posted on 2002-05-15 14:17:56 by chorus</div>
   </div>
   <div class="post" id="post-38430">
    <div class="subject"><a href="#post-38430">Window handles of NC objects</a></div>
    <div class="body">there may be an easier approach for access to a menu hwnd:<br /><br />menu windows cannot be children of the window the menu belongs to. if they were, they would be clipped to the window/client area of their parent. So menu windows must be children of the desktop hwnd (sam as with tooltips). So it should be possible to find the menu window by searching &quot;#32768&quot; childrens of the desktop hwnd. One problem I see is that there may exist more than 1 window of this class so you have to find out which one is the right one.</div>
    <div class="meta">Posted on 2002-05-15 16:50:38 by japheth</div>
   </div>
   <div class="post" id="post-38460">
    <div class="subject"><a href="#post-38460">Window handles of NC objects</a></div>
    <div class="body">Chorus,<br />If ua Canadian don't be lazy...<br /><br />japheth,<br />My code works fine for me...and where is your code?</div>
    <div class="meta">Posted on 2002-05-15 19:58:42 by buliaNaza</div>
   </div>
   <div class="post" id="post-38485">
    <div class="subject"><a href="#post-38485">Window handles of NC objects</a></div>
    <div class="body"><div class="quote"><em>for a scrollbar i dont think you can actually get the handle unless it was actually created with the scrollbar api's. </em></div>Surely the scrollbar would be a child window of the edit control, so you could EnumChildWindows to find its hWnd?</div>
    <div class="meta">Posted on 2002-05-15 22:07:12 by sluggy</div>
   </div>
   <div class="post" id="post-38530">
    <div class="subject"><a href="#post-38530">Window handles of NC objects</a></div>
    <div class="body">buliaNaza,<br /><br />your code is fine :) .<br /><br />I just doubted if to install hooks just for changing menu background color isn't a bit overstretched. But &quot;my&quot; approach isn't proofed to work and it most likely may be even larger than yours.<br /><br />japheth</div>
    <div class="meta">Posted on 2002-05-16 05:01:18 by japheth</div>
   </div>
  </div>
 </body>
</html>