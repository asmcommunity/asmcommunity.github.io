<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>raycasting again ;x - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20740" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=20740">raycasting again ;x</a></p>
   <div class="post" id="post-157909">
    <div class="subject"><a href="#post-157909">raycasting again ;x</a></div>
    <div class="body">hello, after about 2 years i still don&#39;t get raycasting. i know im slow. anyway, i want to implement a raycasting engine in visual basic then later port it to masm and i was wondering if anyone could help me understand it. i really do not get it. i kinda get it but here are a few questions i have to ask about it that i need help with also i would like to know anything anyone will tell me about it. anyway, i want to only use the gdi to implement it because well i want to learn how do do it without directx,etc before i move on to that stuff if it it may be easier for some and im wondering.<br /><br />what api&#39;s would i need?<br />do i draw it using lines or just pixel by pixel?<br />or maybe do i draw just squares on the screen?<br />what about round objects?<br />how do i load the map and turn that into 3d?<br />how do i determine my place in the map and how do i update the map to represent my position on it?<br />how do i render walls and ceilings and floors?<br />how do i texture walls and ceilings and floors?<br />how does the game loop work?<br />how do i remove flickering?<br />how do i interact with objects in this 3d world?<br />how do i make it fast but still look nice?<br />how do i create a resource archive similar to a wad?<br />can someone explain to me how a bsp tree works in idiot terms?<br />is there a video tutorial on how to implement this and explain the concept?<br />what can i do with raycasting?<br />what can&#39;t i do with raycasting?<br />is it possible to mix different kinds of rendering so i can do what the raycaster can&#39;t do?<br />how do i deal with walking up stairs and down stairs,going up and down elevators etc?<br />how are stairs,elevators and other objects represented on the map?<br />how do i do rooms above rooms?<br />how do i do basements sub level floors etc?<br />how do i create and use my own file formats?<br />how do i use assorted texture formats?<br />how do i use different sound formats?<br />what about jumping,crouching?<br />how do i know how far away the wall is? and how do i draw it so it looks correct?<br />what about that stupid hall of mirrors effect? how do i get rid of it?<br />what about lines that dont fully intersect? how do i fix them so they are correct?<br />how do i apply bump mapping, etc. to textures? <br /><br />if you have any answers to these questions or have information on something ive got id love to hear what you have to say. im motivated to make one. i just don&#39;t know how. thanks, hexen.</div>
    <div class="meta">Posted on 2005-03-13 20:18:30 by HeXeN</div>
   </div>
   <div class="post" id="post-157911">
    <div class="subject"><a href="#post-157911">Re: raycasting again ;x</a></div>
    <div class="body">I think you should read (again?) about the BeamTree method, but nothing is ever as pure as a pixel projection raycaster.<br /><br />For a perpixel raycaster, we&#39;re really interested in the View Frustum&#39;s vertices, because we want to cast rays from (the screen) the near plane of the view frustum to the far plane of the view frustum. We wish to cast a ray from &quot;each screen pixel x,y on the near plane&quot; to corresponding (scaled) points on the far plane. We eant to find the closest intersection between each ray origin and any world geometry, then determine the texel (texture coordinate) for that pixel, ie, the color for each screen pixel comes from the texture of the first surface its projected ray intersects with.<br /><br />Scronty wrote a &quot;PickRay&quot; demo which provides a a procedure to cast a single ray with respect to the current camera, plus determine the nearest intersection of that ray with geometry. Worth a look at the code involved, you could just feed it pixel coordinates in a loop, instead of driving it with the mouse...<br /><br /><br /></div>
    <div class="meta">Posted on 2005-03-13 21:34:41 by Homer</div>
   </div>
   <div class="post" id="post-157912">
    <div class="subject"><a href="#post-157912">Re: raycasting again ;x</a></div>
    <div class="body">thanks for telling me about beamtrees i had never even heard of them until today ive looked up a few things on them and found this http://www.bluesnews.com/abrash/chap64.shtml article the most usefull but im still not exactly sure how they work i &quot;kinda&quot; get it. ill look up more stuff on them. <br /><br />you mentioned Scronty wrote a &quot;PickRay&quot; demo. would you happen to know where i could get it? also would you happen to know any more usefull resources i could look at theres alot of stuff i need to learn. also thank you for replying Homer</div>
    <div class="meta">Posted on 2005-03-13 23:04:27 by HeXeN</div>
   </div>
   <div class="post" id="post-157913">
    <div class="subject"><a href="#post-157913">Re: raycasting again ;x</a></div>
    <div class="body">Take a look through the DirectX demos at http://scrontsoft.com, look out for &quot;MousePicking&quot;.<br /></div>
    <div class="meta">Posted on 2005-03-14 01:34:18 by Homer</div>
   </div>
   <div class="post" id="post-158049">
    <div class="subject"><a href="#post-158049">Re: raycasting again ;x</a></div>
    <div class="body">I&#39;m in the middle of doing exactly this right now (I think best/fastest in VB unfortunately - but with ThunderVB or VBInLineAsm it&#39;s not quite so bad anymore).? I really don&#39;t get it yet either, I&#39;m inept at anything graphical, I don&#39;t speak &#39;math&#39; very well, and I&#39;m still learning ASM . . . slowly :)? All in all, I&#39;m pretty much an idiot when it comes to this stuff.? That said, here&#39;s some information I&#39;ve found useful:<br /><br />some screenshots and c-style pseudocode (heavily commented - man I wish c coders would write like this rather than trying to out obfuscate each other):<br /><a target="_blank" href="http://www.wildfred.dsl.pipex.com/raycast/">http://www.wildfred.dsl.pipex.com/raycast/</a><br /><br />here&#39;s a pretty good 2d wolfenstein-style tutorial with java source (it&#39;s not 6 degree of freedom but it&#39;s a start)<br /><a target="_blank" href="http://www.permadi.com/tutorial/raycast/">http://www.permadi.com/tutorial/raycast/</a><br /><br />FlipCode&#39;s &quot;Realtime Voxel Landscape Engines&quot; article:<br /><a target="_blank" href="http://www.flipcode.com/articles/voxelland_part01.shtml">http://www.flipcode.com/articles/voxelland_part01.shtml</a><br /><br />FlipCode&#39;s &quot;Raytracing Topics &amp; Techniques&quot; article:<br /><a target="_blank" href="http://www.flipcode.com/articles/article_raytrace01.shtml">http://www.flipcode.com/articles/article_raytrace01.shtml</a><br /><br />You&#39;ll need a line drawing algorithm (from what I&#39;ve gathered).? Google will return at least a kajillion hits if you search for &quot;bresenham&quot;.? It may not be the best, but it&#39;s extremely simple and will point you in the direction of others (DDA for example).<br /><br />SetPixel in gdi32 is the only api I&#39;m currently using (aside from the DC handling ones anyway).<br /><br />My map currently takes up 128 megs and I get about 5 seconds per frame in the IDE.? No I didn&#39;t say that backwards, 5 seconds per frame.? I&#39;m trying to figure out how to make it work first.? I&#39;ll make it work well later.? If you want to see what can be done check out Ken Silverman&#39;s Voxlap demos here: http://advsys.net/ken/voxlap.htm<br /><br />If I ever get my code to the point it&#39;s not embarrasing to share, I&#39;ll hapilly post it for public consumption.<br /><br />Maybe we can collaborate.? My goal is to duplicate (although not copy) Ken Silverman&#39;s work.? I&#39;m using the GDI and all of my rotations are using Sin/Cos lookup tables.? None of what I&#39;m doing is fast or pretty currently.? My goal is to leave the thing as a complete 6 degree of freedom 30 fps + step by step tutorial and explanation of what why and how in the three languages I don&#39;t get to use at work (C/C++, VB, and ASM) using either trig, matrices, or quats for the rotations at the user&#39;s choice (to compare speed).? That goal is because that is what I&#39;d like to have.? I can&#39;t find it elsewhere, so I&#39;m building it.<br /><br /><div class="quote"><br />what api&#39;s would i need?<br /></div><br />At a minimum?? None.? You could do it all with PSet.? It&#39;ll be extremely, painfully slow.? Speed shouldn&#39;t be a goal to start with though.<br /><br /><div class="quote"><br />do i draw it using lines or just pixel by pixel?<br /></div><br />From what I understand the answer is &quot;both, and neither.&quot;? Or rather, the one covers the other.? A line goes shooting out from your eyeball, through the monitor (near viewing frustrum) and into the world (until it hits something or hits the far viewing frustrum).? If the line hits something, you find out what color that something is at the point of the intersection and make the point on the monitor that color.<br /><br /><div class="quote"><br />or maybe do i draw just squares on the screen?<br />what about round objects?<br /></div><br />I think you&#39;re stuck in 2d.? I can&#39;t be sure though.&nbsp; I&#39;m inept when it comes to graphics remember?<br /><br /><div class="quote"><br />how do i load the map and turn that into 3d?<br />how do i determine my place in the map and how do i update the map to represent my position on it?<br /></div><br />For the first question, I&#39;m doing it the other way around.? I&#39;m drawing the map in 3d voxel space and then saving it.? I found it was really quite a pain to build 3d models by hand and building an editor seemed sort of counter productive when I could just as easily build the editor into the &quot;engine.&quot;<br /><br /><div class="quote"><br />how do i render walls and ceilings and floors?<br />how do i texture walls and ceilings and floors?<br /></div><br />by casting rays from your eye into the world as I described under your question about lines or pixel by pixel, above.<br /><br /><div class="quote"><br />how does the game loop work?<br /></div><br />Infinitely.? Seriously though, it&#39;s just a loop that hogs all the computer&#39;s resources to do your bidding any way you choose.? For now just do (in VB) Do . . . Loop While True.<br />Put all the draw to screen stuff in place of the elipses.<br /><br /><div class="quote"><br />how do i remove flickering?<br />how do i interact with objects in this 3d world?<br />how do i make it fast but still look nice?<br />how do i create a resource archive similar to a wad?<br /></div><br />I personally feel that this stuff is gravy.? Add it after you&#39;ve filled your plate.? After all, you can&#39;t eat the gravy and then add the mashed potatoes later.? Don&#39;t worry about it until after the spuds are mashed.<br /><br /><div class="quote"><br />can someone explain to me how a bsp tree works in idiot terms?<br /></div><br />I&#39;m sure someone can.? I&#39;m equally sure that someone isn&#39;t me.? I understand the concept basically, but I skipped all the tree stuff and went to hash tables.? They fit how my mind works better.<br /><br /><div class="quote"><br />is there a video tutorial on how to implement this and explain the concept?<br /></div><br />I found one but can&#39;t seem to find the link to it now . . .? Spoke too soon, here it is: <br /><a target="_blank" href="http://www.siggraph.org/education/materials/HyperGraph/raytrace/rt_java/raytrace.html">http://www.siggraph.org/education/materials/HyperGraph/raytrace/rt_java/raytrace.html</a><br />Now, keep in mind that the animation here describes shadows and reflections.? I&#39;m not planning on doing that to start (you start looking at extremely realistic renderings that take hours or days per frame when you do that).? Basically, as soon as the animation gets to &#39;If intersect something&#39; I skip calling &#39;Shade&#39; and just go straight to &#39;Put final shade in pixel&#39;<br /><br /><div class="quote"><br />what can i do with raycasting?<br />what can&#39;t i do with raycasting?<br />is it possible to mix different kinds of rendering so i can do what the raycaster can&#39;t do?<br /></div><br />Google for &quot;RayTrace&quot;.? That&#39;ll give you a good idea that will answer the above questions.? I havn&#39;t found anything that can&#39;t be done yet if you&#39;re willing to wait (raycasting/raytracing takes a long, long time for the realistic looking stuff).? See the Voxlap link above for stuff that&#39;s more applicable to games.<br /><br /><div class="quote"><br />how do i deal with walking up stairs and down stairs,going up and down elevators etc?<br />how are stairs,elevators and other objects represented on the map?<br />how do i do rooms above rooms?<br />how do i do basements sub level floors etc?<br />how do i create and use my own file formats?<br />how do i use assorted texture formats?<br />how do i use different sound formats?<br />what about jumping,crouching?<br />how do i know how far away the wall is? and how do i draw it so it looks correct?<br />what about that stupid hall of mirrors effect? how do i get rid of it?<br />what about lines that dont fully intersect? how do i fix them so they are correct?<br />how do i apply bump mapping, etc. to textures?<br /></div><br />All the rest of these are answered in one form or another above.? They&#39;re also pretty off topic for &quot;how-to raycasting.&quot;? If you really have no idea on some of these, I suggest starting with 2d tilemap/sidescrollers.? If I&#39;m misinterpreting the question and you just don&#39;t see how they apply to raycasting, but understand these things otherwise, the answer is that they work just the same as you already know them.<br /><br />I hope that was some help.? If you or anyone else has any other references or resources, please post them!? I could use all the help I can get.<br /><br />P.S. if anybody who stumbles across this has any &quot;explained for a 5 year old&quot; or &quot;heavily commented for boneheads&quot; articles or source on syntax parsing or lexical analysis I&#39;d be forever in your debt.</div>
    <div class="meta">Posted on 2005-03-17 03:36:34 by ChupaThingy</div>
   </div>
   <div class="post" id="post-158050">
    <div class="subject"><a href="#post-158050">Re: raycasting again ;x</a></div>
    <div class="body">Don&#39;t use lookup tables for sin/cos stuff.<br />We&#39;re asm coders.. there&#39;s an asm solution to every problem.<br />Ask.<br /></div>
    <div class="meta">Posted on 2005-03-17 03:41:37 by Homer</div>
   </div>
   <div class="post" id="post-158081">
    <div class="subject"><a href="#post-158081">Re: raycasting again ;x</a></div>
    <div class="body">if you&#39;re not referring to fsincos, consider this asking.</div>
    <div class="meta">Posted on 2005-03-17 16:48:33 by ChupaThingy</div>
   </div>
   <div class="post" id="post-158082">
    <div class="subject"><a href="#post-158082">Re: raycasting again ;x</a></div>
    <div class="body">Yeah I was referring to fsin, fcos, fsincos, and the rest..<br />The fpu is fast and uses no resources.<br />Sine lookup tables are something I used on 8 bit machines (no fpu) in the 1980s.<br /><br /><div class="quote"><br />When I was a child, I spoke as a child, and did childish things...<br /></div></div>
    <div class="meta">Posted on 2005-03-17 17:54:05 by Homer</div>
   </div>
   <div class="post" id="post-158086">
    <div class="subject"><a href="#post-158086">Re: raycasting again ;x</a></div>
    <div class="body">The only reason I&#39;m using them at all is that the primary environment is VB.&nbsp; VB is extremely slow in almost every regard except development time.&nbsp; When I&#39;m debugging in the IDE I use the tables.&nbsp; When I&#39;m not using the JIT the precompiler switches kick in and I use the asm.&nbsp; I pretty much use VB as a compile-able pseudocode now.<br />Thanks for the response btw.</div>
    <div class="meta">Posted on 2005-03-17 19:01:39 by ChupaThingy</div>
   </div>
  </div>
 </body>
</html>