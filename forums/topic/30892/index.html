<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ASM NASM Newbie: Memory Byte Value Read/Write Problem - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30892" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=30892">ASM NASM Newbie: Memory Byte Value Read/Write Problem</a></p>
   <div class="post" id="post-216047">
    <div class="subject"><a href="#post-216047">ASM NASM Newbie: Memory Byte Value Read/Write Problem</a></div>
    <div class="body">I am sorry for asking this as it probably is a stupid question, but I am at a loss.<br /><br />I am 17 years old and brand new to ASM.&nbsp; I am trying to learn it because I do not like the idea of relying on other peoples code.&nbsp; I want to be able to make something entirely from scratch.&nbsp; In the field of programming I am a do it yourself guy.&nbsp; By the way, that is why I do not like the Cloud.<br /><br />I am writing OS level code.&nbsp; Therefore, I am using PXE booting with a bridged VirtualBox network connection to test it.&nbsp; I do this by specifying my program as the file on the server to boot to.<br /><br />I have written a previous program out of samples that worked fine(In the aspect I am asking in this question as It still has other bugs).&nbsp; However my new program(based off those same samples) is not correctly retrieving values stored in memory.&nbsp; I have written a basic program to demonstrate what is happening.&nbsp; Most of the code is just to write the characters on the screen, but the issue is this. I define the decimal ASCII value of a character I would like to print and store it in memory.&nbsp; Then I go to retrieve it and print it out.&nbsp; I should see the character I defined, but that is never what happens.&nbsp; However, if I directly send the character to be printed to the screen, it works fine.<br /><br />Here is the program that does not work:<br /><pre><code>	;tell the assembler that its a 16 bit code<br />	;Origin, tell the assembler that where the code will<br />;be in memory after it is been loaded<br /><br />JMP declar<br /><br />;Declare<br /><br />xpoint DB &#039;+&#039;<br />ypoint DB 45<br /><br />PrintChar:<br />MOV AH, 0x0E ;Teletype Write Text Int Type<br />MOV BL, 0x02 ;Set Color (Based on windows cmd colors)<br />MOV BH, 0x00 ;page number (text modes)<br />INT 0x10 ;Video Int<br />RET<br /><br />declar:<br /><br />;Wait For Keypress<br />MOV AH, 0<br />INT 0x16<br /><br />redraw:<br /><br />;Clear Screen<br />MOV AH, 0x00 ;Should Always Be 0 for this op<br />MOV AL, 0x12 ;Set Graphics Mode<br />INT 0x10 ;Video Int<br /><br />;MOV SI, xpoint<br />MOV AL, <br />CALL PrintChar<br />MOV AL, &#039;|&#039;<br />CALL PrintChar<br />MOV SI, ypoint<br />MOV AL, <br />CALL PrintChar<br /><br />idle:<br />JMP idle ;infinite loop<br /><br />;TIMES 510 - ($ - $$) db 0	;fill the rest of sector with 0<br />DW 0xAA55 ;Bootloader Verify</code></pre><br /><em><br /><br />Here is the one that does(Pay no attention to the comments.&nbsp; They are not accurate.&nbsp; Bad I know.&nbsp; I also just realized that the initial line of text is not being displayed.&nbsp; I do, however, remember it working before.&nbsp; I may have made a change that broke it.&nbsp; At this time, I can not find the problem.&nbsp; Do not worry to much about this code though.&nbsp; It was just something I was messing and practicing with a while back.):<br /><pre><code>	;Tells the assembler that its a 16 bit code<br />	;Origin, tell the assembler that where the code will<br />	;be in memory after it is been loaded<br /><br />MOV SI, TextEntry<br />MOV , SI<br />MOV AH, 00h<br />MOV AL, 12h<br />INT 10h	;Call video interrupt<br />MOV SI, helloMichael<br />CALL PrintString<br />JMP idle 		;Infinite loop, hang it here.<br /><br /><br />PrintString:	;Procedure to print character on screen<br />	;Assume that ASCII value is in register AL<br />MOV AL, <br />INC SI<br />OR AL, 0<br />JZ exit_function_000<br />MOV AH, 0Eh	;Tell BIOS that we need to print one charater on screen.<br />MOV BH, 00h	;Page no.<br />MOV BL, 0Ah	;Text attribute 0x07 is lightgrey font on black background<br />INT 10h	;Call video interrupt<br />CALL PrintString<br />exit_function_000:<br />RET<br /><br />idle:<br /><br />;Check If Keyboard Has Been Pressed<br />MOV AH, 01h<br />INT 16h<br />JNZ getKeyPress_go<br />getKeyPress_ret:<br />check_for_key_events_ret:<br />write_new_line_ret:<br />save_and_print_key_ret:<br />MOV AL, 0<br />MOV , AL<br /><br />;Loop<br />JMP idle<br /><br />getKeyPress_go:<br />MOV AH, 00h<br />INT 16h<br />MOV , AL<br />JMP check_for_key_events<br /><br />check_for_key_events:<br /><br />MOV AH, <br />CMP AH, 1Bh<br />JE dloop<br /><br />MOV AH, <br />;JMP save_and_print_key<br /><br />MOV SI, KeyPressed<br />CALL PrintString<br /><br />JMP check_for_key_events_ret<br /><br />dloop:<br />JMP $<br /><br />save_and_print_key:<br />MOV AL, AH<br />MOV SI, TextPointer<br />MOV , AL<br />INC SI<br />MOV , SI<br />MOV , AL<br />MOV SI, KeyPressed<br />CALL PrintString<br />JMP save_and_print_key_ret<br /><br />write_new_line:<br />MOV AL, 0Ah<br />MOV , AL<br />MOV SI, KeyPressed<br />CALL PrintString<br />MOV AL, 0Dh<br />MOV , AL<br />MOV SI, KeyPressed<br />CALL PrintString<br />MOV AL, 0<br />MOV , AL<br />ADD AX, 4<br />MOV , AX<br />MOV SI, Result_part_0<br />CALL PrintString<br />MOV SI, KeyPressed<br />CALL PrintString<br />MOV SI, Result_part_1<br />CALL PrintString<br /><br />JMP $<br /><br />JMP write_new_line_ret<br /><br />;Data<br />helloMichael	db	&#039;Hello.&#039;, 0Ah, 0Dh, &#039;Enter Any Text You Would Like Below.&#039;, 0Ah, 0Dh, &#039;Press Esc To Stop The System From Accepting Text.&#039;, 0Ah, 0Dh, 0Ah, 0Dh, 0<br />Result_part_0 db &#039;Your Number Plus 4 is: &#039;<br />Result_part_1 db &#039;.&#039;, 0Ah, 0Dh, 0<br />Line db &#039;Line&#039;, 0Ah, 0Dh, 0<br />Shut db &#039;Shutting Down&#039;, 0Ah, 0Dh, 0<br /><br />;Vars<br />KeyPressed db 0<br />PrintStopper db 0<br />TextPointer db 0<br />TextEntry db 0<br /><br />TIMES 510 - ($ - $$) db 0	;Fill the rest of sector with 0<br />DW 0xAA55</code></pre><br /><br />I have read many articles and various pages of documentation, but I can not find the problem.&nbsp; I am fairly certain it is a stupid one, though.&nbsp; Thank you for your help.</div>
    <div class="meta">Posted on 2012-06-19 21:33:40 by Quantum</div>
   </div>
   <div class="post" id="post-216049">
    <div class="subject"><a href="#post-216049">Re: ASM NASM Newbie: Memory Byte Value Read/Write Problem</a></div>
    <div class="body">The PrintString routine may cause a stack overflow, has a recursive call to itself generally JMP PrintString would better after the int 10 call.<br /><br /></div>
    <div class="meta">Posted on 2012-06-20 00:31:04 by forthnutter</div>
   </div>
   <div class="post" id="post-216050">
    <div class="subject"><a href="#post-216050">Re: ASM NASM Newbie: Memory Byte Value Read/Write Problem</a></div>
    <div class="body">Thank you, but I still do not know what the issue is in the first program.&nbsp; Also, that did not fix the problem.</div>
    <div class="meta">Posted on 2012-06-20 09:49:53 by Quantum</div>
   </div>
   <div class="post" id="post-216052">
    <div class="subject"><a href="#post-216052">Re: ASM NASM Newbie: Memory Byte Value Read/Write Problem</a></div>
    <div class="body">Are you being thrown off by your own &quot;Wait For Keypress&quot; code?<br /><br />Also, I don&#039;t see any explicit setup of the segments or the stack, so you are relying on unknown values. Such an assumption may cause intermittent failures. Note that this includes assumptions about the value of the CS register, some BIOS implementations will set CS to 07C0 with an initial IP of 0, while others will set CS to 0 with an initial IP of 7C00. In short, remove all assumptions.<br /></div>
    <div class="meta">Posted on 2012-06-20 10:41:45 by SpooK</div>
   </div>
   <div class="post" id="post-216054">
    <div class="subject"><a href="#post-216054">Re: ASM NASM Newbie: Memory Byte Value Read/Write Problem</a></div>
    <div class="body">Well setting the DS register to 0 fixed it!&nbsp; Thank you!&nbsp; I am very new to assembler.</div>
    <div class="meta">Posted on 2012-06-20 17:55:07 by Quantum</div>
   </div>
  </div>
 </body>
</html>