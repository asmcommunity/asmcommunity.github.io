<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>get drives question - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=22212" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=22212">get drives question</a></p>
   <div class="post" id="post-167040">
    <div class="subject"><a href="#post-167040">get drives question</a></div>
    <div class="body">i have this code, i understand alot of asm, but am still not getting a few things, in the following code:<br /><br /><br /><br />; -------------------------------------------<br />&nbsp; &nbsp; &nbsp; .486<br />&nbsp; &nbsp; &nbsp; .model flat, stdcall<br />&nbsp; &nbsp; &nbsp; option casemap :none<br />&nbsp; &nbsp; &nbsp; include \masm32\include\windows.inc<br />&nbsp; &nbsp; &nbsp; include \masm32\include\gdi32.inc<br />&nbsp; &nbsp; &nbsp; include \masm32\include\user32.inc<br />&nbsp; &nbsp; &nbsp; include \masm32\include\kernel32.inc<br />&nbsp; &nbsp; &nbsp; includelib \masm32\lib\gdi32.lib<br />&nbsp; &nbsp; &nbsp; includelib \masm32\lib\user32.lib<br />&nbsp; &nbsp; &nbsp; includelib \masm32\lib\kernel32.lib<br />; -------------------------------------------<br /><br />GetDrives&nbsp; &nbsp; PROTO <br /><br />; ------------------------------------------- <br /><br />.data <br /><br />	exts	DB	&quot;txt&quot;<br />	Ram	DB	&quot;Ram Drive&quot;,0<br />	HDD	DB	&quot;Hard Drive&quot;,0<br />	CD	DB	&quot;CDRom Drive&quot;,0<br />	Net	DB	&quot;Network Drive&quot;,0<br />	Rem	DB	&quot;Floppy/Removable Drive&quot;,0<br />	Unk	DB	&quot;Unknown Drive&quot;,0<br /><br />	DriveFmt db &quot;%s = %s&quot;,0<br /><br />.data?<br /><br />	buffer db 256 dup(?)<br /><br />; ------------------------------------------- <br /><br />.code<br /><br />START:<br /><br />	INVOKE GetDrives<br />	INVOKE ExitProcess,0<br /><br />	GetDrives PROC<br />&nbsp; &nbsp; 		LOCAL DRIVES[106]:BYTE<br />&nbsp; &nbsp; 		INVOKE GetLogicalDriveStrings, sizeof DRIVES, ADDR DRIVES<br />&nbsp; &nbsp; 		lea esi, DRIVES<br />&nbsp; &nbsp; 		mov ecx,eax ; ECX = LENGTH OF THE STRING<br />&nbsp; &nbsp; 		.WHILE ecx &gt; 0 ; Scan (DRIVES)<br />&nbsp; &nbsp; &nbsp; &nbsp; 		lea ebx, <br />&nbsp; &nbsp; &nbsp; &nbsp; 		push ecx ; GetDriveType modifies ECX<br />&nbsp; &nbsp; &nbsp; &nbsp; 		INVOKE GetDriveType, ebx ; drive type<br />&nbsp; &nbsp; &nbsp; &nbsp; 		.IF eax&nbsp; == DRIVE_FIXED <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  			INVOKE wsprintf,addr buffer,addr DriveFmt,esi,addr HDD <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  			invoke MessageBox,0,addr buffer,esi,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; 		.ELSEIF eax&nbsp; == DRIVE_CDROM<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		INVOKE wsprintf,addr buffer,addr DriveFmt,esi,addr CD&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		invoke MessageBox,0,addr buffer,esi,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; 		.ELSEIF eax&nbsp; == DRIVE_RAMDISK<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		INVOKE wsprintf,addr buffer,addr DriveFmt,esi,addr Ram<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		invoke MessageBox,0,edi,addr buffer,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; 		.ELSEIF eax&nbsp; == DRIVE_REMOTE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		INVOKE wsprintf,addr buffer,addr DriveFmt,esi,addr&nbsp; Net<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		invoke MessageBox,0,addr buffer,esi,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; 		.ELSEIF eax&nbsp; == DRIVE_REMOVABLE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		INVOKE wsprintf,addr buffer,addr DriveFmt,esi,addr&nbsp; Rem<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		invoke MessageBox,0,addr buffer,esi,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; 		.ELSE&nbsp;  ;its a unknown drive<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		INVOKE wsprintf,addr buffer,addr DriveFmt,esi,addr&nbsp; Unk<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		invoke MessageBox,0,addr buffer,esi,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; 		.ENDIF <br />&nbsp; &nbsp; &nbsp; &nbsp; 		pop ecx ; revive ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; 		add esi, 4 <br />&nbsp; &nbsp; &nbsp; &nbsp; 		sub ecx, 4 <br />&nbsp; &nbsp; 		.ENDW<br />&nbsp; &nbsp; 		ret<br />	GetDrives endp<br />END START<br /><br />------------------------------------------- <br /><br /><br />1.) buffer db 256 dup(?) - why a buffer variable, and why is it not initializaed?<br />2.) DriveFmt db &quot;%s = %s&quot;,0 - this reminds me of python, but i still dont seem to get what this does? its not in my masm reference<br />3.) INVOKE wsprintf,addr buffer,addr DriveFmt,esi,addr&nbsp; Rem - how does wsprintf work? why do i need a buffer once again, and what is addr? <br /><br />thanks in advance. i&#39;ve read a good manual and a couple tutorials but i still dont grasp a few things<br /></div>
    <div class="meta">Posted on 2005-10-18 19:15:21 by marla</div>
   </div>
   <div class="post" id="post-167041">
    <div class="subject"><a href="#post-167041">Re: get drives question</a></div>
    <div class="body">1) So that we can fill it up later.<br />2 and 3) Do you use sprintf of C or related programming language? Usage of wsprintf is similiar to sprint. You can check up on the usage of wsprintf. <a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/wsprintf.asp">here</a><br />addr is address of the variable. Remember your lesson 101 in pointers?</div>
    <div class="meta">Posted on 2005-10-18 21:05:02 by roticv</div>
   </div>
  </div>
 </body>
</html>