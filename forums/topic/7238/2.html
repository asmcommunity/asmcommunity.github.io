<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>changing syscolors only for prog - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=7238" />
  <link rel="prev" href="../?id=7238&amp;page=1" />  <link rel="next" href="../?id=7238&amp;page=3" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=7238">changing syscolors only for prog</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=7238&amp;page=1" style="">&laquo;</a><a href="../?id=7238&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="7238" /><input type="number" name="page" min="1" max="3" step="1" value="2" onchange="this.form.submit();" /><a href="../?id=7238&amp;page=3">&gt;</a><a href="../?id=7238&amp;page=3">&raquo;</a></form>   <div class="post" id="post-52620">
    <div class="subject"><a href="#post-52620">changing syscolors only for prog</a></div>
    <div class="body">do you all READ my question before you post such a not-to-my-thread-matching-thing?! don't you see the image i've posted in the thread's beginning?! the best of you all was <strong>Roy Cline</strong> - i would change the whole system's colors! did i want that? - NO! i said it in my question at the beginning!<br />how has the programmer of this program done this black window - WITHOUT changing the whole system's colors?! how does ownerdrawing work? these and some other question seem to be impossible to be answered! but i still would be glad about reading some answers!<br /><br />greets, hartyl</div>
    <div class="meta">Posted on 2002-08-11 06:42:27 by hartyl</div>
   </div>
   <div class="post" id="post-52622">
    <div class="subject"><a href="#post-52622">changing syscolors only for prog</a></div>
    <div class="body">Oh, it ain't even your program, damn, now I know where I've seen this before. :grin: <br /><br />Why don't you take a look at my program and use a solid black brush instead of a<br />pattern brush. People told you what to do all through the thread - looks like you can't<br />read.<br />Why don't you look up WM_CTLCOLOR* messages. If you don't know what window <br />messages are<br /><div class="quote"> go to Izcelion's page: <a target="_blank" href="http://win32asm.cjb.net/">http://win32asm.cjb.net/</a> </div><br />like chorus told you before.<br />If you don't know where to search, search this board or msdn library for<br />WM_CTLCOLOR* and CreateSolidBrush.</div>
    <div class="meta">Posted on 2002-08-11 06:56:39 by goofee</div>
   </div>
   <div class="post" id="post-52625">
    <div class="subject"><a href="#post-52625">changing syscolors only for prog</a></div>
    <div class="body">i CAN read - seem you can't:<br />i've said in the forelast post, that with the WM_CTLCOLORxxx-Messages i can only change the BACKGROUND- and the TEXTCOLOR - NOT the border, NOT the frame, NOT the caption! so how can i make a completely black window (with some different colors, so you can see the control items... - BUT NOT GRAY) ?!<br /><br />:confused: :confused: :confused:</div>
    <div class="meta">Posted on 2002-08-11 07:06:12 by hartyl</div>
   </div>
   <div class="post" id="post-52628">
    <div class="subject"><a href="#post-52628">changing syscolors only for prog</a></div>
    <div class="body"><div class="quote">NOT the border, NOT the frame, NOT the caption</div> <br /><br />read what chorus said about 15 posts before<br /><br /><br /><br /><div class="quote">with some different colors, so you can see the control items... - BUT NOT GRAY</div> <br /><br />why don't you look at my program or go to iczellions site for sub-/super-classing or<br />search the board WM_CTLCOLOR* messages, will you do that please ?<br /><br />Regards, <br />goofee</div>
    <div class="meta">Posted on 2002-08-11 07:15:52 by goofee</div>
   </div>
   <div class="post" id="post-52629">
    <div class="subject"><a href="#post-52629">changing syscolors only for prog</a></div>
    <div class="body">For the window i think you should use WM_NCPAINT<br /><br />from Platform SDK:<br /><div class="quote"><br />The DefWindowProc function paints the window frame. <br /><br />An application can intercept the WM_NCPAINT message and paint its own custom window frame. The clipping region for a window is always rectangular, even if the shape of the frame is altered. <br /><br />The wParam value can be passed to GetDCEx as in the following example.<br /></div></div>
    <div class="meta">Posted on 2002-08-11 07:17:45 by ante</div>
   </div>
   <div class="post" id="post-52632">
    <div class="subject"><a href="#post-52632">changing syscolors only for prog</a></div>
    <div class="body">@ante: THIS could work, greets to you<br /><br />@goofee: am i wrong or not?! with you WM_CTLCOLORxxx-Message you GIVE windows a BRUSH which it uses to draw the BACKGROUND and the TEXT, but NOT the border, NOT the frame, NOT the caption - it is so, isn't it? in you program you use also this function to draw the BACKGROUND of you control items and you change the color of the TEXT but NOT the border, NOT the frame, NOT the caption - it is so, isn't it? how often do you want to tell me to use the WM_CTLCOLORxxx-message if it doesn't work for my purporse? tell me if i was wrong...<br /><br />now i'm gonna try the WM_NCPAINT-message and see...</div>
    <div class="meta">Posted on 2002-08-11 07:26:04 by hartyl</div>
   </div>
   <div class="post" id="post-52633">
    <div class="subject"><a href="#post-52633">changing syscolors only for prog</a></div>
    <div class="body">I thought you need the borders,frame and caption for your<br />window not your controls.<br /><br />MSDN library says:<br /><div class="quote"><br />WM_DRAWITEM<br />The WM_DRAWITEM message is sent to the owner window of an owner-drawn button, combo box, list box, or menu when a visual aspect of the button, combo box, list box, or menu has changed. <br /></div><br /><br />You will need to draw all controls yourself.</div>
    <div class="meta">Posted on 2002-08-11 07:32:25 by goofee</div>
   </div>
   <div class="post" id="post-52639">
    <div class="subject"><a href="#post-52639">aaaargghh</a></div>
    <div class="body">hartyl,<br /> From my original post <strong>two days ago</strong>:<br /><br /><div class="quote"><br />For the Non-Client Area (caption bar, frame) you'll probably wanna intercept <strong>WM_NCPAINT</strong> and call DrawCaption and/or DrawFrameControl or some custom procedure<br /></div><br /><br />Please read the responses people give you! We *are* trying to help you but you just plain aren't listening. Have fun with WM_NCPAINT. If you have trouble with that message, post the code you are working on and someone will give you what assistance they can. <br /><br />By the way, I don't think you've even given someone so much as a thanks for their efforts. Even Roy Cline, though his post wasn't quite on topic, was trying to help. Like the rest of us, he bothered to take the time to write something. Next time you have a post, don't count on these people even bothering to read your post if you won't even show some gratitude.<br /><br />--Chorus</div>
    <div class="meta">Posted on 2002-08-11 07:53:00 by chorus</div>
   </div>
   <div class="post" id="post-52641">
    <div class="subject"><a href="#post-52641">changing syscolors only for prog</a></div>
    <div class="body">Goofee,<br />  I believe the problem with the smearing *is* the null brush. What happens when the window scrolls is that Windows first erases the background then paints the text. If there's a null brush for the background then no erasing gets done and the WM_PAINT simply draws on top of what's there before. Hence the smearing.<br /><br />Maybe there's another cause for it, but that'd be my best guess.<br /><br />You probably don't see the smearing in the other controls because they are single line and hence, no scrolling. Have you tried typing in anything that will cause the box to scroll horizontally? you might see it then. I gave it a try, but the edit boxes didn't seem to be accepting any input, and I can read the other buttons to know which one to press to enter data :) So I tried pressing them all... didn't seem to help... managed to open up notepad though ;)<br /><br />Oh, this my contribute to your problem too, because the text is not drawn with a background color:<br /><pre><code><br />	invoke SetBkMode,wParam,TRANSPARENT<br /></code></pre><br /><br />although I'm sure it's pretty vital to your code so you can see the background brush through the text... shrugs.<br /><br />--Chorus</div>
    <div class="meta">Posted on 2002-08-11 08:04:55 by chorus</div>
   </div>
   <div class="post" id="post-52656">
    <div class="subject"><a href="#post-52656">changing syscolors only for prog</a></div>
    <div class="body">Thanks, chorus.<br /><br />The problem really seems to be the transparent background.<br />But then, I might not texture it at all :grin:<br /><br />You will need to open a file before the edit control becomes active.<br />Try opening this file via Datei-&gt;Datei ?ffnen:</div>
    <div class="meta">Posted on 2002-08-11 09:01:45 by goofee</div>
   </div>
   <div class="post" id="post-52681">
    <div class="subject"><a href="#post-52681">changing syscolors only for prog</a></div>
    <div class="body">i think i... erm... apologize for my last (mean?) posts... and thanks for ya answers<br />i've decided to make everything ownerdrawn - it isnt that difficult so take a look at my results (attached image). the button is really owner-drawn, but the edit-controls are just without a border and the background and the textcolor is set with the WM_CTLCOLOREDIT. but the window's the problem. the background is a bitmap, set with hbrBackground in the windowclass. so i have to CreateWindowEx the window and use WS_POPUP. but the i have also to create the control-items with this function too - thats not good!<br />question: is there any possibility to load the dialog-info from the RC AND using the bitmap as a background WITHOUT a caption bar? i've tried a little bit, but it always shows the cation too despite using ONLY WS_POPUP</div>
    <div class="meta">Posted on 2002-08-11 12:08:17 by hartyl</div>
   </div>
   <div class="post" id="post-52684">
    <div class="subject"><a href="#post-52684">changing syscolors only for prog</a></div>
    <div class="body">Can I have a look at your your code on how to owner draw the buttons ?<br />I'm having problems with that,too.<br /><br />You can use CreateDialogParam for your dialog and pass it your own window<br />class you will need to set the BS_OWNERDRAW style using with SetWindowLong<br />for it won't work if you specify it in the resource.</div>
    <div class="meta">Posted on 2002-08-11 12:24:44 by goofee</div>
   </div>
   <div class="post" id="post-52692">
    <div class="subject"><a href="#post-52692">changing syscolors only for prog</a></div>
    <div class="body"><div class="quote"><br />You can use CreateDialogParam for your dialog and pass it your own window<br />class you will need to set the BS_OWNERDRAW style using with SetWindowLong<br />for it won't work if you specify it in the resource.<br /></div><br /><br />i don't know how you mean that, goofee. do i have to do that, if i want to use the background-image and if i dont want to have a window-caption?<br /><br />and here some owner-draw-code:<br /><br />you need to respond on the WM_DRAWITEM-message. i've declared a universal DrawItem-function. you hand the pointer to the DRAWITEMSTRUCT of the item over to this funciton:<br /><pre><code><br />...<br />.elseif eax==WM_DRAWITEM<br />  invoke DrawItem,lParam<br />...<br /></code></pre><br />here the prototype you put into the *.inc-file (or where you usually have them...):<br /><pre><code><br />DrawItem proto &#58;DWORD<br /></code></pre><br />and now the function itsselfs (with comments)<br /><pre><code><br />DrawItem proc item&#58;DWORD<br />.data?<br />  dc HANDLE ?<br />  brush HANDLE ?<br />  font HANDLE ?<br />  pen HANDLE ?<br />  buf db 256 dup&#40;?&#41;<br />.code<br />  mov esi,item ;move the pointer into esi<br />  assume esi&#58;ptr DRAWITEMSTRUCT ;assume this pointer as a DRAWITEMSTRUCT-pointer &#40;to use the &quot;sub-items&quot;&#41;<br />  mov eax,&#91;esi&#93;.CtlType ;move the type into eax<br />  m2m dc,&#91;esi&#93;.hdc ;and copy the dc<br />  .if eax==ODT_BUTTON ;item is a button &#40;look up the other types you can draw - you CAN'T draw EDITboxes! &#40;has no owner-draw-style<br />    .if &#40;&#91;esi&#93;.itemState&amp;ODS_DISABLED&#41; ;if the state is 'DISABLED' &#40;i was too lazy to code that...&#41;<br />    .else<br />      iif &#91;esi&#93;.itemState&amp;ODS_FOCUS,0804c00h,0603900h ;this is a macro&#58; if the first arg is TRUE the 2nd is returned, else the 3rd<br />      invoke CreateSolidBrush,eax ;finally draw everything<br />      mov brush,eax<br />      invoke SelectObject,dc,brush	    <br />      invoke FillRect,dc,addr &#91;esi&#93;.rcItem,brush<br />      invoke CreateSolidBrush,0ff9900h<br />      mov brush,eax<br />      invoke SelectObject,dc,brush<br />      invoke DeleteObject,eax<br />      invoke FrameRect,dc,addr &#91;esi&#93;.rcItem,brush<br />      invoke SetTextAlign,dc,TA_BASELINE or TA_CENTER<br />      invoke SetBkMode,dc,TRANSPARENT<br />      invoke SetTextColor,dc,0ff9900h<br />      invoke GetWindowText,&#91;esi&#93;.hwndItem,addr buf,256<br />      mov ebx,&#91;esi&#93;.rcItem.right<br />      shr ebx,1<br />      mov ecx,&#91;esi&#93;.rcItem.bottom<br />      shr ecx,1<br />      add ecx,4<br />      invoke lstrlen,addr buf<br />      invoke TextOut,dc,ebx,ecx,addr buf,eax<br />    .endif	<br />  .endif<br />  ret<br />DrawItem endp<br /></code></pre><br /><br />i hope this helps</div>
    <div class="meta">Posted on 2002-08-11 12:54:36 by hartyl</div>
   </div>
   <div class="post" id="post-52704">
    <div class="subject"><a href="#post-52704">changing syscolors only for prog</a></div>
    <div class="body">No, actually it doesn't.<br /><br />I'm using LineTo to draw standard borders instead of FrameRect:<br /><pre><code><br />DrawControl				PROC	hWnd			&#58;DWORD,<br />								wParam			&#58;DWORD,<br />								lParam			&#58;DWORD<br />						<br />						LOCAL	hOldPen			&#58;DWORD<br />						LOCAL	hOffScreenDC	&#58;DWORD<br />						<br />	push edi<br />	mov edi,lParam<br />	assume edi&#58;PTR DRAWITEMSTRUCT<br />	invoke FillRect,&#91;edi&#93;.hdc,addr &#91;edi&#93;.rcItem,hBackBrush<br />	mov eax,&#91;edi&#93;.itemState<br />	and eax,ODS_SELECTED<br />	jz Not_Selected<br />	invoke SelectObject,&#91;edi&#93;.hdc,hShadowPen<br />	mov hOldPen,eax<br />	invoke MoveToEx,&#91;edi&#93;.hdc,0,&#91;edi&#93;.rcItem.bottom-1,NULL<br />	invoke LineTo,&#91;edi&#93;.hdc,0,0<br />	invoke LineTo,&#91;edi&#93;.hdc,&#91;edi&#93;.rcItem.right-1,0<br />	invoke SelectObject,&#91;edi&#93;.hdc,hHighlightPen<br />	invoke LineTo,&#91;edi&#93;.hdc,&#91;edi&#93;.rcItem.right-1,&#91;edi&#93;.rcItem.bottom<br />	invoke LineTo,&#91;edi&#93;.hdc,0,&#91;edi&#93;.rcItem.bottom-1<br />	invoke OffsetRect,addr &#91;edi&#93;.rcItem,1,1<br />	jmp Done<br />Not_Selected&#58;<br />	invoke SelectObject,&#91;edi&#93;.hdc,hShadowPen<br />	mov hOldPen,eax<br />	PrintDec eax<br />	invoke MoveToEx,&#91;edi&#93;.hdc,0,&#91;edi&#93;.rcItem.bottom-1,NULL<br />	invoke LineTo,&#91;edi&#93;.hdc,0,0<br />	invoke LineTo,&#91;edi&#93;.hdc,&#91;edi&#93;.rcItem.right-1,0<br />	invoke SelectObject,&#91;edi&#93;.hdc,hHighlightPen<br />	invoke LineTo,&#91;edi&#93;.hdc,&#91;edi&#93;.rcItem.right-1,&#91;edi&#93;.rcItem.bottom<br />	invoke LineTo,&#91;edi&#93;.hdc,0,&#91;edi&#93;.rcItem.bottom-1<br />Done&#58;<br />	invoke SelectObject,&#91;edi&#93;.hdc,hOldPen<br />	invoke SetBkMode,&#91;edi&#93;.hdc,TRANSPARENT<br />	invoke DrawText,&#91;edi&#93;.hdc,CTEXT&#40;&quot;Start&quot;&#41;,-1,addr &#91;edi&#93;.rcItem,DT_SINGLELINE or DT_CENTER or DT_VCENTER<br />	assume edi&#58;nothing<br />	pop edi<br />	ret<br />DrawControl	endp<br /></code></pre><br /><br /><div class="quote">do i have to do that, if i want to use the background-image</div><br />Yes, exactly.<br />It works just like CreateWindow using a window class structure.<br />About the caption I'm not quite sure myself how to remove it.</div>
    <div class="meta">Posted on 2002-08-11 13:20:16 by goofee</div>
   </div>
   <div class="post" id="post-52705">
    <div class="subject"><a href="#post-52705">changing syscolors only for prog</a></div>
    <div class="body">Btw, are you using SetCaption in your code or creating the window with<br />CreateWindowEx passing it an app name ?</div>
    <div class="meta">Posted on 2002-08-11 13:26:08 by goofee</div>
   </div>
   <div class="post" id="post-52706">
    <div class="subject"><a href="#post-52706">changing syscolors only for prog</a></div>
    <div class="body"><div class="quote">About the caption I'm not quite sure myself how to remove it.</div><br />so it still HAS the caption?<br /><br />i'm too lazy to test you code - so whats the problem with it you said some posts ago? i think your version is a little bit pedantically. i think you only need to give the DRAWITEMSTRUCT to the proc. does it make problems with the pen so you backup it and restore it? you could make a screenie of you button, i'd like to see it.</div>
    <div class="meta">Posted on 2002-08-11 13:29:53 by hartyl</div>
   </div>
   <div class="post" id="post-52708">
    <div class="subject"><a href="#post-52708">changing syscolors only for prog</a></div>
    <div class="body"><div class="quote"><br />Btw, are you using SetCaption in your code or creating the window with<br />CreateWindowEx passing it an app name ?<br /></div><br />i create my window (only for colored windows) with CreateWIndowEx. else i use DialogBoxParam</div>
    <div class="meta">Posted on 2002-08-11 13:32:10 by hartyl</div>
   </div>
   <div class="post" id="post-52711">
    <div class="subject"><a href="#post-52711">changing syscolors only for prog</a></div>
    <div class="body">Are you<br /><div class="quote">passing it an app name ?</div> <br /><br />=window name<br /><br /><pre><code><br />invoke CreateWindowEx,NULL,ADDR ClassNameHere,WINDOWNAMEHERE,WS_POPUP,20,\<br />		213,180,10,NULL,NULL,hInstance,NULL<br /></code></pre></div>
    <div class="meta">Posted on 2002-08-11 13:43:26 by goofee</div>
   </div>
   <div class="post" id="post-52719">
    <div class="subject"><a href="#post-52719">changing syscolors only for prog</a></div>
    <div class="body">i'm at work and just taking a brief look at the posts:<br /><br />1) From what I can tell you want to create a main window with no caption bar (is this right?). For the main window, it isn't enough to create the window withough the WS_CAPTION style. You have to define<br /><br />WS_NOCAPTION EQU 80000000h<br /><br />and create your window with this style (leave out WS_CAPTION). Note: this has worked on all systems I've tested but I have never seen official documentation on this. Maybe someone knows differently.<br /><br />2) Perhaps instead of using the bitmap as a background brush, you can BitBlt the bitmap in WM_PAINT and leave the background brush as NULL. You may get better performance this way. On the other hand, if you never resize the window (are you using WS_THICKFRAME?) than you may not notice the difference<br /><br /><br />I'll take a closer look later<br /><br />--Chorus</div>
    <div class="meta">Posted on 2002-08-11 14:01:03 by chorus</div>
   </div>
   <div class="post" id="post-52730">
    <div class="subject"><a href="#post-52730">changing syscolors only for prog</a></div>
    <div class="body">Hi, in the FAQ area thare are some usefull info about all these subjects:<br /><br />Getting rid of the title bar:<br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=697">http://www.asmcommunity.net/board/index.php?topic=697</a> <br /><br />how to set a bitmap as background of a dialog box?<br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=1012">http://www.asmcommunity.net/board/index.php?topic=1012</a><br /><br />Owner Draw buttons..<br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=6920">http://www.asmcommunity.net/board/index.php?topic=6920</a></div>
    <div class="meta">Posted on 2002-08-11 15:31:25 by LuHa</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=7238&amp;page=1" style="">&laquo;</a><a href="../?id=7238&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="7238" /><input type="number" name="page" min="1" max="3" step="1" value="2" onchange="this.form.submit();" /><a href="../?id=7238&amp;page=3">&gt;</a><a href="../?id=7238&amp;page=3">&raquo;</a></form>  </div>
 </body>
</html>