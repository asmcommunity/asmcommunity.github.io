<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Tab Control Freeze + Weird Behaviour - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29042" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29042">Tab Control Freeze + Weird Behaviour</a></p>
   <div class="post" id="post-205181">
    <div class="subject"><a href="#post-205181">Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">Hello,<br /><br />My problem is that I&#039;m writing an interface for a project of mine and I wanted to use the Tab Control. I created it successfully and can go from one to the other with no problem. However, the problem occurs when I try to stick a child window to each tab. By doing so, the tab freezes and the CPU usage jumps to 100% and the child frames gets a caption bar. I am also attaching the project (interface) for you to see if am doing something wrong.</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=2569" target="_blank">pe_crypter_4.rar</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2008-04-27 17:42:38 by halsten</div>
   </div>
   <div class="post" id="post-205182">
    <div class="subject"><a href="#post-205182">Re: Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">Yeah, I had this problem before and can&#039;t remember what the solution is. I think, though this was years back you have to set the WS_EX_CONTROLPARENT style bit, don&#039;t quote me on it though....</div>
    <div class="meta">Posted on 2008-04-27 17:55:59 by donkey</div>
   </div>
   <div class="post" id="post-205194">
    <div class="subject"><a href="#post-205194">Re: Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">It&#039;s already set in the editor.</div>
    <div class="meta">Posted on 2008-04-27 21:31:29 by halsten</div>
   </div>
   <div class="post" id="post-205196">
    <div class="subject"><a href="#post-205196">Re: Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">I remember this. The problem is that our resource editors set the line CAPTION &quot;IDD_DLG1005&quot; in our child dialogs. This appearantly tells windows to ignore the style and force a caption. delete that line or set the caption to blank and the problem will be gone. <br /></div>
    <div class="meta">Posted on 2008-04-28 03:44:15 by JimmyClif</div>
   </div>
   <div class="post" id="post-205197">
    <div class="subject"><a href="#post-205197">Re: Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">The freezing is due to an oversight in the DialogProcs, A regular dialog proc used with CreateDialogParam looks a little like this:<br /><br /><pre><code><br />DlgInformation proc	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />	mov eax,uMsg<br />	.if eax==WM_INITDIALOG<br />		push hWin<br />		pop hTab<br />	.elseif eax==WM_CLOSE<br />		invoke EndDialog,hWin,NULL<br />	.else<br />		mov		eax,FALSE<br />		ret<br />	.endif<br />	mov		eax,TRUE<br />	ret<br />DlgInformation endp<br /></code></pre><br /><br />As you can see you forgot the <strong>else</strong> part. Also you create all your dialogs with the visible style, while you assume they&#039;d be invisible when starting the app. <br /><br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=25492.0"><u>Here</u></a> is a TabStrib/Child Window tut I once did on the board. Maybe it can help you somehow. Although I use RadAsm I believe WinAsm should come pretty close.<br /><br />Cheers,<br />Jimmy<br /><br /></div>
    <div class="meta">Posted on 2008-04-28 04:04:37 by JimmyClif</div>
   </div>
   <div class="post" id="post-205198">
    <div class="subject"><a href="#post-205198">Re: Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">Hello,<br /><br />I removed that line and it fixed the problem, however the childs are now drawn on the tabs itself and I can&#039;t see it. Any ideas on how to fix that? Thanks in advance.</div>
    <div class="meta">Posted on 2008-04-28 04:40:13 by halsten</div>
   </div>
   <div class="post" id="post-205199">
    <div class="subject"><a href="#post-205199">Re: Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">Yes, you need to resize the dialog to position it under the tabs. Check out the link I gave you - the attachment is a few posts up. <br /><br />Use GetClientRect on the tabs and then MoveWindow the child dialog adjusting it to the height (25) of the tab itself.</div>
    <div class="meta">Posted on 2008-04-28 06:02:37 by JimmyClif</div>
   </div>
   <div class="post" id="post-205200">
    <div class="subject"><a href="#post-205200">Re: Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">Okay, thanks a lot for your efforts in helping me!</div>
    <div class="meta">Posted on 2008-04-28 06:06:09 by halsten</div>
   </div>
   <div class="post" id="post-205204">
    <div class="subject"><a href="#post-205204">Re: Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">Hello,<br /><br />Sorry to bother again, but I did as you suggested. And I checked the sample as well. But, it&#039;s still drawn on the tab itself.<br />Here&#039;s my code, do you see something wrong about it?<br /><br /><pre><code><br />.486<br />.model flat, stdcall<br />option casemap :none<br /><br />include		windows.inc<br /><br />include	kernel32.inc<br />include	user32.inc<br />include	masm32.inc<br />include	comctl32.inc<br />include	advapi32.inc<br />include	comdlg32.inc<br />include	gdi32.inc<br /><br />includelib kernel32.lib<br />includelib user32.lib<br />includelib masm32.lib<br />includelib comctl32.lib<br />includelib advapi32.lib<br />includelib comdlg32.lib<br />includelib gdi32.lib<br /><br />WinMain						proto	<br />DlgMain						proto	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />DlgLog 						proto	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />DlgInformation				proto	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />DlgProtection				proto	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br /><br />.const<br />	IDD_MAINDLG					equ	1001<br />	IDD_LOGDLG					equ 1002	<br />	IDD_INFORMATIONDLG			equ 1005<br />	IDD_PROTECTIONDLG			equ 1006<br />	<br />	DLG_LOG						equ	4000<br />	DLG_INFORMATION				equ	4001<br />	DLG_PROTECTION				equ	4002<br />	DLG_ADVANCEDPROTECTION		equ	4003<br />	<br />	IDC_TAB						equ	100<br />	<br />.data<br />	szApplicationTitle			db &quot;mQUBE&quot;, 0h<br />	szApplicationVersion		db &quot;v1.0&quot;, 0h<br />	<br />	szTabLog					db &quot;Log&quot;, 0h<br />	szTabInformation			db &quot;Information&quot;, 0h<br />	szTabProtection				db &quot;Protection&quot;, 0h<br />	szTabAdvancedProtection		db &quot;Advanced Protection&quot;, 0h<br />	<br /><br />.data?<br />	hInstance					HINSTANCE 	?<br />	<br />	ItemStruct					TC_ITEM		&lt;?&gt;<br />	<br />	hTab						HWND		?<br />	<br />	hDlgLog						HWND 		?<br />	hDlgInformation				HWND		?<br />	hDlgProtection				HWND		?<br />	hDlgAdvancedProtection		HWND		?<br />	<br />	PrevSelTab					HWND		?<br />	<br />.code<br /><br />WinMain	proc<br />	invoke 	InitCommonControls<br />	invoke	GetModuleHandle, NULL<br />	mov		hInstance, eax<br />	invoke 	DialogBoxParam, hInstance, IDD_MAINDLG, NULL, offset DlgMain, NULL<br />	invoke 	ExitProcess, NULL<br />	ret<br />WinMain endp<br /><br /><br />DlgMain	proc hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />	LOCAL rect:RECT<br />	<br />	.if	uMsg == WM_INITDIALOG<br />		invoke	GetDlgItem, hWin, IDC_TAB<br />		mov 	hTab, eax<br />		<br />		mov 	ItemStruct.imask, TCIF_TEXT<br />		<br />		mov 	ItemStruct.pszText, offset szTabLog<br />		invoke 	SendMessage, hTab, TCM_INSERTITEM, 0, offset ItemStruct<br />		<br />		mov 	ItemStruct.pszText, offset szTabInformation<br />		invoke 	SendMessage, hTab, TCM_INSERTITEM, 1, offset ItemStruct<br />		<br />		mov 	ItemStruct.pszText, offset szTabProtection<br />		invoke 	SendMessage, hTab, TCM_INSERTITEM, 3, offset ItemStruct<br />		<br />		mov 	ItemStruct.pszText, offset szTabAdvancedProtection<br />		invoke 	SendMessage, hTab, TCM_INSERTITEM, 4, offset ItemStruct<br />		<br />		invoke	CreateDialogParam, hInstance, IDD_LOGDLG, hTab, Offset DlgLog, 0	<br />		mov		hDlgLog, eax<br />		<br />		invoke	CreateDialogParam, hInstance, IDD_INFORMATIONDLG, hTab, Offset DlgInformation, 0	<br />		mov		hDlgInformation, eax		<br />		<br />		invoke	CreateDialogParam, hInstance, IDD_INFORMATIONDLG, hTab, Offset DlgProtection, 0	<br />		mov		hDlgProtection, eax		<br />		<br />		invoke	ShowWindow, hDlgLog, SW_SHOWDEFAULT<br />		<br />		push	PrevSelTab<br />		pop		hDlgLog<br />		<br />		invoke 	GetClientRect,hTab,addr rect<br />		sub 	rect.bottom, 25<br />		invoke 	MoveWindow,hTab,0,25,rect.right,rect.bottom,TRUE<br />		<br />	.elseif eax==WM_SIZE<br />		invoke 	GetClientRect, hWin,addr rect<br />		invoke 	GetDlgItem, hWin, 1002<br />		invoke 	MoveWindow, eax, 0, 0, rect.right, rect.bottom, TRUE<br />		<br />	.elseif	uMsg == WM_COMMAND<br />		;.if wParam == IDM_EXIT	; -&gt; Exit<br />		;	invoke EndDialog,hWin,NULL<br />		;.elseif wParam == IDM_ABOUT	; -&gt; About<br />		;	invoke MessageBox,hWin,addr lpAbout,addr App,MB_OK<br />		;.endif<br />	.elseif	uMsg == WM_NOTIFY<br />		mov eax, lParam<br />		assume eax:ptr NMHDR<br />		.if	wParam == IDC_TAB &amp;&amp; .code == TCN_SELCHANGE<br />			Invoke SendMessage, hTab, TCM_GETCURSEL, 0, 0<br />			.if	eax == 0<br />				mov edi, hDlgLog<br />			.elseif eax == 1<br />				mov edi, hDlgInformation<br />			.elseif eax == 2<br />				mov edi, hDlgProtection<br />			.elseif eax == 3<br />				mov edi, hDlgAdvancedProtection<br />			.endif<br />			Invoke ShowWindow, PrevSelTab, SW_HIDE<br />			Invoke ShowWindow, edi, SW_SHOWDEFAULT<br />			mov PrevSelTab, edi<br />			<br />			invoke GetClientRect, hTab, addr rect<br />			sub rect.bottom, 25<br />			invoke MoveWindow,hTab, 0, 25, rect.right, rect.bottom, TRUE<br />		.endif<br />		assume eax:nothing<br />	.elseif	uMsg == WM_CLOSE<br />		invoke EndDialog, hWin, NULL<br />	.endif<br />	xor eax,eax<br />	ret<br />DlgMain endp<br /><br />DlgLog proc	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />	mov eax, uMsg<br />	.if eax == WM_INITDIALOG<br />		push hWin<br />		pop hTab<br />	.elseif eax == WM_CLOSE<br />		invoke EndDialog, hWin, NULL<br />	.else<br />		mov	eax, FALSE<br />		ret<br />	.endif<br />	mov	eax, TRUE<br />	ret<br />DlgLog endp<br /><br />DlgInformation proc	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />	mov eax, uMsg<br />	.if eax == WM_INITDIALOG<br />		push hWin<br />		pop hTab<br />	.elseif eax == WM_CLOSE<br />		invoke EndDialog, hWin, NULL<br />	.else<br />		mov	eax, FALSE<br />		ret<br />	.endif<br />	mov	eax, TRUE<br />	ret<br />DlgInformation endp<br /><br />DlgProtection proc	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />	mov eax, uMsg<br />	.if eax == WM_INITDIALOG<br />		push hWin<br />		pop hTab<br />	.elseif eax == WM_CLOSE<br />		invoke EndDialog, hWin, NULL<br />	.else<br />		mov	eax, FALSE<br />		ret<br />	.endif<br />	mov	eax, TRUE<br />	ret<br />DlgProtection endp<br /><br />end WinMain<br /></code></pre></div>
    <div class="meta">Posted on 2008-04-28 06:21:57 by halsten</div>
   </div>
   <div class="post" id="post-205205">
    <div class="subject"><a href="#post-205205">Re: Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">Instead of <strong>hTab</strong> use <strong>PrevSelTab</strong> in the following snippet:<br /><br /><pre><code><br />invoke GetClientRect, hTab, addr rect<br />sub rect.bottom, 25<br />invoke MoveWindow,hTab, 0, 25, rect.right, rect.bottom, TRUE<br /></code></pre></div>
    <div class="meta">Posted on 2008-04-28 06:29:33 by JimmyClif</div>
   </div>
   <div class="post" id="post-205206">
    <div class="subject"><a href="#post-205206">Re: Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">Okay, I changed that and still nothing.</div>
    <div class="meta">Posted on 2008-04-28 06:46:02 by halsten</div>
   </div>
   <div class="post" id="post-205207">
    <div class="subject"><a href="#post-205207">Re: Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">I played around with it and got it almost working... there are many mistakes all over but here&#039;s what I got so far (I really need to do some work now so good luck with it)<br /><br /><pre><code><br />.486<br />.model flat, stdcall<br />option casemap :none<br /><br />include		windows.inc<br /><br />include	kernel32.inc<br />include	user32.inc<br />include	masm32.inc<br />include	comctl32.inc<br />include	advapi32.inc<br />include	comdlg32.inc<br />include	gdi32.inc<br /><br />includelib kernel32.lib<br />includelib user32.lib<br />includelib masm32.lib<br />includelib comctl32.lib<br />includelib advapi32.lib<br />includelib comdlg32.lib<br />includelib gdi32.lib<br /><br />WinMain						proto	<br />DlgMain						proto	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />DlgLog 						proto	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />DlgInformation				proto	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />DlgProtection				proto	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br /><br />.const<br />	IDD_MAINDLG equ 1001<br />	IDD_LOGDLG equ 1002<br />	IDC_EDIT_LOG equ 1004<br />	IDD_INFORMATIONDLG equ 1005<br />	IDD_PROTECTIONDLG equ 1006<br />	<br />	DLG_LOG						equ	4000<br />	DLG_INFORMATION				equ	4001<br />	DLG_PROTECTION				equ	4002<br />	DLG_ADVANCEDPROTECTION		equ	4003<br />	<br />	IDC_TAB						equ	100<br />	<br />.data<br />	szApplicationTitle			db &quot;mQUBE&quot;, 0h<br />	szApplicationVersion		db &quot;v1.0&quot;, 0h<br />	<br />	szTabLog					db &quot;Log&quot;, 0h<br />	szTabInformation			db &quot;Information&quot;, 0h<br />	szTabProtection				db &quot;Protection&quot;, 0h<br />	szTabAdvancedProtection		db &quot;Advanced Protection&quot;, 0h<br />	<br /><br />.data?<br />	hInstance					HINSTANCE 	?<br />	<br />	ItemStruct					TC_ITEM		&lt;?&gt;<br />	<br />	hTab						HWND		?<br />	<br />	hDlgLog						HWND 		?<br />	hDlgInformation				HWND		?<br />	hDlgProtection				HWND		?<br />	hDlgAdvancedProtection		HWND		?<br />	<br />	PrevSelTab					HWND		?<br />	<br />.code<br /><br />WinMain	proc<br />	invoke 	InitCommonControls<br />	invoke	GetModuleHandle, NULL<br />	mov		hInstance, eax<br />	invoke 	DialogBoxParam, hInstance, IDD_MAINDLG, NULL, offset DlgMain, NULL<br />	invoke 	ExitProcess, NULL<br />	ret<br />WinMain endp<br /><br /><br />DlgMain	proc hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />	LOCAL rect:RECT<br />	<br />	.if	uMsg == WM_INITDIALOG<br />		invoke	GetDlgItem, hWin, IDC_TAB<br />		mov 	hTab, eax<br />		<br />		mov 	ItemStruct.imask, TCIF_TEXT<br />		<br />		mov 	ItemStruct.pszText, offset szTabLog<br />		invoke 	SendMessage, hTab, TCM_INSERTITEM, 0, offset ItemStruct<br />		<br />		mov 	ItemStruct.pszText, offset szTabInformation<br />		invoke 	SendMessage, hTab, TCM_INSERTITEM, 1, offset ItemStruct<br />		<br />		mov 	ItemStruct.pszText, offset szTabProtection<br />		invoke 	SendMessage, hTab, TCM_INSERTITEM, 2,offset ItemStruct<br />		<br />		mov 	ItemStruct.pszText, offset szTabAdvancedProtection<br />		invoke 	SendMessage, hTab, TCM_INSERTITEM, 3,offset ItemStruct<br />		<br />		invoke	CreateDialogParam, hInstance, IDD_LOGDLG, hTab, Offset DlgLog, 0	<br />		mov		hDlgLog, eax<br />		invoke	ShowWindow, eax, SW_HIDE<br /><br />		invoke	CreateDialogParam, hInstance, IDD_INFORMATIONDLG, hTab, Offset DlgInformation, 0	<br />		mov		hDlgInformation, eax	<br />		invoke	ShowWindow, eax, SW_HIDE	<br />		<br />		invoke	CreateDialogParam, hInstance, IDD_PROTECTIONDLG, hTab, Offset DlgProtection, 0	<br />		mov		hDlgProtection, eax		<br />		invoke	ShowWindow, eax, SW_HIDE<br />		<br />		push 	hDlgLog		<br />		pop		PrevSelTab<br />		<br />	.elseif uMsg==WM_SIZE<br />		invoke 	GetClientRect, hWin,addr rect<br />		invoke 	MoveWindow, hTab, 0, 0, rect.right, rect.bottom, TRUE<br />		<br />	.elseif	uMsg == WM_COMMAND<br />		;.if wParam == IDM_EXIT	; -&gt; Exit<br />		;	invoke EndDialog,hWin,NULL<br />		;.elseif wParam == IDM_ABOUT	; -&gt; About<br />		;	invoke MessageBox,hWin,addr lpAbout,addr App,MB_OK<br />		;.endif<br />	.elseif	uMsg == WM_NOTIFY<br />		mov eax, lParam<br />		.if	.NMHDR.code == TCN_SELCHANGE<br />			Invoke SendDlgItemMessage, hWin,IDC_TAB, TCM_GETCURSEL, 0, 0<br />			.if	eax == 0<br />				mov edi, hDlgLog<br />			.elseif eax == 1<br />				mov edi, hDlgInformation<br />			.elseif eax == 2<br />				mov edi, hDlgProtection<br />			.elseif eax == 3<br />				mov edi, hDlgAdvancedProtection<br />			.endif<br />			Invoke ShowWindow, PrevSelTab, SW_HIDE<br />			Invoke ShowWindow, edi, SW_SHOW<br />			mov PrevSelTab, edi<br />			invoke 	GetClientRect, hWin,addr rect<br />			invoke 	MoveWindow, hTab, 0, 0, rect.right, rect.bottom, TRUE<br />			invoke 	MoveWindow, PrevSelTab, 0, 25, rect.right, rect.bottom, TRUE	<br />		.endif<br />	.elseif	uMsg == WM_CLOSE<br />		invoke EndDialog, hWin, NULL<br />	.endif<br />	xor eax,eax<br />	ret<br />DlgMain endp<br /><br />DlgLog proc	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />	mov eax, uMsg<br />	.if eax == WM_INITDIALOG<br />	.elseif eax == WM_CLOSE<br />		invoke EndDialog, hWin, NULL<br />	.else<br />		mov	eax, FALSE<br />		ret<br />	.endif<br />	mov	eax, TRUE<br />	ret<br />DlgLog endp<br /><br />DlgInformation proc	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />	mov eax, uMsg<br />	.if eax == WM_INITDIALOG<br />	.elseif eax == WM_CLOSE<br />		invoke EndDialog, hWin, NULL<br />	.else<br />		mov	eax, FALSE<br />		ret<br />	.endif<br />	mov	eax, TRUE<br />	ret<br />DlgInformation endp<br /><br />DlgProtection proc	hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />	mov eax, uMsg<br />	.if eax == WM_INITDIALOG<br /><br />	.elseif eax == WM_CLOSE<br />		invoke EndDialog, hWin, NULL<br />	.else<br />		mov	eax, FALSE<br />		ret<br />	.endif<br />	mov	eax, TRUE<br />	ret<br />DlgProtection endp<br /><br />end WinMain<br /></code></pre><br /><br />You were overwriting hTab in the Child Dialogs, you were pushing and popping an empty PrevSelTab in WM_INITDIALOG, your TCN_SELCHANGE handler had the options, 1,2,3,4 but you are creating the tabs 0,1,2,3, and many more... <br /><br />Sometimes it&#039;s worth it to start all over after one has figured out how to do it. </div>
    <div class="meta">Posted on 2008-04-28 07:48:46 by JimmyClif</div>
   </div>
   <div class="post" id="post-205208">
    <div class="subject"><a href="#post-205208">Re: Tab Control Freeze + Weird Behaviour</a></div>
    <div class="body">Many thanks for all the effort and the help! :)</div>
    <div class="meta">Posted on 2008-04-28 08:33:54 by halsten</div>
   </div>
  </div>
 </body>
</html>