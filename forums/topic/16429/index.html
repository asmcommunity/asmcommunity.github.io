<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>OwnerDraw, Drawing, and Coloring... HELP! - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=16429" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=16429">OwnerDraw, Drawing, and Coloring... HELP!</a></p>
   <div class="post" id="post-127727">
    <div class="subject"><a href="#post-127727">OwnerDraw, Drawing, and Coloring... HELP!</a></div>
    <div class="body">Hello Everyone,<br /><br />I've been around here for a while now and I would just like to thank the lot of you for such a valuable resource, you guys solved much of my troubles.<br /><br />Well I've been getting interested in drawing my own controls something to make my app look different from the now tired looks of standard windows. Knowing this I've hit up the forums and searched for posts that hit a common interest. We I came up with several hits but one particularly sparked some interest: <a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?threadid=6573&amp;highlight=set+dialog+colors">http://www.asmcommunity.net/board/showthread.php?threadid=6573&amp;highlight=set+dialog+colors</a> . LuHa gave an example of an ownerdraw control in C. I was somewhat disappointed that it was in C but I took a look at it and it didn't seem all that complex. Thinking this would be a decent way to start I attempted to port over the example to ASM. Well needless to say I've ran into a few problems.<br /><br />WM_CTLCOLORSTATIC,<br />For some reason when the message get processed nothing happens to my static control. It still retains the default look. I'm guessing the device context is no go. Perhaps something to do with the way I set up the window.<br /><br />WM_DRAWITEM,<br />This is the one that has been driving me crazy. I've gotten it to draw all right but the message doesn't process correctly. From what I experienced my button never sends a ODS_SELECTED message. When I checked the value in ItemState it up in the hundreds while all the ODS constants appear to be 1 or 2 digit numbers.<br /><br />I've attached my source. Hopefully one of you guys can see what I did wrong.<br /><br /><br />I also have a few other questions:<br /><br />1) Is there any way to set the BS_OWNERDRAW flag in RADASM dialog editor? I took a look at visual C++ 6 resource editor and its able to set the flag.<br /><br />2) Will windows delete the brushes, pens I created on its own or do I have to manually delete each one?<br /><br />3) I wanted to learn more about the gdi api's. Anyone know of a good tut on the subject or good reference point?</div>
    <div class="meta">Posted on 2003-12-14 03:11:48 by Lith</div>
   </div>
   <div class="post" id="post-127740">
    <div class="subject"><a href="#post-127740">Re: OwnerDraw, Drawing, and Coloring... HELP!</a></div>
    <div class="body">hi , this is my ASM example:<br /><br />	.ELSEIF uMsg == WM_ERASEBKGND<br />		mov LogBrush.lbStyle, BS_SOLID<br />		RGB 0, 0, 0<br />		mov LogBrush.lbColor, eax<br />		invoke CreateBrushIndirect, addr LogBrush<br />		mov hBrush,eax<br />		invoke GetClientRect, hWnd, addr rect<br />		invoke FillRect, wParam, addr rect, hBrush	<br />		mov eax, TRUE<br />		ret<br />	.ELSEIF uMsg == WM_CTLCOLORSTATIC<br />		invoke	GetDlgCtrlID, lParam<br />		.if eax == IDC_REGCODE<br />			RGB 255, 255, 255<br />			invoke	SetTextColor,wParam, eax<br />			RGB 0, 0, 0<br />			INVOKE	SetBkColor, wParam, eax<br />			invoke	GetStockObject, BLACK_BRUSH	<br />		.else<br />			MOV eax,FALSE<br />			ret<br />		.endif<br />		ret<br />	.ELSEIF uMsg == WM_CTLCOLOREDIT<br />		invoke GetDlgCtrlID,lParam<br />		.if eax == IDC_REGNAME<br />			RGB 255, 255, 255<br />			invoke	SetTextColor,wParam, eax<br />			RGB 0, 0, 0<br />			INVOKE	SetBkColor, wParam, eax<br />			invoke	GetStockObject, BLACK_BRUSH<br />		.else<br />			MOV eax,FALSE<br />			ret<br />		.endif	<br />		ret</div>
    <div class="meta">Posted on 2003-12-14 08:09:22 by benny</div>
   </div>
   <div class="post" id="post-127742">
    <div class="subject"><a href="#post-127742">Re: OwnerDraw, Drawing, and Coloring... HELP!</a></div>
    <div class="body">BTW, if you want to change the button color, you can use WM_CTLCOLORBTN  message.<br /><br />WM_CTLCOLORBTN  <br />hdcButton = (HDC) wParam;   // handle of button display context <br />hwndButton = (HWND) lParam; // handle of button</div>
    <div class="meta">Posted on 2003-12-14 08:16:48 by benny</div>
   </div>
   <div class="post" id="post-127789">
    <div class="subject"><a href="#post-127789">OwnerDraw, Drawing, and Coloring... HELP!</a></div>
    <div class="body">Thanks benny for you example. I'll probably recode a whole new window and just see if that one works. I really wanted to start drawing some of my own controls but I guess I should first work on changing colors then go from there.<br /><br /><br />Ahh.. finally got it to post. For some reason save cookies saved with the wrong password and I couldn't post.</div>
    <div class="meta">Posted on 2003-12-15 01:12:42 by Lith</div>
   </div>
   <div class="post" id="post-127796">
    <div class="subject"><a href="#post-127796">OwnerDraw, Drawing, and Coloring... HELP!</a></div>
    <div class="body">Can someone tell me why the code in WM_CTLCOLORBTN doesn't change the button's color?<br /><br /><pre><code><br />.386<br />.model flat, stdcall<br />option casemap&#58; none<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\gdi32.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\gdi32.lib<br /><br />include ChangingColors.inc<br /><br />WinMain   PROTO	&#58;HINSTANCE,&#58;HINSTANCE,&#58;LPSTR,&#58;DWORD<br />WndProc	PROTO	&#58;HWND,&#58;UINT,&#58;WPARAM,&#58;LPARAM<br /><br />.code<br />start&#58;<br />	invoke GetModuleHandle, NULL<br />	mov hInstance, eax<br />	invoke GetCommandLine<br />	mov CommandLine, eax<br />	invoke WinMain, hInstance, NULL, CommandLine, SW_SHOWDEFAULT<br />	invoke ExitProcess, eax<br />	<br />WinMain proc hInst&#58;HINSTANCE, hPrevInst&#58;HINSTANCE, CmdLine&#58;LPSTR, CmdShow&#58;DWORD<br />	LOCAL wc&#58;WNDCLASSEX<br />	LOCAL msg&#58;MSG<br />	LOCAL hDlg&#58;HWND<br />	<br />	invoke CreateSolidBrush, 00000000h<br />	mov hBkBrush, eax<br />	<br />	mov wc.cbSize, sizeof WNDCLASSEX<br />	mov wc.style, CS_HREDRAW or CS_VREDRAW<br />	mov wc.lpfnWndProc, offset WndProc<br />	mov wc.cbClsExtra, NULL<br />	mov wc.cbWndExtra, DLGWINDOWEXTRA<br />	push hInst<br />	pop wc.hInstance<br />	push hBkBrush<br />	pop wc.hbrBackground<br />	mov wc.lpszMenuName, NULL<br />	mov wc.lpszClassName, offset ClassName<br />	invoke LoadIcon, NULL, IDI_APPLICATION<br />	mov wc.hIcon, eax<br />	mov wc.hIconSm, eax<br />	invoke LoadCursor, NULL, IDC_ARROW<br />	mov wc.hCursor, eax<br />	<br />	invoke RegisterClassEx, addr wc<br />	xor eax, eax<br />	mov ax, IDD_MAIN<br />	invoke CreateDialogParam, hInstance, eax, NULL, offset WndProc, NULL<br />	mov hDlg, eax<br />	invoke ShowWindow, hDlg, SW_SHOWNORMAL<br />	invoke UpdateWindow, hDlg<br />	<br />	.while TRUE<br />		invoke GetMessage, addr msg, NULL, 0, 0<br />		.break .if &#40;!eax&#41;<br />		invoke IsDialogMessage, hDlg, addr msg<br />		.if eax == FALSE<br />			invoke TranslateMessage, addr msg<br />			invoke DispatchMessage, addr msg<br />		.endif<br />	.endw<br />	mov eax, msg.wParam<br />	ret<br /><br />WinMain endp<br /><br />WndProc proc hwnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br />	<br />	.if uMsg == WM_INITDIALOG<br />	<br /><br />	.elseif uMsg == WM_DESTROY<br />		invoke DeleteObject, hBkBrush <br />		invoke PostQuitMessage, NULL<br />		<br />	<br />	&#91;b&#93;&#91;color=red&#93;.elseif uMsg == WM_CTLCOLORBTN<br />		invoke SetBkMode, wParam, TRANSPARENT<br />		invoke SetBkColor, wParam, 00FF0000h<br />		invoke SetTextColor, wParam, 00FFFFFFh<br />	&#91;/color&#93;&#91;/b&#93;<br />	<br />	.elseif uMsg == WM_COMMAND<br />		mov eax, wParam<br />		shl eax, 16<br />		shr eax, 16<br />		.if eax == IDC_BTN_EXIT<br />			invoke SendMessage, hwnd, WM_DESTROY, NULL, NULL<br />		.endif<br />		<br />		<br />	.else<br />		invoke DefWindowProc, hwnd, uMsg, wParam, lParam<br />		ret<br />		<br />		<br />	.endif<br />	xor eax, eax<br />	ret<br /><br />WndProc endp<br /><br />end start<br /></code></pre></div>
    <div class="meta">Posted on 2003-12-15 03:45:45 by Lith</div>
   </div>
   <div class="post" id="post-127802">
    <div class="subject"><a href="#post-127802">OwnerDraw, Drawing, and Coloring... HELP!</a></div>
    <div class="body">set your button's style as  BS_OWNERDRAW</div>
    <div class="meta">Posted on 2003-12-15 04:28:10 by benny</div>
   </div>
   <div class="post" id="post-127808">
    <div class="subject"><a href="#post-127808">OwnerDraw, Drawing, and Coloring... HELP!</a></div>
    <div class="body">Ok. Set the button to OwnerDraw. This is what I get:<br /><br /><img src="http://home.comcast.net/~crypper/ODButtonError.JPG" /><br /><br />Here is the code:<br /><br /><pre><code><br />WndProc proc hwnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br />	<br />	.if uMsg == WM_INITDIALOG<br />		;Set Exit button to OwnerDraw.<br />		invoke GetDlgItem, hwnd, IDC_BTN_EXIT<br />		mov hExit, eax<br />		invoke GetWindowLong, hExit, GWL_STYLE<br />		or eax, BS_OWNERDRAW<br />		invoke SetWindowLong, hExit, GWL_STYLE, eax<br /><br />	.elseif uMsg == WM_DESTROY<br />		invoke DeleteObject, hBkBrush <br />		invoke PostQuitMessage, NULL<br />		<br />	<br />	.elseif uMsg == WM_CTLCOLORBTN<br />		invoke SetBkMode, wParam, TRANSPARENT<br />		invoke SetBkColor, wParam, 00FF0000h<br />		invoke SetTextColor, wParam, 00FFFFFFh<br />	<br />	<br />	.elseif uMsg == WM_COMMAND<br />		mov eax, wParam<br />		shl eax, 16<br />		shr eax, 16<br />		.if eax == IDC_BTN_EXIT<br />			invoke SendMessage, hwnd, WM_DESTROY, NULL, NULL<br />		.endif<br />		<br />		<br />	.else<br />		invoke DefWindowProc, hwnd, uMsg, wParam, lParam<br />		ret<br />		<br />		<br />	.endif<br />	xor eax, eax<br />	ret<br /><br />WndProc endp<br /></code></pre></div>
    <div class="meta">Posted on 2003-12-15 04:46:37 by Lith</div>
   </div>
   <div class="post" id="post-127865">
    <div class="subject"><a href="#post-127865">OwnerDraw, Drawing, and Coloring... HELP!</a></div>
    <div class="body">Ok. I found out that I had to return a brush to windows so it can fill in the background. I decided to make a static control and test my ideas on that. I've gotten somewhere although the solution is a but confusing. Here is what I did:<br /><br /><pre><code><br />WndProc proc hwnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br />	LOCAL temp&#58;DWORD<br />	<br /><br />	.if uMsg == WM_INITDIALOG<br />		;Set Button&#58; Exit to OwnerDraw.<br />		invoke GetDlgItem, hwnd, IDC_BTN_EXIT<br />		mov temp, eax<br />		invoke GetWindowLong, temp, GWL_STYLE<br />		or eax, BS_OWNERDRAW<br />		invoke SetWindowLong, temp, GWL_STYLE, eax<br />		<br />		;Set Static&#58; Title to OwnerDraw.<br />		invoke GetDlgItem, hwnd, IDC_STC_TITLE<br />		mov temp, eax<br />		invoke GetWindowLong, temp, GWL_STYLE<br />		or eax, BS_OWNERDRAW<br />		invoke SetWindowLong, temp, GWL_STYLE, eax<br />		<br /><br />	.elseif uMsg == WM_DESTROY<br />		invoke PostQuitMessage, NULL<br />		<br />	<br />	.elseif uMsg == WM_CTLCOLORBTN<br />		invoke SetBkMode, wParam, TRANSPARENT<br />		invoke SetTextColor, wParam, 00FF0000h<br />		<br />		;Return brush handle for background drawing.<br />		invoke GetStockObject, DKGRAY_BRUSH<br />		mov hBrush, eax<br />		ret<br />		<br />	&#91;b&#93;&#91;color=red&#93;	<br />	.elseif uMsg == WM_CTLCOLORSTATIC<br />		invoke SetTextColor, wParam, 00CC9900h<br />		invoke SetBkMode, wParam, TRANSPARENT<br />		<br />		;Return brush handle for background drawing.<br />		invoke GetStockObject, BLACK_BRUSH<br />		mov hBrush, eax		;&lt;--Doesn't do anything to the background???<br />		ret<br />	&#91;/color&#93;&#91;/b&#93;<br />	<br />	.elseif uMsg == WM_COMMAND<br />		mov eax, wParam<br />		shl eax, 16<br />		shr eax, 16<br />		.if eax == IDC_BTN_EXIT<br />			invoke SendMessage, hwnd, WM_DESTROY, NULL, NULL<br />		.endif<br />		<br />		<br />	.else<br />		invoke DefWindowProc, hwnd, uMsg, wParam, lParam<br />		ret<br />		<br />		<br />	.endif<br />	xor eax, eax<br />	ret<br /><br />WndProc endp<br /></code></pre><br /><br />For some reason returning a predefinded stock object gives the effect I was looking for however if I were to take out the invoke SetBkMode the background wouldn't be the color of the brush I returned to windows. Just white, always white.<br /><br />The button coloring doesn't work. I'm starting to think SetBkMode, SetBkColor, SetTextColor has no effect on the button. Probably because coloring the background and setting the text isn't setting the colors of the button because the button is some kind of object itself outside the background colors and text colors?</div>
    <div class="meta">Posted on 2003-12-15 08:57:01 by Lith</div>
   </div>
   <div class="post" id="post-127903">
    <div class="subject"><a href="#post-127903">OwnerDraw, Drawing, and Coloring... HELP!</a></div>
    <div class="body">Nevermind. I've solved my problem. Here is the source. Its pretty much LuHa's C example in ASM.<br /><br />I had to shift bits around on DRAWITEMSTRUCT.itemState to get it to work properly. I'm not sure if this is the correct way in doing so but it works on my XP machine. Anyone using 9x around here? I would like to know if it worked for you guys.</div>
    <div class="meta">Posted on 2003-12-15 12:13:09 by Lith</div>
   </div>
  </div>
 </body>
</html>