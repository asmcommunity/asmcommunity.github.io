<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>PE file format - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=8185" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=8185">PE file format</a></p>
   <div class="post" id="post-59898">
    <div class="subject"><a href="#post-59898">PE file format</a></div>
    <div class="body">What happens if the loader can't load executable at the preffered address? Does it have to recalculate all addresses while loading and change the code section to fit new address for calls and jumps and new references to data? How can a dll have one code segment for different processes that had loaded it?</div>
    <div class="meta">Posted on 2002-09-28 12:18:17 by Vaxon</div>
   </div>
   <div class="post" id="post-59899">
    <div class="subject"><a href="#post-59899">Re: PE file format</a></div>
    <div class="body"><div class="quote"><br />What happens if the loader can't load executable at the preffered address? Does it have to recalculate all addresses while loading and change the code section to fit new address for calls and jumps and new references to data?</div>If there is relocation info in the PE file then, yes.  Jumps can be relitive and usually are.<div class="quote"><strong>How can a dll have one code segment for different processes that had loaded it?</div>Relocation information would have to be present.</div>
    <div class="meta">Posted on 2002-09-28 12:41:54 by bitRAKE</div>
   </div>
   <div class="post" id="post-60000">
    <div class="subject"><a href="#post-60000">PE file format</a></div>
    <div class="body">Thanks, BitRake.<br />So, 2 programs share the same dll code only if that code has been loaded at the same address by both of them.</div>
    <div class="meta">Posted on 2002-09-29 13:22:09 by Vaxon</div>
   </div>
   <div class="post" id="post-60137">
    <div class="subject"><a href="#post-60137">PE file format</a></div>
    <div class="body"><div class="quote">So, 2 programs share the same dll code only if that code has been loaded at the same address by both of them.</div><br /><br />2 programs share the same dll code even if it being loaded at different addresses.<br />The physical memory is the same but system maps this physical memory at different addresses in differrent processe</div>
    <div class="meta">Posted on 2002-09-30 08:20:11 by Four-F</div>
   </div>
   <div class="post" id="post-60142">
    <div class="subject"><a href="#post-60142">PE file format</a></div>
    <div class="body">How is this possible, Four-F? The code section has to be modified to correct all the CALL's, so they have different code sections. Then how can this section be shared?</div>
    <div class="meta">Posted on 2002-09-30 08:30:06 by Qweerdy</div>
   </div>
   <div class="post" id="post-60144">
    <div class="subject"><a href="#post-60144">PE file format</a></div>
    <div class="body">To Four-F. You are wrong That cannot be possible<br />My win32 api says<br /><div class="quote">Processes that load a DLL  <strong>AT THE SAME BASE ADDRESS</strong> can use a single DLL simultaneously, sharing a single copy of the DLL code in physical memory. Doing this saves memory and reduces swapping. </div> <br />See <em>Advantages of Dynamic Linking</em>  in win32 api reference.</div>
    <div class="meta">Posted on 2002-09-30 08:34:49 by Vaxon</div>
   </div>
   <div class="post" id="post-60160">
    <div class="subject"><a href="#post-60160">PE file format</a></div>
    <div class="body">With PE format files, EXE files mainly load at 400000h no matter what, DLLs are a problem in that if an EXE file loads 2 or more DLLs that have the same preferred base address, only one can be loaded at the base address and the others must be relocated.<br /><br />Address clashes across different running processes can and do cause multiple loading of DLLs. One of the memory usage optimisations is to change the preferred load address for DLLs used by a single process so there is no need to relocate the DLL.<br /><br />The EDITBIN utility can do that from memory.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-09-30 10:45:49 by hutch--</div>
   </div>
   <div class="post" id="post-60224">
    <div class="subject"><a href="#post-60224">PE file format</a></div>
    <div class="body"><strong>Qweerdy</strong> &amp; <strong>Vaxon</strong>, of course you are right. My mistake.</div>
    <div class="meta">Posted on 2002-10-01 00:20:04 by Four-F</div>
   </div>
  </div>
 </body>
</html>