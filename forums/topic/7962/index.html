<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Changing Classname of a running Application ? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=7962" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=7962">Changing Classname of a running Application ?</a></p>
   <div class="post" id="post-58130">
    <div class="subject"><a href="#post-58130">Changing Classname of a running Application ?</a></div>
    <div class="body">Hi!<br /><br />We use a programm called X-Win32 ( <a target="_blank" href="www.starnet.com">www.starnet.com</a> ) for visualization of Unix programms. <br />My problem is, that all created Windows have different captions and the same Classname (&quot;XWinClass&quot;). And they are created at the same time (almost ;) ). I need to get the handle of each Window to remove the WS_CAPTION style (&quot;and eax, not WS_CAPTION&quot; :) ), move the window and resize it.<br />My idea was just to run FindWindow with &quot;XWinClass&quot; as Classname, save the handle in an array, change the class to something else (like &quot;XWinClassDone&quot;) and start over with FindWindow again. <br /><br />If anyone has another suggestion how to save the handles, please reply. GetTopWindow / GetNextWindow is no option, because there are some other apps running which get the focus with each refresh and might intercept a GetTopWindow call :/<br /><br />Thanks,<br />bazik</div>
    <div class="meta">Posted on 2002-09-16 08:05:53 by bazik</div>
   </div>
   <div class="post" id="post-58133">
    <div class="subject"><a href="#post-58133">Changing Classname of a running Application ?</a></div>
    <div class="body">my guess would be: SetClassLong,hWnd,36,ptr_classname according to the api <br />ref it should work... but if this is not the case then try to set the windows pos to<br />HWND_BOTTOM...<br /><br />...<br /><pre><code><br />WNDCLASSEX STRUCT<br />  cbSize            DWORD      ?      0<br />  style             DWORD      ?      4<br />  lpfnWndProc       DWORD      ?      8<br />  cbClsExtra        DWORD      ?      12<br />  cbWndExtra        DWORD      ?      16<br />  hInstance         DWORD      ?      20<br />  hIcon             DWORD      ?      24<br />  hCursor           DWORD      ?      28<br />  hbrBackground     DWORD      ?      32<br />  lpszMenuName      DWORD      ?      34<br />  lpszClassName     DWORD      ?      36<br />  hIconSm           DWORD      ?      40<br />WNDCLASSEX ENDS<br /></code></pre><br />...<br />but i doubt that you can simply pass a pointer to a string that is stored in YOUR<br />process, so just grab a debugger and search for some decent string values in that<br />program you are talking about. or just use hInstance :D</div>
    <div class="meta">Posted on 2002-09-16 08:15:54 by mob</div>
   </div>
   <div class="post" id="post-58136">
    <div class="subject"><a href="#post-58136">Changing Classname of a running Application ?</a></div>
    <div class="body">Hi mob,<br />thanks for your reply but unfortunately it doesn't work and <a target="_blank" href="http://groups.google.com/groups?q=setclasslong+classname&amp;hl=en&amp;lr=&amp;ie=UTF-8&amp;selm=%230p2A4Il%24GA.251%40cppssbbsa03&amp;rnum=3">this</a> newsgroup post verifies it :/ <br /><span style="font-size:9px>If there would be a way to find out the memory position of the classname, I could use WriteProcessMemory (yay, hack it! :grin: ). </span></div>
    <div class="meta">Posted on 2002-09-16 08:27:01 by bazik</div>
   </div>
   <div class="post" id="post-58138">
    <div class="subject"><a href="#post-58138">Changing Classname of a running Application ?</a></div>
    <div class="body"><div class="quote"><br />but SetClassLong doesn't allow me to change the name<br /></div><br /><br /><div class="quote"><br />but i doubt that you can simply pass a pointer to a string that is stored in YOUR<br />process, so just grab a debugger and search for some decent string values in that<br />program you are talking about. or just use hInstance :D<br /></div><br /><br />it's clear as daylight that SetClassLong doesn't work when you provide pointers<br />that are only valid for YOUR process... but when you give it a valid value... it could<br />be worth a try i think... <br /><br />other possibility would be to enumerate processes, you know the exe-filename, thats<br />all you need...</div>
    <div class="meta">Posted on 2002-09-16 08:32:46 by mob</div>
   </div>
   <div class="post" id="post-58139">
    <div class="subject"><a href="#post-58139">Changing Classname of a running Application ?</a></div>
    <div class="body">Cheater!! You edited your post while I was writing my reply! :grin: <br /><br /><br />And for enumerating... I have <strong>one</strong> process for ~20 Windows. How should this work? :rolleyes:</div>
    <div class="meta">Posted on 2002-09-16 08:37:52 by bazik</div>
   </div>
   <div class="post" id="post-58635">
    <div class="subject"><a href="#post-58635">Changing Classname of a running Application ?</a></div>
    <div class="body">just in case you didn't solved your problem... it's strange but i had to do<br />exactly the same yesterday... and... i solved it with the EnumWindows API<br />which i never used before... here's vb code for ya :grin:<br /><pre><code><br />Private Declare Function EnumWindows Lib &quot;user32&quot; &#40;ByVal lpEnumFunc As Long, ByVal lParam As Long&#41; As Long<br />Private Declare Function GetClassName Lib &quot;user32&quot; Alias &quot;GetClassNameA&quot; &#40;ByVal hWnd As Long, ByVal lpClassName As String, ByVal nMaxCount As Long&#41; As Long<br />Private Declare Function GetWindowText Lib &quot;user32&quot; Alias &quot;GetWindowTextA&quot; &#40;ByVal hWnd As Long, ByVal lpString As String, ByVal cch As Long&#41; As Long<br /><br />Public Function fEnumWindowsCallBack&#40;ByVal hWnd As Long, ByVal lpData As Long&#41; As Long<br />On Error Resume Next<br /><br />Dim lResult    As Long<br />Dim lThreadId  As Long<br />Dim lProcessId As Long<br />Dim sWndName   As String<br />Dim sClassName As String<br /><br />Dim menu_handle As Long<br />Dim submenu_handle As Long<br />Dim item_index As Long<br />Dim result As String<br />Dim found As String<br /><br />    fEnumWindowsCallBack = 1<br />    sClassName = Space&#40;260&#41;<br />    sWndName = Space&#40;260&#41;<br />    result = Space&#40;260&#41;<br /><br />    lResult = GetClassName&#40;hWnd, sClassName, 260&#41;<br />    sClassName = Left&#40;sClassName, lResult&#41;<br />    lResult = GetWindowText&#40;hWnd, sWndName, 260&#41;<br />    sWndName = Left&#40;sWndName, lResult&#41;<br /><br />	IF sClassName = &quot;XWinClass&quot; THEN<br /><br />	'hWnd -&gt; handle<br />	'sClassName -&gt; ...<br />	'sWndName -&gt; window title<br /><br />	END IF<br />    <br />End Function<br /><br />Public Function fEnumWindows&#40;&#41; As Boolean<br />Dim hWnd As Long<br />    Call EnumWindows&#40;AddressOf fEnumWindowsCallBack, hWnd&#41;<br />End Function<br /></code></pre><br />oh, in vb this must be thrown in an extra module... then you just have to<br />call fEnumWindows... in asm this would be more than easy...</div>
    <div class="meta">Posted on 2002-09-19 05:58:43 by mob</div>
   </div>
   <div class="post" id="post-58642">
    <div class="subject"><a href="#post-58642">Changing Classname of a running Application ?</a></div>
    <div class="body">Yep, I solved it right after your last reply. Here is my PowerBASIC source :) <br /><br /><pre><code><br />#COMPILE DLL 'EXE<br />#INCLUDE &quot;win32api.inc&quot;<br /><br />GLOBAL g_nHwnd     AS LONG<br />GLOBAL g_nProcessID AS LONG<br /><br />FUNCTION EnumWindowsProc&#40;BYVAL nHwnd AS LONG, BYVAL nParam AS LONG&#41; AS LONG<br /><br />    DIM nProcessID AS LONG<br />    'DIM nThreadID  AS LONG<br />    'DIM szBuffer   AS ASCIIZ * 512<br /><br />    CALL GetWindowThreadProcessId&#40;nHwnd, nProcessID&#41;<br /><br />    'CALL GetWindowText&#40;nHwnd, szBuffer, 512&#41;<br />    'MSGBOX &quot;szBuffer&#58; &quot; + szBuffer + $CRLF _<br />    '     + &quot;nThreadID&#58; &quot; + STR$&#40;nThreadID&#41; + $CRLF _<br />    '     + &quot;nProcessID&#58; &quot; + STR$&#40;nProcessID&#41; + $CRLF _<br />    '     + &quot;nParam&#58; &quot; + STR$&#40;g_nProcessID&#41;<br /><br />    IF nProcessID = g_nProcessID THEN<br /><br />    '    MSGBOX &quot;nProcessID&#58; &quot; + STR$&#40;nProcessID&#41; + CHR$&#40;13,10&#41; + &quot;nParam&#58; &quot; + STR$&#40;g_nProcessID&#41;<br /><br />        'OPEN &quot;test.txt&quot; FOR APPEND AS #1<br />        '    PRINT #1, STR$&#40;nProcessID&#41; + &quot;, &quot; + szBuffer<br />        'CLOSE #1<br />        g_nHwnd = nHwnd<br />        EnumWindowsProc = 0<br />    ELSE<br />        EnumWindowsProc = 1<br />    END IF<br /><br />END FUNCTION<br /><br />FUNCTION WindowHandleFromProcessId&#40;BYVAL nProcessID AS LONG&#41; EXPORT AS LONG<br />    'MSGBOX &quot;nProcessID &#40;VB&#41;&#58; &quot; + STR$&#40;nProcessID&#41;<br />    g_nProcessID = nProcessID<br />    CALL EnumWindows&#40;CODEPTR&#40;EnumWindowsProc&#41;, 0&#41;<br />    'MSGBOX &quot;g_nHwnd&#58; &quot; + STR$&#40;g_nHwnd&#41;<br />    FUNCTION = g_nHwnd<br />    'MSGBOX &quot;done&quot;<br /><br />END FUNCTION<br /></code></pre></div>
    <div class="meta">Posted on 2002-09-19 06:16:59 by bazik</div>
   </div>
   <div class="post" id="post-58643">
    <div class="subject"><a href="#post-58643">Changing Classname of a running Application ?</a></div>
    <div class="body">And because we are all 1337 VB coders, here is the sub which calls this PowerBASIC library... :grin: <br /><br /><pre><code><br />Private Sub cmdOpen_Click&#40;&#41;<br /><br />    Dim sLine As String<br />    Dim sBuffer As String * 512<br />    <br />    Dim vLine As Variant<br />    Dim vGroup As Variant<br />    <br />    Dim n As Long<br />    <br />    Dim nStyle As Long<br />    Dim nHandle As Long<br />    Dim nRet As Long<br />    Dim nProcess As Long<br />    <br />    Dim pi As PROCESS_INFORMATION<br />    Dim si As STARTUPINFO<br />    <br />    g_CurrentX = 0<br />    g_CurrentY = 0<br />    <br />    Open g_sScriptFile For Input As #1<br />    <br />    Do Until EOF&#40;1&#41;<br />        Line Input #1, sLine<br />        <br />        If Left$&#40;sLine, 1&#41; &lt;&gt; &quot;#&quot; And Len&#40;sLine&#41; &gt; 0 Then<br />        <br />            vLine = Split&#40;sLine, &quot;|&quot;&#41;<br />            ' MsgBox UBound&#40;vLine&#41;<br />            If UBound&#40;vLine&#41; = 4 Then<br />                ' 0 &#58;&#58; Befehl<br />                ' 1 &#58;&#58; Parameter<br />                ' 2 &#58;&#58; Arbeitsverzeichniss<br />                ' 3 &#58;&#58; Gruppe&#40;n&#41;<br />                ' 4 &#58;&#58; Kommando Datei<br />            <br />                vGroup = Split&#40;vLine&#40;3&#41;, &quot;,&quot;&#41;<br />                <br />                For n = 0 To UBound&#40;vGroup&#41;<br />                    If vGroup&#40;n&#41; = cmb1.ListIndex Then<br />                    <br />                        si.cb = Len&#40;si&#41;<br />                        ' MsgBox vLine&#40;0&#41; + vbCrLf + vLine&#40;1&#41;<br />                        nRet = CreateProcess&#40;0, vLine&#40;0&#41; + &quot; &quot; + vLine&#40;1&#41;, ByVal 0&amp;, ByVal 0&amp;, 1&amp;, _<br />                                             NORMAL_PRIORITY_CLASS, ByVal 0&amp;, vLine&#40;2&#41;, si, pi&#41;<br />                        If nRet = 0 Then<br />                            MsgBox &quot;Fehler bei Prozesserstellung&#58;&quot; + vbCrLf + vLine&#40;0&#41; + &quot; &quot; + vLine&#40;1&#41;, vbCritical, &quot;Fehler!&quot;<br />                            Exit Sub<br />                        End If<br />                                            <br />                        Call WaitForInputIdle&#40;pi.hProcess, INFINITE&#41;<br />                                            <br />                        <br />                        ' Call EnumWindows&#40;AddressOf EnumWindowsProc, sei.hProcess&#41;<br />                        ' MsgBox &quot;test2&quot;<br />                        ' MsgBox &quot;pi.dwProcessId&#58; &quot; + Str$&#40;pi.dwProcessId&#41;<br />                        <br />                        g_nProcessList&#40;g_nProcessCount&#41; = pi.hProcess<br />                        <br />                        If InStr&#40;vLine&#40;0&#41;, &quot;xwin32&quot;&#41; &lt;&gt; 0 Then<br />lblLoop&#58;<br />                            Do<br />                                nHandle = FindWindow&#40;&quot;XWinClass&quot;, 0&#41;<br />                                DoEvents<br />                                ' Debug.Print nHandle<br />                            Loop Until nHandle &lt;&gt; 0<br />                            <br />                            nRet = GetWindowText&#40;nHandle, sBuffer, 512&#41;<br />                            sBuffer = Left$&#40;sBuffer, nRet&#41;<br /><br />                            If Trim&#40;sBuffer&#41; = &quot;X-Root&quot; Then<br />                                GoTo lblLoop<br />                            End If<br />                                <br />                            Call SetWindowText&#40;nHandle, &quot;X-Root&quot;&#41;<br />                                <br />'                                Call GetWindowThreadProcessId&#40;nHandle, nProcess&#41;<br />'                                MsgBox nProcess<br />'                                g_nProcessList&#40;g_nProcessCount&#41; = nProcess<br />                                <br />                            g_nHandleList&#40;g_nProcessCount&#41; = nHandle<br />                                <br />                        ElseIf InStr&#40;vLine&#40;1&#41;, &quot;telnet&quot;&#41; &lt;&gt; 0 Then<br />lblLoop2&#58;<br />                            Do<br />                                nHandle = FindWindow&#40;&quot;ConsoleWindowClass&quot;, 0&#41;<br />                                DoEvents<br />                            Loop Until nHandle &lt;&gt; 0<br />                            <br />                            nRet = GetWindowText&#40;nHandle, sBuffer, 512&#41;<br />                            sBuffer = Left$&#40;sBuffer, nRet&#41;<br />                            <br />                            ' MsgBox Trim&#40;sBuffer&#41;<br /><br />                            If Trim&#40;sBuffer&#41; = &quot;Telnet-Session&quot; Then<br />                                GoTo lblLoop2<br />                            End If<br />                                <br />                            Call SetWindowText&#40;nHandle, &quot;Telnet-Session&quot;&#41;<br /><br />                            g_nHandleList&#40;g_nProcessCount&#41; = nHandle<br />                                                  <br />                        Else<br />                            &#91;b&#93;g_nHandleList&#40;g_nProcessCount&#41; = WindowHandleFromProcessId&#40;pi.dwProcessId&#41;&#91;/b&#93;<br />                        End If<br />                        ' MsgBox &quot;nHandleList&#58; &quot; + Str$&#40;nHandleList&#40;nProcessCount&#41;&#41;<br />                        ' MsgBox nHandleList&#40;nProcessCount&#41;<br />                                            <br />                        ' MsgBox g_nProcessCount<br />                        <br />                        'nStyle = GetWindowLong&#40;g_nHandleList&#40;g_nProcessCount&#41;, GWL_STYLE&#41;<br />                        <br />                        'nStyle = nStyle And Not WS_CAPTION<br />                        <br />                        'Call SetWindowLong&#40;g_nHandleList&#40;g_nProcessCount&#41;, GWL_STYLE, nStyle&#41;<br />                        <br />                        If vLine&#40;4&#41; &lt;&gt; &quot;0&quot; Then<br />                            Sleep 2000<br />                            SendKeys vLine&#40;4&#41;, True<br />                        End If<br />                        <br />                        'If &#40;g_CurrentX &lt;= g_ScreenWidth&#41; And _<br />                        '   &#40;&#40;g_CurrentX + Val&#40;vLine&#40;3&#41;&#41;&#41; &lt;= g_ScreenWidth&#41; Then<br />                        <br />                        '    Call MoveWindow&#40;g_nHandleList&#40;g_nProcessCount&#41;, g_CurrentX, _<br />                                            g_CurrentY, Val&#40;vLine&#40;3&#41;&#41;, Val&#40;vLine&#40;4&#41;&#41;, 1&#41;<br />                        '    g_CurrentX = g_CurrentX + Val&#40;vLine&#40;3&#41;&#41;<br />                            <br />                        'Else<br />                        '    g_CurrentX = 0<br />                            <br />                        '    g_CurrentY = Val&#40;vLine&#40;6&#41;&#41; ' g_CurrentY + 300<br />                            <br />                        '    Call MoveWindow&#40;g_nHandleList&#40;g_nProcessCount&#41;, g_CurrentX, _<br />                                            g_CurrentY, Val&#40;vLine&#40;3&#41;&#41;, Val&#40;vLine&#40;4&#41;&#41;, 1&#41;<br />                        '    g_CurrentX = g_CurrentX + Val&#40;vLine&#40;3&#41;&#41;<br />                            <br />                        'End If<br />                        g_nProcessCount = g_nProcessCount + 1<br />                        ' MsgBox sei.hProcess<br />                    <br />                        <br />                    End If<br />                Next n<br />                <br />            Else<br />            <br />                MsgBox &quot;Fehler in Datei &quot; + Chr&#40;34&#41; + _<br />                       g_sScriptFile + Chr&#40;34&#41; + vbCrLf + _<br />                       sLine + vbCrLf + &quot;Zu wenig Datenfelder!&quot;, _<br />                       vbCritical, &quot;Fehler!&quot;<br />                Exit Sub<br />            End If<br />            <br />        End If<br />    Loop<br />    <br />    Call TileWindows&#40;0, MDITILE_HORIZONTAL, ByVal 0&amp;, g_nProcessCount, g_nHandleList&#40;0&#41;&#41;<br />           <br />    Close #1<br />    <br />End Sub<br /></code></pre></div>
    <div class="meta">Posted on 2002-09-19 06:20:15 by bazik</div>
   </div>
   <div class="post" id="post-58648">
    <div class="subject"><a href="#post-58648">Changing Classname of a running Application ?</a></div>
    <div class="body">one last thing...<br /><br />what i think is very funny is that those stupid vb coders compare dull api's with the<br />holly grail or something like that haha even after years and years of experience...<br />companys only engage these dumb know-nothing vb students to save costs. that <br />is so terrible, no wonder that this industrial sector is dying in germany.</div>
    <div class="meta">Posted on 2002-09-19 06:38:45 by mob</div>
   </div>
   <div class="post" id="post-58699">
    <div class="subject"><a href="#post-58699">Changing Classname of a running Application ?</a></div>
    <div class="body">Everytime I tell a VB'er that BASIC is an acronym and that the B stands for &quot;Beginner&quot; they don't believe me.<br /><br />Then once I prove it to them they look so hurt.  As if the truth had just stabbed them through the heart.  Poor VBers.  /pat /pat</div>
    <div class="meta">Posted on 2002-09-19 13:05:53 by iblis</div>
   </div>
  </div>
 </body>
</html>