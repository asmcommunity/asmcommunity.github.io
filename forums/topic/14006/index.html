<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Strange behaving exception handlers - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14006" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=14006">Strange behaving exception handlers</a></p>
   <div class="post" id="post-108212">
    <div class="subject"><a href="#post-108212">Strange behaving exception handlers</a></div>
    <div class="body">I'm making a little program that reads certain addresses from memory. If it reads an illegal address I want the program thread to hang in an infinite loop.<br /><br />To do this, I have created code like this:<br /><br /><pre><code><br />start&#58;<br />   &lt;setting up SEH frame on the stack and fs&#58;&#91;0&#93;, handler is set to label exception_handler&gt;<br />   &lt;performing bunch of memory reads from different addresses&gt;<br />   ; We will get here if no illegal address was read<br />   jmp end_program<br />exception_handler&#58;<br />   ; This infinite loop should be entered as soon as an illegal address is read<br />   jmp exception_handler<br />end_program&#58;<br /></code></pre><br /><br />The problem is that this works great on Windows 98 SE, but it refuses to work on Windows 2000 and Windows XP? :confused: As soon as an illegal address is encountered in Windows 2000 or XP, the program instead crashes, not having passed my exception handler (execution seems to jump somewhere else before the crash though, probably to some other exception handling related code).<br /><br />What could be causing this? The SEH frames and fs:[0] pointer should work the same in all Windows operating systems, right?<br /><br />Any tips would be greatly appreciated.<br /><br /><br />dELTA</div>
    <div class="meta">Posted on 2003-06-25 08:01:40 by dELTA</div>
   </div>
   <div class="post" id="post-108219">
    <div class="subject"><a href="#post-108219">Re: Strange behaving exception handlers</a></div>
    <div class="body">while ago i start to write some macros to symplify seh works.<br />I haven't complete it. But i use it from time to time and it works for me under 98, w2k, xp, 2003.<br />Just run seh.exe, if it works may be you did something wrong. Just explore the sources.<br /><br />As for seh handling under different oses - it's exactly the same.<br /><br />PS: You can find some other macros like mine on this board or somewhere else.<br />I simply did it by myself because of i wanted it to be as i want.</div>
    <div class="meta">Posted on 2003-06-25 09:17:50 by Four-F</div>
   </div>
   <div class="post" id="post-108259">
    <div class="subject"><a href="#post-108259">Strange behaving exception handlers</a></div>
    <div class="body">Thanks Four-F, I'll take a look at them!<br /><br />I'd still appreciate any input or tips about my specific code above though, since it can be hard to understand what went wrong by only using someone else's working code, and I'd really like to understand what happened in my program.<br /><br /><br />dELTA</div>
    <div class="meta">Posted on 2003-06-25 17:40:12 by dELTA</div>
   </div>
   <div class="post" id="post-108289">
    <div class="subject"><a href="#post-108289">Strange behaving exception handlers</a></div>
    <div class="body">I'm only afraid it's difficult to say something looking at the code-snippet above.</div>
    <div class="meta">Posted on 2003-06-26 04:53:22 by Four-F</div>
   </div>
  </div>
 </body>
</html>