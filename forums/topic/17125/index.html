<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>texture mapping? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17125" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=17125">texture mapping?</a></p>
   <div class="post" id="post-132806">
    <div class="subject"><a href="#post-132806">texture mapping?</a></div>
    <div class="body">hi<br /><br /><br />doesnt work<br />what my problem??<br /><br /><br />LoadUnCompressedTGA proc,lpTtexture,hFhandle<br />                LOCAL SizeReadWrite:DWORD<br />                LOCAL cswap:GLuint <br /><br />     ASSUME edi:ptr Texture <br />     mov edi,lpTtexture<br /><br />    invoke SetFilePointer,hFhandle,12, NULL, FILE_BEGIN<br /><br />  <br />    invoke ReadFile,hFhandle,ADDR tga.header,sizeof tga.header,ADDR SizeReadWrite,NULL<br /><br /><br />    movzx ecx,word ptr <br />    movzx eax,word ptr <br />    <br /> ;   movzx ecx,byte ptr <br /> ;   movzx eax,byte ptr <br /> ;   shl eax,8          <br /> ;   add eax,ecx<br />    mov .width1,eax<br /><br />;    movzx ecx,byte ptr <br />;    movzx eax,byte ptr <br />;    shl eax,8          <br />;    add eax,ecx<br /><br />    mov .height,ecx<br /><br /><br />    movzx eax,byte ptr <br />    mov .bpp, eax<br /><br />    mov eax,.width1<br />    mov tga.Width1,eax<br /><br />    mov eax,.height<br />    mov tga.Height,eax<br /><br />    mov eax,.bpp<br />    mov tga.Bpp,eax<br /><br />    mov eax,.width1<br />    test eax,eax<br />    jz error<br /><br />    mov eax,.height<br />    test eax,eax<br />    jz error<br />    <br /><br /><br />   .if .bpp == 24<br />    mov edx,GL_RGB<br />    mov .type1,edx<br />   .elseif .bpp == 32<br />    mov edx,GL_RGBA<br />    mov .type1,edx<br />   .else<br />    jmp error<br />   .endif<br /><br /><br />    <br />    mov eax,tga.Bpp<br />    shr eax,3<br />    mov tga.bytesPerPixel,eax<br /><br />    imul eax,tga.Width1<br />    imul eax,tga.Height<br />    mov tga.imageSize,eax<br /><br />    <br />    push eax  	<br />    invoke GetProcessHeap<br />    pop ebx<br /><br /><br />    invoke HeapAlloc,eax, NULL,ebx<br /><br />    .if eax == 0<br />    jmp error<br />    .endif<br /><br />    <br />    mov .imageData,eax	<br /><br />   <br /><br />    invoke ReadFile,hFhandle,Ttexture.imageData,tga.imageSize,ADDR SizeReadWrite,NULL<br /><br />     xor ecx,ecx<br />     mov esi,.imageData<br /><br />loop@:<br />     movzx edx,byte ptr <br />     movzx eax,byte ptr <br />     xor eax,edx<br />     xor edx,eax<br />     xor eax,edx<br />     mov ,dl<br />     mov ,al<br />     add ecx,3<br />      <br />    .if ecx == tga.imageSize<br />     jmp okswap<br />    .endif<br />     jmp loop@<br /><br /><br />okswap:<br /><br />    invoke CloseHandle,hFhandle<br /><br />    ret<br /><br /><br /><br />error:<br />    invoke CloseHandle,hFhandle<br />    xor eax,eax<br />    ret<br /><br />LoadUnCompressedTGA endp<br /><br /><br /><br /><br /><br /><br /><br /><br />LoadGLTexture PROC<br /><br />            LOCAL hFile:DWORD<br />            LOCAL SizeReadWrite:DWORD<br />            LOCAL cswap:GLuint <br />    <br />    invoke CreateFile,ADDR TgaName1,\<br />    <br />                                       GENERIC_READ or GENERIC_WRITE ,\<br />                                       FILE_SHARE_READ or FILE_SHARE_WRITE,\<br />                                       NULL,OPEN_EXISTING,FILE_ATTRIBUTE_ARCHIVE,\<br />                                       NULL                                   <br />    mov hFile,eax<br /><br /><br />    invoke ReadFile,hFile,ADDR tgatestbuff,12,ADDR SizeReadWrite,NULL<br /><br />  <br /><br /><br />    cld<br />    lea esi,uTGAcompare<br />    lea edi,tgatestbuff<br />    mov ecx,12<br />    repz cmpsb<br />    jz uncompress<br /><br /><br />    jmp okload<br /><br /><br />    cld<br />    lea esi,cTGAcompare<br />    lea edi,tgatestbuff<br />    mov ecx,12<br />    repz cmpsb<br />    jnz error<br /><br /><br /> ;   invoke LoadCompressedTGA,ADDR Ttexture,hFile<br />   jmp error  <br /><br /><br /><br />uncompress:<br /><br />    <br />    invoke LoadUnCompressedTGA,ADDR Ttexture,hFile<br />    <br />    <br />    <br />    invoke glGenTextures, 1, ADDR Ttexture.texID<br />    <br />    invoke glBindTexture,0de1h,Ttexture.texID<br /><br /><br /><br />    invoke glTexParameteri,GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR<br />    invoke glTexParameteri,GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR<br />     <br />    invoke glTexImage2D, GL_TEXTURE_2D, 0, 1907h,tga.Width1,tga.Height,\<br />                         0,1907h, GL_UNSIGNED_BYTE,Ttexture.imageData<br /><br /><br /><br />okload:<br /><br />    mov eax,1<br />    ret<br /><br />error:<br />    invoke CloseHandle,hFile<br />    xor eax,eax<br />    ret<br />LoadGLTexture ENDP<br /><br /><br /><br />DrawGLScene proc                                      <br /><br />    <br />    invoke glClear, GL_COLOR_BUFFER_BIT  or GL_DEPTH_BUFFER_BIT <br />    invoke glLoadIdentity                              <br />    _glTranslatef 0, 0, -5.0f<br /><br /><br /><br />    invoke glBindTexture, GL_TEXTURE_2D,1<br />   <br />    invoke glBegin,7<br /><br />    push ecx<br />    fldz<br />    push ecx<br />    fstp real8 ptr <br />    push ecx<br />    push ecx<br />    fldz<br />    fstp real8 ptr    <br />    call glTexCoord2d<br /><br /><br /><br /><br /><br />    push ecx<br />    fldz<br />    push ecx<br />    fstp real8 ptr <br />    push ecx<br />    push ecx<br />    fldz<br />    fstp real8 ptr    <br />    call glVertex2d<br /><br /><br /><br /><br /><br />    push ecx<br />    push ecx<br />    fldz<br />    fstp real8 ptr <br />    push ecx<br />    push ecx<br />    fld1<br />    fstp real8 ptr <br />    call glTexCoord2d<br />    <br /><br /><br /><br />    push ecx<br />    push ecx<br />    fldz<br />    fstp real8 ptr <br />    fld   real8 ptr <br />    push ecx<br />    push ecx<br />    fstp real8 ptr <br />   call glVertex2d <br /><br /> <br /><br /><br />   push ecx<br />    push ecx<br />    fld1<br />    fstp real8 ptr <br />    push ecx<br />    push ecx<br />    fld1;<br />    fstp real8 ptr <br />    call glTexCoord2d<br /><br /><br /><br /><br /><br />    fld   real8 ptr <br />    push ecx<br />    push ecx<br />    fstp real8 ptr <br />    fld real8 ptr <br />    push ecx<br />    push ecx<br />    fstp real8 ptr ;<br />    call glVertex2d<br /><br /><br /><br /><br />   push ecx<br />   push ecx<br />   fld1<br />   fstp real8 ptr <br />   push ecx<br />   push ecx<br />   fldz<br />   fstp real8 ptr <br />   call glTexCoord2d<br /><br />   fld real8 ptr <br />   push ecx<br />   push ecx<br />   fstp real8 ptr <br />   push ecx<br />   push ecx<br />   fldz<br />   fstp real8 ptr <br />   call glVertex2d<br /><br /><br />  invoke glEnd   <br /><br /><br />   mov eax, 1<br />    ret<br />DrawGLScene endp<br /><br />END start<br />:confused:</div>
    <div class="meta">Posted on 2004-02-07 00:13:35 by playh</div>
   </div>
   <div class="post" id="post-132814">
    <div class="subject"><a href="#post-132814">texture mapping?</a></div>
    <div class="body">Ehhh, right.<br />&quot;Please fix this&quot; *large unreadable source with no description at all*</div>
    <div class="meta">Posted on 2004-02-07 05:23:48 by Henk-Jan</div>
   </div>
   <div class="post" id="post-132849">
    <div class="subject"><a href="#post-132849">texture mapping?</a></div>
    <div class="body">Enable texturing winth glEnable (GL_TEXTURE_2D).<br /><br />Toni</div>
    <div class="meta">Posted on 2004-02-07 17:01:27 by minimoog</div>
   </div>
  </div>
 </body>
</html>