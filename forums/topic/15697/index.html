<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Add text in mode 13h - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=15697" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=15697">Add text in mode 13h</a></p>
   <div class="post" id="post-121636">
    <div class="subject"><a href="#post-121636">Add text in mode 13h</a></div>
    <div class="body">A friend liked this fire effect and asked if I could put some text at the<br />top. <br /><br />I didn't write the code and don't understand much of it. <br /><br />She wants to use it as a screensaver from a DOS box on a system running<br />XP. The text I added isn't very readable. Do I have to start with one palette<br />for the text, write the text and then continue. Thanks.<br /><br /><br />; fire.asm     Com file<br />; Fire simulation, good for demos  - by Tenie Remmel   6/7/2002<br />;<br />;<br />Model Tiny<br />386P<br /><br />code<br /><br />Org 100h<br /><br />begin:<br />        jmp   start<br /><br />fire    db      'test$'<br /><br />;************* Custom palette<br />Pal         db 0,0,0,0,0,2,0,0,4,0,0,6,0,0,8,0,0,10,0,0,12,0,0,14<br />            db 0,0,16,2,0,14,4,0,12,6,0,10,8,0,8,10,0,6,12,0,4,14<br />            db 0,2,16,0,0,19,0,0,22,0,0,25,0,0,28,0,0,31,0,0,34,0,0<br />            db 37,0,0,39,0,0,42,0,0,45,0,0,48,0,0,51,0,0,54,0,0,57<br />            db 0,0,60,0,0,63,0,0,63,2,0,63,5,0,63,7,0,63,10,0,63,13<br />            db 0,63,15,0,63,18,0,63,21,0,63,23,0,63,26,0,63,28,0,63<br />            db 31,0,63,34,0,63,36,0,63,39,0,63,42,0,63,44,0,63,47,0<br />            db 63,49,0,63,52,0,63,55,0,63,57,0,63,60,0,63,63,0,63<br />            db 63,2,63,63,5,63,63,7,63,63,10,63,63,13,63,63,15,63<br />            db 63,18,63,63,21,63,63,23,63,63,26,63,63,28,63,63,31<br />            db 63,63,34,63,63,36,63,63,39,63,63,42,63,63,44,63,63<br />            db 47,63,63,49,63,63,52,63,63,55,63,63,57,63,63,60<br /><br />PalDB       db 528 dup(?)           ;Last part of palette<br />RandNum     dd 0                    ;Random number<br /><br />start:<br /><br />            mov ax,13h              ;Set video mode 13h<br />            int 10h<br /><br />            lea     dx,fire<br />            mov     ah,9<br />            int     21h<br /><br /><br />            mov dx,03D4h            ;Set bigger pixels<br />            mov ax,4209h<br />            out dx,ax<br /><br />            mov di,offset PalDB     ;Set last part of palette<br />            mov al,03Fh<br />            mov cx,528<br />            rep stosb<br /><br />            mov dx,3c8h             ;Set custom palette<br />            xor al,al<br />            out dx,al<br />            inc dx<br />            mov cx,768<br />            mov si,offset Pal<br />            rep outsb  <br /><br />            mov ax,cs               ;Get extra segments<br />            add ax,1000h<br />            mov fs,ax<br />            add ax,1000h<br />            mov gs,ax<br />    <br />            push fs                 ;Clear frame 1<br />            pop es<br />            xor di,di<br />            xor eax,eax<br />            mov cx,8000<br />            rep stosd<br />    <br />            push gs                 ;Clear frame 2<br />            pop es<br />            xor di,di<br />            mov cx,8000<br />            rep stosd<br /><br />MainLoop:   push fs gs              ;DS = frame 1<br />            pop es ds               ;ES = frame 2<br />            mov si,321              ;SI = (1, 1), DI = (1, 0)<br />            mov di,1                ;this makes it move up<br />            mov cx,31678            ;CX = count<br />            <br />CalcLoop:   mov al,           ;AX = average of the four<br />            xor ah,ah               ;surrounding pixels<br />            add al,<br />            adc ah,0<br />            add al,<br />            adc ah,0<br />            add al,<br />            adc ah,0<br />            shr ax,2<br /><br />            cmp ax,1                ;Decrement if it isn't zero<br />            adc ax,-1<br /><br />            stosb                   ;Write pixel<br />            inc si                  ;Advance pointer<br />            dec cx                  ;Loop back<br />            jnz CalcLoop<br /><br />            mov di,31360            ;DI = 3rd-to-last row<br />            mov cx,320              ;320 pixels<br />            mov eax,    ;EAX = random number<br />            <br />RandLoop1:  imul eax,69069          ;Set top row random pixel<br />            inc eax<br />            mov bl,ah<br />            and bl,31<br />            add bl,50<br />            mov ,bl<br /><br />            imul eax,69069          ;Set middle row random pixel<br />            inc eax<br />            mov bl,ah<br />            and bl,31<br />            add bl,70<br />            mov ,bl<br /><br />            imul eax,69069          ;Set bottom row random pixel<br />            inc eax<br />            mov bl,ah<br />            and bl,31<br />            add bl,100<br />            mov ,bl<br /><br />            inc di                  ;Next pixel<br />            loop RandLoop1          ;Loop back<br /><br />            imul eax,69069          ;CL = random value<br />            inc eax<br />            mov cl,al<br />            and cx,15<br />            mov si,31360            ;SI = 3rd-to-last row<br />    <br />RandLoop2:  imul eax,69069          ;Get random number<br />            inc eax<br />            push ax                 ;DI = random position<br />            xor dx,dx               ;from 0 to 320<br />            mov bx,320<br />            div bx<br />            mov di,dx<br />            pop ax<br />            add di,si<br />            xor bl,bl               ;BL = 0FFh<br />            dec bl<br />            mov ,bl      ;Draw a 3x3 square<br />            mov ,bl<br />            mov ,bl<br />            mov ,bl<br />            mov ,bl<br />            mov ,bl<br />            mov ,bl<br />            mov ,bl<br />            mov ,bl<br />            loop RandLoop2          ;Loop back<br /><br />            mov ,eax    ;Save random number<br />    <br />            push 0A000h gs          ;ES = 0A000h<br />            pop ds es               ;DS = frame 2<br />            xor si,si               ;Set up for blit<br />            mov di,10880<br />            mov cx,8000             ;100 lines<br />            rep movsd<br /><br />            push fs gs              ;Swap frames<br />            pop  fs gs<br /><br />            mov          ah,0   ; function no. for read<br />            int          1ah    ; get the time of day count<br />            add          dx,1   ; add .05 seconds (one eighteenth of a second<br />                                ; delay)<br /><br />            mov          bx,dx  ; to low word and then store end of delay<br />                                ; value in bx<br />repeat:                            <br />            int          1ah      ; read time again <br />            cmp          dx,bx<br />            jne          repeat<br /><br />            mov ah,1                ;Check for a key<br />            int 16h<br /><br />            jz MainLoop             ;Loop back<br />    <br />            xor ah,ah               ;Eat the key<br />            int 16h<br />            mov ax,3                ;Restore video mode<br />            int 10h<br />            mov  ax,4c00h<br />            int  21h<br />     <br />End  begin</div>
    <div class="meta">Posted on 2003-10-18 04:58:15 by skywalker</div>
   </div>
   <div class="post" id="post-121646">
    <div class="subject"><a href="#post-121646">Add text in mode 13h</a></div>
    <div class="body">You can add to the end of the custom palette, that she made, an entry or two for your text color. I see she already has black, and none of her colors reaches above 63,63,63. So, you should add white (255,255,255) just before &quot;PalDB&quot;, and make &quot;PalDB&quot; have 525 entries. <br />Before the check of the key is the place you wanna code . You'll need to have an array, that contains the text bitmaps. 7x9 pixels  per char is likely to do the trick. I think you can learn how to display the text, so I'll give some advice on building the text bitmap(array). Make a win32 app, that creates a DIB (search this forum for things you don't know) and a DC for it. Make the app ask you for font (MASM32 package has one lib for it, see its code). With the selected font, draw the a-z A-Z text on the DC, in one line, the returned value is the height of the text;  and check each char's length , save it to an array. In the end, make the app save the bitmap bits, the length array, and the height value in hex or BCD format in a text file. Include that file in the code you posted. The result should be like this:<br /><pre><code><br />TextBits db 0,1,0,1,0,0,0 , .........<br />TextLen db 7,5,6,10,4, .........<br />TextHei db 11<br /></code></pre><br />Thus, you can have text with beautiful font, instead of dull fixedsys. The fire algorithm will not wash-out the text in a beautiful way (it doesn't use the whole palette, so I guess it'll limit the blurred out pixels to the number of entries your friend specified), so you'll have clear, contrasting text :)<br /><br />Pls, next time attach the code, instead of inserting it into the post.</div>
    <div class="meta">Posted on 2003-10-18 09:21:13 by Ultrano</div>
   </div>
   <div class="post" id="post-121703">
    <div class="subject"><a href="#post-121703">Add text in mode 13h</a></div>
    <div class="body"><div class="quote"><em>Originally posted by Ultrano </em><br /><strong>You can add to the end of the custom palette, that she made, an entry or two for your text color. I see she already has black, and none of her colors reaches above 63,63,63. So, you should add white (255,255,255) just before &quot;PalDB&quot;, and make &quot;PalDB&quot; have 525 entries. <br />Before the check of the key is the place you wanna code . You'll need to have an array, that contains the text bitmaps. 7x9 pixels  per char is likely to do the trick. I think you can learn how to display the text, so I'll give some advice on building the text bitmap(array). Make a win32 app, that creates a DIB (search this forum for things you don't know) and a DC for it. Make the app ask you for font (MASM32 package has one lib for it, see its code). With the selected font, draw the a-z A-Z text on the DC, in one line, the returned value is the height of the text;  and check each char's length , save it to an array. In the end, make the app save the bitmap bits, the length array, and the height value in hex or BCD format in a text file. Include that file in the code you posted. The result should be like this:<br /><pre><code><br />TextBits db 0,1,0,1,0,0,0 , .........<br />TextLen db 7,5,6,10,4, .........<br />TextHei db 11<br /></code></pre><br /><br />Thanks for the ideas. I look forward to the challenge. Just a few beginning questions. Will this end up being a 32 or 16 bit App.<br />What is a DC.<br /><br />Thanks again.</div>
    <div class="meta">Posted on 2003-10-18 17:41:33 by skywalker</div>
   </div>
   <div class="post" id="post-121719">
    <div class="subject"><a href="#post-121719">Add text in mode 13h</a></div>
    <div class="body">The win32 app will be ... 32-bit :) . You won't run this app more than once, unless there's a problem with it. <br />The DOS app can be made 16-bit or 32-bit - it really doesn't matter.</div>
    <div class="meta">Posted on 2003-10-19 00:17:36 by Ultrano</div>
   </div>
   <div class="post" id="post-122176">
    <div class="subject"><a href="#post-122176">Add text in mode 13h</a></div>
    <div class="body"><div class="quote"><em>Originally posted by Ultrano </em><br /><strong>You can add to the end of the custom palette, that she made, an entry or two for your text color. I see she already has black, and none of her colors reaches above 63,63,63. So, you should add white (255,255,255) just before &quot;PalDB&quot;, and make &quot;PalDB&quot; have 525 entries. <br />Before the check of the key is the place you wanna code . You'll need to have an array, that contains the text bitmaps. 7x9 pixels  per char is likely to do the trick. I think you can learn how to display the text, so I'll give some advice on building the text bitmap(array). Make a win32 app, that creates a DIB (search this forum for things you don't know) and a DC for it. Make the app ask you for font (MASM32 package has one lib for it, see its code). With <br /><br />Since the code I posted was 16 bit, it would seem logical that I don't code in win32 yet. I did search for DIB, but didn't even find full code for anything that would even compile. I have the tools to make win32 apps, but I need something that will at least get me in the ballfield. :-) Then I can work on the suggestions you gave me.<br />Thanks.</div>
    <div class="meta">Posted on 2003-10-22 23:00:59 by skywalker</div>
   </div>
   <div class="post" id="post-122212">
    <div class="subject"><a href="#post-122212">Add text in mode 13h</a></div>
    <div class="body">I'll  try to make the win32 app you need</div>
    <div class="meta">Posted on 2003-10-23 07:52:06 by Ultrano</div>
   </div>
   <div class="post" id="post-122229">
    <div class="subject"><a href="#post-122229">Add text in mode 13h</a></div>
    <div class="body"><div class="quote"><br />I'll  try to make the win32 app you need </div><br /><br />Thanks, I have been downloading everything I can find on mode 13h. <br />One source had a palette of 765 db statements, but then had cx count of 768 which I couldn't figure out.</div>
    <div class="meta">Posted on 2003-10-23 10:39:18 by skywalker</div>
   </div>
   <div class="post" id="post-122242">
    <div class="subject"><a href="#post-122242">Add text in mode 13h</a></div>
    <div class="body">Here you go. The larger generated array is packed like this: every byte contains the values of 8 consecutive horisontal pixels. If you don't manage to get an idea on how to implement it, I'll post some code tomorrow. Anyway, I'll post it, but make sure you try to do it on your own.</div>
    <div class="meta">Posted on 2003-10-23 14:13:35 by Ultrano</div>
   </div>
   <div class="post" id="post-122314">
    <div class="subject"><a href="#post-122314">Writes ASCIA.txt on desktop</a></div>
    <div class="body"><div class="quote"><br />Here you go. The larger generated array is packed like this: every byte contains the values of 8 consecutive horisontal pixels. If you don't manage to get an idea on how to implement it, I'll post some code tomorrow. Anyway, I'll post it, but make sure you try to do it on your own. </div><br /><br />Take your time writing the code. The code you posted writes ASCIA.txt  across the destop.(in Win 98)</div>
    <div class="meta">Posted on 2003-10-24 07:01:23 by skywalker</div>
   </div>
   <div class="post" id="post-122327">
    <div class="subject"><a href="#post-122327">Add text in mode 13h</a></div>
    <div class="body">Yes, I did that on purpose, and if you look closer, you'll see I've put a switch (a constant) to turn this off ;).<br />I've been having 9 to 10 hours/day at uni during the last week, studying higher maths non-stop, I'm very  tired now, and I have some special code to complete asap, so I'll post code on how to use the font in a few days. The version upped above is perfect, so you can make some effort to study and use it meanwhile. :alright:<br /><br />the asci.txt does <strong>not</strong> get shown on the desktop. The array you see on the desktop is exactly what the encoded font looks like (from char 32 to 31+Chars_Num). The Asci.txt has a purpose, though - if your language has some special chars, and you'd like to actually make use of them, you should open that file with notepad or something using the font you chose, and see what the constant Chars_Num should be set to. I'm from Bulgaria, and what would make me more happy than some text is some text in my language, because it's rather rare to see it on my PC, and almost impossible under a DOS proggie. Thus, I'd increase Chars_Num to 224.</div>
    <div class="meta">Posted on 2003-10-24 10:32:23 by Ultrano</div>
   </div>
   <div class="post" id="post-123846">
    <div class="subject"><a href="#post-123846">Add text in mode 13h</a></div>
    <div class="body"><div class="quote"><br />Yes, I did that on purpose, and if you look closer, you'll see I've put a switch (a constant) to turn this off ;).<br />I've been having 9 to 10 hours/day at uni during the last week, studying higher maths non-stop, I'm very  tired now, and I have some special code to complete asap, so I'll post code on how to use the font in a few days. The version upped above is perfect, so you can make some effort to study and use it meanwhile. :alright:<br /><br />the asci.txt does <strong>not</strong> get shown on the desktop. The array you see on the desktop is exactly what the encoded font looks like (from char 32 to 31+Chars_Num). The Asci.txt has a purpose, though - if your language has some special chars, and you'd like to actually make use of them, you should open that file with notepad or something using the font you chose, and see what the constant Chars_Num should be set to. I'm from Bulgaria, and what would make me more happy than some text is some text in my language, because it's rather rare to see it on my PC, and almost impossible under a DOS proggie. Thus, I'd increase Chars_Num to 224. </div><br /><br /><br />What language do you speak.<br />I'll try to work on some text in your language. I learned Korean and German, so it shouldn't be a problem.<br /><br />Couldn't find the switch you mentioned. <br /><br />Have a great weekend.</div>
    <div class="meta">Posted on 2003-11-08 22:22:59 by skywalker</div>
   </div>
   <div class="post" id="post-123961">
    <div class="subject"><a href="#post-123961">Add text in mode 13h</a></div>
    <div class="body">My native language is Bulgarian  (had mentioned it above :grin: ), but I haven't written anything in BG in this code. Here I upload the code, well commented . Follow the XASM tags ;=====[[ &gt;&gt;===\ and ;=======/  - they're both comments and important blocks of code. <br />I wrote half of the function you need to draw text, I expect you continue it - it'll be an exercise :)</div>
    <div class="meta">Posted on 2003-11-10 14:07:14 by Ultrano</div>
   </div>
   <div class="post" id="post-123965">
    <div class="subject"><a href="#post-123965">Add text in mode 13h</a></div>
    <div class="body">I did a font system for my DOS game I made earlier but it was horrible, all I used is a 1 or 0 font where 1 means current text color pixel is plotted at that point and 0 means nothing is plotted (position is skipped). Though that may be too simple if you want multiple colors within your fonts.</div>
    <div class="meta">Posted on 2003-11-10 15:12:25 by x86asm</div>
   </div>
   <div class="post" id="post-123990">
    <div class="subject"><a href="#post-123990">Add text in mode 13h</a></div>
    <div class="body">This font system does the same way :) It's been compressed  8 pixels/byte.</div>
    <div class="meta">Posted on 2003-11-10 23:11:42 by Ultrano</div>
   </div>
   <div class="post" id="post-124047">
    <div class="subject"><a href="#post-124047">FontuHontu.inc</a></div>
    <div class="body"><div class="quote"><br />My native language is Bulgarian  (had mentioned it above :grin: ), but I haven't written anything in BG in this code. Here I upload the code, well commented . Follow the XASM tags ;=====[[ &gt;&gt;===\ and ;=======/  - they're both comments and important blocks of code. <br />I wrote half of the function you need to draw text, I expect you continue it - it'll be an exercise :) </div><br /><br />;------&lt; Switches and settings &gt;-------------------------\<br />itial_Wid equ 1600 ; must be dividable by 8 ; maximum width you'd like to use for whole font<br />Initial_Hei equ 40   ; maximum height you'd want to use<br />Chars_Num equ 96 ; how many characters from the 32nd to show. ANSI that is<br /><br />Ok, so the 96 represents the most common characters most people would want to write, the english <br />alphabet, punctuation, etc.<br /><br />The FontuHontu.inc is the file with the letters,etc. that will show on the screen in my program.<br /><br />Once I have learned how to modify it to show what I need, then I'll need to learn how to display<br />it in particular screen position.<br /><br />For a future project, I'll try to learn how to print the first 32 control characters as well<br />as the remainder of the 256 char set. I only know how to print them using a fixed font.<br /><br />I'm curious as to why the large difference between the height and width values.<br /><br />Thanks.</div>
    <div class="meta">Posted on 2003-11-11 11:29:30 by skywalker</div>
   </div>
   <div class="post" id="post-124049">
    <div class="subject"><a href="#post-124049">Add text in mode 13h</a></div>
    <div class="body">Like I said above, and accented on in the readme.txt,  that constant is what DrawOnDesktop specifies if the proggie shows what it encodes in the FontuHontu.inc . As you see that immediate result on the desktop , you see that the height is merely above 20pt, let's say you use up to 40px , and the width is great, because we're displaying all chars on one line. The font isn't fixed-width, so there are two arrays in FontuHontu, that contain widths (in bytes) of chars and offsets (in words) of these chars' bits in the compressed bitmap. The system can be simplified if each pixel took a byte, but I think small proggies need to be kept small :) . Btw, please, don't use &quot;quote&quot; in the board in this way- it's mainly used when you want to accent on some sentence of somebody of the many people that discuss in this topic, which is really not the case here :)</div>
    <div class="meta">Posted on 2003-11-11 11:43:36 by Ultrano</div>
   </div>
  </div>
 </body>
</html>