<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Printing a Inputed Character - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30010" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=30010">Printing a Inputed Character</a></p>
   <div class="post" id="post-211843">
    <div class="subject"><a href="#post-211843">Printing a Inputed Character</a></div>
    <div class="body">Hello,<br /> I&#039;m doing a simple OS, that will capture a inputted character and will print it using a procedure that I&#039;ve done(because I will print many things later). At the time it&#039;s like this:<br /><pre><code><br /><br /><br />jmp short main &nbsp; ; Jump past disk description section<br />nop &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Pad out before disk description<br /><br />; ------------------------------------------------------------------<br />; Disk description table<br />; Values are those used by IBM for 1.44 MB, 3.5&quot; diskette<br /><br />OEMLabel &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;db &quot;LEAFOS&quot; &nbsp;; Disk label - 8 chars<br />BytesPerSector &nbsp; &nbsp; &nbsp;dw 512 &nbsp; &nbsp; &nbsp; ; Bytes per sector<br />SectorsPerCluster &nbsp; db 1 &nbsp; &nbsp; &nbsp; &nbsp; ; Sectors per cluster<br />ReservedForBoot &nbsp; &nbsp; dw 1 &nbsp; &nbsp; &nbsp; &nbsp; ; Reserved sectors for boot record<br />NumberOfFats &nbsp; &nbsp; &nbsp; &nbsp;db 2 &nbsp; &nbsp; &nbsp; &nbsp; ; Number of copies of the FAT<br />RootDirEntries &nbsp; &nbsp; &nbsp;dw 224 &nbsp; &nbsp; &nbsp; ; Number of entries in root dir<br />LogicalSectors &nbsp; &nbsp; &nbsp;dw 2880 &nbsp; &nbsp; &nbsp;; Number of logical sectors<br />MediumByte &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;db 0F0h &nbsp; &nbsp; &nbsp;; Medium descriptor byte<br />SectorsPerFat &nbsp; &nbsp; &nbsp; dw 9 &nbsp; &nbsp; &nbsp; &nbsp; ; Sectors per FAT<br />SectorsPerTrack &nbsp; &nbsp; dw 18 &nbsp; &nbsp; &nbsp; &nbsp;; Sectors per track (36/cylinder)<br />Sides &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw 2 &nbsp; &nbsp; &nbsp; &nbsp; ; Number of sides/heads<br />HiddenSectors &nbsp; &nbsp; &nbsp; dd 0 &nbsp; &nbsp; &nbsp; &nbsp; ; Number of hidden sectors<br />LargeSectors &nbsp; &nbsp; &nbsp; &nbsp;dd 0 &nbsp; &nbsp; &nbsp; &nbsp; ; Number of LBA sectors<br />DriveNo &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dw 0 &nbsp; &nbsp; &nbsp; &nbsp; ; Drive No: 0<br />Signature &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; db 41 &nbsp; &nbsp; &nbsp; &nbsp;; Drive signature: 41 for floppy<br />VolumeID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dd 00000000h ; Volume ID: any number<br />VolumeLabel &nbsp; &nbsp; &nbsp; &nbsp; db &quot;LEAFOS&quot; &nbsp;; Volume Label: any 11 chars<br />FileSystem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;db &quot;FAT12&quot; &nbsp; ; File system type: don&#039;t change!<br /><br />; End of the disk description table<br />; ------------------------------------------------------------------<br /><br /><br />main:<br /> &nbsp; &nbsp;mov si, msg<br /> &nbsp; &nbsp;call printf<br /> &nbsp; &nbsp;<br /> &nbsp; &nbsp;mov ah, 00h<br /> &nbsp; &nbsp;int 16h<br /> &nbsp; &nbsp;<br /> &nbsp; &nbsp;jmp $<br /> &nbsp; &nbsp;<br /><br />; +------------+<br />; | Procedures |<br />; +------------+ &nbsp; &nbsp;<br />printf:<br /> &nbsp; &nbsp;mov ah, 0eh<br /> &nbsp; &nbsp;mov bl, 07h<br /><br /> &nbsp; &nbsp;.nextchar<br /> &nbsp; &nbsp; &nbsp; lodsb<br /> &nbsp; &nbsp; &nbsp; or al, al<br /> &nbsp; &nbsp; &nbsp; jz .return<br /> &nbsp; &nbsp; &nbsp; int 10h<br /> &nbsp; &nbsp; &nbsp; jmp .nextchar<br /><br /> &nbsp; &nbsp;.return<br /> &nbsp; &nbsp; &nbsp; ret<br /><br />.data<br />msg db &quot;Test&quot; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />times 510-($-$$) db 0<br />dw 0xAA55</code></pre><br />As my procedure reads the <em>SI</em> and print it to the screen, but I want to know the correct way to do it. But I think that it&#039;s to move all the content of <em>AL</em> to a string(that I don&#039;t know how to declare it, because I&#039;ve never declared 8-Bits variables, just db and dw) and the move it to the <em>SI</em>, then if I&#039;m correct, I don&#039;t know how to declare the variable, then I will need to know how.<br /><br />Best Regards,<br /> Nathan Paulino Campos</div>
    <div class="meta">Posted on 2010-05-27 18:10:59 by nathanpc</div>
   </div>
   <div class="post" id="post-211844">
    <div class="subject"><a href="#post-211844">Re: Printing a Inputed Character</a></div>
    <div class="body">OK, so...<br />&nbsp; &nbsp; mov ah, 00h<br />&nbsp; &nbsp; int 16h<br />Puts a character into AL doesn&#039;t it? So could you not just<br /><pre><code><br />&nbsp; &nbsp; ; ---- Get a key into AL----;<br />&nbsp; &nbsp; mov ah, 00h<br />&nbsp; &nbsp; int 16h<br />&nbsp; &nbsp; ;---- Print what is in AL----;<br />&nbsp; &nbsp; mov ah, 0eh&nbsp;  <br />&nbsp; &nbsp; int 10h<br /></code></pre><br />???<br /><br />Also about your code... How do you expect the keypress to get into SI? How do you plan to print it if you stop to JMP $ and don&#039;t continue? Were is you &quot;msg&quot; string at?</div>
    <div class="meta">Posted on 2010-05-27 18:56:37 by Coty</div>
   </div>
   <div class="post" id="post-211845">
    <div class="subject"><a href="#post-211845">Re: Printing a Inputed Character</a></div>
    <div class="body">Sorry, I&#039;ve forgot to copy that part of the code, but now I fixed. Also, I don&#039;t want to do just that, because I need to use my procedure.</div>
    <div class="meta">Posted on 2010-05-27 19:02:22 by nathanpc</div>
   </div>
   <div class="post" id="post-211846">
    <div class="subject"><a href="#post-211846">Re: Printing a Inputed Character</a></div>
    <div class="body">After 4 keys the program will finish putting data into SI and go print with your routeene <br /><pre><code><br /> &nbsp; &nbsp;mov si, msg<br /> &nbsp; &nbsp;;---- Get 4 keys ----;<br /> &nbsp; &nbsp;mov cx, 4 <br /> &nbsp; &nbsp;; ---- Get a key into AL----;<br />.wut:<br /> &nbsp; &nbsp;mov ah, 00h<br /> &nbsp; &nbsp;int 16h<br /> &nbsp; &nbsp;;---- Put key into SI and do moar ----;<br /> &nbsp; &nbsp;stosb<br /> &nbsp; &nbsp;loop .wut<br /> &nbsp; &nbsp;;---- Print what is in SI----;<br /> &nbsp; Call printf<br /></code></pre><br />stosb does the opisite of lodsb by putting what is in AL into SI instead of reading from SI and putting into AL ;)</div>
    <div class="meta">Posted on 2010-05-27 19:25:54 by Coty</div>
   </div>
   <div class="post" id="post-211847">
    <div class="subject"><a href="#post-211847">Re: Printing a Inputed Character</a></div>
    <div class="body"><strong>nathanpc</strong>,<br /><br />You may already have noticed that <strong>nasm</strong> warns you about several lines. Two of them are real labels (<strong>.nextchar</strong> and <strong>.return</strong>), but <strong>.data</strong>â€¦ Do you think it&#039;s directive? No, it&#039;s label too. You&#039;d better use colon after label explicitly (and pay more attention to compiler warnings ;)).<br /><br />For <strong>int 10h fn 0Eh</strong> it&#039;s much more important to have correct <strong>bh</strong> than <strong>bl</strong>: <strong>bh</strong> defines number of video page to output character (fortunately, in most cases BIOS starts boot sector with page 0 active and <strong>bh</strong> being equal to 0), <strong>bl</strong> is foreground character color <u>for graphic modes</u> only.<br /><br />To use your procedure, you must pass correct parameter to it. As <strong>Coty</strong> said, <strong>int 16h</strong> can be used to get single keystroke from keyboard (it doesn&#039;t echo it, though).<br /><br />BTW, 8 bits is a byte (and <strong>db</strong> stands for <strong>d</strong>efine <strong>b</strong>yte). ;)<br /><br />----8&lt;----<br /><div class="quote"><br />After 4 keys the program will finish putting data into SI and go print with your routeene <br /></div><br /><br />Are you sure? <strong>lodsb</strong> copies contents of <strong>byte</strong> to <strong>al</strong>, so nothing else than &quot;Test&quot; will print. ;)</div>
    <div class="meta">Posted on 2010-05-27 19:31:09 by baldr</div>
   </div>
   <div class="post" id="post-211848">
    <div class="subject"><a href="#post-211848">Re: Printing a Inputed Character</a></div>
    <div class="body">I was hoping I edited it before any one saw that.<br /><em>coty fail</em> :lol: </div>
    <div class="meta">Posted on 2010-05-27 19:43:51 by Coty</div>
   </div>
   <div class="post" id="post-211849">
    <div class="subject"><a href="#post-211849">Re: Printing a Inputed Character</a></div>
    <div class="body"><div class="quote"><br />After 4 keys the program will finish putting data into SI and go print with your routeene <br /><pre><code><br />&nbsp; &nbsp; mov si, msg<br />&nbsp; &nbsp; ;---- Get 4 keys ----;<br />&nbsp; &nbsp; mov cx, 4 <br />&nbsp; &nbsp; ; ---- Get a key into AL----;<br />.wut:<br />&nbsp; &nbsp; mov ah, 00h<br />&nbsp; &nbsp; int 16h<br />&nbsp; &nbsp; ;---- Put key into SI and do moar ----;<br />&nbsp; &nbsp; stosb<br />&nbsp; &nbsp; loop .wut<br />&nbsp; &nbsp; ;---- Print what is in SI----;<br />&nbsp;  Call printf<br /></code></pre><br />stosb does the opisite of lodsb by putting what is in AL into SI instead of reading from SI and putting into AL ;)<br /></div><br />I tried to use it, but it haven&#039;t worked, I can&#039;t see the output of it. :(<br /><br /><br /><br /><div class="quote"><br /><strong>nathanpc</strong>,<br /><br />You may already have noticed that <strong>nasm</strong> warns you about several lines. Two of them are real labels (<strong>.nextchar</strong> and <strong>.return</strong>), but <strong>.data</strong>&#8230; Do you think it&#039;s directive? No, it&#039;s label too. You&#039;d better use colon after label explicitly (and pay more attention to compiler warnings ;)).<br /><br />For <strong>int 10h fn 0Eh</strong> it&#039;s much more important to have correct <strong>bh</strong> than <strong>bl</strong>: <strong>bh</strong> defines number of video page to output character (fortunately, in most cases BIOS starts boot sector with page 0 active and <strong>bh</strong> being equal to 0), <strong>bl</strong> is foreground character color <u>for graphic modes</u> only.<br /><br />To use your procedure, you must pass correct parameter to it. As <strong>Coty</strong> said, <strong>int 16h</strong> can be used to get single keystroke from keyboard (it doesn&#039;t echo it, though).<br /><br />BTW, 8 bits is a byte (and <strong>db</strong> stands for <strong>d</strong>efine <strong>b</strong>yte). ;)<br /><br />----8&lt;----<br /><div class="quote"><br />After 4 keys the program will finish putting data into SI and go print with your routeene <br /></div><br /><br />Are you sure? <strong>lodsb</strong> copies contents of <strong>byte</strong> to <strong>al</strong>, so nothing else than &quot;Test&quot; will print. ;)<br /></div><br />Yes, I&#039;ve payed attention on the compiler warnings, but I put my code like that, because it&#039;s my style(as every has your personal style of writing codes), also I know about <strong>bh</strong> and <strong>bl</strong>, but I forgot that <strong>db</strong> was byte, but I was remembering that <strong>dw</strong> is for word. Thanks for advising me about this. :)</div>
    <div class="meta">Posted on 2010-05-27 20:09:34 by nathanpc</div>
   </div>
   <div class="post" id="post-211854">
    <div class="subject"><a href="#post-211854">Re: Printing a Inputed Character</a></div>
    <div class="body"><div class="quote"><br /><div class="quote"><br />After 4 keys the program will finish putting data into SI and go print with your routeene <br /><pre><code><br />&nbsp; &nbsp; mov si, msg<br />&nbsp; &nbsp; ;---- Get 4 keys ----;<br />&nbsp; &nbsp; mov cx, 4 <br />&nbsp; &nbsp; ; ---- Get a key into AL----;<br />.wut:<br />&nbsp; &nbsp; mov ah, 00h<br />&nbsp; &nbsp; int 16h<br />&nbsp; &nbsp; ;---- Put key into SI and do moar ----;<br />&nbsp; &nbsp; stosb<br />&nbsp; &nbsp; loop .wut<br />&nbsp; &nbsp; ;---- Print what is in SI----;<br />&nbsp;  Call printf<br /></code></pre><br />stosb does the opisite of lodsb by putting what is in AL into SI instead of reading from SI and putting into AL ;)<br /></div><br />I tried to use it, but it haven&#039;t worked, I can&#039;t see the output of it. :(</div><br /><br />Do you understand why?<br /><ul><br /><li><strong>stosb</strong> uses <strong>es:di</strong> as the destination, yet it&#039;s uninitialized;</li><br /><li><strong>int 16/00</strong> <em>reads</em> keystroke, it doesn&#039;t echo it to screen.</li><br /></ul></div>
    <div class="meta">Posted on 2010-05-28 00:46:08 by baldr</div>
   </div>
   <div class="post" id="post-211855">
    <div class="subject"><a href="#post-211855">Re: Printing a Inputed Character</a></div>
    <div class="body">About the <strong>int 16 AH=00h</strong>, I know that it doesn&#039;t echo it, and this is what I want, then I need to echo it, but now I was thinking about that other things of <strong>int 10</strong>, there was one cursor blinking thing, and if I&#039;m remembering good there was one thing that what you type it echos, like MS-DOS and consoles does... :O</div>
    <div class="meta">Posted on 2010-05-28 04:46:36 by nathanpc</div>
   </div>
   <div class="post" id="post-211856">
    <div class="subject"><a href="#post-211856">Re: Printing a Inputed Character</a></div>
    <div class="body">Hallo! So, you have some code I gave you, but it is broken... and? From what I think the <br />current code only has 1 <em>small</em> error. easy fix. Google <strong>stosb</strong> and read what <strong>baldr</strong> <br />said. Shouldn&#039;t take more than an half hour to fix, once you accomplish you will <br />remember and all this will be easy. Sure you may hate me, but it will give you the chance<br />to get your feet wet and will give you a chance to learn how to solve problems. remember<br />each <em>painful</em> step on the way up will get you closer to the top &nbsp;;)<br /><br />HINT: There is one line of code missing line, and it has something to do with &quot;mov DI&quot;.</div>
    <div class="meta">Posted on 2010-05-28 06:54:13 by Coty</div>
   </div>
   <div class="post" id="post-211860">
    <div class="subject"><a href="#post-211860">Re: Printing a Inputed Character</a></div>
    <div class="body"><div class="quote">like MS-DOS and consoles does...</div><br /><br />Here you&#039;ve said the key words. OS considers console as compound device consisting of input and output devices (usually keyboard and screen, but not always). DOS provides quite a lot of console input services, with or without echo.<br /><br />BIOS, OTOH, knows nothing about consoles, so <strong>int 16</strong> doesn&#039;t have functions that echo keystrokes they read and <strong>int 10</strong> doesn&#039;t have functions to read keystrokes.</div>
    <div class="meta">Posted on 2010-05-28 14:12:37 by baldr</div>
   </div>
   <div class="post" id="post-211861">
    <div class="subject"><a href="#post-211861">Re: Printing a Inputed Character</a></div>
    <div class="body">Yeah... eventually you&#039;ll probably want to provide &quot;get key with echo&quot; and &quot;get key without echo&quot;. The former is probably more useful, but it&#039;ll take a couple of bios calls.<br /><br />Something that hasn&#039;t been mentioned is initialization of segment registers. If you&#039;re seeing &quot;test&quot;, your bios is leaving ds, at least, set to zero. This isn&#039;t always true (if you want your code to work on other machines), I&#039;d explicitly set ds and es to zero, right after &quot;main&quot;. You might think about where your stack is, too. Often, it appears, bios leaves ss:sp pointed to very low memory - top of your IVT! You&#039;ll want it in a &quot;known&quot; place eventually (remember that interrupts are using your stack, as well as any use you may be making of it). If you know where it&#039;s eventually going to be, &quot;right at first&quot; is a good time to put it there.<br /><br />Baldr points out that &quot;.data&quot; isn&#039;t a directive, but a local label. If you wanted a &quot;segment directive&quot;, you could put one there. To Nasm, &quot;segment&quot; and &quot;section&quot; are aliases, but &quot;segment&quot; is misleading (IMHO) in a binary format - there are no &quot;segments&quot; in a flat binary format. But Nasm will put &quot;section .text&quot; (the default if you don&#039;t specify) first, &quot;section .data&quot; after that, and &quot;section .bss&quot; last. &quot;section .data&quot; isn&#039;t much use in a bootsector - if you *do* have one, make sure your padding and boot sig are at the end of it - not in &quot;section .text&quot;! Remember that &quot;section .data&quot; comes after &quot;section .text&quot;. However, &quot;section .bss&quot; could be useful - it comes after &quot;.text&quot; (and/or &quot;.data&quot;, if any), but doesn&#039;t add anything to your 512 byte file! It merely assigns names to memory beyond the 512 bytes. It is a possible place where you&#039;d want to put your input buffer (resb BUFSIZ).<br /><br />Please don&#039;t write &quot;gets()&quot;! Write &quot;ngets()&quot;. Don&#039;t allow a &quot;user&quot; - even if it&#039;s you - to overflow your buffer. Look at how int 21h/0Ah works. Or WriteFile, or sys_write. They all demand that the caller specify a maximum number of bytes to accept. I&#039;m sorry to be a &quot;nut-case&quot; about this, but it really annoys me that every time (unnamed company) releases a new version of their OS, new &quot;exploits&quot; are found. I suppose it would be high praise if &quot;attackerz&quot; went after your OS, but don&#039;t let &#039;em succeed! No &quot;gets()&quot;! Please! <br /><br />A little-known(?) feature of Nasm is the ability to produce map files in &quot;-f bin&quot; mode. Normally, it&#039;s the linker that produces a map file, but since in &quot;-f bin&quot; mode, Nasm acts as its own linker (to the limited extent of putting &quot;.data&quot; after &quot;.text&quot;, etc - there are othe options - RTFM), it can produce a map file. Normally, it&#039;s a command line option to the linker, but since it only applies to &quot;-f bin&quot;, it has been made a directive. &quot;&quot; (anywhere in your source code) will cause Nasm to blab everything it knows about what went where into the named file. Can be useful solving problems if you and Nasm have different opinions about where things are supposed to be.<br /><br />Oh yeah, I wanted to mention: if you want to have labels without colons, and not have Nasm complain about it, &quot;-w-orphan-labels&quot; will shut it up.<br /><br />Just noticed this:<br /><br /><pre><code><br />OEMLabel&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; db &quot;LEAFOS&quot;&nbsp; ; Disk label - 8 chars<br /></code></pre><br /><br />You probably want that padded (spaces or zeros... or?) so it really is 8 bytes...<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2010-05-28 20:02:16 by fbkotler</div>
   </div>
  </div>
 </body>
</html>