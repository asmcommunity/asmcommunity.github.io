<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Completely INSANE bug in MASM?! - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10157" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=10157">Completely INSANE bug in MASM?!</a></p>
   <div class="post" id="post-76094">
    <div class="subject"><a href="#post-76094">Completely INSANE bug in MASM?!</a></div>
    <div class="body">Ok, I'm going completely out of my mind here...<br /><br />I have found what appears to be a completely crazy bug in MASM (if it's not in MASM, it's either in bitRAKE's macro, or in my brain (most likely :)), but I can't find anything wrong with any of them ;)).<br /><br /><br />Here follows a simple example, demonstrating the bug:<br /><br />I'm using the following simple macro by bitRAKE (taken from the &quot;sniplets&quot; box of RadASM):<br /><br /><pre><code><br />@ArgI MACRO index&#58;REQ, args&#58;VARARG<br />;; Macro function returns an argument specified by number from a VARARG list.<br />;; Params&#58; index - one-based number of the argument to be returned<br />;;          args - argument list<br />    LOCAL arg,y,yStr<br />    y = 0<br />    FOR arg,&lt;&amp;args&gt;<br />        y = y + 1<br />        IF y EQ index<br />            yStr TEXTEQU &lt;arg&gt;<br />            EXITM ;; Exit FOR loop<br />        ENDIF<br />    ENDM<br />    EXITM yStr<br />ENDM<br /></code></pre><br /><br />I also have made the following very simple macro myself, that reproduces the bug:<br /><br /><pre><code><br />global_list TEXTEQU &lt;first_entry&gt;   ; This is a global comma-separated list,<br />                                    ; initialized with one string.<br /><br />; This macro adds the second parameter to the<br />; global comma-separated list<br />ADD_SECOND_ARG_TO_LIST  MACRO new_strings&#58;VARARG<br />%   ECHO List contents &#40;1&#41;&#58; global_list<br />    current_entry TEXTEQU @ArgI&#40;2, new_strings&#41;   ; Saving second arg in variable<br />%   ECHO List contents &#40;2&#41;&#58; global_list<br />%   ECHO Added string&#58; current_entry<br />    global_list CATSTR global_list, &lt;, current_entry&gt;   ; Adding string to list<br />%   ECHO List contents &#40;3&#41;&#58; global_list<br />ENDM</code></pre><br /><br />It really only contains 2 lines, the rest is just debug-text that will help showing the bug.<br /><br /><br />Finally, the very simple program using this macro looks like this:<br /><br /><pre><code><br />    ECHO ### Call 1 ###<br />    ADD_SECOND_ARG_TO_LIST &lt;ignored_string&gt;, &lt;added_string_1&gt;<br />    ECHO ### Call 2 ###<br />    ADD_SECOND_ARG_TO_LIST &lt;ignored_string&gt;, &lt;added_string_2&gt;<br /></code></pre><br /><br /><br />When compiling this, the expected compiler debug output should, according to my understanding, be the following:<br /><br /><pre><code><br />### Call 1 ###<br />List contents &#40;1&#41;&#58; first_entry<br />List contents &#40;2&#41;&#58; first_entry<br />Added string&#58; added_string_1<br />List contents &#40;3&#41;&#58; first_entry, added_string_1<br />### Call 2 ###<br />List contents &#40;1&#41;&#58; first_entry, added_string_1<br />List contents &#40;2&#41;&#58; first_entry, added_string_1<br />Added string&#58; added_string_2<br />List contents &#40;3&#41;&#58; first_entry, added_string_1, added_string_2<br /></code></pre><br /><br />But instead I get this:<br /><br /><pre><code><br />### Call 1 ###<br />List contents &#40;1&#41;&#58; first_entry<br />List contents &#40;2&#41;&#58; first_entry<br />Added string&#58; added_string_1<br />List contents &#40;3&#41;&#58; first_entry, added_string_1<br />### Call 2 ###<br />List contents &#40;1&#41;&#58; first_entry, added_string_1<br />List contents &#40;2&#41;&#58; first_entry, added_string_2      &lt;--- What the f***?!?<br />Added string&#58; added_string_2<br />List contents &#40;3&#41;&#58; first_entry, added_string_2, added_string_2      &lt;---<br /></code></pre><br /><br />After it has extracted the second argument from the macro VARARG parameter with the @ArgI macro, the contents of <strong>the global list</strong> has all of a sudden changed from <em>&lt;first_entry, added_string_1&gt;</em> to <em>&lt;first_entry, added_string_2&gt;</em>, and it was not even referenced in that line!?! This in turn messes up the final list to be <em>&lt;first_entry, added_string_2, added_string_2&gt;</em> instead of the desired <em>&lt;first_entry, added_string_1, added_string_2&gt;</em>. :(<br /><br /><br />So, does anyone here have the slightest clue about why this happens? Is this a bug in MASM, or is it just me being completely blind and stupid? Does it behave differently in anyone else's MASM-compiler here?<br /><br />Any ideas whatsoever would be <strong>greatly</strong> appreciated.<br /><br />Thanks!</div>
    <div class="meta">Posted on 2003-01-13 17:12:24 by dELTA</div>
   </div>
   <div class="post" id="post-76115">
    <div class="subject"><a href="#post-76115">Re: Completely INSANE bug in MASM?!</a></div>
    <div class="body"><div class="quote"><em>Originally posted by dELTA </em><br /><pre><code><br />global_list TEXTEQU &lt;first_entry&gt;   ; This is a global comma-separated list,<br />                                    ; initialized with one string.<br /><br />; This macro adds the second parameter to the<br />; global comma-separated list<br />ADD_SECOND_ARG_TO_LIST  MACRO new_strings&#58;VARARG<br />%   ECHO List contents &#40;1&#41;&#58; global_list<br />    current_entry TEXTEQU @ArgI&#40;2, new_strings&#41;   ; Saving second arg in variable<br />%   ECHO List contents &#40;2&#41;&#58; global_list<br />%   ECHO Added string&#58; current_entry<br />    global_list CATSTR global_list, &#91;color=red&#93;&#91;b&#93;&lt;, &gt;, current_entry&#91;/b&#93;&#91;/color&#93;   ; Adding string to list<br />%   ECHO List contents &#40;3&#41;&#58; global_list<br />ENDM</code></pre><br /><br />It really only contains 2 lines, the rest is just debug-text that will help showing the bug.<br /><br /><br />Finally, the very simple program using this macro looks like this:<br /><br /><pre><code><br />    ECHO ### Call 1 ###<br />    ADD_SECOND_ARG_TO_LIST &lt;ignored_string&gt;, &lt;added_string_1&gt;<br />    ECHO ### Call 2 ###<br />    ADD_SECOND_ARG_TO_LIST &lt;ignored_string&gt;, &lt;added_string_2&gt;<br /></code></pre><br /><br />... (the final output)...<br /><br /><pre><code>&#91;color=red&#93;Microsoft &#40;R&#41; Macro Assembler Version 6.14.8444<br />Copyright &#40;C&#41; Microsoft Corp 1981-1997.  All rights reserved.<br /><br /> Assembling&#58; D&#58;\masm32\_ACTIVE\elec\elec.asm<br />### Call 1 ###<br />List contents &#40;1&#41;&#58; first_entry<br />List contents &#40;2&#41;&#58; first_entry<br />Added string&#58; added_string_1<br />List contents &#40;3&#41;&#58; first_entry, added_string_1<br />### Call 2 ###<br />List contents &#40;1&#41;&#58; first_entry, added_string_1<br />List contents &#40;2&#41;&#58; first_entry, added_string_1<br />Added string&#58; added_string_2<br />List contents &#40;3&#41;&#58; first_entry, added_string_1, added_string_2<br />Microsoft &#40;R&#41; Incremental Linker Version 5.12.8078<br />Copyright &#40;C&#41; Microsoft Corp 1992-1998. All rights reserved.&#91;/color&#93;<br /></code></pre><br /></div><br />Never doubt the machine ;)<br />(( One day i swore that Microchip blew a batch of microchips and i had boughten a completely bad set of PIC chips..  of course i later realized it was just me, high on solder fumes and lack of sleep ;) ))<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2003-01-13 19:34:42 by NaN</div>
   </div>
   <div class="post" id="post-76125">
    <div class="subject"><a href="#post-76125">Completely INSANE bug in MASM?!</a></div>
    <div class="body"><strong>Thanks NaN!</strong> :)<br /><br />Ha ha, holy crap the kind of effects you can get with code that can perform string operations on its own variable names during execution, and has scope-less delay of symbol evaluation. :tongue:<br /><br />I have to admit it took a moment to understand why I got that effect even after you pointed out the exact erroneous line. :)<br /><br />To anyone reading this, for a good laugh I can really recommend you to try to understand the exact chain of events that followed from my little typo, and finally resulted in the behavior described in my original post. :alright: <br /><br />Thanks again NaN!</div>
    <div class="meta">Posted on 2003-01-13 20:24:12 by dELTA</div>
   </div>
   <div class="post" id="post-76130">
    <div class="subject"><a href="#post-76130">Completely INSANE bug in MASM?!</a></div>
    <div class="body">Glad you got it, cause i didnt want to explain that one ;) .  Heck your description of the problem alone is a mouth-full ;) :<div class="quote">Ha ha, holy crap the kind of effects you can get with code that can perform string operations on its own variable names during execution, and has scope-less delay of symbol evaluation. </div></div>
    <div class="meta">Posted on 2003-01-13 20:38:32 by NaN</div>
   </div>
   <div class="post" id="post-76169">
    <div class="subject"><a href="#post-76169">Completely INSANE bug in MASM?!</a></div>
    <div class="body">dELTA,<br /><br />Don't believe what he says, it IS really a wicked plot by Bill Gates and his cronies at Microsoft to drive you nutz so you end up giving up and buying a copy of Office at retail prices. :grin: <br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a><br /><br />-------------------<br />CEO Microsoft<br /><br />Dear Bill,<br /><br />I am really NOT happy about the number of bugz you have deliberately introduced into the free release of ML.EXE just to personally drive me mad.<br /><br />I seriously think you should change this policy so that i do not end up writing code in Visual Basic.</div>
    <div class="meta">Posted on 2003-01-13 23:30:54 by hutch--</div>
   </div>
   <div class="post" id="post-76233">
    <div class="subject"><a href="#post-76233">Completely INSANE bug in MASM?!</a></div>
    <div class="body">Hutch, I just have to say that I find your attitude towards reporting bugs in free software a bit childish.<br /><br />In this case I even wrote that the fault was most likely in my brain, but in earlier cases when I have really found bugs or at least limitations in MASM, it has been the exact same thing.<br /><br />Every time someone even remotely insinuates that there might be a bug in the MASM compiler, you come rushing with one of your sarcastic and quite ridiculous &quot;CEO Microsoft&quot; posts (even though it was slightly more jokingly in this instance, although not really when seen in the light of your earlier posts).<br /><br />So, shouldn't one be able to report bugs for free software? Is that your opinion? Won't the authors of free software appreciate bug reports (I know I do)? And is there maybe a separate commercial version of MASM?<br /><br />Also, I'm relatively sure that the CEO of Microsoft (which is not Bill Gates for that matter) has better things to do than to process bug reports, so I'm quite convinced they have QA-personnel for that.<br /><br />Sincerely,<br />dELTA</div>
    <div class="meta">Posted on 2003-01-14 06:57:41 by dELTA</div>
   </div>
   <div class="post" id="post-76240">
    <div class="subject"><a href="#post-76240">Completely INSANE bug in MASM?!</a></div>
    <div class="body">OOO! It's getting Hot in Here!<br /><br />Take it easy dELTA.  I'm sure Hutch was only joking around.<br />After all he's one of the main guys behind the MASM32 package.<br />A person doesn't put all that effort into something and then trashes  it because of a little criticism!<br /><br />He's progably a M$I (micro$oft spy) agent trying to cover his tracks after getting us hooked on MASM!  I smell a conspiracy!:eek:<br /><br />Martial_Code: The Conspiracy Theorist</div>
    <div class="meta">Posted on 2003-01-14 07:47:48 by MArtial_Code</div>
   </div>
   <div class="post" id="post-76244">
    <div class="subject"><a href="#post-76244">Completely INSANE bug in MASM?!</a></div>
    <div class="body">MArtial_Code, the MASM32 package and the MASM compiler are two different projects, with completely different developers.<br /><br />As I said, I have gotten this kind of posts from hutch several times before, and all I meant is that I neither appreciate them, nor find them productive or meaningful. I don't want to flame anyone at all, my whole point is obviously about <strong>not</strong> flaming people.</div>
    <div class="meta">Posted on 2003-01-14 08:18:20 by dELTA</div>
   </div>
   <div class="post" id="post-76397">
    <div class="subject"><a href="#post-76397">Completely INSANE bug in MASM?!</a></div>
    <div class="body">dELTA,<br /><br />The lesson to learn is not claim to be the judge of a softare product (M$ MASM) without knowing enough about it. As a matter of fact MASM has been known to have a few bugs in it here and there but it never stopped hundreds of thousands of people from writing successful code in it. I am right about the user number as a matter of fact.<br /><br />What I suggest to you is that the bug is usually in the user, you, and that makes you like the rest of us, BUG creators, not assembler/compiler critics.<br /><br />I have for years seen people whinging about bugs in a particular assembler/compiler and almost exclusively, the bugs are in the user, does your opinion make you any different ?<br /><br />Now I am sure that the current CEO of Microsoft which I think from memory is Steve Ballmer would be more than willing to pass on your criticism to the organisation's founder, Bill Gates and on the sheer weight of you opinion he will modify hius organisation's approach to assembler design.<br /><br />Now like I said before, start the letter like this,<br /><br />Dear Bill,<br /><br />I am not happy with the repeated failures of your freeware assembler to live up to my expectations and perform in the way I think it should. etc ....<br /><br />Muhahahaha,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-01-15 02:10:32 by hutch--</div>
   </div>
  </div>
 </body>
</html>