<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Animated SkinMesh under D3D - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=24515" />
    <link rel="next" href="../?id=24515&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=24515">Animated SkinMesh under D3D</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=24515&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=24515&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="24515" /><input type="number" name="page" min="1" max="4" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=24515&amp;page=2">&gt;</a><a href="../?id=24515&amp;page=4">&raquo;</a></form>   <div class="post" id="post-178995">
    <div class="subject"><a href="#post-178995">Animated SkinMesh under D3D</a></div>
    <div class="body">Six attempts over three years, but finally, IT WORKS !!<br />I&#39;m currently having a play around with &#39;character classes&#39; and more advanced skinmesh animation topics such as weight-blending multiple animations, but if you are sick of waiting, just ask and I&#39;ll post a binary demo and full source in its current state :)<br /><br /></div>
    <div class="meta">Posted on 2006-04-03 01:55:10 by Homer</div>
   </div>
   <div class="post" id="post-178997">
    <div class="subject"><a href="#post-178997">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">Congraduations mate, and you KNOW I&#39;ve been waiting to see a demo :&gt;</div>
    <div class="meta">Posted on 2006-04-03 01:59:19 by Synfire</div>
   </div>
   <div class="post" id="post-179006">
    <div class="subject"><a href="#post-179006">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">Hi man<br />We are all waiting for your demo!&nbsp; :P<br /><br />Biterider</div>
    <div class="meta">Posted on 2006-04-03 04:29:57 by Biterider</div>
   </div>
   <div class="post" id="post-179059">
    <div class="subject"><a href="#post-179059">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">Hi Homer,<br /><br />What an achievement! You persisted, and won! Congratulations.<br /><br />I&#39;m can&#39;t wait to see the results of your great work.<br />So, please expose the binary and the source to the world.<br /><br />Friendly regards,<br />mdevries</div>
    <div class="meta">Posted on 2006-04-03 15:46:52 by mdevries</div>
   </div>
   <div class="post" id="post-179119">
    <div class="subject"><a href="#post-179119">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">OK don&#39;t get too excited - its just a start :)<br /><br />- the framework is not robust<br />- the gui controls are not implemented, so you can&#39;t change animations<br />- theres no camera controls<br />- the demo only loads tiny.x, you can&#39;t choose another file<br />- due to the board&#39;s file size limit, you&#39;ll have to supply tiny.x yourself<br />- you&#39;ll have to mess with the paths of includefiles if you wanna rebuild it.<br /><br />Please let me know if theres any problems :)<br /></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=1526" target="_blank">DXSkinMesh.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2006-04-04 10:13:40 by Homer</div>
   </div>
   <div class="post" id="post-179164">
    <div class="subject"><a href="#post-179164">Re: Animated SkinMesh under D3D</a></div>
    <div class="body"><br />I&#39;d like to start an informal discussion of the sourcecode with those who are interested, so I&#39;ll begin by describing some of the framework as it stands.<br /><br />The first class I want to discuss is CModel.<br />This class is responsible for loading,animating and rendering a model.<br />The entrypoint method is called LoadXFile.<br />This method is mostly a wrapper for a call to a DX api function called D3DXLoadMeshHierarchyFromX, which in turn requires from us a pointer to a small callback interface called ID3DXAllocateHierarchy.<br /><br />Thats right - D3DXLoadMeshHierarchyFromX does not do all the work - it requires us to provide four methods for creating and destroying Frame and Mesh container objects.<br /><br />So together, CModel and ID3DXAllocateHierarchy look after all the Loading, as well as setting up some linear arrays to aid animation. Loading the model correctly is about 40 percent of the work involved in implementing animated skinmeshes :)<br /><br />You have the sourcecode in your hot little hands already. Any questions?<br /></div>
    <div class="meta">Posted on 2006-04-05 09:34:57 by Homer</div>
   </div>
   <div class="post" id="post-179181">
    <div class="subject"><a href="#post-179181">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">Hi Homer,<br /><br />The first thing I tried was building the project.<br />Ofcourse I had to change some include file paths<br />But I also had to remove the colon in line 41 in CModel.inc before I could build the project.<br /><br /><pre><code>	StaticMethod Update, REAL8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Was :REAL8</code></pre><br /><br />Are you able to build the project without removing the colon in line 41?<br /><br />Friendly regards,<br />mdevries.</div>
    <div class="meta">Posted on 2006-04-05 16:35:58 by mdevries</div>
   </div>
   <div class="post" id="post-179193">
    <div class="subject"><a href="#post-179193">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">Yes I can, but my OA32 has been slightly modified by myself over time, and that most likely explains why.. interesting :)<br /><br />Continuing my rant from yesterday..<br /><br />ID3DXAllocateHierarchy (callback interface for the meshloader api)<br />There&#39;s four Methods in here.<br />CreateFrame<br />CreateMeshContainer<br />DestroyFrame<br />DestroyMeshContainer.<br /><br />The last two are just for cleaning up resources.<br />CreateFrame method allocates a Frame struct, its not so interesting.<br />CreateMeshContainer allocates a MeshContainer struct and then proceeds to fill its fields via a bunch of input params.. it&nbsp; allocates and copies material info,loads Textures,and it sets up arrays of matrices for animating the mesh.<br />We generally don&#39;t call any of these methods ourself.. we&#39;re just propping up the D3DXLoadMeshHierarchyFromX api (its our opportunity to extend the structs if we wanna).<br /><br />I&#39;m expecting some questions soon.<br />Meanwhile, work continues on code to help with animation blending.<br /><br /><br /></div>
    <div class="meta">Posted on 2006-04-06 02:54:10 by Homer</div>
   </div>
   <div class="post" id="post-179196">
    <div class="subject"><a href="#post-179196">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">Today I wrote a new Method for the CModel class called &quot;SetTrackTransitionKey&quot;.<br />While doing so, I discovered some errors in one of the DX9 includes !!!<br />The file is D3DX9Anim.inc<br />The interface is ID3DXAnimationController<br />The CORRECTION is <div class="quote">&nbsp; STDMETHOD KeyTrackSpeed,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword, dword, real8,real8,dword<br />&nbsp; STDMETHOD KeyTrackWeight,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword, dword, real8,real8,dword<br />&nbsp; STDMETHOD KeyTrackPosition,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword, real8,real8<br />&nbsp; STDMETHOD KeyTrackEnable,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword, dword, real8<br />&nbsp; STDMETHOD KeyPriorityBlend,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword, real8,real8<br /></div><br /><br />Have a nice day :)<br /></div>
    <div class="meta">Posted on 2006-04-06 05:50:52 by Homer</div>
   </div>
   <div class="post" id="post-179198">
    <div class="subject"><a href="#post-179198">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">Corrected. Thanks.<br /><br />Biterider</div>
    <div class="meta">Posted on 2006-04-06 06:47:32 by Biterider</div>
   </div>
   <div class="post" id="post-179250">
    <div class="subject"><a href="#post-179250">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">Forgive the chaotic nature of this post, it is a reflection of my state of mind.<br />I spent a day thinking instead of coding..<br /><br />I&#39;m going to modify or scrap the new Method I wrote which sets up a transition from track A to track B (one track fades out, and the other fades in simultaneously)<br />It&#39;s based closely on one of the methods from Tiny.cpp used to smoothly transition eg from &quot;walking&quot; to &quot;jogging&quot;.<br /><br />It&#39;s a clue to the solution I desire, but it&#39;s heading in the wrong direction.<br />You see, I had been distracted by sourcecode which shows how it is possible to &quot;clone the animationcontroller we obtained when we loaded a skinmesh&quot; in order to create as many AnimationTracks as we want, &quot;so we can have spare tracks for doing transitions&quot;.<br /><br />When we load a SkinMesh,&nbsp; we receive an AnimationController with N AnimationTracks (where N is equal to the number of AnimationSets) and are not able to create any more without using the Cloning trick described above. I suspect that each of the AnimationTracks are preset to each of the AnimationSets, but if not, we can do it..<br />My point is that if we want to transition from one AnimationSet to another, we can do so with the existing Tracks, without needing &quot;spare tracks&quot; at all. And if we want to play a blend of every possible AnimationSet at once, we can do it (by enabling all tracks). It&#39;s not absolutely necessary to write a manager for AnimationTracks :)<br /><br />With this in mind, we can define all kinds of complex &quot;animation combos&quot; by thinking of the whole set of AnimationTracks as a &quot;state machine&quot;, and by declaring each &quot;animation combo&quot; as a description of the state of all the animation tracks :)<br /><br />If we display the entire set of AnimationTracks in a gui control, its fairly easy for the User to create any number of &quot;animation combos&quot; and save them off to a datafile :)<br /><br />Now, can anyone recommend/offer source for a nice propertysheet/spreadsheet/custom listview style of control for runtime editing of the animation track table?</div>
    <div class="meta">Posted on 2006-04-07 04:36:25 by Homer</div>
   </div>
   <div class="post" id="post-179290">
    <div class="subject"><a href="#post-179290">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">Today:<br />I added a System Menu to the GUI, and set up some Load and Unload menuitems.<br />You can now select any xfile to open.<br /><br />I fixed an &quot;intermittent bug&quot; within ID3DXAllocateHierarchy&nbsp; (it only happened sometimes.. due to a register being trashed).<br /><br />I added a ListView control to the GUI, which displays all the AnimationTracks and their settings, and a handful of smaller controls for altering the settings of the selected track.<br />The ListView content is rebuilt whenever we Load a skinmesh.<br /><br />Does anyone want to donate a model with several animations?</div>
    <div class="meta">Posted on 2006-04-07 23:37:54 by Homer</div>
   </div>
   <div class="post" id="post-179300">
    <div class="subject"><a href="#post-179300">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">Since I feel confident about the pending implementation of blended animations, I spent this evening researching the implementation of &quot;RagDoll Physics&quot; with respect to my existing framework (ie, modern skinmesh-based ragdolls as opposed to classic multipartite systems). I have to say that it was quite interesting reading... my eyes have been opened (:shock:), it was well worth the time spent !!!<br /><br />For those who are interested in checking out some cool advanced stuff (very well written and a joy to read), here&#39;s a link:<br />http://talha.zabvision.edu.pk/Game%20Programming/AdamsAdvancedAnimationwithDirectX/J.Adams%20-%20Advanced%20Animation%20with%20DirectX.pdf<br /><br />It just so happens that I spent some time working on an ODE physics project not too long ago, so it&#39;s not such an impossible dream to implement the same kind of system described in the aforementioned document...&nbsp; :D<br /><br />What I have in mind :<br />1 - Ability to switch from Animated mode to RagDoll mode when character dies or is falling.<br />2 - Ability to disable one or more limbs of Animated character (which flop about uselessly).<br />3 - Ability to disable one or more limbs of Animated character (limb is being controlled by the user).<br /><br />Sound like fun? :)</div>
    <div class="meta">Posted on 2006-04-08 07:39:05 by Homer</div>
   </div>
   <div class="post" id="post-179337">
    <div class="subject"><a href="#post-179337">Re: Animated SkinMesh under D3D</a></div>
    <div class="body"><br />In order to implement RagDoll physics I&#39;ll need to &quot;create a Doll from my model&quot;.<br />Basically I need to create a BoundingBox for each Bone.<br />The orientation of each box is that of the Bone it encompasses.<br />To be more precise, for each Bone, find the set of vertices affected by this Bone, and find the boundingbox of the set of affected vertices. Then expand the box to include its connection points with other Bones if necessary.<br />It makes a heck of a lot of sense to me to add an option to the Loader to perform this step within ID3DXAllocateHierarchy, here&#39;s why:<br />One of the things that ID3DXAllocateHierarchy does is create an array of pointers to &quot;bone offset matrices&quot;. IE, for each Bone, we obtain a ptr to that bone&#39;s offset matrix, and store all the pointers in an array.<br />It just so happens that in order to build our &#39;boneboxes&#39;, for each Bone, we need to obtain the bone offset matrix in order to transform the affected vertices from modelspace into bonespace (a requirement).<br />We may as well calculate each &quot;bonebox&quot; during this loop in ID3DXAllocateHierarchy :)<br />The cost is that my ID3DXAllocateHierarchy implementation becomes dependant on CModel, the FRAME struct is extended to include a boundingbox, and a bool switch is added to CModel&#39;s Init method to choose whether to prepare RagDoll stuff..<br /><br />What&#39;s your opinion?<br />Should CModel support RagDoll mode implicitly, so we don&#39;t need CRagDoll?<br />Should CRagDoll inherit from CModel instead, so that ID3DXAllocateHierarchy remains independant from CModel?<br />Perhaps you have a better idea?<br /></div>
    <div class="meta">Posted on 2006-04-09 02:27:03 by Homer</div>
   </div>
   <div class="post" id="post-179345">
    <div class="subject"><a href="#post-179345">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">I&#39;ve decided to make a new class called CRagDoll which derives from CModel.<br />Here&#39;s a sneak preview of how I am spending my time :)<br /><br />I&#39;m extending the CModel class to support RagDoll physics.<br />The attachment shows how I intend to attach physics information to the BoneFrames, and how I intend to work with a hierarchy of Bone-oriented boundingboxes for my RagDoll physics.<br />It contains code for attaching the extension struct and for calculating the &quot;BoneBoxes&quot;.<br /><br />As for the animation blending stuff, it will be implemented in CModel as originally intended.</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=1544" target="_blank">CRagDoll.inc</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2006-04-09 08:13:59 by Homer</div>
   </div>
   <div class="post" id="post-179347">
    <div class="subject"><a href="#post-179347">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">Here&#39;s how it works:<br /><br />A model starts in &quot;Animated&quot; mode.<br />It&#39;s wandering happily along when suddenly (think of a reason) it dies, and in doing so, switches from &quot;Animated&quot; mode to &quot;RagDoll&quot; mode.<br />At this point, we need to initialize our Physics state to reflect the orientation of the Bones at the moment of death.<br />From now on, we&#39;ll be controlling the matCombined matrices in the BoneFrames : they will become outputs for the bonebox physics. The physics engine will drive the matCombined fields of the BoneFrames, and rendering will be as usual.<br /><br />An alternative/extension idea is to have the &quot;Mode&quot; flag on each Bone, meaning that we could &quot;disable a model&#39;s wounded arm&quot; so it flops about :)<br /><br /></div>
    <div class="meta">Posted on 2006-04-09 09:08:16 by Homer</div>
   </div>
   <div class="post" id="post-179367">
    <div class="subject"><a href="#post-179367">Towards implementing RagDoll on top of CModel..</a></div>
    <div class="body">STAGE 1 : EXTEND OUR BONEFRAME STRUCTURE<br /><br />The very first thing that I did was further extend our FRAME struct to include a new field.<br /><pre><code>;Our extended D3DXFRAME struct<br />FRAME struct<br />;D3DXFRAME members<br />	Base D3DXFRAME &lt;&gt;<br />;Extra stuff<br />	matCombined D3DXMATRIX &lt;&gt;;Combined Frame Matrix<br />	pRagDollBone dd ? ;Optional : RagDoll physics data<br />FRAME ends</code></pre><br /><br />The addition of one 32bit pointer isn&#39;t very expensive for implementations that don&#39;t require RagDoll support, but it&#39;s quite a powerful tool for us, because it actually points to another allocated struct, RagDollBone, which contains all kinds of per-bone data for the physics simulation.<br /><br />Don&#39;t worry too much about all these fields, I don&#39;t want this thread to turn into a discussion on ODE physics (yet?)..<br /><pre><code>RagDollBone struct<br />; Frame that this bone is connected to<br />	m_Frame dd ?<br />; Mass and 1/Mass (one-over-mass)<br />	m_Mass REAL4 ?<br />; Coefficient of restitution value<br />; 0 = no bounce<br />; 1 = &#39;super&#39; bounce<br />; &gt;1 = gain power in bounce<br />	m_Coefficient REAL4 ?<br />	m_ParentBone dd ?;Pointer to parent BoneFrame<br />	; Connection-to-parent offset and parent-to-bone offset<br />	m_vecJointOffset Vec3 &lt;&gt;<br />	m_vecParentOffset Vec3 &lt;&gt;<br />	; Size of BoneBox<br />	m_vecBBSize Vec3 &lt;&gt;<br />	<br />; Linear force and angular momentum<br />	m_vecForce Vec3 &lt;&gt;<br />	m_vecTorque Vec3 &lt;&gt;<br />; Original orientation of bone<br />	m_quatOrientation D3DXQUATERNION &lt;&gt;<br />; Rate of resolution (0-1) to resolve slerp interpolation<br />; This is used to make bones return to their initial<br />; orientation relative to its parent.<br />	m_ResolutionRate REAL4 ?<br />; Body&#39;s inverse moment of inertia tensor matrix<br />	m_matInvInertiaTensor D3DXMATRIX &lt;&gt;<br />; Points (in body space) that form bounding box<br />; and connection-to-parent offset position<br />	m_vecPoints Vec3 9 dup (&lt;&gt;)<br />; Bone state<br />	m_State RagDollBoneState &lt;&gt;<br />RagDollBone ends</code></pre><br /><br />That last field is an embedded struct, RagDollBoneState. Again, don&#39;t fret about this struct, I am only including it here to complete the picture..<br /><pre><code>;This struct describes the Physics state<br />;of a Bone, its BoundingBox, etc<br />RagDollBoneState struct<br />	m_vecPosition				Vec3 &lt;&gt;	;&nbsp; Position<br />	m_vecAngularMomentum		Vec3 &lt;&gt;	;&nbsp; Angular momentum<br />	m_vecLinearVelocity&nbsp; 		Vec3 &lt;&gt;	;&nbsp; Linear velocity<br />	m_vecAngularVelocity 		Vec3 &lt;&gt;	;&nbsp; Angular velocity<br />	m_quatOrientation D3DXQUATERNION &lt;&gt;	;&nbsp; Orientation<br />	m_matOrientation&nbsp; D3DXMATRIX&nbsp; &nbsp;  &lt;&gt;	;&nbsp; Orientation<br />; Transformed points, including connection-to-parent<br />; position and parent-to-bone offset<br />	m_vecPoints Vec3 10 dup (&lt;&gt;)<br />RagDollBoneState ends</code></pre><br /><br />OK, so we&#39;re extending the FRAME struct by adding a pointer to a blob of data that contains all that crap I just posted.. This is only relevant to &quot;Frames which represent Bones&quot;, so there&#39;s likely to be one or two Frames that won&#39;t need extending.<br /><br />Now, the next thing I did immediately is add a line to ID3DXAllocateHierarchy::DestroyFrame method, which deallocates our per-Frame pRagDollBone extension if it exists,&nbsp; so that garbage collection of our extension structs is automatic.<br /><br /></div>
    <div class="meta">Posted on 2006-04-10 01:56:20 by Homer</div>
   </div>
   <div class="post" id="post-179368">
    <div class="subject"><a href="#post-179368">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">STAGE 2 : EXTEND OUR LOADER<br /><br />This posting will interest those of you who are not very familiar with OOP.<br /><br />I needed a way to apply my extension to the bone-representative Frames in CModel..but I didn&#39;t want to mess up CModel with non-essential stuff.<br />I decided to use a little oop magic so that I could have it both ways :)<br /><br />Next thing on the agenda was to begin implementing a CRagDoll class, which derives from (inherits) the CModel class.<br />The first method I wrote for the CRagDoll class was a new LoadXFile method.<br />It doesn&#39;t replace the one in CModel, it enhances it.<br />Check it out :)<br /><br /><pre><code>;Overloaded version of LoadXFile<br />;We load the model, then we set up the physics<br />Method CRagDoll.LoadXFile,uses esi,pstrFile<br />	SetObject esi<br />	;First, perform a standard CModel.LoadXFile call<br />	ACall esi.LoadXFile,pstrFile<br />	push eax ;Preserve retval<br />	;Now, setup physics information in the BoneFrames<br />	OCall BuildBonePhysics,.m_pFrameRoot,NULL<br />	pop eax ;Restore retval<br />MethodEnd</code></pre><br /><br />In CRagDoll&#39;s class definition, I used &quot;RedefineMethod LoadXFile,Pointer&quot;<br /><br />ACall is &quot;AncestorCall&quot; - it means &quot;call a named method in the class from which the current class is derived&quot;.. Since CRagDoll derives from CModel, the ACall is referring to a method in CModel, not a method in CRagDoll.. clear as mud?<br /><br />So, looking at the new LoadXFile method,&nbsp; it&#39;s really doing two things.<br />Firstly it ACalls the old CModel version of LoadXFile, then it OCalls a new method in CRagDoll called BuildBonePhysics.. which doesn&#39;t exist yet.<br /><br />Just looking at the OCall, more experienced coders will sense that it&#39;s probably a recursive function entrypoint, since it has two parameters, one of them being a node struct (pFrame) and the other being initially NULL (likely used to pass data between recursion depths)<br /><br />This is indeed the case.<br />The first parameter is used as a nodepointer to walk the frame hierarchy, and the second parameter is used to track the Parent of the current node (root&#39;s parent is NULL).<br /><br />In order to extend the BoneFrames, we need to walk the entire frame hierarchy, looking for BoneFrames.. that&#39;s a recursive job, so we use a recursive method (BuildBonePhysics).<br /><br />BuildBonePhysics does more than just extend the BoneFrames for physics though, its also responsible for calculating a BoundingBox for each Bone, as outlined previously.<br /><br />I&#39;m not showing you BuildBonePhysics today.<br /><br />The last thing I did was to replace all the references to CModel in the main ASM file with references to CRagDoll.<br />Even though CRagDoll is just an infant with bugger all Methods, we mustn&#39;t forget that it inherits everything that CModel has - all the functionality, all the data fields. <br />You might say &quot;any calls to methods that we did not OverRide (like we did to LoadXFile) fall through to the Ancestor class&quot; (although its not really implemented that way..)<br /><br />So, excepting LoadXFile, all our CModel methods are available within CRagDoll.<br />CRagDoll enhances CModel :)<br /><br />Can I have some feedback please?<br />Am I going too fast? Have I dumbed it down too much? Is this stuff too weird? etc..</div>
    <div class="meta">Posted on 2006-04-10 02:36:12 by Homer</div>
   </div>
   <div class="post" id="post-179376">
    <div class="subject"><a href="#post-179376">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">Just keep going, Homer - lack of feedback might be because you&#39;re mixing a load of non-trivial topic; OOP, D3D, Bone physics etc. Quite a mouthful to swallow for many.<br /><br />Don&#39;t dumb things down, though. If you want more feedback, I guess you should start a somewhat simpler side-project :)</div>
    <div class="meta">Posted on 2006-04-10 05:08:00 by f0dder</div>
   </div>
   <div class="post" id="post-179380">
    <div class="subject"><a href="#post-179380">Re: Animated SkinMesh under D3D</a></div>
    <div class="body">STAGE 3 - BuildBonePhysics<br /><br />I admit it, I haven&#39;t completed this Method yet.<br />I&#39;m not filling all the fields yet.. I skipped ahead to work on a few of the physics-related methods in CRagDoll..<br />But I&#39;ll outline what happens in BuildBonePhysics anyway.<br /><br />It&#39;s a recursive function. The first thing it does is check its pFrame parameter as to whether the Frame has a name.. only BoneFrames are named in our hierarchy, so if the Frame is named, its a BoneFrame.<br />Having detected a BoneFrame, a call is made to a method called ExtendFrame, which allocates a new RagDollBone struct and stores its ptr in Frame.pRagDollBone,<br />then a call is made to a method called GetBoneBoundingBoxSize which calculates the BoundingBox of a Bone&#39;s vertices and attachmentpoints.<br />My current code fails to initialize all the other fields in the RagDollBone struct.<br />At the end of the method is code to walk the sibling and child frames, and thats all folks.<br /><br />Heh, so now I guess I&#39;ll have to show you the ExtendFrame and GetBoneBoundingBoxSize methods :)<br />With all the code mentioned so far put together, we&#39;re in a position to initialize everything we need to play with dolls like girly men .. all that&#39;s missing (aside from the aforementioned new methods) is the actual physics code, right? Pretty much :)<br />I&#39;ve already made a good start on that stuff, as I mentioned, but I&#39;m far from satisfied.<br />Right now I&#39;m using euler integration and a variable timestep (like my reference material) but I might later change/add to this a fixed-step Runge-Kutta integrator.. we&#39;ll see :)<br /><br />As I was saying, once I post the new methods, we have enough code to surround our animated thingy in a series of boxes.. it&#39;d be a good time to add code to render the boxes as lines during animation playback, and then clean up the codebase before proceeding.<br /><br />The next step after that is to implement the physics code, add code for collision detection between bodyparts that are not neighbours (what I think is the bare minimum for a ragdoll demo) and then add some clever tools to the gui to allow the user to apply forces to the demo model (so it can slap itself silly), and then regroup (cleanup and review) again.<br /><br />Somewhere inbetween I&#39;ll finish implementing the animation blender controls..<br /><br /><br /></div>
    <div class="meta">Posted on 2006-04-10 09:05:13 by Homer</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=24515&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=24515&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="24515" /><input type="number" name="page" min="1" max="4" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=24515&amp;page=2">&gt;</a><a href="../?id=24515&amp;page=4">&raquo;</a></form>  </div>
 </body>
</html>