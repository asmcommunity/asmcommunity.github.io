<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>rand - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29792" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=29792">rand</a></p>
   <div class="post" id="post-210422">
    <div class="subject"><a href="#post-210422">rand</a></div>
    <div class="body">hey everyone, i thought i would post this rand i recently wrote because i was having troubles finding one that fit my needs.<br />any tips on optimization would be appreciated <br /><br /><pre><code><br />mov esi, offset buffer &nbsp; &nbsp; &nbsp; &nbsp;;buffer for rand output<br />mov edi, 500000d &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;size in bytes<br />mov ebx, 49282048h &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; ;seed<br />add edi, esi<br />xor ecx, ecx<br /><br />@@:<br />rdtsc<br />rol eax, 5<br />lea eax,<br />shr eax, 3<br />ror edx, 3<br />lea edx,<br />rol edx, 7<br />or eax, edx<br />add eax, esi<br />add cl, al<br />ror cl, 3<br />rol eax, cl<br />xor cl, al<br />add cl, ah<br />rol eax, cl<br />lea eax, <br />xor eax, ebx<br />mov cl, bh<br />mov ch, bl<br />ror cx, cl<br />rol ax, cl<br />ror eax, 15<br />lea eax, <br />and ecx, ebx<br />ror eax, cl<br />mov , eax<br />rdtsc<br />mov ebx, eax<br />lea ebx, <br />lea ecx, <br />rol ebx, cl<br />lea ebx, <br />ror cx, cl<br />ror ebx, cl<br />add esi, 4<br />cmp edi, esi<br />jl @B<br /></code></pre><br /><br />1gb of data generated by this rand, tested with ent: <br /><br />Entropy = 8.000000 bits per byte.<br /><br />Optimum compression would reduce the size<br />of this 1073741824 byte file by 0 percent.<br /><br />Chi square distribution for 1073741824 samples is 268.19, and randomly<br />would exceed this value 50.00 percent of the times.<br /><br />Arithmetic mean value of data bytes is 127.4989 (127.5 = random).<br />Monte Carlo value for Pi is 3.141590272 (error 0.00 percent).<br />Serial correlation coefficient is 0.000092 (totally uncorrelated = 0.0).<br /></div>
    <div class="meta">Posted on 2010-01-27 12:53:20 by paradox</div>
   </div>
   <div class="post" id="post-210435">
    <div class="subject"><a href="#post-210435">Re: rand</a></div>
    <div class="body">Looks like a simple variation of Park-Miller, which is not a very good random generator.<br />Using spatial analysis of the numeric keyspace, I determined that Park-Miller generates &#039;clusters&#039; of values, ie, does not have a very good &#039;spread&#039; across the numerical domain.<br />My response was to take Mersenne Twister (B) and Park-Miller, and introduce feedback between the two algorithms. I have not discovered a RNG which has a better &#039;spread&#039; than this combination, and that was some years ago now.<br />I am not convinced that Chi-Square is a good measure of numerical distribution of a RNG.<br />N-Dimensional visualisation of the raw output is perhaps a better gauge.<br />Except for the rdtsc instruction, I would recommend MMX optimizing.<br />What is your intended purpose? That&#039;s the crucial question.<br /></div>
    <div class="meta">Posted on 2010-01-28 02:11:39 by Homer</div>
   </div>
   <div class="post" id="post-210444">
    <div class="subject"><a href="#post-210444">Re: rand</a></div>
    <div class="body">homer, i originally wrote it to generate a set of 1gb files so i could compare the speed of a few sorting algorithms</div>
    <div class="meta">Posted on 2010-01-28 06:23:01 by paradox</div>
   </div>
   <div class="post" id="post-210445">
    <div class="subject"><a href="#post-210445">Re: rand</a></div>
    <div class="body">For me, I wanted a RNG which was guaranteed to produce the same numerical sequence , given the same initial seed, as my purpose was a 4096-bit custom block cypher for 8 bit data based loosely on Vignere&#039;s cypher.<br />The rdtsc opcode is somewhat unreliable without a wait, but it is not unpredictable.<br />Your output receives regular &#039;jitter&#039; from the use of this opcode which makes the output appear more random than it actually is... in effect, your algorithm is more complex than it first appears to be, which is good!<br /></div>
    <div class="meta">Posted on 2010-01-28 06:39:25 by Homer</div>
   </div>
  </div>
 </body>
</html>