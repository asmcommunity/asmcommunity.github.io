<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Qustion a bout Tray icon - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30628" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=30628">Qustion a bout Tray icon</a></p>
   <div class="post" id="post-214823">
    <div class="subject"><a href="#post-214823">Qustion a bout Tray icon</a></div>
    <div class="body"><div class="quote"><br />Note: Beware of two annoying behaviors when you use a popup menu with a tray icon: <br />After calling SetForegroundWindow, you will find that the first time the popup menu is displayed, it works ok but on the subsequent times, the popup menu will show up and close immediately. This behavior is &quot;intentional&quot;, to quote from MSDN. The task switch to the program that is the owner of the tray icon in the near future is necessary. You can force this task switch by posting any message to the window of the program. Just use PostMessage, not SendMessage! </div><br /><br />this is some words in iczelion&#039;s toturial about tray icon.he say after TrackPopupMenu,we should use&nbsp; invoke PostMessage,hWnd,WM_NULL,0,0 ,but without this ,it also work well.i want to know why?<br />his code like this:<br /><div class="quote"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if lParam==WM_RBUTTONDOWN <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke GetCursorPos,addr pt <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SetForegroundWindow,hWnd <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke TrackPopupMenu,hPopupMenu,TPM_RIGHTALIGN,pt.x,pt.y,NULL,hWnd,NULL <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;invoke PostMessage,hWnd,WM_NULL,0,0  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .elseif lParam==WM_LBUTTONDBLCLK <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage,hWnd,WM_COMMAND,IDM_RESTORE,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .endif <br /></div><br /><br /></div>
    <div class="meta">Posted on 2011-08-06 00:45:14 by geegle</div>
   </div>
   <div class="post" id="post-214824">
    <div class="subject"><a href="#post-214824">Re: Qustion a bout Tray icon</a></div>
    <div class="body">I don&#039;t know :shrug: but according to <a target="_blank" href="http://msdn.microsoft.com/en-us/library/ms648002(v=vs.85).aspx">MSDN</a> that&#039;s the way to do it. Maybe it&#039;s some kind of odd behavior for an older version of Windows?</div>
    <div class="meta">Posted on 2011-08-06 13:06:59 by JimmyClif</div>
   </div>
   <div class="post" id="post-214825">
    <div class="subject"><a href="#post-214825">Re: Qustion a bout Tray icon</a></div>
    <div class="body">I dug out some of my old code and a message to myself stated:<br /><br /><pre><code><br />// There&#039;s a &quot;bug&quot; (Microsoft calls it a feature) in Windows 95 that<br />// requires calling SetForegroundWindow. To find out more, search<br />// for Q135788 in MSDN.<br /></code></pre><br /><br />So yes, it&#039;s old behavior although I can&#039;t say if it&#039;s ever been fixed yet...<br /></div>
    <div class="meta">Posted on 2011-08-06 19:25:30 by p1ranha</div>
   </div>
   <div class="post" id="post-214828">
    <div class="subject"><a href="#post-214828">Re: Qustion a bout Tray icon</a></div>
    <div class="body"><a target="_blank" href="http://support.microsoft.com/kb/135788">Here&#039;s the relevant article</a></div>
    <div class="meta">Posted on 2011-08-07 09:19:15 by ti_mo_n</div>
   </div>
  </div>
 </body>
</html>