<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Need Help Converting C Function Prototypes to ASM equivalent - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3081" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=3081">Need Help Converting C Function Prototypes to ASM equivalent</a></p>
   <div class="post" id="post-20194">
    <div class="subject"><a href="#post-20194">Need Help Converting C Function Prototypes to ASM equivalent</a></div>
    <div class="body">Hi Everyone<br /><br />I wonder if anyone can help me <br />First<br /><br />Did I convert this right from C to ASM<br /><br />typedef struct {<br />    char *name;<br />    char *val;<br />} entry;<br /><br />entry struct<br />name DWORD ?<br />val  DWORD ?<br />entry ends<br /><br />And these one I wish I knew how to convert to ASM<br /><br />char *makeword(char *line, char stop);<br /><br />This FILE *f,  seems extra troublesome<br /><br />char *fmakeword(FILE *f, char stop, int *len);<br />char x2c(char *what);<br />void unescape_url(char *url);<br />void plustospace(char *str);<br /><br /><br />Just guesing would <br />void plustospace(char *str);<br />plustospace proto C : PTR BYTE<br /><br />Anyway the goal of all this help is to<br />To Call some functions in C, to use for breaking form posts<br />into an Structure Array, I have the C functions a library that can be called from my ASM program.<br />Of course the battle is not over till this<br />cl = atoi(getenv(&quot;CONTENT_LENGTH&quot;));<br /><br /><br />ForLoop is broken down<br /><br />    for(x=0;cl &amp;&amp; (!feof(stdin));x++) {<br />        m=x;<br />        entries.val = fmakeword(stdin,'&amp;',&amp;cl);<br />        plustospace(entries.val);<br />        unescape_url(entries.val);<br />        entries.name = makeword(entries.val,'=');<br />    }<br /><br />If I suceed it'll be Cool, Then I can see if I can convert the C<br />functions into ASM functions and drop 50k off my program<br /><br />Thanks Andy!</div>
    <div class="meta">Posted on 2002-01-20 20:12:43 by andy981</div>
   </div>
   <div class="post" id="post-20198">
    <div class="subject"><a href="#post-20198">Need Help Converting C Function Prototypes to ASM equivalent</a></div>
    <div class="body">I like these posts, its the only way im able to &quot;maintain&quot; any memory of C :)<br /><br /><br />entry struct <br />name DWORD ? <br />val DWORD ? <br />entry ends <br />...<strong> This is correct!</strong><br /><br />char *makeword(char *line, char stop); <br /><br />...I could be wrong, but this is a FUNCTION that returns a pointer to a character string (the &quot;word&quot;), that is extracted from another pointer to a line of text (char *line), and using the &quot;stop&quot; char as the character to separate with. <br /><br />If im right with my assumptions here, then you would do this as:<br /><br /><pre><code>makeword PROTO &#58;DWORD, &#58;BYTE<br /><br />makeword PROC lpLine&#58;DWORD, stop&#58;BYTE<br />  ....<br />  &#91; code &#93;<br />  ....<br />  mov eax, lpMadeWord<br />  ret<br />makeword ENDP</code></pre><br /><br />This FILE *f, seems extra troublesome  ; <strong>this is C jibberish!<br />Why i dont like using it anymore!</strong><br />You can more or less forget this crap in MASM...<br /><br /><strong>char *fmakeword(FILE *f, char stop, int *len); </strong><br /><br />This is now pretty much like the one above, except that you ALSO pass a pointer to an open file that contains the text to &quot;make a word&quot; from, as well as a length. <br /><br />In MASM, you need to open a file handle via, CreateFile.  Check out Iczelion's tutorials (in this section at the top) numbers 12, and 13 on file access.  Once you have this done, the FILE HANDLE can be thought of as the &quot;*f&quot; in the C statement &quot;FILE *f&quot;.  Remember that handles are just DWORD's so your proto for this would be:<br /><br /><strong>fmakeword PROTO :DWORD, :CHAR, :DWORD</strong><br /><br />char x2c(char *what); <br />void unescape_url(char *url); <br />void plustospace(char *str); <br /><br />Theses look like you dont quite like Pointers :)  All of these statements require a pointer in their function parameters.  In MASM, any TYPE of pointer is always considered a DWORD!  Its up to you to treat the 32bit info AS a pointer!!  So your proto/proc's would like wise have a :DWORD in their place.  The preceeding &quot;char&quot; and &quot;void&quot;'s are also up to you to place in EAX before leaving (as all returns is &quot;practiced&quot; to be in EAX, or AX, or AL)<br /><br />Just guesing would <br />void plustospace(char *str); <br />plustospace proto C : PTR BYTE <br /><br /><strong>Yup, this &quot;should&quot; work.  I dont practice the PTR BYTE stuff, i would just place a :DWORD (for reasons said earlier).  But in all fairness, this would be the better practice.</strong><br /><br />Anyway the goal of all this help is to <br />To Call some functions in C, to use for breaking form posts <br />into an Structure Array, I have the C functions a library that can be called from my ASM program. <br />Of course the battle is not over till this <br />cl = atoi(getenv(&quot;CONTENT_LENGTH&quot;)); <br /><br /><strong>.. umm ok, good luck!  There is often some real issues between C and MASM (mainly the type of C compiler/linker). But i dont know more than this</strong><br /><br />ForLoop is broken down <br /><br />for(x=0;cl &amp;&amp; (!feof(stdin));x++) { <br />m=x; <br />entries.val = fmakeword(stdin,'&amp;',&amp;cl); <br />plustospace(entries.val); <br />unescape_url(entries.val); <br />entries.name = makeword(entries.val,'='); <br />} <br /><br />If I suceed it'll be Cool, Then I can see if I can convert the C <br />functions into ASM functions and drop 50k off my program <br /><br /><strong>.. heh, more fun to come!  (( I really dont miss reading that ))</strong><br /><br /><br />-------------<br />Well theres my help... Enjoy, and good luck.<br />NaN</div>
    <div class="meta">Posted on 2002-01-20 22:03:43 by NaN</div>
   </div>
   <div class="post" id="post-20203">
    <div class="subject"><a href="#post-20203">Thanks NaN</a></div>
    <div class="body">Your Great! NaN<br /><br />I was just about to post this<br />not to waste it<br /><br /><div class="quote"><em><strong><br />Do they look properly converted<br /><br /><br />char *makeword(char *line, char stop);<br />char *fmakeword(FILE *f, char stop, int *len);<br />char x2c(char *what);<br />void unescape_url(char *url);<br />void plustospace(char *sstr);<br /><br />I figure that if * is in front of something even a char<br />it's a dword<br /><br />makeword proto C, line:PTR DWORD, stop:BYTE<br />fmakeword proto C, f:PTR FILE,stop:BYTE,len:PTR DWORD<br />x2c proto C, what:PTR DWORD<br />unescape_url proto C,url:PTR DWORD<br />plustospace proto C, sstr:PTR DWORD<br /></em></div>[<br />But I follow your advice,  <br /><br />The real hard part if I get there is that forloop to see if everything <br />does work!<br /><br />I really Thank You for the Help!<br /><br />Andy981!<br /><br />:)</div>
    <div class="meta">Posted on 2002-01-20 22:37:28 by andy981</div>
   </div>
   <div class="post" id="post-20206">
    <div class="subject"><a href="#post-20206">Do you have a Visual C++ Compliler NaN</a></div>
    <div class="body">Just curious do you have a Visual C++ compliler?<br /><br />Actually the functions of those protos are calling are written in C,<br />but I have them in library made by my VC compliler being called<br />in an ASM file assemble in Hutch's Masm32. And that lib<br />I threw in the folder lib of my Masm32 directory<br />The proto's are in an include file<br /><br /><br />Andy981!</div>
    <div class="meta">Posted on 2002-01-20 22:54:43 by andy981</div>
   </div>
   <div class="post" id="post-20216">
    <div class="subject"><a href="#post-20216">Need Help Converting C Function Prototypes to ASM equivalent</a></div>
    <div class="body">Ya I have VC++ 5.  But it might as well be a plant holder for me :)<br /><br />If i remember correctly, you can link VC and MASM with out probs (as long as you keep STDCALL and C proto as your doing).   But other &quot;C&quot; versions like Borland have a different Obj format.  (If your currious trigger f0dder or Hutch's intersts on this issue, they are walking archieves of such info :P )<br /><br />NaN</div>
    <div class="meta">Posted on 2002-01-21 00:04:36 by NaN</div>
   </div>
  </div>
 </body>
</html>