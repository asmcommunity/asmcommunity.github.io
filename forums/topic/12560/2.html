<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Question about how to get kernel - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=12560" />
  <link rel="prev" href="../?id=12560&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=12560">Question about how to get kernel</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=12560&amp;page=1" style="">&laquo;</a><a href="../?id=12560&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="12560" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-97464">
    <div class="subject"><a href="#post-97464">Question about how to get kernel</a></div>
    <div class="body">Bugs' Bounty HunterBugs' Bounty Hunter,<br /><strong>&quot;Hi lingo. Do you have also code to emulate GetProcAddress?&quot;</strong><br /><br />Yes, I have<br /><br />My GetProcAddress is speed optimized (PIII) and more complicated<br />then Axial's code, because I use binary search algo to resolve<br />addresses of all functions from all dll's which I use in my windows programs<br /><br />It is faster then original MS algo and allow me to start my windows programs faster<br />because in my import directory I have only one function (for W2k,XP compatibility)<br /><br />I can post the code but I don't want to bother ppl like Vortex<br />My optimized code makes him go mad<br />You can see proof here:<br /><br />&quot;Lingo,<br />Are you enough brave to tell us the source of your algo?<br />I think, it doesn't belong to you.&quot;<br /><a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?threadid=12560&amp;perpage=15&amp;pagenumber=1">http://www.asmcommunity.net/board/showthread.php?threadid=12560&amp;perpage=15&amp;pagenumber=1</a><br /><br />here: &quot;lingo,you fool,why should I need speed optimisation for such a short code?&quot;<br /><a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?threadid=1883&amp;highlight=Vortex">http://www.asmcommunity.net/board/showthread.php?threadid=1883&amp;highlight=Vortex</a><br /><br />and here:<br /><br />&quot;Now,look at here lingo kid,<br />Instead of studying C run-time DLLs,you are wasting your time by doing stupid<br />things.Your genius application contains only one section.This is your main trick.<br />Now,little kid,prove that you are a REAL MAN:tell us what is your problem with me?&quot;<br /><a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?threadid=12496">http://www.asmcommunity.net/board/showthread.php?threadid=12496</a><br /><br />Where is the moderator?<br /><br />So, just use Axial's code, it is sample and size optimized.<br /><br />Regards,<br />Lingo</div>
    <div class="meta">Posted on 2003-04-17 07:19:38 by lingo12</div>
   </div>
   <div class="post" id="post-97472">
    <div class="subject"><a href="#post-97472">Question about how to get kernel</a></div>
    <div class="body">Lingo kid,<br /><br />Now,pay a little attention here:First of all,you are unable to answer my<br />questions.<br /><br />Second:Your optimised codes contains also mistakes,read the post of bitRAKE.<br /><br />Third:Nobody is gealous of you,we have really very very experienced coders (+talented)<br />in the board.You know them.<br />What I am curious is your strange words which demonstrates bad<br />intention.What's your reason? What does mean &quot;garbage&quot; for you?<br /><br />Four:I expect to see here a REAL man such you who will reply me moderately.<br /><br />If you continue to play the monkey,that's your problem.<br /><br />Now,try to show your personnality higher than your skills.<br />Don't try to hide behind the moderators. :)<br /><br />That's all.<br /><br />Vortex</div>
    <div class="meta">Posted on 2003-04-17 08:05:27 by Vortex</div>
   </div>
   <div class="post" id="post-97475">
    <div class="subject"><a href="#post-97475">Question about how to get kernel</a></div>
    <div class="body">Okay, boys don't bicker over some misunderstandings and leave the playground fights out of the forums *PS: Don't come back wtih injuries... <br /><br />I think you all are straying from the topic. pazuluo wanted to know why 0f800h was used in the snipplet and no one have yet to answer his question.</div>
    <div class="meta">Posted on 2003-04-17 08:12:52 by roticv</div>
   </div>
   <div class="post" id="post-97477">
    <div class="subject"><a href="#post-97477">Question about how to get kernel</a></div>
    <div class="body">Roticv,<br /><br />That's O.K,you are right;but I don't let myself to be attacked by that person.<br />What wrong I made him? I try to help a little my friends here.Optimised<br />codes are O.K when they are necessary.Sometimes,non-optimised codes makes<br />easier to understand some coding tricks.Why to make a contest?<br /><br />Regards,<br /><br />Vortex</div>
    <div class="meta">Posted on 2003-04-17 08:22:15 by Vortex</div>
   </div>
   <div class="post" id="post-97488">
    <div class="subject"><a href="#post-97488">Question about how to get kernel</a></div>
    <div class="body">Just take it that both of you have opposing views and chill it. Forgive and forget. :alright:</div>
    <div class="meta">Posted on 2003-04-17 09:15:35 by roticv</div>
   </div>
   <div class="post" id="post-97490">
    <div class="subject"><a href="#post-97490">Question about how to get kernel</a></div>
    <div class="body">I agree with you Roticv,if everyone would be peaceful as you:alright:</div>
    <div class="meta">Posted on 2003-04-17 09:24:41 by Vortex</div>
   </div>
   <div class="post" id="post-97494">
    <div class="subject"><a href="#post-97494">Question about how to get kernel</a></div>
    <div class="body">hi all,<br /><br />I'm so sorry to see the injuries here, coz it's not my original intention...:( :(  Sorry for it, please stop.:) <br /><br />BTW, my question still hasn't been solved, could anybody help for the 0f800h?<br /><br />I want to thank you all above! :):)</div>
    <div class="meta">Posted on 2003-04-17 10:01:35 by pazuluo</div>
   </div>
   <div class="post" id="post-97511">
    <div class="subject"><a href="#post-97511">Question about how to get kernel</a></div>
    <div class="body">-- Editted to keep things simple and clear --<br /><br />Sliver</div>
    <div class="meta">Posted on 2003-04-17 12:10:41 by Sliver</div>
   </div>
   <div class="post" id="post-97512">
    <div class="subject"><a href="#post-97512">Question about how to get kernel</a></div>
    <div class="body">Like I said I think it is the address of the default (dummy) code segment. I could be wrong but it seems to make sense.</div>
    <div class="meta">Posted on 2003-04-17 12:12:44 by donkey</div>
   </div>
   <div class="post" id="post-97544">
    <div class="subject"><a href="#post-97544">Question about how to get kernel</a></div>
    <div class="body">I am happy that we can communicate in such an open and free manner.  The maturity of the group is demonstrated by the individual respect given to each member and the understanding that not only are we different but the programming situations themselves are varied - requiring different specific solutions.  It is wonderful that we can see the positive and negitive value of each piece of code without resulting in personal attacks.  Although we may put much of ourselves into our work, we are separate from it. :)</div>
    <div class="meta">Posted on 2003-04-17 17:10:11 by bitRAKE</div>
   </div>
   <div class="post" id="post-97690">
    <div class="subject"><a href="#post-97690">Question about how to get kernel</a></div>
    <div class="body">The &quot;test for weirdvalue&quot; in the original algorithm is probably to avoid antiviral heuristics. It makes more sense to do it &quot;the right way&quot;.<br /><br /><br /><div class="quote"><br />It is faster then original MS algo and allow me to start my windows programs faster<br />because in my import directory I have only one function (for W2k,XP compatibility)<br /></div><br />Hah, as if you would be able to notice any speed difference. Silly statement. Does your proc handle forwarded exports?</div>
    <div class="meta">Posted on 2003-04-18 07:40:41 by f0dder</div>
   </div>
   <div class="post" id="post-97800">
    <div class="subject"><a href="#post-97800">Question about how to get kernel</a></div>
    <div class="body">bitRAKE,<br />I'm happy too, with my new boat...<br /><br /><br />pazuluo,<br /><strong>&quot;BTW, my question still hasn't been solved, could anybody help for the 0f800h?&quot;</strong><br /><br /><strong>test dx, 0F800h</strong> is equal to<br /><br /><strong>cmp dx, 800h</strong><br /><strong>jae  LoopAgain</strong> <br /><br />It is just a filter to cut off all values greater then 00080000h, i.e.<br />the pointer to PE header 'e_lfanew' (which is 32 bits<br />long beginning at byte offset 60) of Kernel32.dll must be:<br />reg DX&lt;800h, else loop again.<br /><br />If you have all PE offsets of all Kernel32.dll of all Windows OS<br />you can get the biggest offset (for instance 200 0000h) and change<br />in DX register F800h with F200h,<br />i.e. test dx,0F200h or cmp dx,200h /jae LoopAgain) and <br />your algo will work just fine.<br /><br />I believe that the author has found out the value  800h with debugger. Why?<br />Because in PE files this value has no limit, i.e.may be greater<br />then 800h. Why?<br />Because this value is a pointer for a place somewhere (PE header) AFTER DOS_Stub<br />and here is MSDN:<div class="quote"><br /><br />&quot;Visual C++ Linker Options<br /> <br />STUB (MS-DOS Stub File Name)<br />STUB:filename<br /><br />where: <br /><br />filename<br />An MS-DOS application.<br /><br />Remarks<br /><br />The STUB option attaches an MS-DOS stub program to a Win32 program.<br /><br />A stub program is invoked if the file is executed in MS-DOS. It usually displays an appropriate message; <strong><br />however, any valid MS-DOS application can be a stub program.</strong> <br />.....&quot;</div><br />i.e. <strong>any valid MS-DOS application can be a stub program</strong>, hence<br />DOS STUB may be greater then 800h and if so,  the pointer to PE header will be<br />greater than  800h too. <br /><br />I rewrote the algo:<pre><code> <br /><br />		mov	eax, &#91;esp&#93;		; Return address of call to CreateProcess	<br />		and	eax, 0FFFF1000h         ; the last four are zeros because<br />LoopAgain&#58;					; Kernel32.dll is memory 64 aligned<br />  		mov	edx, &#91;eax+3Ch-1000h&#93;    ; the pointer is 32 bits by definition	<br />	 	sub	eax, 1000h		; rather then dec eax!!!<br />  		;test	edx, 0FFFFF800h         ; you can try with 0FFFFF200h too<br />	 	;jnz	LoopAgain		; <br />		cmp	edx, 800h               ; you can try with 200h too<br />		jae	LoopAgain		<br />  		cmp	eax, &#91;eax+edx+34h&#93;	<br />	 	jnz	LoopAgain</code></pre><br /><br />Regards,<br />Lingo</div>
    <div class="meta">Posted on 2003-04-18 17:41:07 by lingo12</div>
   </div>
   <div class="post" id="post-97846">
    <div class="subject"><a href="#post-97846">Question about how to get kernel</a></div>
    <div class="body">Thank you very much, lingo12!!!!!! :grin: :grin: :grin: <br /><br />I love this forum! :tongue: :tongue:</div>
    <div class="meta">Posted on 2003-04-18 22:38:07 by pazuluo</div>
   </div>
   <div class="post" id="post-108366">
    <div class="subject"><a href="#post-108366">Question about how to get kernel</a></div>
    <div class="body">lingo12, I want to use your algo.  Which one is the best and fastest the first one with out the loop or the one you rewrote.<br /><br />Also can you post your GetProAddr if you got one for just regurlar 486 and small P500 and under.<br /><br />Thanks in advance</div>
    <div class="meta">Posted on 2003-06-26 19:25:45 by cmax</div>
   </div>
   <div class="post" id="post-108380">
    <div class="subject"><a href="#post-108380">Question about how to get kernel</a></div>
    <div class="body"><strong>cmax,</strong><br />&quot;Also can you post your GetProAddr&quot;<br /><br />imho the thread is closed...<br />&quot;Hah, as if you would be able to notice any speed difference. Silly statement.<br />Does your proc handle forwarded exports?&quot;  by f0dder<br /><br />First tell someone that he is silly and <strong>after</strong> that ask him how he is doing the job...Funny isn't it?<br />He can't imagine someone to know how to:<br />-  look for imported modules <strong>without</strong> LdrpCheckForLoadedDll<br />- &quot;recognize&quot; forwarded API (for ex.HeapAlloc)<br />- search <strong>without</strong> LdrpSnapThunk and LdrpNameToOrdinal and imitate LdrpGetProcedureAddress etc.<br />- investigate every API that DLL imports from other DLLs in order to calculate a real address<br />and/or load additional DLLs and check to see if an API may have been forwarded on to another<br />procedure housed in another DLL<br />- bypass the address calculation and forwarded API processing with binding but<br /><strong>without</strong> using Bind.exe (see SDK for more info) etc...<br /><br />I spent 3 weeks in writing and testing and I'm not so silly to post my code here...sorry<br /><br />My advice to you is to try the fastest method (imho)<br />Just create two programs work.exe and setup.exe<br />With your setup.exe (you don't need speed here) you should:<br />- create and/or patch your work.exe program<br />- calculate all used API addresses by standard method and write them into work.exe<br />- optimize your work.exe for type of CPU, OS, protection, etc<br />Your work.exe will be the fastest and if the user changes the OS he/she must restart the setup.exe again <br /><br /><br />&quot;Which one is the best and fastest the first one with out the loop or the one you rewrote.&quot;<br /><br />First one without the loop. I rewrote the second algo just to answer pazuluo's question. <br /><br />Regards,<br />Lingo</div>
    <div class="meta">Posted on 2003-06-26 22:36:06 by lingo12</div>
   </div>
   <div class="post" id="post-108406">
    <div class="subject"><a href="#post-108406">Question about how to get kernel</a></div>
    <div class="body">Thanks  lingo12 <br /> <br />And sorry about bringing up old dirt.  I do remember when most of the guys here were more concerned about speed and saving even a byte.  And they live for that ... and that only ...<br /><br />Even though i was a super newbee it was a thrill to read some of what you guys were doings.<br /><br />Those were the days :)</div>
    <div class="meta">Posted on 2003-06-27 02:34:35 by cmax</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=12560&amp;page=1" style="">&laquo;</a><a href="../?id=12560&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="12560" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>