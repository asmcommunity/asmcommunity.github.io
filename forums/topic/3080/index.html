<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Dockable Bars - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3080" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=3080">Dockable Bars</a></p>
   <div class="post" id="post-20188">
    <div class="subject"><a href="#post-20188">Dockable Bars</a></div>
    <div class="body">Anyone have any experience with creating dockable windows?<br /><br />I want to have a dockable dialog window that has a treeview control on it. I would like the window to be able to resize while its docked and while its floating.  I basically want something similar to MFC's CDialogBar, but with alot LESS problems!! Plus the CDialogBar doesn't resize while docked and without special overrides wont even support anything other than buttons<br /><br />Where would I start to create something like this?<br /><br />And also, when you click on a window thats dockable, you get an empty frame appear that you drag around... How do you make something like that? Basically the same thing when you move a window when you have Show Contents While Dragging turned off.  Have never been able to figure that one out.<br /><br />thanx guys</div>
    <div class="meta">Posted on 2002-01-20 19:10:58 by Rockinronstar</div>
   </div>
   <div class="post" id="post-20197">
    <div class="subject"><a href="#post-20197">Dockable Bars</a></div>
    <div class="body">Well here is a hearty start.. But dont thank me, <strong>KetilO</strong> put the hard work into getting things working!<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-01-20 21:37:43 by NaN</div>
   </div>
   <div class="post" id="post-20199">
    <div class="subject"><a href="#post-20199">Dockable Bars</a></div>
    <div class="body">thanx NaN, I'll check this out. Gona take me a while though - still pretty new to PC Asm coding. Slowly learning.  Do you know the theory of Docking Windows? How to make the drag box appear and move it instead of the window?<br /><br />I think once I figure out how to get this box to appear and move with the cursor and also how to determine when it intersects a &quot;dockable&quot; area then the rest should be a matter of adjusting window styles and window pos/sizes.<br /><br />well, hope thats it, lol<br /><br />thanx</div>
    <div class="meta">Posted on 2002-01-20 22:05:27 by Rockinronstar</div>
   </div>
   <div class="post" id="post-20200">
    <div class="subject"><a href="#post-20200">Dockable Bars</a></div>
    <div class="body">Nope, not too much on the Theory, but you got the &quot;rosetta stone&quot; before you!<br /><br />Just go thu the code, find the various API calls, and then hit the <a target="_blank" href="http://search.microsoft.com/us/dev/default.asp">MSDN Serach</a> for the translation to your questions. :)<br /><br />(( Bring a Note Pad, and write a tut when your done for all us dummies :grin: ))<br /><br />Have fun..<br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-01-20 22:16:35 by NaN</div>
   </div>
   <div class="post" id="post-20201">
    <div class="subject"><a href="#post-20201">Dockable Bars</a></div>
    <div class="body">actually that might be a good idea. (Tut). I find this is one area(docking) that doesn't get much attention. Wish it did, since it is such a nice feature to provide to your users. Its even expected now-a-days.  <br /><br />The only docking you got is what MFC provides with its CControlBar derived classes. And in my opinion they are a mess. Very hard to use and there isn't any documentation out there on how to use them properly. <br /><br />If I get a tutorial up and running , well when I figure this crap out myself, I will have to do it in C++/MFC/API style since this is what I know best. Then maybe someone here who knows MFC and ASM well enough can translate the code into an ASM source or lib for everyone here to use. <br /><br />Ah, forgot to check the one place that may have something on this subject, Icz's tutorials. Watch him already have written a tutorial on this exact thing.<br />lol<br />:stupid:</div>
    <div class="meta">Posted on 2002-01-20 22:25:52 by Rockinronstar</div>
   </div>
   <div class="post" id="post-20202">
    <div class="subject"><a href="#post-20202">Dockable Bars</a></div>
    <div class="body">nope, Iczelion didn't write one, whew! The feel like an idiot feeling is subsiding <br />:cool:</div>
    <div class="meta">Posted on 2002-01-20 22:28:01 by Rockinronstar</div>
   </div>
   <div class="post" id="post-20350">
    <div class="subject"><a href="#post-20350">Dockable Bars</a></div>
    <div class="body">I once played around with docking windows. I was pretty happy with my results, except I did not get toolbars to work nicely with them, plus a slew of minor issues from activation captions to simplistic docking logic (you can pick which side, but now where a dockling window goes).<br /><br />Everything was packed up inside a dll to make reuseability easy and simple. While I intended to let the dll be freeware, I'm not releasing the source.<br /><br />But I'm always open to questions.<br /><br /><a target="_blank" href="http://ourworld.compuserve.com/homepages/ernies_world/tooltab.zip">Get my docker</a></div>
    <div class="meta">Posted on 2002-01-21 22:05:53 by Ernie</div>
   </div>
   <div class="post" id="post-20486">
    <div class="subject"><a href="#post-20486">Dockable Bars</a></div>
    <div class="body">Hey Ernie, not a bad little dock manager.  A little buggy with the docking logic, but nevertheless, well done. I especially like the VS style when its docked look<br /><br />I am also working on a docking system as well. I am in the process of crashing the machine all the time, haha.  My main problem is how to get the drag box window to come under control of the mouse when you click the dock window Non Client Area.  I am not even quite sure if I am on the right path or not.<br /><br />What I do is when you click on the NC part of the dockable window I create another window that I override the EraseBkgnd and in the NCPaint I draw a simple rect around the border of the window.  I then wanted to transfer the capture to this window and take it from the dockable window you clicked on. This is where I am stumped, the window usually crashes my system when I try a force of the LButtonUp on the dock window and a LButtonDown on the drag box window. Does this sound like the right place to start?<br /><br /><br />thanx</div>
    <div class="meta">Posted on 2002-01-22 17:02:41 by Rockinronstar</div>
   </div>
   <div class="post" id="post-20507">
    <div class="subject"><a href="#post-20507">Dockable Bars</a></div>
    <div class="body">I tried a similar approach once, and got the same results.<br /><br />Crash crash crash. I don't understand why either.<br /><br />So I did a search for stuff, found a technique in a back issue of WDJ mag (or something, I bought the archive CD) and came up with a method that works.<br /><br />It's a bit of work using PatBlt to draw a thick line (which is a rectangle) with a black and white dithered to grey bitmap xor-ed onto the desktop. (Huh? well, follow the code if you want to see).<br /><br />The routine also remembers the last drawn rectangle and first 'undraws' it. Undrawing with an xor brush just means draw it again.<br /><br /><pre><code><br />ropXNor 			EQU     000a50065H<br />BadRect			EQU     -1<br /><br />.data<br />LastRect			RECT   &#123; &#125;<br />rgwBits      		DWORD	0AAAA5555H<br />			DWORD	0AAAA5555H<br />			DWORD	0AAAA5555H<br />			DWORD	0AAAA5555H<br /><br />.code<br />;-------------------------------------------------------------------------------<br />DrawGhost  PROC  pRect&#58;DWORD<br />; draws the drag rect for tooltabs<br />	LOCAL dwWidth&#58;DWORD, 	dwHeight&#58;DWORD<br />	LOCAL dxBdr&#58;DWORD, 		dyBdr&#58;DWORD<br />	LOCAL hdc&#58;DWORD, 		hbrsDither&#58;DWORD<br />	LOCAL rc&#58;RECT<br />    LOCAL oldBrush&#58;DWORD, 	hBmp&#58;DWORD<br /><br />	.IF !pRect <br />		.IF LastRect.left == BadRect<br />			; taint nothin to do here<br />			ret<br />		.ENDIF<br />	.ENDIF<br /><br />	invoke GetDC, NULL		; desktop screen DC<br />	mov hdc, eax<br />	invoke CreateBitmap, 8, 8, 1, 1, ADDR rgwBits<br />	mov hBmp, eax<br />	invoke CreatePatternBrush, hBmp<br />	mov hbrsDither, eax<br />	invoke SetBrushOrgEx, hdc, 0, 0, NULL<br />	invoke SelectObject, hdc, hbrsDither<br />	mov oldBrush, eax<br /><br /><br />	invoke GetSystemMetrics, SM_CXFRAME<br />	mov dxBdr, eax<br />	invoke GetSystemMetrics, SM_CYFRAME<br />	mov dyBdr, eax<br /><br /><br />	.IF LastRect.left != BadRect<br />		mov ecx, OFFSET LastRect<br />		mov eax, &#91;ecx&#93;.RECT.right<br />		mov rc.right, eax<br />		mov edx, &#91;ecx&#93;.RECT.left<br />		mov rc.left, edx<br />		sub eax, edx<br />		mov dwWidth, eax<br /><br />		mov eax, &#91;ecx&#93;.RECT.bottom <br />		mov rc.bottom, eax<br />		mov edx, &#91;ecx&#93;.RECT.top<br />		mov rc.top, edx<br />		sub eax, edx<br />		mov dwHeight, eax<br /><br />		invoke PatBlt, hdc, rc.left, rc.top, dwWidth, dyBdr,    ropXNor<br />		mov edx, rc.bottom<br />		sub edx, dyBdr<br />		invoke PatBlt, hdc, rc.left, edx, 	 dwWidth, dyBdr,    ropXNor<br />		mov eax, dwHeight<br />		sub eax, 2<br />		imul eax, dxBdr     ;dy - 2 * dxBdr<br />		mov eax, dyBdr<br />		sub dwHeight, eax<br />		sub dwHeight, eax<br />		mov eax, dyBdr<br />		add rc.top, eax<br />		invoke PatBlt, hdc, rc.left, rc.top, dxBdr,   dwHeight, ropXNor<br />		mov edx, rc.right<br />		sub edx, dxBdr<br />		invoke PatBlt, hdc, edx,     rc.top, dxBdr,   dwHeight, ropXNor<br />	.ENDIF<br />	.IF pRect <br />		mov ecx, pRect<br />		mov eax, &#91;ecx&#93;.RECT.right<br />		mov LastRect.right, eax<br />		mov rc.right, eax<br />		mov edx, &#91;ecx&#93;.RECT.left<br />		mov LastRect.left, edx<br />		mov rc.left, edx<br />		sub eax, edx<br />		mov dwWidth, eax<br />		<br />		mov eax, &#91;ecx&#93;.RECT.bottom <br />		mov LastRect.bottom, eax<br />		mov rc.bottom, eax<br />		mov edx, &#91;ecx&#93;.RECT.top<br />		mov LastRect.top, edx<br />		mov rc.top, edx<br />		sub eax, edx<br />		mov dwHeight, eax<br /><br />		invoke PatBlt, hdc, rc.left, rc.top, dwWidth, dyBdr,    ropXNor<br />		mov edx, rc.bottom<br />		sub edx, dyBdr<br />		invoke PatBlt, hdc, rc.left, edx, 	 dwWidth, dyBdr,    ropXNor<br />		mov eax, dwHeight<br />		sub eax, 2<br />		imul eax, dxBdr     ;dy - 2 * dxBdr<br />		mov eax, dyBdr<br />		sub dwHeight, eax<br />		sub dwHeight, eax<br />		mov eax, dyBdr<br />		add rc.top, eax<br />		invoke PatBlt, hdc, rc.left, rc.top, dxBdr,   dwHeight, ropXNor<br />		mov edx, rc.right<br />		sub edx, dxBdr<br />		invoke PatBlt, hdc, edx,     rc.top, dxBdr,   dwHeight, ropXNor<br />	.ELSE<br />		mov LastRect.left, BadRect<br />	.ENDIF<br /><br />	invoke SelectObject, hdc, oldBrush<br />	invoke ReleaseDC, NULL, hdc		; release desktop DC<br />	invoke DeleteObject, hBmp<br />	invoke DeleteObject, hbrsDither<br />	ret<br />DrawGhost  ENDP<br /><br />;-------------------------------------------------------------------------------<br /></code></pre><br /><br /><br />A similar method will draw a resizing line.</div>
    <div class="meta">Posted on 2002-01-22 20:09:23 by Ernie</div>
   </div>
   <div class="post" id="post-20519">
    <div class="subject"><a href="#post-20519">Dockable Bars</a></div>
    <div class="body">Thanx Ernie, that bit of info just sent me miles ahead on my goal!!!!<br /><br />Had lots of fun with it too, haha. Never seen such a messed up Desktop in my life. Boy did I dirty it up while testing stuff, haha<br /><br />now all thats left is the Docking logic and then the resize based on docking position. Would be cool to draw a nice caption bar like you did in yours<br /><br />thanx again</div>
    <div class="meta">Posted on 2002-01-22 20:49:27 by Rockinronstar</div>
   </div>
   <div class="post" id="post-20521">
    <div class="subject"><a href="#post-20521">Dockable Bars</a></div>
    <div class="body">How are you holding the docked windows? I took the 'simple' way out and stuck em into rebars.<br /><br />&quot;Simple' is in quotes because I had to subclass the rebars to teach em a few new tricks. But they do handle multiple docked windows quite nicely once they are there.</div>
    <div class="meta">Posted on 2002-01-22 21:03:27 by Ernie</div>
   </div>
   <div class="post" id="post-20622">
    <div class="subject"><a href="#post-20622">Dockable Bars</a></div>
    <div class="body">I was actually gonna take my own path on that. Just reposition the window manually within the frame. But I do like the reBar idea. Reuse a known, working technology. In reality , I would have to create something like a ReBar to hold the docked windows. Plus the ReBar allows multi docking onto the same bar, which I wasn't looking forward to implementing.<br /><br />I'll have to see, I may still go solo on that and create my own &quot;control bar&quot; system</div>
    <div class="meta">Posted on 2002-01-23 06:10:18 by Rockinronstar</div>
   </div>
  </div>
 </body>
</html>