<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>tray icon recovery on explorer crash - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3465" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=3465">tray icon recovery on explorer crash</a></p>
   <div class="post" id="post-22987">
    <div class="subject"><a href="#post-22987">tray icon recovery on explorer crash</a></div>
    <div class="body">I just ran across this trick the other day and thought others may find it useful.  When explorer crashes you lose the icons in the system tray.  Ever since internet explorer 4, windows has begun sending a message out to all top level windows every time the system tray is recreated.  This gives you a chance to re-add your tray icon after explorer restarts.  You must register the &quot;TaskbarCreated&quot; message and then when it is received in the WndProc just recreate your tray icon.  Here is an example:<br /><br /><pre><code><br />.data<br />szTaskbarCreated    db    &quot;TaskbarCreated&quot;,0<br /><br />.data?<br />s_uTaskbarRestart   dd    ?<br /><br />...<br /><br />invoke    RegisterWindowMessage, ADDR szTaskbarCreated<br />mov       s_uTaskbarRestart, eax<br /></code></pre><br /><br />Just look for a message in WndProc with the same value as s_uTaskbarRestart and recreate your icon if you get it.</div>
    <div class="meta">Posted on 2002-02-05 23:12:14 by rdaneel</div>
   </div>
   <div class="post" id="post-22993">
    <div class="subject"><a href="#post-22993">tray icon recovery on explorer crash</a></div>
    <div class="body">wow very nice gem thanks for sharing. you should post this in the algorithms/source.<br /><br />edit: i just tested my programs in the system tray to see which ones would recover there icons and they all failed miserably. although windows 2000 explorer doesnt nearly crash as much as my windows 98 did it still crashes and this code is a wonderful surprise.:alright:</div>
    <div class="meta">Posted on 2002-02-05 23:42:06 by smurf</div>
   </div>
  </div>
 </body>
</html>