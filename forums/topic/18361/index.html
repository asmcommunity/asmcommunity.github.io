<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ID3 reader/writer - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=18361" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=18361">ID3 reader/writer</a></p>
   <div class="post" id="post-142289">
    <div class="subject"><a href="#post-142289">ID3 reader/writer</a></div>
    <div class="body">This is a little something I have been working on, it will read and write ID3v1.1 and v2.3 tags, as well as the audio information for an MP3 file. When writing a v1.1 tag it will replace the existing tag if present, when writing a v2.3 tag it will strip out the frames that are present in the ID3Info structure and replace them with data you supply, all other frames are unchanged. You can optionally have unknown frames removed. There is also a function to extract the album art image from an v2.3 tag and return a bitmap handle. Compressed frames are decompressed before adding them to the structure using zlib, I only had one example frame to test decompression so it is not 100% tested. The only frames that are read/written are those that WinAmp does, this can be expanded if necessary.<br /><br />The code prefers a v2.3 tag and when ReadIDtag is called it will first attempt to read that, if it is not found it will attempt to find a v1.1 tag. Since there is no way to read a v1.1 tag if there is a v2.3 tag present I have provided a function to do that.<br /><br />GetAudioInfo will properly decode the average bitrate and playback time for VBR/XING encoded files.<br /><br />Unicode frames are converted to ANSI prior to being returned.<br /><br /><span style="font-size:9px><pre><code>.data<br />Audhead			AUDIOHEADER	&lt;&gt;<br />taginfo			ID3Info		&lt;&gt;<br /><br />.code<br />invoke GetAudioInfo, &quot;test.mp3&quot;, offset Ahead<br />invoke ReadIDtag, &quot;test.mp3&quot;, offset taginfo<br />invoke ReadV1Tag, &quot;test.mp3&quot;, offset taginfo <br />invoke WriteV23Tag, &quot;test.mp3&quot;, offset taginfo, 1, 0 ; pFileName, pID3Info, fAllowUndo, fRemoveUnknown<br />invoke WriteV1Tag, &quot;test.mp3&quot;, offset taginfo, 1 ; pFileName, pID3Info, fAllowUndo<br />invoke ID3GetImage, &quot;test.mp3&quot;</code></pre></span> <br /><br />fAllowUndo = Send original file to the recycle bin<br />fRemoveUnknown = Remove frames not found in ID3Info<br /><br />The structures are defined in the source.</div>
    <div class="meta">Posted on 2004-05-28 02:09:43 by donkey</div>
   </div>
   <div class="post" id="post-142290">
    <div class="subject"><a href="#post-142290">ID3 reader/writer</a></div>
    <div class="body">The code uses the following libraries...<br /><br />Note that if you include the decompression part you should acknowledge the following people in your about box:<br /><br />Zlib : Jean-loup Gailly and Mark Adler<br />Zlibstat : LaptoniC<br /><br />If you use the bitmap routine you should acknowledge:<br /><br />BitmapFromMemory : Ernest Murphy</div>
    <div class="meta">Posted on 2004-05-28 02:11:59 by donkey</div>
   </div>
   <div class="post" id="post-142383">
    <div class="subject"><a href="#post-142383">ID3 reader/writer</a></div>
    <div class="body">Just for those who have had this problem, do not attempt to replace lib based functions with the ones from MASM32, only BitmapFromMemory is used from the MASM32 library. The others are different in my libraries, mine follow the more standard format of dest,source while the MASM32 versions are a hodgepodge depending on the author. In general string functions like szCopy etc... will follow the lstrxxx version in both parameter order and return value with my libs but the parameters are probably reversed in MASM32.</div>
    <div class="meta">Posted on 2004-05-28 23:42:17 by donkey</div>
   </div>
   <div class="post" id="post-142428">
    <div class="subject"><a href="#post-142428">ID3 reader/writer</a></div>
    <div class="body">haven't tested it, but :alright:</div>
    <div class="meta">Posted on 2004-05-29 11:16:07 by f0dder</div>
   </div>
   <div class="post" id="post-142439">
    <div class="subject"><a href="#post-142439">ID3 reader/writer</a></div>
    <div class="body">Hi f0dder,<br /><br />Thanks. I have tested it on my MP3's here but they were all generated by me from originals so it is difficult to say that the tests were extensive. All my tests were properly read and written to by WinAmp. I tried downloading a few test MP3's from p2p but the ones I got were mostly garbage (the thing not the band). It is difficult to make it robust when I can't know the range of problematic tags. I downloaded the SDK from id3.org and tested with that, it is where I got my only example of a compressed tag. Hopefully someone will use it and report any problems, I will probably convert it to a lib file soon.<br /><br />I am looking into DirectSound to playback the MP3s, but I have no programming experience in DirectX so it is taking a long time to gather the required infomation and coding practices. I beleive that if I can bypass the MCI that I can acheive good enough playback quality and make it a nice lib.</div>
    <div class="meta">Posted on 2004-05-29 12:52:36 by donkey</div>
   </div>
  </div>
 </body>
</html>