<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>RasDial example - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3551" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=8">Networking</a> &raquo; <a href="../?id=3551">RasDial example</a></p>
   <div class="post" id="post-23569">
    <div class="subject"><a href="#post-23569">RasDial example</a></div>
    <div class="body">hi all,<br /><br />i'm trying from some hours to estabilish a RAS connection. But function fail.<br /><br />Could someone show me an example ?<br /><br />THX B7</div>
    <div class="meta">Posted on 2002-02-09 15:23:08 by Bit7</div>
   </div>
   <div class="post" id="post-23578">
    <div class="subject"><a href="#post-23578">RasDial example</a></div>
    <div class="body">create a new file called : rasapi32.inc and fill it with :<br /><br />; ..\LIB\RASAPI32.LIB PROTOTYPES<br />; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br />DDMGetPhonebookInfo PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />RasAutodialAddressToNetwork PROTO :DWORD,:DWORD,:DWORD<br />RasAutodialEntryToNetwork PROTO :DWORD,:DWORD,:DWORD<br />RasConnectionNotificationA PROTO :DWORD,:DWORD,:DWORD<br />RasConnectionNotification equ &lt;RasConnectionNotificationA&gt;<br /><br />RasCreatePhonebookEntryA PROTO :DWORD,:DWORD<br />RasCreatePhonebookEntry equ &lt;RasCreatePhonebookEntryA&gt;<br /><br />RasDeleteEntryA PROTO :DWORD,:DWORD<br />RasDeleteEntry equ &lt;RasDeleteEntryA&gt;<br /><br />RasDialA PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />RasDial equ &lt;RasDialA&gt;<br /><br />RasDialWow PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />RasEditPhonebookEntryA PROTO :DWORD,:DWORD,:DWORD<br />RasEditPhonebookEntry equ &lt;RasEditPhonebookEntryA&gt;<br /><br />RasEnumAutodialAddressesA PROTO :DWORD,:DWORD,:DWORD<br />RasEnumAutodialAddresses equ &lt;RasEnumAutodialAddressesA&gt;<br /><br />RasEnumConnectionsA PROTO :DWORD,:DWORD,:DWORD<br />RasEnumConnections equ &lt;RasEnumConnectionsA&gt;<br /><br />RasEnumConnectionsWow PROTO :DWORD,:DWORD,:DWORD<br />RasEnumDevicesA PROTO :DWORD,:DWORD,:DWORD<br />RasEnumDevices equ &lt;RasEnumDevicesA&gt;<br /><br />RasEnumEntriesA PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />RasEnumEntries equ &lt;RasEnumEntriesA&gt;<br /><br />RasEnumEntriesWow PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />RasGetAutodialAddressA PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />RasGetAutodialAddress equ &lt;RasGetAutodialAddressA&gt;<br /><br />RasGetAutodialEnableA PROTO :DWORD,:DWORD<br />RasGetAutodialEnable equ &lt;RasGetAutodialEnableA&gt;<br /><br />RasGetAutodialParamA PROTO :DWORD,:DWORD,:DWORD<br />RasGetAutodialParam equ &lt;RasGetAutodialParamA&gt;<br /><br />RasGetConnectResponse PROTO :DWORD,:DWORD<br />RasGetConnectStatusA PROTO :DWORD,:DWORD<br />RasGetConnectStatus equ &lt;RasGetConnectStatusA&gt;<br /><br />RasGetConnectStatusWow PROTO :DWORD,:DWORD<br />RasGetCountryInfoA PROTO :DWORD,:DWORD<br />RasGetCountryInfo equ &lt;RasGetCountryInfoA&gt;<br /><br />RasGetCredentialsA PROTO :DWORD,:DWORD,:DWORD<br />RasGetCredentials equ &lt;RasGetCredentialsA&gt;<br /><br />RasGetEntryDialParamsA PROTO :DWORD,:DWORD,:DWORD<br />RasGetEntryDialParams equ &lt;RasGetEntryDialParamsA&gt;<br /><br />RasGetEntryPropertiesA PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />RasGetEntryProperties equ &lt;RasGetEntryPropertiesA&gt;<br /><br />RasGetErrorStringA PROTO :DWORD,:DWORD,:DWORD<br />RasGetErrorString equ &lt;RasGetErrorStringA&gt;<br /><br />RasGetErrorStringWow PROTO :DWORD,:DWORD,:DWORD<br />RasGetHport PROTO :DWORD<br />RasGetProjectionInfoA PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />RasGetProjectionInfo equ &lt;RasGetProjectionInfoA&gt;<br /><br />RasGetSubEntryHandleA PROTO :DWORD,:DWORD,:DWORD<br />RasGetSubEntryHandle equ &lt;RasGetSubEntryHandleA&gt;<br /><br />RasGetSubEntryPropertiesA PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />RasGetSubEntryProperties equ &lt;RasGetSubEntryPropertiesA&gt;<br /><br />RasHangUpA PROTO :DWORD<br />RasHangUp equ &lt;RasHangUpA&gt;<br /><br />RasHangUpWow PROTO :DWORD<br />RasIsRouterConnection PROTO :DWORD<br />RasRenameEntryA PROTO :DWORD,:DWORD,:DWORD<br />RasRenameEntry equ &lt;RasRenameEntryA&gt;<br /><br />RasSetAutodialAddressA PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />RasSetAutodialAddress equ &lt;RasSetAutodialAddressA&gt;<br /><br />RasSetAutodialEnableA PROTO :DWORD,:DWORD<br />RasSetAutodialEnable equ &lt;RasSetAutodialEnableA&gt;<br /><br />RasSetAutodialParamA PROTO :DWORD,:DWORD,:DWORD<br />RasSetAutodialParam equ &lt;RasSetAutodialParamA&gt;<br /><br />RasSetCredentialsA PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />RasSetCredentials equ &lt;RasSetCredentialsA&gt;<br /><br />RasSetEntryDialParamsA PROTO :DWORD,:DWORD,:DWORD<br />RasSetEntryDialParams equ &lt;RasSetEntryDialParamsA&gt;<br /><br />RasSetEntryPropertiesA PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />RasSetEntryProperties equ &lt;RasSetEntryPropertiesA&gt;<br /><br />RasSetOldPassword PROTO :DWORD,:DWORD<br />RasSetSubEntryPropertiesA PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />RasSetSubEntryProperties equ &lt;RasSetSubEntryPropertiesA&gt;<br /><br />RasValidateEntryNameA PROTO :DWORD,:DWORD<br />RasValidateEntryName equ &lt;RasValidateEntryNameA&gt;<br /><br /><br />&gt;-------------next---------------&lt;<br /><br />		        TITLE JejeConex.asm<br />;                      by  n u M I T_o r, 2k<br />;              http://members.xoom.com/numit_or/asm.html<br /><br /><br />.386<br />.Model Flat,Stdcall<br /><br />INCLUDE Windows.Inc<br />INCLUDE Kernel32.inc<br />INCLUDE User32.inc<br />INCLUDE Rasapi32.inc<br /><br />INCLUDELIB Kernel32.Lib<br />INCLUDELIB User32.Lib<br />INCLUDELIB Rasapi32.Lib<br /><br /><br />.DATA<br />  iError     		db &quot;Error&quot;,0<br />  iErrorAlloc 		db &quot;Error de localizaci?n de memoria&quot;, 13, 10, 13, 10<br />			db &quot;Error to alloc memory&quot;, 0<br />  iErrorLock 		db &quot;Error de Bloqueo&quot;, 13, 10, 13, 10<br />                        db &quot;Error to block memory&quot;, 0<br />  iErrorGetP 		db &quot;Error recuperando informaci?n&quot;, 13, 10, 13, 10<br />                        db &quot;Error getting info&quot;, 0<br />  iErrorSmallBuff 	db &quot;ERROR_BUFFER_TOO_SMALL&quot;, 0<br />  iErrorNoBook 		db &quot;ERROR_CANNOT_OPEN_PHONEBOOK&quot;, 0<br />  iErrorNoEntry 	db &quot;ERROR_CANNOT_FIND_PHONEBOOK_ENTRY&quot;, 0<br />  iErrorBadBuffer 	db &quot;ERROR_BUFFER_INVALID&quot;, 0<br />  iConecting 		db &quot;Conectando - Conecting&quot;, 0<br />  CapStr                db &quot;Jeje Conex...&quot;, 0<br /><br />  UNStr  db  'Username: '<br />  UNbuff db  UNLEN dup (0)<br />  PWStr  db  13, 10, 'Password: '<br />  PWBuff db  PWLEN+2 dup (0)<br />  Msg01  db  13, 10, 13, 10, '?Deseas conectarte?'<br />         db  13, 10, 13, 10, 'Do you want to connect?', 0<br /><br />  temp1  db 'N?mero de entradas: %ld', 13, 10, 13, 10<br />         db 'Number of entries: %ld', 0<br />  <br />.DATA?<br />    hInstance   dd ?<br />    password    dd ?<br />    buffer 	db UNLEN+PWLEN+4+100*2 dup (?)<br />    uEntriesStr db 200 dup (?) <br /><br />.CODE<br />Begin:<br />    Push 0h<br />    Call GetModuleHandleA<br />    push eax<br /><br />    Call MyConnect<br />    <br />    call ExitProcess<br /><br />MyConnect Proc uses esi edi ebx<br />    LOCAL RasCon:RASCONNA, ren:RASENTRYNAMEA<br />    LOCAL TrueSize:DWORD, uEntries:DWORD<br /><br />    Mov RasCon.hrasconn,NULL<br />; -------------------------------------------------------<br />; Get the number of entries in a phone book<br />; Obtiene el n?mero de entradas en la libreta telef?nica<br />; -------------------------------------------------------<br />    lea esi, ren<br />    invoke RtlZeroMemory, esi, sizeof RASENTRYNAME<br />    mov dword ptr , 108h<br />    invoke RasEnumEntries, 0, 0, esi, addr TrueSize, addr uEntries<br />    push eax<br />    xor edx, edx<br />    mov eax, TrueSize<br />    mov ecx, 108h<br />    div ecx<br />; ----------------------------------------------------------<br />; eax has the number of entries, display it in a messagebox<br />; eax tiene el n?mero de entradas, desplegarlo<br />; ----------------------------------------------------------<br />    invoke wsprintf, addr uEntriesStr, addr temp1, eax, eax<br />    Invoke MessageBox, NULL, addr uEntriesStr, addr CapStr, MB_ICONINFORMATION<br />; -----------------------------------------------------------<br />; if there are more than 1 entry, get the name of the first<br />; si hay m?s de una enrtada, obtener el nombre de la primera<br />; -----------------------------------------------------------<br />    pop  eax<br />    push eax<br />    .if eax==ERROR_BUFFER_TOO_SMALL<br />        mov ebx, TrueSize<br />        invoke GlobalAlloc, 0, ebx<br />        mov esi, eax<br />        invoke RtlZeroMemory, esi, ebx<br />        mov dword ptr , 108h<br />    	invoke RasEnumEntries, 0, 0, esi, addr TrueSize, addr uEntries<br />    .endif<br />        push esi<br />        push edi<br />        lea  edi, ren<br />        mov  ecx, sizeof RASENTRYNAME<br />        rep  movsb<br />        pop  edi<br />        pop  esi<br />     pop eax<br />     .if eax==ERROR_BUFFER_TOO_SMALL<br />        invoke GlobalFree, esi<br />    .endif<br />; -----------------------------------------<br />; Get the data of the first entry<br />; Obtener  los datos de la primera entrada<br />; -----------------------------------------<br />	; -------------------------------------------------<br />	; Alloc and block RASDIALPARAMSA strcture<br />	; Localizar y bloquear la estrcutura RASDIALPARAMSA<br />	; -------------------------------------------------<br />    invoke GlobalAlloc, 0, sizeof RASDIALPARAMSA<br />    .IF eax==NULL<br />        Invoke MessageBox, NULL, ADDR iErrorAlloc, ADDR iError, 30h<br />        xor eax, eax<br />        ret<br />    .ENDIF<br />    push eax<br />	; ------------------------------------<br />	; Clean the structure buffer<br />	; Limpiar el buffer de la estructura<br />	; ------------------------------------<br />    mov  edi, eax<br />    mov  ecx, sizeof RASDIALPARAMSA<br />    xor  eax, eax<br />    rep  stosb<br />    pop  edi<br />	; ---------------------------------<br />	; Set the entry name<br />	; Poner el nombre de la estructura<br />	; ---------------------------------<br />    assume edi: ptr RASDIALPARAMSA<br />    mov  dword ptr , 041Ch <br />    invoke lstrcpy, addr .szEntryName, addr ren.szEntryName<br />    invoke GlobalLock, edi<br />    .IF eax==NULL<br />        Invoke MessageBox,NULL,ADDR iErrorLock,ADDR iError,30h<br />        xor eax, eax<br />        ret<br />    .ENDIF<br />    mov edi, eax<br />	; -----------------------<br />	; Get the info<br />	; Obtener la informaci?n<br />	; -----------------------<br />    Invoke RasGetEntryDialParams, NULL, edi, addr password<br />    .IF eax==ERROR_CANNOT_OPEN_PHONEBOOK<br />        Invoke MessageBox,NULL,ADDR iErrorNoBook,ADDR iError,30h<br />    .ELSEIF eax==ERROR_CANNOT_FIND_PHONEBOOK_ENTRY<br />        invoke MessageBox,NULL,ADDR iErrorNoEntry,ADDR iError,30h<br />    .ELSEIF eax==ERROR_BUFFER_INVALID<br />	invoke MessageBox,NULL,ADDR iErrorBadBuffer,ADDR iError,30h<br />    .ELSEIF eax==0<br />	; -------------------------<br />	; Display the info<br />	; Desplegar la informaci?n<br />	; -------------------------<br />        invoke lstrcat, addr UNStr, addr .szUserName<br />        invoke lstrcat, addr buffer, addr UNStr<br />        invoke lstrcat, addr PWStr, addr .szPassword<br />        invoke lstrcat, addr buffer, addr PWStr<br />        invoke lstrcat, addr buffer, addr Msg01<br />        Invoke MessageBox,NULL, addr buffer, addr CapStr, MB_ICONINFORMATION  or MB_YESNO<br />	.if eax==IDYES<br />; -----------------------------------<br />; Conect with that entry<br />; Conectarse a trav?s de esa entrada<br />; -----------------------------------<br />        	Invoke RasDial, 0, NULL, edi, 0, 0, ADDR RasCon.hrasconn<br />        	Invoke MessageBox,NULL, addr .szEntryName, addr CapStr, MB_ICONINFORMATION<br />        .endif       <br />    .ENDIF<br />; -------------------------------<br />; Free a unlock buffer<br />; Liberar y desbloquar el buffer<br />; -------------------------------<br />invoke GlobalUnlock, edi<br />invoke GlobalFree, edi<br />assume edi:nothing<br />ret<br />MyConnect endp<br />End Begin<br /><br />&gt;------------------have some fun------------------&lt;</div>
    <div class="meta">Posted on 2002-02-09 16:59:15 by Max</div>
   </div>
   <div class="post" id="post-23650">
    <div class="subject"><a href="#post-23650">RasDial example</a></div>
    <div class="body">Max <br /> <br /> <br />many thanks, that's what i was lookin for.<br /><br />B7</div>
    <div class="meta">Posted on 2002-02-10 08:33:50 by Bit7</div>
   </div>
   <div class="post" id="post-24012">
    <div class="subject"><a href="#post-24012">RasDial example</a></div>
    <div class="body">MAX, thanks again, you gave me everything to do the connection...<br /><br /><br />It's missing just a little thing to complete my little prog... how can i check if a connection is already active, before do RasDial... ?<br /><br />Thanks   B7</div>
    <div class="meta">Posted on 2002-02-12 13:17:37 by Bit7</div>
   </div>
   <div class="post" id="post-24020">
    <div class="subject"><a href="#post-24020">RasDial example</a></div>
    <div class="body">hossa<br /><br />look at this treath from this section: <a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?threadid=2406">http://www.asmcommunity.net/board/showthread.php?threadid=2406</a><br /><br />why need your tool to know if there is a connection before it open a new df? ?<br />hope you dont code a dialer :)</div>
    <div class="meta">Posted on 2002-02-12 15:12:47 by Max</div>
   </div>
   <div class="post" id="post-24135">
    <div class="subject"><a href="#post-24135">RasDial example</a></div>
    <div class="body">thanks again,<br /><br />i've looked @the code.<br /><br />Seems the state can be returned by RasEnumConnections funct.<br /><br />many thx,  B7</div>
    <div class="meta">Posted on 2002-02-13 13:31:49 by Bit7</div>
   </div>
  </div>
 </body>
</html>