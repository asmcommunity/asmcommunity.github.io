<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Help for Learnig Please - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=5725" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=5725">Help for Learnig Please</a></p>
   <div class="post" id="post-40926">
    <div class="subject"><a href="#post-40926">Help for Learnig Please</a></div>
    <div class="body">Hello ??   sorry but I am spanish and my english is not good.<br /><br />I am learning for recursive functions and try make a function<br />for find all files in a directory with all subfolders included.<br /><br />I have MASM32 v7 and here yu can see my code below<br /><br />what I have to do bad?   how is the correct secuence?<br /><br />Thanke you for your help. ( I am happy with MASM32 )<br /><br />; ########################################################################<br /><br />           ; *****  I call from here and asterix is == db &quot;*.*&quot;,0  ******<br />                      <br />                      ; *****  lea eax, asterix           ******<br />                      ; *****  invoke ForFind, hWnd, eax  ******<br /><br /><br />ForFind proc    HWnd :DWORD, search :DWORD<br /><br />               <br />                      ;   *********   FIND FOR FILES FIRST  ************<br />                      <br /><br />                      invoke FindFirstFile, search, offset fnd                   ;search == *.*<br />                      mov hwndff,eax <br /><br />              nextf:  lea esi,fnd.cFileName                                      ; Skip &quot;.&quot; and &quot;..&quot;<br />                      cmp ,byte ptr &quot;.&quot;           <br />                      je nofile<br /><br />                      cmp fnd.dwFileAttributes ,FILE_ATTRIBUTE_DIRECTORY         ;skip directorys<br />                      je nofile<br />                      <br />                      invoke MessageBox, HWnd, addr fnd.cFileName, ADDR caption, MB_OK    ;show filename<br /><br />            nofile:   invoke FindNextFile,hwndff,offset fnd<br />                      cmp eax, 0<br />                      jne nextf<br />                      <br />                      <br />                      ; **********  FIND FOR DIRECTORYS  **************<br />                      <br /><br />                      invoke FindFirstFile, addr asterix, offset fnd             ; asterix == *.*<br />                      mov hwndff,eax <br /><br />            nextdir:  lea esi,fnd.cFileName                     <br />                      cmp ,byte ptr &quot;.&quot;                                     ; Skip &quot;.&quot; and &quot;..&quot;<br />                      je isnotadir<br /><br />                      cmp fnd.dwFileAttributes ,FILE_ATTRIBUTE_DIRECTORY         ; skip files<br />                      jne isnotadir<br />                      <br />                      szText dir, &quot;   Esto es un directorio   &quot;                  ;show selected directory<br />                      invoke MessageBox,HWnd,addr fnd.cFileName,ADDR dir,MB_OK<br />                                           <br />                      invoke SetCurrentDirectory, ADDR fnd.cFileName<br />                      <br />                      invoke ForFind, HWnd, search                               ;recursive call ???<br /><br />                      invoke SetCurrentDirectory,ADDR dirback                    ; go back a directory<br />                                                            <br />                      invoke GetCurrentDirectory, 260,  ADDR buffer1             ; show current directory<br />                      invoke MessageBox,HWnd,addr buffer1,ADDR caption,MB_OK<br />                      <br /><br />          isnotadir:  invoke FindNextFile,hwndff,offset fnd<br />                      cmp eax, 0<br />                      jne nextdir<br /><br /><br />         ret<br /><br />ForFind endp<br /><br />; ########################################################################<br /><br />  Saludos cordiales desde Barcelona      :confused:    :alright:</div>
    <div class="meta">Posted on 2002-06-01 07:27:46 by mnemox</div>
   </div>
   <div class="post" id="post-40934">
    <div class="subject"><a href="#post-40934">Help for Learnig Please</a></div>
    <div class="body"><strong>mnemox</strong>, welcome to the board!<br /><br />To do recursive you need to save the state of the function before executing that function again - else when you return, you do not start where you were.<pre><code>invoke SetCurrentDirectory,ADDR dirback ; go back a directory</code></pre>After this function, you start over looking through previous directory and find the first directory you just displayed!  Look at this post  <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=1711.msg11014">( HERE )</a>.  Complete example <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=2212">( HERE )</a>.</div>
    <div class="meta">Posted on 2002-06-01 08:49:53 by bitRAKE</div>
   </div>
   <div class="post" id="post-40985">
    <div class="subject"><a href="#post-40985">Thanks</a></div>
    <div class="body">Ok, I try it tomorrow another time thanke you very much...</div>
    <div class="meta">Posted on 2002-06-01 16:39:48 by mnemox</div>
   </div>
   <div class="post" id="post-41088">
    <div class="subject"><a href="#post-41088">HI!!  bitRAKE  Thanks</a></div>
    <div class="body">the routine are working good  :alright:<br /><br />Here is the code for everyone<br /><br /> ; ########################################################################<br /><br />; This little routine show in a messagebox all names of files and directories<br />; included in a initial directory.    Thanks to bitRAKE for orientation<br /><br /><br />ForFind proc    HWnd :DWORD, Path :DWORD, match :DWORD<br /><br />      LOCAL PathName[260]<br />	LOCAL fnd   :WIN32_FIND_DATA<br />	LOCAL hFind :DWORD<br /><br />                      invoke lstrcpy, ADDR PathName, Path                           ; initial directory to PathName<br />                      invoke lstrcat, ADDR PathName, match                          ; add \*.* to PathName<br />                 <br />                      invoke FindFirstFile, addr PathName, addr fnd           <br />                      mov hFind,eax<br />                              <br />               .while eax &gt; 0<br />               <br />                              lea esi,fnd.cFileName                                   ; Skip &quot;.&quot; and &quot;..&quot;<br />                              cmp ,byte ptr &quot;.&quot;           <br />                              je nextf<br />                      <br />                     .if  fnd.dwFileAttributes == FILE_ATTRIBUTE_DIRECTORY<br /><br />                              invoke SetCurrentDirectory, ADDR fnd.cFileName          ; into dir<br />                              <br />                              invoke GetCurrentDirectory, 260, ADDR buffer1       <br />                              <br />                              invoke MessageBox,HWnd,addr buffer1,ADDR caption,MB_OK  ; show Current directory<br /><br />                              invoke ForFind, HWnd, ADDR buffer1, match               ; recursive call<br />                              <br />                              invoke SetCurrentDirectory,ADDR dirback                 ; go back<br />                                <br />                     .else<br />                             <br />                              invoke MessageBox,HWnd,addr fnd.cFileName,ADDR caption,MB_OK  ; show Current fileName                <br />                      <br />                     .endif<br />                     <br />                  nextf:  invoke FindNextFile,hFind,addr fnd                       ; next <br /><br />               .endw<br /><br /><br />         ret<br /><br />ForFind endp<br /><br />; ########################################################################</div>
    <div class="meta">Posted on 2002-06-02 10:26:32 by mnemox</div>
   </div>
  </div>
 </body>
</html>