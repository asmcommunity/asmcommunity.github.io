<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>help needed, WIN32 MACRO's inside HLA ? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20080" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=20080">help needed, WIN32 MACRO's inside HLA ?</a></p>
   <div class="post" id="post-153890">
    <div class="subject"><a href="#post-153890">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body">Hi everyone !<br /><br />My aim is to train myself with resources (exactly here : icons).<br />I adapted in HLA one sample program I found in the MSDN library, about changing the icon of an *.exe (calc) by copying it from another one (winmine).<br /><br />I think my code is rather accurate now, except that I have trouble with the following topics :<br /><br />the functions FindResource and UpdateResource use MACRO's named :<br />1' - MAKEINTRESOURCE which returns a lpStr ;<br />2' - MAKELANGID which returns a word specifying a language ID ;<br /><br />My questions are :<br />1 - how is it to use properly the macro-call (MAKEINTRESOURCE or MAKELANGID)  inside a HLA function-call (FindResource or UpdateResource) AND how do I know the value to pass to that macro ;<br />2 - if need, how can I eventually bypass that macro-call, replacing it by the number or the name of the resource I'm trying to locate (that is : how to locate the Icon resource in the *.exe (winmine) ;<br /><br />Here is my code :<br /><br /><pre><code>program Icons;<br /><br />#include&#40; &quot;stdlib.hhf&quot; &#41;<br />#include&#40; &quot;fileio.hhf&quot; &#41;<br />#include&#40; &quot;w.hhf&quot; &#41;<br /><br />static<br />	hFich1&#58;		dword;<br />	hRessource1&#58;	dword;<br />	hResLoad&#58;	dword;<br />	lpResLock&#58;	dword;	<br />	hUpdateRes&#58;	dword;<br />	dwSizeRes&#58;	dword;<br />	bE_U_R&#58;	 	dword;<br />	bFreeLib&#58;		dword;<br />	bresult&#58;		dword;<br />endstatic;<br /><br />begin Icons;<br /><br />	// STEP 1 - load *.exe from which find the resource &#40;WINMINE.EXE&#41;<br /><br />	w.LoadLibrary&#40;&quot;C&#58;\WINNT\system32\winmine.exe&quot;&#41;;<br />	mov&#40;eax,hFich1&#41;;<br />	stdout.put&#40;nl,&quot; hFich1 &quot;,hFich1&#41;;<br /><br /><br />	// STEP 2 - find resource into *.exe &#40;ICON&#41;<br /><br />	w.FindResource<br />	&#40; <br />		hFich1, <br />		#1,		//MAKEINTRESOURCE&#40;?&#41;,  &#91;color=red&#93;&lt;-- what is here to pass as a param. value ?&#91;/color&#93;		&quot;RT_ICON&quot;<br />	&#41;;<br />	mov&#40;eax,hRessource1&#41;;<br />	stdout.put&#40;nl,&quot; hRessource1 &quot;,hRessource1&#41;;<br /><br /><br />	// STEP 3 - load resource from *.exe<br /><br />	w.LoadResource&#40;hFich1,hRessource1&#41;;<br />	mov&#40;eax,hResLoad&#41;;<br />	stdout.put&#40;nl,&quot; hResLoad &quot;,hResLoad&#41;;<br /><br /><br />	// STEP 4 - lock resource<br /><br />	w.LockResource&#40;hResLoad&#41;;<br />	mov&#40;eax,lpResLock&#41;;<br />	stdout.put&#40;nl,&quot; lpResLock &quot;,lpResLock&#41;;<br /><br /><br />	// STEP 5 - open file to which add the resource &#40;CALC_COPY.EXE&#41;<br /><br />	w.BeginUpdateResource&#40;&quot;C&#58;\WINNT\system32\calc_copy.exe&quot;,false&#41;;<br />	mov&#40;eax,hUpdateRes&#41;;<br />	stdout.put&#40;nl,&quot; hUpdateRes &quot;,hUpdateRes&#41;;<br /><br />	// pre-STEP 6 - size of resource<br />	w.SizeofResource&#40;hFich1,hRessource1&#41;;<br />	mov&#40;eax,dwSizeRes&#41;;<br />	stdout.put&#40;nl,&quot; dwSizeRes &quot;,dwSizeRes&#41;;<br /><br />	// STEP 6 - add resource to the updatelist<br /><br />	w.UpdateResource<br />	&#40;<br />	hUpdateRes,<br />	&quot;RT_ICON&quot;,<br />	#1,<br />	1,		//MAKELANGID  &#91;color=red&#93;&lt;-- what is here to pass as a param. value ?&#91;/color&#93;	&#40;LANG_NEUTRAL,SUBLANG_NEUTRAL&#41;,<br />	lpResLock,<br />	dwSizeRes<br />	&#41;;<br />	mov&#40;eax,bresult&#41;;<br />	stdout.put&#40;nl,&quot; bresult &quot;,bresult&#41;;<br /><br /><br />	// STEP 7 - write changes to updated file &#40;CALC.EXE&#41;<br /><br />	w.EndUpdateResource&#40;hUpdateRes, false&#41;;<br />	mov&#40;eax,bE_U_R&#41;;<br />	stdout.put&#40;nl,&quot; bE_U_R &quot;,bE_U_R&#41;;<br /><br /><br />	// STEP 8 - clean up<br /><br />	w.FreeLibrary&#40;hFich1&#41;;<br />	mov&#40;eax,bFreeLib&#41;;<br />	stdout.put&#40;nl,&quot; bFreeLib &quot;,bFreeLib&#41;;<br /><br />end Icons;</code></pre><br /><br />Who can help me finding what is wrong here ?<br />(I hope I was clear enough, in other case, I give more explanations  :oops: )<br /><br />Thanks a lot for answering or eventually redirecting me to another more appropriate forum...<br /><br />Juan,<br />Belgium.</div>
    <div class="meta">Posted on 2004-12-08 05:02:47 by Juan</div>
   </div>
   <div class="post" id="post-153972">
    <div class="subject"><a href="#post-153972">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body">Hi Juan,<br /><br />You should write <br /><pre><code><br />...<br />const<br />      RT_GROUP_ICON &#58;= w.RT_ICON + 11;<br />      ...<br />      w.FindResource<br />      &#40;<br />         hFich1,<br />         val IDI_ICON,    // numeric identifier<br />         val RT_GROUP_ICON<br />      &#41;;<br />      ...<br />      w.UpdateResource<br />      &#40;<br />         hUpdateRes,<br />         val RT_GROUP_ICON,<br />         val IDI_ICON,<br />         0,               // LANG_NEUTRAL = 0, SUBLANG_NEUTRAL = 0<br />         lpResLock, <br />         dwSizeRes <br />      &#41;;<br />      ...<br /></code></pre><br /><br />The macro MAKELANGID and different language IDs are defined like this<br /><br /><pre><code><br />      // from WinNT.h<br />      ...<br />      #define LANG_NEUTRAL                     0x00<br />      ...<br />      #define SUBLANG_NEUTRAL               0x00    // language neutral<br />      #define SUBLANG_DEFAULT               0x01    // user default<br />      #define SUBLANG_SYS_DEFAULT        0x02    // system default<br />      ...<br />      #define MAKELANGID&#40;p, s&#41;       &#40;&#40;&#40;&#40;WORD  &#41;&#40;s&#41;&#41; &lt;&lt; 10&#41; | &#40;WORD  &#41;&#40;p&#41;&#41;<br />      ...<br /></code></pre><br /><br />I hope that helps you<br /><br />Regards</div>
    <div class="meta">Posted on 2004-12-09 18:24:31 by arlequin</div>
   </div>
   <div class="post" id="post-153983">
    <div class="subject"><a href="#post-153983">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body">I wrote<br /><pre><code><br />         ...<br />         val IDI_ICON,    // numeric identifier <br />         val RT_GROUP_ICON   // because I've multiple sizes icon<br />      &#41;; <br />      ...<br /></code></pre><br /><br />Obviously, you can replace RT_GROUP_ICON by RT_ICON if your icon resource contains only one size icon. <br /><br />Regards</div>
    <div class="meta">Posted on 2004-12-10 02:03:28 by arlequin</div>
   </div>
   <div class="post" id="post-154190">
    <div class="subject"><a href="#post-154190">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body">Hi everyone again !<br /><br />OK, I understood Arlequin's explanations (thanks a lot !) and made corrections to my code.<br />But now, though it doesn't generate errors at compile-time, my program still has a bug :<br /><br />If I use the RT_ICON value (=3) for the lptype parameter and IDI_ICON_winmine =1 , IDI_ICON_calc = 1 (FindResource and UpdateResource), the step 5 does not work properly, although it produces actually changes to calc.exe (seems to modify the icon #1 into some WIN standard or default icon, but not into the icon from winmine as required  :? ).<br />I can check this using a resource editor.<br /><br />I suppose the error in my code must hide in the use of the RT_ICON/RT_GROUP_ICON values for the lptype parameter.<br /><br />My first question is :<br />Should I use RT_ICON (=3 as set in w.hhf) or RT_GROUP_ICON (=14) as a value for the lptype parameter, knowing that both calc and winmine have two icons :<br />-	winmine icon #1 : 744 bytes<br />-	winmine icon #2 : 304 bytes<br />-	calc icon #1 : 744 bytes<br />-	calc icon #2 :296 bytes<br />?and that my aim is (at first) to replace calc icon #1 by winmine icon #1 ?<br /><br /><br />If I use the RT_GROUP_ICON value for lptype and IDI_ICON_winmine = 1,<br />then my program simply cannot locate the icon #1?<br /><br />so, my second question is :<br />How can I determine securely the # of an icon, when I have to use the RT_GROUP_ICON value for lptype.<br /><br />My third question is :<br />(the explanation of Arlequin was not quite clear to me  :( ).<br />In case I cannot use MAKELANGID in HLA, how can I know the result of its calculation for any combination of usPrimaryLanguage and usSubLanguage, to be able to input any value for wLanguage. (that is : what is the algorithm of that function ?, where can I find it ?)<br />I noticed that all icons above have LANG_FRENCH and SUBLANG_FRENCH values.<br />Is it the reason for my fail, as I was forced to use 0 for wLanguage until now ?<br /><br />Well... enough for now, but I? be pleased someone to try my prog and give the explanations?<br /><br />Thanks a lot again, especially to Arlequino?<br /><br />my code modified :<br /><br />don't look at pre-STEP 5 for now as I wanted to check and draw the icon, but until now I have no result with this part of code... it will come later... :-D <br /><br /><pre><code>program Icons;<br /><br />// ce programme tente de substituer l'ic?ne de winmine ? calc<br />// &#40;8 ?tapes&#41;<br />//<br /><br />#include&#40; &quot;stdlib.hhf&quot; &#41;<br />#include&#40; &quot;fileio.hhf&quot; &#41;<br />#include&#40; &quot;w.hhf&quot; &#41;<br /><br />const<br />	IDI_ICON_winmine&#58;=	1;<br />	IDI_ICON_calc&#58;=		1;<br />	RT_ICON&#58;=		w.RT_ICON;<br />	RT_GROUP_ICON&#58;=		w.RT_ICON + 11;<br />endconst;<br /><br />static<br />	hDC&#58;		dword;<br />	hFich1&#58;		dword;<br />	hRessource1&#58;	dword;<br />	hResLoad&#58;	dword;<br />	lpResLock&#58;	dword;<br />	bDrawRes&#58;	dword;	<br />	hUpdateRes&#58;	dword;<br />	dwSizeRes&#58;	dword;<br />	bE_U_R&#58;	 	dword;<br />	bFreeLib&#58;		dword;<br />	bresult&#58;		dword;<br />endstatic;<br /><br />begin Icons;<br /><br />	// STEP 1 - load *.exe &#40;WINMINE.EXE&#41; from which find the resource &#40;ICON&#41;<br /><br />	w.LoadLibrary&#40;&quot;C&#58;\hla\essais\icons\winmine.exe&quot;&#41;;<br />	mov&#40;eax,hFich1&#41;;<br />	stdout.put&#40;nl,&quot; hFich1 &quot;,hFich1&#41;;<br /><br /><br />	// STEP 2 - find resource &#40;ICON&#41; into *.exe &#40;WINMINE.EXE&#41;<br />	w.FindResource<br />	&#40; <br />		hFich1, <br />		val IDI_ICON_winmine,		//#1,		//MAKEINTRESOURCE&#40;?&#41;, <br />		val RT_GROUP_ICON<br />	&#41;;<br />	mov&#40;eax,hRessource1&#41;;<br />	stdout.put&#40;nl,&quot; hRessource1 &quot;,hRessource1&#41;;<br /><br /><br />	// STEP 3 - load resource &#40;ICON&#41; from *.exe &#40;WINMINE.EXE&#41;<br /><br />	w.LoadResource&#40;hFich1,hRessource1&#41;;<br />	mov&#40;eax,hResLoad&#41;;<br />	stdout.put&#40;nl,&quot; hResLoad &quot;,hResLoad&#41;;<br /><br /><br />	// STEP 4 - lock resource<br /><br />	w.LockResource&#40;hResLoad&#41;;<br />	mov&#40;eax,lpResLock&#41;;<br />	stdout.put&#40;nl,&quot; lpResLock &quot;,lpResLock&#41;;<br /><br /><br />	//pre-STEP 5 - draw the icon<br /><br />	w.CreateDC<br />	&#40;<br />	&quot;DISPLAY&quot;,<br />	NULL,<br />	NULL,<br />	NULL<br />	&#41;;<br />	mov&#40;eax,hDC&#41;;<br />	stdout.put&#40;nl,&quot; hDC &quot;,hDC&#41;;<br /><br />	w.DrawIcon<br />	&#40;<br />		hDC,<br />		10,<br />		20,<br />		hRessource1<br />	&#41;;<br />	mov&#40;eax,bDrawRes&#41;;<br />	stdout.put&#40;nl,&quot; bDrawRes &quot;,bDrawRes&#41;;<br /><br /><br />	// STEP 5 - open file to which add the resource &#40;CALC.EXE&#41;<br /><br />	w.BeginUpdateResource&#40;&quot;C&#58;\hla\essais\icons\calc.exe&quot;,false&#41;;<br />	mov&#40;eax,hUpdateRes&#41;;<br />	stdout.put&#40;nl,&quot; hUpdateRes &quot;,hUpdateRes&#41;;<br /><br />	// pre-STEP 6 - size of resource<br />	w.SizeofResource&#40;hFich1,hRessource1&#41;;<br />	mov&#40;eax,dwSizeRes&#41;;<br />	stdout.put&#40;nl,&quot; dwSizeRes &quot;,dwSizeRes&#41;;<br /><br />	// STEP 6 - add resource to the updatelist<br /><br />	w.UpdateResource<br />	&#40;<br />	hUpdateRes,<br />	val RT_GROUP_ICON,<br />	val IDI_ICON_calc,		//#1,<br />	0,			// LANG_NEUTRAL = 0, SUBLANG_NEUTRAL = 0		//MAKELANGID&#40;LANG_NEUTRAL,SUBLANG_NEUTRAL&#41;,		<br />	lpResLock,<br />	dwSizeRes<br />	&#41;;<br />	mov&#40;eax,bresult&#41;;<br />	stdout.put&#40;nl,&quot; bresult &quot;,bresult&#41;;<br /><br /><br />	// STEP 7 - write changes to updated file &#40;CALC.EXE&#41;<br /><br />	w.EndUpdateResource&#40;hUpdateRes, false&#41;;<br />	mov&#40;eax,bE_U_R&#41;;<br />	stdout.put&#40;nl,&quot; bE_U_R &quot;,bE_U_R&#41;;<br /><br /><br />	// STEP 8 - clean up<br /><br />	w.FreeLibrary&#40;hFich1&#41;;<br />	mov&#40;eax,bFreeLib&#41;;<br />	stdout.put&#40;nl,&quot; bFreeLib &quot;,bFreeLib&#41;;<br /><br />end Icons;</code></pre></div>
    <div class="meta">Posted on 2004-12-15 07:10:38 by Juan</div>
   </div>
   <div class="post" id="post-154273">
    <div class="subject"><a href="#post-154273">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body">Hi Juan,<br /><br />1&amp;2. Yes, you should use RT_ICON as value for lpType parameter. The problem is to know what icon id to choose. If you look at into the resources of winmine.exe and calc.exe, you'll notice that these two progs contains the same icon number in their RT_GROUP_ICON. In this case, you've not to modify the resource structure, you can simply change one icon by another. As I said, the problem is how to choose the right one. While I was looking for informations, I found  <a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnwui/html/msdn_icons.asp">Icons in Win32</a>. A little bit outdated, but still usable. Read also <a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winui/winui/WindowsUserInterface/Resources/IntroductiontoResources.asp">Introduction to Resources</a><br /><br />3. MAKELANGID is a macro defined in winNT.h as I wrote in my last post. The following is the HLA version:<br /><pre><code><br />#if&#40; ! @defined&#40; winnt_hhf &#41;&#41;<br />?winnt_hhf &#58;= true;<br /><br />namespace nt; @fast;<br /><br />#macro MAKELANGID&#40;p, s&#41;;<br /><br />	&#40;&#40;&#40;type word s&#41; &lt;&lt; 10&#41; | &#40;type word p&#41;&#41;<br /><br />#endmacro;<br /><br />const<br />	LANG_SYSTEM_DEFAULT	&#58;text &#58;= &quot;nt.MAKELANGID&#40;nt.LANG_NEUTRAL, nt.SUBLANG_SYS_DEFAULT&#41;&quot;;<br />	LANG_USER_DEFAULT		&#58;text &#58;= &quot;nt.MAKELANGID&#40;nt.LANG_NEUTRAL, nt.SUBLANG_DEFAULT&#41;&quot;;<br />	<br />//<br />//  Language IDs.<br />//<br />//  The following two combinations of primary language ID and<br />//  sublanguage ID have special semantics&#58;<br />//<br />//    Primary Language ID   Sublanguage ID      Result<br />//    -------------------   ---------------     ------------------------<br />//    LANG_NEUTRAL          SUBLANG_NEUTRAL     Language neutral<br />//    LANG_NEUTRAL          SUBLANG_DEFAULT     User default language<br />//    LANG_NEUTRAL          SUBLANG_SYS_DEFAULT System default language<br />//    LANG_INVARIANT        SUBLANG_NEUTRAL     Invariant locale<br />//<br /><br />//<br />//  Primary language IDs.<br />//<br /><br />const<br />	LANG_NEUTRAL                     &#58;= $00;<br />	LANG_INVARIANT                   &#58;= $7f;<br /><br />	LANG_ENGLISH                     &#58;= $09;<br />	LANG_FRENCH                      &#58;= $0c;<br />	// more const here and above<br /><br />//<br />//  Sublanguage IDs.<br />//<br />//  The name immediately following SUBLANG_ dictates which primary<br />//  language ID that sublanguage ID can be combined with to form a<br />//  valid language ID.<br />//<br /><br />const<br />	SUBLANG_NEUTRAL                  &#58;= $00;   // language neutral<br />	SUBLANG_DEFAULT                  &#58;= $01;   // user default<br />	SUBLANG_SYS_DEFAULT           &#58;= $02;   // system default<br />	<br />	SUBLANG_ENGLISH_US               &#58;= $01;   // English &#40;USA&#41;<br />	SUBLANG_ENGLISH_UK               &#58;= $02;   // English &#40;UK&#41;<br />	SUBLANG_ENGLISH_AUS              &#58;= $03;   // English &#40;Australian&#41;<br />	SUBLANG_ENGLISH_CAN              &#58;= $04;   // English &#40;Canadian&#41;<br />	SUBLANG_ENGLISH_NZ               &#58;= $05;   // English &#40;New Zealand&#41;<br />	SUBLANG_ENGLISH_EIRE             &#58;= $06;   // English &#40;Irish&#41;<br />	SUBLANG_ENGLISH_SOUTH_AFRICA     &#58;= $07;   // English &#40;South Africa&#41;<br />	SUBLANG_ENGLISH_JAMAICA          &#58;= $08;   // English &#40;Jamaica&#41;<br />	SUBLANG_ENGLISH_CARIBBEAN        &#58;= $09;   // English &#40;Caribbean&#41;<br />	SUBLANG_ENGLISH_BELIZE           &#58;= $0a;   // English &#40;Belize&#41;<br />	SUBLANG_ENGLISH_TRINIDAD         &#58;= $0b;   // English &#40;Trinidad&#41;<br />	SUBLANG_ENGLISH_ZIMBABWE         &#58;= $0c;   // English &#40;Zimbabwe&#41;<br />	SUBLANG_ENGLISH_PHILIPPINES      &#58;= $0d;   // English &#40;Philippines&#41;<br />	SUBLANG_FRENCH                   &#58;= $01;   // French<br />	SUBLANG_FRENCH_BELGIAN           &#58;= $02;   // French &#40;Belgian&#41;<br />	SUBLANG_FRENCH_CANADIAN          &#58;= $03;   // French &#40;Canadian&#41;<br />	SUBLANG_FRENCH_SWISS             &#58;= $04;   // French &#40;Swiss&#41;<br />	SUBLANG_FRENCH_LUXEMBOURG        &#58;= $05;   // French &#40;Luxembourg&#41;<br />	SUBLANG_FRENCH_MONACO            &#58;= $06;   // French &#40;Monaco&#41;<br /><br />end nt;<br /><br />#endif<br /></code></pre><br />and now, the sample code for changing the calc.exe icon<br /><pre><code><br />program Icons; <br /><br />// ce programme tente de substituer l'ic?ne de winmine ? calc <br />// &#40;8 ?tapes&#41; <br />// <br />// ce programme va r?ellement substituer l'ic?ne de winmine ? calc<br />// &#40;1 ?tape&#41; &#58;&#41;<br /><br />#include&#40; &quot;stdlib.hhf&quot; &#41; <br />#include&#40; &quot;fileio.hhf&quot; &#41; <br />#include&#40; &quot;w.hhf&quot; &#41;<br /><br />#include&#40; &quot;langid.hhf&quot; &#41;<br /><br />static<br />	LookupIconIdFromDirectoryEx&#58; procedure<br />	&#40;<br />		var presbits&#58; byte;<br />		fIcon&#58; dword;<br />		cxDesired&#58; dword;<br />		cyDesired&#58; dword;<br />		Flags&#58; dword<br />	&#41;;<br />		@stdcall;<br />		@returns&#40; &quot;eax&quot; &#41;;<br />		@external&#40; &quot;__imp__LookupIconIdFromDirectoryEx@20&quot; &#41;;<br /><br />const<br />	TRUE					&#58;= 1;<br />	CXICON				&#58;= 16;<br />	CYICON				&#58;= 16;<br />   IDI_GROUP_ICON		&#58;= 100;	// WinMine.exe group icon <br />   IDI_ICON				&#58;= 5;		// icon to change in calc.exe 	<br />   RT_ICON				&#58;= w.RT_ICON; <br />   RT_GROUP_ICON		&#58;= w.RT_ICON + 11; <br /><br />static <br />   hFich1		&#58;dword;<br />   hRessource1 &#58;dword;<br />	pEntry		&#58;dword;<br />	nID			&#58;dword;<br />	<br />   hUpdateRes	&#58;dword; <br />   dwSizeRes	&#58;dword; <br />   bE_U_R		&#58;dword; <br />   bFreeLib		&#58;dword; <br />   bresult		&#58;dword; <br />	<br />begin Icons; <br /><br />   w.LoadLibrary&#40;&quot;.\winmine.exe&quot;&#41;; <br />   mov&#40; eax, hFich1 &#41;; <br />   stdout.put&#40;nl,&quot;LoadLibrary - hFich1 &quot;, hFich1 &#41;; <br /><br />	w.FindResource&#40; hFich1, val IDI_GROUP_ICON, val RT_GROUP_ICON &#41;; <br />	stdout.put&#40; nl,&quot;FindResource - hRessource1 &quot;, &#40;type dword eax&#41; &#41;; <br /><br />	w.LoadResource&#40; hFich1, eax &#41;; <br />	stdout.put&#40;nl,&quot;LoadResource - hResLoad &quot;, &#40;type dword eax&#41; &#41;; <br /><br />	w.LockResource&#40; eax &#41;; <br />	stdout.put&#40;nl,&quot;LockResource - lpResLock &quot;, &#40;type dword eax&#41; &#41;; <br />	<br />	LookupIconIdFromDirectoryEx&#40;<br />		&#40;type byte &#91;eax&#93;&#41;, TRUE, CXICON, CYICON, w.LR_DEFAULTCOLOR &#41;;<br />	mov&#40; eax, nID &#41;;<br /> 	stdout.put&#40;nl,&quot;LookupIconIdFromDirectoryEx - nID &quot;, nID&#41;; <br /> 	<br /> 	//-----------------------------------------------------------------//<br /> 	<br />	w.FindResource&#40; hFich1, nID, val RT_ICON &#41;; <br />	mov&#40; eax, hRessource1 &#41;;<br />	stdout.put&#40; nl,&quot;FindResource - hRessource1 &quot;, hRessource1 &#41;; <br />	<br />	w.SizeofResource&#40; hFich1, hRessource1 &#41;; <br />   mov&#40; eax, dwSizeRes &#41;; <br />   stdout.put&#40;nl,&quot;SizeofResource - dwSizeRes &quot;, dwSizeRes&#41;; <br />   <br />	w.LoadResource&#40; hFich1, hRessource1 &#41;; <br />	stdout.put&#40;nl,&quot;LoadResource - hResLoad &quot;, &#40;type dword eax&#41; &#41;; <br /><br />	w.LockResource&#40; eax &#41;; <br />	mov&#40; eax, pEntry &#41;;<br />	stdout.put&#40;nl,&quot;LockResource - lpResLock &quot;, pEntry&#41;; <br />		   <br />   w.BeginUpdateResource&#40; &quot;.\calc.exe&quot;, false &#41;; <br />   mov&#40; eax, hUpdateRes&#41;; <br />   stdout.put&#40;nl,&quot;BeginUpdateResource - hUpdateRes &quot;, hUpdateRes&#41;; <br /><br />	mov&#40; pEntry, eax &#41;;<br /><br />   w.UpdateResource <br />   &#40; <br />	   hUpdateRes, <br />	   val RT_ICON, <br />	   val IDI_ICON,<br />	   nt.MAKELANGID&#40; nt.LANG_FRENCH, nt.SUBLANG_FRENCH &#41;,      <br />	   &#91;eax&#93;, <br />	   dwSizeRes <br />   &#41;; <br />   mov&#40;eax,bresult&#41;; <br />   stdout.put&#40;nl,&quot;UpdateResource - bresult &quot;, bresult&#41;; <br />      <br />   w.EndUpdateResource&#40;hUpdateRes, false&#41;; <br />   mov&#40;eax,bE_U_R&#41;; <br />   stdout.put&#40;nl,&quot;EndUpdateResource - bE_U_R &quot;,bE_U_R&#41;; <br /><br /><br />   // STEP 8 - clean up <br /><br />   w.FreeLibrary&#40;hFich1&#41;; <br />   mov&#40;eax,bFreeLib&#41;; <br />   stdout.put&#40;nl,&quot;FreeLibrary - bFreeLib &quot;,bFreeLib&#41;; <br /><br />end Icons;<br /></code></pre><br /><br />J'esp?re que ?a t'aidera un peu<br />a+</div>
    <div class="meta">Posted on 2004-12-16 20:50:16 by arlequin</div>
   </div>
   <div class="post" id="post-154449">
    <div class="subject"><a href="#post-154449">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body">Je vois ? l'instant ta r?ponse... :shock: <br /><br />Je vais tenter de comprendre tout ?a... :wink: <br /><br />Merci beaucoup.<br /><br />MP : tu es francophone ? sinon, 'chapeau'  pour le Fran?ais...:alright: <br /><br />? bient?t,<br />Juan...</div>
    <div class="meta">Posted on 2004-12-20 03:17:58 by Juan</div>
   </div>
   <div class="post" id="post-154454">
    <div class="subject"><a href="#post-154454">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body">hem... :? <br /><br />Langid.hhf ?<br /><br />Where does this one come out ?<br />I don't have it in my includes ?<br /><br />I suppose that it contains the HLA-def. of MAKELANGID ?<br />Can you tell me about that file ? Where can I download it from ?<br /><br />sorry for being so silly sometimes... :oops: <br /><br />But...  thanks to you, I can feel I reach the solution, little by little... :idea: <br /><br />? bient?t,<br />Juan.</div>
    <div class="meta">Posted on 2004-12-20 05:06:50 by Juan</div>
   </div>
   <div class="post" id="post-154460">
    <div class="subject"><a href="#post-154460">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body">Hi Juan,<br /><br />Oops  :roll: , I'm trying my code at work and it doesn't work. <br /><pre><code><br />   LookupIconIdFromDirectoryEx&#40; <br />      &#40;type byte &#91;eax&#93;&#41;, TRUE, CXICON, CYICON, w.LR_DEFAULTCOLOR &#41;; <br />   mov&#40; eax, nID &#41;; <br /></code></pre><br /><br />The return value depends on display properties and LookupIconIdFromDirectoryEx chooses icon that best fit these properties. It seems that with true colors (32bits), nID = 8. At home, I got nID = 5.<br /><br />You've to put <strong>nID</strong> in UpdateResource accordingly. Ok, simply replace val IDI_ICON with <strong>nID</strong> like this<br /><pre><code><br />   w.UpdateResource <br />   &#40; <br />      hUpdateRes, <br />      val RT_ICON, <br />      nID,   &lt;-- here<br />      nt.MAKELANGID&#40; nt.LANG_FRENCH, nt.SUBLANG_FRENCH &#41;,      <br />      &#91;eax&#93;, <br />      dwSizeRes <br />   &#41;; <br /></code></pre><br /><br />Don't forget, it works because calc.exe and winmine.exe have the same RT_GROUP_ICON structure ( same icon IDs ). In other cases, you should  call LookupIconIdFromDirectoryEx, once for each exe.<br /><br />a+</div>
    <div class="meta">Posted on 2004-12-20 05:58:34 by arlequin</div>
   </div>
   <div class="post" id="post-154463">
    <div class="subject"><a href="#post-154463">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body">sorry Juan,<br /><br />change langid.hhf by winnt.hhf<br /><pre><code><br />#include&#40; &quot;winnt.hhf&quot; &#41;<br /></code></pre><br /><br />Obviously, winnt.hhf doesn't exist in the HLA distrib. You have to cut &amp; paste the code from my previous post in your favorite editor and save it on your disk. If you don't find it, here is the begining<br /><br /><pre><code><br />#if&#40; ! @defined&#40; winnt_hhf &#41;&#41; <br />?winnt_hhf &#58;= true; <br /><br />namespace nt; @fast; <br /><br />#macro MAKELANGID&#40;p, s&#41;; <br /><br />   &#40;&#40;&#40;type word s&#41; &lt;&lt; 10&#41; | &#40;type word p&#41;&#41; <br /><br />#endmacro; <br />...<br /></code></pre><br /><br />D?sol? pour mes erreurs, mais courage, ?a va aller..  :wink: <br /><br />a+</div>
    <div class="meta">Posted on 2004-12-20 06:24:21 by arlequin</div>
   </div>
   <div class="post" id="post-154518">
    <div class="subject"><a href="#post-154518">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body">little by little...<br /><br />OK ! let's go on !<br /><br />So until now, I copied the def. of MAKELANGID :<br /><br /><pre><code>#if&#40; ! @defined&#40; winnt_hhf &#41;&#41; <br />?winnt_hhf &#58;= true; <br /><br />namespace nt; @fast; <br /><br />#macro MAKELANGID&#40;p, s&#41;; <br /><br />   &#40;&#40;&#40;type word s&#41; &lt;&lt; 10&#41; | &#40;type word p&#41;&#41; <br /><br />#endmacro; <br /><br />const <br />   LANG_SYSTEM_DEFAULT   &#58;text &#58;= &quot;nt.MAKELANGID&#40;nt.LANG_NEUTRAL, nt.SUBLANG_SYS_DEFAULT&#41;&quot;; <br />   LANG_USER_DEFAULT      &#58;text &#58;= &quot;nt.MAKELANGID&#40;nt.LANG_NEUTRAL, nt.SUBLANG_DEFAULT&#41;&quot;; <br />    <br />// <br />//  Language IDs. <br />// <br />//  The following two combinations of primary language ID and <br />//  sublanguage ID have special semantics&#58; <br />// <br />//    Primary Language ID   Sublanguage ID      Result <br />//    -------------------   ---------------     ------------------------ <br />//    LANG_NEUTRAL          SUBLANG_NEUTRAL     Language neutral <br />//    LANG_NEUTRAL          SUBLANG_DEFAULT     User default language <br />//    LANG_NEUTRAL          SUBLANG_SYS_DEFAULT System default language <br />//    LANG_INVARIANT        SUBLANG_NEUTRAL     Invariant locale <br />// <br /><br />// <br />//  Primary language IDs. <br />// <br /><br />const <br />   LANG_NEUTRAL                     &#58;= $00; <br />   LANG_INVARIANT                   &#58;= $7f; <br /><br />   LANG_ENGLISH                     &#58;= $09; <br />   LANG_FRENCH                      &#58;= $0c; <br />   // more const here and above <br /><br />// <br />//  Sublanguage IDs. <br />// <br />//  The name immediately following SUBLANG_ dictates which primary <br />//  language ID that sublanguage ID can be combined with to form a <br />//  valid language ID. <br />// <br /><br />const <br />   SUBLANG_NEUTRAL                  &#58;= $00;   // language neutral <br />   SUBLANG_DEFAULT                  &#58;= $01;   // user default <br />   SUBLANG_SYS_DEFAULT           &#58;= $02;   // system default <br />    <br />   SUBLANG_ENGLISH_US               &#58;= $01;   // English &#40;USA&#41; <br />   SUBLANG_ENGLISH_UK               &#58;= $02;   // English &#40;UK&#41; <br />   SUBLANG_ENGLISH_AUS              &#58;= $03;   // English &#40;Australian&#41; <br />   SUBLANG_ENGLISH_CAN              &#58;= $04;   // English &#40;Canadian&#41; <br />   SUBLANG_ENGLISH_NZ               &#58;= $05;   // English &#40;New Zealand&#41; <br />   SUBLANG_ENGLISH_EIRE             &#58;= $06;   // English &#40;Irish&#41; <br />   SUBLANG_ENGLISH_SOUTH_AFRICA     &#58;= $07;   // English &#40;South Africa&#41; <br />   SUBLANG_ENGLISH_JAMAICA          &#58;= $08;   // English &#40;Jamaica&#41; <br />   SUBLANG_ENGLISH_CARIBBEAN        &#58;= $09;   // English &#40;Caribbean&#41; <br />   SUBLANG_ENGLISH_BELIZE           &#58;= $0a;   // English &#40;Belize&#41; <br />   SUBLANG_ENGLISH_TRINIDAD         &#58;= $0b;   // English &#40;Trinidad&#41; <br />   SUBLANG_ENGLISH_ZIMBABWE         &#58;= $0c;   // English &#40;Zimbabwe&#41; <br />   SUBLANG_ENGLISH_PHILIPPINES      &#58;= $0d;   // English &#40;Philippines&#41; <br />   SUBLANG_FRENCH                   &#58;= $01;   // French <br />   SUBLANG_FRENCH_BELGIAN           &#58;= $02;   // French &#40;Belgian&#41; <br />   SUBLANG_FRENCH_CANADIAN          &#58;= $03;   // French &#40;Canadian&#41; <br />   SUBLANG_FRENCH_SWISS             &#58;= $04;   // French &#40;Swiss&#41; <br />   SUBLANG_FRENCH_LUXEMBOURG        &#58;= $05;   // French &#40;Luxembourg&#41; <br />   SUBLANG_FRENCH_MONACO            &#58;= $06;   // French &#40;Monaco&#41; <br /><br />end nt; <br /><br />#endif <br /></code></pre><br /><br />into the winnt.hhf and tried to compile the following code (icons.hla) :<br /><br /><pre><code>program Icons; <br /><br />// ce programme tente de substituer l'ic?ne de winmine ? calc <br />// &#40;8 ?tapes&#41; <br />// <br />// ce programme va r?ellement substituer l'ic?ne de winmine ? calc <br />// &#40;1 ?tape&#41; &#58;&#41; <br /><br />#include&#40; &quot;stdlib.hhf&quot; &#41; <br />#include&#40; &quot;fileio.hhf&quot; &#41; <br />#include&#40; &quot;w.hhf&quot; &#41; <br /><br />//#include&#40; &quot;winnt.hhf&quot; &#41; <br /><br />static <br />   LookupIconIdFromDirectoryEx&#58; procedure <br />   &#40; <br />      var presbits&#58; byte; <br />      fIcon&#58; dword; <br />      cxDesired&#58; dword; <br />      cyDesired&#58; dword; <br />      Flags&#58; dword <br />   &#41;; <br />      @stdcall; <br />      @returns&#40; &quot;eax&quot; &#41;; <br />      @external&#40; &quot;__imp__LookupIconIdFromDirectoryEx@20&quot; &#41;; <br /><br />const <br />   TRUE               &#58;= 1; <br />   CXICON            &#58;= 16; <br />   CYICON            &#58;= 16; <br />   IDI_GROUP_ICON      &#58;= 100;   // WinMine.exe group icon <br />   IDI_ICON            &#58;= 5;      // icon to change in calc.exe     <br />   RT_ICON            &#58;= w.RT_ICON; <br />   RT_GROUP_ICON      &#58;= w.RT_ICON + 11; <br /><br />static <br />   hFich1      &#58;dword; <br />   hRessource1 &#58;dword; <br />   pEntry      &#58;dword; <br />   nID         &#58;dword; <br />    <br />   hUpdateRes   &#58;dword; <br />   dwSizeRes   &#58;dword; <br />   bE_U_R      &#58;dword; <br />   bFreeLib      &#58;dword; <br />   bresult      &#58;dword; <br />    <br />begin Icons; <br /><br />   w.LoadLibrary&#40;&quot;.\winmine.exe&quot;&#41;; <br />   mov&#40; eax, hFich1 &#41;; <br />   stdout.put&#40;nl,&quot;LoadLibrary - hFich1 &quot;, hFich1 &#41;; <br /><br />   w.FindResource&#40; hFich1, val IDI_GROUP_ICON, val RT_GROUP_ICON &#41;; <br />   stdout.put&#40; nl,&quot;FindResource - hRessource1 &quot;, &#40;type dword eax&#41; &#41;; <br /><br />   w.LoadResource&#40; hFich1, eax &#41;; <br />   stdout.put&#40;nl,&quot;LoadResource - hResLoad &quot;, &#40;type dword eax&#41; &#41;; <br /><br />   w.LockResource&#40; eax &#41;; <br />   stdout.put&#40;nl,&quot;LockResource - lpResLock &quot;, &#40;type dword eax&#41; &#41;; <br />    <br />   LookupIconIdFromDirectoryEx&#40; <br />      &#40;type byte &#91;eax&#93;&#41;, TRUE, CXICON, CYICON, w.LR_DEFAULTCOLOR &#41;; <br />   mov&#40; eax, nID &#41;; <br />    stdout.put&#40;nl,&quot;LookupIconIdFromDirectoryEx - nID &quot;, nID&#41;; <br />     <br />    //-----------------------------------------------------------------// <br />     <br />   w.FindResource&#40; hFich1, nID, val RT_ICON &#41;; <br />   mov&#40; eax, hRessource1 &#41;; <br />   stdout.put&#40; nl,&quot;FindResource - hRessource1 &quot;, hRessource1 &#41;; <br />    <br />   w.SizeofResource&#40; hFich1, hRessource1 &#41;; <br />   mov&#40; eax, dwSizeRes &#41;; <br />   stdout.put&#40;nl,&quot;SizeofResource - dwSizeRes &quot;, dwSizeRes&#41;; <br />    <br />   w.LoadResource&#40; hFich1, hRessource1 &#41;; <br />   stdout.put&#40;nl,&quot;LoadResource - hResLoad &quot;, &#40;type dword eax&#41; &#41;; <br /><br />   w.LockResource&#40; eax &#41;; <br />   mov&#40; eax, pEntry &#41;; <br />   stdout.put&#40;nl,&quot;LockResource - lpResLock &quot;, pEntry&#41;; <br />          <br />   w.BeginUpdateResource&#40; &quot;.\calc.exe&quot;, false &#41;; <br />   mov&#40; eax, hUpdateRes&#41;; <br />   stdout.put&#40;nl,&quot;BeginUpdateResource - hUpdateRes &quot;, hUpdateRes&#41;; <br /><br />   mov&#40; pEntry, eax &#41;; <br /><br />   w.UpdateResource <br />   &#40; <br />      hUpdateRes, <br />      val RT_ICON, <br />      nID, <br />      nt.MAKELANGID&#40; nt.LANG_FRENCH, nt.SUBLANG_FRENCH &#41;,      <br />      &#91;eax&#93;, <br />      dwSizeRes <br />   &#41;; <br />   mov&#40;eax,bresult&#41;; <br />   stdout.put&#40;nl,&quot;UpdateResource - bresult &quot;, bresult&#41;; <br />      <br />   w.EndUpdateResource&#40;hUpdateRes, false&#41;; <br />   mov&#40;eax,bE_U_R&#41;; <br />   stdout.put&#40;nl,&quot;EndUpdateResource - bE_U_R &quot;,bE_U_R&#41;; <br /><br /><br />   // STEP 8 - clean up <br /><br />   w.FreeLibrary&#40;hFich1&#41;; <br />   mov&#40;eax,bFreeLib&#41;; <br />   stdout.put&#40;nl,&quot;FreeLibrary - bFreeLib &quot;,bFreeLib&#41;; <br /><br />end Icons; <br /></code></pre><br />and...<br />...got an error at compile-time :<br />nt : undefined symbol.<br />I suppose I missed something somewhere, but what ? :? <br /><br />Can you check that you have the same 2 files as I have &quot;icons.hla&quot; and &quot;winnt.hhf&quot;.<br /><br />I'd like to be sure about it (and have a working solution --&gt; an *.exe) before starting to study the functions themselves.<br /><br />By the way, where did you get the HLA-def. of MAKELANGID ?<br /><br />thanks,<br />and until soon,<br /><br />Juan.</div>
    <div class="meta">Posted on 2004-12-21 05:06:04 by Juan</div>
   </div>
   <div class="post" id="post-154523">
    <div class="subject"><a href="#post-154523">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body">Salut Juan,<br /><br /><pre><code><br />//#include&#40; &quot;winnt.hhf&quot; &#41;   &lt;--- ???<br /></code></pre><br /><br />What's the point of this  :? <br /><strong>nt</strong> is a namespace defined into winnt.hhf. If you don't include it, <strong>nt</strong> is undefined and the following code won't work<br /><br /><pre><code><br />   w.UpdateResource <br />   &#40; <br />      hUpdateRes, <br />      val RT_ICON, <br />      nID, <br />      nt.MAKELANGID&#40; nt.LANG_FRENCH, nt.SUBLANG_FRENCH &#41;,  &lt;-- error here <br />      &#91;eax&#93;, <br />      dwSizeRes <br />   &#41;; <br /></code></pre><br /><br />Encore un petit effort et on devrait y arriver  :)  <br />a+</div>
    <div class="meta">Posted on 2004-12-21 07:07:05 by arlequin</div>
   </div>
   <div class="post" id="post-154644">
    <div class="subject"><a href="#post-154644">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body">Salut Arlequin !<br /><br />I saw just now your last message, which I'll read carefully.<br /><br />I'll be back on january 10 th.<br /><br />Have a M.X. and H.N.Y. :alright: <br /><br />bye...<br /><br />until then,<br /><br />Juan.</div>
    <div class="meta">Posted on 2004-12-23 09:14:21 by Juan</div>
   </div>
   <div class="post" id="post-154659">
    <div class="subject"><a href="#post-154659">help needed, WIN32 MACRO's inside HLA ?</a></div>
    <div class="body"><div class="quote"><br />I'll be back on january 10 th.<br /></div><br />Ok, no problem. <br /><br /><div class="quote"><br />Have a M.X. and H.N.Y.<br /></div><br />Thanks, the same to you !  <img src="http://www.websmileys.com/sm/party/fest06.gif" /><br /><br />cheers !  <img src="http://www.websmileys.com/sm/drink/trink22.gif" /><br /><br />a bient?t</div>
    <div class="meta">Posted on 2004-12-23 16:21:32 by arlequin</div>
   </div>
  </div>
 </body>
</html>