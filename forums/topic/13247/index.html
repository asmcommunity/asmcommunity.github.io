<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Setting pixels in DIBitmap - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13247" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=13247">Setting pixels in DIBitmap</a></p>
   <div class="post" id="post-102700">
    <div class="subject"><a href="#post-102700">Setting pixels in DIBitmap</a></div>
    <div class="body">more of a syntax question than anything and if anyone can point me to a similar thread that would be great.<br /><br />what would this line do?   what it doesn't do work<br /><br />    MOV             DWORD ptr ,0FFFFFFh	   ; Set Pixel to White<br /><br />i am modifying MOBs MAKEREGION code, i am making a monochrome bitmap instead of a region<br />i have looked through eoins and scrontys code and have learnt alot from there.<br /><br />my code is below and the last line makes it crash. what i'm trying to do it set the pixel at 0,0 to white.<br /><br /><div class="quote">;********************************************************;<br />        INVOKE          CreateCompatibleDC, NULL         ; CREATE A DUMMY DC (-&gt;_hdc)<br />        MOV             _hdc, EAX                        ;<br />        INVOKE          CreateCompatibleDC, NULL         ; CREATE ANOTHER DC (-&gt;_mhdc)<br />        MOV             _mhdc, EAX                       ;<br />        INVOKE          SelectObject, _hdc, bhnd         ; SELECT THE BACKGROUND INTO THE DC<br />        MOV             bbhnd, EAX;                      ; KEEP THE OLD VALUE<br />                                                         ;<br />        lea EDX,bmi                                      ; EDX HOLDS THE BITMAP INFOE STRUCT<br />        MOV .BITMAPINFOHEADER.biSize,sizeof(BITMAPINFOHEADER)<br />	  MOV eax,PICTUREW                                 ; SET THE WIDTH<br />	  MOV .BITMAPINFOHEADER.biWidth, eax	         ;<br />	  MOV eax,PICTUREH                                 ; SET THE HEIGHT<br />	  MOV .BITMAPINFOHEADER.biHeight,eax          ;<br />	  MOV .BITMAPINFOHEADER.biPlanes,1            ; MONOCHROME<br />	  MOV .BITMAPINFOHEADER.biBitCount,32	   ; 32 BIT COLORS... DWORDS<br />	  MOV .BITMAPINFOHEADER.biCompression,BI_RGB  ; PIX STORAGE FORMAT<br />	  MOV .BITMAPINFOHEADER.biSizeImage,0         ;<br />	  MOV .BITMAPINFOHEADER.biXPelsPerMeter,0     ; <br />	  MOV .BITMAPINFOHEADER.biYPelsPerMeter,0     ;<br />	  MOV .BITMAPINFOHEADER.biClrUsed,0           ;<br />	  MOV .BITMAPINFOHEADER.biClrImportant,0      ;<br />	                                                   ;<br />        INVOKE CreateDIBSection,_mhdc,EDX,DIB_RGB_COLORS,addr bitPoint,0,0<br />        MOV             mhnd, EAX                        ; CREATE THE MASK BITMAP<br />                                                         ;<br />        XOR             EDI, EDI                         ; SET CURRENT PIXEL TO (0,0)<br />        XOR             ESI, ESI                         ; <br />        MOV             EDX, bitPoint                    ; EX POINTS TO THE BITMAPS' PIXELS<br />        INVOKE          GetPixel, _hdc, 0, 0             ; GET PIXELCOLOR AT X:0 Y:0 (-&gt;tcol)<br />        MOV             tcol, EAX                        ; NOW tcol HOLDS THE *TRANSPARENT* COLOR<br />        MOV             DWORD ptr ,0FFFFFFh	   ; Set Pixel to White<br />;********************************************************;<br /></div> <br /><br />i see alot of MOV DWORD ptr , blah blah...           what does this mean?</div>
    <div class="meta">Posted on 2003-05-12 22:02:06 by Crunchi</div>
   </div>
   <div class="post" id="post-102739">
    <div class="subject"><a href="#post-102739">Setting pixels in DIBitmap</a></div>
    <div class="body">MOV DWORD ptr , blah blah<br />=<br />mov dword ptr ,blah blah</div>
    <div class="meta">Posted on 2003-05-13 01:24:14 by roticv</div>
   </div>
   <div class="post" id="post-102755">
    <div class="subject"><a href="#post-102755">Setting pixels in DIBitmap</a></div>
    <div class="body">so if eax holds an address in memory, then..<br /><br /><br />mov DWORD ptr , 0FFFFFFh would move  0FFFFFFh to the place that eax refers to?<br /><br />then is ebx holds 4, 8, 12,... ?<br /><br />mov DWORD ptr , 0AAAAAAh would move 0AAAAAAh to the next byte?</div>
    <div class="meta">Posted on 2003-05-13 03:05:27 by Crunchi</div>
   </div>
   <div class="post" id="post-102761">
    <div class="subject"><a href="#post-102761">Setting pixels in DIBitmap</a></div>
    <div class="body">eax = pointer<br />ebx = displacement<br /><br />So mov DWORD ptr , 0AAAAAAh = move 0AAAAAAh to the next *dword*</div>
    <div class="meta">Posted on 2003-05-13 04:09:46 by roticv</div>
   </div>
   <div class="post" id="post-102762">
    <div class="subject"><a href="#post-102762">Setting pixels in DIBitmap</a></div>
    <div class="body">O.k my head is going to explode!<br /><br />if anyone had some time could you take a look at this code below.<br />it *should* when given a bitmap create a monochrome bitmap i can use as a mask and return<br />it through the third parameter.<br /><br />i can ffel that i'm close, there's just some piece of info i am missing..        ...well have been missing for about a week now. i have really tried to solve this on my own but...<br /><br /><div class="quote">; #######################################################;<br />                                                         ; <br />MAKEMASK  PROC USES ESI EDI EDX \                    ; MAKEMASK HWND, BITMAPHANDLE, BITMASK HANDLE<br />          hwnd: DWORD, bhnd: DWORD, mhnd: DWORD          ;         <br />          LOCAL  d_dc, f_dc, bbhnd: DWORD, bmhnd : DWORD,;<br />          tcol, _hdc : DWORD, _mhdc : DWORD, ps : PAINTSTRUCT<br />                                                         ;<br />;********************************************************;<br />;  GET THE DEVICE CONTEXTS + EDI, ESI AND TRANS COLOR                   ;<br />;  INITIALISED                                                                                           ;<br />;                                                                                                                ;<br />;  EDI, EDX = 0   -&gt; TOP LEFT OF BITMAP                                                  ;<br />;  TCOL = (0,0)   -&gt; TOP LEFT COLOUR TRANSPARENT                              ;<br />;                                                                                                               ;<br />;********************************************************;<br />        INVOKE          CreateCompatibleDC, NULL                                        ; CREATE A DUMMY DC (-&gt;_hdc)<br />        MOV             _hdc, EAX                                                                     ;<br />        INVOKE          CreateCompatibleDC, NULL                                        ; CREATE ANOTHER DC (-&gt;_mhdc)<br />        MOV             _mhdc, EAX                                                                   ;<br />        INVOKE          SelectObject, _hdc, bhnd                                      ; SELECT THE BACKGROUND INTO THE DC<br />        MOV             bbhnd, EAX;                      ; KEEP THE OLD VALUE<br />                                                         ;<br />        lea EDX,bmi                                      ; EDX HOLDS THE BITMAP INFOE STRUCT<br />        MOV .BITMAPINFOHEADER.biSize,sizeof(BITMAPINFOHEADER)<br />	  MOV eax,PICTUREW                                 ; SET THE WIDTH<br />	  MOV .BITMAPINFOHEADER.biWidth, eax	         ;<br />	  MOV eax,PICTUREH                                 ; SET THE HEIGHT<br />	  MOV .BITMAPINFOHEADER.biHeight,eax          ;<br />	  MOV .BITMAPINFOHEADER.biPlanes,1            ; MONOCHROME<br />	  MOV .BITMAPINFOHEADER.biBitCount,1	         ; SIMPLE MONOCHROME<br />	  MOV .BITMAPINFOHEADER.biCompression,BI_RGB  ; PIX STORAGE FORMAT<br />	  MOV .BITMAPINFOHEADER.biSizeImage,0         ;<br />	  MOV .BITMAPINFOHEADER.biXPelsPerMeter,0     ; <br />	  MOV .BITMAPINFOHEADER.biYPelsPerMeter,0     ;<br />	  MOV .BITMAPINFOHEADER.biClrUsed,0           ;<br />	  MOV .BITMAPINFOHEADER.biClrImportant,0      ;<br />	                                                   ;<br />        INVOKE CreateDIBSection,_mhdc,EDX,DIB_RGB_COLORS,addr bitPoint,0,0<br />        MOV             mhnd, EAX                        ; CREATE THE MASK BITMAP<br />        INVOKE SelectObject, _mhdc, mhnd<br />        MOV     bmhnd, eax<br />                                                         ;<br />        XOR             EDI, EDI                         ; SET CURRENT PIXEL TO (0,0)<br />        XOR             EDX, EDX                         ; <br />        INVOKE          GetPixel, _hdc, 0, 0             ; GET PIXELCOLOR AT X:0 Y:0 (-&gt;tcol)<br />        MOV             tcol, EAX                        ; NOW tcol HOLDS THE *TRANSPARENT* COLOR<br />        INVOKE          SetPixel, _mhdc, 0, 0, 1<br />;********************************************************;<br />;  THIS IS THE MAIN LOOP ----------&gt; START HERE          ;<br />;********************************************************;<br />_MLOOP: INVOKE          GetPixel, _hdc, EDI, EDX         ; GET PIXELCOLOR AT X:EDI Y:ESI...<br />        CMP             EAX, tcol                        ; *IF* CURRENT COLOR = TRANSPARENT???<br />        JZ              _SETBG                           ; THEN JUMP TO _SETBG<br />        JMP             _SETFG                           ; ELSE JUMP TO _SETFG<br />_SETBG: INVOKE          SetPixel, _mhdc, EDI, EDX, 1<br />        JMP             _INC                             ; INCREMENT THE COUNTERS<br />_SETFG: INVOKE          SetPixel, _mhdc, EDI, EDX, 0<br />        JMP             _INC                             ; INCREMENT THE COUNTERS<br />_INC:   INC             EDI                              ; NEXT COL IN ROW<br />        CMP             EDI, PICTUREW                    ; *IF* AT THE END OF THE ROW???<br />        JBE             _MLOOP                           ; NO? JUMP TO BEGINNING AND DO NEXT PIXEL; SAME ROW     <br />        XOR             EDI, EDI                         ; YES? SET X = 0<br />        INC             EDX                              ; Y = Y + 1 (NEXT ROW)<br />        CMP             EDX, PICTUREH                    ; *IF* HAVE WE REACHED THE VERY END?<br />        JB              _MLOOP                           ; NO? NEXT ROW OF BITMAP<br />;********************************************************;<br />_EXIT:  INVOKE          SelectObject, _hdc, bbhnd        ;<br />        INVOKE          SelectObject, _mhdc, bmhnd<br />        INVOKE          DeleteDC, _hdc                   ; CLOSE THE BITMAP-DCS...<br />        INVOKE          DeleteDC, _mhdc                  ;<br />        RET                                              ; <br />;********************************************************;<br />MAKEMASK          ENDP                                   ;<br /></div></div>
    <div class="meta">Posted on 2003-05-13 04:17:42 by Crunchi</div>
   </div>
   <div class="post" id="post-102788">
    <div class="subject"><a href="#post-102788">Setting pixels in DIBitmap</a></div>
    <div class="body">You can save some jmps<br /><pre><code><br />_MLOOP&#58; <br />INVOKE GetPixel, _hdc, EDI, EDX ; GET PIXELCOLOR AT X&#58;EDI Y&#58;ESI...<br />xor ecx,ecx ;&lt;-<br />CMP EAX, tcol<br />sete cl;&lt;-<br />INVOKE SetPixel, _mhdc, EDI, EDX, ecx;&lt;-<br />INC EDI ; NEXT COL IN ROW<br />CMP EDI, PICTUREW <br />jnz _MLOOP;&lt;- i think jnz works the same<br />XOR EDI, EDI ; YES? SET X = 0<br />INC EDX ; Y = Y + 1 &#40;NEXT ROW&#41;<br />CMP EDX, PICTUREH ; *IF* HAVE WE REACHED THE VERY END?<br />jb _MLOOP<br /></code></pre><br />Anyway I am not too sure about what went wrong, since I do not really play much with GDI.<br /><div class="quote">it *should* when given a bitmap create a monochrome bitmap i can use as a mask and return it through the third parameter.</div> <br />I don't really understand what you mean by that. You return value by eax, not parameter. the leave instructions clears the stuffs on the stack indirectly.</div>
    <div class="meta">Posted on 2003-05-13 07:21:20 by roticv</div>
   </div>
   <div class="post" id="post-102945">
    <div class="subject"><a href="#post-102945">Setting pixels in DIBitmap</a></div>
    <div class="body">what i meant was that at the end of this proc, mhnd would point to a monochrome bitmap that could be used to mask the input bitmap. <br /><br />i'll try what you said a little later today.<br /><br />thanks.<br /><br />BTW. what's              -&gt; sete cl</div>
    <div class="meta">Posted on 2003-05-13 22:29:35 by Crunchi</div>
   </div>
   <div class="post" id="post-102949">
    <div class="subject"><a href="#post-102949">Setting pixels in DIBitmap</a></div>
    <div class="body">Crunchi,<br /><br />I did something similar to bazik's problem... <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=13238&amp;pagenumber=2">http://www.asmcommunity.net/board/index.php?topic=13238&amp;pagenumber=2</a><br /><br />at the middle of the code, you can see an example on drawing pixels.<br /><br />you can remove all the unnecessary stuff except the 2 blits.<br /><br /><br /><br />you might want to look with your glasses or use a magnifying glass :tongue: , it's at the top left corner of the window.<br /><br />:grin:</div>
    <div class="meta">Posted on 2003-05-13 22:49:50 by arkane</div>
   </div>
   <div class="post" id="post-102984">
    <div class="subject"><a href="#post-102984">Setting pixels in DIBitmap</a></div>
    <div class="body">sete cl = set the value in cl to 1 if zero flag is set.</div>
    <div class="meta">Posted on 2003-05-14 02:03:48 by roticv</div>
   </div>
  </div>
 </body>
</html>