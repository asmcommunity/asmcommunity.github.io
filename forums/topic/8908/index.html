<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Lempel-Ziv compression - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=8908" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=8908">Lempel-Ziv compression</a></p>
   <div class="post" id="post-65504">
    <div class="subject"><a href="#post-65504">Lempel-Ziv compression</a></div>
    <div class="body">Hi!<br /><br />I made some assembler compression and decompression code available. It is small, very fast, and compresses quite well. I released it under the zlib license.<br /><br />If the attach does not work, it's also at: <a target="_blank" href="http://home19.inet.tele.dk/jibz/files/uflz20021112.zip">http://home19.inet.tele.dk/jibz/files/uflz20021112.zip</a></div>
    <div class="meta">Posted on 2002-11-12 07:33:15 by Jibz</div>
   </div>
   <div class="post" id="post-65506">
    <div class="subject"><a href="#post-65506">Looks like a Great piece of code!</a></div>
    <div class="body">However, there is one problem tho? Where is the masm code? :o <br />Hehe, Well I guess the conversion cant be that complicated? :alright:</div>
    <div class="meta">Posted on 2002-11-12 07:53:45 by natas</div>
   </div>
   <div class="post" id="post-65542">
    <div class="subject"><a href="#post-65542">Lempel-Ziv compression</a></div>
    <div class="body">The benefit of the NASM code is that it will work with other linkers as well. The code also works with DJGPP or on linux. E.g. you can assemble it using:<br /><br />  nasm -f win32 &lt;sourcefile&gt;<br /><br />and link it into your code using MS link. But yes, it should be fairly easy to translate to MASM too :-)<br /><br />Here are a few statistics in case somebody is wondering how it compares. I compared with LZOP -1 and comrades lz77 implementation:<br /><br />calgary corpus:<br /><br />  lz77:  7.8 sec  -&gt;  2,251,910<br />  lzop:  1.0 sec  -&gt;  1,582,455<br />  uflz:  1.5 sec  -&gt;  1,296,357<br /><br />canterbury corpus:<br /><br />  lz77:  5.0 sec  -&gt;  1,402,493<br />  lzop:  0.9 sec  -&gt;  1,151,925<br />  uflz:  1.2 sec  -&gt;    959,429<br /><br />gcc-2.7.1 source code:<br /><br />  lz77: 58.5 sec  -&gt; 17,995,196<br />  lzop:  4.0 sec  -&gt; 11,040,001<br />  uflz:  7.8 sec  -&gt;  8,203,678<br /><br />netscape.exe (from ACT):<br /><br />  lz77:  6.9 sec  -&gt;  2,114,336<br />  lzop:  1.1 sec  -&gt;  1,801,764<br />  uflz:  1.7 sec  -&gt;  1,639,410</div>
    <div class="meta">Posted on 2002-11-12 14:21:13 by Jibz</div>
   </div>
   <div class="post" id="post-65543">
    <div class="subject"><a href="#post-65543">Lempel-Ziv compression</a></div>
    <div class="body">Impressive <strong>Jibz</strong> - as always!  I will see what I<br />can do with the decompressor (size wise). :)</div>
    <div class="meta">Posted on 2002-11-12 14:40:58 by bitRAKE</div>
   </div>
   <div class="post" id="post-65547">
    <div class="subject"><a href="#post-65547">Lempel-Ziv compression</a></div>
    <div class="body">Sounds great! .. here is a 107 byte version to get you started ;-)</div>
    <div class="meta">Posted on 2002-11-12 15:36:48 by Jibz</div>
   </div>
   <div class="post" id="post-65624">
    <div class="subject"><a href="#post-65624">Lempel-Ziv compression</a></div>
    <div class="body">Here is a new package, including the 107 byte decompressor and a 352 byte version of the compression code. I also added makefiles for Borland C++ and GCC on Linux/FreeBSD/BeOS/QNX.<br /><br />Still no MASM version, though .. I might make one later :-)</div>
    <div class="meta">Posted on 2002-11-13 05:04:43 by Jibz</div>
   </div>
   <div class="post" id="post-65642">
    <div class="subject"><a href="#post-65642">Lempel-Ziv compression</a></div>
    <div class="body">Very nice, Jibz... :)<br />Thanks for sharing...<br />Does this beat apLib ?<br /><br />PS: Do you have any news about the delta format we talked about there is some week ? :cool: <br /><br />Regards,</div>
    <div class="meta">Posted on 2002-11-13 07:30:59 by JCP</div>
   </div>
   <div class="post" id="post-65658">
    <div class="subject"><a href="#post-65658">Lempel-Ziv compression</a></div>
    <div class="body">Hi Readiosys!<br /><br />It beats aPLib on compression speed, but the ratios are not as good. Below is the table again, with the addition of the results for aPLib v0.36, and my current development code (ffce) at level 1.<br /><br />I am still working on the delta code. I think it's going to be quite good when I get a little more work done on it .. I'll e-mail you when I've got something more solid :-)<br /><br />calgary corpus:<br /><br />lz77:   7.8 sec  -&gt;  2,251,910<br />lzop:   1.0 sec  -&gt;  1,582,455<br />uflz:   1.5 sec  -&gt;  1,296,357<br />apl : 137.5 sec  -&gt;  1,115,349<br />ffce:  10.8 sec  -&gt;  1,087,644<br /><br />canterbury corpus:<br /><br />lz77:   5.0 sec  -&gt;  1,402,493<br />lzop:   0.9 sec  -&gt;  1,151,925<br />uflz:   1.2 sec  -&gt;    959,429<br />apl : 111.3 sec  -&gt;    774,661<br />ffce:   7.2 sec  -&gt;    763,029<br /><br />gcc-2.7.1 source code:<br /><br />lz77:  58.5 sec  -&gt; 17,995,196<br />lzop:   4.0 sec  -&gt; 11,040,001<br />uflz:   7.8 sec  -&gt;  8,203,678<br />apl : 797.5 sec  -&gt;  7,212,418<br />ffce:  63.7 sec  -&gt;  6,253,056<br /><br />netscape.exe (from ACT):<br /><br />lz77:   6.9 sec  -&gt;  2,114,336<br />lzop:   1.1 sec  -&gt;  1,801,764<br />uflz:   1.7 sec  -&gt;  1,639,410<br />apl :  89.2 sec  -&gt;  1,351,048<br />ffce:  11.0 sec  -&gt;  1,346,094</div>
    <div class="meta">Posted on 2002-11-13 09:50:13 by Jibz</div>
   </div>
   <div class="post" id="post-65706">
    <div class="subject"><a href="#post-65706">Lempel-Ziv compression</a></div>
    <div class="body">What are the compressors in that list?</div>
    <div class="meta">Posted on 2002-11-13 15:17:45 by comrade</div>
   </div>
   <div class="post" id="post-65738">
    <div class="subject"><a href="#post-65738">Lempel-Ziv compression</a></div>
    <div class="body"><strong>comrade:</strong> <br /><br />lz77 - comrade lz77 implementation<br />lzop - Markus FXJ Oberhumer lzop file compressor<br />apl - Jibz aPLib<br />ffce - Jibz new unreleased supa-duppa compressor :)<br />uflz - again Jibz small compressor (this thread creation reason)<br /><br />...</div>
    <div class="meta">Posted on 2002-11-14 00:28:08 by TBD</div>
   </div>
   <div class="post" id="post-65794">
    <div class="subject"><a href="#post-65794">Lempel-Ziv compression</a></div>
    <div class="body">I'm down to 92 with small change to compression algo (FASM code):<pre><code>uflz_depack_asm_tiny&#58;<br />        pushad<br />        mov ebp, esp<br />        mov esi, &#91;ebp + &#40;8+1&#41;*4&#93; ; source<br />        mov edi, &#91;ebp + &#40;8+2&#41;*4&#93; ; dest<br />        mov ebx, &#91;ebp + &#40;8+3&#41;*4&#93; ; length<br />;       cld ; not needed on my system<br />        xor eax, eax<br />        add ebx, edi<br />.literal&#58;<br />        movsb<br />.nexttag&#58;<br />        cmp edi, ebx<br />        jnc done<br /><br />        call word getbit<br />        jnc .literal<br /><br />        call word getgamma ; high pos<br />        lea edx, &#91;ecx-2&#93;<br /><br />        call word getgamma ; len<br />        shl edx, 8<br /><br />        mov dl, &#91;esi&#93; ; low pos<br />        inc esi<br /><br />        not edx ;= inc edx | neg edx<br />        push esi<br />        lea esi, &#91;edi + edx&#93;<br />        rep movsb<br />        movsb<br />        movsb<br />        pop esi<br />        jmp .nexttag<br /><br />getbit&#58; add eax, eax<br />        jne .A<br />        lodsd<br />        add eax, eax<br />        inc eax<br />.A&#58;     ret<br /><br />getgamma&#58;<br />        xor ecx, ecx<br />        inc ecx<br />.A&#58;     call word getbit<br />        adc ecx, ecx<br />        call word getbit<br />        jc .A<br />        ret<br /><br />done&#58;<br />        sub edi, &#91;ebp + &#40;8+2&#41;*4&#93;<br />        mov &#91;ebp + &#40;8+3&#41;*4&#93;, edi<br />        popad<br />        ret 8<br /><br />; Usage&#58;<br />;        push length<br />;        push destination<br />;        push source<br />;        call uflz_depack_asm_tiny<br />;<br />;        pop unpacked_length<br /><br />; Changes to compression&#58;<br />; - reverse order of matchpos, matchlen store<br />;   &#40;store matchlen, then matchpos&#41;</code></pre>I haven't had time to test this, yet.</div>
    <div class="meta">Posted on 2002-11-14 09:53:52 by bitRAKE</div>
   </div>
   <div class="post" id="post-65812">
    <div class="subject"><a href="#post-65812">Lempel-Ziv compression</a></div>
    <div class="body">Thanks for the nice optimisations, bitRAKE! I especially liked the way you got rid of the 0x8000000 :-)<br /><br />I was not able to get the 'call word label' trick to work -- the program crashed (Win32).<br /><br />Attached is my latest version, compression = 706/342 bytes, and decompression = 146/99 bytes. I removed the uninitialised data, and use stack variables and a user supplied workmem instead.</div>
    <div class="meta">Posted on 2002-11-14 14:43:11 by Jibz</div>
   </div>
   <div class="post" id="post-66019">
    <div class="subject"><a href="#post-66019">Lempel-Ziv compression</a></div>
    <div class="body">I was playing around with converting the code to MASM style, from which I learnt 2 things:<br /><br /><ul><br />[*]@@: style labels are <strong>not</strong> local to macros<br />[*]when assembling to coff format, ml.exe does something for each element in an uninitialised array, which means that assembling:<br /><pre><code>.386<br /><br />.model flat,stdcall<br /><br />.data?<br /><br />buffer dd 4*65536 dup &#40;?&#41; ; 1 mb of workmem<br /><br />end</code></pre><br />takes 1 minute. Assembling to omf format does not have this problem.<br /><br /><br />Attached is the latest version, compression = 646/328 bytes, and decompression = 146/99 bytes. I added a conversion to 16-bit 8086 assembler (which I guess is of little interest to the Win32ASM community ;-).</div>
    <div class="meta">Posted on 2002-11-16 10:03:49 by Jibz</div>
   </div>
  </div>
 </body>
</html>