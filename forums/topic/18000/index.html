<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Maybe Ultrano can answer this - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=18000" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=38">Object Oriented Programming</a> &raquo; <a href="../?id=18000">Maybe Ultrano can answer this</a></p>
   <div class="post" id="post-138945">
    <div class="subject"><a href="#post-138945">Maybe Ultrano can answer this</a></div>
    <div class="body">This is really a COM question, but I'll post it here anyways and hope for the best :)<br />If a class inherits from IUnknown, then why is it necessary to declare the IUnknown Methods in the inheriting class?<br />I can understand that if the class was inheriting from some other class that maybe we'd need to add them, but in the vanilla case?<br /><br />This is for Ultrano:<br /><br />class Blah, IUnknown, COM compatible<br />;&lt;----My assumption is that IUnknown Methods are ALREADY HERE<br />virtual ClassMethod<br />endclass<br /><br />class Blah, , COM compatible<br />virtual QueryInterface<br />virtual AddRef<br />virtual Release<br />virtual ClassMethod<br />endclass<br /><br />class Blah, IUnknown, COM compatible<br />virtual QueryInterface<br />virtual AddRef<br />virtual Release<br />virtual ClassMethod<br />endclass<br /><br />In this third example, are we or are we not doubling up on the IUnknown methods? Assuming that I have created an IUnknown Class that contains only the IUnknown methods, it should be enough just to inherit from it, right?<br />There's no reason for all classes to have their OWN IUnknown really, is there?<br />I'm just thinking back to something I read on msdn along the lines of &quot;dx classes always derive from IUnknown&quot;...<br /><br />This may seem like a silly question I have posed, but bear in mind that I am staring at a bunch of C++ class defs, and they use the third style of declaring that they inherit from IUnknown and also (re)defining those Methods each time, which makes it appear as though they are overriding IUnknown for absolutely no reason (just extra call overhead and no benefit).<br /><br />Anyone else have an opinion please chime in :)</div>
    <div class="meta">Posted on 2004-04-14 09:39:11 by Homer</div>
   </div>
   <div class="post" id="post-139293">
    <div class="subject"><a href="#post-139293">Maybe Ultrano can answer this</a></div>
    <div class="body">I really don't think I can help :) <br />overriding doesn't add any overhead - the virtual table sits there never changed, and it's hit or miss whether to jump to IUnknown's empty functions, or to Blah's empty functions.</div>
    <div class="meta">Posted on 2004-04-18 04:36:51 by Ultrano</div>
   </div>
   <div class="post" id="post-139643">
    <div class="subject"><a href="#post-139643">Maybe Ultrano can answer this</a></div>
    <div class="body">Thanks anyway.. maybe this will clear things up...<br />(taken from masm COM folder))<br />If a COM class contains several interfaces that inherit from IUnknown, EACH INTERFACE should have its own IUnknown methods ???<br /><br /><pre><code><br />_vtable     STRUCT      <br />IAsmCtrl<br />                            DWORD   QueryInterface<br />                            DWORD   AddRef<br />                            DWORD   Release<br />                            DWORD   GetTypeInfoCount<br />                            DWORD   GetTypeInfo<br />                            DWORD   GetIDsOfNames<br />                            DWORD   Invoke_<br />                            DWORD   put_Value<br />                            DWORD   get_Value<br />                            DWORD   Raise<br />                            DWORD   put_ForeColor<br />                            DWORD   get_ForeColor<br />                            DWORD   put_BackColor<br />                            DWORD   get_BackColor<br />                            DWORD   AboutBox <br />IOleObject                  DWORD   QueryInterface<br />                            DWORD   AddRef<br />                            DWORD   Release<br />                            DWORD   IOleObject_SetClientSite<br />                            DWORD   IOleObject_GetClientSite<br />                            DWORD   IOleObject_SetHostNames<br />                            DWORD   IOleObject_Close<br />                            DWORD   IOleObject_SetMoniker<br />                            DWORD   IOleObject_GetMoniker<br />                            DWORD   IOleObject_InitFromData<br />                            DWORD   IOleObject_GetClipboardData<br />                            DWORD   IOleObject_DoVerb<br />                            DWORD   IOleObject_EnumVerbs<br />                            DWORD   IOleObject_Update<br />                            DWORD   IOleObject_IsUpToDate<br />                            DWORD   IOleObject_GetUserClassID<br />                            DWORD   IOleObject_GetUserType<br />                            DWORD   IOleObject_SetExtent<br />                            DWORD   IOleObject_GetExtent<br />                            DWORD   IOleObject_Advise<br />                            DWORD   IOleObject_Unadvise<br />                            DWORD   IOleObject_EnumAdvise<br />                            DWORD   IOleObject_GetMiscStatus<br />                            DWORD   IOleObject_SetColorScheme<br />IProvideClassInfo           DWORD   QueryInterface<br />                            DWORD   AddRef<br />                            DWORD   Release<br />                            DWORD   IProvideClassInfo_GetClassInfo    <br />IPersist                    DWORD   QueryInterface                       <br />                            DWORD   AddRef<br />                            DWORD   Release<br />                            DWORD   IPersist_GetClassID<br />IPersistStreamInit          DWORD   QueryInterface                       <br />                            DWORD   AddRef<br />                            DWORD   Release<br />                            DWORD   IPersist_GetClassID<br />                            DWORD   IPersistStreamInit_IsDirty<br />                            DWORD   IPersistStreamInit_Load<br />                            DWORD   IPersistStreamInit_Save<br />                            DWORD   IPersistStreamInit_GetSizeMax<br />                            DWORD   IPersistStreamInit_InitNew<br /><br />IPersistPropertyBag         DWORD   QueryInterface                       <br />                            DWORD   AddRef<br />                            DWORD   Release<br />                            DWORD   IPersist_GetClassID<br />                            DWORD   IPersistPropertyBag_InitNew<br />                            DWORD   IPersistPropertyBag_Load<br />                            DWORD   IPersistPropertyBag_Save<br /><br />IViewObject                 DWORD   QueryInterface<br />                            DWORD   AddRef<br />                            DWORD   Release<br />                            DWORD   IViewObject_Draw<br />                            DWORD   IViewObject_GetColorSet	<br />                            DWORD   IViewObject_Freeze<br />                            DWORD   IViewObject_Unfreeze<br />                            DWORD   IViewObject_SetAdvise<br />                            DWORD   IViewObject_GetAdvise		<br />IViewObject2                DWORD   IViewObject2_GetExtent<br />ISpecifyPropertyPages       DWORD   QueryInterface<br />                            DWORD   AddRef<br />                            DWORD   Release<br />                            DWORD   ISpecifyPropertyPages_GetPages<br />ICategorizeProperties       DWORD   QueryInterface<br />                            DWORD   AddRef<br />                            DWORD   Release<br />                            DWORD   ICategorizeProperties_MapPropertyToCategory <br />                            DWORD   ICategorizeProperties_GetCategoryName <br />_vtable     ENDS<br /></code></pre><br /><br /><br />mmmk ... that means that it's simply NOT POSSIBLE to just Inherit Iunknown for the entire class, and furthermore, we have a name collision issue to contend with??? Are the duplicate named entries in this vtable actually pointing to the same or to different versions of the named functions?<br />:)</div>
    <div class="meta">Posted on 2004-04-21 02:40:45 by Homer</div>
   </div>
   <div class="post" id="post-139700">
    <div class="subject"><a href="#post-139700">Maybe Ultrano can answer this</a></div>
    <div class="body">Each interface represents a different class of objects.<br /><br />When inheriting, the (virtual function) entries are repeated so that any function from the base class can be found at the same offset for every derived class. Using a different entry value for the derived class is the same as overriding the virtual function.</div>
    <div class="meta">Posted on 2004-04-21 16:18:47 by tenkey</div>
   </div>
   <div class="post" id="post-139726">
    <div class="subject"><a href="#post-139726">Maybe Ultrano can answer this</a></div>
    <div class="body">I think this is the ATC equivalent:<br /><pre><code><br /><br />&#91;color=blue&#93;class&#91;/color&#93; IDispatch,IUnknown,COM compatible ; for VB I guess<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetTypeInfoCount<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetTypeInfo<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetIDsOfNames<br />	&#91;color=green&#93;virtual&#91;/color&#93; Invoke_<br />&#91;color=blue&#93;endclass&#91;/color&#93;<br /><br /><br />&#91;color=blue&#93;class&#91;/color&#93; IAsmCtrl,IDispatch,COM compatible ; actually IAsmCtrl is more messy<br />	&#91;color=green&#93;virtual&#91;/color&#93; put_Value<br />	&#91;color=green&#93;virtual&#91;/color&#93; get_Value<br />	&#91;color=green&#93;virtual&#91;/color&#93; Raise<br />	&#91;color=green&#93;virtual&#91;/color&#93; put_ForeColor<br />	&#91;color=green&#93;virtual&#91;/color&#93; get_ForeColor<br />	&#91;color=green&#93;virtual&#91;/color&#93; put_BackColor<br />	&#91;color=green&#93;virtual&#91;/color&#93; get_BackColor<br />	&#91;color=green&#93;virtual&#91;/color&#93; AboutBox <br />	long m_isDirty<br />	long m_advf<br />	long m_pClientSite<br />	long m_pViewAdviseSink<br />	long m_pAdviseHolder<br />	long m_himetricExtent<br />	long m_pixelExtent<br />	long m_Value<br /> 	long m_BackColor<br />	long m_ForeColor<br />&#91;color=blue&#93;endclass&#91;/color&#93;<br /><br />&#91;color=blue&#93;class&#91;/color&#93; IOleObject,IUnknown,COM compatible<br />	&#91;color=green&#93;virtual&#91;/color&#93; SetClientSite<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetClientSite<br />	&#91;color=green&#93;virtual&#91;/color&#93; SetHostNames<br />	&#91;color=green&#93;virtual&#91;/color&#93; Close<br />	&#91;color=green&#93;virtual&#91;/color&#93; SetMoniker<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetMoniker<br />	&#91;color=green&#93;virtual&#91;/color&#93; InitFromData<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetClipboardData<br />	&#91;color=green&#93;virtual&#91;/color&#93; DoVerb<br />	&#91;color=green&#93;virtual&#91;/color&#93; EnumVerbs<br />	&#91;color=green&#93;virtual&#91;/color&#93; Update<br />	&#91;color=green&#93;virtual&#91;/color&#93; IsUpToDate<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetUserClassID<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetUserType<br />	&#91;color=green&#93;virtual&#91;/color&#93; SetExtent<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetExtent<br />	&#91;color=green&#93;virtual&#91;/color&#93; Advise<br />	&#91;color=green&#93;virtual&#91;/color&#93; Unadvise<br />	&#91;color=green&#93;virtual&#91;/color&#93; EnumAdvise<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetMiscStatus<br />	&#91;color=green&#93;virtual&#91;/color&#93; SetColorScheme<br />&#91;color=blue&#93;endclass&#91;/color&#93;<br /><br />&#91;color=blue&#93;class&#91;/color&#93; IProvideClassInfo,IUnknown,COM compatible<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetClassInfo<br />&#91;color=blue&#93;endclass&#91;/color&#93;<br />&#91;color=blue&#93;class&#91;/color&#93; IPersist,IUnknown,COM compatible<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetClassID<br />&#91;color=blue&#93;endclass&#91;/color&#93;<br />&#91;color=blue&#93;class&#91;/color&#93; IPersistStreamInit,IPersist,COM compatible<br />	&#91;color=green&#93;virtual&#91;/color&#93; IsDirty<br />	&#91;color=green&#93;virtual&#91;/color&#93; Load<br />	&#91;color=green&#93;virtual&#91;/color&#93; Save<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetSizeMax<br />	&#91;color=green&#93;virtual&#91;/color&#93; InitNew<br />&#91;color=blue&#93;endclass&#91;/color&#93;<br />&#91;color=blue&#93;class&#91;/color&#93; IPersistPropertyBag,IPersist,COM compatible<br />	&#91;color=green&#93;virtual&#91;/color&#93; InitNew<br />	&#91;color=green&#93;virtual&#91;/color&#93; Load<br />	&#91;color=green&#93;virtual&#91;/color&#93; Save<br />&#91;color=blue&#93;endclass&#91;/color&#93;<br />&#91;color=blue&#93;class&#91;/color&#93; IViewObject,IUnknown,COM compatible<br />	&#91;color=green&#93;virtual&#91;/color&#93; Draw<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetColorSet<br />	&#91;color=green&#93;virtual&#91;/color&#93; Freeze<br />	&#91;color=green&#93;virtual&#91;/color&#93; unfreeze<br />	&#91;color=green&#93;virtual&#91;/color&#93; SetAdvise<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetAdvise<br />&#91;color=blue&#93;endclass&#91;/color&#93;<br />&#91;color=blue&#93;class&#91;/color&#93; IViewObject2,IViewObject,COM compatible<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetExtent<br />&#91;color=blue&#93;endclass&#91;/color&#93;<br />&#91;color=blue&#93;class&#91;/color&#93; ISpecifyPropertyPages,IUnknown,COM compatible<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetPages<br />&#91;color=blue&#93;endclass&#91;/color&#93;<br />&#91;color=blue&#93;class&#91;/color&#93; ISpecifyPropertyPages,IUnknown,COM compatible<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetPages<br />&#91;color=blue&#93;endclass&#91;/color&#93;<br />&#91;color=blue&#93;class&#91;/color&#93; ICategorizeProperties,IUnknown,COM compatible<br />	&#91;color=green&#93;virtual&#91;/color&#93; MapPropertyToCategory<br />	&#91;color=green&#93;virtual&#91;/color&#93; GetCategoryName<br />&#91;color=blue&#93;endclass&#91;/color&#93;<br /></code></pre></div>
    <div class="meta">Posted on 2004-04-22 02:40:23 by Ultrano</div>
   </div>
   <div class="post" id="post-139751">
    <div class="subject"><a href="#post-139751">Maybe Ultrano can answer this</a></div>
    <div class="body">Thanks very much :)</div>
    <div class="meta">Posted on 2004-04-22 08:23:36 by Homer</div>
   </div>
  </div>
 </body>
</html>