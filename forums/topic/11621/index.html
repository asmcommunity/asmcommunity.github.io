<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>To Hutch - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=11621" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=11621">To Hutch</a></p>
   <div class="post" id="post-87998">
    <div class="subject"><a href="#post-87998">To Hutch</a></div>
    <div class="body">Hi Hutch,<br /><br />I had a major PC disaster on 02-28-2003, I won't go into the gory details.<br /><br />Aynhow I had to rebuild my systems from scratch and I'm about 85% done.<br />I had to download your Masm32 V8 package for my AsmEdit package, <br />(I lost all of the previous versions) and I can no longer assembler any of my <br />programs that use the IShellFolder Interface it looks like all of the IID_Ixxxxx <br />references are gone from the Shell32.lib file. <br /><br />Was there a reason for that?<br /><br />I had someone send me a previous version of your Include/Lib files and they<br />work ok.<br /><br />I was going to try to patch something together, but I can not figure out where<br />you found the IID_Ixxxxx input  when you built the Shell32.lib file.<br /><br />I hate to start getting a bunch of emails from folks saying they can not assemble<br />some of my programs after they updated the Masm32 package to V8.<br /><br />Thanks for any help.<br /><br />Ewayne</div>
    <div class="meta">Posted on 2003-03-18 19:07:33 by Ewayne</div>
   </div>
   <div class="post" id="post-88033">
    <div class="subject"><a href="#post-88033">To Hutch</a></div>
    <div class="body">Ewayne,<br /><br />I think I know what has happened, to get the package size down, I build the libraries from the include files but the include files only contain exported API function calls so the iShell interface will not be in the library.<br /><br />If you have access at a standard Microsoft issued library, try running it instead and produce an include file from it if you need the API function prototypes.<br /><br />If this is not the problem, let me know and I will try and find something else.<br /><br />Sorry to hear about the crash, I had a fatal one in 1999 that lost 6 months work on me so I have been doing multiple backups across different machines and writing CDs since.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-03-19 01:31:56 by hutch--</div>
   </div>
   <div class="post" id="post-88039">
    <div class="subject"><a href="#post-88039">To Hutch</a></div>
    <div class="body">These IID_ externals should be found in UUID.LIB</div>
    <div class="meta">Posted on 2003-03-19 01:56:34 by japheth</div>
   </div>
   <div class="post" id="post-88083">
    <div class="subject"><a href="#post-88083">To Hutch</a></div>
    <div class="body">To japheth:<br /><br />The IID_ externals are not in my UUID.LIB.<br /><br />Thanks,<br /><br />Ewayne</div>
    <div class="meta">Posted on 2003-03-19 08:34:00 by Ewayne</div>
   </div>
   <div class="post" id="post-88090">
    <div class="subject"><a href="#post-88090">To Hutch</a></div>
    <div class="body">To Hutch:<br /><br />I do not have access to a standard Microsoft issued library.<br /><br />I'm a little confused (not unusual), in the previous version of Masm32<br />Include/Lib files that someone sent me the shell32.lib has the IID_externals<br />but the Shell32.inc has no reference to them. How did the lib build program<br />get the information for the IID_externals?<br /><br />I think I can build a seperate .lib file with the IID_externals in it, but I would<br />like to know how you did it with the previous versions of Masm32.<br /><br />I know you put a ton of work in Masm32 V8, but don't you think you should<br />put the IID_externals back in in case someone wants to write a program<br />using the IShellFolder Interface and IID_externals? (just wondering)<br /><br />About  my disaster I had two internal drives and one large external scsi<br />fixed drive and one 2gig removable scsi drive and I could boot from all four.<br />I thought I was safe (wrong)<br /><br />The three fixed drives got toasted and I got lazy backing up the the removable.<br /><br />I got three new drives for the old PC and I bought a new 2.8GHz 1gig mem PC,<br />setup with three drives and I have a cdRW drive for both PC's plus a remote backup.<br /><br />If I do my daily backups like I should maybe I'll be safe this time.<br /><br />What bug's me is that I was writting a RichEdit control to replace M$ RichEdit and<br />it was in the final stage and I lost most of that work.<br /><br />Thanks,<br /><br />Ewayne</div>
    <div class="meta">Posted on 2003-03-19 09:13:38 by Ewayne</div>
   </div>
   <div class="post" id="post-88091">
    <div class="subject"><a href="#post-88091">Which version do you think you need?</a></div>
    <div class="body">I have versions 7,5,4, right on my backup drive.<br /><br />Just let me know and I will post what you need.<br /><br />Regards,  P1</div>
    <div class="meta">Posted on 2003-03-19 09:20:50 by Pone</div>
   </div>
   <div class="post" id="post-88098">
    <div class="subject"><a href="#post-88098">To Hutch</a></div>
    <div class="body">To Pone:<br /><br />Thanks for the feedback.<br /><br />I have my AsmEdit package working with a previous release of the Include/Lib files<br />that someone has sent me.<br /><br />I can use Masm32 V8 except I think only the Shell32 files need to be changed.<br /><br />Lets wait for Hutch's response.<br /><br />Thanks again.<br /><br />Ewayne</div>
    <div class="meta">Posted on 2003-03-19 09:46:25 by Ewayne</div>
   </div>
   <div class="post" id="post-88252">
    <div class="subject"><a href="#post-88252">To Hutch</a></div>
    <div class="body">Ewayne,<br /><br />Here are the two libraries from the PLATFORMSDK for win2k. They are shell32.lib and uuid.lib.<br /><br />What I need you to do is try them out one at a time to see if this is the problem. I think what has happened is that the technique I use to build thwe libraries in MASM32 v8 only builds normal exported API function calles that use the STDCALL convention. I added the wsprintfA prototype manually and it is included in the normal lib as well.<br /><br />This means that function accessed in other way are not in the library and this is probably what the problem is. If the code works with the Microsoft libraries it verifies what the problem was.<br /><br />Please let me know what happens with these libraries.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-03-19 20:03:53 by hutch--</div>
   </div>
   <div class="post" id="post-88268">
    <div class="subject"><a href="#post-88268">To Hutch</a></div>
    <div class="body">To Hutch,<br /><br />The Shell32.lib that you sent works great on the programs that I could not assemble<br />with the Masm32 V8 Shell32.lib, I'm not using any functions that are in the Uuid.lib so<br />I didn't need to use it.<br /><br />Thanks,<br /><br />Ewayne</div>
    <div class="meta">Posted on 2003-03-19 20:43:16 by Ewayne</div>
   </div>
   <div class="post" id="post-88327">
    <div class="subject"><a href="#post-88327">To Hutch</a></div>
    <div class="body">Ewayne,<br /><br />thats a good result as it identified the problem straight away. I would enclose the library with your package so that the problem does not occur with users at all. It is from the Platformsdk so its should be legal to do so.<br /><br />All you would need to do is have some instructions so that the user can place the library correctly and everything will work.<br /><br />I am stuck with the idea of building the libraries as it produced a 40% bandwidth drop with the MASM32 package. The download rate has been very high and it was straining a number of servers from members who have been kind enough to help out so I had to change how it was done.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-03-20 01:32:16 by hutch--</div>
   </div>
   <div class="post" id="post-88363">
    <div class="subject"><a href="#post-88363">To Hutch</a></div>
    <div class="body">Ewayne,<br /><br />Do you have the actual prototypes for the functions you were after from the shell32.lib library ? The toy for building the libraries can handle both STDCALL and C calling conventions so if its C calling, all I need to do is add the prototypes manually and the functions will be included in the library.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-03-20 04:30:25 by hutch--</div>
   </div>
   <div class="post" id="post-88424">
    <div class="subject"><a href="#post-88424">To Hutch</a></div>
    <div class="body">To Hutch:<br /><br />The following are the only prototypes that I use.<br /><br />CLSID_ShellDesktop<br />CLSID_ShellLink<br /><br />IDD_IUnknown<br />IID_IContextMenu<br />IID_IContextMenu2<br />IID_IShellExtInit<br />IID_IShellPropSheetExt<br />IID_IExtractIcon<br />IID_IShellLink<br />IID_IShellCopyHook<br />ID_IFileViewerSite<br />IID_IFileViewer<br />IID_IEnumIDList<br />IID_IShellFolder<br /><br />I have tried adding them in your V8 Shell32.inc and bulding<br />a new Shell32.lib the entries show up in the Shell32.lib, but<br />it does not work. (I must be doing something wrong)<br /><br />Thanks,<br /><br />Ewayne</div>
    <div class="meta">Posted on 2003-03-20 08:44:33 by Ewayne</div>
   </div>
   <div class="post" id="post-88555">
    <div class="subject"><a href="#post-88555">To Hutch</a></div>
    <div class="body">Ewayne,<br /><br />problem is I have no way of testing what these functions do but give this a try if you have not already done it.<br /><br />For each function in the list, try it with the C calling convention with VARARG.<br /><br />IID_IShellFolder PROTO C :VARARG<br /><br />I had a look through the shell32.lib and there are a big pile of functions including the ones you require that do not have parameter data like STDCALL ones but they still appear to only be export entries, not static code in a library so its worth trying them as C calling.<br /><br />I would be interested to see if this works.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-03-20 17:38:33 by hutch--</div>
   </div>
   <div class="post" id="post-88591">
    <div class="subject"><a href="#post-88591">To Hutch</a></div>
    <div class="body">To Hutch:<br /><br />The:<br /><br />IID_IShellFolder PROTO C :VARARG (Works ok)<br /><br />IID_IContextMenu PROTO C :VARARG (Does not work ok)<br /><br />The program assembles and links ok, but when you try to execute<br />it I get an:<br /><br />Error Starting Program<br />The xxxx.exe file is linked to missing export SHELL32.DLL:IID_IContextMenu<br />message.<br /><br />Looking in my Windows.inc I can not see where there should be a difference<br />between the IID_IShellFolder and the IID_IContextMenu.<br /><br />Any other suggestions?<br /><br />If you would like I could put together a little program that uses the two<br />interfaces and send it to you.<br /><br />Thanks,<br /><br />Ewayne</div>
    <div class="meta">Posted on 2003-03-20 20:22:55 by Ewayne</div>
   </div>
   <div class="post" id="post-88646">
    <div class="subject"><a href="#post-88646">To Hutch</a></div>
    <div class="body">Hi Hutch,<br /><br />these IID_xxx definitions are references to COM interface IDs. When referencing such an external, the linker includes such an IID (which results in 16 data bytes included, i.e.:  {12345678-1234-1234-01293940596696}) .So I would suggest to define it with EXTERNDEF in include files (&quot;externdef stdcall IID_xxxx:IID&quot;), not with PROTO statement. But inside the lib these 16 bytes must be defined!<br /><br />Japheth</div>
    <div class="meta">Posted on 2003-03-21 03:24:56 by japheth</div>
   </div>
   <div class="post" id="post-88914">
    <div class="subject"><a href="#post-88914">To Hutch</a></div>
    <div class="body">To Hutch:<br /><br />I've tried 37 different ways of writing a Shell32.asm and then<br />creating a Shell32.lib, I can get it close, but I still can not get<br />the IID_IContextMenu interface to work.<br /><br /><br />I usually don't give up on a problem, but it looks like there is <br />something I don't know about.<br /><br />So for the time being I will just include your Masm32 V7 Shell32.lib<br />with AsmEdit.<br /><br />But what are you going to do with your package if someone wants<br />to write a program using a IID_xxxx interface?<br /><br />Thanks,<br /><br />Ewayne</div>
    <div class="meta">Posted on 2003-03-21 21:53:11 by Ewayne</div>
   </div>
   <div class="post" id="post-88933">
    <div class="subject"><a href="#post-88933">To Hutch</a></div>
    <div class="body">Ewayne,<br /><br />The suggestion that Japheth made is an interesting one but I don't know how the original Microsoft library was made with the COM interface. The EXTERNDEF part makes sense but I don't know enough about the COM interface to try and emulate it in ML.EXE to build the import library.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-03-21 23:58:38 by hutch--</div>
   </div>
   <div class="post" id="post-89015">
    <div class="subject"><a href="#post-89015">To Hutch</a></div>
    <div class="body">Hi,<br /><br />most of these shell IID are made public in SHLGUID.H from SDK. So to define a public IID_IContextMenu for example this may work: <br /><br /><pre><code><br />DEFINE_SHLGUID macro name, l, w1, w2<br />s&amp;name	textequ &lt;&#123;l, w1, w2, &#123;0C0h,0,0,0,0,0,0,046h&#125;&#125;&gt;<br />	endm<br /><br />DEFINE_SHLGUID IID_IContextMenu,        0000214E4h, 0, 0<br /><br />IID_IContextMenu GUID sIID_IContextMenu<br />public IID_IContextMenu<br /></code></pre><br /><br />Japheth</div>
    <div class="meta">Posted on 2003-03-22 06:43:15 by japheth</div>
   </div>
  </div>
 </body>
</html>