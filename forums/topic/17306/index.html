<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Com Server Access - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17306" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=38">Object Oriented Programming</a> &raquo; <a href="../?id=17306">Com Server Access</a></p>
   <div class="post" id="post-134094">
    <div class="subject"><a href="#post-134094">Com Server Access</a></div>
    <div class="body">Are there any examples of how to access say Excel or Word using COM with Masm32 (hutch's)?<br /><br />Thanks</div>
    <div class="meta">Posted on 2004-02-18 15:39:27 by StillLearning</div>
   </div>
   <div class="post" id="post-134118">
    <div class="subject"><a href="#post-134118">Com Server Access</a></div>
    <div class="body"><a target="_blank" href="http://www.japheth.de/download/excelhost.zip">Here</a>  is a sample using excel automation.</div>
    <div class="meta">Posted on 2004-02-19 00:08:21 by japheth</div>
   </div>
   <div class="post" id="post-134119">
    <div class="subject"><a href="#post-134119">Com Server Access</a></div>
    <div class="body">Thank you for that link and code..I have not looked it over as of yet, but perhaps you can tell mw why I get this errors when I run your make from the Comview28 zip file<br /><br /><br /><br />C:\Comview28\Webbrowser&gt;make<br /><br />Microsoft (R) Macro Assembler Version 7.00.9466<br />Copyright (C) Microsoft Corporation.  All rights reserved.<br /><br /> Assembling: webbrowserapp.asm<br />oaidl.inc(24) : error A2004: symbol type conflict : PVOID<br />oaidl.inc(28) : error A2004: symbol type conflict : LPWSTR<br />shdocvwc.inc(29) : fatal error A1016: Internal Assembler Error<br /> MacroLoop(1): iteration 0: Macro Called From<br />  DEFINE_DISPMETHOD(11): Macro Called From<br />   shdocvwc.inc(29): Include File<br />\masm32\include\resource.h(1229) : warning RC4005: 'IDC_EDIT1' : rede<br />Microsoft (R) Incremental Linker Version 5.12.8078<br />Copyright (C) Microsoft Corp 1992-1998. All rights reserved.<br /><br />LINK : fatal error LNK1181: cannot open input file &quot;webbrowserapp.obj<br /><br />C:\comview28\Webbrowser&gt;<br /><br /><br />Again thanks for responding :alright:</div>
    <div class="meta">Posted on 2004-02-19 00:36:09 by StillLearning</div>
   </div>
   <div class="post" id="post-134124">
    <div class="subject"><a href="#post-134124">Com Server Access</a></div>
    <div class="body">japheth:<br /><br />Ok, I tried to assemble the ExcelHost and received these errors....<br /><br />Same error types as the WebBrowser Errors<br /><br /><br />Win2K<br />Excel 97<br />Masm32v8sp1 Hutch's <br />RadAsm IDE<br /><br /><br /> Assembling: ExcelHost.asm<br />oaidl.inc(20) : error A2004: symbol type conflict : PVOID<br />oaidl.inc(24) : error A2004: symbol type conflict : LPWSTR<br />excel.inc(1595) : error A2008: syntax error : EQU<br />excelc.inc(33) : fatal error A1016: Internal Assembler Error<br /> DEFINE_DISPMETHOD(1): Macro Called From<br />  excelc.inc(33): Include File<br /><br />Make error(s) occured.<br /><br /><br />Are those dsw dsp files needed ( they are present)  and can it be done without them.... If they are needed by all files how do a make them?<br /><br />Inside the rc file is a reference to afxres.h  I don't have this file<br /><br />Nor do I have the NMake file needed to try using your .mak file<br /><br />What is the correct procedure to correct the Comview output files that contain the ;+++ definitions?<br /><br />Should one look at the ComView display and manually extend the definitions to the proper structure? Is it possible it correct them?<br /><br /><br />I sure need this to build cleanly as I ran the enclosed ExcelHost.exe and WOW......It got my tail wagging...........This my be the example I need!!!!!<br /><br />Thanks again</div>
    <div class="meta">Posted on 2004-02-19 01:17:06 by StillLearning</div>
   </div>
   <div class="post" id="post-134181">
    <div class="subject"><a href="#post-134181">Com Server Access</a></div>
    <div class="body">Hi,<br /><br />possibly you are using MASM V8, which has some small incompatibilities. View <a target="_blank" href="http://www.japheth.de/masm32.html">http://www.japheth.de/masm32.html</a> and download the package mentioned there.<br /><br />Japheth</div>
    <div class="meta">Posted on 2004-02-19 08:50:44 by japheth</div>
   </div>
   <div class="post" id="post-134229">
    <div class="subject"><a href="#post-134229">Com Server Access</a></div>
    <div class="body">Hi:<br /><br />Yes, as stated in my second post I am using Masm32, which is what I thought your example code was made for.<br /><br /><br />Your code example is like a big piece of candy to me now.<br /><br />It's the example that I really need to understand, but can't get it <br />to build cleanly.<br /><br />The excelc.inc produces errors and I have no idea how to fix them.<br /><br />excelc.inc ( Excel 8 )  built using comview28<br /><br />Masm 7.00.9xxx<br /><br />So no clean build<br /><br />If I switch over to:<br /><br />Masm 6.14xx<br /><br />It assembles and reports no errors.<br /><br />But the linker...<br /><br />Microsoft (R) Incremental Linker Version 5.12.8078<br />Copyright (C) Microsoft Corp 1992-1998. All rights reserved.<br /><br />ExcelHost.obj : error LNK2001: unresolved external symbol _IID_IUnknown<br />ExcelHost.exe : fatal error LNK1120: 1 unresolved externals<br /><br />Make error(s) occured.<br /><br />1). Why does Masm v7 not like the excelc.inc file?<br /><br />2). How do a fix the linker problem, if a use Masm v6.14 to assemble it?<br /><br />3). What is the correct procedure to correct the Comview output files that contain the ;+++ definitions?<br /><br />Should one look at the ComView display and manually extend the definitions to the proper structure? Is it possible it correct them?<br /><br /><br />I really really appreciate your time and help in this matter.<br /><br />Thank you.</div>
    <div class="meta">Posted on 2004-02-19 16:47:55 by StillLearning</div>
   </div>
   <div class="post" id="post-134254">
    <div class="subject"><a href="#post-134254">Com Server Access</a></div>
    <div class="body">Hi,<br /><br />1). Why does Masm v7 not like the excelc.inc file?<br /><br />I dont know, will check it<br /><br />2). How do a fix the linker problem, if a use Masm v6.14 to assemble it?<br /><br />the public _IID_IUnknown is defined in UUID.LIB of MASM32 V7 (you have V8, which includes a crippled version of this library). As I have mentioned in my previous post, you can download some MASM32 V7 includes/libraries from my site, which will resolve this issue.<br /><br />3). What is the correct procedure to correct the Comview output files that contain the ;+++ definitions?<br /><br />same answer as to 1).<br /><br />Japheth</div>
    <div class="meta">Posted on 2004-02-19 23:55:40 by japheth</div>
   </div>
   <div class="post" id="post-134255">
    <div class="subject"><a href="#post-134255">Com Server Access</a></div>
    <div class="body">Hi:<br /><br />I did download the different includes and built the new libs....<br /><br />Didn't seem to help.<br /><br />That's not saying I didn't make a mistake somewhere in the process.<br /><br />Again I thank you for looking into it.</div>
    <div class="meta">Posted on 2004-02-20 00:10:27 by StillLearning</div>
   </div>
   <div class="post" id="post-134264">
    <div class="subject"><a href="#post-134264">Com Server Access</a></div>
    <div class="body">Hi,<br /><br />I had some problems with this sample as well because its so old.<br />The main problem is that this sample doesnt use include file DISPHLP.INC.<br />So I updated the include files and made some small changes to the source.<br /><br />Just updated the new version on my site. Use the link from my first post.<br /><br />With these modifications I had no problems with masm v615 and v700.<br />But you still need a proper version of UUID.LIB. If still errors occur during<br />the assembly step, you should post the generated includes in zipped format.<br /><br />Japheth</div>
    <div class="meta">Posted on 2004-02-20 01:22:54 by japheth</div>
   </div>
   <div class="post" id="post-134270">
    <div class="subject"><a href="#post-134270">Com Server Access</a></div>
    <div class="body">japheth:<br /><br />Microsoft (R) Macro Assembler Version 7.00.9466<br />Copyright (C) Microsoft Corporation.  All rights reserved.<br /><br /> Assembling: ExcelHost.asm<br />excelc.inc(77) : fatal error A1016: Internal Assembler Error<br /> MacroLoop(1): iteration 0: Macro Called From <br />  DEFINE_DISPMETHOD(11): Macro Called From<br />   excelc.inc(77): Include File<br /><br />Make error(s) occured.<br /><br />If I comment out that line the error just continues down the file to the next line.<br /><br />What is the  version # of your Masm v7.???? Mine is 7.00.9466<br /><br />Thanks...I think we are getting close.<br /><br />P.S.<br /><br />It does assemble and build under 6.14 - no problem.</div>
    <div class="meta">Posted on 2004-02-20 02:58:26 by StillLearning</div>
   </div>
   <div class="post" id="post-134280">
    <div class="subject"><a href="#post-134280">Com Server Access</a></div>
    <div class="body">Hi,<br /><br />regretably I used the same version, and I dont get any errors.<br /><br />Japheth</div>
    <div class="meta">Posted on 2004-02-20 05:19:15 by japheth</div>
   </div>
   <div class="post" id="post-134293">
    <div class="subject"><a href="#post-134293">Com Server Access</a></div>
    <div class="body">Hi:<br /><br />ok,<br /><br />Well I guess you can't fix what isn't broken on your end.<br /><br />It sure is a beautiful example on accessing COM.<br /><br />Thank you very much for all of your help.<br /><br />The ;+++ 's inside the inc's are being caused by the fact that the Excel 8 dll carries many of the parms out to 30!<br /><br /><br />Any chance in Comview going out that far to caught them all?<br /><br />Is there any setting in Comview for me to request parms be generated out that far?<br /><br /><br />Your example is a GREAT help, thanks again.</div>
    <div class="meta">Posted on 2004-02-20 10:13:15 by StillLearning</div>
   </div>
   <div class="post" id="post-134301">
    <div class="subject"><a href="#post-134301">Com Server Access</a></div>
    <div class="body">Hi,<br /><br /><div class="quote"><br />The ;+++ 's inside the inc's are being caused by the fact that the Excel 8 dll carries many of the parms out to 30!<br />Any chance in Comview going out that far to caught them all?<br /></div><br /><br />There is a MASM limitation of 30/31 parameters, so modifying comview wont help.<br /><br />Japheth</div>
    <div class="meta">Posted on 2004-02-20 12:22:20 by japheth</div>
   </div>
   <div class="post" id="post-134802">
    <div class="subject"><a href="#post-134802">Com Server Access</a></div>
    <div class="body">japheth:<br /><br />I few questions.<br /><br />Please understand I may not the using the correct COM usage or reference in my questions, but hopefully you get the idea.<br /><br />1). How would this type of method be handled?<br /><br />STDMETHOD	OpenApplication	, :BSTR,:ptr ptr dxoPApplication<br /><br /><br />2). If one call returns a  ptr to another interface or dispatch then am I required to CoCreateInstance on this interface dispatch?<br /><br /><br />3). If the return is a ptr to another interface within the same dll, does the orginal CoCreateInstance handle that interface/dispatch?<br /><br /><br />Thank for you time.</div>
    <div class="meta">Posted on 2004-02-25 14:32:46 by StillLearning</div>
   </div>
   <div class="post" id="post-134826">
    <div class="subject"><a href="#post-134826">Com Server Access</a></div>
    <div class="body">Hi,<br /><br />to your questions:<br /><br />1.)<br />     local bstr:BSTR<br /><br />          invoke SysAllocString, addr wszString<br />          mov bstr, eax<br />          invoke vf(pObject, Ixxx, OpenApplication), bstr, addr pApplication<br /><br />2.) No (how would you tell CoCreateInstance about your dispatch pointer?)<br />  <br />3.) Dont understand this question. If you get an Idispatch pointer, you can do with it<br />     what you want. CoCreateInstance is just a wrapper for <br />    - loading your dll<br />    - calling DllGetClassObject (returns a class factory object)<br />    - calling CreateInstance method of class factory (hopefully returns the object you want)<br />    - releasing class factory<br />    - calling QueryInterface on the object and returning this object</div>
    <div class="meta">Posted on 2004-02-25 23:37:01 by japheth</div>
   </div>
   <div class="post" id="post-135474">
    <div class="subject"><a href="#post-135474">Com Server Access</a></div>
    <div class="body">Hi:<br /><br />I'm back, I've been trying to work with your macros, with some success.<br /><br />Can not get over a bump.<br /><br /><br />An external APP is sending into my dll code the IDispatch address of an Object.<br /><br /><br />How do I set this up in ASM to access the items of that dispatch.<br /><br />CoCreateInstance always returns A class factory error.<br /><br /><br />If we assume this is the IUnknown of the dispatch, how would that be set up?<br /><br /><br /><br /><br />In PB if I do a setup such as:<br /><br /><br />Dim ThisObject as xxIThisObject ; references the Interface Dispatch definition<br /><br /><br />Set ThisObject = &quot;Passed in dispatched pointer&quot; ; dispatch pointer passed in by the external app<br /><br /><br />BINGO I have access<br /><br /><br />I understand that PB is doing the CO stuff, but what sequence is the proper ones in assembler?<br /><br /><br />If an Interface is COclass does this mean that both items can be referenced by one of the other names / or class?<br /><br /><br /><br />Thanks</div>
    <div class="meta">Posted on 2004-03-09 10:42:08 by StillLearning</div>
   </div>
   <div class="post" id="post-135547">
    <div class="subject"><a href="#post-135547">Com Server Access</a></div>
    <div class="body">Hi,<br /><br />if you get an idispatch from outside you dont need cocreateinstance.<br /><br />&gt; Dim ThisObject as xxIThisObject<br />&gt; Set ThisObject = &quot;Passed in dispatched pointer&quot;<br /><br />vb doesnt do this either with the code above, it would call cocreateinstance only with<br /><br />&gt; Dim ThisObject as NEW xxIThisObject<br /><br />So I would suggest you to post your code (partly).<br /><br />Japheth</div>
    <div class="meta">Posted on 2004-03-10 01:52:24 by japheth</div>
   </div>
   <div class="post" id="post-136607">
    <div class="subject"><a href="#post-136607">Com Server Access</a></div>
    <div class="body">Sorry, out of town no access<br /><br /><br />The code to do the same thing PB does is what I'm looking for.<br /><br />Dim ThisObject as xxIThisObject<br /><br />Set ThisObject = &quot;Passed in dispatched pointer&quot;<br /><br /><br />ok, so If I have a dispatch pointer, how do I use your Invoke vf() macro (as this is not a pointer to the unknown) to perform this:<br /><br />Dim vTargetItemValue as Variant<br />Dim TargetItemValue as Double<br /><br />Object Get ThisObject.TargetDouble = vTargetItemValue<br /><br />TargetItemValue=Variant#(vTargetItemValue)<br /><br />TargetItemValue will now contain a double prec value.<br /><br /><br />Thank you for your time and help on this.</div>
    <div class="meta">Posted on 2004-03-21 14:37:56 by StillLearning</div>
   </div>
   <div class="post" id="post-136668">
    <div class="subject"><a href="#post-136668">Com Server Access</a></div>
    <div class="body">I hope to learn OOP because I need to communicate with excel, word and MsProject. I have downloaded you example ExcelHost.<br /><br />When compiling your example there is a conflicting parameter definition in masm32 user32.inc file and Debugout.inc.<pre><code>wsprintfA PROTO C &#58;DWORD,&#58;VARARG<br />wsprintf equ &lt;wsprintfA&gt;</code></pre><br /><br />Then I have a question. It takes a very long time to compile (appr 45 sek). I have not experienced such a long time before. The ExcelHost.obj file is 2.8 Mb. Is this significant for OOP projects?</div>
    <div class="meta">Posted on 2004-03-22 09:19:04 by minor28</div>
   </div>
  </div>
 </body>
</html>