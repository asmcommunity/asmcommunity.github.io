<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>nARM macros - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=18385" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=32">Electronics</a> &raquo; <a href="../?id=18385">nARM macros</a></p>
   <div class="post" id="post-142458">
    <div class="subject"><a href="#post-142458">nARM macros</a></div>
    <div class="body">Below are some useful macros in NASM for ARM (&quot;narmw&quot;), if you have some ideas or hints to help me develop software for PalmOS5 , I'll be glad to hear them. <br />I noticed NARM is actually almost as powerful as MASM, and only the lack of &quot;%xdefine&quot; in narmw keeps me from building an OOP framework for arm. If/when I return to x86, I will try to port ATC to nasm :)<br /><br /><pre><code><br />Example&#58;<br />proc test4,var1,var2,var3,var4,var5,var6,var7,var8<br />	local var9,var10<br />	add var1,var1,var2<br />	add var1,var1,var3<br />	add var1,var1,var4<br />	add var1,var1,var5<br />	add var1,var1,var6<br />	add var1,var1,var7<br />	add var1,var1,var8<br />	<br />	ret ; var1 = r0<br />endp<br /></code></pre><br /><pre><code><br /><br />%macro proc 1-*<br />	%1&#58; <br />	%rotate 1<br />	<br />	stmdb sp!, &#123;r4,r5,r6,r7,r8,r9,r10,r11,r12,r14&#125;<br />	<br />	%if %0&gt;1<br />		%define %1 r0<br />	%endif<br />	<br />	%if %0&gt;2<br />		%define %2 r1<br />	%endif<br />	%if %0&gt;3<br />		%define %3 r2<br />	%endif<br />    	%if %0&gt;4<br />		%define %4 r3<br />	%endif<br />	%if %0&gt;5<br />		ldr r4,&#91;sp,#40&#93;<br />		%define %5 r4<br />	%endif<br />	%if %0&gt;6<br />		ldr r5,&#91;sp,#44&#93;<br />		%define %6 r5<br />	%endif<br />	%if %0&gt;7<br />		ldr r6,&#91;sp,#48&#93;<br />		%define %7 r6<br />	%endif<br />	%if %0&gt;8<br />		ldr r7,&#91;sp,#52&#93;<br />		%define %8 r7<br />	%endif<br />	%if %0&gt;9<br />		ldr r8,&#91;sp,#56&#93;<br />		%define %9 r8<br />	%endif<br />	%if %0&gt;10<br />		%error Too many parameters<br />	%endif<br />	<br />%endmacro<br />	<br /><br />;proc ilko , var0,var1,var2,var3,var4,var5<br /><br />%macro ret 0<br />	%ifdef this_proc_locals<br />	%if this_proc_locals<br />		add sp,sp,this_proc_locals*4 + 4<br />	%endif<br />	%endif<br />	ldmia sp!, &#123;r4,r5,r6,r7,r8,r9,r10,r11,r12,r15&#125;<br />%endmacro<br /><br />%define endp <br /><br /><br />%macro local 1-*<br />	%ifdef this_proc_locals<br />		%if this_proc_locals<br />		%error Locals already created!<br />		%endif<br />	%endif<br />	%assign this_proc_locals 0<br />	%rep %0<br />		%if this_proc_locals = 0<br />			%define %1 &#91;sp,#0&#93;<br />		%elif this_proc_locals = 1<br />			%define %1 &#91;sp,#4&#93;<br />		%elif this_proc_locals = 2<br />			%define %1 &#91;sp,#8&#93;<br />		%elif this_proc_locals = 3<br />			%define %1 &#91;sp,#12&#93;<br />		%elif this_proc_locals = 4<br />			%define %1 &#91;sp,#16&#93;<br />		%elif this_proc_locals = 5<br />			%define %1 &#91;sp,#20&#93;<br />		%elif this_proc_locals = 6<br />			%define %1 &#91;sp,#24&#93;<br />		%elif this_proc_locals = 7<br />			%define %1 &#91;sp,#28&#93;<br />		%elif this_proc_locals = 8<br />			%define %1 &#91;sp,#32&#93;<br />		%elif this_proc_locals = 9<br />			%define %1 &#91;sp,#36&#93;<br />		%else<br />			%error Too many locals!<br />		%endif<br />		%assign this_proc_locals this_proc_locals+1<br />		%rotate 1<br />	%endrep<br />	<br />	sub sp,sp,this_proc_locals*4 +4<br />	<br />%endmacro<br /><br /><br /><br />; GetWordElement&#40;r0,table1,r1&#41; =   mov r0,table1&#91;r1*2&#93;	<br /><br />%macro GetWordElement 3   <br />	add  %1,r15,%3,lsl #1<br />	ldrh %1,&#91;%1,%2-%%this&#93;<br />    %%this&#58;<br />%endmacro<br /><br /></code></pre><br /><br />Also, I found out that I should disasm libgcc.a to clone+modify __divsi3 , since if I divide on 0, my program really misbehaves. <br />Anyone else here coding ARM ?</div>
    <div class="meta">Posted on 2004-05-29 18:00:28 by Ultrano</div>
   </div>
   <div class="post" id="post-142463">
    <div class="subject"><a href="#post-142463">nARM macros</a></div>
    <div class="body">I tried to before, but because of time restrictions I cant, but I used VisualHAM tho since the ARM7 I'm using is in my GBA and I have a flash cart too :D. Programming ARM is fun!</div>
    <div class="meta">Posted on 2004-05-29 19:50:00 by x86asm</div>
   </div>
   <div class="post" id="post-142479">
    <div class="subject"><a href="#post-142479">nARM macros</a></div>
    <div class="body">I did some ARM optimizations for the ARM7TDMI (memory operations, blit, YUV -&gt; RGB conversion, ...) The performance boost was decisive. I used a package with a GCC arm compiler and a GBA emulator for debugging. The GBA emulator was very useful because the video format is RGB 555 and I was working on a system with RGB 565. ARM7 optimization is easier than PC optimization : no cache, simple pipeline, lots of registers, conditionnal execution for all instructions...</div>
    <div class="meta">Posted on 2004-05-30 01:01:51 by Dr. Manhattan</div>
   </div>
   <div class="post" id="post-142491">
    <div class="subject"><a href="#post-142491">nARM macros</a></div>
    <div class="body">Hi x86asm, do u have any interest in making an ARM plugin for ProEmulator?<br />Maybe u can join my project on sourceforge (by becoming a developer member), what do u say?<br /><br /><div class="quote"><br />I tried to before, but because of time restrictions I cant, but I used VisualHAM tho since the ARM7 I'm using is in my GBA and I have a flash cart too :D. Programming ARM is fun! </div></div>
    <div class="meta">Posted on 2004-05-30 05:49:22 by optimus</div>
   </div>
   <div class="post" id="post-142524">
    <div class="subject"><a href="#post-142524">nARM macros</a></div>
    <div class="body"><div class="quote"><br />Hi x86asm, do u have any interest in making an ARM plugin for ProEmulator?<br />Maybe u can join my project on sourceforge (by becoming a developer member), what do u say?<br /><br /> </div><br />I would love to but the next CPU I was going to tackle was the Motorola 68000 ( so I can write Sega Genesis emu)! I'll decide which CPU is better for me to emulate and get back to ya :D<br />This is assuming you dont mind a Motorola 68000 emu in ur project :D<br />I'll assess the ARM CPU's instruction set (ARM7 u want?), I might detour from 68000, if I can write the ARM7 by hand instead of coding a C asm outputter (the case for my 68000 emu)</div>
    <div class="meta">Posted on 2004-05-30 21:01:26 by x86asm</div>
   </div>
   <div class="post" id="post-142542">
    <div class="subject"><a href="#post-142542">nARM macros</a></div>
    <div class="body">Any new CPU to be implemented in ProEmulator is welcomed! If u can implement a 68k cpu, perhaps ProEmulator will be able to emulate a MAC someday and that seems pretty cool. ^_^<br />If time permitted, i will try to write an ARM7 emulation plugin (if feasible i'm thinking of adopting Dynamic Binary Translation technique), maybe we can co-operate to finish the work.</div>
    <div class="meta">Posted on 2004-05-31 06:56:08 by optimus</div>
   </div>
   <div class="post" id="post-142577">
    <div class="subject"><a href="#post-142577">nARM macros</a></div>
    <div class="body"><div class="quote"><br />Any new CPU to be implemented in ProEmulator is welcomed! If u can implement a 68k cpu, perhaps ProEmulator will be able to emulate a MAC someday and that seems pretty cool. ^_^<br />If time permitted, i will try to write an ARM7 emulation plugin (if feasible i'm thinking of adopting Dynamic Binary Translation technique), maybe we can co-operate to finish the work. </div><br />I am definitely more than willing to help co-op on the ARM7 emulation, but the thing is that I havent researched Dynamic Binary Translation that much so I'm not very knowledgable on the subject I will do some research in my spare time. I will forge ahead with the Motorola 68000 emulation, I started that project about a week ago. (Still fixing bugs in the Z80 CPU emu as well tho too)<br /><br />Sorry for crapping on ur thread Ultrano. :(</div>
    <div class="meta">Posted on 2004-05-31 15:41:17 by x86asm</div>
   </div>
   <div class="post" id="post-142579">
    <div class="subject"><a href="#post-142579">nARM macros</a></div>
    <div class="body">lol  np :)</div>
    <div class="meta">Posted on 2004-05-31 15:56:00 by Ultrano</div>
   </div>
   <div class="post" id="post-142595">
    <div class="subject"><a href="#post-142595">nARM macros</a></div>
    <div class="body">Also ATC to nasm will be interesting ;), gl and if I can help I will try.<br /><br />Have a nice day or night.</div>
    <div class="meta">Posted on 2004-05-31 23:32:55 by rea</div>
   </div>
   <div class="post" id="post-142629">
    <div class="subject"><a href="#post-142629">nARM macros</a></div>
    <div class="body">nasm supports ARM??</div>
    <div class="meta">Posted on 2004-06-01 09:49:44 by optimus</div>
   </div>
   <div class="post" id="post-142630">
    <div class="subject"><a href="#post-142630">nARM macros</a></div>
    <div class="body"><a target="_blank" href="http://www.geocities.com/SiliconValley/Hub/6461/arm/">http://www.geocities.com/SiliconValley/Hub/6461/arm/</a><br /><br />&quot;what it's lacking is the object-dumper part&quot; ... <br />also it lacks import of external symbols,  and<br /><strong>blt</strong> gets translated as <strong>bl</strong> :(<br />It makes me think about making a macro wrapper to arm-palmos-as.exe . Actually I've just started making this wrapper.</div>
    <div class="meta">Posted on 2004-06-01 10:51:58 by Ultrano</div>
   </div>
   <div class="post" id="post-142661">
    <div class="subject"><a href="#post-142661">nARM macros</a></div>
    <div class="body"><div class="quote"><br /><br />I am definitely more than willing to help co-op on the ARM7 emulation, but the thing is that I havent researched Dynamic Binary Translation that much so I'm not very knowledgable on the subject I will do some research in my spare time. I will forge ahead with the Motorola 68000 emulation, I started that project about a week ago. (Still fixing bugs in the Z80 CPU emu as well tho too)<br /><br />Sorry for crapping on ur thread Ultrano. :( </div><br /><br />DBT is much more harder to implement than interpreting. This will be a work to be done later. ARM interpreting emulator should be firstly implemented.</div>
    <div class="meta">Posted on 2004-06-01 19:47:32 by optimus</div>
   </div>
   <div class="post" id="post-142662">
    <div class="subject"><a href="#post-142662">nARM macros</a></div>
    <div class="body"><div class="quote"><br /><a target="_blank" href="http://www.geocities.com/SiliconValley/Hub/6461/arm/">http://www.geocities.com/SiliconValley/Hub/6461/arm/</a><br /><br />&quot;what it's lacking is the object-dumper part&quot; ... <br />also it lacks import of external symbols,  and<br /><strong>blt</strong> gets translated as <strong>bl</strong> :(<br />It makes me think about making a macro wrapper to arm-palmos-as.exe . Actually I've just started making this wrapper. </div><br /><br />It sounds great.<br />But sorry I can never visit geocities here. Any mirrors of the site?</div>
    <div class="meta">Posted on 2004-06-01 19:48:48 by optimus</div>
   </div>
   <div class="post" id="post-142763">
    <div class="subject"><a href="#post-142763">nARM macros</a></div>
    <div class="body">:( no mirrors, <br /><a target="_blank" href="http://66.102.11.104/search?q=cache:Lk3DcPhOJlIJ:www.geocities.com/SiliconValley/Hub/6461/arm/+arm+nasm+assembler&amp;hl=en">http://66.102.11.104/search?q=cache:Lk3DcPhOJlIJ:www.geocities.com/SiliconValley/Hub/6461/arm/+arm+nasm+assembler&amp;hl=en</a><br />but for the files .... <br />anyway, it's not a perfect package, has no documentation, and pretty soon I'm sure to replace it. I've managed so far to enable basic macros and %define , currently working on proc/ret/endp , then on .if .while, @@, @F @B , ... oy :)</div>
    <div class="meta">Posted on 2004-06-03 03:42:45 by Ultrano</div>
   </div>
   <div class="post" id="post-142914">
    <div class="subject"><a href="#post-142914">nARM macros</a></div>
    <div class="body">I will take a look  @<br /><a target="_blank" href="http://www.geocities.com/SiliconValley/Hub/6461/arm/">http://www.geocities.com/SiliconValley/Hub/6461/arm/</a><br /><br />Interesting, I from time to time whant to help the nasm project ;) finall examinations here, but then come the vacations, hope I can do some.<br /><br />Ultrano you already look at some of the macros implemented for structured programmin? I think the package of tomcat have the original ones, also I think I do  &quot;interesting&quot; macros for proc... and such things.<br /><br />Also will be interesting see how is modificated nasm for assemble arm  instruction set.<br /><br /><br />Have a nice day or night.</div>
    <div class="meta">Posted on 2004-06-05 11:44:01 by rea</div>
   </div>
   <div class="post" id="post-142919">
    <div class="subject"><a href="#post-142919">nARM macros</a></div>
    <div class="body">I haven't seen any such macros. And when I googled on it now, I couldn't find anything completely relevant - what is Tomcat? (Apart from my favourite jetfighter F-14 :grin: ) . Structured programming ... aye it's not really clear to me - the seach on it returned stuff like &quot;no branching&quot; and &quot;java&quot;, which confuses me more :)  I'll look it up if I find some time</div>
    <div class="meta">Posted on 2004-06-05 12:14:42 by Ultrano</div>
   </div>
   <div class="post" id="post-142920">
    <div class="subject"><a href="#post-142920">nARM macros</a></div>
    <div class="body">This one is <a target="_blank" href="http://rs1.szif.hu/~tomcat/win32/">http://rs1.szif.hu/~tomcat/win32/</a> :) I google tomcat nasm.  :).<br /><br /><br /><div class="quote">Structured programming ... aye it's not really clear to me - the seach on it returned stuff like &quot;no branching&quot; and &quot;java&quot;</div><br /><br />For me structured programming not mean java, C, C++ or any other, mean tht you can draw a <strong>plain graph</strong> <em>following the secuence of instructions</em>, and any structure for complicated that it apear to be can be draw as a plain graph and not overlap other lines on the graph,  not more not less.<br /><br /><br />mmmm, also structured programming mean &quot;not spaguetti code&quot;, also spagetti code is a <strong>not plain graph</strong> ;), and for analyse it you need other things... some things not are directly aplicable to them. <br /><br />Also in electric circuits is important have a <strong>plain graph</strong> for aply the thechnique &quot;analysis by meshes&quot; (an?lisis por mallas).<br /><br /><br /><br /><br />Apart, I dont understand completely the thing about the output for arm.. the thing &quot;what it's lacking is the object-dumper part&quot;,or &quot;barely produce any usable output!&quot;<br /><br />Have a nice day or night.</div>
    <div class="meta">Posted on 2004-06-05 12:44:03 by rea</div>
   </div>
   <div class="post" id="post-142921">
    <div class="subject"><a href="#post-142921">nARM macros</a></div>
    <div class="body">lol btw, I saw the &quot;The shortest helloworld&quot; on TomCat's site .. omg is this to scare newbies :) ?<br />I'd show newbies the following working code:<br /><pre><code><br />include \masm32\ultrano\bank\base.inc<br />start&#58;<br />msgbox &quot;hello world!&quot;<br />invoke ExitProcess,0<br /></code></pre><br />:P<br />Structured programming ... following only one way of coding seems to me that will produce unoptimized code. I prefer writing optimized code, AND giving complete comments on them. So far my boss and colleagues cope with that :D<br />hmm on second thought, I guess I've been coding the structured way :) Anyway ^^&quot; ....that doesn't matter...</div>
    <div class="meta">Posted on 2004-06-05 13:11:33 by Ultrano</div>
   </div>
   <div class="post" id="post-142924">
    <div class="subject"><a href="#post-142924">nARM macros</a></div>
    <div class="body">;) scary newbie == scary movie ??<br /><br />Also here are others more short<br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=1469">http://www.asmcommunity.net/board/index.php?topic=1469</a><br /><br /><br /><br />Understand well structured programming will help (or at less that is the objetive), for example, I know people that is learning for example C, and even that they have the structures for help do structured programming (functions, &quot;constrol structs&quot;), they can't in fact do well structured programms, that is: that you have suport for a thing, not mean that you know how to use it that is a fault when teachers expose how to write a programm with C or other I think ... ;). Also there are people that can use it without go in dept, but they have a more clear way of how to use them. The teachers think that having &quot;descriptive&quot; names for the control structs the student will catch how to do things well, when that is only a suposition, for proof, you can find on internet some examples (provided by teachers or other similars) of how the students do faults: extrange comparisions or inecesary, write the same in a diferent ways and others &quot;problems&quot; that teachers say that the student dont understand, when in fact that is a fault of both parts... the teacher assuming that is clear and not explaining structured programming objetive and what is and the student for not question the teacher.<br /><br /><br /><br />Also other proof that structured programming not mean C, java, C++ or any other that <strong>&quot;implement&quot;</strong> such constructions for help is that they can't launch errors regarded to them, in fact, they can launch errors/warnings related to: cast, mismatch in size, prototypes, class declarations, incorrect or not defined symbol, unitialized pointer, but in fact any of this can't (at less as I know) launch a error in the logic when you use while, for, etc. Then is clearly that this languages only  give the structures but are not part of any of this languages, because the compiler can't launch errors about this.<br /><br />In fact that type of errors regarded to structured programming is showed at execution time (the compiler can't catch them), when a guy whant x result and he/she think that the programm is running in a bad way.<br /><br />sorry if I polute a little your thread.....<br /><br />But like I see now, C,C++ and others reserve only that &quot;reserved words&quot;, for/while/do/others and do a little implementation, perhaps they provide a sintaxis for use them, also can do a little about optimization,  but in fact they are not part of any of this languages, because the real parts that are suported inside the languages the compiler can launch errors of them, also they have a sintaxis and reserved words, but the compiler can launch errors/warnings. With the control struct of structured programming any compiler(that I know) can launch even a warning, then I not consider that the language have a real suport for structured programming... they provide only like macros ;), the real parts of this languages are the things that dont belong to that structures.<br /><br />For example (on the fly):<br /><br />.....<br />int a = 16;<br />if( a &gt; &quot;32&quot;){<br /> a = a + &quot;32&quot;;<br />}<br /><br />The compiler will launch a error in: a &gt; &quot;32&quot;, a = a + &quot;32&quot;;, but in fact, the compiler never can say you if (or questionate your logic) about:<br /><br />int a = 16;<br />if( a &gt; &quot;32&quot;){<br />// at less I think the assembler will <br />//nedd you say that It will not translate<br />// the block belong to if(a&gt; &quot;32&quot;) and <br />//continue pheraphs to the else... that <br />//will be executed anyway, because is <br />//not assembled the if block...<br /><br /><br />And more if is at runtime and always you get: a&lt;someValue... the compiler can't say in what part is the error, you should debug and understand the operations that carry to always have that value in that part of memory.<br /><br /><br /><br />But like you see I can :) questionate the logic.<br /><br /><br />Then pheraphs you or other that is reading this, can see that high level languages dont implement more than some more powerfull macros (because optimization and such things and some type checking... that in fact is regarded to the core of the language by itself) in some way,  they are only separed like part of the language by means of &quot;reserved words&quot;, but they <strong>don't belong to any language</strong>, they belong to logic in programming or a more logic way of do things, and in some way analysis of graphs, I dont know much about analysis of algorithms, but I supose that is more easy analyse a plain one that a not plain, but not plain ones also can be of help... I supose, not all is plain in this world.<br /><br /><br />Also because the language need use them, in some way is impactated the look of the language, that is: structured programming change some in the language that is <strong>traying</strong> to implement or <strong>at less</strong> provide the constrol structs for use it. But is  structured programming that impact the language and <strong>not</strong> viceversa. Also see that impact the language, not mean that the language itself can understand structured programming ;).<br /><br /><br />Have a nice day or night.<br /><br />For resume:<br />structured programming dont belong or is not well implemented in the compilers that I know, because the <strong>compiler is suposed to help you in write a programm in x language, and it should give you warnings/errors about the <em>bad usage of the language</em> and translate to machine target</strong>, then when I find that a x compiler can't questionate the logic of how to use a suposed <em>part of the language</em> (the one regarded to structured programming), then <em>this part</em>, because <em>is not directly handled by the compiler</em>, ie, it dont give me a warning, then the use of the compiler <strong>&quot;for this part of the  language&quot;</strong> is near to nothing**, then is not a direct part of the language, because can not be handled by the <em>suposed one</em> that will handle the translation and correction of the programm, <strong>the compiler</strong>.<br /><br /><br />** Also see that some errors launched inside constrols structs are of the language, mismatch pointers, unitialization, etc, but not question the logic.<br /></div>
    <div class="meta">Posted on 2004-06-05 14:38:52 by rea</div>
   </div>
  </div>
 </body>
</html>