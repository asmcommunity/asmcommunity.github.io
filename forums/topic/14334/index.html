<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Best custom Mutex code here - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14334" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=14334">Best custom Mutex code here</a></p>
   <div class="post" id="post-110922">
    <div class="subject"><a href="#post-110922">Best custom Mutex code here</a></div>
    <div class="body">Multithreaded programs need a way to synchonize their data access at some risky places. You can always use CriticalSection or Mutex, but what if you try to access an object that no longer exists? EnterCriticalSection does not return a value to tell you if the object exists or not. This can be avoided by initially removing all pointers to the object, but in some cases this won't be of enough security. The following code works perfectly and I have been using it for more than 8 months 12 hours/day, with no fails from it. Twice there were discussions (threads) about this, but few people seemed to use the power of x86 instead of API functions. <br />  I noticed that when you free some heap memory with HeapFree, the first several bytes of that data are still accessible (noticed on Win98SE). Even if they are not, the functions will never fail you. Your program will never lock itself, either. <br /><br />(see attachment)</div>
    <div class="meta">Posted on 2003-07-17 14:24:54 by Ultrano</div>
   </div>
   <div class="post" id="post-111011">
    <div class="subject"><a href="#post-111011">Best custom Mutex code here</a></div>
    <div class="body">I have used similar code on occasion, though it wasn't as generic. I must confess I don't really know what the lock prefix does, although I can guess. Is there a reason for using a explicit &quot;lock&quot; prefix in the unlocking code, but not the locking code?<br /><br />PS: If I don't reply, it's because I'm going on vacation tomorrow :) I'll still read this when I get back though.</div>
    <div class="meta">Posted on 2003-07-18 07:02:06 by Qweerdy</div>
   </div>
   <div class="post" id="post-111017">
    <div class="subject"><a href="#post-111017">Best custom Mutex code here</a></div>
    <div class="body">oh, well, at that place the LOCK is useless. I had put it 'just in case' . I am sure it can be removed with no consequences. 'Lock' makes sure no other cpu uses the memory bus during the next instruction, so that no data gets used during the next instruction. Like telling the other cpu to stop for a while (7 cycles I suppose).</div>
    <div class="meta">Posted on 2003-07-18 07:18:07 by Ultrano</div>
   </div>
   <div class="post" id="post-111024">
    <div class="subject"><a href="#post-111024">Best custom Mutex code here</a></div>
    <div class="body">No offense here, but if you're trying to access a synchronization object that don't exist, then you need to seriously rethink your program design.</div>
    <div class="meta">Posted on 2003-07-18 07:50:42 by iblis</div>
   </div>
   <div class="post" id="post-111041">
    <div class="subject"><a href="#post-111041">Best custom Mutex code here</a></div>
    <div class="body">No offense here, but you need to correct you chronology arguments too<br /><br /><strong>February 01, 2003</strong><br />Ultrano invented the XCHG<br /><br /><a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?threadid=10555&amp;">http://www.asmcommunity.net/board/showthread.php?threadid=10555&amp;</a><br /><br /><br /><strong>July 11, 2003</strong><br />&quot;<strong>I have been using XCHG for 1 year,</strong> and it absolutely never let me down.<br />My program never crashed or misbehaved for object locking<br />thanks to using my own mutex, even though it has 4 threads<br />that have high priority and each of the threads gets its timeslice<br />every 10ms.&quot;<br /><br /><a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?threadid=14228&amp;highlight=xchg">http://www.asmcommunity.net/board/showthread.php?threadid=14228&amp;highlight=xchg</a><br /><br />imho, it is five months rather tnen 1 year<br /><br /><br /><strong>July 17, 2003</strong><br />&quot;The following code works perfectly and I have been using it for<br /><strong> more than 8 months</strong> 12 hours/day,with no fails from it.<br />Twice there were discussions (threads) about this, but few<br />people seemed to use the power of x86<br />instead of API functions.&quot;<br /><br /><a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?threadid=14334">http://www.asmcommunity.net/board/showthread.php?threadid=14334</a><br /><br />just for 7 days   5 months or 1 year become to 8 months</div>
    <div class="meta">Posted on 2003-07-18 11:05:20 by lingo12</div>
   </div>
   <div class="post" id="post-111049">
    <div class="subject"><a href="#post-111049">Best custom Mutex code here</a></div>
    <div class="body">you have a point, but you forgot to bold <strong>12 hours/day</strong>  ;)</div>
    <div class="meta">Posted on 2003-07-18 12:30:56 by Ultrano</div>
   </div>
  </div>
 </body>
</html>