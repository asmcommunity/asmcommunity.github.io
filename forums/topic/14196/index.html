<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Execute File in Memory (How To) - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14196" />
    <link rel="next" href="../?id=14196&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=14196">Execute File in Memory (How To)</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=14196&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=14196&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="14196" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=14196&amp;page=2">&gt;</a><a href="../?id=14196&amp;page=3">&raquo;</a></form>   <div class="post" id="post-109741">
    <div class="subject"><a href="#post-109741">Execute File in Memory (How To)</a></div>
    <div class="body">I did a search but could not find anything about it.  I been trying to execute a file from memory only so there will be no disk activity.  Is this possible .  I can't seem to find a way to do it.  It may sound like a crazy idea but if you got texts in a buffer why do you always have to write to disk just to execute it.<br /><br />I would be useing it to execute registry files with the Regedit4 header that i create in memory and have no use for it to write to disk.<br /><br />I never could find a way to set registry binary files so if i can do it this way it will be good enough.  I got a lot of things i do with IE Explore registry setting, but my way is the wrong way as a programmers way of doing things.<br /><br />I need to learn how to do it both ways really.  As far as setting binary files Dream show me how to do it with numbers only it will not do letters like 21,bf,00<br /><br /><br /><br />The_Text          db &quot;21,bf,00&quot;,0<br /><br />Text2          db &quot;Thank You&quot;,0<br /><br /><br />c_execute_memory PROC<br /><br />PUSH offset The_Text;offset SW_SHOW<br />PUSH 0 ;offset The_Text<br />PUSH 0 ;offset The_Text<br />PUSH offset The_File<br />PUSH 0 ;offset The_Text<br />PUSH 0 ;offset The_Text<br />CALL ShellExecute<br /><br />RET<br />c_execute_memory ENDP</div>
    <div class="meta">Posted on 2003-07-08 23:36:02 by cmax</div>
   </div>
   <div class="post" id="post-109742">
    <div class="subject"><a href="#post-109742">Execute File in Memory (How To)</a></div>
    <div class="body"><div class="quote">I would be useing it to execute registry files with the Regedit4 header that i create in memory and have no use for it to write to disk.</div> <br /><br />Are you shellexecuting regedit.exe in order to add things to the registry?<br /><br />RobotBob</div>
    <div class="meta">Posted on 2003-07-08 23:40:20 by RobotBob</div>
   </div>
   <div class="post" id="post-109743">
    <div class="subject"><a href="#post-109743">Execute File in Memory (How To)</a></div>
    <div class="body">Are you talking about a PE file or just raw opcodes. If it's a PE file it can't really be done, the PE format has relative offsets and jump tables that are resolved at load time, the segments have to be repositioned by the PE loader as well. It is technically possible but from a practical standpoint it would be easier to save it to a file and execute it.</div>
    <div class="meta">Posted on 2003-07-08 23:44:26 by donkey</div>
   </div>
   <div class="post" id="post-109744">
    <div class="subject"><a href="#post-109744">Execute File in Memory (How To)</a></div>
    <div class="body">No I just have my own numbers in the program to replace cetain numbers in the reg.  Since its only a few it's a waste of time writing to disk than executing it but thats all i can do at the moment.  The right way is RegSet but no one know how to do it with binary (numbers and letters).  And learn to execute in memory only  would be a plus.<br /><br /><br /><br />REGEDIT4<br /><br /><br />&quot;ITBarLayout&quot;=hex:11,00,00,00,36,00,00,00,00,00,00,00,10,00,00,00,1f,00,00,00,\<br />  5e,00,00,00,01,00,00,00,a0,06,00,00,a0,0f,00,00,05,00,00,00,62,04,00,00,26,\<br />  00,00,00,02,00,00,00,a1,06,00,00,a0,0f,00,00,04,00,00,00,a1,00,00,00,a0,0f,\<br />  00,00,03,00,00,00,a0,02,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00</div>
    <div class="meta">Posted on 2003-07-08 23:49:17 by cmax</div>
   </div>
   <div class="post" id="post-109745">
    <div class="subject"><a href="#post-109745">Execute File in Memory (How To)</a></div>
    <div class="body">So if I get you right, you are saving that text file to disk<br />and then shellexecuting regedit.exe in order to load the .reg file?<br /><br />Why not use the registry api for this? <br /><br />Or maybe I am missunderstanding you.<br /><br />RobotBob</div>
    <div class="meta">Posted on 2003-07-08 23:53:36 by RobotBob</div>
   </div>
   <div class="post" id="post-109746">
    <div class="subject"><a href="#post-109746">Execute File in Memory (How To)</a></div>
    <div class="body">I don't know how to ... Thats what i want to find out and how to do execute from mem if it is possilbe also .... <br /><br />I need to learn both ways but i be happy with anything that works...<br /><br />Being force to write a dumb reg file to disks than executing it is not a mark of a ASM programmer.  It's my only bomber..</div>
    <div class="meta">Posted on 2003-07-09 00:01:32 by cmax</div>
   </div>
   <div class="post" id="post-109747">
    <div class="subject"><a href="#post-109747">Execute File in Memory (How To)</a></div>
    <div class="body">The right way to do it is with the registry API, it involves only three functions :<br /><br />RegOpenKeyEx<br />RegSetValueEx<br />RegCloseKey</div>
    <div class="meta">Posted on 2003-07-09 00:03:18 by donkey</div>
   </div>
   <div class="post" id="post-109749">
    <div class="subject"><a href="#post-109749">Execute File in Memory (How To)</a></div>
    <div class="body">Would you PLEASE show me an example.  <br /><br />I tried them all .  and can do them all .... But its hard to do it with BINARY.  I can do it with numbers like 10,20,30,40  but not with letters like bf,cf,df,10 that you see in binary not dword binary.  There is a big difference. <br /><br />I can do everything else but not this :(</div>
    <div class="meta">Posted on 2003-07-09 00:12:51 by cmax</div>
   </div>
   <div class="post" id="post-109750">
    <div class="subject"><a href="#post-109750">Execute File in Memory (How To)</a></div>
    <div class="body">cmax i am nearly finished with your example.<br /><br />gimme a few :)<br /><br />RobotBob</div>
    <div class="meta">Posted on 2003-07-09 00:19:25 by RobotBob</div>
   </div>
   <div class="post" id="post-109751">
    <div class="subject"><a href="#post-109751">Execute File in Memory (How To)</a></div>
    <div class="body">Just in case<br /><br />Be carefull with changing those numbers.<br /><br />Export that key FIRST so you can replace it.</div>
    <div class="meta">Posted on 2003-07-09 00:25:33 by cmax</div>
   </div>
   <div class="post" id="post-109752">
    <div class="subject"><a href="#post-109752">Execute File in Memory (How To)</a></div>
    <div class="body"><pre><code>&#91;size=12&#93;invoke RegSetValueEx, hKey, lpValueName, 0, REG_BINARY, offset SomeBlockOfData, sizeOfBlock&#91;/size&#93;</code></pre></div>
    <div class="meta">Posted on 2003-07-09 00:27:21 by iblis</div>
   </div>
   <div class="post" id="post-109754">
    <div class="subject"><a href="#post-109754">Execute File in Memory (How To)</a></div>
    <div class="body">Here is your code cmax:<br /><br /><pre><code><br />; #################################################<br /><br />    .486<br />    .model flat, stdcall<br />    option casemap &#58;none   ; case sensitive<br /><br />; #################################################<br /><br />    include \masm32\include\windows.inc<br />    include \masm32\include\user32.inc<br />    include \masm32\include\kernel32.inc<br />    include \masm32\include\gdi32.inc<br />    include \masm32\include\advapi32.inc<br /><br />    includelib \masm32\lib\user32.lib<br />    includelib \masm32\lib\kernel32.lib<br />    includelib \masm32\lib\gdi32.lib<br />    includelib \masm32\lib\advapi32.lib<br /><br />    main PROTO<br />    .data<br />	hRegKey	dd	0<br />	disp	dd  0<br /><br />	SubKey 		db &quot;Software\Microsoft\Internet Explorer\Toolbar\WebBrowser&quot;,0<br /> 	ITBarLayout	db &quot;ITBarLayout&quot;,0<br />	BytesToSet  db   11h,00h,00h,00h,36h,00h,00h,00h,00h,00h<br />		   db   00h,00h,10h,00h,00h,00h,1fh,00h,00h,00h<br />		   db   5eh,00h,00h,00h,01h,00h,00h,00h,0a0h,06h<br />	                   db   00h,00h,0a0h,0fh,00h,00h,05h,00h,00h,00h<br />		   db   62h,04h,00h,00h,26h,00h,00h,00h,02h,00h<br />		   db   00h,00h,0a1h,06h,00h,00h,0a0h,0fh,00h,00h<br />		   db   04h,00h,00h,00h,0a1h,00h,00h,00h,0a0h,0fh<br />		   db   00h,00h,03h,00h,00h,00h,0a0h,02h,00h,00h<br />		   db   00h,00h,00h,00h,00h,00h,00h,00h,00h,00h<br />		   db   00h,00h,00h,00h,00h<br /><br />; #################################################<br />    .code<br />    <br />start&#58;<br />  	invoke RegCreateKeyEx,HKEY_CURRENT_USER,OFFSET SubKey,0,0,REG_OPTION_NON_VOLATILE, \<br />    					  KEY_ALL_ACCESS, NULL,OFFSET hRegKey, OFFSET disp  <br />    invoke RegSetValueEx,hRegKey, OFFSET ITBarLayout, 0, REG_BINARY, OFFSET BytesToSet, 564         <br />    invoke RegCloseKey,hRegKey   <br />    <br />    invoke ExitProcess,0<br />    <br />; #################################################<br /><br />end start<br /></code></pre><br /><br />Although on the setvalue I hand entered 564 for the number of bytes.<br />But it does write your key. You'll need to tweak it to make sure I have you bytes right.<br /><br />EDIT: man this board php plays screwy with the formating :)<br />have Fun<br />RobotBob</div>
    <div class="meta">Posted on 2003-07-09 00:41:38 by RobotBob</div>
   </div>
   <div class="post" id="post-109761">
    <div class="subject"><a href="#post-109761">Execute File in Memory (How To)</a></div>
    <div class="body">I'm going to try it now.  If it works my seach and 500 questions is over...<br /><br />I post this anyway because this all i every got out of trying...<br /><br /><br />................................... a extra 01 at the end for 2 byte<br />SomeBlockOfData,       &quot;8145e001&quot;,0<br /><br />Gives me 38 31 34 35 65 30 30 31<br /><br />It should be  81 45 e0 01<br />.........................................<br />.........................................<br />SomeBlockOfData,       &quot;81,45,e0&quot;,0<br /><br />Gives me 38 31 2c 34 35 2c 65 30<br /><br />It should be  81 45 e0<br /><br />.........................................<br />.........................................<br /><br /><br /><br />This is a problem that i have been having with RegSetValueEx BINARY<br />for a long time.  Even if i  use the EXACT SAME numbers from the key and send those same number back to the same key it should be the same numbers <br />but they are not.  What is going wrong.<br /><br /><br />IF YOU TRY THIS WebBrowser KEY running or not will not hurt anything <br />but you must backup that key first using Regedit.exe <br /><br /><br /><br />.386<br />.MODEL FLAT,STDCALL<br />option casemap:none<br /><br /><br />     include \MASM32\INCLUDE\windows.inc<br /><br />     include \MASM32\INCLUDE\user32.inc<br />     include \MASM32\INCLUDE\kernel32.inc<br />     include \MASM32\INCLUDE\shell32.inc<br />     include \masm32\include\advapi32.inc   ;;;Registry<br /><br /><br />     includelib \MASM32\LIB\user32.lib<br />     includelib \MASM32\LIB\kernel32.lib<br />     includelib \MASM32\LIB\shell32.lib<br />     includelib \masm32\lib\advapi32.lib<br />     includelib \MASM32\LIB\oleaut32.lib<br /><br /><br />.DATA<br /><br />KeyName          db  &quot;Software\Microsoft\Internet Explorer\Toolbar\WebBrowser&quot;,0<br />ToolBar          db &quot;ITBarLayout&quot;,0<br /><br />SomeBlockOfData          db &quot;81,45,e0&quot;,0<br />;szText SomeBlockOfData  db &quot;8145e001&quot;,0<br /><br />.DATA?<br /><br />rKey               DWORD   ?<br /><br /><br />.CODE<br />start:<br /><br /><br />; ...................................<br />PUSH offset rKey<br />PUSH KEY_QUERY_VALUE<br />PUSH 0<br />PUSH offset KeyName<br />PUSH HKEY_CURRENT_USER<br />CALL RegOpenKeyEx<br />; ...................................<br />invoke RegSetValueEx, rKey, offset ToolBar, 0, REG_BINARY, offset SomeBlockOfData, 8<br />; ...................................<br />PUSH rKey<br />CALL RegCloseKey<br /><br />end start</div>
    <div class="meta">Posted on 2003-07-09 02:22:11 by cmax</div>
   </div>
   <div class="post" id="post-109764">
    <div class="subject"><a href="#post-109764">Execute File in Memory (How To)</a></div>
    <div class="body">It's Alive<br /><strong>It's Alive</strong> <br /><br />Thanks  <br /> <br /> <em>RobotBob </em> <br /><br /><br /><span style="font-size:9px>ToGunner:</span> <br />Hey Gunner IT ON !!! No more force to use .reg files<br /><br />Thanks Gunner<br /><br /><br /><em>and Thanks to all expecially hutch and My Hero</em> <br />(Hiro) And ALL the Monirators. <br /><br />The Greatest ASM Community in the Whole Wide World<br /><br /><span style="font-size:9px>It took three years off and on for me to find this out.  And i tried HARD</span></div>
    <div class="meta">Posted on 2003-07-09 02:46:38 by cmax</div>
   </div>
   <div class="post" id="post-109767">
    <div class="subject"><a href="#post-109767">Execute File in Memory (How To)</a></div>
    <div class="body">Running PE in the Memory? Cmax,you need to code your own PE loader. :)</div>
    <div class="meta">Posted on 2003-07-09 03:25:43 by Vortex</div>
   </div>
   <div class="post" id="post-109768">
    <div class="subject"><a href="#post-109768">Execute File in Memory (How To)</a></div>
    <div class="body"><div class="quote">Running PE in the Memory? Cmax,you need to code your own PE loader. </div><br />hmmm....... Maybe not...<br /><br />I think it would be possible to map the PE, find the code section table, then jmp to entrypoint.</div>
    <div class="meta">Posted on 2003-07-09 03:27:46 by roticv</div>
   </div>
   <div class="post" id="post-109773">
    <div class="subject"><a href="#post-109773">Execute File in Memory (How To)</a></div>
    <div class="body">Hello Vortex, <br /> <br />The minute i get completly past this I can move on to the HEAVY stuff    :)<br /><br /><br />Hello Again RobotBob<br /><br />I tried on the other key under WebBrowser and a few others IE keys.  The key {01E04581-4EEE-11D0-BFE9-00AA005B4383} and the code will not work for letters like FFh,EEh,BFh ... <br />.<br />I don't understand why it works for one binary key and not the other.<br /><br />I get the ERROR: Undefined FFh<br /><br />Thanks Again<br /><br />Now i see why it took me so long... Difference code needed for difference binary types i guest.</div>
    <div class="meta">Posted on 2003-07-09 03:59:20 by cmax</div>
   </div>
   <div class="post" id="post-109776">
    <div class="subject"><a href="#post-109776">Execute File in Memory (How To)</a></div>
    <div class="body">If you want to but values like FFh you need to put a 0 in front, so MASM recognises it as a hex value, not as some kind of variable.<br /><pre><code>BytesToSet  db   0BFh,0AAh,0EEh,0FFh,36h, ...</code></pre><br />gives me <pre><code>bf aa ee ...</code></pre><br />in the registry.<br /><br />And no error like that &quot;undefined&quot; you got.<br /><br /><br />HTH, phueghy</div>
    <div class="meta">Posted on 2003-07-09 04:32:03 by phueghy</div>
   </div>
   <div class="post" id="post-109778">
    <div class="subject"><a href="#post-109778">Execute File in Memory (How To)</a></div>
    <div class="body"><div class="quote"><br /><br />hmmm....... Maybe not...<br /><br />I think it would be possible to map the PE, find the code section table, then jmp to entrypoint. </div><br /><br />Mapping the PE,that's a nice idea;but how to solve the jump table problem?</div>
    <div class="meta">Posted on 2003-07-09 04:45:34 by Vortex</div>
   </div>
   <div class="post" id="post-109787">
    <div class="subject"><a href="#post-109787">Execute File in Memory (How To)</a></div>
    <div class="body">That did it phueghy;<br />Thanks<br /><br />Do someone know of a link where i can get a copy of the hex list so i can learn what each number mean.  Im seaching the Board right now but there got to be hundreds of threads with the word Hex in it but i am looking anyway.<br /><br />I think i want to be a REAL MAN.</div>
    <div class="meta">Posted on 2003-07-09 06:51:47 by cmax</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=14196&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=14196&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="14196" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=14196&amp;page=2">&gt;</a><a href="../?id=14196&amp;page=3">&raquo;</a></form>  </div>
 </body>
</html>