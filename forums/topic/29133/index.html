<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Newb Needs Help - win32 compiler error with FASM - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29133" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=29133">Newb Needs Help - win32 compiler error with FASM</a></p>
   <div class="post" id="post-205807">
    <div class="subject"><a href="#post-205807">Newb Needs Help - win32 compiler error with FASM</a></div>
    <div class="body">Hello, all.<br /><br />Those of you with a good memory might remember me on this forum about a year ago saying something about ASM programming and a game called FlopNinja that I wanted to program as a standalone bootable application.<br /><br />At any rate I got fed up with trying to figure out how to set up boot code whilst not knowing a single thing about win32 programming (or anything else about programming for that matter).<br /><br />So finally I broke out of my self-furnished mental straitjacket and decided that I just wanted to program SOMETHING THAT WORKS.<br /><br />Thus ensued a midnight internet rampage and I managed to find the Test Department tutorials here. I still wanted to use FASM so I wasn&#039;t able to do much with it, but then I mysteriously discovered the win32 template that had been in the FASM directory for who knows how long (!). Yay, I&#039;m actually beginning to understand something.<br /><br />So, I opened up the .asm file for Minipad and decided to try and do the wing-it thing and learn that way. I came up with this. Basically it was copy-and paste, look at the compiler errors and figure out what was wrong, fix it, etc. Now I&#039;ve found an error that I can&#039;t trace.<br /><br />Code is below, copy and paste into FASM to see what I&#039;m talking about. All dependencies are in the FASM include directory. Error is in the resource section when I start building the menubar for the window. <br /><br /><pre><code><br />; Template for program using standard Win32 headers<br /><br />format PE GUI 4.0<br />entry start<br /><br />include &#039;win32w.inc&#039;<br /><br />MENU_NEW&nbsp;  = 101<br />MENU_ABOUT = 102<br />MENU_HELP&nbsp; = 103<br />MENU_EXIT&nbsp; = 104<br /><br />section &#039;.data&#039; data readable writeable<br /><br />&nbsp; _class TCHAR &#039;FASMWIN32&#039;,0<br />&nbsp; _title TCHAR &#039;Win32 program template&#039;,0<br />&nbsp; _error TCHAR &#039;Startup failed.&#039;,0<br /><br />&nbsp; _about_title TCHAR &#039;About&#039;,0<br />&nbsp; _about_text&nbsp; TCHAR &#039;This is FirstApp, my First App.&#039;,0<br /><br />&nbsp; wc WNDCLASS 0,WindowProc,0,0,NULL,NULL,NULL,COLOR_BTNFACE+1,NULL,_class<br /><br />&nbsp; msg MSG<br /><br />section &#039;.code&#039; code readable executable<br /><br />&nbsp; start:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; GetModuleHandle,0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Getting window ID (handle)<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ,eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;putting ID into variable wc.hInstance<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; LoadIcon,0,IDI_APPLICATION&nbsp; &nbsp; ;giving our window an icon<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; LoadCursor,0,IDC_ARROW&nbsp; &nbsp; &nbsp; &nbsp; ;loading a cursor (otherwise the mouse arrow would disappear when it went over our window).<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; RegisterClass,wc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Registering all this via RegisterClass, wc=using wc.* variables.<br />&nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; eax,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; jz&nbsp; &nbsp; &nbsp; error<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; LoadMenu,,37<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; CreateWindowEx,0,_class,_title,WS_VISIBLE+WS_DLGFRAME+WS_SYSMENU,128,128,480,320,NULL,NULL,,NULL&nbsp;  ;creating window.<br />&nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; eax,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; jz&nbsp; &nbsp; &nbsp; error<br /><br />&nbsp; msg_loop:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Waits for message. If message found, TranslateMessage calls the appropriate code block.<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; GetMessage,msg,NULL,0,0<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  eax,1<br />&nbsp; &nbsp; &nbsp; &nbsp; jb&nbsp; &nbsp; &nbsp; end_loop<br />&nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  msg_loop<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; TranslateMessage,msg<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; DispatchMessage,msg<br />&nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  msg_loop<br /><br />&nbsp; error:<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; MessageBox,NULL,_error,NULL,MB_ICONERROR+MB_OK<br /><br />&nbsp; end_loop:<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; ExitProcess,<br /><br />proc WindowProc hwnd,wmsg,wparam,lparam<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ebx esi edi<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  ,WM_DESTROY<br />&nbsp; &nbsp; &nbsp; &nbsp; je&nbsp; &nbsp; &nbsp; .wmdestroy<br />&nbsp; .defwndproc:<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; DefWindowProc,,,,<br />&nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  .finish<br />&nbsp; .wmcommand:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;compares message string and calls the appropriate code block.<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax,<br />&nbsp; &nbsp; &nbsp; &nbsp; and&nbsp; &nbsp;  eax,0FFFFh<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  eax,MENU_NEW<br />&nbsp; &nbsp; &nbsp; &nbsp; je&nbsp; &nbsp; &nbsp; .new<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  eax,MENU_ABOUT<br />&nbsp; &nbsp; &nbsp; &nbsp; je&nbsp; &nbsp; &nbsp; .about<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  eax,MENU_HELP<br />&nbsp; &nbsp; &nbsp; &nbsp; je&nbsp; &nbsp; &nbsp; .help<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  eax,MENU_EXIT<br />&nbsp; &nbsp; &nbsp; &nbsp; je&nbsp; &nbsp; &nbsp; .wmdestroy<br />&nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  .defwndproc<br />&nbsp; &nbsp; &nbsp; .new:<br />&nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  .finish<br />&nbsp; &nbsp; &nbsp; .about:<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; MessageBox,,_about_text,_about_title,MB_OK<br />&nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  .finish<br />&nbsp; &nbsp; &nbsp; .help:<br />&nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  .finish<br />&nbsp; .wmdestroy:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Exit<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; PostQuitMessage,0<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  eax,eax<br />&nbsp; .finish:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;Return<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  edi esi ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />endp<br /><br />section &#039;.idata&#039; import data readable writeable<br /><br />&nbsp; library kernel32,&#039;KERNEL32.DLL&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; user32,&#039;USER32.DLL&#039;<br /><br />&nbsp; include &#039;api\kernel32.inc&#039;<br />&nbsp; include &#039;api\user32.inc&#039;<br /><br />&nbsp; import kernel,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  GetModuleHandle,&#039;GetModuleHandleA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  ExitProcess,&#039;ExitProcess&#039;<br /><br />&nbsp; import user,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  RegisterClass,&#039;RegisterClassA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  CreateWindowEx,&#039;CreateWindowExA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  DefWindowProc,&#039;DefWindowProcA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  SetWindowLong,&#039;SetWindowLongA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  RedrawWindow,&#039;RedrawWindow&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  GetMessage,&#039;GetMessageA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  TranslateMessage,&#039;TranslateMessage&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  DispatchMessage,&#039;DispatchMessageA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  SendMessage,&#039;SendMessageA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  LoadCursor,&#039;LoadCursorA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  LoadIcon,&#039;LoadIconA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  LoadMenu,&#039;LoadMenuA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  GetClientRect,&#039;GetClientRect&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  MoveWindow,&#039;MoveWindow&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  SetFocus,&#039;SetFocus&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  MessageBox,&#039;MessageBoxA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp;  PostQuitMessage,&#039;PostQuitMessage&#039;<br /><br />section &#039;.rsrc&#039; resource data readable<br /><br />&nbsp; ; resource directory<br /><br />&nbsp; directory RT_MENU,menus,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RT_ICON,icons,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RT_GROUP_ICON,group_icons,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RT_VERSION,versions<br /><br />&nbsp; ; resource subdirectories<br /><br />&nbsp; resource menus,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  37,LANG_ENGLISH+SUBLANG_DEFAULT,menu_bar<br /><br />&nbsp; resource icons,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  1,LANG_NEUTRAL,icon_data<br /><br />&nbsp; resource group_icons,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  17,LANG_NEUTRAL,main_icon<br /><br />&nbsp; resource versions,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  1,LANG_NEUTRAL,version<br /><br />&nbsp; menu menu_bar<br />&nbsp; &nbsp; &nbsp;  menuitem &#039;&amp;File&#039;,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; menuitem &#039;&amp;New&#039;,MENU_NEW<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; menuseparator<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; menuitem &#039;E&amp;xit&#039;,MENU_EXIT<br />&nbsp; &nbsp; &nbsp;  menuitem &#039;&amp;Help&#039;,MENU_HELP<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; menuitem &#039;&amp;About...&#039;,MENU_ABOUT<br /><br />&nbsp; icon main_icon,icon_data,&#039;minipad.ico&#039;<br /><br />&nbsp; versioninfo version,VOS__WINDOWS32,VFT_APP,VFT2_UNKNOWN,LANG_ENGLISH+SUBLANG_DEFAULT,0,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;FileDescription&#039;,&#039;FirstApp - my First App&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;LegalCopyright&#039;,&#039;No rights reserved.&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;FileVersion&#039;,&#039;0.0&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;ProductVersion&#039;,&#039;0.0&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;OriginalFilename&#039;,&#039;FirstApp.exe&#039;<br /></code></pre><br /><br />p.s. I still plan on doing FlopNinja once I feel I have a handle on the important stuff.<br /><br />Thanks for any help, <br /><br /> - keantoken</div>
    <div class="meta">Posted on 2008-08-23 06:04:18 by keantoken</div>
   </div>
   <div class="post" id="post-205812">
    <div class="subject"><a href="#post-205812">Re: Newb Needs Help - win32 compiler error with FASM</a></div>
    <div class="body">As the resident game-oriented type without a straight jacket, I commend you, and I will support you and answer your stupid shop questions without hesitation :)</div>
    <div class="meta">Posted on 2008-08-23 11:15:20 by Homer</div>
   </div>
   <div class="post" id="post-205813">
    <div class="subject"><a href="#post-205813">Re: Newb Needs Help - win32 compiler error with FASM</a></div>
    <div class="body"><div class="quote">As the resident game-oriented type without a straight jacket, I commend you, and I will support you and answer your stupid shop questions without hesitation</div><br /><br />Thank you.<br /><br />It spits out some kind of error during compile about how size?mc is not defined. It doesn&#039;t do this for minipad.asm (in the examples directory of FASM), even though I haven&#039;t found anything in minipad.asm that would point me to my problem (I&#039;m comparing them side-by side so as to have direction when something wonks out). The compiler output gives me the line number in another include file having to do with the menu function but I sure can&#039;t decode it. Could it be that I need to state a variable for this? If so then I haven&#039;t found any documentation on MSDN or the ancient win32.hlp file, and no variables like this are stated in minipad.asm.<br /><br />About shop questions:<br /><br />1: I&#039;m guessing that almost any number work in windows will be with unsigned integers, unless it has to do with hardware DAC/sound/graphics/algorithms.<br /><br />2: Is there any way to manually flip the FPU register to do rounding correctly for sound programs too stupid to do it themselves? <br /><br />Thank you for your answers,<br /><br /> - keantoken</div>
    <div class="meta">Posted on 2008-08-23 14:46:19 by keantoken</div>
   </div>
   <div class="post" id="post-205870">
    <div class="subject"><a href="#post-205870">Re: Newb Needs Help - win32 compiler error with FASM</a></div>
    <div class="body">1. Yes<br />2. No (caveat, you can hook stuff to work around it)<br /><br />I dont use fasm, but if you post your binary I&#039;ll trace it and tell you what and where the problem is.<br />I&#039;m doing most of my dev work using ObjAsm32, a macro based buildtime environment for masm... something half way between c++ and asm. <br /><br />I don&#039;t actually like masm at all, and you can expect we&#039;ll support other assemblers soon via a preprocessor and/or compiler.<br /></div>
    <div class="meta">Posted on 2008-09-04 22:58:42 by Homer</div>
   </div>
   <div class="post" id="post-205872">
    <div class="subject"><a href="#post-205872">Re: Newb Needs Help - win32 compiler error with FASM</a></div>
    <div class="body">2) only by manually doing something like <br />.data<br />f_05 real4 0.5<br />.code<br />fld in_value<br />fadd f_05<br />fistp out_value<br /><br />I just woke up, I don&#039;t remember which rounding mode the above needs; maybe just the default. <br /><br /><br />[ I suspect/recall fasm doesn&#039;t have (powerful) macros ] For sane gamedev in asm, I don&#039;t see how I&#039;ll cope without macros. I even had to make a macro-preprocessor for my non-x86 commercial games, to keep my sanity. Still, x86 has the easiest ISA, so it&#039;s possible to get top-notch results quickly even without macros. <br /><br />Btw, I remember you - at least your interesting nick :)</div>
    <div class="meta">Posted on 2008-09-05 02:15:17 by Ultrano</div>
   </div>
   <div class="post" id="post-205971">
    <div class="subject"><a href="#post-205971">Re: Newb Needs Help - win32 compiler error with FASM</a></div>
    <div class="body"><div class="quote">Those of you with a good memory might remember me on this forum about a year ago saying something about ASM programming and a game called FlopNinja that I wanted to program as a standalone bootable application.</div><br /><br />And the fact that you are very young, and you write quite well (and quite much sometimes&nbsp; :) )<br />And something about a cool turtle, too :)<br /><br />good luck in your programming journey!<br /><br /></div>
    <div class="meta">Posted on 2008-09-24 03:04:40 by HeLLoWorld</div>
   </div>
  </div>
 </body>
</html>