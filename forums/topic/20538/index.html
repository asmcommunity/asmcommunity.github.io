<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ObjAsm32 Version 1.3b - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20538" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=38">Object Oriented Programming</a> &raquo; <a href="../?id=20538">ObjAsm32 Version 1.3b</a></p>
   <div class="post" id="post-156882">
    <div class="subject"><a href="#post-156882">ObjAsm32 Version 1.3b</a></div>
    <div class="body"><img src="http://members.rogers.com/objasm32/images/oa32.JPG" /><br /><br />We have reached what we feel is another mile stone in the OA32 progress. ?&nbsp;There has been improvements and expansion of the project, as well as additional work has been invested in this release to reinforce the work already done; Namely more simple and direct tutorials. <br /><br />Below is a list of some of the features:<br /><ul>[*]Works with <strong>Hutch&#39;s MASM32</strong> Package<br />[*]Supported by <strong>RadASM version 2.1.0.7</strong> or greater.<br />[*]Model improvements and extensions. <br />[*]Static object implementation. <br />[*]New debugging features and a new debug console. <br />[*]COM aggregation supported. <br />[*]COM OCX demo application. <br />[*]DirectX support and demo application. <br />[*]Translation of Iczelion tutorials 3 - 11. <br />[*]More projects. <br />[*]...and much more in this new release!<br /><br />We welcome your feedback. ?&nbsp;If your new to this project, simply download it and check out the Demo&#39;s or the Nan_Tuts. ?&nbsp;The Nan_Tuts were deliberately desigend to reflect each of Iczelion&#39;s famous tutorials. ?&nbsp;Since most if not all of you are familiar with these tutorials, it was my hope that it would help sever as a basis to teach the Object Orientated approach to the same problem in each tutorial. ?&nbsp;I didnt copy the origional tutorials, so I leave it to you review Iczelions&#39; work from his many sites. ?&nbsp;However, I did make a large effort to ensure my equivalent demos are well commented.<br /><br />Please provide your feed back, good or bad.<br /><br />You can get the download at the following site:<a target="_blank" href="http://objasm32.tripod.com/docs.htm">ObjAsm32 Home Page</a><br /><br />Please let us know if the bandwidth gets chewed up. ?&nbsp;We will make additional provisions to offer the package in this case.<br /><br />Best Regards and have fun!<br />:alright:<br />:NaN:</ul></div>
    <div class="meta">Posted on 2005-02-09 17:53:28 by NaN</div>
   </div>
   <div class="post" id="post-156893">
    <div class="subject"><a href="#post-156893">ObjAsm32 Version 1.3b</a></div>
    <div class="body">Hi Biterider + NaN,<br /><br />&gt; Please provide your feed back, good or bad<br /><br />The setup program allows to choose a different folder (and drive) for OA32 than for MASM32, but after I selected C:\ObjAsm32 and D:\MASM32 I had some difficulties to get anything to work. The idea of oa32_setup.inc with path equates is good, but the source sometimes seems to ignore these definitions.</div>
    <div class="meta">Posted on 2005-02-10 01:29:05 by japheth</div>
   </div>
   <div class="post" id="post-156898">
    <div class="subject"><a href="#post-156898">ObjAsm32 Version 1.3b</a></div>
    <div class="body">Hi Japheth!<br />Thanks for your feedback. I'll check if I have forgotten to modify some parts of the code... <br /><br />Regards,<br /><br />Biterider</div>
    <div class="meta">Posted on 2005-02-10 04:24:17 by Biterider</div>
   </div>
   <div class="post" id="post-156920">
    <div class="subject"><a href="#post-156920">ObjAsm32 Version 1.3b</a></div>
    <div class="body">It's a normal problem with masm32, imho - I always keep asm/C/C++ code in D: in order to stay away from such faults. There are already two or more folders on my HDD that contain ml.exe, all registered in %PATH% . Just to save you a minute or two:<br /><pre><code><br />;------------&#91; find where MASM32 is &#93;--------------------------------------\<br />.data<br />	;compilation1 db &quot;C&#58;\masm32\bin\ml /c /coff pbmp_out.imp&quot;,0  <br />	;compilation2 db &quot;C&#58;\masm32\bin\lib pbmp_out.obj /out&#58;%s.lib&quot;,0<br />	masmfolder db &quot;C&#58;\masm32&quot;,0<br />.code<br />	mov ebx,'C'<br />	@@&#58;<br />		mov masmfolder&#91;0&#93;,bl<br />		;mov compilation1&#91;0&#93;,bl<br />		;mov compilation2&#91;0&#93;,bl<br />		push ebx<br />		invoke GetFileAttributes,addr masmfolder<br />		pop ebx<br />		inc ebx<br />		cmp eax,-1<br />		je @B<br />	;--------------------------------------------------------------------------/		<br /></code></pre></div>
    <div class="meta">Posted on 2005-02-10 12:37:38 by Ultrano</div>
   </div>
   <div class="post" id="post-156975">
    <div class="subject"><a href="#post-156975">ObjAsm32 Version 1.3b</a></div>
    <div class="body">I played with the OCX sample a bit (called LED server) and run into some problems:<br /><br />1. The first problem was that I wanted to modify IOleObject.inc but got assembly errors, even for the unmodified version. The reason seems to be that I once converted the include files of masm32 with l2extia. With these include file versions oa32 doesn't work. In my case it was GetClipboardData. This name is a valid user32 function and a method of IOleObject.as well. l2extia creates an equate in user32.inc:<br /><br />GetClipboardData equ &lt;_imp__GetClipboardData@4&gt;<br /><br />which caused the problem. As a workaround I modified user32.inc temporarily.<br /><br />2. The modified version of IOleObject.inc is<br /><br /><pre><code><br />Method IOleObject.DoVerb,uses esi, dVerb&#58;dword, pMsg&#58;Pointer, pActiveSite&#58;Pointer, \<br />                                    dReserved&#58;dword, hParent&#58;Handle, pRect&#58;Pointer<br />local pUnknown&#58;ptr<br />local cauuid&#58;CAUUID	<br /><br />    DbgText &quot;IOleObject.DoVerb&quot;<br />    DbgDec dVerb<br />    SetObject esi<br />    .if dVerb == OLEIVERB_PROPERTIES<br />      .if &#91;esi&#93;.pIOleClientSite != NULL<br />        push ecx<br />        ICall &#91;esi&#93;.pIOleClientSite&#58;&#58;IOleClientSite.QueryInterface, addr IID_IOleControlSite, esp<br />        pop ecx<br />        .if SUCCEEDED&#40;eax&#41;<br />          push ecx<br />          ICall ecx&#58;&#58;IOleControlSite.ShowPropertyFrame<br />          pop ecx<br />          push eax<br />          ICall ecx&#58;&#58;IOleControlSite.Release<br />          pop eax<br />        .else<br />          mov eax, E_NOTIMPL<br />        .endif<br />        .if &#40;eax == E_NOTIMPL&#41;<br />            push 0<br />externdef c IID_ISpecifyPropertyPages&#58;IID            <br />            ICall esi&#58;&#58;IUnknown.QueryInterface, addr IID_ISpecifyPropertyPages, esp<br />            pop ecx<br />            .if &#40;eax == S_OK&#41;<br />            	push ecx<br />                ICall ecx&#58;&#58;ISpecifyPropertyPages.GetPages, addr cauuid<br />                pop ecx<br />                push eax<br />                ICall ecx&#58;&#58;ISpecifyPropertyPages.Release<br />                pop eax<br />                .if &#40;eax == S_OK&#41;<br />                    mov pUnknown,esi<br />        .const<br />wszProperties	dw 'P','r','o','p','e','r','t','i','e','s',0<br />        .code<br />                    invoke OleCreatePropertyFrame, hParent, 32, 32, \<br />                       offset wszProperties, 1, addr pUnknown,\<br />                       cauuid.dElems,cauuid.pElems, 0, 0, 0<br />                    mov eax,S_OK<br />                .endif<br />	    .else<br />                 mov eax, OLEOBJ_S_CANNOT_DOVERB_NOW <br />            .endif<br />        .endif<br />        DbgComError eax<br />      .endif<br />    .elseif dVerb == OLEIVERB_ABOUT               ;About Dialog requested &#40;= 1&#41;<br />      OCall $New&#40;DialogAbout, Init, esi, hParent&#41;&#58;&#58;DialogAbout.Show<br />      xor eax, eax                                ;Return S_OK<br />    .else<br />      mov eax, E_NOTIMPL<br />    .endif<br />MethodEnd<br /></code></pre><br /><br />The idea of the changes is to show the property pages by myself if  IOleControlSite doesn't do it (which is legal, since this function is optional). But I couldn't find out how to directly get the ISpecifyPropertyPages interface with OA32, so I had to use QueryInterface/Release, which is very ugly. (BTW, I was also unable to use the CUStr macro to define a wide string, so I defined the string the hard way).<br /><br />3. comview always shows the server state as &quot;loaded&quot;, it never is in &quot;activated&quot; or &quot;uiactivated&quot; state. So obviously the control currently doesn't call the required container function calls.<br /><br />4. The dll remains loaded in memory after the object is released. I suspect this is due to some missing Release calls.<br /></code></pre></div>
    <div class="meta">Posted on 2005-02-12 05:06:00 by japheth</div>
   </div>
   <div class="post" id="post-156981">
    <div class="subject"><a href="#post-156981">ObjAsm32 Version 1.3b</a></div>
    <div class="body">&gt; 4. The dll remains loaded in memory after the object is released.<br /><br />Apparently this no longer happens with the modified version of IOleObject.inc.</div>
    <div class="meta">Posted on 2005-02-12 08:38:27 by japheth</div>
   </div>
   <div class="post" id="post-156982">
    <div class="subject"><a href="#post-156982">ObjAsm32 Version 1.3b</a></div>
    <div class="body">Hi Japheth!<br />I have been working on a more flexible way to install the package and I can say that I?m 90%   ready. Some difficulties remain with the RC compiler when used from inside RadAsm, but I?m sure that KetilO can help us to setup all properly? The new approach is using 2 environmental variables to specify the OA32 and the MASM32 paths, since the last one can also be installed somewhere else.<br /><br />Concerning the Led OCX, you are right with the name collision. I?ll change the interface method name a bit to avoid it.<br />I tested your changes (switching first all LoadObjects to MakeObjects in the asm file) and it worked well.<br />The way I planed to get an interface is using the Component.GetInterface method defined in COMPrimers.inc. This method searches in the interface collection for the proper IID and returns an interface pointer. It is the object internal equivalent for QueryInterface. Since the interfaces are stored in a collection, there are other ways to retrieve this info too.<br />There a 2 ways to reference an UNICODE string, the first is<br /><br /><pre><code>invoke OleCreatePropertyFrame, hParent, 32, 32, \ <br />           $OfsCUStr&#40;&quot;Properties&quot;&#41;, 1, addr pUnknown,\ <br />            cauuid.dElems,cauuid.pElems, 0, 0, 0</code></pre><br /><br />or define somewhere <br /><br /><pre><code>CUStr wszProperties, &quot;Properties&quot;</code></pre><br /><br />and then<br /><br /><pre><code>invoke OleCreatePropertyFrame, hParent, 32, 32, \ <br />            offset wszProperties, 1, addr pUnknown,\ <br />            cauuid.dElems,cauuid.pElems, 0, 0, 0</code></pre><br /><br />I personally prefer the first.<br /><br />Your point 3 is right. I have to implement it.<br /><br />Finally, point 4, how do you know that the DLL remains in memory?  In my tests, the DLL_PROCESS_DETACH was called and as far as I know, this was enough to guarantee that the DLL was (can be) freed from memory?<br /><br />Thanks for testing!   :) <br /><br />Regards,<br /><br />Biterider</div>
    <div class="meta">Posted on 2005-02-12 10:39:12 by Biterider</div>
   </div>
   <div class="post" id="post-156984">
    <div class="subject"><a href="#post-156984">ObjAsm32 Version 1.3b</a></div>
    <div class="body">&gt; how do you know that the DLL remains in memory?<br /><br />Usually I set switch &quot;call CoFreeUnusedLibraries after Release&quot; in comview and then check with a process viewer if the dll has vanished. But I cannot reproduce the error with the original version. It disappears as it should if I open and close a container window. Problems occur only if I don't open such a window (that is, I create an led object instance and then immediately close the &quot;object&quot; dialog). Then I get various errors, sometimes GPFs. But that is minor, since a control usually is created inside a container.</div>
    <div class="meta">Posted on 2005-02-12 11:37:42 by japheth</div>
   </div>
   <div class="post" id="post-157018">
    <div class="subject"><a href="#post-157018">ObjAsm32 Version 1.3b</a></div>
    <div class="body">Hello Biterider,<br /><br /><div class="quote"><br />or define somewhere<br /><br />Code:<br />CUStr wszProperties, &quot;Properties&quot;<br /></div><br /><br />This works now, it was a missing UString.inc in IOleObject.asm which caused the error.<br /><br />I'm having another very interesting problem. When I enter<br /><br />ml -c -coff -Cp IOleObject.asm<br /><br />I get no errors, but when I want a listing and enter<br /><br />ml -c -coff -Cp -Fl IOleObject.asm<br /><br />masm displays some errors:<br /><div class="quote"><br /> Assembling: IOleObject.asm<br />WinPrimer.inc(21) : error A2018: invalid use of external symbol<br /> MacroLoop(3): iteration 1: Macro Called From <br />  MacroLoop(9): iteration 1: Macro Called From <br />   CreateEventStructure(20): Macro Called From<br />    ObjectEnd(38): Macro Called From<br />     WinPrimer.inc(21): Include File<br />Dialog.inc(43) : error A2018: invalid use of external symbol<br /> MacroLoop(3): iteration 1: Macro Called From <br />  MacroLoop(9): iteration 1: Macro Called From <br />   CreateEventStructure(20): Macro Called From<br />    CreateEventStructure(5): Macro Called From<br />     ObjectEnd(38): Macro Called From<br />      Dialog.inc(43): Include File<br /></div><br /><br />it may be a - strange - MASM bug, but if so you possibly ran into this error already and know a workaround?<br /><br />Regards<br /><br />Japheth</div>
    <div class="meta">Posted on 2005-02-14 03:10:03 by japheth</div>
   </div>
   <div class="post" id="post-157020">
    <div class="subject"><a href="#post-157020">ObjAsm32 Version 1.3b</a></div>
    <div class="body">Hi Japheth!<br /><br />The support for UNICODE strings is in the Code\Macros\UStrings.inc file.<br />Add the following line to the first include block of the IOleObject.asm file:<br /><br /><pre><code>% include &amp;MacPath&amp;UStrings.inc</code></pre><br /><br />and recompile it.<br /><br />Regards,<br /><br />Biterider</div>
    <div class="meta">Posted on 2005-02-14 05:02:07 by Biterider</div>
   </div>
   <div class="post" id="post-157025">
    <div class="subject"><a href="#post-157025">ObjAsm32 Version 1.3b</a></div>
    <div class="body">Hi Japheth<br />I haven't seen it before, but I have to admit that it's a long time that I didn't generate a listing. I suspect that it's an internal error of ML that's not capable to resolve an external symbol for a listing the same way it does for the compilation. <br />I also found some other compilation problems related to segment organization... <br />I'll see if I can find out what is generating the listing problem.<br /><br />Regards<br /><br />Biterider</div>
    <div class="meta">Posted on 2005-02-14 08:44:29 by Biterider</div>
   </div>
   <div class="post" id="post-159221">
    <div class="subject"><a href="#post-159221">Re: ObjAsm32 Version 1.3b</a></div>
    <div class="body"><div class="quote"><br />I also found some other compilation problems related to segment organization... <br /></div><br /><br />Yes, there is one known bug, maybe it helps: (check the lastest posts of the thread)<br />http://217.160.247.193/index.php?topic=7797.0</div>
    <div class="meta">Posted on 2005-04-22 02:43:30 by MazeGen</div>
   </div>
  </div>
 </body>
</html>