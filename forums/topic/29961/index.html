<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Show a bmp - only half the pic shows - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29961" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29961">Show a bmp - only half the pic shows</a></p>
   <div class="post" id="post-211545">
    <div class="subject"><a href="#post-211545">Show a bmp - only half the pic shows</a></div>
    <div class="body">I have modified some code, but this is displaying only half of the picture.<br /><br />I want to show a pic at the beginning of my program and then go on to other things.<br /><br />Do I need to modify the dimensions in <br />invoke BitBlt,hDC,10,10,166,68,memDC,0,0,SRCCOPY ?<br /><br />Thanks.<br /><br /><br /><br /><pre><code><br />; test.asm<br />&nbsp; &nbsp; &nbsp; .386<br />&nbsp; &nbsp; &nbsp; .model flat, stdcall&nbsp; ; 32 bit memory model<br />&nbsp; &nbsp; &nbsp; option casemap :none&nbsp; ; case sensitive<br /><br />&nbsp; &nbsp; &nbsp; include bitblt.inc&nbsp; &nbsp; ; local includes for this file<br /><br />.code<br /><br />start:<br />&nbsp; &nbsp; &nbsp; invoke GetModuleHandle, NULL<br />&nbsp; &nbsp; &nbsp; mov hInstance, eax<br /><br />&nbsp; &nbsp; &nbsp; invoke LoadBitmap,hInstance,100<br />&nbsp; &nbsp; &nbsp; mov hBmp, eax<br /><br />&nbsp; &nbsp; &nbsp; invoke GetCommandLine<br />&nbsp; &nbsp; &nbsp; mov CommandLine, eax<br /><br />&nbsp; &nbsp; &nbsp; invoke WinMain,hInstance,NULL,CommandLine,SW_SHOWDEFAULT<br />&nbsp; &nbsp; &nbsp; invoke ExitProcess,eax<br /><br />WinMain proc hInst&nbsp; &nbsp;  :DWORD,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  hPrevInst :DWORD,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  CmdLine&nbsp;  :DWORD,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  CmdShow&nbsp;  :DWORD<br /><br />&nbsp; &nbsp; &nbsp; ;====================<br />&nbsp; &nbsp; &nbsp; ; Put LOCALs on stack<br />&nbsp; &nbsp; &nbsp; ;====================<br /><br />&nbsp; &nbsp; &nbsp; LOCAL wc&nbsp;  :WNDCLASSEX<br />&nbsp; &nbsp; &nbsp; LOCAL msg&nbsp; :MSG<br />&nbsp; &nbsp; &nbsp; LOCAL Wwd&nbsp; :DWORD<br />&nbsp; &nbsp; &nbsp; LOCAL Wht&nbsp; :DWORD<br />&nbsp; &nbsp; &nbsp; LOCAL Wtx&nbsp; :DWORD<br />&nbsp; &nbsp; &nbsp; LOCAL Wty&nbsp; :DWORD<br /><br />&nbsp; &nbsp; &nbsp; ;==================================================<br />&nbsp; &nbsp; &nbsp; ; Fill WNDCLASSEX structure with required variables<br />&nbsp; &nbsp; &nbsp; ;==================================================<br /><br />&nbsp; &nbsp; &nbsp; invoke LoadIcon,hInst,500&nbsp; &nbsp; ; icon ID<br />&nbsp; &nbsp; &nbsp; mov hIcon, eax<br /><br />&nbsp; &nbsp; &nbsp; szText szClassName,&quot;Project_Class&quot;<br /><br />&nbsp; &nbsp; &nbsp; mov wc.cbSize,&nbsp; &nbsp; &nbsp; &nbsp;  sizeof WNDCLASSEX<br />&nbsp; &nbsp; &nbsp; mov wc.style,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CS_BYTEALIGNWINDOW<br />&nbsp; &nbsp; &nbsp; mov wc.lpfnWndProc,&nbsp; &nbsp; offset WndProc<br />&nbsp; &nbsp; &nbsp; mov wc.cbClsExtra,&nbsp; &nbsp;  NULL<br />&nbsp; &nbsp; &nbsp; mov wc.cbWndExtra,&nbsp; &nbsp;  NULL<br />&nbsp; &nbsp; &nbsp; m2m wc.hInstance,&nbsp; &nbsp; &nbsp; hInst<br />&nbsp; &nbsp; &nbsp; mov wc.hbrBackground,&nbsp; COLOR_BTNFACE+1<br />&nbsp; &nbsp; &nbsp; mov wc.lpszMenuName,&nbsp;  NULL<br />&nbsp; &nbsp; &nbsp; mov wc.lpszClassName,&nbsp; offset szClassName<br />&nbsp; &nbsp; &nbsp; m2m wc.hIcon,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hIcon<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke LoadCursor,NULL,IDC_ARROW<br />&nbsp; &nbsp; &nbsp; mov wc.hCursor,&nbsp; &nbsp; &nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; m2m wc.hIconSm,&nbsp; &nbsp; &nbsp; &nbsp; hIcon<br /><br />&nbsp; &nbsp; &nbsp; invoke RegisterClassEx, ADDR wc<br /><br />&nbsp; &nbsp; &nbsp; ;================================<br />&nbsp; &nbsp; &nbsp; ; Centre window at following size<br />&nbsp; &nbsp; &nbsp; ;================================<br /><br />&nbsp; &nbsp; &nbsp; mov Wwd, 500<br />&nbsp; &nbsp; &nbsp; mov Wht, 350<br /><br />&nbsp; &nbsp; &nbsp; invoke GetSystemMetrics,SM_CXSCREEN<br />&nbsp; &nbsp; &nbsp; invoke TopXY,Wwd,eax<br />&nbsp; &nbsp; &nbsp; mov Wtx, eax<br /><br />&nbsp; &nbsp; &nbsp; invoke GetSystemMetrics,SM_CYSCREEN<br />&nbsp; &nbsp; &nbsp; invoke TopXY,Wht,eax<br />&nbsp; &nbsp; &nbsp; mov Wty, eax<br /><br />&nbsp; &nbsp; &nbsp; invoke CreateWindowEx,WS_EX_LEFT,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ADDR szClassName,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ADDR szDisplayName,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WS_OVERLAPPEDWINDOW,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wtx,Wty,Wwd,Wht,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NULL,NULL,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hInst,NULL<br />&nbsp; &nbsp; &nbsp; mov&nbsp;  hWnd,eax<br /><br />&nbsp; &nbsp; &nbsp; invoke LoadMenu,hInst,600&nbsp; ; menu ID<br />&nbsp; &nbsp; &nbsp; invoke SetMenu,hWnd,eax<br /><br />&nbsp; &nbsp; &nbsp; invoke ShowWindow,hWnd,SW_SHOWNORMAL<br />&nbsp; &nbsp; &nbsp; invoke UpdateWindow,hWnd<br /><br />&nbsp; &nbsp; &nbsp; ;===================================<br />&nbsp; &nbsp; &nbsp; ; Loop until PostQuitMessage is sent<br />&nbsp; &nbsp; &nbsp; ;===================================<br /><br />&nbsp; &nbsp; StartLoop:<br />&nbsp; &nbsp; &nbsp; invoke GetMessage,ADDR msg,NULL,0,0<br />&nbsp; &nbsp; &nbsp; cmp eax, 0<br />&nbsp; &nbsp; &nbsp; je ExitLoop<br />&nbsp; &nbsp; &nbsp; invoke TranslateMessage, ADDR msg<br />&nbsp; &nbsp; &nbsp; invoke DispatchMessage,&nbsp; ADDR msg<br />&nbsp; &nbsp; &nbsp; jmp StartLoop<br />&nbsp; &nbsp; ExitLoop:<br /><br />&nbsp; &nbsp; &nbsp; return msg.wParam<br /><br />WinMain endp<br /><br />WndProc proc hWin&nbsp;  :DWORD,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  uMsg&nbsp;  :DWORD,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  wParam :DWORD,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  lParam :DWORD<br /><br />&nbsp; &nbsp; LOCAL var&nbsp; &nbsp; :DWORD<br />&nbsp; &nbsp; LOCAL caW&nbsp; &nbsp; :DWORD<br />&nbsp; &nbsp; LOCAL caH&nbsp; &nbsp; :DWORD<br />&nbsp; &nbsp; LOCAL Rct&nbsp; &nbsp; :RECT<br />&nbsp; &nbsp; LOCAL hDC&nbsp; &nbsp; :DWORD<br />&nbsp; &nbsp; LOCAL Ps&nbsp; &nbsp;  :PAINTSTRUCT<br />&nbsp; &nbsp; LOCAL buffer1[128]:BYTE&nbsp; ; these are two spare buffers<br />&nbsp; &nbsp; LOCAL buffer2[128]:BYTE&nbsp; ; for text manipulation etc..<br /><br />&nbsp; &nbsp; .if uMsg == WM_COMMAND<br />&nbsp; &nbsp; ;======== menu commands ========<br />&nbsp; &nbsp; .elseif uMsg == WM_CREATE<br /><br />&nbsp; &nbsp; .elseif uMsg == WM_SIZE<br /><br />&nbsp; &nbsp; .elseif uMsg == WM_PAINT<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke BeginPaint,hWin,ADDR Ps<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov hDC, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke Paint_Proc,hWin,hDC<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke EndPaint,hWin,ADDR Ps<br />&nbsp; &nbsp; &nbsp; &nbsp; return 0<br /><br />&nbsp; &nbsp; .elseif uMsg == WM_CLOSE<br /><br />&nbsp; &nbsp; .elseif uMsg == WM_DESTROY<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke PostQuitMessage,NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; return 0 <br />&nbsp; &nbsp; .endif<br /><br />&nbsp; &nbsp; invoke DefWindowProc,hWin,uMsg,wParam,lParam<br /><br />&nbsp; &nbsp; ret<br /><br />WndProc endp<br /><br />TopXY proc wDim:DWORD, sDim:DWORD<br /><br />&nbsp; &nbsp; shr sDim, 1&nbsp; &nbsp; &nbsp; ; divide screen dimension by 2<br />&nbsp; &nbsp; shr wDim, 1&nbsp; &nbsp; &nbsp; ; divide window dimension by 2<br />&nbsp; &nbsp; mov eax, wDim&nbsp; &nbsp; ; copy window dimension into eax<br />&nbsp; &nbsp; sub sDim, eax&nbsp; &nbsp; ; sub half win dimension from half screen dimension<br /><br />&nbsp; &nbsp; return sDim<br /><br />TopXY endp<br /><br />Paint_Proc proc hWin:DWORD, hDC:DWORD<br /><br />&nbsp; &nbsp; LOCAL hOld:DWORD<br />&nbsp; &nbsp; LOCAL memDC :DWORD<br /><br />&nbsp; &nbsp; invoke CreateCompatibleDC,hDC<br />&nbsp; &nbsp; mov memDC, eax<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; invoke SelectObject,memDC,hBmp<br />&nbsp; &nbsp; mov hOld, eax<br /><br />&nbsp; &nbsp; invoke BitBlt,hDC,10,10,166,68,memDC,0,0,SRCCOPY<br /><br />&nbsp; &nbsp; invoke SelectObject,hDC,hOld<br />&nbsp; &nbsp; invoke DeleteDC,memDC<br /><br />&nbsp; &nbsp; return 0<br /><br />Paint_Proc endp<br /><br />; ########################################################################<br /><br />end start<br /></code></pre></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=3121" target="_blank">Show_Bmp.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2010-05-01 16:04:25 by skywalker</div>
   </div>
   <div class="post" id="post-211546">
    <div class="subject"><a href="#post-211546">Re: Show a bmp - only half the pic shows</a></div>
    <div class="body">I don&#039;t have MASM here anymore and the attachment lacks of an executable that I could patch so the following may be wrong and/or incomplete:<br /><br />You need to change to &quot;invoke BitBlt,hDC,10,10,<strong>183,170</strong>,memDC,0,0,SRCCOPY&quot; to fully copy the image.</div>
    <div class="meta">Posted on 2010-05-01 16:53:43 by LocoDelAssembly</div>
   </div>
  </div>
 </body>
</html>