<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>DLGTEMPLATEEX et al - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25463" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25463">DLGTEMPLATEEX et al</a></p>
   <div class="post" id="post-186131">
    <div class="subject"><a href="#post-186131">DLGTEMPLATEEX et al</a></div>
    <div class="body">Hi all,<br /><br />I have to use a dialog template in memory for a little sample code I am working on and since I haven&#39;t ever really done this that I can remember I am having a bit of trouble. The dialog will show correctly until I add a control, at which point it returns &quot;Error 1407 &gt; Cannot find window class.&quot;. Since the class is &quot;Edit&quot; I think I must have an alignment problem but I can&#39;t find it...<br /><br /><pre><code>NEWITEMTEMPLATEEX struct<br />	dlgVer DW 1<br />	signature DW 0FFFFh<br />	helpID DD 0<br />	exStyle DD WS_EX_TOOLWINDOW<br />	style DD WS_VISIBLE + WS_SYSMENU + WS_CAPTION + DS_SETFONT<br />	cDlgItems DW 1<br />	x DW 6<br />	y DW 6<br />	cx DW 208<br />	cy DW 212<br />	menu DW 0 ;IDD_NEWITEMDLG<br />	windowClass DW 0<br />	title DUS &quot;New/edit item&quot;,0<br />	pointsize DW 8<br />	weight DW 400<br />	italic DB 0<br />	charset DB 0<br />	typeface DUS &quot;MS Sans Serif&quot;,0<br />ENDS<br /><br />CONTROL1 STRUCT<br />	helpID DD 0<br />	exStyle DD 0x00000200<br />	style DD 0x50010000<br />	x DW 56<br />	y DW 70<br />	cx DW 120<br />	cy DW 13<br />	id DW IDC_STARTIN<br />	windowClass DUS &quot;Edit&quot;,0<br />	title DW 0<br />	extraCount DW 0<br />ENDS<br /><br />DATA SECTION<br /><br />ALIGN 4<br />NewItemDlg NEWITEMTEMPLATEEX &lt;&gt;<br />ALIGN 4<br />Ctrl1 CONTROL1 &lt;&gt;<br />ALIGN 4<br />EndDlgTemplate: // Provides padding to the next DWORD boundary<br /><br />CODE SECTION<br /><br />invoke DialogBoxIndirectParam,,offset NewItemDlg,,offset DlgProc2,0</code></pre><br /><br />Ofcourse the DialogBoxIndirectParam is in my main message loop and the  and  parameters are filled and correct at the time of the call. Thanks in advance for any help.<br /><br />Donkey</div>
    <div class="meta">Posted on 2006-10-22 15:00:03 by donkey</div>
   </div>
   <div class="post" id="post-186133">
    <div class="subject"><a href="#post-186133">Re: DLGTEMPLATEEX et al</a></div>
    <div class="body">hi donkey,<br /><br />your class definition is wrong, check this out: <br /><br /><pre><code><br />;-----------------------------------------------------------<br />.const ; DialogEx Memory templates by drizz<br />;-----------------------------------------------------------<br />BUTTTON_CLASS equ 80h<br />EDIT_CLASS&nbsp; &nbsp; equ 81h<br />STATIC_CLASS&nbsp; equ 82h<br /><br />dup_unicode macro ustr:vararg; pass nothing for nil ustring<br />&nbsp; IFNB &lt;ustr&gt;<br />&nbsp; &nbsp; &nbsp; FORC arg,&lt;ustr&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IFDIFI &lt;arg&gt;, &lt;!&#39;&gt;&nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IFDIFI &lt;arg&gt;, &lt;!&quot;&gt;&nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; db &quot;&amp;arg&quot;,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ENDIF&nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ENDIF&nbsp;  <br />&nbsp; &nbsp; &nbsp; ENDM<br />&nbsp; ENDIF&nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; db 0,0<br />endm<br /><br />; Dialog ;-----------------------------------------------------------<br />DLGT_START macro Name:req,title:req,font:req,fontsize:req,exStyle:req,Style:req,itemCnt:req,l:req,t:req,w:req,h:req<br />ALIGN 4<br />Name	dw 1,-1;dlgVer,signature<br />		dd 0;helpID<br />		dd exStyle<br />		dd WS_VISIBLE or DS_SETFONT or Style<br />		dw itemCnt<br />		dw l,t,w,h; x,y,cx,cy<br />		dw 0,0;menu,class<br />		dup_unicode title; caption		<br />		dw fontsize<br />		dw 0<br />		dw 0<br />		dup_unicode font; font face<br />endm <br />; Edit ;-----------------------------------------------------------<br />DLGT_EDIT macro exStyle:req,Style:req,itemID:req,l:req,t:req,w:req,h:req<br />ALIGN 4<br />	dd 0<br />&nbsp; &nbsp; dd exStyle<br />&nbsp; &nbsp; dd WS_VISIBLE or WS_CHILD or ES_LEFT or Style<br />&nbsp; &nbsp; dw l,t,w,h; x,y,cx,cy<br />&nbsp; &nbsp; dd itemID; ctlID<br />&nbsp; &nbsp; dw 0ffffh,EDIT_CLASS; -1,class<br />&nbsp; &nbsp; dw 0<br />endm<br />; Static ;-----------------------------------------------------------<br />DLGT_STATIC macro caption:req,exStyle:req,Style:req,itemID:req,l:req,t:req,w:req,h:req<br />ALIGN 4<br />	dd 0<br />&nbsp; &nbsp; dd exStyle<br />&nbsp; &nbsp; dd WS_VISIBLE or WS_CHILD or SS_LEFT or Style<br />&nbsp; &nbsp; dw l,t,w,h;x,y,cx,cy<br />&nbsp; &nbsp; dd itemID;ctlID<br />&nbsp; &nbsp; dw 0ffffh,STATIC_CLASS;-1,class<br />&nbsp; &nbsp; dup_unicode caption<br />ALIGN 2<br />&nbsp; &nbsp; dw 0<br />endm<br />; GroupBox ;--------------------------------------------------------<br />DLGT_GRPBOX macro caption:req,exStyle:req,Style:req,itemID:req,l:req,t:req,w:req,h:req<br />ALIGN 4<br />	dd 0<br />&nbsp; &nbsp; dd exStyle<br />&nbsp; &nbsp; dd WS_VISIBLE or WS_CHILD or BS_GROUPBOX or Style<br />&nbsp; &nbsp; dw l,t,w,h;0,0,200,87;x,y,cx,cy<br />&nbsp; &nbsp; dd itemID;-1;667; ctlID<br />&nbsp; &nbsp; dw 0ffffh,BUTTTON_CLASS;-1,class<br />&nbsp; &nbsp; dup_unicode caption<br />ALIGN 2<br />&nbsp; &nbsp; dw 0<br />endm<br />; Button ;-----------------------------------------------------------<br />DLGT_BUTTON macro caption:req,exStyle:req,Style:req,itemID:req,l:req,t:req,w:req,h:req<br />ALIGN 4<br />&nbsp; &nbsp; dd 0<br />&nbsp; &nbsp; dd exStyle<br />&nbsp; &nbsp; dd WS_VISIBLE or WS_CHILD or BS_PUSHBUTTON or WS_TABSTOP or Style<br />&nbsp; &nbsp; dw l,t,w,h;0,0,200,87;x,y,cx,cy<br />&nbsp; &nbsp; dd itemID;-1;667; ctlID<br />&nbsp; &nbsp; dw 0ffffh,BUTTTON_CLASS;-1,class<br />&nbsp; &nbsp; dup_unicode caption<br />ALIGN 2<br />&nbsp; &nbsp; dw 0<br />endm<br />; CheckBox ;-----------------------------------------------------------<br />DLGT_CHKBOX macro caption:req,exStyle:req,Style:req,itemID:req,l:req,t:req,w:req,h:req<br />ALIGN 4<br />&nbsp; &nbsp; dd 0<br />&nbsp; &nbsp; dd exStyle<br />&nbsp; &nbsp; dd WS_VISIBLE or WS_CHILD or BS_AUTOCHECKBOX or WS_TABSTOP or Style<br />&nbsp; &nbsp; dw l,t,w,h;0,0,200,87;x,y,cx,cy<br />&nbsp; &nbsp; dd itemID;-1;667; ctlID<br />&nbsp; &nbsp; dw 0ffffh,BUTTTON_CLASS;-1,class<br />&nbsp; &nbsp; dup_unicode caption<br />ALIGN 2<br />&nbsp; &nbsp; dw 0<br />endm<br />;---------------------------------------------------------------------<br />DLGT_END macro<br />&nbsp; &nbsp; dw 0<br />endm<br />;---------------------------------------------------------------------<br /></code></pre><br /><br /><pre><code>IDC_BTN1 equ 101<br />IDC_BTN2 equ 102<br />DLG_STYLE equ DS_MODALFRAME or DS_CENTER&nbsp; or WS_CAPTION or WS_SYSMENU<br />.data<br />DLGT_START DlgTemplate,&#39;Hello World&#39;,&#39;Arial&#39;,8,WS_EX_DLGMODALFRAME,DLG_STYLE,2,&nbsp; 6,6,194,106<br />DLGT_BUTTON &#39;Btn&#39;,WS_EX_STATICEDGE,0,IDC_BTN1, 8,7,48,12<br />DLGT_BUTTON &#39;Btn&#39;,WS_EX_STATICEDGE,0,IDC_BTN2, 8,24,48,15<br />DLGT_END</code></pre></div>
    <div class="meta">Posted on 2006-10-22 16:19:20 by drizz</div>
   </div>
   <div class="post" id="post-186134">
    <div class="subject"><a href="#post-186134">Re: DLGTEMPLATEEX et al</a></div>
    <div class="body">Thank you very much Drizz, however it was not the class that was the problem though your post did point it out to me, I was missing a parameter (dwitemID). All is fine now (with UNICODE text as the class so I can use common controls and custom classes). Funny that that feild is not in the documentation for the structure.<br /><br />Donkey</div>
    <div class="meta">Posted on 2006-10-22 16:27:35 by donkey</div>
   </div>
   <div class="post" id="post-186136">
    <div class="subject"><a href="#post-186136">Re: DLGTEMPLATEEX et al</a></div>
    <div class="body">of course : &gt;custom classes&lt; doh, either way, you found the error&nbsp; :)<br /></div>
    <div class="meta">Posted on 2006-10-22 16:41:21 by drizz</div>
   </div>
   <div class="post" id="post-186137">
    <div class="subject"><a href="#post-186137">Re: DLGTEMPLATEEX et al</a></div>
    <div class="body">Hi Drizz,<br /><br />Actually the error was that I had defined the id as a WORD when it should have been a DWORD, dummy me, actually believing the SDK !!!!<br /><br /><pre><code>typedef struct {<br />&nbsp; &nbsp; DWORD helpID;<br />&nbsp; &nbsp; DWORD exStyle;<br />&nbsp; &nbsp; DWORD style;<br />&nbsp; &nbsp; short x;<br />&nbsp; &nbsp; short y;<br />&nbsp; &nbsp; short cx;<br />&nbsp; &nbsp; short cy;<br />&nbsp; &nbsp; WORD id;<br />&nbsp; &nbsp; sz_Or_Ord windowClass;<br />&nbsp; &nbsp; sz_Or_Ord title;<br />&nbsp; &nbsp; WORD extraCount;<br />} DLGITEMTEMPLATEEX;</code></pre><br /><br />id should be a DWORD not a WORD then everything is perfect.</div>
    <div class="meta">Posted on 2006-10-22 16:50:09 by donkey</div>
   </div>
   <div class="post" id="post-186138">
    <div class="subject"><a href="#post-186138">Re: DLGTEMPLATEEX et al</a></div>
    <div class="body">Hi, <br /><br />it seems you aren&#39;t the only one :)<br />http://blogs.msdn.com/andypennell/archive/2006/03/29/564231.aspx<br /><br />check the info in this KB (dword)&nbsp;  :)<br />http://support.microsoft.com/default.aspx?scid=kb;en-us;141201</div>
    <div class="meta">Posted on 2006-10-22 17:14:19 by drizz</div>
   </div>
   <div class="post" id="post-186139">
    <div class="subject"><a href="#post-186139">Re: DLGTEMPLATEEX et al</a></div>
    <div class="body">It seems we ended up with the same solution, define an extra WORD in the structure...<br /><br /><pre><code>CONTROL1 STRUCT<br />	helpID DD 0<br />	exStyle DD WS_EX_CLIENTEDGE<br />	style DD WS_CHILD+WS_VISIBLE+WS_TABSTOP<br />	x DW 56<br />	y DW 70<br />	cx DW 120<br />	cy DW 13<br />	id DW IDC_STARTIN<br />	unknown DW 0<br />	windowClass DUS &quot;Edit&quot;,0<br />	title DW 0<br />	extraCount DW 0<br />ENDS</code></pre></div>
    <div class="meta">Posted on 2006-10-22 17:33:02 by donkey</div>
   </div>
  </div>
 </body>
</html>