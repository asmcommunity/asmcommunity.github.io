<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Shell Menu Item - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=28982" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=28982">Shell Menu Item</a></p>
   <div class="post" id="post-204855">
    <div class="subject"><a href="#post-204855">Shell Menu Item</a></div>
    <div class="body">Does anybody know how I can associate a menu-item with my program when the user for example right clicks on their desktop? Or for example, let&#039;s say the user selects a series of files and/or folders and right clicks. How can I create a menu-item in the list of the items that will popup in the default menu?<br /><br />Thanks in advance</div>
    <div class="meta">Posted on 2008-02-25 00:07:52 by XCHG</div>
   </div>
   <div class="post" id="post-204856">
    <div class="subject"><a href="#post-204856">Re: Shell Menu Item</a></div>
    <div class="body">I&#039;m having problems with my website provider this weekend but I have attached an example here...<br /><br /></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=2560" target="_blank">IContextMenu.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2008-02-25 00:50:21 by donkey</div>
   </div>
   <div class="post" id="post-204857">
    <div class="subject"><a href="#post-204857">Re: Shell Menu Item</a></div>
    <div class="body">Hi Edgar-<br /><br />That works if you click on a file, do you have anything that works if you right click on the naked desktop?<br /><br /></div>
    <div class="meta">Posted on 2008-02-25 08:15:29 by JimG</div>
   </div>
   <div class="post" id="post-204858">
    <div class="subject"><a href="#post-204858">Re: Shell Menu Item</a></div>
    <div class="body">JimG, in DllRegisterServer function, add your CLSID to \SOFTWARE\Classes\Directory\Background\shellex\ContextMenuHandlers.</div>
    <div class="meta">Posted on 2008-02-25 10:35:42 by sapero</div>
   </div>
   <div class="post" id="post-204860">
    <div class="subject"><a href="#post-204860">Re: Shell Menu Item</a></div>
    <div class="body">Thanks sapero, I&#039;ll give it a try.</div>
    <div class="meta">Posted on 2008-02-25 11:48:05 by JimG</div>
   </div>
   <div class="post" id="post-204863">
    <div class="subject"><a href="#post-204863">Re: Shell Menu Item</a></div>
    <div class="body">Okay here&#039;s the deal! The context menu handler  can handle specific file types. Right? But let&#039;s say the user selects a bunch of files with different extensions and a couple of folders and then right clicks. How can I handle that? I have looked in many places but all of the codes just deal with specific file types. For example, UltraEdit (Hex Editor) appears in the Explorer&#039;s context menu wherever you right click on any file or a group of files/folders. That&#039;s what I have to create and have no idea how to by the way.<br /></div>
    <div class="meta">Posted on 2008-02-26 10:44:30 by XCHG</div>
   </div>
   <div class="post" id="post-204864">
    <div class="subject"><a href="#post-204864">Re: Shell Menu Item</a></div>
    <div class="body">Hi XCHG,<br /><br />Multiple files are handled through IContextMenu::InvokeCommand, you can use DragQueryFiles to extract the information for more than one file, in my example I do not loop the query but it is not difficult to add the couple of extra lines needed.</div>
    <div class="meta">Posted on 2008-02-26 10:52:33 by donkey</div>
   </div>
   <div class="post" id="post-204865">
    <div class="subject"><a href="#post-204865">Re: Shell Menu Item</a></div>
    <div class="body">Are you talking about multiple files of the same type? I am not if you are :(</div>
    <div class="meta">Posted on 2008-02-26 11:01:23 by XCHG</div>
   </div>
   <div class="post" id="post-204866">
    <div class="subject"><a href="#post-204866">Re: Shell Menu Item</a></div>
    <div class="body">Hi XCHG,<br /><br />You can specify any file type by using the &quot;HKEY_CLASSES_ROOT\*\shellex\ContextMenuHandlers&quot; file class when registering the menu handler, then all files will be passed to it.<br /><br />http://msdn2.microsoft.com/en-us/library/bb776881(VS.85).aspx</div>
    <div class="meta">Posted on 2008-02-26 11:18:44 by donkey</div>
   </div>
   <div class="post" id="post-204869">
    <div class="subject"><a href="#post-204869">Re: Shell Menu Item</a></div>
    <div class="body">Hits the nail on the head! Thanks.</div>
    <div class="meta">Posted on 2008-02-26 12:38:27 by XCHG</div>
   </div>
   <div class="post" id="post-204870">
    <div class="subject"><a href="#post-204870">Re: Shell Menu Item</a></div>
    <div class="body"><div class="quote"><br />Hits the nail on the head! Thanks.<br /></div><br /><br />No probs. Good luck with the project.</div>
    <div class="meta">Posted on 2008-02-26 15:13:45 by donkey</div>
   </div>
   <div class="post" id="post-204900">
    <div class="subject"><a href="#post-204900">Re: Shell Menu Item</a></div>
    <div class="body"><div class="quote"><br /><div class="quote"><br />Hits the nail on the head! Thanks.<br /></div><br /><br />No probs. Good luck with the project.<br /></div><br /><br />Thank you so much. I did finish the project. It was a code that I had to write for somebody in RentaCoder.com and I did it in Delphi which helps a lot for such projects. However, I have to mention that to register the Shell Extension to work with both files and folders, I had to write the Registry entries for both HKEY_CLASSES_ROOT\*\shellex\ContextMenuHandlers and HKEY_CLASSES_ROOT\Directory\shellex\ContextMenuHandlers. Before that, when a list of files and folders was selected, you couldn&#039;t see the Shell context menu item. But after registering the context menu handler for both * and Directory, it worked fine.<br /><br />Thank you again for your help. Your example helped a lot.</div>
    <div class="meta">Posted on 2008-03-02 06:15:18 by XCHG</div>
   </div>
  </div>
 </body>
</html>