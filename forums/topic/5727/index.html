<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Qeditor problems on XP - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=5727" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=5727">Qeditor problems on XP</a></p>
   <div class="post" id="post-40929">
    <div class="subject"><a href="#post-40929">Qeditor problems on XP</a></div>
    <div class="body">I have been checking code that has recently been reported as problematic in this forum in Quick Editor and both instances are related to using SendMessage with EM_GETLINE.<br /><br />On my win95b, win98se and winNT4 + sp6a, the API call works as it is documented but i have no immediate way of testing what is happening on XP.<br /><br />If anyone is using Qeditor on XP, would you test if the Auto Indent works properly and if the setini.exe application that is called when you change editor settings works correctly when you press the &quot;Check Menus&quot; button ?<br /><br />I need to see if this is normal on XP or unusual.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-06-01 08:25:40 by hutch--</div>
   </div>
   <div class="post" id="post-40935">
    <div class="subject"><a href="#post-40935">Qeditor problems on XP</a></div>
    <div class="body">Auto Indent = No Problem.<br />Check Menus = Endless loop of message boxes.</div>
    <div class="meta">Posted on 2002-06-01 09:08:40 by bitRAKE</div>
   </div>
   <div class="post" id="post-40956">
    <div class="subject"><a href="#post-40956">Qeditor problems on XP</a></div>
    <div class="body">Ricky,<br /><br />Thanks for testing this, this one is no so much of a problem to fix.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-06-01 11:52:16 by hutch--</div>
   </div>
   <div class="post" id="post-42429">
    <div class="subject"><a href="#post-42429">Qeditor problems on XP</a></div>
    <div class="body">I have tested it on XP, and there?s something going on with the indent: when I?m editing someting, it &quot;shifts&quot; the indent thing, Mostly evewry time I write a label, like:<br /><br />   pop this<br />   pop that<br />   jmp over_this<br />over_this:            &lt;----------Here the disp`lay moves<br />  femms               &lt;-----here moves back<br /><br /><br />It?s the only thing I?ve found yet.<br />By the way, I use it to code.<br />(Wish the fonts could be changed though)<br /><br />I like it, with the grown up editor ;) too.</div>
    <div class="meta">Posted on 2002-06-10 14:32:20 by slop</div>
   </div>
   <div class="post" id="post-42521">
    <div class="subject"><a href="#post-42521">Qeditor problems on XP</a></div>
    <div class="body">fjrp2,<br /><br />Thanks for your feedback, it seems that all of the problems associated with qeditor come back to the EM_GETLINE message sent with SendMessage specifically on XP as it works correctly and to the documentation on win95/98/NT4/2k.<br /><br />It seems specific to XP that the richedit 1 control does not perform to the previous documentation so I am currently writing a complex test piece as an editor to try and track down what the variations are so I can find another work around for errant API functions.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-06-11 00:56:57 by hutch--</div>
   </div>
   <div class="post" id="post-42802">
    <div class="subject"><a href="#post-42802">Qeditor problems on XP</a></div>
    <div class="body">Do you think that?s the only &quot;different&quot; thing with the XP API, or are there other &quot;surprises&quot; (should wue call them enhancements) ?</div>
    <div class="meta">Posted on 2002-06-12 02:40:34 by slop</div>
   </div>
   <div class="post" id="post-51379">
    <div class="subject"><a href="#post-51379">Qeditor problems on XP</a></div>
    <div class="body">sloppy, most of the time things that seem like &quot;hey, this windows<br />version does this thing differently&quot; is when you don't follow the<br />specifications... it can be very subtle things, like the EM_GETLINE<br />documentation saying<br /><div class="quote"><br />Before sending the message, set the first word of this buffer to the size, in <strong>TCHARs</strong>, of the buffer. <br /></div><br />Note that TCHAR is capital and bold, while 'word' is neither... thus,<br />this most likely refers to machine-word size (32bit), and not the<br />win32 16bit <strong>WORD</strong> datatype. I played around a bit, and while<br />&quot;random&quot; values don't produce any errors (as long as you don't get<br />buffer overflows), you definitely have to set this (d)word. Set it to<br />zero (or forget setting it, with zero-initialized allocated memory), and<br />you will get no string back.<br /><br />There have been other cases where microsoft has been blamed for<br />programming errors that weren't theirs - I remember some memory mapping<br />issues... the behaviour of UnmapViewOfFile was definitely a bit<br />peculiar, and it ought to have returned error rather than doing<br />what it did. But the bug was still within hutches code, no windows.<br /><br />This is not meant as 'hutch bashing' - but I'd just like to suggest<br />people to blame their own code before blaming MS. Most of the time,<br />it's <strong>your</strong> fault. I assume EM_GETLINE is widely used, there's<br />a lot of richedit applications out there... yet &quot;EM_GETLINE+bug&quot;<br />on google doesn't return anything that would indicate a but in ms code.<br /><br />Hutch, assuming you don't store the buffer length in the first<br />dword of your buffers before EM_GETLINE, could you please try doing<br />this (even if you have a workaround already)? It would be nice to<br />find out if this really *is* a bug in MS code (though I doubt it).</div>
    <div class="meta">Posted on 2002-08-02 11:47:34 by f0dder</div>
   </div>
   <div class="post" id="post-51446">
    <div class="subject"><a href="#post-51446">Qeditor problems on XP</a></div>
    <div class="body">Hmmmm,<br /><br />recycled IRC. The message EM_GETLINE has been around since win95oem so the assumptions appropriate to what may work on XP or win2k don't mean much.<br /><br />When Microsoft publish the specifications of a function and their own implementation of it differs from the documentation in one or more versions, I call it a BUG.<br /><pre><code><br />EM_GETLINE  <br />wParam = &#40;WPARAM&#41; line;          // line number to retrieve <br />lParam = &#40;LPARAM&#41; &#40;LPCSTR&#41; lpch; // address of buffer for line <br /></code></pre><br />WIN32.HLP<br />The first word of the buffer specifies the maximum number of characters that can be copied to the buffer. <br /><br />MSDN<br />The first word of the buffer specifies the maximum number of characters that can be copied to the buffer.<br /><br />Note that in two of the major references to Microsoft functions that there is NO reference to the information you quoted.<br /><pre><code><br />Before sending the message, set the first word of this buffer to the size, in TCHARs, of the buffer.<br /></code></pre> <br /><br />Which leads to my original point, the documentation for the function differs from the implementation in some windows versions. Now it does not matter if the function actually works in the Windows versions that differ, the problem is that they don't work in the way that they are documented.<br /><br />Producing later documentation that has a different explanation only proves that the functionality has changed and that the function does not perform to the earlier specification that is documented in the standard Microsoft literature.<br /><br />You need to keep in mind that EM_GETLINE is used with the 16 bit edit control that is in win9x, NT4, etc .... so the assumption that using the machines native &quot;word&quot; size is documented behaviour does not make sense. The 16 bit edit control cannot address.<br /><br />I have to go at the moment but I will finish this later.<br /><br />Regards,<br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-08-03 02:51:45 by hutch--</div>
   </div>
   <div class="post" id="post-51457">
    <div class="subject"><a href="#post-51457">Qeditor problems on XP</a></div>
    <div class="body"><div class="quote"><br />Note that in two of the major references to Microsoft functions that there is NO reference to the information you quoted.<br /></div><br />The november 2001 release of the PlatformSDK does. So does the august 2001.<br /><br /><div class="quote"><br />You need to keep in mind that EM_GETLINE is used with the 16 bit edit control that is in win9x, NT4, etc .... so the assumption that using the machines native &quot;word&quot; size is documented behaviour does not make sense. The 16 bit edit control cannot address.<br /></div><br />Well... even win32.hlp seems rather consistant in writing data types in <strong>UPPERCASE BOLD</strong>. Like PlatformSDK, it doesn't do this for the 'word' in EM_GETLINE. C code I have seen (both 16 and 32bit) use something like<br /><pre><code><br />*&#40;&#40;int *&#41; buffer&#41; = buflen;<br /></code></pre><br />This seems to work just fine, and I've never seen anybody else complain about EM_GETLINE. Assuming that it is really a 16bit <strong>WORD</strong> that's wanted (which could be the case - there's a lot of win32 api documentation, and missing a little detail like uppercasing+bolding a couple words here and there could certainl happen), it will not matter since x86 is little-endian (well, it could matter if you have a ridiculously small buffer ;)).<br /><br />If you can give a piece of code which has a reproducible EM_GETLINE problem, or you can give some information on how to make qeditor bork, I'd be happy to take a further look into this. I still very much doubt that it's a microsoft problem, but if it is, the exact circumstances of the b0rking should be identified (windows version(s), riched version(s), etc) so people can avoid problems with their code. But still, taking into account the amount of applications using richedit, and the lack of mention about EM_GETLINE trouble outside of wine mailing lists...</div>
    <div class="meta">Posted on 2002-08-03 04:31:01 by f0dder</div>
   </div>
   <div class="post" id="post-51464">
    <div class="subject"><a href="#post-51464">Qeditor problems on XP</a></div>
    <div class="body">Right,<br /><br />I am back, just rescued a damsel in distress. :)<br /><br />You latest post makes the point about unreliable documentation in an operating system that has changed the operation of a function.<br /><br />The november 2001 release of the PlatformSDK does. So does the august 2001.<br /><br />Window in 32 bit has been released since 1995 and the documentation that was current for it then and later is different to the documentation you have quoted.<br /><br />When changed code causes an existing function to break using the documentation that was current for it, its a BUG in the OS code.<br /><br />Here is another, the function call &quot;GlobalMemoryStatus&quot; works as it is documented in win9x, WinNT4 but parts of it do not work in 2k/XP, I call that a BUG.<br /><br />You mentioned a problem I had with the release call for a memory mapped file. When a function call causes a GP fault instead of returning the correct error as it is documented, I call that a BUG in the OS code.<br /><br />The problem with your argument is that win32 existed well before the release of win2k and while win2k/XP have released additional functionality, it has also introduced BUGS in existing functionality because a number of functions that have been around since 1995 do not work any longer.<br /><br />Now there may be the situation where the functions in Win2k work fine but I wonder what is the use when they deviate from the documented forms that have worked on earlier versions for a long time beforehand ?<br /><br />We may have a different view as to what a bug in opereating system code may be. As I am well familiar with Microsofts habit of changing things without advising anyone and letting everyone find out the hard way that there are defects in one or more of the operating systems that they design.<br /><br />I am yet to see your point in raising this issue when bad habits by Microsoft fill volumes. What I in fact did to solve the problem was to produce the functionality of EM_GETLINE by another method that did not suffer the defects of not performing to specification. It can be done with messages that are not shared with 16 bit controls and that appears so far to be more stable than the older messages.<br /><br />I will keep using this technique until Microsoft changes the rules again and I will probably have to find another work around to another BUG that they introduce in a later version of Windows.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-08-03 05:43:04 by hutch--</div>
   </div>
   <div class="post" id="post-51475">
    <div class="subject"><a href="#post-51475">Qeditor problems on XP</a></div>
    <div class="body"><div class="quote"><br />Window in 32 bit has been released since 1995 and the documentation that was current for it then and later is different to the documentation you have quoted.<br /></div><br />The text has been updated from win32.hlp to the recent platformsdk, but the content is still the same, really. The update has to do with unicode support (a thing that wasn't really in win3.x as far as I remember ;)).<br /><br />win32.hlp says:<br /><div class="quote"><br /><em>lpch</em><br />Value of lParam. Points to the buffer that receives a copy of the line. The first word of the buffer specifies the maximum number of characters that can be copied to the buffer. <br /></div><br /><br />PlatformSDK says:<br /><div class="quote"><br /><em>lParam</em><br />Pointer to the buffer that receives a copy of the line. Before sending the message, set the first word of this buffer to the size, in <strong>TCHARs</strong>, of the buffer. For ANSI text, this is the number of bytes; for Unicode text, this is the number of characters. The size in the first word is overwritten by the copied line. <br /></div><br /><br />I don't see anything indicating changes other than the support of unicode text.<br /><br /><div class="quote"><br />When changed code causes an existing function to break using the documentation that was current for it, its a BUG in the OS code.<br /></div><br />Sure... but sometimes programmers have misinterpreted documentation (and that often because documentation has been poor). And other times the problems have been register preservation, structure alignment (etc) - things that aren't documented (or at least not with big bold letters), but still make a difference.<br /><br /><div class="quote"><br />Here is another, the function call &quot;GlobalMemoryStatus&quot; works as it is documented in win9x, WinNT4 but parts of it do not work in 2k/XP, I call that a BUG.<br /></div><br />Dunno, I don't have any trouble with it. Every field returned (on my win2ksp2 and a friends XP) has sensible values. I think you had trouble with &quot;dwMemoryLoad&quot; under NT4? That does sound like a bug, true. bazik had some negative values with pagefile size, but that's due to the int-&gt;str conversion routine. Unsigned, the value amounted to ~3.3GB, not a unreasonable size.<br /><br /><div class="quote"><br />You mentioned a problem I had with the release call for a memory mapped file. When a function call causes a GP fault instead of returning the correct error as it is documented, I call that a BUG in the OS code.<br /></div><br />Yes, it is indeed a bug of UnmapViewOfFile to unmap your main module with the value you passed to it (if you had been passing it your base address, it would have been correct behaviour though). But it still doesn't change the fact that *your* code was buggy and you blamed microsoft.<br /><br /><div class="quote"><br />The problem with your argument is that win32 existed well before the release of win2k and while win2k/XP have released additional functionality, it has also introduced BUGS in existing functionality because a number of functions that have been around since 1995 do not work any longer.<br /></div><br />I'm not saying microsoft hasn't made mistakes and introduced bugs in newer versions of their OSes... I haven't bumped into any yet, though (apart from UnmapViewOfFile not returning and error in your code). I think it's too easy to blame microsoft when something goes wrong. I still haven't excluded the possibility that EM_GETLINE *could* be broken, I just find it unlikely, and would like to be able to reproduce it myself.<br /><br /><div class="quote"><br />We may have a different view as to what a bug in opereating system code may be.<br /></div><br />Dunno. When something doesn't live up to the PlatformSDK information, I'd label it as either a bug or documentation error. But I try to be very very very sure that it's their fault and not mine before I rush out and say &quot;yet another windows bug yadda yadda&quot;.<br /><br />Bleh, this is turning into a flamewar. I just want a piece of code that shows the EM_GETLINE 'bug', or directions on how to make the old version of qeditor fail.</div>
    <div class="meta">Posted on 2002-08-03 06:51:31 by f0dder</div>
   </div>
   <div class="post" id="post-51605">
    <div class="subject"><a href="#post-51605">Qeditor problems on XP</a></div>
    <div class="body">Well,<br /><br />Since I did not resurect this topic for a free kick in something where you are a long way from being sure of the results you query, i wonder why you bothered ?<br /><br />I have been shovelling through errors in Windows versions for about 12 years to date and sad to say its nothing new, its been happening that long. Win31wh.hlp was a lot better version than WIN32.HLP which takes a long time to decypher when you first get into it.<br /><br />In days of old, when Microsoft made another mess of a function or a capacity, you could open the DLL code and see what it was actually doing and get the code to work properly but with the proliferation of Windows versions that are around and then the extra deviation with various service packs, getting something to work on one version does not help you on another, you are at the mercy of lousy documentation.<br /><br />The problem was never that the code did not work, it was always related to the documentation of how it was supposed to work and these two categories do not always match.<br /><br />I just dont see the point of your approach of defending badly written documentation that Microsoft are not willing to follow themselves in a later operating system version.<br /><br />You may understand my approach of preferring operating system versions that Microsoft have abandoned as they are at last stable and you can predictably write code for them.<br /><br />Fortunately most people in the world own out of date OS's so its not hard to cater for them where the later versions do suffer arbitrary changes that you find out the hard way when the code that works correctly on earlier version crashes on a later one.<br /><br />I call these changes BUGS, with or without your agreement as I have seen thousands of them in my time, this is why I don't take much notice of what you say here as i have seen different too many times before.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-08-04 07:18:46 by hutch--</div>
   </div>
   <div class="post" id="post-54046">
    <div class="subject"><a href="#post-54046">TheGun</a></div>
    <div class="body">Just a slight bug with TheGun on XP with saving files. If I select &quot;File -&gt; Save&quot; or &quot;File -&gt; Save As&quot; from the menu the 'Open A File' dialog is always shown (After the 'Save File As' dialog if &quot;File -&gt; Save As&quot; is selected). The saving of the file is still done correctly.</div>
    <div class="meta">Posted on 2002-08-18 23:52:12 by huh</div>
   </div>
   <div class="post" id="post-54054">
    <div class="subject"><a href="#post-54054">Qeditor problems on XP</a></div>
    <div class="body">Huh,<br /><br />Thanks for the info, I am trying to track this problem down on TheGun at the moment as it is working correctly on everything from win95 up to win2k fine but is showing the other file dialog as you have described on XP.<br /><br />I am loading the dialog as per the Microsoft documentation using the correct structure etc ... but I do not have XP on a box anywhere and I am in no hurry to waste a computer loading it with XP.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-08-19 00:33:45 by hutch--</div>
   </div>
   <div class="post" id="post-54134">
    <div class="subject"><a href="#post-54134">Qeditor problems on XP</a></div>
    <div class="body">Hi hutch!<br /><br />Now that the &quot;DWORD&quot; issue with QEDIT and Windows XP compatibility is solved, there is another funny thing that I find.<br />It doesn't happen with my 98 version, but when I try it on XP,  it sometimes (haven't tested exactly when) doesn't load the file, it just opens in blamk, like when you press 'new instance'<br />That?s it, just to make you know.</div>
    <div class="meta">Posted on 2002-08-19 11:02:09 by slop</div>
   </div>
   <div class="post" id="post-54206">
    <div class="subject"><a href="#post-54206">Qeditor problems on XP</a></div>
    <div class="body">Sloppy,<br /><br />Thanks for the info, I have just about done the quirk that TheGun found in XP and when the testing is completed by an independent person I know with XP, I will post it.<br /><br />I get really tired of messups with Microsoft OS versions and instead of wasting the time trying to debug what had happened, I just rewrote the dialog code to avoid whatever XP was doing.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-08-20 01:20:27 by hutch--</div>
   </div>
   <div class="post" id="post-54268">
    <div class="subject"><a href="#post-54268">Qeditor problems on XP</a></div>
    <div class="body">So then you rewrite the whole thing for XP?<br /><br />Btw, just tryed The ne GUN and works fine.</div>
    <div class="meta">Posted on 2002-08-20 12:36:51 by slop</div>
   </div>
   <div class="post" id="post-73178">
    <div class="subject"><a href="#post-73178">Qeditor problems on XP</a></div>
    <div class="body">Hi hutch<br /><br />I too have experienced the problem with<br />Qeditor on WinXP.<br /><br />When I am writing some code, suddenly the <br />text moves to the right, and later on back again.<br /><br /><br /><br />One time, I have been giving my son my old, but<br />good monitor, later on, when I saw that the text <br />was moving right and left on Qeditor with my &quot;new&quot; <br />monitor, I  thought that there was a little problem <br />with my monitor.<br />So I told my son, that I would switch our monitors back,<br />so that I could use Qeditor WITHOUT any problems....<br />Was I surprised, when I saw that the problem with<br />Qeditor WASN'T GONE.......:rolleyes: <br /><br />Now I know, that it's &quot;only&quot; a matter of getting the code<br />right in Qeditor...</div>
    <div class="meta">Posted on 2002-12-29 07:21:03 by The SharK</div>
   </div>
   <div class="post" id="post-73261">
    <div class="subject"><a href="#post-73261">Qeditor problems on XP</a></div>
    <div class="body">Shark,<br /><br />Get the version from my web site, it is a full rewrite with additional capacity.<br /><br /><a target="_blank" href="www.movsd.com">www.movsd.com</a><br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-12-29 17:29:22 by hutch--</div>
   </div>
   <div class="post" id="post-73395">
    <div class="subject"><a href="#post-73395">Qeditor problems on XP</a></div>
    <div class="body">Thanks hutch<br /><br />I use the program all the time :alright:</div>
    <div class="meta">Posted on 2002-12-30 05:42:41 by The SharK</div>
   </div>
  </div>
 </body>
</html>