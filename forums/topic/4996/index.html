<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>RTCW Playerfinder - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4996" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=4996">RTCW Playerfinder</a></p>
   <div class="post" id="post-35119">
    <div class="subject"><a href="#post-35119">RTCW Playerfinder</a></div>
    <div class="body">Hossa,<br /><br />im working on a basic playerfinder for a popular multiplayergame.<br /><br />can you test if it work on nt or win2k and can you take a look at the code and show me a better way to find a word inside a text ?<br /><br />since its basic i use wolffinder to do the search work....<br /><br />Thanks<br /><br />ps: its packed with winrar ,remove &quot;.zip&quot; to entpack.<br />sorry i have no zip program.<br /><br />for the one dont like to download:<br /><br />.386<br />.MODEL FLAT,STDCALL<br />               <br />UNICODE=0<br />include resources\w32.inc<br /><br />extrn lstrcat                           : proc<br />extrn lstrcpy		:Proc<br />extrn lstrcatA		:Proc<br />extrn lstrcmpi		:Proc<br />extrn FindWindowExA        :Proc<br />extrn inet_addr		: proc<br />extrn WSAGetLastError	: proc<br /><br />;**************************************** DATA *************************************************<br />.DATA<br /><br />WSACleanup 	PROTO<br />WSAStartup 	PROTO :DWORD,:DWORD<br />htons 	                PROTO :DWORD<br />recv 		PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />socket 	                PROTO :DWORD, :DWORD, :DWORD<br />WSAAsyncSelect PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />closesocket	PROTO :DWORD<br />accept 	                PROTO :DWORD,:DWORD,:DWORD<br />bind 	                PROTO :DWORD,:DWORD,:DWORD<br />listen 	                PROTO :DWORD,:DWORD<br />connect    	PROTO :DWORD,:DWORD,:DWORD<br />send 		PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />ioctlsocket	PROTO :DWORD,:DWORD,:DWORD<br />setsockopt            PROTO :DWORD,:DWORD,:DWORD,:DWORD,:DWORD<br />gethostbyname	PROTO :DWORD<br /><br /><br />WSABASEERR          equ             10000<br />WSAEINTR          equ               WSABASEERR+4<br />WSAEBADF          equ               WSABASEERR+9<br />WSAEACCES          equ              WSABASEERR+13<br />WSAEFAULT          equ              WSABASEERR+14<br />WSAEINVAL          equ              WSABASEERR+22<br />WSAEMFILE          equ              WSABASEERR+24<br />WSAEWOULDBLOCK          equ         WSABASEERR + 35<br />WSAEINPROGRESS          equ         WSABASEERR + 36<br />WSAEALREADY          equ            WSABASEERR + 37<br />WSAENOTSOCK          equ            WSABASEERR + 38<br />WSAEDESTADDRREQ          equ        WSABASEERR + 39<br />WSAEMSGSIZE          equ            WSABASEERR + 40  <br />WSAEPROTOTYPE          equ          WSABASEERR + 41<br />WSAENOPROTOOPT          equ         WSABASEERR + 42<br />WSAEPROTONOSUPPORT          equ     WSABASEERR + 43<br />WSAESOCKTNOSUPPORT          equ     WSABASEERR + 44<br />WSAEOPNOTSUPP          equ          WSABASEERR + 45<br />WSAEPFNOSUPPORT          equ        WSABASEERR + 46<br />WSAEAFNOSUPPORT          equ        WSABASEERR + 47<br />WSAEADDRINUSE          equ          WSABASEERR + 48<br />WSAEADDRNOTAVAIL          equ       WSABASEERR + 49<br />WSAENETDOWN          equ            WSABASEERR + 50<br />WSAENETUNREACH          equ         WSABASEERR + 51<br />WSAENETRESET          equ           WSABASEERR + 52<br />WSAECONNABORTED          equ        WSABASEERR + 53<br />WSAECONNRESET          equ          WSABASEERR + 54   <br />WSAENOBUFS          equ             WSABASEERR + 55  <br />WSAEISCONN          equ             WSABASEERR + 56<br />WSAENOTCONN          equ            WSABASEERR + 57<br />WSAESHUTDOWN          equ           WSABASEERR + 58<br />WSAETOOMANYREFS          equ        WSABASEERR + 59<br />WSAETIMEDOUT          equ           WSABASEERR + 60<br />WSAECONNREFUSED          equ        WSABASEERR + 61<br />WSAELOOP          equ               WSABASEERR + 62<br />WSAENAMETOOLONG          equ        WSABASEERR + 63<br />WSAEHOSTDOWN          equ           WSABASEERR + 64<br />WSAEHOSTUNREACH          equ        WSABASEERR + 65<br />WSAENOTEMPTY          equ           WSABASEERR + 66<br />WSAEPROCLIM          equ            WSABASEERR + 67<br />WSAEUSERS          equ              WSABASEERR + 68<br />WSAEDQUOT          equ              WSABASEERR + 69<br />WSAESTALE          equ              WSABASEERR + 70<br />WSAEREMOTE          equ             WSABASEERR + 71<br />WSASYSNOTREADY          equ         WSABASEERR+91<br />WSAVERNOTSUPPORTED          equ     WSABASEERR+92<br />WSANOTINITIALISED          equ      WSABASEERR+93<br />WSAHOST_NOT_FOUND          equ      WSABASEERR + 1001<br />HOST_NOT_FOUND          equ         WSAHOST_NOT_FOUND<br />SOCKET_ERROR		equ 	-1<br /><br />;These are the dialog elements as found in the .rc file<br />DLG1           equ     100<br />ICON1	     equ     101<br /><br />IDB_BTN1           equ     105<br /><br />IDE_WORD    equ        500<br />IDE_FOUND   equ        510<br /><br />IDL_TIME      equ           600<br />IDL_SER         equ           610<br />IDL_PLA        equ           620<br />IDL_UPD        equ           630<br />IDL_NAME    equ           640<br />IDE_STATUS     equ           700<br />;**********************************<br /><br />SOCK_STREAM	equ	1<br />AF_INET		equ	2<br />BuffSize	equ    1024<br /><br /><br />WSAdata STRUCT<br />  wVersion	dw	?<br />  wHighVersion	dw	?<br />  szDescription	db 	257 dup (?)<br />  szSystemStatus db 	129 dup (?)<br />  iMaxSockets	dw	?<br />  iMaxUdpDg  	dw	?<br />  lpVendorInfo	dd	?<br />WSAdata ENDS<br /><br />sockaddr_in STRUCT<br />  sin_family	dw	?<br />  sin_port	dw	?<br />  sin_addr	dd	?<br />  sin_zero	db	8 dup (0)<br />sockaddr_in ENDS<br /><br />wsadata		WSAdata &lt;?&gt;<br />sock		DD	?<br />Len		DD	?<br /><br />wsa2         	WSAdata 	?<br />conn_socket 	dd 		0<br />data_socket 	dd 		0<br />server      	sockaddr_in 	&lt;0,0,0,0&gt;<br /><br />wsa WSAdata &lt;?&gt;<br />hStatic     dd ?<br />hFont       dd ?<br />;**********************************<br /><br />hInstance   dd 0<br />seekdb        dd 0<br />seekinc       dd 0<br />seekcount  dd 0<br />loopcount  dd 0<br />foundstr     dd 0<br />hicon          dd  0<br />hinst_         dd  0<br /><br />ipsrting       db        'gowolf.pl',0<br /><br />d01 db 'ERROR OPEN CONNECTION',0<br />d02 db 'WSAENETDOWN',0<br />d03 db 'WSAENETUNREACH',0<br />d04 db 'WSAECONNABORTED',0<br />d05 db 'WSAECONNRESET',0<br />d06 db 'WSAENOTCONN',0<br />d07 db 'WSAEHOSTDOWN',0<br />d08 db 'WSAEHOSTUNREACH',0<br />d09 db 'WSAVERNOTSUPPORTED',0<br /><br />errorsocket     DB 'SOCKET ERROR'   ,0<br />errorsend        DB 'SEND ERROR'	    ,0<br />errorIP             DB 'IP ERROR'   ,0<br />errorMiss        DB 'PLAYER NAME MISSING'   ,0<br /><br />buff	    	db BuffSize dup (00h)<br /> <br />;---- wolffinder cgi strings<br /><br />wolffinderip           db           '216.99.207.98',2 dup (0)<br />start01    	db 	'GET /index.php?',0<br />seek1	    	db 	'sname=',0<br />language1    	db 	'&amp;submit=',0<br />language2    	db 	'click',0       <br />end                	db 	' HTTP/1.0',0<br />eol	    	db 	13,10,13,10,13,10,0<br />		db	20 dup (0)<br />;**************************************** DATA ? *************************************************<br />.data?<br />errordummy db 70 DUP  (?)<br />buffer      db 24 dup (?)<br />buffer2     db 128 dup (?)<br />username01  db 24 dup (?)<br />htmlbuffer     db 1024 dup (?)<br />htmlbuffer1     db 9000 dup (?)<br />htmlbuffer2     db 256000 dup (?)<br />htmlbuffer3     db 256000 dup (?)<br />htmlbuffer4     db 256000 dup (?)<br />htmlbuffer5     db 256000 dup (?)<br />htmlbuffer6     db 256000 dup (?)<br />htmlbuffer7     db 256000 dup (?)<br />txtbuffer     db 256 dup (?)<br />seekbuffer     db 256 dup (?)<br />seekbuffer2     db 256 dup (?)<br />;**************************************** CODE *************************************************<br />.CODE<br />main:<br />          call      GetModuleHandleA, 0<br />          test      eax, eax<br />          jne       gmhok<br />          call      ExitProcess,0<br /><br />gmhok:    <br />          mov     hinst_, eax<br />          call      DialogBoxParamA, hinst_, DLG1, 0, offset DlgProcedure, 0<br />          call      ExitProcess,0<br />;********************************************************************************<br />PUBLIC DlgProcedure<br />DlgProcedure   PROC STDCALL, hwnd_:DWORD, wmsg:DWORD, wparam_:DWORD, lparam_:DWORD<br />          USES ebx, edi, esi<br />          <br />          .IF       wmsg==WM_DESTROY || wmsg==WM_CLOSE <br />                    jmp    wmdestroy<br />          <br />          .ELSEIF   wmsg==WM_COMMAND    <br />                    jmp    wmcommand  <br />          <br />          .ELSEIF   wmsg==WM_INITDIALOG<br />                    jmp    dlginit<br /><br />          .ENDIF<br />          RET<br /><br />wmdestroy:<br />          call      EndDialog, hwnd_, 0<br />          call      ExitProcess,0<br /><br />wmcommand  :<br />          .IF              word ptr ==IDB_BTN1<br />                            call      GetDlgItem,hwnd_,IDB_BTN1<br />                            call      ShowWindow,eax,0<br />                            call      SendSearch<br /><br />          .ENDIF<br />          RET<br />;******************************************** DLG INIT ******************************************<br />dlginit:<br />                 call      LoadIconA, hinst_, ICON1                                                           ; load icon                                                            <br />                 call      SendMessageA, hwnd_, WM_SETICON, ICON1, eax            ; show icon <br /><br />SockedInitialize:<br />	call 	WSAStartup	,101h ,offset wsa2<br />	cmp  	eax		,SOCKET_ERROR<br />	jnz  	InitOk<br />Exit_if_cant_open:<br />                jmp           wmdestroy<br />InitOk:<br />               RET<br />DlgProcedure EndP<br />;***************************************** SEND SEARCH *****************************************<br />SendSearch proc<br />               call           SendDlgItemMessageA,hwnd_,IDL_NAME,LB_RESETCONTENT,0,0     ;-- empty listbox<br /><br />                call          GetDlgItemText,hwnd_,IDE_WORD,offset txtbuffer,256<br />                call          lstrlen,offset  txtbuffer<br />                cmp        eax,0<br />                    je        Error_Missing<br /><br />                call 	socket		,AF_INET ,SOCK_STREAM ,0<br />	cmp 	eax		,SOCKET_ERROR<br />	jz  	Error_Socket<br />	mov 	conn_socket	,eax<br />	call 	htons		,80	; HTTP-Service<br />	mov 	,AF_INET<br />	mov 	  ,ax<br /><br />	call 	inet_addr	,offset wolffinderip                      ;--searchengine ip<br />	cmp 	eax		,SOCKET_ERROR<br />	jz  	Error_IP<br /><br />	mov 		,eax<br />	call 	connect	,conn_socket,offset server,16<br /><br />	call	ClearBuff<br />                 mov       buff,0<br />;----------------------<br />	call 	lstrcpy	,offset buff	,offset start01           ;---cgi script<br />	call 	lstrcat	,offset buff	,offset seek1                       <br /><br />	call 	lstrcat	,offset buff	,offset txtbuffer     ;-- edit value<br /><br />	call 	lstrcat	,offset buff	,offset language1         <br />	call 	lstrcat	,offset buff	,offset language2         <br />;----------------------<br />	call 	lstrcat	,offset buff	,offset end                 ;-- cgi http<br />	call 	lstrcat	,offset buff	,offset eol                  ;-- cgi end<br />	call 	lstrlen	,offset buff<br /><br />	call 	send	,conn_socket ,offset buff ,eax ,0<br />                cmp         eax,SOCKET_ERROR<br />                    je          SOCK_ERROR_MSG<br /><br />                mov        htmlbuffer1,0<br />                call          recv,conn_socket ,offset htmlbuffer1,9000,0    ; Read the data from the socket<br />                call          SetDlgItemText,hwnd_,IDE_FOUND,offset htmlbuffer1<br /><br />	call 	closesocket	,conn_socket<br />	call 	closesocket	,data_socket<br />                call          Sleep,150<br />                call          searchinfos       ;--- start search for word in text<br />                ret<br />;**************************************************************************<br />;                                                                  SOCKET ERRORS<br />;**************************************************************************<br />SOCK_ERROR_MSG:<br />                 call WSAGetLastError<br />.if eax!=WSAEWOULDBLOCK<br />                call  lstrcpy,offset errordummy,offset d01<br />.elseif eax!=WSAENETDOWN<br />                call lstrcpy,offset errordummy,offset d02<br />.elseif eax!=WSAENETUNREACH <br />                call lstrcpy,offset errordummy,offset d03<br />.elseif eax!=WSAECONNABORTED<br />                call lstrcpy,offset errordummy,offset d04<br />.elseif eax!=WSAECONNRESET<br />                call lstrcpy,offset errordummy,offset d05<br />.elseif eax!=WSAENOTCONN<br />                call lstrcpy,offset errordummy,offset d06<br />.elseif eax!=WSAEHOSTDOWN<br />                call lstrcpy,offset errordummy,offset d07<br />.elseif eax!=WSAEHOSTUNREACH<br />                call lstrcpy,offset errordummy,offset d08<br />.elseif eax!=WSAVERNOTSUPPORTED<br />                call lstrcpy,offset errordummy,offset d09<br />	.endif <br />                call          SetDlgItemText,hwnd_,IDE_STATUS,offset errordummy<br />                jmp endloop<br /><br />Error_Socket:<br />                call          SetDlgItemText,hwnd_,IDE_STATUS,offset errorsocket<br />                jmp endloop<br />Error_IP:<br />                call          SetDlgItemText,hwnd_,IDE_STATUS,offset errorIP<br />                jmp endloop<br />Error_Send_Notify:<br />                call          SetDlgItemText,hwnd_,IDE_STATUS,offset errorsend <br />                jmp endloop<br />Error_Missing:<br />                call          SetDlgItemText,hwnd_,IDE_STATUS,offset errorMiss<br />                jmp endloop<br />SendSearch endp<br />;**************************************************************************<br />;                                                                  CLEAR BUFFER<br />;**************************************************************************<br />ClearBuff	Proc	Near<br />	mov	edi	,offset buff<br />	mov	ecx	,BuffSize shr 2<br />	xor	eax	,eax<br />	rep	stosd<br />	ret<br />ClearBuff	EndP<br />;**************************************************************************<br />;                                                                  SEARCH<br />;**************************************************************************<br />searchinfos         Proc<br />        call       GetDlgItemText,hwnd_,IDE_FOUND,offset htmlbuffer1-23,55<br />        call       SetDlgItemText,hwnd_,IDL_TIME,offset htmlbuffer1<br /><br />        call       GetDlgItemText,hwnd_,IDE_FOUND,offset htmlbuffer2-786,790<br />        call       SetDlgItemText,hwnd_,IDL_SER,offset htmlbuffer2<br /><br />        call       GetDlgItemText,hwnd_,IDE_FOUND,offset htmlbuffer3-905,910<br />        call       SetDlgItemText,hwnd_,IDL_PLA,offset htmlbuffer3<br /><br />        call       GetDlgItemText,hwnd_,IDE_FOUND,offset htmlbuffer4-1017,1042<br />        call       SetDlgItemText,hwnd_,IDL_UPD,offset htmlbuffer4<br />;---<br />        mov     loopcount,0<br />        mov     seekcount,0<br />        mov     foundstr,0<br />        call       SendDlgItemMessageA,hwnd_,IDL_NAME,LB_RESETCONTENT,0,0<br /><br />        call       GetDlgItemText,hwnd_,IDE_WORD,offset seekbuffer,256<br />        call       lstrlen,offset seekbuffer<br />        inc        eax<br />        mov     seekdb,eax<br /><br />        call       GetDlgItemText,hwnd_,IDE_FOUND,offset seekbuffer2,seekdb<br /><br />loopseek:<br />.if     foundstr==0<br />        mov     edi, offset seekbuffer<br />        mov     esi, offset seekbuffer2<br />        mov     ecx, 5<br />        repz     cmpsb<br />        jnz       Notfound<br />        mov     foundstr,1<br />        jmp      Notfound<br />.elseif   foundstr==1<br />        mov     edi, offset ipsrting<br />        mov     esi, offset seekbuffer2<br />        mov     ecx, 5<br />        repz     cmpsb<br />        jnz       Notfound<br />        call       GetDlgItemText,hwnd_,IDE_FOUND,offset htmlbuffer4-10,50<br />        call       SendDlgItemMessageA,hwnd_,IDL_NAME,LB_ADDSTRING,0,offset htmlbuffer4<br />        mov     foundstr,0<br />.endif<br /><br />Notfound:<br />        inc      loopcount<br />        cmp    loopcount,9000<br />          je      endloop<br /><br />        inc      seekdb<br />        call     GetDlgItemText,hwnd_,IDE_FOUND,offset htmlbuffer4-1,256000<br />        call     SetDlgItemText,hwnd_,IDE_FOUND,offset htmlbuffer4<br /><br />        call     GetDlgItemText,hwnd_,IDE_FOUND,offset seekbuffer2,seekdb<br />        jmp     loopseek<br />endloop:<br /><br />         call      GetDlgItem,hwnd_,IDB_BTN1<br />         call      ShowWindow,eax,1<br />         ret<br />searchinfos        EndP<br />;************************** END ******************************<br />ends<br />end main</div>
    <div class="meta">Posted on 2002-04-26 02:52:04 by Max</div>
   </div>
   <div class="post" id="post-35146">
    <div class="subject"><a href="#post-35146">RTCW Playerfinder</a></div>
    <div class="body">OS: WinXP<br />CPU-usage: 97%<br />Screenshot:</div>
    <div class="meta">Posted on 2002-04-26 06:57:45 by Delight</div>
   </div>
   <div class="post" id="post-35213">
    <div class="subject"><a href="#post-35213">RTCW Playerfinder</a></div>
    <div class="body">Thanks for the help :-)<br /><br />i change the way i create the dialog and hope now it work on XP.<br />i would happy if you have the time to test the new version.<br /><br />tomorow i remove the html strings ,so dont wonder.<br /><br />i post a screenshot to show how it should look :-)</div>
    <div class="meta">Posted on 2002-04-26 18:43:42 by Max</div>
   </div>
   <div class="post" id="post-35214">
    <div class="subject"><a href="#post-35214">RTCW Playerfinder</a></div>
    <div class="body">Screenshot:</div>
    <div class="meta">Posted on 2002-04-26 18:45:37 by Max</div>
   </div>
   <div class="post" id="post-35263">
    <div class="subject"><a href="#post-35263">RTCW Playerfinder</a></div>
    <div class="body">Not better I'm afraid :(<br /><br />CPU-usage: 99% <br />Screenshot:</div>
    <div class="meta">Posted on 2002-04-27 05:32:04 by Delight</div>
   </div>
   <div class="post" id="post-35275">
    <div class="subject"><a href="#post-35275">RTCW Playerfinder</a></div>
    <div class="body">i've a problem on a prog some weeks ago that should be your problem, on Win98 the dialog shows ok, but in WinXP it shows like that window (Delight). Check the return value of all WM_*<br />:alright:<br /><br />cu<br /><br />Coder7345 / jEAN</div>
    <div class="meta">Posted on 2002-04-27 07:57:53 by coder</div>
   </div>
  </div>
 </body>
</html>