<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Immediate floats - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=19089" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=19089">Immediate floats</a></p>
   <div class="post" id="post-147584">
    <div class="subject"><a href="#post-147584">Immediate floats</a></div>
    <div class="body">While I was testing the graphics lib with MASM I ran into an interesting problem. In GoAsm 4 bytes is 4 bytes, doesn't matter what you put in it. So if you had a function that had a REAL4 parameter you can do this:<br /><br />invoke Deg2Rad, 45.5<br /><br />or <br /><br />push 45.5<br />call Deg2Rad<br /><br />And it will push the immediate value 42360000h onto the stack (45.5 in REAL4). But in MASM I could find no way to use an immediate for a REAL4 number, REAL4 PTR 45.5, DWORD PTR 45.5 etc... all failed. I eventually had to declare it in my data section and use the variable in an invoke (though PUSH works too). My question is does anyone know how to use REAL4 immediates in MASM ?</div>
    <div class="meta">Posted on 2004-08-06 20:55:48 by donkey</div>
   </div>
   <div class="post" id="post-147590">
    <div class="subject"><a href="#post-147590">Immediate floats</a></div>
    <div class="body">GoAsm probably has a macro which is inserted in the code to convert immediate floats. If you disassemble the code generated by GoAsm, you should find how that assembler does it. OTOH, it may convert it at compile time without inserting extraneous code. MASM does not have any conversion feature within code instructions.<br /><br />FYI, HLA also inserts code to convert immediate floats at run-time, and would blindly trash any valid data which may be in those FPU registers which are required for the conversion. GoAsm may/maynot be doing the same thing.<br /><br />If trashing of valid data in FPU registers must be avoided, it's always safer to set those &quot;immediate&quot; floats in global variables, regardless of the assembler you are using.<br /><br />Raymond</div>
    <div class="meta">Posted on 2004-08-06 22:11:37 by Raymond</div>
   </div>
   <div class="post" id="post-147592">
    <div class="subject"><a href="#post-147592">Immediate floats</a></div>
    <div class="body">Hi Raymond,<br /><br />No, GoAsm converts the float at compile time and pushes the immediate value.<br /><br />push 45.5<br /><br />compiles to<br /><br />68 00 00 36 42    push 42360000<br /><br />MASM obviously has the capacity to convert REAL4 numbers, after all you can declare<br /><br />.data<br />blah REAL4 45.5<br /><br />and it will convert it to 42360000h in the data section. There is no logical reason that MASM can't do it in code as well, 4 bytes is 4 bytes. This obviously has nothing to do with trashing the FPU, there are many calls especially with GDI+ that require a REAL4 parameter be pushed onto the stack. It seems like a useless waste if you have to declare each one in order to use it. But if it can't it can't, I use GoAsm and that can do it so I am not worried, I was just curious.</div>
    <div class="meta">Posted on 2004-08-06 22:24:39 by donkey</div>
   </div>
   <div class="post" id="post-147598">
    <div class="subject"><a href="#post-147598">Immediate floats</a></div>
    <div class="body">You can do it like this<br /><br />DB 68h<br />REAL4 45.5<br />CALL Deg2Rad<br /><br />And it works perfectly.<br /><br />A little macro for it:<br /><br /><pre><code>pushr macro arg1<br />	db 68h<br />	REAL4 arg1<br />endm<br /><br />pushr 45.5</code></pre></div>
    <div class="meta">Posted on 2004-08-07 00:17:15 by donkey</div>
   </div>
  </div>
 </body>
</html>