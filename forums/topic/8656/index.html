<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ipicture Render transparent color - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=8656" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=116">Windows</a> &raquo; <a href="../?id=8656">ipicture Render transparent color</a></p>
   <div class="post" id="post-63605">
    <div class="subject"><a href="#post-63605">ipicture Render transparent color</a></div>
    <div class="body">This topic was discussed awhile back.<br />You can open any GIF, JPG, BMP and display it, using the Render()<br />method of the ipicture interface -- this is COM stuff.<br /><br />I experimented and found that the actual bitmap is still a DIB, and<br />I used ipicture::SelectPicture() to extract a handle to the bitmap<br />and then used BitBlt() to paint the bitmap.<br />I also experimented with TransparentBlt(), which enables you to<br />specify a transparent color -- but it has a memory leak in Win9x<br />-- MS fixed it for WinMe onwards.<br /><br />So, my question. As the image is just a DIB, how does Render()<br />know which color is the transparent one? Ernie and some other guys<br />have some code in which they used GetPixel(hdc,0,0,) to get the<br />transparent color -- but, was this an arbitary choice? is it some kind<br />of standard to use 0,0 for the transparent color?<br /><br />By the way, Ernie, I tried to email you at <a href="mailto:ernie@surfree.com">ernie@surfree.com</a> but<br />got &quot;user unknown&quot;.<br /><br />When a GIF is loaded, or any image, it becomes a DIB, and<br />somehow Render() knows what color is transparent. This is the<br />question I can't find the answer to in any MS docs.<br />I want to be able to read that color and maybe modify it.<br /><br />For my little freeware app, I would like to display a edit box in which<br />users can choose the transparent color for any image, regardless of<br />whether it was GIF, BMP, etc beforehand, but must be able to read<br />the transparent color previously inside the image.<br />Surely I won't have to go back to the original GIF image to read it<br />... surely not ...<br /><br />Anyone got any thoughts on this?<br /><br />Regards,<br />Barry kauler<br />P.S., I'm planning to write-up my experiments on TransparentBlt()<br />and whatever else turns up, for everyone to benefit.</div>
    <div class="meta">Posted on 2002-10-26 18:22:13 by bkauler</div>
   </div>
   <div class="post" id="post-63913">
    <div class="subject"><a href="#post-63913">ipicture Render transparent color</a></div>
    <div class="body">Barry,<br /><br />  Nice to see you again.<br /><br />  I've seen the 0,0 pixel defined as transparent in a few places (such as OCX toolbox bitmaps), so apparently its a common hack to use it that way in a bitmap.<br /><br />  GIFs were designed &quot;bottom up&quot; to be transparent, they store the index number of the transparent color in the Graphic Control Extension per my copy of GIF89a. <br /><br />I was playing around once trying to make a royality free moving GIF control that used the Windows code to do the LZW unpacking (hence no royality). The project went no where (paying work got far more interesting), but parsing the GIF data stream wasn't all that bad, even for multiple (or moving) images.<br /><br />For the moment, I'm borrowing mail server space from my wife's site. I can be reached at <a href="mailto:ernie@chairlady.com">ernie@chairlady.com</a></div>
    <div class="meta">Posted on 2002-10-29 20:43:27 by Ernie</div>
   </div>
   <div class="post" id="post-63969">
    <div class="subject"><a href="#post-63969">ipicture Render transparent color</a></div>
    <div class="body">Hi,<br />I posted a similar question to a Microsoft newsgroup, and an actual<br />MS support person responded.<br /><br />He pointed out that I can't expect to find transparent color info<br />in a DIB, because it isn't part of the DIB spec.<br /><br />He also said that although I found the image inside the ipicture object<br />was just a DIB and I was able to use BitBlt() instead of ::Render(), that<br />was just &quot;coincidental&quot;. Render() knows about transparent color and<br />the format of image storage in the object is not published and subject<br />to change.<br /><br />Finally, he recommended that my problem with transparent color would<br />be solved if I used GDI+.<br /><br />GDI+???<br /><br />So, I had a quick look at the GIF89a spec and wrote some code to extract<br />the transparent color. Works on  a couple of GIFs but I don't fully understand<br />the spec yet, so it's probably not perfect -- the code looks like a quick hack,<br />which it is.<br /><br />Regards,<br />Barry Kauler</div>
    <div class="meta">Posted on 2002-10-30 09:21:05 by bkauler</div>
   </div>
   <div class="post" id="post-64031">
    <div class="subject"><a href="#post-64031">ipicture Render transparent color</a></div>
    <div class="body"><div class="quote">He also said that although I found the image inside the ipicture object was just a DIB and I was able to use BitBlt() instead of ::Render(), that was just &quot;coincidental&quot;. </div> <br /><br />In my copy of MSDN, IPicture:SelectPicture returns a phbmpOut. Now my hungarian might be a little rusty, but I read that as &quot;pointer to a handle of a bitmap you can copy from me&quot;<br /><br />Interesting that the Microspeak for an interface performing exactly as it is published is &quot;coincidental&quot;</div>
    <div class="meta">Posted on 2002-10-30 23:04:29 by Ernie</div>
   </div>
   <div class="post" id="post-64108">
    <div class="subject"><a href="#post-64108">ipicture Render transparent color</a></div>
    <div class="body">Well, here is my posting to microsoft.public.win32.programmer.gdi<br />and the reply from the MS guy:<br /><br />Subject:  RE: ipicture render transparent color Attachments:  None  <br /> From:  &quot;John Hornick &quot; &lt;JHornick@online.microsoft.com&gt; Sent:  10/26/2002 7:22:54 PM<br /><br />Hi,<br /><br />&gt; You can open any GIF, JPG, BMP and display it, using the Render()<br />&gt; method of the ipicture interface -- this technique is documented<br />&gt; in various places, including a link off my x86 page:<br />&gt; <a target="_blank" href="http://www.goosee.com/x86/">http://www.goosee.com/x86/</a><br />&gt; <br />&gt; Ipicture is a COM thing, but the functions are readily callable<br />&gt; from non-oop code -- I program in MS assembler.<br />&gt; I experimented and found that the actual bitmap is still a DIB, and<br />&gt; I used ipicture::SelectPicture() to extract a handle to the bitmap<br />&gt; and then used BitBlt() to paint the bitmap.<br />&gt; I also experimented with TransparentBlt(), which enables you to<br />&gt; specify a transparent color -- but it has a memory leak in Win9x<br />&gt; -- MS fixed it for WinMe onwards.<br />&gt; <br />&gt; A note for those unfamiliar with ipicture::Render() -- it automatically<br />&gt; displays the transparent color in a GIF. I use OleLoadPicture() to<br />&gt; load any GIF, JPG or BMP. This is all in the olepro32.dll, that works<br />&gt; on Win95.<br />&gt; <br />&gt; So, my question. As the image is just a DIB, how does Render()<br />&gt; know which color is the transparent one? I looked at some code<br />&gt; in which they used GetPixel(hdc,0,0,) to get the<br />&gt; transparent color -- but, was this an arbitary choice? is it some kind<br />&gt; of standard to use 0,0 for the transparent color?<br />&gt; <br />&gt; When a GIF is loaded, or any image, it becomes a DIB, and<br />&gt; somehow Render() knows what color is transparent. This is the<br />&gt; question I can't find the answer to in any MS docs.<br />&gt; I want to be able to read that color and maybe modify it.<br />&gt; <br />&gt; For my little freeware app, I would like to display a edit box in which<br />&gt; users can choose the transparent color for any image, regardless of<br />&gt; whether it was GIF, BMP, etc beforehand, but must be able to read<br />&gt; the transparent color previously inside the image.<br />&gt; Surely I won't have to go back to the original GIF, BMP, etc image to <br />&gt; read it ... surely not ... <br />&gt; <br />&gt; Anyone got any thoughts on this?<br /><br /><br />As you noted, IPicture is a COM thing, not a GDI thing. So maybe<br />you'd get better information by posting on a COM newsgroup.<br /><br />Still, here's my 2 cents: the fact that it's stored as a DIB is<br />a coincidence - I don't think that's documented, and therefore<br />might change from version to version of olepro32 or oleaut32.<br /><br />If I needed to provide the functionality you are looking to provide,<br />I'd use GDI+.  GDI+ does what you want, and in documented ways.<br /><br />Thanks,<br />- John<br />Microsoft Developer Support<br />This posting is provided &quot;AS IS&quot; with no warranties, and confers no rights.<br />Visit <a target="_blank" href="http://www.microsoft.com/security">http://www.microsoft.com/security</a> for current information on security.</div>
    <div class="meta">Posted on 2002-10-31 16:44:24 by bkauler</div>
   </div>
  </div>
 </body>
</html>