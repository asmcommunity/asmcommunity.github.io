<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>StretchDIBits fails for unknown reason - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=5276" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=5276">StretchDIBits fails for unknown reason</a></p>
   <div class="post" id="post-37327">
    <div class="subject"><a href="#post-37327">StretchDIBits fails for unknown reason</a></div>
    <div class="body">I'm trying to draw something on a 32-bit 800*600 GDI window (DirectX is for later), but the call to StretchDIBits fails. GetLastError says there's a parameter wrong, but I don't see which on is bad. <br />I've created a minimal file that shows the problem (hardcoded sizes, needs 32-bit desktop etc). Can anyone tell what's wrong with it? It should just show a white window. Pressing any key closes it.</div>
    <div class="meta">Posted on 2002-05-09 03:19:44 by james</div>
   </div>
   <div class="post" id="post-37351">
    <div class="subject"><a href="#post-37351">StretchDIBits</a></div>
    <div class="body">Is this supposed to be negative?:<br /><br />mov   [(BITMAPINFOHEADER( VV_Bitmap_Info.bmiHeader)).biHeight], -600</div>
    <div class="meta">Posted on 2002-05-09 06:46:48 by Brad</div>
   </div>
   <div class="post" id="post-37354">
    <div class="subject"><a href="#post-37354">StretchDIBits</a></div>
    <div class="body">Yes, from the win32 programmers reference, BITMAPINFOHEADER entry:<br /><br />biHeight:<br />Specifies the height of the bitmap, in pixels. If biHeight is positive, the bitmap is a bottom-up DIB and its origin is the lower left corner. If biHeight is negative, the bitmap is a top-down DIB and its origin is the upper left corner. <br /><br />And I've tried flipping the sign but it doesn't solve the problem :(</div>
    <div class="meta">Posted on 2002-05-09 08:12:17 by james</div>
   </div>
   <div class="post" id="post-37388">
    <div class="subject"><a href="#post-37388">Problem not solved, but...</a></div>
    <div class="body">After further investigations, I've tried to assemble the same small file in TASM and it works as expected. So I guess the problem is not specifically in the StretchDIBits call but more something like a wrong library or so. If you've any suggestions, please post them in the &quot;Help! Does windows hate MASM&quot;-thread.</div>
    <div class="meta">Posted on 2002-05-09 14:55:27 by james</div>
   </div>
   <div class="post" id="post-37397">
    <div class="subject"><a href="#post-37397">StretchDIBits</a></div>
    <div class="body">james, <br /><br />my asm is not up to par yet.....but I can give you a PowerBASIC example that does all you wish if you like....pretty easy to follow:<br /><br /><a target="_blank" href="http://www.powerbasic.com/support/forums/Forum7/HTML/001247.html">http://www.powerbasic.com/support/forums/Forum7/HTML/001247.html</a><br /><br />B<br /><br /><br />added: <br />here's a much simplier one at the bottom of the thread....<br /><a target="_blank" href="http://www.powerbasic.com/support/forums/Forum4/HTML/005635.html">http://www.powerbasic.com/support/forums/Forum4/HTML/005635.html</a></div>
    <div class="meta">Posted on 2002-05-09 15:32:07 by Brad</div>
   </div>
   <div class="post" id="post-37443">
    <div class="subject"><a href="#post-37443">StretchDIBits</a></div>
    <div class="body">Hi James,<br /><br /><pre><code><br />.data<br />;.code	  <br />align 4<br />;              B I T M A P  F I L E  HEADER - Len Eh=14 bytes (w ,dw,dw,dw)<br />;                   B        M      F  i  l  e   s  i  z  e      R e s e r v ed      b f O f f B i t s	<br />;Bit1  DB &quot;B&quot;  &quot;M&quot; 09Bh, 002h, 000h, 000h, 000h, 000h, 000h, 000h, 036h,004h,000h,000h  ;14 <br /> Bit1  DB          036h,004h,000h,000h  ;14 <br />; 	B     I       T     M     A    P   I    N   F    O - <br />;                    B  I T M A P I N F O H E A D E R - Len here -&gt; 28h=40bytes<br />;            b i S i z e          b i W i d t h       b i H e i g h t     biPlanes<br />      DB 028h,000h,000h,000h,  010h,000h,000h,000h, 010h,000h,000h,000h, 001h, 000h<br />;  biBitCount      biCompression           biSizeImage         biXPelsPerMeter<br />DB 008h,000h,   000h,000h,000h,000h,   000h,001h,000h,000h, 088h,00Bh,000h,000h<br />;   biYPelsPerMeter           biClrUsed         biClrImportant<br />DB 088h,00Bh,000h,000h, 000h,000h,000h,000h, 000h,000h,000h,000h ;end BITMAPINFOHEADER<br />;                    bmiColors[1] - Len here-&gt;400h=1024 bytes =bfOffBits - 0Eh - biSize =436h-0Eh-28h=400h<br />DB 000h, 000h, 000h, 000h, 000h, 0BFh, 0BFh, 000h, 000h, 0FFh, 0FFh, 000h, 080h, 080h<br />DB 080h, 000h, 0C0h, 0C0h, 0C0h, 000h, 0ECh, 0ECh, 0ECh, 000h, 0FFh, 0FFh, 0FFh, 000h<br />DB 0C1h, 053h, 011h, 000h, 0F8h, 06Fh, 004h, 000h, 0A2h, 06Eh, 080h, 000h, 087h, 0BFh<br />DB 0F6h, 000h, 0BFh, 0F6h, 0B4h, 000h, 060h, 060h, 000h, 000h, 000h, 000h, 081h, 000h<br />DB 090h, 000h, 000h, 000h, 080h, 0F8h, 06Fh, 000h, 068h, 0E2h, 0B8h, 000h, 000h, 015h<br />DB 081h, 000h, 0B4h, 000h, 000h, 000h, 081h, 068h, 0E2h, 000h, 0F8h, 06Fh, 050h, 000h<br />DB 03Ch, 022h, 080h, 000h, 000h, 0BFh, 0F6h, 000h, 081h, 060h, 060h, 000h, 000h, 000h<br />DB 000h, 000h, 0E2h, 0B8h, 000h, 000h, 015h, 081h, 068h, 000h, 000h, 000h, 000h, 000h<br />DB 0F8h, 06Fh, 090h, 000h, 0CFh, 0D5h, 080h, 000h, 0DEh, 000h, 001h, 000h, 000h, 001h<br />DB 0CFh, 000h, 000h, 000h, 000h, 000h, 000h, 015h, 000h, 000h, 050h, 000h, 000h, 000h<br />DB 0E7h, 08Ch, 057h, 000h, 0FFh, 000h, 017h, 000h, 01Eh, 0C8h, 015h, 000h, 020h, 02Bh<br />DB 087h, 000h, 000h, 000h, 000h, 000h, 0F6h, 013h, 0E2h, 000h, 013h, 0E2h, 0BFh, 000h<br />DB 06Fh, 0BFh, 0F6h, 000h, 000h, 000h, 001h, 000h, 0F6h, 012h, 0C5h, 000h, 057h, 000h<br />DB 0BFh, 000h, 001h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 0F6h, 060h, 035h, 000h<br />DB 003h, 031h, 0BFh, 000h, 0D5h, 000h, 000h, 000h, 000h, 001h, 0CFh, 000h, 000h, 003h<br />DB 031h, 000h, 06Fh, 098h, 000h, 000h, 08Ch, 080h, 0F8h, 000h, 0BFh, 0F7h, 013h, 000h<br />DB 000h, 003h, 031h, 000h, 046h, 08Fh, 000h, 000h, 077h, 0E5h, 0E6h, 000h, 000h, 000h<br />DB 001h, 000h, 0F8h, 06Fh, 0E8h, 000h, 000h, 000h, 080h, 000h, 000h, 000h, 000h, 000h<br />DB 000h, 000h, 000h, 000h, 000h, 001h, 005h, 000h, 03Ah, 043h, 000h, 000h, 000h, 000h<br />DB 05Ch, 000h, 000h, 000h, 000h, 000h, 022h, 088h, 060h, 000h, 06Fh, 0C8h, 000h, 000h<br />DB 0B3h, 080h, 0F8h, 000h, 0BFh, 0F8h, 047h, 000h, 0F8h, 070h, 088h, 000h, 000h, 000h<br />DB 080h, 000h, 031h, 003h, 031h, 000h, 000h, 000h, 003h, 000h, 0F8h, 047h, 0D1h, 000h<br />DB 000h, 000h, 0BFh, 000h, 0B8h, 000h, 000h, 000h, 080h, 0F8h, 06Fh, 000h, 097h, 030h<br />DB 093h, 000h, 016h, 015h, 044h, 000h, 088h, 001h, 067h, 000h, 046h, 08Fh, 0E6h, 000h<br />DB 000h, 000h, 000h, 000h, 019h, 0B8h, 000h, 000h, 01Ah, 0BFh, 0F6h, 000h, 000h, 000h<br />DB 0E6h, 000h, 0FFh, 0FFh, 0FFh, 000h, 018h, 06Dh, 0FFh, 000h, 08Fh, 0BFh, 0F6h, 000h<br />DB 0E5h, 0E6h, 046h, 000h, 000h, 000h, 000h, 000h, 0E5h, 0E6h, 000h, 000h, 07Eh, 000h<br />DB 00Ch, 000h, 000h, 000h, 001h, 000h, 040h, 035h, 00Bh, 000h, 044h, 0CFh, 033h, 000h<br />DB 07Eh, 001h, 07Eh, 000h, 00Dh, 000h, 001h, 000h, 07Eh, 001h, 07Eh, 000h, 000h, 001h<br />DB 001h, 000h, 07Eh, 035h, 0CCh, 000h, 001h, 07Eh, 001h, 000h, 00Bh, 000h, 000h, 000h<br />DB 033h, 040h, 035h, 000h, 07Eh, 044h, 0CFh, 000h, 001h, 07Eh, 001h, 000h, 07Eh, 000h<br />DB 000h, 000h, 001h, 07Eh, 001h, 000h, 0CCh, 000h, 001h, 000h, 001h, 07Eh, 035h, 000h<br />DB 032h, 001h, 080h, 000h, 033h, 040h, 035h, 000h, 07Eh, 044h, 0CFh, 000h, 001h, 07Eh<br />DB 001h, 000h, 07Eh, 001h, 000h, 000h, 001h, 07Eh, 001h, 000h, 0CCh, 000h, 001h, 000h<br />DB 001h, 07Eh, 035h, 000h, 07Eh, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 0F7h, 000h<br />DB 000h, 000h, 03Ah, 048h, 000h, 000h, 000h, 0E8h, 041h, 000h, 015h, 0FFh, 000h, 000h<br />DB 067h, 000h, 000h, 000h, 0E6h, 06Ch, 001h, 000h, 057h, 05Fh, 0A4h, 000h, 001h, 080h<br />DB 001h, 000h, 000h, 000h, 000h, 000h, 001h, 07Eh, 000h, 000h, 09Dh, 0E7h, 08Ch, 000h<br />DB 0E7h, 08Ch, 063h, 000h, 000h, 000h, 017h, 000h, 000h, 000h, 000h, 000h, 0B6h, 001h<br />DB 07Fh, 000h, 000h, 000h, 003h, 000h, 0B6h, 0E7h, 08Ch, 000h, 001h, 07Fh, 003h, 000h<br />DB 09Ah, 0E8h, 012h, 000h, 0E7h, 08Ch, 053h, 000h, 041h, 046h, 08Fh, 000h, 046h, 08Fh<br />DB 0E8h, 000h, 08Fh, 009h, 0E2h, 000h, 015h, 0FFh, 046h, 000h, 0AEh, 046h, 08Fh, 000h<br />DB 0F6h, 097h, 0F0h, 000h, 000h, 000h, 005h, 000h, 03Ah, 043h, 000h, 000h, 046h, 050h<br />DB 05Ch, 000h, 049h, 050h, 05Ch, 000h, 050h, 054h, 043h, 000h, 034h, 042h, 055h, 000h<br />DB 050h, 050h, 05Ch, 000h, 04Eh, 049h, 02Eh, 000h, 053h, 000h, 049h, 000h, 070h, 0C4h<br />DB 0C1h, 000h, 0D8h, 080h, 0F8h, 000h, 080h, 0F8h, 070h, 000h, 060h, 098h, 018h, 000h<br />DB 0E8h, 044h, 081h, 000h, 080h, 082h, 009h, 000h, 0C1h, 053h, 011h, 000h, 0F8h, 070h<br />DB 0D8h, 000h, 0A2h, 06Eh, 080h, 000h, 087h, 0BFh, 0F6h, 000h, 0BFh, 0F6h, 0B4h, 000h<br />DB 0F8h, 070h, 0F4h, 000h, 098h, 018h, 080h, 000h, 040h, 081h, 060h, 000h, 082h, 009h<br />DB 07Eh, 000h, 053h, 011h, 080h, 000h, 070h, 0F4h, 0C1h, 000h, 008h, 080h, 0F8h, 000h<br />DB 080h, 0F8h, 071h, 000h, 060h, 098h, 018h, 000h, 0E7h, 098h, 081h, 000h, 080h, 082h<br />DB 009h, 000h, 0C1h, 053h, 011h, 000h, 0F8h, 071h, 008h, 000h, 0A2h, 06Eh, 080h, 000h<br />DB 087h, 0BFh, 0F6h, 000h, 0BFh, 0F6h, 0B4h, 000h, 009h, 050h, 000h, 000h, 000h, 000h<br />DB 082h, 000h, 08Fh, 000h, 000h, 000h, 0E7h, 062h, 046h, 000h, 000h, 001h, 077h, 000h<br />DB 050h, 000h, 000h, 000h, 038h, 082h, 008h, 000h, 080h, 0F8h, 071h, 000h, 060h, 098h<br />DB 018h, 000h, 0E7h, 064h, 081h, 000h, 080h, 082h, 009h, 000h, 0C1h, 053h, 011h, 000h<br />DB 0F8h, 071h, 038h, 000h, 0A2h, 06Eh, 080h, 000h, 050h, 0BFh, 0F6h, 000h, 080h, 0F8h<br />DB 071h, 000h, 060h, 097h, 0E4h, 000h, 016h, 0D8h, 081h, 000h, 080h, 081h, 0E9h, 000h<br />DB 0C1h, 053h, 011h, 000h, 0F8h, 071h, 050h, 000h, 0A2h, 06Eh, 080h, 000h, 087h, 0BFh<br />DB 0F6h, 000h, 0BFh, 0F6h, 0B4h, 000h, 0E8h, 050h, 000h, 000h, 000h, 000h, 081h, 000h<br />DB 08Fh, 002h, 086h, 000h, 046h, 08Fh, 056h, 000h, 0A0h, 002h, 086h, 000h, 0E7h, 061h<br />DB 08Ah, 000h, 086h, 0E7h, 061h, 000h, 056h, 08Fh, 002h, 000h, 030h, 0E7h, 061h, 000h<br />DB 001h, 04Fh, 089h, 000h, 04Fh, 002h, 086h, 000h, 045h, 00Fh, 00Dh, 000h, 08Fh, 0F6h<br />DB 097h, 000h, 0E8h, 00Fh, 046h, 000h, 06Fh, 09Ah, 01Dh, 000h, 0E7h, 0BCh, 046h, 000h<br />DB 0AAh, 0E7h, 06Ch, 000h, 03Ah, 043h, 0E7h, 000h, 059h, 04Dh, 05Ch, 000h, 043h, 04Fh<br />DB 044h, 000h, 031h, 07Eh, 055h, 000h, 053h, 041h, 05Ch, 000h, 044h, 05Ch, 04Dh, 000h<br />DB 070h, 05Ch, 042h, 000h, 031h, 030h, 070h, 000h, 030h, 036h, 037h, 000h, 002h, 000h<br />DB 036h, 000h, 046h, 08Fh, 000h, 000h, 09Ch, 002h, 087h, 000h, 089h, 030h, 0E7h, 000h<br />DB 087h, 001h, 04Fh, 000h, 00Bh, 04Ah, 002h, 000h, 08Fh, 01Bh, 046h, 000h, 0E7h, 0B5h<br />DB 046h, 000h, 00Fh, 004h, 0FBh, 000h, 00Ah, 02Fh, 045h, 000h, 010h, 0F6h, 097h, 000h<br />DB 000h, 000h, 000h, 000h, 08Fh, 000h, 000h, 000h, 0E8h, 013h, 046h, 000h, 06Fh, 09Ah<br />DB 068h, 000h, 0E8h, 022h, 046h, 000h, 0C0h, 046h, 08Fh, 000h, 046h, 08Fh, 0E7h, 000h<br />DB 05Ch, 03Ah, 043h, 000h, 044h, 059h, 04Dh, 000h, 055h, 043h, 04Fh, 000h, 05Ch, 031h<br />DB 07Eh, 000h<br />;<br />DB 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h<br />DB 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 001h, 006h, 003h, 006h, 006h<br />DB 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 001h, 000h, 004h, 004h<br />DB 003h, 006h, 006h, 006h, 003h, 006h, 006h, 006h, 006h, 006h, 006h, 001h, 003h, 003h, 005h, 005h<br />DB 003h, 006h, 006h, 003h, 006h, 006h, 006h, 006h, 006h, 006h, 001h, 002h, 000h, 004h, 005h, 005h<br />DB 003h, 006h, 003h, 006h, 006h, 006h, 006h, 006h, 006h, 001h, 002h, 005h, 000h, 004h, 005h, 005h<br />DB 003h, 006h, 006h, 006h, 006h, 006h, 006h, 001h, 003h, 002h, 005h, 002h, 000h, 000h, 005h, 005h<br />DB 003h, 006h, 006h, 006h, 006h, 006h, 001h, 002h, 004h, 005h, 002h, 005h, 000h, 003h, 000h, 005h<br />DB 003h, 006h, 003h, 003h, 003h, 003h, 001h, 002h, 004h, 002h, 005h, 002h, 000h, 004h, 000h, 005h<br />DB 003h, 006h, 006h, 006h, 006h, 006h, 001h, 005h, 004h, 005h, 002h, 005h, 000h, 000h, 005h, 005h<br />DB 003h, 006h, 006h, 006h, 006h, 006h, 006h, 001h, 001h, 002h, 005h, 002h, 000h, 004h, 005h, 005h<br />DB 003h, 006h, 003h, 006h, 006h, 006h, 006h, 006h, 006h, 001h, 002h, 005h, 000h, 004h, 005h, 005h<br />DB 003h, 006h, 006h, 003h, 006h, 006h, 006h, 006h, 006h, 006h, 001h, 002h, 003h, 003h, 004h, 005h<br />DB 003h, 006h, 006h, 006h, 003h, 006h, 006h, 006h, 006h, 006h, 006h, 001h, 002h, 000h, 004h, 004h<br />DB 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 001h, 003h, 006h, 003h<br />DB 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h, 006h<br />DB 006h, 006h, 006h, 006h, 006h, 006h<br /><br />align 4<br />Bit2  DB 036h, 004h, 000h, 000h, 028h, 000h<br />DB 000h, 000h, 010h, 000h, 000h, 000h, 010h, 000h, 000h, 000h, 001h, 000h, 008h, 000h, 000h, 000h<br />DB 000h, 000h, 000h, 001h, 000h, 000h, 088h, 00Bh, 000h, 000h, 088h, 00Bh, 000h, 000h, 000h, 000h<br />DB 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 0BFh, 0BFh, 000h, 000h, 0FFh<br />DB 0FFh, 000h, 080h, 080h, 080h, 000h, 0C0h, 0C0h, 0C0h, 000h, 0ECh, 0ECh, 0ECh, 000h, 0FFh, 0FFh<br />DB 0FFh, 000h, 0C1h, 053h, 011h, 000h, 0F8h, 06Fh, 004h, 000h, 0A2h, 06Eh, 080h, 000h, 087h, 0BFh<br />DB 0F6h, 000h, 0BFh, 0F6h, 0B4h, 000h, 060h, 060h, 000h, 000h, 000h, 000h, 081h, 000h, 090h, 000h<br />DB 000h, 000h, 080h, 0F8h, 06Fh, 000h, 068h, 0E2h, 0B8h, 000h, 000h, 015h, 081h, 000h, 0B4h, 000h<br />DB 000h, 000h, 081h, 068h, 0E2h, 000h, 0F8h, 06Fh, 050h, 000h, 03Ch, 022h, 080h, 000h, 000h, 0BFh<br />DB 0F6h, 000h, 081h, 060h, 060h, 000h, 000h, 000h, 000h, 000h, 0E2h, 0B8h, 000h, 000h, 015h, 081h<br />DB 068h, 000h, 000h, 000h, 000h, 000h, 0F8h, 06Fh, 090h, 000h, 0CFh, 0D5h, 080h, 000h, 0DEh, 000h<br />DB 001h, 000h, 000h, 001h, 0CFh, 000h, 000h, 000h, 000h, 000h, 000h, 015h, 000h, 000h, 050h, 000h<br />DB 000h, 000h, 0E7h, 08Ch, 057h, 000h, 0FFh, 000h, 017h, 000h, 01Eh, 0C8h, 015h, 000h, 020h, 02Bh<br />DB 087h, 000h, 000h, 000h, 000h, 000h, 0F6h, 013h, 0E2h, 000h, 013h, 0E2h, 0BFh, 000h, 06Fh, 0BFh<br />DB 0F6h, 000h, 000h, 000h, 001h, 000h, 0F6h, 012h, 0C5h, 000h, 057h, 000h, 0BFh, 000h, 001h, 000h<br />DB 000h, 000h, 000h, 000h, 000h, 000h, 0F6h, 060h, 035h, 000h, 003h, 031h, 0BFh, 000h, 0D5h, 000h<br />DB 000h, 000h, 000h, 001h, 0CFh, 000h, 000h, 003h, 031h, 000h, 06Fh, 098h, 000h, 000h, 08Ch, 080h<br />DB 0F8h, 000h, 0BFh, 0F7h, 013h, 000h, 000h, 003h, 031h, 000h, 046h, 08Fh, 000h, 000h, 077h, 0E5h<br />DB 0E6h, 000h, 000h, 000h, 001h, 000h, 0F8h, 06Fh, 0E8h, 000h, 000h, 000h, 080h, 000h, 000h, 000h<br />DB 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 005h, 000h, 03Ah, 043h, 000h, 000h, 000h, 000h<br />DB 05Ch, 000h, 000h, 000h, 000h, 000h, 022h, 088h, 060h, 000h, 06Fh, 0C8h, 000h, 000h, 0B3h, 080h<br />DB 0F8h, 000h, 0BFh, 0F8h, 047h, 000h, 0F8h, 070h, 088h, 000h, 000h, 000h, 080h, 000h, 031h, 003h<br />DB 031h, 000h, 000h, 000h, 003h, 000h, 0F8h, 047h, 0D1h, 000h, 000h, 000h, 0BFh, 000h, 0B8h, 000h<br />DB 000h, 000h, 080h, 0F8h, 06Fh, 000h, 097h, 030h, 093h, 000h, 016h, 015h, 044h, 000h, 088h, 001h<br />DB 067h, 000h, 046h, 08Fh, 0E6h, 000h, 000h, 000h, 000h, 000h, 019h, 0B8h, 000h, 000h, 01Ah, 0BFh<br />DB 0F6h, 000h, 000h, 000h, 0E6h, 000h, 0FFh, 0FFh, 0FFh, 000h?~G</div>
    <div class="meta">Posted on 2002-05-09 19:04:26 by buliaNaza</div>
   </div>
   <div class="post" id="post-37445">
    <div class="subject"><a href="#post-37445">StretchDIBits</a></div>
    <div class="body">continue...<br /><pre><code><br /><br />.data<br />rect    RECT  &lt;&gt;                        ;<br /><br />.code<br /><br />OnDrawitem&#58;                             ;<br />	mov	ebx, &#91;esp+16+24&#93;  	; ebx-&gt;lParam-&gt;DRAWITEMSTRUCT<br />	mov	ecx, &#91;esp+16+20&#93;  	; ecx-&gt;wParam-&gt;control identifier <br />                                        ;<br />	test	ecx, ecx		; if ecx=0-&gt;menu	<br />        jne     EndOd                   ; end<br />        ;......                         ;<br />        ;......                         ;<br />	;<br />	mov	edx, &#91;ebx&#93;.DRAWITEMSTRUCT.rcItem.top	;<br />	mov	rect.top, edx				;<br />	mov	edx, &#91;ebx&#93;.DRAWITEMSTRUCT.rcItem.right	;<br />        mov     rect.right, edx                         ; <br />	mov	edx, &#91;ebx&#93;.DRAWITEMSTRUCT.rcItem.bottom	;<br />        mov     rect.bottom, edx                        ;<br />        ;.......                                        ;<br />        ;.......                                        ;<br />	mov	ebp, &#91;ebx&#93;.DRAWITEMSTRUCT.hdc 		; ebp-&gt;hDC<br />        mov     eax, offset Bit1                        ; or offset Bit2<br />        mov     ecx, offset rect                        ;<br />	call	StretchBitmap				; call my proc<br />        ;........                                       ;<br />        ;........                                       ;<br />EndOd&#58;                                                  ;<br />        ret                                             ;<br /><br /><br />;Usage&#58;                                 ;<br />;	mov	eax, offset Bitmap	; eax-&gt;bitmap offset in memory<br />;	mov	ecx, offset rect	; ecx-&gt;offset of target rectangle<br />;	mov	ebp, hDC		; ebp-&gt;hDC<br />;       call    StretchBitmap           ;<br />;.......................................;<br />StretchBitmap&#58;                          ;<br />        push    ebx                     ; <br />        push    0CC0020h                ; dwRop, raster operation code<br />        lea     ebx, &#91;eax+4&#93;            ; calculate pointer to BITMAPINFOHEADER <br />        push    0                       ; iUsage, DIB_RGB_COLORS<br />        push    ebx                     ; pointerBMI+4 ; lpBitsInfo, address of bitmap data<br />        mov     eax, &#91;ebx-4&#93;            ; offset to bitmap data<br />	lea	edx, &#91;eax+ebx-14&#93; 	; calculate pointer to bitmap data<br />        mov     eax, &#91;ebx+8&#93;            ; member biHeight of BITMAPINFO<br />        push    edx                     ; lpBits, address of bitmap bits<br />;Source Rect                            ;<br />        mov     edx, &#91;ebx+4&#93;            ; member biWidth of BITMAPINFO<br />        push    eax                     ; nSrcHeight, height of src rectangle<br />        push    edx                     ; nSrcWidth, width of source rectangle<br />        push    0                       ; YSrc, y=src. rect. up-left<br />        push    0                       ; XSrc, x=src. rect. up-left<br />;Destination Rect			;<br />        mov     eax, &#91;ecx+12&#93;           ; nDestHeight, height dest. rectangle<br />        mov     edx, &#91;ecx+8&#93;            ; nDestWidth, width dest. rectangle<br />        push    eax                     ; Ypos_max<br />        push    edx                     ; Xpos_max <br />        mov     eax, &#91;ecx+4&#93;            ; YDest, y=dest. rect. up-left<br />        mov     edx, &#91;ecx&#93;              ; XDest, x=dest. rect. up-left <br />        push    eax                     ; YDest, y=dest. rect. up-left<br />        push    edx                     ; XDest, x=dest. rect. up-left <br />        push    ebp                     ; ebp-&gt;hDC<br />        call    StretchDIBits           ; call API<br />        pop     ebx                     ;<br />        ret                             ;</code></pre></div>
    <div class="meta">Posted on 2002-05-09 19:08:45 by buliaNaza</div>
   </div>
   <div class="post" id="post-37610">
    <div class="subject"><a href="#post-37610">Problem is solved</a></div>
    <div class="body">Thanks for the suggestions,  Brad and BuliaNaza, but I wasn't looking for a workaround. I'm trying to convert lots of old TASM code to MASM, so it's important I know *why* something fails. In this case, it seems that MASM did not understand this TASM construct<br /><br />mov   [(BITMAPINFOHEADER( VV_Bitmap_Info.bmiHeader)).biWidth], 800<br /><br />Instead, I had to use this:<br /><br />mov   [ VV_Bitmap_Info.bmiHeader.biWidth], 800<br /><br />If you wonder why I used that BITMAPINFOHEADER(): In the original code (not the simplyfied bugtest code), there was a register in there:<br /><br />mov [(BITMAPINFOHEADER( eax ).biWidth], 800<br /><br />The &quot;cast&quot; tells TASM that eax is a pointer to a Bitmapinfoheader. Appearently MASM does not understand this type of addressing syntax, but generates the wrong address instead of giving an error.<br /><br />The correct syntax in MASM with a register seems to be:<br /><br />mov .BITMAPINFOHEADER.biWidth, 800<br /><br />Kudos to NaN who figured that out.</div>
    <div class="meta">Posted on 2002-05-10 14:27:52 by james</div>
   </div>
  </div>
 </body>
</html>