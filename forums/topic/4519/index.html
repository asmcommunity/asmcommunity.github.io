<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Simple random algo demo - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4519" />
    <link rel="next" href="../?id=4519&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=4519">Simple random algo demo</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=4519&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=4519&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="4519" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=4519&amp;page=2">&gt;</a><a href="../?id=4519&amp;page=2">&raquo;</a></form>   <div class="post" id="post-31544">
    <div class="subject"><a href="#post-31544">Simple random algo demo</a></div>
    <div class="body">I liked the simplicity of the random algo that vecna posted so I have played with it for a while to make its distribution less uniform. The form I have it in is suitable for simple stuff like games or in the case of the example, a static star field plotted with random X/Y co-ordinates.<br /><br />There are far more powerful versions available, Agner Fog's collection are very sophisticated and with a secondary random seeding for the algorithm, they are probably powerful enough to use with encryption but they are a more complex algos that are based on floating point and are probably a bit complex to use for simple tasks.<br /><br />Any comments or improvements will be welcome, the idea is to retain a simple integer random algorithm.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-03-29 19:08:42 by hutch--</div>
   </div>
   <div class="post" id="post-31568">
    <div class="subject"><a href="#post-31568">Simple random algo demo</a></div>
    <div class="body">I like <strong>Yawns</strong> Random Number Generator.<pre><code><br />RandomNumGen PROC min&#58;DWORD, max&#58;DWORD<br /><br />    mov     ebx, max<br />    sub     ebx, min<br />    inc     ebx<br />    xor     edx, edx<br />    mov     eax, RandSeed<br />    div     ebx<br />    add     RandSeed, eax<br />    add     edx, min<br />    mov     eax, edx<br />    ret<br /><br />RandomNumGen ENDP<br /></code></pre>All you have to do is call GetTickCount to get the seed and your ready to go. You can even specify a range of values like from 1 to 500... :)</div>
    <div class="meta">Posted on 2002-03-29 23:00:24 by stryker</div>
   </div>
   <div class="post" id="post-31571">
    <div class="subject"><a href="#post-31571">Simple random algo demo</a></div>
    <div class="body">Well it *looks* like a good randomizing algo on the surface, but its still quite repetitive....  However, the trade off is speed! Im impressed on the size for what it *can* do.<br /><br />I took that algo, and placed it in a Direct Draw app with a main section as follows:<pre><code><br /><br />  RAND32 640<br />  mov lx, eax<br />  RAND32 480<br />  mov ecx, ddsd.lPitch<br />  mul ecx<br />  add eax, lx<br />  mov ly, eax<br />  RAND32 3        ; &lt;&lt;&lt;&lt; COLORS<br />  <br />  mov ebx, lpBUF<br />  add ebx, ly<br />  mov &#91;ebx&#93;, al</code></pre><br /><br />All it does is get 3 random #'s (0-640, 0-480, 0-3).<br /><br />With your algo, and the colors brought up high (256) it looks exactly like my version based on the Park, Miller random number algorithm (chaotic!).<br /><br />But when the # is brough down to smaller values, its does become quite repetative!  I start to get line patters forming that looks *very* symetrical!<br /><br />The smaller the #, the worse it gets!  And what i mean by patterning is, there is areas that *always* get the same color number, and it happens with constant repitition:</div>
    <div class="meta">Posted on 2002-03-30 00:17:03 by NaN</div>
   </div>
   <div class="post" id="post-31573">
    <div class="subject"><a href="#post-31573">Simple random algo demo</a></div>
    <div class="body">Nice! example :alright: I actually use Yawns RNG for my data structures homeworks/projects.<br /><br />It really bogs down when it comes to smaller range of numbers. I tried to apply it on a slot machine game on of my friends code and yes it becomes repetitive on smaller ranges. But its great on larger ranges and look at the size and less opcodes used, very straightforward too and easy to follow. :grin:</div>
    <div class="meta">Posted on 2002-03-30 00:26:46 by stryker</div>
   </div>
   <div class="post" id="post-31574">
    <div class="subject"><a href="#post-31574">Simple random algo demo</a></div>
    <div class="body">Nan,<br /><br />The test you are using looks interesting, I tested this modified version of the algo that Vecna posted with 3 grey shades with the range sized to the existing window size and after some thousands of iterations, the pattern still looked very RANDOM in its distribution.<br /><br />The reason why I modified it was to avoid the nearly exact distribution of the different numbers in the range. I would be interested to see what this algo looked like with your test.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-03-30 00:37:17 by hutch--</div>
   </div>
   <div class="post" id="post-31576">
    <div class="subject"><a href="#post-31576">Simple random algo demo</a></div>
    <div class="body">Sure thing Hutch...<br /><br />Here is the Files I used:<br /><br />The Ex2 is just example 2 (for D Draw piddling)<br />_Macros_.inc  Has the Random # Gen's near the bottom... (and a ton of other crap ?? (( I rarely use this file anymore))<br /><br />In Ex2:  Near the bottom in &quot;Game Main&quot; i do the work of placing pixels at 'random' :) .  The two types are there, but uncomment and re-compile to try the other...<br /><br />Enjoy.. (sorry, but the code is *real* shoddy ~ wrote the DirectX framework almost a year ago... but this doesnt matter, cause the random gen macro's are in _Macros_.inc anyways...)<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-03-30 00:49:19 by NaN</div>
   </div>
   <div class="post" id="post-31577">
    <div class="subject"><a href="#post-31577">Simple random algo demo</a></div>
    <div class="body">I took a screenshot from that one and here's the output. I cut a small portion of the image(the rest are the same as the one here) since I'm running at 1024x768 and the image file is large in dimensions...</div>
    <div class="meta">Posted on 2002-03-30 00:56:28 by stryker</div>
   </div>
   <div class="post" id="post-31583">
    <div class="subject"><a href="#post-31583">Simple random algo demo</a></div>
    <div class="body">Looks like a good generator hutch.  Easy to remember.  But what is the following line included for:<br />    and eax, 0FFFFFFFFh<br />doesn't that just give back eax...?</div>
    <div class="meta">Posted on 2002-03-30 02:31:08 by grv575</div>
   </div>
   <div class="post" id="post-31590">
    <div class="subject"><a href="#post-31590">Simple random algo demo</a></div>
    <div class="body">If you are looking for simple pseudorandom number generators, there's no simpler than the Lehmer algorithm (the linear congruential method):<pre><code>mov   eax, Seed<br />mul   Value<br />inc   eax<br />mov   Seed, eax<br />mov   ecx, Range<br />xor   edx, edx<br />div   ecx</code></pre>You initialize Seed with GetTickCount, and that's all!<br />You must select an initial value for 'Value' according to Knuth rules:<br />1. not too small or too large compared to 'Range'<br />2. 1 less decimal digit than 'Range' is a good choice (if 'Range' is a decimal number of 5 digits, 'Value' should have 4 digits)<br />3. should end with ...n21, where n is even (7621, 2308546021, etc)</div>
    <div class="meta">Posted on 2002-03-30 03:35:30 by micmic</div>
   </div>
   <div class="post" id="post-31591">
    <div class="subject"><a href="#post-31591">Simple random algo demo</a></div>
    <div class="body">If anyone cares, here is the Park, Miller Algo:<br /><pre><code>RAND32 MACRO base&#58;REQ<br />  ; Random number generator based on the Real time clock<br />  ; and the Park, Miller random number algorithm<br />  ;<br />  ; Coded by NaN for WIN32ASM<br />  ; &#40; Optomized by bitRake &#41;<br />  ;<br />  ; May 5, 2001<br />  ; rev 2.<br /><br />;  push ecx ; not used<br />  push edx<br /><br />  ifndef __RAND_BY_NAN__<br />  __RAND_BY_NAN__ equ 1<br />  <br />     .data? <br />     NaNRand dd ?<br />     .code<br /><br />    db 0fh,31h <br />    shr eax, 2<br />    add eax, 1<br />    mov NaNRand, eax<br />  else<br />    mov eax, NaNRand    <br />  endif<br />  <br />  xor edx,edx<br />  push 127773	;q<br />  div DWORD PTR &#91;esp&#93;	; eax == floor&#40; seed / q&#41;<br />                		; edx == remainder<br />  push eax<br />  mov eax, 16807<br />  mul edx      ; eax = mul of remainder * a<br />  pop edx      ; edx == floor of seed/q<br /><br />  push eax<br />  mov eax, 2836<br />  mul edx<br />  pop edx		; edx == mull of rem * a<br />		; eax == mull of seed/q * r<br />  sub edx, eax<br />  mov eax, edx    <br />  mov NaNRand, edx ; save next seed <br />  push base<br />  mov edx, 0<br />  div DWORD PTR &#91;esp&#93;<br />  add esp,8<br />  mov eax, edx<br />  pop edx<br />;  pop ecx<br />  EXITM &lt;eax&gt;<br />ENDM</code></pre><br /><br />This can also be easily cleaned up into a function...<br /><br />Enjoy..<br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-03-30 03:39:31 by NaN</div>
   </div>
   <div class="post" id="post-31602">
    <div class="subject"><a href="#post-31602">Simple random algo demo</a></div>
    <div class="body">NaN,<br /><br />The algo looks good, I have been playing with its behaviour in your test bed. Now that you come to mention it :) it would be handy if it WAS converted to a procedure and there was a method of manually setting the seed number.<br /><br />The algo type I had in mind is one that will produce the same sequence with the same seed.<br /><br />With a few fiddles the one I posted was OK on small sequrences but its repeat rate was very poor and patterns became visible so it is not powerful enough.<br /><br />Now that you are a man of leisure, such a contribution to the MASM32 library would be appreciated. :alright: <br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-03-30 05:00:41 by hutch--</div>
   </div>
   <div class="post" id="post-31643">
    <div class="subject"><a href="#post-31643">Simple random algo demo</a></div>
    <div class="body">Sure, but little lost what you want (maybe its cause i just woke up?). <br /><br />You want the source for the package? - If so, take it..<br /><br />You want me to make a function outat it first?<br /><br />You want the Ex2 program for the package? (Dunno why, its crap code :grin: )<br /><br />Or all of the above? <br /><br /><br />Anywho, glad it amuses you :)<br />:enjoy:<br />NaN</div>
    <div class="meta">Posted on 2002-03-30 12:50:29 by NaN</div>
   </div>
   <div class="post" id="post-31645">
    <div class="subject"><a href="#post-31645">Simple random algo demo</a></div>
    <div class="body">I think hutch-- wants you to write it inside a procedure but don't worry I have it covered. :alright: <pre><code><br />NaNPM PROC base&#58;DWORD<br /><br />    push edx<br /><br />    ifndef __RAND_BY_NAN__<br />    __RAND_BY_NAN__ equ 1<br />  <br />    .data?<br />    <br />        NaNRand dd ?<br />    <br />    .code<br /><br />        db 0fh,31h <br />        shr eax, 2<br />        add eax, 1<br />        mov NaNRand, eax<br />    ELSE<br />        mov eax, NaNRand    <br />    ENDIF<br />  <br />    xor edx,edx<br />    push 127773<br />    div DWORD PTR &#91;esp&#93;<br />    push eax<br />    mov eax, 16807<br />    mul edx<br />    pop edx<br />    push eax<br />    mov eax, 2836<br />    mul edx<br />    pop edx<br />    sub edx, eax<br />    mov eax, edx    <br />    mov NaNRand, edx<br />    push base<br />    mov edx, 0<br />    div DWORD PTR &#91;esp&#93;<br />    add esp,8<br />    mov eax, edx<br />    pop edx<br />    ret<br /><br />NaNPM ENDP<br /></code></pre>I just had a quick conversion from your macro to a proc(No Optimizations done). :)</div>
    <div class="meta">Posted on 2002-03-30 13:04:33 by stryker</div>
   </div>
   <div class="post" id="post-31679">
    <div class="subject"><a href="#post-31679">Simple random algo demo</a></div>
    <div class="body">Josh,<br /><br />You are a gentleman. I have changed the algo to the format I was after and plugged it directly into NaN's test piece and its working fine.<br /><br />NaN,<br /><br />Have a look at this form and see if you are happy with it, if its OK, I want it for the MASM32 library as it performs well and is easy to use.<br /><pre><code><br />; #########################################################################<br />;<br />;  Park Miller random number algorithm written by Jaymeson Trudgen &#40;NaN&#41;.<br />;<br />; #########################################################################<br /><br />nrandom PROC base&#58;DWORD<br /><br />    mov eax, nrandom_seed<br /><br />    xor edx,edx<br />    push 127773<br />    div DWORD PTR &#91;esp&#93;<br />    push eax<br />    mov eax, 16807<br />    mul edx<br />    pop edx<br />    push eax<br />    mov eax, 2836<br />    mul edx<br />    pop edx<br />    sub edx, eax<br />    mov eax, edx    <br />    mov nrandom_seed, edx<br />    push base<br />    mov edx, 0<br />    div DWORD PTR &#91;esp&#93;<br />    add esp,8<br />    mov eax, edx<br /><br />    ret<br /><br />nrandom ENDP<br /><br />; #########################################################################<br /><br />nseed proc TheSeed&#58;DWORD<br /><br />    .data<br />      nrandom_seed dd 12345678<br />    .code<br /><br />    mov eax, TheSeed<br />    mov nrandom_seed, eax<br /><br />    ret<br /><br />nseed endp<br /><br />; #########################################################################<br /><br />Regards,<br /><br />&#91;email&#93;hutch@movsd.com&#91;/email&#93;<br /><br /></code></pre></div>
    <div class="meta">Posted on 2002-03-30 16:57:47 by hutch--</div>
   </div>
   <div class="post" id="post-31692">
    <div class="subject"><a href="#post-31692">Simple random algo demo</a></div>
    <div class="body"><pre><code>nrandom PROC base&#58;DWORD<br />	mov eax, nrandom_seed<br /><br />	xor edx, edx<br />	mov ecx, 127773<br />	div ecx             ; seed/127773<br /><br />	mov ecx, eax<br />	mov eax, 16807<br />	mul edx             ; 16807 * &#40;seed % 127773&#41;<br /><br />	mov edx, ecx<br />	mov ecx, eax<br />	mov eax, 2836<br />	mul edx<br /><br />	sub ecx, eax<br />	xor edx, edx<br />	mov eax, ecx<br />	mov nrandom_seed, ecx<br />	div base<br /><br />	mov eax, edx<br />	ret<br />nrandom ENDP</code></pre></div>
    <div class="meta">Posted on 2002-03-30 17:55:09 by bitRAKE</div>
   </div>
   <div class="post" id="post-31718">
    <div class="subject"><a href="#post-31718">Simple random algo demo</a></div>
    <div class="body">Hutch it looks great to me :grin:<br /><br />However, after doing some more homework on the issue, I strongly think you should use bitRAKE's above version (and give him credit for optomizing it so tightly).<br /><br />Using the following code as a bench on my AMD 800 (256 Mb Ram), Windows 98 SE:<br /><pre><code>.586<br />.model flat,stdcall<br />option casemap&#58;none<br />.NOLIST<br />include \masm32\include\windows.inc<br />include \masm32\include\masm32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\debug.inc<br />include \masm32\include\user32.inc<br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\masm32.lib<br />includelib \masm32\lib\debug.lib<br />.list<br /><br />nrandom PROTO &#58;DWORD<br />mrandom PROTO &#58;DWORD<br />nseed   PROTO &#58;DWORD<br /><br />TimeTest_ON macro <br />          db 0fh,31h <br />          push edx       ; push high<br />          push eax       ; push low<br />endm<br /><br />TimeTest_OFF macro <br />          db 0fh,31h <br />          pop ebx        ; pop low<br />          pop ecx        ; pop hight<br />          sub eax,ebx    ; diff low<br />          sbb edx,ecx    ; diff high<br />endm<br /><br /> TLen equ 10<br /><br />.data<br /><br />.data?<br />   EFX    dd ?<br />   EGX    dd ?<br />   Ave    dd ?<br />.code<br />start&#58;<br />pusha<br /><br />PrintText &quot;Warm up -- Shake window setup time error&quot;<br /><br />invoke nseed, 123456<br />mov EFX, 10000000<br />TimeTest_ON<br />@@&#58;<br />invoke nrandom, 10<br />dec EFX<br />jnz @B<br />TimeTest_OFF<br />PrintDec edx<br />PrintDec eax<br /><br />mov Ave, 0<br /><br />PrintText &quot;------------- Previous Version -----------&quot;<br /><br />mov EGX, 100<br />ALop&#58;<br />invoke nseed, 123456<br />mov EFX, TLen<br />TimeTest_ON<br />@@&#58;<br />invoke nrandom, 10<br />dec EFX<br />jnz @B<br />TimeTest_OFF<br />add Ave, eax<br />dec EGX<br />jnz ALop<br />xor edx, edx<br />mov eax, Ave<br />mov ecx, 1000<br />div ecx<br />PrintText &quot; Average Tick Count For 1 Random Number&#58; &quot;<br />PrintDec eax<br /><br />mov Ave, 0<br /><br />PrintText &quot;------------- New Version -----------&quot;<br /><br />mov EGX, 100<br />BLop&#58;<br />invoke nseed, 123456<br />mov EFX, TLen<br />TimeTest_ON<br />@@&#58;<br />invoke mrandom, 10<br />dec EFX<br />jnz @B<br />TimeTest_OFF<br />add Ave, eax<br />dec EGX<br />jnz BLop<br />xor edx, edx<br />mov eax, Ave<br />mov ecx, 1000<br />div ecx<br />PrintText &quot; Average Tick Count For 1 Random Number&#58; &quot;<br />PrintDec eax<br /><br /><br />popa<br />invoke ExitProcess, NULL</code></pre><br /><br />The following results occoured (and were also found highly recreatable between separate executions):<div class="quote">Warm up -- Shake window setup time error<br />edx = 0<br />eax = 1129853437<br />------------- Previous Version -----------<br /> Average Tick Count For 1 Random Number: <br />eax = 107<br />------------- New Version -----------<br /> Average Tick Count For 1 Random Number: <br />eax = 98</div><br /><br />So he shaved off 9 tick counts, and (63 - 55)= 8 Bytes from the previous version, while keeping the algorithm the same (Tested and showed 10 numbers in the same order from the same seed as my older version).   So its just *better* in every direction (good job bitRAKE!).<br /><br /><strong>So i sugest using somthing like this</strong>:<pre><code>;  #########################################################################<br />;<br />;  Park Miller random number algorithm.<br />;<br />;  Written by Jaymeson Trudgen &#40;NaN&#41;<br />;  Optimized by bitRAKE &#40;Rickey Bowers Jr.&#41;<br />;  <br />;  Size&#58; 55 Bytes,  CPU Time&#58; 98 Ticks<br />#########################################################################<br /><br />nrandom PROC base&#58;DWORD<br /><br />	mov eax, nrandom_seed<br /><br />	xor edx, edx<br />	mov ecx, 127773<br />	div ecx<br />	mov ecx, eax<br />	mov eax, 16807<br />	mul edx<br />	mov edx, ecx<br />	mov ecx, eax<br />	mov eax, 2836<br />	mul edx<br />	sub ecx, eax<br />	xor edx, edx<br />	mov eax, ecx<br />	mov nrandom_seed, ecx<br />	div base<br /><br />	mov eax, edx<br />	ret<br /><br />nrandom ENDP<br /><br />;  #########################################################################<br /><br />nseed proc TheSeed&#58;DWORD<br /><br />    .data<br />      nrandom_seed dd 12345678<br />    .code<br /><br />    mov eax, TheSeed<br />    mov nrandom_seed, eax<br /><br />    ret<br /><br />nseed endp<br /><br />;  #########################################################################</code></pre><br /><br />:alright:<br />NaN<br /><br />PS:  Off topic, but i find it amazing a programmer in Astralia can get my name correct (to my surprise), while my school (which i've invested about 20K $ and 4 years of my life) gives me a graduation mug with <strong>Jaymeson Trudeau</strong> on it!  Hehehe, makes me wonder what the Degree will have...</div>
    <div class="meta">Posted on 2002-03-31 00:59:28 by NaN</div>
   </div>
   <div class="post" id="post-31735">
    <div class="subject"><a href="#post-31735">Simple random algo demo</a></div>
    <div class="body">Yes,<br /><br />Optimisation looks good, plugged into the attached example, a rewrite of the last one.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-03-31 04:02:01 by hutch--</div>
   </div>
   <div class="post" id="post-31821">
    <div class="subject"><a href="#post-31821">Simple random algo demo</a></div>
    <div class="body">Hehe, i like it ~ its got this star wars thing to it :)<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-03-31 12:42:38 by NaN</div>
   </div>
   <div class="post" id="post-31832">
    <div class="subject"><a href="#post-31832">Simple random algo demo</a></div>
    <div class="body"><pre><code><br />	sub ecx, eax<br />	xor edx, edx &lt;-- Remove this<br />	mov eax, ecx<br />	mov nrandom_seed, ecx<br />	div base<br /></code></pre><br /><br />You really don't need the extra &quot;xor edx, edx&quot; and it will increase the speed of the code (by a tinsy wincy bit)..<br /><br />Sliver<br /><br />---EDIT---<br />actually both of the &quot;xor edx, edx&quot; aren't really used (because the value in them gets trashed anyway)... not sure what purpose they serve... :)  Prob. missing something</div>
    <div class="meta">Posted on 2002-03-31 13:49:29 by Sliver</div>
   </div>
   <div class="post" id="post-31838">
    <div class="subject"><a href="#post-31838">Simple random algo demo</a></div>
    <div class="body">Its because the way <strong>div</strong> works.<br /><br />Here is a description from HelpPC 21:<div class="quote">Unsigned binary division of accumulator by source.  If the source<br />divisor is a byte value then AX is divided by &quot;src&quot; and the quotient<br />is placed in AL and the remainder in AH.  If source operand is a word<br />value, then DX:AX is divided by &quot;src&quot; and the quotient is stored in AX<br />and the remainder in DX.<br /></div><br /><br />So by extension to 32 bits:  EDX:EAX becomes divided when the source is a 32 bit value.   To keep the results correct we must zero out any grabage that might be there to start with...<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-03-31 14:32:51 by NaN</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=4519&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=4519&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="4519" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=4519&amp;page=2">&gt;</a><a href="../?id=4519&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>