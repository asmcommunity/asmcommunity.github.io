<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Get OS version - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20278" />
    <link rel="next" href="../?id=20278&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=20278">Get OS version</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=20278&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=20278&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="20278" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=20278&amp;page=2">&gt;</a><a href="../?id=20278&amp;page=2">&raquo;</a></form>   <div class="post" id="post-155227">
    <div class="subject"><a href="#post-155227">Get OS version</a></div>
    <div class="body">hello, everybody.<br />here a code written by Thomas Kruse. when i tested it on the windows xp home edition, it returned -1(unknown).<br />what's error my usage?<br /><br />regards.<br /><pre><code><br />;@echo off<br />;goto make<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />		.386<br />		.model flat, STDCALL<br />		option casemap &#58;none<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />include	\masm32\include\windows.inc<br />include	\masm32\include\kernel32.inc<br />include	\masm32\include\user32.inc<br />include	\masm32\include\masm32.inc <br />includelib	\masm32\lib\kernel32.lib<br />includelib	\masm32\lib\user32.lib<br />includelib	\masm32\lib\masm32.lib<br /><br />include		\masm32\Macros\macros.asm<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />;-- return values from OS_GetOS<br />.const<br />OS_UNKNOWN	equ -1<br />OS_WIN95	equ 1<br />OS_WIN98	equ 2<br />OS_WINME	equ 3<br />OS_WINNT	equ 4<br />OS_WIN2K	equ 5<br />OS_WINXP	equ 6<br />OS_WIN2K3	equ 7<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.code<br /><br />OS_GetOS proc<br />	local _theReturnValue&#58;DWORD<br /><br />	pushad ; store all registers<br />	mov _theReturnValue,OS_UNKNOWN<br />	assume fs&#58;nothing<br />	mov ebx,fs&#58;&#91;18h&#93; ; get self pointer from TEB<br />	mov eax,fs&#58;&#91;30h&#93; ; get pointer to PEB / database<br />	.if eax==7FFDF000h &amp;&amp; ebx==7FFDE000h ; WinNT based<br />		mov ebx,&#91;eax+0A8h&#93; ; get OSMinorVersion<br />		mov eax,&#91;eax+0A4h&#93; ; get OSMajorVersion<br />		.if eax==5 &amp;&amp; ebx==0 ; is it Windows 2000?<br />			mov _theReturnValue,OS_WIN2K<br />		.elseif eax==5 &amp;&amp; ebx==1 ; is it Windows XP?<br />			mov _theReturnValue,OS_WINXP<br />		.elseif eax==5 &amp;&amp; ebx==2 ; is it Windows 2003?<br />			mov _theReturnValue,OS_WIN2K3<br />		.elseif eax&lt;=4 ; is it Windows NT?<br />			mov _theReturnValue,OS_WINNT<br />		.endif<br />	.else ; Win9X based<br />		mov edx,00530000h ; the magic value to search<br />		mov eax,fs&#58;&#91;18h&#93; ; get the TEB base address<br />		mov ebx,&#91;eax+58h&#93; ; TEB-base + 58h &#40;W95&#41;<br />		mov ecx,&#91;eax+7Ch&#93; ; TEB-base + 7Ch &#40;WME&#41;<br />		mov eax,&#91;eax+54h&#93; ; TEB-base + 54h &#40;W98&#41;<br />		.if ebx==edx ; is it Windows 95?<br />			mov _theReturnValue,OS_WIN95<br />		.elseif eax==edx ; is it Windows 98?<br />			mov _theReturnValue,OS_WIN98<br />		.elseif ecx==edx ; is it Windows ME?<br />			mov _theReturnValue,OS_WINME<br />		.endif<br />	.endif ; of base check NT/9X<br />		popad ; restore all registers<br />		mov eax,_theReturnValue<br />		ret ; return to caller<br />OS_GetOS endp<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />start&#58;<br />	invoke OS_GetOS<br />	invoke MessageBox,NULL,str$&#40;eax&#41;,chr$&#40;&quot;---GetOS Test ---&quot;&#41;,MB_OK or MB_ICONASTERISK<br />	invoke ExitProcess,NULL<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br /><br />end start<br /><br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />&#58;make<br />set name=getOS_1<br /><br />    \masm32\bin\ml /c /coff %name%.bat<br />    \masm32\bin\Link /subsystem&#58;windows %name%.obj<br /><br />    if exist *.bak del *.bak<br />    if exist *.obj del *.obj<br />    echo.<br /></code></pre></div>
    <div class="meta">Posted on 2005-01-04 08:20:25 by dcskm4200</div>
   </div>
   <div class="post" id="post-155228">
    <div class="subject"><a href="#post-155228">Get OS version</a></div>
    <div class="body">You could just use GetVersionEx. Windows xp will be Windows NT 5.1</div>
    <div class="meta">Posted on 2005-01-04 08:31:07 by QuantumMatrix1024</div>
   </div>
   <div class="post" id="post-155229">
    <div class="subject"><a href="#post-155229">Get OS version</a></div>
    <div class="body">Thanks you replying.<br /><br />Thomas Kruse said:<br /><div class="quote">Detecting operating systems without Microsoft Advanced Programming Interface.<br /><br />Today nearly all programmers use the Advanced Programming Interface (API) to receive information?s about given system values. By using this API?s, we don?t have to take care which operating system is currently available. But sometimes it might be needful to avoid the usage of such API?s. This situation is given during development of software<br />protections in order to avoid importing functions which - eventually - will point a reverse engineer to a solution.</div><br /><br />i have thought he is right at all time.<br /><br />regards</div>
    <div class="meta">Posted on 2005-01-04 08:50:08 by dcskm4200</div>
   </div>
   <div class="post" id="post-155232">
    <div class="subject"><a href="#post-155232">Get OS version</a></div>
    <div class="body">&quot;Advanced Programming Interface&quot;... hehe. The first A is for 'Application'.<br /><br />The problem with Kruse's approach is that he is accessing some *very* version-dependant structures, and there's no guarantee whatsoever these structures won't change... theoretically, even a service pack or hotfix could change things around.</div>
    <div class="meta">Posted on 2005-01-04 10:44:22 by f0dder</div>
   </div>
   <div class="post" id="post-155237">
    <div class="subject"><a href="#post-155237">Get OS version</a></div>
    <div class="body">That man shouldn't be allowed to come near a computer again, and his magazines should be burnt.<br /><br />What do you need the OS version for in your protection scheme?</div>
    <div class="meta">Posted on 2005-01-04 12:37:29 by Sephiroth3</div>
   </div>
   <div class="post" id="post-155238">
    <div class="subject"><a href="#post-155238">Get OS version</a></div>
    <div class="body">Just in case you were curious, here's how you'd get the OS version using the API:<br /><br /><pre><code><br />  LOCAL versionInfo&#58;OSVERSIONINFO<br /><br />  ...<br /><br />  ; Get the operating system version<br />  mov       versionInfo.dwOSVersionInfoSize, SIZEOF OSVERSIONINFO<br />  invoke    GetVersionEx, ADDR versionInfo<br />  .IF     versionInfo.dwMajorVersion == 5<br />    .IF     versionInfo.dwMinorVersion == 2<br />      ; Windows Server 2003<br />    .ELSEIF versionInfo.dwMinorVersion == 1<br />      ; Windows XP<br />    .ELSEIF versionInfo.dwMinorVersion == 0<br />      ; Windows 2000<br />    .ENDIF<br />  .ELSEIF versionInfo.dwMajorVersion == 4<br />    .IF     versionInfo.dwMinorVersion == 0<br />      .IF     versionInfo.dwPlatformId == VER_PLATFORM_WIN32_NT<br />        ; Windows NT 4.0<br />      .ELSEIF versionInfo.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS<br />        ; Windows 95<br />      .ENDIF<br />    .ELSEIF versionInfo.dwMinorVersion == 90<br />      ; Windows ME<br />    .ELSEIF versionInfo.dwMinorVersion == 10<br />      ; Windows 98<br />    .ENDIF<br />  .ELSEIF versionInfo.dwMajorVersion == 3<br />    .IF     versionInfo.dwMinorVersion == 51<br />      ; Windows NT 3.51<br />    .ENDIF<br />  .ELSE<br />    ; Windows 3.1 or earlier<br />  .ENDIF<br /><br />  ; Service pack is a string at &quot;ADDR &#91;versionInfo+20&#93;&quot;<br />  ; Build number is in &quot;versionInfo.dwBuildNumber&quot;<br /></code></pre><br /><br />Spara</div>
    <div class="meta">Posted on 2005-01-04 12:44:08 by Sparafusile</div>
   </div>
   <div class="post" id="post-155250">
    <div class="subject"><a href="#post-155250">Get OS version</a></div>
    <div class="body">Thanks all who replyed my question.<br />;============================<br />f0dder,<br />today hook_technology has been used generally. we can't guarantee really our system is controled by pure windows operation. <br />which proc will need to change some *very* version-dependant structures? i don't ensure:  if the structures has been changed, my windows operation isn't  natural.<br />;===================================<br />Sephiroth3,<br />it sounds you don't like him. i'm a newbie. i tested the approach for learning.<br />;===================================<br />Sparafusile,<br />thanks you very much.<br />I don' know there has a another way without using the API CALL.<br /><br /><br />best regards.</div>
    <div class="meta">Posted on 2005-01-04 19:40:03 by dcskm4200</div>
   </div>
   <div class="post" id="post-155251">
    <div class="subject"><a href="#post-155251">Get OS version</a></div>
    <div class="body"><div class="quote"><br />today hook_technology has been used generally. we can't guarantee really our system is controled by pure windows operation.<br /></div><br />It's the old cat-and-mouse game... which always ends up hurting end-users. In case you're worried about hooking, well... what stops an evil-doer putting a breakpoint on access to the PEB instead of GetVersion*? etc etc etc.<br /><br /><div class="quote"><br />which proc will need to change some *very* version-dependant structures? i don't ensure: if the structures has been changed, my windows operation isn't natural.<br /></div><br />What I'm saying is that Kruse's code accesses (reads) some undocumented windows structures. While it might never happen, you have no guarantee that microsoft will not change the layout of some of these structures.<br /><br />Better to stick with the API, especially for something like getting the windows version.</div>
    <div class="meta">Posted on 2005-01-04 19:50:18 by f0dder</div>
   </div>
   <div class="post" id="post-155259">
    <div class="subject"><a href="#post-155259">Get OS version</a></div>
    <div class="body">f0dder,<br />Thanks you again.<br /><br />1.  if i wasn't wrong, your meaning is : Until now microsoft didn't change the structures.<br />2. with using Thomas Kruse's the approach, we can estimate that our system is normal.   meaning: if calling OS_GetOS proc return parameter is right, then our system is normal;  if calling OS_GetOS proc return parameter is error, then our system maybe some problems.  <strong>is it right?</strong><br /><br /><br />best regards</div>
    <div class="meta">Posted on 2005-01-05 00:21:25 by dcskm4200</div>
   </div>
   <div class="post" id="post-155274">
    <div class="subject"><a href="#post-155274">Get OS version</a></div>
    <div class="body">Advanced Programming Interface (API)??? haha :)<br />Where did he get that from?</div>
    <div class="meta">Posted on 2005-01-05 07:10:29 by dev_zero</div>
   </div>
   <div class="post" id="post-155276">
    <div class="subject"><a href="#post-155276">Get OS version</a></div>
    <div class="body"><div class="quote"><br />1. if i wasn't wrong, your meaning is : Until now microsoft didn't change the structures. <br /></div><br />Microsoft <strong>have</strong>changed the structures - but only some parts of it, and appearantly not the location of major+minor version. But nothing stops them from doing it, as this is internal &amp; undocumented.<br /><br /><div class="quote"><br />2. with using Thomas Kruse's the approach, we can estimate that our system is normal. meaning: if calling OS_GetOS proc return parameter is right, then our system is normal; if calling OS_GetOS proc return parameter is error, then our system maybe some problems. is it right? <br /></div><br />Nope, why would it indicate that &quot;our system is normal&quot;?</div>
    <div class="meta">Posted on 2005-01-05 07:29:43 by f0dder</div>
   </div>
   <div class="post" id="post-155278">
    <div class="subject"><a href="#post-155278">Get OS version</a></div>
    <div class="body"><div class="quote"><br /><br />if calling OS_GetOS proc return parameter is error, then our system maybe some problems.  <strong>is it right?</strong><br /></div><br /><br />Not a 'problem' just a change.</div>
    <div class="meta">Posted on 2005-01-05 07:58:13 by QuantumMatrix1024</div>
   </div>
   <div class="post" id="post-155282">
    <div class="subject"><a href="#post-155282">Get OS version</a></div>
    <div class="body">dev_zero,<br />here is the last section of the paper written by Thomas Kruse.<br /><br /><div class="quote"> Conclusions<br />Resolving the operating system by using this technique is only one possibility to avoid the usage of Advanced Programming Interface functions. Other functions, for example GetCommandLine[1], IsDebuggerPresent[1] or named functions in this essay could be rewritten in the same way. In other words: the reverse engineer isn?t able to set breakpoints on API function calls, because they didn?t exist. And mixing different operating system solutions together makes life even harder for him.<br /><br />References<br />[1] Microsoft Corporation, Microsoft Developer Network, http://msdm.microsoft.com<br />[2] Yuschuk, O., Olly Debugger, http://home.t-online.de/home/ollydbg<br />[3] Hutchenson, S., MASM V8, http://www.masmforum.com<br /><br />Copyright c<br />2004 and published by the Assembly-Programming-Journal. Single print or electronic copies for personal use only are permitted. Reproduction and distribution without permission is prohibited.<br /></div><br />your means:<br />The approach of getting OS version got from you or others ? it isn't his researched result ?<br />;=====================================================================<br />f0dder,<br />you gave me a lot of information that i need. as a newbie, i can't  judge which way of getting OS version is better.<br />thanks thanks you again.<br /><br />if you let your proc to run on all windows platform, you must know which windows operation system is your Proc will be run. until now, i understand his approach isn't entiretiely right. <br /><br /><br />best regards.</div>
    <div class="meta">Posted on 2005-01-05 08:44:04 by dcskm4200</div>
   </div>
   <div class="post" id="post-155286">
    <div class="subject"><a href="#post-155286">Get OS version</a></div>
    <div class="body"><div class="quote">Nope, why would it indicate that &quot;our system is normal&quot;?</div><div class="quote">Not a 'problem' just a change.</div><br /><br />according to Jeremy Gordon's &lt;&lt;Win32 Exception handling for assembler programmers &gt;&gt;, i knew that the fs register is used by debug application, anti-debug application, virus application,or anti-virus application. most of normal application don't need to use the fs register. in my windows operation system, I only installed some debug software (softice, ollydbg), I didn't start up them. but I tested the OS_GetOS is error result. so i thought the structures has been changed. if microsoft didn't change, who changed the structures? i guessed virus maybe change the structures. (now, I knew my comprehending is wrong, because f0dder said that Microsoft have changed some parts of the structures.) <br /><br />best regards.</div>
    <div class="meta">Posted on 2005-01-05 10:02:18 by dcskm4200</div>
   </div>
   <div class="post" id="post-155289">
    <div class="subject"><a href="#post-155289">Re: Get OS version</a></div>
    <div class="body">hi<br />just a quick noob question ....   :) <br />what is that thing about TEB :<br /><pre><code><br />assume fs&#58;nothing<br />mov ebx,fs&#58;&#91;18h&#93;<br />mov eax,fs&#58;&#91;30h&#93;<br /><br />.if eax==7FFDF000h &amp;&amp; ebx==7FFDE000h <br /><br />mov ebx,&#91;eax+0A8h&#93; <br /></code></pre><br /><br />and if i mov ebx fs:[18h] it would be = to 7ffdf000h ?!?!?!??!<br />im very very very confused  :?  :?  :?</div>
    <div class="meta">Posted on 2005-01-05 12:18:42 by GR33d</div>
   </div>
   <div class="post" id="post-155298">
    <div class="subject"><a href="#post-155298">Get OS version</a></div>
    <div class="body">GR33d,<br /><br /><div class="quote">what is that thing about TEB, <br />and if i mov ebx fs:[18h] it would be = to 7ffdf000h ?!?!?!??! <br />im very very very confused <br /></div><br />here is the LINK for explaining .<br />http://www.assembly-journal.com/viewarticle.php?id=144&amp;layout=abstract<br /><br />regards.</div>
    <div class="meta">Posted on 2005-01-05 19:06:36 by dcskm4200</div>
   </div>
   <div class="post" id="post-155335">
    <div class="subject"><a href="#post-155335">oh</a></div>
    <div class="body">oh  :shock: <br /><br /><br />now i get it  :) <br /><br />thx !</div>
    <div class="meta">Posted on 2005-01-06 09:25:52 by GR33d</div>
   </div>
   <div class="post" id="post-155443">
    <div class="subject"><a href="#post-155443">Get OS version</a></div>
    <div class="body">Build number:<br /><br /><pre><code><br />osvi.dwBuildNumber &amp; 0xffff<br /></code></pre><br /><br />Evil. =)</div>
    <div class="meta">Posted on 2005-01-09 13:15:56 by evil__donkey</div>
   </div>
   <div class="post" id="post-155449">
    <div class="subject"><a href="#post-155449">Get OS version</a></div>
    <div class="body">hi, evil__donkey<br /><br /><strong>osvi.dwBuildNumber &amp; 0xffff </strong>what's means ?<br />how modify the code?<br /><br />regards.</div>
    <div class="meta">Posted on 2005-01-09 20:43:59 by dcskm4200</div>
   </div>
   <div class="post" id="post-155451">
    <div class="subject"><a href="#post-155451">Get OS version</a></div>
    <div class="body">This will output a string like &quot;Windows 2000 Service Pack 4&quot;<br /><br /><pre><code>DATA SECTION<br />	szOSVersionW		db	&quot;Windows&quot;,0<br />	szOSVersion0		db	&quot;%s %u.%u %s&quot;,0<br />	szOSVersion1		db	&quot;%s 95 %s&quot;,0<br />	szOSVersion2		db	&quot;%s 98 %s&quot;,0<br />	szOSVersion3		db	&quot;%s ME %s&quot;,0<br />	szOSVersion5		db	&quot;%s NT4 %s&quot;,0<br />	szOSVersion6		db	&quot;%s 2000 %s&quot;,0<br />	szOSVersion7		db	&quot;%s XP %s&quot;,0<br />	szOSVersion8		db	&quot;%s 2003 %s&quot;,0<br /><br />CODE SECTION<br /><br />GetWindowsString FRAME pOutString<br />	LOCAL osvi			&#58;OSVERSIONINFO<br />	LOCAL buffer&#91;256&#93;	&#58;B<br /><br />	invoke IsBadWritePtr,&#91;pOutString&#93;,1<br />	or eax,eax<br />	jz &gt;<br />		xor eax,eax<br />		dec eax<br />		ret<br />	&#58;<br /><br />	mov D&#91;osvi.dwOSVersionInfoSize&#93;,SIZEOF OSVERSIONINFO<br />	invoke GetVersionExA,ADDR osvi<br />	cmp D&#91;osvi.dwMajorVersion&#93;,4<br />	jne &gt;&gt;.XP2K<br />		cmp D&#91;osvi.dwMinorVersion&#93;,0<br />		jne &gt;<br />			cmp D&#91;osvi.dwPlatformId&#93;,VER_PLATFORM_WIN32_WINDOWS<br />			jne &gt;.NT4<br />				invoke wsprintfA,&#91;pOutString&#93;,offset szOSVersion1,offset szOSVersionW,\<br />					OFFSET osvi.szCSDVersion<br />				add esp,16<br />				jmp &gt;&gt;.OSVERSION<br />			.NT4<br />				invoke wsprintfA,&#91;pOutString&#93;,offset szOSVersion5,offset szOSVersionW,\<br />					OFFSET osvi.szCSDVersion<br />				add esp,16<br />				jmp &gt;&gt;.OSVERSION<br />		&#58;<br />		cmp D&#91;osvi.dwMinorVersion&#93;,10<br />		jne &gt;<br />			invoke wsprintfA,&#91;pOutString&#93;,offset szOSVersion2,offset szOSVersionW,\<br />				OFFSET osvi.szCSDVersion<br />			add esp,16<br />			jmp &gt;&gt;.OSVERSION<br />		&#58;<br />		cmp D&#91;osvi.dwMinorVersion&#93;,90<br />		jne &gt;<br />			invoke wsprintfA,&#91;pOutString&#93;,offset szOSVersion3,offset szOSVersionW,\<br />				OFFSET osvi.szCSDVersion<br />			add esp,16<br />			jmp &gt;&gt;.OSVERSION<br />		&#58;<br />	.XP2K<br />	cmp D&#91;osvi.dwMajorVersion&#93;,5<br />	jne &gt;&gt;.OTHER<br />		cmp D&#91;osvi.dwMinorVersion&#93;,0<br />		jne &gt;<br />			invoke wsprintfA,&#91;pOutString&#93;,offset szOSVersion6,offset szOSVersionW,\<br />				OFFSET osvi.szCSDVersion<br />			add esp,16<br />			jmp &gt;&gt;.OSVERSION<br />		&#58;<br />		cmp D&#91;osvi.dwMinorVersion&#93;,1<br />		jne &gt;<br />			invoke wsprintfA,&#91;pOutString&#93;,offset szOSVersion7,offset szOSVersionW,\<br />				OFFSET osvi.szCSDVersion<br />			add esp,16<br />			jmp &gt;.OSVERSION<br />		&#58;<br />		cmp D&#91;osvi.dwMinorVersion&#93;,2<br />		jne &gt;<br />			invoke wsprintfA,&#91;pOutString&#93;,offset szOSVersion8,offset szOSVersionW,\<br />				OFFSET osvi.szCSDVersion<br />			add esp,16<br />			jmp &gt;.OSVERSION<br />		&#58;<br />	jmp &gt;.OSVERSION<br />	.OTHER<br />	; Other<br />		invoke wsprintfA,&#91;pOutString&#93;,offset szOSVersion0,offset szOSVersionW,\<br />			&#91;osvi.dwMajorVersion&#93;,&#91;osvi.dwMinorVersion&#93;,OFFSET osvi.szCSDVersion<br />		add esp,24<br />	.OSVERSION<br /><br />	RET<br />ENDF</code></pre></div>
    <div class="meta">Posted on 2005-01-09 21:32:23 by donkey</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=20278&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=20278&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="20278" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=20278&amp;page=2">&gt;</a><a href="../?id=20278&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>