<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>cant get GetDeviceCaps workk in d3d9 - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25011" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25011">cant get GetDeviceCaps workk in d3d9</a></p>
   <div class="post" id="post-183145">
    <div class="subject"><a href="#post-183145">cant get GetDeviceCaps workk in d3d9</a></div>
    <div class="body">trying to make a minimal skeleton, no hardware rendering needs to take place, only need to get d3d9 caps before starting software textureprocessing/generation to file, to get max texturesize on system etc, max aviable memory for textures<br /><br /><pre><code>caps&nbsp; &nbsp; D3DCAPS9 &lt;0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0,0,0,0,0,0,0,0,0&gt;<br /></code></pre><br /><br />should this be pcall, icall, invoke or what?<br /><pre><code>pcall lpD3D.GetDeviceCaps,D3DADAPTER_DEFAULT,D3DDEVTYPE_HAL,ADDR caps<br /></code></pre><br />want help with this, after that I will share a skeleton, with a main sourcefile, calling a example proc in separate .inc file for anyone to be able to write their own procedural texturegeneration or modify existing textures for example downsize existing textures for lower end systems<br /><br />for example homers earlier blend together different textures, could be made to file and scaled/smoothed to better hardware<br /></div>
    <div class="meta">Posted on 2006-07-08 07:49:59 by daydreamer</div>
   </div>
   <div class="post" id="post-183150">
    <div class="subject"><a href="#post-183150">Re: cant get GetDeviceCaps workk in d3d9</a></div>
    <div class="body">If it&#39;s in ATC, it works here for me<br /><pre><code><br />set g_pD3D as IDirect3D9<br />set g_pd3dDevice as IDirect3DDevice9<br />....<br />....<br />mov g_pD3D,$invoke(Direct3DCreate9,D3D_SDK_VERSION)<br />pcall g_pD3D.GetDeviceCaps,D3DADAPTER_DEFAULT,D3DDEVTYPE_HAL,addr caps<br />print caps[4*22] ;MaxTextureWidth=2048<br /></code></pre><br /></div>
    <div class="meta">Posted on 2006-07-08 09:39:03 by Ultrano</div>
   </div>
   <div class="post" id="post-183156">
    <div class="subject"><a href="#post-183156">Re: cant get GetDeviceCaps workk in d3d9</a></div>
    <div class="body">its ATC<br />its not my lucky day<br />first its syntax error with caps D3D9 data, I define the struct but it complains its too complex<br /><br /></div>
    <div class="meta">Posted on 2006-07-08 13:28:00 by daydreamer</div>
   </div>
   <div class="post" id="post-183181">
    <div class="subject"><a href="#post-183181">Re: cant get GetDeviceCaps workk in d3d9</a></div>
    <div class="body">If you can&#39;t figurre it out, show me the following:<br />-Your D3DCAPS9 struct definition<br />-Your IDirect3D9 interface definition<br /><br />I&#39;ll compare them to mine and let you know what the issue is.<br /></div>
    <div class="meta">Posted on 2006-07-08 22:10:58 by Homer</div>
   </div>
   <div class="post" id="post-183187">
    <div class="subject"><a href="#post-183187">Re: cant get GetDeviceCaps workk in d3d9</a></div>
    <div class="body"><div class="quote"><br />If you can&#39;t figurre it out, show me the following:<br />-Your D3DCAPS9 struct definition<br />-Your IDirect3D9 interface definition<br /><br />I&#39;ll compare them to mine and let you know what the issue is.<br /><br /></div><br />I just define D3DCAPS9 struct with 69 dwords, as I saw in dx9 sdk<br />IDirect3D9 is from your older ATC/DX9 skeleton and already works with rendering and the other interfaces, I guess bug can be in includefile?</div>
    <div class="meta">Posted on 2006-07-08 23:02:32 by daydreamer</div>
   </div>
   <div class="post" id="post-183189">
    <div class="subject"><a href="#post-183189">Re: cant get GetDeviceCaps workk in d3d9</a></div>
    <div class="body">This struct appears twice within D3DCAPS9 <br /><pre><code><br />D3DVSHADERCAPS2_0 struct<br />&nbsp; Caps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; DynamicFlowControlDepth&nbsp;  dword&nbsp;  ?<br />&nbsp; NumTemps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; StaticFlowControlDepth&nbsp; &nbsp; dword&nbsp;  ?<br />D3DVSHADERCAPS2_0 ends<br /></code></pre><br /><br />Here&#39;s my D3DCAPS9 struct<br /><pre><code><br />D3DCAPS9 struct<br />; Device Info<br />&nbsp; DeviceType&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; AdapterOrdinal&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />; Caps from DX7 Draw<br />&nbsp; Caps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; Caps2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; Caps3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; PresentationIntervals&nbsp; &nbsp;  dword&nbsp;  ?<br />; Cursor Caps<br />&nbsp; CursorCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />; 3D Device Caps<br />&nbsp; DevCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; PrimitiveMiscCaps&nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; RasterCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; ZCmpCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; SrcBlendCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; DestBlendCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; AlphaCmpCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; ShadeCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; TextureCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; TextureFilterCaps&nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?&nbsp;  ;D3DPTFILTERCAPS for IDirect3DTexture9&#39;s<br />&nbsp; CubeTextureFilterCaps&nbsp; &nbsp;  dword&nbsp;  ?&nbsp;  ;D3DPTFILTERCAPS for IDirect3DCubeTexture9&#39;s<br />&nbsp; VolumeTextureFilterCaps&nbsp;  dword&nbsp;  ?&nbsp;  ;D3DPTFILTERCAPS for IDirect3DVolumeTexture9&#39;s<br />&nbsp; TextureAddressCaps&nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?&nbsp;  ;D3DPTADDRESSCAPS for IDirect3DTexture9&#39;s<br />&nbsp; VolumeTextureAddressCaps&nbsp; dword&nbsp;  ?&nbsp;  ;D3DPTADDRESSCAPS for IDirect3DVolumeTexture9&#39;s<br />&nbsp; LineCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?&nbsp;  ;D3DLINECAPS<br />&nbsp; MaxTextureWidth&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; MaxTextureHeight&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; MaxVolumeExtent&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; MaxTextureRepeat&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; MaxTextureAspectRatio&nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; MaxAnisotropy&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; MaxVertexW&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FLOAT&nbsp;  ?<br />&nbsp; GuardBandLeft&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  FLOAT&nbsp;  ?<br />&nbsp; GuardBandTop&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FLOAT&nbsp;  ?<br />&nbsp; GuardBandRight&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FLOAT&nbsp;  ?<br />&nbsp; GuardBandBottom&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  FLOAT&nbsp;  ?<br />&nbsp; ExtentsAdjust&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  FLOAT&nbsp;  ?<br />&nbsp; StencilCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; FVFCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; TextureOpCaps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; MaxTextureBlendStages&nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; MaxSimultaneousTextures&nbsp;  dword&nbsp;  ?<br />&nbsp; VertexProcessingCaps&nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; MaxActiveLights&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; MaxUserClipPlanes&nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; MaxVertexBlendMatrices&nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; MaxVertexBlendMatrixIndex dword&nbsp;  ?<br />&nbsp; MaxPointSize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FLOAT&nbsp;  ?<br />&nbsp; MaxPrimitiveCount&nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?&nbsp;  ;Max number of primitives per DrawPrimitive call<br />&nbsp; MaxVertexIndex&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; MaxStreams&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; MaxStreamStride&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?&nbsp;  ;Max stride for SetStreamSource<br />&nbsp; VertexShaderVersion&nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; MaxVertexShaderConst&nbsp; &nbsp; &nbsp; dword&nbsp;  ?&nbsp;  ;Number of vertex shader constant registers<br />&nbsp; PixelShaderVersion&nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; PixelShader1xMaxValue&nbsp; &nbsp;  FLOAT&nbsp;  ?&nbsp;  ;Max value storable in registers of ps.1.x shaders<br />; Here are the DX9 specific ones<br />&nbsp; DevCaps2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?<br />&nbsp; MaxNpatchTessellationLevel FLOAT&nbsp; ?<br />&nbsp; Reserved5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?<br />&nbsp; MasterAdapterOrdinal&nbsp; &nbsp; &nbsp; dword&nbsp;  ?&nbsp;  ;Ordinal of master adaptor for adapter group<br />&nbsp; AdapterOrdinalInGroup&nbsp; &nbsp;  dword&nbsp;  ?&nbsp;  ;Ordinal inside the adapter group<br />&nbsp; NumberOfAdaptersInGroup&nbsp;  dword&nbsp;  ?&nbsp;  ;Number of adapters in this adapter group (only if master)<br />&nbsp; DeclTypes&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dword&nbsp;  ?&nbsp;  ;Data types, supported in vertex declarations<br />&nbsp; NumSimultaneousRTs&nbsp; &nbsp; &nbsp; &nbsp; dword&nbsp;  ?&nbsp;  ;Will be at least 1<br />&nbsp; StretchRectFilterCaps&nbsp; &nbsp;  dword&nbsp;  ?&nbsp;  ;Filter caps supported by StretchRect<br />&nbsp; VS20Caps D3DVSHADERCAPS2_0 &lt;?&gt;<br />&nbsp; PS20Caps D3DPSHADERCAPS2_0 &lt;?&gt;<br />&nbsp; VertexTextureFilterCaps&nbsp;  dword&nbsp;  ?&nbsp;  ;D3DPTFILTERCAPS for IDirect3DTexture9&#39;s for texture, used in vertex shaders<br />&nbsp; MaxVShaderInstructionsExecuted&nbsp; &nbsp; dword&nbsp;  ?&nbsp;  ;Maximum number of vertex shader instructions that can be executed<br />&nbsp; MaxPShaderInstructionsExecuted&nbsp; &nbsp; dword&nbsp;  ?&nbsp;  ;Maximum number of pixel shader instructions that can be executed<br />&nbsp; MaxVertexShader30InstructionSlots dword&nbsp;  ?<br />&nbsp; MaxPixelShader30InstructionSlots&nbsp; dword&nbsp;  ?<br />D3DCAPS9 ends<br /></code></pre><br /><br />That should sort the problem out.<br />If not, we&#39;ll doublecheck the interface definition too, my ATC includes for DX9.0a had a few small bugs, my current ones are 9.0c<br /><br /></div>
    <div class="meta">Posted on 2006-07-08 23:24:05 by Homer</div>
   </div>
   <div class="post" id="post-183206">
    <div class="subject"><a href="#post-183206">Re: cant get GetDeviceCaps workk in d3d9</a></div>
    <div class="body">Remember to set the structure&#39;s size BEFORE calling GetCaps. In one of the topics here in this board I have explained this VERY THOROUGHLY, so feel free to check it out.</div>
    <div class="meta">Posted on 2006-07-09 02:39:22 by ti_mo_n</div>
   </div>
   <div class="post" id="post-183271">
    <div class="subject"><a href="#post-183271">Re: cant get GetDeviceCaps workk in d3d9</a></div>
    <div class="body">uhm, D3DCAPS9 and size? No, you needn&#39;t/can&#39;t set its size. I checked the DX9 SDK examples, no such thing needed/possible. Since the IDirect3D9 class, that I have here, works perfectly, I figured I should share it again (see attachment). <br /><br />Parameters&#39; number isn&#39;t defined (lazy me), and D3DCAPS9 isn&#39;t defined either, but you can either define them yourself (only if necessary), or just have the documentation/headers as a reference while coding (which you have to do anyway). <br /><br />Btw, Homer, I finally understood the beauty of Matrix4x4 and Quaternions :) ... I had to make a good camera - and mathematically it was impossible without matrices. But still, I use the shortcut of Vec6 (vec3 for position, vec3 for ZYX rotation)&nbsp; in the initial stage of computing world-coordinates of parented meshes. (it&#39;s still a bit faster - and I damn need any extra cycles, since I&#39;m already pushing near the theoretical limit of these PDA devices :( )<br /><br />Btw, I have a (rather) complete importer of scene+animation data of .lws (lightwave scene) files - I can share to anyone interested via email :) . </div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=1825" target="_blank">d3d9.inc</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2006-07-09 12:11:33 by Ultrano</div>
   </div>
   <div class="post" id="post-183319">
    <div class="subject"><a href="#post-183319">Re: cant get GetDeviceCaps workk in d3d9</a></div>
    <div class="body"><div class="quote"><br />uhm, D3DCAPS9 and size? No, you needn&#39;t/can&#39;t set its size. I checked the DX9 SDK examples, no such thing needed/possible.</div><br />You&#39;re right. Let&#39;s just say that I was too sleepy :mrgreen:</div>
    <div class="meta">Posted on 2006-07-10 06:14:03 by ti_mo_n</div>
   </div>
   <div class="post" id="post-183327">
    <div class="subject"><a href="#post-183327">Re: cant get GetDeviceCaps workk in d3d9</a></div>
    <div class="body">I myself have a tonne of such posts, np ;)</div>
    <div class="meta">Posted on 2006-07-10 09:02:31 by Ultrano</div>
   </div>
  </div>
 </body>
</html>