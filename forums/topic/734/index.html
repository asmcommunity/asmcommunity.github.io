<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>PIPE problem error during process creation help .. - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=734" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=734">PIPE problem error during process creation help ..</a></p>
   <div class="post" id="post-4383">
    <div class="subject"><a href="#post-4383">PIPE problem error during process creation help ..</a></div>
    <div class="body">I try to code the pipe example from ICZelion in NASM  and got a error in process creation <br />if any one can say some thing... <br /><br />here it is:<br /><br />;- MUSIC WHILE CODING Mundo Civilizado ARTO LINDSAY -<br />;---------------------------------------------------------<br />;   NaGoA     RAD IDE         <a target="_blank" href="http://visual-assembler.pt.vu">http://visual-assembler.pt.vu</a><br />;---------------------------------------------------------<br /><br /><br />extern LoadIconA<br />extern LoadCursorA<br />extern RegisterClassExA<br />extern GetMessageA<br />extern TranslateMessage<br />extern DispatchMessageA<br />extern CreateWindowExA<br />extern MoveWindow<br />extern CreatePipe<br />extern MessageBoxA<br />extern CreateProcessA<br />extern SendMessageA<br />extern CloseHandle<br />extern PostQuitMessage<br />extern DefWindowProcA<br />extern GetStartupInfoA<br />extern ReadFile<br />extern RtlZeroMemory<br />extern ShowWindow<br />extern GetModuleHandleA<br />extern ExitProcess<br />extern SetTextColor<br />extern SetBkColor<br />extern GetStockObject<br /><br />%include &quot;\lab\vasm\inc\win32n.inc&quot;<br />%include &quot;\lab\vasm\inc\nagoa.inc&quot;<br /><br /><br /><br />Instance	                dd 0<br />WndClassEx		resb	WNDCLASSEX_size<br />Atom  			dd 0<br />WindowName		db	&quot;Nasm PIPE example&quot;, 0<br />WindowHandle		dd 0<br />Msg	         		resb	MSG_size<br />sat                            resb SECURITY_ATTRIBUTES_size<br />IDR_MAINMENU	equ 101<br />IDM_ASSEMBLE	equ 40001<br />ClassName 	       db &quot;PIPEnasm&quot;,0<br />AppName  	               db &quot;One-way Pipe Example thanks Iczelion! :)&quot;,0<br />EditClass	               db &quot;EDIT&quot;,0<br />CreatePipeError        db &quot;Error during pipe creation&quot;,0<br />CreateProcessError   db &quot;Error during process creation&quot;,0<br />CommandLine          db &quot;c:\lab\vasm\gorc  pipe.rc&quot;,0<br /><br />hwndEdit	              dd 0<br />wc                           resb  WNDCLASSEX_size<br />hwnd                       dd 0<br />rect                         resb RECT_size<br />hRead                     dd 0<br />hWrite                     dd 0<br />startupinfo               resb STARTUPINFO_size<br />pinfo                        resb PROCESS_INFORMATION_size<br />buffer                      resd   1024<br />bytesRead               dd 0<br /><br /><br /><br /><br />;---------------  THE CODE ------------------------------------------------<br /><br /><br />..start:<br />	call GetModuleHandleA, 0<br />	mov dword , eax<br /><br />	<br /><br />	call WinMain, , NULL, NULL, SW_SHOWDEFAULT<br /><br />	call ExitProcess, eax<br /><br /><br /><br />WinMain:<br /><br /><br /><br />%define	hInstance	        ebp+8<br />%define   hPrevInstace	ebp+12<br />%define	lpCmdLine	        ebp+16<br />%define	nCmdShow	ebp+20<br /><br /><br />enter 0, 0  ;clear the stack reset <br /><br />; fill values in members of wc  that we give the name of WndClassEx.<br />;it?s how it will be our window load icon?s cursor type of window etc..<br />;============================================<br /><br />	mov dword , WNDCLASSEX_size<br />	mov dword ,  CS_HREDRAW + CS_VREDRAW<br />	mov dword , WindowProc<br />	mov dword , 0 <br />	mov dword , 0 <br />	mov eax, dword <br />	mov dword , eax<br /><br />	call LoadIconA, NULL, IDI_APPLICATION<br />	mov dword , eax<br />	mov dword , eax<br /><br />	call LoadCursorA, NULL, IDC_ARROW<br />	mov dword , eax<br /><br />	mov dword , COLOR_APPWORKSPACE<br />	mov dword ,IDR_MAINMENU<br />	mov dword , ClassName<br />        call LoadIconA,NULL,IDI_APPLICATION<br />	mov   dword ,eax<br />	mov   dword ,0<br />	call LoadCursorA,NULL,IDC_ARROW<br />	mov   dword ,eax    <br />        call RegisterClassExA, WndClassEx<br />	test eax, eax<br />	jne .DoAndShow<br />	jmp .erro<br /><br /><br /><br /> .DoAndShow:<br />	mov dword , eax<br />        call CreateWindowExA,WS_EX_CLIENTEDGE,,AppName,WS_OVERLAPPEDWINDOW+WS_VISIBLE,CW_USEDEFAULT,CW_USEDEFAULT,400,200,NULL,NULL,,NULL<br /><br /><br />	<br />        test eax, eax<br />	je near .erro<br />        mov dword , eax<br />	call ShowWindow, , <br /><br /><br /><br /><br /><br />; Loop Messages in order to get all of them..<br />;============================<br />.Messageloop<br />        call GetMessageA, Msg, NULL, 0, 0<br /><br />	test eax, eax<br />	je .Fim<br /><br />	cmp eax, -1<br />	je .erro<br /><br />	call TranslateMessage, Msg<br />	call DispatchMessageA, Msg<br /><br />	jmp .Messageloop<br /><br />.Fim:<br />	mov eax, dword <br /><br />	leave<br />	ret 16<br />.erro<br />        xor eax, eax<br /><br />	leave<br />	ret 16<br /><br /><br />WindowProc:<br />;===============================================<br />;here the messages that are inputed by the user are processed , did he clicked button x ....<br />;*****************************************************<br />;*	WindowProc(hwnd, uMsg, wParam, lParam);		                         *<br />;*****************************************************<br />%define	hwnd 	ebp+8       ;it?s the handle of  our application  an aplication as a instance and a handle<br />%define	uMsg	        ebp+12   <br />%define   wParam	ebp+16     <br />%define   lParam	ebp+20<br /><br /><br />	enter 0, 0<br /><br />	mov eax, dword <br /><br />	cmp eax, WM_DESTROY<br />	je near .Destroy<br />	cmp eax, WM_CREATE<br />        je near .Create<br />	cmp eax, WM_COMMAND<br />	je near .Command<br />        cmp eax,WM_SIZE<br />        je .Size<br />        cmp eax,WM_CTLCOLOREDIT<br />        je .ColorEdit<br />        <br /><br /><br /><br />.Defaut:<br />	call DefWindowProcA, , , , <br />   <br />	leave<br />	ret 16<br /><br />.Size<br />       mov edx,<br />       mov ecx,edx<br />       shr ecx,16<br />       and edx,0FFFFh<br />       call MoveWindow,,0,0,edx,ecx,FALSE<br /> <br />	leave<br />	ret 16<br /><br />.ColorEdit<br />       call SetTextColor,,Yellow<br />       call SetBkColor,,Black<br />       call GetStockObject,BLACK_BRUSH<br />     <br />	leave<br />	ret 16<br /><br />;==================================<br />;Create here your front hend of your aplication!!  Make a button a combobox etc..<br />;==================================<br />.Create<br /><br />call CreateWindowExA,NULL,EditClass,NULL,WS_CHILD+WS_VISIBLE+ES_MULTILINE+ES_AUTOHSCROLL+ES_AUTOVSCROLL ,0,0,0,0,,NULL,,NULL<br />mov ,eax<br /><br /><br /><br /><br />xor eax, eax<br />leave<br />ret 16<br /><br />;=============================<br />;-------------------------wmcommand start <br />;=============================<br />.Command:<br /><br />cmp dword ,0                 <br />jne near .goOUT<br />mov eax, dword 	 <br />cmp ax,IDM_ASSEMBLE	<br />jne near .goOUT<br />mov dword ,SECURITY_ATTRIBUTES_size<br />mov dword ,NULL<br />mov dword ,TRUE<br /><br />call CreatePipe,hRead,hWrite,sat,NULL<br />test  eax,eax<br />jnz .gostartupinfo<br />call MessageBoxA,,CreatePipeError, AppName,MB_ICONERROR + MB_OK<br />jmp .goOUT<br />.gostartupinfo<br />mov dword ,STARTUPINFO_size<br />call GetStartupInfoA,startupinfo<br />mov eax,hWrite<br />mov dword ,eax<br />mov dword ,eax<br />mov dword ,STARTF_USESHOWWINDOW+STARTF_USESTDHANDLES<br />mov dword ,SW_HIDE<br /><br />;------------------------------------------<br />; Create process<br />;------------------------------------------<br />call CreateProcessA,NULL,CommandLine,NULL,NULL,TRUE,NULL,NULL,NULL, startupinfo,pinfo<br />test ax,0<br />jnz .go2<br />call MessageBoxA,,CreateProcessError,AppName,MB_ICONERROR+MB_OK<br />jmp .goCloseHandle<br />.go2<br />call CloseHandle,hWrite<br />.goo1<br />call RtlZeroMemory,buffer,1024<br />call ReadFile,hRead,buffer,1023,bytesRead,NULL<br />test ax,0<br />jnz .go3<br />jmp .goCloseHandle<br />.go3<br />call SendMessageA,,EM_SETSEL,-1,0<br />call SendMessageA,,EM_REPLACESEL,FALSE,buffer<br />jmp .goo1	<br />.goCloseHandle			<br />call CloseHandle,hRead<br />jmp .goOUT<br /><br />.goOUT              <br />        xor eax, eax<br />	leave<br />	ret 16<br /><br /><br />;===========================<br />;--------------------- wmcommand   end<br />;===========================<br /><br />.Destroy<br /><br />        call PostQuitMessage, 0	<br /><br />        xor eax, eax<br />	leave<br />	ret 16</div>
    <div class="meta">Posted on 2001-08-21 22:43:31 by Nguga</div>
   </div>
  </div>
 </body>
</html>