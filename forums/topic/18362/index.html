<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Common (simple) techniques to reduce EXE size - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=18362" />
    <link rel="next" href="../?id=18362&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=18362">Common (simple) techniques to reduce EXE size</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=18362&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=18362&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="18362" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=18362&amp;page=2">&gt;</a><a href="../?id=18362&amp;page=2">&raquo;</a></form>   <div class="post" id="post-142292">
    <div class="subject"><a href="#post-142292">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">I have a 1.5K 'Hello World!' program (MASM), how could I get it smaller, without hex editing etc. With pure, code, assembler options, linker options etc. Keeping it an EXE. I want to use the same/similar methods for larger projects.<pre><code>.386<br />.MODEL flat, stdcall<br />OPTION casemap &#58;none<br /><br />INCLUDE windows.inc<br /><br />INCLUDE user32.inc<br />INCLUDE kernel32.inc<br /><br />INCLUDELIB user32.lib<br />INCLUDELIB kernel32.lib<br /><br />.CONST<br />  Caption db &quot;Hello World!&quot;, 0<br /><br />.CODE<br /><br />Start&#58;<br />  INVOKE MessageBox, NULL, addr Caption, NULL, NULL<br />  INVOKE ExitProcess, 0<br />END Start</code></pre></div>
    <div class="meta">Posted on 2004-05-28 02:21:23 by SubEvil</div>
   </div>
   <div class="post" id="post-142299">
    <div class="subject"><a href="#post-142299">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">Typical methods to reduce EXE size:<br /><br />i) Merge sections<br />ii) Use smaller DOS stub with MS link<br /><br /><a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?postid=112309.msg112309">http://www.asmcommunity.net/board/showthread.php?postid=112309.msg112309</a></div>
    <div class="meta">Posted on 2004-05-28 05:03:40 by Vortex</div>
   </div>
   <div class="post" id="post-142328">
    <div class="subject"><a href="#post-142328">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">Or just use FASM :grin: without linker... ;)</div>
    <div class="meta">Posted on 2004-05-28 14:28:44 by Tommy</div>
   </div>
   <div class="post" id="post-143080">
    <div class="subject"><a href="#post-143080">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body"><div class="quote"><br />Or just use FASM :grin: without linker... ;) </div><br /><br />nasm is much more flexible :)</div>
    <div class="meta">Posted on 2004-06-07 00:41:37 by Drocon</div>
   </div>
   <div class="post" id="post-143099">
    <div class="subject"><a href="#post-143099">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">Can you describe a little more about flexibility?</div>
    <div class="meta">Posted on 2004-06-07 04:47:44 by Vortex</div>
   </div>
   <div class="post" id="post-143129">
    <div class="subject"><a href="#post-143129">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body"><div class="quote"><br />Can you describe a little more about flexibility? </div><br /><br />i guess no reserved symbols, or bunk restrictions, it's just WYSIWYG sort of thing.<br />not to say FASM is bad or anything, maybe i'm just not used to it. :)</div>
    <div class="meta">Posted on 2004-06-07 12:48:06 by Drocon</div>
   </div>
   <div class="post" id="post-143152">
    <div class="subject"><a href="#post-143152">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">Even in VC6 you can easily do 1-2 KB Exe Files, if you set the right compiler options. I've never been able to get comparably small files with other compiles, such as GCC, Borland or when using MFC (= the devil). And code bloat is one thing I really hate. (Another hint: search for libctiny.lib)<br /><br />This is a (surely not perfect) example of a 1 KB exe files done with VC6.<br /><br /><br /><pre><code><br />#include &lt;windows.h&gt;<br />#include &lt;string.h&gt;       // strcat&#40;&#41;<br /><br />#pragma comment&#40;linker,&quot;/ignore&#58;4078&quot;&#41;<br />#pragma comment&#40;linker,&quot;/merge&#58;.text=.data&quot;&#41;<br />#pragma comment&#40;linker,&quot;/merge&#58;.rdata=.data&quot;&#41;<br />#pragma comment&#40;linker,&quot;/filealign&#58;512&quot;&#41;<br />#pragma comment&#40;linker,&quot;/ENTRY&#58;entry&quot;&#41;<br /><br />void entry&#40;&#41;<br />&#123;<br /><br />  OSVERSIONINFO lpVInfo;<br />  lpVInfo.dwOSVersionInfoSize =  sizeof&#40;OSVERSIONINFO&#41;;<br /><br />  GetVersionEx&#40;&amp;lpVInfo&#41;;<br /><br />  char *ver;<br /><br />  if&#40;lpVInfo.dwPlatformId ==  VER_PLATFORM_WIN32_NT&#41;<br /><br />    if&#40;lpVInfo.dwMajorVersion &lt; 5&#41;<br />      ver = &quot;NT&quot;;<br />    else<br />    &#123;<br />    if&#40;lpVInfo.dwMinorVersion &lt; 1&#41;<br />      ver = &quot;2000&quot;;<br />    else if&#40;lpVInfo.dwMinorVersion &lt; 2&#41;<br />      ver = &quot;XP&quot;;<br />    else<br />      ver = &quot;.NET Server&quot;;<br />    &#125;<br /><br />  else<br /><br />    if&#40;!lpVInfo.dwMinorVersion&#41;<br />      ver = &quot;95&quot;;<br />    else if&#40;lpVInfo.dwMinorVersion == 90&#41;<br />      ver = &quot;ME&quot;;<br />    else<br />      ver = &quot;98&quot;;<br /><br /> // &lt;insert better code here&gt;<br /><br />  MessageBox&#40;NULL, text, &quot;Info&#58;&quot;, MB_ICONINFORMATION&#41;;<br />  ExitProcess&#40;0&#41;;<br /><br />&#125;<br /></code></pre><br /><br /><br /><br />You can get your hello world prog down to 552 bytes, if you stuff the code / string data into the pe header or you could get somewhere around 600, if you put .code and .data into 1 section starting at 200h. Just do the whole header in NASM.<br /><br /><br />Hope this helped<br /><br /><br /><br />edit: fodder: Corrected.</div>
    <div class="meta">Posted on 2004-06-07 17:49:38 by pmpch</div>
   </div>
   <div class="post" id="post-143155">
    <div class="subject"><a href="#post-143155">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">Yay, another world's smallest messagebox... anyway, you shouldn't call your entrypoint &quot;main&quot; when you don't use regular libc, as it's bad karma to have &quot;void main&quot; - use &quot;entry&quot; or whatever. And have a look at Jibz' wcrt, <a target="_blank" href="www.ibsensoftware.com">www.ibsensoftware.com</a></div>
    <div class="meta">Posted on 2004-06-07 18:06:52 by f0dder</div>
   </div>
   <div class="post" id="post-143162">
    <div class="subject"><a href="#post-143162">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body"><pre><code><br />  char *text = &quot;Your operating system has been identified as... Windows &quot;;<br />  char *retp = strcat&#40;text, ver&#41;;<br /></code></pre><br />Please tell me I didn't just see this...</div>
    <div class="meta">Posted on 2004-06-07 19:18:32 by death</div>
   </div>
   <div class="post" id="post-143165">
    <div class="subject"><a href="#post-143165">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body"><div class="quote"><em>Originally posted by death </em><br /><pre><code><br />  char *text = &quot;Your operating system has been identified as... Windows &quot;;<br />  char *retp = strcat&#40;text, ver&#41;;<br /></code></pre><br />Please tell me I didn't just see this... </div><br /><br />You did, what's wrong with it?<br />_CRTIMP char *  __cdecl strcat(char *, const char *);<br /><br /><br /><div class="quote"><em>Originally posted by f0dder </em><br />And have a look at Jibz' wcrt, <a target="_blank" href="www.ibsensoftware.com">www.ibsensoftware.com</a></div><br /><br />It's quite new, I didn't visit his page for a while. Tnx.</div>
    <div class="meta">Posted on 2004-06-07 20:23:16 by pmpch</div>
   </div>
   <div class="post" id="post-143188">
    <div class="subject"><a href="#post-143188">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body"><div class="quote">You did, what's wrong with it?</div><br />The main thing that's wrong with it, is that strcat just appends one string to another, which means the target string should be large enough for both. The string <em>text</em> points to is not, so the call to strcat will overwrite whatever data is after the string.<br /><br />The second, somewhat more subtle, problem is that modifying a string constant is undefined in C. A string like the one <em>text</em> points to can be placed in the const segment, which could result in an access violation. Also string pooling could give you some interesting problems if your did something like that in a larger program.</div>
    <div class="meta">Posted on 2004-06-08 02:30:57 by Jibz</div>
   </div>
   <div class="post" id="post-143196">
    <div class="subject"><a href="#post-143196">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">Jibz is of course correct, and there is a third problem with it.<br />The CRT startup code is there for a reason, and if it is not being run, don't expect the CRT functions to work. Just because strcat() worked doesn't mean it will work in the future, and other functions certainly won't work now.</div>
    <div class="meta">Posted on 2004-06-08 05:25:11 by death</div>
   </div>
   <div class="post" id="post-143209">
    <div class="subject"><a href="#post-143209">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">Ok, I get the point. :grin:<br />What would be a good way to avoid those 3 problems?</div>
    <div class="meta">Posted on 2004-06-08 10:28:52 by pmpch</div>
   </div>
   <div class="post" id="post-143215">
    <div class="subject"><a href="#post-143215">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">pmpch,<br /><br />You wrote:<br /><br />&gt;You can get your hello world prog down to 552 bytes<br /><br />Don't expect that this prog will run on every version of windows</div>
    <div class="meta">Posted on 2004-06-08 11:36:12 by Vortex</div>
   </div>
   <div class="post" id="post-143227">
    <div class="subject"><a href="#post-143227">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body"><div class="quote"><br />What would be a good way to avoid those 3 problems? </div><br />Allocate an array big enough to have both 'text' and 'ver' strings concatenated, use lstrcpy()/lstrcat().</div>
    <div class="meta">Posted on 2004-06-08 13:25:12 by death</div>
   </div>
   <div class="post" id="post-143240">
    <div class="subject"><a href="#post-143240">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body"><div class="quote"><br />pmpch,<br />You wrote:<br />&gt;You can get your hello world prog down to 552 bytes<br />Don't expect that this prog will run on every version of windows </div><br /><br />It has run on every system so far, including Dos, Win95, 98, Me, 2000, Xp (SP0+1). I haven't tested it on NT. It has worked on 20 computers.<br />Is there a reason it shouldn't work? Alignment 512/1024 should work fine, and most of the header is unused. However, feel free to prove otherwise.</div>
    <div class="meta">Posted on 2004-06-08 15:57:16 by pmpch</div>
   </div>
   <div class="post" id="post-143266">
    <div class="subject"><a href="#post-143266">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">attached is an 753 byte uptime utility, in nasm, via a more traditional technique.<br />a messagebox alone can be as little as 550ish bytes. i've seen other exes merging portions of the PE as space for code/data. i believe a win32 pe hack for small exes <em>is</em> possible.</div>
    <div class="meta">Posted on 2004-06-09 00:19:29 by Drocon</div>
   </div>
   <div class="post" id="post-143278">
    <div class="subject"><a href="#post-143278">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">pmpch,<br /><br />Possibly, your small example worked fine but it's better to follow the PE specifications. :)</div>
    <div class="meta">Posted on 2004-06-09 04:55:11 by Vortex</div>
   </div>
   <div class="post" id="post-143284">
    <div class="subject"><a href="#post-143284">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">@Vortex: Of course for any distrubuted/commercial exe it is good to follow the PE specs.<br />The files will most likely need 32k on disk anyway :grin:<br /><br />If the specs are ignored you can get down to<br /><br />552 - all versions<br />2xx - NT &amp; 2000 (could possibly be lower)<br />157 - XP (with 1 correct import, doubt theres enough room at 133 for this)<br />97 - XP (only version specific XP, direct func call, massive overlays, but fun :alright: )<br /><br />These, as Vortex said, are unsafe, but can be used for demos and stuff like that. (Not commercial)<br /><br /><br /><strong>Here the NASM source for the 552 byte prog (1 import).</strong><br /><br /><pre><code><br />&#91;size=9&#93;IMAGEBASE    EQU 400000h<br />SECTIONALIGN EQU 4096       ; 4096/512 works for every<br />FILEALIGN    EQU 512        ; 32-bit Windows<br /><br />UNUSED       EQU 0<br /><br /><br />; ####################################################<br />;                     H E A D E R<br />; ####################################################<br /><br /><br />; +++++++++++++<br />   DOS_HEADER&#58;<br />; +++++++++++++<br /><br />e_magic        DW 'MZ'       ; &#91;@00h&#93;<br /><br />e_cblp         DB 0          ; &#91;@02h&#93;<br />               DB 0<br />e_cp           DB 1          ; total number of 512-byte pages<br />               DB 0          ; &#40;need only for dosstub&#41;<br />e_crlc         DB 0<br />               DB 0<br />e_cparhdr      DB 0<br />               DB 0<br />e_minalloc     DB 0<br />               DB 0<br />e_maxalloc     DB 0<br />               DB 0<br />e_ss           DB 0<br />               DB 0<br /><br /><br />e_sp           DB 0          ; initial SP, &#40;for dosstub&#41; &#91;@10h&#93;<br />               DB 0<br />e_csum         DB 0<br />               DB 0<br />e_ip           DB 0<br />               DB 0<br />e_cs           DB 0<br />               DB 0<br />e_lfarlc       DB 0<br />               DB 0<br />e_ovno         DB 0<br />               DB 0<br />e_res          DB 0<br />               DB 0<br />               DB 0<br />               DB 0<br /><br />e_ddosentry    push cs              ; DB 0Eh   DOSSTUB entrypoint<br />               pop ds               ; DB 1Fh<br />               mov dx, word string  ; DB BAh<br />                                    ; DB ??h<br />                                    ; DB ??h<br />               mov ah, 9            ; DB B4h<br />                                    ; DB 09h<br />               int 21h              ; DB CDh<br />                                    ; DB 21h<br />               mov ax, 4C01h        ; DB B8h<br />                                    ; DB 01h<br />                                    ; DB 4Ch<br />               int 21h              ; DB CDh<br />                                    ; DB 21h   &#91;@2Dh&#93;<br /> strr          DB 0<br />               DB 0<br />               DB 0            ; &#91;@30h&#93;<br />               DB 0<br />               DB 0<br />               DB 0<br />               DB 0<br />               DB 0<br />               DB 0            ; &#91;@36h&#93;<br />               DB 0<br />               DB 0<br />               DB 0<br />               DB 0<br />               DB 0<br />e_lfanew       DD 40h        ;  points to NT_SIGNATURE  &#91;@3Ch&#93;<br /><br /><br /><br /><br /><br />; ++++++++++++++<br />   FILE_HEADER&#58;<br />; ++++++++++++++<br /><br />  NT_SIGNATURE&#58;         DB 'PE',0,0          ; &#91;@FILE_HEADER + 00h&#93;<br /><br />Machine                 DB 4Ch               ; &#91;@FH+04h&#93;<br />                        DB 1<br />NumberOfSections        DB 1<br />                        DB 0<br />TimeDateStamp           DB UNUSED                 ; ==&gt; 12 bytes  &#91;@FH+08h&#93;<br />                        DB UNUSED<br />                        DB UNUSED<br />                        DB UNUSED<br />PointerToSymbolTable    DB UNUSED<br />                        DB UNUSED<br />                        DB UNUSED<br />                        DB UNUSED<br /><br />NumberOfSymbols         DB UNUSED                 ; &#91;@FH+10h&#93;<br />                        DB UNUSED<br />                        DB UNUSED<br />                        DB UNUSED<br />SizeOfOptionalHeader    DB 0E0h              ; const DW = 224  &#91;@FH+14h&#93;<br />                        DB 0<br />Characteristics         DB 2                 ; const DW = 2  &#91;@FH+16h&#93;<br />                        DB 0                 ; 0 or 1 works<br /><br /><br /><br />; ++++++++++++++++++<br />   OPTIONAL_HEADER&#58;<br />; ++++++++++++++++++<br /><br />Magic                    DB 0Bh               ; constant  &#91;@FH+18h&#93;<br />                         DB 1                 ;<br />MajorLinkerVersion       DB UNUSED            ;  ==&gt; 14 bytes  &#91;@FH+1Ah&#93;<br />MinorLinkerVersion       DB UNUSED<br />SizeOfCode               DB UNUSED<br />                         DB UNUSED<br />                         DB UNUSED<br />                         DB UNUSED<br /><br />SizeOfInitializedData    DB UNUSED            ; &#91;@FH+20h&#93;<br />                         DB UNUSED<br />                         DB UNUSED<br />                         DB UNUSED<br />SizeOfUninitializedData  DB UNUSED<br />                         DB UNUSED<br />                         DB UNUSED<br />                         DB UNUSED<br />AddressOfEntryPoint      DD CODE_ENTRY        ; ENTRYPOINT FIXED!   &#91;@FILE_HEADER + 28h&#93;<br />BaseOfCode               DB UNUSED            ;  ==&gt; 8 bytes  &#91;@FH+2Ch&#93;<br />                         DB UNUSED<br />                         DB UNUSED<br />                         DB UNUSED<br /><br />BaseOfData               DB UNUSED            ; &#91;@FH+30h&#93;<br />                         DB UNUSED<br />                         DB UNUSED<br />                         DB UNUSED<br />ImageBase                DD IMAGEBASE         ; IMAGEBASE     &#91;@FILE_HEADER + 34h&#93;<br />SectionAlignment         DD SECTIONALIGN      ; SECTIONALIGN  &#91;@FILE_HEADER + 38h&#93;<br />FileAlignment            DD FILEALIGN         ; FILEALIGN     &#91;@FILE_HEADER + 3Ch&#93;<br /><br />MajorOperatingSystemVer  DB 4                 ;  ==&gt; 8 bytes  &#91;@FH+40h&#93;<br />                         DB UNUSED<br />MinorOperatingSystemVer  DB UNUSED<br />                         DB UNUSED<br />MajorImageVersion        DB UNUSED<br />                         DB UNUSED<br />MinorImageVersion        DB UNUSED<br />                         DB UNUSED<br />MajorSubsystemVersion    DB 4                 ; constant = 4  &#91;@FH+48h&#93;<br />                         DB 0<br />MinorSubsystemVersion    DB UNUSED            ;  ==&gt; 6 bytes  &#91;@FH+4Ah&#93;<br />                         DB UNUSED<br />Win32VersionValue        DB UNUSED<br />                         DB UNUSED<br />                         DB UNUSED<br />                         DB UNUSED<br /><br />SizeOfImage              DD SECTIONALIGN + SECTION_END - SECTION_START  ;  &#91;@FILE_HEADER + 50h&#93;<br />SizeOfHeaders            DD FILEALIGN                                   ;  &#91;@FILE_HEADER + 54h&#93;<br />CheckSum                 DB 0                 ;  ==&gt; 4 bytes  &#91;@FH+58h&#93;<br />                         DB UNUSED<br />                         DB UNUSED<br />                         DB UNUSED<br />Subsystem                DB 2                 ; gui&#40;2&#41;, console&#40;3&#41;  &#91;@FH+5Ch&#93;<br />                         DB 0<br />DllCharacteristics       DB UNUSED            ;  ==&gt; 2 bytes  &#91;@FH+5Eh&#93;<br />                         DB UNUSED<br /><br />SizeOfStackReserve       DB 0                 ; &#91;@FILE_HEADER + 60h&#93;<br />                         DB 0<br />                         DB 10<br />                         DB 0<br />SizeOfStackCommit        DB 0                 ; &#91;@FILE_HEADER + 64h&#93;<br />                         DB 10<br />                         DB 0<br />                         DB 0<br />SizeOfHeapReserve        DB 0                 ; &#91;@FILE_HEADER + 68h&#93;<br />                         DB 0<br />                         DB 10<br />                         DB 0<br />SizeOfHeapCommit         DB 0                 ; &#91;@FILE_HEADER + 6Ch&#93;<br />                         DB 10<br />                         DB 0<br />                         DB 0<br /><br />LoaderFlags              DB UNUSED            ;  ==&gt; 4 bytes  &#91;@FH+70h&#93;<br />                         DB UNUSED<br />                         DB UNUSED<br />                         DB UNUSED<br />NumberOfRvaAndSizes      DB 2                 ; const DD = 2   &#91;@FH+74h&#93;<br />                         DB 0<br />                         DB 0<br />                         DB 0<br /><br /><br />; +++++++++++++++++<br />   DATA_DIRECTORY&#58;<br />; +++++++++++++++++<br /><br />DIRECTORY_ENTRY_EXPORT       DB UNUSED         ;  ==&gt; 8 bytes  &#91;@FH+78h&#93;<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br /><br />DIRECTORY_ENTRY_IMPORT       DD SECTIONALIGN + IMPORT_DESCRIPTOR - SECTION_START  ; &#91;@FILE_HEADER + 80h&#93;<br />                             DD &#40;IMPORT_DESCRIPTOR_END + 4&#41; - IMPORT_DESCRIPTOR   ; size = 24h<br />DIRECTORY_ENTRY_RESOURCE     DB 0               ; const DD = 0 &#91;@FH+88h&#93;<br />                             DB 0<br />                             DB 0<br />                             DB 0<br />                             DB UNUSED            ;  ==&gt; 52 bytes  &#91;@FH+8Ch&#93;<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br /><br />DIRECTORY_ENTRY_EXCEPTION    DB UNUSED            ; &#91;@FH+90h&#93;<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />DIRECTORY_ENTRY_SECURITY     DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br /><br />DIRECTORY_ENTRY_BASERELOC    DB UNUSED            ; &#91;@FH+A0h&#93;<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />DIRECTORY_ENTRY_DEBUG        DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br /><br />DIRECTORY_ENTRY_COPYRIGHT    DB UNUSED            ; &#91;@FH+B0h&#93;<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />DIRECTORY_ENTRY_GLOBALPTR    DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br /><br />DIRECTORY_ENTRY_TLS          DB 0          ; const DD = 0  &#91;@FH+C0h&#93;<br />                             DB 0<br />                             DB 0<br />                             DB 0<br />                             DB UNUSED            ;  ==&gt; 52 bytes  &#91;@FH+C4h&#93;<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />DIRECTORY_ENTRY_LOAD_CONFIG  DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br /><br />DIRECTORY_ENTRY_BOUND_IMPORT DB UNUSED            ; &#91;@FH+D0h&#93;<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />DIRECTORY_ENTRY_IAT          DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br /><br />DIRECTORY_ENTRY_14           DB UNUSED            ; &#91;@FH+E0h&#93;<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />DIRECTORY_ENTRY_15           DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br /><br />DIRECTORY_ENTRY_16           DB UNUSED            ; &#91;@FH+F0h&#93;<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br /><br />; +++++++++++++++++<br />   SECTION_HEADER&#58;<br />; +++++++++++++++++<br /><br />SectionName             DB UNUSED         ; ==&gt; 8 bytes  &#91;@FH+F8h&#93;<br />                        DB UNUSED<br />                        DB UNUSED<br />                        DB UNUSED<br />                        DB UNUSED<br />                        DB UNUSED<br />                        DB UNUSED<br />                        DB UNUSED<br />VirtualSize             DB 0              ; anything &lt; SECTIONALIGN  &#91;@FILE_HEADER + 100h&#93;<br />                        DB 0<br />                        DB 0<br />                        DB 0<br />VirtualAddress          DD SECTIONALIGN               ; RVA to section &#40;in RAM&#41;<br />SizeOfRawData           DD SECTION_END-SECTION_START  ; Size of section<br />PointerToRawData        DD SECTION_START              ; Offset to section &#40;in File&#41;<br /><br />PointerToRelocations    DB UNUSED         ; ==&gt; 12 bytes  &#91;@FH+110h&#93;<br />                        DB UNUSED<br />                        DB UNUSED<br />                        DB UNUSED<br />PointerToLinenumbers    DB UNUSED<br />                        DB UNUSED<br />                        DB UNUSED<br />                        DB UNUSED<br />NumberOfRelocations     DB UNUSED<br />                        DB UNUSED<br />NumberOfLinenumbers     DB UNUSED<br />                        DB UNUSED<br />SectionCharacteristics  DB 0<br />                        DB 0<br />                        DB 0<br />                        DB 0E0h         ; section executable, readable, writable<br /><br /><br />  ; +++++++++++++<br />     CODE_ENTRY&#58;<br />  ; +++++++++++++<br /><br />  &#91;BITS 32&#93;<br /><br />   mov eax,IMAGEBASE + title<br />   cdq                        ; clears EDX<br />   push 1040h<br />   push eax<br />   sub al, title - string<br />   push eax<br />   push edx<br />   call dword &#91;IMAGEBASE+SECTIONALIGN+&#40;__imp__MessageBoxA-SECTION_START&#41;&#93;<br />   retn<br /><br />  ; +++++++<br />     DATA&#58;<br />  ; +++++++<br /><br />  string&#58;                 DB 'PE/EXE File - 552 bytes',10,13,'&#40;Dos/Win95/98/ME/NT/2000/Xp&#41;'<br />                          DB 10,13,'CoDE&#58; pmpch',10,13,10,13,'Copyright &#40;c&#41; 2oo4',0,'$'<br />  title&#58;                  DB ' trY ME!',0<br /><br />  IMPORT_BY_NAME&#58;         DW  UNUSED             ;&#40;ordinal&#41;<br />                          DB 'MessageBoxA',0<br /><br />  DLLNAME&#58;                DB 'User32.dll',0<br /><br /><br /><br /> ALIGN FILEALIGN,DB 0                    ; 0-padding to FILEALIGN<br /><br /><br /><br /><br /><br /><br />; ####################################################<br />;                    S E C T I O N<br />; ####################################################<br /><br /><br />; ++++++++++++++++<br />   SECTION_START&#58;                         ;  &#91;@FILEALIGN + 00h&#93;<br />; ++++++++++++++++<br /><br /><br /><br />  ; +++++++++++++++<br />      FIRST_THUNK&#58;<br />  ; +++++++++++++++<br /><br />  __imp__MessageBoxA&#58;        DD IMPORT_BY_NAME  ; RVA<br />                            ;DD 0               ; terminator<br /><br />  ; ++++++++++++++++++++<br />     IMPORT_DESCRIPTOR&#58;<br />  ; ++++++++++++++++++++<br />    OriginalFirstThunk_1     DD 0               ; ...is terminator for __imp__MessageBoxA<br />                                                ; at the same time ;&#41;<br /><br />    TimeDateStamp_1          DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br /><br />    ForwarderChain_1         DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />    Name_1                   DD DLLNAME         ; RVA to DLL name<br />    FirstThunk_1             DD SECTIONALIGN + FIRST_THUNK - SECTION_START  ; RVA to 1st thunk<br /><br />   IMP_DES_TERMINATOR&#58;<br />    tOriginalFirstThunk      DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />    tTimeDateStamp           DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />    tForwarderChain          DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />                             DB UNUSED<br />    tName                    DB 0         ; const DD = 0<br />                             DB 0<br />                             DB 0<br />                             DB 0<br />   ;tFirstThunk              DB 0         ; STRIPPED<br />   ;                         DB 0         ; STRIPPED<br />   ;                         DB 0         ; STRIPPED<br />   ;                         DB 0         ; STRIPPED<br /><br />   ; ++++++++++++++++++++++++<br />     IMPORT_DESCRIPTOR_END&#58;<br />   ; ++++++++++++++++++++++++<br /><br />   ; ATTETION&#58; add +4 to DIRECTORY_ENTRY_IMPORT&#91;size&#93;<br /><br /><br /><br />; ++++++++++++++<br />   SECTION_END&#58;<br />; ++++++++++++++<br /><br /><br />; ####################################################<br />; ####################################################&#91;/SIZE&#93;</code></pre></div>
    <div class="meta">Posted on 2004-06-09 07:30:45 by pmpch</div>
   </div>
   <div class="post" id="post-143298">
    <div class="subject"><a href="#post-143298">Common (simple) techniques to reduce EXE size</a></div>
    <div class="body">Here is my example of  432 bytes running on every version of windows. Find out the trick. :)</div>
    <div class="meta">Posted on 2004-06-09 11:57:59 by Vortex</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=18362&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=18362&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="18362" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=18362&amp;page=2">&gt;</a><a href="../?id=18362&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>