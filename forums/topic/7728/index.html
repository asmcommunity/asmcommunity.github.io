<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Problem - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=7728" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=7728">Problem</a></p>
   <div class="post" id="post-56090">
    <div class="subject"><a href="#post-56090">Problem</a></div>
    <div class="body">Hello,<br /><br />  I am new to win32 programming and also not much of a wise guy in new processors assembly too. I did assembler to Z80, and it is alike, but some trick differences between them.<br /><br /> However, I have a problem now with a small code I wrote and assembled with MASM32. Ill put the whole code here.<br /> The line where I get the fatal error is the marked one. Ill put more info on the thread about it, as it is needed.<br /><br />  Hope some one lightens up here!! :)<br /><br />&gt;&gt;&gt;-----tt.asm---------&lt;&lt;&lt;&lt;<br /><br />.386<br />.model flat, stdcall<br />option casemap:none<br />include e:\masm32\include\windows.inc<br />include e:\masm32\include\kernel32.inc<br />include e:\masm32\include\user32.inc<br />includelib e:\masm32\lib\user32.lib<br />includelib e:\masm32\lib\kernel32.lib<br />;e:\masm32\bin\ml /c /coff /Cp a:\tt.asm<br />;e:\masm32\bin\link /SUBSYSTEM:WINDOWS /LIBPATH:e:\masm32\lib tt.obj<br /><br />.data<br />MsgCaption		db &quot;Hora precisa!! :)&quot;,0<br />MsgBoxText		db &quot;O programa que mostra a EXAAAAAATA hora que voc? o executou. Sem coisais in?teis. Enjoy!&quot;,0<br />UI				db &quot;Voc? executou o programa exatamente ?s:&quot;,0<br />Relogio			db 0,0,0,0,0,0,0,0<br />		<br />Ofiseti			db 5,16,27,38,47,53,59,65,0<br />.code<br />start:<br />	<br />	jmp Pulo<br />	String	db &quot;Ano: ***** &quot;,&quot;Mes: ***** &quot;,&quot;DiS: ***** &quot;,&quot;Dia: ***** &quot;,&quot;As *****:&quot;,&quot;*****:&quot;,&quot;*****&quot;,&quot;.*****&quot;,0<br /><br />	<br />Pulo:	invoke MessageBox, NULL,addr MsgBoxText, addr MsgCaption, MB_OK<br /><br />	push eax<br />	mov eax,offset Relogio		;<br />	call GetLocalTime			;Puts time  in address at EAX<br /><br /><br />	push ebx<br />	push ecx<br />	push edx<br />	push edi<br />	push esi<br /><br />	; ----- START -----<br /><br />	mov edx,offset Ofiseti<br />Num:	xor ecx,ecx<br />	mov ecx,<br />	mov edi,offset String		 	;1st add. de string (thousands)<br />	add edi,ecx<br />	mov esi,offset Relogio		;offset do primeiro valor<br />	call W2S0<br />	inc edx<br />	mov edx,<br />	test edx,0<br />	jnz Num<br /><br />	; ----- END -----<br />	<br />	<br />	<br />	invoke MessageBox, NULL,addr String, addr UI, MB_OK<br />	<br />	<br />	pop eax<br />	pop bx<br />	pop ecx<br />	pop edx<br />	pop edi<br />	pop esi<br /><br />	invoke ExitProcess,NULL<br />	<br />	<br />	<br />; ------------ START ------------<br /><br />W2S0:		mov eax,<br />			mov bx,30h		;SET<br />			<br />Ite1:		sub ax,2710h<br />			jl Ite2<br />			inc bx<br />			jmp Ite1<br />			<br />Ite2:		add ax,2710h		;fiz ax number for next Iteration<br />			mov ,ebx   ;HERE I GET THE FAULT ERROR WHERE THE PROGRAM GETS CLOSED... WHY?? :-(<br />			add edi,2			;points SI 2 bytes up ( WORD! ;)<br />							; :-d<br /><br />W2S1:		mov bx,30h<br /><br />Ite3:		sub ax,3e8h<br />			jl Ite4<br />			inc bx<br />			jmp Ite3<br /><br />Ite4:		add ax,3e8h		<br />			mov ,bx<br />			add edi,2			<br />			<br />W2S2:		mov bx,30h<br /><br />Ite5:		sub ax,64h<br />			jl Ite6<br />			inc bx<br />			jmp Ite5<br />			<br />Ite6:		add ax,64h<br />			mov ,bx<br />			add edi,2<br /><br />W2S3:		mov bx,30h<br /><br />Ite7:		sub ax,0ah<br />			jl Ite8<br />			inc bx<br />			jmp Ite7<br />			<br />Ite8:		add ax,0ah<br />			mov ,bx<br />			add edi,2<br /><br />W2S4:		mov bx,30h		; for the last one!<br />			add bx,ax			; what remains in AX is simple units!!<br />			mov ,bx<br />			ret<br /><br /><br />			<br /><br /><br /><br />; ------------- END -------------<br /><br />end start<br /><br /><br /><br />&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;--------------------&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</div>
    <div class="meta">Posted on 2002-09-04 18:59:38 by wicr0s0ft</div>
   </div>
   <div class="post" id="post-56118">
    <div class="subject"><a href="#post-56118">Problem</a></div>
    <div class="body">mmm... you should debugger and make lots practice with it, wicr0s0ft.<br /><br />regards</div>
    <div class="meta">Posted on 2002-09-04 21:28:22 by dion</div>
   </div>
   <div class="post" id="post-56135">
    <div class="subject"><a href="#post-56135">Problem</a></div>
    <div class="body">I haven't bothered trying to straighten out your loop, but here are three suggestions:<br /><br />- is edi containing a valid pointer? How do you check that before you use it?<br /><br />- you are moving a DWORD (ebx) to the location pointed to by edi, then incrementing edi by SIZEOF(WORD) == 2 bytes, so next time you copy a DWORD it will partially overwrite your previously moved  DWORD. Are you meaning to copy a WORD or a DWORD?<br /><br />-try using the syntax &quot;mov  DWORD PTR , ebx&quot;, just to make sure that you and the compiler do not get confused.</div>
    <div class="meta">Posted on 2002-09-05 00:28:06 by sluggy</div>
   </div>
   <div class="post" id="post-56152">
    <div class="subject"><a href="#post-56152">Problem</a></div>
    <div class="body">wicr0s0ft,<br /><br />from your code:<br /><br />push eax<br />mov eax,offset Relogio ;<br />call GetLocalTime ;Puts time  in address at EAX<br /><br /><br />I can see that you should read some docs about win32 programming. Parameters for Win32 functions such as GetLocalTime will never be transfered with registers but by pushing them onto the stack, so the correct form of this call would be:<br /><br />mov eax,offset Relogio ;<br />push eax<br />call GetLocalTime<br /> <br />or, even smaller:<br /><br />push offset Relogio<br />call GetLocalTime<br /><br />or, with &quot;invoke&quot;:<br /><br />invoke GetLocalTime, addr Relogio</div>
    <div class="meta">Posted on 2002-09-05 02:33:19 by japheth</div>
   </div>
   <div class="post" id="post-56277">
    <div class="subject"><a href="#post-56277">Problem</a></div>
    <div class="body">Fisrt of: thanks for all that replied to this. :)<br /><br />  I am sorry for the very raw code I left here,  I was I a real rush yesterday....<br /><br />  Ill try to explain here what all that code is supposed to do.<br />--------<br />  The programs does only two visible things ( what we see when we run it ), wich is to display to messages, one with a &quot;welcome&quot; line and another with the info returned by SystemTime...<br /><br />  The DATA: the 1st 2 strings are shownn in the fisrt dialog. The 3rd one is the caption for the 2nd dialog, and this dialog's text is in the code section, as I was thinking that the error was because I was overwritten the bytes of .data section... as you see, my problem here are most of concepts... :-\ ... continuing: the &quot;Relogio&quot; data is the destination for the time struct;<br />   the Ofiseti: is constructed with &quot;*&quot; in the places where we will replace with the values (Words)... as a Word can carry numbers of 5 digits (&lt;65535).... the No 0x213 on memory would result in 00531....<br /><br />  The W2S0 routine (Word to String ;) works like this: gets the interger value and substract 0x2710 (10k :) from it until the result is neggative.... we count those, of course, to add 0x30 to them.... next step is to do the same thing with the remain (we add 0x2710 to eax after we find that we BLEW it....) but subtracting 0x3e8 from it.... I think you got the idea of how it works now. After this we call the Message box with our &quot;fized&quot; time message... :)<br />-------<br /><br />Dion: yes, I also think I should.... I started to debug my program in SICE, but there I thing I dont know YET about how win32 programs work.... what better way of discovering that than creating a win32 program and reversing it yourself?? ;)<br />==========<br /><br />sluggy: so what are you saying is that:<br /><br />  -the fault page my program cause is due to a probable tentative of writing in a memory address OUTSIDE my program, and that is also NOT allocated for it ( I dont use any malloc in this ). Could you tell me what I CANNOT do with a win32 program... for example, is there a register I CANNOT in absolute NO circunstances modify.... even if I restore it after I use it? If you could show me URLs or docs that provide this info, instead of having to explain all this bits, you are welcome too! :)<br />=============<br /><br />japheth:<br />i did get the win32.hlp... but it didnt said HOW it gets the address of the destination struct... :( ... so, I tried to guess!! :-D <br />I know about invoke... but I am beggining to win32 asm, so Ill do PUSHs for a while... when Im doing enough pushs to consume tiime, Ill use the macros... ;) ... do you know where the MASM32 macros are stored?? So I could modify/add to that file my own macros too.<br /><br />  Thanks for the tip :)<br />===========</div>
    <div class="meta">Posted on 2002-09-05 17:00:14 by wicr0s0ft</div>
   </div>
  </div>
 </body>
</html>