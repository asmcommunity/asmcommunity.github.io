<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>DIB Picture Resize - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=1513" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=1513">DIB Picture Resize</a></p>
   <div class="post" id="post-9739">
    <div class="subject"><a href="#post-9739">DIB Picture Resize</a></div>
    <div class="body">Hi,<br />This my little MASM32 dll, that resizes a Picture smoothly. Im using it from out VB. In my litte TestApplication I'm creating a DIB-Collection from an Image and than Pass the Properties of the Source and Destination Image to my ASM-DLL.<br />It took me a while... But it works now. This is just for scaling a picture to a smaller size. It works with scaling it bigger, but without Interpolation.<br />I did the same thing in VB before... But compared to ASM it's of course real slow!<br /><br />If there was anybody who wants to test it or performing the whole thing I would be glad. - The comments are all German... I'm sorry!<br /><br />(Oh, If you want to use the testApplication you need to copy ma dll into the winnt or windows Directory... Or correct the Path in VB directly. - you need the vb-Runtimelibrarys)</div>
    <div class="meta">Posted on 2001-10-19 03:57:12 by Butch77</div>
   </div>
   <div class="post" id="post-9744">
    <div class="subject"><a href="#post-9744">DIB Picture Resize</a></div>
    <div class="body">Bi Butch77<br /><br />Works like a charm, except when down sizeing the window.<br />Btw, is'nt there api calls that does this well?<br /><br />KetilO</div>
    <div class="meta">Posted on 2001-10-19 05:01:05 by KetilO</div>
   </div>
   <div class="post" id="post-9748">
    <div class="subject"><a href="#post-9748">DIB Picture Resize</a></div>
    <div class="body">The down sizeing problem is some kind of an event-bug... I don't get any PaintEvent when down sizeing the window. But only on my win 2000 Server installation. Not on the win 2000 Professional.... whatever.<br /><br />I haven't found any API call, that does it smoothy (the AverageCalculationThing) Resizing, but if you find any please let me know. So that I can see which one is faster. :)</div>
    <div class="meta">Posted on 2001-10-19 06:14:19 by Butch77</div>
   </div>
   <div class="post" id="post-9786">
    <div class="subject"><a href="#post-9786">DIB Picture Resize</a></div>
    <div class="body">Hi,<br />API &quot;StretchDIBits&quot; does it.<br />Here is a Subroutine.<br />We must also create a device context on WM_Create.<br />On WM_Paint we display the bitmap via BitBlt.<br /><br /><pre><code><br /><br />My_LoadBitmap&#58;<br />;------------------------------------------------------------------------------<br />; API &quot;GetOpenFileName&quot; creates a system-defined dialog box that enables the<br />; user to select a file to open. <br />;------------------------------------------------------------------------------<br />mov     lStructSize,4Ch                     ;length in bytes of structure<br />mov     eax,WP1_hWnd<br />mov     hWndOwner,eax                       ;id window that owns dialog box<br />mov     eax,hInstance<br />mov     hInstance1,eax                      ;handle, our program id<br />mov     lpstrFilter,OFFSET FileFilterBMP    ;pointer to string + filter, 0= no<br />mov     lpstrCustomFilter,0h                ;pointer to user defined filter<br />mov     nMaxCustFilter,0h                   ;size bytes/characters of above<br />mov     nFilterIndex,0h                     ;filter index of lpstrFilter <br />mov     lpstrFile,OFFSET FileNameBuffer     ;pointer initialize filename, 0=no<br />mov     nMaxFile,104h                       ;max size bytes/characters of above<br />mov     lpstrFileTitle,0h                   ;pointer title of the selected file<br />mov     nMaxFileTitle,0h                    ;size of the lpstrFileTitle buffer <br />mov     lpstrInitialDir,0h                  ;pointer init file dir,0=default<br />mov     lpstrTitle,OFFSET LoadFileTitelBMP  ;pointer title of the box <br />mov     Flags,00281804h                     ;the dialog box creation flags <br />mov     nFileOffset,0h                      ;offset filename in string lpstrFile <br />mov     nFileExtension,0h                   ;offset extension in string lpstrFile <br />mov     lCustData,0h                        ;? <br />mov     lpfnHook,0h                         ;? used if flag is OFN_ENABLETEMPLATE<br />mov     lpTemplateName,0h                   ;? used if flag is OFN_ENABLETEMPLATE<br />mov     lpstrDefExt,OFFSET FileDefExtBMP    ;pointer default extension file, 0=no <br />push    OFFSET lStructSize                  ;pointer to OPENFILENAME Structure<br />call    GetOpenFileNameA                    ;- API Function -<br />cmp     eax,0h                              ;<br />je      My_LoadBitmap_Return                ;Error<br />;------------------------------------------------------------------------------<br />; API &quot;CreateFileA&quot; creates or opens a file, it returns a handle.<br />;------------------------------------------------------------------------------<br />push    0h                      ;hTemplateFile,<br />push    80h                     ;dwFlagsAndAttributes, 80h = normal<br />push    3h                      ;dwCreationDistribution, OPEN_EXISTING<br />push    0h                      ;lpSecurityAttributes,<br />push    1h                      ;dwShareMode, FILE_SHARE_READ<br />push    80000000h               ;dwDesiredAccess, GENERIC_READ<br />push    OFFSET FileNameBuffer   ;lpFileName,pointer to filename<br />call    CreateFileA             ;- API Function -<br />cmp     eax,-1                  ;<br />je      My_LoadBitmap_Return    ;Error<br />mov     handleFile,eax          ;store handle in variable<br />;------------------------------------------------------------------------------<br />; API &quot;GetFileSize&quot; retrieves the size, in bytes, of the specified file. <br />;------------------------------------------------------------------------------<br />push    0h                      ;lpFileSizeHigh, highword file size<br />push    handleFile              ;hFile, handle of file to get size of<br />call    GetFileSize             ;- API Function -<br />cmp     eax,-1                  ;<br />je      My_LoadBitmap_Return    ;Error<br />mov     totalBytesFile,eax      ;store size in variable<br />;------------------------------------------------------------------------------<br />; API &quot;GlobalAlloc&quot; allocates the specified number of bytes<br />;------------------------------------------------------------------------------<br />push    totalBytesFile          ;dwBytes, number of bytes to allocate  <br />push    0h                      ;uFlags, alloc attributes 0=GMEM_FIXED <br />call    GlobalAlloc             ;- API Function -<br />cmp     eax,0h                  ;<br />je      My_LoadBitmap_Return    ;Error<br />mov     pGlobalMemFile,eax      ;store memory pointer in variable<br />;------------------------------------------------------------------------------<br />; API &quot;ReadFile&quot; reads data from a file, starting at the position file pointer<br />;------------------------------------------------------------------------------<br />push    0h                      ;lpOverlapped,address data structure <br />push    OFFSET FileBytesReturn  ;lpNumberOfBytesRead, readed bytes <br />push    totalBytesFile          ;nNumberOfBytesToRead, bytes to read <br />push    pGlobalMemFile          ;lpBuffer, address buffer receives data<br />push    handleFile              ;hFile, handle of file to read <br />call    ReadFile                ;- API Function -<br />cmp     eax,0h                  ;<br />je      My_LoadBitmap_Return    ;Error<br />;------------------------------------------------------------------------------<br />; Calculate the pointer to the BITMAPINFO structure and to the bitmap data.<br />; Also receive the biHeight and biWidth values for future use.<br />;------------------------------------------------------------------------------<br />mov     eax,pGlobalMemFile      ;first byte in global memory<br />add     eax,14                  ;calculate pointer to BITMAPINFOHEADER<br />mov     pointerBMI,eax          ;<br />mov     eax,pGlobalMemFile      ;first byte in global memory<br />mov     ebx,pGlobalMemFile      ;first byte in global memory<br />add     ebx,10                  ;offset to bitmap data<br />add     eax,&#91;ebx&#93;               ;calculate pointer to bitmap data<br />mov     pointerDAT,eax          ;<br />mov     eax,pGlobalMemFile      ;pointer to global memory<br />add     eax,18                  ;member biWidth of BITMAPINFO<br />mov     ebx,&#91;eax&#93;               ;<br />mov     widthBMP,ebx            ;<br />add     eax,4h                  ;member biHeight of BITMAPINFO<br />mov     ebx,&#91;eax&#93;               ;<br />mov     heightBMP,ebx           ;<br />;------------------------------------------------------------------------------<br />; API &quot;SetStretchBltMode&quot; sets the bitmap stretching mode in the specified DC.<br />;------------------------------------------------------------------------------<br />push    3h                      ;iStretchMode, COLORONCOLOR<br />push    h_DC_Memory             ;hdc, handle of device context<br />call    SetStretchBltMode       ;- API Function -<br />;------------------------------------------------------------------------------<br />; API &quot;SetMapMode&quot; sets the mapping mode of the specified device context. The<br />; mapping mode defines the unit of measure used to transform page-space units<br />; into device-space units and the orientation of the device's x and y axes.<br />;------------------------------------------------------------------------------<br />push    1h                      ;fnMapMode, mapping mode, MM_TEXT	<br />push    h_DC_Memory             ;hdc, handle of device context<br />call    SetMapMode              ;- API Function -<br />;------------------------------------------------------------------------------<br />; API &quot;StretchDIBits&quot; copies the color data for a rectangle of pixels in a<br />; device-independent bitmap &#40;DIB&#41; to the specified destination rectangle.<br />; If the destination rectangle is larger than the source rectangle, this API<br />; stretches the rows and columns of color data to fit the destination rectangle<br />; If the destination rectangle is smaller than the source rectangle, this API <br />; compresses the rows and columns by using the specified raster operation.<br />;------------------------------------------------------------------------------<br />push    0CC0020h                ;dwRop, raster operation code<br />push    0h                      ;iUsage, DIB_RGB_COLORS<br />push    pointerBMI              ;lpBitsInfo, address of bitmap data<br />push    pointerDAT              ;lpBits, address of bitmap bits<br />push    heightBMP               ;nSrcHeight, height of src rectangle<br />push    widthBMP                ;nSrcWidth, width of source rectangle<br />push    0h                      ;YSrc, y=src. rect. up-left<br />push    0h                      ;XSrc, x=src. rect. up-left<br />push    Ypos_max                ;nDestHeight, height dest. rectangle<br />push    Xpos_max                ;nDestWidth, width dest. rectangle<br />push    0h                      ;YDest, y=dest. rect. up-left<br />push    0h                      ;XDest, x=dest. rect. up-left<br />push    h_DC_Memory             ;hdc, handle of destination DC<br />call    StretchDIBits           ;- API Function -<br />;------------------------------------------------------------------------------<br />; API &quot;GlobalFree&quot; frees the global memory object and invalidates its handle.<br />;------------------------------------------------------------------------------<br />push    pGlobalMemFile          ;hMem, handle to global memory object  <br />call    GlobalFree              ;- API Function -<br />;------------------------------------------------------------------------------<br />; API &quot;InvalidateRect&quot; adds a rectangle to specified window's update region.<br />; This function performs a WM_PAINT message.<br />;------------------------------------------------------------------------------<br />push    0h                      ;bErase, erase-background flag<br />push    0h                      ;lpRect, rect structure, 0h=client area<br />push    WP1_hWnd                ;hWnd, handle window update region<br />call    InvalidateRect          ;- API Function -<br />My_LoadBitmap_Return&#58;<br />;------------------------------------------------------------------------------<br />; API &quot;CloseHandle&quot; closes an open object handle.<br />;------------------------------------------------------------------------------<br />push    handleFile              ;hObject, handle of object to close  <br />call    CloseHandle             ;- API Function -<br />ret<br /><br /></code></pre><br /><br />TD</div>
    <div class="meta">Posted on 2001-10-20 02:48:29 by Test Department</div>
   </div>
  </div>
 </body>
</html>