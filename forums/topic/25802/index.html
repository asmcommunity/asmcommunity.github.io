<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Invalid Opcode Exception and IRQs (Solved) - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25802" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25802">Invalid Opcode Exception and IRQs (Solved)</a></p>
   <div class="post" id="post-188235">
    <div class="subject"><a href="#post-188235">Invalid Opcode Exception and IRQs (Solved)</a></div>
    <div class="body">I am extending my kernel by remapping IRQs to IDT slots 0x20 and the slave PIC to 0x28. The problem is that when the IDT is set and everything is done, when a key is pressed, Trap #6 in my IDT is called. can anybody tell me what I am doing wrong? Below is the code for the kernel:<br /><br /><pre><code><br /><br />VIDEOSEGMENT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x000B8000<br />VIDEOBYTECOUNT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(80*25) &lt;&lt; 1<br />KERNELENTRY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x00100000<br />KERNEL_SIZE_IN_KB&nbsp; &nbsp; &nbsp; &nbsp;EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x04<br />IDT_ENTRY_COUNT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x30<br />; --------------------------------------------------<br />%IDEFINE OFFSET<br />%IDEFINE PTR<br />; --------------------------------------------------<br />%MACRO&nbsp; SETIDTENTRY 2 ; (int IDTNumber , void IDTProcedure)<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;EBX , OFFSET IDT + (%1 * 0x08)<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , %2<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;WORD PTR  , AX<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;WORD PTR  , 0x0008<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;WORD PTR  , 0x8E00<br />&nbsp; SHR&nbsp; &nbsp; &nbsp;EAX , 0x10<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;WORD PTR  , AX<br />%ENDMACRO<br />; --------------------------------------------------<br />PIC1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x20<br />PIC2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0xA0<br />PIC1_COMMAND&nbsp; &nbsp; EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PIC1<br />PIC1_DATA&nbsp; &nbsp; &nbsp; &nbsp;EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (PIC1+1)<br />PIC2_COMMAND&nbsp; &nbsp; EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PIC2<br />PIC2_DATA&nbsp; &nbsp; &nbsp; &nbsp;EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (PIC2+1)<br />PIC_EOI&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x20<br />ICW1_ICW4&nbsp; &nbsp; &nbsp; &nbsp;EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x01<br />ICW1_INIT&nbsp; &nbsp; &nbsp; &nbsp;EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x10<br />ICW4_8086&nbsp; &nbsp; &nbsp; &nbsp;EQU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x01<br />; --------------------------------------------------<br /><br />START:<br />&nbsp; CLI<br /><br />&nbsp; CALL&nbsp; &nbsp; __ClearScreen<br /><br />&nbsp; ; Fill all the IDT slots with zero<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;ECX , IDT_ENTRY_COUNT<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;EBX , OFFSET IDT<br />&nbsp; XOR&nbsp; &nbsp; &nbsp;EAX , EAX<br />&nbsp; @@__FillIDTWithZero:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;DWORD PTR  , EAX<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;DWORD PTR  , EAX<br />&nbsp; &nbsp; ADD&nbsp; &nbsp; &nbsp;EBX , 0x08<br />&nbsp; &nbsp; DEC&nbsp; &nbsp; &nbsp;ECX<br />&nbsp; &nbsp; JNZ&nbsp; &nbsp; &nbsp;@@__FillIDTWithZero<br /><br />&nbsp; ; Initialize the 8259A PIC<br />&nbsp; IN&nbsp; &nbsp; &nbsp; AL , PIC1_DATA<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;DL , AL<br />&nbsp; IN&nbsp; &nbsp; &nbsp; AL , PIC2_DATA<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;DH , AL<br /><br />&nbsp; MOV&nbsp; &nbsp; &nbsp;AL , ICW1_INIT | ICW1_ICW4<br />&nbsp; OUT&nbsp; &nbsp; &nbsp;PIC1_COMMAND , AL<br /><br />&nbsp; OUT&nbsp; &nbsp; &nbsp;PIC2_COMMAND , AL<br /><br />&nbsp; MOV&nbsp; &nbsp; &nbsp;AL , 0x20<br />&nbsp; OUT&nbsp; &nbsp; &nbsp;PIC1_DATA , AL<br /><br />&nbsp; MOV&nbsp; &nbsp; &nbsp;AL , 0x28<br />&nbsp; OUT&nbsp; &nbsp; &nbsp;PIC2_DATA , AL<br /><br />&nbsp; MOV&nbsp; &nbsp; &nbsp;AL , 0x04<br />&nbsp; OUT&nbsp; &nbsp; &nbsp;PIC1_DATA , AL<br /><br />&nbsp; MOV&nbsp; &nbsp; &nbsp;AL , 0x02<br />&nbsp; OUT&nbsp; &nbsp; &nbsp;PIC2_DATA , AL<br /><br />&nbsp; MOV&nbsp; &nbsp; &nbsp;AL , ICW4_8086<br />&nbsp; OUT&nbsp; &nbsp; &nbsp;PIC1_DATA , AL<br /><br />&nbsp; OUT&nbsp; &nbsp; &nbsp;PIC2_DATA , AL<br /><br />&nbsp; MOV&nbsp; &nbsp; &nbsp;AL , DL<br />&nbsp; OUT&nbsp; &nbsp; &nbsp;PIC1_DATA , AL<br /><br />&nbsp; MOV&nbsp; &nbsp; &nbsp;AL , DH<br />&nbsp; OUT&nbsp; &nbsp; &nbsp;PIC2_DATA , AL<br /><br /><br />&nbsp; ; Set IDT entries for the first 32 slots<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x00 , __Trap0Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x01 , __Trap1Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x02 , __Trap2Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x03 , __Trap3Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x04 , __Trap4Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x05 , __Trap5Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x06 , __Trap6Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x07 , __Trap7Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x08 , __Trap8Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x09 , __Trap9Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x0A , __Trap10Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x0B , __Trap11Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x0C , __Trap12Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x0D , __Trap13Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x0E , __Trap14Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x0F , __Trap15Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x10 , __Trap16Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x11 , __Trap17Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x12 , __Trap18Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x13 , __Trap19To31Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x14 , __Trap19To31Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x15 , __Trap19To31Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x16 , __Trap19To31Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x17 , __Trap19To31Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x18 , __Trap19To31Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x19 , __Trap19To31Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x1A , __Trap19To31Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x1B , __Trap19To31Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x1C , __Trap19To31Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x1D , __Trap19To31Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x1E , __Trap19To31Handler<br />&nbsp; SETIDTENTRY&nbsp; &nbsp;0x1F , __Trap19To31Handler<br /><br /><br />&nbsp; ; Fill IRQ gates in the IDT for the first 8 IRQs<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;EBX , OFFSET IDT + (0x20 * 0x08)<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;ECX , 0x08<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , OFFSET __MasterPICHandler<br />&nbsp; @@__FillIRQSlots1to8:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;WORD PTR  , AX<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;WORD PTR  , 0x0008<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;WORD PTR  , 0x8F00<br />&nbsp; &nbsp; ROR&nbsp; &nbsp; &nbsp;EAX , 0x10<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;WORD PTR  , AX<br />&nbsp; &nbsp; ADD&nbsp; &nbsp; &nbsp;EBX , 0x08<br />&nbsp; &nbsp; DEC&nbsp; &nbsp; &nbsp;ECX<br />&nbsp; &nbsp; JNZ&nbsp; &nbsp; &nbsp;@@__FillIRQSlots1to8<br /><br />&nbsp; ; Fill IRQ gates in the IDT for the last 8 IRQs<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;ECX , 0x08<br />&nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , OFFSET __SlavePICHandler<br />&nbsp; @@__FillIRQSlots9to16:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;WORD PTR  , AX<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;WORD PTR  , 0x0008<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;WORD PTR  , 0x8F00<br />&nbsp; &nbsp; ROR&nbsp; &nbsp; &nbsp;EAX , 0x10<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;WORD PTR  , AX<br />&nbsp; &nbsp; ADD&nbsp; &nbsp; &nbsp;EBX , 0x08<br />&nbsp; &nbsp; DEC&nbsp; &nbsp; &nbsp;ECX<br />&nbsp; &nbsp; JNZ&nbsp; &nbsp; &nbsp;@@__FillIRQSlots9to16<br /><br />&nbsp; LIDT&nbsp; &nbsp; <br />&nbsp; STI<br /><br />&nbsp; HLT<br /><br />&nbsp; %INCLUDE &quot;Procs.asm&quot;<br />; --------------------------------------------------<br />&nbsp; __MasterPICHandler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;AL , PIC_EOI<br />&nbsp; &nbsp; OUT&nbsp; &nbsp; &nbsp;PIC1_COMMAND , AL<br />&nbsp; &nbsp; IRET<br /><br />&nbsp; __SlavePICHandler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;AL , PIC_EOI<br />&nbsp; &nbsp; OUT&nbsp; &nbsp; &nbsp;PIC2_COMMAND , AL<br />&nbsp; &nbsp; OUT&nbsp; &nbsp; &nbsp;PIC1_COMMAND , AL<br />&nbsp; &nbsp; IRET<br />; --------------------------------------------------<br />&nbsp; Trap0Msg&nbsp; &nbsp; &nbsp; DB&nbsp; &nbsp; &nbsp; &#39;Division by zero&#39;, 0x00<br />&nbsp; Trap1Msg&nbsp; &nbsp; &nbsp; DB&nbsp; &nbsp; &nbsp; &#39;Debug Exception&#39;, 0x00<br />&nbsp; Trap2Msg&nbsp; &nbsp; &nbsp; DB&nbsp; &nbsp; &nbsp; &#39;Non-maskable Interrupt Exception&#39;, 0x00<br />&nbsp; Trap3Msg&nbsp; &nbsp; &nbsp; DB&nbsp; &nbsp; &nbsp; &#39;Breakpoint Exception&#39;, 0x00<br />&nbsp; Trap4Msg&nbsp; &nbsp; &nbsp; DB&nbsp; &nbsp; &nbsp; &#39;Into Detected Overflow Exception&#39;, 0x00<br />&nbsp; Trap5Msg&nbsp; &nbsp; &nbsp; DB&nbsp; &nbsp; &nbsp; &#39;Out of Bounds Exception&#39;, 0x00<br />&nbsp; Trap6Msg&nbsp; &nbsp; &nbsp; DB&nbsp; &nbsp; &nbsp; &#39;Invalid Opcode Exception&#39;, 0x00<br />&nbsp; Trap7Msg&nbsp; &nbsp; &nbsp; DB&nbsp; &nbsp; &nbsp; &#39;No Coprocessor Exception&#39;, 0x00<br />&nbsp; Trap8Msg&nbsp; &nbsp; &nbsp; DB&nbsp; &nbsp; &nbsp; &#39;Double Fault Exception&#39;, 0x00<br />&nbsp; Trap9Msg&nbsp; &nbsp; &nbsp; DB&nbsp; &nbsp; &nbsp; &#39;Coprocessor Segment Overrun Exception&#39;, 0x00<br />&nbsp; Trap10Msg&nbsp; &nbsp; &nbsp;DB&nbsp; &nbsp; &nbsp; &#39;Bad TSS Exception&#39;, 0x00<br />&nbsp; Trap11Msg&nbsp; &nbsp; &nbsp;DB&nbsp; &nbsp; &nbsp; &#39;Segment Not Present Exception&#39;, 0x00<br />&nbsp; Trap12Msg&nbsp; &nbsp; &nbsp;DB&nbsp; &nbsp; &nbsp; &#39;Stack Fault Exception&#39;, 0x00<br />&nbsp; Trap13Msg&nbsp; &nbsp; &nbsp;DB&nbsp; &nbsp; &nbsp; &#39;General Protection Fault&#39;, 0x00<br />&nbsp; Trap14Msg&nbsp; &nbsp; &nbsp;DB&nbsp; &nbsp; &nbsp; &#39;Page Fault Exception&#39;, 0x00<br />&nbsp; Trap15Msg&nbsp; &nbsp; &nbsp;DB&nbsp; &nbsp; &nbsp; &#39;Unknown Interrupt Exception&#39;, 0x00<br />&nbsp; Trap16Msg&nbsp; &nbsp; &nbsp;DB&nbsp; &nbsp; &nbsp; &#39;Coprocessor Fault Exception&#39;, 0x00<br />&nbsp; Trap17Msg&nbsp; &nbsp; &nbsp;DB&nbsp; &nbsp; &nbsp; &#39;Alignment Check Exception&#39;, 0x00<br />&nbsp; Trap18Msg&nbsp; &nbsp; &nbsp;DB&nbsp; &nbsp; &nbsp; &#39;Machine Check Exception&#39;, 0x00<br />&nbsp; Trap19Msg&nbsp; &nbsp; &nbsp;DB&nbsp; &nbsp; &nbsp; &#39;Reserved Exception&#39;, 0x00<br />; --------------------------------------------------<br />&nbsp; __Trap0Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap0Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap1Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap1Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap2Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap2Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap3Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap3Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap4Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap4Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap5Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap5Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap6Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap6Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap7Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap7Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap8Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap8Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap9Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap9Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap10Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap10Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap11Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap11Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap12Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap12Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap13Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap13Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap14Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap14Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap15Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap15Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap16Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap16Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap17Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap17Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap18Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap18Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />&nbsp; &nbsp; ; --------------------<br />&nbsp; __Trap19To31Handler:<br />&nbsp; &nbsp; MOV&nbsp; &nbsp; &nbsp;EAX , Trap19Msg<br />&nbsp; &nbsp; CALL&nbsp; &nbsp; __WriteStr<br />&nbsp; &nbsp; JMP&nbsp; &nbsp; &nbsp;$<br />; --------------------------------------------------<br />&nbsp; ALIGN 8, NOP<br />&nbsp; <br />&nbsp; IDT:<br />&nbsp; &nbsp; RESD (IDT_ENTRY_COUNT &lt;&lt; 1)<br />&nbsp; IDT_END:<br />&nbsp; ;------------------------------<br />&nbsp; <br />&nbsp; IDTR:<br />&nbsp; &nbsp; DW (IDT_END - IDT) - 1<br />&nbsp; &nbsp; DD IDT<br /><br />&nbsp; String1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Kernel&#39;, 0x00<br />&nbsp; String2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;A key is pressed&#39;, 0<br />&nbsp; VideoCursor&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x00000000<br /><br />&nbsp; TIMES&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(KERNEL_SIZE_IN_KB &lt;&lt; 10)-($-$$) DB 0x00</code></pre></div>
    <div class="meta">Posted on 2007-02-25 04:31:04 by XCHG</div>
   </div>
   <div class="post" id="post-188241">
    <div class="subject"><a href="#post-188241">Re: Invalid Opcode Exception and IRQs</a></div>
    <div class="body">Shooting from the hip, your INT 0x21 (IRQ 1/Keyboard) entry may be pointing to a section of data (hence the invalid opcode) or is perhaps corrupt.<br /><br />I&#39;ll look into more later, I&#39;m busy at the moment.</div>
    <div class="meta">Posted on 2007-02-25 18:47:10 by SpooK</div>
   </div>
   <div class="post" id="post-188292">
    <div class="subject"><a href="#post-188292">Re: Invalid Opcode Exception and IRQs</a></div>
    <div class="body">Okay I fixed the problem. There were a lot of stuff wrong with the code. Thanks spook. Appreciations.</div>
    <div class="meta">Posted on 2007-03-02 03:56:24 by XCHG</div>
   </div>
   <div class="post" id="post-188298">
    <div class="subject"><a href="#post-188298">Re: Invalid Opcode Exception and IRQs</a></div>
    <div class="body"><div class="quote"><br />Okay I fixed the problem. There were a lot of stuff wrong with the code. Thanks spook. Appreciations.<br /></div><br /><br />Yeah, sorry I didn&#39;t get time to look at it further. I kind of expected you to catch it though, as you are more familiar with your own code :)</div>
    <div class="meta">Posted on 2007-03-02 11:47:54 by SpooK</div>
   </div>
   <div class="post" id="post-188301">
    <div class="subject"><a href="#post-188301">Re: Invalid Opcode Exception and IRQs (Solved)</a></div>
    <div class="body">Actually it was your comment that made me realize that some data was being executed instead of code. For now I really am just testing stuff so I&#39;m going to be needing your help every now and then.</div>
    <div class="meta">Posted on 2007-03-02 12:47:10 by XCHG</div>
   </div>
   <div class="post" id="post-188305">
    <div class="subject"><a href="#post-188305">Re: Invalid Opcode Exception and IRQs (Solved)</a></div>
    <div class="body"><div class="quote"><br />Actually it was your comment that made me realize that some data was being executed instead of code. For now I really am just testing stuff so I&#39;m going to be needing your help every now and then.<br /></div><br /><br />Yeah, I use things like Bochs to keep me in check. There are times that I think there is a &quot;bug in Bochs&quot; but eventually I realize it is something I did when I should have been sleeping :)</div>
    <div class="meta">Posted on 2007-03-02 15:24:18 by SpooK</div>
   </div>
  </div>
 </body>
</html>