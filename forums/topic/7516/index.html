<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Bug?? Or am I just not doing it right?? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=7516" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=7516">Bug?? Or am I just not doing it right??</a></p>
   <div class="post" id="post-54607">
    <div class="subject"><a href="#post-54607">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">Probly the second one.  <br /><br />Now that FASM is 1.40, I've decided to start using it.<br /><br />My first project was to see if I could make VC7 assemble and attach to the process and debug it.<br /><br />My test source was TUT03 from the tutorial file Privalov posted.<br /><br />It will assemble PE GUI 4.0, but VC7 cannot attach to the process.<br /><br />So I decided to try COFF.<br /><br />I changed the line 'format PE GUI 4.0' to 'format MS COFF'.<br /><br />This is the command line and error I get:<br /><pre><code><br />fasm tut03.asm test.obj<br />flat assembler  version 1.40<br />tut03.asm &#91;83&#93;&#58;<br />section '.idata' import data readable writeable<br />error&#58; extra characters on line<br /></code></pre><br /><br />The only part of the code I've touched is the format and an int 3 after the WinMain entry point.<br /><br />Is there some form of structural difference needed for MS COFF to work? Are PE GUI 4.0 and MS COFF not supposed to be interchangable?  Am I missing something else?<br /><br />Thanks.<br /><br /><br />edit: another quick question.  Can I use 'fasm c:\program\program.asm c:\debug\program.exe'??   So far I have not been able to assemble without the fasm exe being in the same directory.</div>
    <div class="meta">Posted on 2002-08-23 08:01:11 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-54608">
    <div class="subject"><a href="#post-54608">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">The &quot;import&quot; flag doesn't work with MS COFF format, PE data directories are generated by the linker.</div>
    <div class="meta">Posted on 2002-08-23 08:06:00 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-54611">
    <div class="subject"><a href="#post-54611">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">I've only use MASM, so I'm trying to understand this.  I looked at the COFF tutorial by Eoin.<br /><br />So COFF does not use the .idata section?<br /><br />Eoin's tutorial has no .idata, but he can still 'invoke SendMessage....'<br /><br />If I remove .idata and try to make an obj...<br /><br />tut03.asm [23] stdcall [3]:<br />        invoke  GetModuleHandle, NULL<br />error: invalid value.<br /><br />I have the includes.  Please help me understand when assembling for COFF, where does it get the API name from, if not from the includes?  Or am I reading the above error wrong?<br /><br />Thanks.</div>
    <div class="meta">Posted on 2002-08-23 08:46:47 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-54614">
    <div class="subject"><a href="#post-54614">Bug?? Or am I just not doing it right??</a></div>
    <div class="body"><div class="quote"><br /><br />tut03.asm [23] stdcall [3]:<br />        invoke  GetModuleHandle, NULL<br />error: invalid value.<br /> </div><br /><br />It happens in line 3 of the stdcall macro, so I guess you have no equate for NULL :) <br />Try to replace it with 0 .</div>
    <div class="meta">Posted on 2002-08-23 08:57:32 by bazik</div>
   </div>
   <div class="post" id="post-54616">
    <div class="subject"><a href="#post-54616">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">Not, not having an equate for NULL is not the problem, it errors on 0 also.<br /><br />I looked close at Eoin's tutorial.  He has a kernel32.inc and kernel32.ext.  kernel32.ext defines the names:<br /><br />extrn __imp__AddAtomA@4:dword<br />AddAtomA equ __imp__AddAtomA@4<br />AddAtom equ AddAtomA<br /><br />kernel32.inc is the same as the FASM distributions kernel.inc with one line added at the top:<br /><br />include 'include\kernel32.ext'<br /><br />.....Hmmm COFF does not like 'entry start'.  Figures becasue the linker sets the entry.<br /><br />uhoh..<br /><br />tut03.asm [45] stdcall [3]:<br />        invoke  LoadIcon, NULL, IDI_APPLICATION<br />error: invalid value.<br /><br />Well Eoin's tutorial uses some other includes besides kernel32, better grab those  :grin:<br /><br /><br /><br /><br /><br />Figured it out!!!  Thanks for the hint Privalov, and thanks to Eoin for his COFF tutorial.  I never would have know about the .ext files..  <br /><br />:alright:</div>
    <div class="meta">Posted on 2002-08-23 09:17:50 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-54852">
    <div class="subject"><a href="#post-54852">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">TheExt files were just something I threw together to make make life easier for myself. I like to use libraries and resources so I really only changed over to Fasm when coff support appeared.<br /><br />Here attached are all the ext files I've needed so far, plus the prog I use to make them. IncToExt as it's called will convert Masm inc format files to the ext files. It's not exactly a robust program, and is probably quite intollerent so stick to files supplied with Masm32.</div>
    <div class="meta">Posted on 2002-08-25 16:32:00 by Eóin</div>
   </div>
   <div class="post" id="post-54914">
    <div class="subject"><a href="#post-54914">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">Eoin, or some kind person more familar with FASM than I...<br /><br /><br /><br />I've assembled Privalov's tut03.asm to an obj.<br /><br />But I can only link an exe using /FORCE becasue of a bunch of unresolved externals.<br /><br />I'm not sure if it is something I'm doing wrong with FASM, or perhaps I do not know link well enough.<br /><br />I'm using Eoin's ext files, so I guess FASM is including the references in the obj.  I have no idea yet how to exclude them.<br /><br />I like to use libs too.(but tut03 is not a good cannidite for a lib)</div>
    <div class="meta">Posted on 2002-08-26 08:35:26 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-54991">
    <div class="subject"><a href="#post-54991">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">I've never seen that problem before, nor am I seeing it now :grin: . When I remove the FORCE directive and run the batch file the exe is made perfectly.<br /><br />What exact problem are you having?</div>
    <div class="meta">Posted on 2002-08-26 19:54:30 by Eóin</div>
   </div>
   <div class="post" id="post-54999">
    <div class="subject"><a href="#post-54999">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">I've posted the output when I link without /FORCE I get when linking. I wonder if it is my version of link? (VC7)<br /><br />I looked at the /FORCEd exe with a debugger and the jump table contains EVERY function listed in the included ext files.<br /><br />That means every function is included in the obj file too.  So Eoin, I'm wondering how you set up your tutorial to only include the needed functions int the obj file?  Thats is probably where my problem is.<br /><br />Thanks.</div>
    <div class="meta">Posted on 2002-08-26 22:22:07 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-55026">
    <div class="subject"><a href="#post-55026">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">It must be a difference between the link version, I use the one that comes with masm32. The only thing I can suggest is trying the /OPT:REF directive, or perhaps it should be /OPT:NOREF, I can't remeber which one so try both :alright:</div>
    <div class="meta">Posted on 2002-08-27 04:07:00 by Eóin</div>
   </div>
   <div class="post" id="post-55047">
    <div class="subject"><a href="#post-55047">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">Thanks Eoin.  I'll try both, maybe even the old linker.</div>
    <div class="meta">Posted on 2002-08-27 06:23:09 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-55062">
    <div class="subject"><a href="#post-55062">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">Hmmm get the same error with MASM32 link and VC7 link /OPT:REF or /OPT/NOREF<br /><br />Also get the error with your example project.  I've made no changes except file paths...<br /><br />Weird.</div>
    <div class="meta">Posted on 2002-08-27 07:51:03 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-55080">
    <div class="subject"><a href="#post-55080">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">I'm at a loss then, the only warning link gives me is<br /><br />LINK : warning LNK4089: all references to &quot;GDI32.dll&quot; discarded by /OPT:REF <br /><br />And it only gives this for libraries where I included all the extern definitions but then don't actually use any of the functions in that library.<br /><br />Its a bit strange as I never actually use the /OPT:REF directive, it seems to assume it by default.<br /><br />Someone else here must know more about link.</div>
    <div class="meta">Posted on 2002-08-27 12:11:01 by Eóin</div>
   </div>
   <div class="post" id="post-55084">
    <div class="subject"><a href="#post-55084">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">Maybe you should ask in Main, people there may know more about link.</div>
    <div class="meta">Posted on 2002-08-27 13:55:32 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-55113">
    <div class="subject"><a href="#post-55113">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">Thanks for trying. :(<br /><br />Perhaps I shall trying in main.<br /><br />Privalov, since you wrote the COFF support, I assume you understand it? If so, when an obj is made containing references to a lib(ie. kernel32.lib), is the COFF standard to put every function available in the obj?  If that is how it works, I then know it is the linkers job to select what funtions to add to the exe.  If that is not how it works, I know I'm doing something wrong in FASM.<br /><br />Also since FASM can save as a bin, couldn't someone devise there own lib format for FASM?  If so, once I understand FASM better, I might just try to do that.<br /><br />Thanks.</div>
    <div class="meta">Posted on 2002-08-27 20:46:09 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-55118">
    <div class="subject"><a href="#post-55118">Bug?? Or am I just not doing it right??</a></div>
    <div class="body">It has to be something small ThoughtCriminal as I don't seem to be doing anything special, yet the version of Link (5.12.8078) I got with masm32 is discarding all the unneeded references. And its telling me that the /OPT:REF directive is responsible for it doing that.<br /><br />If you can't figure it out try a specific thread in main about this, someone is bound to know. :)<br /><br />Perhaps also, though I don't know know what the lisence is for your version of link, you could upload it so someone else could give it a try. Just take care to avoid doing anything illegal, it ain't fair to get the board or Hiro in trouble :alright:</div>
    <div class="meta">Posted on 2002-08-27 21:18:38 by Eóin</div>
   </div>
  </div>
 </body>
</html>