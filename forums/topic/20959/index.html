<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Check if same: without FPU. - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20959" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=20959">Check if same: without FPU.</a></p>
   <div class="post" id="post-159008">
    <div class="subject"><a href="#post-159008">Check if same: without FPU.</a></div>
    <div class="body">Hello. I did the sum and sub. I am happy <br /><br />How can I know if two numbers are the same<br /><br />It must return an INT&nbsp; <br />Int = 1 if they are the same<br />Int = 0 if are different.<br /></div>
    <div class="meta">Posted on 2005-04-14 13:25:03 by luise.valencia</div>
   </div>
   <div class="post" id="post-159012">
    <div class="subject"><a href="#post-159012">Re: Check if same: without FPU.</a></div>
    <div class="body">compare_numbers proc uses ebx, number_one_value:dword, number_two_value:dword<br /><br />mov eax,number_one_value<br />mov ebx,number_two_value<br /><br />cmp eax,ebx<br />je theyarethesame<br /><br />; they arent the same<br /><br />xor eax,eax<br />ret<br /><br />theyarethesame:<br /><br />xor eax,eax<br />inc eax<br />ret<br /><br />compare_numbers endp<br /><br /><br /><br />you really should do your own homework though, otherwise you will not learn a damn thing</div>
    <div class="meta">Posted on 2005-04-14 15:05:32 by evlncrn8</div>
   </div>
   <div class="post" id="post-159015">
    <div class="subject"><a href="#post-159015">Re: Check if same: without FPU.</a></div>
    <div class="body">I am learning a lot with you<br /><br />I am gonna try to comment the code and tell me if I have something wrong<br /><br />mov eax,number_one_value&nbsp; &nbsp; &#39;Mov parameter 1 to eax<br />mov ebx,number_two_value&nbsp;  &#39;Mov parameter 2 to eax<br /><br />cmp eax,ebx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;This makes a bit comparison and sets a flag if they are equal right?<br />je theyarethesame&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;This reads that flaf<br /><br />; they arent the same<br /><br />xor eax,eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &#39;As they are not the same you make an xor, and xor of equal numbers is 0<br />ret<br /><br />theyarethesame:<br /><br />xor eax,eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;The same eax = 0<br />inc eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;eax =1<br />ret&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;It returns eax.<br /><br />compare_numbers endp<br /></div>
    <div class="meta">Posted on 2005-04-14 15:52:49 by luise.valencia</div>
   </div>
   <div class="post" id="post-159021">
    <div class="subject"><a href="#post-159021">Re: Check if same: without FPU.</a></div>
    <div class="body">It dosent return nothing, it only terminate the function and &quot;clean&quot; the stack from the function, if the function that call this function need that the return value is in eax, then you should say more like: Im storing the return value in eax because is a &quot;protocol&quot; I must follow and then Im terminating the function with macro ret.</div>
    <div class="meta">Posted on 2005-04-14 18:17:26 by rea</div>
   </div>
   <div class="post" id="post-159029">
    <div class="subject"><a href="#post-159029">Re: Check if same: without FPU.</a></div>
    <div class="body">I need to return an int.<br />1 if they are the same<br />0 if they are not the same<br /><br />How would it be?</div>
    <div class="meta">Posted on 2005-04-14 22:04:31 by luisvalencia</div>
   </div>
   <div class="post" id="post-159032">
    <div class="subject"><a href="#post-159032">Re: Check if same: without FPU.</a></div>
    <div class="body">In fact the anterior way for write is OK for return a value in your case 0 or 1.<br /><br />But Im saying that you explanation is a little &quot;bad&quot;, tought you have understood, I only whant to &quot;clean&quot; a little more your explanation.<br /><br /><pre><code><br />xor eax,eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;The same eax = 0<br />inc eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;eax =1<br />ret&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;It returns eax.<br /></code></pre><br /><br />You have make &quot;literal&quot; comments, mean taht you have commented what can be watched from the mnemonics, but not the porpuose when you see the porpuose, you will catch that it dosent return eax with ret, but ret is the return point of the anterior secuence of mnemonics.<br /><br /><br /><pre><code><br />xor eax,eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; This two lines, fill the value in eax in concordance with a &quot;protocol&quot; that exist and say that the<br />inc eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; function that call this function will try access the result of this function in eax<br />ret&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Return to the caller and clean the stack and arguments<br /></code></pre><br /><br /><br />You see ret is not returning the value in eax, because it was filled before. Also when you return ( ret macro in masm ) from the function, you are actually not returning a value, you are returning to the next instruction after the call to this function also &quot;ret&quot; align the stack &quot;cleaning&quot; the locals in the stack and the arguments in the stack if they exist in this call.<br /><br /><br /></div>
    <div class="meta">Posted on 2005-04-14 23:36:54 by rea</div>
   </div>
   <div class="post" id="post-159034">
    <div class="subject"><a href="#post-159034">Re: Check if same: without FPU.</a></div>
    <div class="body">Well its not working <br /><br />I put an 1 and 1. and it says there anot the same<br /><pre><code>SonIgualesFloat proc var1:REAL4, var2:REAL4<br />&nbsp; &nbsp; LOCAL retval:REAL4<br />&nbsp; &nbsp; PUBLIC SonIgualesFloat<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; mov eax,var1<br />	mov ebx,var2<br /><br />	cmp eax,ebx<br />	je theyarethesame<br /><br />	; they arent the same<br /><br />	xor eax,eax<br />	ret<br /><br />	theyarethesame:<br /><br />	xor eax,eax<br />	inc eax<br /><br />	ret<br />&nbsp; <br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; <br />SonIgualesFloat endp</code></pre><br /><br /><br /><pre><code>void menuSonIgualesFloat(void)<br />{<br />&nbsp; &nbsp;  int ch;<br />&nbsp; &nbsp;  float f1;<br />&nbsp; &nbsp;  float f2;<br />&nbsp; &nbsp;  printf(&quot;Primer numero\n\n&quot;);<br />	 if(scanf(&quot;%f&quot;,&amp;f1)== 1)<br />	 {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  printf(&quot;Segundo numero\n\n&quot;);<br />	&nbsp; &nbsp; &nbsp;  if(scanf(&quot;%f&quot;,&amp;f2) == 1)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int x;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = SonIgualesFloat(f1, f2);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(x == 1)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; printf(&quot;Son Iguales&quot;);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; printf(&quot;No Son Iguales&quot;);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  else<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  printf(&quot;Datos incorrectos&quot;);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp;  }<br />&nbsp; &nbsp;  else<br />&nbsp; &nbsp;  {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; printf(&quot;Datos Incorrectos, debe usar el punto para la separacion de decimales&quot;);&nbsp; &nbsp;  <br />&nbsp; &nbsp;  }<br /><br />	while ( (ch = getchar()) != &#39;\n&#39; &amp;&amp; ch != EOF) ;<br /><br />	printf(&quot;\n\nPress ENTER to continue.&quot;);<br />	while ( (ch = getchar()) != &#39;\n&#39; &amp;&amp; ch != EOF)<br />;<br />&nbsp;  if(ch==&#39;\n&#39; || ch==EOF)<br />&nbsp;  {<br />&nbsp; &nbsp; &nbsp; printmenu();&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp;  }<br />&nbsp;  <br />}</code></pre></div>
    <div class="meta">Posted on 2005-04-15 00:11:57 by luisvalencia</div>
   </div>
   <div class="post" id="post-159042">
    <div class="subject"><a href="#post-159042">Re: Check if same: without FPU.</a></div>
    <div class="body">The assumption you are making is that different types of NaN are not equal, nor are + and - 0, nor are denormalised zeros.<br /><br />If you need to guard against these cases, you&#39;ll need to do a bit more work.<br /><br />Mirno</div>
    <div class="meta">Posted on 2005-04-15 06:44:40 by Mirno</div>
   </div>
   <div class="post" id="post-159051">
    <div class="subject"><a href="#post-159051">Re: Check if same: without FPU.</a></div>
    <div class="body"><br />.......<br />&nbsp; &nbsp; XOR EAX,EAX<br />&nbsp; &nbsp; MOV EDX,Var1<br />&nbsp; &nbsp; CMP EDX,Var2<br />&nbsp; &nbsp; SETE AL&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;EAX=1 if Var1=Var2, else EAX=0<br />.......</div>
    <div class="meta">Posted on 2005-04-15 09:37:29 by MikDay</div>
   </div>
   <div class="post" id="post-159078">
    <div class="subject"><a href="#post-159078">Re: Check if same: without FPU.</a></div>
    <div class="body">Hm, checking if two floating-point numbers are the same without using FPU... I wouldn&#39;t do that. The &quot;correct&quot; way is to subtract the numbers and check whether the result is larger than &quot;some pretty small value&quot;, because floating point numbers aren&#39;t 100% stable.</div>
    <div class="meta">Posted on 2005-04-16 08:55:39 by f0dder</div>
   </div>
   <div class="post" id="post-159080">
    <div class="subject"><a href="#post-159080">Re: Check if same: without FPU.</a></div>
    <div class="body">It still returns 0 and not 1.<br /><br />1 and 1 must be the same binary representation so it must return an 1 if same but I still dont get it to work.<br /><pre><code><br /> SonIgualesFloat proc var1:REAL4, var2:REAL4<br />&nbsp; &nbsp; LOCAL retval:PTR<br />&nbsp; &nbsp; PUBLIC SonIgualesFloat<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; mov eax,var1<br />	mov ebx,var2<br /><br />	cmp eax,ebx<br />	je theyarethesame<br /><br />	; they arent the same<br /><br />	xor eax,eax<br />	ret<br /><br />	theyarethesame:<br /><br />	xor eax,eax<br />	;inc eax<br /> 	;XOR EAX,EAX<br />&nbsp; &nbsp; MOV EDX,var1<br />&nbsp; &nbsp; CMP EDX,var2<br />&nbsp; &nbsp; SETE AL <br />	<br />&nbsp; <br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; <br />SonIgualesFloat endp</code></pre></div>
    <div class="meta">Posted on 2005-04-16 09:33:59 by luisvalencia</div>
   </div>
   <div class="post" id="post-159083">
    <div class="subject"><a href="#post-159083">Re: Check if same: without FPU.</a></div>
    <div class="body">that last code snip wont return at all, you&#39;re missing the ret</div>
    <div class="meta">Posted on 2005-04-16 12:18:18 by evlncrn8</div>
   </div>
   <div class="post" id="post-159109">
    <div class="subject"><a href="#post-159109">Re: Check if same: without FPU.</a></div>
    <div class="body">Perhaps I have confused the guy?? about what is return from function and what is save a value in concordance with a &quot;protocol&quot; and how this combination &quot;makes&quot; the feel to return something from the function?.</div>
    <div class="meta">Posted on 2005-04-17 10:49:19 by rea</div>
   </div>
   <div class="post" id="post-159110">
    <div class="subject"><a href="#post-159110">Re: Check if same: without FPU.</a></div>
    <div class="body">And you need a xor eax, eax (which you missed out).</div>
    <div class="meta">Posted on 2005-04-17 11:23:30 by roticv</div>
   </div>
   <div class="post" id="post-159118">
    <div class="subject"><a href="#post-159118">Re: Check if same: without FPU.</a></div>
    <div class="body"><div class="quote"><br />Well its not working <br /><br />I put an 1 and 1. and it says there anot the same<br /></div><br /><br />As a check, have your C code compare and show the actual values of f1 and f2 in hex format. If f1 and f2 are exactly the same, the problem is parameter passing. If it&#39;s a problem with parameters, then it&#39;s because the compiler is creating double (REAL8) values before passing them to your ASM function. (If the compiler is a C compiler, or a C++ compiler compiling in C mode, this is a rule of C.)</div>
    <div class="meta">Posted on 2005-04-17 13:24:08 by tenkey</div>
   </div>
  </div>
 </body>
</html>