<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Trick to make Windows program run the DOS alternate (stub) i - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=18185" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=18185">Trick to make Windows program run the DOS alternate (stub) i</a></p>
   <div class="post" id="post-140643">
    <div class="subject"><a href="#post-140643">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body">Eh, not sure what all use this will be but I figured I'd share anyway as I've not seen this trick posted anywhere and it's just a little something I found myself fiddling around.<br /><br />Anyhow, if you are interested in making a single executable with both a DOS part and Windows part (aka utilizing the stub) so that you have some sort of viable alternative that runs under DOS if that is used (which probably isn't too relavant nowadays, but what the hey?) then here is all you'll need to do for testing your DOS part under Windows.<br /><br />Use a hex editor (or MS-DOS edit) and reverse the MZ at the first two bytes (should look like ZM) save the file then execute it.  It will display the DOS behavior.:)<br /><br />This works on both NE files (Win16) and PE files (Win32)<br /><br />I think the reason for this is because ZM is a valid start of a DOS executable (though very rare) but is NOT for a Windows one.<br /><br />Hence you can test out what the DOS part does of any program this way:)</div>
    <div class="meta">Posted on 2004-05-02 00:54:22 by ShortCoder</div>
   </div>
   <div class="post" id="post-140644">
    <div class="subject"><a href="#post-140644">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body">Afternoon, ShortCoder.<br /><br />Just tested that out. You're right - it works.<br /><br />Thanks for the info.<br /><br />Cheers,<br />Scronty</div>
    <div class="meta">Posted on 2004-05-02 02:20:35 by Scronty</div>
   </div>
   <div class="post" id="post-140646">
    <div class="subject"><a href="#post-140646">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body">Nice trick:alright:</div>
    <div class="meta">Posted on 2004-05-02 03:12:32 by Vortex</div>
   </div>
   <div class="post" id="post-140681">
    <div class="subject"><a href="#post-140681">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body">You could also just test the DOS stub part without appending a PE exe :p<br /><br />And yes, ZM is a valid dos signature, some old virii used it to check if they had already infected a file...</div>
    <div class="meta">Posted on 2004-05-02 08:29:18 by f0dder</div>
   </div>
   <div class="post" id="post-140819">
    <div class="subject"><a href="#post-140819">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body">Apparently programmers at Microsoft forgot to test for ZM as well when coding the PE loader.<br /><br />As I recall, Luevelsmeyer's tutorial on PE files recommended to check for both signatures, but it appears not to be necessary then...</div>
    <div class="meta">Posted on 2004-05-03 17:48:14 by QvasiModo</div>
   </div>
   <div class="post" id="post-140820">
    <div class="subject"><a href="#post-140820">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body"><div class="quote"><br />And yes, ZM is a valid dos signature, some old virii used it to check if they had already infected a file... </div><br />I wonder if a ZM signature triggers any heuristic flags... I think it did for TBAV but I have a very bad memory :P</div>
    <div class="meta">Posted on 2004-05-03 17:49:30 by QvasiModo</div>
   </div>
   <div class="post" id="post-140827">
    <div class="subject"><a href="#post-140827">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body">It has in the past, dunno if it does anymore. But I wouldn't use it anyway.</div>
    <div class="meta">Posted on 2004-05-03 18:13:03 by f0dder</div>
   </div>
   <div class="post" id="post-140829">
    <div class="subject"><a href="#post-140829">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body">Actually, 'ZM' is a valid EXE signature before DOS 2.0.  I don't have an explanation for why it came to life, but I suspect some people were confused about the byte-order and just put something like mov word ptr ,'MZ'.  And, then, DOS had to maintain the compatibility.</div>
    <div class="meta">Posted on 2004-05-03 18:13:32 by Starless</div>
   </div>
   <div class="post" id="post-140871">
    <div class="subject"><a href="#post-140871">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body"><div class="quote"><br />It has in the past, dunno if it does anymore. But I wouldn't use it anyway. </div><br />For any particular reason? I'm still using that AV, always had a high concept of it. :confused:</div>
    <div class="meta">Posted on 2004-05-04 12:06:53 by QvasiModo</div>
   </div>
   <div class="post" id="post-140878">
    <div class="subject"><a href="#post-140878">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body">Well, I was referring to ZM rather than MZ signature with &quot;wouldn't use it anyway&quot; :). So, TBAV still exists? I stopped using it not too long after the windows version arrived, it didn't work really well imo. ThunderByte was bought by some other company too, wasn't it?<br /><br />These days it's Kaspersky and F-Prot for me... those are still decent products. Norton AV at the museum even though it sucks, but it catches the email spam and is automated + doesn't cause a fuss.</div>
    <div class="meta">Posted on 2004-05-04 12:45:00 by f0dder</div>
   </div>
   <div class="post" id="post-140890">
    <div class="subject"><a href="#post-140890">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body"><div class="quote"><br />mov word ptr ,'MZ'.  And, then, DOS had to maintain the compatibility. </div><br /><br />Good explanation !<br />However, this shows a defect in assembler, it is not only a programmer's fault. A good assembler must assemble it properly. (sorry masm :) )</div>
    <div class="meta">Posted on 2004-05-04 13:39:04 by pelaillo</div>
   </div>
   <div class="post" id="post-140964">
    <div class="subject"><a href="#post-140964">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body"><div class="quote"><br />Well, I was referring to ZM rather than MZ signature with &quot;wouldn't use it anyway&quot; :)</div><br />LOL! Sorry :grin:<br /><div class="quote"><strong>So, TBAV still exists? I stopped using it not too long after the windows version arrived, it didn't work really well imo. ThunderByte was bought by some other company too, wasn't it?<br /><br />These days it's Kaspersky and F-Prot for me... those are still decent products. Norton AV at the museum even though it sucks, but it catches the email spam and is automated + doesn't cause a fuss. </div><br />Yes, it was. I'm still using my ancient copy of TBAV because it's the only one I know of that still shows you the heuristic flags. F-prot doesn't do that anymore, but it's the one I use for detecting known viruses.<br /><br />Is Kaspersky's AV freeware? I haven't checked in a long time...</div>
    <div class="meta">Posted on 2004-05-12 15:20:39 by QvasiModo</div>
   </div>
   <div class="post" id="post-140967">
    <div class="subject"><a href="#post-140967">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body">No it's not, but I think there might be a trial version. You don't get (good) things for free these days, anyway. If you're still using an old dos TBAV, you might as well not use antiviral protection I'm afraid...</div>
    <div class="meta">Posted on 2004-05-12 15:30:45 by f0dder</div>
   </div>
   <div class="post" id="post-140968">
    <div class="subject"><a href="#post-140968">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body">It's not THAT old... it's for Win95, one of the first. But I couple it with FPROT anyway. :)</div>
    <div class="meta">Posted on 2004-05-12 15:34:18 by QvasiModo</div>
   </div>
   <div class="post" id="post-140974">
    <div class="subject"><a href="#post-140974">Trick to make Windows program run the DOS alternate (stub) i</a></div>
    <div class="body">I described the trick years ago :)</div>
    <div class="meta">Posted on 2004-05-12 16:03:25 by The Svin</div>
   </div>
  </div>
 </body>
</html>