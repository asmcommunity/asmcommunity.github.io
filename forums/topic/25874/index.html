<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Progress Bar Help - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25874" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25874">Progress Bar Help</a></p>
   <div class="post" id="post-188693">
    <div class="subject"><a href="#post-188693">Progress Bar Help</a></div>
    <div class="body">Hello:<br /><br />I am attempting to make a progress bar with text in the middle to show a percentage. Searching the forum I found clues about floating a transparent static control over the progress bar. This seems to work but the static control does not repaint its own background so the text looks messed up after awhile. To get around this I use ShowWindow to hide the static control, then ShowWindow to make it visible again. Is there a better way? Also the progress bar does not honor the settings in the resource file for PBS_SMOOTH. Is it possible to set the style to PBS_SMOOTH after it is drawn in the dialogbox from a resource?&nbsp; Does anyone have this file: progressproc.asm from a 2001 post? It shows how to subclass the progress bar and paint text on it directly. Or does anyone have a ready made control or source code for a horizontal progress bar with text inside it? <br /><br />(Already looked at Gradprogress. It does not have text inside the progress bar, and I cant seem to figure out how to draw text inside it.)<br /><br />Thanks in advance,<br />SS<br /><br /></div>
    <div class="meta">Posted on 2007-04-01 02:32:10 by SideSwipe</div>
   </div>
   <div class="post" id="post-188694">
    <div class="subject"><a href="#post-188694">Re: Progress Bar Help</a></div>
    <div class="body">Why don&#39;t you ... ?<br /><br /><ul><br /><li>Get the handle of the Progress Bar</li><br /><li>Get the Device Context handle of the Progress Bar with GetDC()</li><br /><li>Write text to the Device Context using TextOut</li><br /></ul><br /><br />I was going to give you an example with a pseudocode but I then coded it in Delphi. I hope that it is okay with moderators because if it is not, I can replace it with an Assembly code. I just did it in Delphi because I didn&#39;t have time so, sorry.<br /><br /><pre><code>Function DrawTextOnProgressBar (ProgressBarHandle : HWND; Const Text : PChar;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BackgroundColor, ForegroundColor : Cardinal;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XPosition, YPosition : Cardinal) : Boolean;<br />Var<br />&nbsp; WindowClass : Array[0..255] of Char;<br />&nbsp; WindowDC&nbsp; &nbsp; : HDC;<br />&nbsp; Background&nbsp; : Cardinal;<br />Const<br />&nbsp; PROGRESSCLASS = &#39;msctls_progress32&#39;;<br />begin<br />Result := False;<br />if (IsWindow(ProgressBarHandle) = False) or<br />&nbsp;  (IsWindowVisible(ProgressBarHandle) = False) then<br />&nbsp; Exit;<br />GetClassName(ProgressBarHandle, WindowClass, SizeOf(WindowClass));<br />if (lstrcmpi(PROGRESSCLASS, WindowClass) &lt;&gt; 0) then<br />&nbsp; Exit;<br />WindowDC := GetDC(ProgressBarHandle);<br />if (WindowDC = 0) then<br />&nbsp; Exit;<br />SetBkColor(WindowDC, BackgroundColor);<br />SetTextColor(WindowDC, ForegroundColor);<br />Result := TextOut(WindowDC, XPosition, YPosition , Text, lstrlen(Text));<br />ReleaseDC(ProgressBarHandle, WindowDC);<br />end;</code></pre><br /><br /><br />It allows you to put the handle of the Progress Bar on which you want to draw a text, your text, the foreground and the background colors of the text and finally, the X and Y location of the text. Hope it helps.</div>
    <div class="meta">Posted on 2007-04-01 04:51:32 by XCHG</div>
   </div>
   <div class="post" id="post-188700">
    <div class="subject"><a href="#post-188700">Re: Progress Bar Help</a></div>
    <div class="body">Hello XCHG:<br /><br />Thanks for the reply. Outputting text directly to the progress bar control saved me from using a static control overlayed on top of the progressbar. However, I am back to the problem with the progress bar looking messed up as the text changes. I tried to use ShowWindow to hide and display the progress bar, but the text still looks messed. How do I get the progress bar to redraw itself?&nbsp; Or, how do I get the overlayed text to not look all roostered?<br /><br />This is what I have so far. Any help appreciated!<br /><br />invoke SendMessage,h_progress1, PBM_SETPOS, 60, 0 ;put some bars in the progress bar<br />invoke GetDC,h_progress1<br />mov h_progress1_DC,eax<br />invoke SetBkMode,h_progress1_DC,TRANSPARENT<br />invoke TextOut,h_progress1_DC,10,1,ADDR random_number_text,6 ;;;;ie: 18.48, 17.55 etc...<br />invoke ReleaseDC,h_progress1,h_progress1_DC<br /><br />Also, is it possible to set the style to PBS_SMOOTH after it is drawn in the dialogbox from a resource? How do I do this?<br /><br />Regards,<br />SS</div>
    <div class="meta">Posted on 2007-04-01 10:53:41 by SideSwipe</div>
   </div>
   <div class="post" id="post-188703">
    <div class="subject"><a href="#post-188703">Re: Progress Bar Help</a></div>
    <div class="body">Hello Again:<br /><br />OK, so I have answered one of my own questions. To change the style of a window or control use SetWindowLong. I use SetWindowLong to change the style of my progress bar to PBS_SMOOTH like this:<br /><br />invoke SetWindowLong,h_progress1,GWL_STYLE, WS_VISIBLE or WS_CHILD or PBS_SMOOTH<br /><br />Problem is, it did not work, the progress bar still shows segmented. I figured out the problem was I am using a XML stylesheet in the .RC file like this:<br /><br />1&nbsp; &nbsp;  24&nbsp; &nbsp; &nbsp; DISCARDABLE&nbsp; &nbsp;  &quot;xptheme.xml&quot;<br /><br />This gives my app the nice XP style controls. When I remove the above line from the RC file then the Progress Bar Smooth style works. Also when the above line is removed from the RC file then the resource editor properties work again and I don&#39;t need SetWindowLong at all.<br /><br />What am I doing wrong? How can I get the nice XP style effect and still be able to set the progress bar to PBS_SMOOTH ? Below is the XML file I found on this board.<br /><br /><br /><br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt; <br />&lt;assembly <br />&nbsp;  xmlns=&quot;urn:schemas-microsoft-com:asm.v1&quot; <br />&nbsp;  manifestVersion=&quot;1.0&quot;&gt;<br /> &lt;assemblyIdentity <br />&nbsp; &nbsp; processorArchitecture=&quot;x86&quot; <br />&nbsp; &nbsp; version=&quot;5.1.0.0&quot;<br />&nbsp; &nbsp; type=&quot;win32&quot;<br />&nbsp; &nbsp; name=&quot;MyApp&quot;/&gt;<br /> &lt;description&gt;Program Description&lt;/description&gt;<br /> &lt;dependency&gt;<br />&nbsp; &lt;dependentAssembly&gt;<br />&nbsp; &nbsp; &lt;assemblyIdentity<br />&nbsp; &nbsp; &nbsp; &nbsp;  type=&quot;win32&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp;  name=&quot;Microsoft.Windows.Common-Controls&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp;  version=&quot;6.0.0.0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp;  publicKeyToken=&quot;6595b64144ccf1df&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp;  language=&quot;*&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp;  processorArchitecture=&quot;x86&quot;/&gt;<br />&nbsp; &lt;/dependentAssembly&gt;<br /> &lt;/dependency&gt;<br />&lt;/assembly&gt;<br /><br /></div>
    <div class="meta">Posted on 2007-04-01 12:38:29 by SideSwipe</div>
   </div>
  </div>
 </body>
</html>