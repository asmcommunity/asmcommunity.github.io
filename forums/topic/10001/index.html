<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Assembly Tool 'LIBM v2.2' - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10001" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=10001">Assembly Tool 'LIBM v2.2'</a></p>
   <div class="post" id="post-74746">
    <div class="subject"><a href="#post-74746">Assembly Tool 'LIBM v2.2'</a></div>
    <div class="body">Hello all,<br /><br />Here is my final release of the LIBM.EXE library assembly tool.  Im postin in a new thread because <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=9910">this thread</a> had become very convoluted from working out a few past bugs.<br /><br />Im releasing it with source for those who are interested.  It uses our OOP model for file access.  The CFile.inc is the File handler class, and is an old quick and dirty hack that I once did a long while ago.  It works, but its far from optimized code ( there is some fat in this class that can use some trimming ~ but for the tool's purpose it doesnt matter) ;)<br /><br />The program should be straight forward to follow<ul><br />[*]1) Get the commandline<br />[*]2) Check Params and if need be delete/create a working directory<br />[*]3) Open asm file<br />[*]4) Find header start<br />[*]5) Find header end<br />[*]While more PROC's<br />[*]- 6) Find first PROC<br />[*]- 7) Find first following ENDP<br />[*]- 8) Get ProcName<br />[*]- 9) Make new Asm Called 00[?].asm<br />[*]- 10) Copy Header to new ASM<br />[*]- 11) Copy PROC to new ASM<br />[*]- 12) CLose ASM and loop back to step 6<br />[*]13) Make Include file from ProcNames and ProtoLists<br />[*]14) Run ML /c /nologo /coff *.asm<br />[*]15) Run LIB *.obj /out:filename.lib<br />[*]16) Copy back to current user directory filename.*<br />[*]17) Exit.<br /><br /><span style="font-size:60>So how do i use it?</span> <br /><br />Please look at the provided MyLibSrc.ASM file.  I acutaly compiled this lib and used it to make this source, to show it works.<br /><br />There is a few things to remember when making a single ASM file to host multple, separately linking, functions.<br /><br />You MUST have <strong>;HEADER START</strong> and <strong>;HEADER END</strong> labels around the assembler directives and includes used.  The thing to remember is this 'block' is cut &amp; pasted by the tool as the header for each unique asm file generated.  If you do or dont want code in every function file, here is where to look.<br /><br />The tool is dumb in the sence it doesnt care about semicolons.  So dont have ' proc' in a comment, or it will fool the tool into thinking its a new function declairation.   This is the only real short comming i didnt chase out.  However, if you have a PROC within the function it will be ignored (such as invoke <strong>Proc</strong>eedure2, ...).  So this is only a problem for text found between functions... something im willing to live with ;) .  Also do not have PROC in the function name itself, as this is considered ouside the PROC/ENDP scope..<br /><br />You can only have one PUBLIC function per file generated.  You can have multiple private functions in the same file tho (which are called upon by the public function). To do this, you actually 'trick' the tool (which saves me coding/dreaming up more ;lables) ;).  Here is an example:<pre><code><br />PublicFunciton &#91;b&#93;&#91;COLOR=orangered&#93;PROC&#91;/COLOR&#93;&#91;/b&#93;&#91;COLOR=blue&#93;  param&#58;DWORD<br />&#91;b&#93;  PrivateFunction1 PROTO &#58;REAL8<br />  PrivateFunction2 PROTO &#58;DWORD<br /><br />  SKIP_NEXT TEXTEQU &lt;endp&gt;  ;no spaces in &lt;&gt;&#91;/b&#93;<br /><br />  .data<br />     MyDataForThisFile REAL8 2.2<br />  .data?<br />    MyData?Too db 0<br />  .const<br />    crap dd 123h<br />  .code<br /><br />  xor eax, eax<br />  invoke PrivateFunction1,  addr MyDataForThisFile<br />  ret<br />PublicFunction &#91;b&#93;SKIP_NEXT&#91;/b&#93;<br /><br />PrivateFunction1 PROC private ar8&#58;REAL8<br />  nop<br />  invoke PrivateFunction2<br />  ret<br />PrivateFunction1 &#91;b&#93;SKIP_NEXT&#91;/b&#93;<br /><br />PrivateFunction2 PROC<br />  add eax, 3<br />  ret<br />PrivateFunction2 &#91;/color&#93;&#91;b&#93;&#91;COLOR=orangered&#93;ENDP&#91;/COLOR&#93;&#91;/b&#93;</code></pre><br />The tool only sees a start PROC from 'PublicFunction' and then hunts down the first ENDP instance (ignoring PROC's inbetween).  So by using a MASM text equate the tool skips over the private functions until the last one is done where an ENDP is finally exposed.  As well only the PublicFunction will have an INCLUDE proto generated by the tool.  The private ones were never noticed.  So the file generated would have a header and the above code directly copied, as if it were one big function in the tools eyes.<br /><br /><span style="font-size:60>What there is more?</span> <br />To compile an asm file the tool will accept both x:\path and .\path (. being current directory).  Here are valid examples:<br /><br /><strong>LIBM x:\path\path2\libfile.asm<br />LIBM libfile.asm<br />LIBM .\subfolder\libfile.asm</strong><br /><br />All of these above examples will use the \WINDOWS\TEMP\MASMLIB\ temp directory to do its dirty work.  The directory is either created if not present, or will have its contents deleted before running.<br /><br />If you hate digging thu your \windows folder, the tool has an optional output directory which can be more local to your project.<br /><br /><strong>LIBM x:\path\libfile.asm x:\OutputDir\Workhere<br />LIBM libfile.asm .\OutputDir</strong><br /><br />In this case, if the optional output directory is not there is creates it and works in it.  If the directory already exists, you will be greated with a message &quot;<strong>WARNING: About To Delete Unknown Directory! Proceed: ?</strong>&quot;.  This is to ensure your dont accidently erease say your \Masm\include\ directory ;) .  If you hit any other key than ( y ) it will automatically abort.<br /><br />Files generated are labled by the first 5 characters from the public PROC function, followed by a three digit number, dot ASM.  The 3 digit number increments from each function to the next.  This is to ensure no two files are the same name, yet give you a 5 char 'best guess' as to what fucntion is in the file.   The .obj's and .ams's are not erased from the working directory until it is used again by the LIBM tool.  So you can also collect them and save them for other uses later...<br /><br />Well i think i covered everything... Hope you can enjoy it.  It works well on my WIN98SE machine and im presently happy with it.  Let me know what you think..  I tried to give it as much punch as i could within the timeframe of last weekend (i didnt want to spend alot of time on this)...<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2003-01-06 22:50:07 by NaN</div>
   </div>
   <div class="post" id="post-75111">
    <div class="subject"><a href="#post-75111">Assembly Tool 'LIBM v2.2'</a></div>
    <div class="body">Hi NaN :) <br /><br />I was so busy for the last couple days and i am still busy working.<br />Anyway, I just want to say thanks for your tools &amp; source code. Also thank you very much for your time for making this lib :alright: <br /><br />Best regards</div>
    <div class="meta">Posted on 2003-01-08 14:45:22 by HermanT</div>
   </div>
  </div>
 </body>
</html>