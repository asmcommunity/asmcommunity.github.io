<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>why toolbar control buttons is lost in Rebar bands - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=22488" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=22488">why toolbar control buttons is lost in Rebar bands</a></p>
   <div class="post" id="post-168729">
    <div class="subject"><a href="#post-168729">why toolbar control buttons is lost in Rebar bands</a></div>
    <div class="body">Hi, everyone,<br />&nbsp; &nbsp; &nbsp; &nbsp;  I&#39;v create a toolbar with several buttons contained in a rebar band in WM_CREATE message,well the toolbar display well when max-min the main-window,but while&nbsp; I click any place in the client area,the toolbar buttons disappeared and only the rebar frame left:<br /><pre><code><br />BuildRebar proc hParent:dword<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL hwndRebar:HWND<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL WhWnd&nbsp; &nbsp; :HWND<br />&nbsp; &nbsp; &nbsp; &nbsp; LOCAL lResult&nbsp; :DWORD<br /><br />&nbsp; &nbsp; &nbsp; &nbsp;  ;-------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; ;1.Create the rebar window<br />&nbsp; &nbsp; &nbsp; &nbsp; ;-------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; push hParent<br />&nbsp; &nbsp; &nbsp; &nbsp; pop WhWnd<br />&nbsp; &nbsp; &nbsp; &nbsp; Invoke CreateWindowEx, WS_EX_TOOLWINDOW, addr ReBarClassName, NULL,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  WS_CHILD Or WS_CLIPCHILDREN Or WS_CLIPSIBLINGS Or WS_VISIBLE or WS_BORDER Or RBS_VARHEIGHT Or&nbsp; RBS_BANDBORDERS OR&nbsp; CCS_NODIVIDER OR CCS_NOPARENTALIGN ,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0, 0, rcClient.right, 10, WhWnd, NULL, ghInst, NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; mov hwndRebar,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; .if hwndRebar==NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke MessageBox,NULL,CTEXT(&quot;Create Rebar Window Error.&quot;),addr szFatalError,MB_ICONASTERISK<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jmp @F<br />&nbsp; &nbsp; &nbsp; &nbsp; .endif<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; ;2.Create the toolbar window<br />&nbsp; &nbsp; &nbsp; &nbsp; ;--------------------------<br />&nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke	CreateToolbarEx,hwndRebar,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WS_CHILD or WS_VISIBLE or WS_BORDER or TBSTYLE_TOOLTIPS OR\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  CCS_NOPARENTALIGN,\<br />		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IDR_TOOLBAR, MAXBUTTONS, HINST_COMMCTRL, IDB_STD_SMALL_COLOR, \<br />		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ADDR TBButtons,NUMBUTTONS , cxSmIcon, cySmIcon, cxSmIcon, cySmIcon, sizeof TBBUTTON<br />&nbsp; &nbsp; &nbsp; &nbsp; mov	hTBWnd,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; ;----------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; ;2.Initialize and send the REBARINFO structure(shared by all bands)<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; mov rbi.cbSize,sizeof REBARINFO&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;size of REBARINFO<br />&nbsp; &nbsp; &nbsp; &nbsp; mov rbi.fMask, 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;must be<br />&nbsp; &nbsp; &nbsp; &nbsp; m2m rbi.himl,0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;Handle to an image lis<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage,hwndRebar,RB_SETBARINFO,0,ADDR rbi&nbsp; ;insert	<br />&nbsp; &nbsp; &nbsp; &nbsp; ;.if eax==NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; ;	invoke MessageBox,hParent,CTEXT(&quot;Initial Rebar Info Error.&quot;),\<br />&nbsp; &nbsp; &nbsp; &nbsp; ;	&nbsp; &nbsp; &nbsp; &nbsp; szFatalError,MB_ICONERROR<br />&nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp; &nbsp; &nbsp; &nbsp; jmp @F<br />&nbsp; &nbsp; &nbsp; &nbsp; ;.endif<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ;------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; ;3.Initialize structure members that all bands will share.<br />&nbsp; &nbsp; &nbsp; &nbsp; ;------------------------------------------------------------------------<br />	mov rbbi.cbSize, SIZEOF REBARBANDINFO&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;size<br />	<br />	mov rbbi.fMask, RBBIM_COLORS or RBBIM_CHILD or RBBIM_CHILDSIZE or \&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RBBIM_STYLE or RBBIM_ID<br />	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />	invoke GetSysColor,COLOR_BTNTEXT<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp;  rbbi.clrFore,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke GetSysColor,COLOR_BTNFACE<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp;  rbbi.clrBack,eax<br /><br />		;fStyle should include RBBS_GRIPPERALWAYS<br />		;otherwise gripper may or may not be displayed<br />		&nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; mov rbbi.fStyle,RBBS_NOVERT or \&nbsp; &nbsp;  ;do not display in vertical orientation<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RBBS_CHILDEDGE or \&nbsp; ;display the top and bottom edge of child window<br />	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RBBS_GRIPPERALWAYS&nbsp;  ;always display gripper<br />	<br />	push hTBWnd<br />	pop&nbsp; rbbi.hwndChild<br />	<br />	push IDR_TOOLBAR<br />	pop&nbsp; rbbi.wID<br />	<br />	mov&nbsp; eax,rcClient.right<br />	shr&nbsp; eax,1&nbsp; &nbsp; &nbsp;  <br />	mov&nbsp; rbbi.cxMinChild,eax&nbsp; &nbsp; &nbsp; &nbsp; ;the band&#39;s mini width is 1/2 of client window <br />&nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; eax,cySmIcon <br />&nbsp; &nbsp; &nbsp; &nbsp; shr&nbsp; eax,1<br />&nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; eax,cySmIcon<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; rbbi.cyMinChild,eax&nbsp; &nbsp; &nbsp; &nbsp; ;the band&#39;s mini height is 3/2 cySmIcon<br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage,hwndRebar,RB_INSERTBAND,-1,addr rbbi&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; Invoke ShowWindow,hwndRebar,SW_SHOWNORMAL&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />@@:&nbsp; &nbsp;  <br /> <br />	mov eax, hwndRebar<br />	ret<br />BuildRebar endp<br /></code></pre><br /><br />&nbsp;  the WM_CREATE :<br /><pre><code><br />WM_CREATE:<br />;...<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;-----------------------------------------------<br />	&nbsp; &nbsp; &nbsp; &nbsp; ;creat Rebar window<br />	&nbsp; &nbsp; &nbsp; &nbsp; ;----------------------------------------------<br />	&nbsp; &nbsp; &nbsp; &nbsp; invoke BuildRebar,hWin<br />	&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp;  eax<br />	&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp; hRebar<br />;...<br /></code></pre><br /><br /> the WM_SIZE message<br /><pre><code>&nbsp; &nbsp; &nbsp; &nbsp; .elseif uMsg== WM_SIZE<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; invoke SendMessage,hToolBar,TB_AUTOSIZE,0,0<br /><br />		&nbsp; &nbsp; &nbsp; &nbsp;  ;Get the client area window width and height<br />		&nbsp; &nbsp; &nbsp; &nbsp;  ;invoke SendMessage,hToolBar,TB_AUTOSIZE,0,0<br />		&nbsp; &nbsp; &nbsp; &nbsp;  m2m caW, lParam[0]&nbsp; ; client area width<br />		&nbsp; &nbsp; &nbsp; &nbsp;  m2m caH, lParam[2]&nbsp; ; client area height<br />		<br />		&nbsp; &nbsp; &nbsp; &nbsp;  <br />		&nbsp; &nbsp; &nbsp; &nbsp;  invoke GetWindowRect,hRebar,ADDR rcRebar<br />		&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; eax,rcRebar.bottom<br />		&nbsp; &nbsp; &nbsp; &nbsp;  sub&nbsp; &nbsp; eax,rcRebar.top<br />		&nbsp; &nbsp; &nbsp; &nbsp;  <br />		&nbsp; &nbsp; &nbsp; &nbsp;  invoke MoveWindow,hRebar,0,0,caW,eax,TRUE<br />		&nbsp; &nbsp; &nbsp; &nbsp; <br />		&nbsp; &nbsp; &nbsp; &nbsp;  ;re-size status bar window<br />		&nbsp; &nbsp; &nbsp; &nbsp;  invoke GetWindowRect,hStatus,ADDR rcStatus<br />		&nbsp; &nbsp; &nbsp; &nbsp;  mov eax, rcStatus.bottom<br />		&nbsp; &nbsp; &nbsp; &nbsp;  sub eax, rcStatus.top<br />		&nbsp; &nbsp; &nbsp; &nbsp;  sub caH, eax<br />		&nbsp; &nbsp; &nbsp; &nbsp;  invoke MoveWindow,hStatus,0,caH,caW,caH,TRUE<br /></code></pre><br /><br /><br />&nbsp;  Do I lost something to repair the rebar?<br />&nbsp; &nbsp; &nbsp; Thanks in avdvance!<br />&nbsp; &nbsp; &nbsp; &nbsp; Bst regards!</div>
    <div class="meta">Posted on 2005-12-10 04:17:14 by Luckrock</div>
   </div>
   <div class="post" id="post-168732">
    <div class="subject"><a href="#post-168732">Re: why toolbar control buttons is lost in Rebar bands</a></div>
    <div class="body">hi, luckrock, see the following tutorial and it&#39;s source codes. <br />Perhaps you will get something from it. :D&nbsp; &nbsp; <a target="_blank" href="http://211.90.241.130:22366/view.asp?file=20">http://211.90.241.130:22366/view.asp?file=20</a><br /><br />BTW: there&#39;s some codes in the package of MASM32 .<br />&nbsp; &nbsp; &nbsp; &nbsp;  the tutorials in RadAsm IS ALSO PERFECT.&nbsp; <a target="_blank" href="http://www.radasm.com/projects/Demo.zip"> http://www.radasm.com/projects/Demo.zip</a></div>
    <div class="meta">Posted on 2005-12-10 06:11:47 by miaomiao</div>
   </div>
   <div class="post" id="post-168733">
    <div class="subject"><a href="#post-168733">Re: why toolbar control buttons is lost in Rebar bands</a></div>
    <div class="body">Hi,Miaomiao<br />    Thanks.althought both are worth studying.    Well,the first tut is not related to rebar control.and the second is based on a dialog.<br />not suit to my win32 sdi app case.<br />&nbsp; &nbsp; Anyway,thanks&nbsp; a lot<br />&nbsp;  BST RGS.<br />&nbsp; &nbsp; </div>
    <div class="meta">Posted on 2005-12-10 07:04:18 by Luckrock</div>
   </div>
  </div>
 </body>
</html>