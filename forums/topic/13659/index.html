<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>How do I make a simple text and/or number array? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13659" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=13659">How do I make a simple text and/or number array?</a></p>
   <div class="post" id="post-105821">
    <div class="subject"><a href="#post-105821">How do I make a simple text and/or number array?</a></div>
    <div class="body">I'm used to programming in VB using the syntax below for arrays and would like to know how to do the same in assembler, such as how to declare an array variable, how to write data to the array, and how to read from it, thanks:<br /><br />VB Code Logic Example:<br /><br />'Put 3 text items into string array.<br />strArray(0) = &quot;Item 1&quot;<br />strArray(1) = &quot;Item 2&quot;<br />strArray(2) = &quot;Item 3&quot;<br /><br />'Put 3 number items into number array.<br />intArray(1) = 1<br />intArray(2) = 2<br />intArray(3) = 3<br /><br />'Read string from string array.<br />msgbox strArray(1),vbOKOnly,&quot;String Read&quot;<br /><br />'Read number from number array.<br />msgbox intArray(1),vbOKOnly,&quot;Number Read&quot;</div>
    <div class="meta">Posted on 2003-06-03 01:27:06 by Knight Chat X</div>
   </div>
   <div class="post" id="post-105822">
    <div class="subject"><a href="#post-105822">How do I make a simple text and/or number array?</a></div>
    <div class="body">Well, if you consider how VB probably does it the answer is clear. Store your strings in a memory buffer and save the offset of the beginning of the string. The offset is saved to an array of DWORDs. For example :<br /><br />&gt;allocate enough memory for your strings and get the base pointer<br />invoke HeapCreate,HEAP_NO_SERIALIZE,4096,NULL<br />mov hHeap,eax<br />test eax,eax<br />jnz @F<br />	invoke ExitProcess,eax<br />@@:<br />invoke HeapAlloc,hHeap,HEAP_ZERO_MEMORY,4096<br />mov pHeap,eax<br />mov baseptr,pHeap<br /><br />; baseptr is used to keep track of where the end of the array is.<br /><br />NumArray would be like a DIM statement (in this case 256 elements max):<br /><br />NumArray dd <strong>256</strong> DUP (0)<br /><br /><strong>Adding strings</strong><br />; copy a string into the array<br />invoke lstrcpy,baseptr,ADDR String<br />; Save the base pointer into the current var<br />mov edi,OFFSET NumArray<br />mov ,baseptr<br />;Set the new base ptr<br />invoke lstrlen,ADDR String<br />add baseptr,eax<br />inc baseptr<br /><br /><strong>Reading strings</strong><br />mov edi,pHeap<br />invoke MessageBox,NULL,,NULL,MB_OK<br /><br />There are garbage collection problems associated with this method however so it is best used with arrays that will not change alot.</div>
    <div class="meta">Posted on 2003-06-03 01:49:08 by donkey</div>
   </div>
   <div class="post" id="post-105823">
    <div class="subject"><a href="#post-105823">How do I make a simple text and/or number array?</a></div>
    <div class="body">Number arrays are indexed as follows :<br /><br />Just create an array of DWORDS using DUP<br /><br />Array DWORD 1024 DUP (0)<br /><br />then use this addressing mode to assign and read values :<br /><br />mov edi,OFFSET Array<br />mov ,1<br />mov ,1<br />mov ,1<br /><br />The second parameter (0,1,2...) is the element number that you wish to access, the 4 is for 4 bytes (DWORD)<br /><br />I think you're allowed to do this in MASM as well:<br /><br />mov Array[1],1<br />mov Array[2],1<br />mov Array[3],1</div>
    <div class="meta">Posted on 2003-06-03 01:52:23 by donkey</div>
   </div>
   <div class="post" id="post-105826">
    <div class="subject"><a href="#post-105826">How do I make a simple text and/or number array?</a></div>
    <div class="body"><pre><code><br />.data<br />string1 db &quot;item1&quot;,0<br />string2 db &quot;item2&quot;,0<br />string3 db &quot;item3&quot;,0<br />string4 db &quot;item4&quot;,0<br />stringtable dd offset string1, offset string2, offset string3, offset string4<br /><br />.code<br />lea edi, stringtable<br />mov eax, &#91;edi&#93; ;first string<br />mov eax, &#91;edi&#93;&#91;1*4&#93;;second string<br />mov eax, &#91;edi&#93;&#91;2*4&#93;;third string<br />mov eax, &#91;edi&#93;&#91;3*4&#93;;fourth string<br /></code></pre><br /><br /><pre><code><br />.data?<br />array dd 4 dup &#40;?&#41;<br /><br />.code<br />mov array, eax<br />mov &#91;array+4&#93;,eax<br />mov &#91;array+8&#93;,eax<br />mov &#91;array+12&#93;,eax<br /></code></pre><br />Should work me thinks. :rolleyes:</div>
    <div class="meta">Posted on 2003-06-03 03:12:19 by roticv</div>
   </div>
   <div class="post" id="post-105836">
    <div class="subject"><a href="#post-105836">How do I make a simple text and/or number array?</a></div>
    <div class="body">I like the string method roticv but it is only useful if you have fixed compile-time strings. With run-time strings you would be required to set the maximum size possible for each entry, an incredible waste of space. Consider if you were storing paths, MAX_PATH is 260 characters, for the most part your array would contain NULLs. Also declaring a large array in the data section makes for really big executables. The garbage collect problem is solved as there is no expansion of the array possible and therefore no contraction either.<br /><br />The number array is essentially just a syntax change, in MASM I would prefer the Array syntax, it seems clearer and would lend itself more easily to debugging later.</div>
    <div class="meta">Posted on 2003-06-03 05:07:52 by donkey</div>
   </div>
   <div class="post" id="post-105849">
    <div class="subject"><a href="#post-105849">How do I make a simple text and/or number array?</a></div>
    <div class="body">Actually can store the array on the stack.<br /><pre><code><br />sub esp, 4*4<br />mov esi,esp<br />mov &#91;esi&#93;,eax<br />mov &#91;esi+4&#93;,eax<br />mov &#91;esi+8&#93;,eax<br />mov &#91;esi+12&#93;,eax<br />....<br />add esp, 4*4<br /></code></pre><br /><br />Well creating a string table have its uses. It could do some sort of look up if you know the index of the array of the string.</div>
    <div class="meta">Posted on 2003-06-03 07:16:27 by roticv</div>
   </div>
   <div class="post" id="post-105865">
    <div class="subject"><a href="#post-105865">How do I make a simple text and/or number array?</a></div>
    <div class="body">Ok, both of those method's seem to have a good use, and since I mostly program with the use of array's for things such as hash/ID/comparison tables, without being able to work with array's in MASM it would be a pain, so thank you both.<br /><br />There are a few more questions I have on these method's, but will post them a bit later.<br /><br />For now, here's one, why does the multiplier start at 4 bytes and is doubled everytime for each incrementation of the index?<br /><br />Like below:<br />*4<br />*8<br />*12</div>
    <div class="meta">Posted on 2003-06-03 11:24:06 by Knight Chat X</div>
   </div>
   <div class="post" id="post-105866">
    <div class="subject"><a href="#post-105866">How do I make a simple text and/or number array?</a></div>
    <div class="body">That is because data is stored as dword and each dword = 4 bytes. :rolleyes:</div>
    <div class="meta">Posted on 2003-06-03 11:26:19 by roticv</div>
   </div>
   <div class="post" id="post-105870">
    <div class="subject"><a href="#post-105870">How do I make a simple text and/or number array?</a></div>
    <div class="body">I've been thinking about a good garbage collect routine and though the routine is easy enough, you just allocate another heap and copy all valid strings to it contiguously updating the pointers as you go, it is difficult to come up with an algorithm that will tell you the level of granularity or fragmentation in your array. You essentially have 2 choices, conserve memory by collecting often or collecting less often and have higher granularity. At a certain point if you wait too long the collection time could become prohibitive.<br /><br />I think that you could custom tailor one to your app depending on how many deleted strings you had, say after 50 deleted array elements you collect the garbage. It would simple be a matter of copying the strings then destroying the old heap. You may also want to set your heap so it can grow so that the array is expandable.</div>
    <div class="meta">Posted on 2003-06-03 12:35:18 by donkey</div>
   </div>
   <div class="post" id="post-105916">
    <div class="subject"><a href="#post-105916">How do I make a simple text and/or number array?</a></div>
    <div class="body">Ok, that's great, already have made functions for doing all of that in VB, sometimes when you have program that requires scanning a file with a variable number of lines, such as for an options file, you need to be able to adjust the size of the array as the number of lines in the file can vary, in that case you just ReDim to change the size.<br /><br />If I were to wanna cut down on the empty spaces in an array if spaces existed, and to get an accurate count of the lines in the file minus the spaces, I simply use a special CopyArrayToArray function that has a flag option of ignoring the empty array index items so when the array is copied into a new array it does not include the empty spaces. There is much more to it than that, such as doing a comparison on the first array minus the empty index items in order to properly set the new array size to match the number of items that will be placed into the new array, but all of that is pretty easy.<br /><br />In MASM, however, I still see a difference in the array pattern, for one, what exactly causes this defragmentation in an array, are you talking about the empty index items whenever an item in the array is deleted?<br /><br />If so, when that happens, can new data be placed in that empty index item space after it is deleted, or would this cause further fragmentation and that's the reason for dumping the allocated memory and redoing it like you mentioned by allocating new space and basically rebuilding the array again?<br /><br />Do all the item sizes in the array have to be the same size, etc., or can it vary?<br /><br />And what do you mean rebuild the array within a certain amount of time if the array items are changed alot?</div>
    <div class="meta">Posted on 2003-06-03 23:05:17 by Knight Chat X</div>
   </div>
   <div class="post" id="post-105919">
    <div class="subject"><a href="#post-105919">How do I make a simple text and/or number array?</a></div>
    <div class="body">The index isn't the problem, that has a fixed length of 4 bytes. The problem is that you have variable length data so each time you allocate a string to replace an existing one it must be put at the end of the array and it's index pointer changed. This does not delete the original string, that remains in memory taking up space, when you collect the garbage you are removing the dead strings from the array. For example :<br /><br />&gt; copy a string to the buffer<br />mov Index[12], pString<br /><br />; Replace string 12<br /><br />&gt; copy a new string to the end of the buffer<br />mov Index[12],pNewString<br /><br />The original string is not deleted, To delete it you must allocate a new buffer and copy all valid strings to it in order to remove the dead ones. For example if you had strings 0-100 it would go something like this, I haven't checked it but it should be close. You can save alot more time by using DWORDs to transfer the strings but that is a little more complicated, see the StrLen source for MASM32 to find out how.<br /><br />mov ecx,100<br />mov edi,pnewbuffer<br />mov esi,Array<br />@@:<br />mov al,<br />mov ,al<br />inc edi<br />inc esi<br />cmp al,0<br />jne @B<br />dec ecx<br />mov esi,Array<br />jnz @B<br /><br />This is something that every language does in the background, however ASM requires that you do it yourself. Whenever you use dynamic data arrays you must do a garbage collect to conserve memory. You may notice that when you move alot of data in an array using VB, the program can stall sometimes, this is the GC cycle.</div>
    <div class="meta">Posted on 2003-06-03 23:32:04 by donkey</div>
   </div>
   <div class="post" id="post-105932">
    <div class="subject"><a href="#post-105932">How do I make a simple text and/or number array?</a></div>
    <div class="body"><div class="quote">Do all the item sizes in the array have to be the same size, etc., or can it vary?</div> <br />Regarding this topic, you have to ask yourself one question. Why do you want the item size in the array to vary? Yes, it could be done (You could do almost anything with asm). However when using item size in the array varies, it is hard to access the data that you wish to access. <br /><div class="quote">If I were to wanna cut down on the empty spaces in an array if spaces existed, and to get an accurate count of the lines in the file minus the spaces, I simply use a special CopyArrayToArray function that has a flag option of ignoring the empty array index items so when the array is copied into a new array it does not include the empty spaces. There is much more to it than that, such as doing a comparison on the first array minus the empty index items in order to properly set the new array size to match the number of items that will be placed into the new array, but all of that is pretty easy.<br /><br /></div><br />Why not code the algorithm yourself? Anyway since you are coding in asm, you should approach programming from a new point of view and not be 'stuck' in vb's methodology. Just remember that it is easier to create bugs in asm, but harder to find them as compared with HLL. Nothing is limiting you when you code in asm. <br /><div class="quote">Ok, that's great, already have made functions for doing all of that in VB, sometimes when you have program that requires scanning a file with a variable number of lines, such as for an options file, you need to be able to adjust the size of the array as the number of lines in the file can vary, in that case you just ReDim to change the size.</div><br />View the file mapped into memory or copied to an array as an array of bytes. With the pointer to the memory or array, alot of things could be done. To limit the number of lines, just scan for CRLF and count the number of CRLF. When the number of lines you need is reached, just do what ever you want to do with it.</div>
    <div class="meta">Posted on 2003-06-04 04:01:21 by roticv</div>
   </div>
   <div class="post" id="post-105950">
    <div class="subject"><a href="#post-105950">How do I make a simple text and/or number array?</a></div>
    <div class="body">roticv,<br /><br /><div class="quote">Regarding this topic, you have to ask yourself one question. Why do you want the item size in the array to vary? Yes, it could be done (You could do almost anything with asm). However when using item size in the array varies, it is hard to access the data that you wish to access. </div> <br /><br />Must be a failure to communicate, I asked this:<br /><div class="quote">Do all the item sizes in the array have to be the same size, etc., or can it vary?</div> <br /><br />The question was asked because I needed to know why in the examples the size of each index item/layer, appeared as if it had to be the same size, that's all. Weither it is harder or not to access the data doesn't matter, as you said:<br /><div class="quote">Yes, it could be done (You could do almost anything with asm)</div> <br /><br /><div class="quote">Why not code the algorithm yourself? Anyway since you are coding in asm, you should approach programming from a new point of view and not be 'stuck' in vb's methodology. Just remember that it is easier to create bugs in asm, but harder to find them as compared with HLL. Nothing is limiting you when you code in asm.</div> <br /><br />First of all, I use this messageboard as a last resort, only after there's a big stop point in development, or when there's an idea and I might be able to possibly help someone, you can look at the number of posts I've done and see it's not the largest, I already have created the algorithm in VB and in other programming languages, that doesn't matter, yea this is MASM, and nobody's perfect. Regardless, every programmer programs differently, I started on an old government 286 dell computer with a orange monochrome monitor when I was 12, and have since then tried over 14 languages, mostly stayed away from the common languages, weither it's batch file programming, GWBASIC, QBASIC, VB, HTML, DOS Console, MASM, NASM, TASM, Borland, Perl, CGI or any other language, I program on inspiration and with reason, I'm not stuck at all on VB, hopefully that wont be assumed as I only use VB in examples to break things down so the communication gap in my posts isn't so big, like any mechanic that chooses his brand of tools, or artist that chooses paint colors, I've chosen mine. I even found problem in the Windows.inc file once long ago and submitted my findings to SH. But guess that doesn't matter to much now huh. No matter what views I had back then I still found problem and saw the solution. The bottom line is, I don't tell you how you should program or do things, so please respect me equally as a fellow programmer, thank you for your comments.<br /><br />If you do not ask, you do not learn...<br /><br />Here's a good bit of reading for those that have MASM installed, it's a nice artical:<br />C:\masm32\HTML\warriors.htm</div>
    <div class="meta">Posted on 2003-06-04 07:09:54 by Knight Chat X</div>
   </div>
   <div class="post" id="post-105952">
    <div class="subject"><a href="#post-105952">How do I make a simple text and/or number array?</a></div>
    <div class="body"><div class="quote">The question was asked because I needed to know why in the examples the size of each index item/layer, appeared as if it had to be the same size, that's all. Weither it is harder or not to access the data doesn't matter, as you said:</div><br />Well because if the arrays are of different size, people use structs instead. <br /><pre><code><br />mystruct struct<br />dword1 dd ?<br />byte1 db ?<br />word1 dw ?<br />dword2 dd ?<br />dword3 dd ?<br />mystruct ends<br /><br />.data?<br />mystruct1 mystruct &lt;1,1,1,1,1&gt;<br /><br />.code<br />lea edi,mystruct1<br />assume edi&#58; ptr mystruct<br />mov &#91;edi&#93;.dword1, eax<br />mov &#91;edi&#93;.dword3,eax<br />assume edi&#58;none<br /></code></pre></div>
    <div class="meta">Posted on 2003-06-04 07:23:20 by roticv</div>
   </div>
   <div class="post" id="post-105954">
    <div class="subject"><a href="#post-105954">How do I make a simple text and/or number array?</a></div>
    <div class="body">k Donkey,<br /><br />.data<br />Array DWORD 1024 DUP (0)<br /><br />.code<br />mov edi,OFFSET Array<br />mov ,1<br />mov ,1<br />mov ,1<br /><br /><br />While trying to compile is giving a &quot;Invalid Instruction Operands&quot; error for each of the:<br />mov ,1</div>
    <div class="meta">Posted on 2003-06-04 07:34:43 by Knight Chat X</div>
   </div>
   <div class="post" id="post-105955">
    <div class="subject"><a href="#post-105955">How do I make a simple text and/or number array?</a></div>
    <div class="body"><pre><code>.data<br />Array DWORD 1024 DUP &#40;0&#41;<br /><br />.code<br />mov edi,OFFSET Array<br />mov dword ptr &#91;edi+0*4&#93;,1<br />mov dword ptr&#91;edi+1*4&#93;,1<br />mov dword ptr&#91;edi+2*4&#93;,1<br /></code></pre><br />This is because the size of data to copy to was not specified. The fact that copying an immediate to memory does not tell the assembler what is the size of data to copy to. however if copying memory to reg or reg to memory, the assembler knows the size of data to copy and write to.</div>
    <div class="meta">Posted on 2003-06-04 07:37:50 by roticv</div>
   </div>
   <div class="post" id="post-105956">
    <div class="subject"><a href="#post-105956">How do I make a simple text and/or number array?</a></div>
    <div class="body">Using a structure, hmmm, well that's pretty cool, lol</div>
    <div class="meta">Posted on 2003-06-04 07:40:19 by Knight Chat X</div>
   </div>
   <div class="post" id="post-106064">
    <div class="subject"><a href="#post-106064">How do I make a simple text and/or number array?</a></div>
    <div class="body">Donkey, couldn't get this to work, sometimes it'll compile, but crash, other times when changed a bit I'll recieve a baseptr error saying invalid operand etc, or a problem with pHeap saying the samething.<br /><br />invoke HeapCreate,HEAP_NO_SERIALIZE,4096,NULL<br />mov hHeap,eax<br />test eax,eax<br />jnz @F<br />invoke ExitProcess,eax<br />@@:<br />invoke HeapAlloc,hHeap,HEAP_ZERO_MEMORY,4096<br />mov pHeap,eax<br />mov baseptr,pHeap ;&lt;&lt;&lt;&lt;PROBLEM 1<br /><br />; baseptr is used to keep track of where the end of the array is.<br /><br />NumArray would be like a DIM statement (in this case 256 elements max):<br /><br />NumArray dd 256 DUP (0)<br /><br />Adding strings<br />; copy a string into the array<br />invoke lstrcpy,baseptr,ADDR String<br />; Save the base pointer into the current var<br />mov edi,OFFSET NumArray<br />mov ,baseptr ;&lt;&lt;&lt;&lt;&lt;PROBLEM 2<br />;Set the new base ptr<br />invoke lstrlen,ADDR String ;&lt;&lt;&lt;&lt;&lt;&lt;PROBLEM 3<br />add baseptr,eax<br />inc baseptr<br /><br />Reading strings<br />mov edi,pHeap ;&lt;&lt;&lt;&lt;&lt;&lt;PROBLEM 4<br />invoke MessageBox,NULL,,NULL,MB<br />_OK</div>
    <div class="meta">Posted on 2003-06-05 06:27:00 by Knight Chat X</div>
   </div>
   <div class="post" id="post-106065">
    <div class="subject"><a href="#post-106065">How do I make a simple text and/or number array?</a></div>
    <div class="body">It is not donkey's error. Look through the intel manual for the opcode and you would realise that there is something called the mod. However there is no option for any opcode to read from memory and store it back on memory. Thus the assembler generate an error. Replace it with<br /><pre><code><br />mov baseptr,eax<br /></code></pre><br />or<br /><pre><code><br />push pHeap<br />pop baseptr</code></pre><br /><pre><code>mov edi,OFFSET NumArray<br />mov &#91;edi+ArrayElementNumber*4&#93;,baseptr ;&lt;&lt;&lt;&lt;&lt;PROBLEM 2<br /></code></pre><br />Read my above statement. No opcode can work on 2 memory (for the source and destination, whatever you call it). Unless of course ArrayElementNumber is a constant/immediate.<br />Use something like<br /><pre><code>lea edi, NumArray<br />mov ecx,ArrayElementNumber<br />mov &#91;ecx*4+edi&#93;,baseptr</code></pre><br />Problem 4 lies on the same fact as Problem 2.  Furthermore the MessageBox api expects its parameter for lpaption to be a pointer to a string and not just data.<br /><pre><code>invoke MessageBox,NULL,&#91;edi+ArrayElementNumber*4&#93;,NULL,MB</code></pre><br />Not sure about Problem 3.</div>
    <div class="meta">Posted on 2003-06-05 06:37:28 by roticv</div>
   </div>
  </div>
 </body>
</html>