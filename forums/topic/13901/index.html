<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ColRef - RadAsm addin - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13901" />
    <link rel="next" href="../?id=13901&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=42">RadASM</a> &raquo; <a href="../?id=13901">ColRef - RadAsm addin</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=13901&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=13901&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="13901" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=13901&amp;page=2">&gt;</a><a href="../?id=13901&amp;page=2">&raquo;</a></form>   <div class="post" id="post-107455">
    <div class="subject"><a href="#post-107455">ColRef - RadAsm addin</a></div>
    <div class="body">Hi<br /> <br />Last year I createde ColRef addin for RadAsm. It was later replaced by InsertColor addin. Now I have had need of picking colors from the screen so I improved my old ColRef addin. For those who are interested you can either choos color from the common dialog or pick a color from the screen. It is tested on win 2000.<br /><br />Dll and source code are attached.<br /><br />Regards</div>
    <div class="meta">Posted on 2003-06-18 05:51:26 by minor28</div>
   </div>
   <div class="post" id="post-107919">
    <div class="subject"><a href="#post-107919">ColRef - RadAsm addin</a></div>
    <div class="body">Well,<br /><br />This is it. I'm sure minor28 will like the new look. I got rid of the dual window idea and consolidated everything onto the ChooseColor dialog. I painted the dialog to make it look nicer. The choosecolor dialog is a template now, if you've never done a common dialog template this is how. The messages are all handled in the callback for the ChooseColor dialog, another good example on how to do something. Pressing OK on the dialog will not close it, only copy the color info to the edit controls. Use the insert buttons to insert the color number. New feaatures:<br /><br />Saves the custom colors.<br /><br />The top row of custom colors is saved to RadASM.ini and is available to all projects.<br />The bottom row is available to the current project and is saved in the Rap file.<br />Will capture a number at the cursor for the initial color<br /><br /><strong>&lt; use minor28's version at the bottom of the thread :) &gt;</strong><br /><br />It's his addin after all...</div>
    <div class="meta">Posted on 2003-06-22 16:10:21 by donkey</div>
   </div>
   <div class="post" id="post-107935">
    <div class="subject"><a href="#post-107935">ColRef - RadAsm addin</a></div>
    <div class="body">For those of you who would like to use the dialog templates to modify the common dialogs (I like to do this) I use a res file that I generated from the common dialog dll. Use res2dlg to extract the dialogs and then modify them in RadASM. I've only tested the find and choose color dialogs but they should all be ok.<br /><br />(Be sure to get the new Res2Dlg the one in RadASM will crash)</div>
    <div class="meta">Posted on 2003-06-22 23:49:56 by donkey</div>
   </div>
   <div class="post" id="post-107938">
    <div class="subject"><a href="#post-107938">ColRef - RadAsm addin</a></div>
    <div class="body">Yes donkey,<br /><br />I like the new look. I am sure your intention of the dialog title is not to take the credit from me, but personly I would prefer a more neutral title as &quot;Color reference&quot;. I think you are too modest. Why not begin the colref.asm and colref.txt with<br /><br />&quot;Code by minor28 and donkey in cooperation&quot;.<br /><br />If I may wish, it would be nice if the captured color also could be added to the custom colors. <br /><br />Best regards</div>
    <div class="meta">Posted on 2003-06-23 01:18:41 by minor28</div>
   </div>
   <div class="post" id="post-107939">
    <div class="subject"><a href="#post-107939">ColRef - RadAsm addin</a></div>
    <div class="body">Nah,<br /><br />It's your addin, I just worked on the interface, you deserve the credit. As for the title, don't be shy, you did good work, everybody should know. ;). <br /><br />I left my nick in the source (and the upcoming help file), it's ok there. I'll leave the adding of the captured colours to you, it should just be a matter of copying the RGB values into the dialog text boxes (SetDlgItemInt)</div>
    <div class="meta">Posted on 2003-06-23 01:44:47 by donkey</div>
   </div>
   <div class="post" id="post-107943">
    <div class="subject"><a href="#post-107943">ColRef - RadAsm addin</a></div>
    <div class="body">One more idea for your addin that I had is you can add text capture that will copy the text at the cursor into the dialog and display the colour. You can check BitMask to see how I handled it with both hex and decimal numbers. That way if you have a colour in hex format in your code and you want to know what it is you just put the cursor on it and press the button.<br /><br />I added this myself as I'm familiar with the code and it was fairly easy for me. I updated the file in my original link. I did the capture color to chooser thingy as well so you put the captured colors into the favourites, I had nothing else to do and my air conditioning is broken, can't sleep at 28c :(</div>
    <div class="meta">Posted on 2003-06-23 02:09:49 by donkey</div>
   </div>
   <div class="post" id="post-107994">
    <div class="subject"><a href="#post-107994">ColRef - RadAsm addin</a></div>
    <div class="body">Now the captured color is inserted in the common dlg part and can be saved as custom colors.<br /><br />Regards</div>
    <div class="meta">Posted on 2003-06-23 11:38:27 by minor28</div>
   </div>
   <div class="post" id="post-107997">
    <div class="subject"><a href="#post-107997">ColRef - RadAsm addin</a></div>
    <div class="body">Whoops, I added that to my version in the end, couldn't sleep last nite :eek:<br /><br />I've removed my copy so there is no confusion.</div>
    <div class="meta">Posted on 2003-06-23 11:43:08 by donkey</div>
   </div>
   <div class="post" id="post-108003">
    <div class="subject"><a href="#post-108003">ColRef - RadAsm addin</a></div>
    <div class="body">Hi Minor28,<br /><br />Maybe have the color dialog updated only when a color has been selected. It is a little hard on the eyes to see all of that flashing when it is being updated on each mousemove. Outside of that nice job :alright:</div>
    <div class="meta">Posted on 2003-06-23 11:54:54 by donkey</div>
   </div>
   <div class="post" id="post-108004">
    <div class="subject"><a href="#post-108004">ColRef - RadAsm addin</a></div>
    <div class="body">First I was going to update the dialog only when a color had been selected. But then I found that it is easier to hit the right spot if you can see the color. You don't have to look at the dialog all the time only when you are near the spot you are interested in.</div>
    <div class="meta">Posted on 2003-06-23 12:07:14 by minor28</div>
   </div>
   <div class="post" id="post-108008">
    <div class="subject"><a href="#post-108008">ColRef - RadAsm addin</a></div>
    <div class="body">Yes, you're right. it is much better to see the transitions.</div>
    <div class="meta">Posted on 2003-06-23 12:26:43 by donkey</div>
   </div>
   <div class="post" id="post-108013">
    <div class="subject"><a href="#post-108013">ColRef - RadAsm addin</a></div>
    <div class="body">Maybe put turning it off as an option :<pre><code>;Write pic color to common dialog<br />.IF Opt != 2<br />	xor eax,eax<br />    mov al,byte ptr &#91;color + 2&#93;<br />    push eax<br />	invoke wsprintf,addr colref,SADD&#40;'%ld'&#41;<br />	invoke SetDlgItemText,hCCDlg,708,addr colref<br />    mov al,byte ptr &#91;color + 1&#93;<br />    push eax<br />	invoke wsprintf,addr colref,SADD&#40;'%ld'&#41;<br />	invoke SetDlgItemText,hCCDlg,707,addr colref<br />    mov al,byte ptr color<br />    push eax<br />	invoke wsprintf,addr colref,SADD&#40;'%ld'&#41;<br />	invoke SetDlgItemText,hCCDlg,706,addr colref<br />.ENDIF</code></pre>This way if you have an LCD screen (like I do) it isn't as hard on the eyes. I'm trying to think of a way to use the WM_PAINT message to have just the colour box updated but it doesn't go well.<br /><br />In this case option 2 will tun it off</div>
    <div class="meta">Posted on 2003-06-23 13:00:37 by donkey</div>
   </div>
   <div class="post" id="post-108015">
    <div class="subject"><a href="#post-108015">ColRef - RadAsm addin</a></div>
    <div class="body">I added the turning off option. Testing the option turned the flashing off but to my surprise the dialog was updated with the captured color. Then I found your &quot;SelectToDialog&quot; function. So I suppose I downloaded your version before you<br /><div class="quote">Whoops, I added that to my version in the end, couldn't sleep last nite <br /><br />I've removed my copy so there is no confusion.</div></div>
    <div class="meta">Posted on 2003-06-23 14:02:48 by minor28</div>
   </div>
   <div class="post" id="post-108135">
    <div class="subject"><a href="#post-108135">ColRef - RadAsm addin</a></div>
    <div class="body">I added a button &quot;Color ref&quot; to utilize donkey's facility to capture a color reference in RadAsm by the mousepointer and show the color in the dialog. Now you can show the color not only at dialog start up but also by pushing the button. I think that's all<br /><br />Regards</div>
    <div class="meta">Posted on 2003-06-24 13:30:22 by minor28</div>
   </div>
   <div class="post" id="post-108328">
    <div class="subject"><a href="#post-108328">ColRef - RadAsm addin</a></div>
    <div class="body">donkey<br /><br />I found it annoying that choosing a color from the color picker window always result in black. So I wanted to set Lum: to 120. Not to interfere with the start up color reference I choose WM_LBUTTONUP<br /><pre><code>.elseif uMsg==WM_LBUTTONUP<br />	mov eax,lParam<br />	and eax,0ffffh<br />	mov lpPoint.x,eax<br />	mov eax,lParam<br />	shr eax,16<br />	mov lpPoint.y,eax<br />	.if &#40;lpPoint.x&gt;225 &amp;&amp; lpPoint.y&lt;415 &amp;&amp; lpPoint.y&gt;3 &amp;&amp; lpPoint.y&lt;187&#41;<br />		invoke SetDlgItemInt,hCCDlg,705,120,FALSE <br />	.endif</code></pre><br />How should I do to get the rectangle values from code and not as I did from the property list in RadAsm. I have tried several ways but all fails.<br /><br />Regards</div>
    <div class="meta">Posted on 2003-06-26 12:27:18 by minor28</div>
   </div>
   <div class="post" id="post-108336">
    <div class="subject"><a href="#post-108336">ColRef - RadAsm addin</a></div>
    <div class="body">I think that you can verify that there is no number present at the cursor and set a default value for the luminosity to say 120 (50%) when the dialog starts. You can pick a neutral color like light gray if no rgbinit value is supplied. The cursor capture of the number is capable of  returning a default color if there is not a valid number at the cursor. Altering the choice after initializing the dialog would not be a good idea as it might interfere with the selection of colors.<br /><pre><code>ParseInput proc InputMask&#58;DWORD<br />	LOCAL buffer&#91;256&#93;			&#58;BYTE<br /><br />	invoke lstrcpy,ADDR buffer,InputMask<br />	lea eax,buffer<br />	mov InputMask,eax<br /><br />	mov edx,InputMask<br />	mov al,&#91;edx&#93;<br />	.IF al &gt;= &quot;0&quot; &amp;&amp; al &lt;= &quot;9&quot;<br />		invoke StrLen,InputMask<br />		mov edx,InputMask<br />		add edx,eax<br />		sub edx,1<br />		mov al,&#91;edx&#93;<br />		.IF al == &quot;h&quot; || al == &quot;H&quot;<br />			mov &#91;edx&#93;,BYTE PTR 0<br />			mov edx,InputMask<br />			invoke htodw,edx<br />			ret<br />		.endif<br />		invoke atodw,InputMask<br />	.ELSE<br />		&#91;color=red&#93;&#91;b&#93;mov eax,DefaultColor&#91;/b&#93;&#91;/color&#93;<br />	.ENDIF<br />	ret<br />ParseInput endp</code></pre></div>
    <div class="meta">Posted on 2003-06-26 13:51:33 by donkey</div>
   </div>
   <div class="post" id="post-108356">
    <div class="subject"><a href="#post-108356">ColRef - RadAsm addin</a></div>
    <div class="body">Ok donkey<br /><br />The easy way is to do what you proposed. Just replace &quot;xor eax,eax&quot; with &quot;mov eax,007F7F7Fh&quot;. But I couldn't  give up the thought of the WM_LBUTTONUP idea. This is a code that works.<br /><pre><code>.elseif uMsg==WM_LBUTTONUP<br />	invoke GetDlgItem,hCCDlg,710<br />	mov hwnd,eax<br />	invoke GetClientRect,hwnd,addr rect<br />	;Convert upper left corner to POINT structure<br />	mov eax,rect.left<br />	mov lpPoint.x,eax<br />	mov eax,rect.top<br />	mov lpPoint.y,eax<br />	mov times,1<br />@@&#58;<br />	;Convert client coordinates to screen coordinates<br />	invoke ClientToScreen,hwnd,addr lpPoint<br />	push lpPoint.y ;Store y-coordinate<br />	push lpPoint.x ;Store x-coordinate<br />	;Convert upper left corner point of the dialog window <br />	mov lpPoint.y,0<br />	mov lpPoint.x,0<br />	;Convert to Screen coordinates<br />	invoke ClientToScreen,hCCDlg,addr lpPoint<br />	pop eax ;Restore x-coordinate of Client rect &#40;Screen coordinates&#41;<br />	sub eax,lpPoint.x ;Sub dialog x-coordinat from client x-coordinat<br />	mov lpPoint.x,eax ;Client x-coordinat with origo on upper left corner of the dialog<br />	mov eax,lParam <br />	and eax,0ffffh ;Get lowword of lParam = x-coordinate of mousepointer<br />	cmp times,0<br />	je @1<br />	cmp eax,lpPoint.x <br />	jle @F ;if less or equal jump out<br />	jmp @2<br />@1&#58;		<br />	cmp eax,lpPoint.x <br />	jge @F<br />@2&#58;<br />	pop eax ;Restore y-coordinate of client rect &#40;Screen coordinates&#41;<br />	sub eax,lpPoint.y ;Sub dialog y-coordinat from client y-coordinat<br />	mov lpPoint.y,eax ;Client y-coordinat with origo on upper left corner of the dialog<br />	mov eax,lParam<br />	shr eax,16 ;Get hiword of lParam = y-coordinate of mousepointer<br />	cmp times,0<br />	je @3<br />	cmp eax,lpPoint.y<br />	jle @F ;if less or equal jump out<br />	jmp @4<br />@3&#58;		<br />	cmp eax,lpPoint.y<br />	jge @F<br />	invoke SetDlgItemInt,hCCDlg,705,120,FALSE<br />	jmp @F<br />@4&#58;<br />	mov eax,rect.right<br />	mov lpPoint.x,eax<br />	mov eax,rect.bottom<br />	mov lpPoint.y,eax<br />	mov times,0<br />	jmp @B<br />@@&#58;</code></pre><br />Does it have to be so complecated? I would be very interested if there is a simplier and better way to go, i.e. the point way.<br /><br />Regards</div>
    <div class="meta">Posted on 2003-06-26 17:06:04 by minor28</div>
   </div>
   <div class="post" id="post-108363">
    <div class="subject"><a href="#post-108363">ColRef - RadAsm addin</a></div>
    <div class="body">This is much less complicated :<br /><pre><code>.elseif uMsg==WM_LBUTTONUP<br />	invoke GetCursorPos,ADDR lpPoint<br />	invoke ChildWindowFromPoint,hCCDlg,lpPoint.x,lpPoint.y<br />	push eax<br />	invoke GetDlgItem,hCCDlg,710<br />	pop ecx<br />	.IF eax==ecx<br />		invoke SetDlgItemInt,hCCDlg,705,120,FALSE<br />	.ENDIF</code></pre></div>
    <div class="meta">Posted on 2003-06-26 18:58:48 by donkey</div>
   </div>
   <div class="post" id="post-108386">
    <div class="subject"><a href="#post-108386">ColRef - RadAsm addin</a></div>
    <div class="body">As a matter of fact I have already made an attempt on that one and several others but none works only my complicated code. Why your code not works I suppose is due to GetCursorPos gives values in screen coordinates and ChildWindowFromPoint requires client coordinates values.</div>
    <div class="meta">Posted on 2003-06-27 00:35:14 by minor28</div>
   </div>
   <div class="post" id="post-108389">
    <div class="subject"><a href="#post-108389">ColRef - RadAsm addin</a></div>
    <div class="body">Works for me, if you select a color from the dither static it automatically sets the  luminosity to 120, anywhere else it takes it at the selected value unaltered. That is by far the most elegant solution, otherwise you are changing values that the user might want to retain. Yes, it is supposed to be client coords but it seems to work, I wonder why. Oh well, just but in a screentoclient and it should be 100%</div>
    <div class="meta">Posted on 2003-06-27 00:49:00 by donkey</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=13901&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=13901&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="13901" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=13901&amp;page=2">&gt;</a><a href="../?id=13901&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>