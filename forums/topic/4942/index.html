<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>custom shaped windows again... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4942" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=4942">custom shaped windows again...</a></p>
   <div class="post" id="post-34631">
    <div class="subject"><a href="#post-34631">custom shaped windows again...</a></div>
    <div class="body">because iczelions gdi tutorials where not correct<br />and my examples in hutchs masm package simply<br />wrong i decided to release this stuff again... now<br />it's very small, simple to understand und of course<br />bug-*free* <br /><br />i saw a couple of skinning tutes in the net based <br />on my work... mh what can i say, i wouldn't shuffle <br />those windows in 2k :grin:</div>
    <div class="meta">Posted on 2002-04-23 08:25:24 by mob</div>
   </div>
   <div class="post" id="post-34714">
    <div class="subject"><a href="#post-34714">custom shaped windows again...</a></div>
    <div class="body">Mob,<br /><br />This one works fine on my win95b but then so did the last one. What is the difference ? Is it just tidier code ?<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-04-23 18:59:08 by hutch--</div>
   </div>
   <div class="post" id="post-34798">
    <div class="subject"><a href="#post-34798">custom shaped windows again...</a></div>
    <div class="body">the last one don't work with 2k platforms... just shuffle<br />the window around and see what happens, the whole<br />pallette seems to be f**ked up... the difference? in this<br />version i do not respond to WM_PAINT at all. because<br />the backgroundpic is already defined in the window-class <br />WM_PAINT causes strange effects... the key was <br />WM_ERASEBKGND... now it works fine. i rewrote it cause<br />i got a couple of mails describing the problem thats all :)</div>
    <div class="meta">Posted on 2002-04-24 03:19:15 by mob</div>
   </div>
   <div class="post" id="post-34933">
    <div class="subject"><a href="#post-34933">custom shaped windows again...</a></div>
    <div class="body"><div class="quote"><br />.ELSEIF uMSG ==         WM_PAINT                         ; MH, I HAD STRANGE ERRORS WITH THIS<br />                                                         ; ONE. I STILL DON'T KNOW WHY BUT IF<br />                                                         ; YOU LET WINDOWS DO ALL THE GDI STUFF<br />                                                         ; WITH WM_PAINT YOU'LL GET A BAD SURPRISE<br />                                                         ; WHEN SHUFFLING THE WINDOW AROUND...<br /></div><br /><br />When I move the window (NT sp 6.0) I get a weird erased background look (if I move the window across and open folder the items disappear for a second in that folder)... Not sure if this was the problem you were trying to fix <br /><br />Sliver</div>
    <div class="meta">Posted on 2002-04-24 19:48:33 by Sliver</div>
   </div>
   <div class="post" id="post-34962">
    <div class="subject"><a href="#post-34962">custom shaped windows again...</a></div>
    <div class="body">i hope you meant *after* you let windows do all the<br />wm_paint stuff... if thats the case, yeah, i get the same<br />results then... thats really strange i think but in my<br />opinion thats because i defined the bgpic in the window-<br />class, that means the background must only redrawn<br />if the app gets a wm_bkgnderased, not on every wm_paint<br />because this causes overdrawing effects. this seems<br />be be a general problem because you also can draw<br />the background yourself (like in iczelion &amp; hiro tutes)<br />but even then there are drawing problems.<br /><br />so if one uses wm_bkgnderased for the actual background<br />and wm_paint for the controls and/or other grafical<br />elements everything should be working fine... i hope<br />so...<br /><br />oh and if you meant the effect when you shuffle the<br />windows across for example the iexplorer window... thats<br />normal... it has something to do with the specific windows<br />paint-msg processing... try it with winamp (with a <br />transparent skin!!!), you'll get the same effect but 100x <br />more worse... it also has something to do with the <br />complexity of the shape, this one in the zip-file above is <br />*very* complex so it will take longer to erase the <br />background, but if you just use simpler shapes like <br />rounded edges you won't even notice these erasing<br />effects in the most cases...</div>
    <div class="meta">Posted on 2002-04-25 03:44:48 by mob</div>
   </div>
   <div class="post" id="post-34966">
    <div class="subject"><a href="#post-34966">custom shaped windows again...</a></div>
    <div class="body">look at this... i choosed a very simple shape and<br />i don't recognize any redrawing effects now...</div>
    <div class="meta">Posted on 2002-04-25 04:22:23 by mob</div>
   </div>
   <div class="post" id="post-121341">
    <div class="subject"><a href="#post-121341">custom shaped windows again...</a></div>
    <div class="body">hi..<br /><br />nice code here... but i get some problems with my messagebox.. it appears behind the bmp :\<br />any help ?</div>
    <div class="meta">Posted on 2003-10-14 15:37:09 by SlashZero</div>
   </div>
   <div class="post" id="post-121422">
    <div class="subject"><a href="#post-121422">custom shaped windows again...</a></div>
    <div class="body">i didn't touched a single asm command in months now but<br />if you could clearly state whats your problem i could probably<br />help you out. examples aren't a bad thing either...</div>
    <div class="meta">Posted on 2003-10-15 11:37:00 by mob</div>
   </div>
   <div class="post" id="post-121599">
    <div class="subject"><a href="#post-121599">custom shaped windows again...</a></div>
    <div class="body">Greetings <strong>mob</strong>, I conducted an experiment with your code using double-buffering instead: <br /><pre><code><br />.ELSEIF uMSG ==         WM_PAINT                    <br />        INVOKE          CreateCompatibleDC, NULL    <br />        MOV             cdc, EAX                    <br /><br />; Use double buffering here ------&gt; <br /><br />        INVOKE          CreateCompatibleBitmap, hdc, PICTUREW, PICTUREH<br />        MOV             bdc, EAX      <br />        INVOKE          SelectObject, cdc, bdc    <br />        mov             hOld, EAX  <br />        INVOKE          BitBlt, wParam, 0, 0, PICTUREW, PICTUREH, cdc, 0, 0, SRCCOPY<br />        INVOKE          SelectObject, cdc, hOld<br />        INVOKE          DeleteObject, bdc <br /><br />        INVOKE          DeleteDC, cdc               <br /></code></pre><br /> <br />It appears to work just as well as your method (on W2KSP4), but at the expense of additional code.</div>
    <div class="meta">Posted on 2003-10-17 19:28:38 by Poimander</div>
   </div>
   <div class="post" id="post-122014">
    <div class="subject"><a href="#post-122014">custom shaped windows again...</a></div>
    <div class="body"><strong>mob</strong>, I discovered using a double buffer doesn't work after all even if you use it to process WM_ERASEBCKGND. I was trying to illicit further discussion. In anycase it is experimentally evident that WM_ERASEBCKGND requires a fast routine to update the screen otherwise you end up with the same distorsion problem. Your technique is truely a sound one. Thanks for sharing it with us.</div>
    <div class="meta">Posted on 2003-10-21 16:10:50 by Poimander</div>
   </div>
   <div class="post" id="post-122126">
    <div class="subject"><a href="#post-122126">custom shaped windows again...</a></div>
    <div class="body"><div class="quote"><br /><strong>mob</strong>, I discovered using a double buffer doesn't work after all even if you use it to process WM_ERASEBCKGND. I was trying to illicit further discussion. In anycase it is experimentally evident that WM_ERASEBCKGND requires a fast routine to update the screen otherwise you end up with the same distorsion problem. Your technique is truely a sound one. Thanks for sharing it with us. </div><br />no problem. yeah it gets quite weird, i tried out everything but this was the<br />only way that worked well, well it's only a line so this became a standard for<br />me from there on. as i am a more or less a defunct member of this community<br />(because of my work) it's kinda hard for me to discuss, sorry. i just don't want<br />to get in touch with computers in my freetime, i'm pretty fed up when i leave<br />work and have plenty of other things to do then :)</div>
    <div class="meta">Posted on 2003-10-22 10:57:51 by mob</div>
   </div>
   <div class="post" id="post-126617">
    <div class="subject"><a href="#post-126617">custom shaped windows again...</a></div>
    <div class="body">Since i found a good source of inspiration in mob's example, here is what i think would improve greatly the performance of this custom shaped window algo:<br /><strong>do not</strong> create the memory DC at every WM_ERASEBCKGND &amp; WM_PAINT message, instead create one at WM_CREATE and only blit it when needed.<br /><br />Eugen</div>
    <div class="meta">Posted on 2003-12-04 21:17:49 by Eugen</div>
   </div>
  </div>
 </body>
</html>