<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Newbie Array Question - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=19446" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=19446">Newbie Array Question</a></p>
   <div class="post" id="post-149888">
    <div class="subject"><a href="#post-149888">Newbie Array Question</a></div>
    <div class="body">I just started writing in HLA about two weeks ago.  I've found it simple and intuitive for the most part.<br />However, I come from VB world (that and another high-level script language are what I use at work).  That means no pointers (without undocumented function hacks or API tricks anyway).<br />So, needless to say, my question has a lot to do with pointers I think.<br /><br />I'm trying to build a snippet that creates a dynamic array of strings, fills each index with a unique string, loops through the array to edit each string (say, takes out the 2nd character or something trivial - I'm pretty strong on string manipulation), and then outputs each element.<br /><br />BTW, I'm using Arrays.hhf, and Strings.hhf.<br /><br />I'll happily post what I have in this snippet if anyone asks, but I'd rather see it done right than have what's wrong patched.  I've learned everything I know about programming from studying other people's source first and foremost.<br /><br />To Randall Hyde:<br />  Thank you for all of the work you've put in on this project, I wish I'd had HLA available to me when I started coding, I wouldn't have gotten trapped in VB land.</div>
    <div class="meta">Posted on 2004-09-16 19:11:11 by ChupaThingy</div>
   </div>
   <div class="post" id="post-149896">
    <div class="subject"><a href="#post-149896">Newbie Array Question</a></div>
    <div class="body">This is probably not what you want, but this is more of a low-level dynamic array: a linked list of string pointer objects:<br /><br /><pre><code><br />program dStr;<br />#include&#40;&quot;stdlib.hhf&quot;&#41;<br /><br />type	<br />	dString&#58;record<br />		string_ptr	&#58;string;<br />		next		&#58;pointer to dString;<br />	endrecord;<br /><br />static<br />	base_ptr	&#58;pointer to dString;<br />	<br />const<br />	stresi	&#58;text&#58;=&quot;&#40;type dString&#91;esi&#93;&#41;&quot;;<br /><br />begin dStr;<br />	// create the first object<br />	// allocate memory for the object, and a string of 100 chars<br />	mem.alloc&#40;@size&#40;dString&#41;&#41;;<br />	mov&#40;eax,base_ptr&#41;;<br />	mov&#40;eax,esi&#41;;<br />	mov&#40;NULL,stresi.next&#41;;<br />	str.alloc&#40;100&#41;;<br />	mov&#40;eax,stresi.string_ptr&#41;;<br /><br />	//let's add 9 more string objects<br />	mov&#40;9,ecx&#41;;<br />	_loop&#58;<br />		call _addStringObject;<br />		dec&#40;ecx&#41;;<br />		jnz _loop;<br />		<br />	// manipulate the string objects<br />	mov&#40;base_ptr,esi&#41;;		// recover the 1st string object<br />	mov&#40;1,ecx&#41;;<br />	_strloop&#58;<br />		str.put&#40;stresi.string_ptr,&quot;String #&quot;,&#40;type uns32 ecx&#41;&#41;;<br />		inc&#40;ecx&#41;;<br />		mov&#40;stresi.next,esi&#41;;<br />		cmp&#40;esi,0&#41;;<br />		jne _strloop;<br />		<br />	// display our string objects to stdout<br />	mov&#40;base_ptr,esi&#41;;<br />	_displayloop&#58;<br />		stdout.put&#40;stresi.string_ptr,nl&#41;;<br />		mov&#40;stresi.next,esi&#41;;<br />		cmp&#40;esi,0&#41;;<br />		jne _displayloop;<br />	<br />	// done, call cleanup, this is probably not necessary, but I<br />	// always try to cleanup before quitting<br />	call _cleanUp;<br />	jmp _end;<br /><br />// procedures	 =========================<br />_addStringObject&#58;<br />	mem.alloc&#40;@size&#40;dString&#41;&#41;;<br />	mov&#40;eax,stresi.next&#41;;<br />	mov&#40;eax,esi&#41;;<br />	mov&#40;NULL,stresi.next&#41;;<br />	str.alloc&#40;100&#41;;<br />	mov&#40;eax,stresi.string_ptr&#41;;<br />	ret&#40;&#41;;<br />	<br />_cleanUp&#58;<br />	mov&#40;base_ptr,esi&#41;;<br />	_cleanloop&#58;<br />		str.free&#40;stresi.string_ptr&#41;;<br />		mov&#40;stresi.next,ebx&#41;;<br />		mem.free&#40;esi&#41;;<br />		cmp&#40;ebx,0&#41;;<br />		je _endcleanup;<br />		mov&#40;ebx,esi&#41;;<br />		jmp _cleanloop;<br />	_endcleanup&#58;<br />	ret&#40;&#41;;<br />//=========================================<br />_end&#58;<br />end dStr;<br /></code></pre><br /><br />This program displays 10 strings (of 100 max. characters each)  labled &quot;String #1&quot; to &quot;String #10&quot; that are dynamically created.<br />You can add more features to the record, such as the total number of strings, a &quot;prev&quot; pointer, etc.<br /><br />Other improvements could be made to the _addStringObject procedure such as feeding it a paramter for variable-length strings for each object.</div>
    <div class="meta">Posted on 2004-09-17 02:00:49 by Kain</div>
   </div>
   <div class="post" id="post-149897">
    <div class="subject"><a href="#post-149897">Newbie Array Question</a></div>
    <div class="body"><div class="quote">This is probably not what you want, but this is more of a low-level dynamic array: a linked list of string pointer objects:</div><br /><br />That does exactly what I asked, it's possibly more than I need though.  I'll have to study it a bit to figure out what's going on (I'm still new at this).<br /><br />I was looking more for a very simple example type snippet.  Thank you for this, hopefully I'll be able to learn what I'm missing.</div>
    <div class="meta">Posted on 2004-09-17 02:10:36 by ChupaThingy</div>
   </div>
   <div class="post" id="post-149899">
    <div class="subject"><a href="#post-149899">Newbie Array Question</a></div>
    <div class="body">No problem :)<br /><br />If you want a more detailed explanation of any portion, let me know, I'll get back to you next time I'm online.<br /><br />Keep in mind that this is only one of many ways to do this.  My guess is that it would be easier to use arrays.hhf for a more high-level feel, but as I've never made use of it, I can't help you with it.</div>
    <div class="meta">Posted on 2004-09-17 02:24:28 by Kain</div>
   </div>
   <div class="post" id="post-149911">
    <div class="subject"><a href="#post-149911">Newbie Array Question</a></div>
    <div class="body">Thanks for your help.  I was trying to use arrays.hhf.  After I picked apart your example (and re-read, and re-read, etc) the sections in AoA on addressing modes I finally got it.  It's not pretty, and it's about as un-assembly like as it can be I'm sure, but I think I finally understand the concept behind it.<br /><br />Here it is in any case just in case someone else might find it useful (and for anyone to offer criticism on how I'm doing things... no optimizations though, I've always worried about making code tight, small, and fast after I've mastered the concepts, any advice will be saved away for later weeks and years though)<br /><br /><pre><code><br /><br />	Index&#58;dword;<br />	Elements&#58;dword;<br />	sHeapString&#58;string;<br />	pArray&#58;dword;<br /><br />. . . .<br /><br />	mov&#40; 0, Index &#41;;				// Initialize the Index Counter<br />	<br />	mov&#40; 2, Elements &#41;;				// Determine the number of elements we want<br />	mov&#40; 2, ECX &#41;;					// note that realloc can grow this later<br />	<br />	intmul&#40; @size&#40;dword&#41;, ECX &#41;;	// determine how much space is needed for ECX elements<br />	malloc&#40; ECX &#41;;					// allocate the space<br />	mov&#40; EAX, pArray &#41;;				// save the address of the allocated space<br />	<br />	for&#40; mov&#40; 0, ECX &#41;; ECX &lt; Elements; inc&#40; ECX &#41; &#41; do<br />		<br />		stralloc&#40; 32 &#41;;					// allocate space for the string<br />		mov&#40; EAX, sHeapString &#41;;		// save the address of the allocated space<br />		<br />		str.cpy&#40; &quot;This should be element &quot;, sHeapString &#41;;	// put something into the string<br />		str.cati32&#40; ECX, sHeapString &#41;;<br />		<br />		mov&#40; sHeapString, EAX &#41;;		// move the string's address into EAX<br />		mov&#40; pArray, EBX &#41;;				// move the array's address into EBX<br />		mov&#40; EAX, &#91; EBX + ECX * 4 &#93; &#41;;	// Store the string into the array?<br />		// The above should be&#58; Base_Address + Index * Element_Size<br />		<br />		<br />		// replace a bit of the string directly in the array<br />                                // This is just to test that everything's working<br />                                // I tend to over-use debug output statements<br />		str.index&#40; &#91;EBX + ECX * 4&#93;, &quot;should be&quot; &#41;;<br />		if&#40; &#40;type int32 EAX&#41; &gt; 0 &#41; then<br />			str.delete&#40; &#91;EBX + ECX * 4&#93;, EAX, 9 &#41;;<br />			str.insert&#40; &quot;is&quot;, &#91;EBX + ECX * 4&#93;, 5 &#41;;<br />		endif;<br />		<br />	endfor;<br />	<br />	// clean up everything<br />	mov&#40; Elements, EDX &#41;;<br />	mov&#40; pArray, EBX &#41;;<br />	for&#40; mov&#40; Index, ECX &#41;; ECX &lt; EDX; inc&#40; ECX &#41; &#41; do<br />		if &#40; &#40;type dword &#91;EBX + ECX * 4&#93;&#41; &gt; 0 &#41; then<br />			strfree&#40; &#91;EBX + ECX * 4&#93; &#41;;<br />			dbg.put&#40; &quot;Index &quot;, &#40;type int32 ECX&#41;, &quot; freed&quot;, &quot;, Address = &quot;, &#40;type int32 &#91;EBX + ECX * 4&#93;&#41; &#41;;<br />		endif;<br />	endfor;<br />	<br />	free&#40; pArray &#41;;<br /></code></pre></div>
    <div class="meta">Posted on 2004-09-17 06:37:48 by ChupaThingy</div>
   </div>
   <div class="post" id="post-149941">
    <div class="subject"><a href="#post-149941">Newbie Array Question</a></div>
    <div class="body">Looks pretty good at first glance.  The only suggestion I can give at this time is to discontinue use of the depricated functions: stralloc, strfree, malloc and free.<br /><br />Instead use the new functions in the mem and str namespaces: str.alloc, str.free, mem.alloc and mem.free<br /><br />Much of what you have done here can also be done with arrays.hhf with the added advantage of allowing you to use indexed addressing mode.  Missing this ability is not a big deal however as it can be done by register indirect addressing.</div>
    <div class="meta">Posted on 2004-09-17 20:26:20 by Kain</div>
   </div>
   <div class="post" id="post-149948">
    <div class="subject"><a href="#post-149948">Newbie Array Question</a></div>
    <div class="body"><div class="quote">Looks pretty good at first glance.  The only suggestion I can give at this time is to discontinue use of the depricated functions: stralloc, strfree, malloc and free.</div><br /><br />I didn't know they were deprecated.  I was just following the docs (AoA mostly).  I'll update it, thanks.<br /><br /><div class="quote">Much of what you have done here can also be done with arrays.hhf with the added advantage of allowing you to use indexed addressing mode.  Missing this ability is not a big deal however as it can be done by register indirect addressing.</div><br /><br />As my first post pointed out, I was trying with arrays.hhf but I couldn't seem to get it to work.  I was really hoping to build the arrays in as high-level a manner as possible.<br /><br />If you would be willing to update the snippet above to use arrays.hhf I'd be forever in your debt.  I can't seem to get it working properly and have had even less luck finding a snippet or example to follow.</div>
    <div class="meta">Posted on 2004-09-18 00:44:07 by ChupaThingy</div>
   </div>
   <div class="post" id="post-150001">
    <div class="subject"><a href="#post-150001">Newbie Array Question</a></div>
    <div class="body">:-D Somehow I knew no one would fix my code above and hand me the answer I was looking for.  I had to try though (MTV generation and all).  Anyway, I think I've figured it out (it compiles, and runs, and does what I want).  There's just one problem.  I get a slew of errors when using array.element macro:<br /><br />(Version I'm using: <br />HLAParse Version 1.70 build 9367 (prototype)<br />MASM Version 6.14.8444)<br /><br />Error in file &quot;arrays.hhf&quot; at line 239 :<br />Macro called in file &quot;Src\ArrTest.hla&quot; at line 70<br />Undefined symbol.<br />Near: &lt;&lt; code &gt;&gt;<br /><br />Anyone seen this before?  I'll be more than happy to post the whole bit of code if needed.</div>
    <div class="meta">Posted on 2004-09-19 12:50:20 by ChupaThingy</div>
   </div>
   <div class="post" id="post-150011">
    <div class="subject"><a href="#post-150011">Newbie Array Question</a></div>
    <div class="body"><div class="quote"><br />:-D Somehow I knew no one would fix my code above and hand me the answer I was looking for. I had to try though (MTV generation and all).<div class="quote"><br /><br />Hehe.  As I mentioned earlier, I've never used arrays.hhf so I would'nt be able to help you on it.<br />Anyway, I did look through it and I didn't find a function to increase the size of your array once it was created... though I suppose you could create a new larger array and copy the original array into it.<br /><br /><br /><div class="quote">Anyone seen this before? I'll be more than happy to post the whole bit of code if needed.</div><br /><br />Please do.</div>
    <div class="meta">Posted on 2004-09-19 17:02:20 by Kain</div>
   </div>
   <div class="post" id="post-150019">
    <div class="subject"><a href="#post-150019">Newbie Array Question</a></div>
    <div class="body"><pre><code><br />/************************************************************<br />*** This program requires a textfile containing two lines<br />*** I used&#58;<br />*** key1=value1<br />*** key2=value2<br />************************************************************/<br /><br />program Arrays;<br />#include&#40; &quot;stdlib.hhf&quot; &#41;;<br />#include&#40; &quot;arrays.hhf&quot; &#41;;<br />#include&#40; &quot;strings.hhf&quot; &#41;;<br />#include&#40; &quot;fileio.hhf&quot; &#41;;<br /><br />var<br />	aK_V&#58; array.dArray&#40; string, 2 &#41;;<br />	hFile&#58;dword;<br /><br />	nIndex&#58;dword;<br /><br />	sReadLine&#58;string;<br />	sKey&#58;string;<br />	sValue&#58;string;<br /><br />	Row&#58;dword;<br />	Col&#58;dword;<br />	<br />begin Arrays;<br /><br />	fileio.open &#40; &quot;C&#58;\test.txt&quot;, fileio.r &#41;;<br />	mov&#40; EAX, hFile &#41;;<br />	<br />	array.daAlloc&#40; aK_V, 2, 3 &#41;;<br /><br />	mov&#40; 0, nIndex &#41;;<br /><br />	repeat<br />		fileio.a_gets&#40; hFile &#41;;<br />		mov&#40; EAX, sReadLine &#41;;<br />		<br />		str.index&#40; sReadLine, &quot;=&quot; &#41;;<br />		mov&#40; EAX, EBX &#41;;<br />		if&#40; &#40;type int32 EAX&#41; &gt;= 0 &#41; then<br />			str.a_substr&#40; sReadLine, 0, EBX &#41;;<br />			mov&#40; EAX, sKey &#41;;<br />			add&#40; 1, EBX &#41;;<br />			str.length&#40; sReadLine &#41;;<br />			sub&#40; EBX, EAX &#41;;<br />			str.a_substr&#40; sReadLine, EBX, EAX &#41;;<br />			mov&#40; EAX, sValue &#41;;<br /><br />			array.index&#40; EDX, aK_V, nIndex, 0 &#41;;<br />			mov&#40; sKey, &#91;EDX&#93; &#41;;<br /><br />			array.index&#40; EDX, aK_V, nIndex, 1 &#41;;<br />			mov&#40; sValue, &#91;EDX&#93; &#41;;<br />			<br />			add&#40; 1, nIndex &#41;;<br />		endif;<br />	until &#40; fileio.eof&#40; hFile &#41; &#41;;<br /><br />	fileio.close&#40; hFile &#41;;<br /><br />	fileio.openNew&#40; &quot;c&#58;\Keys.txt&quot; &#41;;<br />	fileio.close&#40; EAX &#41;;<br />	<br />	// fileio.a gives Undefined symbol Near&#58; &lt;&lt; .a &gt;&gt;<br />	// all others &#40;.w, .wr, .r&#41; work<br />	fileio.open&#40; &quot;c&#58;\Keys.txt&quot;, fileio.w &#41;;<br />	mov&#40; EAX, hFile &#41;;<br /><br />	mov&#40; nIndex, EBX &#41;;<br /><br />/************************************************************<br />*** trying to use array.element gives me these errors with<br />*** HLAParse Version 1.70 build 9367 &#40;prototype&#41;<br />*** MASM Version 6.14.8444<br />Error in file &quot;arrays.hhf&quot; at line 239 &#91;errid&#58;41348/hlaparse.bsn&#93;&#58;<br />Macro called in file &quot;Src\ArrTest.hla&quot; at line 70<br />Undefined symbol.<br />Near&#58; &lt;&lt; code &gt;&gt;<br /><br />Error in file &quot;arrays.hhf&quot; at line 239 &#91;errid&#58;58249/hlaparse.bsn&#93;&#58;<br />Macro called in file &quot;Src\ArrTest.hla&quot; at line 70<br />Constant is not allowed as parameter here.<br />Near&#58; &lt;&lt; &#40; &gt;&gt;<br /><br />Error in file &quot;arrays.hhf&quot; at line 239 &#91;errid&#58;58078/hlaparse.bsn&#93;&#58;<br />Macro called in file &quot;Src\ArrTest.hla&quot; at line 70<br />Too few actual parameters.<br />Near&#58; &lt;&lt; &#40; &gt;&gt;<br /><br />Error in file &quot;arrays.hhf&quot; at line 239 &#91;errid&#58;3277/hlaparse.bsn&#93;&#58;<br />Macro called in file &quot;Src\ArrTest.hla&quot; at line 70<br />Expected '&#41;', encountered '&#40;'.<br />Near&#58; &lt;&lt; &#40; &gt;&gt;<br /><br />Error in file &quot;arrays.hhf&quot; at line 239 &#91;errid&#58;75381/hlaparse.bsn&#93;&#58;<br />Macro called in file &quot;Src\ArrTest.hla&quot; at line 70<br />Expected 'do'.<br />Near&#58; &lt;&lt; &#40; &gt;&gt;<br /><br />	foreach array.element&#40; aK_V &#41; do<br />		fileio.puts&#40; hFile, &#91;EAX&#93; &#41;;<br />		strfree&#40; &#91;EAX&#93; &#41;;<br />	endfor;<br />*/<br /><br />	for&#40; mov&#40; 0, Row &#41;; Row &lt; EBX; add&#40; 1, Row &#41; &#41; do<br />		for&#40; mov&#40; 0, Col &#41;; Col &lt; EBX; add&#40; 1, Col &#41; &#41; do<br />			array.index&#40; EDX, aK_V, Row, Col &#41;;<br />			fileio.puts&#40; hFile, &#91;EDX&#93; &#41;;<br />		endfor;<br />		<br />		fileio.puts&#40; hFile, nl &#41;;<br />	endfor;<br /><br />	fileio.close&#40; hFile &#41;;<br /><br />	array.daFree&#40; aK_V &#41;;<br />end Arrays;<br /></code></pre></div>
    <div class="meta">Posted on 2004-09-19 19:20:53 by ChupaThingy</div>
   </div>
   <div class="post" id="post-150021">
    <div class="subject"><a href="#post-150021">Newbie Array Question</a></div>
    <div class="body">There is an error in arrays.hhf, I'll inform Mr. Hyde, if he hasn't already seen this.</div>
    <div class="meta">Posted on 2004-09-19 20:25:22 by Kain</div>
   </div>
   <div class="post" id="post-150022">
    <div class="subject"><a href="#post-150022">Newbie Array Question</a></div>
    <div class="body"><div class="quote">There is an error in arrays.hhf, I'll inform Mr. Hyde, if he hasn't already seen this.</div><br /><br />Oh good (well, not good, but... never mind).  At least it isn't something I'm doing wrong.<br /><br />By the way, thank you for HIDE.  Aside from a few random crashes with no error message it's the best IDE I've found for HLA.<br /><br />Is it still being worked on or have you moved over to other projects?</div>
    <div class="meta">Posted on 2004-09-19 21:31:39 by ChupaThingy</div>
   </div>
   <div class="post" id="post-150059">
    <div class="subject"><a href="#post-150059">Newbie Array Question</a></div>
    <div class="body"><div class="quote">There is an error in arrays.hhf, I'll inform Mr. Hyde, if he hasn't already seen this.</div><br /><br />This is new, and has been fixed for the HLA v1.71 release (whenever that will be).<br /><br />In the mean time, replace<br /><br />code( --- )<br />by<br />#{ --- }<br /><br />and you should be in business.<br />Cheers,<br />Randy Hyde</div>
    <div class="meta">Posted on 2004-09-20 10:28:50 by rhyde</div>
   </div>
   <div class="post" id="post-150083">
    <div class="subject"><a href="#post-150083">Newbie Array Question</a></div>
    <div class="body"><div class="quote"><br /><br />By the way, thank you for HIDE.  Aside from a few random crashes with no error message it's the best IDE I've found for HLA.<br /><br />Is it still being worked on or have you moved over to other projects?</div><br /><br />Thanks.  I'm still developing HIDE (a new version should be due in about a week).  Can you explain more of what you were doing just before the crashes (and what OS version)?</div>
    <div class="meta">Posted on 2004-09-20 21:39:13 by Kain</div>
   </div>
   <div class="post" id="post-150104">
    <div class="subject"><a href="#post-150104">Newbie Array Question</a></div>
    <div class="body">It's always when I build or save while the code window is dirty.  Strange thing is, if I open HIDE back up again, make the exact same changes (only way I can be sure of that statement is there are times I've just uncommented or commented a line or changed one variable name) and repeat the same previous action (build or save via hotkey or menu, it doesn't matter) it'll usually (70-80%) crash a second time, maybe even a third.  The third is less likely (maybe only 25-30%).<br /><br />I'm on XP sp1.  Doesn't matter which compiler I'm using (has happened both with the fasm it comes with and the masm I posted stats to above).  I don't remember right now which version of HIDE it is, I d/l'd it sometime during the last week though.  If you need it I can find out.<br /><br />I've started (just the night before last so there's not much there yet) keeping track of exactly what I did prior to the crash (in my wish list file for HIDE  :-D ).  The error is always &quot;Unhandled exception&quot;.  I have yet to re-install Olly (just got a new HD) so I can't tell you where it's happening.  Maybe I'll start running it through there though.  I get 3-4 of these crashes a night.  Fortunately, I save pretty religiously so it hasn't been a big deal (that and I know it's not release code).</div>
    <div class="meta">Posted on 2004-09-21 06:03:53 by ChupaThingy</div>
   </div>
   <div class="post" id="post-150139">
    <div class="subject"><a href="#post-150139">Newbie Array Question</a></div>
    <div class="body">When the crashes happen, are you working with or without projects (it helps to isolate the problem area)?</div>
    <div class="meta">Posted on 2004-09-21 15:57:54 by Kain</div>
   </div>
   <div class="post" id="post-150150">
    <div class="subject"><a href="#post-150150">Newbie Array Question</a></div>
    <div class="body">With projects.  I havn't not worked with them yet.  Even when I don't really need to (i.e. little snippets of one source file).  Another thing that increases the chances of a crash are if I open a file but not add it to the project and build while it's open (such as one of the .hhf files or a source file from another project that has a snippet I want).</div>
    <div class="meta">Posted on 2004-09-21 21:36:25 by ChupaThingy</div>
   </div>
  </div>
 </body>
</html>