<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Masm x64 Windows API - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20604" />
    <link rel="next" href="../?id=20604&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=20604">Masm x64 Windows API</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=20604&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=20604&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="20604" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=20604&amp;page=2">&gt;</a><a href="../?id=20604&amp;page=2">&raquo;</a></form>   <div class="post" id="post-157307">
    <div class="subject"><a href="#post-157307">Masm x64 Windows API</a></div>
    <div class="body">Hello,<br /><br />As you may know, Windows x64 is almost released.<br /><br />The calling convention for Windows API is totally different (parameters are passed in registers and not via the stack).<br /><br />Is anyone working or plan to work in a library that allow us to do the standard:<br /><br />invoke MessageBox, xx, xx, xx, ...<br /><br />Instead of passing parameters by registers and avoid learning which registers are passed for each API? That's a real pain! :)<br /><br />Thanks</div>
    <div class="meta">Posted on 2005-02-23 03:40:18 by Alorent</div>
   </div>
   <div class="post" id="post-157324">
    <div class="subject"><a href="#post-157324">Masm x64 Windows API</a></div>
    <div class="body">Are you sure about this?<br />I remember reading on msdn that only some api functions will be changed to reflect the x64 requirements. Nothing was said about changing the whole calling convention.</div>
    <div class="meta">Posted on 2005-02-23 08:58:09 by arafel</div>
   </div>
   <div class="post" id="post-157358">
    <div class="subject"><a href="#post-157358">Masm x64 Windows API</a></div>
    <div class="body">who uses ia-64 anyways? it has a total of like 2000 sales. parameters will still be passed through the stack for x64. as usual, but addresses must be qword aligned.</div>
    <div class="meta">Posted on 2005-02-23 17:34:03 by Drocon</div>
   </div>
   <div class="post" id="post-157371">
    <div class="subject"><a href="#post-157371">Masm x64 Windows API</a></div>
    <div class="body">I think there is a lot of confusion between IA-64, AMD64 and EM64T and how they will work with Window XP 64-bit Edition. I'll admit I am a bit confused too. <br /><br />Charles Petzold needs to write another book on Win64 on AMD64 / EM64T. But Microsoft is promoting .NET and Longhorn so much...<br /><br />I bet Windows XP x64 Edition becomes very popular. I wonder how that will effect .NET and Longhorn.<br /><br />The direction of things may be taking a turn here (I hope).</div>
    <div class="meta">Posted on 2005-02-23 18:39:26 by Greg</div>
   </div>
   <div class="post" id="post-157413">
    <div class="subject"><a href="#post-157413">Masm x64 Windows API</a></div>
    <div class="body">.Net and Longhorn are all wrapped together and would include any x64 stuff.  They will all be MS home base.</div>
    <div class="meta">Posted on 2005-02-23 22:48:55 by drhowarddrfine</div>
   </div>
   <div class="post" id="post-157416">
    <div class="subject"><a href="#post-157416">Masm x64 Windows API</a></div>
    <div class="body"><div class="quote">Are you sure about this?<br />I remember reading on msdn that only some api functions will be changed to reflect the x64 requirements. Nothing was said about changing the whole calling convention.</div><br />Check <a target="_blank" href="http://www.codegurus.be/codegurus/Programming/assembler&amp;win64_en.htm#Win64">Win64 ASM example source code</a> out.</div>
    <div class="meta">Posted on 2005-02-24 01:55:11 by MazeGen</div>
   </div>
   <div class="post" id="post-157417">
    <div class="subject"><a href="#post-157417">Masm x64 Windows API</a></div>
    <div class="body"><div class="quote">who uses ia-64 anyways? it has a total of like 2000 sales. parameters will still be passed through the stack for x64. as usual, but addresses must be qword aligned.</div><br />Itanium, IA-64, gets unsupported by Microsoft in last weeks. ML64 means ML x86-64. AFAIK there's no ML for Itanium, Microsoft distributes IAS (made by Intel) instead.</div>
    <div class="meta">Posted on 2005-02-24 01:59:58 by MazeGen</div>
   </div>
   <div class="post" id="post-157451">
    <div class="subject"><a href="#post-157451">Masm x64 Windows API</a></div>
    <div class="body"><div class="quote">.Net and Longhorn are all wrapped together and would include any x64 stuff. They will all be MS home base.</div><br /><br />If I understand things correctly, and I may not, .NET will be the base API for Longhorn and Win32 (and Win64?) applications will have to be converted to .NET before they are executed.  Very much like .NET applications have to be converted to Win32 now. I have read that .NET is 32-bit only at this time, but I'm sure they are working on 64-bit .NET.<br /><br />What I was trying to say above is that <strong>native</strong> 64-bit code using Win64 on Windows XP x64 Edition may become so popular that things may take a turn away from .NET and Longhorn. Maybe they will end up like IA-64. I hope so anyway, I really don't like .NET / Longhorn.</div>
    <div class="meta">Posted on 2005-02-24 14:37:05 by Greg</div>
   </div>
   <div class="post" id="post-157456">
    <div class="subject"><a href="#post-157456">Masm x64 Windows API</a></div>
    <div class="body">All dotNET code is eventually translated into the Win32 API.  However it is &quot;managed&quot; at the .NET level before doing so.  (To make a long explanation short).  <br /><br />Win32 code written in, say, C++ can be &quot;managed&quot; by the .NET framework or you can write it &quot;unmanaged&quot;, that is, without using the .NET framework, just as most code is written today.</div>
    <div class="meta">Posted on 2005-02-24 16:45:08 by drhowarddrfine</div>
   </div>
   <div class="post" id="post-157459">
    <div class="subject"><a href="#post-157459">Masm x64 Windows API</a></div>
    <div class="body"><div class="quote">Check <a target="_blank" href="http://www.codegurus.be/codegurus/Programming/assembler&amp;win64_en.htm#Win64">Win64 ASM example source code</a> out.</div><br />I though windows 64bit edition (for Itanium) and windows x64 are the same thing. Sorry for misunderstanding. :oops:</div>
    <div class="meta">Posted on 2005-02-24 19:22:33 by arafel</div>
   </div>
   <div class="post" id="post-157467">
    <div class="subject"><a href="#post-157467">Masm x64 Windows API</a></div>
    <div class="body">Hello,<br /><br />Yes, there are a lot of confusiong about AMD64, EMT64T and IA64.<br /><br />This are my 2 cents: <br /><br />AMD64 = EMT64T<br />--------------------<br /><br /><br />AMD64 is designed by AMD.<br />EMT64T is designed by Intel.<br /><br />AMD64 and EMT64T should be almost equivalent. Well, they are as similar as current Pentium processors and AMD processors for 32 bits.<br /><br />Their assembly code are referenced as x64 or x86-64.<br /><br />So, Windows XP x64 and Windows 2003 Server x64 are the binary compatible version for this 2 new 64bits processors. They both can be called Win64.<br /><br />They can also run in 32bit compatibility mode. So, they can run current 32bits versions of Windows without loosing performance.<br /><br /><br />Intel Itanium (IA64)<br />-----------------------<br /><br />This is a completely different beast. The instruction set is completely different and it uses a RISC architecture. Nothing is similar to our beloved x86 assembly code.<br /><br />My thoughts are that this Itanium processor will not be very expanded due to BIIIG prices . Also, to run our  32bits programs under Windows Server 2003 Itanium, they emulate each instruction. So, it will run Win32 apps much slower. I think this processor will be only use for big servers and not for home-use.<br /><br />The Windows version for this processor is called Windows 2003 Server Itanium.<br /><br /><br />Summing up<br />--------------<br /><br />I guess the future of our assembly code will be x64 (so called, x86-64 also). That's the assembly for AMD64 and EMT64T.<br /><br /><br />So, going back to my original question. You will see if you have a look at the following code for Win64 how MEssageBox and ExitProcess are called (they use registers parameters instead of the traditional stack)<br /><br /><br />---<br />mov r9d, 0       ; uType = MB_OK<br />lea r8,  mytit   ; LPCSTR lpCaption<br />lea rdx, mymsg   ; LPCSTR lpText<br />mov rcx, 0       ; hWnd = HWND_DESKTOP<br />call MessageBoxA<br />mov ecx, eax     ; uExitCode = MessageBox(...)<br />call ExitProcess<br /><br />---<br /><br />Annoying, isnt it? ;) I think that we should need a wrapper that converts our: <br /><br />invoke ExitProcess, 1 <br /><br />to<br /><br />mov ecx, 1<br />call ExitProcess<br /><br />And the same for all the rest APIs ;)<br /><br />Cheers</div>
    <div class="meta">Posted on 2005-02-25 02:52:54 by Alorent</div>
   </div>
   <div class="post" id="post-157468">
    <div class="subject"><a href="#post-157468">Masm x64 Windows API</a></div>
    <div class="body">My 2 cents about the processor modes:<br /><br />Legacy mode:<br /><ul>[*]means functionality just like current x86-16 and x86-32 processors<br />Long mode (only under 64-bit OS):<br /><ul>[*]with compatibily mode: used to run x86-16 and x86-32 native applications under 64-bit OS<br />[*]with 64-bit mode: supports all of new features<br /><br />BTW, this may be confusing: long mode (in AMD terminology) = IA-32e mode (in Intel terminology)</div>
    <div class="meta">Posted on 2005-02-25 04:21:31 by MazeGen</div>
   </div>
   <div class="post" id="post-157469">
    <div class="subject"><a href="#post-157469">Masm x64 Windows API</a></div>
    <div class="body">I thought &quot;long mode&quot; didn't support 16bit apps?</div>
    <div class="meta">Posted on 2005-02-25 04:25:10 by f0dder</div>
   </div>
   <div class="post" id="post-157471">
    <div class="subject"><a href="#post-157471">Masm x64 Windows API</a></div>
    <div class="body">I don't own x86-64 processor, I study AMD Programmer's Manual Volume 1 (I use revision 3.07), chapter 1.2.3 Compatibility Mode:<br /><div class="quote"><br />...allows 64-bit operating system to run existing 16-bit and 32-bit x86 applications. These legacy applications run in compatibility mode without recompilation.<br />Applications running in compatibility mode use 32-bit or 16-bit addressing and can access the first 4GB of virtual-address space. Legacy x86 instruction prefixes toggle between 16-bit and 32-bit address and operand sizes.<br />...<br /></div><br />Intel says the same in a bit different words, with one note:<br /><div class="quote"><br />...<br />(However, legacy applications which were run in Virtual 8086 mode or use hardware tasm management will not work.)<br />...<br /></div><br />It seems that there is almost 100% backward compatibility also in long mode.</div>
    <div class="meta">Posted on 2005-02-25 04:39:00 by MazeGen</div>
   </div>
   <div class="post" id="post-157474">
    <div class="subject"><a href="#post-157474">Masm x64 Windows API</a></div>
    <div class="body"><div class="quote"><br />However, legacy applications which were <strong>run in Virtual 8086 mode</strong> or use hardware tasm management will not work.<br /></div><br /><br />that sounds to me like 16bit apps won't work, or will have to be emulated... or am I completely misunderstanding this?</div>
    <div class="meta">Posted on 2005-02-25 11:34:29 by f0dder</div>
   </div>
   <div class="post" id="post-157477">
    <div class="subject"><a href="#post-157477">Masm x64 Windows API</a></div>
    <div class="body">No, just those that use V86 mode, such as DOS emulation. Old Windows applications should work fine, right? And you could probably switch it back to legacy mode to use V86 mode, if needed.</div>
    <div class="meta">Posted on 2005-02-25 14:43:49 by Sephiroth3</div>
   </div>
   <div class="post" id="post-157479">
    <div class="subject"><a href="#post-157479">Masm x64 Windows API</a></div>
    <div class="body">Someone really needs to write a good book on programming Windows XP x64 Edition.<br /><br />Here is some documentation on the Windows x64 Calling Convention, it's FASTCALL.<br /><a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/kmarch/hh/kmarch/64bitAMD_6ec00b51-bf75-41bf-8635-caa8653c8bd9.xml.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/kmarch/hh/kmarch/64bitAMD_6ec00b51-bf75-41bf-8635-caa8653c8bd9.xml.asp</a><br /><br />(later)<br />x87 and MMX code is not going to be allowed in a 64-bit app on Windows x64. <br />SSE/SSE2 only.<br /><a target="_blank" href="http://www.devx.com/amd/Article/20923">http://www.devx.com/amd/Article/20923</a><br /><br />(even later)<br />Windows x64 will <strong>not</strong> run MS-DOS or 16-bit Windows applications.<br /><a target="_blank" href="http://www.winsupersite.com/reviews/windowsxp_x64_preview2.asp">http://www.winsupersite.com/reviews/windowsxp_x64_preview2.asp</a> (third paragraph)<br /><br /><br />Big changes...</div>
    <div class="meta">Posted on 2005-02-25 16:13:15 by Greg</div>
   </div>
   <div class="post" id="post-157485">
    <div class="subject"><a href="#post-157485">Masm x64 Windows API</a></div>
    <div class="body">Well, when I say 16bit apps, I mean dos - I guess I should have been specific here, as 16bit pmode (win3.x) is another case. I run more DOS apps than I run win3.x stuff :)<br /><br />And as for switching back to legacy mode, humm... I think that would be too slow to be practical? So either DOS apps will be unsupported, or will have to be run in 100% CPU emulation mode (like dosbox) - eek!<br /><br />Greg: WTF? No MMX in native mode? Are they out of their minds? O_o (ok, if the SSE2 versions of MMX are allowed, I guess this is okay... but still!)<br /><br />I guess it's okay they're dropping 16bit (both DOS and win3.x) support. After all, these are not natively supported by hardware when in &quot;long&quot; mode (afaik), and most people don't need these anymore. And if they do, well, run a 32bit version of windows. Commandline tools can be rewritten to native win32/64 console applications, and DOS games ran like shit in emulation mode anyway :)<br /><br />Even though my new box is going to be an amd64, I dunno when I will be running XP64... will probably take some time, wait until the product matures and such.</div>
    <div class="meta">Posted on 2005-02-26 00:33:04 by f0dder</div>
   </div>
   <div class="post" id="post-157500">
    <div class="subject"><a href="#post-157500">Masm x64 Windows API</a></div>
    <div class="body">f0dder,<br /><br />What I have been wondering about is how we are supposed to do <br />transcendental functions (trigonometric, logarithmic and exponential <br />functions) in Windows x64 if you can't use x87 instructions? For example how <br />can you calculate a <em>Cosine</em> on SSE/SSE2? Will they have to be done in <br />software? Talk about sloooow.<br /><br />This is a Windows x64 limitation not an AMD64 or EM64T limitation. 64-bit <br />Linux can use x87 instructions.</div>
    <div class="meta">Posted on 2005-02-26 18:51:54 by Greg</div>
   </div>
   <div class="post" id="post-157509">
    <div class="subject"><a href="#post-157509">Masm x64 Windows API</a></div>
    <div class="body">Are there any informations about it directly from Microsoft? I can't believe Win x64 won't support native functions of the processor...</div>
    <div class="meta">Posted on 2005-02-27 00:39:28 by MazeGen</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=20604&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=20604&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="20604" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=20604&amp;page=2">&gt;</a><a href="../?id=20604&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>