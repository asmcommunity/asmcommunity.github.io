<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Warning StrLen Problems - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4417" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=4417">Warning StrLen Problems</a></p>
   <div class="post" id="post-30710">
    <div class="subject"><a href="#post-30710">Warning StrLen Problems</a></div>
    <div class="body">Since the StrLen war has carm down for a whilei been using M32 Strlen and Jens Duttke 2nd smallest one.<br /><br />Sometime one will work and the other don't in a given project in  the SAME block of CODE.  This is true...and i know what i am doing now...<br /><br />Also one day i dumped my file and looked at it and for ONLY one string that i did a reverse ONLY once, cut off a piece, than turned it back around again and GUEST WHAT .... that string in my dumped file showed up more times than it was REVERSED. All over the place. ( i got more testing to do but i thought i should tell you Guys to be aware, because tomorrow i might for get...<br /><br />I also had already mov Buffer1[0], 0 just after the operation so there was no reason to see more than one or two IF ANY reversted strings in my dumped files.<br /><br />So I am sticking with M32 StrLen and Jen's VERY FIRST ONE and the 2nd smallest one if ALL ELSE FAIL....<br /><br />As you build your app i think its a good idea to used difference styles and do some serious checking from time to time to see if the results underneath it all is true and acceptable.<br /><br />Everybody got there own style of coding that why we all get difference strange results some time<br /><br />BeWAre....Just in Case</div>
    <div class="meta">Posted on 2002-03-25 04:11:45 by cmax</div>
   </div>
   <div class="post" id="post-30719">
    <div class="subject"><a href="#post-30719">Warning StrLen Problems</a></div>
    <div class="body">Could you please post some source code, wich produces this problem?</div>
    <div class="meta">Posted on 2002-03-25 04:49:01 by bazik</div>
   </div>
   <div class="post" id="post-30741">
    <div class="subject"><a href="#post-30741">Warning StrLen Problems</a></div>
    <div class="body">The most reliable way to test a string length is to use a byte scanner as it does nothing fancy, it just scans until it finds a zero.<br /><br />I exhaustively tested the version by Agner Fog that is in the masm32 library and it was reliable in all instances so I am not sure what is happening with the others.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-03-25 07:38:31 by hutch--</div>
   </div>
   <div class="post" id="post-30751">
    <div class="subject"><a href="#post-30751">Re: Warning StrLen Problems</a></div>
    <div class="body">hi!<br /><br />cmax, can you please post the code which make problems ?<br /><br />I use my routine in some projects now, and it's already tested by some people, and nobody got any problem. And I am sure much more people used the routine which is included in hutch's MASM package without problems.<br /><br />I am interested in it, what's the test-string, at which address is the test-string, how much memory have you allocated and how have you allocated the memory.<br /><br />Maybe your string is langer than the allocated memory ?<br /><br />Cu, Jens<br />----<br /><a target="_blank" href="http://www.emucheater.com">http://www.emucheater.com</a><br /><a target="_blank" href="http://cyberpad.psxemu.com">http://cyberpad.psxemu.com</a></div>
    <div class="meta">Posted on 2002-03-25 08:33:46 by Jens Duttke</div>
   </div>
   <div class="post" id="post-30862">
    <div class="subject"><a href="#post-30862">Give me a few weeks and i will put some stuff together</a></div>
    <div class="body">Jens Duttke<br /><br />I use the First one that Hutch posted and the Last one that you posted ( the one with the minor changes ) and both are DAME good and fasters.  I play with a lot of code as i build my app and found that M32 StrLen will not work when yours do... and via sa vir sa at times...<br /><br />I do to much sh*t so i just want to say that they all have their place and that the programmmer should test them for themselfs when selecting for an CERTAIN block of code....<br /><br />My Sh*t now is all based on protection and i can't show the stupit sh*t that i am doing right now or it will all be for nothing....<br /><br />Give me a few weeks and i will put stuff together as i work and e-mail it to you because you and Hutch simply must know what i have founded.  Right now i am on a ROLL and can't stop.  <br /><br />But mind you, my sh*t is BACKWARD so it may not be important anyway.  But for people who do things differencly and don't know why sh*t went wrong than SIMPLY SWITCH LEN for that block of code ONLY.  That's ALLLLLL.....<br /><br />As i said i do a lot of Stupit Sh*t that workssss.<br /><br />The regular programmer (doing things the right way) it will not give him stange results... only people like me get them because of the way we do things....BACKWARD sometime.  So don't worry Just test the test until then...<br /><br />excuse my lang<br /><br />See ya<br /><br />I will do this for you but i need time</div>
    <div class="meta">Posted on 2002-03-25 18:56:29 by cmax</div>
   </div>
   <div class="post" id="post-30865">
    <div class="subject"><a href="#post-30865">Warning StrLen Problems</a></div>
    <div class="body"><div class="quote"><br />But mind you, my sh*t is BACKWARD<br /></div><br />BACKWARD as in &quot;weird a$$ code&quot; or &quot;std&quot;? If it's the latter, always<br />&quot;cld&quot; after you're done...</div>
    <div class="meta">Posted on 2002-03-25 19:04:32 by f0dder</div>
   </div>
   <div class="post" id="post-30936">
    <div class="subject"><a href="#post-30936">Warning StrLen Problems</a></div>
    <div class="body"><strong> f0dder </strong> <br /><br />It's unbeleivable that you made since of what i did...<br /><br />In that block of code i use StrLen first that a Reverse String added to it with other junk.   And what you said, make me relize that it's not StrLen that cause my problem it's a the stuff i did AFTER it....<br /><br /><strong>Sorry, Jens</strong> <br /><br />I just got a big piece of bad coding.  Thats a personal PROBLEM...Sorry Guys  ,  I forgot it depend on what you doing and when you using stuff...<br /><br /><br /><strong> f0dder </strong> <br /><br />it's &quot;weird a$$ code&quot;  but i know how to fix it now....also i did not use std and stuff right...Thanks</div>
    <div class="meta">Posted on 2002-03-26 03:26:29 by cmax</div>
   </div>
   <div class="post" id="post-31131">
    <div class="subject"><a href="#post-31131">Warning StrLen Problems</a></div>
    <div class="body"><strong>bAZiK</strong> <br /><br />Sorry i did not see your reply, i was rushing and worried.  I like your new logo.<br /><br /><br /><br /><br />.386<br />.model flat,stdcall<br />option casemap:none<br />WinMain proto :DWORD,:DWORD,:DWORD,:SWORD<br /><br /><br />      include \MASM32\INCLUDE\windows.inc<br />      include \MASM32\INCLUDE\masm32.inc<br />      include \MASM32\INCLUDE\gdi32.inc<br />      include \MASM32\INCLUDE\user32.inc<br />      include \MASM32\INCLUDE\kernel32.inc<br />      includelib \MASM32\LIB\masm32.lib<br /><br />      includelib \MASM32\LIB\gdi32.lib<br />      includelib \MASM32\LIB\user32.lib<br />      includelib \MASM32\LIB\kernel32.lib<br /> <br /><br />MessageBoxA PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />Len2    PROTO :DWORD<br />wsprintfA PROTO C :DWORD,:VARARG<br />wsprintf equ &lt;wsprintfA&gt;<br /><br />.data<br /><br />String1            db &quot;C:\Window\Notepad.exe&quot;,0<br /><br /><br />.data? <br /><br /><br />Buffer1             BYTE 128 dup(?)<br />Buffer2             BYTE 128 dup(?)<br />Buffer3             BYTE 128 dup(?)<br />Buffer4             BYTE 128 dup(?)<br />Buffer5             BYTE 128 dup(?)<br /><br /><br />.code<br /> Main: <br /><br />;.....; Copy the string To Buffer...Why...This is the way i want did<br />;.....;  it in my app<br /><br /><br />mov esi, offset String1<br />mov edi, offset Buffer1<br />mov ecx, lengthof String1<br />rep movsb<br />; ...........................Jens StrLen Will not make it to Message box 3<br />; ...........................here, but in my app it Do.  Switch and see<br />; ...........................Strange to me it don't work in this example<br />; ...........................It is the exact same way in my app but to<br />; ...........................get other words the same way....<br /><br /><br />; ..........................; M32 StrLen will get tMessage box 3 <br />; ..........................; wrong with MY coding but that is not the<br />; ..........................; point just yet<br /><br />    mov ecx, offset Buffer1<br />  @@:<br />    mov eax, dword ptr <br />    add ecx, 4<br />    lea edx, <br />    xor eax, edx<br />    and eax, 80808080h<br />    and eax, edx<br />    jz @B<br />  @@:<br />    bsf edx, eax<br />    lea eax,  ; n<br />    shr eax, 3<br />    sub eax, offset Buffer1 ; n<br /><br /><br />;    push    offset Buffer1<br />;    mov     eax,eax<br />;    lea     edx,<br />;  @@:     <br />;    mov     ebx,<br />;    add     eax,128               ;; i have to put 128 here but i dont<br />;have to do that with Jens. His works <br />;;;;but in a few cases it sometimes the other way around....<br />;    lea     ecx,<br />;    not     ebx<br />;    and     ecx,ebx<br />;    and     ecx,80808080h    <br />;    jz      @B<br />;    test    ecx,00008080h<br />;    jnz     @F<br />;    shr     ecx,16<br />;   @@:<br />;    shl     cl,1<br />;    sbb     eax,edx<br />;    pop     ebx<br /><br /><br />;;invoke    MessageBoxA, 0, offset Buffer1, 0, 0                           ;MessageBox 1<br /><br />; ......................................................  Part 1:   Reverse String<br />    push edi<br />    mov ecx, offset Buffer1<br />    lea edx,<br />    lea ecx,<br />    mov edi, offset Buffer2<br />  @@:<br />    mov al, <br />    dec ecx<br />    mov , al<br />    inc edi<br />    cmp ecx, edx<br />    jne @B<br />    mov byte ptr ,0<br />    pop edi<br /><br />invoke    MessageBoxA, 0, offset Buffer2, 0, 0                                ;MessageBox 2<br /><br />; ............................................  Part 1:   Cut Out .exe from String<br /> lea esi, offset Buffer2<br />@@:<br /> mov al, byte ptr <br /> inc esi<br /> cmp al, &quot;\&quot;<br /> jne @B<br /> lea edi, offset Buffer3 ; n<br /> xor ecx, ecx<br /><br />@@:<br /> mov al, byte ptr <br /> mov byte ptr , al<br /> inc esi<br /> inc edi<br />.if al == ':' ;n.. one of these is a facker just to get things to work<br /> inc ecx<br />.endif<br /> cmp ecx, SIZEOF Buffer2;;128 ; n<br /> jne @B<br />xor edx,edx<br />xor ecx,edx<br />xor ebx,edx<br />xor eax,edx   ;;;;;;;;; I don't know why these 4 line are here but i <br />;;;;;;;;;;;;;;;;;;;;;;;;;;  had to do it some where to get it<br />;;;;;;;;;;;;;;;;;;;;;;;;;;  to work when i first start trying to reverve <br />;;;;;;;;;;;;;;;;;;;;;;;;;;  strings and stuff...It was stange too.<br /><br /><br />invoke    MessageBoxA, 0, offset Buffer3, 0, 0                                ;MessageBox 3<br /><br />; .......................... Jens StrLen  Round 2    GET Reverse String and<br />; .......................... Jens StrLen  Round 2    GET Reverse String and<br />; .......................... Jens StrLen  Round 2    GET Reverse String and<br />    mov ecx, offset Buffer3<br />  @@:<br />    mov eax, dword ptr <br />    add ecx, 4<br />    lea edx, <br />    xor eax, edx<br />    and eax, 80808080h<br />    and eax, edx<br />    jz @B<br />  @@:<br />    bsf edx, eax<br />    lea eax,  ; n<br />    shr eax, 3<br />    sub eax, offset Buffer3 ; n<br />; ......................     Part 2:   Reverse String Back to original state<br />    push edi<br />    mov ecx, offset Buffer3<br />    lea edx,<br />    lea ecx,<br />    mov edi, offset Buffer4<br />  @@:<br />    mov al, <br />    dec ecx<br />    mov , al<br />    inc edi<br />    cmp ecx, edx<br />    jne @B<br />    mov byte ptr ,0<br />    pop edi<br /><br />;.................It should just end up with the word window<br />;.................and it does in my app.  i don't know why it <br />;.................is not working here.  But that still bring me<br />;.................back to when i dump my app it got 20 line of<br />;.................reversed of a single string reverved.  Even<br />;.................though the my app works but i know that something<br />;.................is wrong and i got to fix it...<br />;......only the word WINDOWS should show up in the message box<br />;......Remember to DUMP it even if you fix-it to see if everything<br />;......is alright...Thank you for helping...<br /><br />end     Main<br /><br /><br /><br /><strong>in the matter of fact bAZiK i got this code (Your Code) from smurf old post back when smurf and me went string crazy</strong> But he left me behind he were learning so fast...It's my favorite code before i got lost...</div>
    <div class="meta">Posted on 2002-03-27 06:32:51 by cmax</div>
   </div>
  </div>
 </body>
</html>