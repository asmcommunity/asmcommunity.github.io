<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Get windows coords of a given display of a given adapter - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30076" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=116">Windows</a> &raquo; <a href="../?id=30076">Get windows coords of a given display of a given adapter</a></p>
   <div class="post" id="post-212213">
    <div class="subject"><a href="#post-212213">Get windows coords of a given display of a given adapter</a></div>
    <div class="body">As the topic says, the problem is as follows:<br />I can enumerate display adapters via <a target="_blank" href="http://msdn.microsoft.com/en-us/library/dd162609(VS.85).aspx">EnumDisplayDevices</a>. I can enumerate display outputs of a given display adapter via the same funcion. BUT the latter enumeration doesn&#039;t give display output&#039;s window (desktop) coordinates. It just gives you a name. The functions which give window coords are <a target="_blank" href="http://msdn.microsoft.com/en-us/library/dd162610(VS.85).aspx">EnumDisplayMonitors</a> or <a target="_blank" href="http://msdn.microsoft.com/en-us/library/dd144901(VS.85).aspx">GetMonitorInfo</a>, none of which take display output&#039;s name as one of its parameters. So how do I link the names of enumerated display outputs of a given adapter to their respective window/desktop coordinates? Let&#039;s say I have 2 adapters, 2 displays each (4 displays total). I want to get window coords of the first display of they second adapter.</div>
    <div class="meta">Posted on 2010-07-05 12:25:25 by ti_mo_n</div>
   </div>
   <div class="post" id="post-212216">
    <div class="subject"><a href="#post-212216">Re: Get windows coords of a given display of a given adapter</a></div>
    <div class="body">Hum... if you do EnumDisplayMonitors, you get the HMONITOR. You can then use GetMonitorInfo to get the adapter name (make sure you pass a <a target="_blank" href="http://msdn.microsoft.com/en-us/library/dd145066(v=VS.85).aspx">MONITORINFOEX structure</a>, the regular MONITORINFO doesn&#039;t have the name string).<br />Then you can compare that string to the one you got with EnumDisplayDevices, and you know which monitor belongs to which adapter... I think :)</div>
    <div class="meta">Posted on 2010-07-05 14:49:44 by Scali</div>
   </div>
   <div class="post" id="post-212218">
    <div class="subject"><a href="#post-212218">Re: Get windows coords of a given display of a given adapter</a></div>
    <div class="body">Apparently, it works! Thanks! :D <br />The only minor correction to the steps you proposed is that after you get MONITORINFOEX, you need to pass it through EnumDisplayDevices once more to get its &quot;real&quot; name.<br /><br />If anyone with multiple adapters/display outputs could test the attached files, I would be grateful ^^<br /><br /><br />The relevant parts of the code, in C/C++, are as follows:<br /><pre><code><br />// monitor info<br />typedef struct _MONINF {<br /> &nbsp;RECT coords;<br /> &nbsp;TCHAR devname[32],<br /> &nbsp; &nbsp; &nbsp; &nbsp;dspname[128];<br /> &nbsp;BOOL isAttached;<br />} MONINF;<br /><br />// helper struct<br />typedef struct _MYPARAMS {<br /> &nbsp;MONINF **displays;<br /> &nbsp;CONST UINT *dspcnts;<br /> &nbsp;MONITORINFOEX miex;<br /> &nbsp;DISPLAY_DEVICE dd;<br /> &nbsp;UINT adcnt;<br />} MYPARAMS;<br /><br />// ---------------------------------------------------------------------------------------------------------<br /><br />// get display devices<br />// we use this first time to enumerate adapters and subsequent times<br />// to enumerate displays on a particular adapter<br />static UINT getDevs(HANDLE hHeap, CONST TCHAR *dn, DISPLAY_DEVICE **oad) {<br /> &nbsp;DISPLAY_DEVICE *ad, *tmpad;<br /> &nbsp;UINT i, j, k;<br /><br /> &nbsp;_tprintf(dbg01);<br /> &nbsp;if (hHeap) {<br /> &nbsp; &nbsp;if ((ad = (DISPLAY_DEVICE *)HeapAlloc(hHeap, 0, sizeof(DISPLAY_DEVICE)))) {<br /> &nbsp; &nbsp; &nbsp;j = 0;<br /> &nbsp; &nbsp; &nbsp;k = 0;<br /> &nbsp; &nbsp; &nbsp;ad-&gt;cb = sizeof(DISPLAY_DEVICE);<br /> &nbsp; &nbsp; &nbsp;while (EnumDisplayDevices(dn, j, ad, 0)) {<br /> &nbsp; &nbsp; &nbsp; &nbsp;j++;<br /> &nbsp; &nbsp; &nbsp; &nbsp;if (!(ad-&gt;StateFlags &amp; DISPLAY_DEVICE_MIRRORING_DRIVER)) k++;<br /> &nbsp; &nbsp; &nbsp; &nbsp;ad-&gt;cb = sizeof(DISPLAY_DEVICE);<br /> &nbsp; &nbsp; &nbsp;}<br /><br /> &nbsp; &nbsp; &nbsp;if (k &gt; 0) {<br /> &nbsp; &nbsp; &nbsp; &nbsp;tmpad = NULL;<br /> &nbsp; &nbsp; &nbsp; &nbsp;if ((k == 1) || (tmpad = (DISPLAY_DEVICE *)HeapReAlloc(hHeap, 0, ad, (sizeof(DISPLAY_DEVICE) * k)))) {<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (tmpad) ad = tmpad;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;i = 0;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;j = 0;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ad[0].cb = sizeof(DISPLAY_DEVICE);<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;while ((j &lt; k) &amp;&amp; EnumDisplayDevices(dn, i, &amp;(ad), 0)) {<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;i++;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!(ad-&gt;StateFlags &amp; DISPLAY_DEVICE_MIRRORING_DRIVER)) j++;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (j &lt; k) ad.cb = sizeof(DISPLAY_DEVICE);<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (oad) (*oad) = ad;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else HeapFree(hHeap, 0, oad);<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_tprintf(dbg02a);<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return k;<br /> &nbsp; &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp; &nbsp;HeapFree(hHeap, 0, ad);<br /> &nbsp; &nbsp;}<br /> &nbsp;}<br /> &nbsp;if (oad) (*oad) = NULL;<br /> &nbsp;_tprintf(dbg02b);<br /> &nbsp;return 0;<br />}<br /><br />// returns all display outputs that belong to an adapter given by its name<br />static UINT getDisplays(HANDLE hHeap, CONST TCHAR *adnam, MONINF **odsp) {<br /> &nbsp;DISPLAY_DEVICE *dspinf;<br /> &nbsp;MONINF *dsp;<br /> &nbsp;UINT dspcnt, i;<br /><br /> &nbsp;_tprintf(dbg03);<br /> &nbsp;if (hHeap &amp;&amp; adnam) {<br /> &nbsp; &nbsp;dspcnt = getDevs(hHeap, adnam, &amp;dspinf);<br /> &nbsp; &nbsp;if (dspcnt) {<br /> &nbsp; &nbsp; &nbsp;if ((dsp = (MONINF *)HeapAlloc(hHeap, 0, (sizeof(MONINF) * dspcnt)))) {<br /> &nbsp; &nbsp; &nbsp; &nbsp;for (i = 0; i &lt; dspcnt; i++) {<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;memcpy(&amp;(dsp<em>.devname), dspinf<em>.DeviceName, (sizeof(TCHAR) &lt;&lt; 5));<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;memcpy(&amp;(dsp<em>.dspname), dspinf<em>.DeviceString, (sizeof(TCHAR) &lt;&lt; 7));<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dsp<em>.isAttached = ((dspinf<em>.StateFlags &amp; DISPLAY_DEVICE_ATTACHED_TO_DESKTOP) ? TRUE : FALSE);<br /> &nbsp; &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp; &nbsp; &nbsp;if (odsp) (*odsp) = dsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;else HeapFree(hHeap, 0, dsp);<br /> &nbsp; &nbsp; &nbsp; &nbsp;_tprintf(dbg04a);<br /> &nbsp; &nbsp; &nbsp; &nbsp;return dspcnt;<br /> &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp;}<br /> &nbsp; &nbsp;if (dspinf) HeapFree(hHeap, 0, dspinf);<br /> &nbsp;}<br /> &nbsp;if (odsp) (*odsp) = NULL;<br /> &nbsp;_tprintf(dbg04b);<br /> &nbsp;return 0;<br />}<br /><br />// the &#039;enumproc&#039; which performs display name comparison and fills the coordinate data<br />static BOOL CALLBACK MonitorEnumProc(HMONITOR hMonitor, HDC hdcMonitor, LPRECT lprcMonitor, LPARAM dwData) {<br /> &nbsp;MYPARAMS *mp = ((MYPARAMS *)dwData);<br /> &nbsp;UINT i, j, k, l;<br /><br /> &nbsp;if (mp) {<br /> &nbsp; &nbsp;if (hMonitor) {<br /> &nbsp; &nbsp; &nbsp;mp-&gt;miex.cbSize = sizeof(MONITORINFOEX);<br /> &nbsp; &nbsp; &nbsp;if (GetMonitorInfo(hMonitor, &amp;(mp-&gt;miex))) {<br /> &nbsp; &nbsp; &nbsp; &nbsp;mp-&gt;dd.cb = sizeof(DISPLAY_DEVICE);<br /> &nbsp; &nbsp; &nbsp; &nbsp;if (EnumDisplayDevices(mp-&gt;miex.szDevice, 0, &amp;(mp-&gt;dd), 0)) {<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;j = mp-&gt;adcnt;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (i = 0; i &lt; j; i++) {<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;l = mp-&gt;dspcnts<em>;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (k = 0; k &lt; l; k++) {<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!(lstrcmp(mp-&gt;dd.DeviceName, mp-&gt;displays<em>.devname))) {<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mp-&gt;displays<em>.coords = mp-&gt;miex.rcMonitor;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return TRUE;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp;}<br /> &nbsp; &nbsp;return TRUE;<br /> &nbsp;}<br /> &nbsp;return FALSE;<br />}<br /><br />// starter for the enumproc<br />static VOID fillDisplayCoords(HANDLE hHeap, UINT adcnt, CONST UINT *dspcnts, MONINF **displays) {<br /> &nbsp;MYPARAMS *mp;<br /><br /> &nbsp;_tprintf(dbg05);<br /> &nbsp;if ((hHeap) &amp;&amp; (adcnt &gt; 0) &amp;&amp; (dspcnts) &amp;&amp; (displays)) {<br /> &nbsp; &nbsp;if ((mp = (MYPARAMS *)HeapAlloc(hHeap, 0, sizeof(MYPARAMS)))) {<br /> &nbsp; &nbsp; &nbsp;mp-&gt;displays = displays;<br /> &nbsp; &nbsp; &nbsp;mp-&gt;dspcnts = dspcnts;<br /> &nbsp; &nbsp; &nbsp;mp-&gt;adcnt = adcnt;<br /> &nbsp; &nbsp; &nbsp;EnumDisplayMonitors(NULL, NULL, &amp;MonitorEnumProc, (LPARAM)mp);<br /> &nbsp; &nbsp; &nbsp;HeapFree(hHeap, 0, mp);<br /> &nbsp; &nbsp;}<br /> &nbsp;}<br /> &nbsp;_tprintf(dbg06);<br />}<br /><br />// kinda self-explanatory...<br />static VOID presentDisplays(DISPLAY_DEVICE *adapters, UINT adcnt, MONINF **dsps, UINT *dspcnts) {<br /> &nbsp;UINT i, j, k, l;<br /><br /> &nbsp;_tprintf(dbg07);<br /> &nbsp;if ((adcnt &gt; 0) &amp;&amp; (adapters) &amp;&amp; (dsps) &amp;&amp; (dspcnts)) {<br /> &nbsp; &nbsp;l = 0;<br /> &nbsp; &nbsp;_tprintf(dsprn);<br /> &nbsp; &nbsp;for (i = 0; i &lt; adcnt; i++) {<br /> &nbsp; &nbsp; &nbsp;k = dspcnts<em>;<br /> &nbsp; &nbsp; &nbsp;for (j = 0; j &lt; k; j++) {<br /> &nbsp; &nbsp; &nbsp; &nbsp;if (dsps<em>) {<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_tprintf(dspst, l, dsps<em>.dspname, adapters<em>.DeviceString, dsps<em>.coords.left, dsps<em>.coords.top, dsps<em>.coords.right, dsps<em>.coords.bottom);<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;l++;<br /> &nbsp; &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp;}<br /> &nbsp; &nbsp;_tprintf(dsprn);<br /> &nbsp;}<br /> &nbsp;_tprintf(dbg08);<br />}<br /><br />// the startup function<br />static INT mymain2(INT argc, _TCHAR* argv&#91;]) {<br /> &nbsp;HANDLE hHeap;<br /> &nbsp;DISPLAY_DEVICE *adapters;<br /> &nbsp;MONINF **displays;<br /> &nbsp;UINT *dspcnts;<br /> &nbsp;UINT adcnt, i;<br /><br /> &nbsp;displays = NULL;<br /> &nbsp;adapters = NULL;<br /> &nbsp;if (!(hHeap = GetProcessHeap())) return -1;<br /><br /> &nbsp;adcnt = getDevs(hHeap, NULL, &amp;adapters);<br /> &nbsp;<br /> &nbsp;if (adcnt &gt; 0) {<br /> &nbsp; &nbsp;if ((dspcnts = (UINT *)HeapAlloc(hHeap, 0, (sizeof(UINT) * adcnt)))) {<br /> &nbsp; &nbsp; &nbsp;if ((displays = (MONINF **)HeapAlloc(hHeap, 0, (sizeof(MONINF *) * adcnt)))) {<br /> &nbsp; &nbsp; &nbsp; &nbsp;for (i = 0; i &lt; adcnt; i++) {<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dspcnts<em> = getDisplays(hHeap, adapters<em>.DeviceName, &amp;(displays<em>));<br /> &nbsp; &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp; &nbsp; &nbsp;fillDisplayCoords(hHeap, adcnt, dspcnts, displays);<br /> &nbsp; &nbsp; &nbsp;}<br /> &nbsp; &nbsp;}<br /> &nbsp;}<br /><br /><br /> &nbsp;if ((adapters) &amp;&amp; (displays) &amp;&amp; (dspcnts) &amp;&amp; (adcnt &gt; 0)) presentDisplays(adapters, adcnt, displays, dspcnts);<br /><br /><br /> &nbsp;if (dspcnts) HeapFree(hHeap, 0, dspcnts);<br /> &nbsp;if (displays) {<br /> &nbsp; &nbsp;for (i = 0; i &lt; adcnt; i++) {<br /> &nbsp; &nbsp; &nbsp;if (displays<em>) HeapFree(hHeap, 0, displays<em>);<br /> &nbsp; &nbsp;}<br /> &nbsp; &nbsp;HeapFree(hHeap, 0, displays);<br /> &nbsp;}<br /> &nbsp;if (adapters) HeapFree(hHeap, 0, adapters);<br /> &nbsp;_tsystem(pscmd);<br /> &nbsp;return 0;<br />}<br /></code></pre></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=3211" target="_blank">dispenum5.zip</a></li>
      <li><a href="../../attachments/?id=3212" target="_blank">its_alive_;).png</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2010-07-05 18:21:39 by ti_mo_n</div>
   </div>
  </div>
 </body>
</html>