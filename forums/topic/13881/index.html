<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Question... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13881" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=13881">Question...</a></p>
   <div class="post" id="post-107296">
    <div class="subject"><a href="#post-107296">Question...</a></div>
    <div class="body">Hi everyone.<br /><br />Okay, here is my dilemma. I have an old app laying around which was written in Delphi. This app displays OS version information in this format:<br /><br /><strong>Operating System: Windows XP 5.1 build 2600 (Service Pack 1)</strong><br /><br />It does this for ALL versions of windows from 95 and up. In delphi this was easy, but I am at a loss as to how to achieve this in MASM. If someone can just nudge me in the right direction, it would be a big help. :)<br /><br />Many thanks in advance!</div>
    <div class="meta">Posted on 2003-06-16 17:09:34 by The Beginner</div>
   </div>
   <div class="post" id="post-107312">
    <div class="subject"><a href="#post-107312">Question...</a></div>
    <div class="body">Look at API function <strong>GetVersionEx</strong> .<br /><br />RobotBob</div>
    <div class="meta">Posted on 2003-06-16 21:14:07 by RobotBob</div>
   </div>
   <div class="post" id="post-107663">
    <div class="subject"><a href="#post-107663">Question...</a></div>
    <div class="body">Do you mean when you right click the .exe and select properties? That's set by the resource script, Like this:<br /><br /><pre><code><br />1 VERSIONINFO	MOVEABLE IMPURE LOADONCALL DISCARDABLE<br />BEGIN<br />    BLOCK &quot;StringFileInfo&quot;<br />    BEGIN<br />        BLOCK &quot;040C04E4&quot;	//Block&#58; language ID = French, char set = Windows, Multilingual<br />        BEGIN<br />            VALUE	&quot;CompanyName&quot;,	&quot;http&#58;//www.asmcommunity.net/board/index.php\0&quot;<br />            VALUE	&quot;FileDescription&quot;,	&quot;Adding Scripting capabilities to an exe\0&quot;<br />            VALUE	&quot;FileVersion&quot;,	&quot;01,23,04,2003\0&quot;<br />            VALUE	&quot;InternalName&quot;,	&quot;ScripTxt\0&quot;<br />            VALUE	&quot;OriginalFilename&quot;,	&quot;ScripTxt.exe\0&quot;<br />            VALUE	&quot;ProductName&quot;,	&quot;ScripTxt\0&quot;<br />            VALUE	&quot;ProductVersion&quot;,	&quot;03.04.2003\0&quot;<br />            VALUE	&quot;Comments&quot;,	&quot;Revised by near everyone\0&quot;<br />            VALUE	&quot;LegalCopyright&quot;,	&quot;Freeware for non commercial use\0&quot;<br />            VALUE	&quot;OLESelfRegister&quot;,&quot;\0&quot;<br />        END<br />    END<br />    BLOCK &quot;VarFileInfo&quot;<br />    BEGIN<br />        VALUE	&quot;Translation&quot;, 0x040C, 1252<br />    END<br />END<br /></code></pre><br /><br />(This isn't a COM dll, its an exeacutable. ToutEnMasm added it to one of my projects when he was fixing it.)</div>
    <div class="meta">Posted on 2003-06-19 23:17:37 by Ernie</div>
   </div>
   <div class="post" id="post-107670">
    <div class="subject"><a href="#post-107670">Question...</a></div>
    <div class="body">If you're using RadASM you can set the versioninfo by selecting Versioninfo from the project menu and filling in the values. It will auto-generate the RC script for you, you should do it from the menu in RadASM as it makes updating easier and using version-inc you can have it auto-increment build numbers.</div>
    <div class="meta">Posted on 2003-06-20 00:47:04 by donkey</div>
   </div>
   <div class="post" id="post-107876">
    <div class="subject"><a href="#post-107876">Question...</a></div>
    <div class="body">Thanks everyone, but I was asking about OS version information as I asked in my post above. :)</div>
    <div class="meta">Posted on 2003-06-22 08:44:27 by The Beginner</div>
   </div>
   <div class="post" id="post-107888">
    <div class="subject"><a href="#post-107888">Question...</a></div>
    <div class="body">That was the GetVersionEx answer, all the information you need about the OS is from that api. You have to build the strings yourself.</div>
    <div class="meta">Posted on 2003-06-22 09:50:29 by donkey</div>
   </div>
   <div class="post" id="post-107892">
    <div class="subject"><a href="#post-107892">Question...</a></div>
    <div class="body">Using wsprintf most likely I suppose.</div>
    <div class="meta">Posted on 2003-06-22 10:04:27 by roticv</div>
   </div>
   <div class="post" id="post-107923">
    <div class="subject"><a href="#post-107923">Question...</a></div>
    <div class="body">Alot of the return values are just numbers.<br />You'll have to look at msdn to find the associated strings.<br />(like <strong>donkey</strong> states)<br />But this gives you more power. Instead of Win98 Second Edition, you could call it &quot;M$ Bloated Dos Shell 98SE!&quot;  /jk :grin: <br /><br />It is really easy to use. I use it for tests to see what platform my app is running on. In this instance (testing platform versions for features) the associated string are not needed.<br /><br />RobotBob</div>
    <div class="meta">Posted on 2003-06-22 17:38:22 by RobotBob</div>
   </div>
   <div class="post" id="post-107926">
    <div class="subject"><a href="#post-107926">Question...</a></div>
    <div class="body"><div class="quote"><br />That was the GetVersionEx answer, all the information you need about the OS is from that api. You have to build the strings yourself. </div><br /><br />I guess the problem is building the strings. In Delphi, it was easy:<br /><br /><pre><code><br />function GetWindowsVersion&#58; String;<br />var<br />  lpOS&#58; TOsVersionInfo;<br />  build&#58; String;<br />begin<br /> lpOS.dwOSVersionInfoSize &#58;= SizeOf&#40;OsVersionInfo&#41;;<br /> GetVersionEx&#40;lpOS&#41;;<br /><br /> case lpOs.dwPlatformId of<br /> VER_PLATFORM_WIN32_NT&#58;<br /> begin<br /> build &#58;= ' build ' + IntToStr&#40;lpOS.dwBuildNumber&#41; + ' &#40;' + lpOS.szCSDVersion + '&#41;'; //Windows build and SP<br /> if build = '' then build &#58;= '&#40;No Service Pack Installed&#41;';<br />   if &#40;lpOS.dwMajorVersion &lt;= 4&#41; then<br />      result &#58;= 'Windows NT ' + IntToStr&#40;lpOS.dwMajorVersion&#41; + '.' + IntToStr&#40;lpOS.dwMinorVersion&#41; +<br />                build; //IntToStr&#40;lpOS.dwBuildNumber&#41; + ' &#40;' + lpOS.szCSDVersion + '&#41;';;<br />   if &#40;&#40;lpOS.dwMajorVersion = 5&#41; and &#40;lpOS.dwMinorVersion = 0&#41;&#41; then<br />      result &#58;= 'Windows 2000 ' + IntToStr&#40;lpOS.dwMajorVersion&#41; + '.' + IntToStr&#40;lpOS.dwMinorVersion&#41; +<br />                build //IntToStr&#40;lpOS.dwBuildNumber&#41; + ' &#40;' + lpOS.szCSDVersion + '&#41;'<br />       else<br />    if &#40;&#40;lpOS.dwMajorVersion = 5&#41; and &#40;lpOS.dwMinorVersion = 1&#41;&#41; then<br />      result &#58;= 'Windows XP ' + IntToStr&#40;lpOS.dwMajorVersion&#41; + '.' + IntToStr&#40;lpOS.dwMinorVersion&#41; +<br />                build; //IntToStr&#40;lpOS.dwBuildNumber&#41; + ' &#40;' + lpOS.szCSDVersion + '&#41;'<br />   end;<br /> VER_PLATFORM_WIN32_WINDOWS&#58;<br /> begin<br />   if &#40;&#40;lpOS.dwMajorVersion &gt; 4&#41; or &#40;&#40;lpOS.dwMajorVersion = 4&#41; and &#40;lpOS.dwMinorVersion = 0&#41;&#41;&#41; then<br />      result &#58;= 'Windows 98 ' + IntToStr&#40;lpOS.dwMajorVersion&#41; + '.' + IntToStr&#40;lpOS.dwMinorVersion&#41; +<br />                build //IntToStr&#40;lpOS.dwBuildNumber&#41; + ' &#40;' + lpOS.szCSDVersion + '&#41;'<br />       else<br />    if &#40;&#40;lpOS.dwMajorVersion &gt; 4&#41; or &#40;&#40;lpOS.dwMajorVersion = 4&#41; and &#40;lpOS.dwMinorVersion = 90&#41;&#41;&#41; then<br />       result &#58;= 'Windows ME ' + IntToStr&#40;lpOS.dwMajorVersion&#41; + '.' + IntToStr&#40;lpOS.dwMinorVersion&#41; +<br />                build //IntToStr&#40;lpOS.dwBuildNumber&#41; + ' &#40;' + lpOS.szCSDVersion + '&#41;'<br />      else<br />     result &#58;= 'Windows 95 ' + IntToStr&#40;lpOS.dwMajorVersion&#41; + '.' + IntToStr&#40;lpOS.dwMinorVersion&#41; +<br />                build; //IntToStr&#40;lpOS.dwBuildNumber&#41; + ' &#40;' + lpOS.szCSDVersion + '&#41;';<br />    end<br />   else<br />  result &#58;= 'Win32s';<br /> end;<br />end;<br /></code></pre><br /><br />Now, for me at least, building a proc or function like the one above is a bit difficult. I guess you can't just simply &quot;add&quot; strings in MASM and I am told that I need to use lstrcat, but how do you do it like I do in the code above? Yes... still learning. Forgive me. :)<br /><br />Anyhow, thanks everyone. I appreciate your generous attempts at helping me with this.</div>
    <div class="meta">Posted on 2003-06-22 18:22:40 by The Beginner</div>
   </div>
   <div class="post" id="post-107929">
    <div class="subject"><a href="#post-107929">Well here you go.</a></div>
    <div class="body">I made this quickly so don't expect much from this.<br />It functions just like the code you posted. And I tried to make it<br />look comfortable to someone coming from a hll.<br />I know the standard boards rules are not to generate full code for someone.<br />When its not 'homework' related, I wouldn't want you to get frustrated and go back<br />to delphi :)<br /><br />Here is the code in masm32 format, SpAsm format on request :)<br /><br /><pre><code><br />; #################################################<br />    ; Using hll macros and apis for formatting.<br />    ; Also there are too many wsprintfs, this should<br />    ; called at the end. It took me 15 minutes and<br />    ; It could be made more efficent. Like -not- using<br />    ; wsprintf &#58;&#41; Purists beware.<br />    ; I guess it makes it more understandable since<br />    ; the original delphi post looks close to this.<br />    ; This looks god-awfully close to C doesn't it.<br />    <br />    ; So 'The Beginner' wsprintf is handy. Everyone<br />    ; on this board seems to like it. However ASM<br />    ; is powerful in string manipulations. Don't<br />    ; always lean toward an api. You will remove<br />    ; the power that asm gives you if you do so.<br />    ; But its close to your previous ways of parsing,<br />    ; it will help in learning and minimize any hair<br />    ; pulling.<br />    .486<br />    .model flat, stdcall<br />    option casemap &#58;none   ; case sensitive<br />; #################################################<br /><br />    include \masm32\include\windows.inc<br />    include \masm32\include\user32.inc<br />    include \masm32\include\kernel32.inc<br />    include \masm32\include\gdi32.inc<br />    	<br />    includelib \masm32\lib\user32.lib<br />    includelib \masm32\lib\kernel32.lib<br />    includelib \masm32\lib\gdi32.lib<br />    <br />    main PROTO<br />; #################################################<br />	.data?<br />	osver OSVERSIONINFO &lt;&gt;<br />	; Blindly make large buffers, not a good idea<br />	; I am in a hurry however &#58;0<br />	OutPutBuffer 	db 50 dup&#40;?&#41;<br />	ServPack 		db 25 dup&#40;?&#41;	<br />; #################################################<br />	.data<br />	AppTitle      db &quot;GetVersionEx Example&quot;,0<br />	NoServicePack db &quot;No Service Pack Installed&quot;,0<br />	WinNT	      db &quot;Windows NT %i.%i build %i &#40;%s&#41;&quot;,0<br />	Win98         db &quot;Windows 98 %i.%i build %i &#40;%s&#41;&quot;,0<br />	Win95         db &quot;Windows 95 %i.%i build %i &#40;%s&#41;&quot;,0<br />	Win2000       db &quot;Windows 2000 %i.%i build %i &#40;%s&#41;&quot;,0<br />	WinXP         db &quot;Windows XP %i.%i build %i &#40;%s&#41;&quot;,0<br />	WinME         db &quot;Windows ME %i.%i build %i &#40;%s&#41;&quot;,0<br />; #################################################<br />    .code<br />start&#58;<br />    call main<br />    invoke ExitProcess,0<br />; #################################################<br /><br />main proc<br />	; Must fill this dword with the OSVERSIONINFO struct size<br />	mov DWORD PTR &#91;osver.dwOSVersionInfoSize&#93;, 148<br />	invoke GetVersionEx,OFFSET osver<br />	<br />	.IF osver.dwPlatformId == VER_PLATFORM_WIN32_NT<br />		.IF osver.szCSDVersion == NULL<br />			invoke lstrcat,OFFSET ServPack,OFFSET NoServicePack<br />		.ELSE<br />			invoke lstrcat,OFFSET ServPack,OFFSET osver.szCSDVersion<br />		.ENDIF<br />		<br />			<br />		.IF osver.dwMajorVersion &lt;= 4<br />			invoke wsprintf,OFFSET OutPutBuffer,OFFSET WinNT,osver.dwMajorVersion, \<br />				            osver.dwMinorVersion,osver.dwBuildNumber,OFFSET ServPack<br />			<br />		.ELSEIF osver.dwMajorVersion == 5 &amp;&amp; osver.dwMinorVersion == 0<br />			invoke wsprintf,OFFSET OutPutBuffer,OFFSET Win2000,osver.dwMajorVersion, \<br />				            osver.dwMinorVersion,osver.dwBuildNumber,OFFSET ServPack<br />				            <br />		.ELSEIF osver.dwMajorVersion == 5 &amp;&amp; osver.dwMinorVersion == 1<br />			invoke wsprintf,OFFSET OutPutBuffer,OFFSET WinXP,osver.dwMajorVersion, \<br />				            osver.dwMinorVersion,osver.dwBuildNumber,OFFSET ServPack<br />		.ENDIF<br />		<br />	.ELSEIF osver.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS<br />	<br />		.IF osver.dwMajorVersion &gt; 4  || osver.dwMajorVersion == 4 &amp;&amp; osver.dwMinorVersion == 0<br />			invoke wsprintf,OFFSET OutPutBuffer,OFFSET Win98,osver.dwMajorVersion, \<br />				            osver.dwMinorVersion,osver.dwBuildNumber,OFFSET ServPack<br />				            				            <br />		.ELSEIF osver.dwMajorVersion &gt;= 4 &amp;&amp; osver.dwMinorVersion == 90<br />			invoke wsprintf,OFFSET OutPutBuffer,OFFSET WinME,osver.dwMajorVersion, \<br />				            osver.dwMinorVersion,osver.dwBuildNumber,OFFSET ServPack					            	<br />		.ELSE<br />			invoke wsprintf,OFFSET OutPutBuffer,OFFSET Win95,osver.dwMajorVersion, \<br />				            osver.dwMinorVersion,osver.dwBuildNumber,OFFSET ServPack		<br />		.ENDIF<br />			<br />	.ENDIF<br />	; And Display Our Result..Woohoo<br />	invoke MessageBox,0,OFFSET OutPutBuffer,OFFSET AppTitle,MB_OK<br />    ret  <br /><br />main endp<br />; #################################################<br />end start<br /></code></pre><br /><br />The boards software may wrap some of these lines, it should be obvious where it happens.<br /><br />It works on my machine, granted it means only one test works for sure :)<br />it display for me Windows XP 5.1 build 2600 Service Pack 1<br /><br />Good Luck,<br />RobotBob</div>
    <div class="meta">Posted on 2003-06-22 21:46:49 by RobotBob</div>
   </div>
   <div class="post" id="post-107930">
    <div class="subject"><a href="#post-107930">Question...</a></div>
    <div class="body">Nice job RobotBob,<br /><br />I'm not averse to wsprintf myself so do you mind if I steal your code for a sniplet (duly creditted ofcourse) ?</div>
    <div class="meta">Posted on 2003-06-22 21:56:14 by donkey</div>
   </div>
   <div class="post" id="post-107932">
    <div class="subject"><a href="#post-107932">Sure, of course</a></div>
    <div class="body">Credit me if you like or not , although credit warms my ego :grin: <br />It most likely has bug, and the guessed buffers sizes are a bad idea.<br /><br />Hopefully it displays right on everyones platform, I dont expect it not to..who knows.<br /><br />BTW I started using RADAsm. Mainly to play with GoAsm and those times I <br />must use the evil empires assembler. :)<br /><br />EDIT: oh and feel free to edit or remove the whining comment at the top :)<br /><br />RobotBob</div>
    <div class="meta">Posted on 2003-06-22 22:05:49 by RobotBob</div>
   </div>
   <div class="post" id="post-108014">
    <div class="subject"><a href="#post-108014">Had a improvement thought</a></div>
    <div class="body">This works and minimizes the number of wsprintfs in the exe.<br />Without using a subroutine or proc (overhead of jmp-stack-ret).<br /><br />There still is the buffer thing, but maybe later:)<br />oh and error checking...<br /><br /><pre><code><br />; Add this to your .data? section<br />; call it whatever you like.<br />.data?<br />OsStringPtr     dd ?<br /><br />;Ok a cleaner main proc<br />main proc<br />	; Must fill this dword with the OSVERSIONINFO struct size<br />	mov DWORD PTR &#91;osver.dwOSVersionInfoSize&#93;, 148<br />	invoke GetVersionEx,OFFSET osver<br />	<br />	.IF osver.dwPlatformId == VER_PLATFORM_WIN32_NT<br />		.IF osver.szCSDVersion == NULL<br />			invoke lstrcat,OFFSET ServPack,OFFSET NoServicePack<br />		.ELSE<br />			invoke lstrcat,OFFSET ServPack,OFFSET osver.szCSDVersion<br />		.ENDIF<br />					<br />		.IF osver.dwMajorVersion &lt;= 4<br />			mov eax, OFFSET WinNT<br />			mov OsStringPtr, eax<br />			<br />		.ELSEIF osver.dwMajorVersion == 5 &amp;&amp; osver.dwMinorVersion == 0<br />			mov eax, OFFSET Win2000<br />			mov OsStringPtr, eax<br />							            <br />		.ELSEIF osver.dwMajorVersion == 5 &amp;&amp; osver.dwMinorVersion == 1<br />		 	mov eax, OFFSET WinXP<br />			mov OsStringPtr, eax<br />			<br />		.ENDIF<br />		<br />	.ELSEIF osver.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS<br />	<br />		.IF osver.dwMajorVersion &gt; 4  || osver.dwMajorVersion == 4 &amp;&amp; osver.dwMinorVersion == 0<br />			mov eax, OFFSET Win98<br />			mov OsStringPtr, eax<br />			<br />		.ELSEIF osver.dwMajorVersion &gt;= 4 &amp;&amp; osver.dwMinorVersion == 90<br />			mov eax, OFFSET WinME<br />			mov OsStringPtr, eax<br />			<br />		.ELSE<br />			mov eax, OFFSET Win95<br />			mov OsStringPtr, eax<br />				<br />		.ENDIF			<br />	.ENDIF<br />	<br />	; Format And Display Our Result..Woohoo<br />	invoke wsprintf,OFFSET OutPutBuffer,OsStringPtr,osver.dwMajorVersion, \<br />			osver.dwMinorVersion,osver.dwBuildNumber,OFFSET ServPack<br />	invoke MessageBox,0,OFFSET OutPutBuffer,OFFSET AppTitle,MB_OK<br />    ret  <br /><br />main endp<br /></code></pre><br /><br />I hope this works well, it seems to.<br />And its smaller.<br /><br />You could do a push push pop pop to exhange.<br />But it becomes less understandable.<br /><br />RobotBob</div>
    <div class="meta">Posted on 2003-06-23 13:30:13 by RobotBob</div>
   </div>
   <div class="post" id="post-108127">
    <div class="subject"><a href="#post-108127">Question...</a></div>
    <div class="body">Wow!<br /><br />I only wanted hints, but you did something you didn't have to by going the extra mile and showing me some nice code! Thank you very much, RobotBob! This is very much appreciated!<br /><br />I am going to kick this around now and see how it works out. I will let ya know what I do to it. :)<br /><br />Thanks again everyone!</div>
    <div class="meta">Posted on 2003-06-24 12:29:10 by The Beginner</div>
   </div>
   <div class="post" id="post-108140">
    <div class="subject"><a href="#post-108140">I found  a bug.</a></div>
    <div class="body">Nothing major, I just need to look att he msdn site to compare os version numbers.<br />Its reporting win98 first edition as win95. Its because win95 is determined by an else clause. <br /><br />I am glad its helpful. I know not being able to just &quot;Connect&quot; + &quot;String&quot; + &quot; Literals&quot; can be quite a change.<br /><br />EDIT: If you want to fix it, then go ahead, I did jump past hints straight into app :) I was afraid you would consider this to be difficult compared to delphi. Not so.<br /><br />Edit2:<a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/sysinfo/base/getting_the_system_version.asp">here is the msdn link</a> fixing the bug is easy ,just look at the versions.<br />RobotBob</div>
    <div class="meta">Posted on 2003-06-24 13:59:36 by RobotBob</div>
   </div>
   <div class="post" id="post-108509">
    <div class="subject"><a href="#post-108509">I hade a bored moment again :)</a></div>
    <div class="body">I had some time to kill so here is a fixed version:<br />-full source-<br /><br /><pre><code><br />; #################################################<br />    ; Using hll macros and apis for formatting.<br />    ; I guess it makes it more understandable since<br />    ; the original delphi post looks close to this.<br />    ; This looks god-awfully close to C doesn't it.<br />    <br />    .486<br />    .model flat, stdcall<br />    option casemap &#58;none   ; case sensitive<br />; #################################################<br /><br />    include \masm32\include\windows.inc<br />    include \masm32\include\user32.inc<br />    include \masm32\include\kernel32.inc<br />    include \masm32\include\gdi32.inc<br /><br />    includelib \masm32\lib\user32.lib<br />    includelib \masm32\lib\kernel32.lib<br />    includelib \masm32\lib\gdi32.lib<br />    <br />    main PROTO<br />; #################################################<br />	.data?<br />	osver OSVERSIONINFO &lt;&gt;<br />	; Blindly make large buffers, not a good idea<br />	; I am in a hurry however &#58;0<br />	OutPutBuffer 	db 50 dup&#40;?&#41;<br />	ServPack 		db 128 dup&#40;?&#41;<br />	OsStringPtr     dd ?<br />; #################################################<br />	.data<br />	AppTitle      db &quot;GetVersionEx Example&quot;,0<br />	NoServicePack db &quot;No Service Pack Installed&quot;,0<br />	WinNT	      db &quot;Windows NT %i.%i build %i &#40;%s&#41;&quot;,0<br />	Win98         db &quot;Windows 98 %i.%i build %i &#40;%s&#41;&quot;,0<br />	Win95         db &quot;Windows 95 %i.%i build %i &#40;%s&#41;&quot;,0<br />	Win2000       db &quot;Windows 2000 %i.%i build %i &#40;%s&#41;&quot;,0<br />	WinXP          db &quot;Windows XP %i.%i build %i &#40;%s&#41;&quot;,0<br />	WinME         db &quot;Windows ME %i.%i build %i &#40;%s&#41;&quot;,0<br />	SE	   db &quot;Second Edition&quot;,0<br />; #################################################<br />    .code<br />start&#58;<br />    call main<br />    invoke ExitProcess,0<br />; #################################################<br /><br />main proc<br />	; Must fill this dword with the OSVERSIONINFO struct size<br />	mov DWORD PTR &#91;osver.dwOSVersionInfoSize&#93;, 148<br />	invoke GetVersionEx,OFFSET osver<br />	<br />	.IF osver.dwPlatformId == VER_PLATFORM_WIN32_NT<br />		.IF osver.szCSDVersion == NULL <br />			invoke lstrcat,OFFSET ServPack,OFFSET NoServicePack<br />		.ELSE<br />			invoke lstrcat,OFFSET ServPack,OFFSET osver.szCSDVersion<br />		.ENDIF<br />					<br />		.IF osver.dwMajorVersion &lt;= 4<br />			mov eax, OFFSET WinNT<br />			mov OsStringPtr, eax<br />			<br />		.ELSEIF osver.dwMajorVersion == 5 &amp;&amp; osver.dwMinorVersion == 0<br />			mov eax, OFFSET Win2000<br />			mov OsStringPtr, eax<br />							            <br />		.ELSEIF osver.dwMajorVersion == 5 &amp;&amp; osver.dwMinorVersion == 1<br />		 	mov eax, OFFSET WinXP<br />			mov OsStringPtr, eax			<br />		.ENDIF<br />		<br />	.ELSEIF osver.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS<br />	<br />		.IF osver.dwMajorVersion &gt; 4  || osver.dwMajorVersion == 4 &amp;&amp; osver.dwMinorVersion == 0<br />			mov eax, OFFSET Win95<br />			mov OsStringPtr, eax<br />			<br />		.ELSEIF osver.dwMajorVersion &gt;= 4 &amp;&amp; osver.dwMinorVersion == 90<br />			mov eax, OFFSET WinME<br />			mov OsStringPtr, eax<br />			<br />		.ELSEIF osver.dwMajorVersion &gt;= 4 &amp;&amp; osver.dwMinorVersion == 10<br />			.IF osver.szCSDVersion == 'A'<br />				; Don't worry about clearing ServPack, in this case it only contained <br />				; one byte anyway.<br />				invoke lstrcat,OFFSET ServPack,OFFSET SE<br />			.ENDIF<br />			mov eax, OFFSET Win98<br />			mov OsStringPtr, eax				<br />		.ENDIF<br />					<br />	.ENDIF<br />	<br />	; Format And Display Our Result..Woohoo<br />	invoke wsprintf,OFFSET OutPutBuffer,OsStringPtr,osver.dwMajorVersion, \<br />				            osver.dwMinorVersion,osver.dwBuildNumber,OFFSET ServPack<br />	invoke MessageBox,0,OFFSET OutPutBuffer,OFFSET AppTitle,MB_OK<br />    ret  <br /><br />main endp<br />; #################################################<br />end start<br /></code></pre><br /><br />Beware of the wrapping,<br /><br />RobotBob</div>
    <div class="meta">Posted on 2003-06-28 02:12:42 by RobotBob</div>
   </div>
  </div>
 </body>
</html>