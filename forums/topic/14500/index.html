<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Working with sound - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14500" />
    <link rel="next" href="../?id=14500&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=14500">Working with sound</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=14500&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=14500&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="14500" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=14500&amp;page=2">&gt;</a><a href="../?id=14500&amp;page=2">&raquo;</a></form>   <div class="post" id="post-112158">
    <div class="subject"><a href="#post-112158">Working with sound</a></div>
    <div class="body">hi<br />Did anybody try to transfer voice over the internet? If somebody have some good source code of working with sound, could you please share?<br />Thanx.</div>
    <div class="meta">Posted on 2003-07-28 08:37:31 by masnick[CCCP]</div>
   </div>
   <div class="post" id="post-112161">
    <div class="subject"><a href="#post-112161">Working with sound</a></div>
    <div class="body">If you are fine with using a library use Speex :)<br /><br /><a target="_blank" href="http://www.speex.org/">http://www.speex.org/</a><br /><a target="_blank" href="http://www.speex.org/projects.html">http://www.speex.org/projects.html</a></div>
    <div class="meta">Posted on 2003-07-28 08:44:21 by bazik</div>
   </div>
   <div class="post" id="post-112174">
    <div class="subject"><a href="#post-112174">Working with sound</a></div>
    <div class="body">Thanx, i'll look at that.</div>
    <div class="meta">Posted on 2003-07-28 10:42:54 by masnick[CCCP]</div>
   </div>
   <div class="post" id="post-112181">
    <div class="subject"><a href="#post-112181">Working with sound</a></div>
    <div class="body">Does anybody know what is the best solution of transfering sound over internet? For example the one they use in NetMeeting, Yahoo Messenger. Do they just send chunks of sound or they send stream. And how do they do it?</div>
    <div class="meta">Posted on 2003-07-28 11:08:08 by masnick[CCCP]</div>
   </div>
   <div class="post" id="post-112248">
    <div class="subject"><a href="#post-112248">Working with sound</a></div>
    <div class="body">I solved this problem.<br />Just get chunks of sound using Wave APIs then use ACM APIs (Microsoft Audio Compression Manager) to compress those chunks, and just use simple winsock connection to transfer it to another end over internet, where it gets uncompressed and sended to sound card.<br />One of the best compressors to use is GSM or TrueSpeech.</div>
    <div class="meta">Posted on 2003-07-28 18:46:20 by masnick[CCCP]</div>
   </div>
   <div class="post" id="post-112273">
    <div class="subject"><a href="#post-112273">Working with sound</a></div>
    <div class="body">Im interested in your project.  Sounds fun.  Keep us (or me) informed if you dont mind :alright:<br /><br />:NaN:</div>
    <div class="meta">Posted on 2003-07-28 23:40:20 by NaN</div>
   </div>
   <div class="post" id="post-112323">
    <div class="subject"><a href="#post-112323">Working with sound</a></div>
    <div class="body">If somebody worked with ACM, i need some help, since there are some problems with buffer when you decompress. And thanx again to Bazik for that link. I think that's the compression i'm going to use, since it has all needed features: compression and decompression samples, VAD (Voice Activity Detection to save bandwidth). I hope it will work perfectly.</div>
    <div class="meta">Posted on 2003-07-29 08:17:05 by masnick[CCCP]</div>
   </div>
   <div class="post" id="post-112324">
    <div class="subject"><a href="#post-112324">Working with sound</a></div>
    <div class="body"><div class="quote">&quot;]<br />If somebody worked with ACM, i need some help, since there are some problems with buffer when you decompress. </div><br /><br />I think miracle and/or Maverick did some work with that.<br /><br /><div class="quote">&quot;]<br />And thanx again to Bazik for that link. </div><br /><br />No problem :) Speex is also the best codec available for that purpose right now (as you see on the comparsion). And its free :)</div>
    <div class="meta">Posted on 2003-07-29 08:26:47 by bazik</div>
   </div>
   <div class="post" id="post-112325">
    <div class="subject"><a href="#post-112325">Working with sound</a></div>
    <div class="body">Bazik, does speex have .dll some where?</div>
    <div class="meta">Posted on 2003-07-29 08:54:32 by masnick[CCCP]</div>
   </div>
   <div class="post" id="post-112328">
    <div class="subject"><a href="#post-112328">Working with sound</a></div>
    <div class="body">Can anybody share .dll of speex?</div>
    <div class="meta">Posted on 2003-07-29 09:01:55 by masnick[CCCP]</div>
   </div>
   <div class="post" id="post-112329">
    <div class="subject"><a href="#post-112329">Working with sound</a></div>
    <div class="body"><div class="quote">&quot;]<br />Bazik, does speex have .dll some where? </div><br /><br />Either you have to build it from the source code or ask on the mailing list for a dll version. <img src="http://0x1337.net/pub/hm.gif" /></div>
    <div class="meta">Posted on 2003-07-29 09:02:36 by bazik</div>
   </div>
   <div class="post" id="post-112331">
    <div class="subject"><a href="#post-112331">Working with sound</a></div>
    <div class="body">I did! But need urgently! Boss is waiting!</div>
    <div class="meta">Posted on 2003-07-29 09:10:09 by comrade</div>
   </div>
   <div class="post" id="post-112332">
    <div class="subject"><a href="#post-112332">Working with sound</a></div>
    <div class="body"><div class="quote"><br />Im interested in your project.  Sounds fun.  Keep us (or me) informed if you dont mind :alright:<br /><br />:NaN: </div><br /><br />Here is I think our working build. :)<br />It is in Visual Basic. Started in FASM, but no include files for mmsystem, so moved to VB. :)<br />Our whole project for remote store control is in Visual Basic. So far we have live stream using WMP control from WM encoder on server. But its 10-second delay. So we need realtime audio (two-way) and real-time video (probably will be pushed JPEGs from server, thanks Scronty).</div>
    <div class="meta">Posted on 2003-07-29 09:12:27 by comrade</div>
   </div>
   <div class="post" id="post-112335">
    <div class="subject"><a href="#post-112335">Working with sound</a></div>
    <div class="body">Here is also some other test we did. Its in C, records from microphone, encodes to MP3 and plays back. Aborted since haven't found practical way to programmatically decode separate MP3 chunks. :(</div>
    <div class="meta">Posted on 2003-07-29 09:17:05 by comrade</div>
   </div>
   <div class="post" id="post-112337">
    <div class="subject"><a href="#post-112337">Working with sound</a></div>
    <div class="body">Also, we have problem with sound skipping. When transferring sound over LAN with 4096 chunks, we get skips but are not as very serious (not as noticeable). But when actually going through Internet it skips a lot. In inner loop of playing (while waiting for chunk to play), it check for new data that arrived, and queues it up with recursive call. But that still does not eliminate skipping. I think now problem is with sender (recorder), it encodes in a single-loop and sends out once buffer is full. But how to make it send while recording? Tricky to do multi-threading in Visual Basic... and waveInStart() seems to be a blocking, synchronous call.</div>
    <div class="meta">Posted on 2003-07-29 09:22:33 by comrade</div>
   </div>
   <div class="post" id="post-112350">
    <div class="subject"><a href="#post-112350">Working with sound</a></div>
    <div class="body">Here is a new version of our proggy. I added ther ACM compression. Took me a while, since I had some problem with buffer. Some guy had similar to this and wanted hundreds dollars for source code, bastard Texas capitalist wouldn't give for free. Here is our, very similar in functionality. DSP gives 1:16 compression, but sound still skips though. I think sender problem.</div>
    <div class="meta">Posted on 2003-07-29 11:40:37 by masnick[CCCP]</div>
   </div>
   <div class="post" id="post-112445">
    <div class="subject"><a href="#post-112445">Working with sound</a></div>
    <div class="body"><div class="quote">&quot;]<br />Here is a new version of our proggy. I added ther ACM compression. Took me a while, since I had some problem with buffer. Some guy had similar to this and wanted hundreds dollars for source code, bastard Texas capitalist wouldn't give for free. Here is our, very similar in functionality. DSP gives 1:16 compression, but sound still skips though. I think sender problem. </div><br /><br />Actually, one method to get rid of the sound skips is to lower your chunk sizes.  One method is to have a cyclic fifo buffer for the data, where your input stream is being compressed and packed for output, while in the background all &quot;ready&quot; packets go out and any incoming come in.  Not sure how you actually did do the transfer work, but if you're using VB, cheat a little, toss the internet transfers on a timer.  (It's naughty, but it's &quot;get by-able&quot;.  A cheap way of multi-threading with severe limitations.)<br /><br />The main reason your sound skips is your large buffer size, perhaps monitor buffer transmission times and auto-adjust out packet sizes accordingly.<br /><br /><br /><br />You're bottlenecks for the program are as follows:<br /><br /> :eek: Single buffers for fifo, if your transmission is stalled for any reason, you'll get a blank spot, reasons for these follow.<br /> :eek: Use of ReDim, avoid at all costs.  This is the worst idea when dealing with buffers, typically build a buffer in memory and chunk off of it, the ws.SendData is the wrong method here, you can't specify your total data count with it.<br /> :eek: No static buffers means memory chopping at an alarming rate, which will put an overhead strain on overall system performance.<br /><br />:alright: Recommendations, don't use the ws.GetData or ws.SendData, instead use the API calls to the Wsock32.dll directly:<br /><br />Declare Function Send Lib &quot;wsock32.dll&quot; Alias &quot;send&quot; (ByVal s As Long, buf As Any, ByVal buflen As Long, ByVal flags As Long) As Long<br />Declare Function recv Lib &quot;wsock32.dll&quot; (ByVal s As Long, buf As Any, ByVal buflen As Long, ByVal flags As Long) As Long<br /><br />Those will let you actually specify how much data is going either way to your buffers (letting you make static buffer space, even chop it up into segments for a cyclic fifo method to cut down on process interferences).  You could allocate 64k of ram, break it into 4 in and 4 out buffers, and 32k of it for the audio compress/decompress areas, 16k for each should be fine, doubt your smaller packet sizes will generate data that large, but if they do, go larger.  When your program is done, you're merely getting rid of 1 larger memory chunk, no ReDims that cause a memory flush and allocate each time you do it.  It'll make the program faster, smoother and won't chunk memory up.</div>
    <div class="meta">Posted on 2003-07-30 13:08:03 by FunkyMeister</div>
   </div>
   <div class="post" id="post-112457">
    <div class="subject"><a href="#post-112457">Working with sound</a></div>
    <div class="body">Thanks very much.</div>
    <div class="meta">Posted on 2003-07-30 14:43:29 by comrade</div>
   </div>
   <div class="post" id="post-112549">
    <div class="subject"><a href="#post-112549">Working with sound</a></div>
    <div class="body">FunkyMeister, do you think it's possible to make similar program for video? Cause we tried to research but didn't find a lod.</div>
    <div class="meta">Posted on 2003-07-31 09:53:23 by masnick[CCCP]</div>
   </div>
   <div class="post" id="post-112560">
    <div class="subject"><a href="#post-112560">Working with sound</a></div>
    <div class="body"><div class="quote">&quot;]<br />FunkyMeister, do you think it's possible to make similar program for video? Cause we tried to research but didn't find a lod. </div><br /><br />Look around for resources on &quot;VFW&quot; (Video For Windows), there should be examples for reading a &quot;camera device&quot; and using it to also display.  Probably resources for that.<br /><br />You'll really need to do cyclic buffering a lot for those, as you'll cause massive studdering if you have your transmission and reception of audio and video buried in your normal routines (they need to be off on another thread).<br /><br />With respect to your WINSOCK issues, go to <a target="_blank" href="www.allapi.net">www.allapi.net</a> and download their last offering of it if it's still there, has all of the Winsock API there AND examples.  This is a VB aimed site.</div>
    <div class="meta">Posted on 2003-07-31 10:35:16 by FunkyMeister</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=14500&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=14500&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="14500" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=14500&amp;page=2">&gt;</a><a href="../?id=14500&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>