<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Is HeapSize() trustworthy? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25402" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25402">Is HeapSize() trustworthy?</a></p>
   <div class="post" id="post-185730">
    <div class="subject"><a href="#post-185730">Is HeapSize() trustworthy?</a></div>
    <div class="body">Does on all modern Win32 OS, HeapSize() return exactly the number of bytes requested during HeapAlloc() ? <br /><pre><code><br />invoke HeapAlloc,pHeap1,0,107 ; request 107 bytes<br />invoke HeapSize,pHeap1,0,eax<br /> ; is EAX==107 ??<br /></code></pre><br /><br />I&#39;m thinking of relying on this API function for some code of mine. </div>
    <div class="meta">Posted on 2006-10-04 15:21:25 by Ultrano</div>
   </div>
   <div class="post" id="post-185734">
    <div class="subject"><a href="#post-185734">Re: Is HeapSize() trustworthy?</a></div>
    <div class="body">Good question, PlatformSDK doesn&#39;t say anything 100% specific... It wouldn&#39;t surprise me if, at least on some windows versions, it could return a rounded number.<br /></div>
    <div class="meta">Posted on 2006-10-04 17:11:14 by f0dder</div>
   </div>
   <div class="post" id="post-185737">
    <div class="subject"><a href="#post-185737">Re: Is HeapSize() trustworthy?</a></div>
    <div class="body">MSDN is fairly clear on this, HeapAlloc is the problem, it will not always allocate exactly the numbe rof bytes requested but will allocate &quot;at least&quot; the number requested. Heap size will always return the exact number of bytes allocated which may or may not match the number requested.<br /><br /><div class="quote">If HeapAlloc succeeds, it allocates at least the amount of memory requested. If the actual amount allocated is greater than the amount requested, the process can use the entire amount. To determine the actual size of the allocated block, use the HeapSize function.</div></div>
    <div class="meta">Posted on 2006-10-04 19:29:31 by donkey</div>
   </div>
   <div class="post" id="post-185739">
    <div class="subject"><a href="#post-185739">Re: Is HeapSize() trustworthy?</a></div>
    <div class="body">Thanks, <br />shame on me for not noticing&nbsp; :oops:<br /></div>
    <div class="meta">Posted on 2006-10-04 19:59:58 by Ultrano</div>
   </div>
  </div>
 </body>
</html>