<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>flat assembler 1.42 - better optimization - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=9351" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=9351">flat assembler 1.42 - better optimization</a></p>
   <div class="post" id="post-69038">
    <div class="subject"><a href="#post-69038">flat assembler 1.42 - better optimization</a></div>
    <div class="body">Version 1.42 is ready. This update was unexpected even for me, because the idea of improvement came today (I'm not sure from where, maybe I was inspired by something like green ray from space, I don't remember exactly ;)) I'm attaching two sources, which show why previous algorithm wasn't perfect. First case is not properly optimized by 1.41 (compare output with this generated by 1.42), second causes 1.41 to run out of memory, altough there are no good reasons for that.</div>
    <div class="meta">Posted on 2002-12-04 09:50:57 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-69058">
    <div class="subject"><a href="#post-69058">flat assembler 1.42 - better optimization</a></div>
    <div class="body">An uppdate, you said you fixed a  &quot;run out of memory&quot;-error. I've experenced a few such when using fasmw (v1.41) (after lot's of compiling, running and coding for some hour), if the error still exist I'll make a bug-report. :)<br />I made a quick test and it works flawless. :)<br /><br /><div class="quote">green ray from space</div> <br />Stryker, was it you? :eek:</div>
    <div class="meta">Posted on 2002-12-04 11:01:15 by scientica</div>
   </div>
   <div class="post" id="post-69068">
    <div class="subject"><a href="#post-69068">flat assembler 1.42 - better optimization</a></div>
    <div class="body">When you are working with large projects in fasmw, make sure you have enough setting of memory in compiler options, the default is 4 MB and might be not enough for big programs.</div>
    <div class="meta">Posted on 2002-12-04 11:44:45 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-69070">
    <div class="subject"><a href="#post-69070">Good work!</a></div>
    <div class="body">Once again Privalov: Excellent work! ;)</div>
    <div class="meta">Posted on 2002-12-04 12:14:38 by POW</div>
   </div>
   <div class="post" id="post-69081">
    <div class="subject"><a href="#post-69081">flat assembler 1.42 - better optimization</a></div>
    <div class="body">I've set it to 32 Mb (increased it from 16 megs, after I got the first out of memory).<br /><br />A little question, how big is big? I'm not kidding, is big a 10 kb or 100kb .asm-file? The sorce file is (at the moment) 10,7 kb, and requires 3 passes.<br /><br />POW, I agree with you. :alright:</div>
    <div class="meta">Posted on 2002-12-04 13:07:53 by scientica</div>
   </div>
   <div class="post" id="post-69099">
    <div class="subject"><a href="#post-69099">flat assembler 1.42 - better optimization</a></div>
    <div class="body">You can have very little source needing much memory if you use large allocations using &quot;rb&quot; directive (because every space that is declared as reserved is allocated and zeroed at compile time, it is then cut (if possible) at the formatting stage.</div>
    <div class="meta">Posted on 2002-12-04 14:06:33 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-69107">
    <div class="subject"><a href="#post-69107">flat assembler 1.42 - better optimization</a></div>
    <div class="body">I have shocked myself. Look at this!</div>
    <div class="meta">Posted on 2002-12-04 14:40:17 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-69109">
    <div class="subject"><a href="#post-69109">flat assembler 1.42 - better optimization</a></div>
    <div class="body">Nice optimizations... Here is the result :<br /><br />C:\Programmation\PureBasic\Compilers&gt;fasm PureBasicTest.asm test.exe<br />flat assembler  version 1.41.2<br />36 passes, 0.8 seconds, 134905 bytes.<br /><br />C:\Programmation\PureBasic\Compilers&gt;fasm PureBasicTest.asm test.exe<br />flat assembler  version 1.42<br />31 passes, 0.5 seconds, 134893 bytes.<br /><br />  Bye,<br />  <br />    Fred - AlphaSND</div>
    <div class="meta">Posted on 2002-12-04 14:58:21 by AlphaSND</div>
   </div>
   <div class="post" id="post-69119">
    <div class="subject"><a href="#post-69119">flat assembler 1.42 - better optimization</a></div>
    <div class="body">Amazing! Otlichnaya rabota!</div>
    <div class="meta">Posted on 2002-12-04 16:58:53 by comrade</div>
   </div>
   <div class="post" id="post-69124">
    <div class="subject"><a href="#post-69124">[Off Topic]</a></div>
    <div class="body">Privet comrade.. did you read my PM?</div>
    <div class="meta">Posted on 2002-12-04 17:50:15 by Maverick</div>
   </div>
   <div class="post" id="post-69187">
    <div class="subject"><a href="#post-69187">flat assembler 1.42 - better optimization</a></div>
    <div class="body">little fun Privalov:<br /><br />plz enter this series segregs.<br /><br />cs ds es ss fs gs<br /><br />Hey!, it allowed me to assemble :grin:</div>
    <div class="meta">Posted on 2002-12-05 03:34:14 by Bi_Dark</div>
   </div>
   <div class="post" id="post-69189">
    <div class="subject"><a href="#post-69189">flat assembler 1.42 - better optimization</a></div>
    <div class="body">I keep reading about &quot;passes&quot; all the time. What is it?</div>
    <div class="meta">Posted on 2002-12-05 03:39:08 by Delight</div>
   </div>
   <div class="post" id="post-69192">
    <div class="subject"><a href="#post-69192">flat assembler 1.42 - better optimization</a></div>
    <div class="body">In each pass assembler converts the source into machine code, instruction after instruction. The single pass is not enough if you do any of so called &quot;forward references&quot;, that is when you use some label that is not yet defined, for example:<br /><pre><code><br />        jmp     finish<br />        ; some other code<br />finish&#58;<br /></code></pre><br />When assembler encounters &quot;jmp finish&quot; instruction in the first pass, the address of &quot;finish&quot; is not yet known, therefore instruction cannot be correctly generated. So it's assembled with some temporarily assumed value for that address, and the second pass is needed. In the second pass assembler already knows all the addresses and this time code is filled with correct values. At this stage assembly process ends in the two-pass assemblers, that don't have size optimization features (NASM, for example). But FASM always tries to generate as small instructions as possible, and the size of instruction mainly depends on the immediate values (like &quot;finish&quot; address in the above example). If &quot;finish&quot; label is not too far from the &quot;jmp finish&quot; instruction, the short (2 bytes) form of this instruction can be generated, otherwise some longer form has to be used. Because FASM tries to generate smallest possible code, in the first pass generates shortest form of instructions, but in the second pass it may realize that &quot;finish&quot; label is too far and the instruction has to be changed into longer form. But in this case also the address of &quot;finish&quot; label (and all other labels after that instruction) will change! So FASM does the third pass also, and even more if some addresses have changed once again.</div>
    <div class="meta">Posted on 2002-12-05 04:04:24 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-69194">
    <div class="subject"><a href="#post-69194">flat assembler 1.42 - better optimization</a></div>
    <div class="body">Thanks for your explanation Privalov, it's all clear to me now :alright:</div>
    <div class="meta">Posted on 2002-12-05 04:20:37 by Delight</div>
   </div>
  </div>
 </body>
</html>