<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Full Path Name - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14535" />
    <link rel="next" href="../?id=14535&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=14535">Full Path Name</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=14535&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=14535&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="14535" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=14535&amp;page=2">&gt;</a><a href="../?id=14535&amp;page=2">&raquo;</a></form>   <div class="post" id="post-112399">
    <div class="subject"><a href="#post-112399">Full Path Name</a></div>
    <div class="body">I can only get the Caption name of another app by using GetForegroundWindow and GetWindowTextA.  But how do you get the full path name if this is all you got to go on.  GetWindow don't work for me and i am trying not to use EnumWindow.  <br />If it is not possible the by a standard way do someone know of a link where i can see how it is done PE style that works for 9x and up. <br /><br />This is one of the many things i tried to do but nothing works.<br /><br /><br />invoke GetDesktopWindow ;;;GetForegroundWindow<br /><br />; ...............................       GetClassName<br />PUSH 128<br />PUSH offset Buffer<br />PUSH eax<br />PUSH GetClassNameA<br />; ...............................       FindClass  <br />PUSH 0<br />PUSH offset Buffer<br />CALL FindWindowA<br />   mov temp, eax<br />; ...............................       GetWindowText<br />PUSH 128<br />PUSH offset b_PATH<br />PUSH temp<br />CALL GetWindowTextA<br />; ...............................       GETTEXTLENGTH  tried also<br />;PUSH offset b_PATH<br />;PUSH WM_GETTEXTLENGTH <br />;PUSH WM_GETTEXT <br />;PUSH eax<br />;CALL SendMessageA<br /><br /><br /><strong>PS: </strong>  Do Process32Next   work for all 9x and up</div>
    <div class="meta">Posted on 2003-07-30 01:44:04 by cmax</div>
   </div>
   <div class="post" id="post-112402">
    <div class="subject"><a href="#post-112402">Full Path Name</a></div>
    <div class="body">Yes, Process32Next works with all 32 bit versions of Windows (Except NT4), it is part of the ToolHelp API.</div>
    <div class="meta">Posted on 2003-07-30 02:25:40 by donkey</div>
   </div>
   <div class="post" id="post-112409">
    <div class="subject"><a href="#post-112409">Full Path Name</a></div>
    <div class="body">OK,<br /><br />thanks a lot donkey</div>
    <div class="meta">Posted on 2003-07-30 03:53:14 by cmax</div>
   </div>
   <div class="post" id="post-112419">
    <div class="subject"><a href="#post-112419">Full Path Name</a></div>
    <div class="body">I already post this but under a different thread but when someone find this one it is where it shoud be.<br /><br /><br />I got the Process ID with this old code... seem simple but hard to find :)<br /><br />aProcess DWORD ?<br /><br />invoke GetForegroundWindow<br /><br />push offset aProcess<br />push eax<br />call GetWindowThreadProcessId<br /><br />It returns the scrible scrabble Thread ID for that window.<br /><br />Do anyone know where i go from here to get the full path name</div>
    <div class="meta">Posted on 2003-07-30 05:17:39 by cmax</div>
   </div>
   <div class="post" id="post-112434">
    <div class="subject"><a href="#post-112434">Full Path Name</a></div>
    <div class="body">How about <strong>GetModuleFileName</strong>?</div>
    <div class="meta">Posted on 2003-07-30 11:14:25 by QvasiModo</div>
   </div>
   <div class="post" id="post-112458">
    <div class="subject"><a href="#post-112458">Full Path Name</a></div>
    <div class="body">oh a I see, you want to get the full path.<br />I do that like this, just change the classname<br /><br /><pre><code><br />.386<br />.model flat, stdcall<br />option casemap&#58;none<br /><br />include WINDOWS.INC<br />include kernel32.inc<br />include user32.inc<br />include psapi.inc<br /><br />includelib kernel32.lib<br />includelib user32.lib<br />includelib psapi.lib<br /><br /><br />.data<br />	szMSNClass	db &quot;MSNMSBLClass&quot;, 0<br />	<br />.data?<br />	szBuffer	db 256 dup &#40;?&#41;<br />	ProcessId	dd ?<br />	hProcess	dd ?<br />	hModule		dd ?<br />	numModules	dd ?<br />	<br />.code<br />Start&#58;<br />	invoke	FindWindow, offset szMSNClass, 0<br />	invoke	GetWindowThreadProcessId, eax, offset ProcessId<br />	invoke	OpenProcess, PROCESS_QUERY_INFORMATION or PROCESS_VM_READ, 0, ProcessId<br />	   mov	hProcess, eax<br />	invoke	EnumProcessModules, hProcess, offset hModule, sizeof hModule, offset numModules<br />	.if eax != 0<br />		invoke	GetModuleFileNameEx, hProcess, hModule, offset szBuffer, sizeof szBuffer<br />		invoke	MessageBox, 0, offset szBuffer, offset szBuffer, 0<br />	.endif<br />	invoke	CloseHandle, hProcess<br />	invoke	ExitProcess, 0<br />end Start<br /></code></pre></div>
    <div class="meta">Posted on 2003-07-30 14:52:07 by Jnrz</div>
   </div>
   <div class="post" id="post-112464">
    <div class="subject"><a href="#post-112464">Full Path Name</a></div>
    <div class="body">The code at the beginning should work for SOMETHING.  Here is a example that is SUPPOSE to get Class Name.  Remember i don't know the class name of the top-level window.<br /><br />I thought the only way to get the handle of un-known window was to use GetForegroundWindow or GetDesktopWindow.  There must be something else or it don't work as stated in API help. <br /><br />Anyway as you see it returns nothing but the handle.<br /><br />I never get the chance to use FindWindow... <br /><br />If i did, with  your code above or maybe even some of my at the top IT would BE ALL OVER....Maybe my code is wrong but i douth it.<br /><br />int GetClassName(<br /><br />HWND  hWnd,	// handle of window<br />LPTSTR  lpClassName,	// address of buffer for class name<br />int  nMaxCount 	// size of buffer, in characters<br /><br /><br />;.......................................................... Stranges<br />;..........................................................<br />; IT RETURN A HANDLE...<br /><br />; BUT NOT CLASS NAME ...<br />;..........................................................<br /><br />.386<br />.MODEL FLAT,STDCALL<br />option casemap:none<br /><br />include \MASM32\INCLUDE\windows.inc<br />include \MASM32\INCLUDE\user32.inc<br />include \MASM32\INCLUDE\kernel32.inc<br /><br />includelib \MASM32\LIB\user32.lib<br />includelib \MASM32\LIB\kernel32.lib<br /><br /><br />.DATA<br /><br />;s_Where_CLASS                      db &quot;Don't know Class Name&quot;,0<br /><br />.data?<br /><br />aHandle       DWORD ?<br /><br />aClassName                  BYTE        128 dup(?)<br /><br />.CODE<br />start:<br /><br />invoke GetForegroundWindow ; or GetDesktopWindow <br />mov aHandle, eax<br /><br />PUSH 128<br />PUSH offset aClassName<br />PUSH aHandle<br />PUSH GetClassNameA<br /><br /><br />invoke    MessageBoxA, 0, offset aHandle, 0, 0<br /><br />invoke    MessageBoxA, 0, offset aClassName, 0, 0<br /><br /><br />    invoke ExitProcess, 0<br /><br /><br /><br /><br />end start<br />-------------------------</div>
    <div class="meta">Posted on 2003-07-30 17:20:15 by cmax</div>
   </div>
   <div class="post" id="post-112466">
    <div class="subject"><a href="#post-112466">Full Path Name</a></div>
    <div class="body"><div class="quote"><br />PUSH 128<br />PUSH offset aClassName<br />PUSH aHandle<br />PUSH GetClassNameA<br /></div> <br /><br />Should be<br /><br /><div class="quote"><br />PUSH 128<br />PUSH offset aClassName<br />PUSH aHandle<br />CALL GetClassNameA<br /></div> <br /><br />It works, btw.<br /><br />RobotBob</div>
    <div class="meta">Posted on 2003-07-30 17:28:37 by RobotBob</div>
   </div>
   <div class="post" id="post-112468">
    <div class="subject"><a href="#post-112468">Full Path Name</a></div>
    <div class="body"><div class="quote"><em>Originally posted by cmax </em><br />.data?<br />aHandle      DWORD ?<br />aClassName                  BYTE        128 dup(?)<br /><br /><strong>(...)</strong><br />invoke    MessageBoxA, 0, offset aHandle, 0, 0<br /></div><br />I don't understand... why are you passing a DWORD number to MessageBox, where it expects a pointer to a string?<br /><br />Besides, this should work:<br /><pre><code><br />invoke GetDesktopWindow<br />invoke GetClassName,eax,offset aClassName,sizeof aClassName<br />invoke MessageBox,0,offset aClassName,offset aClassName,MB_OK<br /></code></pre></div>
    <div class="meta">Posted on 2003-07-30 17:31:31 by QvasiModo</div>
   </div>
   <div class="post" id="post-112469">
    <div class="subject"><a href="#post-112469">Full Path Name</a></div>
    <div class="body"><div class="quote"><br />IT RETURN A HANDLE... BUT NOT CLASS NAME ...</div><br /><br />Are you getting something like this?<br /><br />   #123<br /><br />That's not a handle... it's an atom. That is, a WORD number associated with a string. Class names work this way. Since you can also use a string beginning with a numeral sign, and the ASCII decimal representation of the atom value, instead of a different string, sometimes GetClassName will return the atom value converted to ASCII decimal string with a # prepended.</div>
    <div class="meta">Posted on 2003-07-30 17:41:31 by QvasiModo</div>
   </div>
   <div class="post" id="post-112475">
    <div class="subject"><a href="#post-112475">Full Path Name</a></div>
    <div class="body">I been pushing a call for 3 days now.<br /><br />SORRY...<br /><br />So now i can get the full path even with my code at top as usual since i now GetClassName.  How Blind can i be.<br /><br />Jnrz, do EnumProcessModules work for 9x also.  It's not in my API help file for even for NT?  <br /><br />QvasiModo, I get a real handle but as RobotBob pointed out i was pushing a call.<br /><br />btw QvasiModo, since i saw it i plan to use it.  I have been laying your code out in a readable format.. ( at lease this is what i do so i can understand things better )  I'm not finshed but i plan to correct your spelling and lay it out.  I seen it all to you when i am finshed in a few day if you want it.  I do this for all code that i use in my program just to remember.<br /><br />Great work. It really teaches us about dlls even as we go.  (I use WordPerfet for spelling not my brains.. )<br /><br />Anyway case close ... my bad</div>
    <div class="meta">Posted on 2003-07-30 19:06:14 by cmax</div>
   </div>
   <div class="post" id="post-112500">
    <div class="subject"><a href="#post-112500">There is one more thing about this.  Sorry Guys</a></div>
    <div class="body">I think that GetModuleFileName is the way to go but this code only give the executionable own full FileName.  I am trying to get the ForegroundWindow FileName . Getting my window out the way is not the problem because i ise SW_HIDE in a  timer funtion and everything else that i was trying to do here now works <br />(GetClassName) and others but not this one. <br /><br />I think i am making the wrong call at <br /><br />&quot;invoke GetModuleHandle, eax ;;;NULL&quot; or it don't work with a plain handle.<br /><br /><br /><br />;..........................................................<br /><br />.386<br />.MODEL FLAT,STDCALL<br />option casemap:none<br /><br />include \MASM32\INCLUDE\windows.inc<br />include \MASM32\INCLUDE\user32.inc<br />include \MASM32\INCLUDE\kernel32.inc<br /><br />includelib \MASM32\LIB\user32.lib<br />includelib \MASM32\LIB\kernel32.lib<br /><br />.data?<br /><br />aHandle       DWORD ?<br /><br />FileName                  BYTE        128 dup(?)<br /><br />.CODE<br />start:<br /><br /><br />invoke GetForegroundWindow<br /><br /><br />invoke GetModuleHandle, eax ;;;NULL<br /><br />invoke GetModuleFileName, eax, addr FileName, sizeof FileName<br /><br />invoke    MessageBoxA, 0, offset FileName, 0, 0<br /><br /><br />    invoke ExitProcess, 0<br /><br /><br /><br /><br />end start<br />-------------------------<br /><br />it returns my own file name .  I'm hope this don't piece of code s not a forground window.</div>
    <div class="meta">Posted on 2003-07-30 23:08:47 by cmax</div>
   </div>
   <div class="post" id="post-112501">
    <div class="subject"><a href="#post-112501">Full Path Name</a></div>
    <div class="body">Its returning its own filename because GetModuleHandle is failing.<br />if the first param to GetModuleFileName is NULL, it assumes you mean it own module.<br /><br />&quot;If this parameter is NULL, GetModuleFileName returns the path for the file used to create the calling process. &quot;<br /><br />HMODULE GetModuleHandle(<br />    LPCTSTR lpModuleName 	// address of module name to return handle for  <br />   );<br /><br />Is looking for a 'string' and not the window handle returned by: GetForegroundWindow.<br /><br />I'll look through it and see If I can generate the result you desire.<br /><br />RobotBob</div>
    <div class="meta">Posted on 2003-07-30 23:19:33 by RobotBob</div>
   </div>
   <div class="post" id="post-112503">
    <div class="subject"><a href="#post-112503">Full Path Name</a></div>
    <div class="body">One thing for sure GetModuleFileName would have been the best way because it works for all windows. That was where i accually started but i did not want to keep it in a dll, so i went gun-ho for vxd and kmd's to figure out why it did not work and make it work in an executionable. <br /><br />Now i see why.  A dll is not a real PE or don't have a MZ.  Now that i know it looks for a string, it looks for itself regardless before the code ends.   So SW_HIDE means nothing.<br /><br />I think this one is a losing battle.  So don't go any more out your way unless you know you can get around that.  I hope you can but if not Thanks anyway Robot.<br /><br />At lease their's enough info here to get things working the long way around with no driver need. ( But i am going to write one anyway some day soon )<br /><br />&quot;Process32Next works with all 32 bit versions of Windows (Except NT4)&quot; and &quot;EnumProcessModules&quot; may take care of NT to boot. Thanks to donkey and Jnrz replies.<br /><br />It's the only block of code that i may have to write for each OS. I been very lucky up until now.<br /><br />I was telling this chick i know what i was trying to do and how hard it was to do it.<br /><br />She said you want your cake and eat it too.<br /><br />Where do females come up with these lines and keep them for thousands of years... <br /><br />I asked her, what else is a cake good for.<br /><br />She return no reply. hee hee ... <br /><br />but i bet she use that line again.<br /><br />Thanks everybody</div>
    <div class="meta">Posted on 2003-07-31 01:58:33 by cmax</div>
   </div>
   <div class="post" id="post-112506">
    <div class="subject"><a href="#post-112506">Full Path Name</a></div>
    <div class="body">&quot;Now i see why. A dll is not a real PE or don't have a MZ.&quot;<br /><br />Not true, a dll is a PE.<br /><br />Here is what the api needs for the intial call to GetModuleHandle:<br /><div class="quote"><br />lpModuleName<br /><br />Points to a null-terminated string that names a Win32 module (either a .DLL or .EXE file). If the filename extension is omitted, the default library extension .DLL is appended. The filename string can include a trailing point character (.) to indicate that the module name has no extension. The string does not have to specify a path. The name is compared (case independently) to the names of modules currently mapped into the address space of the calling process. <br /></div><br /><br />There is always a method, never a losing battle.<br />I am not sure what your goal is? So are you trying to get the fullpath of a foreground window? and that it?<br />If I can fully understand what you need, then I can help you find the solution. Remember there is always a<br />solution. Is this for the hooking lib?<br /><br />Never give up.<br /><br />RobotBob</div>
    <div class="meta">Posted on 2003-07-31 02:19:31 by RobotBob</div>
   </div>
   <div class="post" id="post-112510">
    <div class="subject"><a href="#post-112510">Full Path Name</a></div>
    <div class="body">I have a small window that will open up  at the bottom of the user screen.  It is TOP_MOST so it will not be in the way that much.  When another app open it will hide itself.  When the app close it will re-appear.<br /><br />OK, When it hides itself it need to get the full pathname, time opend, time closed and other stuff of whatever program is running or in use.  (now it's no suprise) :(  Anything else is easy is guest... But i want to do it my way.<br /><br />So since i am not useing a dll for this one i need to do it all in the app.  <br /><br />OK, this thread have proven though coding that i can get all of that other information such as WindowText, ClassName or anything else but the full path.<br /><br />If i don't hide my window i get nothing but my own information about my window.<br /><br />The Full Path is the last thing i need to get and i can't find a way to get it.  If i get the right code it will work for all Windows not one for 9x and one for NT and one for XP etc.<br /><br />This is the added hell i get.  so GetModuleFileName seem to be the best way to go but it keeps returning information on my window not the other window as it should just like when i get classname.<br /><br />I hope i you understand what i am saying, <br /><br />It works for every call but GetModuleFileName ... <br /><br />If i got to code for all OS i will<br /><br />Anything it takes to get the FileName and it full path i be HAPPY...<br />but GetModuleFileName use less API to get the job done<br /><br />PS:  I am trying to deal with the app that the user is using, not all opened windows only the top level one that's why my gets out the way and has good reasons of doing so to boot... I hate to tell what i am doing until i did it.  But anything for ________<br /><br />Thanks</div>
    <div class="meta">Posted on 2003-07-31 04:00:52 by cmax</div>
   </div>
   <div class="post" id="post-112514">
    <div class="subject"><a href="#post-112514">Full Path Name</a></div>
    <div class="body">GetModuleFileName will not retrieve the filename of a module in another process. The only way you can do this is to enumerate all the processes and find the one that you're looking for, you can then extract the module file name using GetModuleFileNameEx using the process handle or use a Module Snapshot to get it.<br /><pre><code>SearchForProcess proc<br />   LOCAL pe32               &#58;PROCESSENTRY32<br />   LOCAL me32               &#58;MODULEENTRY32<br />   LOCAL hProcessSnap         &#58;HANDLE<br />   LOCAL hModuleSnap         &#58;HANDLE<br /><br />   mov pe32.dwSize,SIZEOF PROCESSENTRY32<br />   mov me32.dwSize,SIZEOF MODULEENTRY32<br /><br />   invoke CreateToolhelp32Snapshot,TH32CS_SNAPPROCESS,0<br />   .IF eax == -1<br />      ret<br />   .ENDIF<br />   mov hProcessSnap,eax<br />   invoke Process32First,hProcessSnap,ADDR pe32<br />   .IF eax==0<br />      ret<br />   .ENDIF<br /><br />   .WHILE eax<br />      invoke SetLastError,0<br />      invoke CreateToolhelp32Snapshot,TH32CS_SNAPMODULE,pe32.th32ProcessID<br />      mov hModuleSnap,eax<br />      invoke Module32First,hModuleSnap,ADDR me32<br />      invoke CloseHandle,hModuleSnap<br /><br />      ; &#91;b&#93;Module filename is in me32.szExePath&#91;/b&#93;<br /><br />      invoke Process32Next,hProcessSnap,ADDR pe32<br />   .ENDW<br />   invoke CloseHandle,hProcessSnap<br /><br />   ret<br />SearchForProcess endp</code></pre>You will have to find a way to pick out your target process</div>
    <div class="meta">Posted on 2003-07-31 04:23:41 by donkey</div>
   </div>
   <div class="post" id="post-112535">
    <div class="subject"><a href="#post-112535">Full Path Name</a></div>
    <div class="body">Yell, I really thought so.  I spend more time trying every way possible receiving the same results.<br /><br />So i was looking at Jnrz code for NT and had just set it up in my app while reading API as i went.<br /><br />Than i was going to find this code for all else because i seen it in a post while searching. That's why I PS: &quot;Do Process32Next work for all 9x and up&quot;..... Ii was looking dead at it or something just like it posted by you.  <br /><br />So i was prepared to find it again... <br /><br />Robot, you and i are kind of alike.  It's hard to give up. Nine  out of ten we usually find away even with the so-called impossible.  But you the kind of guy that can and will beats the odds.  It's a gift.  I got a feeling.<br /><br />Istine said something like this &quot; Insanity is when you do the same thing over and over again only getting the same results&quot;<br /><br />I'm talking days here and Pushing Calls to boot...<br /><br />But i learned a lot of new stuff behind it all and will never forget it.<br /><br />Thanks again<br /><br />PS:  I had to tell about what i am doing.  You're are not the only one who get confuss by what i say.  Just read above or in my previous thread, for that matter up to two years ago. :)</div>
    <div class="meta">Posted on 2003-07-31 06:25:10 by cmax</div>
   </div>
   <div class="post" id="post-112536">
    <div class="subject"><a href="#post-112536">Full Path Name</a></div>
    <div class="body">Process32Next works for all 9x, 2K and XP, it does not work for NT4, you have to use the psapi for that.</div>
    <div class="meta">Posted on 2003-07-31 06:30:24 by donkey</div>
   </div>
   <div class="post" id="post-112537">
    <div class="subject"><a href="#post-112537">Full Path Name</a></div>
    <div class="body">(1)<br />Let me get this straight.  Jnrz code use the psapi.inc so it's NT <strong>READY</strong> right.  If so the two together is more than what one can ask for.<br /><br />(2)<br />Can make the psapi.dll work for 9x if i steal some needed stuff out of NT XP.  (This one just a thought)<br /><br />(3)<br />I see the psapi.dll in a lot of examples.  This is for NT only or all NT types. <br /><br />I don't have NT or NT types  but i am setting things up now but test it when i get it.<br /><br />Done<br /><br />Thanks</div>
    <div class="meta">Posted on 2003-07-31 06:54:09 by cmax</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=14535&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=14535&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="14535" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=14535&amp;page=2">&gt;</a><a href="../?id=14535&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>