<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>SEH with invalid ESP - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29003" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29003">SEH with invalid ESP</a></p>
   <div class="post" id="post-204956">
    <div class="subject"><a href="#post-204956">SEH with invalid ESP</a></div>
    <div class="body">As stated in win API reference for the SetUnhandledExceptionFilter:<br /><br />&quot;The exception handler specified by lpTopLevelExceptionFilter<br />is executed in the context of the thread that caused the fault.<br />This can affect the exception handler&#039;s ability to recover<br />from certain exceptions, such as an invalid stack.&quot;<br /><br />Since I use the ESP as a general purpose reg, my handler<br />doesn&#039;t get called, a standard GPF window is displayed instead.<br /><br />Anyway to overcome this?<br />Some mechanism to tell windows the default ESP value?<br /><br />P.S. I&#039;ve just started using SEH<br /></div>
    <div class="meta">Posted on 2008-03-07 07:48:05 by aleksaZR</div>
   </div>
   <div class="post" id="post-204957">
    <div class="subject"><a href="#post-204957">Re: SEH with invalid ESP</a></div>
    <div class="body">simple way - dont use esp, you shouldn&#039;t use it as a general purpose register.. its not intended for that purpose... </div>
    <div class="meta">Posted on 2008-03-07 16:20:05 by evlncrn8</div>
   </div>
   <div class="post" id="post-204958">
    <div class="subject"><a href="#post-204958">Re: SEH with invalid ESP</a></div>
    <div class="body"><div class="quote"><br />simple way - dont use esp, you shouldn&#039;t use it as a general purpose register.. its not intended for that purpose... <br /></div><br />Nevermind.<br /><br />I&#039;ve changed the prog not to use the ESP but the speed<br />tests shows that SEH really slows down my prog, up to 7 times.<br /><br />I&#039;m doing about 28million calculations, 1/4 are divisions.<br /><br />Instead of testing for division by zero with &quot;test reg,reg : jz err&quot;<br />I&#039;ve tried SEH, but that is much slower.<br /></div>
    <div class="meta">Posted on 2008-03-08 04:19:48 by aleksaZR</div>
   </div>
   <div class="post" id="post-204967">
    <div class="subject"><a href="#post-204967">Re: SEH with invalid ESP</a></div>
    <div class="body">Exception handlers are slow unless you are testing for a wide variety of failure cases. If its just DIV BY 0 then use test/jz.<br /><br />If you need help optimizing your algorithm you may want to consider posting it on the forum for pier review.</div>
    <div class="meta">Posted on 2008-03-11 10:20:31 by r22</div>
   </div>
   <div class="post" id="post-204969">
    <div class="subject"><a href="#post-204969">Re: SEH with invalid ESP</a></div>
    <div class="body"><div class="quote"><br />Exception handlers are slow unless you are testing for a wide variety of failure cases. If its just DIV BY 0 then use test/jz.<br /><br />If you need help optimizing your algorithm you may want to consider posting it on the forum for pier review.<br /></div><br /><br />Off-topic..<br /><br />Those 28mil of calculations are to solve the quiz game<br />on a local TV. The player is presented with 7 numbers.<br />He/she can use 6 of them to make a math formula that will<br />produce a number as close as possible to the 7th number.<br /><br />If you are aware of any similar prog, please let me know.<br /><br />I know of only one, and it is also made for the same quiz show.<br />The author says that it can take as long as 5min on a PIII 1GHz.<br /><br />My prog takes less than 11sec on a PI 233MHz,<br />which would make me very proud if I didn&#039;t know<br />that the other author is a 16 years old kid......<br /><br />So, if you are aware of any similar prog, please let me know.<br /><br />Anyway, my prog is complete (not in english).<br />If you want it, get it from www.beotel.net/~astancic<br />click on &quot;slagalica - moj broj.rar&quot;<br /><br />The fields (edit boxes) can contain numbers only:<br /> field 1: 3 digits, 1 to 999<br /> field 2,3,4,5: 1 digit, 1-9<br /> field 6: 10,15,20<br /> fiels 7: 20,25,50,75,100<br /><br />Type-in 7 numbers in the 7 fields and press ENTER.<br />The prog will then try to find the formula that,<br />using the fields 2-7, will produce the result closest<br />to the number given in field 1.<br /><br />The formula can use +-*/() integer math only.<br /><br />To get the longest possible exec time, search for 999<br />with all other numbers set to 1.<br /><br />note: I don&#039;t check for allowed numbers at all,<br />meaning that you can type, say 95, in field 7.</div>
    <div class="meta">Posted on 2008-03-11 17:15:42 by aleksaZR</div>
   </div>
  </div>
 </body>
</html>