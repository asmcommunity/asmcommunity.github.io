<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>directinput: new problem - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=2425" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=2425">directinput: new problem</a></p>
   <div class="post" id="post-15323">
    <div class="subject"><a href="#post-15323">directinput: new problem</a></div>
    <div class="body">hi,<br /><br />sorry, it's me again :tongue: <br />i've another problem with my direct input stuff. i attached a part of the source and the exe. the problem is:<br /><br />when i press a lot of keys one after the other in a short time for snake number1 (first), snake number 2 doesn't react on its keys correctly (when snake nr. 1 started to do that). but if snake number 2 does the stuff first, snake number 1 has no problems with input, but after about 2 seconds, snake 2 doesn't react correctly anymore. it's like, that snake nr.1 is &quot;stronger&quot; than snake nr. 2. i can't explain that to me. it should work as well!<br /><br />to start the game, doubleclick it, wait about 4 seconds, then press &quot;S&quot;. the game starts with two snakes. perhaps there is someone who can help you to test :tongue: <br /><br />here is the readkeyboard loop:<br /><br /><pre><code><br />snakemainproc proc uses ebx edi esi<br />      <br />      invoke GetTickCount<br />      mov ebx,eax<br />      mov ecx,lasttick<br />      sub eax,ecx<br />      .if eax&gt;=snakespeed<br />      mov lasttick,ebx<br />      invoke ClearScreen<br />      invoke movesnake<br />      invoke changedirection<br />      .if foodflag==1<br />        invoke placefood<br />      .endif<br />      invoke foodcrash<br />      invoke snakecrash<br />      .if eax==1<br />        jmp @F<br />      .endif<br />      invoke wallcrash<br />      .if eax==1<br />        jmp @F<br />      .endif<br />      invoke DrawBitmap,foodx,foody,offset surface_food,offset bmp_food_info<br />      mcall &#91;dds_back&#93;,IDirectDrawSurface7_GetDC,addr backdc<br />      invoke SelectObject, backdc, fonthandle<br />      mov oldfont,eax<br />      invoke SetTextColor,backdc,0FFFFFFh<br />      invoke SetBkMode,backdc,TRANSPARENT<br />      .if point1flag==1<br />      invoke wsprintf,addr strbuffer,addr szformat,p1pointsint<br />      invoke wsprintf,addr p1points,addr p1pointsformat,addr strbuffer<br />      mov point1flag,0<br />      .endif<br />      invoke DrawMyText,addr p1points,addr pointsrectstruct<br />      invoke SelectObject,backdc,oldfont<br /><br />      mcall &#91;dds_back&#93;,IDirectDrawSurface7_ReleaseDC,backdc<br /><br />      <br />      invoke DrawWindowFrame<br />      invoke UpdateScreen<br />      .endif<br /><br />      invoke ReadKeyboard<br />      <br />      .if keyboard_state&#91;DIK_ESCAPE&#93;<br />           <br />            invoke DestroyWindow,hWnd<br />	       <br />       .elseif keyboard_state&#91;DIK_UP&#93;<br />            .if snakeone&#91;0&#93;.direction!=3<br />            mov snakeone&#91;0&#93;.direction,1<br />            .endif<br />	<br />	.elseif keyboard_state&#91;DIK_DOWN&#93;<br />             .if snakeone&#91;0&#93;.direction!=1<br />	       mov snakeone&#91;0&#93;.direction,3<br />             .endif<br />		<br />	.elseif keyboard_state&#91;DIK_LEFT&#93;<br />	       .if snakeone&#91;0&#93;.direction!=2<br />             mov snakeone&#91;0&#93;.direction,4<br />             .endif<br />		<br />	.elseif keyboard_state&#91;DIK_RIGHT&#93;<br />             .if snakeone&#91;0&#93;.direction!=4<br />	       mov snakeone&#91;0&#93;.direction,2<br />             .endif<br />      .elseif keyboard_state&#91;DIK_W&#93;<br />            .if snaketwo&#91;0&#93;.direction!=3<br />            mov snaketwo&#91;0&#93;.direction,1<br />            .endif<br />	<br />	.elseif keyboard_state&#91;DIK_S&#93;<br />             .if snaketwo&#91;0&#93;.direction!=1<br />	       mov snaketwo&#91;0&#93;.direction,3<br />             .endif<br />		<br />	.elseif keyboard_state&#91;DIK_A&#93;<br />	       .if snaketwo&#91;0&#93;.direction!=2<br />             mov snaketwo&#91;0&#93;.direction,4<br />             .endif<br />		<br />	.elseif keyboard_state&#91;DIK_D&#93;<br />             .if snaketwo&#91;0&#93;.direction!=4<br />	       mov snaketwo&#91;0&#93;.direction,2<br />             .endif<br /><br />      .elseif keyboard_state&#91;DIK_S&#93;<br />               <br />        .endif<br />           <br />                        @@&#58;<br />      <br />ret <br />snakemainproc endp<br /></code></pre><br /><br />the keys of snake one are the arrow keys, and snake two has the other (W,A,S,D).<br /><br />thanks <br />nop</div>
    <div class="meta">Posted on 2001-12-18 15:01:58 by NOP-erator</div>
   </div>
   <div class="post" id="post-15339">
    <div class="subject"><a href="#post-15339">directinput: new problem</a></div>
    <div class="body">I presume you are getting all keys pressed reported, and so you can press 2 or more keys at once (this would make sense).<br /><br />However you seem to only deal with one at a time in your loop.<br /><br />You really need to do something like this:<br /><pre><code><br />.if escape<br />  ; Do escape<br />.else<br />  ; All other cases are overridden by quitting!<br /><br />  ; Now we must deal with player1<br />  .if p1_up_key<br />    ; p1_direction = up<br />  .elseif p1_down_key<br />    ; p1_direction = down<br />  .elseif p1_left_key<br />    ; p1_direction = left<br />  .elseif p1_right_key<br />    ; p1_direction = right<br />  .endif<br />  ; No more checks for p1!<br /><br />  ; But we must also check for player 2 as well.<br />  .if p2_up_key<br />    ; p2_direction = up<br />  .elseif p2_down_key<br />    ; p2_direction = down<br />  .elseif p2_left_key<br />    ; p2_direction = left<br />  .elseif p2_right_key<br />    ; p2_direction = right<br />  .endif<br />.endif<br /></code></pre><br /><br />At the moment, you will skip the rest of the &quot;elseif&quot; statements on finding the first key that is pressed, so player 2 cannot change course unless player1 allows them to....<br /><br />Mirno</div>
    <div class="meta">Posted on 2001-12-18 18:46:35 by Mirno</div>
   </div>
   <div class="post" id="post-15364">
    <div class="subject"><a href="#post-15364">alright</a></div>
    <div class="body">thanks, you made it very clear for me. i'll test it in about 6 hours, i'm at school at the moment. but it was a logical fault again....<br /><br />thanks!<br /><br />nop</div>
    <div class="meta">Posted on 2001-12-19 02:35:59 by NOP-erator</div>
   </div>
   <div class="post" id="post-15421">
    <div class="subject"><a href="#post-15421">thank you</a></div>
    <div class="body">hi,<br /><br />thank you, thank you, thank you, everything's cool!!! i'm so happy!! :alright: <br /><br />Thanks Mirno <img src="http://www.plaudersmilies.de/remybussi.gif" /> :grin: <br /><br />nop</div>
    <div class="meta">Posted on 2001-12-19 13:33:33 by NOP-erator</div>
   </div>
  </div>
 </body>
</html>