<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>need help with stacks i`m very new to assembly - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29944" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29944">need help with stacks i`m very new to assembly</a></p>
   <div class="post" id="post-211443">
    <div class="subject"><a href="#post-211443">need help with stacks i`m very new to assembly</a></div>
    <div class="body">the question is to solve the following using only ax,bp,sp<br />b*c/d+(e-f)*g wh,b=10,c=4,d=5,e=8,f=3,g=2<br />the answer is suppose to be 18 but i obtain 14<br />here is my code<br />org 100<br />section .data<br />section .text<br />start:<br />mov ax,3<br />push ax<br />mov bp,sp<br />mov ax,8<br />sub ax,<br />push ax<br />mov ax,2<br />mov bp,sp<br />imul ax,<br />push ax<br />mov ax,10<br />imul ax,4<br />mov bp,sp<br />mov bp,<br />div bp<br />mov bp,<br />mov ax,bp<br />mov bp,<br /><br /><br /><br /><br />add ax,bp<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />int 20h<br /></div>
    <div class="meta">Posted on 2010-04-24 06:25:44 by foxynash</div>
   </div>
   <div class="post" id="post-211446">
    <div class="subject"><a href="#post-211446">Re: need help with stacks i`m very new to assembly</a></div>
    <div class="body"><strong>foxynash</strong>,<br /><br /><strong>mov ax, bp</strong> trashes the result of your previous calculations.<br /><br /><strong>mov bp, </strong> uses value that you didn&#039;t <strong>push</strong>ed on stack (actually it&#039;s trails of <strong>debug</strong> interrupt handler&#039;s &quot;save/restore registers&quot; code if you use <strong>t</strong> or <strong>g</strong> command before that <strong>mov</strong>, or any trash).<br /><br /><strong>div r16</strong> uses dx too (ax = dx:ax/r16; luckily dx==0 in most cases).<br /><br />Mixed signed/unsigned arithmetics? This can lead to a problem (not in this simple case).<br /><br />You need only one word of stack to do this (because * has more priority than +).</div>
    <div class="meta">Posted on 2010-04-24 10:51:58 by baldr</div>
   </div>
   <div class="post" id="post-211455">
    <div class="subject"><a href="#post-211455">Re: need help with stacks i`m very new to assembly</a></div>
    <div class="body"><div class="quote"><br /><strong>foxynash</strong>,<br /><br /><strong>mov ax, bp</strong> trashes the result of your previous calculations.<br /><br /><strong>mov bp, </strong> uses value that you didn&#039;t <strong>push</strong>ed on stack (actually it&#039;s trails of <strong>debug</strong> interrupt handler&#039;s &quot;save/restore registers&quot; code if you use <strong>t</strong> or <strong>g</strong> command before that <strong>mov</strong>, or any trash).<br /><br /><strong>div r16</strong> uses dx too (ax = dx:ax/r16; luckily dx==0 in most cases).<br /><br />Mixed signed/unsigned arithmetics? This can lead to a problem (not in this simple case).<br /><br />You need only one word of stack to do this (because * has more priority than +).<br /></div><br /><br /><br />thanks bald... please tell me what is the right operation to use??? I just want to copy the first result obtained into&nbsp; bp so that i can later add it with the one in ax</div>
    <div class="meta">Posted on 2010-04-25 10:40:25 by foxynash</div>
   </div>
   <div class="post" id="post-211456">
    <div class="subject"><a href="#post-211456">Re: need help with stacks i`m very new to assembly</a></div>
    <div class="body">This is quite a tricky question, Foxynash! Not that hard to do - quite easy, &quot;if you want to do it *that* way&quot;... But hard to know how you&#039;re &quot;supposed&quot; to do it.<br /><br />One way to figure out how to do stuff is to write it up in C, and observe what the compiler does with it. If you turn up optimization, the compiler is going to optimize everything down to &quot;mov ax, 18&quot;! We can do the same with Nasm...<br /><br /><pre><code><br />mov ax, 10 * 4 / 5 + (8 - 3) * 2<br /></code></pre><br /><br />There ya go! Somehow, I don&#039;t think that&#039;s going to get you a good grade, however. I suppose you&#039;re supposed to give the CPU some exercise. Well, I can see that I probably want to do the stuff in the parentheses first...<br /><br /><pre><code><br />mov ax, 8<br />sub ax, 3<br /></code></pre><br /><br />Now I want to multiply by 2...<br /><br /><pre><code><br />shl ax, 1<br /></code></pre><br /><br />Or was I &quot;supposed&quot; to use &quot;mul&quot; there? As Baldr points out, &quot;mul&quot; (and &quot;div&quot;) silently use dx. Is this a &quot;trick question&quot;? Well, an 8-bit &quot;mul&quot; or &quot;div&quot; don&#039;t use dx. Is that what we&#039;re &quot;supposed&quot; to do? With just ax, bp, and sp to use (in dos, interrupts use &quot;our&quot; stack, so sp isn&#039;t really useable!) we haven&#039;t got a spare 8-bit register. We could use an 8-bit memory location... Although the stack has a 16-bit &quot;size&quot; in 16-bit code, we can perfectly well access an 8-bit location on it, though not with &quot;push&quot; and &quot;pop&quot;. Given the registers specified, and the word &quot;stack&quot; in the topic, I suspect you&#039;re &quot;supposed&quot; to create a &quot;stack frame&quot; with some &quot;local variables&quot; on it, in which to store some temporary results. I&#039;m not sure whether using 8-bit operations in order to avoid &quot;silently&quot; using dx is &quot;silently&quot; part of the assignment, or not. These &quot;given&quot; numbers will all fit in a byte, but that might not be the &quot;general&quot; case.<br /><br />A very &quot;general&quot; case would be to let the user input &quot;10 * 4 / 2 + ... whatever&quot;, allowing arbitrary operators and arbitrary levels of parentheses, &quot;parse&quot; it and calculate it. If you suspect that next week&#039;s assignment is going to be something like that, it may influence how you approach this assignment! :)<br /><br />You&#039;ll need to know/decide how large numbers you need to handle, and what, if anything, you want to do about overflow. Do you need to handle negative inputs/results? The &quot;given&quot; numbers are easy, but what other &quot;given&quot; numbers should the code handle?<br /><br />You can probably guess how you&#039;re &quot;supposed&quot; to do this by &quot;where you are&quot; in the course. Or &quot;you can find out a lot, just by askin&#039;&quot;... Your code so far looks like you want &quot;local variables&quot; on the stack. Perhaps something like...<br /><br /><pre><code><br />org 100h<br />section .text<br />&nbsp; &nbsp; push bp ; for no good reason but that it&#039;s &quot;standard&quot;<br />&nbsp; &nbsp; mov bp, sp ; establish a &quot;stack frame pointer&quot;<br />&nbsp; &nbsp; sub sp, 8 ; enough for 4 words or 8 bytes - more than we need<br /><br />; we can give our variables names...<br />%define tmp1 bp - 2<br />%define tmp2 bp - 4<br />%define tmp3 bp - 6<br />%define tmp4 bp - 8<br /><br />&nbsp; &nbsp; mov ax, 8<br />&nbsp; &nbsp; sub ax, 3<br /><br />; though &quot;tmp1&quot; has room for a word, we can use just a byte<br />&nbsp; &nbsp; mov byte , 2<br />&nbsp; &nbsp; mul byte  ; al *  -&gt; ax<br /><br />; use the whole 16 bits here<br />&nbsp; &nbsp; mov , ax<br /><br />; now do the first part<br />&nbsp; &nbsp; mov ax, 10<br />&nbsp; &nbsp; mov byte , 4<br />&nbsp; &nbsp; mul byte <br />&nbsp; &nbsp; mov byte , 5<br />&nbsp; &nbsp; div byte <br />; oh, oh! the &quot;given&quot; numbers divide evenly, if there<br />; had been a remainder, it would be in ah. use it to round?<br />; throw it away? are we &quot;supposed&quot; to use ah?<br />; maybe we would have been better off with words - ignore dx?<br />; no? okay, use ax, and throw away any remainder:<br />&nbsp; &nbsp; and ax, 0FFh ; there!<br /><br />&nbsp; &nbsp; add ax, <br /><br />; are we done? destroy stack frame:<br />&nbsp; &nbsp; mov sp, bp<br />&nbsp; &nbsp; pop bp<br />&nbsp; &nbsp; ret ; just to prove we can...<br /><br />; better?<br />; mov ah, 4Ch<br />; int 21h<br />; return result in al as errorlevel?<br /><br />%undef tmp1<br />; etc. - if you want to be able to reuse them<br /><br /></code></pre><br /><br />That&#039;s untested - I don&#039;t even know if it&#039;ll assemble - or gives correct results - or if it&#039;s anything like the way you&#039;re &quot;supposed&quot; to do it, but it&#039;s an attempt to use &quot;mul&quot; and &quot;div&quot; without using dx. Another possibility would be to use words throughout, and avoid &quot;mul&quot; and &quot;div&quot;... our two multiplies can both be replaced with shifts, and &quot;div&quot; can be replaced by repeated subtraction (&quot;div&quot; is so slow that subtraction is sometimes faster!!!) If the next set of &quot;given&quot; numbers can&#039;t be multiplied by shifts... back to &quot;mul&quot;... or do repeated &quot;add&quot;s... Easiest thing would be to use dx without sayin&#039; so - but that depends on if the assignment is a &quot;trick question&quot;. Use your judgement.<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2010-04-25 16:57:54 by fbkotler</div>
   </div>
   <div class="post" id="post-211457">
    <div class="subject"><a href="#post-211457">Re: need help with stacks i`m very new to assembly</a></div>
    <div class="body">i compiled your code and obtained 12 as result which is not suppose to be the correct answer.How can i perform the operation 10*4/5 cos when i mov into bp after doing mov ax 10 and imul ax, 4 i obtain the 8 as result which is correct... but the problem is adding the two parts together to obtain 18.. i`ve been working on this for two days already need help please!!!!!!</div>
    <div class="meta">Posted on 2010-04-25 18:37:03 by foxynash</div>
   </div>
   <div class="post" id="post-211458">
    <div class="subject"><a href="#post-211458">Re: need help with stacks i`m very new to assembly</a></div>
    <div class="body">thanks bald and frank i just realised wafter a last trial that 18 is in binary and in hex its 12 which is correct answer thanks......</div>
    <div class="meta">Posted on 2010-04-25 18:58:44 by foxynash</div>
   </div>
   <div class="post" id="post-211460">
    <div class="subject"><a href="#post-211460">Re: need help with stacks i`m very new to assembly</a></div>
    <div class="body">I&#039;m posting this only because it use the stack a bit less.<br /><br /><pre><code>org 0x100<br />; Compute b*c/d+(e-f)*g<br />&nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; bp, sp<br /><br />; We are going to compute b*c/d first<br />&nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; ax, <strong><br />&nbsp; &nbsp; &nbsp; imul&nbsp; &nbsp;  ax, <br />&nbsp; &nbsp; &nbsp; cwd ; Ensures DX will be either 0 or -1 but not any garbage that would make the division fail. (Not always needed but I&#039;m assuming DX is in an unknown state at this point)<br />&nbsp; &nbsp; &nbsp; idiv&nbsp; &nbsp;  <br /><br />; We save AX<br />&nbsp; &nbsp; &nbsp; push&nbsp; &nbsp;  ax<br /><br />; We are going to compute (e-f)*g now<br />&nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; ax, <br />&nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp; &nbsp; ax, <br />&nbsp; &nbsp; &nbsp; imul&nbsp; &nbsp;  ax, <br /><br />; Now we add up the two parts to complete the computation<br />&nbsp; &nbsp; &nbsp; add&nbsp; &nbsp; &nbsp; ax, <br />&nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp; &nbsp; sp, bp ; Just to restore SP to the value previous to &quot;PUSH AX&quot; (in this code not really needed)<br /><br />; Trap to see results in the debugger (use DEBUG here or whatever you like)<br />&nbsp; &nbsp; &nbsp; int3<br /><br />&nbsp; &nbsp; &nbsp; int&nbsp; &nbsp; &nbsp; 0x20<br /><br />; I&#039;ll use integer variables to pretend flexibility on the values at run-time (them could have been all equates/constants and in such case the square brackets in the instructions must be removed)<br />b dw 10<br />c dw&nbsp; 4<br />d dw&nbsp; 5<br />e dw&nbsp; 8<br />f dw&nbsp; 3<br />g dw&nbsp; 2</code></pre><br />I&#039;ve used fasm, but I believe it also compiles in NASM and in TASM probably it requires some minor changes.</div>
    <div class="meta">Posted on 2010-04-25 20:48:58 by LocoDelAssembly</div>
   </div>
   <div class="post" id="post-211466">
    <div class="subject"><a href="#post-211466">Re: need help with stacks i`m very new to assembly</a></div>
    <div class="body">I&#039;m posting this only because it don&#039;t use anything besides <strong>ax</strong> (ip/flags, of course).<br /><br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; org&nbsp; &nbsp;  100h<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ax, 10 shl 8<br />&nbsp; &nbsp; &nbsp; &nbsp; aad&nbsp; &nbsp;  4<br />&nbsp; &nbsp; &nbsp; &nbsp; aam&nbsp; &nbsp;  5<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, 8<br />&nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, 3<br />&nbsp; &nbsp; &nbsp; &nbsp; xchg&nbsp; &nbsp; ah, al<br />&nbsp; &nbsp; &nbsp; &nbsp; aad&nbsp; &nbsp;  2<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br /></code></pre><br /><br />Immediate power! ;-)</div>
    <div class="meta">Posted on 2010-04-26 11:46:57 by baldr</div>
   </div>
   <div class="post" id="post-211478">
    <div class="subject"><a href="#post-211478">Re: need help with stacks i`m very new to assembly</a></div>
    <div class="body">Wow!!! That definitely wins the prize for &quot;coolest code&quot;!<br /><br />(Nasm knows &quot;shl&quot; as an instruction, but not an operator - that&#039;ll have to be changed to &quot;&lt;&lt;&quot; for Nasm to eat it)<br /><br />A couple extra instructions will return the answer as an exitcode - in Linux, we can just do &quot;echo $?&quot; to see the exitcode of the last program that ran - in decimal, so we don&#039;t get confused. :) I don&#039;t think that works in dos, but a few extra instructions would display the answer...<br /><br /><pre><code><br />...<br />aam 10<br />add ax, 3030h ; &#039;0&#039; &#039;0&#039; - to convert number to character<br />xchg al, ah<br />int 29h<br />xchg al, ah<br />int 29h<br /><br />ret<br /></code></pre><br /><br />(this little trick only works for two-digit numbers)<br /><br />Cool as this code is, I think LocoDelAs has posted a more &quot;appropriate&quot; approach for Foxynash to follow. Putting the &quot;given numbers&quot; in variables is a lot more flexible than &quot;hard coding&quot; them... a step towards allowing the user to enter values (or reading them from a file)... in turn, a step towards &quot;arbitrary operations&quot; (tougher, but not that tough). Hard-coding a specific set of &quot;given numbers&quot; is a good first step toward learning to do calculations, but isn&#039;t that useful. So, might as well code it in an &quot;expandable&quot; way.<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2010-04-27 20:15:49 by fbkotler</div>
   </div>
   <div class="post" id="post-211480">
    <div class="subject"><a href="#post-211480">Re: need help with stacks i`m very new to assembly</a></div>
    <div class="body"><div class="quote"><br />Wow!!! That definitely wins the prize for &quot;coolest code&quot;!</div><br /><br />That&#039;s how we did it in the 80s.<br />These days it&#039;s VERY SLOW code, as all that BCD-related junk in the instructionset is implemented in slow microcode macros. The x86 instructionset is NOT what a modern x86 CPU implements in hardware. It is a RISC CPU that only implements the common subset of x86 instructions in hardware.</div>
    <div class="meta">Posted on 2010-04-28 02:53:03 by Scali</div>
   </div>
   <div class="post" id="post-211481">
    <div class="subject"><a href="#post-211481">Re: need help with stacks i`m very new to assembly</a></div>
    <div class="body"><div class="quote"><br />These days it&#039;s VERY SLOW code, as all that BCD-related junk in the instructionset is implemented in slow microcode macros.<br /></div><br /><br />Can&#039;t imagine why they eliminated it in Long Mode :lol:</div>
    <div class="meta">Posted on 2010-04-28 03:17:33 by SpooK</div>
   </div>
   <div class="post" id="post-211483">
    <div class="subject"><a href="#post-211483">Re: need help with stacks i`m very new to assembly</a></div>
    <div class="body">Just for the sake of argument, what&#039;s your &quot;fast&quot; implementation, Scali?<br /><br />The reason I ask is not that I doubt your assertion, but... I once set out to determine &quot;How slow *is* it?&quot;... I was interested in &quot;das&quot; in particular... and my results were &quot;highly inconclusive&quot;. I wrote a little &quot;timing harness&quot; - it gives some &quot;odd&quot; results, but usually a definite number of cycles for an instruction or group of instructions ... But &quot;das&quot; was all over the place! I&#039;ll post my code - maybe someone can spot something wrong with it... But I think I&#039;ll start a new thread... These are not the instructions Foxynash wants, for reasons besides speed (I think it&#039;s &quot;undocumented&quot; that some of &#039;em take operands, isn&#039;t it?). Best to hand in code that you can explain, if asked, and I doubt if the class has gotten to those &quot;adjust&quot; instructions... unless you&#039;re working alphabetically...<br /><br />Foolish question, I suppose, what&#039;s the fastest way to do &quot;mov ax, 18&quot;... but it raises some other &quot;interesting&quot; questions, in my mind...<br /><br />Later,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2010-04-28 05:56:06 by fbkotler</div>
   </div>
   <div class="post" id="post-211484">
    <div class="subject"><a href="#post-211484">Re: need help with stacks i`m very new to assembly</a></div>
    <div class="body"><div class="quote"><br />Just for the sake of argument, what&#039;s your &quot;fast&quot; implementation, Scali?</div><br /><br />I&#039;m rather busy with my other projects at the moment, but perhaps you can make a new &#039;small challenge&#039; topic, so all the members can try their hand at writing the fastest implementation, and we can compare with f0dder&#039;s yodel framework, like we did with Homer&#039;s challenge a while ago.<br />I believe these slow instructions are well-documented in both AMD&#039;s and Intel&#039;s optimization manuals though.</div>
    <div class="meta">Posted on 2010-04-28 06:06:03 by Scali</div>
   </div>
   <div class="post" id="post-213551">
    <div class="subject"><a href="#post-213551">need help with threads</a></div>
    <div class="body">need code for implementation of prim`s algorithm to find minimum spanning tree in parallel using multiple threads.... using c++<br />&nbsp;  I am&nbsp; a newbie in threads and don`t really know where to start to slove this problem... Can anyone help me on this??/</div>
    <div class="meta">Posted on 2010-12-01 05:44:01 by foxynash</div>
   </div>
  </div>
 </body>
</html>