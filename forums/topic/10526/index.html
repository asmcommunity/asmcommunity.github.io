<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>macros again - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10526" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=10526">macros again</a></p>
   <div class="post" id="post-79177">
    <div class="subject"><a href="#post-79177">macros again</a></div>
    <div class="body">Hiya<br /><br />My macro looks like this:<pre><code>#macro _push&#40; _arg &#41;;<br />    push&#40; _arg &#41;;<br />#endmacro;</code></pre>I'd like this macro to work in any of following cases:<pre><code>const<br />    _CONST1 &#58;= 1;<br />    _CONST2 &#58;= 2;<br />procedure _proc;<br />var<br />    b &#58; byte;<br />    w &#58; word;<br />    d &#58; dword;<br />begin _proc;<br />    _push&#40; 1 &#41;;<br />    _push&#40; eax &#41;;<br />    _push&#40; dx &#41;;<br />    _push&#40; bl &#41;;<br />    _push&#40; &#40;type string edi&#41; &#41;;<br />    _push&#40; b &#41;;<br />    _push&#40; w &#41;;<br />    _push&#40; d &#41;;<br />    _push&#40; _CONST1 | _CONST2 &#41;;<br />end _proc;</code></pre><br />please help me to modify the macro.<br /><br />clone-d.</div>
    <div class="meta">Posted on 2003-01-30 09:48:56 by clone-d</div>
   </div>
   <div class="post" id="post-79397">
    <div class="subject"><a href="#post-79397">Re: macros again</a></div>
    <div class="body"><div class="quote"><br />Hiya<br /><br />My macro looks like this:<pre><code>#macro _push&#40; _arg &#41;;<br />    push&#40; _arg &#41;;<br />#endmacro;</code></pre>I'd like this macro to work in any of following cases:<pre><code>const<br />    _CONST1 &#58;= 1;<br />    _CONST2 &#58;= 2;<br />procedure _proc;<br />var<br />    b &#58; byte;<br />    w &#58; word;<br />    d &#58; dword;<br />begin _proc;<br />    _push&#40; 1 &#41;;<br />    _push&#40; eax &#41;;<br />    _push&#40; dx &#41;;<br />    _push&#40; bl &#41;;<br />    _push&#40; &#40;type string edi&#41; &#41;;<br />    _push&#40; b &#41;;<br />    _push&#40; w &#41;;<br />    _push&#40; d &#41;;<br />    _push&#40; _CONST1 | _CONST2 &#41;;<br />end _proc;</code></pre><br />please help me to modify the macro.<br /><br />clone-d. </div><br /><br />Well, doing all that starts to get convoluted and ugly.<br />It's also one area where HLA v1.x's compile-time language<br />has gotten a bit cheap.  Actually, that's not true, the compile-time<br />language handles this stuff fairly well, it's the HLA v1.x <em>implementation</em><br />of the compile-time language that's problematic (i.e., some things<br />are defined just the way you want them, but they don't always work<br />properly).   In any case, the stuff you want to look up are the compile-time<br />functions @isconst, @isreg, @ismemory, etc.  These functions return true<br />or false if their argument falls into the specified category.  So you wind up<br />coding stuff like the following:<br /><br /><pre><code><br />#macro _push&#40; arg &#41;;<br /><br />   #if&#40; @isConst&#40; arg &#41;&#41;<br /><br />        ...<br /><br />   #elseif&#40; @isreg8&#40; arg &#41;&#41;<br /><br />       ...<br /><br />   #elseif&#40; @isreg16&#40; arg &#41;&#41;<br />       ...<br />   #elseif ....<br /><br />    etc.<br /><br />#endmacro;<br /></code></pre><br />Take a look at the &quot;stdout.put&quot; macro in the stdout.hhf header<br />file for some examples of this.<br /><br />I will warn you, it's a lot of work to handle every case properly<br />and work around some of the bugs in HLA v1.x :-(<br />As big as the stdout.put macro is, it's still far from complete.<br /><br />One of the big plans I have for HLA v2.0 is to implement a new<br />kind of macro that I call &quot;templates&quot; that will simplify this kind<br />of stuff.  But I still haven't quite figured out how I want to do that.<br /><br />Oh, btw, do realize that using crazy macros like this *really* slows<br />down the compilation of an HLA program.  HLA macros, because<br />of limitations in flex and bison, don't have the most efficient implementation<br />you can devise.  1,000 lines of macro code probably compile at between<br />1/10th and 1/100th the speed of a normal source file (of course, if each<br />macro expands to 10 lines of code, you'd expect this, but macros are<br />quite a bit slower than even this would suggest).<br />Cheers,<br />Randy Hyde</div>
    <div class="meta">Posted on 2003-02-01 01:48:26 by rhyde</div>
   </div>
   <div class="post" id="post-79405">
    <div class="subject"><a href="#post-79405">another problem</a></div>
    <div class="body">here goes a new problem:<span style="font-size:9px><pre><code>program test_macro;<br />    #macro m1&#40; arg &#41;;<br />        #if&#40; @isreg&#40; arg &#41;&#41;<br />            #print&#40; &quot;REG&quot; &#41;;<br />        #elseif&#40; @isconst&#40; arg &#41;&#41;<br />            #print&#40; &quot;CONST&quot; &#41;;<br />        #else<br />            #print&#40; &quot;NEITHER&quot; &#41;;<br />        #endif;<br />    #endmacro;<br />	<br />    #macro m2&#40; arg &#41;;<br />        m1&#40; a &#41;;<br />    #endmacro;<br /><br />begin test_macro;<br />    m1&#40; 1 &#41;;<br />    m1&#40; eax &#41;;<br />    m2&#40; 1 &#41;;<br />    m2&#40; eax &#41;;<br />end test_macro;</code></pre></span>and here's what we get:<span style="font-size:9px><pre><code>c&#58;\tmp\test_macro&gt;hla test_macro<br />CONST<br />REG<br />NEITHER<br />NEITHER<br /> Assembling&#58; test_macro.asm</code></pre></span>clone-d.<br />P.S. I think you should remove the auto-appending a .hla extension to filename (or at least first try to find given file and if none found, then try adding .hla)</div>
    <div class="meta">Posted on 2003-02-01 03:00:45 by clone-d</div>
   </div>
   <div class="post" id="post-79498">
    <div class="subject"><a href="#post-79498">Re: another problem</a></div>
    <div class="body"><div class="quote"><br />here goes a new problem:<span style="font-size:9px><pre><code>program test_macro;<br />    #macro m1&#40; arg &#41;;<br />        #if&#40; @isreg&#40; arg &#41;&#41;<br />            #print&#40; &quot;REG&quot; &#41;;<br />        #elseif&#40; @isconst&#40; arg &#41;&#41;<br />            #print&#40; &quot;CONST&quot; &#41;;<br />        #else<br />            #print&#40; &quot;NEITHER&quot; &#41;;<br />        #endif;<br />    #endmacro;<br />	<br />    #macro m2&#40; arg &#41;;<br />        m1&#40; a &#41;;<br />    #endmacro;<br /><br />begin test_macro;<br />    m1&#40; 1 &#41;;<br />    m1&#40; eax &#41;;<br />    m2&#40; 1 &#41;;<br />    m2&#40; eax &#41;;<br />end test_macro;</code></pre></span>and here's what we get:<span style="font-size:9px><pre><code>c&#58;\tmp\test_macro&gt;hla test_macro<br />CONST<br />REG<br />NEITHER<br />NEITHER<br /> Assembling&#58; test_macro.asm</code></pre></span>clone-d.<br />P.S. I think you should remove the auto-appending a .hla extension to filename (or at least first try to find given file and if none found, then try adding .hla)  </div><br /><br />Did you really mean to pass &quot;a&quot; rather than &quot;arg&quot; as the m1 argument in the m2 macro invocation?  (Or is this just a typo?).<br /><br />First trying to find the file is probably a good idea.  I'll add that to my list.<br />Randy Hyde</div>
    <div class="meta">Posted on 2003-02-01 20:21:09 by rhyde</div>
   </div>
   <div class="post" id="post-79551">
    <div class="subject"><a href="#post-79551">macros again</a></div>
    <div class="body"><div class="quote">Did you really mean to pass &quot;a&quot; rather than &quot;arg&quot; as the m1 argument in the m2 macro invocation? (Or is this just a typo?).</div> <br />Yeah? I meant<span style="font-size:9px><pre><code>#macro m2&#40; arg &#41;;<br />    m1&#40; arg &#41;;<br />#endmacro;</code></pre></span></div>
    <div class="meta">Posted on 2003-02-02 05:53:08 by clone-d</div>
   </div>
   <div class="post" id="post-79808">
    <div class="subject"><a href="#post-79808">macros again</a></div>
    <div class="body"><div class="quote"><br /> <br />Yeah? I meant<span style="font-size:9px><pre><code>#macro m2&#40; arg &#41;;<br />    m1&#40; arg &#41;;<br />#endmacro;</code></pre></span> </div><br /><br />Take a look at this.  It should give you some ideas:<br /><br /><pre><code><br />program t;<br />#include&#40; &quot;stdlib.hhf&quot; &#41;<br />const<br />    _CONST1 &#58;= 1;<br />    _CONST2 &#58;= 2;<br />	<br />#macro _push&#40; arg &#41;;<br /><br />	#if&#40; @isconst&#40; arg &#41;&#41;<br />	<br />		#print&#40; &quot;constant = &quot;, @string&#40; arg &#41;&#41;<br />		<br />	#elseif&#40; @isreg32&#40; arg &#41;&#41;<br />	<br />		#print&#40; &quot;reg32&#58; &quot;, @string&#40; arg &#41;&#41;<br />		<br />	#elseif&#40; @isreg16&#40; arg &#41;&#41;<br />	<br />		#print&#40; &quot;reg16&#58; &quot;, @string&#40; arg &#41;&#41;<br />		<br />	#elseif&#40; @isreg&#40; arg &#41;&#41;<br />	<br />		#print&#40; &quot;can't push &quot;, @string&#40; arg &#41;&#41;<br />		<br />	#elseif&#40; @ismem&#40; arg &#41;&#41;<br />	<br />		#if&#40; @size&#40; arg &#41; = 4 &#41;<br />		<br />			#print&#40; &quot;mem32&#58; &quot;, @string&#40; arg &#41;&#41;<br />		<br />		#elseif&#40; @size&#40; arg &#41; = 2 &#41;<br />		<br />			#print&#40; &quot;mem16&#58; &quot;, @string&#40; arg &#41;&#41;<br />			<br />		#else<br />			<br />			#print&#40; &quot;Can't directly push &quot;, @string&#40; arg &#41;&#41;<br />			<br />		#endif<br />		<br />	#else<br />	<br />		#print&#40; &quot;Something else &quot;, @string&#40; arg &#41;&#41;<br />		<br />	#endif<br />	<br />#endmacro;<br /><br />procedure _proc;<br />var<br />    b &#58; byte;<br />    w &#58; word;<br />    d &#58; dword;<br />begin _proc;<br />    _push&#40; 1 &#41;;<br />    _push&#40; eax &#41;;<br />    _push&#40; dx &#41;;<br />    _push&#40; bl &#41;;<br />    _push&#40; &#40;type string edi&#41; &#41;;<br />    _push&#40; b &#41;;<br />    _push&#40; w &#41;;<br />    _push&#40; d &#41;;<br />    _push&#40; _CONST1 | _CONST2 &#41;;<br />end _proc;	<br />begin t;<br />					<br />end t;<br /></code></pre><br /><br />Cheers,<br />Randy Hyde</div>
    <div class="meta">Posted on 2003-02-03 20:56:17 by rhyde</div>
   </div>
  </div>
 </body>
</html>