<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>OBJ file format?? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17194" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=17194">OBJ file format??</a></p>
   <div class="post" id="post-133282">
    <div class="subject"><a href="#post-133282">OBJ file format??</a></div>
    <div class="body">I found some info at this link:<br /><a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dndebug/html/msdn_peeringpe.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dndebug/html/msdn_peeringpe.asp</a> <br />If you dont want to read the link:<br /><div class="quote"><br />Differences Between PE and COFF OBJ Files<br />There are two portions of the PE file that are not used by the operating system. These are the COFF symbol table and the COFF debug information. Why would anyone need COFF debug information when the much more complete CodeView information is available? If you intend to use the Windows NT system debugger (NTSD) or the Windows NT kernel debugger (KD), COFF is the only game in town. For those of you who are interested, I've included a detailed description of these parts of the PE file in the online posting that accompanies this article (available on all MSJ bulletin boards). <br /><br />At many points throughout the preceding discussion, I've noted that many structures and tables are the same in both a COFF OBJ file and the PE file created from it. Both COFF OBJ and PE files have an IMAGE_FILE_HEADER at or near their beginning. This header is followed by a section table that contains information about all the sections in the file. The two formats also share the same line number and symbol table formats, although the PE file can have additional non-COFF symbol tables as well. The amount of commonality between the OBJ and PE EXE formats is evidenced by the large amount of common code in PEDUMP (see COMMON.C on any MSJ bulletin board).<br /><br />This similarity between the two file formats isn't happenstance. The goal of this design is to make the linker's job as easy as possible. Theoretically, creating an EXE file from a single OBJ should be just a matter of inserting a few tables and modifying a couple of file offsets within the image. With this in mind, you can think of a COFF file as an embryonic PE file. Only a few things are missing or different, so I'll list them here. <br /><br />COFF OBJ files don't have an MS-DOS stub preceding the IMAGE_FILE_HEADER, nor is there a &quot;PE&quot; signature preceding the IMAGE_FILE_HEADER. <br />OBJ files don't have the IMAGE_OPTIONAL_HEADER. In a PE file, this structure immediately follows the IMAGE_FILE_HEADER. Interestingly, COFF LIB files do have an IMAGE_OPTIONAL_HEADER. Space constraints prevent me from talking about LIB files here. <br />OBJ files don't have base relocations. Instead, they have regular symbol-based fixups. I haven't gone into the format of the COFF OBJ file relocations because they're fairly obscure. If you want to dig into this particular area, the PointerToRelocations and NumberOfRelocations fields in the section table entries point to the relocations for each section. The relocations are an array of IMAGE_RELOCATION structures, which is defined in WINNT.H. The PEDUMP program can show OBJ file relocations if you enable the proper switch. <br />The CodeView information in an OBJ file is stored in two sections (.debug$S and .debug$T). When the linker processes the OBJ files, it doesn't put these sections in the PE file. Instead, it collects all these sections and builds a single symbol table stored at the end of the file. This symbol table isn't a formal section (that is, there's no entry for it in the PE's section table). <br /></div> <br />An OBJ does not have all the info an EXE has.  I figured that, the linker adds the MZ header and some other stuff.<br /><br />I've been looking through Winnt.h.  Some of the structures are defined there.<br /><br />Does anyone have any links or info for making OBJ files??<br /><br />I'm a bit confused because of stuff like this: (from above)<br /><div class="quote"><br />Both COFF OBJ and PE files have an IMAGE_FILE_HEADER at or near their beginning.<br /></div> <br />Uhhhh, okay....  Why would it not always be in the same place?<br /><br />Does anyone have the MS-COFF structure in non-tutorial format? (Broken into little bits).<br />I would like to see a basic one as it appears in memory.  Just a list of the fields.<br /><br />Thanks.</div>
    <div class="meta">Posted on 2004-02-12 08:54:33 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-133283">
    <div class="subject"><a href="#post-133283">OBJ file format??</a></div>
    <div class="body">Hi,<br /><br />here's a link collection that I've found while browsing the net, when i was studying the PE.<br /><br />Matt Pietrek (Peering inside the PE) <br /><br /><a target="_blank" href="">http://msdn.Microsoft.com/library/default.asp?url=/library/en-us/dndebug/html/msdn_peeringpe.asp</a> <br /><br /><br />Matt Pietrek: An In-Depth Look into the Win32 Portable Executable File Format <br /><br /><a target="_blank" href="">http://msdn.Microsoft.com/msdnmag/issues/02/02/pe/default.aspx</a> <br /><br /><br />Matt Pietrek: Inside Windows: An In-Depth Look into the Win32 Portable Executable File Format, Part 2 <br /><br /><a target="_blank" href="">http://msdn.Microsoft.com/msdnmag/issues/02/03/pe2/default.aspx</a> <br /><br />ICZELION PE tuts <br /><br /><a target="_blank" href="">http://spiff.tripnet.se/~iczelion/tutorials.html</a> <br /><br />LUEVELSMEYER's description about PE file format<br /><br /><a target="_blank" href="">http://spiff.tripnet.se/~iczelion/files/pe1.zip</a> <br /><br /><br />And &quot;The&quot; big archive (I think it's the bible of the PE/COFF), with everything about the PE and COFF certifications (from Microsoft.). You'll find all you want to know about the PE and the COFF file format:<br /><br />PE and COFF specifications <br /><br /><a target="_blank" href="">http://www.microsoft.com/whdc/hwdev/hardware/pecoff.mspx </a> <br /><br />Hope you'll find it interesting.<br /><br />Regards, Neitsa.</div>
    <div class="meta">Posted on 2004-02-12 09:26:47 by Neitsa</div>
   </div>
   <div class="post" id="post-133284">
    <div class="subject"><a href="#post-133284">OBJ file format??</a></div>
    <div class="body">Some additional info, the DJGPP COFF format (very very similar to ms-coff): <a target="_blank" href="http://www.delorie.com/djgpp/doc/coff/">http://www.delorie.com/djgpp/doc/coff/</a><br /><br /><div class="quote"><br />Uhhhh, okay.... Why would it not always be in the same place?<br /></div><br />Because .obj files don't have MZ stubs? :)</div>
    <div class="meta">Posted on 2004-02-12 09:43:16 by f0dder</div>
   </div>
   <div class="post" id="post-133285">
    <div class="subject"><a href="#post-133285">OBJ file format??</a></div>
    <div class="body"><div class="quote"><br />Because .obj files don't have MZ stubs? </div> <br /><br />Ahh thanks.  The way it was written did not make it clear to me.<br /><br /><div class="quote"><br />Some additional info, the DJGPP COFF format (very very similar to ms-coff):</div> <br /><br />Is it compatible?  Would an exe made from a DJGPP obj file run on Windows?</div>
    <div class="meta">Posted on 2004-02-12 11:32:07 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-133305">
    <div class="subject"><a href="#post-133305">OBJ file format??</a></div>
    <div class="body">DJGPP doesn't create PE files, and it uses a dos extender approach - but those executables do run under windows. It uses a &quot;floating-segment&quot; approach, ie not a flat memory model, to avoid relocations etc - some apps use a &quot;hack&quot; to enable flat adressing though, especially for VESA stuff, and NT doesn't like this very much ;)<br /><br />The ms-coff and djgpp-coff object formats are *almost* compatible - however, some relocation formats are handled a bit differently. One of them (iirc, ms) has DWORD 0 as the data and depends on the linker to do a full symbol fixup, while the other format has the unrelocated reference and depends on the linker to add the 'delta value' - and thus you can't link dj-coff with ms link or vice verca. It should be easy enough to write a tool to fix up the relocs, though.</div>
    <div class="meta">Posted on 2004-02-12 14:31:54 by f0dder</div>
   </div>
  </div>
 </body>
</html>