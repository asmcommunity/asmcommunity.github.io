<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Call your own export - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=8726" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=8726">Call your own export</a></p>
   <div class="post" id="post-64117">
    <div class="subject"><a href="#post-64117">Call your own export</a></div>
    <div class="body">This is something that may be interested for<br />those who are working in protection  and revercing fields.<br />This app loaded itself as dynamic lybrary which lids to<br />have to copies of the same dll at a time.<br />M$ claims that it is impossible but you can see it clearly in SoftIce.<br />The proc itself is very simple:<br />it exports one of its function (use /export:FuncName key while linking for that)<br />then in start it loaded itself as dll, and calls one of it function.(simple msgbox)<br /><br />The trick is done by making exe with long name and colling itself by short name.<br />To see results and consequences <br />1. Load it in SoftIce<br />2. after LoadLibrary call type mod - u  and see that two identical lybrary are loaded.<br /><br />What is usable about the trick and data?<br />Think about relocations.</div>
    <div class="meta">Posted on 2002-10-31 18:44:07 by The Svin</div>
   </div>
   <div class="post" id="post-64123">
    <div class="subject"><a href="#post-64123">Call your own export</a></div>
    <div class="body">Wow!  That's possible??  DLL masquerading as EXE?<br /><br />Still what about portability... maybe later Win versions won't work with this trick?</div>
    <div class="meta">Posted on 2002-10-31 20:41:27 by AmkG</div>
   </div>
   <div class="post" id="post-64130">
    <div class="subject"><a href="#post-64130">Call your own export</a></div>
    <div class="body">Works fine under XP. I used OllyDebug to view the extra module (i.e is visible to standed API's).<br /><br />I also had an idea, under XP if you name a file &quot;a .exe&quot; the short filename has some apparently handle hex digets appended to it:<br />&quot;a .exe&quot; -&gt; &quot;AFD72~1.EXE&quot;<br />&quot;3 .exe&quot; -&gt; &quot;3F5C1~1.EXE&quot;<br /><br />This just makes things slightly more confusing to anyone trying to find this &quot;extra module&quot; on disk.<br /><br />Also for compatibility issues with future versions of windows LoadLibrary will just return the module handle to the previously loaded module.<br /><br />Edit - I also wonder how windows will handle a shared segment withen the module that results in two shared segments per address space?</div>
    <div class="meta">Posted on 2002-10-31 21:14:28 by huh</div>
   </div>
   <div class="post" id="post-64172">
    <div class="subject"><a href="#post-64172">Call your own export</a></div>
    <div class="body">Privet <strong>The Svin</strong>,<br />Very interesting. What implications may it have / what advantages may it give to anti-debugging tricks et simila?<br /><br />Dosvidanja,<br />Maverick</div>
    <div class="meta">Posted on 2002-11-01 03:11:24 by Maverick</div>
   </div>
   <div class="post" id="post-64248">
    <div class="subject"><a href="#post-64248">Call your own export</a></div>
    <div class="body">Hmmmmm.  Weeeird.  I bet you could also use this for the &quot;remove file after run&quot; trick.<br />on getting a WM_CLOSE message call an exported function to remove exe file on disk<br />in a loop until it works and then exit...</div>
    <div class="meta">Posted on 2002-11-01 11:59:55 by Graebel</div>
   </div>
   <div class="post" id="post-64260">
    <div class="subject"><a href="#post-64260">Call your own export</a></div>
    <div class="body"><div class="quote"><br />Privet <strong>The Svin</strong>,<br />Very interesting. What implications may it have / what advantages may it give to anti-debugging tricks et simila?<br /><br />Dosvidanja,<br />Maverick </div><br />Vivat, Fabio!<br />Relocations as I said.<br />Data and code managed by export function would have different addrs. Though they would come from the same exe file.<br />+<br />Having to copies of the same data initialized (the same in file)<br />you have instrument to disorient hacker from finding offset of it in the file. There are many ideas that can come from it: for example you can do one thing with the data in<br />first proc and different with copy of the exe loaded as library. I'm sure you can in a time show us some new ideas coming from it. :)<br />My task was just to show interface of it and point out that we can have 2 copies of library that have the same name. Wich many Win32 programmers consider impossible.</div>
    <div class="meta">Posted on 2002-11-01 15:18:05 by The Svin</div>
   </div>
   <div class="post" id="post-64267">
    <div class="subject"><a href="#post-64267">Call your own export</a></div>
    <div class="body">I see. :alright:<br />Glad to see you're back with several posts lately, I hope it's not only a parenthesis. :)<br /><br />Take Care!<br />Maverick</div>
    <div class="meta">Posted on 2002-11-01 16:19:37 by Maverick</div>
   </div>
   <div class="post" id="post-64409">
    <div class="subject"><a href="#post-64409">Call your own export</a></div>
    <div class="body"><div class="quote"><br /><br />I see. :alright:<br />Glad to see you're back with several posts lately, I hope it's not only a parenthesis. :)<br /><br />Take Care!<br />Maverick </div><br />Thank you.<br />I've started thinking of writing a book(or books ? :)), so if I have money for inet I'm going post some material from it for discussion here frequently.</div>
    <div class="meta">Posted on 2002-11-02 18:59:51 by The Svin</div>
   </div>
   <div class="post" id="post-64449">
    <div class="subject"><a href="#post-64449">Call your own export</a></div>
    <div class="body">Privet <strong>Alex</strong>,<br />Interesting.. a book about coding? I'll be glad to join the discussion when it's time to. ;)</div>
    <div class="meta">Posted on 2002-11-03 02:57:50 by Maverick</div>
   </div>
   <div class="post" id="post-82355">
    <div class="subject"><a href="#post-82355">Call your own export</a></div>
    <div class="body">I forgot to say that to use distracing relocation effect while calling your own export the exe need to be linked with FIXED:NO option. Otherwise relocation section would be stripped.</div>
    <div class="meta">Posted on 2003-02-17 17:43:16 by The Svin</div>
   </div>
   <div class="post" id="post-82587">
    <div class="subject"><a href="#post-82587">Call your own export</a></div>
    <div class="body">I'll try a Hook function as normally should be in a &quot;separate&quot; DLL ;)</div>
    <div class="meta">Posted on 2003-02-19 06:39:15 by KaSt</div>
   </div>
   <div class="post" id="post-82653">
    <div class="subject"><a href="#post-82653">Call your own export</a></div>
    <div class="body"><div class="quote"><br />Wow!  That's possible??  DLL masquerading as EXE?<br /><br />Still what about portability... maybe later Win versions won't work with this trick? </div>It's actually a pretty old trick. In Win16, the three core DLLs are called KERNEL.EXE, GDI.EXE, and USER.EXE.<br /><br />I believe all OCX files are DLLs. However, because they're COM modules, it's possible that some are EXE files.<br /><br />If LoadLibrary can use any valid file name to load a DLL, there is no portability problem. It will need to do some checking of the PE file for validity, in any case.<br /><br /><div class="quote"><br />My task was just to show interface of it and point out that we can have 2 copies of library that have the same name. Wich many Win32 programmers consider impossible. </div>Which means there is still some old Win16 knowledge hanging around. It's definitely true in Win16 that you can't load two different DLLs with the same name, unless the first is completely unloaded beforehand.</div>
    <div class="meta">Posted on 2003-02-19 14:02:50 by tenkey</div>
   </div>
   <div class="post" id="post-82657">
    <div class="subject"><a href="#post-82657">Call your own export</a></div>
    <div class="body">I think the point was having an Exe with Exports, that can be used as a DLL. This is at least what I understood.</div>
    <div class="meta">Posted on 2003-02-19 14:28:45 by KaSt</div>
   </div>
   <div class="post" id="post-82662">
    <div class="subject"><a href="#post-82662">Call your own export</a></div>
    <div class="body">Awsome Thread/Idea The Svin<br /><br />I had more fun playing around with this than iv'e had in a long time lol...... hmmmm uhoh.  any way <br />I find....<br />You can Load it into itself with no problems whatsoever.<br />You can call you exports from yourself with 0 issues<br /><br />You can load and call the exports from ANY app AS LONG AS YOUR EXPORTS MAKE NO API CALLS<br /><br />The Import table does not get filled in when you call LoadLibrary to load it, this is not a problem in your own process<br />as the import table is alread filled in and your &quot;DLL/EXE&quot; uses an identical Import table as youe EXE/EXE<br />also, I do not think you have to use the short DOS name to load it as a dll, I think it will load anyway.<br /><br />I'm not sure but I dont think LoadLibrary fills in the import table EVER when you use it to load an EXE this is probably<br />because it would endup overwriteing the calling APP's import table and all hell would break lose :)<br /><br />I'm not adverse to being corected if im wrong, this is just what I have observer playing around with it. <br />Personally  I LOVE the idea of makeing an EXE that has also has some fuunctions EXPORTED so that other people can use them .  :)<br /> to bad I can't If i make API calls :alright:<br /><br /><br />As Far as an EXE masqueradeing as a dll... well it's better to make a dll and edit the header to have it masquerade as an exe lol</div>
    <div class="meta">Posted on 2003-02-19 15:41:11 by dionysus</div>
   </div>
  </div>
 </body>
</html>