<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>PCIe bandwith - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20846" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=20846">PCIe bandwith</a></p>
   <div class="post" id="post-158487">
    <div class="subject"><a href="#post-158487">PCIe bandwith</a></div>
    <div class="body">Hi there,<br /><br />started to check out the bandwith to/from my PCIe-card (ATI x800xt) - with some disappointing results:<br /><br /><br />--------------------------------------<br /><br />;P4 3.2GHz HT, ATI_x800xt PCIe - Messergebnisse:? ?(LU=LoopUnroll)<br />;===============================================<br />;<br /><br />; Read from videomem (1024x768x32, x800xt)? ? Write to videomem<br />; ----------------------------------------? ? -----------------<br />;<br />;mov al,, 2MB, LU=1 :? ?GB/s? ? ? ? ?;mov ,al,? 2MB, LU=1 : 1.31 GB/s<br />;mov al,, 2MB, LU=2 :? ?GB/s? ? ? ? ?;mov ,al,? 2MB, LU=2 : 1.31 GB/s<br />;mov al,, 2MB, LU=4 :? ?GB/s? ? ? ? ?;mov ,al,? 2MB, LU=4 : 1.31 GB/s<br />;mov al,, 2MB, LU=8 :? ?GB/s? ? ? ? ?;mov ,al,? 2MB, LU=8 : 1.31 GB/s<br />;mov al,, 2MB, LU=16:? ?GB/s? ? ? ? ?;mov ,al,? 2MB, LU=16: 1.31 GB/s<br />;<br />;mov ax,, 2MB, LU=1 :? ?GB/s? ? ? ? ?;mov ,ax,? 2MB, LU=1 : 1.31 GB/s<br />;mov ax,, 2MB, LU=2 :? ?GB/s? ? ? ? ?;mov ,ax,? 2MB, LU=2 :? ?GB/s<br />;mov ax,, 2MB, LU=4 :? ?GB/s? ? ? ? ?;mov ,ax,? 2MB, LU=4 :? ?GB/s<br />;mov ax,, 2MB, LU=8 :? ?GB/s? ? ? ? ?;mov ,ax,? 2MB, LU=8 :? ?GB/s<br />;mov ax,, 2MB, LU=16:? ?GB/s? ? ? ? ?;mov ,ax,? 2MB, LU=16:? ?GB/s<br />;<br />;mov eax,, 2MB, LU=1 :? ?0.008 GB/s? ;mov ,eax,? 2MB, LU=1 : 1.31 GB/s<br />;mov eax,, 2MB, LU=2 :? ?GB/s? ? ? ? ;mov ,eax,? 2MB, LU=2 :? ?GB/s<br />;mov eax,, 2MB, LU=4 :? ?GB/s? ? ? ? ;mov ,eax,? 2MB, LU=4 :? ?GB/s<br />;mov eax,, 2MB, LU=8 :? ?GB/s? ? ? ? ;mov ,eax,? 2MB, LU=8 :? ?GB/s<br />;mov eax,, 2MB, LU=16:? ?GB/s? ? ? ? ;mov ,eax,? 2MB, LU=16:? ?GB/s<br />;<br />;movq mm0,, 2MB, LU=1 :? 0.015 GB/s? ;movq ,mm0,? 2MB, LU=1 : 1.31 GB/s<br />;movq mm0,, 2MB, LU=2 :? ?GB/s? ? ? ?;movq ,mm0,? 2MB, LU=2 :? ?GB/s<br />;movq mm0,, 2MB, LU=4 :? ?GB/s? ? ? ?;movq ,mm0,? 2MB, LU=4 :? ?GB/s<br />;movq mm0,, 2MB, LU=8 :? ?GB/s? ? ? ?;movq ,mm0,? 2MB, LU=8 :? ?GB/s<br />;movq mm0,, 2MB, LU=16:? ?GB/s? ? ? ?;movq ,mm0,? 2MB, LU=16:? ?GB/s<br />;<br />;movaps xmm0,, 2MB,LU=1 : 0.016 GB/s ;movaps ,xmm0,? 2MB, LU=1 : 1.31 GB/s<br />;movaps xmm0,, 2MB,LU=2 : 0.016 GB/s ;movaps ,xmm0,? 2MB, LU=2 : 1.31 GB/s<br />;movaps xmm0,, 2MB,LU=4 :? ?GB/s? ? ?;movaps ,xmm0,? 2MB, LU=4 :? ?GB/s<br />;movaps xmm0,, 2MB,LU=8 :? ?GB/s? ? ?;movaps ,xmm0,? 2MB, LU=8 :? ?GB/s<br />;movaps xmm0,, 2MB,LU=16:? ?GB/s? ? ?;movaps ,xmm0,? 2MB, LU=16:? ?GB/s<br />;<br /><br /><br />; Read from memory? ? ? ? ? ? ? ? ? ? ? ? ? ? ?Write to memory<br />; ----------------? ? ? ? ? ? ? ? ? ? ? ? ? ? ?---------------<br />;<br />;mov al,, 20MB, LU=1 :? 1.14 GB/s? ? ? ?;mov ,al,? 20MB, LU=1 :? 1.69 GB/s<br />;mov al,, 40MB, LU=2 :? 1.72 GB/s? ? ? ?;mov ,al,? 40MB, LU=2 :? 1.75 GB/s<br />;mov al,, 80MB, LU=4 :? 1.85 GB/s? ? ? ?;mov ,al,? 80MB, LU=4 :? 1.73 GB/s<br />;mov al,, 80MB, LU=8 :? 2.09 GB/s? ? ? ?;mov ,al,? 80MB, LU=8 :? 1.74 GB/s<br />;mov al,, 80MB, LU=16:? 2.07 GB/s? ? ? ?;mov ,al,? 80MB, LU=16:? 1.72 GB/s<br />;<br />;mov ax,, 40MB, LU=1 :? 2.19 GB/s? ? ? ?;mov ,ax,? 40MB, LU=1 :? 1.87 GB/s<br />;mov ax,, 80MB, LU=2 :? 3.09 GB/s? ? ? ?;mov ,ax,? 80MB, LU=2 :? 1.86 GB/s<br />;mov ax,, 80MB, LU=4 :? 3.37 GB/s? ? ? ?;mov ,ax,? 80MB, LU=4 :? 1.86 GB/s<br />;mov ax,, 80MB, LU=8 :? 3.35 GB/s? ? ? ?;mov ,ax,? 80MB, LU=8 :? 1.87 GB/s<br />;mov ax,, 80MB, LU=16:? 3.33 GB/s? ? ? ?;mov ,ax,? 80MB, LU=16:? 1.86 GB/s<br />;<br />;mov eax,, 80MB, LU=1 : 3.81 GB/s? ? ? ?;mov ,eax,? 80MB, LU=1 : 1.86 GB/s<br />;mov eax,, 80MB, LU=2 : 3.88 GB/s? ? ? ?;mov ,eax,? 80MB, LU=2 : 1.87 GB/s<br />;mov eax,, 80MB, LU=4 : 3.90 GB/s? ? ? ?;mov ,eax,? 80MB, LU=4 : 1.87 GB/s<br />;mov eax,, 80MB, LU=8 : 3.89 GB/s? ? ? ?;mov ,eax,? 80MB, LU=8 : 1.87 GB/s<br />;mov eax,, 80MB, LU=16: 3.90 GB/s? ? ? ?;mov ,eax,? 80MB, LU=16: 1.86 GB/s<br />;<br />;movq mm0,, 80MB, LU=1 : 4.14 GB/s? ? ? ;movq ,mm0,? 80MB, LU=1 : 1.86 GB/s<br />;movq mm0,, 80MB, LU=2 : 4.16 GB/s? ? ? ;movq ,mm0,? 80MB, LU=2 : 1.86 GB/s<br />;movq mm0,, 80MB, LU=4 : 4.16 GB/s? ? ? ;movq ,mm0,? 80MB, LU=4 : 1.86 GB/s<br />;movq mm0,, 80MB, LU=8 : 4.16 GB/s? ? ? ;movq ,mm0,? 80MB, LU=8 : 1.86 GB/s<br />;movq mm0,, 80MB, LU=16: 4.16 GB/s? ? ? ;movq ,mm0,? 80MB, LU=16: 1.86 GB/s<br />;<br />;movaps xmm0,, 80MB, LU=1 : 4.74 GB/s? ?;movaps ,xmm0,? 80MB, LU=1 : 1.85 GB/s<br />;movaps xmm0,, 80MB, LU=2 : 4.76 GB/s? ?;movaps ,xmm0,? 80MB, LU=2 : 1.85 GB/s<br />;movaps xmm0,, 80MB, LU=4 : 4.76 GB/s? ?;movaps ,xmm0,? 80MB, LU=4 : 1.85 GB/s<br />;movaps xmm0,, 80MB, LU=8 : 4.76 GB/s? ?;movaps ,xmm0,? 80MB, LU=8 : 1.85 GB/s<br />;movaps xmm0,, 80MB, LU=16: 4.76 GB/s? ?;movaps ,xmm0,? 80MB, LU=16: 1.85 GB/s<br /><br />--------------------------------------<br /><br />I must do something wrong?!<br />Reading from videomem (dword) only 8MB/s !?!<br />Max. should be 4GB/s to/from videomemory ?!<br /><br />VShader<br /><br /></div>
    <div class="meta">Posted on 2005-03-28 04:08:04 by VShader</div>
   </div>
   <div class="post" id="post-158496">
    <div class="subject"><a href="#post-158496">Re: PCIe bandwith</a></div>
    <div class="body"><br />&nbsp; I had heard that no videocard vendor is using the full power of PCIe yet.&nbsp; Both ATI and Nvidia did it differently but neither one has&nbsp; a part that can use the full potential of PCIe.&nbsp; I don&#39;t know how much of&nbsp; difference it will make when they do it, because the way most games work is they send all the data for the level you are about to play at the start of the level.&nbsp; And then you do the operations on the data in the videocard.&nbsp; That&#39;s why if you&#39;ve ever seen video game tests comparing AGP, AGP 2x and AGP 4x you hardly see any FPS difference in the different modes.&nbsp; I think going from AGP to AGP4x gives a 8% gain in performance, if that.&nbsp; Games were written to take advantage of the fact that there isn&#39;t much bandwidth, and so they try to send as much data as they can at the start of each level.&nbsp; As a side note, reads from video memory have always been really expensive.&nbsp; So the fact that your reads were a lot slower for video memory was no surprise to me.&nbsp; </div>
    <div class="meta">Posted on 2005-03-28 09:37:45 by mark_larson</div>
   </div>
   <div class="post" id="post-158497">
    <div class="subject"><a href="#post-158497">Re: PCIe bandwith</a></div>
    <div class="body">Even when video card manufacturers start utilizing PCIe properly, readbacks will probably remain slow when operating in 3D mode, as you have to &quot;sync up&quot; the pipelines. Just a guess, of course.<br /><br />It wouldn&#39;t surprise me if the current PCIe cards work more or less as AGP cards right now, just like the early AGP cards where basically PCI cards with a different interface.<br /></div>
    <div class="meta">Posted on 2005-03-28 10:26:02 by f0dder</div>
   </div>
   <div class="post" id="post-158501">
    <div class="subject"><a href="#post-158501">Re: PCIe bandwith</a></div>
    <div class="body">Hehe,<br /><br />my first hope for PCIe was:<br /><br />6.4 GB/s to main memory + 4 GB/s TO vidmem + (simultaneous) 4 GB/s FROM vidmem<br />= 14.4 GB/s bandwith.<br /><br />Then I realized that in P4-architecture everything has to go through (south?)-bridge -&gt; so then max.? 6.4 GB/s.<br />(Perhaps the 14.4 GB/s could be theoretically possible on AMD64).<br /><br />But only 16 MB/s from videomem is disapointing.<br /><br />I am for sure not complaining about the power of the x800xt, but I hoped to do some crunching with the GPU (pixelshader) and then read it back, but this is with only 16 MB/s (only 0.4% of theoretical max.) obsolete.<br /><br />Perhaps I can sue someone for misleading marketing? :P<br /><br /><br />VShader<br /></div>
    <div class="meta">Posted on 2005-03-28 16:08:59 by VShader</div>
   </div>
   <div class="post" id="post-158513">
    <div class="subject"><a href="#post-158513">Re: PCIe bandwith</a></div>
    <div class="body">Btw, could you post the source of your test program here? I have a AMD64 with a GeForce 6600 PCIe card, might be interesting to see which speeds I get?<br /></div>
    <div class="meta">Posted on 2005-03-29 07:52:16 by f0dder</div>
   </div>
   <div class="post" id="post-158526">
    <div class="subject"><a href="#post-158526">Re: PCIe bandwith</a></div>
    <div class="body">&gt;&gt; Btw, could you post the source of your test program here? <br /><br />Yes, of course. <br /><br />I put it on my &quot;homepage&quot; (scroll down).<br /><br />http://rz-home.de/~eugen/<br /><br />I did it in my 3D-engine (no development for the last half year - going from P200mmx to P4_HT_3.2Ghz+ATIx800xt opens a world of cheap and cool games  , ... but I think I start coding again soon. ).<br /><br />There is the complete engine with source (newest version).<br />Full 3D-Clipping and with DSound/DInput<br />Cleaned up and translated.<br />I used masm V6.15.8803 for sse2 instructions (but test can run on pentium too)<br />Search for ?bandwidthtests&quot; in the code.<br />Change parameters in the block ?All you have to change&quot; for read/write-tests (CAUTION: max.blocksize!).<br />Toggle Info-overlay with F2.<br />Additional info about the engine in the thread ?Quickk reference to MMX/SSE/SSE2 ...&quot;<br />The DebugIt-block is normally empty and gets moved around in the sourcecode for quick debugging.<br /><br /><br />The read/write-instructions are straight forward - unrolled mov(1..4bytes)/movq(8bytes)/movaps(16bytes)-instructions with a little bit help of macros? ?- perhaps there are faster ways (let me know!) but on P4 there is a hardware data prefetcher which automatically kicks in when you read/write in regular patterns - which here is the case.<br /><br /><br />I don?t give up on a faster version of reading back from vidmem via PCIe yet - If anyone has a clue let me please know (dma?, special DirectX-functions?, special way of allocating a buffer in vidmem instead of reading from backbuffer?). <br />It would be too cool to utilize the 22 (6 vertex-engines and 16 pixelengines) floating-point-cores in the GPU @ 500MHz with 32GB/s bandwidth (physics!). <br /><br />Btw: Hi bitrake! This version includes the fully working octree (mmx-accelerated) !! (hehe, I have to look deeply to understand it in detail myself now ... but it works stable and fast (I think, have no other code to compare).<br />I am planning to keep this octree with (sse2 enhanced)-integer-simd and change the transforming/clipping to sse-float-simd - should be the best combination. It should work to check the octree-spheres in (4x)16bit integer-math but then do the clipping in (4x)float32 and it should be possible to adjust the integer-resolution so the world can be much bigger but still fast and compact mmx(/mmx2)-octree-vf-culling. <br /><br />VShader<br /></div>
    <div class="meta">Posted on 2005-03-29 13:09:49 by VShader</div>
   </div>
   <div class="post" id="post-158534">
    <div class="subject"><a href="#post-158534">Re: PCIe bandwith</a></div>
    <div class="body">&quot;mmx3d_200503.zip&quot; crashes every time on my P4, GF4 Ti 4200, WinXP PRO SP2.<br /><br />eax=00000000 ebx=00000000 ecx=00000000 edx=00241a11 esi=0000010b edi=00d7f840<br />eip=0040744b esp=0012ff44 ebp=0012ff84 iopl=0&nbsp; &nbsp; &nbsp; &nbsp;  nv up ei pl zr na po nc<br />cs=001b&nbsp; ss=0023&nbsp; ds=0023&nbsp; es=0023&nbsp; fs=003b&nbsp; gs=0000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  efl=00000246<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; 00407436 eb0a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jmp&nbsp; &nbsp;  MMX3D+0x7442 (00407442)<br />&nbsp; &nbsp; &nbsp; &nbsp; 00407438 0f7f2c8f&nbsp; &nbsp; &nbsp; &nbsp;  movq&nbsp; &nbsp; qword ptr ,mm5<br />&nbsp; &nbsp; &nbsp; &nbsp; 0040743c 83eb02&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  sub&nbsp; &nbsp;  ebx,0x2<br />&nbsp; &nbsp; &nbsp; &nbsp; 0040743f 83c102&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  add&nbsp; &nbsp;  ecx,0x2<br />&nbsp; &nbsp; &nbsp; &nbsp; 00407442 83fb01&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  cmp&nbsp; &nbsp;  ebx,0x1<br />&nbsp; &nbsp; &nbsp; &nbsp; 00407445 7df1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jge&nbsp; &nbsp;  MMX3D+0x7438 (00407438)<br />&nbsp; &nbsp; &nbsp; &nbsp; 00407447 0bdb&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  or&nbsp; &nbsp; &nbsp; ebx,ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; 00407449 7504&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jnz&nbsp; &nbsp;  MMX3D+0x744f (0040744f)<br />------&gt;0040744b 0f7e2c8f&nbsp; &nbsp; movd dword ptr ,mm5 ds:0023:00d7f840=????????<br />&nbsp; &nbsp; &nbsp; &nbsp; 0040744f 4e&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dec&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; 00407450 0ffef7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  paddd&nbsp;  mm6,mm7<br />&nbsp; &nbsp; &nbsp; &nbsp; 00407453 033df44d4100&nbsp; &nbsp;  add&nbsp; &nbsp;  edi,<br />&nbsp; &nbsp; &nbsp; &nbsp; 00407459 83fe00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  cmp&nbsp; &nbsp;  esi,0x0<br />&nbsp; &nbsp; &nbsp; &nbsp; 0040745c 7dad&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jge&nbsp; &nbsp;  MMX3D+0x740b (0040740b)<br />&nbsp; &nbsp; &nbsp; &nbsp; 0040745e 90&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  nop<br />&nbsp; &nbsp; &nbsp; &nbsp; 0040745f 0f6f1424&nbsp; &nbsp; &nbsp; &nbsp;  movq&nbsp; &nbsp; mm2,qword ptr <br />&nbsp; &nbsp; &nbsp; &nbsp; 00407463 83c408&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  add&nbsp; &nbsp;  esp,0x8<br />&nbsp; &nbsp; &nbsp; &nbsp; 00407466 90&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  nop<br /><br /><br />ChildEBP RetAddr&nbsp; Args to Child&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />0012ff84 00401ebb 0f360040 0f1353a0 00000134 MMX3D+0x744b<br />0012ff98 00401194 00000005 00000012 0000031a MMX3D+0x1ebb<br />0012ffb8 00410174 001406a2 7c816d4f 80000001 MMX3D+0x1194<br />0012fff0 00000000 004100ce 00000000 78746341 MMX3D+0x10174<br /><br /><br />stack:<br />000000000012ff44&nbsp; 00 00 b8 08 c7 51 ff 7f - 00 00 84 4b 1a 53 ff 7f&nbsp; .....Q.....K.S..<br />000000000012ff54&nbsp; 00 00 8b 4b e2 52 ff 7f - 38 5d 13 0f 40 6e e8 00&nbsp; ...K.R..8]..@n..<br />000000000012ff64&nbsp; 40 00 36 0f 7c ff 12 00 - 88 3a 36 0f 2e 01 00 00&nbsp; @.6.|....:6.....<br />000000000012ff74&nbsp; 00 00 00 00 ae 18 d3 6b - 11 1a 24 00 98 ff 12 00&nbsp; .......k..$.....<br />000000000012ff84&nbsp; 98 ff 12 00 bb 1e 40 00 - 40 00 36 0f a0 53 13 0f&nbsp; ......@.@.6..S..<br />000000000012ff94&nbsp; 34 01 00 00 b8 ff 12 00 - 94 11 40 00 05 00 00 00&nbsp; 4.........@.....<br />000000000012ffa4&nbsp; 12 00 00 00 1a 03 00 00 - 46 02 00 00 60 00 00 00&nbsp; ........F...`...<br />000000000012ffb4&nbsp; 24 03 41 00 f0 ff 12 00 - 74 01 41 00 a2 06 14 00&nbsp; $.A.....t.A.....<br />000000000012ffc4&nbsp; 4f 6d 81 7c 01 00 00 80 - 8c da da 00 00 b0 fd 7f&nbsp; Om.|............</div>
    <div class="meta">Posted on 2005-03-29 18:17:23 by ti_mo_n</div>
   </div>
   <div class="post" id="post-158559">
    <div class="subject"><a href="#post-158559">Re: PCIe bandwith</a></div>
    <div class="body">ti_mo_n ,<br /><br />this is in the scanline-filler (.exe was assembled with 32 bit color-depth and mmx-writes to videomem.)<br /><br />I added (sorry) the necessary include/lib-files and a assemble/link-batchfile on my homepage to &quot;mmx3d_200503.zip&quot; so you now have a realistic chance to succesfully assemble and link the program.<br />Change in the sourcecode to 16 bit (search for &quot;BytesPerPixel&quot; -&gt; from 4 to 2 ) and assemble again.<br />The programm allocs a 100MB-block for memtest (&quot;P4MemTestBuffer&quot;) -&gt; you should kill this if you only want the 3D-engine.<br />Or if you don&#39;t want to assemble again take the mmy3d.exe from the version above on my homepage.<br /><br /><br />VShader<br /></div>
    <div class="meta">Posted on 2005-03-30 07:07:53 by VShader</div>
   </div>
   <div class="post" id="post-158560">
    <div class="subject"><a href="#post-158560">Re: PCIe bandwith</a></div>
    <div class="body">;The fastest transferrates so far on my P4,PCIe:<br />;----------------------------------------------------------<br />;read vidmem:<br />;movaps xmm0,, 2MB, LU=2 : 0.016 GB/s<br />;write vidmem:<br />;movaps ,xmm0,? 2MB, LU=2 : 1.31 GB/s<br /><br />;read mem:<br />;movaps xmm0,, 80MB, LU=2 : 4.76 GB/s<br />;write mem:<br />;movaps ,xmm0,? 80MB, LU=2 : 1.85 GB/s<br /><br />VShader</div>
    <div class="meta">Posted on 2005-03-30 07:12:39 by VShader</div>
   </div>
   <div class="post" id="post-158572">
    <div class="subject"><a href="#post-158572">Re: PCIe bandwith</a></div>
    <div class="body">&nbsp; I saw that you were using MOVAPS to write data to memory.&nbsp; Look at doing MOVNTPS instead if you have 1-2 MB or larger buffer.&nbsp; It&#39;s faster for large buffer sizes.&nbsp; Experiment with your code and find out at what buffer size MOVNTPS gets faster than MOVAPS.&nbsp; MOVNTPS writes directly to memory and never updates the cache.&nbsp; It usually gets faster than MOVAPS on my P4 with a 1-2MB buffer size.<br /><br />&nbsp; Actually now that I think about it, using MOVNTPS might not give you a speed up at all, since the buffer is in video memory.&nbsp; It&#39;d be curious to see you run this test with a 4MB buffer and try both MOVAPS and MOVNTPS and see what the speed difference is.&nbsp; Technically if the buffer is in video memory, the processor shouldn&#39;t cache it.&nbsp; But I am not sure how they set it up.&nbsp; If they do cache it, then MOVNTPS should be faster at some point.</div>
    <div class="meta">Posted on 2005-03-30 10:35:24 by mark_larson</div>
   </div>
   <div class="post" id="post-158576">
    <div class="subject"><a href="#post-158576">Re: PCIe bandwith</a></div>
    <div class="body"><div class="quote">Or if you don&#39;t want to assemble again take the mmy3d.exe from the version above on my homepage.</div><br />You meant &quot;mmx3d.zip&quot;? ..eh sorry, but i really dont have the time to play with this. i just wanted to run it, and see what it does. never mind that. anyways - mmx3d.zip crashes too.<br /><br /><span style="font-size:10pt><div class="quote">eax=00000058 ebx=00000000 ecx=0b000000 edx=bdc0bdc0 esi=00000003 edi=00d7fa00<br />eip=004071a0 esp=0012ff54 ebp=0012ff84 iopl=0&nbsp; &nbsp; &nbsp; &nbsp;  nv up ei pl zr na po nc<br />cs=001b&nbsp; ss=0023&nbsp; ds=0023&nbsp; es=0023&nbsp; fs=003b&nbsp; gs=0000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  efl=00000246<br /><br />004071a0 66891447&nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp;  ,dx&nbsp; &nbsp; &nbsp; &nbsp; ds:0023:00d7fab0=????</div></span><br /><br />...since i cant just run it and see - i&#39;ll leave it alone :]</div>
    <div class="meta">Posted on 2005-03-30 12:11:46 by ti_mo_n</div>
   </div>
   <div class="post" id="post-158580">
    <div class="subject"><a href="#post-158580">Re: PCIe bandwith</a></div>
    <div class="body">mark_larson, you are the man!<br /><br />moving the backbuffer to ram should bring roughly 3 times the speed in actual engine!<br />Speedincrease for untouched ram with movntps is cool too!<br /><br />;P4 Prescott 1MB Cache<br />;<br />;vidmem write<br />;-------------<br />;movaps? ,xmm0,? 1MB, LU=4 :? ? ?1.31 GB/s<br />;movntps ,xmm0,? 1MB, LU=4 :? ? ?1.32 GB/s<br />;<br />;movaps? ,xmm0,? 0.614MB, LU=4 :? 1.32 GB/s? (640x480x16 Buffer in VIDram)<br />;movntps ,xmm0,? 0.614MB, LU=4 :? 1.32 GB/s? (640x480x16 Buffer in VIDram)<br /><br /><br />;mem write<br />;-------------<br />;movaps? ,xmm0,? 80MB, LU=4 :? ? ?1.75 GB/s<br />;movntps ,xmm0,? 80MB, LU=4 :? ? ?4.25 GB/s? :-)<br />;<br />;movaps? ,xmm0,? 0.2MB, LU=4 :? ? ?8.47 GB/s? &lt;= Should make sense<br />;movntps ,xmm0,? 0.2MB, LU=4 :? ? ?4.22 GB/s<br />;<br />;movaps? ,xmm0,? 0.4MB, LU=4 :? ? ?6.84 GB/s<br />;movntps ,xmm0,? 0.4MB, LU=4 :? ? ?4.26 GB/s<br />;<br />;movaps? ,xmm0,? 0.614MB, LU=4 :? ?4.38 GB/s? (640x480x16 Buffer in ram)<br />;movntps ,xmm0,? 0.614MB, LU=4 :? ?4.23 GB/s? (640x480x16 Buffer in ram)<br /><br /><br />movaps in a memory-backbuffer seems to make sense. Transfering the final image at 80 Hz to vidmem eats only 3,78% -&gt; overdraw in (cached) ram is much cheaper.<br /><br />VShader<br /></div>
    <div class="meta">Posted on 2005-03-30 13:55:57 by VShader</div>
   </div>
   <div class="post" id="post-158614">
    <div class="subject"><a href="#post-158614">Re: PCIe bandwith</a></div>
    <div class="body"><div class="quote"><br />mark_larson, you are the man!<br /><br /></div><br /><br />&nbsp; Just buy me some brownies, if we ever meet ;) ;) ;) heheee<br /><br /></div>
    <div class="meta">Posted on 2005-03-31 12:54:09 by mark_larson</div>
   </div>
  </div>
 </body>
</html>