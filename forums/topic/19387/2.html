<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>3D Scene - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=19387" />
  <link rel="prev" href="../?id=19387&amp;page=1" />  <link rel="next" href="../?id=19387&amp;page=3" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=19387">3D Scene</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=19387&amp;page=1" style="">&laquo;</a><a href="../?id=19387&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="19387" /><input type="number" name="page" min="1" max="3" step="1" value="2" onchange="this.form.submit();" /><a href="../?id=19387&amp;page=3">&gt;</a><a href="../?id=19387&amp;page=3">&raquo;</a></form>   <div class="post" id="post-150091">
    <div class="subject"><a href="#post-150091">3D Scene</a></div>
    <div class="body">Another way of thinking about this stuff is that the concatenated matrix (from now on we call it the object matrix, k?) is a way for us to &quot;move from world space to object space&quot;... <br />Once we've applied our objectmatrix as the current world xform, we have effectively entered object space - everything we do now is totally relative to the position/orientation/scale of the object, instead of the world origin. For example if we have entered object space, and we then tried to draw another object, its position and rotation would be relative to the first one.<br />To get back to world space, we could either restore the matrices we stored prior to rending each object, or just apply an Identity matrix as the current world xform, which has the effect of resetting it.<br />We could consider that the first object is Parent to the second object, because if we now move the first object around in the world, the second one will move with it (since its relative).<br />Likewise, we could consider the the second object is a Child of the first object.<br />We could say that the Child has a different Frame Of Reference to the Parent, that the Child's Origin depends on the Parent's Origin, etc.<br />I may be getting a little ahead, but it makes good brainfood.<br />When you start to read about Frames later, this is what they are talking about, not animation cell frames, but rather frames of reference, and relative objects (relative position, relative rotation etc - it's all just a matter of nesting the call to render the object, nothing hard to code)</div>
    <div class="meta">Posted on 2004-09-21 01:56:15 by Homer</div>
   </div>
   <div class="post" id="post-150229">
    <div class="subject"><a href="#post-150229">3D Scene</a></div>
    <div class="body">Afternoon, gallo.<br /><br />Check out the following thread:<br /><a target="_blank" href="http://www.asmcommunity.net/board/viewtopic.php?t=16454">http://www.asmcommunity.net/board/viewtopic.php?t=16454</a><br /><br />Every object in the world has its own &quot;World&quot; matrix. The &quot;World&quot; matrix is the matrix telling DX where the centre of the &lt;about-to-be-rendered&gt; object is *in* the world. It *isn't* the world's matrix.  :shock:  :-D <br /><br />This means you *don't* have to save/restore it every time you want to render something.<br />You just have to remember that each object *must* have it's own World matrix which is set just before rendering that object.<br /><br />When it comes to the Camera matrix (the View matrix), you can pretty much treat it like any other object, except there's an extra step when setting up the matrices.<br /><br />I don't bother with quarternions, as there ends up being about the same number of calculations/ code involved as with using the vector/matrix calculations.<br /><br />Cheers,<br />Scronty</div>
    <div class="meta">Posted on 2004-09-22 21:50:23 by Scronty</div>
   </div>
   <div class="post" id="post-150272">
    <div class="subject"><a href="#post-150272">3D Scene</a></div>
    <div class="body"><div class="quote">I don't bother with quarternions, as there ends up being about the same number of calculations/ code involved as with using the vector/matrix calculations.</div><br /><br />in fact is all math nothing more than just some very basic operations. but, quaternions are an explanation of what you are actually doing. and they are the solution to rotate around an arbitrary axis, which is a must if you write something more than an average first person shooter.</div>
    <div class="meta">Posted on 2004-09-23 12:24:06 by lifewire</div>
   </div>
   <div class="post" id="post-150306">
    <div class="subject"><a href="#post-150306">3D Scene</a></div>
    <div class="body">It's possible to define matrices to rotate about arb axes also - and rather hard to use quats to do anything EXCEPT rotate - however, quats can be faster (as I've said before), and they are inherently better at coping with something called Gimbal Lock - they don't suffer from it.</div>
    <div class="meta">Posted on 2004-09-24 02:28:07 by Homer</div>
   </div>
   <div class="post" id="post-150380">
    <div class="subject"><a href="#post-150380">3D Scene</a></div>
    <div class="body">hello and sorry for being absent but in school we had a sort of tests :-D ,<br /><br />thanks to EvilHomer2k and to Scronty for your help :alright: ,<br />but something wierd happened, i did a little drawing to make my problem a little clearer, imagine that this object is been seen from the right side:<br />(i think the image should appear below)<br />well as you can see in the image, what is happening is that after the object has been rotated, it just moves forward and not to the object's direction how i thought it'd be if i use matrices....so what is happening is correct or it should be how i wanted and i'm doing something wrong....<br /><br />and something more, Scronty i downloaded your &quot;fly&quot; proggy and it's very very impressive, if you saw the picture i post, i'll notice that what i need it's basically what the red-buggy does...so may be you can please help me :oops: <br /><br />thanks</div>
    <div class="meta">Posted on 2004-09-24 19:01:13 by gallo</div>
   </div>
   <div class="post" id="post-150417">
    <div class="subject"><a href="#post-150417">3D Scene</a></div>
    <div class="body">Afternoon, gallo.<br /><br />It all depends upon which method you're using for the movement and rotation of the object.<br /><br />Is it possible to upload the proggy plus sourcecode of what you've got so far so I can take a look at it?<br /><br />Cheers,<br />Scronty</div>
    <div class="meta">Posted on 2004-09-25 08:12:08 by Scronty</div>
   </div>
   <div class="post" id="post-150487">
    <div class="subject"><a href="#post-150487">3D Scene</a></div>
    <div class="body">hello Scronty,<br />here is my little program and its code; as i said before, the problem is that after rotating the object if i move it, the DX puts the object in its new position in the world and not in the object's position relative to its direction<br /><br />so i hope you can help me :alright:<br /><br />thanks</div>
    <div class="meta">Posted on 2004-09-25 19:10:56 by gallo</div>
   </div>
   <div class="post" id="post-150491">
    <div class="subject"><a href="#post-150491">3D Scene</a></div>
    <div class="body">Good afternoon.<br /><br />Here's some stuff that may help you - or not :tongue:<br /><br />First, a structure to define an instance of a mesh object.<br />We load the mesh once, then we create some kind of array<br />of instances of the object, with their unique data kept inside (stuff like position, orientation kept per instance of the object).<br /><br />NB: CAVEATS concerning the following code, the pMesh member of object instances is a copy of the pMesh we got when we loaded the mesh - all Instances of a mesh use the same pMesh value, so we should not unload the mesh until the reference count (#instances) reaches zero :)<br />This &quot;object&quot; structure is merely a way of keeping instance-specific data together, and is just something I made up - invent your own :)<br /><br /><pre><code><br /> LPOBJECT typedef ptr Object<br />Object STRUCT<br />  ObjectType          DWORD ?                ;We just might wanna know this if we have more than 1 kind<br />  pMesh                 DWORD ?                ;Pointer to this object's Mesh<br />  vLocation            D3DVECTOR &lt;&gt;        ;where in 3D space this object is currently located<br />  fYaw                    FLOAT ?                   ;Three angles = the 3D rotation &#40;orientation&#41; of the object<br />  fPitch                   FLOAT ?<br />  fRoll                    FLOAT ? <br />  matLocal D3DMATRIX   &lt;&gt;                  ;will be used to manipulate the object according to the above info<br />Object  ENDS<br /></code></pre><br /><br />Now a couple of helper procs that operate on object instances:<br /><br /><pre><code><br />;--------------------------------------------------------------------------------------------------------------------------------------------------<br />;This procedure calculates a per-object &quot;world transformation matrix&quot;<br />;useful for Orientation and Positioning of a 3d object in &quot;world space&quot;,<br />;from data stored in a per-object data structure, where it also stores the resulting matrix.<br />;Rotation of objects is around their own origin &#40;around origin of model space&#41;.<br />;Position of objects is in world space.<br />;--------------------------------------------------------------------------------------------------------------------------------------------------<br />CalculateObjectMatrix PROC pObject&#58;DWORD<br />local matTemp, matRotateX, matRotateY, matRotateZ &#58;D3DMATRIX<br />push edi<br />mov edi,pObject<br />assume edi&#58;LPOBJECT<br />;The following function shifts the world by MINUS the object origin<br />;You could also say we are moving our imaginary 3d pen to the object location<br />invoke D3DUtil_SetTranslateMatrix, addr matWorld, addr &#91;edi&#93;.vLocation<br /><br />invoke D3DUtil_SetRotateYMatrix, addr  matRotateY, addr &#91;edi&#93;.fYaw<br />invoke D3DUtil_SetRotateXMatrix, addr  matRotateX, addr &#91;edi&#93;.fPitch <br />invoke D3DUtil_SetRotateZMatrix, addr  matRotateZ, addr &#91;edi&#93;.fRoll<br />invoke D3DXMatrixMultiply, addr matTemp, addr matRotateX, addr matRotateY ;&#40;X x Y --&gt; T&#41;<br />invoke D3DXMatrixMultiply, addr matTemp, addr matRotateZ, addr matTemp     ;&#40;Z x T --&gt; T&#41;<br />invoke D3DXMatrixMultiply, addr matWorld, addr matTemp, addr matWorld       ;&#40;T x W --&gt; W&#41;<br />invoke RtlMoveMemory,addr &#91;edi&#93;.matLocal , addr matWorld,sizeof D3DMATRIX<br />pop edi<br />ret<br />CalculateObjectMatrix ENDP<br /></code></pre><br /><br /><pre><code><br /><br />;This procedure is used to perform the following steps&#58;<br />;1- Stash the current World Transform Matrix<br />;2- Switch to the OBJECT Local Transform Matrix<br />;3- Draw the Object<br />;4- Return the World Transform Matrix to its previous state<br /><br />DrawObjectInPosition PROC pObject&#58;LPOBJECT<br />local matStash&#58;D3DXMATRIX<br />mov edi,pObject<br />mcall &#91;lpd3dDevice&#93;,IDirect3DDevice8_GetTransform, 256, addr matStash<br />mcall &#91;lpd3dDevice&#93;,IDirect3DDevice8_SetTransform, 256, addr &#91;edi&#93;.matLocal<br />_saferender &#91;edi&#93;.pMesh<br />mcall &#91;lpd3dDevice&#93;,IDirect3DDevice8_SetTransform, 256, addr matStash<br />ret<br />DrawObjectInPosition ENDP<br /></code></pre><br /><br />I have not given code to load or render the actual mesh - I'll leave it to you since I assume you can already do that :)<br /><br />What we can do now is call the function to calculate object instance matrices once when an object instance is initialized,  and once whenever the objectinstance's values (pos, rot etc) are changed.<br /><br />We can call render on the instances at any time after they have been initialized - and can do so in a loop, looking for a flag that states the instance &quot;IsReadyToRender&quot; ..</div>
    <div class="meta">Posted on 2004-09-25 23:32:48 by Homer</div>
   </div>
   <div class="post" id="post-150493">
    <div class="subject"><a href="#post-150493">3D Scene</a></div>
    <div class="body">The above posting may seem redundant to some people at first, especially the getting and setting of the world transform in the render-in-frame-of-reference procedure.<br />I agree, there should be a parameter in that procedure that points to a &quot;parent matrix&quot;, which normally is an identity matrix, but could also be an object's matrix in which case subsequent rending would be relative to that object.<br />With that in mind, it's pretty potent stuff :)</div>
    <div class="meta">Posted on 2004-09-25 23:55:24 by Homer</div>
   </div>
   <div class="post" id="post-150512">
    <div class="subject"><a href="#post-150512">3D Scene</a></div>
    <div class="body">You can also translate the object in world space, and then rotate it around the world origin to achieve the result you seek, but the solution I have offered will work for every case.</div>
    <div class="meta">Posted on 2004-09-26 06:39:27 by Homer</div>
   </div>
   <div class="post" id="post-150540">
    <div class="subject"><a href="#post-150540">3D Scene</a></div>
    <div class="body">hello EvilHomer2k,<br />first thank you for those class instance methods, i think they are gonna be very useful.<br />Now if you downloaded my little test program you'll notice that what i do to rotate and to move the object is more or less the same as you, even though, it still doesn't work how i showed in the picture (rember?): the object doesn't move the its direction, so i still don't know how to do it.....would some one please help me??<br /><br />thanks</div>
    <div class="meta">Posted on 2004-09-26 18:39:53 by gallo</div>
   </div>
   <div class="post" id="post-150582">
    <div class="subject"><a href="#post-150582">3D Scene</a></div>
    <div class="body">Afternoon, gallo.<br /><br />You've still got a wee bit of code missing:<br /><br />1) There's no timing code. You need to be able to know how much time has passed between renders for doing any animation (movement/rotation).<br /><br />2) There's no control code. You need to be able to control the object (move forward/backward/rotate) with keyboard and/or mouse.<br /><br />Cheers,<br />Scronty</div>
    <div class="meta">Posted on 2004-09-27 20:57:28 by Scronty</div>
   </div>
   <div class="post" id="post-150720">
    <div class="subject"><a href="#post-150720">3D Scene</a></div>
    <div class="body">hello Scronty,<br />i took in count your advices (thanks!) and this is my new test program:<br />(to control the object use the numpad (with num-lock) numbers: 8=down and 2=up (rotate x axis); 4=left and 6=right (rotate z axis); 0=left and &lt;return&gt;=right (rotate y axis))<br />.....so what do you think? :oops: <br /><br />thanks</div>
    <div class="meta">Posted on 2004-09-30 17:19:41 by gallo</div>
   </div>
   <div class="post" id="post-150967">
    <div class="subject"><a href="#post-150967">3D Scene</a></div>
    <div class="body"><div class="quote"><br />We could consider that the first object is Parent to the second object, because if we now move the first object around in the world, the second one will move with it (since its relative).<br />Likewise, we could consider the the second object is a Child of the first object.<br />We could say that the Child has a different Frame Of Reference to the Parent, that the Child's Origin depends on the Parent's Origin, etc.<br />I may be getting a little ahead, but it makes good brainfood.<br />When you start to read about Frames later, this is what they are talking about, not animation cell frames, but rather frames of reference, and relative objects (relative position, relative rotation etc - it's all just a matter of nesting the call to render the object, nothing hard to code)</div><br />had been interesting to see a example of frames of reference, etc in ATC<br /><br />just interesting as I am doing all stuff right now by myself but yet has only object transform/rotate, not World rotate</div>
    <div class="meta">Posted on 2004-10-05 14:46:21 by daydreamer</div>
   </div>
   <div class="post" id="post-150984">
    <div class="subject"><a href="#post-150984">3D Scene</a></div>
    <div class="body">Yep, all this stuff I coded under ATC some time ago (see the TerrainDemo), was very educational, learning about dealing with polygonal objects, a segmented World and its data structure(s), etc.<br /><br />One of the major support classes that myself and Ultrano wrote and which deserves to be reviewed is the one used to create node hierarchies - a small base class from which we derive various classes for the various kinds of nodes we want to handle.<br /><br />We are talking about Frame Nodes.<br />NOT FRAME OF REFERENCE, NOT ANIMATIONFRAME<br />Microsoft like talking about 'Frames', so I'll refer to them as Frames from now on. Damn you to hell m$ for confusing everyone. Note there's several kinds of Frames for holding different kinds of content - each is similar, and all have a handful of fields in common, so we can certainly afford to wrap all the common stuff in a light base class as stated earlier.<br /><br />What are these common fields so we can define our base class?<br />We'd need at least the following:<br /><br />-pParent = pointer to Parent frame (&quot;up&quot; the tree)<br />-pChild = pointer to Child frame (&quot;down&quot; the tree)<br />-pNextSibling = pointer to Younger Brother frame (&quot;right&quot; in tree)<br />-pPrevSibling = pointer to Older Brother frame (&quot;left&quot; in tree)<br /><br />It's normal to NAME frames with a string, so we should also have<br />-pName = pointer to NameString<br />Finally, since we'll probably keep mixed node types in a single tree, all nodes should have a NodeType identifying field<br />-dwNodeType = What kind of Node this is (we'll use this later)<br /><br />So, armed with these 6 fields, we can go ahead and define a BaseClass from which all Frame Nodes will be derived.<br /><br />It's common to use the value NULL (zero) to mean illegal pointer,<br />so an object with no Parent will have pParent=NULL.<br /><br />Under ATC, we're not meant to need to zero out fields in new object instances (in constructor), but my experience tells me that we do - I assume sometimes the HeapAlloc call doesn't correctly zero newly-allocated memory, possibly this is an artifact of my modified xp os.<br /><br />Now let's talk about what kind of Methods we'll want in our baseclass.<br />We want to be able to link and unlink objects from their parents and siblings. We'll need to handle insertions (patching links) and the opposite (unpatching links to remove an object without deleting it) ie linking and unlinking objects in a tree-wise fashion.<br />That's about all we need.<br /><br />You may have noticed that we are defining a bidirectional 2-dimensional linked list here, a useful support class in your arsenal, good for all kinds of things besides FrameNode hierarchy.<br /><br />Go ahead and try to write the Node Hierarchy Base Class.<br />I'd like to see what you come up with :)<br /><br />Once this is written, we simply inherit it in our Node classes.</div>
    <div class="meta">Posted on 2004-10-06 01:38:47 by Homer</div>
   </div>
   <div class="post" id="post-150986">
    <div class="subject"><a href="#post-150986">3D Scene</a></div>
    <div class="body">The type of hierarchy formed using this baseclass is called a Directed Acyclic Graph (aka DAG).<br /><br />It has one root node.<br />Each node can have N children.<br />Note that only the FIRST CHILD of a Parent Node is recorded as a Child of that Parent, since any others are Younger Siblings of the First Child.<br />That means a group of Siblings all know who their Parent is, but a Parent only knows the FIRST of its children. That's important. Now we know that Siblings are just a way of keeping a group of &quot;subitems&quot; together.<br /><br />We can use this hierarchy to define a SCENE GRAPH !!!<br />It's more than just a system of storing the scene data - we can define Nodes which DO STUFF instead of just containing something.<br />Furthermore, any changes made by nodes that do stuff (called Action Nodes) are propagated down the tree, and thus affect any subsequent Nodes.<br /><br />Imagine we have a &quot;rotation node&quot;, with a child &quot;geometry node&quot;.<br />The rotation will be applied to the geometry, and anything &quot;below&quot; it in the tree hierarchy.<br /><br />We can define Skeletons for animating Skinned Mesh creatures using this kind of hierarchy - and more !!<br /><br />We can write MOST OF THE LOGIC OF A GAME into a SceneGraph, including triggered and timed events and their response actions.<br /><br />I hope you see some of the possibilities of this stuff, and appreciate that SceneGraph (in all its forms) is already in common use to the point where it's becoming a defacto standard.<br /><br />The &quot;game engine&quot; then boils down to a scenegraph loader, and some code to &quot;walk&quot; the scenegraph (applying action nodes, collecting the &quot;renderables&quot; into a by-texture array of &quot;stuff to draw&quot;, marking Nodes for deletion where applicable).</div>
    <div class="meta">Posted on 2004-10-06 03:10:56 by Homer</div>
   </div>
   <div class="post" id="post-150998">
    <div class="subject"><a href="#post-150998">3D Scene</a></div>
    <div class="body">Hey EvilHomer2k, why don't you write a tutorial? :) if you copy all your posts in this thread together you'll have one :)<br /><br />What is the next step? BSP-trees or Quad/Oct-trees for frustum culling?</div>
    <div class="meta">Posted on 2004-10-06 10:56:06 by lifewire</div>
   </div>
   <div class="post" id="post-151040">
    <div class="subject"><a href="#post-151040">3D Scene</a></div>
    <div class="body">If you have specific requests for one or more tutorials, I'd be happy to take them into consideration. I'm not about to write tutorials which won't be read and appreciated.<br /><br />Where to from here? Octree :) Why?<br /><br />We have been discussing the merits of hierarchical databases.<br />One method of wholesale culling which is gaining popularity right now is to create a hierarchy of Bounding Volumes (generally Boxes, but not always). The reason? If a Bounding Volume is totally outside the Viewing Frustum, then it is not at all visible - and neither are its children ... we can disregard the bounding volume AND ANYTHING WITHIN IT.<br /><br />The name given to this kind of system is Octree Space Partitioning 2.<br />Don't ask me why, I have no idea why it wasn't given a name which distinguishes it more easily from regular OSP.<br /><br />Regardless, it's a great culling method because it is cheap to implement, and the savings in cpu cycles compared to non hierarchical BB testing is obviously very large.<br /><br />Unfortunately, it is not efficient to implement unless you already have a hierarchical DB, so we have yet another reason to want one.<br /><br />Last night, I revised my TreeNode class.<br />I went on to write a SwitchNode class that is derived from it.<br />I'll post it a little later, I'm currently not on my workhorse.<br /><br />Have a nice day :)</div>
    <div class="meta">Posted on 2004-10-07 00:20:44 by Homer</div>
   </div>
   <div class="post" id="post-151041">
    <div class="subject"><a href="#post-151041">3D Scene</a></div>
    <div class="body">Just wanted to qualify my last post a little more .. BSP is redundant due to its simplicity.. its a system used to divide the world into ever-smaller &quot;half-spaces&quot;, where a half-space contains geometric data, either in the leaves of the tree (&quot;leafy bsp&quot;) or spread throughout its nodes (&quot;nodey bsp&quot;).<br />One problem with that is that we end up with a lot of EMPTY HALFSPACES being mapped into the tree - nodes that don't contain anything.<br /><br />Hierarchical BoundingVolumes are a better choice, because the geometry nodes will ALWAYS contain some geometry, and will NEVER be empty - we will never map an empty volume of space.<br /><br />It's inherently more suitable for a world that is mostly empty space, with objects and terrain occupying anything under 50% of the universe.<br /><br />Furthermore, it's pretty easy to move stuff around in an OSP2 world, blow holes in geometry, etc, all the stuff that basically can't be done in a BSP.<br /><br />A BSP IS ONLY USEFUL FOR MAPPING STATIC WORLDS.</div>
    <div class="meta">Posted on 2004-10-07 00:32:30 by Homer</div>
   </div>
   <div class="post" id="post-151042">
    <div class="subject"><a href="#post-151042">3D Scene</a></div>
    <div class="body">I should also add that BSP requires preprocessing of the map.<br />Depending on the quality of the algo used, it can be very slow.<br />Processing times of 10 to 12 hours for a single map are not unusual.<br />Want to modify the world? Now you have to reprocess it (grrr).<br /><br />OSP on the other hand: much faster, in fact, no need to preprocess, can generate at runtime in a couple of seconds.<br /><br />If I remember correctly, BSP was first written up in 1968, and I feel that it is beginning to show signs of old age.</div>
    <div class="meta">Posted on 2004-10-07 00:41:05 by Homer</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=19387&amp;page=1" style="">&laquo;</a><a href="../?id=19387&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="19387" /><input type="number" name="page" min="1" max="3" step="1" value="2" onchange="this.form.submit();" /><a href="../?id=19387&amp;page=3">&gt;</a><a href="../?id=19387&amp;page=3">&raquo;</a></form>  </div>
 </body>
</html>