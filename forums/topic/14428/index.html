<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Desktop Image and WebCam - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14428" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=14428">Desktop Image and WebCam</a></p>
   <div class="post" id="post-111550">
    <div class="subject"><a href="#post-111550">Desktop Image and WebCam</a></div>
    <div class="body">Hello Coders<br /><br />I am trying to get my present desktop into a buffer in memory.  Than show it on the desktop like a screen save would but it would only be a true 100% image of the present screen.  Not zooming or nothing special.   Just a raw accurate shot of the entire screen.<br /><br />From there I'm sure i know how to make my image topmost window, lock it, kill mouse and keyboard.  So if any touch my machine they would have to SHUT-IT DOWN....<br /><br />But skip my details.  What is the easiest and fairly fast way to do this?  Lighting speed is not really needed for me .... only accuracy..  <br /><br />I will be reading a lot to night about it but if i don't get it at lease someone may know how and i don't have to SUFFER another month of confessing docs but will learn something tonight out of it by reading them..<br /><br />Thanks in advance<br /><br />PS:<br />To Scronty:<br /><br />I am getting into your  WebCam code, correction (program) in the process.  But all i get is a black bitmap save to disk.  All day i been quite afaird to tamper with the code because i have no clue where to start .to be honest.  My question is will it do what i am trying to do and how do i get to see an image.  I got your new VFW32 but i get the same results.  Is WebCamApp for web related stuff only.</div>
    <div class="meta">Posted on 2003-07-22 20:39:13 by cmax</div>
   </div>
   <div class="post" id="post-111560">
    <div class="subject"><a href="#post-111560">Desktop Image and WebCam</a></div>
    <div class="body">There are thousands of threads about this.  You have to be a rocket sinentic to put all the pieces together.  <br /><br />Anyway, While searching i founded titan code.  It seem to be a good start so i put it in the Generic.asm but i can't seem to get the Screen Capture in the hwndStatic box.  I know i am doing something really silly but <br />i have rushed though it at lease 20 times.  Setting text is easy but how to i set a capture on a static box.  I also found a code that make a bitmap and write it to disk and it show the same thing that WebCam does &quot;A Big Black Bitmap&quot;  So i guest it must be under there somewhere.  The Bitmaps format is a trip.  I hope i don't need all of that.. and sorry about all of this...<br /><br /><br />; #########################################################################<br /><br />      .386<br />      .model flat, stdcall  ; 32 bit memory model<br />      option casemap :none  ; case sensitive<br /><br /><br />; #########################################################################<br /><br /><br /><br />; #########################################################################<br /><br />;     include files<br />;     ~~~~~~~~~~~~~<br />      include \MASM32\INCLUDE\windows.inc<br />      include \MASM32\INCLUDE\masm32.inc<br />      include \MASM32\INCLUDE\gdi32.inc<br />      include \MASM32\INCLUDE\user32.inc<br />      include \MASM32\INCLUDE\kernel32.inc<br />      include \MASM32\INCLUDE\Comctl32.inc<br />      include \MASM32\INCLUDE\comdlg32.inc<br />      include \MASM32\INCLUDE\shell32.inc<br /><br />;     libraries<br />;     ~~~~~~~~~<br />      includelib \MASM32\LIB\masm32.lib<br /><br />      includelib \MASM32\LIB\gdi32.lib<br />      includelib \MASM32\LIB\user32.lib<br />      includelib \MASM32\LIB\kernel32.lib<br />      includelib \MASM32\LIB\Comctl32.lib<br />      includelib \MASM32\LIB\comdlg32.lib<br />      includelib \MASM32\LIB\shell32.lib<br /><br />; #########################################################################<br />      szText MACRO Name, Text:VARARG<br />        LOCAL lbl<br />          jmp lbl<br />            Name db Text,0<br />          lbl:<br />        ENDM<br /><br />      m2m MACRO M1, M2<br />        push M2<br />        pop  M1<br />      ENDM<br /><br />      return MACRO arg<br />        mov eax, arg<br />        ret<br />      ENDM<br /><br />        WinMain PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />        WndProc PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />        TopXY PROTO   :DWORD,:DWORD<br /><br /><br />    .data<br />        szDisplayName db &quot;Generic&quot;,0<br />        CommandLine   dd 0<br />        hWnd          dd 0<br />        hInstance     dd 0<br />        StaticClassName db &quot;static&quot;,0<br /><br />.data?<br /><br /><br />rect                                RECT                &lt;?&gt;<br /><br />hwndStatic    DWORD  ?<br />hdc    DWORD  ?<br />cdc    DWORD  ?<br />hbmp   DWORD  ?<br />temp   DWORD  ?<br /><br />; #########################################################################<br />    .code<br />start:<br /><br />    invoke GetModuleHandle, NULL ; provides the instance handle<br />    mov hInstance, eax<br /><br />    invoke GetCommandLine        ; provides the command line address<br />    mov CommandLine, eax<br /><br />    invoke WinMain,hInstance,NULL,CommandLine,SW_SHOWDEFAULT<br />    <br />    invoke ExitProcess,eax       ; cleanup &amp; return to operating system<br /><br />; #########################################################################<br /><br />WinMain proc hInst     :DWORD,<br />             hPrevInst :DWORD,<br />             CmdLine   :DWORD,<br />             CmdShow   :DWORD<br /><br />        ;====================<br />        ; Put LOCALs on stack<br />        ;====================<br /><br />        LOCAL wc   :WNDCLASSEX<br />        LOCAL msg  :MSG<br /><br />        LOCAL Wwd  :DWORD<br />        LOCAL Wht  :DWORD<br />        LOCAL Wtx  :DWORD<br />        LOCAL Wty  :DWORD<br /><br />        szText szClassName,&quot;Generic_Class&quot;<br /><br />        ;==================================================<br />        ; Fill WNDCLASSEX structure with required variables<br />        ;==================================================<br /><br />        mov wc.cbSize,         sizeof WNDCLASSEX<br />        mov wc.style,          CS_HREDRAW or CS_VREDRAW \<br />                               or CS_BYTEALIGNWINDOW<br />        mov wc.lpfnWndProc,    offset WndProc      ; address of WndProc<br />        mov wc.cbClsExtra,     NULL<br />        mov wc.cbWndExtra,     NULL<br />        m2m wc.hInstance,      hInst               ; instance handle<br />        mov wc.hbrBackground,  COLOR_BTNFACE+3     ; system color<br />        mov wc.lpszMenuName,   NULL<br />        mov wc.lpszClassName,  offset szClassName  ; window class name<br />          invoke LoadIcon,hInst,500    ; icon ID   ; resource icon<br />        mov wc.hIcon,          eax<br />          invoke LoadCursor,NULL,IDC_ARROW         ; system cursor<br />        mov wc.hCursor,        eax<br />        mov wc.hIconSm,        0<br /><br />        invoke RegisterClassEx, ADDR wc     ; register the window class<br /><br />        ;================================<br />        ; Centre window at following size<br />        ;================================<br /><br />        mov Wwd, 500<br />        mov Wht, 350<br /><br />        invoke GetSystemMetrics,SM_CXSCREEN ; get screen width in pixels<br />        invoke TopXY,Wwd,eax<br />        mov Wtx, eax<br /><br />        invoke GetSystemMetrics,SM_CYSCREEN ; get screen height in pixels<br />        invoke TopXY,Wht,eax<br />        mov Wty, eax<br /><br />        ; ==================================<br />        ; Create the main application window<br />        ; ==================================<br />        invoke CreateWindowEx,WS_EX_OVERLAPPEDWINDOW,<br />                              ADDR szClassName,<br />                              ADDR szDisplayName,<br />                              WS_OVERLAPPEDWINDOW,<br />                              Wtx,Wty,Wwd,Wht,<br />                              NULL,NULL,<br />                              hInst,NULL<br /><br />        mov   hWnd,eax  ; copy return value into handle DWORD<br /><br /><br /><br />        invoke ShowWindow,hWnd,SW_SHOWNORMAL      ; display the window<br />        invoke UpdateWindow,hWnd                  ; update the display<br /><br /><br /><br />invoke CreateWindowExA,NULL, ADDR StaticClassName, 0,\<br />WS_CHILD or WS_VISIBLE,\<br />01,01,300,300,hWnd,0,hInstance,NULL;<br />mov  hwndStatic,eax<br /><br /><br />      ;===================================<br />      ; Loop until PostQuitMessage is sent<br />      ;===================================<br /><br />    StartLoop:<br />      invoke GetMessage,ADDR msg,NULL,0,0         ; get each message<br />      cmp eax, 0                                  ; exit if GetMessage()<br />      je ExitLoop                                 ; returns zero<br />      invoke TranslateMessage, ADDR msg           ; translate it<br />      invoke DispatchMessage,  ADDR msg           ; send it to message proc<br />      jmp StartLoop<br />    ExitLoop:<br /><br />      return msg.wParam<br /><br />WinMain endp<br /><br />; #########################################################################<br /><br />WndProc proc hWin   :DWORD,<br />             uMsg   :DWORD,<br />             wParam :DWORD,<br />             lParam :DWORD<br />    .if uMsg == WM_COMMAND<br /><br /><br />        .if wParam == 1000<br />            invoke SendMessage,hWin,WM_SYSCOMMAND,SC_CLOSE,NULL<br />        .elseif wParam == 1900<br />            szText TheMsg,&quot;Assembler, Pure &amp; Simple&quot;<br />            invoke MessageBox,hWin,ADDR TheMsg,ADDR szDisplayName,MB_OK<br />        .endif<br /><br />    ;====== end menu commands ======<br /><br />    .elseif uMsg == WM_CREATE<br /><br /><br /><br />invoke CreateCompatibleDC,NULL<br />mov cdc,eax<br /><br />invoke CreateCompatibleBitmap,hdc,rect.right,rect.bottom <br /><br />mov hbmp,eax<br /><br /><br />invoke SelectObject,cdc,hbmp<br />invoke BitBlt,hdc,rect.left,rect.top,rect.right,rect.bottom,cdc,rect.left,rect.top,DSTINVERT<br /><br />invoke BitBlt,hdc,rect.left,rect.top,rect.right,rect.bottom,cdc,rect.left,rect.top,DSTINVERT<br />mov hwndStatic, offset cdc<br /><br />invoke SetWindowPos, hWnd, HWND_TOPMOST, NULL, NULL, NULL, NULL,SWP_SHOWWINDOW or SWP_NOSIZE or SWP_NOMOVE<br /><br /><br /><br />    .elseif uMsg == WM_CLOSE<br />        szText TheText,&quot;Please Confirm Exit&quot;<br />        invoke MessageBox,hWin,ADDR TheText,ADDR szDisplayName,MB_YESNO<br />          .if eax == IDNO<br />            return 0<br />          .endif<br /><br />    .elseif uMsg == WM_DESTROY<br />        invoke PostQuitMessage,NULL<br />        return 0 <br />    .endif<br /><br />    invoke DefWindowProc,hWin,uMsg,wParam,lParam<br /><br />    ret<br /><br />WndProc endp<br /><br />; ########################################################################<br /><br />TopXY proc wDim:DWORD, sDim:DWORD<br /><br />    shr sDim, 1      ; divide screen dimension by 2<br />    shr wDim, 1      ; divide window dimension by 2<br />    mov eax, wDim    ; copy window dimension into eax<br />    sub sDim, eax    ; sub half win dimension from half screen dimension<br /><br />    return sDim<br /><br />TopXY endp<br /><br />; ########################################################################<br /><br />end start</div>
    <div class="meta">Posted on 2003-07-23 00:29:36 by cmax</div>
   </div>
  </div>
 </body>
</html>