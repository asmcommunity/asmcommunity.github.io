<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>String Magic in &quot;Code Injection&quot;- ? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=15980" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=15980">String Magic in &quot;Code Injection&quot;- ?</a></p>
   <div class="post" id="post-123853">
    <div class="subject"><a href="#post-123853">String Magic in &quot;Code Injection&quot;- ?</a></div>
    <div class="body">In an asm code,for injection, i found something like<pre><code>	<br />inject_code_start&#58;<br /><br />lbl1&#58;<br />       AppendedStr	db  ' Some String to be used inside proggie&#58;&#41;&quot;',0<br />lbl2&#58;<br />NewMsgTitle	db 100 + &#40;lbl2 - lbl1&#41; dup&#40;0&#41;	;buf = 100 + Len&#40;AppendedStr&#41; + 1inject_code_start&#58;<br /><br />inject_code_end&#58;</code></pre><br />And in the code these strings are used  like below,<br /><pre><code><br />mov	eax,&#91; ebp + pLstrcat &#93;	;eax -&gt; lstrcat API function's address<br /><br />lea	ebx,&#91; ebp + AppendedStr &#93;	;ebx -&gt; the string we wanna append<br />lea	ecx,&#91; ebp + NewMsgTitle &#93;	;ecx -&gt; the buffer <br /><br />push		ebx	;arg 2<br />push		ecx	;arg 1<br />call		eax	;lstrcat API is called<br /></code></pre><br />Doubt is...why the string is used like it.?<br />What's the Magic of that labels.(lbl1 &amp; lbl2)?.<br />Please, clarify the theory behind it?.</div>
    <div class="meta">Posted on 2003-11-09 00:15:50 by zakham</div>
   </div>
   <div class="post" id="post-123854">
    <div class="subject"><a href="#post-123854">String Magic in &quot;Code Injection&quot;- ?</a></div>
    <div class="body">labels are calcuated as RVA of a PE file. With that in mind, that's how your code works. (Too lazy to explain it in details) Hope you do not get into trouble with the rules of the forum.</div>
    <div class="meta">Posted on 2003-11-09 00:40:28 by roticv</div>
   </div>
  </div>
 </body>
</html>