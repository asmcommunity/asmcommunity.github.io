<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Delta Stuff! - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17991" />
    <link rel="next" href="../?id=17991&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=17991">Delta Stuff!</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=17991&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=17991&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="17991" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=17991&amp;page=2">&gt;</a><a href="../?id=17991&amp;page=2">&raquo;</a></form>   <div class="post" id="post-138884">
    <div class="subject"><a href="#post-138884">Delta Stuff!</a></div>
    <div class="body">Can any one plz explain me the concept of what a 'delta' handle is coz i have seen a lot of programs<br /><br />containing the following snippet of code:<br /><br />        CALL            DELTA                            ; GET DELTA<br /><br />DELTA:  POP             EBP                                     <br /><br />        SUB             EBP, DELTA<br /><br />Also how can i get kernel32 imagebase from the stack. I want to do this since i have to protect an exe by<br /><br />having '0' imports to refer to :grin: <br /><br />Thkx in advance<br /><br />:stupid:</div>
    <div class="meta">Posted on 2004-04-13 22:14:23 by telophase</div>
   </div>
   <div class="post" id="post-138886">
    <div class="subject"><a href="#post-138886">Delta Stuff!</a></div>
    <div class="body">DELTA is most likely not a handle but a symbolic name.  Delta is the mathematical word for 'difference' or 'change'. For example<br /><br />mov  edx,  offset Function_End<br />sub  edx, offset Function_Start<br />mov Delta, edx<br /><br />Delta holds the difference, or change in adresses.  <br /><br />Hope this helps<br />:NaN:</div>
    <div class="meta">Posted on 2004-04-13 22:31:57 by NaN</div>
   </div>
   <div class="post" id="post-138891">
    <div class="subject"><a href="#post-138891">Delta Stuff!</a></div>
    <div class="body">an exe with 0 imports wont run in xp/2k/nt as far as i remember<br /><br />and the call delta gives you the runtime eip effectively,allowing you to use that address as a 'landmark' when calculating other addresses..trace it, it isnt rocket science</div>
    <div class="meta">Posted on 2004-04-13 23:42:03 by evlncrn8</div>
   </div>
   <div class="post" id="post-138893">
    <div class="subject"><a href="#post-138893">Delta Stuff!</a></div>
    <div class="body"><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=17649&amp;highlight=delta">http://www.asmcommunity.net/board/index.php?topic=17649&amp;highlight=delta</a><br /><br />0 imports will not work, forget the idea.</div>
    <div class="meta">Posted on 2004-04-13 23:46:25 by f0dder</div>
   </div>
   <div class="post" id="post-138901">
    <div class="subject"><a href="#post-138901">Delta Stuff!</a></div>
    <div class="body">You use it to create virus</div>
    <div class="meta">Posted on 2004-04-14 01:48:28 by greenant</div>
   </div>
   <div class="post" id="post-138949">
    <div class="subject"><a href="#post-138949">Delta Stuff!</a></div>
    <div class="body">'alternative importing' is used in software protection, too (no, f0dcrypt is still not ready for release and probably won't be for quite some time yet.)<br /><br />I am sure telophase wouldn't need to ask about such techniques here if he was a virus writer, as they are well described in various viral zines. (And if he is, well, I hope we will toddle off and go somewhere else.)</div>
    <div class="meta">Posted on 2004-04-14 09:49:37 by f0dder</div>
   </div>
   <div class="post" id="post-138955">
    <div class="subject"><a href="#post-138955">Delta Stuff!</a></div>
    <div class="body"><div class="quote">an exe with 0 imports wont run in xp/2k/nt as far as i remember</div> <br /><br />I don't understand what you want to tell here.<br /><br />Do you mean that a program that don't call any function in windows or any library. will not work on the xp/2k/nt systems.<br />Then How dos programs work on it?<br /><br />And another thing here, What is delta ?<br />I will tell you what I understood. you get by using it eip that allow your code to enter the program loop. to run on the processor. Is that right?<br /><br />Finally How to make such thing??????????????<br /><br /><br />Thanks,<br />Amr</div>
    <div class="meta">Posted on 2004-04-14 10:08:08 by amr</div>
   </div>
   <div class="post" id="post-138959">
    <div class="subject"><a href="#post-138959">Delta Stuff!</a></div>
    <div class="body"><div class="quote"><br />Then How dos programs work on it?<br /></div><br />Because DOS programs run in another subsystem - the NTVDM. Obviously DOS programs don't have to use win32 imports :p.<br /><br />0-import exe's will work on some win32 versions but not on others. Didn't work on the versions of win2k I tried it on, but worked on XP. Since there's at least a couple of platforms it doesn't work on, the technique is unusable for me.<br /><br />If anybody knows the tech detail why it works on XP but not 2k, enlighten me - I'm too lazy to reverse the PE loader :)<br /><br /><div class="quote"><br />And another thing here, What is delta ?<br /></div><br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=17649&amp;highlight=delta">http://www.asmcommunity.net/board/index.php?topic=17649&amp;highlight=delta</a></div>
    <div class="meta">Posted on 2004-04-14 10:17:47 by f0dder</div>
   </div>
   <div class="post" id="post-138960">
    <div class="subject"><a href="#post-138960">Delta Stuff!</a></div>
    <div class="body"><div class="quote">If anybody knows the tech detail why it works on XP but not 2k, enlighten me - I'm too lazy to reverse the PE loader <br /><br /></div><br /><br />If I remember correctly reading it off somewhere, the problem with 0 imports is only on 2k. It had soemthing to do with the PE loader in 2k. The exact details I cannot remmeber, might need to dig for it.</div>
    <div class="meta">Posted on 2004-04-14 10:33:24 by roticv</div>
   </div>
   <div class="post" id="post-138964">
    <div class="subject"><a href="#post-138964">Delta Stuff!</a></div>
    <div class="body">Well, my <strong>guess</strong>...<br /><br />It's a more or less wellknown fact that your program entrypoint isn't the first code that executes on process creation. Some of the first code that executes in your process is actually kernel32.dll code, which then calls your entrypoint iirc. This is why you can find a kernel32 address on  at program entrypoint.<br /><br />It's also wellknown that DLL's aren't &quot;global&quot; on NT as they are on 9x - they get mapped for each individual process only if the process uses them.<br /><br />So... it would seem the stuff fails on 2k because 2k doesn't &quot;force&quot; kernel32 into your process. But why does it succed on XP, then? Are DLLs forced into your process, and is it more than just kernel32?<br /><br />(And of course, the above is a *lot* of speculation, so it could be wrong).</div>
    <div class="meta">Posted on 2004-04-14 10:55:01 by f0dder</div>
   </div>
   <div class="post" id="post-138965">
    <div class="subject"><a href="#post-138965">Delta Stuff!</a></div>
    <div class="body">Ah you reminded me.<br /><br />I think the reason why the exe cannot be loaded without an import in win2k is because without any imports, ntdll.dll cannot be mapped into the memory and thus the exe fails to load properly. Like what you said dll aren't global on NT. <br /><br />Perhaps we need to look into the pe loader of XP? :p</div>
    <div class="meta">Posted on 2004-04-14 11:02:42 by roticv</div>
   </div>
   <div class="post" id="post-138966">
    <div class="subject"><a href="#post-138966">Delta Stuff!</a></div>
    <div class="body">I can't really be bothered :). I asked g-rom about it a while ago, and he didn't know either - it even came as a surprise to him that the noimports stuff didn't work on 2k.</div>
    <div class="meta">Posted on 2004-04-14 11:14:06 by f0dder</div>
   </div>
   <div class="post" id="post-138991">
    <div class="subject"><a href="#post-138991">Delta Stuff!</a></div>
    <div class="body"><div class="quote"><br />It's a more or less wellknown fact that your program entrypoint isn't the first code that executes on process creation. Some of the first code that executes in your process is actually kernel32.dll code, which then calls your entrypoint iirc. This is why you can find a kernel32 address on  at program entrypoint.</div><br /><br />AFAIK, the address in  is the same return address for procedures called through CreateThread. It is supposed to be simply a call to ExitThread with a return value of 0. The lParam seems to be missing in this case? :confused:<br /></div>
    <div class="meta">Posted on 2004-04-14 15:33:31 by QvasiModo</div>
   </div>
   <div class="post" id="post-138995">
    <div class="subject"><a href="#post-138995">Delta Stuff!</a></div>
    <div class="body">The  and thread-return values are different on my system...</div>
    <div class="meta">Posted on 2004-04-14 15:58:50 by f0dder</div>
   </div>
   <div class="post" id="post-138998">
    <div class="subject"><a href="#post-138998">Delta Stuff!</a></div>
    <div class="body">Yep, here too (XP). I'll try it back home (98). Then I'll see if I got that info from there, or if I've finally melted my brain :P</div>
    <div class="meta">Posted on 2004-04-14 17:55:22 by QvasiModo</div>
   </div>
   <div class="post" id="post-138999">
    <div class="subject"><a href="#post-138999">Delta Stuff!</a></div>
    <div class="body">Guess I was way off the mark here &lt;lol&gt;<br /><br />:NaN:</div>
    <div class="meta">Posted on 2004-04-14 18:33:52 by NaN</div>
   </div>
   <div class="post" id="post-139000">
    <div class="subject"><a href="#post-139000">Delta Stuff!</a></div>
    <div class="body">Not that much, NaN - the 'delta' is indeed still difference/change in this context - the precise meaning would be &quot;amount loaded code has been relocated from it's original imagebase&quot;.</div>
    <div class="meta">Posted on 2004-04-14 18:37:37 by f0dder</div>
   </div>
   <div class="post" id="post-139005">
    <div class="subject"><a href="#post-139005">Delta Stuff!</a></div>
    <div class="body">But all you people tell me one thing how do i get the ImageBase of kernel32 from the stack?<br /><br />And is it also possible for me to get ImageBase of other DLL's lke user32 or shell32 etc..</div>
    <div class="meta">Posted on 2004-04-14 20:21:00 by telophase</div>
   </div>
   <div class="post" id="post-139006">
    <div class="subject"><a href="#post-139006">Delta Stuff!</a></div>
    <div class="body"><div class="quote"><br />But all you people tell me one thing how do i get the ImageBase of kernel32 from the stack?<br /><br />And is it also possible for me to get ImageBase of other DLL's lke user32 or shell32 etc.. </div><br /><br />on EP get the vall off the stack like dword ptr ..That'll give you somewhere in K32..doesnt really matter and you can wipe the loword if you want cause x86 is on 1 page align..this is all in Billys 29A4 guide (sorry to cite it here).  Anyways heres my func for it..kinda lame cause its slow:<br /><br /><pre><code><br /><br /> ;--------------------------------------;<br /> ; GetKernelBase			;<br /> ;				        ;<br /> ; - Gets kernel32 base                 ;<br /> ;                                      ;<br /> ; Input&#58;			        ;<br /> ; - EAX - Somewhere in KERNEL32	;<br /> ;				        ;<br /> ; Output&#58;			        ;<br /> ; ddKernBase - Base                    ;<br /> ;--------------------------------------;<br /><br />GetKernelBase proc<br />	pushad<br /><br />	LoopCheck&#58;<br />	cmp word ptr &#91;eax&#93;, IMAGE_DOS_SIGNATURE<br />	jz LoopFind<br />	dec eax<br />	jmp LoopCheck<br /><br />	LoopFind&#58;<br />	movzx edi, word ptr &#91;eax+3ch&#93;<br />	add edi, eax<br />	cmp dword ptr &#91;edi&#93;, IMAGE_NT_SIGNATURE<br />	jz LoopEnd<br />	dec eax<br />	jmp LoopCheck ; rinse &amp; repeat<br /><br />	LoopEnd&#58;<br />	mov dword ptr &#91;ebp+ddKernBase&#93;, eax<br /><br />	popad<br />	ret<br />	<br />GetKernelBase endp<br /></code></pre><br /><br /><br />0 Imports dont work cause M$ prolly assumed that what legit exe would need 0 imports which theyre right.  At any rate you can use virtual loader like y0das Incontext or z0mbies thing INMEM.rar for 0 imports i think.</div>
    <div class="meta">Posted on 2004-04-14 21:37:33 by archphase</div>
   </div>
   <div class="post" id="post-139009">
    <div class="subject"><a href="#post-139009">Delta Stuff!</a></div>
    <div class="body">The concept of virtual loaders sounds good could you give me some more info or some links and stuff on this thing</div>
    <div class="meta">Posted on 2004-04-14 22:28:32 by telophase</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=17991&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=17991&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="17991" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=17991&amp;page=2">&gt;</a><a href="../?id=17991&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>