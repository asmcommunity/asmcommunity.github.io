<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>what the hell is going on [cr4] - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=16760" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=16760">what the hell is going on [cr4]</a></p>
   <div class="post" id="post-130153">
    <div class="subject"><a href="#post-130153">what the hell is going on [cr4]</a></div>
    <div class="body">I tried to test 3th bit in cr4 register and before it i loaded cr4 into eax, just like this:<br /><br /><pre><code><br /> mov eax,cr4<br /> test eax,4<br /> jz good    <br /></code></pre><br /><br />winXP said me that:<br /><div class="quote"><br />you fellow used the Privileged instruction (0xc0000096) at the location 0x00402000 and now your application will be closed<br /><br />click on OK to terminate the program<br />click on CANCEL to terminate yourself.<br /></div><br /><br /><br />I don't really know, what the hell is going on:notsure:</div>
    <div class="meta">Posted on 2004-01-09 07:51:24 by etn</div>
   </div>
   <div class="post" id="post-130154">
    <div class="subject"><a href="#post-130154">what the hell is going on [cr4]</a></div>
    <div class="body">Hi, etn<br /><br /><br /><pre><code>mov eax, CR4</code></pre> <br /><br />is only possible if your program is running in CPL = 0.<br />To make this you need to write a device driver or <br />another way to execute your code in Ring 0.</div>
    <div class="meta">Posted on 2004-01-09 08:07:08 by Opcode</div>
   </div>
   <div class="post" id="post-130155">
    <div class="subject"><a href="#post-130155">what the hell is going on [cr4]</a></div>
    <div class="body">but i needn't CPL0 i only want to test the 3th bit on cr4 register , that is all.<br /><br />what a pulp...<br />oh! Krrisna, Ring 0...<br /><br />couldn't the exception be off?</div>
    <div class="meta">Posted on 2004-01-09 08:13:56 by etn</div>
   </div>
   <div class="post" id="post-130156">
    <div class="subject"><a href="#post-130156">what the hell is going on [cr4]</a></div>
    <div class="body">There is <strong>no other way</strong> to access the CR4 register in the Intel Architeture <br />if the code is not running in CPL = 0.<br /><br /><div class="quote"><br /><br />    MOV to/from special registers                    CPU: 386+ Priv<br /><br />    In protected mode, MOV to/from a special register is a privileged<br />    instruction and can be executed only if CPL=0. 32-bit operands are<br />    always used with these instructions, regardless of the operand-size<br />    attribute.<br /><br />    Note that the CR4 register was introduced with the Pentium, and that<br />    the test registers do not exist on the Pentium or the Pentium Pro.<br /><br /><br />    Opcode      Format<br />    0F 20 /r    MOV  r32,CR0/CR2/CR3/CR4<br />    0F 21 /r    MOV  r32,DR0/DR1/DR2/DR3/DR6/DR7<br />    0F 22 /r    MOV  CR0/CR2/CR3/CR4,r32<br />    0F 23 /r    MOV  DR0/DR1/DR2/DR3/DR6/DR7,r32<br />    0F 24 /r    MOV  r32,TR6/TR7                ; 386-486<br />    0F 26 /r    MOV  TR6/TR7,r32                ; 386-486<br />    0F 24 /r    MOV  r32,TR3/TR4/TR5            ; 486<br />    0F 26 /r    MOV  TR3/TR4/TR5,r32            ; 486<br /> <br /></div> <br /><br />You are needing to read more the Intel? Architecture Software Developer's Manuals.<br /><a target="_blank" href="http://www.intel.com/design/pentium/manuals/">http://www.intel.com/design/pentium/manuals/</a></div>
    <div class="meta">Posted on 2004-01-09 08:24:12 by Opcode</div>
   </div>
   <div class="post" id="post-130158">
    <div class="subject"><a href="#post-130158">what the hell is going on [cr4]</a></div>
    <div class="body">THX men, you raised my spirits:cool:</div>
    <div class="meta">Posted on 2004-01-09 08:37:55 by etn</div>
   </div>
   <div class="post" id="post-130162">
    <div class="subject"><a href="#post-130162">what the hell is going on [cr4]</a></div>
    <div class="body">Run the code in Ring0 (driver most probably) instead of Ring3.</div>
    <div class="meta">Posted on 2004-01-09 10:07:42 by roticv</div>
   </div>
   <div class="post" id="post-130164">
    <div class="subject"><a href="#post-130164">what the hell is going on [cr4]</a></div>
    <div class="body"><div class="quote"><br />Run the code in Ring0 (driver most probably) instead of Ring3. </div><br /><br />Excuse me, maybe I'm mistaken and I have a different perception.<br />But isn't that answer has been already given?</div>
    <div class="meta">Posted on 2004-01-09 10:19:58 by Eternal Idol Birmingham</div>
   </div>
   <div class="post" id="post-130182">
    <div class="subject"><a href="#post-130182">what the hell is going on [cr4]</a></div>
    <div class="body"><div class="quote"><br />click on OK to terminate the program<br />click on CANCEL to terminate yourself. <br /></div> <br /><br />Since you are posting, I guess you clicked &quot;OK&quot;  :grin:</div>
    <div class="meta">Posted on 2004-01-09 14:02:18 by ThoughtCriminal</div>
   </div>
   <div class="post" id="post-130431">
    <div class="subject"><a href="#post-130431">what the hell is going on [cr4]</a></div>
    <div class="body">no,<br /><br />U R wrong!<br /><br />I pressed cancel but like always without any succes ;)</div>
    <div class="meta">Posted on 2004-01-12 07:44:27 by etn</div>
   </div>
  </div>
 </body>
</html>