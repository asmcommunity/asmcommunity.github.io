<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Homer's GameDev Blog - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29358" />
  <link rel="prev" href="../?id=29358&amp;page=7" />  <link rel="next" href="../?id=29358&amp;page=9" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=29358">Homer's GameDev Blog</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=29358&amp;page=1" style="">&laquo;</a><a href="../?id=29358&amp;page=7" style="">&lt;</a><input type="hidden" name="id" value="29358" /><input type="number" name="page" min="1" max="15" step="1" value="8" onchange="this.form.submit();" /><a href="../?id=29358&amp;page=9">&gt;</a><a href="../?id=29358&amp;page=15">&raquo;</a></form>   <div class="post" id="post-208938">
    <div class="subject"><a href="#post-208938">Re: Homer's GameDev Blog</a></div>
    <div class="body">Added (but did not yet hook up) a new object to abstract keyboard input.<br />It maps between Virtual KeyCodes and &quot;GameEngine User Input Codes&quot; using the &quot;xlatb&quot; opcode (yeah, pointless, we can do our own addressing, why DOES this opcode exist? Is it faster? I just felt like using it).<br />This will facilitate user-generated keyboard mappings.<br />Both forward and reverse lookups are supported, so I can display a list of key bindings, and more importantly, quickly determine which commands are NOT bound (possibly due to user remapping).<br /><br />I also added code to allow the user to skip the intro movie by pressing space.<br />Those things can be annoying after the 50th time.<br />Might force the user to watch it once via a regkey, but after that, meh.<br /></div>
    <div class="meta">Posted on 2009-09-25 07:05:03 by Homer</div>
   </div>
   <div class="post" id="post-208940">
    <div class="subject"><a href="#post-208940">Re: Homer's GameDev Blog</a></div>
    <div class="body"><div class="quote"><br />It maps between Virtual KeyCodes and &quot;GameEngine User Input Codes&quot; using the &quot;xlatb&quot; opcode (yeah, pointless, we can do our own addressing, why DOES this opcode exist? Is it faster? I just felt like using it).</div><br /><br />It exists because it is a useful atomic operation in some OS internals. Together with the lock prefix, you can do a simple table lookup that is thread-safe in a multi-CPU environment.</div>
    <div class="meta">Posted on 2009-09-25 07:45:14 by Scali</div>
   </div>
   <div class="post" id="post-208943">
    <div class="subject"><a href="#post-208943">Re: Homer's GameDev Blog</a></div>
    <div class="body">Well, I might need to do my own addressing eventually if I want to support Chinese keyboards, and will deal with mutexing at that time. Already have some weapons pointed that way.<br />For now, I will be masking out VK codes to 6 bits, and using the upper two bits to encode the shift and control keys (SYSKEYS).<br /><br />I can detect pretty much all the keys that a user might press, as well as the mouse buttons...<br /><br />I won&#039;t be able to distinguish left shift from right shift, or uppercase from lowercase.<br />However, I accept this limitation for the time being and move on.<br /><br /><br /></div>
    <div class="meta">Posted on 2009-09-25 09:12:26 by Homer</div>
   </div>
   <div class="post" id="post-208948">
    <div class="subject"><a href="#post-208948">Re: Homer's GameDev Blog</a></div>
    <div class="body">About skinmesh animation, I had some problem weighted-mixing anims (how the resulting model looked and performed) : <br />- lerp of matrices was of so-so quality. Candy-wrapper artifacts, strange incompatibility with the dual-quat skinning shader on gpu. <br />- lerp of &quot;vec3 pos&quot; and &quot;vec3 rot&quot; and constructing a final matrix per bone via quat was unexpectedly horrible<br />Most engines use quat-slerp, but I&#039;d rather not use several thousand trigonometry-instructions per mixed anim.<br /><br />DualQuats saved my day, but I don&#039;t see anyone using them much, yet. Specifically the ability to weighted-accumulate ( DQuat1+= DQ2*0.3) looks under-utilized. Is there something one should avoid about DQs ? <br />My current code computes the final local-space bones via DQs, then converts each DQ to Mat4, then appends those Mat4 for the hierarchy, multiplies by the inverse Mat4 of the bind-pose, and finally converts the resulting Mat4s to an array of DQs to be used in the shader. Is there a way to do the hierarchy-transforms only via DQs, instead of temporarily converting to Mat4 ?</div>
    <div class="meta">Posted on 2009-09-25 13:30:48 by Ultrano</div>
   </div>
   <div class="post" id="post-208949">
    <div class="subject"><a href="#post-208949">Re: Homer's GameDev Blog</a></div>
    <div class="body"><br />Do your animation keyframes only drive rotation and translation (ie, no scale, no shear)?<br />If so, I can see absolutely no reason to convert to matrices, given that you are not passing matrix data to your shader. You can concatenate the frame transformations as quaternions (orientation) and vectors (translation). Don&#039;t use axis/angle orientation, use proper quaternions.<br /><br />Careful painting of skin weights will improve artifacts due to animation blending.<br />These most often result from inconsistent skin weights exaggerated by unintended bone influences.<br /><br />Try not to use too many #influences, you generally DONT need 4 or more bone influences.<br />Often 3, or even 2 is enough. More is quite unnecessary.<br /><br /></div>
    <div class="meta">Posted on 2009-09-25 20:20:51 by Homer</div>
   </div>
   <div class="post" id="post-208950">
    <div class="subject"><a href="#post-208950">Re: Homer's GameDev Blog</a></div>
    <div class="body">Thanks, now I&#039;m sure I can get rid of Mat4 in the animations :D . Will get to implementing it at some time, as the code already removes all cos/sin/acos/etc instructions from the whole animation, and the final mix looks great ^_^ . <br />Yeah, the shader code supports up to 4 weights, dynamic branching. (ironically, it&#039;s just a few more instructions on a G80+ than 4 Mat4x3*vec3 multiplies)<br />Simplistic IK for feet of blended-animation now seems much more possible for me to make (via selective blending of pre-baked rotations). </div>
    <div class="meta">Posted on 2009-09-26 00:23:53 by Ultrano</div>
   </div>
   <div class="post" id="post-208954">
    <div class="subject"><a href="#post-208954">Re: Homer's GameDev Blog</a></div>
    <div class="body">Happy to help.<br />I spent six YEARS trying to make skinmesh work, one attempt per year!<br />They are not the most simple thing in the world, but they are made of simple things.<br /><br />Today I hooked up the Keyboard Abstraction Layer, it works like a charm.<br />I tried binding some new keys to existing command codes such as &#039;terminate application&#039;, and proved to myself that the User (of my Engine) can easily map and unmap even the default key bindings without problems.<br /><br />I also reworked the code for the Console Exec(ute ScriptFile) command so that it resembles a primitive interpreter instead of a pile of switch logic.<br />That wasnt completed, but one side effect of this work was the creation of a new object called TextFile which derives from DiskStream and supports a &#039;GetNextLine&#039; method, as well as returning meaningful errorcodes.<br /><br />The Console is tracking which textfiles are currently open, so our scriptfiles can recurse other scriptfiles, but only if they are not already being recursed - this eliminates the possibility of reentrancy.<br />The interpreter does not exist yet, I will break at this time and speak to Biterider about implementing a serious script engine with access to class templates and such.<br />This will allow the user to write scripts which can manipulate the fields of object instances, and much, much more.<br /><br />Script engines are a wonderful and powerful tool, but can easily be abused.<br />My first advice is to not script anything that happens once per frame.<br />Their best use is as event sources and event sinks outside of the main loop.<br /></div>
    <div class="meta">Posted on 2009-09-26 11:36:12 by Homer</div>
   </div>
   <div class="post" id="post-208956">
    <div class="subject"><a href="#post-208956">Re: PHYSICS REPLUGGED</a></div>
    <div class="body">Upgrading the Physics Simulator.<br /><br />CollisionBody class now works like D3D_Mesh and D3D_SkinMesh - its a Reference object which keeps a collection of its own Instances.<br /><br />Simulator stores CollisionBody objects, and CollisionBody stores CollisionBodyInstance objects.<br /><br />The Simulator.CreateInstance method was modified to accept a given (possibly Derived) instance, which is what happens in D3D_MeshManager and D3D_SkinMeshManager.<br /><br />Several methods of Simulator were modified to take (1) a pointer to an array of instance pointers, and (2) the #instances.<br />And this is important.<br />Although instances are internally managed under their ref objects, it is ASSUMED that you are keeping a list of instance pointers OUTSIDE THE SIMULATOR.<br />This allows the user to easily PARTITION THE SIMULATION by keeping several lists of instances.<br />I chose to pass ptrs to raw arrays of ptrs with a counter so that the Simulator object remains more friendly to non OA32 callers... more on that later.<br /><br />My world is space-partitioned.<br />What partitioning scheme I used is not relevant.<br />If I make a list of physics entities that are inside each partition, &nbsp;I can drive the simulation on a per-partition basis, using sublists of CollisionBodyInstance objects.<br />And if all the instances in a given partition are &#039;asleep&#039;, I can cull that partition from the simulation.<br /><br />I cannot overstate how important this is, it can VASTLY improve the efficiency of the simulation.<br />Physics is very cpu-intense stuff, and my algorithms use exhaustive tests of pairs of candidates for collision testing, so it is logarithmically expensive to test for collisions.<br />The smaller your lists of potentially colliding bodies, the quicker the simulation will run, leaving more processor time for other stuff.<br /><br /><br /></div>
    <div class="meta">Posted on 2009-09-27 00:42:00 by Homer</div>
   </div>
   <div class="post" id="post-208957">
    <div class="subject"><a href="#post-208957">Re: Homer's GameDev Blog</a></div>
    <div class="body">Doing more NNAI research, man I cannot wait to put together a training ground and unleash two sets of AI critters - zombie antagonists, and screaming human prey!<br />The time is coming!<br /></div>
    <div class="meta">Posted on 2009-09-27 02:51:16 by Homer</div>
   </div>
   <div class="post" id="post-208974">
    <div class="subject"><a href="#post-208974">Re: Homer's GameDev Blog</a></div>
    <div class="body">As mentioned, I&#039;ve been spending a few days cleaning up the object associations in order to cleanly implement the physics engine.<br />Here&#039;s a picture that roughly describes the associations between the local Player object and the GameEngine.<br /></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=2873" target="_blank">Recent.JPG</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2009-09-29 08:17:44 by Homer</div>
   </div>
   <div class="post" id="post-208975">
    <div class="subject"><a href="#post-208975">Re: Homer's GameDev Blog</a></div>
    <div class="body">I&#039;ve chosen an interesting way to bring together the Visual and Physical components of the Player.<br /><br />As you can see in my previous post, the Player class is Derived (inherits) from the CollisionBodyInstance class.<br />That means it can be driven directly by the Physics engine, which like our other Manager classes, supports the managing of user-supplied (and possibly Derived) instances of any managed reference object.<br /><br />We can also see that the Player class embeds the SkinMeshInstance class.<br />The embedded skinmesh instance is managed by SkinMeshManager.<br />That means we don&#039;t ever need to animate or draw the player.... the manager will do it.<br /><br />The Player class applies User Input to manipulate the Physical state, and ensures that the Visual object remains synchronized to the Physical object.<br /><br />The physics engine drives the position and orientation of the Player, and as mentioned, animation and rendering is automatic, since the Visual object is also Managed.<br /><br />The less that the application programmer needs to do, the better.<br /></div>
    <div class="meta">Posted on 2009-09-29 10:15:15 by Homer</div>
   </div>
   <div class="post" id="post-208980">
    <div class="subject"><a href="#post-208980">Re: Homer's GameDev Blog</a></div>
    <div class="body">Now things get a little more interesting, because we need to start culling stuff.<br />For example, we don&#039;t want to animate every skinmesh instance in the world on the client.<br />Most of them are not even NEARLY in view.<br />But we can&#039;t just ignore them, because D3D doesn&#039;t let us Set the AnimationController time.<br />We can only advance by some amount.<br />So we need to track, per UNRENDERABLE SKINMESH INSTANCE, how long the instance has been offscreen, and account for that time when the instance DOES become visible.<br />OR, we could keep track of how long we&#039;ve been rendering altogether, and advance by THAT much when the instance is newly visible. See how much more efficient that is?<br /><br />And we can&#039;t just drive our camera (or its parent) if we are in a multiplayer game.<br />The client needs to tell the server what &#039;player controls&#039; are active so that the Server (not the client) can determine adjustments to the physical state of the whole world, and then alert the player(s) about changes in the physical state of the world.<br /><br />As I said, things are more interesting now.<br />I really need some way to interface the &quot;game logic&quot; to my game engine, rather than hardcoding it.<br />The obvious way is through a set of standard application interfaces, such as COM.<br />Perhaps there is a better way through carefully marshalled use of an external script engine.<br /><br /></div>
    <div class="meta">Posted on 2009-09-30 09:47:13 by Homer</div>
   </div>
   <div class="post" id="post-208981">
    <div class="subject"><a href="#post-208981">Re: Homer's GameDev Blog</a></div>
    <div class="body">Well, I suppose the simple answer is: don&#039;t rely on D3DX, but roll your own.<br />It&#039;s always going to be a tad difficult to have completely arbitrary animation relative to time... Your animation will usually consist of a set of interpolation control paths. So when you specify a random time, you have to figure out in which part of the path you are, before you can decide what and where to interpolate to get the exact position from the control points.<br />So to avoid complete reinitialization of the interpolator everytime, you usually want to have some sort of stepping mechanism.<br />At the very least, you could do a simple check to see if you are still in the same bit of control-path as you were last time (simple bounds-checking should do), so you only re-init when you actually make a switch.</div>
    <div class="meta">Posted on 2009-09-30 10:23:57 by Scali</div>
   </div>
   <div class="post" id="post-209007">
    <div class="subject"><a href="#post-209007">Re: Time to grow up</a></div>
    <div class="body">Today I&#039;m thinking about what an interface between GameEngine and the Application might look like.<br />I have some experience with this problem due to my work developing OA32&#039;s networking engine.<br />Primarily, we want an Application Event Sink so that GameEngine can push event notifications to the application.<br /><br />The question is: what kind of GameEngine events should a Game Application care about?<br />By creating a list of these, I can A) design the aforementioned event sinking interface, and B) create a Design Document to guide further development of GameEngine with the end-user in mind.<br />So far, development of GameEngine has been heavily based apon the constraints imposed by OA32&#039;s D3D application framework, which does support event virtualization via custom WM&#039;s, but I don&#039;t want to be posting events via the WM queue, I would much rather use a direct callback interface in order to avoid &#039;WM queue flooding&#039;.And besides, its about time I got my sh*t together and put together a battle plan, since GameEngine has become so large and complex, and I want to hide all that from the end-user, and I want to work to a schedule rather than the ad-hoc approach I&#039;ve taken so far - that works for small projects, and this is not a small project any more.<br /><br />Please note that I DO have working demos, I am not pipe dreaming about some code, I am talking about taking control of the erstwhile-chaotic design and implementation pipeline.<br /><br /><br /><br /></div>
    <div class="meta">Posted on 2009-10-03 01:44:58 by Homer</div>
   </div>
   <div class="post" id="post-209017">
    <div class="subject"><a href="#post-209017">Re: Homer's GameDev Blog</a></div>
    <div class="body">Spent one day extending NetComEngine to support all the socket types defined under Windows.<br />Tested the changes using an updated &#039;NetComEngine Client Demo&#039;, and the OLD &#039;NetComEngine Server Demo&#039;, just to prove that my changes are sane and workable.<br /><br />As mentioned in another thread, I did this in a unified way, by replacing WSASend/WSARecv calls with WSASendTo/WSARecvFrom calls (the latter work for any kind of socket, the former are only good for tcp streams).<br /><br />Actually it took a lot less than one day, more like 15 minutes.<br />I had predicted the changes would take 10 minutes, so I must have been moving too slow :P<br /><br />Anyway, the result is that OA32&#039;s networking engine now supports all defined socket types:<br />-Raw (IP layer packet interface)<br />-UDP (Unreliable, Unordered Messages)<br />-UDP (Reliable, Unordered Messages)<br />-UDP (Reliable, Ordered Messages)<br />-TCP (Reliable, Ordered Byte Stream)<br /><br />And if at some future time Microsoft decides to support new socket types (such as SOCK_SCTP) the engine is ready to support them too.<br /></div>
    <div class="meta">Posted on 2009-10-05 01:56:30 by Homer</div>
   </div>
   <div class="post" id="post-209024">
    <div class="subject"><a href="#post-209024">Re: Homer's GameDev Blog</a></div>
    <div class="body">I&#039;ll be spending a day or two moving GameEngine into a DLL build.<br />This will give me a solid reason to implement the Application Event Sink I mentioned previously, as well as making GameEngine immediately more appealing to programmers from all walks of life.<br />Better still, it allows me to cleanly separate &#039;game logic&#039; from &#039;engine proper&#039;.<br /></div>
    <div class="meta">Posted on 2009-10-06 02:27:20 by Homer</div>
   </div>
   <div class="post" id="post-209026">
    <div class="subject"><a href="#post-209026">Re: Homer's GameDev Blog</a></div>
    <div class="body">Well, I&#039;ve finished shovelling GameEngine into a DLL, next I have to write a small exe which uses the DLL, and remove any non-essential democode from GameEngine&#039;s core. That&#039;s why I estimated it will take a day or two.<br /><br />The DLL exports just one function, which normally does not return until the user quits the app.<br />You might wonder where is the opportunity for executing user code, and what is the point of the DLL?<br />The user&#039;s executable supports an event-sinking interface whose methods are called by GameEngine.<br />It is within these methods that the user implements the &#039;game logic&#039;.<br />This will typically involve calls (from the EXE&#039;s event sink) back into the DLL (GameEngine methods), and to methods of any GameEngine subengines and other components.<br /><br />Since GameEngine looks after all aspects of the &#039;application framework&#039;, the user/developer can concentrate on just writing the logic to drive the game, and not worry about anything else.<br />I keep saying &quot;the less the user has to know and do, the better&quot;..</div>
    <div class="meta">Posted on 2009-10-06 06:36:34 by Homer</div>
   </div>
   <div class="post" id="post-209027">
    <div class="subject"><a href="#post-209027">Regarding a 'feature' of OA32</a></div>
    <div class="body">Found a pretty serious problem with OA32&#039;s marshalling of &#039;Window Messages&#039; to virtual event handler methods. Well I think I did, I hope I am doing something terribly wrong!<br /><br />Basically, when a WM fires, OA32&#039;s application framework marshals a call to a standard method which takes three parameters (one of which is hidden to the coder).<br />The first parameter of the call SHOULD be a pointer to the Object Instance.<br />I have discovered that, instead, it is pointing to the Object Template, ie, TPL_CLASSNAME.<br />That works fine if the template is stored in the executable file, and/or we are working directly with that template rather than Instancing (which, granted, is a workaround that I could use...)<br />But if the template is stored in a DLL, and given that the Instance is in heap memory, we will be addressing DLL memory instead of the heap-based memory of the object instance that we made.<br /><br />This problem does not affect applications that directly use a templated class containing such event handlers - but it does affect applications that instance such classes, so we could not use this for a Dialog class, therefore this goes a lot deeper than just posing a problem to DLL implementations.<br /><br />I hope Biterider is watching this :)<br /><br />Now - since each Instance is associated with exactly one Window, the solution would seem to store the instance pointer as a WindowLong data member which can be easily retrieved when marshaling WMs.<br />Unfortunately, that can&#039;t be done until the Window has been created, so ideally this would be automatically done for the user in any of the chain of ancestral Init methods, WinPrimer.Init being the obvious candidate.<br /><br /></div>
    <div class="meta">Posted on 2009-10-06 08:47:44 by Homer</div>
   </div>
   <div class="post" id="post-209028">
    <div class="subject"><a href="#post-209028">Re: Homer's GameDev Blog</a></div>
    <div class="body">Hi Homer<br />Windows messages are send to the corresponding object instance using the objects Dispatch methods, which is defined for example in the SDI object. As you pointed out, the Startup method is only capable to initialize the object template. This is why the Self pointer is pointing to the object template. As soon as you have created a window, the message pump sends the corresponding messages to the created object instance.<br /><br />In your case, the DLL builds a second template chain, which must be initialized the same way as the main app, using SysInit when the DLL is attached and finally SysDone when it is detached. An example can be seen here \ObjAsm32\Code\COM\COM_DLL.inc<br /><br />Since the New and Destroy macros need to know about the object templates and their addresses, it may be necessary to implement specific (de)allocation stubs for the objects residing in your DLL.<br /></div>
    <div class="meta">Posted on 2009-10-06 13:59:53 by Biterider</div>
   </div>
   <div class="post" id="post-209038">
    <div class="subject"><a href="#post-209038">Re: Homer's GameDev Blog</a></div>
    <div class="body">Thanks for the reply.<br />Yep I already solved the problem.<br />For the benefit of those who completely did not understand that response, basically the problem was determined to be that the Window was being Created within the Startup method, which is a NO NO.<br />We should create our window within the Init method.<br />This &#039;feature&#039; was present in legacy code, unfortunately.<br />It won&#039;t happen again, at least not to me :P<br /></div>
    <div class="meta">Posted on 2009-10-07 10:48:49 by Homer</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=29358&amp;page=1" style="">&laquo;</a><a href="../?id=29358&amp;page=7" style="">&lt;</a><input type="hidden" name="id" value="29358" /><input type="number" name="page" min="1" max="15" step="1" value="8" onchange="this.form.submit();" /><a href="../?id=29358&amp;page=9">&gt;</a><a href="../?id=29358&amp;page=15">&raquo;</a></form>  </div>
 </body>
</html>