<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>SHA1 - US Secure Hash Algorithm - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=6751" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=6751">SHA1 - US Secure Hash Algorithm</a></p>
   <div class="post" id="post-48779">
    <div class="subject"><a href="#post-48779">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">Hi guys, I'v written an implementation of the SHA1 algorithim. However I've run into a difficulty and I can't check  if I'm right or wrong in the implementation.<br /><br />I need the Hash code produced to be compatible with another program. <br /><br />When I hash the files in that program it gives <br />1) CZN3GPMKNMABB3W7QFAGS575PWPHX4OZ<br />2) KHUAUMQQTLDLBAHAG5BYZYLW7BZGFISM<br />3) ICMEAS7FYBVGE62QTQXX5L22BFEHYY6O<br /><br />However my program gives in hex<br />1) DBDB582D9589952274477A856493C97354DBAA68<br />2) AF0E23F658855207693C86A4C23FD5E7564747A8<br />3) C0A59BF1EA023C059664168EC022B6E7245E9CD5<br /><br /><br />Clealy they are using a different method of converting the 5 dword (20 byte) hash code into ascii. I simply used  hex2dw.<br /><br />The question I want to ask is can anyone explain what method they seem to be using? Their hash string is 32 characters in lenght always (I've looked at more than three files). It seems to be made up of letters A-Z and however I've only ever noticed digits 2-7. <br /><br />That gives a total 32 distinct characters, which would be 5 bits. This also fits in with the size 5 dwords : 160  bits divided by 5 gives 32; the number of characters.<br /><br />So I tried the following code to create that type of string<br /><br /><pre><code>.data<br />HS db 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567'<br /><br />.data?<br />tBuf db 128 dup &#40;?&#41;<br /><br />.code<br />mov edi,-20<br />lea esi,tBuf<br />xor ecx,ecx<br />@@&#58;	mov eax,H&#91;20&#93;&#91;edi&#93;<br />	shr eax,cl<br />	and eax,011111b<br />	mov bl,HS&#91;eax&#93;<br />	mov &#91;esi&#93;,bl<br />	inc esi<br /><br />	add ecx,5<br />	cmp ecx,16<br />	jb  @B<br /><br />	sub ecx,16<br />	add edi,2<br />jnz @B</code></pre><br /><br />And I get the following strings.<br /><br />1) 36WRVWUSJMFFC25I2LBJWJGZTDVWNVCN<br />2) PVDGC3DLFUUOQURHGEJF47U2HXVOUDBV<br />3) AOJXZYL5CAPKALSMWQDBMRYWHHJ4FOW2<br /><br />Now I can't see any similarity between them any the programs output, nor can I spot any pattern off hand. <br /><br />So I have to ask for help, could any suggest another possible method they may be using to convert the 160 bit hash code to ascii. Or could someone, perhaps maybe implement the C code provided in the technical file in the zip as this generates hex outputs which I could compare with my own code.<br /><br />Thanks guys, this really has me stumped.</div>
    <div class="meta">Posted on 2002-06-05 10:05:20 by Eóin</div>
   </div>
   <div class="post" id="post-48780">
    <div class="subject"><a href="#post-48780">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">Hmm, this is bad. I've been looking over the algo and I've spotted some mistakes. This begs the question how many other might there be which would be causeing my results to differ from other programs. :confused:<br /><br />Basically I was using the lenght of the file in bytes, but the algo calls for bits. Another thing of note is the fact that the C code padded with an extra byte, however the algo calls for an extra bit. I figured that most people will go for the extra byte implementation as its easier in HLLs, I hope that was the right choice.<br /><br />Heres the version with the length sorted, but it still produces different results.</div>
    <div class="meta">Posted on 2002-06-05 11:51:49 by Eóin</div>
   </div>
   <div class="post" id="post-48795">
    <div class="subject"><a href="#post-48795">RE</a></div>
    <div class="body">eoin,<br /><br />what is the program? if it isnt open source (neither have a open source equivalent) its easier to reverse engennering it a bit, and discover how he do the bin2ascii conversion, than trying to guess the algo by the result.<br /><br />ancev</div>
    <div class="meta">Posted on 2002-06-05 13:28:13 by ancev</div>
   </div>
   <div class="post" id="post-48787">
    <div class="subject"><a href="#post-48787">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">Here is some PowerBASIC source for SHA-1. Hope it helps!<br /><br /><pre><code><br />   #COMPILE EXE<br />   #REGISTER NONE<br />   #DIM ALL<br />   #INCLUDE &quot;Win32Api.Inc&quot;<br /><br />   $FileNm = &quot;sha.bas&quot;  ' &lt;------ Change<br /><br />   TYPE mSHA<br />      H0 AS LONG<br />      H1 AS LONG<br />      H2 AS LONG<br />      H3 AS LONG<br />      H4 AS LONG<br />   END TYPE<br /><br />   FUNCTION CalcSHA &#40;Str AS STRING, SHA AS mSHA&#41; AS LONG<br />      #REGISTER NONE<br /><br />      DIM lStr AS LONG, nq AS LONG, n AS LONG, adrW AS LONG, adrWW AS LONG<br />      DIM H0 AS LONG, H1 AS LONG, H2 AS LONG, H3 AS LONG, H4 AS LONG, W&#40;0 &#58; 79&#41; AS LONG<br />      DIM A AS LONG, B AS LONG, C AS LONG, D AS LONG, E AS LONG, TEMP AS LONG<br /><br />      lStr = LEN&#40;Str&#41;<br />      nq = FIX&#40;&#40;lStr + 8&#41; / 64&#41; + 1<br />      n = 16 * nq<br /><br />      REDIM WW&#40;0 TO n - 1&#41; AS LONG<br /><br />      WW&#40;n - 1&#41; = lStr * 8<br />      adrW = VARPTR&#40;W&#40;0&#41;&#41;<br />      adrWW = VARPTR&#40;WW&#40;0&#41;&#41;<br />      A = STRPTR&#40;Str&#41;<br /><br />      ! PUSH EDI<br />      ! PUSH ESI<br /><br />      ! MOV EDI, adrWW<br />      ! MOV ESI, A<br />      ! MOV ECX, lStr<br />      ! REP MOVSB<br /><br />      ! MOV CL, &amp;H80<br />      ! MOV &#91;EDI&#93;, CL<br /><br />      ! MOV EDI, adrWW<br />      ! MOV ECX, 2<br /> CalcSHA_Lbl1&#58;<br />      ! MOV AX, &#91;EDI&#93;<br />      ! MOV DX, &#91;EDI + 2&#93;<br />      ! MOV &#91;EDI&#93;, DH<br />      ! MOV &#91;EDI + 1&#93;, DL<br />      ! MOV &#91;EDI + 2&#93;, AH<br />      ! MOV &#91;EDI + 3&#93;, AL<br />      ! ADD EDI, 4<br />      ! INC ECX<br />      ! CMP ECX, n<br />      ! JNE CalcSHA_Lbl1<br /><br />      ! MOV H0, &amp;H67452301&amp;<br />      ! MOV H1, &amp;HEFCDAB89&amp;<br />      ! MOV H2, &amp;H98BADCFE&amp;<br />      ! MOV H3, &amp;H10325476&amp;<br />      ! MOV H4, &amp;HC3D2E1F0&amp;<br /><br /> CalcSHA_Lbl2&#58;<br /><br />      ! MOV EDI, adrW<br />      ! MOV ESI, adrWW<br />      ! MOV ECX, 64<br />      ! REP MOVSB<br />      ! MOV adrWW, ESI<br /><br />      ! MOV ECX, 0<br /> CalcSHA_Lbl3&#58;<br />      ! MOV ESI, ECX<br />      ! ADD ESI, ESI<br />      ! ADD ESI, ESI<br />      ! ADD ESI, adrW<br /><br />      ! MOV EAX, &#91;ESI + 52&#93;<br />      ! XOR EAX, &#91;ESI + 32&#93;<br />      ! XOR EAX, &#91;ESI + 8&#93;<br />      ! XOR EAX, &#91;ESI&#93;<br /><br />      ! MOV EDX, EAX<br />      ! SHL EAX, 1<br />      ! SHR EDX, 31<br />      ! OR  EAX, EDX<br />      ! MOV &#91;ESI + 64&#93;, EAX<br /><br />      ! INC ECX<br />      ! CMP ECX, 64<br />      ! JNE CalcSHA_Lbl3<br /><br />      ! MOV EAX, H0<br />      ! MOV A, EAX<br />      ! MOV EAX, H1<br />      ! MOV B, EAX<br />      ! MOV EAX, H2<br />      ! MOV C, EAX<br />      ! MOV EAX, H3<br />      ! MOV D, EAX<br />      ! MOV EAX, H4<br />      ! MOV E, EAX<br /><br />      ! MOV EDI, 0<br /> CalcSHA_Lbl4&#58;<br />      ! CMP EDI, 19<br />      ! JA CalcSHA_Lbl5<br /><br />      ! MOV ECX, B<br />      ! AND ECX, C<br />      ! MOV EAX, B<br />      ! NOT EAX<br />      ! AND EAX, D<br />      ! OR  ECX, EAX<br />      ! ADD ECX, &amp;H5A827999&amp;<br />      ! JMP CalcSHA_Lbl8<br /><br /> CalcSHA_Lbl5&#58;<br />      ! CMP EDI, 39<br />      ! JA CalcSHA_Lbl6<br /><br />      ! MOV ECX, B<br />      ! XOR ECX, C<br />      ! XOR ECX, D<br />      ! ADD ECX, &amp;H6ED9EBA1&amp;<br />      ! JMP CalcSHA_Lbl8<br /><br /> CalcSHA_Lbl6&#58;<br />      ! CMP EDI, 59<br />      ! JA CalcSHA_Lbl7<br /><br />      ! MOV EAX, B<br />      ! AND EAX, C<br />      ! MOV ECX, B<br />      ! AND ECX, D<br />      ! MOV EDX, C<br />      ! AND EDX, D<br />      ! OR  ECX, EAX<br />      ! OR  ECX, EDX<br />      ! ADD ECX, &amp;H8F1BBCDC&amp;<br />      ! JMP CalcSHA_Lbl8<br /><br /> CalcSHA_Lbl7&#58;<br />      ! MOV ECX, B<br />      ! XOR ECX, C<br />      ! XOR ECX, D<br />      ! ADD ECX, &amp;HCA62C1D6&amp;<br /><br /> CalcSHA_Lbl8&#58;<br />      ! MOV EAX, A<br />      ! MOV EDX, EAX<br />      ! SHL EAX, 5<br />      ! SHR EDX, 27<br />      ! OR  EAX, EDX<br />      ! ADD EAX, E<br />      ! ADD ECX, EAX<br /><br />      ! MOV ESI, EDI<br />      ! ADD ESI, ESI<br />      ! ADD ESI, ESI<br />      ! ADD ESI, adrW<br />      ! MOV ESI, &#91;ESI&#93;<br />      ! MOV TEMP, ESI<br /><br />      ! ADD Temp, ECX<br />      ! MOV EAX, D<br />      ! MOV E, EAX<br />      ! MOV EAX, C<br />      ! MOV D, EAX<br />      ! MOV EAX, B<br />      ! MOV EDX, EAX<br />      ! SHL EAX, 30<br />      ! SHR EDX, 2<br />      ! OR  EAX, EDX<br />      ! MOV C, EAX<br />      ! MOV EAX, A<br />      ! MOV B, EAX<br />      ! MOV EAX, TEMP<br />      ! MOV A, EAX<br /><br />      ! INC EDI<br />      ! CMP EDI, 80<br />      ! JNE CalcSHA_Lbl4<br /><br />      ! MOV EAX, A<br />      ! ADD H0, EAX<br />      ! MOV EAX, B<br />      ! ADD H1, EAX<br />      ! MOV EAX, C<br />      ! ADD H2, EAX<br />      ! MOV EAX, D<br />      ! ADD H3, EAX<br />      ! MOV EAX, E<br />      ! ADD H4, EAX<br /><br />      ! SUB nq, 1<br />      ! JNE CalcSHA_Lbl2<br /><br />      ! POP ESI<br />      ! POP EDI<br /><br />      SHA.H0 = H0&#58; SHA.H1 = H1&#58; SHA.H2 = H2&#58; SHA.H3 = H3&#58; SHA.H4 = H4<br /><br />   END FUNCTION<br /><br />   FUNCTION tSHA &#40;SHA AS mSHA&#41; AS STRING<br />      FUNCTION = HEX$&#40;SHA.H0, 8&#41; + &quot; &quot; + HEX$&#40;SHA.H1, 8&#41; + &quot; &quot; + HEX$&#40;SHA.H2, 8&#41; + &quot; &quot; + _<br />                 HEX$&#40;SHA.H3, 8&#41; + &quot; &quot; + HEX$&#40;SHA.H4, 8&#41;<br />   END FUNCTION<br /><br /><br />   FUNCTION PBMAIN<br /><br />      DIM SHA AS mSHA<br /><br />      CalcSHA &quot;abc&quot;, SHA<br />      MSGBOX tSHa&#40;SHA&#41;<br /><br /><br />   END FUNCTION<br /></code></pre></div>
    <div class="meta">Posted on 2002-06-05 13:38:59 by bazik</div>
   </div>
   <div class="post" id="post-48781">
    <div class="subject"><a href="#post-48781">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">ancev, the program in question is Gnucleus, a Gnutella client and as it happens it is open source. But I can't get the source code. According to the site I need WinCVS to download the latest version of the source but the program keeps crashing whenever I try run it. I must look into it more.<br /><br />bAZik, thanks for that code, I'll study it to see where I'm going wrong.<br /><br />A note regarding the hash string, I've been reading information on some gnutella forum and spotted BASE 32 mentioned so that probably is then method used to display the hash in ascii. Of course the specific order A-Z then 2-7 may not be right.</div>
    <div class="meta">Posted on 2002-06-05 14:07:25 by Eóin</div>
   </div>
   <div class="post" id="post-48796">
    <div class="subject"><a href="#post-48796">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">E?in,<br /> Attached is the only .cpp with the word hash in it from the latest CVS version of Gnucleus. I hope it help's If it is missing anything or you need other files than  send me a PM and I will email the source to you. Its 600k + and is over the boards limit.</div>
    <div class="meta">Posted on 2002-06-05 14:41:42 by emonk</div>
   </div>
   <div class="post" id="post-48792">
    <div class="subject"><a href="#post-48792">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body"><strong>E?in</strong>, browse the CVS and download anything you want:<br /><a target="_blank" href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/gnucleus">http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/gnucleus</a></div>
    <div class="meta">Posted on 2002-06-05 15:17:25 by bitRAKE</div>
   </div>
   <div class="post" id="post-48782">
    <div class="subject"><a href="#post-48782">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">I can feel my blood beginning to boil, its time to take a break.<br /><br />But I'll share something, the list of things the author of the C code seems to have done wrong.<br /><br />First theres the fact that he assumes that a message will be a multiple of 8. Thats a fair assumptions in this world of bytes rather than bits, but why does he then use the number of bits for the length. If you start with bytes, stick with them.<br /><br />Next for some reason he decided to bswap every single dword in the message. Nowhere in the algo description does it say the order is important, in fact since it should be read as a bit string you'd assume order is entirely unimportant. Moreoever his code bswap's the dword containing the additional padded byte, the end result being that the pad no longer remains at the end of the message. Clearly this must wrong.<br /><br />Both these are repeated in the PowerBasic version so it seems this incorrect implementation (and hugely inefficient due to unnecessary bswaps) has been accepted as standard. :mad:<br /><br />Finally the C version also decides to bswap the MessageDigest when its finished, however the PowerBasic version doesn't. So by my reckoning these two implementation of the same algo would yield different result. :rolleyes:<br /><br />emonk, thanks for the file. Unfortunatly it contains information on word hashing, not file hashing. Perhaps if you checked for the word SHA1 the right file might turn up. I think my e-mail may have a 1/2 mb limit.<br /><br />EDIT: Just spotted bitRAKEs link, thanks. emonk thanks fo the offer but I can get the file myself now. :alright:</div>
    <div class="meta">Posted on 2002-06-05 15:46:24 by Eóin</div>
   </div>
   <div class="post" id="post-48788">
    <div class="subject"><a href="#post-48788">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">Here is a compiled version of the PowerBASIC SHA code. It takes the commandline parameters and calculates the hash from it.<br /><br />Good info source:<br /><a target="_blank" href="http://csrc.nist.gov/cryptval/shs.html">http://csrc.nist.gov/cryptval/shs.html</a></div>
    <div class="meta">Posted on 2002-06-05 16:26:17 by bazik</div>
   </div>
   <div class="post" id="post-48789">
    <div class="subject"><a href="#post-48789">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">P.S.: Here is my validation. :)</div>
    <div class="meta">Posted on 2002-06-05 16:28:20 by bazik</div>
   </div>
   <div class="post" id="post-48778">
    <div class="subject"><a href="#post-48778">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body"><div class="quote"><br />Next for some reason he decided to bswap every single dword in the message. Nowhere in the algo description does it say the order is important, in fact since it should be read as a bit string you'd assume order is entirely unimportant.</div><br /><br />I'm not sure about SHA1, but SHA256 uses big endian convention (i.e. the left-most bit is in the most significant bit position), so you really have to bswap every dword.</div>
    <div class="meta">Posted on 2002-06-05 18:51:12 by Tola</div>
   </div>
   <div class="post" id="post-48783">
    <div class="subject"><a href="#post-48783">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">bAZik, thank you very much, its working! :alright:<br /><br />Tola, you're right of course. I still say it doesn't stress order in the algo description but if other implementations all generate the same hash code then I suppose I can't say that they're wrong.<br /><br />It annoys me however that the gnutella crowd blindly implemented the algo. They wouldn't need their hash codes to match SHA1, just that they would be consistent throughout the network. They should have optimised.<br /><br />bitRAKE, thanks again for that link I found the necessary file so I should be able to reproduce those BASE32 ascii strings.<br /><br />I'll post optimised code soon, but here's a little piece which I'm sure mmx could optimise, I just don't know how. It involves bswaping 16 dwords.<br /><pre><code>mov ecx,-16<br />sLp&#58;	mov eax,W&#91;16*4&#93;&#91;ecx*4&#93;<br />	bswap eax<br />	mov W&#91;16*4&#93;&#91;ecx*4&#93;,eax<br />inc ecx<br />jnz sLp</code></pre><br /><br />Thanks guys, ye were a great help. :stupid:</div>
    <div class="meta">Posted on 2002-06-05 19:43:10 by Eóin</div>
   </div>
   <div class="post" id="post-48793">
    <div class="subject"><a href="#post-48793">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">:) In my current lazy state, only this comes to mind:<pre><code>mov ecx,-8<br />sLp&#58;	mov eax,W&#91;16*4&#93;&#91;ecx*8&#93;<br />	mov edx,W&#91;16*4&#93;&#91;ecx*8&#93;&#91;4&#93;<br />	bswap eax<br />	bswap edx<br />	mov W&#91;16*4&#93;&#91;ecx*8&#93;,eax<br />	mov W&#91;16*4&#93;&#91;ecx*8&#93;&#91;4&#93;,edx<br />inc ecx<br />jnz sLp</code></pre></div>
    <div class="meta">Posted on 2002-06-05 20:08:15 by bitRAKE</div>
   </div>
   <div class="post" id="post-48784">
    <div class="subject"><a href="#post-48784">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">Yeah, I tried playing around with it on paper, but the pack and unpack instructions don't seem to be up to it, and I'd rather not use the shuffle instructions. Too limiting...<br /><br />So I guess I'll uses that one. Here's the final code if anyones interested. <br /><br /><span style="font-size:9px><pre><code>.data?<br />gFile dd ?<br />fSzeL dd ?<br />fSzeH dd ?<br />rSize dd ?<br /><br />H dd 5 dup &#40;?&#41;<br />W dd 80 dup &#40;?&#41;<br />T dd ?<br /><br />.code<br />HashFile Proc uses edi esi ebx ebp<br /><br />	invoke GetFileSize,gFile,addr fSzeH<br />	mov fSzeL,eax<br />	<br />	mov H&#91; 0&#93;,067452301h<br />	mov H&#91; 4&#93;,0EFCDAB89h<br />	mov H&#91; 8&#93;,098BADCFEh<br />	mov H&#91;12&#93;,010325476h<br />	mov H&#91;16&#93;,0C3D2E1F0h<br />	<br />	jmp mNx<br />mLp&#58;invoke ReadFile,gFile,addr W,64,addr rSize,0	<br />	call HashMessage<br /><br />mNx&#58;sub fSzeL,64<br />	jnb mLp<br />	cmp fSzeH,0<br />	jz  mEx<br />	dec fSzeH<br />	jmp mLp	<br />	<br />mEx&#58;mov ebx,fSzeL<br />	add ebx,64<br />	invoke ReadFile,gFile,addr W,ebx,addr rSize,0<br />	mov pb W&#91;ebx&#93;,80h<br />	<br />	sub ebx,64-&#40;8+1&#41;<br />	jbe mZo<br />	<br />	sub ebx,8<br />	jz  mHm<br />mFz&#58;and pb W&#91;64&#93;&#91;ebx&#93;,0	<br />	inc ebx<br />	js  mFz<br />	<br />mHm&#58;call HashMessage<br />	mov ebx,-56	<br />	jmp mFl<br />	<br />mZo&#58;jz  mSz<br />mFl&#58;and pb W&#91;64-8&#93;&#91;ebx&#93;,0<br />	inc ebx<br />	js  mFl<br /><br />mSz&#58;invoke GetFileSize,gFile,addr fSzeH<br />	mov ecx,8<br />	xor edx,edx<br />	mul ecx<br />	shl fSzeH,3<br />	or  edx,fSzeH<br />	<br />	bswap eax<br />	bswap edx<br />	mov W&#91;15*4&#93;,eax<br />	mov W&#91;14*4&#93;,edx<br />	call HashMessage<br />	<br />	mov eax,H&#91;0&#93;<br />	mov edx,H&#91;4&#93;<br />	mov ecx,H&#91;8&#93;<br />	bswap eax<br />	bswap edx<br />	bswap ecx<br />	mov H&#91;0&#93;,eax<br />	mov H&#91;4&#93;,edx<br />	mov H&#91;8&#93;,ecx<br />	<br />	mov eax,H&#91;12&#93;<br />	mov edx,H&#91;16&#93;<br />	bswap eax<br />	bswap edx<br />	mov H&#91;12&#93;,eax<br />	mov H&#91;16&#93;,edx<br />	<br />ret<br />HashFile EndP<br /><br />HashMessage Proc<br />	mov T,esp<br /><br />	mov ecx,-8<br />	sLp&#58;mov eax,W&#91;16*4&#93;&#91;ecx*8&#93;<br />		mov edx,W&#91;16*4&#93;&#91;ecx*8&#93;&#91;4&#93;<br />		bswap eax<br />		bswap edx<br />		mov W&#91;16*4&#93;&#91;ecx*8&#93;,eax<br />		mov W&#91;16*4&#93;&#91;ecx*8&#93;&#91;4&#93;,edx<br />	inc ecx<br />	jnz sLp<br /><br />	mov ecx,16-80<br />	tLp&#58;mov eax,W&#91;&#40;80-3&#41;*4&#93;&#91;ecx*4&#93;<br />		mov edx,W&#91;&#40;80-8&#41;*4&#93;&#91;ecx*4&#93;<br />		xor eax,W&#91;&#40;80-14&#41;*4&#93;&#91;ecx*4&#93;<br />		xor edx,W&#91;&#40;80-16&#41;*4&#93;&#91;ecx*4&#93;<br />		xor eax,edx<br />		rol eax,1<br />		mov W&#91;80*4&#93;&#91;ecx*4&#93;,eax<br />	inc ecx<br />	jnz tLp<br />	<br />	mov ebx,H&#91;0&#93;	;A<br />	mov esi,H&#91;4&#93;	;B<br />	mov edi,H&#91;8&#93;	;C<br />	mov ebp,H&#91;12&#93;	;D<br />	mov esp,H&#91;16&#93;	;E<br /><br />	mov ecx,-20<br />	aLp&#58;mov edx,esi<br />		mov eax,edi<br />		not edx<br />		and eax,esi<br />		and edx,ebp<br />		or  eax,edx<br />		<br />		add eax,W&#91;20*4&#93;&#91;ecx*4&#93;<br />		lea eax,&#91;eax&#93;&#91;esp&#93;&#91;05A827999h&#93;<br />		<br />		mov esp,ebp<br />		mov ebp,edi<br />		rol esi,30<br />		mov edi,esi<br />		mov esi,ebx	<br />		rol ebx,5<br />		add ebx,eax<br />	inc ecx<br />	jnz aLp		<br /><br />	mov ecx,-20<br />	bLp&#58;mov eax,esi<br />		mov edx,edi<br />		xor eax,ebp<br />		xor eax,edx<br />		<br />		add eax,W&#91;40*4&#93;&#91;ecx*4&#93;<br />		lea eax,&#91;eax&#93;&#91;esp&#93;&#91;06ED9EBA1h&#93;<br />		<br />		mov esp,ebp<br />		mov ebp,edi<br />		rol esi,30<br />		mov edi,esi<br />		mov esi,ebx	<br />		rol ebx,5<br />		add ebx,eax<br />	inc ecx<br />	jnz bLp		<br /><br />	mov ecx,-20<br />	cLp&#58;mov eax,edi<br />		mov edx,ebp<br />		or  eax,ebp<br />		and edx,edi<br />		and eax,esi<br />		or  eax,edx<br />		<br />		add eax,W&#91;60*4&#93;&#91;ecx*4&#93;<br />		lea eax,&#91;eax&#93;&#91;esp&#93;&#91;08F1BBCDCh&#93;<br />		<br />		mov esp,ebp<br />		mov ebp,edi<br />		rol esi,30<br />		mov edi,esi<br />		mov esi,ebx	<br />		rol ebx,5<br />		add ebx,eax<br />	inc ecx<br />	jnz cLp		<br /><br />	mov ecx,-20<br />	dLp&#58;mov eax,esi<br />		mov edx,edi<br />		xor eax,ebp<br />		xor eax,edx<br />		<br />		add eax,W&#91;80*4&#93;&#91;ecx*4&#93;<br />		lea eax,&#91;eax&#93;&#91;esp&#93;&#91;0CA62C1D6h&#93;<br />		<br />		mov esp,ebp<br />		mov ebp,edi<br />		rol esi,30<br />		mov edi,esi<br />		mov esi,ebx	<br />		rol ebx,5<br />		add ebx,eax<br />	inc ecx<br />	jnz dLp	<br /><br />	add H&#91;0&#93;,ebx<br />	add H&#91;4&#93;,esi<br />	add H&#91;8&#93;,edi<br />	add H&#91;12&#93;,ebp<br />	add H&#91;16&#93;,esp<br />	<br />	mov esp,T<br />ret<br />HashMessage EndP</code></pre></span><br /><br />Thanks every who helped</div>
    <div class="meta">Posted on 2002-06-05 20:37:20 by Eóin</div>
   </div>
   <div class="post" id="post-48785">
    <div class="subject"><a href="#post-48785">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">BTW, you really have to love the speed improvement you get for merely rewriting a C algo in Asm. ;)</div>
    <div class="meta">Posted on 2002-06-05 20:38:55 by Eóin</div>
   </div>
   <div class="post" id="post-48790">
    <div class="subject"><a href="#post-48790">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">E?in,<br />nice Tool that Hash Calculator, eh? :)<br />But I see 14 Algo's missing in your program... :grin: <br /><br />Would you mind if I use your Hash code in my Email program for validating the Messages? I already added GPG support, but not everyone wants to use this. So I would like to check it internally with SHA :) For now I use a PowerBASIC .dll with the above code... didnt have the time to covert it to ASM as your now did. <br /><br />Thanks again for sharing!</div>
    <div class="meta">Posted on 2002-06-06 00:59:27 by bazik</div>
   </div>
   <div class="post" id="post-48794">
    <div class="subject"><a href="#post-48794">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">I posted a ASM version of the RIPEMD-160 algo in this forum about a month ago.<br /><br />When I get round to it might see if it will benifit from a MMX version but I have this feeling it wont because of the structure of the code.</div>
    <div class="meta">Posted on 2002-06-06 01:57:55 by huh</div>
   </div>
   <div class="post" id="post-48791">
    <div class="subject"><a href="#post-48791">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body"><div class="quote"><br />BTW, you really have to love the speed improvement you get for merely rewriting a C algo in Asm. ;) </div><br /><br />Hehe, you are right...<br />But it's better I calculate a hash of every msg when it get added to the inbox. Hashing my whole Inbox is a bit slow....<br /><br />BTW, don't ask me again for releasing my Mail client. I'll do it, when I don't find any bugs for a week or so :)</div>
    <div class="meta">Posted on 2002-06-06 03:20:08 by bazik</div>
   </div>
   <div class="post" id="post-48786">
    <div class="subject"><a href="#post-48786">SHA1 - US Secure Hash Algorithm</a></div>
    <div class="body">By all means bAZik, use the code however you wish.<br /><br />As for actualy usage, hashing can be expensive, but you need only do it once then store the hashs for the various messages in a data file somewhere. After that you'd only need to hash message as they arrive.<br /><br />I'd recommend calling the hash code in its own thread with a low priority, this means the job stills gets done, but you won't see any real effect on system performance. By that I mean GUI reaction time, mp3 players, etc.<br /><br />I don't for sure if this is right but I always use the following code to achieve that.<br /><pre><code>invoke CreateThread,0,0,offset ThreadProc,0,NORMAL_PRIORITY_CLASS,addr tdd<br />mov ebx,eax<br />invoke SetThreadPriority,eax,THREAD_PRIORITY_LOWEST<br />invoke CloseHandle,ebx</code></pre></div>
    <div class="meta">Posted on 2002-06-06 09:12:37 by Eóin</div>
   </div>
  </div>
 </body>
</html>