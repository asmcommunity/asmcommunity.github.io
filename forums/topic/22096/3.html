<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>OOPSkinMesh question - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=22096" />
  <link rel="prev" href="../?id=22096&amp;page=2" />  <link rel="next" href="../?id=22096&amp;page=4" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=22096">OOPSkinMesh question</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=22096&amp;page=1" style="">&laquo;</a><a href="../?id=22096&amp;page=2" style="">&lt;</a><input type="hidden" name="id" value="22096" /><input type="number" name="page" min="1" max="4" step="1" value="3" onchange="this.form.submit();" /><a href="../?id=22096&amp;page=4">&gt;</a><a href="../?id=22096&amp;page=4">&raquo;</a></form>   <div class="post" id="post-169209">
    <div class="subject"><a href="#post-169209">Re: OOPSkinMesh question</a></div>
    <div class="body">We need to forget about the SkinMesh stuff for a while and get our application framework together.<br />Let&#39;s put on a brave face and examine the WinMain which appears next in the SDK sample.<br />We can see that it relies HEAVILY on stuff we haven&#39;t looked at yet, the DXUT application framework. Although it might be useful to totally translate the DXUT stuff too, I&#39;m not inclined to do so - rather, we will translate the DXUT stuff as we encounter it, so as to translate the minimum junk for this project.<br /><br /><pre><code><br />//--------------------------------------------------------------------------------------<br />// Entry point to the program. Initializes everything and goes into a message processing <br />// loop. Idle time is used to render the scene.<br />//--------------------------------------------------------------------------------------<br />INT WINAPI WinMain( HINSTANCE, HINSTANCE, LPSTR, int )<br />{<br />    // Enable run-time memory check for debug builds.<br />#if defined(DEBUG) | defined(_DEBUG)<br />    _CrtSetDbgFlag( _CRTDBG_ALLOC_MEM_DF | _CRTDBG_LEAK_CHECK_DF );<br />#endif<br /><br />    // Set the callback functions. These functions allow DXUT to notify<br />    // the application about device changes, user input, and windows messages.  The <br />    // callbacks are optional so you need only set callbacks for events you&#39;re interested <br />    // in. However, if you don&#39;t handle the device reset/lost callbacks then the sample <br />    // framework won&#39;t be able to reset your device since the application must first <br />    // release all device resources before resetting.  Likewise, if you don&#39;t handle the <br />    // device created/destroyed callbacks then DXUT won&#39;t be able to <br />    // recreate your device resources.<br />    DXUTSetCallbackDeviceCreated( OnCreateDevice );<br />    DXUTSetCallbackDeviceReset( OnResetDevice );<br />    DXUTSetCallbackDeviceLost( OnLostDevice );<br />    DXUTSetCallbackDeviceDestroyed( OnDestroyDevice );<br />    DXUTSetCallbackMsgProc( MsgProc );<br />    DXUTSetCallbackKeyboard( KeyboardProc );<br />    DXUTSetCallbackFrameRender( OnFrameRender );<br />    DXUTSetCallbackFrameMove( OnFrameMove );<br /><br />    // Show the cursor and clip it when in full screen<br />    DXUTSetCursorSettings( true, true );<br /><br />    InitApp();<br /><br />    // Initialize DXUT and create the desired Win32 window and Direct3D <br />    // device for the application. Calling each of these functions is optional, but they<br />    // allow you to set several options which control the behavior of the framework.<br />    DXUTInit( true, true, true ); // Parse the command line, handle the default hotkeys, and show msgboxes<br />    DXUTCreateWindow( L&quot;Skinned Mesh&quot; );<br /><br />    // Supports all types of vertex processing, including mixed.<br />    DXUTGetEnumeration()-&gt;SetPossibleVertexProcessingList( true, true, true, true );<br /><br />    DXUTCreateDevice( D3DADAPTER_DEFAULT, true, 640, 480, IsDeviceAcceptable, ModifyDeviceSettings );<br /><br />    // Pass control to DXUT for handling the message pump and <br />    // dispatching render calls. DXUT will call your FrameMove <br />    // and FrameRender callback when there is idle time between handling window messages.<br />    DXUTMainLoop();<br /><br />    // Perform any application-level cleanup here. Direct3D device resources are released within the<br />    // appropriate callback functions and therefore don&#39;t require any cleanup code here.<br />    ReleaseAttributeTable( g_pFrameRoot );<br />    delete&#91;] g_pBoneMatrices;<br /><br />    return DXUTGetExitCode();<br />}<br /></code></pre><br /><br />Our version must look a lot like this:<br /><pre><code><br /><br />WinMain proc hInst, hInst, pString, dwVal<br /><br />    ; Set the callback functions. These functions allow DXUT to notify<br />    ; the application about device changes, user input, and windows messages.  The <br />    ; callbacks are optional so you need only set callbacks for events you&#39;re interested <br />    ; in. However, if you don&#39;t handle the device reset/lost callbacks then the sample <br />    ; framework won&#39;t be able to reset your device since the application must first <br />    ; release all device resources before resetting.  Likewise, if you don&#39;t handle the <br />    ; device created/destroyed callbacks then DXUT won&#39;t be able to <br />    ; recreate your device resources.<br />    invoke DXUTSetCallbackDeviceCreated, addr OnCreateDevice<br />    invoke DXUTSetCallbackDeviceReset, addr  OnResetDevice<br />    invoke DXUTSetCallbackDeviceLost, addr OnLostDevice <br />    invoke DXUTSetCallbackDeviceDestroyed, addr OnDestroyDevice <br />    invoke DXUTSetCallbackMsgProc, addr MsgProc <br />    invoke DXUTSetCallbackKeyboard, addr KeyboardProc <br />    invoke DXUTSetCallbackFrameRender, addr OnFrameRender <br />    invoke DXUTSetCallbackFrameMove, addr OnFrameMove <br /><br />    ; Show the cursor and clip it when in full screen<br />    invoke DXUTSetCursorSettings,TRUE,TRUE<br /><br />    invoke InitApp<br /><br />    ; Initialize DXUT and create the desired Win32 window and Direct3D <br />    ; device for the application. Calling each of these functions is optional, but they<br />    ; allow you to set several options which control the behavior of the framework.<br />    invoke DXUTInit,TRUE,TRUE,TRUE ;  Parse the command line, handle the default hotkeys, and show msgboxes<br />    .data<br />    sztitle db &quot;Skinned Mesh&quot;,0<br />    .code<br />    invoke DXUTCreateWindow,addr sztitle<br /><br />    ; Supports all types of vertex processing, including mixed.<br />    invoke DXUTGetEnumeration<br />    OCall eax::CD3DEnumeration.SetPossibleVertexProcessingList, TRUE,TRUE,TRUE,TRUE<br /><br />    invoke DXUTCreateDevice, D3DADAPTER_DEFAULT, TRUE,640, 480, IsDeviceAcceptable, ModifyDeviceSettings<br /><br />    ; Pass control to DXUT for handling the message pump and <br />    ; dispatching render calls. DXUT will call your FrameMove <br />    ; and FrameRender callback when there is idle time between handling window messages.<br />    invoke DXUTMainLoop<br /><br />    ; Perform any application-level cleanup here. Direct3D device resources are released within the<br />    ; appropriate callback functions and therefore don&#39;t require any cleanup code here.<br />    ReleaseAttributeTable g_pFrameRoot<br />    MemFree g_pBoneMatrices;<br />    invoke DXUTGetExitCode<br />    ret<br />WinMain endp<br /></code></pre><br /><br />Yeah, what a mess of unimplemented stuff, huh?<br />What the above really does is create our main window, enter the messagepump loop, wait for a quit, then clean up.<br />We&#39;ve got a bit of work to do in order to implement this awful stuff.<br />Is it just me, or do microsoft like ugly names??<br />I am going to stop right now.<br />I would like to know who is following this stuff, so I can make a decision regarding how light our framework should be.<br /><br />If you are keen to see this project unfold any further, say so now.<br /></div>
    <div class="meta">Posted on 2005-12-28 04:21:54 by Homer</div>
   </div>
   <div class="post" id="post-169212">
    <div class="subject"><a href="#post-169212">Re: OOPSkinMesh question</a></div>
    <div class="body">Tick Tock... (I can feel myself rot)...</div>
    <div class="meta">Posted on 2005-12-28 07:30:31 by Homer</div>
   </div>
   <div class="post" id="post-169213">
    <div class="subject"><a href="#post-169213">Re: OOPSkinMesh question</a></div>
    <div class="body">Amaizing work. I&#39;m putting all peaces together...<br />As for the string allocation, you can use StrNew or StrAlloc from the ObjMem32 library.<br /><br />Biterider<br /></div>
    <div class="meta">Posted on 2005-12-28 07:37:01 by Biterider</div>
   </div>
   <div class="post" id="post-169214">
    <div class="subject"><a href="#post-169214">Re: OOPSkinMesh question</a></div>
    <div class="body">Thanks for the heads up Biterider - do these just wrap an invocation of MemAlloc, or do they call the COM SysAllocString thingy?</div>
    <div class="meta">Posted on 2005-12-28 07:48:48 by Homer</div>
   </div>
   <div class="post" id="post-169215">
    <div class="subject"><a href="#post-169215">Re: OOPSkinMesh question</a></div>
    <div class="body">PS Biterider - happy to see you are watching this, I&#39;ll be screaming for help when this version fails - I am willing to send you the existing (and much cleaner) SkinMesh oa32 class as it stands, basically I think its failing me because I miss one stage of matrix multiplication at the scene root..<br />Hey, you wanna scrap both our D3DApp classes and translate the DX9 sample framework?<br />It&#39;s ugly as hell, but implementing it may provide some impetus for your model..<br /><br />Oh yeah, I downloaded the December SDK today - it sucks.. lol<br />Theres a bunch of DX10 samples, but you need to have Longhorn (Vista) OS and you also need a graphic card that isn&#39;t publically available - pretty useful to most devs I imagine..</div>
    <div class="meta">Posted on 2005-12-28 07:53:12 by Homer</div>
   </div>
   <div class="post" id="post-169242">
    <div class="subject"><a href="#post-169242">Re: OOPSkinMesh question</a></div>
    <div class="body">Hi Homer,<br /><br /><div class="quote">I have spent my time translating the &quot;Modular SkinMesh&quot; source posted at flipcode.org, which is basically a modified version of the sdk skinmesh sample.. the author has moved a bunch of stuff around in order to make the skinmesh class less closely associated with the SDK Sample and more useful as a generic skinmesh class.<br />Of course, there&#39;s no binary included, because the bloody thing doesn&#39;t work.</div><br /><br />It&#39;s a pitty flipcode.org&#39;s activities have been stopped, but at least the information it contained is still available.<br />In the &quot;Featered Articles&quot; section of the site, I saw Phil Taylor&#39;s 2 articles:<br />&quot;Modular D3D SkinnedMesh&quot; and &quot;SkinnedMesh DPlay Maze&quot;.<br />His approach seems good to me. And in fact that&#39;s what we want to: A reusable SkinnedMesh class.<br />I can feel your frustration, when your translation of it didn&#39;t work.<br /><br />But what about your conclusion: &quot;There&#39;s no binary included, because the thing doesn&#39;t work&quot;?<br />I can&#39;t imagine that his example couldn&#39;t be compiled. The article even mentions David Jurado&#39;s updated version of it.<br />My conclusion is: Couldn&#39;t there be a small inaccuracy in your translation?<br /><br />Friendly regards,<br />mdevries.</div>
    <div class="meta">Posted on 2005-12-30 01:51:48 by mdevries</div>
   </div>
   <div class="post" id="post-169243">
    <div class="subject"><a href="#post-169243">Re: OOPSkinMesh question</a></div>
    <div class="body">Hi Homer,<br /><br /><div class="quote">I suggest that it might be mutually beneficial to translate the original DX9 SDK skinmesh sample here, in public, with the hope that more eyes mean less bugfixes, and so that you guys can see what is involved in translating a cpp source to oa32.</div><br /><br />This direct approach is a good idea from education point of view.<br /><br />I hope it attracts some people. And isn&#39;t it now, then maybe in the future.<br />You never know who will be interested some day.<br /><br />Friendly regards,<br />mdevries.</div>
    <div class="meta">Posted on 2005-12-30 01:59:15 by mdevries</div>
   </div>
   <div class="post" id="post-169244">
    <div class="subject"><a href="#post-169244">Re: OOPSkinMesh question</a></div>
    <div class="body">Hi Homer,<br /><br /><div class="quote">That being said, I feel a linear approach to the translation of the sample code is warranted.<br />Unless someone can tell me why I should not, I will begin posting slabs of the original file, in order of appearance, and follow each with the oa32 translation of it.</div><br /><br />This approach has the advantage everyone can follow you directly from the SDK. So it&#39;s clear what is ahead of us.<br />But our goal must remain: a reusable SkinnedMesh class.<br /><br />Friendly regards,<br />mdevries.</div>
    <div class="meta">Posted on 2005-12-30 02:03:40 by mdevries</div>
   </div>
   <div class="post" id="post-169245">
    <div class="subject"><a href="#post-169245">Re: OOPSkinMesh question</a></div>
    <div class="body">Hi Homer/Biterider,<br /><br /><div class="quote">Note that when we define objects with OA32, we should declare a unique &quot;class identifier&quot;.<br />The value of CAllocateHierarchyID is totally arbitrary, I tend to invent random numbers and hope that they don&#39;t collide with existing OA32 class identifiers </div> <br /><br />You mention the problem: Colliding with used OA32 class identifiers.<br />Is there a logic in the way OA32 uses class identifiers?<br /><br />Friendly regards,<br />mdevries.</div>
    <div class="meta">Posted on 2005-12-30 02:12:15 by mdevries</div>
   </div>
   <div class="post" id="post-169246">
    <div class="subject"><a href="#post-169246">Re: OOPSkinMesh question</a></div>
    <div class="body">Hi Homer,<br /><br /><div class="quote">In the Modular version I originally translated, a lot of these fields had been moved into the SkinMesh class instead of being global like this.</div><br /><br />I can imagine. If you have more than one instance of the same SkinMesh class, each one of them should have it&#39;s own set of variables.<br /><br />Friendly regards,<br />mdevries.</div>
    <div class="meta">Posted on 2005-12-30 02:16:41 by mdevries</div>
   </div>
   <div class="post" id="post-169247">
    <div class="subject"><a href="#post-169247">Re: OOPSkinMesh question</a></div>
    <div class="body">Hi Homer,<br /><br /><div class="quote">Our version of this procedure uses OA32&#39;s MemAlloc macro.<br />More specifically, I use $MemAlloc, which is a lot like $invoke..<br />MemAlloc allocates memory on the Process Heap.<br />This may not be the best place to shove strings, but it&#39;ll do the job.<br />Right now I&#39;m not concerned about efficiency, just wanna make it work.</div><br /><br />In the passed years you have tried hard to make the animated SkinnedMesh work.<br />I can understand you first want to make it work.<br />Making the code more efficient can always be done at a later moment in time.<br /><br />Friendly regards,<br />mdevries.</div>
    <div class="meta">Posted on 2005-12-30 02:20:56 by mdevries</div>
   </div>
   <div class="post" id="post-169248">
    <div class="subject"><a href="#post-169248">Re: OOPSkinMesh question</a></div>
    <div class="body">Hi Homer,<br /><br /><div class="quote">Here&#39;s the original version of the CreateMeshContainer method.<br />It will look scary at first, but there&#39;s nothing to be afraid of..</div><br /><br />It looks scary at first, indeed. But the translation is rather straight forward, as I can see.<br /><br />Friendly regards,<br />mdevries.</div>
    <div class="meta">Posted on 2005-12-30 02:27:46 by mdevries</div>
   </div>
   <div class="post" id="post-169249">
    <div class="subject"><a href="#post-169249">Re: OOPSkinMesh question</a></div>
    <div class="body">Hi Homer,<br /><br /><div class="quote">We have arrived at WinMain in the SDK sample.<br /><br />From here on, things will be weird, because we will attempt to avoid implementing mountains of unnecessary generic app support code.<br /><br />Things are also weird because the application-specific code and the skinmesh code are presented together, whereas we would ultimately like to separate SkinMesh class code from the application junk, so that we have a reusable SkinMesh class object we can instance in future apps.. </div> <br /><br />Not implementing unnecessary generic app support code is good. It makes the code less massive at the moment. <br />But as you saw in the translation of Phil Taylor&#39;s version of the SDK Sample, it may not be working at first.<br />Why not translating the sample as it is. And when it works, you can move stuff around to make the code more like want it to be: Reusable SkinnedMesh code.<br /><br />Friendly regards,<br />mdevries.</div>
    <div class="meta">Posted on 2005-12-30 02:39:52 by mdevries</div>
   </div>
   <div class="post" id="post-169250">
    <div class="subject"><a href="#post-169250">Re: OOPSkinMesh question</a></div>
    <div class="body">Hi Homer,<br /><br /><div class="quote">If you are keen to see this project unfold any further, say so now.</div><br /><br /><div class="quote">Tick Tock... (I can feel myself rot)...</div><br /><br />You know my answer, don&#39;t you? But I can&#39;t always be online.<br />So be patient. If noone answers within a few hours, it doesn&#39;t mean you are doing it for nothing.<br />Just keep up the good work. I respect your knowledge and skill on this subject.<br /><br />Friendly regards,<br />mdevries.</div>
    <div class="meta">Posted on 2005-12-30 02:46:49 by mdevries</div>
   </div>
   <div class="post" id="post-169251">
    <div class="subject"><a href="#post-169251">Re: OOPSkinMesh question</a></div>
    <div class="body">Hi mdevries,<br /><br />STOP SPAMMING THE BOARD. All of your previous posts could have been combined into one, please use common sense with utilizing these forums.</div>
    <div class="meta">Posted on 2005-12-30 02:59:20 by SpooK</div>
   </div>
   <div class="post" id="post-169252">
    <div class="subject"><a href="#post-169252">Re: OOPSkinMesh question</a></div>
    <div class="body">Hi Spook,<br /><br />Thanks for your correction. I&#39;ll keep it in mind. <br /><br />B.t.w. Thanks for unlocking the incidentally Locking stage of this topic.<br /><br />Friendly regards,<br />mdevries.</div>
    <div class="meta">Posted on 2005-12-30 03:05:32 by mdevries</div>
   </div>
   <div class="post" id="post-169256">
    <div class="subject"><a href="#post-169256">Re: OOPSkinMesh question</a></div>
    <div class="body">Hi mdevries<br />The class identifier is a distinctive and unique ID for this class. It is used in several places to identify an unknown object instance. I.e. it is used when you retrieve an object from a Stream. The code implementation reads this ID from the stream and then it knows how to recreate the object. Another use of these IDs is the error reporting strategy used in ObjAsm32.<br />These IDs should be unique, at least in an application. If the compiler detects an ID collision, it reports an error. For all objects included in the package, the IDs are concentrated in a file called ObjIDs.inc in the …\Code\Objects directory. It is a good practice to put user defined IDs in a separate file, since in future releases, this file could be overridden.<br /><br />Regards<br /><br />Biterider<br /></div>
    <div class="meta">Posted on 2005-12-30 09:45:46 by Biterider</div>
   </div>
   <div class="post" id="post-169257">
    <div class="subject"><a href="#post-169257">Re: OOPSkinMesh question</a></div>
    <div class="body">I&#39;m convinced that there was no error in my translation of the modular skinmesh code. I have provided biterider with a copy of it in order to verify this according to my belief that many eyes make code work. I believe the problem was in my implementation of the scene root, whose transformation matrix is inherited by the entire hierarchy in one way or another.<br />Today, in order to confirm this conviction, and out of boredom, I wrote a MeshManager class which can maintain N instances of a static mesh. It works fine, so I must accept that the problem is NOT in the mesh loading or rendering code, it is in the matrix transformations.<br />Having studied the SDK sample&#39;s gui framework for a couple of days, I must reiterate that I am not inclined to translate the whole lot in a braindead fashion. My own gui framework, and biteriders, are equal if not superior to the SDK version. What I will do is translate and implement various elements of the SDK gui framework as they are needed, and as I see fit.. for example, I&#39;ve already translated the CD3DArcBall camera support class.<br />I wanted to have the skinmesh stuff working before the end of the year, but that&#39;s unlikely now.<br />Ah well, I am nevertheless determined to make it work, and I believe I will.<br />I&#39;ll post all related code next year (in the coming days) for anyone who is interested.<br /></div>
    <div class="meta">Posted on 2005-12-30 10:43:43 by Homer</div>
   </div>
   <div class="post" id="post-169258">
    <div class="subject"><a href="#post-169258">Re: OOPSkinMesh question</a></div>
    <div class="body"><div class="quote"><br />I&#39;m convinced that there was no error in my translation of the modular skinmesh code. I have provided biterider with a copy of it in order to verify this according to my belief that many eyes make code work. I believe the problem was in my implementation of the scene root, whose transformation matrix is inherited by the entire hierarchy in one way or another.<br />Today, in order to confirm this conviction, and out of boredom, I wrote a MeshManager class which can maintain N instances of a static mesh. It works fine, so I must accept that the problem is NOT in the mesh loading or rendering code, it is in the matrix transformations.<br />Having studied the SDK sample&#39;s gui framework for a couple of days, I must reiterate that I am not inclined to translate the whole lot in a braindead fashion. My own gui framework, and biteriders, are equal if not superior to the SDK version. What I will do is translate and implement various elements of the SDK gui framework as they are needed, and as I see fit.. for example, I&#39;ve already translated the CD3DArcBall camera support class.<br />I wanted to have the skinmesh stuff working before the end of the year, but that&#39;s unlikely now.<br />Ah well, I am nevertheless determined to make it work, and I believe I will.<br />I&#39;ll post all related code next year (in the coming days) for anyone who is interested.<br /><br /></div><br />I will look forward to see your great work, now see if I can succed and post some animation code, next year, until then happy new year Homer<br /></div>
    <div class="meta">Posted on 2005-12-30 12:48:03 by daydreamer</div>
   </div>
   <div class="post" id="post-169350">
    <div class="subject"><a href="#post-169350">Re: OOPSkinMesh question</a></div>
    <div class="body">I succeeded with animation code - I can load a skinmesh model&#39;s frame hierarchy and all its animation data and I can animate it, but I can&#39;t render it.<br />I get a jumble of animated triangles, which some other authors describe seeing when they &quot;forget to call the UpdateMatrices method&quot;.<br />It must be damn close to being right, I bet its some small bug I&#39;m overlooking.<br /><br /></div>
    <div class="meta">Posted on 2006-01-05 08:58:21 by Homer</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=22096&amp;page=1" style="">&laquo;</a><a href="../?id=22096&amp;page=2" style="">&lt;</a><input type="hidden" name="id" value="22096" /><input type="number" name="page" min="1" max="4" step="1" value="3" onchange="this.form.submit();" /><a href="../?id=22096&amp;page=4">&gt;</a><a href="../?id=22096&amp;page=4">&raquo;</a></form>  </div>
 </body>
</html>