<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>&quot;Relocation truncatted to fit ....&quot; problem. - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=28936" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=117">Unix</a> &raquo; <a href="../?id=28936">&quot;Relocation truncatted to fit ....&quot; problem.</a></p>
   <div class="post" id="post-204601">
    <div class="subject"><a href="#post-204601">&quot;Relocation truncatted to fit ....&quot; problem.</a></div>
    <div class="body">I am compiling the below small code with GNU AS on Linux. The compile command is: <br /><br />gcc -nostdlib a.s<br /><br />And it reports the error &quot;relocation truncatted to fit R_386_16 in .text&quot;. And the problem caused by the line &quot;movw ax, $ok_msg&quot;. Anybody please tell me how to fix this?<br /><br />(The code must be in 16bit because I want to run it in Real-mode in x86)<br /><br />Thanks,<br />Jun<br /><br /><br />/* a.s */<br />.text<br />.global _start<br /><br />_start:<br />&nbsp; &nbsp; &nbsp; &nbsp; .code16<br />&nbsp; &nbsp; &nbsp; &nbsp; movw $ok_msg, %ax	/* &lt;=== WHY THIS CAUSES A BUG? */<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br /><br />ok_msg: .string &quot;OK\n&quot;<br /></div>
    <div class="meta">Posted on 2008-01-23 20:39:13 by junkoi</div>
   </div>
   <div class="post" id="post-204602">
    <div class="subject"><a href="#post-204602">Re: &quot;Relocation truncatted to fit ....&quot; problem.</a></div>
    <div class="body">Link: <a target="_blank" href="http://www.gnu.org/software/binutils/manual/gas-2.9.1/html_chapter/as_16.html#SEC205">GAS: &quot;Writing 16-bit Code&quot;</a></div>
    <div class="meta">Posted on 2008-01-23 20:54:47 by SpooK</div>
   </div>
   <div class="post" id="post-204603">
    <div class="subject"><a href="#post-204603">Re: &quot;Relocation truncatted to fit ....&quot; problem.</a></div>
    <div class="body"><div class="quote"><br />Link: <a target="_blank" href="http://www.gnu.org/software/binutils/manual/gas-2.9.1/html_chapter/as_16.html#SEC205">GAS: &quot;Writing 16-bit Code&quot;</a><br /></div><br /><br />I think my code already followed the guide, in which I inserted &quot;.code16&quot;.<br /><br />I notice a line from the above link though: &quot;... So you can write code that runs on 16-bit processors, but only if that code never references memory.&quot;<br /><br />Is that the reason why my code fails to do &quot;movw ax, $ok_msg&quot;???<br /><br />That still doesnt make sense to me though. <br /><br />Do you have any idea on how to fix it?<br /><br />Thanks.<br />Jun</div>
    <div class="meta">Posted on 2008-01-23 21:04:06 by junkoi</div>
   </div>
   <div class="post" id="post-204607">
    <div class="subject"><a href="#post-204607">Re: &quot;Relocation truncatted to fit ....&quot; problem.</a></div>
    <div class="body">If you want to write 16-bit code, you&#039;re better off using <a target="_blank" href="http://www.flatassembler.net">fasm</a> or <a target="_blank" href="http://nasm.sourceforge.net/">nasm</a>. GAS is primarily written to be a GCC back-end, and GCC is primarily focused on 32- and 64-bit CPUs.<br /><br />FASM can directly output 16-bit .com and .exe without any linker, as well as a lot of other formats. NASM is a bit more standard and a bit more portable, but requires you to either write .com or find a 16-bit linker for .exe.<br /></div>
    <div class="meta">Posted on 2008-01-24 05:07:45 by f0dder</div>
   </div>
  </div>
 </body>
</html>