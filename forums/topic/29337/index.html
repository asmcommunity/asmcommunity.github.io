<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>owner drawn menu and the left mouse button - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29337" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29337">owner drawn menu and the left mouse button</a></p>
   <div class="post" id="post-207198">
    <div class="subject"><a href="#post-207198">owner drawn menu and the left mouse button</a></div>
    <div class="body">hi i hope someone can help me<br />im having a owner drawn popupmenu when i right click my mouse.<br />now when i do this&nbsp; .if .itemID == IDM_MNU_SETUP in my code then when i hover the mouse over it it closes<br />my menu but i want it to close when i click my left mouse button.this is in my window proc<br />i hope it is not to much code but thanks for the reply<br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.elseif uMsg == WM_DRAWITEM<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov edi, bParam<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assume edi:ptr DRAWITEMSTRUCT<br /><br />&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .if aParam == 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov edi, bParam<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assume edi:ptr DRAWITEMSTRUCT<br /><br /><br />				; Prep Menu DC<br />					invoke SetBkMode, .hdc, TRANSPARENT<br />					invoke SelectObject, .hdc, hMnuFont<br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; *******************************************************<br />				&nbsp; &nbsp; ; ******************* DRAW BACKGROUND *******************<br />				&nbsp; &nbsp; ; *******************************************************<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .if .itemState &amp; ODS_SELECTED<br />&nbsp; 					;.endif	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;	<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .if .itemState &amp; ODS_DISABLED<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke GetSysColor, COLOR_MENU<br />&nbsp; 						&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SetTextColor,.hdc, eax<br />&nbsp; 						&nbsp; &nbsp; .else<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke GetSysColor, COLOR_HIGHLIGHTTEXT<br />&nbsp; 						&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SetTextColor,.hdc, eax<br />						&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; .if(.itemAction==ODA_SELECT)<br />						&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; .if .hwndItem== offset hMainMnu<br />						&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;invoke MessageBox,hWin,addr AppName,ADDR AppName,MB_OK +MB_ICONINFORMATION <br /> 										;.<br />						&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .if .itemData &amp; IDM_MNU_SETUP&nbsp; &nbsp;; deze is goed<br />						&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;invoke MessageBox,hWin,addr AppName,ADDR AppName,MB_OK +MB_ICONINFORMATION <br />.endif<br />						&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />;.endif						&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;.endif<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax, .rcItem.left<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add eax, 22<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke BitBlt, .hdc, eax, .rcItem.top, 129, 20, hMem_Hilite_DC, 0, 0, SRCCOPY<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;&nbsp; &nbsp;.else<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .if .itemState &amp; ODS_DISABLED<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke GetSysColor, COLOR_GRAYTEXT<br />&nbsp; 						&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SetTextColor,.hdc, eax<br />&nbsp; 						&nbsp; &nbsp; .else<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke GetSysColor, COLOR_MENUTEXT<br />&nbsp; 						&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SetTextColor,.hdc, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .endif<br />&nbsp; 						<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke GetSysColorBrush, COLOR_MENU&nbsp; &nbsp; <br />&nbsp; 						&nbsp; &nbsp; invoke SelectObject, .hdc, eax<br />&nbsp; 							<br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax, .rcItem.bottom<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub eax, .rcItem.top<br /><br />&nbsp; 						&nbsp; &nbsp; invoke PatBlt, .hdc, .rcItem.left, .rcItem.top, .rcItem.right, eax, PATCOPY<br />&nbsp; 				&nbsp; .endif	<br /><br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ****************************************************<br />				; ******************* DRAW CONTENT *******************<br />				; ****************************************************<br /><br /><br /><br /><br />					.if .itemState &amp; ODS_CHECKED<br /><br />							invoke LoadImage, hInstance, 1020, IMAGE_ICON, 16, 16, LR_DEFAULTCOLOR<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov hmnuIcon, eax<br /><br />&nbsp; 					.else<br />&nbsp; <br />&nbsp; 							.if .itemState &amp; ODS_DISABLED<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax, .itemID<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add eax, 1<br /><br />&nbsp; 									invoke LoadImage, hInstance, eax, IMAGE_ICON, 16, 16, LR_DEFAULTCOLOR<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov hmnuIcon, eax<br /><br />							.else<br />&nbsp; 									invoke LoadImage, hInstance, .itemID, IMAGE_ICON, 16, 16, LR_DEFAULTCOLOR<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov hmnuIcon, eax<br />&nbsp; 									<br />&nbsp; 									.if (hmnuIcon != 0) &amp;&amp; (.itemState &amp; ODS_FOCUS) <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;			<br />&nbsp; &nbsp; &nbsp; &nbsp; 					;mov nFlag,0												; als de linker muis button is geklikt zet de vlag op 1 zodat de foto getoond wordt<br /> 	&nbsp; &nbsp; &nbsp; 				;invoke InvalidateRect,hWin,NULL,TRUE&nbsp; 						 <br /> 				<br /><br />&nbsp; 									;<br />&nbsp; &nbsp; 									<br />&nbsp; 									;.IF(ODA_SELECT==0)<br />;{<br />;if((dis.itemState &amp; ODS_SELECTED))<br />;{<br />;SelectObject(g_hButtonDC, (HBITMAP)g_hButtonPushedBmp);<br />;}<br /><br />&nbsp; 										mov eax,.itemID<br />&nbsp; 										mov t,eax<br />&nbsp; 										<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax, .rcItem.left<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add eax, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; .if&nbsp; ODS_FOCUS &amp;&amp; ODS_SELECTED&nbsp; &nbsp;;;&nbsp; &nbsp;HIER NOG VERDER AAN WERKEN<br />&nbsp; 						&nbsp; &nbsp; &nbsp;;&nbsp; &nbsp; &nbsp; &nbsp;invoke MessageBox,hWin,hMem_Box_DC,offset AppName,MB_OK	<br />&nbsp; 						&nbsp; &nbsp; &nbsp;.endif<br />&nbsp; 									.endif<br />&nbsp; 							;		.ENDIF<br />&nbsp; 							;.endif<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke BitBlt, .hdc, eax, .rcItem.top, 20, 20, hMem_Box_DC, 0, 0, SRCCOPY<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />					.endif<br /><br /><br /><br />					.if ( hmnuIcon != 0 )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax, .rcItem.top<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add eax, 2<br />						invoke DrawIconEx, .hdc, 3, eax, hmnuIcon, 16, 16, 0, 0, DI_NORMAL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .endif<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push 26<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop .rcItem.left<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke lstrlen, .itemData<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov .itemAction, eax<br /><br />					invoke DrawText, .hdc, .itemData, .itemAction, ADDR .rcItem, DT_SINGLELINE or DT_NOCLIP or DT_VCENTER <br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke GetStockObject, BLACK_BRUSH<br />					invoke SelectObject, .hdc, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke GetStockObject, BLACK_PEN<br />					invoke SelectObject, .hdc, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke GetStockObject, DEFAULT_GUI_FONT<br />					invoke SelectObject, .hdc, eax<br />					invoke DestroyIcon, hmnuIcon<br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .endif			<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />invoke InvalidateRect,hWin,NULL,TRUE&nbsp; <br />;<br />Solved thank you for reply</div>
    <div class="meta">Posted on 2009-03-31 05:03:15 by rilm</div>
   </div>
   <div class="post" id="post-207199">
    <div class="subject"><a href="#post-207199">Re: owner drawn menu and the left mouse button</a></div>
    <div class="body">Where is this <pre><code>.if .itemID == IDM_MNU_SETUP</code></pre> located? You need to post a little more of your code.</div>
    <div class="meta">Posted on 2009-03-31 07:59:29 by JimmyClif</div>
   </div>
  </div>
 </body>
</html>