<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Choose Pixel Format always fails - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=6296" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=6296">Choose Pixel Format always fails</a></p>
   <div class="post" id="post-45284">
    <div class="subject"><a href="#post-45284">Choose Pixel Format always fails</a></div>
    <div class="body">While i learned OpenGL, i never checked for any errors. Now im writing a &quot;shell&quot; app to use that will check for as many error as possible. When i wasnt checking for errors, ChoosPixelFormat would work. Or at least if it failed i didnt know it, and the OpenGL app would still work. Now that i check to make sure it doesnt fail, it always does. Ill post the code i use to choose a pixel format, maybe theres something wrong in it. Is there anywhere else in a windows opengl app that would affect choosing a pixel format? Like somthing in the window class structure or something?<br /><br /><pre><code>int choosePixelFormat&#40;&#41;<br />&#123;<br />	PIXELFORMATDESCRIPTOR pfd;<br /><br />	pfd.cColorBits		= 16;<br />	pfd.cDepthBits		= 16;<br />	pfd.dwFlags			= PFD_DRAW_TO_WINDOW | PFD_SUPPORT_OPENGL | PFD_DOUBLEBUFFER;<br />	pfd.iLayerType		= PFD_MAIN_PLANE;<br />	pfd.iPixelType		= PFD_TYPE_RGBA;<br />	pfd.nSize			= sizeof&#40;pfd&#41;;<br />	pfd.nVersion		= 1;<br />	if&#40;&#40;pixelFormatWndGL = &#58;&#58;ChoosePixelFormat&#40;hDCWndGL, &amp;pfd&#41;&#41; == 0&#41;<br />	&#123;<br />		&#58;&#58;MessageBox&#40;NULL, &quot;Failure choosing pixel format.&quot;, appTitle, MB_OK | MB_ICONERROR&#41;;<br />		return&#40;1&#41;;<br />	&#125;<br /><br />	return&#40;0&#41;;<br />&#125;</code></pre></div>
    <div class="meta">Posted on 2002-06-26 12:23:39 by ChimpFace9000</div>
   </div>
   <div class="post" id="post-45289">
    <div class="subject"><a href="#post-45289">Choose Pixel Format always fails</a></div>
    <div class="body">By the way, im doing all the opengl initilization in the WM_CREATE message, should it be done some where else?</div>
    <div class="meta">Posted on 2002-06-26 13:31:07 by ChimpFace9000</div>
   </div>
   <div class="post" id="post-45316">
    <div class="subject"><a href="#post-45316">Choose Pixel Format always fails</a></div>
    <div class="body">We are doing all inits before message loop is started in HE but we use DX, OpenGL window init and/or switch context has always been unreliable IMO</div>
    <div class="meta">Posted on 2002-06-26 18:14:16 by BogdanOntanu</div>
   </div>
   <div class="post" id="post-45320">
    <div class="subject"><a href="#post-45320">Choose Pixel Format always fails</a></div>
    <div class="body">Actually i think its a problem with windows 98. Ill post the code and the binary. Could people give it a try and tell me what version of windows they are using, and if they got any errors. Thanks.<br /><br /><pre><code>Code deleted</code></pre><br /><br />Just get rid of the .txt on the exe. Id post the whole project, but i dont have winzip.<br /><br />[ Attachment deleted ]</div>
    <div class="meta">Posted on 2002-06-26 18:57:06 by ChimpFace9000</div>
   </div>
   <div class="post" id="post-45359">
    <div class="subject"><a href="#post-45359">Choose Pixel Format always fails</a></div>
    <div class="body">Ok, i download winzip and heres the whole project.</div>
    <div class="meta">Posted on 2002-06-27 04:46:37 by ChimpFace9000</div>
   </div>
   <div class="post" id="post-45382">
    <div class="subject"><a href="#post-45382">Choose Pixel Format always fails</a></div>
    <div class="body">Afternoon, ChimpFace9000.<br /><br />I used GetLastError just after ChoosePixelFormat.<br />It returned 126 as the error code.<br />My docs says that this means &quot;The specified module could not be found.&quot;.<br /><br />I wouldn't have a clue as to what &quot;module&quot; it's talking about :grin:<br /><br />Cheers,<br />Scronty</div>
    <div class="meta">Posted on 2002-06-27 06:56:39 by Scronty</div>
   </div>
   <div class="post" id="post-45438">
    <div class="subject"><a href="#post-45438">Choose Pixel Format always fails</a></div>
    <div class="body">I looked at the game dev forums, and people who had the same problem said get last error returned that and none of them had any idea what that meant.<br /><br />I wrote to NeHe about the problem, he said try changing the bit depth of my desktop to match the bit depth in my code. And update my drivers. So im off to try that.</div>
    <div class="meta">Posted on 2002-06-27 13:02:12 by ChimpFace9000</div>
   </div>
   <div class="post" id="post-45453">
    <div class="subject"><a href="#post-45453">Choose Pixel Format always fails</a></div>
    <div class="body">Matching the bit depth didnt work, and updating my drivers screwed up my whole computer. Oh well.</div>
    <div class="meta">Posted on 2002-06-27 13:53:36 by ChimpFace9000</div>
   </div>
   <div class="post" id="post-45559">
    <div class="subject"><a href="#post-45559">Choose Pixel Format always fails</a></div>
    <div class="body"><a target="_blank" href="http://www.wischik.com/lu/programmer/wingl.html#choosepixelformat">http://www.wischik.com/lu/programmer/wingl.html#choosepixelformat</a><br /><br />... Im so pissed...</div>
    <div class="meta">Posted on 2002-06-28 04:09:41 by ChimpFace9000</div>
   </div>
   <div class="post" id="post-45563">
    <div class="subject"><a href="#post-45563">Choose Pixel Format always fails</a></div>
    <div class="body">Ditch OpenGL and go D3D? :)</div>
    <div class="meta">Posted on 2002-06-28 04:26:16 by f0dder</div>
   </div>
   <div class="post" id="post-45566">
    <div class="subject"><a href="#post-45566">Choose Pixel Format always fails</a></div>
    <div class="body"><div class="quote"><br /><a target="_blank" href="http://www.wischik.com/lu/programmer/wingl.html#choosepixelformat">http://www.wischik.com/lu/programmer/wingl.html#choosepixelformat</a><br /><br />... Im so pissed... </div><br /><br /><br />:grin:</div>
    <div class="meta">Posted on 2002-06-28 04:35:30 by bazik</div>
   </div>
   <div class="post" id="post-45571">
    <div class="subject"><a href="#post-45571">Choose Pixel Format always fails</a></div>
    <div class="body">This wasnt an OpenGL problem, this was a Visual C++ problem.</div>
    <div class="meta">Posted on 2002-06-28 04:54:48 by ChimpFace9000</div>
   </div>
   <div class="post" id="post-45575">
    <div class="subject"><a href="#post-45575">Choose Pixel Format always fails</a></div>
    <div class="body">It's not Visual C++ problem. It's gdi32.dll problem. There are two versions of ChoosePixelFormat, ChoosePixelFormat exported in gdi32.dll and &quot;hidden&quot; wglChoosePixelFormat exported in opengl32.dll (hidden means that is not defined in header files). When the call to ChoosePixelFormat is made, first it's trying to find is it opengl32.dll loaded in the memory (GetModuleHandle), then if it's loaded, finds the adress of wglChoosePixelFormat (with GetProcAddress), and he calls wglChoosePixelFormat.<br /><br />So, if opengl32.dll it's not loaded ChoosePixelFormat fails. <br /><br />Using GetModuleHandle to finds is it opengl32.dll loaded explains why &quot;The specified module could not be found.&quot; error is showing...<br /><br />Solution: use any kind of gl or wgl functions, at least once function, just compiler to link to the opengl32.dll...</div>
    <div class="meta">Posted on 2002-06-28 06:28:14 by minimoog</div>
   </div>
   <div class="post" id="post-45577">
    <div class="subject"><a href="#post-45577">Choose Pixel Format always fails</a></div>
    <div class="body">so ChimpFace was doing OpenGL with no other calls than<br />ChoosePixelFormat? :). Ok, perhaps using GetModuleHandle instead<br />of LoadLibrary isn't the best approach, but at least that way you<br />don't get crazy reference counts to opengl32.dll ...<br /><br />And btw, the linker discarding unused libs it not a &quot;problem&quot; - its<br />an optimization. Otherwise boy you'd have some bloated executables.</div>
    <div class="meta">Posted on 2002-06-28 06:47:22 by f0dder</div>
   </div>
   <div class="post" id="post-45592">
    <div class="subject"><a href="#post-45592">Choose Pixel Format always fails</a></div>
    <div class="body">ChoosePixelFormat is windows opengl specific, why this function is &quot;mapped&quot; in gdi32.dll I don't know. <br /><br />Here are wgl functions that are linked to gdi32.dll:<br /><br />ChoosePixelFormat<br />DescribePixelFormat<br />GetPixelFormat<br />SetPixelFormat<br />SwapBuffers<br /><br />I guess that they all require opengl32.dll to be loaded or they fail...</div>
    <div class="meta">Posted on 2002-06-28 09:54:28 by minimoog</div>
   </div>
   <div class="post" id="post-47386">
    <div class="subject"><a href="#post-47386">...</a></div>
    <div class="body">1. from what i have experienced, it is not good idea to initialize opengl during WM_CREATE (it crashes a lot on my win98SE, creates bugs on stack (ESP points to wrong place), ogl doesn't initialize at all, or initializes wrongly (for example: 16bpp when i have chose 32 etc.)).<br /><br />so it's better to initialize ogl AFTER returning from CreateWindow.<br /><br />2. on some nVidia's cards open gl requires CS_OWNDC flag to be set when registering window class.<br /><br />it is good idea then to set that flag, even if u r not sure wheter a card is nvidia's or not.<br /><br /><br />------------------------------------------------------<br />The only way to achieve the goal is fight....<br />...but i always forget about it.</div>
    <div class="meta">Posted on 2002-07-13 10:30:34 by ti_mo_n</div>
   </div>
   <div class="post" id="post-47406">
    <div class="subject"><a href="#post-47406">Choose Pixel Format always fails</a></div>
    <div class="body">I use win98se and ogl starts perfectly under wm_create. Theres probably a problem with your code.</div>
    <div class="meta">Posted on 2002-07-13 15:27:24 by ChimpFace9000</div>
   </div>
  </div>
 </body>
</html>