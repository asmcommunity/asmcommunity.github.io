<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>button fails to create - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=16242" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=16242">button fails to create</a></p>
   <div class="post" id="post-126119">
    <div class="subject"><a href="#post-126119">button fails to create</a></div>
    <div class="body">i am trying to do a little tool to design my own custom trainers for games, but i am having a very weird problem, the custom window is created ok but in the outputed trainer.exe at the WM_CREATE message, buttons simply refuse to create.<br />i am kinda very confused since i checked and double checked the code and found nothing suspicious=/<br />here i attach the code, maybe someone can figure this out <br /><br />BUTTON_SETTINGS STRUCT<br />  butHeight             DWORD      ?<br />  butWidth		        DWORD      ?<br />  butVertical			DWORD      ?<br />  butHorizontal			DWORD      ?<br />  butStyle				DWORD	   ?<br />  butTimer	     		DWORD      ?<br />  butCaption			db 10h dup (0)    <br />BUTTON_SETTINGS ENDS<br /><br /><br />int 3<br />push SW_SHOWDEFAULT<br />push NULL<br />push NULL<br />push dword ptr <br />Call TrainerMain<br /><br />@@:<br />jmp @B<br /><br /><br /><br />TrainerMain proc MyhInst:HINSTANCE, hPrevInst:HINSTANCE, CmdLine:LPSTR, CmdShow:DWORD<br />LOCAL wc:WNDCLASSEX<br />  LOCAL msg:MSG<br />  LOCAL hwnd:HWND<br />Call @F<br />@@:<br />pop edi<br />sub edi, offset @B  <br />mov wc.cbSize, SIZEOF WNDCLASSEX<br />mov wc.style, CS_HREDRAW or CS_VREDRAW<br />lea eax, <br />mov wc.lpfnWndProc, eax<br />mov wc.cbClsExtra, NULL<br />mov wc.cbWndExtra, NULL<br />push edi<br />push MyhInst<br />pop wc.hInstance<br />mov wc.lpszMenuName, NULL<br />push IDI_APPLICATION<br />push 0<br />call <br />pop edi<br />push edi<br />mov wc.hIcon, eax<br />mov wc.hIconSm, eax<br />push IDC_ARROW<br />push 0<br />Call <br />pop edi<br />push edi<br />mov wc.hCursor, eax<br />mov	wc.hbrBackground, COLOR_BTNFACE+1<br />lea eax, <br />mov wc.lpszClassName, eax<br />lea eax, wc.cbSize<br />push eax<br />Call <br />pop edi<br /><br />push edi<br />lea eax, <br />lea ebx, <br />push 0<br />push MyhInst<br />push 0<br />push 0<br />mov edx, 012345678h 	 		; window height gets filled in trainer designer<br />TrainerHeight equ $-4<br />push edx<br />mov edx, 012345678h 						; window width<br />TrainerWidth equ $-4<br />push edx 						; vertical position of window<br />mov edx, 012345678h<br />TrainerVertical equ $-4<br />push edx<br />mov edx, 012345678h<br />TrainerHorizontal equ $-4 					;  horizontal position of window<br />push edx<br />push WS_SYSMENU<br />TrainerWindowStyles equ $-4<br />push ebx		;  AppName<br />push eax		;  Main Class<br />push WS_EX_TOPMOST<br /><br />Call <br />mov dword ptr , eax<br />pop edi<br />push edi<br />push CmdShow<br />push hwnd<br />Call <br />pop edi<br />push edi<br />push hwnd<br />Call <br />pop edi<br /><br />.WHILE TRUE<br /><br />push edi<br />push 0<br />push 0<br />push 0<br />push msg<br />Call <br />pop edi<br /><br />.BREAK .IF(!eax)<br /><br />push edi<br />push msg<br />Call <br />pop edi<br />push edi <br />push msg<br />Call  <br />pop edi<br /><br />.ENDW<br />mov eax, msg.wParam<br />ret<br />TrainerMain endp<br /><br /><br /><br />TrainerWndProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br /><br />.IF uMsg==WM_CREATE<br /><br />pushad<br />Call @F<br />@@:<br />int 3<br />pop edi<br />sub edi, offset @B<br />push 0						   ; address of window-creation data, not used<br />push dword ptr 			   ; the image base<br />push 0<br />push dword ptr 			   		   ; parent window<br />lea ebx, <br /><br />assume ebx : ptr BUTTON_SETTINGS 		 ; ebx now points to the button creation settings <br />push dword ptr .butHeight   		 ; window height<br />push dword ptr .butWidth			 ; window width<br />push dword ptr .butVertical		 ; vertical position of window<br />push dword ptr .butHorizontal 		 ; horizontal position of window<br />lea eax, <br />;lea edx, .butCaption<br />lea edx, <br />push WS_CHILD or WS_VISIBLE <br />;push dword ptr .butStyle			 ; button style from array<br />push edx								 ; button caption/text from array<br />push eax								 ; button class<br />push WS_EX_CLIENTEDGE					 ; extended style<br />Call <br />popad<br />assume ebx : nothing<br /><br /><br />.ELSEIF<br /><br />Call @F<br />@@:<br />pop edi<br />sub edi, offset @B  <br />push lParam<br />push wParam<br />push uMsg<br />push hWnd	<br />Call 	<br />ret<br />.ENDIF<br />xor eax, eax<br />ret<br />TrainerWndProc endp<br /><br />ButtonSettings BUTTON_SETTINGS &lt;20,20,20,20&gt; 		; the structure which holds the buttons information<br /><br />MainTrainerClass      db  'random class', 0<br />TrainerAppName        db  100h dup (0)<br />TrainerButtClass      db  &quot;button&quot;, 0<br />TrainerStaticClass    db  100h dup (0)<br />TrainerWindowMain  	  dd  ?</div>
    <div class="meta">Posted on 2003-12-01 07:11:25 by DZA</div>
   </div>
   <div class="post" id="post-126127">
    <div class="subject"><a href="#post-126127">Helpful Suggestion</a></div>
    <div class="body">This is just a suggestion, but if you remove all references to 'trainers' (read the faq) then you'll have better luck getting assistance.</div>
    <div class="meta">Posted on 2003-12-01 09:26:30 by Will</div>
   </div>
   <div class="post" id="post-126133">
    <div class="subject"><a href="#post-126133">button fails to create</a></div>
    <div class="body">don't know if this has anything to do with your problem but callback procedures such as window procs should preserv ebx, esi and edi<br /><br /><pre><code><br />TrainerWndProc proc uses ebx esi edi hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br /></code></pre></div>
    <div class="meta">Posted on 2003-12-01 10:06:21 by ENF</div>
   </div>
   <div class="post" id="post-126143">
    <div class="subject"><a href="#post-126143">sorry</a></div>
    <div class="body">rofl, trainers illegal?  i wasn't up to date with this sorry...anyway, i think yall can figure out that this shit sucks very much, as there are plenty of &quot;legal&quot; proggies which make use of the WriteProcessMemory shit to modify other processes...examples..uhm, just the first one that comes to my mind..Crash Guard from Symantec...anyway, there are plenty others! <br />i respect this board, and i don't want it closed as yall prolly do, so if such discussions about trainers could cause problems, i agree<br /><br />thanks go for those who repplied, if someone can help me out pls PM tho:P</div>
    <div class="meta">Posted on 2003-12-01 11:10:30 by DZA</div>
   </div>
  </div>
 </body>
</html>