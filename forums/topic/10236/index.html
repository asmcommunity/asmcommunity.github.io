<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>A macro for defining string arrays - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10236" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=10236">A macro for defining string arrays</a></p>
   <div class="post" id="post-76788">
    <div class="subject"><a href="#post-76788">A macro for defining string arrays</a></div>
    <div class="body">Greetings,<br />here's a macro for defining an array of strings.<br />I've attached a simple console program to demonstrate it's use.<br />assemble and link it as a console program... <br />it demonstrates the use of $ :the location counter<br /><br /><pre><code><br />STRINGARR macro varname&#58;req,stringlist&#58;vararg<br />;;written by Martial_Code 2003<br />;;defines an array of strings<br />;;varname &#58; name of array which will receive the string offsets<br />;;stringlist&#58; comma separated list of quoted strings,&#40;use text equates to over come line length limitation&#41;<br />;;eg&#58; STRINGARR SIMPSONS,&quot;La Famille Simpson&quot;,&quot;Homer&quot;,&quot;Marge&quot;,&quot;Bart&quot;,&quot;Lisa&quot;,&quot;Maggie&quot;,&quot;Santa's Little Helper&quot;,&quot;The Cat&quot;<br />;;the array of offsets is call simpsons<br />;;this macro also generates a jmp to skip the data if defined in the code section<br />LOCAL lbl<br />	IFNB &lt;stringlist&gt;<br />		dwsize equ 4<br />		len=0<br />		i=0<br />		datasize=0<br />		sumdiff=0<br />	%FOR arg,&lt;stringlist&gt;<br />			i=i+1 ;get number of string elements<br />			len SizeStr &lt;arg&gt;<br />	  	len=len-1<br />	  	datasize=datasize+len ;get the cumulative size of the text data<br />		ENDM		<br />		j=0 <br />		%j INSTR &lt;@CurSeg&gt;,&lt;_TEXT&gt;<br />		if j<br />			jmp lbl<br />		endif		<br />		j=0<br />	 %FOR arg,&lt;stringlist&gt;<br />			local	start ;start is defined here so that each time thru the loop it get a different value<br />			len SizeStr &lt;arg&gt;<br />	  	len=len-1 ;get number of bytes in the string includeing null char<br />	   	start	db arg,0 ;define data here<br />			sumdiff=sumdiff+dwsize-len ;accumulative sum of misfit<br />	  	ORG $+datasize-dwsize+sumdiff ;set location counter to next free slot in array of pointers<br />	  	i=i-1<br />	  	if j eq 0<br />	  		@CatStr&#40;&lt;varname dword offset start&gt;&#41; ;only first time thru the loop defines varname<br />	 			j=1<br />	  	else<br />		  	@CatStr&#40;&lt;dword offset start&gt;&#41; ;other times<br />	  	endif<br />	  	if i gt 0<br />	  		ORG $-datasize-sumdiff ;set location counter to next free string offset only if more date to be defined<br />	  	endif<br />		ENDM<br />		%j instr &lt;@CurSeg&gt;,&lt;_TEXT&gt;<br />		if j<br />			lbl&#58;<br />		endif<br />	ENDIF<br />ENDM<br /></code></pre><br />*******EDIT********** <br />slight modification to macro:<br />it now allows text equates which can be used to overcome masm's 255 char line limit. see updated attachment on useage.</div>
    <div class="meta">Posted on 2003-01-16 21:59:00 by MArtial_Code</div>
   </div>
   <div class="post" id="post-76797">
    <div class="subject"><a href="#post-76797">A macro for defining string arrays</a></div>
    <div class="body">Very nice work.  Im glad you took the time to use the $ operator instead of sizing the array rectangularly (ie. making each entry the size of the longest array entry).<br /><br />Once might argue the pointer table is wasteful, but verses the above rectangular approach this might as well be seen as encrytiping the added white spaces ;) .  A pointer table entry is only 4 bytes, which is not much compared to an array like:<br /><br />&quot;Yes&quot; (3 chars + Null)<br />&quot;No&quot; (2 chars + Null)<br />&quot;Kinda sorta, im not sure&quot;  (24 chars + Null)<br /><br />Rectangularly it would be 3*25 == 75 bytes for the array<br /><br />Your macro will produce only 4+3+25+(4*3)=32+12= 44 bytes!<br /><br />The tradeoff happens when your array items are very close to the same size.  In this rare condition then the rectangular would be better.  (But this rarely is the case with text strings ;) )<br /><br />On an application sizde, this tool will be great for filling combo/drop boxes with intial data ;)<br /><br />Thanx for the hard work.. This one is a keeper in my books..<br />As well, as MACROS can be a pain, i should say its also well written...<br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2003-01-16 22:44:52 by NaN</div>
   </div>
   <div class="post" id="post-76798">
    <div class="subject"><a href="#post-76798">A macro for defining string arrays</a></div>
    <div class="body">As a suggestion you should add an align statment:<pre><code>STRINGARR macro varname&#58;req,stringlist&#58;vararg<br />;;written by Martial_Code 2003<br />;;defines an array of strings<br />;;varname &#58; name of array which will receive the string offsets<br />;;stringlist&#58; comma separated list of quoted strings<br />;;eg&#58; STRINGARR SIMPSONS,&quot;La Famille Simpson&quot;,&quot;Homer&quot;,&quot;Marge&quot;,&quot;Bart&quot;,&quot;Lisa&quot;,&quot;Maggie&quot;,&quot;Santa's Little Helper&quot;,&quot;The Cat&quot;<br />;;the array of offsets is call simpsons<br />;;this macro also generates a jmp to skip the data if defined in the code section<br />LOCAL lbl<br />	IFNB &lt;stringlist&gt;<br />		dwsize equ 4<br />		len=0<br />		i=0<br />		datasize=0<br />		sumdiff=0<br />		FOR arg,&lt;stringlist&gt;<br />			i=i+1 ;get number of string elements<br />			len SizeStr &lt;arg&gt;<br />	  	len=len-1<br />	  	datasize=datasize+len ;get the cumulative size of the text data<br />		ENDM		<br />		j=0 <br />		%j INSTR &lt;@CurSeg&gt;,&lt;_TEXT&gt;<br />		if j<br />			jmp lbl<br />		endif		<br />		j=0<br />		FOR arg,&lt;stringlist&gt;<br />			local	start ;start is defined here so that each time thru the loop it get a different value<br />			len SizeStr &lt;arg&gt;<br />	  	len=len-1 ;get number of bytes in the string includeing null char<br />		&#91;COLOR=red&#93;ALIGN 4&#91;/COLOR&#93;<br />	   	start	db arg,0 ;define data here<br />			sumdiff=sumdiff+dwsize-len ;accumulative sum of misfit<br />	  	ORG $+datasize-dwsize+sumdiff ;set location counter to next free slot in array of pointers<br />	  	i=i-1<br />	  	if j eq 0<br />	  		&#91;COLOR=red&#93;ALIGN 4&#91;/COLOR&#93; <br />	  		@CatStr&#40;&lt;varname dword offset start&gt; &#41; ;only first time thru the loop defines varname<br />	 			j=1<br />	  	else<br />		  	@CatStr&#40;&lt;dword offset start&gt; &#41; ;other times<br />	  	endif<br />	  	if i gt 0<br />	  		ORG $-datasize-sumdiff ;set location counter to next free string offset only if more date to be defined<br />	  	endif<br />		ENDM<br />		%j instr &lt;@CurSeg&gt;,&lt;_TEXT&gt;<br />		if j<br />			lbl&#58;<br />		endif<br />	ENDIF<br />ENDM</code></pre><br /><br />This makes the pipelines happy for when your char array's finish up on an odd number ;)<br /><br />:NaN:</div>
    <div class="meta">Posted on 2003-01-16 22:50:42 by NaN</div>
   </div>
   <div class="post" id="post-76828">
    <div class="subject"><a href="#post-76828">A macro for defining string arrays</a></div>
    <div class="body">Cheers nan...it was tough going trying to figure out the general formula for setting the location counter, I finally had to resort to the old gridded-paper and pencil &quot;trick&quot;;) . <br /><br />I've tried the align statements, placing align 4 before the text is decalred(first position in your post above), causes an error in the execuable.  Aligning the the pointer array however seems to work fine.  I'll have to look into it:confused: .</div>
    <div class="meta">Posted on 2003-01-17 04:17:20 by MArtial_Code</div>
   </div>
   <div class="post" id="post-76863">
    <div class="subject"><a href="#post-76863">A macro for defining string arrays</a></div>
    <div class="body">Hmm.. thats strange.. i didnt test it, but it should have worked...  <br /><br />The quick fix migh just be @CatStr( &lt;ALIGN 4&gt; ).... :this is odd:<br /><br />:NaN:</div>
    <div class="meta">Posted on 2003-01-17 10:21:42 by NaN</div>
   </div>
  </div>
 </body>
</html>