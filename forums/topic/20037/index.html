<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>GetDlgItemInt and hWnd - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20037" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=20037">GetDlgItemInt and hWnd</a></p>
   <div class="post" id="post-153607">
    <div class="subject"><a href="#post-153607">GetDlgItemInt and hWnd</a></div>
    <div class="body">Why doesn't hWnd work at the function: GetDlgItemInt ?<br /><br /><br /><pre><code>.386<br />.model flat,stdcall<br />option casemap&#58;none<br /><br />WinMain proto &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br /><br />include \masm32\include\gdi32.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\windows.inc<br /><br />includelib \masm32\lib\gdi32.lib<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />.data<br />ClassName   db &quot;DLGCLASS&quot;,0<br />MenuName    db &quot;MyMenu&quot;,0<br /><br />  ; -------------------------------------<br />  ; IMPORTANT that your DlgName is THE<br />  ; SAME as the AppName in your RESOURCE<br />  ; FILE !!!<br />  ; Otherwise your window WON?T SHOW !!!<br />  ; Here we write&#58; DlgName db &quot;Convert&quot;,0<br />  ; -------------------------------------<br />DlgName                 db  &quot;Convert&quot;,0<br />AppName                 db  &quot;Convert v1.0 by Ib Larsen&quot;,0<br />Caption                 db  &quot;Exit Program&quot;,0<br />Text                    db  &quot;Really want to quit ?&quot;,0<br /><br /><br /><br />.data?<br />hInstance               HINSTANCE           ?<br />CommandLine             LPSTR               ?<br />lpSuccessorFailure      db                  ?<br />DEC_Buffer              db          32 dup &#40;?&#41;<br />ASCII_Buffer            db          32 dup &#40;?&#41;<br /><br /><br />.const<br />IDC_EDIT_1         equ 4001<br />IDC_EDIT_2         equ 4002<br />IDC_EXIT           equ 3014<br />IDC_DEC            equ 3001<br /><br />.code<br />start&#58;<br />        invoke GetModuleHandle, NULL<br />        mov    hInstance,eax<br />        invoke GetCommandLine<br />        mov    CommandLine,eax<br />        invoke WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT<br />        invoke ExitProcess,eax<br /><br /><br />WinMain proc   hInst&#58;HINSTANCE,hPrevInst&#58;HINSTANCE,CmdLine&#58;LPSTR,CmdShow&#58;DWORD<br />        LOCAL  wc&#58;WNDCLASSEX<br />        LOCAL  msg&#58;MSG<br />        LOCAL  hDlg&#58;HWND<br />        mov    wc.cbSize,SIZEOF WNDCLASSEX<br />        mov    wc.style, CS_HREDRAW or CS_VREDRAW<br />        mov    wc.lpfnWndProc,OFFSET WndProc<br />        mov    wc.cbClsExtra,NULL<br />        mov    wc.cbWndExtra,DLGWINDOWEXTRA<br />        push   hInst<br />        pop    wc.hInstance<br />        mov    wc.hbrBackground,COLOR_BTNFACE+1<br />        mov    wc.lpszMenuName,OFFSET MenuName<br />        mov    wc.lpszClassName,OFFSET ClassName<br />        invoke LoadIcon,NULL,IDI_APPLICATION<br />        mov    wc.hIcon,eax<br />        mov    wc.hIconSm,eax<br />        invoke LoadCursor,NULL,IDC_ARROW<br />        mov    wc.hCursor,eax<br />        invoke RegisterClassEx, addr wc<br />        invoke CreateDialogParam,hInstance,ADDR DlgName,NULL,NULL,NULL<br />        mov    hDlg,eax<br />        invoke GetDlgItem,hDlg,IDC_EDIT_1<br />        invoke SetFocus,eax <br />        invoke ShowWindow, hDlg,SW_SHOWNORMAL<br />        invoke UpdateWindow, hDlg<br />        .WHILE TRUE<br />                invoke GetMessage, ADDR msg,NULL,0,0<br />                .BREAK .IF &#40;!eax&#41;<br />                invoke IsDialogMessage, hDlg, ADDR msg<br />                .IF eax==FALSE<br />                        invoke TranslateMessage, ADDR msg<br />                        invoke DispatchMessage, ADDR msg<br />                .ENDIF<br />        .ENDW<br />               mov eax,msg.wParam<br />               ret<br />WinMain endp<br /><br /><br /><br /><br /><br />WndProc proc hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br /><br />            cmp uMsg,WM_COMMAND<br />            jnz @F<br />            mov eax,wParam<br />            cmp ax,IDC_EXIT<br />            jnz @F<br />            CALL ExitProc<br />            ret<br />@@&#58;         cmp ax,IDC_DEC<br />            jnz @F<br />            CALL InputProc<br />            CALL OutputProc<br />            ret<br /><br />@@&#58;         invoke DefWindowProc,hWnd,uMsg,wParam,lParam<br />            ret<br />            <br />WndProc endp<br /><br /><br /><br />ExitProc  proc<br /><br />            invoke MessageBox,NULL,addr Text,addr Caption,MB_YESNO OR MB_SYSTEMMODAL<br />            cmp eax,IDNO<br />            je NO<br />            invoke ExitProcess,eax<br />NO&#58;         ret   <br /><br />ExitProc  endp<br /><br /><br /><br /><br /><br />;This procedure determines which button is pushed,<br />;and pass the value accordingly to the Convert_proc.<br />InputProc  proc hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br />             cmp ax,IDC_DEC<br />             jnz DefaultProc<br />             invoke GetDlgItemInt,hWnd,IDC_EDIT_1,addr lpSuccessorFailure,TRUE<br />             cmp lpSuccessorFailure,TRUE<br />             jnz DefaultProc<br />             mov dword ptr &#91;DEC_Buffer&#93;,eax<br />             ret<br /><br />;            cmp ax,IDC_HEX<br />;            jnz Default_Proc<br />;            invoke GetDlgItemInt,hWnd,IDC_EDIT_2,addr lpSuccessorFailure,TRUE<br />;            cmp lpSuccessorFailure,TRUE<br />;            jnz Default_Proc<br />;            mov dword ptr &#91;HEX_Buffer&#93;,eax<br />;            ret<br /><br />;            cmp ax,IDC_BIN<br />;            jnz Default_Proc<br />;            invoke GetDlgItemInt,hWnd,IDC_EDIT_3,addr lpSuccessorFailure,TRUE<br />;            cmp lpSuccessorFailure,TRUE<br />;            jnz Default_Proc<br />;            mov dword ptr &#91;BIN_Buffer&#93;,eax<br />;            ret<br /><br />;            cmp ax,IDC_ASCII<br />;            jnz Default_Proc<br />;            invoke GetDlgItemInt,hWnd,IDC_EDIT_4,addr lpSuccessorFailure,TRUE<br />;            cmp lpSuccessorFailure,TRUE<br />;            jnz Default_Proc<br />;            mov dword ptr &#91;ASCII_Buffer&#93;,eax<br /><br />DefaultProc&#58; invoke DefWindowProc,hWnd,uMsg,wParam,lParam<br />             ret<br /><br />InputProc  endp<br /><br /><br /><br /><br /><br /><br />  ; This procedure converts input from a buffer, and pass this value<br />  ; to the Output_proc.<br /><br />;Convert_Proc proc hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br />;DEC_to_HEX&#58;<br />;DEC_to_Bin&#58;<br />;DEC_to_ASCII&#58;<br />;             invoke GetDlgItemInt,hWnd,IDC_EDIT_1,addr lpSuccessorFailure,TRUE<br />;             cmp lpSuccessorFailure,TRUE<br />;             jnz DefWndPr<br />;             mov dword ptr &#91;ASCII_Buffer&#93;,eax<br /><br />;DefWndPr&#58;     invoke DefWindowProc,hWnd,uMsg,wParam,lParam<br />;             ret<br /><br /><br />;HEX_to_DEC&#58;<br />;HEX_to_BIN&#58;<br />;HEX_to_ASCII&#58;<br /><br /><br />;BIN_to_DEC&#58;<br />;BIN_to_HEX&#58;<br />;BIN_to_ASCII&#58;<br /><br /><br />;ASCII_to_DEC&#58;<br />;ASCII_to_HEX&#58;<br />;ASCII_to_BIN&#58;<br /><br />;Convert_Proc    endp<br /><br /><br /><br /><br /><br /><br /><br />OutputProc proc<br /><br />           ret<br /><br />;IDC_EDIT_1&#58;<br /><br />;IDC_EDIT_2&#58;<br /><br />;IDC_EDIT_3&#58;<br /><br />;IDC_EDIT_4&#58;            <br /><br />OutputProc endp<br /><br /><br /><br /><br /><br /><br /><br />;Default_Proc proc hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br /><br />;             invoke DefWindowProc,hWnd,uMsg,wParam,lParam<br />;             ret<br /><br />;Default_Proc endp<br /><br /><br />end start<br /></code></pre></div>
    <div class="meta">Posted on 2004-12-02 07:44:58 by The SharK</div>
   </div>
   <div class="post" id="post-153610">
    <div class="subject"><a href="#post-153610">GetDlgItemInt and hWnd</a></div>
    <div class="body">little hint ...CALL InputProc<br />but the definition of InputProc in ur source is<br />proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM</div>
    <div class="meta">Posted on 2004-12-02 08:07:31 by Allanon</div>
   </div>
   <div class="post" id="post-153616">
    <div class="subject"><a href="#post-153616">GetDlgItemInt and hWnd</a></div>
    <div class="body">Hi Allanon<br /><br /><br />okay<br /><br /><br />This works:<pre><code>InputProc proto &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD</code></pre><br /><pre><code>            invoke InputProc,hWnd,IDC_EDIT_1,addr lpSuccessorFailure,TRUE</code></pre><br /><br /><br />But if I want to use CALL instead of invoke, how do I do that, like:<br /><br /><pre><code>            push hWnd<br />            push IDC_EDIT_1<br />            push addr lpSuccesorFailure<br />            push TRUE            <br />            CALL InputProc</code></pre><br /><br />regards,<br /><br />The SharK</div>
    <div class="meta">Posted on 2004-12-02 09:06:38 by The SharK</div>
   </div>
   <div class="post" id="post-153617">
    <div class="subject"><a href="#post-153617">GetDlgItemInt and hWnd</a></div>
    <div class="body">You have reversed the parameters.</div>
    <div class="meta">Posted on 2004-12-02 09:08:22 by Sephiroth3</div>
   </div>
   <div class="post" id="post-153629">
    <div class="subject"><a href="#post-153629">GetDlgItemInt and hWnd</a></div>
    <div class="body">Thanks Sephiroth3<br /><br /><br />That sure helped ;-)</div>
    <div class="meta">Posted on 2004-12-02 11:51:54 by The SharK</div>
   </div>
   <div class="post" id="post-153642">
    <div class="subject"><a href="#post-153642">GetDlgItemInt and hWnd</a></div>
    <div class="body">From the Win32 Programmer's Reference:<br /><br /><pre><code>HWND CreateDialogParam&#40;<br /><br />    HINSTANCE hInstance,      // handle to application instance<br />    LPCTSTR lpTemplateName,   // identifies dialog box template<br />    HWND hWndParent,          // handle to owner window<br />    DLGPROC lpDialogFunc,     // pointer to dialog box procedure  <br />    LPARAM dwInitParam        // initialization value<br />   &#41;;</code></pre><br /><br />You will notice that the 4th parameter must be a pointer to the dialog box procedure. You used NULL when you called the function. The WndProc used when you registered your &quot;window class&quot; may never see the messages generated for the dialog box, which is in a class of its own.<br /><br />Furthermore, if the dialog box is the only &quot;window&quot; you are using, there is no need to register a separate window class.<br /><br />Raymond</div>
    <div class="meta">Posted on 2004-12-02 19:55:14 by Raymond</div>
   </div>
   <div class="post" id="post-153687">
    <div class="subject"><a href="#post-153687">GetDlgItemInt and hWnd</a></div>
    <div class="body">Hi Raymond !<br /><br /><br />Thanks for the advice about the fourth parameter,<br />I have overlooked that.<br /><br /><br /><pre><code>Furthermore, if the dialog box is the only &quot;window&quot; you are using, there is no need to register a separate window class. <br /></code></pre><br /><br />If I remove all the wc stuff, then the Dialog won't show :-(<br />It's the only &quot;window&quot; for the program, except for a MessageBox ;-)<br /><br />regards,<br /><br />The SharK</div>
    <div class="meta">Posted on 2004-12-04 06:58:59 by The SharK</div>
   </div>
  </div>
 </body>
</html>