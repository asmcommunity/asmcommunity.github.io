<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>raw ICMP ping example - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14777" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=8">Networking</a> &raquo; <a href="../?id=14777">raw ICMP ping example</a></p>
   <div class="post" id="post-114577">
    <div class="subject"><a href="#post-114577">raw ICMP ping example</a></div>
    <div class="body">I've found some little time and a project which was unfinished... so I finished the first step :grin: <br />PingChat will be a program (now it has only the first step which is icmp handling properly) with wich you can chat with others through ICMP protocol<br /><br />hpe it will be a usefull example of raw icmp</div>
    <div class="meta">Posted on 2003-08-20 09:28:14 by NEMO</div>
   </div>
   <div class="post" id="post-114792">
    <div class="subject"><a href="#post-114792">raw ICMP ping example</a></div>
    <div class="body">Typo in the button &quot;Cancle&quot; :stupid: <br /><br />Anyway it looks cool, though I have yet to really try chatting with my friends using it.</div>
    <div class="meta">Posted on 2003-08-21 10:26:00 by roticv</div>
   </div>
   <div class="post" id="post-115146">
    <div class="subject"><a href="#post-115146">raw ICMP ping example</a></div>
    <div class="body">Under XP the send works but no replies are caught.</div>
    <div class="meta">Posted on 2003-08-23 21:31:19 by Homer</div>
   </div>
   <div class="post" id="post-135087">
    <div class="subject"><a href="#post-135087">raw ICMP ping example</a></div>
    <div class="body">So how would one go about grabbing incoming ping packets on XP?</div>
    <div class="meta">Posted on 2004-02-29 09:31:25 by tomdfx</div>
   </div>
   <div class="post" id="post-135270">
    <div class="subject"><a href="#post-135270">raw ICMP ping example</a></div>
    <div class="body">Queerdy wrote an asm ping example which received replies under xp, take a look at that.</div>
    <div class="meta">Posted on 2004-03-05 21:49:58 by Homer</div>
   </div>
   <div class="post" id="post-135713">
    <div class="subject"><a href="#post-135713">raw ICMP ping example</a></div>
    <div class="body">I searched through the forums and couldn't locate Queerdy's example.  Do you know of a link to it, or perhaps have a general idea how he went about capturing the replies on XP?</div>
    <div class="meta">Posted on 2004-03-12 12:26:50 by tomdfx</div>
   </div>
   <div class="post" id="post-135739">
    <div class="subject"><a href="#post-135739">raw ICMP ping example</a></div>
    <div class="body">Here u go :)</div>
    <div class="meta">Posted on 2004-03-12 23:16:18 by Homer</div>
   </div>
   <div class="post" id="post-136168">
    <div class="subject"><a href="#post-136168">raw ICMP ping example</a></div>
    <div class="body">Good code but at me is not present files icmp.lib  came to me him please  (ignat_ivanov@mail.ru)<br /> A thank :)</div>
    <div class="meta">Posted on 2004-03-17 00:58:18 by animator</div>
   </div>
   <div class="post" id="post-136227">
    <div class="subject"><a href="#post-136227">raw ICMP ping example</a></div>
    <div class="body">Hmm... it is good for grabbing the replies, but is there any kind of functionality available through the APIs to setup callbacks when ICMP requests (in other words, when another computer is initiating the ping) are received?  More of a catch-all example?</div>
    <div class="meta">Posted on 2004-03-17 13:17:39 by tomdfx</div>
   </div>
   <div class="post" id="post-137439">
    <div class="subject"><a href="#post-137439">raw ICMP ping example</a></div>
    <div class="body">Hi,<br />      can the icmpchecksum proc be used to find the checksum of TCP headers?:confused: :stupid: <br /><br />Thomas Antony</div>
    <div class="meta">Posted on 2004-03-31 01:00:39 by thomasantony</div>
   </div>
   <div class="post" id="post-137893">
    <div class="subject"><a href="#post-137893">raw ICMP ping example</a></div>
    <div class="body">From memory, icmp(udp) and tcp packet checksums are calculated using different (yet very similar) algos - but don't quote me on that - check for yourself :)</div>
    <div class="meta">Posted on 2004-04-04 10:16:31 by Homer</div>
   </div>
   <div class="post" id="post-137930">
    <div class="subject"><a href="#post-137930">raw ICMP ping example</a></div>
    <div class="body">Hi, I got a checksum algo in C. But didn't quite understand it so that I couldn't convert it into ASM. Can someone please post a TCP checksum algo in MASM or GoASM format?<br /><br />Thomas Antony</div>
    <div class="meta">Posted on 2004-04-05 02:10:20 by thomasantony</div>
   </div>
   <div class="post" id="post-137951">
    <div class="subject"><a href="#post-137951">raw ICMP ping example</a></div>
    <div class="body">think this will help you a bit</div>
    <div class="meta">Posted on 2004-04-05 06:37:30 by NEMO</div>
   </div>
   <div class="post" id="post-156126">
    <div class="subject"><a href="#post-156126">raw ICMP ping example</a></div>
    <div class="body">Hi! Can i have a look at Queerdy example? Thanks! <br /><br />grundic ~  gmail  ~  com :roll:</div>
    <div class="meta">Posted on 2005-01-22 06:09:02 by grundic</div>
   </div>
   <div class="post" id="post-158324">
    <div class="subject"><a href="#post-158324">Re: raw ICMP ping example</a></div>
    <div class="body">Hi,<br />&nbsp;  See the Raw ICMP ping example at my site at http://www.tomasm.tk/ . I haven&#39;t tested it on XP yet.<br /><br />Thomas Antony</div>
    <div class="meta">Posted on 2005-03-23 23:15:27 by thomasantony</div>
   </div>
   <div class="post" id="post-163037">
    <div class="subject"><a href="#post-163037">Re: raw ICMP ping example</a></div>
    <div class="body">you probably need to switch to promiscuous mode on xp, using WSAIoctl with SIO_RCVALL.<br />if anyone is interested, I could post my win32asm raw socket sniffer for a real-life example ...<br /><br />Dominik<br /><br />p.s. hi EvilHomer, i&#39;m back :) ... you probably remember that raw socket sniffer...<br />unfortunately it was never finished to be object-orientated, though it does work fine without :)</div>
    <div class="meta">Posted on 2005-08-10 01:05:11 by Dom</div>
   </div>
   <div class="post" id="post-163191">
    <div class="subject"><a href="#post-163191">Re: raw ICMP ping example</a></div>
    <div class="body">You could use a RAW socket to collect the ping replies. You have to parse through the headers of all the incoming data but it would work relatively well.<br /><br />Here&#39;s a snippet of vb code to initialize the raw socket<br /><pre><code><br />Dim byteA(0 To 3)<br />byteA(0) = &amp;H1<br />With sAddr<br />.sin_family = 2<br />.sin_port = 0<br />.sin_addr = xIP //ip of local host<br />End With<br />sd = socket(2&amp;, 3&amp;, 0&amp;)<br />a = bind(sd, sAddr, 16&amp;)<br />a = WSAIoctl(sd, &amp;H98000001, byteA(0), 4&amp;, vbNull, vbNull, XX, vbNull, vbNull)<br /></code></pre><br /><br />Then run a RecvFrom api inside of a loop in another thread and check the incoming packets for the reply.<br /><br />It&#39;s not the epitome of efficiency but meh.</div>
    <div class="meta">Posted on 2005-08-13 00:30:43 by r22</div>
   </div>
   <div class="post" id="post-163261">
    <div class="subject"><a href="#post-163261">Re: raw ICMP ping example</a></div>
    <div class="body"><div class="quote">a = WSAIoctl(sd, &amp;H98000001, byteA(0), 4&amp;, vbNull, vbNull, XX, vbNull, vbNull)</div><br />there we got the promiscous mode.<br />r22, better run a recv - loop or do you know whose data you are getting in with the raw socket!?</div>
    <div class="meta">Posted on 2005-08-15 00:01:57 by Dom</div>
   </div>
  </div>
 </body>
</html>