<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>CreateFile - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3504" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=3504">CreateFile</a></p>
   <div class="post" id="post-23223">
    <div class="subject"><a href="#post-23223">CreateFile</a></div>
    <div class="body">Hi.<br />I got a strange problem.<br />When my program starts, it reads a file, loads it and closes it again. when i want to open the file with WRITE_ACCESS later again, i get ERROR_SHARING_VIOLATION. if i try to delete the file, i get ERROR_ACCESS_DENIED. but i am 100% SURE that i did close the file handle when i opened it real quick at the beginning of the program to load it. so at the beginning i open a file, close its handle, later i try to open the file again, but i get these errors above. what is this? i can open the file with read only, but if i try to get write access, i get these errors.<br /><br />At the beginning i use<br />GENERIC_READ and OPEN_EXISTING.<br />Later i use<br />GENERIC_READ or GENERIC_WRITE and CREATE_ALWAYS<br />(since i will rewrite the whole file, i use CREATE_ALWAYS).<br /><br />Does anybody have an idea whats going on there? i've tested this on win95 and win98. it didn't work on both.</div>
    <div class="meta">Posted on 2002-02-07 08:24:55 by darester</div>
   </div>
   <div class="post" id="post-23237">
    <div class="subject"><a href="#post-23237">CreateFile</a></div>
    <div class="body">What version of windows are you using?<br />Are you <u>really</u> sure that you've closed the file?</div>
    <div class="meta">Posted on 2002-02-07 11:06:32 by bitRAKE</div>
   </div>
   <div class="post" id="post-23246">
    <div class="subject"><a href="#post-23246">CreateFile</a></div>
    <div class="body">Do you have this part of your code CloseHandle (HandleToTheFile)?</div>
    <div class="meta">Posted on 2002-02-07 12:20:47 by stryker</div>
   </div>
   <div class="post" id="post-23264">
    <div class="subject"><a href="#post-23264">CreateFile</a></div>
    <div class="body">Are you sure what our opening can be written to, you can open and read from the local executable but not write to it.</div>
    <div class="meta">Posted on 2002-02-07 15:13:46 by Quantum</div>
   </div>
   <div class="post" id="post-23334">
    <div class="subject"><a href="#post-23334">CreateFile</a></div>
    <div class="body">oh well, i just found out, that CloseHandle() always fails when i try to close the file after reading it at the beginning.<br />but i have no idea why it fails. i read some parts of the file, then i pass the file handle to a function BY VALUE, not BY REFERENCE, so that this function can read some information from the current position of the file pointer. when the function returns, the file handle should be closed, but CloseHandle fails. the file handle isn't changed in any way by the called function. it is the same as it was before. so why does CloseHandle() fail? I get ERROR_INVALID_HANDLE. but the handle shouldn't become invalid because it isn't changed.<br /><br />I also found out, that, if i close the file handle immediately after the last ReadFile Operation, it works. but i don't want to immediately close the file handle after the last ReadOperation.</div>
    <div class="meta">Posted on 2002-02-08 05:03:20 by darester</div>
   </div>
   <div class="post" id="post-23416">
    <div class="subject"><a href="#post-23416">CreateFile</a></div>
    <div class="body">Post a small snippet of code that illustrates your problem.</div>
    <div class="meta">Posted on 2002-02-08 12:46:16 by f0dder</div>
   </div>
  </div>
 </body>
</html>