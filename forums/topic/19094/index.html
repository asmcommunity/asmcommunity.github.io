<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Help at carry of class C ++ in ASM - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=19094" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=19094">Help at carry of class C ++ in ASM</a></p>
   <div class="post" id="post-147610">
    <div class="subject"><a href="#post-147610">Help at carry of class C ++ in ASM</a></div>
    <div class="body">Prompt please as on ASM the following code will look: <br /><br />int controlsInit = FALSE; <br /><br />BOOL WINAPI DllMain(HINSTANCE hinstDLL,ULONG fdwReason,LPVOID lpvReserved) <br />{ <br /><br />hInstance = hinstDLL; <br /><br />if (! controlsInit) { <br /><br />controlsInit = TRUE; <br /><br />InitCustomControls(hInstance); <br /><br />InitCommonControls(); <br /><br />} <br /><br />return(TRUE); <br /><br />} <br /><br /><br />__declspec(dllexport) ClassDesc *LibClassDesc(int i) { <br /><br />switch(i) { <br /><br />case 0: return &amp;MeltCD; <br /><br />default: return 0; <br /><br />} <br /><br />} <br /><br /><br />class MeltClassDesc : public ClassDesc { <br /><br />public: <br /><br />int IsPublic() { return TRUE; } <br /><br />void * Create(BOOL loading=FALSE) { return new MeltMod(); } <br /><br />const TCHAR * ClassName() { return _T(&quot;Melt&quot;); } <br /><br />SClass_ID SuperClassID() { return OSM_CLASS_ID; } <br /><br />Class_ID ClassID() { return Class_ID(0xA1C8E1D1, 0xE7AA2BE5); } <br /><br />const TCHAR* Category() { return _T(&quot;&quot;); } <br /><br />}; <br /><br />static MeltClassDesc MeltCD;</div>
    <div class="meta">Posted on 2004-08-07 07:56:55 by Alex BP</div>
   </div>
   <div class="post" id="post-147611">
    <div class="subject"><a href="#post-147611">Help at carry of class C ++ in ASM</a></div>
    <div class="body">You must give us the ClassDesc, MeltMod and Class_ID definitions. There are two ways to make a C++ -compatible code in asm - hardcoding <strong>or</strong> using existing macros that increase readability and stability dramatically for no speed cost. I always prefer the easy way :grin:  :<br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=17987">http://www.asmcommunity.net/board/index.php?topic=17987</a></div>
    <div class="meta">Posted on 2004-08-07 08:54:38 by Ultrano</div>
   </div>
   <div class="post" id="post-147614">
    <div class="subject"><a href="#post-147614">Help at carry of class C ++ in ASM</a></div>
    <div class="body">class ClassDesc {<br />	private:<br />		Tab&lt;FPInterface*&gt;		interfaces;		<br />	public:<br />		virtual					~ClassDesc() {}<br />		virtual int				IsPublic()=0;  <br />		virtual void *			Create(BOOL loading=FALSE)=0;   <br />		virtual	int 			BeginCreate(Interface *i) {return 0;}<br />		virtual int 			EndCreate(Interface *i) {return 0;};<br />		virtual const TCHAR* 	ClassName()=0;<br />		virtual SClass_ID		SuperClassID()=0;<br />		virtual Class_ID		ClassID()=0;<br />		virtual const TCHAR* 	Category()=0;   <br />		virtual BOOL		OkToCreate(Interface *i) { return TRUE; }<br />		virtual BOOL			HasClassParams() {return FALSE;}<br />		virtual void			EditClassParams(HWND hParent) {}<br />		virtual void			ResetClassParams(BOOL fileReset=FALSE) {}<br /><br />        virtual int             NumActionTables() { return 0; }<br />        virtual ActionTable*  GetActionTable(int i) { return NULL; }<br /><br />        virtual BOOL IsManipulator() { return FALSE; }<br /><br />        virtual BOOL CanManipulate(ReferenceTarget* hTarget) { return FALSE; }<br />        virtual BOOL CanManipulateNode(INode* pNode) { return FALSE; }<br /><br />         virtual Manipulator* CreateManipulator(ReferenceTarget* hTarget,<br />                                               INode* pNode) {return NULL;}<br />        virtual Manipulator* CreateManipulator(INode* pNode) {return NULL;}<br /><br />		virtual BOOL			NeedsToSave() { return FALSE; }<br />		virtual IOResult 		Save(ISave *isave) { return IO_OK; }<br />		virtual IOResult 		Load(ILoad *iload) { return IO_OK; }<br /><br />		virtual DWORD			InitialRollupPageState() { return 0x7fffffff; }<br /><br />		virtual const TCHAR*	InternalName() { return NULL; }<br />		virtual HINSTANCE		HInstance() { return NULL; }<br />		virtual int				NumParamBlockDescs() { return 0; }<br />		virtual ParamBlockDesc2* GetParamBlockDesc(int i) { return NULL; }<br />		virtual ParamBlockDesc2* GetParamBlockDescByID(BlockID id) { return NULL; }<br />		virtual void			AddParamBlockDesc(ParamBlockDesc2* pbd) { }<br />		virtual void			BeginEditParams(IObjParam *ip, ReferenceMaker* obj, ULONG flags, Animatable *prev) { }<br />		virtual void			EndEditParams(IObjParam *ip, ReferenceMaker* obj, ULONG flags, Animatable *prev) { }<br />		virtual void			InvalidateUI(ParamBlockDesc2* pbd) { }<br />		CoreExport virtual TCHAR* GetRsrcString(INT_PTR id);<br />		virtual void			MakeAutoParamBlocks(ReferenceMaker* owner) { }<br />		virtual int				NumParamMaps() { return 0; }<br />		virtual IParamMap2*		GetParamMap(int i) { return NULL; }<br />		virtual IParamMap2*		GetParamMap(ParamBlockDesc2* pbd) { return NULL; }<br />		virtual void			SetUserDlgProc(ParamBlockDesc2* pbd, ParamMap2UserDlgProc* proc=NULL) { }<br />		virtual ParamMap2UserDlgProc* GetUserDlgProc(ParamBlockDesc2* pbd) { return NULL; }<br /><br />		virtual bool DrawRepresentation(COLORREF bkColor, HDC hDC, Rect &amp;rect) { return FALSE; }<br /><br />		virtual int				NumInterfaces() { return interfaces.Count(); }<br />		virtual FPInterface*	GetInterfaceAt(int i) { return interfaces<em>; }<br />		CoreExport virtual FPInterface*	GetInterface(Interface_ID id);<br />		CoreExport virtual FPInterface*	GetInterface(TCHAR* name);<br />		CoreExport virtual void	AddInterface(FPInterface* fpi);<br />		virtual void			ClearInterfaces() { interfaces.ZeroCount(); }<br />		<br />		virtual Class_ID		SubClassID() { return Class_ID(); }<br /><br />		virtual INT_PTR Execute(int cmd, ULONG_PTR arg1=0, ULONG_PTR arg2=0, ULONG_PTR arg3=0) { return 0; } <br />	};<br /><br /><br /><br />class Class_ID {<br />	ULONG a,b;<br />	public:<br />		Class_ID() { a = b = 0xffffffff; }<br />		Class_ID(const Class_ID&amp; cid) { a = cid.a; b = cid.b;	}<br />		Class_ID(ulong aa, ulong bb) { a = aa; b = bb; }<br />		ULONG PartA() { return a; }<br />		ULONG PartB() { return b; }<br />		void SetPartA( ulong aa ) { a = aa; } //-- Added 11/21/96 GG<br />		void SetPartB( ulong bb ) { b = bb; }<br />		int operator==(const Class_ID&amp; cid) const { return (a==cid.a&amp;&amp;b==cid.b); }<br />		int operator!=(const Class_ID&amp; cid) const { return (a!=cid.a||b!=cid.b); }<br />		Class_ID&amp; operator=(const Class_ID&amp; cid)  { a=cid.a; b = cid.b; return (*this); }<br />		bool operator&lt;(const Class_ID&amp; rhs) const<br />		{<br />			if ( a &lt; rhs.a || ( a == rhs.a &amp;&amp; b &lt; rhs.b ) )<br />				return true;<br /><br />			return false;<br />		}<br />	};<br /><br />typedef ULONG_PTR SClass_ID;</div>
    <div class="meta">Posted on 2004-08-07 09:53:33 by Alex BP</div>
   </div>
   <div class="post" id="post-147622">
    <div class="subject"><a href="#post-147622">Help at carry of class C ++ in ASM</a></div>
    <div class="body">Looks something like this. Got bored in the end<br /><br /><pre><code><br />&#91;size=9&#93;<br />include masm32ultranoankase.inc<br /><br /><br /><br />class ClassDesc,,C++ compatible <br />	<br />	des interfaces ObjVector<br />	<br />	virtual IsPublic&#58;<br />	virtual Create&#58;		loading<br />	virtual BeginCreate&#58;	i<br />	virtual EndCreate&#58;	i<br />	virtual ClassName&#58;	<br />	virtual SuperClassID&#58;	<br />	virtual ClassID&#58;<br />	virtual Category&#58;<br />	virtual OkToCreate&#58;	i<br />	virtual HasClassParams&#58;	<br />	virtual EditClassParams&#58;	hParent<br />	virtual ResetClassParams&#58;	fileReset<br />	<br />	virtual NumActionTables&#58;<br />	virtual GetActionTable&#58;	i<br />		<br />	virtual IsManipulator&#58;<br />		<br />	virtual CanManipulate&#58;		hTarget<br />	virtual CanManipulateNode&#58;	pNode<br />	<br />	virtual CreateManipulator&#58;	hTarget,pNode<br />	<br />	virtual NeedsToSave&#58;	<br />	virtual Save&#58;		isave<br />	virtual Load&#58;		iload<br />	<br />	virtual InitialRollupPageState&#58;<br />	<br />	virtual InternalName&#58;<br />	virtual HInstance&#58;<br />	virtual NumParamBlockDescs&#58;<br />	virtual GetParamBlockDesc&#58;	i<br />	virtual GetParamBlockDescByID&#58;	id<br />	virtual AddParamBlockDesc&#58;	pbd<br />	virtual BeginEditParams&#58;	ip,obj,flags,prev<br />	virtual EndEditParams&#58;		ip,obj,flags,prev<br />	virtual InvalidateUI&#58;		pbd<br />	virtual GetRsrcString&#58;		id<br />	virtual MakeAutoParamBlocks&#58;	owner<br />	virtual NumParamMaps&#58;<br />	virtual GetParamMap&#58;		i<br />	virtual SetUserDlgProc&#58;		pbd,proc<br />	virtual GetUserDlgProc		pbd<br />	<br />	virtual DrawRepresentation&#58;	bkColor,hDC,rect<br />	<br />	virtual NumInterfaces&#58;<br />	virtual GetInterfaceAt&#58;		i<br />	virtual GetInterface&#58;		id<br />	virtual AddInterface&#58;		fpi<br />	virtual ClearInterfaces&#58;<br />	<br />	virtual SubClassID&#58;<br />	<br />	virtual Execute&#58;		cmd,arg1,arg2,arg3<br />endclass<br /><br /><br />ClassDesc_ClassDesc proc<br />	lea ecx,&#91;ecx&#93;.ClassDesc.interfaces<br />	$new ecx,ObjVector<br />ret<br />ClassDesc_ClassDesc endp<br /><br />ClassDesc_$ClassDesc proc<br />	lea ecx,&#91;ecx&#93;.ClassDesc.interfaces<br />	delete ecx<br />ret<br />ClassDesc_$ClassDesc endp<br /><br />ClassDesc_IsPublic proc<br />	xor eax,eax<br />ret<br />ClassDesc_IsPublic endp<br /><br />ClassDesc_Create proc loading<br />	xor eax,eax<br />ret<br />ClassDesc_Create endp<br /><br />ClassDesc_BeginCreate proc i<br />	xor eax,eax<br />ret<br />ClassDesc_BeginCreate endp<br /><br />ClassDesc_EndCreate proc i<br />	xor eax,eax<br />ret<br />ClassDesc_EndCreate endp<br /><br />ClassDesc_ClassName proc<br />	xor eax,eax<br />ret<br />ClassDesc_ClassName endp<br /><br />ClassDesc_SuperClassID proc<br />	xor eax,eax<br />ret<br />ClassDesc_SuperClassID endp<br /><br />ClassDesc_ClassID proc<br />	xor eax,eax<br />ret<br />ClassDesc_ClassID endp<br /><br />ClassDesc_Category proc<br />	xor eax,eax<br />ret<br />ClassDesc_Category endp<br /><br />ClassDesc_OkToCreate proc i<br />	mov eax,1<br />ret<br />ClassDesc_OkToCreate endp<br /><br />ClassDesc_HasClassParams proc<br />	xor eax,eax<br />ret<br />ClassDesc_HasClassParams endp<br /><br />ClassDesc_EditClassParams proc hParent<br />ret<br />ClassDesc_EditClassParams endp<br /><br />ClassDesc_ResetClassParams proc fileReset<br />ret<br />ClassDesc_ResetClassParams endp<br /><br />ClassDesc_NumActionTables proc<br />	xor eax,eax<br />ret<br />ClassDesc_NumActionTables endp<br /><br />ClassDesc_GetActionTable proc i<br />	xor eax,eax<br />ret<br />ClassDesc_GetActionTable endp<br /><br />ClassDesc_IsManipulator proc<br />	xor eax,eax<br />ret<br />ClassDesc_IsManipulator endp<br /><br />ClassDesc_CanManipulate proc hTarget<br />	xor eax,eax<br />ret<br />ClassDesc_CanManipulate endp<br /><br />ClassDesc_CanManipulateNode proc pNode<br />	xor eax,eax<br />ret<br />ClassDesc_CanManipulateNode endp<br /><br />ClassDesc_CreateManipulator proc pNode<br />	xor eax,eax	<br />ret<br />ClassDesc_CreateManipulator endp<br /><br />ClassDesc_NeedsToSave proc<br />	xor eax,eax<br />ret<br />ClassDesc_NeedsToSave endp<br /><br />ClassDesc_Save proc isave<br />	mov eax,IO_OK<br />ret<br />ClassDesc_Save endp<br /><br />ClassDesc_Load proc iload<br />	mov eax,IO_OK<br />ret<br />ClassDesc_Load endp<br /><br />ClassDesc_InitialRollupPageState proc<br />	mov eax,7FFFFFFFh<br />ret<br />ClassDesc_InitialRollupPageState endp<br /><br />ClassDesc_InternalName proc<br />	xor eax,eax<br />ret<br />ClassDesc_InternalName endp<br /><br />ClassDesc_HInstance proc<br />	xor eax,eax<br />ret<br />ClassDesc_HInstance endp<br /><br />ClassDesc_NumParamBlockDescs proc<br />	xor eax,eax<br />ret<br />ClassDesc_NumParamBlockDescs endp<br /><br />ClassDesc_GetParamBlockDesc proc i<br />	xor eax,eax<br />ret<br />ClassDesc_GetParamBlockDesc endp<br /><br />ClassDesc_GetParamBlockDescByID proc id<br />	xor eax,eax<br />ret<br />ClassDesc_GetParamBlockDescByID endp<br /><br />ClassDesc_AddParamBlockDesc proc pbd<br />ret<br />ClassDesc_AddParamBlockDesc endp<br /><br />ClassDesc_BeginEditParams proc ip,obj,flags,prev<br />ret<br />ClassDesc_BeginEditParams endp<br /><br />ClassDesc_EndEditParams proc ip,obj,flags,prev<br />ret<br />ClassDesc_EndEditParams endp<br /><br />ClassDesc_InvalidateUI proc pbd<br />ret<br />ClassDesc_InvalidateUI endp<br /><br />ClassDesc_GetRsrcString proc id<br />	xor eax,eax<br />ret<br />ClassDesc_GetRsrcString endp<br /><br />ClassDesc_MakeAutoParamBlocks proc owner<br />ret<br />ClassDesc_MakeAutoParamBlocks endp<br /><br />ClassDesc_NumParamMaps proc<br />	xor eax,eax<br />ret<br />ClassDesc_NumParamMaps endp<br /><br />ClassDesc_GetParamMap proc pbd<br />	xor eax,eax<br />ret<br />ClassDesc_GetParamMap endp<br /><br />ClassDesc_SetUserDlgProc proc pbd,procc<br />ret<br />ClassDesc_SetUserDlgProc endp<br /><br />ClassDesc_GetUserDlgProcpbd proc<br />	xor eax,eax<br />ret<br />ClassDesc_GetUserDlgProcpbd endp<br /><br />ClassDesc_DrawRepresentation proc bkColor,hDC,rect<br />	xor eax,eax<br />ret<br />ClassDesc_DrawRepresentation endp<br /><br />ClassDesc_NumInterfaces proc<br />	mov eax,&#91;ecx&#93;.ClassDesc.interfaces.BytesTaken<br />	shr eax,2<br />ret<br />ClassDesc_NumInterfaces endp<br /><br />ClassDesc_GetInterfaceAt proc i<br />ret<br />ClassDesc_GetInterfaceAt endp<br /><br />ClassDesc_GetInterface proc name1<br />ret<br />ClassDesc_GetInterface endp<br /><br />ClassDesc_AddInterface proc fpi<br />ret<br />ClassDesc_AddInterface endp<br /><br />ClassDesc_ClearInterfaces proc<br />	lea ecx,&#91;ecx&#93;.ClassDesc.interfaces<br />	push ecx<br />	delete ecx<br />	pop ecx<br />	$new ecx,ObjVector<br />ret<br />ClassDesc_ClearInterfaces endp<br /><br />ClassDesc_SubClassID proc<br />	icall ecx,ClassDesc,ClassID<br />ret<br />ClassDesc_SubClassID endp<br /><br />ClassDesc_Execute proc cmd,arg1,arg2,arg3<br />	xor eax,eax<br />ret<br />ClassDesc_Execute endp<br /><br /><br /><br />; ============================================================<br /><br /><br />class MeltClassDesc,ClassDesc,C++ compatible<br />	virtual IsPublic&#58;<br />	virtual Create&#58;	loading<br />	virtual ClassName&#58;<br />	<br />	virtual SuperClassID&#58;	<br />	<br />	virtual ClassID&#58;<br /><br />	virtual Category&#58;<br />endclass<br /><br /><br /><br /><br /><br />.data<br />	controlsInit dd 0<br />	MeltCD MeltClassDesc &lt;&gt;<br />.code<br />	<br /><br />DllMain	proc PUBLIC hinstDLL,fdwReason,lpvReserved<br />	m2m hInstance,hinstDLL<br />	cmp controlsInit,0<br />	jnz _ret<br />	mov controlsInit,1<br />	<br />	invoke InitCustomControls,hInstance<br />	invoke InitCommonControls<br /><br />_ret&#58;	mov eax,1<br />	ret<br />DllMain endp<br /><br /><br />LibClassDesc proc PUBLIC i<br />	xor eax,eax<br />	.if !i<br />		$new offset MeltCD,MeltClassDesc<br />		lea eax,MeltCD<br />	.endif<br />	ret	<br />LibClassDesc endp<br /><br /><br /><br /><br />MeltClassDesc_MeltClassDesc proc<br />ret<br />MeltClassDesc_MeltClassDesc endp<br /><br />MeltClassDesc_$MeltClassDesc proc<br />ret<br />MeltClassDesc_$MeltClassDesc endp<br /><br />MeltClassDesc_IsPublic proc<br />	mov eax,1<br />ret<br />MeltClassDesc_IsPublic endp<br /><br />MeltClassDesc_Create proc loading<br />ret<br />MeltClassDesc_Create endp<br /><br /><br /><br /><br /><br />end<br /><br /><br />&#91;/SIZE&#93; <br /></code></pre><br /><br />You should have some experience in C++/asm interfacing before coping with such a huge class. There are several procs I missed - you'll notice them when you have enough experience to convert the code.</div>
    <div class="meta">Posted on 2004-08-07 11:23:24 by Ultrano</div>
   </div>
  </div>
 </body>
</html>