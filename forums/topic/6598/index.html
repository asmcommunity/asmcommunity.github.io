<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>shrinking Iczelion?s window tut - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=6598" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=6598">shrinking Iczelion?s window tut</a></p>
   <div class="post" id="post-47654">
    <div class="subject"><a href="#post-47654">shrinking Iczelion?s window tut</a></div>
    <div class="body">HI!<br />I've been trying to &quot;shrink&quot; Iczelions?s Simple window example, and this is what I got.<br />Can anybody tell me why it doesn?t seem to work properly?<br /><br />Attached code:<br /><pre><code><br />;<br /><br />    .386<br />    .model flat,stdcall<br />    OPTION casemap&#58;none<br /><br />;<br />      include \masm32\include\windows.inc <br />      include \masm32\include\user32.inc <br />      include \masm32\include\kernel32.inc <br /><br />      includelib \masm32\lib\user32.lib <br />      includelib \masm32\lib\kernel32.lib <br /><br />;<br />    ;-------------<br />    ; MACROS<br />    ;-------------<br />    <br />    salir MACRO arg <br />        mov eax, arg <br />        ret <br />    ENDM <br /><br />; <br />    ;================= <br />    ; Local prototypes <br />    ;================= <br /><br />    WinMain PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD<br /><br />.data<br />    ClassName DB &quot;ClaseUno&quot;,0<br />    Caption1 DB &quot;Primera Ventana&quot;,0<br />.code<br /><br />start&#58;<br />    invoke WinMain, 40000, NULL, NULL, SW_SHOWDEFAULT<br />    invoke ExitProcess, NULL<br /><br />WinMain PROC hInst&#58;DWORD, hPrevInst&#58;DWORD, CmdLine&#58;DWORD, CmdShow&#58;DWORD<br />    LOCAL wc &#58;WNDCLASSEX  &lt;sizeof WNDCLASSEX, CS_HREDRAW or CS_VREDRAW or CS_BYTEALIGNWINDOW\<br />    ,offset WndProc, 0, 0, 400000, 0, 0, COLOR_BTNFACE + 1, 0, addr ClassName, 0&gt;<br />         ;Variables locales para usarlas mediante el stack<br /><br />    invoke RegisterClassEx, addr wc<br />    invoke CreateWindowEx, NULL, addr ClassName, addr Caption1, WS_VISIBLE, NULL,NULL,400000,NULL<br />    LOCAL hWnd1 &#58;DWORD<br />    invoke UpdateWindow<br />    LOCAL msg &#58;MSG<br /><br />.WHILE TRUE     ;Main Event Loop<br />    invoke GetMessage, addr msg, hWnd1,0,0<br />.BREAK .IF &#40;!eax&#41;       ;Para si no hay mensajes<br />    invoke TranslateMessage, addr msg<br />    invoke DispatchMessage, addr msg<br /><br />.ENDW<br />    ret<br />WinMain ENDP<br /><br /><br />WndProc PROC hWnd&#58;DWORD, idMsg&#58;DWORD, wParam&#58;DWORD, lParam&#58;DWORD<br />;Called by DispatchMessage only<br /><br />.IF idMsg==WM_DESTROY<br />    invoke PostQuitMessage, NULL<br />.ELSE<br />    invoke DefWindowProc, hWnd, idMsg, wParam, lParam<br />    ;Le pasa los mismos par?metros a Default...<br />    ret<br />.ENDIF<br />    salir 0     ;Sale sin errores<br /><br />WndProc ENDP<br /><br />END start<br /></code></pre><br /><br /><br /><span style="font-size:9px><em>[ code ] tags added by bAZiK</em></span></div>
    <div class="meta">Posted on 2002-07-15 05:39:11 by slop</div>
   </div>
   <div class="post" id="post-47659">
    <div class="subject"><a href="#post-47659">shrinking Iczelion?s window tut</a></div>
    <div class="body">The three most glaring errors:<br /><br />- you are missing a parameter with your call to UpdateWindow, you need to specify an hWnd<br /><br />- there is not RET at the end of your WndProc <br /><br />- you never move a value into hWnd1, so when you call GetMessage there is an unknown value in there<br /><br /><br />I know that you are a newbie, but that is pretty sloppy coding. You just need to take more care, and errors like this won't happen ;) :cool:<br /><br /><span style="font-size:9px>Oops, i just went back and re-read your macro, so disregard point #3 above </span></div>
    <div class="meta">Posted on 2002-07-15 07:01:42 by sluggy</div>
   </div>
   <div class="post" id="post-47660">
    <div class="subject"><a href="#post-47660">shrinking Iczelion?s window tut</a></div>
    <div class="body">You've presumed an hInstance, which is a bad thingTM.... Not only that, but you've presumed the wrong one!<br /><br />It may look right, but thats because you've forgoten the magic character.<br /><br />Mirno</div>
    <div class="meta">Posted on 2002-07-15 07:07:56 by Mirno</div>
   </div>
   <div class="post" id="post-47661">
    <div class="subject"><a href="#post-47661">shrinking Iczelion?s window tut</a></div>
    <div class="body"><div class="quote"><br />You've presumed an hInstance, which is a bad thingTM.... Not only that, but you've presumed the wrong one!<br /><br />It may look right, but thats because you've forgoten the magic character.<br /><br />Mirno </div><br /><br />And a 0 :)<br /><br /><pre><code><br />invoke WinMain, 400000h, 0, 0, SW_SHOWDEFAULT<br /></code></pre><br /><br />It's not a &quot;bad thing&quot; (TM). You know, we already had a discussion about that :)<br /><br />Here is an example source, generated by my &quot;FRM2ASM&quot; tool, <br />wich should be something like the &quot;minimum&quot; Window ;)<br />(notice that it also centers  the window :rolleyes: )<br /><br /><pre><code><br />        .486<br />        .model flat, stdcall<br />        option casemap &#58;none<br /><br />        include \masm32\include\windows.inc<br />        include \masm32\include\user32.inc<br />        include \masm32\include\kernel32.inc<br /><br />        includelib \masm32\lib\user32.lib<br />        includelib \masm32\lib\kernel32.lib<br /><br />.data<br /><br /><br />		szClassName		db &quot;Form1&quot;, 0<br /><br />		wc		WNDCLASSEX &lt;sizeof wc, CS_HREDRAW \<br />			        or CS_VREDRAW or CS_BYTEALIGNWINDOW, \<br />			        offset WndProc, 0, 0, 400000h, \<br />			        0, 0, COLOR_BTNFACE + 1, 0, \<br />			        offset szClassName, 0&gt;<br /><br />		szForm1		        db &quot;Form1&quot;, 0<br /><br />.data?<br />		hWnd     		dd ?<br />		msg		        MSG &lt;?&gt;<br /><br />.code<br /><br />  start&#58;<br /><br />      call WinMain<br />      invoke ExitProcess, eax<br /><br />  WinMain proc<br />      mov wc.hIcon, 0<br />      invoke LoadCursor, 0, IDC_ARROW<br />      mov wc.hCursor, eax<br />      invoke RegisterClassEx, addr wc<br />      invoke GetSystemMetrics, SM_CXSCREEN<br />      mov esi,eax<br />      invoke GetSystemMetrics, SM_CYSCREEN<br />      shr esi, 1<br />      shr eax, 1<br />      sub eax, 394/2<br />      sub esi, 228/2<br /><br />      invoke CreateWindowEx, WS_EX_TOPMOST,<br />                             addr szClassName,<br />                             addr szForm1,<br />                             WS_CAPTION or WS_MINIMIZEBOX or WS_SYSMENU or WS_VISIBLE,<br />                             esi, eax, 394, 228, 0, 0, 400000h, 0<br />      mov hWnd, eax<br />      invoke ShowWindow, hWnd, SW_SHOWNORMAL<br />      invoke UpdateWindow, hWnd<br />      mov esi, offset msg<br />   @@&#58;<br />      invoke GetMessage, esi, 0, 0, 0<br />      or eax, eax<br />      je @F<br />      invoke TranslateMessage, esi<br />      invoke DispatchMessage, esi<br />      jmp @B<br />   @@&#58;<br />      mov eax, msg.wParam<br />      ret<br />  WinMain endp<br /><br />  WndProc proc hWin &#58;DWORD,uMsg &#58;DWORD, wParam &#58;DWORD, lParam &#58;DWORD<br /><br />     .if uMsg == WM_CREATE<br /><br />    .elseif uMsg == WM_DESTROY<br /><br />        invoke PostQuitMessage, 0<br />        xor eax, eax<br />        ret<br /><br />    .endif<br /><br />    invoke DefWindowProc, hWin, uMsg, wParam, lParam<br /><br />    ret<br /><br />WndProc endp<br /><br />end start<br /></code></pre></div>
    <div class="meta">Posted on 2002-07-15 07:19:36 by bazik</div>
   </div>
   <div class="post" id="post-47680">
    <div class="subject"><a href="#post-47680">shrinking Iczelion?s window tut</a></div>
    <div class="body"><div class="quote">there is not RET at the end of your WndProc </div> <br /><br />sluggy,fjrp2 did use ret in the WndProc. However it is hidden in his marco :p<br /><br /><pre><code><br />    salir MACRO arg <br />        mov eax, arg <br />        ret <br />    ENDM <br /></code></pre></div>
    <div class="meta">Posted on 2002-07-15 09:12:11 by roticv</div>
   </div>
   <div class="post" id="post-47715">
    <div class="subject"><a href="#post-47715">shrinking Iczelion?s window tut</a></div>
    <div class="body">I haven?t been able to come back to the thread till now.<br />Thanks for the real-working minimum code, bAZiK.<br />And also <br /><br /><br />                         I know that you are a newbie, but that is pretty sloppy coding. You just need to take more<br />                         care, and errors like this won't happen  <br /><br />I know it?s sloppy (I wisj you coul see my bedroom...) they say that the code is usually similar to the coder... I?ll have to change a lot then... and &quot;re-distribute&quot; my neurons, or Learn from you wizards :)<br />I take it easy (and wait till next one ;) )</div>
    <div class="meta">Posted on 2002-07-15 12:12:44 by slop</div>
   </div>
   <div class="post" id="post-47717">
    <div class="subject"><a href="#post-47717">shrinking Iczelion?s window tut</a></div>
    <div class="body">And also, thank you for taggint it, bAZik, how did you do it? I tryed, but It?d appear that way.</div>
    <div class="meta">Posted on 2002-07-15 12:14:35 by slop</div>
   </div>
   <div class="post" id="post-47734">
    <div class="subject"><a href="#post-47734">shrinking Iczelion?s window tut</a></div>
    <div class="body"><div class="quote"><br />And also, thank you for taggint it, bAZik, how did you do it? I tryed, but It?d appear that way. </div><br /><br />It's explained at the bottom of this page:<br /><a target="_blank" href="http://www.asmcommunity.net/board/misc.php?s=&amp;action=bbcode">http://www.asmcommunity.net/board/misc.php?s=&amp;action=bbcode</a><br /><br />You can try it out in our TEST forum. :)<br /><br /><br />regards,<br />bAZiK</div>
    <div class="meta">Posted on 2002-07-15 13:02:06 by bazik</div>
   </div>
   <div class="post" id="post-48153">
    <div class="subject"><a href="#post-48153">shrinking Iczelion?s window tut</a></div>
    <div class="body">Now with VB tags <span style="font-size:24px>(Thanks bAZiK)</span>, and that have taken into consideration all your advices, here?s a working version of the first example:<br /><br /><pre><code>;Changed everything that you told me, and now it works ;&#41;<br />;By sloppy<br /><br />    .386<br />    .model flat,stdcall<br />    OPTION casemap&#58;none<br /><br />;<br />      include \masm32\include\windows.inc <br />      include \masm32\include\user32.inc <br />      include \masm32\include\kernel32.inc <br /><br />      includelib \masm32\lib\user32.lib <br />      includelib \masm32\lib\kernel32.lib <br /><br />;<br />    ;-------------<br />    ; MACROS<br />    ;-------------<br />    <br />    salir MACRO arg <br />        mov eax, arg <br />        ret <br />    ENDM <br /><br />; <br />    ;================= <br />    ; Local prototypes <br />    ;================= <br />   WinMain PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD<br />;<br />.data?<br />    hWnd1 DD ?<br />    mg MSG &lt;?&gt;<br /><br />.data<br />    wc WNDCLASSEX  &lt;sizeof wc, CS_HREDRAW or CS_VREDRAW or CS_BYTEALIGNWINDOW, \<br />                    offset WndProc, 0, 0, 400000h, 0, 0, COLOR_BTNFACE + 1, 0, \<br />                    offset ClassName, 0&gt;<br />    ClassName DB &quot;ClaseUno&quot;,0<br />    Caption1 DB &quot;Segunda Ventana&quot;,0<br /><br />.code<br /><br />start&#58;<br />    invoke WinMain, 400000h, NULL, NULL, SW_SHOWDEFAULT<br />    invoke ExitProcess, NULL<br /><br /><br />WinMain PROC hInst&#58;DWORD, hPrevInst&#58;DWORD, CmdLine&#58;DWORD, CmdShow&#58;DWORD<br />    invoke LoadCursor, 0, IDC_ARROW<br />    mov wc.hCursor, eax             ;Needed for normal behaviour of the cursors<br />    <br />    invoke RegisterClassEx, addr wc<br />    invoke CreateWindowEx, NULL, addr ClassName,\<br />                           addr Caption1, WS_VISIBLE or WS_SYSMENU,\<br />                           CW_USEDEFAULT, CW_USEDEFAULT,\<br />                           CW_USEDEFAULT, CW_USEDEFAULT,\<br />                           NULL,NULL,\<br />                           400000h,NULL	<br />    ;Devuelve hWnd en EAX<br />    mov &#91;hWnd1&#93;,eax<br />    invoke UpdateWindow,eax<br /><br />.WHILE TRUE     ;Main Event Loop<br />    invoke GetMessage, addr mg, NULL,0,0<br />.BREAK .IF &#40;!eax&#41;       ;Para si no hay mensajes<br />    invoke TranslateMessage, addr mg<br />    invoke DispatchMessage, addr mg<br /><br />.ENDW<br />    ret<br />WinMain ENDP<br /><br /><br />WndProc PROC handle&#58;DWORD, idMsg&#58;DWORD, wParam&#58;DWORD, lParam&#58;DWORD<br />;Called by DispatchMessage only<br /><br />.IF idMsg==WM_DESTROY<br />    invoke PostQuitMessage, NULL<br />.ELSE<br />    invoke DefWindowProc, handle, idMsg, wParam, lParam<br />    ;Le pasa los mismos par?metros a Default...<br />    ret<br />.ENDIF<br />    salir 0     ;Sale sin errores<br /><br />WndProc ENDP<br /><br />END start</code></pre><br /><br />And here?s the prog attached:</div>
    <div class="meta">Posted on 2002-07-17 11:02:38 by slop</div>
   </div>
  </div>
 </body>
</html>