<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>writing a Direct3D9 include - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13608" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=13608">writing a Direct3D9 include</a></p>
   <div class="post" id="post-105434">
    <div class="subject"><a href="#post-105434">writing a Direct3D9 include</a></div>
    <div class="body">Hey guys, I've been thinking about doing some D3D9 in assembly for fun and I noticed there wasn't an available include file. So I've started writing out the COM object definitions from the d3d9.h header file and I would appreciate it if someone could look over the IDirect3D9 definition I have so far. I would like to keep it consistant with the MASM COM stuff and hand it out when it's finished but I'm a newbie so I don't trust myself. Oh, any suggestions for speeding up the translation would be great since there are so many interfaces (As I write this the hugeness of the IDirect3DDevice9 interface is looming). Also, as far as interfaces that inherit from anoher interface, do put the functions from the inherited class into the derived class? Do they go before the other functions? For example, IDirect3DTexture9 inherits from IDirect3DBaseTexture9 which inherits from IDirect3DResource9 which inherits from IUnknown. When I'm adding the functions into the IDirect3DTexture9 structure, do I first write the IUnknown functions, then all the IDirect3DResource9 functions, IDirect3DBaseTexture9, and finally add the IDirect3DTexture9 functions at the end? Or do I simply write the specific IDirect3DTexture9 functions?<br /><br /><pre><code><br /><br />; PROTOTYPES -------------------------------------------------------------------------------------<br /><br />QueryInterface_Proto 		typedef PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD<br />AddRef_Proto 			typedef PROTO &#58;DWORD<br />Release_Proto 			typedef PROTO &#58;DWORD<br />RegisterSoftwareDevice_Proto	typedef PROTO &#58;DWORD, &#58;DWORD<br />GetAdapterCount_Proto		typedef PROTO &#58;DWORD<br />GetAdapterIdentifier_Proto		typedef PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD<br />GetAdapterModeCount_Proto		typedef PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD<br />EnumAdapterModes_Proto		typedef PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD<br />GetAdapterDisplayMode_Proto	typedef PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD<br />CheckDeviceType_Proto		typedef PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD<br />CheckDeviceFormat_Proto		typedef PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD<br />CheckDeviceMultiSampleType_Proto	typedef PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD <br />CheckDepthStencilMatch_Proto	typedef PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD<br />CheckDeviceFormatConversion_Proto	typedef PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD <br />GetDeviceCaps_Proto		typedef PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD <br />GetAdapterMonitor_Proto		typedef PROTO &#58;DWORD, &#58;DWORD <br />CreateDevice_Proto			typedef PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD <br /><br /><br />; END PROTOTYPES ----------------------------------------------------------------------------------<br /><br />; FUNCTION POINTERS -------------------------------------------------------------------------------<br /><br />QueryInterface_Pointer		typedef ptr QueryInterface_Proto<br />AddRef_Pointer			typedef ptr AddRef_Proto<br />Release_Pointer			typedef ptr Release_Proto<br />RegisterSoftwareDevice_Pointer	typedef ptr RegisterSoftwareDevice_Proto<br />GetAdapterCount_Pointer		typedef ptr GetAdapterCount_Proto<br />GetAdapterIdentifier_Pointer		typedef ptr GetAdapterIdentifier_Proto<br />GetAdapterModeCount_Pointer	typedef ptr GetAdapterModeCount_Proto<br />EnumAdapterModes_Pointer		typedef ptr EnumAdapterModes_Proto<br />GetAdapterDisplayMode_Pointer	typedef ptr GetAdapterDisplayMode_Proto<br />CheckDeviceType_Pointer		typedef ptr CheckDeviceType_Proto<br />CheckDeviceFormat_Pointer		typedef ptr CheckDeviceFormat_Proto<br />CheckDeviceMultiSampleType_Pointer	typedef ptr CheckDeviceMultiSampleType_Proto <br />CheckDepthStencilMatch_Pointer	typedef ptr CheckDepthStencilMatch_Proto<br />CheckDeviceFormatConversion_Pointer	typedef ptr CheckDeviceFormatConversion_Proto <br />GetDeviceCaps_Pointer		typedef ptr GetDeviceCaps_Proto <br />GetAdapterMonitor_Pointer		typedef ptr GetAdapterMonitor_Proto <br />CreateDevice_Pointer		typedef ptr CreateDevice_Proto <br /><br /><br />; END FUNCTION POINTERS ----------------------------------------------------------------------------<br /><br />; IDirect3D9 INTERFACE DEFINITION<br /><br />IDirect3D9 struct DWORD<br /><br />IDirect3D9_QueryInterface			QueryInterface_Pointer 		?<br />IDirect3D9_AddRef				AddRef_Pointer 			?<br />IDirect3D9_Release				Release_Pointer 			?<br />IDirect3D9_RegisterSoftwareDevice		RegisterSoftwareDevice_Pointer	?<br />IDirect3D9_GetAdapterCount			GetAdapterCount_Pointer		?<br />IDirect3D9_GetAdapterIdentifier		GetAdapterIdentifier_Pointer		?<br />IDirect3D9_GetAdapterModeCount		GetAdapterModeCount_Pointer	?<br />IDirect3D9_EnumAdapterModes		EnumAdapterModes_Pointer		?<br />IDirect3D9_GetAdapterDisplayMode		GetAdapterDisplayMode_Pointer	?<br />IDirect3D9_CheckDeviceType			CheckDeviceType_Pointer		?<br />IDirect3D9_CheckDeviceFormat		CheckDeviceFormat_Pointer		?<br />IDirect3D9_CheckDeviceMultiSampleType	CheckDeviceMultiSampleType_Pointer	?<br />IDirect3D9_CheckDepthStencilMatch		CheckDepthStencilMatch_Pointer	?<br />IDirect3D9_CheckDeviceFormatConversion	CheckDeviceFormatConversion_Pointer	?<br />IDirect3D9_GetDeviceCaps			GetDeviceCaps_Pointer		?<br />IDirect3D9_GetAdapterMonitor		GetAdapterMonitor_Pointer		?<br />IDirect3D9_CreateDevice			CreateDevice_Pointer		?<br /><br />IDirect3D9 ends<br /><br /></code></pre> <br /><br />Thanks for any suggestions or comments.<br /><br />...Sorry about the formatting, it looks correct the way I've copied it in, but in preview it is skewed.</div>
    <div class="meta">Posted on 2003-05-30 14:08:14 by AlexEiffel</div>
   </div>
   <div class="post" id="post-106245">
    <div class="subject"><a href="#post-106245">writing a Direct3D9 include</a></div>
    <div class="body">Try using the STDMETHOD macro - it makes life MUCH easier...<br />You don't need to define the IUnknown methods per se... take a look :)<br /><br />DECLARE_INTERFACE &lt;IDirect3D9A_&gt;<br />; IUnknown methods<br />INHERIT_IUnknown<br />;additional methods<br />STDMETHOD &lt;RegisterSoftwareDevice&gt;,:DWORD<br />STDMETHOD &lt;GetAdapterCount&gt;<br />...<br /><br />Note that using this method, you &quot;chop off&quot; the first dword parameter when defining the parameters for each Method, because that one is a pointer to &quot;This&quot; interface, and it's automagically added by our macro since its always there.<br /><br />Also, you don't need to close the definition at all, but you do add a struct like this:<br />IDirect3D9A STRUCT<br /> lpVtbl	dword ?<br />IDirect3D9A ENDS<br /><br />and some type definitions like this:<br />IDirect3D9 TYPEDEF	IDirect3D9A<br />LPDIRECT3D9A TYPEDEF PTR IDirect3D9A<br />LPDIRECT3D9  TYPEDEF PTR IDirect3D9<br /><br />and just incase you don't have the STDMETHOD macro,<br />STDMETHOD MACRO	name,argl :VARARG<br />	LOCAL @tmp_a<br />	LOCAL @tmp_b<br />	@tmp_a	TYPEDEF PROTO argl<br />	@tmp_b	TYPEDEF PTR @tmp_a<br />	name	@tmp_b	?<br />ENDM<br /><br />So that covers interfaces, and converting structs and equates is child's play.<br />Have fun :)</div>
    <div class="meta">Posted on 2003-06-07 00:59:55 by Homer</div>
   </div>
  </div>
 </body>
</html>