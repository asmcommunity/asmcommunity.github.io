<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>OpenGL Console - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=19695" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=19695">OpenGL Console</a></p>
   <div class="post" id="post-151480">
    <div class="subject"><a href="#post-151480">OpenGL Console</a></div>
    <div class="body">Here's my fledgling class for a Console in OpenGL.<br />I've implemented it using NeHe tutorial#17 as a testbed.<br />I'll post that later if anyone wants to see the Console working.<br />It's a Quake style console, the strings are stored in a dynamic array (can resize itself during runtime), no support for anything cool yet.<br />Font is assumed to be from a 256x256x24bit bmp, as 16x16 tiles (256 printable characters), as per NeHe tutorial#17.<br /><br /><br /><pre><code><br />;Console class<br />;EvilHomer<br />;October 18, 2004<br />;<br />;Console Commands are <br />;Implemented console commands&#58;<br />;List GLExtensions &#40;or simply &quot;list glx&quot;&#41; - enlists all opengl extensions supported by the local hardware<br />;<br /><br />class Console, ,C++ compatible<br />    virtual SetConsoleSize&#58;dwWidth, dwHeight    ;Should be called whenever screensize changed<br />    virtual Print&#58;xpixel, ypixel, pString, Set ;Set=CharacterSet, we fit 2 of them in our fontbitmap<br />    virtual Display&#58;yDisplacement<br />    virtual ScrollDown                              ;Scroll the display Down &#40;by incrementing FirstLine&#41;<br />    virtual ScrollUp                                   ;Scroll the display Up      &#40;by decrementing FirstLine&#41;<br />    virtual AddString&#58;pString                     ;Add a String to the internal StringArray &#40;mem will be allocated&#41;<br />    virtual Interpret&#58;pCommandString      ;Interpret an input command string<br />    virtual Enlist&#58;pCommandArgument    ;Handles &quot;list&quot; command<br />    long dwWidth                        ;&lt;-- ScreenWidth<br />    long dwHeight                       ;&lt;-- ScreenHeight &#40;from SetConsoleSize&#41;<br />    long pStrings                        ;ptr to instance of CVector, holding internal StringArray as array of ptrs to strings<br />    long FirstLine                       ;=First Line to be displayed<br />    long MaxLine                       ;=#Strings in StringArray<br />endclass<br /><br />Console_SetConsoleSize proc dwWidth, dwHeight<br />    m2m &#91;ecx&#93;.Console.dwWidth, dwWidth<br />    m2m &#91;ecx&#93;.Console.dwHeight, dwHeight<br />    ret<br />Console_SetConsoleSize endp<br /><br />Console_ScrollDown proc<br />    mov eax,&#91;ecx&#93;.Console.FirstLine<br />    inc eax<br />    .if eax&lt;&#91;ecx&#93;.Console.MaxLine<br />        inc &#91;ecx&#93;.Console.FirstLine<br />    .endif<br />    ret<br />Console_ScrollDown endp<br /><br />Console_ScrollUp proc<br />    mov eax,&#91;ecx&#93;.Console.FirstLine<br />    .if eax&gt;0<br />        dec &#91;ecx&#93;.Console.FirstLine<br />    .endif<br />    ret<br />Console_ScrollUp endp<br /><br />;Returns NULL=SUCCESS <br />;else eax=ptr to first unprinted character in string &#40;to be printed on a subsequent line?&#41;<br />Console_Print proc xpixel&#58;GLint, ypixel&#58;GLint, pString&#58;DWORD, Set&#58;UINT<br />    push ecx<br />    invoke glPrint , xpixel, ypixel, pString, Set<br />    invoke lstrlen, pString<br />    pop ecx<br />    shl eax,4 ;multiply by 16 &#40;font width&#41;<br />    .if eax&gt;&#91;ecx&#93;.Console.dwWidth<br />        sub eax,&#91;ecx&#93;.Console.dwWidth<br />        shr eax,4<br />        add eax,pString<br />        ret<br />    .endif<br />    xor eax,eax<br />    ret<br />Console_Print endp<br /><br />;Displays up to &#40;Height/16&#41; lines of text from internal stringarray<br />Console_Display proc yDisplacement<br />local iMaxLines<br />local iCurrentLine<br />local me<br />local CurrentX<br />local CurrentY<br />    mov me,ecx<br />    m2m iMaxLines, &#91;ecx&#93;.Console.FirstLine<br />    mov eax, &#91;ecx&#93;.Console.FirstLine<br />    mov iCurrentLine, eax<br />    xor eax,eax<br />    mov CurrentX,eax<br />    mov eax,&#91; ecx&#93;.Console.dwHeight<br />    sub eax,16<br />    mov CurrentY,eax<br />    shr eax,4                   ;divide by 16<br />    add iMaxLines,eax<br />    mov ecx,iCurrentLine<br />    .while ecx&lt;iMaxLines<br />        mov ebx,me<br />        icall &#91;ebx&#93;.Console.pStrings, CVector, getbyindex, iCurrentLine<br />        .break .if eax==0<br />        mov ebx,CurrentY<br />        sub ebx,yDisplacement<br />        icall me, Console, Print, CurrentX, ebx, eax, 0<br />        inc iCurrentLine<br />        mov eax,iCurrentLine<br />        sub CurrentY,16<br />        mov ecx,iCurrentLine<br />    .endw<br />    ret<br />Console_Display endp<br /><br />Console_AddString proc pString<br />    invoke AllocString,pString<br />    icall &#91;ecx&#93;.Console.pStrings, CVector, push_back, eax<br />    inc &#91;ecx&#93;.Console.MaxLine<br />    mov eax,&#91;ecx&#93;.Console.dwHeight<br />    shr eax,4<br />    dec eax    ;&lt;== #lines that fit on the screen<br />    .if eax&lt;&#91;ecx&#93;.Console.MaxLine<br />           icall ecx, Console, ScrollDown<br />    .endif<br />    ret<br />Console_AddString endp<br /><br />Console_$Console proc<br />local count<br />    icall &#91;ecx&#93;.Console.pStrings, CVector, getcount<br />    mov count,eax<br />    .while count !=0<br />        icall  &#91;ecx&#93;.Console.pStrings, CVector, pop_back<br />        free eax<br />        dec count<br />    .endw<br />    delete &#91;ecx&#93;.Console.pStrings<br />    ret<br />Console_$Console endp<br /><br />Console_Console proc<br />    mov &#91;ecx&#93;.Console.pStrings, new &#40;CVector&#41;<br />    ret<br />Console_Console endp<br /><br />Console_Interpret proc uses ebx edi pCommandString<br />local me<br />local pSecondTerm<br />mov me,ecx<br />.if pCommandString==0<br />    ret<br />.endif<br />icall me,Console,AddString, addr ConsoleString<br />mov esi,pCommandString<br />.while byte ptr&#91;esi&#93;!=0 &amp;&amp; byte ptr&#91;esi&#93;!=32<br />    inc esi<br />.endw<br />.if byte ptr&#91;esi&#93;==32<br />    mov byte ptr&#91;esi&#93;,0<br />    inc esi<br />    mov pSecondTerm,esi    <br />.else<br />    mov pSecondTerm,0<br />.endif<br /><br />invoke lstrcmpi, pCommandString, CTEXT&#40;&quot;list&quot;&#41;<br />.if eax==0<br />    icall me, Console, Enlist, pSecondTerm<br />.endif<br /><br />;<br />;<br />;<br /><br />ret<br />Console_Interpret endp<br /><br />Console_Enlist proc pListArgument<br />local me<br />    mov me,ecx<br />    .if pListArgument==0<br />        ret<br />    .endif<br />    invoke lstrcmpi, pListArgument, CTEXT&#40;&quot;glextensions&quot;&#41;<br />    .if eax==0<br />        jmp EnlistExtensions<br />    .endif<br />    invoke lstrcmpi, pListArgument, CTEXT&#40;&quot;glx&quot;&#41;<br />    .if eax==0<br />        jmp EnlistExtensions<br />    .endif<br />    ret<br /><br /><br />EnlistExtensions&#58;<br />    icall me, Console, AddString, CTEXT &#40;&quot;&#91;FULL LIST OF SUPPORTED OPENGL EXTENSIONS&#93;&quot;&#41;<br />    invoke glGetString,GL_EXTENSIONS    ;returns ptr to space-terminated array of strings as one large string<br />    mov esi,eax<br />    .while byte ptr&#91;esi&#93;!=0<br />        push esi<br />        .while byte ptr&#91;esi&#93;!=32 &amp;&amp; byte ptr&#91;esi&#93;!=0<br />                inc esi<br />        .endw<br />        .if byte ptr&#91;esi&#93;!=0        ;If we haven't found the array terminator<br />            mov byte ptr&#91;esi&#93;,0  ;Insert a string terminator <br />            inc esi                     ;and inc stringpointer &#40;skip stringterminator&#41;<br />        .endif<br />            mov edi,esi<br />            inc edi<br />            pop esi                 ;Retrieve the start of the current string<br />            push edi               ;Stow the start of the Next string<br />        .if byte ptr&#91;esi&#93;!=0<br />    icall me, Console, AddString,  esi   ;Add the String to the Console<br />        .endif<br />            pop esi                 ;Retrieve the start of the Next string<br />    .endw<br />    ret<br />Console_Enlist endp<br /></code></pre></div>
    <div class="meta">Posted on 2004-10-19 01:08:33 by Homer</div>
   </div>
   <div class="post" id="post-152003">
    <div class="subject"><a href="#post-152003">OpenGL Console</a></div>
    <div class="body">I've improved the Console class, added some very useful commands to it, and also written a &quot;programmable keyboard manager&quot; class which works closely with the Console class.<br /><br />Here is a list of all the currently supported console commands:<br /><br /><div class="quote"><br />List GLExtensions (or simply &quot;list glx&quot;) - enlists all opengl extensions supported by the local hardware.<br /><br />Quit (or &quot;exit&quot;, same thing) posts a Quit message, same as hitting <br />ESCAPE (or hitting 'close window' , when windowed)<br /><br />Time      messes with the dwGameTime ,fGameTimeMultipler, GameTimePaused variables.<br /><br />TimeBase  sets fGameTimeMultiplier<br /><br />Execute  executes a textfile as a series of scripted commands :) (no good support for nesting yet)<br /><br />SetKey   binds a function to a keycode<br /></div><br /><br />And here is a list of all the &quot;named functions&quot; accessible via the SetKey command:<br /><br /><div class="quote"><br />Quit<br />ModeToggle (toggles fullscreen/windowed)<br />TimeToggle  (freezes/unfreezed GameTimer)<br />ConToggle   (opens/closes Console)<br />Enter           (why would you want to reprogram this? I don't know)<br />Backspace   (for that matter, why would you change this one?)<br />Up               (Cursor Up)<br />Down           (Cursor Down)<br /></div><br /><br />If anyone is actually interested in this Quake-style Console, I will post the demo source in its current form and you can do what you like with it.<br />If you DO make extensions/improvements to it, I'd like to see them posted here in kind.<br /><br />Thanks, have a nice day :)</div>
    <div class="meta">Posted on 2004-10-29 02:36:31 by Homer</div>
   </div>
   <div class="post" id="post-152004">
    <div class="subject"><a href="#post-152004">OpenGL Console</a></div>
    <div class="body">As an example of the SetKey command:<br /><pre><code><br />setkey togglecon 32<br /></code></pre><br /><br />will reprogram the spacebar to open/close the console :)<br />Thus it's possible to bind any key to any named function, providing the function has an entry in my &quot;KeyCommands&quot; table:<br /><br /><pre><code><br />KeyCommand struct<br />    pCommandName dd ?       ;ptr to string = Name of command as displayed on screen<br />    pFunction dd ?                   ;ptr to handler function<br />    KeyCode db ?                    ;Default Key<br />KeyCommand ends<br /><br />.data<br />KeyCommands KeyCommand &lt;CTEXT&#40;&quot;Quit&quot;&#41;,offset DeadApp, VK_ESCAPE&gt;<br />                          KeyCommand &lt;CTEXT&#40;&quot;ModeToggle&quot;&#41;, offset F1, VK_F1&gt;<br />                          KeyCommand &lt;CTEXT&#40;&quot;TimeToggle&quot;&#41;, offset F2, VK_F2&gt;<br />                          KeyCommand &lt;CTEXT&#40;&quot;ConToggle&quot;&#41;, offset OnTilde, VK_TILDE&gt;<br />                          KeyCommand &lt;CTEXT&#40;&quot;Enter&quot;&#41;, offset OnEnter, VK_ENTER&gt;<br />                          KeyCommand &lt;CTEXT&#40;&quot;BackSpace&quot;&#41;, offset OnBackSpace, VK_BACK&gt;<br />                          KeyCommand &lt;CTEXT&#40;&quot;Up&quot;&#41;, offset OnCursorUp, VK_UP&gt;<br />                          KeyCommand &lt;CTEXT&#40;&quot;Down&quot;&#41;, offset OnCursorDown, VK_DOWN&gt;<br />                          KeyCommand &lt;0,0,0&gt;<br /></code></pre></div>
    <div class="meta">Posted on 2004-10-29 02:40:55 by Homer</div>
   </div>
   <div class="post" id="post-152044">
    <div class="subject"><a href="#post-152044">OpenGL Console</a></div>
    <div class="body">I've added internally-managed lists of named Object and Group nodes.<br />That means you can create Objects using the command &quot;Object &quot; and you can create Groups with the command &quot;Group &quot;.<br />I also added the following command syntax for adding an existing Object to an existing Group: &quot; Add &quot;<br /><br />You can create objects, and arrange them in groups, using commands in the console :)<br />I'll next add support for adding geometry to objects :)<br /><br />The idea is to construct complex objects using predefined and / or freehand-defined geometry elements, and then have the added ability to keep these objects in named groups, possibly defining even more complex objects...</div>
    <div class="meta">Posted on 2004-10-30 03:58:35 by Homer</div>
   </div>
   <div class="post" id="post-152086">
    <div class="subject"><a href="#post-152086">OpenGL Console</a></div>
    <div class="body">Is anyone interested in helping to expand this &quot;Command Line Interpreter&quot; into a fully-fledged runtime language of some kind?</div>
    <div class="meta">Posted on 2004-10-31 23:14:49 by Homer</div>
   </div>
   <div class="post" id="post-152146">
    <div class="subject"><a href="#post-152146">OpenGL Console</a></div>
    <div class="body">bleargh - I fully endorse and support me.</div>
    <div class="meta">Posted on 2004-11-02 01:15:37 by Homer</div>
   </div>
   <div class="post" id="post-152147">
    <div class="subject"><a href="#post-152147">OpenGL Console</a></div>
    <div class="body">How about a scriptable pluggin interface?<br /><br />Requirements:<br />- separate code from UI<br />- very modular (DLL for each object)<br />- UI can be generated automagically<br /><br />I've been thinking about this for a 3D program but it has many uses.  Let me give an example of what I mean above.  Let us say we have a BOX.DLL:<br /><br />box ; creates a box at orgin :)<br />box {height=10,width=30,length=40} ; still centered at orgin<br /><br />The same DLL works for programmatical control.  The shell will see that &quot;box&quot; is a public method that takes no parameters and the user can assign a button to this feature (default is the obvious).  Additionally, the &quot;box&quot; has a group of private-UI parameters which could be displayed on an option dialog/tab (up to the program).<br /><br />Another idea is to auto update global parameters - like ProjectName, FileName, etc -- based on whatever the current shell supports.  But the object can't assume anything of the shell.<br /><br />The key point being the UI is not assumed to be graphical, and graphical shells could be quite customizable based on the exposure of objects.  Need to work out some bumps to make it more scalable.<br /><br />What do you think? Stupid idea, huh :?:<br /><br />I'm pointed in the DX direction right now, but will attempt to make the interfaces API independent.  The front end of my checkers program will be replaced by a 3D version next year. I also want to make a DX version of <a target="_blank" href="http://uk.abalonegames.com/index.htm">Abalone</a> -- yeah, kind of lame to convert a board game, but I gave mine away to some kids and am too cheap to buy another. :)</div>
    <div class="meta">Posted on 2004-11-02 02:09:35 by bitRAKE</div>
   </div>
   <div class="post" id="post-152148">
    <div class="subject"><a href="#post-152148">OpenGL Console</a></div>
    <div class="body">That's what I already have in terms of the GUI only receives output from the result of interpreted commands .. although at the moment the code for the interpreter is nested in the console code, it is logically separate, and I have expressed an interest inseparating it further to a 'CInterpreter' class which is fed active lines of script either from the console input or from a script file...<br /><br />Glad to see some interest in this, it seems crazy to want to write yet another language, but if its a specialized oned and merely triggering our asm code, then afaics we can do no wrong.<br /><br />I'm currently messing around with some iocp support classes in order to add iocp server support as a class based module...</div>
    <div class="meta">Posted on 2004-11-02 02:16:40 by Homer</div>
   </div>
   <div class="post" id="post-152149">
    <div class="subject"><a href="#post-152149">OpenGL Console</a></div>
    <div class="body">Blah, DX, OGL, I don't care anymore, I just want some action :(<br /><br />All my support classes are ATC based, most are not DX or OGL specific, and moving from one to the other is not a problem for me.<br />I have more experience in DX as it stands, butI don't like Bill.com a whole lot...</div>
    <div class="meta">Posted on 2004-11-02 02:18:51 by Homer</div>
   </div>
   <div class="post" id="post-152169">
    <div class="subject"><a href="#post-152169">OpenGL Console</a></div>
    <div class="body"><div class="quote">Blah, DX, OGL, I don't care anymore, I just want some action :(</div>What, like 3D p0rn? :P<br />...there is much foreplay involved and still the possiblity of blue balls. :cry:</div>
    <div class="meta">Posted on 2004-11-02 08:31:09 by bitRAKE</div>
   </div>
   <div class="post" id="post-152233">
    <div class="subject"><a href="#post-152233">OpenGL Console</a></div>
    <div class="body">As far as enshrining stuff in DLL form, I certainly have no problem with that, but what is your solution for sharing the dll-owned data with the application? A shared BSS segment (special build DLL)? I mean I assume the DLL is responsible for resource allocation and release, absolving the caller executable from such duties means idiotproof programming..</div>
    <div class="meta">Posted on 2004-11-03 00:54:27 by Homer</div>
   </div>
   <div class="post" id="post-152275">
    <div class="subject"><a href="#post-152275">OpenGL Console</a></div>
    <div class="body">I haven't had a use for DLLs, yet.  What I've read of them seem to indicate they run in the same address space.  Wouldn't a DLL have access to memory of the parent process?  If not, then I'd rather make a simple loader than use a DLL.  So, much for enshrine.</div>
    <div class="meta">Posted on 2004-11-03 11:50:23 by bitRAKE</div>
   </div>
   <div class="post" id="post-152292">
    <div class="subject"><a href="#post-152292">OpenGL Console</a></div>
    <div class="body">I was thinking about a DLL shared by several concurrent processes, forming the core module of an engine.. I wrapped my existing ogl stuff in a DLL last night, now I'm unhappy with the flexibility of the initialisation procs eg fixed fov etc.. I'll post soon :)</div>
    <div class="meta">Posted on 2004-11-03 16:34:09 by Homer</div>
   </div>
  </div>
 </body>
</html>