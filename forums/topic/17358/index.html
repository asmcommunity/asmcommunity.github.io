<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>16 bit code Not the typical DOS program - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17358" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=17358">16 bit code Not the typical DOS program</a></p>
   <div class="post" id="post-134452">
    <div class="subject"><a href="#post-134452">16 bit code Not the typical DOS program</a></div>
    <div class="body">I am trying to analyze this program. This is the beginning code.<br /><br /> What I have learned is that the program uses a DOS extender.<br /><br /> If someone has time could you help me step through this so I can learn what it is doing.<br />  <br />It doesn't have the normal MZ signature. It stops interrupts for a  while and uses the extra segment.<br /><br />Thanks.<br /><br />  cs:0000 FA             cli                                 <br />  cs:0001 16             push   ss                           <br />  cs:0002 1F             pop    ds                           <br />  cs:0003 26A10200       mov    ax,es:[0002]                 <br />  cs:0007 83E840         sub    ax,0040                     <br />  cs:000A 8ED0           mov    ss,ax                        <br />  cs:000C FB             sti                                 <br />  cs:000D 06             push   es                           <br />  cs:000E 16             push   ss                           <br />  cs:000F 07             pop    es                           <br />  cs:0010 BEF003         mov    si,03F0                      <br />  cs:0013 8BFE           mov    di,si                        <br />  cs:0015 B91000         mov    cx,0010                      <br />  cs:0018 F3A4           rep movsb                           <br />  cs:001A 07             pop    es</div>
    <div class="meta">Posted on 2004-02-22 08:39:43 by skywalker</div>
   </div>
   <div class="post" id="post-134457">
    <div class="subject"><a href="#post-134457">16 bit code Not the typical DOS program</a></div>
    <div class="body">This code sets up a 1024 byte stack at the end of the memory and copies 16 bytes from the previous stack to the new stack. The cli and sti are pointless. Are you sure it is not an EXE file? If it isn't, then the addresses should start at 0x100.<br /><br />Edit: Actually, the board rules might not permit this kind of research for fear of the US law. But as long as you're not attempting to bypass protection mechanisms, you are probably not doing anything unlawful.</div>
    <div class="meta">Posted on 2004-02-22 09:38:50 by Sephiroth3</div>
   </div>
   <div class="post" id="post-134461">
    <div class="subject"><a href="#post-134461">Bigger stack might help speed ?</a></div>
    <div class="body"><div class="quote"><br />This code sets up a 1024 byte stack at the end of the memory and copies 16 bytes from the previous stack to the new stack. The cli and sti are pointless. Are you sure it is not an EXE file? If it isn't, then the addresses should start at 0x100.<br /><br />Edit: Actually, the board rules might not permit this kind of research for fear of the US law. But as long as you're not attempting to bypass protection mechanisms, you are probably not doing anything unlawful. </div><br /><br /><br />Here is the next section of code.<br />Thanks. If the stack was made bigger would it run faster.<br /><br />The program runs my 256M memory down to zero while it's running, then later it is restored upon program<br />termination.<br /><br /><br />110F:001B 36            SS:<br />110F:001C 8C06FC03      MOV     [03FC],ES<br />-u<br />110F:0020 8BD8          MOV     BX,AX<br />110F:0022 8CCA          MOV     DX,CS<br />110F:0024 36            SS:<br />110F:0025 0316F003      ADD     DX,[03F0]<br />110F:0029 36            SS:<br />110F:002A 8B2EF203      MOV     BP,[03F2]<br />110F:002E FD            STD<br />110F:002F 8BC5          MOV     AX,BP<br />110F:0031 3D0010        CMP     AX,1000<br />110F:0034 7603          JBE     0039<br />110F:0036 B80010        MOV     AX,1000<br />110F:0039 2BE8          SUB     BP,AX<br />110F:003B 2BD0          SUB     DX,AX<br />110F:003D 2BD8          SUB     BX,AX<br />110F:003F 8EDA          MOV     DS,DX<br />-</div>
    <div class="meta">Posted on 2004-02-22 10:20:02 by skywalker</div>
   </div>
   <div class="post" id="post-134471">
    <div class="subject"><a href="#post-134471">16 bit code Not the typical DOS program</a></div>
    <div class="body">Lol, no, it wouldn't :P<br />It's difficult to tell what the code is supposed to do. Maybe you could upload the program somewhere and PM or email me the address?</div>
    <div class="meta">Posted on 2004-02-22 11:19:36 by Sephiroth3</div>
   </div>
  </div>
 </body>
</html>