<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Mouse sensitive elements... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=9108" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=9108">Mouse sensitive elements...</a></p>
   <div class="post" id="post-66948">
    <div class="subject"><a href="#post-66948">Mouse sensitive elements...</a></div>
    <div class="body">Hello,<br /><br />  I am trying to make things move/change, or whatever when the mouse cursor is over a element. I dont know what to search for... I tried &quot;mouse over&quot; &quot;... sensitive: ... no use...<br /><br />  What options I have to do that?<br /><br />  Tnx! :)</div>
    <div class="meta">Posted on 2002-11-22 13:50:31 by wicr0s0ft</div>
   </div>
   <div class="post" id="post-66953">
    <div class="subject"><a href="#post-66953">Mouse sensitive elements...</a></div>
    <div class="body">WM_MOUSEMOVE</div>
    <div class="meta">Posted on 2002-11-22 14:31:53 by tenkey</div>
   </div>
   <div class="post" id="post-66954">
    <div class="subject"><a href="#post-66954">Mouse sensitive elements...</a></div>
    <div class="body">The ONLY way to do that is tracking the mouse coordinates on my window? I was thinking if I could do something like &quot;onmouseover&quot; for just a few elements of my window (a button, and one or 2 static controls)... so I really have to build the routines to process the values? ... it could be fun too. :)<br /><br />Ps:<br />Ok, I dont know what is with this board, but I have looked on that API. I think most people here find it too bad when people ask dumb looking questions or if you want, newbies... I think it is better to give them a good big answer, and maybe some options or things to look for, from their current knowledge, helping them to achieve what they are trying to do... but this discussion coud be on the Heap...</div>
    <div class="meta">Posted on 2002-11-22 14:46:07 by wicr0s0ft</div>
   </div>
   <div class="post" id="post-66961">
    <div class="subject"><a href="#post-66961">Mouse sensitive elements...</a></div>
    <div class="body">Any other suggestions?</div>
    <div class="meta">Posted on 2002-11-22 15:32:27 by wicr0s0ft</div>
   </div>
   <div class="post" id="post-66965">
    <div class="subject"><a href="#post-66965">Mouse sensitive elements...</a></div>
    <div class="body">I apologize for the extremely brief answer.<br /><br />For controls (such as buttons), you may need to subclass the controls. See Iczelion's tutorials. What messages to look for with subclassing? Maybe WM_MOUSEMOVE or WM_SETCURSOR.<br /><br />Hope someone can give you more ideas.</div>
    <div class="meta">Posted on 2002-11-22 15:57:57 by tenkey</div>
   </div>
   <div class="post" id="post-66985">
    <div class="subject"><a href="#post-66985">Mouse sensitive elements...</a></div>
    <div class="body">No worries.<br /><br />Thanks for the ideas. It helped me to search more specifically. :)<br /><br />... and yeah, I hope more good ideas come. I have to learn what subclassing is, but Im not sure it will be what I want.... better when you know, right? ;)<br /><br />See ya'round.<br /><br />Tnx again.</div>
    <div class="meta">Posted on 2002-11-22 20:11:34 by wicr0s0ft</div>
   </div>
   <div class="post" id="post-67005">
    <div class="subject"><a href="#post-67005">Mouse sensitive elements...</a></div>
    <div class="body">Code taken from Ewayne's code generator which produce a mouseover button<br /><br /><pre><code><br />;---------- &#91;Place in the Resource file &#40;.rc&#41;&#93; ----------<br />136      BITMAP  DISCARDABLE  &quot;MouseO4U.bmp&quot;<br />137      BITMAP  DISCARDABLE  &quot;MouseO4O.bmp&quot;<br />138      BITMAP  DISCARDABLE  &quot;MouseO4D.bmp&quot;<br />;---------- &#91;End of resource definitions&#93; ----------<br /><br />;---------- &#91;Place in the Application or Include file&#93; ----------<br />ControlButt    PROTO &#58;DWORD, &#58;DWORD, &#58;DWORD, &#58;DWORD<br /><br />;---------- &#91;Place in the Application file &#40;.asm&#41;&#93; ----------<br />.data<br />ButtClass      db  'BUTTON',0<br />FontName       db  'MS Sans Serif',0<br /><br />.data?<br />hButt5         dd  ?<br />lpButCtrl      dd  ?<br />hFontB         dd  ?<br /><br />Butt5D         dd  ?<br />Done           dd  ?<br /><br />lf             LOGFONT         &lt;&gt;<br /><br />.code<br /><br />start&#58;<br />.<br />.<br />.<br />      .if wMsg == WM_CREATE<br />;---------- &#91;Create the OwnerDrawn Button Control&#93; ----------<br />         INVOKE     CreateWindowEx, 0, addr ButtClass, 0,<br />                    WS_CHILD or WS_VISIBLE or BS_OWNERDRAW,<br />                    20, 20, 115, 26, hdlg, 187, hInst, 0<br />            mov     hButt5, eax<br /><br />;---------- &#91;Subclass the Control&#93; ----------<br />         INVOKE     SetWindowLong, hButt5, GWL_WNDPROC, ControlButt<br />            mov     lpButCtrl, eax<br /><br />;---------- &#91;Create the Button Font&#93; ----------<br />         INVOKE     lstrcpy, addr lf.lfFaceName, addr FontName<br />            mov     lf.lfHeight, 14<br />            mov     lf.lfWeight, 600<br />         INVOKE     CreateFontIndirect, ADDR lf<br />            mov     hFontB, eax<br /><br />;---------- &#91;Load the Bitmaps&#93; ----------<br />         INVOKE     LoadBitmap, hInst, 136<br />            mov     hBmp5U, eax<br />         INVOKE     LoadBitmap, hInst, 137<br />            mov     hBmp5O, eax<br />         INVOKE     LoadBitmap, hInst, 138<br />            mov     hBmp5D, eax<br /><br />;---------- &#91;Delete Objects&#93; ----------<br />      .elseif wmsg == WM_DESTROY<br />         INVOKE     DeleteObject, hBmp5U<br />         INVOKE     DeleteObject, hBmp5O<br />         INVOKE     DeleteObject, hBmp5D<br />         INVOKE     DeleteObject, hFontB<br />.<br />.<br />.<br /><br />;=================================================<br />; Copies an image to the face of a Button<br />;=================================================<br />CopyBitMap  PROC hButt&#58;DWORD, hBmp, bWh, bHt<br />LOCAL    hMemDC&#58;DWORD, hDC<br /><br />      INVOKE     GetDC, hButt               ; Get the dc of the button<br />         mov     hDC, eax<br />      INVOKE     CreateCompatibleDC, hDC    ; Create a compatible dc in memory<br />         mov     hMemDC, eax<br />      INVOKE     SelectObject, hMemDC, hBmp ; Select the opened bitmap into the dc<br />      INVOKE     BitBlt, hDC, 0, 0, bWh, bHt, hMemDC, 0, 0, SRCCOPY ;Copy the bitmap<br />      INVOKE     DeleteDC, hMemDC           ; Delete the memory dc<br />      INVOKE     ReleaseDC, hButt, hDC      ; Release the control dc<br /><br />         xor    eax, eax<br />         ret<br />CopyBitMap  endp<br /><br />;=================================================<br />; Subclass procedure for the Control Buttons<br />;=================================================<br />ControlButt  PROC  hwnd&#58;DWORD, wMsg, wParam, lParam<br /><br />      INVOKE     CallWindowProc, lpButCtrl, hwnd, wMsg, wParam, lParam<br /><br />      .if wMsg == WM_PAINT<br />PaintEM&#58;<br />            mov     eax, hwnd<br />         .if eax == hButt5<br />               mov     Butt5D, 0<br />            INVOKE     CopyBitMap, hwnd, hBmp5U, 115, 26<br />         .endif<br />            mov     UpDown, 1<br /><br />      .elseif wMsg == WM_LBUTTONDOWN<br />            mov     eax, hwnd<br />         .if eax == hButt5<br />               mov     Butt5D, 1<br />            INVOKE     CopyBitMap, hButt5, hBmp5D, 115, 26<br />         .else<br />               jmp     PaintEM<br />         .endif<br /><br />      .elseif wMsg == WM_MOUSEMOVE<br />         INVOKE     GetClientRect, hwnd, addr rect<br />            mov     ebx, lParam<br />            mov     ecx, ebx<br />            and     ebx, 0000ffffh<br />            shr     ecx, 16<br />            mov     eax, hwnd<br />         .if eax == hButt5<br />            .if ebx &gt;= rect.left &amp;&amp; ebx &lt;= rect.right &amp;&amp;\<br />                ecx &gt;= rect.top &amp;&amp; ecx &lt;= rect.bottom<br />               INVOKE     SetCapture, hButt5<br />               .if Butt5D<br />                  INVOKE     CopyBitMap, hButt5, hBmp5D, 115, 26<br />               .else<br />                  INVOKE     CopyBitMap, hButt5, hBmp5O, 115, 26<br />               .endif<br />            .else<br />               INVOKE     ReleaseCapture<br />                  jmp     PaintEM<br />            .endif<br />               jmp     Ret1<br />         .endif<br /><br />      .elseif wMsg == WM_LBUTTONUP<br />            mov     eax, hwnd<br />         .if eax == hButt5<br />               and     Butt5D, 0<br />            INVOKE     CopyBitMap, hButt5, hBmp5O, 115, 26<br />         .else<br />            jmp     PaintEM<br />         .endif<br />      .endif<br /><br />Ret1&#58;<br />         mov     eax, TRUE<br />         ret<br />ControlButt  ENDP<br /></code></pre></div>
    <div class="meta">Posted on 2002-11-23 00:44:43 by roticv</div>
   </div>
   <div class="post" id="post-67191">
    <div class="subject"><a href="#post-67191">Thanks a lot!</a></div>
    <div class="body">:)<br /><br />I see that the only way of doing mouse overs is to tracking its coordinates... I'll be fubling 'round these codes for sometime now... :)<br /><br />Thank <strong>you all</strong> for the pull!</div>
    <div class="meta">Posted on 2002-11-24 08:45:11 by wicr0s0ft</div>
   </div>
   <div class="post" id="post-67196">
    <div class="subject"><a href="#post-67196">Mouse sensitive elements...</a></div>
    <div class="body">Search on &quot;SetCapture&quot;, &quot;TrackMouseEvent&quot;(not supported on 95) and super/subclass.</div>
    <div class="meta">Posted on 2002-11-24 09:36:44 by C.Z.</div>
   </div>
   <div class="post" id="post-67197">
    <div class="subject"><a href="#post-67197">Mouse sensitive elements...</a></div>
    <div class="body">I have also written a  MouseOver routine which changes a window style to make it looked &quot;pressed&quot; instead of swapping bitmaps:<br /><br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=6142&amp;highlight=mouseover">http://www.asmcommunity.net/board/index.php?topic=6142&amp;highlight=mouseover</a></div>
    <div class="meta">Posted on 2002-11-24 09:51:40 by bazik</div>
   </div>
   <div class="post" id="post-67198">
    <div class="subject"><a href="#post-67198">Mouse sensitive elements...</a></div>
    <div class="body">Hello <strong>bomb01</strong> :)<br /><br />I don't think those 2 API's are needed:<br /><br />- WM_MOUSEMOVE says: <div class="quote">The WM_MOUSEMOVE message is posted to a window when the cursor moves. If the mouse is not captured, the message is posted to the window that contains the cursor. Otherwise, the message is posted to the window that has captured the mouse.</div><br /><br />From what I think: &quot;Mmm!! This means I do NOT have to capture mouse, because I receive its coordinates when it is over my window. :) This is cool!&quot;<br /><br />And about the second one, I don't want to use it just for portability... and since there is an easy alternative, I don't wanna bother with it...<br /><br />Don't you agree?? ;)<br /><br />Well, I'm just trying to understand the reason of your suggestion, because maybe you didn't knew what I explained above....<br /><br />Superclass and subclassing... means changing default proc and settings of predefined classes (buttons, boxes,...) for what Ive seen 'til now, right? Seems like fun.<br /><br /><br />S'ya, pal!</div>
    <div class="meta">Posted on 2002-11-24 10:02:52 by wicr0s0ft</div>
   </div>
   <div class="post" id="post-67199">
    <div class="subject"><a href="#post-67199">bazik, yours, crashes!</a></div>
    <div class="body">I have found your outlook example <strong>before!</strong> 8-)<br /><br />..but it crashes when I run it... it crashes only when I point to the bar. Im using win98se. Do you know why? ... the code was there still... ;-)<br /><br />Your idea (changing style instead of new bitmaps) was my fisrt one. Jsut didn't see how would get to know when change it.... :)<br /><br />Ps: <em>crash info</em> in case you want to debug it<br /><pre><code><br />OUTLOOK_STYLE causou uma falha de prote??o geral<br />no m?dulo KERNEL32.DLL em 0167&#58;bff73641.<br />Registros&#58;<br />EAX=00000000 CS=0167 EIP=bff73641 EFLGS=00010246<br />EBX=0063fd2c SS=016f ESP=00000000 EBP=0063fcf8<br />ECX=00000000 DS=016f ESI=00008d50 FS=4437<br />EDX=00000000 ES=016f EDI=00000000 GS=0000<br />Bytes em CS&#58;EIP&#58;<br />5f 5e c9 c2 0c 00 52 51 33 c0 48 50 50 65 ff 32<br />Esvaziamento da pilha&#58;<br />00ca0f9e 00700465 09f20016 00700465 00700465<br />f000ff54 f000ea79 f000ea21 c8000000 0ac808d2<br />09f2003a 09f20052 09f2006a 09f20082 09f2009a<br />00700465<br /></code></pre></div>
    <div class="meta">Posted on 2002-11-24 10:31:13 by wicr0s0ft</div>
   </div>
   <div class="post" id="post-67318">
    <div class="subject"><a href="#post-67318">Mouse sensitive elements...</a></div>
    <div class="body">wicr0s0ft:<br /><br />Do you mean to just add<br />WM_MOUSEMOVE: SetCursor(hcursor);<br />to the window procedure?<br /><br />i don't think that's good option. imo, it doesn't give good performance calling an api each time the mouse moves, when the cursor shape is already correctly set.<br /><br />we had better: set the cursor shape the first time it moves in, and restore it when moves out. Windows doesn't tell you when the mouse moves out (no such msg)unless the window has captured the mouse.<br /><br />TrackMouseEvent is a handy alternative, many windows programs use it for mouse sensitive elements like floating buttons and toolbars. that's why i suggested them.:)</div>
    <div class="meta">Posted on 2002-11-25 04:20:51 by C.Z.</div>
   </div>
   <div class="post" id="post-67321">
    <div class="subject"><a href="#post-67321">Re: bazik, yours, crashes!</a></div>
    <div class="body"><div class="quote"><br />I have found your outlook example <strong>before!</strong> 8-)<br /><br />..but it crashes when I run it... it crashes only when I point to the bar. Im using win98se. Do you know why? ... the code was there still... ;-)<br /><br />Your idea (changing style instead of new bitmaps) was my fisrt one. Jsut didn't see how would get to know when change it.... :)<br /><br />Ps: <em>crash info</em> in case you want to debug it<br /><pre><code><br />OUTLOOK_STYLE causou uma falha de prote??o geral<br />no m?dulo KERNEL32.DLL em 0167&#58;bff73641.<br />Registros&#58;<br />EAX=00000000 CS=0167 EIP=bff73641 EFLGS=00010246<br />EBX=0063fd2c SS=016f ESP=00000000 EBP=0063fcf8<br />ECX=00000000 DS=016f ESI=00008d50 FS=4437<br />EDX=00000000 ES=016f EDI=00000000 GS=0000<br />Bytes em CS&#58;EIP&#58;<br />5f 5e c9 c2 0c 00 52 51 33 c0 48 50 50 65 ff 32<br />Esvaziamento da pilha&#58;<br />00ca0f9e 00700465 09f20016 00700465 00700465<br />f000ff54 f000ea79 f000ea21 c8000000 0ac808d2<br />09f2003a 09f20052 09f2006a 09f20082 09f2009a<br />00700465<br /></code></pre> </div><br /><br /><br />Why dont you fix it then? :)<br /><br />You need to push &amp; pop edi...<br /><br /><pre><code><br />MouseOver proc hCtl &#58;DWORD<br />    invoke GetWindowLong, hCtl, GWL_EXSTYLE <br />    .if &#40;!&#40;eax &amp; WS_EX_CLIENTEDGE&#41;&#41; <br />	push edi ; &lt;---------------------------------------------------------<br />        mov edi, eax<br />        mov eax, WS_EX_CLIENTEDGE   <br />        or eax, edi             <br />        invoke SetWindowLong, hCtl, GWL_EXSTYLE, eax<br />        invoke SetWindowPos, hCtl, 0, 0, 0, 0, 0, ; redraw window<br />                             SWP_NOSIZE or SWP_NOMOVE or \<br />                             SWP_NOZORDER or SWP_NOACTIVATE or \<br />                             SWP_FRAMECHANGED<br />	pop edi ; &lt;---------------------------------------------------------<br />    .endif<br />    ret<br />MouseOver endp<br /></code></pre><br /><br />.... or upgrade to a real OS because crappy Win9x cares that much about register preversation ;)</div>
    <div class="meta">Posted on 2002-11-25 04:52:41 by bazik</div>
   </div>
   <div class="post" id="post-67415">
    <div class="subject"><a href="#post-67415">WM_MOUSEMOVE</a></div>
    <div class="body">bomb01,<br /><br />  I still disagree with you, but it seems like yu missed my point.<br />  My idea is not to change the cursor every time mouse moves... maybe I would just cehck if I gotta change or not... but my idea is to change the button's attributes when the mouse is over the button's area in my window.<br /><br />  API ref states:<br />  <div class="quote">The WM_MOUSEMOVE message is posted to a window when the cursor moves. If the mouse is not captured, the message is posted to the window that contains the cursor. Otherwise, the message is posted to the window that has captured the mouse. <br /><br />WM_MOUSEMOVE  <br />fwKeys = wParam;        // key flags <br />xPos = LOWORD(lParam);  // horizontal position of cursor <br />yPos = HIWORD(lParam);  // vertical position of cursor</div><br /><br /> So, when my procedure proccess the WM_MOUSEMOVE message, it will do a FEW calculations to know where in the window the cursor is. I don't plan to do that using APIs, since I think it is not that hard to be done... ;) ... I'll just compare the each coordinate with 4 or eight values (I have two sensitive buttons).<br /><br /> Further, if I want to change the mouse cursor, I would just have to check another range of value... :) ... and NO, I don't think that is bloat... did you know that all those little animations we have in windoze shell are AVI clips?? Now THAT is bloat! :-d<br /><br /> Got it? :)<br /><br /> Glad to discuss.</div>
    <div class="meta">Posted on 2002-11-25 12:26:44 by wicr0s0ft</div>
   </div>
   <div class="post" id="post-67420">
    <div class="subject"><a href="#post-67420">Mouse sensitive elements...</a></div>
    <div class="body">Oh no, bazik!<br /><br />So you say that the reason it crashes on 98 is &quot;absolved&quot; by later OSes?? :-d ... funny. :-D<br />So that two lil mnes fix it?<br /><br />...<br /><br />About changing OS:<br />I have so much thigs I hate about MS-OSes above win98 that I could write a whole thread about it. I can't see the minute I get my precious win98 (1st ED) back to me, and install it again. I use to start my whole PC in 13 seconds. Not kidding :( ... now it takes at least 23 seconds. I have had much fun with 98 setings, and new versions of windoze aint fun. They are bloated and have that WEIRD &quot;user friendly&quot; (IMHO much hard to deal with, since its obscure) concept much more cramped inside it. :(<br /><br />Im thinking about Linux, but it is becoming more and more bloat every day, trying to be a alter-ego of windoze... :**( ... that makes it hard and distant to play with it, until it comes clean...<br /><br />...</div>
    <div class="meta">Posted on 2002-11-25 13:22:41 by wicr0s0ft</div>
   </div>
   <div class="post" id="post-67432">
    <div class="subject"><a href="#post-67432">Mouse sensitive elements...</a></div>
    <div class="body">&gt;So that two lil mnes fix it?<br /><br />Yes :)<br /><br />&gt;Im thinking about Linux, but it is becoming more and more bloat every day, trying to be a alter-ego of windoze... :**( ... that <br />&gt;makes it hard and distant to play with it, until it comes clean...<br /><br />You didnt try Gentoo yet :grin: (<a target="_blank" href="www.gentoo.org">www.gentoo.org</a>)</div>
    <div class="meta">Posted on 2002-11-25 14:58:21 by bazik</div>
   </div>
  </div>
 </body>
</html>