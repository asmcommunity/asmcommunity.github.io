<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ExitProcess call is required??? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29726" />
    <link rel="next" href="../?id=29726&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29726">ExitProcess call is required???</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=29726&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=29726&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="29726" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=29726&amp;page=2">&gt;</a><a href="../?id=29726&amp;page=2">&raquo;</a></form>   <div class="post" id="post-209923">
    <div class="subject"><a href="#post-209923">ExitProcess call is required???</a></div>
    <div class="body">Hi,<br /><br />I have written couple of tiny win32 assembly programs using mingw and the following is one of them. I have seen some examples in MASM and FASM which call ExitProcess at the end. This particular program is working fine even without ExitProcess. Any thoughts???<br /><br /><pre><code><br /><br />.intel_syntax noprefix<br /><br />.section .data<br /> &nbsp; &nbsp;window_title:<br /> &nbsp; &nbsp; &nbsp; &nbsp;.ascii &quot;Note\0&quot;<br /><br /> &nbsp; &nbsp;window_message:<br /> &nbsp; &nbsp; &nbsp; &nbsp;.ascii &quot;Goodbye, cruel world!\0&quot;<br /> &nbsp; &nbsp;<br />.section .text<br /> &nbsp; &nbsp;.globl _start<br /> &nbsp; &nbsp;_start:<br /> &nbsp; &nbsp; &nbsp; &nbsp;# function prologue<br /> &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;ebp<br /> &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; ebp, esp<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;offset window_title<br /> &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;offset window_message<br /> &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_MessageBoxA@16<br /> &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; eax, 0<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;# function epilogue &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; esp, ebp<br /> &nbsp; &nbsp; &nbsp; &nbsp;pop &nbsp; &nbsp; ebp<br /> &nbsp; &nbsp; &nbsp; &nbsp;ret<br /><br /></code></pre><br /><br />But the second one, a simple window program, displays window properly and gets closed when clicked on X button, but still appears in the task manager process list. Here is the second program, a bit lengthy one....I tried calling ExitProcess after the message loop, but still is not working.<br /><br /><pre><code><br /># after calling win32 api functions, no need to reset the stack.<br /># function will adjust the stack automatically<br /><br />.intel_syntax noprefix<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br />.globl window_class &nbsp; <br />.section .data<br /> &nbsp; &nbsp;window_title:<br /> &nbsp; &nbsp; &nbsp; &nbsp;.ascii &quot;Window Title\0&quot;<br /> &nbsp; &nbsp;window_class:<br /> &nbsp; &nbsp; &nbsp; &nbsp;.ascii &quot;myWindowClass\0&quot;<br /> &nbsp; &nbsp;error_window:<br /> &nbsp; &nbsp; &nbsp; &nbsp;.ascii &quot;Error\0&quot;<br /> &nbsp; &nbsp;wnd_creation_errmsg:<br /> &nbsp; &nbsp; &nbsp; &nbsp;.ascii &quot;Window creation failed\0&quot;<br /> &nbsp; &nbsp;class_reg_errmsg:<br /> &nbsp; &nbsp; &nbsp; &nbsp;.ascii &quot;Class registration failed\0&quot;<br /><br />.section .bss<br /> &nbsp; &nbsp;.lcomm &nbsp; &nbsp;hwnd, 4<br /> &nbsp; &nbsp;.lcomm &nbsp; &nbsp;hIcon, 4<br /> &nbsp; &nbsp;.lcomm &nbsp; &nbsp;hCursor, 4<br /> &nbsp; &nbsp;.lcomm &nbsp; &nbsp;msg, 4<br /> &nbsp; &nbsp;.lcomm &nbsp; &nbsp;strct_wndclassex, 48<br /> &nbsp; &nbsp;.lcomm &nbsp; &nbsp;err_code, 4<br /> &nbsp; &nbsp;.lcomm &nbsp; &nbsp;hInstance, 4<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br />.section .text<br /> &nbsp; &nbsp;.globl _start<br /> &nbsp; &nbsp;.globl _wnd_proc &nbsp;<br /> &nbsp; &nbsp;<br /> &nbsp; &nbsp;_start:<br /> &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;ebp<br /> &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; ebp, esp<br /> &nbsp; &nbsp; &nbsp; <br /> &nbsp; &nbsp; &nbsp; &nbsp;load_icon:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;32512<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_LoadIconA@8<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr hIcon, eax<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;load_cursor:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;32512<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_LoadCursorA@8<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr hCursor, eax<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;get_hinstance:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_GetModuleHandleA@4<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr hInstance, eax<br /> &nbsp; &nbsp; &nbsp; <br /> &nbsp; &nbsp; &nbsp; &nbsp;fill_struct_windclassex:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; edi, offset strct_wndclassex <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr , 48<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr , 0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr , offset _wnd_proc<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr , 0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr , 0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; eax, hInstance<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr , eax<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; eax, hIcon<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr , eax<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; eax, hCursor<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr , eax<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr , 6<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr , 0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr , offset window_class<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; eax, hIcon<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr , eax<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;regsiter_window:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;offset strct_wndclassex<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_RegisterClassExA@4<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cmp &nbsp; &nbsp; eax, 0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jnz &nbsp; &nbsp; create_window<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;class_reg_failed:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0x30<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;offset error_window<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;offset class_reg_errmsg<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_MessageBoxA@16<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; &nbsp; &nbsp;eax, 0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jmp &nbsp; &nbsp; return_WinMain<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;create_window:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#push &nbsp; &nbsp;dword ptr <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;hInstance<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;120<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;240<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;-2147483648<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;-2147483648<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;13565952<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;offset window_title<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;offset window_class<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;512<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_CreateWindowExA@48<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cmp &nbsp; &nbsp; eax, 0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jnz &nbsp; &nbsp; show_window<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;window_creation_failed:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0x30<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;offset error_window<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;offset wnd_creation_errmsg<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_MessageBoxA@16<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; &nbsp; &nbsp;eax, 0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jmp &nbsp; &nbsp; return_WinMain<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;show_window:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# save the return value in hwnd<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; dword ptr hwnd, eax<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;1<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;eax<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_ShowWindow@8<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;update_window:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;dword ptr hwnd<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_UpdateWindow@4<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;msg_loop:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;offset msg<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_GetMessageA@16<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cmp &nbsp; &nbsp; eax, 0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jg &nbsp; &nbsp; &nbsp;translate_msg<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;translate_msg:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;offset msg<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_TranslateMessage@4<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dispatch_msg:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;offset msg<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_DispatchMessageA@4<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jmp &nbsp; &nbsp; msg_loop<br /> &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;return_WinMain:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# function epilogue &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp;esp, ebp<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pop &nbsp; &nbsp;ebp<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ret<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp;# callback function to handle messages for the window<br /> &nbsp; &nbsp;_wnd_proc:<br /> &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;ebp<br /> &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; ebp, esp<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;cmp &nbsp; &nbsp; dword ptr , 16<br /> &nbsp; &nbsp; &nbsp; &nbsp;jz &nbsp; &nbsp; &nbsp;close<br /> &nbsp; &nbsp; &nbsp; &nbsp;cmp &nbsp; &nbsp; dword ptr , 2<br /> &nbsp; &nbsp; &nbsp; &nbsp;jz &nbsp; &nbsp; &nbsp;destroy<br /> &nbsp; &nbsp; &nbsp; &nbsp;jmp &nbsp; &nbsp; default<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;close: <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;dword ptr <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_DestroyWindow@4<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jmp &nbsp; &nbsp; return_WndProc<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;destroy:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_PostQuitMessage@4<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jmp &nbsp; &nbsp; return_WndProc<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;default:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;dword ptr <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;dword ptr <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;dword ptr <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push &nbsp; &nbsp;dword ptr <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;_DefWindowProcA@16<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;return_WndProc:<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; esp, ebp<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pop &nbsp; &nbsp; ebp<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ret<br /> &nbsp;<br /></code></pre></div>
    <div class="meta">Posted on 2009-12-17 04:51:23 by uglyhunK</div>
   </div>
   <div class="post" id="post-209925">
    <div class="subject"><a href="#post-209925">Re: ExitProcess call is required???</a></div>
    <div class="body">If your stack is correctly balanced, your program will <strong>probably</strong> terminate just fine by doing a &quot;ret&quot; - but this is an undocumented Windows implementation detail, and not something you should depend on - ExitProcess is the correct way to exit.<br /><br />What&#039;s with the use of labels insetad of comments, and magic numbers instead of constants? Ugly ugly.<br /><br />Anyway, younever seem to exit your msssageloop... you should exit on GetMessage returning 0.</div>
    <div class="meta">Posted on 2009-12-17 05:16:20 by f0dder</div>
   </div>
   <div class="post" id="post-209926">
    <div class="subject"><a href="#post-209926">Re: ExitProcess call is required???</a></div>
    <div class="body">I feel, by using labels we can separate blocks of code, helps in indentation and at the same time serves the dual purpose of what that block does. Constants, yes it should be the right way. And by the way, thanks for the inputs, changing &quot;jg&nbsp; &nbsp; translate_msg&quot; to &quot;jng&nbsp;  return_WinMain&quot; did the job. Damn.....been looking at it for almost 2hrs and did not even notice.....<br /><br /><pre><code><br />msg_loop:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; offset msg<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; _GetMessageA@16<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  eax, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jng&nbsp; &nbsp;  return_WinMain<br /></code></pre></div>
    <div class="meta">Posted on 2009-12-17 06:40:29 by uglyhunK</div>
   </div>
   <div class="post" id="post-209928">
    <div class="subject"><a href="#post-209928">Re: ExitProcess call is required???</a></div>
    <div class="body">I&#039;d like to point out that jg/jng consider SIGNED numbers, so they check zero flag AND sign/overflow flag (as opposed to ja/jb).<br />GetMessage() returns a BOOL, which should be interpreted as an UNSIGNED number.<br />You should just use jz/jnz to check for zero/nonzero values. Only on zero you should exit the loop.<br /><br />So don&#039;t forget... for signed stuff, you use greater/less, for unsigned stuff you use above/below.<br />Here&#039;s a nice overview of the different conditional jumps:<br />http://unixwiz.net/techtips/x86-jumps.html</div>
    <div class="meta">Posted on 2009-12-17 07:40:12 by Scali</div>
   </div>
   <div class="post" id="post-209929">
    <div class="subject"><a href="#post-209929">Re: ExitProcess call is required???</a></div>
    <div class="body"><div class="quote">I feel, by using labels we can separate blocks of code, helps in indentation and at the same time serves the dual purpose of what that block does.</div>If I see a label, I expect it to be used as a branch target - so it makes the program structure less clear to use labels for commenting purposes, when a comment is really what you&#039;re making.</div>
    <div class="meta">Posted on 2009-12-17 08:57:43 by f0dder</div>
   </div>
   <div class="post" id="post-209930">
    <div class="subject"><a href="#post-209930">Re: ExitProcess call is required???</a></div>
    <div class="body"><div class="quote"><br />I&#039;d like to point out that jg/jng consider SIGNED numbers, so they check zero flag AND sign/overflow flag (as opposed to ja/jb).<br />GetMessage() returns a BOOL, which should be interpreted as an UNSIGNED number.<br />You should just use jz/jnz to check for zero/nonzero values. Only on zero you should exit the loop.<br /></div><br /><br />According to the API, GetMessage() returns 0 on WM_QUIT and values &gt; 0 for other messages. But it also returns -1 on error. Ideally I should handle that exception, in which case, I should check for signed integers. Isn&#039;t it???</div>
    <div class="meta">Posted on 2009-12-17 09:48:44 by uglyhunK</div>
   </div>
   <div class="post" id="post-209931">
    <div class="subject"><a href="#post-209931">Re: ExitProcess call is required???</a></div>
    <div class="body"><div class="quote"><br />According to the API, GetMessage() returns 0 on WM_QUIT and values &gt; 0 for other messages. But it also returns -1 on error. Ideally I should handle that exception, in which case, I should check for signed integers. Isn&#039;t it???<br /></div>Yep - shame on Microsoft for using BOOL as return type when the possible values are clearly not just TRUE/FALSE.</div>
    <div class="meta">Posted on 2009-12-17 09:52:38 by f0dder</div>
   </div>
   <div class="post" id="post-209932">
    <div class="subject"><a href="#post-209932">Re: ExitProcess call is required???</a></div>
    <div class="body"><div class="quote"><br /><div class="quote">I feel, by using labels we can separate blocks of code, helps in indentation and at the same time serves the dual purpose of what that block does.</div>If I see a label, I expect it to be used as a branch target - so it makes the program structure less clear to use labels for commenting purposes, when a comment is really what you&#039;re making.<br /></div><br />Yes, I totally agree with you. But, I did not mean that labels are a replacement for comments. It certainly increases the general readability of the assembly source. Otherwise it is just strings of instructions.....may be I feel this way because my journey is from c-&gt;java-&gt;assembly.</div>
    <div class="meta">Posted on 2009-12-17 10:03:22 by uglyhunK</div>
   </div>
   <div class="post" id="post-209933">
    <div class="subject"><a href="#post-209933">Re: ExitProcess call is required???</a></div>
    <div class="body">MSDN says you should do this:<br /><pre><code>BOOL bRet;<br /><br />while( (bRet = GetMessage( &amp;msg, NULL, 0, 0 )) != 0)<br />{ <br />&nbsp; &nbsp; if (bRet == -1)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; // handle the error and possibly exit<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; else<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; TranslateMessage(&amp;msg); <br />&nbsp; &nbsp; &nbsp; &nbsp; DispatchMessage(&amp;msg); <br />&nbsp; &nbsp; }<br />}</code></pre><br /><br />So special cases for 0 and -1.</div>
    <div class="meta">Posted on 2009-12-17 10:22:31 by Scali</div>
   </div>
   <div class="post" id="post-209934">
    <div class="subject"><a href="#post-209934">Re: ExitProcess call is required???</a></div>
    <div class="body"><div class="quote"><br />Yes, I totally agree with you. But, I did not mean that labels are a replacement for comments. It certainly increases the general readability of the assembly source. Otherwise it is just strings of instructions.....may be I feel this way because my journey is from c-&gt;java-&gt;assembly.<br /></div>My language &quot;journey&quot; has been Pascal, asm16, asm32, C, C++, Python (pretty small tools), LUA (very little), asm64 (very little), Java, and I&#039;ll pick up C# in a few months... I definitely have a high-level bias, and I still don&#039;t think using labels instead of comments is the way to go :)<br /><br />Programs <strong>are</strong> just string of instructions, but we can split them into procedures/functions - which is when you&#039;d use labels :)</div>
    <div class="meta">Posted on 2009-12-17 10:28:38 by f0dder</div>
   </div>
   <div class="post" id="post-209941">
    <div class="subject"><a href="#post-209941">Re: ExitProcess call is required???</a></div>
    <div class="body"><div class="quote"><br />I feel, by using labels we can separate blocks of code, helps in indentation and at the same time serves the dual purpose of what that block does. <br /></div><br /><br /><pre><code><br /><br />;=====&lt;&lt; sDrawBSpline &gt;&gt;===\<br />.data<br />	BSplineShader 	dd 0<br />	BSplineShadeWid dd 1<br />.code<br />	<br />sDrawBSpline proc PUBLIC UseAll pSpline:ptr SDSPLINE,numPoints,dwColor<br />	local xa,xb,xc<br />	local ya,yb,yc<br />	local deltaT:real8,curT:real8<br />	local curX,curY,nX,nY<br />	<br />	mov ecx,pSpline<br />	test ecx,ecx<br />	jz _ret<br />	assume ecx:ptr SDSPLINE<br />	<br />	; C = 3.0 * (cp[1] - cp[0]);<br />	mov eax,.p1.x<br />	mov edx,.p1.y<br />	sub eax,.p0.x<br />	sub edx,.p0.y<br />	lea eax,<br />	lea edx,<br />	mov xc,eax<br />	mov yc,edx<br />	<br />	; B = 3.0 * (cp[2] - cp[1]) - C;<br />	mov eax,.p2.x<br />	mov edx,.p2.y<br />	sub eax,.p1.x<br />	sub edx,.p1.y<br />	lea eax,<br />	lea edx,<br />	sub eax,xc<br />	sub edx,yc<br />	mov xb,eax<br />	mov yb,edx<br />	<br />	; A = cp[3].x - cp[0].x - cx - bx;<br />	mov eax,.p3.x<br />	mov edx,.p3.y<br />	sub eax,.p0.x<br />	sub edx,.p0.y<br />	sub eax,xc<br />	sub edx,yc<br />	sub eax,xb<br />	sub edx,yb<br />	mov xa,eax<br />	mov ya,edx<br />	<br />	;--------[ compute numPoints if necessary ]----------\<br />	.if numPoints==0<br />		;----[ compute average point of p1 &amp; p2 ]--\<br />		mov eax,.p2.x<br />		mov edx,.p2.y<br />		add eax,.p1.x<br />		add edx,.p1.y<br />		sar eax,1<br />		sar edx,1<br />		mov nX,eax ; store it temporarily in nX:nY<br />		mov nY,eax<br />		;------------------------------------------/<br />		<br />		;----[ compute sqr of len p0:pN ]--\<br />		fild .p0.x<br />		fisub nX<br />		fmul ST,ST<br />		fild .p0.y<br />		fisub nY<br />		fmul ST,ST<br />		fadd<br />		;----------------------------------/<br />		;----[ compute sqr of len p3:pN ]--\<br />		fild .p3.x<br />		fisub nX<br />		fmul ST,ST<br />		fild .p3.y<br />		fisub nY<br />		fmul ST,ST<br />		fadd<br />		;----------------------------------/<br />		fadd<br />		fsqrt<br />		fistp numPoints<br />		shr numPoints,3<br />		add numPoints,4		<br />	.endif<br />	;----------------------------------------------------/<br />	<br />	<br />	<br />	<br />	fld1<br />	fidiv numPoints<br />	fst deltaT<br />	fstp curT<br />	m2m curX,.p0.x<br />	m2m curY,.p0.y<br />	<br />	@@:<br />		; nX = 	(ax * tCubed) + (bx * tSquared) + (cx * t) + cp[0].x;<br />		fild .p0.x<br />		fild xc<br />		fmul curT<br />		fadd<br />		fild xb<br />		fmul curT<br />		fmul curT<br />		fadd<br />		fild xa<br />		fmul curT<br />		fmul curT<br />		fmul curT<br />		fadd<br />		fistp nX<br />		<br />		; nY = 	(ay * tCubed) + (by * tSquared) + (cy * t) + cp[0].y;<br />		fild .p0.y<br />		fild yc<br />		fmul curT<br />		fadd<br />		fild yb<br />		fmul curT<br />		fmul curT<br />		fadd<br />		fild ya<br />		fmul curT<br />		fmul curT<br />		fmul curT<br />		fadd<br />		fistp nY<br />		<br />		.if !BSplineShader<br />			invoke sDrawLine,curX,curY,nX,nY,dwColor<br />		.else<br />			invoke sDrawLineCustom,curX,curY,nX,nY,BSplineShader,BSplineShadeWid,dwColor<br />		.endif<br />		<br />		<br />		<br />		m2m curX,nX<br />		m2m curY,nY<br />		fld curT<br />		fadd deltaT<br />		fstp curT<br />	dec numPoints<br />	jnz @B<br />	<br />	<br />	<br />	assume ecx:nothing<br />_ret:	ret<br />sDrawBSpline endp<br /><br />sDrawBSplineShade proc PUBLIC pSpline:ptr SDSPLINE,numPoints,dwColor,pShadeFunc,ShadeWid<br />	m2m BSplineShader,pShadeFunc<br />	m2m BSplineShadeWid,ShadeWid<br />	<br />	invoke sDrawBSpline,pSpline,numPoints,dwColor<br />	<br />	mov BSplineShader,0<br />	mov BSplineShadeWid,1<br />	ret<br />sDrawBSplineShade endp<br />;=======/<br /></code></pre><br /><br />(view in Notepad++ or another editor that does color-hilite ) http://dl.dropbox.com/u/1969613/openglForum/layout.png</div>
    <div class="meta">Posted on 2009-12-17 23:11:34 by Ultrano</div>
   </div>
   <div class="post" id="post-209943">
    <div class="subject"><a href="#post-209943">Re: ExitProcess call is required???</a></div>
    <div class="body">Fine....may be the convention is not use labels unless it is a branch target. But, is there a reason to not use labels other than cosmetic reasons???<br /></div>
    <div class="meta">Posted on 2009-12-18 01:04:21 by uglyhunK</div>
   </div>
   <div class="post" id="post-209950">
    <div class="subject"><a href="#post-209950">Re: ExitProcess call is required???</a></div>
    <div class="body"><div class="quote"><br />Fine....may be the convention is not use labels unless it is a branch target. But, is there a reason to not use labels other than cosmetic reasons???</div>IMHO not making the program logic less clear is a bit more than just cosmetic - but other than that, not really. Your assembler will run a slight bit slower and use a bit more memory, but it&#039;s not going to be noticeable for simple use like this.</div>
    <div class="meta">Posted on 2009-12-18 07:21:59 by f0dder</div>
   </div>
   <div class="post" id="post-209959">
    <div class="subject"><a href="#post-209959">Re: ExitProcess call is required???</a></div>
    <div class="body">The reason is that all those labels end up as Symbols inside the .OBJ file, which wouldn&#039;t be a problem, if the OBJ file format didn&#039;t have a limit on the number of symbols, and as long as you don&#039;t care how long it takes to build your application (commercial apps tend to get pretty big and need to be rebuilt millions of times, and its actually not hard to reach the symbol limit of your typical assembler, which was never designed for large workloads).<br />There are ways around this problem, but this is not the right thread to be discussing those in.<br />Anyway, he&#039;s right, don&#039;t do it, it&#039;s a bad habit - and generally, it won&#039;t help you debug, because the debugger doesn&#039;t know or see those symbols in the binary executable, why generate them?<br />I&#039;m pretty sure this is exactly why the COMMENT directives exist, to differentiate between HUMAN and MACHINE language within a given sourcecode.<br />On the other hand, it CAN be beneficial to purposefully inject text strings into your binary executable for debugging purposes - ObjAsm32 does this for DEBUG builds, and can help you identify what line, in what file, caused you problems.<br /></div>
    <div class="meta">Posted on 2009-12-18 09:12:25 by Homer</div>
   </div>
   <div class="post" id="post-209960">
    <div class="subject"><a href="#post-209960">Re: ExitProcess call is required???</a></div>
    <div class="body">Afaik the labels aren&#039;t going to end up in the .obj file unless you declare them as PUBLIC?</div>
    <div class="meta">Posted on 2009-12-18 09:28:03 by f0dder</div>
   </div>
   <div class="post" id="post-209964">
    <div class="subject"><a href="#post-209964">Re: ExitProcess call is required???</a></div>
    <div class="body">Thanks for the info. All I have been doing till now is using labels as way to increase readability of the source, not for debugging. But, the overwhelming response about the art of writing assembly is totally against liberal use of labels. Now, I&#039;m convinced that I can&#039;t post any assembly snippets, in this forum, with labels posted all over the place and I can&#039;t stop myself coming here....so I&#039;m changing my habit... :lol:<br /><br /></div>
    <div class="meta">Posted on 2009-12-18 11:55:40 by uglyhunK</div>
   </div>
   <div class="post" id="post-209966">
    <div class="subject"><a href="#post-209966">Re: ExitProcess call is required???</a></div>
    <div class="body">Everyone has bad or odd habits in coding. Those habits are a hindrance only in 2 related things: teamwork/sharing and speed/reliability of coding. Your code already contains enough comments (despite the unusual format), so it&#039;s already good enough for reminding or sharing; &nbsp;also the chunks of code are logically separated, the label-name is not acronyms/too-brief and it&#039;s not taking long to type. Your style isn&#039;t very bad, it&#039;s just slightly odd. <br />The style I recommended allows me to navigate through heaps of code, as it&#039;s describing the code structure. Your style, with the appropriate/special indentation that you mentioned can already do the same. So, you only have to make labels local inside a proc, and look-out for same-named labels in that proc :) . [ p. s. ] Aside from showing whether a label is actually used. <br />Every company makes-up their own coding conventions afaik; and so far I&#039;ve seen complete sync of styles of several coders on a given project in only two ways: 1) MSDN-sized comments on every proc; &nbsp;2) horrible code with barely any hints. <br />So, don&#039;t sweat it ;) . Post and code in whatever way you like and find reliable across years of development. </div>
    <div class="meta">Posted on 2009-12-18 13:16:46 by Ultrano</div>
   </div>
   <div class="post" id="post-209974">
    <div class="subject"><a href="#post-209974">Re: ExitProcess call is required???</a></div>
    <div class="body"><div class="quote"><br />Thanks for the info. All I have been doing till now is using labels as way to increase readability of the source, not for debugging. But, the overwhelming response about the art of writing assembly is totally against liberal use of labels. Now, I&#039;m convinced that I can&#039;t post any assembly snippets, in this forum, with labels posted all over the place and I can&#039;t stop myself coming here....so I&#039;m changing my habit... :lol:</div>*grin*<br /><br />Well, pad yourself on the back for commenting your code, even if you&#039;re doing it in a kinda unusual way right now - it&#039;s definitely better than a lot of the junk that&#039;s floating around. Just keep in mind that people will generally think &quot;OK, there&#039;s a label, why&#039;s it there and where is it referenced?&quot; :)</div>
    <div class="meta">Posted on 2009-12-18 18:16:59 by f0dder</div>
   </div>
   <div class="post" id="post-209976">
    <div class="subject"><a href="#post-209976">Re: ExitProcess call is required???</a></div>
    <div class="body"><div class="quote"><br />&nbsp; &nbsp; * By default statement labels appearing in a procedure are local to that procedure.<br />&nbsp; &nbsp; * By default all procedure names are public.<br />&nbsp; &nbsp; * By default most other symbols are global.<br /><br />Note that these rules apply to MASM 6.x only. Other assemblers and earlier versions of MASM follow different rules.<br /></div><br /><br />Since the labels are not inside a procedure, they are public in scope, by default ;)</div>
    <div class="meta">Posted on 2009-12-18 19:23:50 by Homer</div>
   </div>
   <div class="post" id="post-209980">
    <div class="subject"><a href="#post-209980">Re: ExitProcess call is required???</a></div>
    <div class="body"><div class="quote"><br />Since the labels are not inside a procedure, they are public in scope, by default ;)<br /></div><br /><br />I&#039;m not sure if this &#039;public&#039; means the same as the PUBLIC keyword... because PUBLIC makes the symbols global (ie exported symbols in the .obj file). Without the PUBLIC keyword, I don&#039;t think symbols can be seen at link-time (unlike C/C++ for example, where they are global by default, and you use the static keyword to avoid that).</div>
    <div class="meta">Posted on 2009-12-20 06:26:46 by Scali</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=29726&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=29726&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="29726" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=29726&amp;page=2">&gt;</a><a href="../?id=29726&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>