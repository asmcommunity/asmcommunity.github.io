<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>drawing line segments with polyline - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3118" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=3118">drawing line segments with polyline</a></p>
   <div class="post" id="post-20485">
    <div class="subject"><a href="#post-20485">drawing line segments with polyline</a></div>
    <div class="body">this isnt really much of a gem but here's how to draw line segments to a window.<br /><br /><pre><code>.586<br />.model flat, stdcall<br /> option casemap &#58;none<br />      <br />      include       \masm32\include\windows.inc<br />      include       \masm32\include\kernel32.inc<br />      include       \masm32\include\user32.inc<br />      include       \masm32\include\comctl32.inc<br />       include    \masm32\include\gdi32.inc<br /><br />      includelib    \masm32\lib\kernel32.lib<br />      includelib    \masm32\lib\user32.lib<br />      includelib    \masm32\lib\comctl32.lib<br />      includelib \masm32\lib\gdi32.lib <br /><br />      <br />      WinMain       PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />      WndProc       PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />      TopXY         PROTO &#58;DWORD,&#58;DWORD<br />      <br /><br />      <br />.data<br />      ClassName     db &quot;Starting Template&quot;,0<br />      CaptionText   db &quot;Drawing&quot;,0<br />      <br />      charS        dd   15,30,5,30,5,40,15,40,15,50,5,50<br />      charM        dd   20,50,20,30,25,40,30,30,30,50                       <br />      charU        dd   35,30,35,50,45,50,45,30      <br />      charR        dd   50,50,50,30,60,30,60,40,50,40,60,50                        <br />      charF        dd   75,30,65,30,65,40,75,40,65,40,65,50<br />                                               <br />.data?<br />      hWnd          HANDLE   ?<br />      hInstance     HANDLE   ?<br /><br />      <br />      hDC HDC ?<br />      rect RECT &lt;&gt;<br /><br />      ps PAINTSTRUCT &lt;&gt;<br />     <br />.code<br /> start&#58;<br />      invoke GetModuleHandle, NULL<br />      mov hInstance, eax<br />      invoke WinMain,hInstance,NULL,NULL,SW_SHOWDEFAULT<br />      invoke ExitProcess,eax<br />      invoke InitCommonControls<br /><br />; ########################################################################<br /><br />WinMain proc hInst     &#58;DWORD,<br />             hPrevInst &#58;DWORD,<br />             CmdLine   &#58;DWORD,<br />             CmdShow   &#58;DWORD<br /><br />      ;====================<br />      ; Put LOCALs on stack<br />      ;====================<br /><br />      LOCAL  wc   &#58;WNDCLASSEX<br />      LOCAL  msg  &#58;MSG<br />      LOCAL  Wwd  &#58;DWORD<br />      LOCAL  Wht  &#58;DWORD<br />      LOCAL  Wtx  &#58;DWORD<br />      LOCAL  Wty  &#58;DWORD<br /><br />      ;==================================================<br />      ; Fill WNDCLASSEX structure with required variables<br />      ;==================================================<br /><br />         mov    wc.cbSize,       SIZEOF WNDCLASSEX<br />	 mov    wc.style,        CS_HREDRAW + CS_VREDRAW<br />	 mov    wc.lpfnWndProc,  OFFSET WndProc<br />	 mov    wc.cbClsExtra,   NULL<br />	 mov    wc.cbWndExtra,   NULL<br />	 mov    eax,             hInstance<br />	 mov    wc.hInstance,    eax<br />         invoke LoadIcon,        NULL,IDI_APPLICATION<br />	 mov    wc.hIcon,        eax<br />	 mov    wc.hIconSm,      eax<br />	 invoke LoadCursor,      NULL,IDC_ARROW<br />	 mov    wc.hCursor,      eax<br />	 mov    wc.hbrBackground,HOLLOW_BRUSH<br />	 mov    wc.lpszMenuName, NULL<br />	 mov    wc.lpszClassName,OFFSET ClassName<br /><br /><br />	 invoke RegisterClassEx, addr wc<br /><br />      ;================================<br />      ; Centre window at following size<br />      ;================================<br /><br />      mov    Wwd, 300<br />      mov    Wht, 250<br /><br />      invoke GetSystemMetrics,SM_CXSCREEN<br />      invoke TopXY,Wwd,eax<br />      mov    Wtx, eax<br /><br />      invoke GetSystemMetrics,SM_CYSCREEN<br />      invoke TopXY,Wht,eax<br />      mov    Wty, eax<br /><br />      invoke CreateWindowEx,NULL,<br />     			    ADDR ClassName,<br />     			    ADDR CaptionText,<br />     			    WS_OVERLAPPEDWINDOW,<br />     			    Wtx,Wty,Wwd,Wht,<br />     			    NULL,<br />     			    NULL,<br />     			    hInst,<br />     			    NULL<br />      mov    hWnd,eax<br /><br />      invoke ShowWindow,hWnd,SW_SHOWNORMAL<br />      invoke UpdateWindow,hWnd<br /><br />      ;===================================<br />      ; Loop until PostQuitMessage is sent<br />      ;===================================<br /><br />    StartLoop&#58;<br />      invoke GetMessage,ADDR msg,NULL,0,0<br />      cmp eax, 0<br />      je ExitLoop<br />      invoke TranslateMessage, ADDR msg<br />      invoke DispatchMessage,  ADDR msg<br />      jmp StartLoop<br />    ExitLoop&#58;<br /><br />	mov     eax,msg.wParam<br />	ret<br /><br />WinMain endp<br /><br />; ########################################################################<br /><br />WndProc proc hWin    &#58;HWND,<br />			     uMsg    &#58;UINT,<br />             wParam  &#58;WPARAM,<br />             lParam  &#58;LPARAM<br /><br />.IF uMsg==WM_DESTROY<br />   invoke PostQuitMessage,NULL<br /><br />      <br />.ELSEIF uMsg == WM_PAINT <br />   invoke BeginPaint,hWin,addr ps<br />   mov hDC,eax<br />   invoke GetClientRect,hWin,addr rect<br />   invoke SetMapMode,hDC,MM_ANISOTROPIC<br />   invoke SetWindowExtEx,hDC,80,85,0<br />   invoke SetViewportExtEx,hDC,rect.right,rect.bottom,0<br />   invoke Polyline,hDC,addr charS,6<br />   invoke Polyline,hDC,addr charM,5<br />   invoke Polyline,hDC,addr charU,4<br />   invoke Polyline,hDC,addr charR,6<br />   invoke Polyline,hDC,addr charF,6    <br />   invoke EndPaint,hWin,addr ps<br /><br />.ELSE<br />   invoke DefWindowProc,hWin,uMsg,wParam,lParam<br />   ret<br /><br />.ENDIF<br />   xor eax,eax<br />   ret<br /><br />WndProc endp<br /><br /><br />; ########################################################################<br /><br />TopXY proc wDim&#58;DWORD, sDim&#58;DWORD<br /><br />    shr sDim, 1<br />    shr wDim, 1<br />    mov eax, wDim<br />    sub sDim, eax<br />    mov eax,sDim<br />    ret<br /><br />TopXY endp<br /><br />; #########################################################################<br /><br />end start<br /></code></pre></div>
    <div class="meta">Posted on 2002-01-22 16:46:35 by smurf</div>
   </div>
  </div>
 </body>
</html>