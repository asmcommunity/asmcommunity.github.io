<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Tray Organizer Project Problems :( - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=22547" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=22547">Tray Organizer Project Problems :(</a></p>
   <div class="post" id="post-169147">
    <div class="subject"><a href="#post-169147">Tray Organizer Project Problems :(</a></div>
    <div class="body">I have a ton of desktop shortcuts and a ton of folders of such.. So, The project I&#39;m working on is a startup program trayicon.. Which will have menus for organization of computer programs and folders. I will also include fast searching capabilities. <br /><br />I was using a window before this and it was working perfectly... <br /><br />However, Making each and every window is too troublesome for me so... Im trying to use a dialogbox for this. However, now it seems to be in a loop which I can&#39;t figure it how to fix. <br /><br /><pre><code><br />;======================================================================= <br /> format PE GUI 4.0 <br />;format PE CONSOLE <br />;======================================================================= <br />include &#39;%fasminc%\win32ax.inc&#39; <br />include &#39;databaseengine.inc&#39;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />;======================================================================= <br />entry start <br />WUM_SHELLNOTIFY equ WM_USER + 5 <br />MI_RESTORE&nbsp; &nbsp; &nbsp; equ 3000 <br />MI_CREATE&nbsp; &nbsp; &nbsp; equ 3001 <br />MI_EXIT&nbsp; &nbsp; &nbsp; &nbsp;  equ 3002 <br />MI_EXECUTE&nbsp; &nbsp;  equ 3003 <br />SBI_TRAY&nbsp; &nbsp; &nbsp; &nbsp; equ 3004 <br />textb equ 102h <br />buttonb equ 101h <br />MAINDLG&nbsp; &nbsp; &nbsp; &nbsp; equ 100 <br />IDI_ICON&nbsp; &nbsp; &nbsp;  equ 9000 <br /><br />;MACORS_________________________________________________________ <br /><br />macro @GetModuleHandle <br /><br />{ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword &nbsp;  ; API : GetModuleHandleA <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword &nbsp; ;--------------- <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword &nbsp; ;-------------------- <br /><br />} <br /><br /><br />macro @GetLastError <br /><br />{ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword  ; API : GetLastError---------- <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax,dword &nbsp; ;-------------------------- <br /><br />} <br /><br />macro @GetTickCount <br /><br />{ <br /><br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp;  MOV EDX,7FFE0000h <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EAX,DWORD&nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MUL DWORD  <br />&nbsp; &nbsp; &nbsp;  SHRD EAX,EDX,18 <br /><br /><br /><br />} <br /><br />macro @GetAppName <br /><br />{ <br />MOV&nbsp; &nbsp;  EAX,  <br />MOV&nbsp; &nbsp;  EAX,  <br />MOV&nbsp; &nbsp;  EAX,  <br />} <br /><br />macro @GetCurrentThread <br /><br />{ <br />&nbsp; MOV EAX,dword&nbsp;  <br />&nbsp; MOV EAX,dword  <br /><br />} <br /><br />macro @sysenter syscall,  <br />{ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  local&nbsp; blah1,blah2 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  push&nbsp;  eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jmp&nbsp; &nbsp; blah2&nbsp; <br />blah1:&nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; eax, syscall&nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp; edx, esp <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dw&nbsp; &nbsp;  340Fh&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;sysenter 0F34h&nbsp; <br />blah2: <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  call&nbsp;  blah1 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  add&nbsp; &nbsp; esp, (parameters*4) + 4 ; + 1 dummy EIP <br />}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br /><br /><br /><br />macro Sysinvoke proc,&nbsp;  <br /><br />{ common&nbsp;  <br />local blah1,blah2,param_count&nbsp;  <br /><br />&nbsp; <br />param_count=0&nbsp;  <br />reverse&nbsp; &nbsp; <br />pushd parameters&nbsp; &nbsp; <br />param_count=param_count+1&nbsp;  <br />common&nbsp;  <br />push eax&nbsp;  <br />jmp blah2&nbsp; &nbsp; <br />blah1:&nbsp; &nbsp; <br />mov eax, proc&nbsp; &nbsp; <br />mov edx, esp&nbsp; &nbsp; <br />dw 340Fh ;sysenter 0F34h&nbsp; &nbsp; <br />blah2:&nbsp; &nbsp; <br />call blah1&nbsp; &nbsp; <br />add esp, (param_count * 4) + 4 ; + 1 dummy EIP&nbsp; &nbsp; <br />} <br /><br />&nbsp; &nbsp; &nbsp; <br /><br /><br />;DATA______________________________________________________________________________________ <br /><br />section &#39;.data&#39; data readable writeable <br />&nbsp; &nbsp; &nbsp; &nbsp; gIst dd ? <br />&nbsp; &nbsp; &nbsp; &nbsp; wndH&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd ? <br />&nbsp; &nbsp; &nbsp; &nbsp; insH&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd ? <br />&nbsp; &nbsp; &nbsp; &nbsp; wndClsName&nbsp; &nbsp; &nbsp; db &#39;TUT_23&#39;,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; wndTitle&nbsp; &nbsp; &nbsp; &nbsp; db &#39;Tutorial 23&#39;,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; texthd&nbsp;  dd ? <br />&nbsp; &nbsp; &nbsp; &nbsp; buttond&nbsp; dd ? <br />&nbsp; &nbsp; &nbsp; &nbsp; wndCls&nbsp; WNDCLASS <br />&nbsp; &nbsp; &nbsp; &nbsp; wndMsg&nbsp; MSG <br />&nbsp; &nbsp; &nbsp; &nbsp; texth&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  db &#39;EDIT&#39;,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; buttonh&nbsp; &nbsp; &nbsp; &nbsp;  db &#39;BUTTON&#39;,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; menuH&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ? <br />&nbsp; &nbsp; &nbsp; &nbsp; menuPt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; POINT <br />&nbsp; &nbsp; &nbsp; &nbsp; menuRect&nbsp; &nbsp; &nbsp; &nbsp; RECT <br />&nbsp; &nbsp; &nbsp; &nbsp; miCreate&nbsp; &nbsp; &nbsp; &nbsp; db &#39;&amp;Create&#39;,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; miExecute&nbsp; &nbsp; &nbsp;  db &#39;&amp;Execute&#39;,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; miRESTORE&nbsp; &nbsp; &nbsp;  db &#39;&amp;Restore&#39;,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; miEXIT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; db &#39;&amp;Exit&#39;,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; executed&nbsp; &nbsp; &nbsp; &nbsp; db &#39;C:\Documents and Settings\Owner\Desktop\flatpe.exe&#39;,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; statBarData&nbsp; &nbsp;  NOTIFYICONDATA <br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; sinfo STARTUPINFO&nbsp;  <br />&nbsp; &nbsp; &nbsp;  <br /> datahandle dd 0 <br />buffer rb 20h <br />bufin dd 40 dup (?) <br />bufin2 dd 40 dup (?) <br />databytes rb 20h <br />byteread dd ?&nbsp; &nbsp; &nbsp; <br />database db &quot;hello&quot;,0 <br /><br />pinfo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  PROCESS_INFORMATION&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /><br />shi db &quot;%d&quot;,0 <br />shi1 db &quot;%s&quot;,0 <br /><br /><br />section &#39;.data1&#39; data readable writeable <br /><br />datastart equ $ <br /><br />phandle dd 0 <br />mhandle dd 0 <br />fhandle dd 0 <br />range&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd&nbsp; &nbsp;  ? <br /><br /><br /><br />;CODE_________________________________________________________________________________________________________ <br />section &#39;.code&#39; code readable executable <br /><br /><br /><br /> proc&nbsp; start1&nbsp; <br /><br />&nbsp; &nbsp; @GetModuleHandle <br />&nbsp; &nbsp; mov ,eax <br />&nbsp; &nbsp; invoke InitCommonControls <br />&nbsp;  invoke DialogBoxParam,eax,MAINDLG,0,DlgProc,0 <br />&nbsp;  invoke ExitProcess,0 <br /><br />endp <br />&nbsp;  <br />&nbsp;  ;+----------------------+ <br />&nbsp;  ;| the dialog procedure | <br />&nbsp;  ;+----------------------+ <br />&nbsp;  proc DlgProc,hWnd,uMsg,wParam,lParam <br />&nbsp;  push ebx esi edi <br /><br />&nbsp; &nbsp; .if ,e,WM_INITDIALOG <br />&nbsp; &nbsp; invoke&nbsp; SendMessage,,WM_COMMAND,MI_RESTORE,0 <br />&nbsp; &nbsp; invoke LoadIcon,,IDI_ICON <br />&nbsp; &nbsp; invoke SendMessage,,WM_SETICON,TRUE,eax <br />&nbsp; jmp wmBYE <br /><br />&nbsp; &nbsp; <br />&nbsp;  .elseif ,e,WUM_SHELLNOTIFY <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; ,SBI_TRAY <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; wmBYE <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; ,WM_RBUTTONDOWN <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; je&nbsp;  wumSHELLNOTIFY_WM_RBUTTONDOWN <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; ,WM_LBUTTONDBLCLK <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; je&nbsp;  wumSHELLNOTIFY_WM_LBUTTONDBLCLK <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; wmBYE <br />&nbsp; &nbsp;  <br />&nbsp; .elseif ,e,WM_COMMAND <br />&nbsp; &nbsp; &nbsp; cmp&nbsp; ,0 <br />&nbsp; &nbsp; &nbsp; jne&nbsp; wmBYE <br />&nbsp; &nbsp; &nbsp; mov&nbsp; eax, <br />&nbsp; &nbsp; &nbsp; cmp&nbsp; ax,MI_RESTORE <br />&nbsp; &nbsp; &nbsp; je&nbsp;  wmCOMMAND_MI_RESTORE <br />&nbsp; &nbsp; &nbsp; cmp ax,MI_EXECUTE <br />&nbsp; &nbsp; &nbsp; je&nbsp; wmCOMMAND_MI_EXECUTE <br />&nbsp; &nbsp; &nbsp; cmp ax,MI_CREATE <br />&nbsp; &nbsp; &nbsp; je&nbsp; wmCOMMAND_MI_CREATE <br />&nbsp; &nbsp; &nbsp; cmp ax,MI_EXIT <br />&nbsp; &nbsp; &nbsp; je wmCOMMAND_MI_EXIT <br />&nbsp; &nbsp; &nbsp; Sysinvoke&nbsp; DEstroyWindow, <br />&nbsp; &nbsp; &nbsp; jmp&nbsp; wmBYE <br />&nbsp; &nbsp; &nbsp; <br />.elseif ,e,WM_SIZE <br /> cmp&nbsp; ,SIZE_MINIMIZED <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; wmBYE <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; ,sizeof.NOTIFYICONDATA <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; ,SBI_TRAY <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; ,NIF_ICON + NIF_MESSAGE + NIF_TIP <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; ,WUM_SHELLNOTIFY <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; LoadIcon,,IDI_ICON <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; ,eax <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; lstrcpy,statBarData.szTip,wndTitle <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Sysinvoke&nbsp; SHowWindow,,SW_HIDE <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; Shell_NotifyIcon,NIM_ADD,statBarData <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; wmBYE <br />&nbsp; &nbsp; &nbsp; &nbsp;  <br />.elseif ,e,WM_CREATE <br />&nbsp; invoke&nbsp; CreatePopupMenu <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; ,eax <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke AppendMenu,,MF_STRING,MI_EXECUTE,miExecute <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; AppendMenu,,MF_STRING,MI_RESTORE,miRESTORE <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; AppendMenu,,MF_STRING,MI_CREATE,miCreate <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; AppendMenu,,MF_STRING,MI_EXIT,miEXIT <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; wmBYE <br /><br /><br />&nbsp; .elseif ,e,WM_CLOSE <br />&nbsp;  ;invoke OutputDebugString,crap <br />&nbsp; &nbsp;  invoke EndDialog,,0 <br />&nbsp;  <br />&nbsp; &nbsp; .endif <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wumSHELLNOTIFY_WM_LBUTTONDBLCLK: <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke&nbsp; SendMessage,,WM_COMMAND,MI_RESTORE,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; wmBYE <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wumSHELLNOTIFY_WM_RBUTTONDOWN: <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Sysinvoke&nbsp; GETCursorPos,menuPt,026h <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Sysinvoke SEtForegroundWindow, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; TrackPopupMenu,,TPM_RIGHTALIGN + TPM_RIGHTBUTTON,\ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ,,NULL,,NULL <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; PostMessage,,WM_NULL,0,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; wmBYE <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; wmCOMMAND_MI_EXECUTE: <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke CreateProcessInternal,0,0,executed,0,0,FALSE,NORMAL_PRIORITY_CLASS,0,0,sinfo,pinfo,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp wmBYE <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp;  wmCOMMAND_MI_CREATE : <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ebx,255 <br />&nbsp; &nbsp; &nbsp; &nbsp; stdcall CreateDatabase,wndTitle,ebx <br />&nbsp; &nbsp; &nbsp; &nbsp; jmp wmBYE <br />&nbsp; &nbsp; &nbsp; &nbsp; wmCOMMAND_MI_RESTORE: <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; Shell_NotifyIcon,NIM_DELETE,statBarData <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Sysinvoke&nbsp; SHowWindow,,SW_RESTORE <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; wmBYE <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp;  wmCOMMAND_MI_EXIT: <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; Shell_NotifyIcon,NIM_DELETE,statBarData <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke ExitProcess,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; wmDESTROY: <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Sysinvoke&nbsp; DEstroyMenu, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke&nbsp; Shell_NotifyIcon,NIM_DELETE,statBarData <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Sysinvoke&nbsp; POstQuitMessage,0,33h <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; wmBYE: <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop edi esi ebx <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret <br />&nbsp;  endp <br /><br />start: <br />call start1 <br /><br />;IMPORTS__________________________________________________________________________________________________ <br />section &#39;.idata&#39; import data readable writeable <br /><br />&nbsp; library kernel32,&#39;KERNEL32.DLL&#39;,\ <br />&nbsp; &nbsp;  user32,&nbsp; &#39;USER32.DLL&#39;,\ <br />&nbsp; &nbsp;  comdlg32,&#39;COMDLG32.DLL&#39;,\ <br />&nbsp; &nbsp;  ole32,&nbsp;  &#39;OLE32.DLL&#39;,\ <br />&nbsp; &nbsp;  ntdll,&nbsp;  &#39;NTDLL.DLL&#39;,\ <br />&nbsp; &nbsp;  shell32, &#39;SHELL32.DLL&#39;,\ <br />&nbsp; &nbsp;  advapi32, &#39;ADVAPI32.DLL&#39;,\ <br />&nbsp; &nbsp;  comctl32, &#39;comctl32.dll&#39; <br /><br /><br /><br /><br />;----------------------------------------------------------------------- <br />include &#39;C:\WinAsm\Assemblers\fasm\INCLUDE\APIA\kernel32.inc&#39; <br />include &#39;C:\WinAsm\Assemblers\fasm\INCLUDE\APIA\ntdll.inc&#39; <br />include &#39;C:\WinAsm\Assemblers\fasm\INCLUDE\APIA\user32.inc&#39; <br />include &#39;C:\WinAsm\Assemblers\fasm\INCLUDE\APIA\comdlg32.inc&#39; <br />include &#39;C:\WinAsm\Assemblers\fasm\INCLUDE\APIA\ole32.inc&#39; <br />include &#39;C:\WinAsm\Assemblers\fasm\INCLUDE\APIA\shell32.inc&#39; <br />include &#39;C:\WinAsm\Assemblers\fasm\INCLUDE\APIA\advapi32.inc&#39; <br />include &#39;C:\WinAsm\Assemblers\fasm\INCLUDE\APIA\comctl32.inc&#39; <br /><br />;======================================================================= <br />section &#39;.rsrc&#39; resource from &#39;res1.res&#39; data readable<br /> <br /><br /> <br /> <br /><br /></code></pre><br /></div>
    <div class="meta">Posted on 2005-12-25 02:24:28 by shism2</div>
   </div>
  </div>
 </body>
</html>