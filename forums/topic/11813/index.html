<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>.IF syntax for FPU? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=11813" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=11813">.IF syntax for FPU?</a></p>
   <div class="post" id="post-90231">
    <div class="subject"><a href="#post-90231">.IF syntax for FPU?</a></div>
    <div class="body">Would it be possible to create macros that could be used with real numbers the same way .IF etc are used with integers? Maybe someone has made such macros already?<br /><br />With simple conditions, and using FCOMI instruction (which sets ZF, PF, and CF in the EFLAGS directly) things are fairly simple. But when conditions get complex, it would be really nice to have &quot;.IF&quot;-syntax for FPU, too. <br /><br />Actually, I guess that even better would be if .IF etc. themselves could be enhanced so, that both real and integer variables could be used in the same conditional statement.</div>
    <div class="meta">Posted on 2003-03-25 15:42:30 by Janne</div>
   </div>
   <div class="post" id="post-90344">
    <div class="subject"><a href="#post-90344">.IF syntax for FPU?</a></div>
    <div class="body">The main potential problem with such a programming approach is the restricted use of the FPU registers. You must insure that an FPU register must be &quot;empty&quot; before using it, and only 8 registers are available.<br /><br />Proper FPU programming must therefore keep close track of the number of registers in use at all times. Branching  after testing the content of a register must often take into account if the register(s) involved in the test must be cleared or retained for further processing.<br /><br />Ordinary IF statements are not designed to handle this. In theory, you could probably create a complex FPUIF macro to handle those tests (or comparisons, or whatever) but you would have to give directions on how to handle the registers.<br /><br />IMHO your code would be a lot clearer if you handle each case separately, using FPU instructions for the tests followed with the IF statement on the result of the test, and cleaning up the FPU stack as necessary.<br /><br />If you need guidance on performing the tests with FPU instructions, you can look at the source code of the functions provided in the FPU.lib library available in the MASM32v8 package. If you want to invoke the functions without programming the FPU yourself, the associated Help file should be studied.<br /><br />(If you would like the FPU.lib package without the entire MASM32v8 package, you can get the latest version from the <strong>FPU.lib Update</strong> thread of the MASM32 forum.)<br /><br />Raymond</div>
    <div class="meta">Posted on 2003-03-25 19:30:38 by Raymond</div>
   </div>
   <div class="post" id="post-90464">
    <div class="subject"><a href="#post-90464">.IF syntax for FPU?</a></div>
    <div class="body">...or you could go code in a highlevel language ;-)</div>
    <div class="meta">Posted on 2003-03-26 02:27:01 by f0dder</div>
   </div>
  </div>
 </body>
</html>