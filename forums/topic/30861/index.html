<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Assembling on DosBox - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30861" />
    <link rel="next" href="../?id=30861&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=115">DOS &amp; BIOS</a> &raquo; <a href="../?id=30861">Assembling on DosBox</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=30861&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=30861&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="30861" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=30861&amp;page=2">&gt;</a><a href="../?id=30861&amp;page=3">&raquo;</a></form>   <div class="post" id="post-215839">
    <div class="subject"><a href="#post-215839">Assembling on DosBox</a></div>
    <div class="body">Hello guys,<br /><br />I am new on these forums and wanted to ask something about assembling on DOS.<br />I started lately to learn 16-bit Assembly and thought it would be a good base to start from, and then learn by myself to assemble in 32-bit and even 64-bit. <br />The reason I am starting to assemble is because I am taking soon a course of Reverse Engineering and I already know assembler, just want to make it better.<br /><br />I got an advice to practice using MASM, after reading about it some I figured it wouldn&#039;t work on 32-bit (and I have 64-bit windows 7 so I installed VirtualBox to have an XP with 32-bit). Then, I read that it is recommended to use DosBox to assemble and practice, and using MASM on it.<br /><br />Now, what I want to ask is, how am I exactly installing MASM on DosBox? or how do I even use it on that? I really am confused since the only time I used DOS was maybe when I was really really young and it wasn&#039;t for purpose of programming.<br /><br />Any assistance would be gladly appreciated :)<br /><br />p1Mp.</div>
    <div class="meta">Posted on 2012-03-09 03:43:40 by p1Mp</div>
   </div>
   <div class="post" id="post-215840">
    <div class="subject"><a href="#post-215840">Re: Assembling on DosBox</a></div>
    <div class="body">MASM has been a 32-bit Windows application for a long time now. There is also a 64-bit version of MASM.<br />If you want to use MASM in Dosbox, I think you&#039;ll specifically need to look for a very old version of MASM, because as far as I know, the newer versions will not work.<br />What I normally do is build DOS applications with the 32-bit Windows version, then use an older version of LINK.EXE (which is also 32-bit Windows) which can still output DOS executables.<br />Then I run the built executable in Dosbox.</div>
    <div class="meta">Posted on 2012-03-09 04:14:26 by Scali</div>
   </div>
   <div class="post" id="post-215841">
    <div class="subject"><a href="#post-215841">Re: Assembling on DosBox</a></div>
    <div class="body">The thing is that the book I&#039;m reading from and practicing ASM is working on 16-bit, probably referring to DOS. Do you mind then please explaining to me how to work on Dos so I can assemble on 16-bit? Because it might not work (the way I will make the code) if I work on 32-bit or 64-bit platforms.<br /><br />Note: Consider that I am purely new to this and I know nothing about DOS applications or anything like this, that means I&#039;m confused of every 2nd work you say as hell :)</div>
    <div class="meta">Posted on 2012-03-09 04:19:25 by p1Mp</div>
   </div>
   <div class="post" id="post-215842">
    <div class="subject"><a href="#post-215842">Re: Assembling on DosBox</a></div>
    <div class="body">Just because MASM is a 32-bit Windows application doesn&#039;t mean it can&#039;t produce 16-bit DOS (or Win16) code.<br />And just because your program runs in DOS doesn&#039;t mean it has to be built from DOS.<br /><br />So, what you can do is this:<br />Get MASM32 (http://www.movsd.com). Install it in Windows.<br />Now, if I&#039;m not mistaken, MASM32 comes with a LINK16.EXE in the \bin directory (if not, I have a copy of it for you).<br />LINK16.EXE is an old linker, which still supports creating DOS EXEs and COM files.<br /><br />Then you use MASM (ML.EXE) and the linker (LINK16.EXE) from a Windows command prompt to assemble and link your DOS program.<br />You can then set up Dosbox to mount the directory in which you built your DOS program, and run it there.<br /><br />So you basically have two windows side-by-side: One Windows command prompt to build your DOS program, and Dosbox to run your program.</div>
    <div class="meta">Posted on 2012-03-09 04:36:38 by Scali</div>
   </div>
   <div class="post" id="post-215844">
    <div class="subject"><a href="#post-215844">Re: Assembling on DosBox</a></div>
    <div class="body">What do you mean by building my program? don&#039;t I just write it on a .txt file and then make it .asm, and do something with it? Can you please explain to me stage-by-stage thorough?<br />Like, how do I use the linker and what does it do, how do I use the ML.exe and what does it do, how do I for example run a program and then see what the register contains, like, how it all works with commands and such.<br /><br />By the way, do I must work with 32-bit virtual computer to assemble? cant I work with my 64-bit computer?</div>
    <div class="meta">Posted on 2012-03-09 05:56:26 by p1Mp</div>
   </div>
   <div class="post" id="post-215846">
    <div class="subject"><a href="#post-215846">Re: Assembling on DosBox</a></div>
    <div class="body"><div class="quote"><br />What do you mean by building my program? don&#039;t I just write it on a .txt file and then make it .asm, and do something with it? Can you please explain to me stage-by-stage thorough?</div><br /><br />Building a program is the process of converting your source code into a working binary. In this case, assembling and linking it.<br /><br /><div class="quote"><br />Like, how do I use the linker and what does it do, how do I use the ML.exe and what does it do, how do I for example run a program and then see what the register contains, like, how it all works with commands and such.</div><br /><br />I think you&#039;re better off reading some tutorial or such, perhaps Art of Assembly.<br /><br /><div class="quote"><br />By the way, do I must work with 32-bit virtual computer to assemble? cant I work with my 64-bit computer?<br /></div><br /><br />No, 32-bit Windows applications are still supported by 64-bit Windows, so you can use 32-bit MASM and LINK16.EXE without a problem (which is why I suggested that route, I&#039;ve been using that myself on 64-bit Windows).</div>
    <div class="meta">Posted on 2012-03-09 06:13:12 by Scali</div>
   </div>
   <div class="post" id="post-215849">
    <div class="subject"><a href="#post-215849">Re: Assembling on DosBox</a></div>
    <div class="body">Okay thank you.<br />Can you still explain to me stage-by-stage to how for example build a program and check for example the registers to see if it worked well? using the MASM &amp; Command Prompt &amp; DosBox. and you can explain to me the linking really briefly I will understand, no need to tell me to read a tutorial when I don&#039;t even know where to look, especially when finding results of ASM in google is hard, especially about 16-bit or w.e =\</div>
    <div class="meta">Posted on 2012-03-09 06:57:45 by p1Mp</div>
   </div>
   <div class="post" id="post-215850">
    <div class="subject"><a href="#post-215850">Re: Assembling on DosBox</a></div>
    <div class="body"><div class="quote"><br />Okay thank you.<br />Can you still explain to me stage-by-stage to how for example build a program and check for example the registers to see if it worked well? using the MASM &amp; Command Prompt &amp; DosBox. and you can explain to me the linking really briefly I will understand, no need to tell me to read a tutorial when I don&#039;t even know where to look, especially when finding results of ASM in google is hard, especially about 16-bit or w.e =\<br /></div><br /><br />If you want to check the registers, you need a debugger. A DOS debugger.<br />I suppose debug.exe included with DOS itself would be a start (note that DOS is not included with Dosbox, but you can find DOS packages for Dosbox on the web).<br /><br />As for a tutorial, as I said, look into Art of Assembly, the 16-bit DOS edition.<br />http://homepage.mac.com/randyhyde/webster.cs.ucr.edu/www.artofasm.com/DOS/pdf/0_AoAPDF.html<br />It explains how to use MASM and such (see chapter 4).<br />It uses the CodeView debugger for DOS, not sure if that is easily available on the web. You might have more luck with Turbo Debugger perhaps. It comes with Turbo C++, Turbo Assembler or Turbo Pascal, which are still reasonably popular around the web.</div>
    <div class="meta">Posted on 2012-03-09 08:10:41 by Scali</div>
   </div>
   <div class="post" id="post-215851">
    <div class="subject"><a href="#post-215851">Re: Assembling on DosBox</a></div>
    <div class="body">So can I find how to assemble with DOSBox and windows command prompt and MASM on chapter 4? That is all I want... I am getting way confused with your explanations about the DOS debugger and Turbo assembler etc =\, I do want to check the registers but can you show me how to use that dos debugger to check them after running an ASM code?<br />Because the way you explain it you talk as I already know the tools and programs to do it.<br /><br />Thanks for your time bro, and for helping me.<br /><br />EDIT: After looking at Chapter 4, man it is really really long, how can I know where I find what I need? I know already all of the things there, about registers, flags, memory, segments. It is theoretical material, where can I find how to bring that to practice...?<br /><br />EDIT2: Alright so I found chapter 4.9.4 and it explains about ML, from what I understood it is checking errors, correct me if I&#039;m wrong, and if there&#039;s an error it doesn&#039;t make an .exe file.<br /><br />I am trying to assemble this code:<br /><br /><pre><code>CODE SEGMENT<br />ASSUME CS:CODE, DS:CODE<br />START: MOV AX, CODE<br />&nbsp; &nbsp; &nbsp;  MOV DS, AX<br />&nbsp; &nbsp; &nbsp;  MOV AL, 66H<br />&nbsp; &nbsp; &nbsp;  MOV BX, 1000H<br />&nbsp; &nbsp; &nbsp;  MOV , AL<br />CODE ENDS<br />END START</code></pre><br /><br />(Note: I assemble this code on the 64-bit with the windows command prompt using the command&nbsp; &#039;ml /Zi prog.asm&#039;)<br /><br />After trying to assemble that, I get these 2 warnings and 1 error:<br /><br /><pre><code>LINK : warning LNK4044: unrecognized option &quot;z2&quot;; ignored<br />LINK : warning LNK4044: unrecognized option &quot;CO:nopack&quot;; ignored<br />LINK : error : Segment reference in fixup record<br />prog.obj : fatal error LNK1123: failure during conversion to COFF: file invalid<br />or corrupt</code></pre><br /><br />Can you tell me why is this? I believe it is a correctly written code, no?</div>
    <div class="meta">Posted on 2012-03-09 08:19:15 by p1Mp</div>
   </div>
   <div class="post" id="post-215852">
    <div class="subject"><a href="#post-215852">Re: Assembling on DosBox</a></div>
    <div class="body">Geez man, some things just require effort.<br />Also, as I said, you need to use LINK16.EXE.<br />It looks like you&#039;re trying to use the regular LINK.EXE, which doesn&#039;t work for DOS (it tries to convert to COFF, which is the new object format, DOS used OBJ).<br />(LINK16.EXE is just an old LINK.EXE which is renamed to LINK16.EXE for the MASM32 package, to avoid confusion with the regular LINK.EXE that you&#039;d use for Win32 applications. LINK16.EXE can be used for DOS and Win16 applications).</div>
    <div class="meta">Posted on 2012-03-09 08:53:25 by Scali</div>
   </div>
   <div class="post" id="post-215853">
    <div class="subject"><a href="#post-215853">Re: Assembling on DosBox</a></div>
    <div class="body">I didn&#039;t even touch the linker =\, all I did was use the command of the ML..?<br /><br />Look, all I did was going to windows command prompt, going to the /bin directory (using &#039;cd&#039; command), and then when in the directory, making sure prog.asm which is the code I showed before is in the /bin directory, and then typing in the command prompt &#039;ml /Zi prog.asm&#039;.</div>
    <div class="meta">Posted on 2012-03-09 08:57:40 by p1Mp</div>
   </div>
   <div class="post" id="post-215854">
    <div class="subject"><a href="#post-215854">Re: Assembling on DosBox</a></div>
    <div class="body">Ah right... ML automatically starts the linker.<br />Which it shouldn&#039;t.<br />You need to use the /c switch so you can manually start the linker.</div>
    <div class="meta">Posted on 2012-03-09 09:21:19 by Scali</div>
   </div>
   <div class="post" id="post-215855">
    <div class="subject"><a href="#post-215855">Re: Assembling on DosBox</a></div>
    <div class="body"><div class="quote"><br />Ah right... ML automatically starts the linker.<br />Which it shouldn&#039;t.<br />You need to use the /c switch so you can manually start the linker.<br /></div><br /><br />K, I&#039;ll try. Thanks.<br /><br />Ok this is what came out:<br /><br /><pre><code>C:\masm32\bin&gt;ml /c prog.asm<br />Microsoft (R) Macro Assembler Version 6.14.8444<br />Copyright (C) Microsoft Corp 1981-1997.&nbsp; All rights reserved.<br /><br /> Assembling: prog.asm<br /><br />C:\masm32\bin&gt;link16 prog.asm<br /><br />Microsoft (R) Segmented Executable Linker&nbsp; Version 5.60.339 Dec&nbsp; 5 1994<br />Copyright (C) Microsoft Corp 1984-1993.&nbsp; All rights reserved.<br /><br />Run File :<br />List File :<br />Libraries [.lib]:<br />Definitions File :<br />prog.asm : fatal error L1101: invalid object module<br />Object file offset: 1 Record type: 43</code></pre><br /><br />Whats wrong now with the linker?<br /><br />I tried again, thought maybe I need to use the linker on the .obj file, and this is what came out:<br /><br /><pre><code>C:\masm32\bin&gt;link16 prog.obj<br /><br />Microsoft (R) Segmented Executable Linker&nbsp; Version 5.60.339 Dec&nbsp; 5 1994<br />Copyright (C) Microsoft Corp 1984-1993.&nbsp; All rights reserved.<br /><br />Run File :<br />List File :<br />Libraries [.lib]:<br />Definitions File :<br />LINK : warning L4021: no stack segment</code></pre><br />It also created a prog.exe file<br /><br />And what are these fields that I left empty that needs to be filled?</div>
    <div class="meta">Posted on 2012-03-09 09:22:13 by p1Mp</div>
   </div>
   <div class="post" id="post-215856">
    <div class="subject"><a href="#post-215856">Re: Assembling on DosBox</a></div>
    <div class="body">Run File should be quite obvious: the name of the binary the linker should generate (usually .exe, sometimes .com).<br />List File is a .map file, which will contain debugging information.<br />With Libraries you can specify any libraries that your code requires (the linker&#039;s main task is to combine multiple .obj files into a complete application. A library is a collection of .obj files).<br />A Definition file contains the names of symbols that you want to export (which mainly applies to Windows DLLs).<br /><br />Basically all the default values are okay. You need to specify the Run File name, but it generally defaults to the right name anyway. The rest is optional and can be skipped.<br /><br />Congratulations! You have now built PROG.EXE, which you can run in Dosbox (and it will crash, because your program does not do a clean exit).</div>
    <div class="meta">Posted on 2012-03-09 09:36:15 by Scali</div>
   </div>
   <div class="post" id="post-215857">
    <div class="subject"><a href="#post-215857">Re: Assembling on DosBox</a></div>
    <div class="body"><div class="quote"><br />Run File should be quite obvious: the name of the binary the linker should generate (usually .exe, sometimes .com).<br />List File is a .map file, which will contain debugging information.<br />With Libraries you can specify any libraries that your code requires (the linker&#039;s main task is to combine multiple .obj files into a complete application. A library is a collection of .obj files).<br />A Definition file contains the names of symbols that you want to export (which mainly applies to Windows DLLs).<br /><br />Basically all the default values are okay. You need to specify the Run File name, but it generally defaults to the right name anyway. The rest is optional and can be skipped.<br /><br />Congratulations! You have now built PROG.EXE, which you can run in Dosbox (and it will crash, because your program does not do a clean exit).<br /></div><br /><br />:P<br /><br />And how do I check its registers tell me plz again?! :D<br /><br />By the way, I try to run it on DosBox by mounting it on c:\masm32\bin and then type prog.exe, am I doing it correct? Because it doesn&#039;t work... (Illegal command: prog.exe)<br /><br />And how do I do an exit clean?</div>
    <div class="meta">Posted on 2012-03-09 09:39:10 by p1Mp</div>
   </div>
   <div class="post" id="post-215858">
    <div class="subject"><a href="#post-215858">Re: Assembling on DosBox</a></div>
    <div class="body"><div class="quote"><br />And how do I check its registers tell me plz again?! :D<br /></div><br /><br />As I said, get a debugger for DOS (be it DOS&#039;s own DEBUG.EXE, Borland&#039;s Turbo Debugger, Microsoft CodeView, or whatever else), and then open PROG.EXE in your debugger and single-step through it.</div>
    <div class="meta">Posted on 2012-03-09 09:44:01 by Scali</div>
   </div>
   <div class="post" id="post-215859">
    <div class="subject"><a href="#post-215859">Re: Assembling on DosBox</a></div>
    <div class="body"><div class="quote"><br /><div class="quote"><br />And how do I check its registers tell me plz again?! :D<br /></div><br /><br />As I said, get a debugger for DOS (be it DOS&#039;s own DEBUG.EXE, Borland&#039;s Turbo Debugger, Microsoft CodeView, or whatever else), and then open PROG.EXE in your debugger and single-step through it.<br /></div><br /><br />It does crash when I run the program. How do I do an exit clean then?<br />And can you please tell me how to use debug.exe? (Sorry im being annoying and nagging you too much, I just hope you understand that it&#039;s hard to figure out about ASM on google (the internet itself) and that is why I came to this forum, your help is really really appreciated just so you know :D , and sorry once again...)</div>
    <div class="meta">Posted on 2012-03-09 10:02:00 by p1Mp</div>
   </div>
   <div class="post" id="post-215860">
    <div class="subject"><a href="#post-215860">Re: Assembling on DosBox</a></div>
    <div class="body">Art Of Assembly will tell you how to properly exit from a program.<br />And you should also read about debugging there.<br />Not sure if DEBUG.EXE is a good idea actually. Doesn&#039;t work in my Dosbox, it says &quot;Incorrect DOS version&quot;.</div>
    <div class="meta">Posted on 2012-03-09 10:07:57 by Scali</div>
   </div>
   <div class="post" id="post-215861">
    <div class="subject"><a href="#post-215861">Re: Assembling on DosBox</a></div>
    <div class="body">Can you please tell me in which chapter I find how to exit a program in a clean way?<br />Also, what debugger do you recommend using then?</div>
    <div class="meta">Posted on 2012-03-09 10:16:32 by p1Mp</div>
   </div>
   <div class="post" id="post-215862">
    <div class="subject"><a href="#post-215862">Re: Assembling on DosBox</a></div>
    <div class="body">Argh? What is up with kids today? The Google generation?<br />Need instant answers for everything?<br /><br />The world doesn&#039;t work that way. I&#039;ve already spelled out way more than should be required (and I already suggested various debuggers).<br />It ends here. Just start reading Art of Assembly. You&#039;ll find what you&#039;re looking for soon enough.</div>
    <div class="meta">Posted on 2012-03-09 11:27:17 by Scali</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=30861&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=30861&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="30861" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=30861&amp;page=2">&gt;</a><a href="../?id=30861&amp;page=3">&raquo;</a></form>  </div>
 </body>
</html>