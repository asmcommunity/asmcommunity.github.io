<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>My string replace - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=5608" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=5608">My string replace</a></p>
   <div class="post" id="post-39945">
    <div class="subject"><a href="#post-39945">My string replace</a></div>
    <div class="body"><strong>Major edit:</strong><br />ok my string replace function will replace any find string with any other string of any lenght<br />like<br />this is the string you want to find in b db &quot;im gettin good&quot;<br />this is your string to find f db &quot;g&quot; and ur replace string r db &quot;w&quot;<br />you will end up with &quot;im wettin wood&quot; in a new buff<br />or ur replace string &quot;****&quot; = &quot;im ****ettin ****ood&quot;<br />im soo hyped that ive done such a complex thing ive gotta say every thing about it!<br />also if therres any way to optimize or make it better/faster please tell me.<br /><br /><pre><code><br />ret1 macro<br />      xor eax,eax<br />      inc eax<br />      endm<br /><br />      ret0 macro<br />      xor eax,eax<br />      endm<br />sav macro<br />pushad<br />pushf<br />endm<br /><br />res macro<br />popf<br />popad<br />endm<br /><br />PStrCpy Proc stdcall public,PTRDEST long ,PTRSRC long,DIFputnull long;<br />sav<br />mov ecx,PTRDEST<br />mov ebx,PTRSRC<br />Invoke StringLen,ebx<br />mov edi,eax<br />cmp eax,0<br />je @PStrCpyEND<br />dec edi<br />xor eax,eax<br />xor edx,edx<br />mov dl, BYTE PTR &#91;ebx+eax&#93;<br />mov BYTE PTR &#91;ecx+eax&#93;,dl<br />;inc eax<br />cmp eax,edi<br />je @PStrCpy@PUtnull<br />@@&#58;<br />inc eax<br />mov dl, BYTE PTR &#91;ebx+eax&#93;<br />mov BYTE PTR &#91;ecx+eax&#93;,dl<br />cmp eax,edi<br />jne @B<br />@PStrCpy@PUtnull&#58;<br />cmp DIFputnull,1<br />je @PStrCpyEND<br />inc eax<br />mov BYTE PTR &#91;ecx+eax&#93;,0<br />@PStrCpyEND&#58;<br />res<br />ret<br />PStrCpy EndP<br />;=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|;for string replace<br />PStrMultiMove Proc,PTRDEST long ,PTRFIND long,PTRSRC long;,DIFputnull long<br /><br /><br />Local pdest long<br />Local pfind long<br />Local psrc long<br />Local lpheap long<br />sav<br />mov ecx,PTRDEST<br />Invoke StringLen,ecx<br />cmp eax,0<br />je PStrMultiMoveEND<br />mov pdest,eax<br /><br />mov ebx,PTRSRC<br />Invoke StringLen,ebx<br />cmp eax,0<br />je PStrMultiMoveEND<br />mov psrc,eax<br /><br />Invoke StringLen,PTRFIND<br />cmp eax,0<br />je PStrMultiMoveEND<br />mov pfind,eax<br />add ecx,eax<br />sav<br />mov edx,pdest<br />add edx,1000<br />;13+1000 for 5l4xx0r<br />Invoke GetProcessHeap<br />Invoke HeapAlloc,eax,HEAP_GENERATE_EXCEPTIONS or HEAP_ZERO_MEMORY,edx<br />mov lpheap,eax<br />res<br />Invoke PStrCpy,lpheap,ecx,0<br />sub ecx,pfind<br />Invoke PStrCpy,ecx,ebx,1<br />add ecx,psrc<br />Invoke PStrCpy,ecx,lpheap,0<br /><br /><br /><br /><br />PStrMultiMoveENDHEAP&#58;<br />Invoke GetProcessHeap<br />Invoke HeapFree, eax, 0, lpheap<br />PStrMultiMoveEND&#58;<br /><br />res<br />ret<br />PStrMultiMove EndP<br />;=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|<br />PStrReplace Proc stdcall public,PTRstringrep long,PTRstrrep long,PTRSTRING2REPW long,PTRbuffer long<br />Local PTRstringrepLEN long<br />Local PTRstrrepwLEN long<br />Local fstrun long<br />;int 3<br />sav <br />Invoke PStrCpy,PTRbuffer,PTRstringrep,0<br /><br />mov ecx,PTRbuffer<br />mov ebx,PTRstrrep<br />Invoke StringLen,ecx<br />mov PTRstringrepLEN,eax<br />Invoke StringLen,ebx<br />mov PTRstrrepwLEN,eax<br />cmp PTRstringrepLEN,eax<br />jb PStrReplace@endo<br />mov edx,PTRstringrepLEN<br />sub edx,PTRstrrepwLEN<br />mov edi,edx<br />xor eax,eax<br />xor edx,eax<br />mov esi,-1<br />jmp @neloop<br />PStrReplace@not&#58;<br />dec ecx<br />Invoke PStrMultiMove,ecx,ebx,PTRSTRING2REPW<br /><br />push eax<br />push edx<br />Invoke StringLen,PTRbuffer<br />mov PTRstringrepLEN,eax<br />mov edx,PTRstringrepLEN<br />sub edx,PTRstrrepwLEN<br />mov edi,edx<br />pop edx<br />pop eax<br />inc ecx<br /><br /><br /><br />@neloop&#58;<br />cmp esi,edi<br />je PStrReplace@endo<br />Invoke PStrCmp,ecx,ebx<br />inc ecx<br />inc esi<br />cmp eax,1<br />jne @neloop<br />je PStrReplace@not<br />PStrReplace@endo&#58;<br />res<br />ret<br />PStrReplace EndP<br />;=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|=-|<br />PStrCmp Proc stdcall public, PTRstring long,PTRstring2find long<br />;Local strlenght1 long<br />push ecx<br />push ebx<br />push edx<br />push esi<br />mov ecx,PTRstring<br />Invoke StringLen,ecx<br />cmp eax,0<br />je @ret0attrrcmp<br />mov ebx,PTRstring2find<br />Invoke StringLen,ebx<br />cmp eax,0<br />je @ret0attrrcmp<br />mov esi,eax<br />dec esi<br />xor eax,eax<br />xor edx,eax<br />mov dl, BYTE PTR &#91;ebx+eax&#93;<br />cmp dl, BYTE PTR &#91;ecx+eax&#93;<br />jne @ret0attrrcmp<br />;inc eax<br />@@&#58;<br />cmp eax,esi<br />je @ret1attrrcmp<br />inc eax<br />mov dl, BYTE PTR &#91;ebx+eax&#93;<br />cmp dl, BYTE PTR &#91;ecx+eax&#93;<br />je @B<br />jne @ret0attrrcmp<br />@ret1attrrcmp&#58;<br />ret1<br />@popptrecmp&#58;<br />pop esi<br />pop edx<br />pop ebx<br />pop ecx<br />ret<br />@ret0attrrcmp&#58;<br />ret0<br />jmp @popptrecmp<br />PStrCmp EndP<br />StringLen Proc  stdcall public,ptrSTRING1&#58;DWORD;duh<br />pushf<br />push esi<br />push ebx<br />mov esi,ptrSTRING1<br />xor ebx,ebx<br />xor eax,eax<br />@@&#58;<br />mov bl,BYTE PTR &#91;esi+eax&#93;<br />inc eax<br />cmp bl,0<br />jne @B<br />dec eax<br />pop ebx<br />pop esi<br />popf<br />ret<br />StringLen end<br /></code></pre></div>
    <div class="meta">Posted on 2002-05-25 12:37:07 by Qages</div>
   </div>
  </div>
 </body>
</html>