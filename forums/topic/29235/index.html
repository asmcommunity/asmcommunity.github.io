<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Question about keyboard interrupts - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29235" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29235">Question about keyboard interrupts</a></p>
   <div class="post" id="post-206504">
    <div class="subject"><a href="#post-206504">Question about keyboard interrupts</a></div>
    <div class="body">I have this program written in asm that generates random characters and displays them on the screen until you press a key on the keyboard.&nbsp; The program currently works but my problem is that it&#039;s basically a regurgitation of what was written on the board in my classroom so I don&#039;t understand why the keyboard interrupt works as it does.&nbsp; Also if anyone could explain how a mouse interrupt works that would be welcome as well.<br /><br />Here is the code...<br /><br /><div class="quote"><br /><br />.model small<br />.stack 100h<br />.data<br />seed DW 1234h<br />.code<br /><br />main proc<br />	mov ax,@data<br />	mov ds,ax<br />	<br />	push ds<br />	mov ax,@code<br />	mov ds,ax<br />	mov ah,25h<br />	mov al,9h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;I believe this is what makes the interrupt work?<br />	mov dx,offset keyboard_int<br />	int 21h<br />	pop ds<br />	<br />	mov al,&#039;0&#039;<br />	mov ah,02h<br />	mov dl,0d&nbsp; &nbsp; &nbsp;  		;across<br />	mov dh,0d&nbsp; &nbsp; &nbsp;  		;down<br />	mov bx,offset chars<br />	mov si,0<br />	mov cx,2<br />	<br />L1:	call drawChar<br />	call offsetPOS<br />	call randomCH<br />	inc cx<br />	push ax<br />	mov ah,9h<br />	pop ax<br />	loop L1<br /><br />	mov ax,4c00h<br />	int 21h<br />main endp<br /><br />keyboard_int proc<br />	mov ax,4c00h<br />	int 21h<br />	iret<br />keyboard_int endp<br /><br />offsetPOS proc<br />	inc dh&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;across<br />	cmp dh, 50d<br />	jl notEdge<br />	mov dh, 0<br />	inc dl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;down<br />	cmp dl, 80d<br />	jl notEdge<br />	mov dl, 0<br />notEdge:<br />	ret<br />offsetPOS endp<br /><br />drawChar proc<br />	push ax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; symbol, color<br />	push dx<br />	mov al, 80<br />	mul dh&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; ax = 80*ROW<br />	xor dh, dh&nbsp; &nbsp; &nbsp; &nbsp; ; dx = COL<br />	add ax, dx&nbsp; &nbsp; &nbsp; &nbsp; ; ax = 80*ROW+COL<br />	shl ax, 1&nbsp; &nbsp; &nbsp; &nbsp;  ; ax = (80*ROW+COL)*2<br />	mov di, ax&nbsp; &nbsp; &nbsp; &nbsp; ; di = offset for char<br />	<br />	mov ax, 0B800h<br />	mov es, ax<br /><br />	pop dx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; restore width, height<br />	pop ax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Restore symbol, color<br />	mov es:, ax&nbsp;  ; Symbol should appear after this<br />	ret<br />drawChar endp<br /><br />randomCH proc<br />	push ax<br />	push dx<br />	mov ax, 32fdh<br />	mul seed<br />	xor dx, dx<br />	add ax, 26c4h<br />	mov seed, ax<br />	xor ax, 8h<br />	mov bx, ax<br />	pop dx<br />	pop ax<br />	mov al, bl<br />	ret<br />randomCH endp<br /><br />end main</div></div>
    <div class="meta">Posted on 2008-12-15 18:16:20 by Unclejunebug</div>
   </div>
   <div class="post" id="post-206505">
    <div class="subject"><a href="#post-206505">Re: Question about keyboard interrupts</a></div>
    <div class="body">The first int21 is setting up the pointer to your interrupt function, in this case a keyboard interrupt.<br />This will be called whenever a key is pressed.<br /><br />Basically, an interrupt function is some code that is executed in response to an interrupt event (usually hardware-generated).<br /><br />The interrupt function itself doesn&#039;t care what key was pressed, it just calls int 21 with ah=4Ch, which terminates a DOS program.<br /><br />Check out Ralf Brown&#039;s Interrupt List (RBIL) for specific information on all DOS interrupts.</div>
    <div class="meta">Posted on 2008-12-15 21:57:17 by Homer</div>
   </div>
   <div class="post" id="post-206506">
    <div class="subject"><a href="#post-206506">Re: Question about keyboard interrupts</a></div>
    <div class="body">You are on the right track regarding your comment in the posted code.<br /><br />Under DOS, INT 0x21, Function 0x25, allows you to hook a specified Interrupt Vector so that it will call a custom routine. The code you posted sets Interrupt Vector 0x09 to point to code that calls a DOS exit, thus terminating the program.<br /><br />RBIL is probably your best friend for PC interrupt information.<br /><br />-<a target="_blank" href="http://www.ctyme.com/intr/rb-2602.htm">INT 0x21, Function 0x25</a>.<br />-<a target="_blank" href="http://www.ctyme.com/intr/int-33.htm">INT 0x33, General Mouse Functions</a>.</div>
    <div class="meta">Posted on 2008-12-15 22:07:03 by SpooK</div>
   </div>
   <div class="post" id="post-206508">
    <div class="subject"><a href="#post-206508">Re: Question about keyboard interrupts</a></div>
    <div class="body">Hey!<br /><br />Thanks for the clarification and the link to RBIL.&nbsp; I think the mov ah,25h line was what was giving me the most trouble.&nbsp; I didn&#039;t realize that is what is used to set an interrupt vector to a different interrupt.&nbsp; I&#039;ve been trying now to get a mouse interrupt to work but with no success yet.&nbsp; The program I wrote just draws the letter &#039;H&#039; all over the screen and should stop when you either click a mouse button or move the mouse.&nbsp; If I take the mouseInt procedure out the letters draw on the screen without any problem, but with it in it doesn&#039;t draw anything and just hangs.&nbsp; Can anyone tell me what I&#039;m doing wrong here?<br /><br /><div class="quote">.model small<br />.stack 100h<br />.data<br /><br />mouseX	DW	?<br />mouseY	DW	?<br />mButton DW	?<br /><br />.code<br />main proc<br /><br />	mov ax,@data<br />	mov ds,ax<br />	push ds<br />	<br />	mov ax,@code<br />	mov ds,ax<br />	mov ah,25h<br />	mov al,33h<br />	mov dx,offset mouseInt<br />	int 21h<br />	pop ds<br />	<br />	mov ax,3<br />	int 33h<br />	mov mButton,bx<br />	mov mouseX,cx<br />	mov mouseY,dx<br />	<br />	mov bx,80<br />	mov di,bx<br />	mov cx,0<br />L1:	call drawChar<br />	mov ah,33h<br />	jmp L1<br />	<br />	mov ax,4C00h<br />	int 21h<br />	<br />main endp<br /><br />mouseInt proc<br />	mov ax,3<br />	int 33h<br />	cmp bx,mButton<br />	jne endProgram<br />	cmp cx,mouseX<br />	jne endProgram<br />	cmp dx,mouseY<br />	jne endProgram<br />	jmp continue<br />endProgram: mov ax,4C00h<br />			int 21h<br />continue: iret<br />mouseInt endp<br /><br />keyboardInt proc<br />	mov ax,4C00h<br />	int 21h<br />	;iret<br />keyboardInt endp<br /><br />drawChar proc<br />	mov ax,0B800h<br />	mov es,ax<br />	mov ah,25h<br />	mov al,&#039;H&#039;<br />	mov es:,ax<br />	add di,10<br />	ret<br />drawChar endp<br />	<br />end main</div></div>
    <div class="meta">Posted on 2008-12-16 12:47:05 by Unclejunebug</div>
   </div>
   <div class="post" id="post-206511">
    <div class="subject"><a href="#post-206511">Re: Question about keyboard interrupts</a></div>
    <div class="body">The INT 0x21, Function 0x25, method of hooking of INT 0x09 works in the above code because the interrupt vector is triggered (either directly or indirectly) by a hardware interrupt; an event with origins external to the processor.<br /><br />Interrupts 0x20 and above are considered &quot;programmer/user/OS defined&quot;, in which are mainly used in an API-like fashion via a specialized trapped software exception commonly known as the &quot;INT&quot; instruction. There are exceptions (no pun intended) to these higher interrupt vectors, such as mapping IRQs, as well as the availability of other INT-like instructions, but that summary should suffice as a general guideline.<br /><br />The use of INT 0x33 would necessitate polling, periodically checking for a specific event. Figure out which INT 0x33 function would serve you best in this situation and work it in.</div>
    <div class="meta">Posted on 2008-12-16 20:43:56 by SpooK</div>
   </div>
  </div>
 </body>
</html>