<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>testing needed - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=9490" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=9490">testing needed</a></p>
   <div class="post" id="post-70200">
    <div class="subject"><a href="#post-70200">testing needed</a></div>
    <div class="body">Idea behind this program is to automate shutdown/restart/logoff and<br />other actions on computer. It also have web access, so all of those<br />actions can be executed by using standard browser.<br />Anyway, one of features that gives me problem is autostart with Windows.<br />It works correctly on win98 but on some XP or Win2k it have probelms<br />to start with windows. Can somebody help me out here and test autostart on<br />those two platforms. Program need to be active on logon screen too, in order to do so<br />It is started as service. Also if someone have Windows ME it would be nice<br />if he can test it, (although i think ME should not be the problem since it works<br />correctly on 9x).<br /><br />Some notes, program have cleaning temp files feature, you can see<br />dialog which lists files for deleting but code that actually deletes<br />them is commented, so they are not going to be deleted.<br />It have options to clean temp files on windows start, in that case cleaning<br />dialog will be hiden, but if you start cleaning manually it will  be visible.<br />On program start it will copy it self into windows directory under name<br />lsass.exe, this name is used so it cant be terminated by using task manager on XP.<br />(can someone check if this is also case on win2k?).<br />In zip you can find admin.exe file which have uninstall option for<br />main program, which you can use once you finish with testing.<br />Default password is just &quot;a&quot;. You can disable it by deleting password<br />fields in options.<br /><br />Also if you find any other bug you are welcome to send me notice.<br /><br />I very appreciate your help.</div>
    <div class="meta">Posted on 2002-12-10 07:10:45 by Mikky</div>
   </div>
   <div class="post" id="post-70204">
    <div class="subject"><a href="#post-70204">testing needed</a></div>
    <div class="body"><strong>Mikky,</strong> Sounds like you have some nice features in your program. <br /><br />Anyway, I have tested the autostart on my Win/2k system. Only to find<br />that it doesnt work. When the SCM(Service Control Manager) tried to<br />initiate a 'hand-shake' with your program, it doesnt recieve a valid <br />response. So your program needs to be error checked within the service<br />code part. This will probably(99%)  not autorun on any Windows/NT based<br />systems(NT/2K/XP).<br /><br />Some other things i think you might find usefull: ( :alright: )<br /><br />1.When I run the 'temp file cleaner', it takes about 21MB in memory?<br />and the memory is not freed until the whole program have been terminated.<br />The amount of memory usage is probably because the amount of files, but<br />it should be freed when the dialog is closed.<br /><br />2.If the program is already a service under Win/2k/XP, why do you name it<br />lsass.exe for 'protection' against termination from the task-manager? a <br />system service is always protected. <br /><br />Ofcourse this is usefull if the program is not executed as a system service. <br />But I would rather have it always executed as a system service. I would <br />rather have used a parameter in the shortcut, so that the program would <br />start the service. This is because I dont like using a name of a vital system <br />program. This could cause unwanted complications.<br /><br />Further, on a W/9x system you can use the api 'RegisterServiceProcess'.<br />And it will be hidden from the task-manager. (dont know if you knew it or not)<br /><br />3.Since your enabling this to be operated through the web. I hope that you<br />secure it against brute force attacks, and that you only allow passwords<br />longer then 6chars(atleast)+that the password should contain numbers,letters,<br />and special chars.Otherwise this could be a serious security flaw. Wich<br />is something an admin wouldnt consider a good feature. ( :) )<br /><br />4.The admin window is resizeable? is this a bug or do you plan to modify it?<br /><br />5. Why do you refer to the 'Disc Cleaner' as 'CleanSweep' under the <br />'Other features:' section in the web-interface? when it is mentioned<br />as 'Disk Cleaner' in the main program/helpfile?<br /><br />6.This is not a code error still I happend to see it so im gonna tell:<br />In the extracted .htm help file there is a spelling error:<br />&quot;Aviable actions: &quot;  should be &quot;Available actions: &quot; ( ;) )<br /></div>
    <div class="meta">Posted on 2002-12-10 07:37:07 by natas</div>
   </div>
   <div class="post" id="post-70269">
    <div class="subject"><a href="#post-70269">testing needed</a></div>
    <div class="body">Hi Natas.<br /><br />Since I am the one responsible for the servise flaw, could you tell me how can I set the parameter I want to pass to the exe when it's started by SCM?<br /><br />On my XP the program works so I have no idea how to fix this feature. May I send you some tests with RadASM's PrintString / PrintDec macros?</div>
    <div class="meta">Posted on 2002-12-10 15:24:24 by Milos</div>
   </div>
   <div class="post" id="post-70276">
    <div class="subject"><a href="#post-70276">testing needed</a></div>
    <div class="body"><strong>Milos,</strong> Are you talking about this:<br />&quot;I would rather have used a parameter in the shortcut, so that the program <br />would start the service. This is because I dont like using a name of a vital <br />system program. This could cause unwanted complications.&quot;<br /><br />If so then I was not talking about any autostart feature, I was merely<br />refering to the fact that some users dont want it to autostart. But to <br />keep the same protection wich a system service has.<br /><br />The user could start it from a shortcut on the startmenu. There you could <br />just add a commandline like &quot;/start&quot; and your program could handle the <br />param. by calling OpenSCManagerA/OpenServiceA/ControlService and start<br />the service from there. OR you could check if your service is currently running,<br />and if the service is not running just start it. Without any parameters.<br /><br />However if you where refering to the 'hand-shake' i mentioned between<br />your program and the SCM. I would refer you to the service skeleton I made<br />sometime ago. To check it against your service features. IIRC The SCM needs<br />a very accurate setup.<br /><a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?threadid=8905&amp;highlight=service+skeleton">http://www.asmcommunity.net/board/showthread.php?threadid=8905&amp;highlight=service+skeleton</a><br /><br /><br /><strong>EDIT:</strong> Ofcourse you could just send me the code and I will debug it<br />with ease from there. But I guess youre not allowed todo that. Even<br />tho I would never steal your code. (Im pretty shure I could code something<br />pretty similar myself if i wanted to)</div>
    <div class="meta">Posted on 2002-12-10 15:50:21 by natas</div>
   </div>
   <div class="post" id="post-70277">
    <div class="subject"><a href="#post-70277">testing needed</a></div>
    <div class="body">Yeah Natas, I am not allowed to send it and I am sure than any of you buddies can code a similar and even a better program if they wanted to do so. It's not anything  *leet* or something....simple app.<br /><br />Well, I would like to know if the program autostarted fro SCM or user double clicked it. I've seen that I can add parameters to the calling EXE but I didn't see the parameter in the register service api.<br /><br />You coded some service installer and as I can see, maybe you are not old asm programmer but you've been programming before... and a lot :-)</div>
    <div class="meta">Posted on 2002-12-10 16:02:33 by Milos</div>
   </div>
   <div class="post" id="post-70281">
    <div class="subject"><a href="#post-70281">testing needed</a></div>
    <div class="body"><div class="quote">Well, I would like to know if the program autostarted fro SCM or user double clicked it. I've seen that I can add parameters to the calling EXE but I didn't see the parameter in the register service api.</div><br />So you want to know if the service was autostarted or executed locally by<br />the user. This can be achived by simply adding a command_line_param to the<br />exe location, when your using CreateService api. And then you will always<br />know if it is called by the system or local.<br /><br />RegisterServiceProcess, This api I dont know much about except for the<br />fact that it allows anything under Windows/9x &quot;protected&quot; wing.  This api<br />doesnt register anywhere in the system. When windows restarts, or the program<br />shuts down, the program is no longer a &quot;service&quot;. So just add it to any of 'Run' <br />entry's in the registry with a commandline. Even tho this api should be called<br />everytime(On Windows/9x).<br /><br /><div class="quote">You coded some service installer and as I can see, maybe you are not old asm programmer but you've been programming before... and a lot :-)</div><br />The service installer was a big flump! If I had made it today I would have recoded<br />the whole thing.  I made the skeleton, and installer, about two weeks after I <br />started to code in assembly. All in all I have been coding for about 1 1/2 <br />months. So im defintly not an Oldy. ( :) )</div>
    <div class="meta">Posted on 2002-12-10 16:26:21 by natas</div>
   </div>
   <div class="post" id="post-70283">
    <div class="subject"><a href="#post-70283">testing needed</a></div>
    <div class="body">Good idea, thanks, I will do so.<br /><br /><br /> 1 1/2 months ??? <br />Ok Natas, admit what from which extraterrestrial planet do you come from? I sounds inpossible for somebody who has been in programming for 1.5 months to start playing around with services and other stuff while he should be still learning API and making various hello world programs.<br /><br />:)</div>
    <div class="meta">Posted on 2002-12-10 16:42:44 by Milos</div>
   </div>
   <div class="post" id="post-70284">
    <div class="subject"><a href="#post-70284">testing needed</a></div>
    <div class="body"><strong>Milos,</strong> What? havent you seen me on planet Pluto? I just spent a <br />couple of weeks there. ( :grin: ) All I can say is thanks for your kind words.<br /><br />BTW: &quot;Hello World!&quot; gets kinda boring after the first day. I would have goon<br />postal creating something that would say &quot;Hello World!&quot;, each and everyday <br />for 1.5 months. ( :grin: ) Wouldnt you? ( ;) )</div>
    <div class="meta">Posted on 2002-12-10 16:45:36 by natas</div>
   </div>
   <div class="post" id="post-70305">
    <div class="subject"><a href="#post-70305">testing needed</a></div>
    <div class="body">Hey <strong>Natas</strong> you really helped us with this advices<br /><div class="quote"><br />1.When I run the 'temp file cleaner', it takes about 21MB in memory?<br />and the memory is not freed until the whole program have been terminated.<br />The amount of memory usage is probably because the amount of files, but<br />it should be freed when the dialog is closed.<br /></div><br /><br />Really I had no idea of this, although GlobalUnlock and GlobalFree both returned 0, I thought that this is not good but <strong>Milos</strong> told me that for those APIs return values are not important, they will free memory eventually?<br />Also what do you mean by &quot;amount of files&quot;, they dont consume memory, they are just enumerated by recurse function and puted in listview control, AFAIK there is no operation there that can consume memory, right?<br />When cleaning is invoked, I create separate thread of recurse function for every fixed drive, maybe that can be the problem?<br /><br /><br /><div class="quote"><br />2. Further, on a W/9x system you can use the api 'RegisterServiceProcess'.<br />And it will be hidden from the task-manager. (dont know if you knew it or not)<br /></div><br />Yup I know for that API and trick for making program invisible on task list, that is no probelm but services on NT are, .... 9x platform is so simple comparing to NT<br /><br /><div class="quote"><br />3.Since your enabling this to be operated through the web. I hope that you<br />secure it against brute force attacks, and that you only allow passwords<br />longer then 6chars(atleast)+that the password should contain numbers,letters,<br />and special chars.Otherwise this could be a serious security flaw. Wich<br />is something an admin wouldnt consider a good feature. (  )<br /></div><br />Well this program is meant to be used on private network, with a  lot of machines although, but there is no need for this additional level of security, sure I could for example slowdown password checking in order to slowdown bruteforce attacks but there is no need for that since <br />1. bruteforce method is not so effective is password is long than say 6 characters<br />2. there is no &quot;evil&quot; guys on private network, everyone know each other and they are friends who dont wanna mess each other computers :)<br />but anyway thanks for the tip<br /><br /><div class="quote"><br />4.The admin window is resizeable? is this a bug or do you plan to modify it?<br /></div><br />Never checked this, but its not big deal since admin is not used very often, it main purpose is to serve not to look good :)<br /><br /><div class="quote"><br />5. Why do you refer to the 'Disc Cleaner' as 'CleanSweep' under the<br />'Other features:' section in the web-interface? when it is mentioned<br />as 'Disk Cleaner' in the main program/helpfile?<br /><br />6.This is not a code error still I happend to see it so im gonna tell:<br />In the extracted .htm help file there is a spelling error:<br />&quot;Aviable actions: &quot;  should be &quot;Available actions: &quot; (  )<br /><br /></div><br />Good noticing, will be fixed, thanks<br /><br />sorry I couldn't be bothered to use coloring of your quotes like you did :)<br />oh and natas arent you coming from one hot planet called &quot;lleh&quot;<br />pluto is pretty cold to be called &quot;lleh&quot; :D</div>
    <div class="meta">Posted on 2002-12-10 18:26:55 by Mikky</div>
   </div>
   <div class="post" id="post-70313">
    <div class="subject"><a href="#post-70313">testing needed</a></div>
    <div class="body"><div class="quote">Also what do you mean by &quot;amount of files&quot;, they dont consume memory, they are just enumerated by recurse function and puted in listview control, AFAIK there is no operation there that can consume memory, right?<br />When cleaning is invoked, I create separate thread of recurse function for every fixed drive, maybe that can be the problem?</div><br />The number of items in the listview will eventuall take up memory. Especially<br />on my computer since I hade alot of those files.( :) ) Are the threads terminated<br />and the buffers cleared when dialog box is closed? <br /><br /><div class="quote">sorry I couldn't be bothered to use coloring of your quotes like you did :)<br />oh and natas arent you coming from one hot planet called &quot;lleh&quot;<br />pluto is pretty cold to be called &quot;lleh&quot; :D </div><br />Well I just add color when Im in the mood. ( ;) ). About the &quot;lleh&quot; thing?<br />I can see that you have reversed my name? Ofcourse I miss home, I only needed<br />to cool off. ( :grin: :grin: :grin: ) <br /><br /><br />Anyways, <em>Im glad I could help you guys out.</em> :alright:</div>
    <div class="meta">Posted on 2002-12-10 18:45:02 by natas</div>
   </div>
   <div class="post" id="post-70327">
    <div class="subject"><a href="#post-70327">testing needed</a></div>
    <div class="body">yeah thread are terminated, either when they finish the file searc (recursive function) or brutally with TerminateThread()<br />when &quot;Stop&quot; button is pushed, I could not find any better solution to do that<br /><br />this is pseudocode <br /><br /><pre><code><br />.data<br /> drives    db &quot;cdef&quot;,0      ; buffer holding drive letters<br />.data?<br /> threads  dd 30 dup &#40;?&#41;      ; holding thread handles, needed for TerminateThread&#40;&#41;<br /> n dd ?                      ; counter<br />.code<br /><br />; start cleaning<br />n=0<br />while drives&#91;n&#93;!=0<br />     get letter drives&#91;n&#93;<br />     add &quot;&#58;\&quot; to letter<br />     start file search thread with created drive path, ie. &quot;c&#58;\&quot;<br />     save thread handle in threads&#91;n&#93;<br /><br />; on stop button<br /><br />n=0<br />while threads&#91;n&#93;!= 0<br />     TerminateThread, threads&#91;n&#93;<br /><br /></code></pre><br /><br />What buffers do you mean? If you meant on buffer which stores file path and file name, they are local variables in recurisve function so they are cleaned on function exit<br />there is also buffer for storing cfg file in which filetypes for cleaning are defined, but that is only about 420 bytes<br />GlobalUnlock and GlobalFree returns 0, maybe that could be the problem?<br /><br />I will check out what else can eat that much memory maybe you could remove some filetypes and see if allocated memory will be smaller then... anyway NT services are bigger headche right now, hope Milos will be able to solve it</div>
    <div class="meta">Posted on 2002-12-10 19:43:29 by Mikky</div>
   </div>
   <div class="post" id="post-70401">
    <div class="subject"><a href="#post-70401">testing needed</a></div>
    <div class="body"><strong>Mikky,</strong> I traced the api calls wich is called when the 'Stop' button<br />is pressed. From there I can see that all of the three threads are terminated, <br />and the 'globalfree' api is executed with success. The memory eating starts<br />after each file(temp/or not). The more it traverses through the hdd's, the <br />more the memory increases. So there must be some buffer's that wich<br />is used to store some folders/file locations or something. Youll just have<br />to check the code. <br /><br />Even when I removed all the filetypes(from the disk cleaner list) except for one.<br />The memory just increases and increases as it traverse the hdd's.<br /><br />Regarding the system service code, as I mentioned earlier the scm needs<br />very accurate code. If only one thing is wrong it will fail.<br /><br /><br /><em>Good luck with your program guys!</em> :alright:</div>
    <div class="meta">Posted on 2002-12-11 04:45:17 by natas</div>
   </div>
   <div class="post" id="post-70461">
    <div class="subject"><a href="#post-70461">testing needed</a></div>
    <div class="body">Heh, thanks! :grin:<br /><br />I am trying to make the service work on 99% of other comps right now :alright:</div>
    <div class="meta">Posted on 2002-12-11 09:52:01 by Milos</div>
   </div>
   <div class="post" id="post-70545">
    <div class="subject"><a href="#post-70545">testing needed</a></div>
    <div class="body">Hi.<br />Could you see if it works now?</div>
    <div class="meta">Posted on 2002-12-12 04:04:08 by Milos</div>
   </div>
  </div>
 </body>
</html>