<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>FPU Floating Point Register Stack Questionn - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17446" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=17446">FPU Floating Point Register Stack Questionn</a></p>
   <div class="post" id="post-135112">
    <div class="subject"><a href="#post-135112">FPU Floating Point Register Stack Questionn</a></div>
    <div class="body">Hi Guys,<br /><br />I am having some trouble understanding the basic operation of the FPU Floating Point Reg. Stack.<br /><br />Please take a look at the ffg. short program:<br />-----------------------------------------------------------<br />Program MyProg;<br />#include(&quot;stdlib.hhf&quot;)<br /><br />static<br />            m_dFromStack: real32;<br /><br />begin MyProg;<br />            fld(3.445);<br />            fld(23.84);<br /><br />            fst(m_dFromStack);<br />            stdout.put(nl, &quot;2nd value pushed: &quot;, m_dFromStack);    // m_dFromStack contains 23.84 after 1st pop.<br />            fst(m_dFromStack);<br />            stdout.put(nl, &quot;1st  value pushed: &quot;, m_dFromStack);   // m_dFromStack contains 23.84 after 2nd pop as well.<br />end MyProg;<br /><br />-----------------------------------------------------------<br /><br />I was expecting the first  statement to return 23.84 and the second  statement to return 3.445.<br /><br />What am I not getting?<br /><br /><br />Thanks for your help.</div>
    <div class="meta">Posted on 2004-03-01 01:17:09 by Jaysen</div>
   </div>
   <div class="post" id="post-135138">
    <div class="subject"><a href="#post-135138">FPU Floating Point Register Stack Questionn</a></div>
    <div class="body"><strong>fst</strong> only stores the value of the top register without &quot;popping&quot; it. Use <strong>fstp</strong> to store and pop in a single operation.<br /><br />If you want to only store the value without popping immediately (for whatever reason), you could later pop the top register with the following:<br /><br /><strong>fstp st(0)</strong><br /><br />Randall's AoA has a good section on the FPU. If you are interested, the following is written in a different style and may help in further understanding the FPU's intricacies.<br /><br /><a target="_blank" href="http://www.masmforum.com/website/tutorials/fptute/index.html">http://www.masmforum.com/website/tutorials/fptute/index.html</a><br /><br />Raymond</div>
    <div class="meta">Posted on 2004-03-01 23:28:08 by Raymond</div>
   </div>
   <div class="post" id="post-135139">
    <div class="subject"><a href="#post-135139">FPU Floating Point Register Stack Questionn</a></div>
    <div class="body">My warmest &amp; most grateful thanks, Raymond,<br /><br />Last night after playing around a bit more with  and  and carrying on with the AoA manual, I managed to get how it works.<br /><br />Mr Randall Hyde, I'm still using the beta version of your excellent book so I don't know if you've already updated your explanation of  and  in AoA.  But in beta,  it doesn't state that  only stores but doesn't pop.<br /><br />I had to read on until the  and  where I read about the &quot;pop&quot; and the &quot;non-pop&quot; difference (only that was for integers) before I got how  and  works.<br /><br />My warmest and most grateful thanks.</div>
    <div class="meta">Posted on 2004-03-02 00:45:41 by Jaysen</div>
   </div>
  </div>
 </body>
</html>