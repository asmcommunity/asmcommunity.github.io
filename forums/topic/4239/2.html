<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Image loader library Beta release - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4239" />
  <link rel="prev" href="../?id=4239&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=4239">Image loader library Beta release</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=4239&amp;page=1" style="">&laquo;</a><a href="../?id=4239&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="4239" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-29978">
    <div class="subject"><a href="#post-29978">Image loader library Beta release</a></div>
    <div class="body">ahhh maybe that's it.<br /><br />You should have used a relative path I guess.  ;)</div>
    <div class="meta">Posted on 2002-03-19 19:31:04 by iblis</div>
   </div>
   <div class="post" id="post-30001">
    <div class="subject"><a href="#post-30001">Image loader library Beta release</a></div>
    <div class="body">Yep, I could have used GetModuleFileName to find the correct directory, assuming the end user didn't move good ole Homer, strip off the exeacutable name, tack on Homer's file name...<br /><br />I thought it best (since it was just a test app) to give explicit directions WHERE to put it, where the path was hard coded (to change either the pic or the path), and let the user play.<br /><br /><br />Gee guys, RTFM still applies.   ;-)<br /><br /><br /><br />Jimmy: I'm happy it worked so well for you. Shrinking the filesize is what I wanted to accomplish. Looks like you scored an 88% reduction.</div>
    <div class="meta">Posted on 2002-03-19 22:55:51 by Ernie</div>
   </div>
   <div class="post" id="post-30002">
    <div class="subject"><a href="#post-30002">Image loader library Beta release</a></div>
    <div class="body">Ernie, why not just use a relative path? So much easier for everybody.<br />Hardcoded paths = lame.</div>
    <div class="meta">Posted on 2002-03-19 23:03:23 by f0dder</div>
   </div>
   <div class="post" id="post-30020">
    <div class="subject"><a href="#post-30020">Image loader library Beta release</a></div>
    <div class="body"><div class="quote"><br />Woohoo<br /><br />Just wanted to drop a line saying that after some minor changes (had to change 1 line of code) the image.lib did it's wonder already.. The Filesize got reduced from 3.8MB to an amazing 444KB.. Small is beautiful ;)<br /><br />I'm never working with bmp's again.. (lol)<br /><br />PS: It works like a charm on XP. </div><br /><br />I was in an equivalent situation some months ago...<br />I had to code an autorun and I wanted it to be small !<br />But the Bitmap was way too big and I didn't want to use the Delphi/VB mess or use an exe packer on a 1 mb large executable.<br />As my original pic was in jpeg, i had to convert it in bmp first and the pic was way bigger than the jpeg, for sure...<br />Ernies method is definitely the solution !<br /><br />I remember when I coded in VB (don't mock me please :rolleyes: ), it had native support for, bmp. gif, jpeg and wmf files...<br />I assume it is via the same COM method right ?<br />Can somebody confirm this theory please ?<br />Thanks.</div>
    <div class="meta">Posted on 2002-03-20 02:01:42 by JCP</div>
   </div>
   <div class="post" id="post-30051">
    <div class="subject"><a href="#post-30051">Image loader library Beta release</a></div>
    <div class="body">imo it's a lot easier to keep your files in the same directory as the exe, then you don't need a path.<br />OpenSomeFile( &quot;myFile.txt&quot; );<br />will open just fine if it's in the same dir.  much easier for testing purposes.<br /><br /><br />Granted I should have &quot;RTFM&quot; but admitedly I skimmed over your first post.  Bad habit.   Had I read it I probably wouldn't have put it in MASM32 dir anyhow, as I like to keep things nice and orderly in there.  That would be like asking me to unzip your files into c:\windows.   There's enough crap in there already ;)</div>
    <div class="meta">Posted on 2002-03-20 07:29:15 by iblis</div>
   </div>
   <div class="post" id="post-30088">
    <div class="subject"><a href="#post-30088">Image loader library Beta release</a></div>
    <div class="body">Okay, I'm trying Ernie's library for the first time, and I've run into a few problems.  <br /><br />First, on some images, <strong>BitmapFromFile</strong> returns 00h, even when called with a path that I know is valid.<br /><br />When I do get a bitmap handle back, calling <strong>GetBitmapDimensionEx</strong> on that handle returns dimensions of 0 x 0.<br /><br />(EDIT: I &quot;adjusted&quot; the library to store the pixel dimensions of the image, with <strong>SetBitmapDimensionEx</strong>.  That fixed problem 2, but I still get ERROR_FILE_NOT_FOUND on about every other file I try to load.)<pre><code>invoke	SetBitmapDimensionEx, tempBitmap, dwWidth, dwHeight, NULL</code></pre><br />All of the images I'm trying to load worked fine when I called COM directly.</div>
    <div class="meta">Posted on 2002-03-20 16:29:43 by The Worrier King</div>
   </div>
   <div class="post" id="post-30098">
    <div class="subject"><a href="#post-30098">Image loader library Beta release</a></div>
    <div class="body"><div class="quote">Ernie, why not just use a relative path? So much easier for everybody. Hardcoded paths = lame.</div> <br /><br /><br />Gee, sorry fodder. Perhaps you should try a beginners forum if these concepts are beyond your understanding.</div>
    <div class="meta">Posted on 2002-03-20 19:40:00 by Ernie</div>
   </div>
   <div class="post" id="post-30099">
    <div class="subject"><a href="#post-30099">Image loader library Beta release</a></div>
    <div class="body">The Worrier King,<br /><br />  Yikes, what happened?  OK, here's what I can think of offhand:<br /><br />1) Your OS version doesn't support something I use (unlikely as you get it to work doing it manually)<br /><br />2) Somehow your path or file name or file extrnsion is incorrect. Note this routine used OleLoadPicturePath, which required the pathname (fully qualified path and file name) to open the file.<br /><br />3) something else....<br /><br /><br />In the something else catagory, please try this is you would. Stick these two lines into BitmapFromFile.ASM and recompile:<br /><br />MessageBoxW  PROTO  :DWORD, :DWORD, :DWORD, :DWORD<br /><br />invoke MessageBoxW, 0, pwszFileName, 0, 0<br /><br /><br />Put the 2nd statement just before OleLoadPicturePath. MessageBoxW is one of the very few Unicode supported API's that is valid in all Windows flavors, so it will display the pathname used by OleLoadPicturePath.<br /><br /><br />Please let me know if something significant shows up (engineering speak for a real bug of mine).  Also, you say this occures on 'some' images, I would appreciate a copy of any image that is not properly loaded.  Email works for that.</div>
    <div class="meta">Posted on 2002-03-20 19:53:46 by Ernie</div>
   </div>
   <div class="post" id="post-30101">
    <div class="subject"><a href="#post-30101">Image loader library Beta release</a></div>
    <div class="body"><div class="quote"><br />Worrier King,<br /><br />  Yikes, what happened?  OK, here's what I can think of offhand:<br /><br />3) something else....<br /><br />In the something else catagory, please try this is Please let me know if something significant shows up (engineering speak for a real bug of mine).  </div>FOUND IT!!!!  I think I sent you this before, in a thread in the COM forum. <br /><br /><strong>MultiByteToWideChar</strong> exhibits anti-social behavior when the destination buffer is exactly 2* the source buffer.  I guess it needs a couple extra bytes scratch space.  If you size the buffer the way you had it, the Unicode string may wind up with an extra bogus character at the end, causing the load to fail.<br /><br />If you change the beginning of <strong>BitmapFromFile</strong> to...<pre><code>LOCAL wszFileName&#91;MAX_PATH&#93;&#58;WORD, dwLength&#58;DWORD, pPicture&#58;DWORD, hNewBmp&#58;DWORD<br /><br />invoke CoInitialize, NULL<br />mov pPicture, NULL    ; NULL pointer for later use<br /><br />; first, we need the filename in Unicode<br />invoke MultiByteToWideChar, CP_ACP, 0, pszFileName, -1, ADDR wszFileName, MAX_PATH<br />; now we can create out picture object<br />invoke OleLoadPicturePath, ADDR wszFileName, NULL, NULL, NULL, ADDR IID_IPicture, ADDR pPicture<br /></code></pre>...all becomes right with the world.:alright:</div>
    <div class="meta">Posted on 2002-03-20 20:42:50 by The Worrier King</div>
   </div>
   <div class="post" id="post-30107">
    <div class="subject"><a href="#post-30107">Image loader library Beta release</a></div>
    <div class="body">Worrier,<br /><br />   Thanks, good report. <br /><br />  Gee, and I even go thru the trouble of defining the buffer size as 2X + 2, where X is the ASCII character count. And that takes a <br />lstrlen call to boot.<br /><br />  Now I wonder what happens if we pass in a string that's already MAX_PATH. Shoud we leave just 2*MAX_PATH for unicode? Or 2*MAX_PATH+2? +4?  <br /><br />  How about we just go for 3*MAX_PATH and be done with it.<br /><br />  Seriously... Using  a fixed string length is A) acceptable, since paths do have the MAX_PATH limitation, and are B) quicker to define as we don't have to search for the length.<br /><br />  OK, so say we define the buffer as twice MAX_PATH (or twice 260 for 520).  Should we add a few bytes anyway? I'd be temped to add them 'just in any case' to be safe and sure.<br /><br />  The other alternative is to use MultiByteToWideChar to compute the length of the unicode string IT wants, by passing it a zero as the last parameter (receive buffer size). <br /><br />   Since I'm a tightwad in allocating memory, I'm going to try this last way. <br /><br />  I reposted the code with this change. The sample paint.exe now looks for:<br /><pre><code><br />szFile      BYTE    &quot;C&#58;\masm32\Image\long long long long long &quot;<br />            BYTE    &quot;long long long long long long long long long &quot;<br />            BYTE    &quot;long long long long long long long long long &quot;<br />            BYTE    &quot;long long long long long long long long long &quot;<br />            BYTE    &quot;long long long long long long long long long &quot;<br />            BYTE    &quot;long long long long long name.bmp&quot;, 0<br /></code></pre><br /><br />This seems to be a MAX_PATH filename, it loads sucessfully for me.</div>
    <div class="meta">Posted on 2002-03-20 22:07:12 by Ernie</div>
   </div>
   <div class="post" id="post-30113">
    <div class="subject"><a href="#post-30113">Image loader library Beta release</a></div>
    <div class="body">============<br />Gee, sorry fodder. Perhaps you should try a beginners forum if these concepts are beyond your understanding.<br />============<br /><br />:grin: <br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-03-20 23:02:04 by hutch--</div>
   </div>
   <div class="post" id="post-30139">
    <div class="subject"><a href="#post-30139">Image loader library Beta release</a></div>
    <div class="body">why i cannot create a lib file that only contains one function that is  BitmapFromFile ( i know i still lack of  knowledge about com).<br /><br />There is an error when i linked it.  Are those functions have a close relationship so we cannot make it independently or i am wrong when i made a lib file.<br /><br />for example i i want to create image.lib with command<br /><br />ml /c /coff BitmapFromFile.asm<br /><br />lib /out:image.lib *.obj<br /><br />image.lib was created, but there was an error in linking <br /><br />i know the key is about com knowledge and my bailiwich is not reach there.</div>
    <div class="meta">Posted on 2002-03-21 06:34:19 by newbies</div>
   </div>
   <div class="post" id="post-30185">
    <div class="subject"><a href="#post-30185">Image loader library Beta release</a></div>
    <div class="body"><div class="quote"><br />Gee, sorry fodder. Perhaps you should try a beginners forum if these concepts are beyond your understanding. <br /></div><br />That comment was about as lame as using hardcoded paths. Unless,<br />of course, the COM method is lame and doesn't support relative paths.</div>
    <div class="meta">Posted on 2002-03-21 14:18:45 by f0dder</div>
   </div>
   <div class="post" id="post-30187">
    <div class="subject"><a href="#post-30187">Image loader library Beta release</a></div>
    <div class="body">Not only does it support relative paths, but it supports URLs ;)</div>
    <div class="meta">Posted on 2002-03-21 14:27:54 by iblis</div>
   </div>
   <div class="post" id="post-31033">
    <div class="subject"><a href="#post-31033">Image loader library Beta release</a></div>
    <div class="body">Very goo library ernie.<br /><br /><br />I found a bug - not exactly on the code uou made, but ...here goes.<br /><br /><br />I coded a small app with imagelib and put jpg on a window that is able to resize proportionally (i posted on the board)...<br /><br />When you resize the window the centered image (originally it was a bitmap), was resizing proportionally. I change the image for a jpg...and the api call (was invoke LoadBitmap).<br /><br />What is happenign is due to teh compression of the jpg the image that is resizing is strongly ugly (deformed)....<br /><br />I remember on this board that butch77 coded a routine able to resize images correctly (<a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=1513&amp;highlight=resize">http://www.asmcommunity.net/board/index.php?topic=1513&amp;highlight=resize</a>).<br /><br />Maybe the same routine coding can be applyed to your library in order to the image (jpg, bmp, gif or anyother), can be able to be resized based on their inner pixels.<br /><br />Regards<br /><br />Beyond2000!</div>
    <div class="meta">Posted on 2002-03-26 13:41:40 by Beyond2000!</div>
   </div>
   <div class="post" id="post-31089">
    <div class="subject"><a href="#post-31089">Image loader library Beta release</a></div>
    <div class="body">When an image is saved in a file, certain information about that image is also stored inside the file, so that the intrinsic width and height of the image is preserved.<br /><br />  The image lib I made takes advantage of these values and returns a bitmap representation that pixel for pixel matches this intrinsic stored width and height. Thus it contains all the information saved in whatever format the picture was in.<br /><br />  Any finite image, when zoomed to sufficient size will 'pixelate,' or turn to a mass of large color blobs. The information just isn't there anymore.<br /><br />Sure, you may have seen computers in the movies add this detail back in, but thats a movie. I'd personally like a James Bond flying back pack, but it just ain't possible.   ;-)</div>
    <div class="meta">Posted on 2002-03-26 19:36:48 by Ernie</div>
   </div>
   <div class="post" id="post-31103">
    <div class="subject"><a href="#post-31103">Image loader library Beta release</a></div>
    <div class="body">No, ernie....<br /><br /><br />I meant that due to the jpg compression the image is heavelly pixelated (scrambled)...using a bitmap it works just fine.<br /><br />Your code is awsome, all i try to say is that if use another code routines like dibresize (on the board) has...it can be applyed to jpg or gif, and make the pixelation quite good as if you use an bitmap.<br /><br />The pixelation of an jpf nto only is caused when you enlarge it, but when it is reduce too...<br /><br />The code that butch77 uses, seems to be applyed to jpg, gif, pic and bmp.<br /><br /><br />I on;ly saying thjat if you implement your code with the same routines, it would be a better version then it is already.<br /><br />You said that it was an alpha version, i'm just trying to help to improve your library.<br /><br />I'll try to use the butch77's routine and see if it can be applyed to your lib, and send it here to you analyse.<br /><br />It could be interesting.<br /><br />Regards,<br /><br />Beyond2000!</div>
    <div class="meta">Posted on 2002-03-26 23:10:55 by Beyond2000!</div>
   </div>
   <div class="post" id="post-31105">
    <div class="subject"><a href="#post-31105">Image loader library Beta release</a></div>
    <div class="body">The file was made in VB, (Not the dll that has the resize function), trying to convert the main VB executable to asm, can get more clues on resizing the mage without too many lost of data /quality.<br /><br /><br />here it is</div>
    <div class="meta">Posted on 2002-03-26 23:50:45 by Beyond2000!</div>
   </div>
   <div class="post" id="post-31260">
    <div class="subject"><a href="#post-31260">Image loader library Beta release</a></div>
    <div class="body">When you 'open' a picture file with this image library, you get back a handle to a bitmap.<br /><br />It is no longer a gif, jpg, wmf, icon, or whatever it started as.<br /><br />It is now a bitmap.<br /><br />Any methods you have in handeling bitmaps (such as butch77's code) may be used to manipulate these images.<br /><br />As far as adding a resize method to this lib, that falls outside the scope of the project. The goal is to open image files in many formats. <br /><br />It seems to do that quite nicely. I'll call it a day.</div>
    <div class="meta">Posted on 2002-03-27 22:24:05 by Ernie</div>
   </div>
   <div class="post" id="post-84071">
    <div class="subject"><a href="#post-84071">Image loader library Beta release</a></div>
    <div class="body"><div class="quote"><br />Is paint.exe supposed to do something?<br />It opens a blank window, and I don't see a picture.  But in the paint.asm file I see it calls your loadpicture routines in the WM_CREATE.<br />This is on Win XP. </div><br /><br />the same thing happens on my w2k box.<br />i unziped the image folder into my masm32 folder, is this correct?</div>
    <div class="meta">Posted on 2003-02-27 22:03:17 by Homer</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=4239&amp;page=1" style="">&laquo;</a><a href="../?id=4239&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="4239" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>