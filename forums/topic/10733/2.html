<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ints in PM - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10733" />
  <link rel="prev" href="../?id=10733&amp;page=1" />  <link rel="next" href="../?id=10733&amp;page=3" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=10733">ints in PM</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=10733&amp;page=1" style="">&laquo;</a><a href="../?id=10733&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="10733" /><input type="number" name="page" min="1" max="6" step="1" value="2" onchange="this.form.submit();" /><a href="../?id=10733&amp;page=3">&gt;</a><a href="../?id=10733&amp;page=6">&raquo;</a></form>   <div class="post" id="post-84433">
    <div class="subject"><a href="#post-84433">protected mode / OS (was ints in PM)</a></div>
    <div class="body"><div class="quote"><br />Yeah, there's nothing like OS coding... Just me, hardware, and an empty memory waiting to get filled with stuff...<br />A true definition of freedom :grin:</div><br />2nd me on that :alright:</div>
    <div class="meta">Posted on 2003-03-02 03:30:10 by scientica</div>
   </div>
   <div class="post" id="post-84439">
    <div class="subject"><a href="#post-84439">protected mode / OS (was ints in PM)</a></div>
    <div class="body"><div class="quote">A true FreeDom</div> <br /><br />Im agreed.:alright:</div>
    <div class="meta">Posted on 2003-03-02 03:54:36 by realvampire</div>
   </div>
   <div class="post" id="post-84506">
    <div class="subject"><a href="#post-84506">protected mode / OS (was ints in PM)</a></div>
    <div class="body">oh man! i just got multitasking running! *freedom* :)<br />i'll now go about the gui and the windowing system<br /><br />greets, hartyl</div>
    <div class="meta">Posted on 2003-03-02 10:51:59 by hartyl</div>
   </div>
   <div class="post" id="post-84583">
    <div class="subject"><a href="#post-84583">Tell or teach?</a></div>
    <div class="body">I try to use 32-Bit Operand at real mode, Xor eax,eax, its crashes. Then I try to use Mov eax,CR0 but...., I dont know its hexvalue. <br />Tell me or teach me:<br />1. Can I move CR0 to 16-Bit reg?<br />2. So  32-Bit reg only able to use only at Pmode, if Im not setting it it always crashes?<br />3. How to read immed BitField?<br />4. You need help? if so teach me first, teaching me or give me information or tutorial will be great investment for you.</div>
    <div class="meta">Posted on 2003-03-02 20:25:32 by realvampire</div>
   </div>
   <div class="post" id="post-84619">
    <div class="subject"><a href="#post-84619">real mode is only 16bit</a></div>
    <div class="body">When you are in real mode you are using the 8086 core of the processor. You cannot use 32bit instructions until you switch to protected mode.</div>
    <div class="meta">Posted on 2003-03-03 00:10:23 by mrgone</div>
   </div>
   <div class="post" id="post-84633">
    <div class="subject"><a href="#post-84633">How to do it ?</a></div>
    <div class="body">:confused:  The only clues I have is Use MSW AX. It mean Machine Status word (MASM doesn't support it), and then use SETE AX after I  adjust it.<br /><br /><pre><code><br />MSW AX   ; Get the status<br />xor al,1    ; Set to PMode<br />SETE AX   ; Change it<br /><br /></code></pre> <br /><br /><br />It wont work.... any Advice ? :confused:</div>
    <div class="meta">Posted on 2003-03-03 03:03:28 by realvampire</div>
   </div>
   <div class="post" id="post-84640">
    <div class="subject"><a href="#post-84640">protected mode / OS (was ints in PM)</a></div>
    <div class="body">why don't you try<br /><pre><code><br />mov eax,cr0<br />or al,1<br />mov cr0,eax<br /></code></pre><br />i could look up the equivalent bytes, but fasm does assemble this<br /><br />btw, can i rename this thread? &quot;ints in pm&quot; doesnt match anymore, what about &quot;protected mode&quot;?<br /><br />greets, hartyl</div>
    <div class="meta">Posted on 2003-03-03 03:47:57 by hartyl</div>
   </div>
   <div class="post" id="post-84685">
    <div class="subject"><a href="#post-84685">I agree</a></div>
    <div class="body">Rename this Thread. Mov eax,cr0 are unable at Real-mode. I boot my OS from diskette, If I able to switch to Pmode I can draw using VESA without bank Switching anymore. Yes Find the equivalent... Please.</div>
    <div class="meta">Posted on 2003-03-03 09:10:08 by realvampire</div>
   </div>
   <div class="post" id="post-84686">
    <div class="subject"><a href="#post-84686">Re: real mode is only 16bit</a></div>
    <div class="body"><div class="quote"><br />When you are in real mode you are using the 8086 core of the processor. You cannot use 32bit instructions until you switch to protected mode. </div><br />Well, actually you can use 32-bit operands in 16-bit PM, or realmode, using the operand-size prefix (66h).<br /><br /><div class="quote">I try to use 32-Bit Operand at real mode, Xor eax,eax, its crashes.</div><br />Are you sure you are doing it right?<br />NASM assembles xor eax,eax as 6631C0.<br /><br />-Stealth</div>
    <div class="meta">Posted on 2003-03-03 09:10:33 by Stealth</div>
   </div>
   <div class="post" id="post-84689">
    <div class="subject"><a href="#post-84689">huh?</a></div>
    <div class="body"><div class="quote">NASM assembles xor eax,eax as 6631C0.</div> <br /><br />Mine is 36C0 not 31C0. Could you tell me the Bitfield?.<br />can I write it 6636C0? ot I have to do it 6631C0 ?<br />:alright:  Thanks anyway I now know what is Prefix, do you have another prefix value ?<br /><br />Prefix: My Understanding.<br /><br />Prefix is 32-Bit Code substract with 0x500 and add it with 0x6600000?<br /><br />Am I right ?<br />:confused:</div>
    <div class="meta">Posted on 2003-03-03 09:17:20 by realvampire</div>
   </div>
   <div class="post" id="post-84705">
    <div class="subject"><a href="#post-84705">protected mode / OS (was ints in PM)</a></div>
    <div class="body">36C0?<br />I dunno... NDisasm doesn't recognize it as a valid instruction, and I can't find it from the Intel's reference, either.<br /><br />There's also the Address-size prefix (67h). You can use it for example, to code instructions that use 32-bit memory references in 16-bit modes (but in order for it to work, you must have big limits loaded in the descriptors), like mov word[0B8000h+eax],720h (assembled 67C78000800B0020).<br /><br />Other prefixes include: segment overrides (cs=2Eh,ds=3Eh,es=26h), rep (F3), etc.<br /><br />I haven't done so much manual coding lately, as NASM can assemble all instructions quite well, but as far as I remember, you just need to output the prefix(es) before the instruction, no need to substract anything.<br /><br />-Stealth</div>
    <div class="meta">Posted on 2003-03-03 09:53:58 by Stealth</div>
   </div>
   <div class="post" id="post-84711">
    <div class="subject"><a href="#post-84711">My Understanding</a></div>
    <div class="body">:eek:  Not recognized ? I dont know I dont have any 32-Bit Dis-Assembler.<br /><br />34C0:00110-100-11-000000<br />31C0:00110-001-11-000000<br /><br /><pre><code><br />Format of Bitfield = 5&#58;3&#58;2&#58;6<br />Size Bit is at Bit 8-10&#58; <br />mine is 100=4  2^4=16 16*2 =32-Bit<br />NASM is 001 = 1 2^1 =2  2*2=4-Bit.<br /><br /></code></pre><br /><br />seems you are right but Where is my mistakes? :confused:</div>
    <div class="meta">Posted on 2003-03-03 10:24:36 by realvampire</div>
   </div>
   <div class="post" id="post-85631">
    <div class="subject"><a href="#post-85631">vesa, i still don't get it</a></div>
    <div class="body">i am now able to create threads on the fly - but just create. so i went over to the gui. haha, vesa! i but i got farer than in the last try: i created a selector for the LFB, and it worked - partially. i played around with it for an hour and i wondered about some things:<br />- now i get more of the screen: the 3rd part of the screen from the top and from the bottom. i can't access the middle.<br />- when i draw a gradient (by increasing the color from one pixel to another) i can do it with blue and green. if i set red to 0x80 i can't put a pixel.<br />- if i use a mode with 24 bpp i still have to increase 4 bytes from one pixel to the other to have the correct result. but i'm bot sure about that, see #2 :)<br /><br />some code right here (i hope some1 reads this):<br /><pre><code><br />video_sel&#58;<br />; video segment descriptor<br />  dw 0xffff ;limit<br />  dw 0x0000 ;base<br />  db 0x00  ;base<br />  db 0x92 ;type<br />  db 0xcf ;attribs and 4 bits of limit<br />  db 0x00 ;base &#40;msb&#41;<br /><br />..&#91;snip!&#93;..<br /><br />;set up the vesa-gfx right here<br />  mov ax,0x4f00<br />  int 0x10 ;vesa present?<br />  cmp ax,0x004f<br />  jnz $ ;hang if failed<br /><br />  mov ax,0x4f01 ;get mode info<br />  mov cx,0x4115 ;800x600x16m<br />  push 0x0000<br />  pop es<br />  mov di,0xa000<br />  int 0x10 ;get mode info to es&#58;di<br />  cmp ax,0x004f<br />  jnz $<br /><br />  mov eax,&#91;es&#58;di+0x28&#93; ;physical address of linear video buffer<br />  mov &#91;video_sel+2&#93;,ax ;fill the gdt.base for video selector<br />  shr eax,16<br />  mov &#91;video_sel+4&#93;,al<br />  mov &#91;video_sel+7&#93;,ah<br /><br />  mov ax,0x4f02<br />  mov bx,0x4115<br />  int 0x10 ;set mode<br />  cmp ax,0x004f<br />  jnz $<br /><br />..&#91;snip!&#93;..<br /><br />  ;this is how i access the lfb<br />  mov ax,VIDEO_SEL<br />  mov gs,ax<br />  mov dword &#91;gs&#58;0&#93;,0x00ff00 ;put a green pixel on the top left of screen<br /></code></pre><br />everything just partially works...<br />the pm.com-file by <strong>Stealth</strong> worked perfectly...<br /><br />greets, hartyl</div>
    <div class="meta">Posted on 2003-03-07 14:33:32 by hartyl</div>
   </div>
   <div class="post" id="post-85672">
    <div class="subject"><a href="#post-85672">...</a></div>
    <div class="body">Hartyl what assembler you use?</div>
    <div class="meta">Posted on 2003-03-07 18:36:24 by realvampire</div>
   </div>
   <div class="post" id="post-85780">
    <div class="subject"><a href="#post-85780">protected mode / OS (was ints in PM)</a></div>
    <div class="body">fasm, why do you ask?<br /><br />ha! i noticed something new:<br />if i want to put a pixel into the black bar in the middle of the screen it appears exactly 256 pixel higher... as if the color-information for the middle is displayed on the top of the screen...<br />but the rest works fine: i can put a pixel where i want - and it lands there :)</div>
    <div class="meta">Posted on 2003-03-08 07:02:13 by hartyl</div>
   </div>
   <div class="post" id="post-85925">
    <div class="subject"><a href="#post-85925">Hi hartyl</a></div>
    <div class="body">Im courious, FASM able to use 32-Bit register at DOS program. <br />1. Is FASM have function like FarCAlloc? <br />2. Can it allocate memory above 1MB?<br />3. Is FASM have an IDE to compile a DOS program? (RAD Asm doesnot support DOS ).</div>
    <div class="meta">Posted on 2003-03-08 23:21:52 by realvampire</div>
   </div>
   <div class="post" id="post-86066">
    <div class="subject"><a href="#post-86066">protected mode / OS (was ints in PM)</a></div>
    <div class="body">@realvampire:<br />1. fasm is just a flat assembler - you can write functions like FarCAlloc, but the assembler itself doesn't have it afaik.<br />2. see #1<br />3. damnit, fasm is just an assembler :). i currently use the dos-editor and the fasm.exe for assembling. i start win98 in dos-mode and edit&amp;assemble with:<br /><pre><code><br />edit file.asm<br />fasm file.asm file.exe<br /></code></pre><br />btw, i already told you on February 23rd, 2003 @ 05:18 PM what assembler i use :)<br /><br />@all:<br />any answer to my weired screen-black-bar-problem?</div>
    <div class="meta">Posted on 2003-03-09 13:43:24 by hartyl</div>
   </div>
   <div class="post" id="post-86122">
    <div class="subject"><a href="#post-86122">Hi hartyl</a></div>
    <div class="body">Use a Buffer. And then Bitblt, it's more easy than calculate it one-by one. Hartyl, do you have a code for allocate mem above 1MB ?:cool:</div>
    <div class="meta">Posted on 2003-03-09 19:19:23 by realvampire</div>
   </div>
   <div class="post" id="post-86286">
    <div class="subject"><a href="#post-86286">protected mode / OS (was ints in PM)</a></div>
    <div class="body">@realvampire:<br />i think you understood something wrong... i put a pixel in the middle of the screen, but it appears 256px above the calculated destination - but that's only in the middle of the screen. above and below it works correctly.<br />and: what the hell are you doing?! are you programming a program in windows? write an OS?<br />in the first case: use the windows-api: LocalAlloc / GlobalAlloc<br />in the other case: hey! you're writing an os, nothing is in the memory except your code, take what you need.</div>
    <div class="meta">Posted on 2003-03-10 13:07:57 by hartyl</div>
   </div>
   <div class="post" id="post-86373">
    <div class="subject"><a href="#post-86373">protected mode / OS (was ints in PM)</a></div>
    <div class="body"><pre><code><br />in the other case&#58; hey! you're writing an os, nothing is in the memory except your code, take what you need.<br /></code></pre><br /><br />yep. Im studying Allocate Mem via Port (0c0~0x1F) but Im found difficulties. I dont have any example. Do you have one?. By accessing DMA even we're at real mode we can do anything (as I understand).</div>
    <div class="meta">Posted on 2003-03-10 21:02:03 by realvampire</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=10733&amp;page=1" style="">&laquo;</a><a href="../?id=10733&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="10733" /><input type="number" name="page" min="1" max="6" step="1" value="2" onchange="this.form.submit();" /><a href="../?id=10733&amp;page=3">&gt;</a><a href="../?id=10733&amp;page=6">&raquo;</a></form>  </div>
 </body>
</html>