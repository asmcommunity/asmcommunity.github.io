<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>The Web Browser Saga Continues... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=812" />
  <link rel="prev" href="../?id=812&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=116">Windows</a> &raquo; <a href="../?id=812">The Web Browser Saga Continues...</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=812&amp;page=1" style="">&laquo;</a><a href="../?id=812&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="812" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-5366">
    <div class="subject"><a href="#post-5366">The Web Browser Saga Continues...</a></div>
    <div class="body">Xtreme,<br /><br />the new exe still doesn't work under Win NT 4.0. Shows a white screen. Most probably this will be error 0x80004005 (E_FAIL) after Navigate.<br /><br />Will look after it later. Currently I'm busy recovering from a HD crash.<br /><br />japheth</div>
    <div class="meta">Posted on 2001-08-30 05:17:52 by japheth</div>
   </div>
   <div class="post" id="post-5408">
    <div class="subject"><a href="#post-5408">The Web Browser Saga Continues...</a></div>
    <div class="body">This is what it looks like on Win2k<br /><br />At least something comes up this time :) Before it didn't do that :)</div>
    <div class="meta">Posted on 2001-08-30 14:16:52 by Kenny</div>
   </div>
   <div class="post" id="post-5409">
    <div class="subject"><a href="#post-5409">The Web Browser Saga Continues...</a></div>
    <div class="body">Kenny,<br /><br /> Thats it!<br /> The button just displays an Alert box.<br /> (I was working on the ShowMessage handler at the time).<br /><br /><br />Japheth / Everyone, <br /><br /> Last night, I revomed the GETOBJECTPOINTER macro and mixed<br /> the code in with the QueryInterface. Then started optimizing<br /> its code. Can't we remove the IIUnknown-like structs and make<br /> Objects members dwords? Like so:<br /><br /><pre><code><br />        Object struct<br />            iUnknown dd ?<br />            iBase0 dd ?<br />            iOleWindow dd ?<br />            iBase1 dd ?<br /></code></pre><br /><br /> <br />The New QueryInterface Proc:<br /><br /><pre><code><br />QueryInterface proc uses ebx ecx pif&#58;DWORD, riid&#58;DWORD, ppv&#58;DWORD<br /><br /><br />    LOCAL iface&#58;DWORD<br /><br />    invoke IsEqualGUID, &#91;riid&#93;, addr IID_IUnknown<br />    test eax,eax<br />    mov iface, 1<br />    jnz @F<br /><br />    invoke IsEqualGUID, &#91;riid&#93;, addr IID_IOleClientSite<br />    test eax, eax<br />    mov iface, 2<br />    jnz @F<br /><br />    invoke IsEqualGUID, &#91;riid&#93;, addr IID_IDocHostUIHandler<br />    test eax, eax<br />    mov iface, 3<br />    jnz @F<br /><br />    invoke IsEqualGUID, &#91;riid&#93;, addr IID_IDocHostShowUI<br />    test eax, eax<br />    mov iface, 4<br />    jnz @F<br /><br />    invoke IsEqualGUID, &#91;riid&#93;, addr IID_IOleInPlaceSite<br />    test eax, eax<br />    mov iface, 5<br />    jnz @F<br /><br />    invoke IsEqualGUID, &#91;riid&#93;, addr IID_IDispatch<br />    test eax, eax<br />    mov iface, 6<br />    jnz @F<br /><br />    invoke IsEqualGUID, &#91;riid&#93;, addr DIID_DWebBrowserEvents2<br />    test eax, eax<br />    mov iface, 6<br />    jnz @F<br /><br />    jmp @Error<br />    <br />@@&#58;<br /><br />    mov eax, pif<br />    sub eax, &#91;eax + 4&#93;<br /><br />    .IF iface == 1<br /><br />            mov ecx, &#40;Object ptr &#91;eax&#93;&#41;.iUnknown<br />            lea eax, &#40;Object ptr &#91;eax&#93;&#41;.iUnknown<br />            mov ebx, &#91;ppv&#93;<br />            mov dword ptr &#91;ebx&#93;, eax<br />            invoke  &#40;IIUnknownVtbl ptr &#91;ecx&#93;&#41;.AddRef, &#91;pif&#93;<br /><br />    .ELSEIF iface == 2<br /><br />            mov ecx, &#40;Object ptr &#91;eax&#93;&#41;.iOleClientSite<br />            lea eax, &#40;Object ptr &#91;eax&#93;&#41;.iOleClientSite<br />            mov ebx, &#91;ppv&#93;<br />            mov dword ptr &#91;ebx&#93;, eax<br />            invoke  &#40;IIOleClientSiteVtbl ptr &#91;ecx&#93;&#41;.AddRef, &#91;pif&#93;<br /><br />    .ELSEIF iface == 3                 <br /><br />            mov ecx, &#40;Object ptr &#91;eax&#93;&#41;.iDocHostUIHandler<br />            lea eax, &#40;Object ptr &#91;eax&#93;&#41;.iDocHostUIHandler<br />            mov ebx, &#91;ppv&#93;<br />            mov dword ptr &#91;ebx&#93;, eax<br />            invoke  &#40;IIDocHostUIHandlerVtbl ptr &#91;ecx&#93;&#41;.AddRef, &#91;pif&#93;<br /><br />    .ELSEIF iface == 4<br /><br />            mov ecx, &#40;Object ptr &#91;eax&#93;&#41;.iDocHostShowUI<br />            lea eax, &#40;Object ptr &#91;eax&#93;&#41;.iDocHostShowUI<br />            mov ebx, &#91;ppv&#93;<br />            mov dword ptr &#91;ebx&#93;, eax<br />            invoke  &#40;IIDocHostShowUIVtbl ptr &#91;ecx&#93;&#41;.AddRef, &#91;pif&#93;<br /><br />    .ELSEIF iface == 5<br /><br />            mov ecx, &#40;Object ptr &#91;eax&#93;&#41;.iOleInPlaceSite<br />            lea eax, &#40;Object ptr &#91;eax&#93;&#41;.iOleInPlaceSite<br />            mov ebx, &#91;ppv&#93;<br />            mov dword ptr &#91;ebx&#93;, eax<br />            invoke  &#40;IIOleInPlaceSiteVtbl ptr &#91;ecx&#93;&#41;.AddRef, &#91;pif&#93;<br /><br />    .ELSEIF iface == 6<br /><br />            mov ecx, &#40;Object ptr &#91;eax&#93;&#41;.iDispatch<br />            lea eax, &#40;Object ptr &#91;eax&#93;&#41;.iDispatch<br />            mov ebx, &#91;ppv&#93;<br />            mov dword ptr &#91;ebx&#93;, eax<br />            invoke  &#40;IIDispatchVtbl ptr &#91;ecx&#93;&#41;.AddRef, &#91;pif&#93;<br /><br />    .ENDIF<br /><br />    mov eax, S_OK<br />    ret<br /><br />@Error&#58;<br />    mov     eax, &#91;ppv&#93;<br />    mov     dword ptr &#91;eax&#93;, 0<br />    mov     eax, E_NOINTERFACE<br />    ret<br /><br />QueryInterface endp<br /></code></pre><br /><br />Thanks,<br />Xtreme</div>
    <div class="meta">Posted on 2001-08-30 14:19:43 by Xtreme</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=812&amp;page=1" style="">&laquo;</a><a href="../?id=812&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="812" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>