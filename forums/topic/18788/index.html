<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Copy and Paste in Superclassed Editbox - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=18788" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=18788">Copy and Paste in Superclassed Editbox</a></p>
   <div class="post" id="post-145446">
    <div class="subject"><a href="#post-145446">Copy and Paste in Superclassed Editbox</a></div>
    <div class="body">i superclassed an editbox,so that i only can enter a-f A-F 0-9 and some other stuff...<br /><br />now COPY and PASTE (CTRL+C,CTRL+V) doesnt work. see also Iczelions tut's (20,22), there also CTRL+C doesnt work.<br /><br />here is some code:<br /><pre><code><br />WndProc proc handle1&#58;DWORD,uMsg1&#58;DWORD,wParam1&#58;DWORD,lParam1&#58;DWORD                         		<br />	.IF uMsg1 == WM_CHAR<br />		mov eax,wParam1<br />		mov edx,_len<br />		mov edi,currentDialog		<br />		.IF &#40;al&gt;=&quot;0&quot; &amp;&amp; al&lt;=&quot;9&quot;&#41; || &#40;al&gt;=&quot;a&quot; &amp;&amp; al&lt;=&quot;f&quot;&#41; || &#40;al&gt;=&quot;A&quot; &amp;&amp; al&lt;=&quot;F&quot;&#41; || al==&quot;*&quot; || al==&quot;,&quot; || al==VK_BACK<br />			.IF &#40;byte ptr&#91;edi+edx-1&#93;!=22h&#41; &amp;&amp; &#40;byte ptr&#91;edi+edx-1&#93;!=&quot;'&quot;&#41;<br />				.IF al&gt;=&quot;a&quot; &amp;&amp; al&lt;=&quot;f&quot;<br />					sub al,20h				<br />				.ENDIF<br />			.ENDIF			<br />			mov wParam1,eax				<br />			jmp @sendkey<br />		.ELSEIF &#40;al==22h || al==&quot;'&quot;&#41; &amp;&amp; _len==0<br />			jmp @sendkey<br />		.ELSEIF &#40;al==22h || al==&quot;'&quot;&#41; ; &amp;&amp; &#40;byte ptr&#91;edi+edx-1&#93;==&quot;,&quot; || byte ptr&#91;edi+edx-2&#93;==22h ||byte ptr&#91;edi+edx-2&#93;==&quot;'&quot; &#41;<br />			jmp @sendkey<br />		.ELSEIF &#40;al&gt;=0 &amp;&amp; al&lt;=255&#41; &amp;&amp; &#40;byte ptr&#91;edi+edx-1&#93;==22h || byte ptr&#91;edi+edx-1&#93;==&quot;'&quot;&#41; <br />			jmp @sendkey<br />		.ENDIF	<br />	.ELSE	<br />		@sendkey&#58;	<br />		invoke CallWindowProc,lpfnWndProc,handle1,uMsg1,wParam1,lParam1<br />	.ENDIF	<br />	ret<br />WndProc endp<br /></code></pre></div>
    <div class="meta">Posted on 2004-07-05 12:20:24 by diablo2oo2</div>
   </div>
   <div class="post" id="post-145528">
    <div class="subject"><a href="#post-145528">Copy and Paste in Superclassed Editbox</a></div>
    <div class="body">It just needs some debugging.  Sooo thats what we are going to do...<br />Lets start at the beginning: Minimal superclass of the edit control<br /><br />Minimum superclass<br /><pre><code><br />EditWndProc PROC hEdit&#58;DWORD,uMsg&#58;DWORD,wParam&#58;DWORD,lParam&#58;DWORD<br />	invoke CallWindowProc,OldWndProc,hEdit,uMsg,wParam,lParam<br />	ret<br />EditWndProc endp<br /></code></pre><br /><br />Compile and run.  Control is superclassed and cut-and-paste still work.<br />Thus subclassing is not the issue.  The problem *has* to be in the way<br />the routine is coded.  Lets expand on this a little.<br /><br />Expand<br /><pre><code><br />EditWndProc PROC hEdit&#58;DWORD,uMsg&#58;DWORD,wParam&#58;DWORD,lParam&#58;DWORD<br />	.if uMsg==WM_CHAR<br />		mov eax,wParam<br />		.if &#40;al&gt;=&quot;0&quot; &amp;&amp; al&lt;=&quot;9&quot;&#41; || &#40;al&gt;=&quot;A&quot; &amp;&amp; al&lt;=&quot;F&quot;&#41; || &#40;al&gt;=&quot;a&quot; &amp;&amp; al&lt;=&quot;f&quot;&#41; || al==VK_BACK<br />			.if al&gt;=&quot;a&quot; &amp;&amp; al&lt;=&quot;f&quot;<br />				sub al,20h<br />				invoke CallWindowProc,OldWndProc,hEdit,uMsg,eax,lParam<br />				ret<br />			.endif<br />		.endif<br />	.endif<br /><br />	invoke CallWindowProc,OldWndProc,hEdit,uMsg,wParam,lParam<br />	ret<br />EditWndProc endp<br /></code></pre><br /><br />Ok so hows it doing now?  Getting better actually.  It does no filtering on the<br />characters yet, but any lower case charater from a-f is changed to A-F and we<br />can still cut-and-paste.  No problems yet.  Lets add some filtering...<br /><br /><pre><code><br />EditWndProc PROC hEdit&#58;DWORD,uMsg&#58;DWORD,wParam&#58;DWORD,lParam&#58;DWORD<br />	.if uMsg==WM_CHAR<br />		mov eax,wParam<br />		.if &#40;al&gt;=&quot;0&quot; &amp;&amp; al&lt;=&quot;9&quot;&#41; || &#40;al&gt;=&quot;A&quot; &amp;&amp; al&lt;=&quot;F&quot;&#41; || &#40;al&gt;=&quot;a&quot; &amp;&amp; al&lt;=&quot;f&quot;&#41; || al==VK_BACK<br />			.if al&gt;=&quot;a&quot; &amp;&amp; al&lt;=&quot;f&quot;<br />				sub al,20h<br />				invoke CallWindowProc,OldWndProc,hEdit,uMsg,eax,lParam<br />				ret<br />			.endif<br />		.else<br />			xor eax, eax<br />			ret<br />		.endif<br />	.endif<br /><br />	invoke CallWindowProc,OldWndProc,hEdit,uMsg,wParam,lParam<br />	ret<br />EditWndProc endp<br /></code></pre><br /><br />Now?  Well now it filters out all non hex characters ... OOPS, cut and paste broke.<br />So the whole issue lies with the character filter... Lets check the docs :alright:<br /><br /><div class="quote"><br />WM_CHAR<br /><br /><strong>Remarks</strong><br />Because there is not necessarily a one-to-one correspondence between keys pressed<br />and character messages generated, the information in the high-order word of the lKeyData<br />parameter is generally not useful to applications. The information in the high-order word<br />applies only to the most recent WM_KEYDOWN message that precedes the posting of the<br />WM_CHAR message.<br /></div><br /><br />The ultimate problem with this is the phrase &quot;not necessarily a one-to-one correspondence<br />between keys pressed&quot;.  So when you hit the control key WM_CHAR is sent and the message<br />is eaten by the ret so the control never sees it.  We need to check for this before hand so<br />the control will process it as normal.<br /><br />Final<br /><pre><code><br />EditWndProc PROC hEdit&#58;DWORD,uMsg&#58;DWORD,wParam&#58;DWORD,lParam&#58;DWORD<br />	.if uMsg==WM_CHAR<br />		invoke	GetKeyState, VK_CONTROL<br />		cmp		eax, 0<br />		jne		ContinueProcessingKeys<br /><br />		mov eax,wParam<br />		.if &#40;al&gt;=&quot;0&quot; &amp;&amp; al&lt;=&quot;9&quot;&#41; || &#40;al&gt;=&quot;A&quot; &amp;&amp; al&lt;=&quot;F&quot;&#41; || &#40;al&gt;=&quot;a&quot; &amp;&amp; al&lt;=&quot;f&quot;&#41; || al==VK_BACK<br />			.if al&gt;=&quot;a&quot; &amp;&amp; al&lt;=&quot;f&quot;<br />				sub al,20h<br />				invoke CallWindowProc,OldWndProc,hEdit,uMsg,eax,lParam<br />				ret<br />			.endif<br />		.else<br />			mov eax, 0<br />			ret<br />		.endif<br />	.endif<br /><br />	ContinueProcessingKeys&#58;<br />	invoke CallWindowProc,OldWndProc,hEdit,uMsg,wParam,lParam<br />	ret<br />EditWndProc endp<br /></code></pre><br /><br />Now this code works properly.  I am sure the same technique will also work for your routine...<br />Cheers<br /><br />Graebel</div>
    <div class="meta">Posted on 2004-07-06 21:35:42 by Graebel</div>
   </div>
   <div class="post" id="post-145568">
    <div class="subject"><a href="#post-145568">Copy and Paste in Superclassed Editbox</a></div>
    <div class="body">ok it so simple after reading your post. thank you very much.<br /><br />ps: i already tryed GetKeyState, but i used it wrong.</div>
    <div class="meta">Posted on 2004-07-07 11:02:01 by diablo2oo2</div>
   </div>
  </div>
 </body>
</html>