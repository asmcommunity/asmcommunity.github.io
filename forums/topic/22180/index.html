<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>I need readkey/getch function's code for hla - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=22180" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=22180">I need readkey/getch function's code for hla</a></p>
   <div class="post" id="post-166892">
    <div class="subject"><a href="#post-166892">I need readkey/getch function's code for hla</a></div>
    <div class="body">Dear everyone,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  I can&#39;t find any function that similiar to readkey in Pascal or getch() in C in hla standard library. Is there somebody know the source code for these functions.<br /><br />thanks.</div>
    <div class="meta">Posted on 2005-10-13 23:20:30 by eru_dio</div>
   </div>
   <div class="post" id="post-166922">
    <div class="subject"><a href="#post-166922">Re: I need readkey/getch function's code for hla</a></div>
    <div class="body">If you have a look in the MASM32 library reference, that comes with the masm32 package,or the high level help,that<br />also comes with the package, you might find something in there to help you.</div>
    <div class="meta">Posted on 2005-10-15 06:28:04 by rags</div>
   </div>
   <div class="post" id="post-166931">
    <div class="subject"><a href="#post-166931">Re: I need readkey/getch function's code for hla</a></div>
    <div class="body"><div class="quote"><br />Dear everyone,<br />             I can&#39;t find any function that similiar to readkey in Pascal or getch() in C in hla standard library. Is there somebody know the source code for these functions.<br /><br />thanks.<br /></div><br /><br />From the win32console library in the HLA examples code:<br /><br /><div class="quote"><br />unit consoleUnit;<br />#include( &quot;stdin.hhf&quot; );<br />#include( &quot;win32cons.hhf&quot; );<br /><br /><br /><br /><br /><br />// peekInput-<br />//<br />//	Checks for an input event (mouse event, keyboard event, resize event).<br />//	Returns zero in EAX if no events or error, returns one if it successfully<br />//	peeked at an event.<br /><br />procedure win32cons.peekInput( var input:win.INPUT_RECORD ); @nodisplay;<br />var<br />	numEvents:	dword;<br />	<br />begin peekInput;<br /><br />	push( ebx );<br />	push( ecx );<br />	push( edx );<br />	push( esi );<br />	push( edi );<br />	<br />	win.PeekConsoleInput( numEvents, 1, input, stdin.handle() );<br />	if( eax ) then<br />		<br />		mov( numEvents, eax );<br />		<br />	endif;<br />	pop( edi );<br />	pop( esi );<br />	pop( edx );<br />	pop( ecx );<br />	pop( ebx );<br />		<br />end peekInput;<br /><br /><br /><br /><br />// readInput-<br />//<br />//	Waits for an input event (mouse event, keyboard event, resize event).<br /><br />procedure win32cons.readInput( var input:win.INPUT_RECORD ); @nodisplay;<br />var<br />	numEvents:	dword;<br />	<br />begin readInput;<br /><br />	push( ebx );<br />	push( ecx );<br />	push( edx );<br />	push( esi );<br />	push( edi );<br />	<br />	win.ReadConsoleInput( numEvents, 1, input, stdin.handle() );<br />	if( eax ) then<br />		<br />		mov( numEvents, eax );<br />		<br />	endif;<br />	pop( edi );<br />	pop( esi );<br />	pop( edx );<br />	pop( ecx );<br />	pop( ebx );<br />		<br />end readInput;<br /><br /><br />// flushInput-<br />//<br />//	Flushes all the console input events from the internal buffer.<br /><br />procedure win32cons.flushInput; @nodisplay; @noframe;<br />begin flushInput;<br /><br />	pushad();<br />	win.FlushConsoleInputBuffer( stdin.handle() );<br />	popad();<br />	ret();<br />	<br />end flushInput;<br /><br /><br /><br /><br />end consoleUnit;<br /></div><br /><br />Cheers,<br />Randy Hyde<br /></div>
    <div class="meta">Posted on 2005-10-15 15:11:39 by rhyde</div>
   </div>
   <div class="post" id="post-167289">
    <div class="subject"><a href="#post-167289">Re: I need readkey/getch function's code for hla</a></div>
    <div class="body">Thank you for the helps. I am not familiar with win32 API but I&#39;m trying hard here. With the functions that Randy gave, I <br /><br />made (not-perfect) readkey-like program. But, when I made it with #include(w.hhf), there is <br /><br />a little problem. Also I have a few technical question. First, here is the program&#39;s code with including win32cons.hhf :<br /><br />// this program will read a keyboard input character like readkey<br />program ha;<br />#include(&quot;win32cons.hhf&quot;)<br />#include(&quot;stdlib.hhf&quot;)<br />static<br />	c: win.INPUT_RECORD;<br />	<br />begin ha;<br />	// I want to make sure that when I press ctrl+c, the process won&#39;t break out<br />	win.SetConsoleMode( win.ENABLE_ECHO_INPUT	+ win.ENABLE_LINE_INPUT, stdin.handle() );<br /><br />	// It will keep readInput until we hit keyboard and as long as the key is not shift/ctrl/alt/capslock/numslock/<br /><br />scrolllock.<br />	stdout.put(&quot;Input char = &quot;);<br />	repeat<br />		win32cons.readInput(c);<br />	until ( c.Event.KeyEvent.bKeyDown = 1&nbsp; &amp;&amp; !(c.Event.KeyEvent.wVirtualKeyCode = $10 || c.Event.KeyEvent.<br /><br />wVirtualKeyCode = $11 || c.Event.KeyEvent.wVirtualKeyCode = $12 || c.Event.KeyEvent.wVirtualKeyCode = $14 || c.Event.<br /><br />KeyEvent.wVirtualKeyCode = $90 || c.Event.KeyEvent.wVirtualKeyCode = $91) );<br /><br />	// Get input char into al and print the input char to console<br />	mov(c.Event.KeyEvent.AsciiChar,al);<br />	stdout.put((type char al),nl);<br />end ha;<br /><br />The first question:<br />- What is the meaning of ENABLE_LINE_INPUT, ENABLE_ECHO_INPUT, ENABLE_WINDOW_INPUT in the inputmode of SetConsoleMode ?<br /><br />Next, the code with including w.hhf :<br /><br />program hb;<br />#include(&quot;w.hhf&quot;)<br />#include(&quot;stdlib.hhf&quot;)<br /><br />static<br />	c: w.INPUT_RECORD;<br /><br />procedure readInput2( var input:w.INPUT_RECORD ); @nodisplay;<br />var<br />&nbsp;  numEvents:&nbsp;  dword;<br />&nbsp;  <br />begin readInput2;<br /><br />&nbsp;  push( ebx );<br />&nbsp;  push( ecx );<br />&nbsp;  push( edx );<br />&nbsp;  push( esi );<br />&nbsp;  push( edi );<br />&nbsp;  <br />&nbsp;  w.ReadConsoleInput( stdin.handle(),input,1,numEvents );<br />&nbsp;  <br />&nbsp;  if( eax==1 ) then&nbsp; <br />&nbsp; &nbsp; &nbsp; mov( numEvents, eax );&nbsp; &nbsp; &nbsp; <br />&nbsp;  endif;<br />&nbsp;  <br />&nbsp;  pop( edi );<br />&nbsp;  pop( esi );<br />&nbsp;  pop( edx );<br />&nbsp;  pop( ecx );<br />&nbsp;  pop( ebx );<br />&nbsp; &nbsp; &nbsp; <br />end readInput2;<br /><br />begin hb;<br />	w.SetConsoleMode( stdin.handle(), w.ENABLE_ECHO_INPUT + w.ENABLE_LINE_INPUT );<br />	stdout.put(&quot;Input char = &quot;);<br />	repeat<br />		readInput2(c);<br />	until ( c.Event.KeyEvent.bKeyDown = 1&nbsp; &amp;&amp; !(c.Event.KeyEvent.wVirtualKeyCode = $10 || c.Event.KeyEvent.<br /><br />wVirtualKeyCode = $11 || c.Event.KeyEvent.wVirtualKeyCode = $12 || c.Event.KeyEvent.wVirtualKeyCode = $14 || c.Event.<br /><br />KeyEvent.wVirtualKeyCode = $90 || c.Event.KeyEvent.wVirtualKeyCode = $91) );<br /><br />	mov(c.Event.KeyEvent._uChar.AsciiChar,al);<br />	stdout.put( (type char al),nl);<br />end hb;<br /><br />The resulting program will keep running forever. Then I tried to investigate it. I found out there is something weird about <br /><br />w.INPUT_RECORD, the &#39;c.Event.KeyEvent.bKeyDown&#39; was not returning the boolean value, instead it returned the numeric values <br /><br />like 1_D512,0_D512, 1_000. Also the &#39;c.Event.KeyEvent._uChar.AsciiChar&#39; is supposed to be returning the AsciiChar, but it <br /><br />returned the virtual key scan-code instead.<br /><br />When I used this after statement until(...):<br />	stdout.put<br />	( <br />		nl <br />		&quot;Event=&quot;, c.EventType, nl,<br />		&quot;KeyDown=&quot;, c.Event.KeyEvent.bKeyDown, nl,<br />		&quot;Repeat =&quot;, c.Event.KeyEvent.wRepeatCount, nl<br />		&quot;KeyCode=&quot;, c.Event.KeyEvent.wVirtualKeyCode, nl <br />		&quot;ScanCode=&quot;, c.Event.KeyEvent.wVirtualScanCode, nl,<br />		&quot;ASCIIcode=&quot;, (type byte c.Event.KeyEvent._uChar.AsciiChar), nl,<br />		&quot;CtrlState=&quot;, c.Event.KeyEvent.dwControlKeyState, nl,<br />		nl <br />	);<br />The result was:<br />event=0001<br />keydown=0000_D512<br />repeat=0000<br />keycode=0001<br />scancode=000D<br />ascii=1C<br />ctrlstate=0020_000D<br /><br />I checked the KEY_EVENT_RECORD in w.hhf, then I found out that the field&#39;s type of bKeyDown is not same to the same field of <br /><br />KEY_EVENT_RECORD in win32cons.hhf. The type is dword, meanwhile win32cons.hhf&#39;s uses boolean[4], and also it doesn&#39;t have a <br /><br />padding before it. I want to know if this a bug in w.hhf ?<br /><br />Why we must put a padding before the bKeyDown ?<br /><br />I wonder which is right type of dwControlKeyState&#39;s field ?. Is it dword or word. The win32 API manual said it&#39;s dword but <br /><br />the win32cons.hhf says it&#39;s word.<br /><br />Once again thanks for the help (sorry for the bad english).</div>
    <div class="meta">Posted on 2005-10-27 22:09:36 by eru_dio</div>
   </div>
  </div>
 </body>
</html>