<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>First Win 32 program - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17286" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=17286">First Win 32 program</a></p>
   <div class="post" id="post-133961">
    <div class="subject"><a href="#post-133961">First Win 32 program</a></div>
    <div class="body">This is my first attempt at learning to write a Win 32 program.<br />It is a slight modification of one in the MASM 32 package.<br /><br />I looked thru the tuts but I could find out what I need.<br /><br />I want this to open up fullscreen when I execute it.<br />There is probably some code that specifies window size. <br /><br />I am making it to send to my daughter.<br /><br />Thanks.<br /><br /><br /><br />.386<br />.model flat,stdcall<br />option casemap:none<br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\gdi32.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\gdi32.lib<br /><br />WinMain proto :DWORD,:DWORD,:DWORD,:DWORD<br />IDB_MAIN   equ 1<br /><br />.data<br />ClassName db &quot;SimpleWin32ASMBitmapClass&quot;,0<br />AppName  db &quot;With Love from Dad (His first Windows Program)&quot;,0<br /><br />.data?<br />hInstance HINSTANCE ?<br />CommandLine LPSTR ?<br />hBitmap dd ?<br /><br />.code<br />start:<br />	invoke GetModuleHandle, NULL<br />	mov    hInstance,eax<br />	invoke GetCommandLine<br />	mov    CommandLine,eax<br />	invoke WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT<br />	invoke ExitProcess,eax<br /><br />WinMain proc hInst:HINSTANCE,hPrevInst:HINSTANCE,CmdLine:LPSTR,CmdShow:DWORD<br />	LOCAL wc:WNDCLASSEX<br />	LOCAL msg:MSG<br />	LOCAL hwnd:HWND<br />	mov   wc.cbSize,SIZEOF WNDCLASSEX<br />	mov   wc.style, CS_HREDRAW or CS_VREDRAW<br />	mov   wc.lpfnWndProc, OFFSET WndProc<br />	mov   wc.cbClsExtra,NULL<br />	mov   wc.cbWndExtra,NULL<br />	push  hInstance<br />	pop   wc.hInstance<br />	mov   wc.hbrBackground,COLOR_WINDOW+1<br />	mov   wc.lpszMenuName,NULL<br />	mov   wc.lpszClassName,OFFSET ClassName<br />	invoke LoadIcon,NULL,IDI_APPLICATION<br />	mov   wc.hIcon,eax<br />	mov   wc.hIconSm,eax<br />	invoke LoadCursor,NULL,IDC_ARROW<br />	mov   wc.hCursor,eax<br />	invoke RegisterClassEx, addr wc<br />	INVOKE CreateWindowEx,NULL,ADDR ClassName,ADDR AppName,\<br />           WS_OVERLAPPEDWINDOW,CW_USEDEFAULT,\<br />           CW_USEDEFAULT,CW_USEDEFAULT,CW_USEDEFAULT,NULL,NULL,\<br />           hInst,NULL<br />	mov   hwnd,eax<br />	invoke ShowWindow, hwnd,SW_SHOWNORMAL<br />	invoke UpdateWindow, hwnd<br />	.while TRUE<br />		invoke GetMessage, ADDR msg,NULL,0,0<br />		.break .if (!eax)<br />		invoke TranslateMessage, ADDR msg<br />		invoke DispatchMessage, ADDR msg<br />	.endw<br />	mov     eax,msg.wParam<br />	ret<br />WinMain endp<br /><br />WndProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />   LOCAL ps:PAINTSTRUCT<br />   LOCAL hdc:HDC<br />   LOCAL hMemDC:HDC<br />   LOCAL rect:RECT<br />   .if uMsg==WM_CREATE<br />      invoke LoadBitmap,hInstance,IDB_MAIN<br />      mov hBitmap,eax<br />   .elseif uMsg==WM_PAINT<br />      invoke BeginPaint,hWnd,addr ps<br />      mov hdc,eax<br />      invoke CreateCompatibleDC,hdc<br />      mov hMemDC,eax<br />      invoke SelectObject,hMemDC,hBitmap<br />      invoke GetClientRect,hWnd,addr rect<br />      invoke BitBlt,hdc,0,0,rect.right,rect.bottom,hMemDC,0,0,SRCCOPY<br />      invoke DeleteDC,hMemDC<br />      invoke EndPaint,hWnd,addr ps<br />	.elseif uMsg==WM_DESTROY<br />      invoke DeleteObject,hBitmap<br />		invoke PostQuitMessage,NULL<br />	.ELSE<br />		invoke DefWindowProc,hWnd,uMsg,wParam,lParam		<br />		ret<br />	.ENDIF<br />	xor eax,eax<br />	ret<br />WndProc endp<br />end start</div>
    <div class="meta">Posted on 2004-02-17 20:29:09 by skywalker</div>
   </div>
   <div class="post" id="post-133983">
    <div class="subject"><a href="#post-133983">First Win 32 program</a></div>
    <div class="body">you specify the window size on the call to CreateWindowEx - look at MSDN, PlatformSDK or win32.hlp for more information.<br /><br />To create a &quot;fullscreen&quot; window, do GetWindowRect() on the HWND obtained with GetDesktopWindow(), and use the values in the RECT in the call to CreateWindowEx.<br /><br />I use this myself for DirectX applications, so the transition to a DX fullscreen video mode looks smoother (compared to some games, where you see part of a dummy window for half a sec before the game is completely initialized.)<br /><br />Ranma, a bit silly to call ShowWindow, when you can add WS_MAXIMIZE to dwStyle on CreateWindowEx - besides this is just maximized, not 'fullscreen' :)</div>
    <div class="meta">Posted on 2004-02-18 01:31:35 by f0dder</div>
   </div>
   <div class="post" id="post-134014">
    <div class="subject"><a href="#post-134014">GetWindowRect()</a></div>
    <div class="body"><div class="quote"><br />you specify the window size on the call to CreateWindowEx - look at MSDN, PlatformSDK or win32.hlp for more information.<br /><br />To create a &quot;fullscreen&quot; window, do GetWindowRect() on the HWND obtained with GetDesktopWindow(), and use the values in the RECT in the call to CreateWindowEx.<br /><br />I use this myself for DirectX applications, so the transition to a DX fullscreen video mode looks smoother (compared to some games, where you see part of a dummy window for half a sec before the game is completely initialized.)<br /><br />Ranma, a bit silly to call ShowWindow, when you can add WS_MAXIMIZE to dwStyle on CreateWindowEx - besides this is just maximized, not 'fullscreen' :) </div><br /><br />Found this on MS, a little slim on the comments though. Just keep in mind that my previous post was a MINOR modification of one of Hutch's example. By reading though the code I realized that the bitmap name is stored<br />in the .rc file. Not sure why a lone two line file is necessary to store the bitmap. Don't answer that yet.<br /><br />Thanks.<br /><br />HWND hwndOwner; <br />RECT rc, rcDlg, rcOwner; <br /> <br />    case WM_INITDIALOG: <br /> <br />        // Get the owner window and dialog box rectangles. <br /> <br />        if ((hwndOwner = GetParent(hwndDlg)) == NULL) <br />        {<br />            hwndOwner = GetDesktopWindow(); <br />        }<br /><br />        GetWindowRect(hwndOwner, &amp;rcOwner); <br />        GetWindowRect(hwndDlg, &amp;rcDlg); <br />        CopyRect(&amp;rc, &amp;rcOwner); <br /> <br />         // Offset the owner and dialog box rectangles so that <br />         // right and bottom values represent the width and <br />         // height, and then offset the owner again to discard <br />         // space taken up by the dialog box. <br /> <br />        OffsetRect(&amp;rcDlg, -rcDlg.left, -rcDlg.top); <br />        OffsetRect(&amp;rc, -rc.left, -rc.top); <br />        OffsetRect(&amp;rc, -rcDlg.right, -rcDlg.bottom); <br /> <br />         // The new position is the sum of half the remaining <br />         // space and the owner's original position. <br /> <br />        SetWindowPos(hwndDlg, <br />            HWND_TOP, <br />            rcOwner.left + (rc.right / 2), <br />            rcOwner.top + (rc.bottom / 2), <br />            0, 0,          // ignores size arguments <br />            SWP_NOSIZE); <br /> <br />        if (GetDlgCtrlID((HWND) wParam) != ID_ITEMNAME) <br />        { <br />            SetFocus(GetDlgItem(hwndDlg, ID_ITEMNAME)); <br />            return FALSE; <br />        } <br />        return TRUE;</div>
    <div class="meta">Posted on 2004-02-18 06:23:06 by skywalker</div>
   </div>
  </div>
 </body>
</html>