<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>about sef-del, It cannot work - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=19893" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=19893">about sef-del, It cannot work</a></p>
   <div class="post" id="post-152754">
    <div class="subject"><a href="#post-152754">about sef-del, It cannot work</a></div>
    <div class="body">I have writed a program to  delete itself, but it cannot work, why? <br />and it work on XP sp2<br /><br />.386 <br />.model flat,stdcall <br />option casemap:none <br />include \masm32\include\windows.inc <br />include \masm32\include\kernel32.inc <br />includelib \masm32\lib\kernel32.lib <br />include \masm32\include\user32.inc <br />includelib \masm32\lib\user32.lib <br /><br />.data <br />MsgBoxCaption db &quot;My self-del program&quot;,0 <br />MsgBoxText db &quot;Now you will see the resule!&quot;,0 <br />progname db 256 dup(0)<br /><br />.data?<br />module HMODULE ?<br /><br />.code <br />start:<br />invoke GetModuleHandle,0<br />mov module,eax<br />invoke GetModuleFileName,module,addr progname,256<br />invoke MessageBox, NULL, addr MsgBoxText, addr MsgBoxCaption, MB_OK <br /><br />invoke CloseHandle,HANDLE+4 <br />lea eax,progname <br />push 0 <br />push 0 <br />push eax <br />push ExitProcess <br />push module <br />push DeleteFile <br />push UnmapViewOfFile <br />ret<br />invoke ExitProcess,NULL<br />end start</div>
    <div class="meta">Posted on 2004-11-11 22:07:41 by miaomiao</div>
   </div>
   <div class="post" id="post-152757">
    <div class="subject"><a href="#post-152757">about sef-del, It cannot work</a></div>
    <div class="body">http://board.flatassembler.net/viewtopic.php?t=1979</div>
    <div class="meta">Posted on 2004-11-11 22:37:58 by comrade</div>
   </div>
   <div class="post" id="post-152759">
    <div class="subject"><a href="#post-152759">about sef-del, It cannot work</a></div>
    <div class="body"><div class="quote">http://board.flatassembler.net/viewtopic.php?t=1979</div><br />thanks a lot, but I cannot open the URL</div>
    <div class="meta">Posted on 2004-11-11 22:50:39 by miaomiao</div>
   </div>
   <div class="post" id="post-152776">
    <div class="subject"><a href="#post-152776">about sef-del, It cannot work</a></div>
    <div class="body"><a target="_blank" href="http://www.catch22.net/tuts/selfdel.asp">see the follow URL, and you will get the result</a><br /><br /> :lol:</div>
    <div class="meta">Posted on 2004-11-12 08:17:10 by miaomiao</div>
   </div>
   <div class="post" id="post-152785">
    <div class="subject"><a href="#post-152785">Re: about sef-del, It cannot work</a></div>
    <div class="body"><pre><code>invoke CloseHandle,HANDLE+4</code></pre><br />Why the &quot;HANDLE+&quot;?<br />I don't like that code at all.</div>
    <div class="meta">Posted on 2004-11-12 10:42:21 by death</div>
   </div>
   <div class="post" id="post-152786">
    <div class="subject"><a href="#post-152786">about sef-del, It cannot work</a></div>
    <div class="body">Hardcoded value? hmm</div>
    <div class="meta">Posted on 2004-11-12 11:05:00 by roticv</div>
   </div>
   <div class="post" id="post-152787">
    <div class="subject"><a href="#post-152787">about sef-del, It cannot work</a></div>
    <div class="body">file section has handle of 4 on win2000, i believe<br />that's part of the trick</div>
    <div class="meta">Posted on 2004-11-12 11:06:37 by comrade</div>
   </div>
  </div>
 </body>
</html>