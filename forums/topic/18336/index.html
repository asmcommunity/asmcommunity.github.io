<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>2 Questions - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=18336" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=18336">2 Questions</a></p>
   <div class="post" id="post-142055">
    <div class="subject"><a href="#post-142055">2 Questions</a></div>
    <div class="body">Hi,<br /><br />1. How can I restore a minimized console window in windows XP. I want to restore it from another process,<br />and it seems I cannot find a HWND for the console window.<br /><br />2. I have a mysterious behaviour of a program using mixed 16/32 bit code segments. the following code crashes on pentium cpus, but works for P4:<br /><br />this code when executed has a 16bit CS and a 32bit! SS, HiWord(ESP)=0 but HiWord(EBP) is NOT zero:<br /><br />    push bp<br />    mov bp, sp<br />    mov ax, 1<br />    leave                    ;&lt;- causes a stack fault on pentium cpus<br />    retf<br /><br />I always thought the leave instruction on a 16-bit CS (without 66h prefix) should restore SP with BP only, leaving HiWord(ESP) unchanged, but this seems to be not the case. I havent found any descriptions of this bug(?) yet. Further information would be appreciated.<br /><br />Japheth</div>
    <div class="meta">Posted on 2004-05-25 04:24:07 by japheth</div>
   </div>
   <div class="post" id="post-142056">
    <div class="subject"><a href="#post-142056">2 Questions</a></div>
    <div class="body">For the second part:  do you have the same OS for those two CPUs?  If not, I suspect one on your Pentium runs strange version of DPMI.  Or, that one does not handle DOS extender (as embedded in .exe) properly.</div>
    <div class="meta">Posted on 2004-05-25 04:43:39 by Starless</div>
   </div>
   <div class="post" id="post-142090">
    <div class="subject"><a href="#post-142090">2 Questions</a></div>
    <div class="body">For the first question, this routine:<br /><a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllp</a><br />roc/base/getconsolewindow.asp<br /><br />2k+ only though, and only for the active process (ie, code injection time). Or you could use this workaround, which would also require code injection: <a target="_blank" href="http://support.microsoft.com/default.aspx?scid=http://support.microsoft.com:80/support/kb/articles/Q124/1/03.asp&amp;NoWebContent=1">http://support.microsoft.com/default.aspx?scid=http://support.microsoft.com:80/support/kb/articles/Q124/1/03.asp&amp;NoWebContent=1</a></div>
    <div class="meta">Posted on 2004-05-25 10:18:16 by f0dder</div>
   </div>
   <div class="post" id="post-142094">
    <div class="subject"><a href="#post-142094">2 Questions</a></div>
    <div class="body">Starless,<br /><br />its &quot;almost&quot; the same OS. But it doesnt matter, because I made a mistake and the versions of the 16-bit dlls differed. For the P4 I used an older version, where the generated code was a bit optimized:<br /><br />mov ax, 1<br />retf<br /><br />When I use the newer version, I crashes on the P4 as well. So obviously the &quot;leave&quot; instruction always depends on the D bit of the SS descriptor, not the CS descriptor, which I wasnt aware of.<br /><br />f0dder, thanks for the links. If it is really necessary to inject code for such &quot;simple&quot; jobs...  :rolleyes: <br /><br />Japheth</div>
    <div class="meta">Posted on 2004-05-25 11:05:30 by japheth</div>
   </div>
  </div>
 </body>
</html>