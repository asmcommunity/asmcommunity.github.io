<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Tutorial 7...trying to add right mouse click - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=19661" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=17">Iczelion's Tutorials</a> &raquo; <a href="../?id=19661">Tutorial 7...trying to add right mouse click</a></p>
   <div class="post" id="post-151260">
    <div class="subject"><a href="#post-151260">Tutorial 7...trying to add right mouse click</a></div>
    <div class="body">Hi all.  I'm new.  This is fun.  I like the tutorials a lot!<br /><br />Anyway, I am trying to modify Tutorial 7 to respond to right mouse click.<br />However, the right mouse click only works one time, when you first load the window.  After that, only left mouse click text string shows even when<br />you click right mouse.<br /><br />Thanks for your help!  <br /><br /><br /><br /><br /><pre><code>.386<br />.model flat,stdcall<br />option casemap&#58;none<br /><br />WinMain proto &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\gdi32.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\gdi32.lib<br /><br />.data<br />ClassName db &quot;SimpleWinClass&quot;,0<br />AppName  db &quot;Our First Window&quot;,0<br />RightAppName db &quot;My First RightCLick&quot;,0<br />MouseClick db 0         ; 0=no click yet<br />RightMouseClick db 0<br />.data?<br />hInstance HINSTANCE ?<br />CommandLine LPSTR ?<br />hitpoint POINT &lt;&gt;<br /><br />.code<br />start&#58;<br />    invoke GetModuleHandle, NULL<br />    mov    hInstance,eax<br />    invoke GetCommandLine<br />    mov CommandLine,eax<br />    invoke WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT<br />    invoke ExitProcess,eax<br /><br />WinMain proc hInst&#58;HINSTANCE,hPrevInst&#58;HINSTANCE,CmdLine&#58;LPSTR,CmdShow&#58;DWORD<br />    LOCAL wc&#58;WNDCLASSEX<br />    LOCAL msg&#58;MSG<br />    LOCAL hwnd&#58;HWND<br />    mov   wc.cbSize,SIZEOF WNDCLASSEX<br />    mov   wc.style, CS_HREDRAW or CS_VREDRAW<br />    mov   wc.lpfnWndProc, OFFSET WndProc<br />    mov   wc.cbClsExtra,NULL<br />    mov   wc.cbWndExtra,NULL<br />    push  hInst<br />    pop   wc.hInstance<br />    mov   wc.hbrBackground,COLOR_WINDOW+1<br />    mov   wc.lpszMenuName,NULL<br />    mov   wc.lpszClassName,OFFSET ClassName<br />    invoke LoadIcon,NULL,IDI_APPLICATION<br />    mov   wc.hIcon,eax<br />    mov   wc.hIconSm,eax<br />    invoke LoadCursor,NULL,IDC_ARROW<br />    mov   wc.hCursor,eax<br />    invoke RegisterClassEx, addr wc<br />    invoke CreateWindowEx,NULL,ADDR ClassName,ADDR AppName,\<br />           WS_OVERLAPPEDWINDOW,CW_USEDEFAULT,\<br />           CW_USEDEFAULT,CW_USEDEFAULT,CW_USEDEFAULT,NULL,NULL,\<br />           hInst,NULL<br />    mov   hwnd,eax<br />    invoke ShowWindow, hwnd,SW_SHOWNORMAL<br />    invoke UpdateWindow, hwnd<br />    .WHILE TRUE<br />                invoke GetMessage, ADDR msg,NULL,0,0<br />                .BREAK .IF &#40;!eax&#41;<br />                invoke DispatchMessage, ADDR msg<br />    .ENDW<br />    mov     eax,msg.wParam<br />    ret<br />WinMain endp<br /><br />WndProc proc hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br />    LOCAL hdc&#58;HDC<br />    LOCAL ps&#58;PAINTSTRUCT<br /><br />    .IF uMsg==WM_DESTROY<br />        invoke PostQuitMessage,NULL<br />    .ELSEIF uMsg==WM_LBUTTONDOWN<br />        mov eax,lParam<br />        and eax,0FFFFh<br />        mov hitpoint.x,eax<br />        mov eax,lParam<br />        shr eax,16<br />        mov hitpoint.y,eax<br />        mov MouseClick,TRUE<br />        invoke InvalidateRect,hWnd,NULL,TRUE<br />    .ELSEIF uMsg==WM_RBUTTONDOWN<br />    	mov eax, lParam<br />    	and eax, 0FFFFh<br />    	mov hitpoint.x,eax<br />    	mov eax, lParam<br />    	shr eax, 16<br />    	mov hitpoint.y, eax<br />    	mov RightMouseClick,TRUE<br />    	invoke InvalidateRect,hWnd,NULL,TRUE<br />    .ELSEIF uMsg==WM_PAINT<br />        invoke BeginPaint,hWnd, ADDR ps<br />        mov    hdc,eax<br />        .IF MouseClick<br />            invoke lstrlen,ADDR AppName<br />            invoke TextOut,hdc,hitpoint.x,hitpoint.y,ADDR AppName,eax<br />        .ELSEIF RightMouseClick<br />        	invoke lstrlen,ADDR RightAppName<br />        	invoke TextOut,hdc,hitpoint.x,hitpoint.y,ADDR RightAppName, eax<br />        .ENDIF<br />        invoke EndPaint,hWnd, ADDR ps<br />    .ELSE<br />        invoke DefWindowProc,hWnd,uMsg,wParam,lParam<br />        ret<br />    .ENDIF<br />    xor    eax,eax<br />    ret<br />WndProc endp<br />end start </code></pre></div>
    <div class="meta">Posted on 2004-10-13 21:42:25 by sharkfish</div>
   </div>
   <div class="post" id="post-151261">
    <div class="subject"><a href="#post-151261">Tutorial 7...trying to add right mouse click</a></div>
    <div class="body"><div class="quote">However, the right mouse click only works one time, when you first load the window. After that, only left mouse click text string shows even when you click right mouse.</div>When you check which message to display with the following code<pre><code>        .IF MouseClick <br />            invoke lstrlen,ADDR AppName <br />            invoke TextOut,hdc,hitpoint.x,hitpoint.y,ADDR AppName,eax <br />        .ELSEIF RightMouseClick <br />           invoke lstrlen,ADDR RightAppName <br />           invoke TextOut,hdc,hitpoint.x,hitpoint.y,ADDR RightAppName, eax <br />        .ENDIF </code></pre>you first look at the value of &quot;MouseClick&quot; which is initialized to FALSE in your data segment. Once you change it to TRUE when you click the left mouse button, it always remains to that value regardless of the mouse button you click, and will therefore always result in the code to display the left mouse button message being processed preferentially.<br /><br />There are numerous ways to correct this misbehaviour but the simplest one for your snippet would be to add the following instruction in the uMsg==WM_RBUTTONDOWN case:<pre><code>        mov MouseClick,FALSE</code></pre><br />Raymond</div>
    <div class="meta">Posted on 2004-10-13 22:49:31 by Raymond</div>
   </div>
   <div class="post" id="post-151291">
    <div class="subject"><a href="#post-151291">Tutorial 7...trying to add right mouse click</a></div>
    <div class="body">Thanks!<br /><br />Your solution works, however, I wonder why I do  not have to do the same for WM_LBUTTONDOWN since both MouseClick and RightMouseClick are initialized false in the data segment.  ?</div>
    <div class="meta">Posted on 2004-10-14 21:59:57 by sharkfish</div>
   </div>
   <div class="post" id="post-151301">
    <div class="subject"><a href="#post-151301">Tutorial 7...trying to add right mouse click</a></div>
    <div class="body"><div class="quote">I wonder why I do not have to do the same for WM_LBUTTONDOWN </div><br />Simply because, if you click the left mouse button, it gets checked first and its code gets done skipping the code for the right mouse button. It then doesn't matter what the RightMouseClick status is in memory.<br /><br />As I mentioned, this was a quick fix for your snippet because you simply had only 2 choices. Don't use this as a standard way of programming. In more complex algos, you may need to proceed differently.<br /><br />Raymond</div>
    <div class="meta">Posted on 2004-10-15 08:56:43 by Raymond</div>
   </div>
   <div class="post" id="post-156892">
    <div class="subject"><a href="#post-156892">maybe more than one nesting in the message que</a></div>
    <div class="body">If its possible to have more than one if statement in the message que, you could seperate left and right mouse clicks.<br /><br />i.e.<br /><br />.if leftmouseclick==true<br />             invoke something<br />.endif<br />.if rightmouseclick==true<br />             invoke something<br />.endif<br /><br />I'm not sure if this would work you can test it though if you feel bothered.<br /><br />maybe even <br /><br />.if leftmouseclick==TRUE<br />            invoke something<br />            mov leftmouseclick,FALSE<br />.endif<br />.if rightmouseclick==TRUE<br />            invoke something<br />            mov rightmouseclick,FALSE<br />.endif<br /><br />and if you wanted to be extreme you could have two procedures.  Not sure how you'd do that just yet though.</div>
    <div class="meta">Posted on 2005-02-09 23:51:14 by Phase Verocity</div>
   </div>
  </div>
 </body>
</html>