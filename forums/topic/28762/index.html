<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Retrieving PE file's import module names - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=28762" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=113">Low Level Concepts</a> &raquo; <a href="../?id=28762">Retrieving PE file's import module names</a></p>
   <div class="post" id="post-203210">
    <div class="subject"><a href="#post-203210">Retrieving PE file's import module names</a></div>
    <div class="body">Hi<br />I am trying to get list of import module names from PE file. But i can not find the solution.<br />This is my code:<br /><pre><code><br />CString CPE::GetImportModuleNames(CString str_SectionHdrName)<br />{<br />	CString c;<br /><br /><br />	IMAGE_DOS_HEADER * dosheader=(IMAGE_DOS_HEADER *)g_pMappedFileBase;<br />&nbsp; &nbsp; IMAGE_OPTIONAL_HEADER * opthdr =(IMAGE_OPTIONAL_HEADER *) <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ((BYTE*)dosheader+dosheader-&gt;e_lfanew+24);<br /><br />&nbsp; &nbsp; IMAGE_IMPORT_DESCRIPTOR * descriptor=(IMAGE_IMPORT_DESCRIPTOR *)<br />&nbsp; &nbsp;  ((BYTE*)dosheader+ <br />&nbsp; &nbsp;  opthdr-&gt;DataDirectory.VirtualAddress);<br /><br />	// (?)<br /><br />	return c;<br />}</code></pre><br /><br />In Documentation, it says:<br /><br /><div class="quote">&quot; The IMAGE_IMPORT_DESCRIPTOR struct consists of five fields :<br /><br />&nbsp; Union {<br />	DWORD Characteristics;<br />	PIMAGE_THUNK_DATA OriginalFirstThunk;<br />&nbsp; };<br />&nbsp; DWORD TimeDateStamp;<br />&nbsp; DWORD ForwarderChain;<br />&nbsp; DWORD Name;<br />&nbsp; PIMAGE_THUNK_DATA FirstThunk;&quot;<br />...<br />&quot;Name contains the a pointer (RVA) to the ASCII name of the DLL.&quot;</div><br />How can i retrieve the name of modules from that pointer(RVA).<br />Now i think i must write a loop and get the names but i couldn&#039;t do the the last step.<br /><br />while(?)<br />	{<br />	descriptor-&gt;Name (?)<br />	}<br /><br />Could you please help me.<br />Thank you.</div>
    <div class="meta">Posted on 2007-10-17 04:05:34 by portyum</div>
   </div>
   <div class="post" id="post-203211">
    <div class="subject"><a href="#post-203211">Re: Retrieving PE file's import module names</a></div>
    <div class="body">Have a look at Iczelion&#039;s PE tutorials, this one explains the basics of the import table :<br /><br />http://win32assembly.online.fr/pe-tut6.html</div>
    <div class="meta">Posted on 2007-10-17 13:01:29 by Vortex</div>
   </div>
  </div>
 </body>
</html>