<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Printer Help... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=404" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=116">Windows</a> &raquo; <a href="../?id=404">Printer Help...</a></p>
   <div class="post" id="post-2260">
    <div class="subject"><a href="#post-2260">Printer Help...</a></div>
    <div class="body">Hey, I reciently did a first time hack at making a print function for a program im working on..  Surprisingly i got it going the first time.. but my problem is while the text formating on one printer looks good.. when i use the same code on another, the text is 2x the size as the first...??  So this tells me i need to find the printer's x and y max bits per page somehow and scale my text accordingly.. but how?? Where is this info found??<br /><br />Here is my existing code...<br /><pre><code>Do_Print PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD<br /><br />COLUMN_1 equ 100<br />COLUMN_2 equ 2100<br />LINE_WIDTH equ 100<br /><br />PrintFloat MACRO Q1&#58;REQ, string&#58;REQ<br />  LOCAL szMessage<br /><br />  .data<br />  szMessage       BYTE string, &quot;&#58;&quot;,0<br />  .code<br />  invoke FloatToStr2, Q1, addr POUT<br />  invoke lstrlen, addr szMessage<br />  invoke TextOut, PD.hDC, COLUMN_1, yP, addr szMessage, eax<br /><br />  invoke lstrlen, addr POUT<br />  invoke TextOut, PD.hDC, COLUMN_2, yP, addr POUT, eax<br />  <br />  add yP, LINE_WIDTH<br /><br />ENDM<br /><br />PrintMemText MACRO Mem&#58;REQ, string&#58;REQ<br />  LOCAL szMessage<br /><br />  .data<br />  szMessage       BYTE string, &quot;&#58;&quot;,0<br />  .code<br /><br />  invoke lstrlen, addr szMessage<br />  invoke TextOut, PD.hDC, COLUMN_1, yP, addr szMessage, eax<br /><br />  invoke lstrlen, addr Mem<br />  invoke TextOut, PD.hDC, COLUMN_2, yP, addr Mem, eax<br />  <br />  add yP, LINE_WIDTH<br /><br />ENDM<br /><br />PrintTitle MACRO string&#58;REQ<br />  LOCAL szMessage<br /><br />  .data<br />  szMessage       BYTE string, 0<br />  .code<br /><br />  add yP, LINE_WIDTH<br />  invoke lstrlen, addr szMessage<br />  invoke TextOut, PD.hDC, COLUMN_1, yP, addr szMessage, eax<br />  <br />  add yP, 2*LINE_WIDTH<br /><br />ENDM<br /><br /><br />.data?<br />  PD  PRINTDLG  &lt;&gt;<br />  DOC DOCINFO   &lt;&gt;<br />  LF  LOGFONT   &lt;&gt;<br />  <br />  pFont         dd ?<br />  yP            dd ?<br />  POUT          db 50 dup &#40;?&#41;<br /><br />.data<br />  DocTitle      db &quot;Ground Grid Calculations&quot;,0<br />  <br />  FontMS        db &quot;MS Sans Serif&quot;,0<br />  <br />.code<br />Do_Print PROC hWnd&#58;DWORD, wParam&#58;DWORD, lParam&#58;DWORD<br />  LOCAL QTMP &#58;QWORD<br />  LOCAL BUG&#91;12&#93; &#58;BYTE<br />  LOCAL TEMP &#58;DWORD<br /><br />  ; Initialize the Print Dialog<br />  ; --===============================================<br />  mov yP, 0 ; Start of page..<br /><br />  invoke SendMessage, h7001, CB_GETCURSEL, NULL, NULL<br />  mov TEMP, eax<br />  invoke SendMessage, h7001, CB_GETLBTEXT, TEMP, addr BUG<br />  <br />  ; Initialize the Print Dialog<br />  ; --===============================================<br />  mov PD.lStructSize, SIZEOF PD<br />  m2m PD.hwndOwner, hWnd<br />  m2m PD.hInstance, hInstance<br />  mov PD.Flags, PD_RETURNDC                  ; Return Users DC choices<br />  <br />  ; Create A Printer Font..<br />  ; --===============================================<br />  invoke lstrcpy, addr LF.lfFaceName, addr FontMS<br />  mov LF.lfHeight, 100<br />  mov LF.lfWeight, 600<br />  invoke CreateFontIndirect, ADDR LF<br />  mov pFont, eax<br />  <br />  ; Show the Print Dialog Box!<br />  ; --===============================================<br />  invoke PrintDlg, offset PD<br />  cmp eax, FALSE<br />  je @ExitPrint<br />  <br />  ; IF you specify the PD_RETURNDC value in the Flags member of the PRINTDLG structure and the user <br />  ; selects Print To File from the Print dialog box, you can use the DC returned in the hDC member <br />  ; of the structure to generate output, but only after you prepare the file for output by specifying <br />  ; the name of the file in the lpszOutput member of the DOCINFO structure and calling the StartDoc function. <br />  <br />  ; Set up the Document Info Structure<br />  ; --===============================================<br />  mov DOC.cbSize, SIZEOF DOC<br />  mov DOC.lpszDocName, offset DocTitle<br />  mov DOC.lpszOutput, NULL<br />  mov DOC.fwType, NULL<br />  <br />  ; Start the Doc..<br />  ; Ensures proper print order of pages..<br />  ; --===============================================<br />  invoke StartDoc, PD.hDC, offset DOC<br />  <br />  ; Start the Page..<br />  ; Prepares the printer driver to accept data.<br />  ; --===============================================<br />  invoke StartPage, PD.hDC<br />  <br />  ; Load a Printer Font..<br />  ; --===============================================<br />  invoke SelectObject, PD.hDC, pFont<br />  <br />  ; Print The Needed Text...<br />  ; --===============================================<br />  PrintTitle &quot;Ground Grid Design Calculations&quot;<br />  PrintTitle &quot;Conductor Values&quot;<br />  PrintFloat OutsideDistance, &quot;Outside Ground Segment Length &#40;m&#41;&quot;<br />  PrintFloat InsideDistance,  &quot;Inside Ground Segment Length &#40;m&#41;&quot;<br />  PrintFloat CondDistance,    &quot;Inside Conductor Spacing &#40;m&#41;&quot;<br />  PrintFloat NumberOfRods,    &quot;Number Of Ground Rods&quot;<br />  PrintFloat RodLength,       &quot;Ground Rod Length &#40;m&#41;&quot;<br />  PrintFloat ConductorSize,   &quot;Conductor Size &#40;m&#41;&quot;<br />  PrintMemText BUG,           &quot;Conductor Type &#40;IEEE&#41;&quot;<br />  <br />  PrintTitle &quot;Geometry Values&quot;<br />  PrintFloat Depth,           &quot;Ground Grid Burried Depth &#40;m&#41;&quot;<br />  PrintFloat Perimeter,       &quot;Ground Grid Perimeter &#40;m&#41;&quot;<br />  PrintFloat TotalArea,       &quot;Ground Grid Total Area &#40;m*m&#41;&quot;<br />  PrintFloat TotalCondLength, &quot;Ground Grid Total Conductor Length &#40;m&#41;&quot;<br />  PrintFloat TotalGroundRodLength, &quot;Ground Grid Total Ground Rod Length &#40;m&#41;&quot;<br />  PrintTitle &quot;Electrical Values&quot;<br />  PrintFloat VABase,          &quot;VA Base &#40;unused in Calculations&#41;&quot;<br />  PrintFloat VoltBase,        &quot;3P Voltage Value &#40;V&#41;&quot; <br />  PrintFloat MaxFaultTime,    &quot;Max Fault Time &#40;unused in Calculations&#41;&quot;<br />  PrintFloat SurfaceResistivity, &quot;Surface Resistivity &#40;unused&#41; &#40;Ohm-m&#41;&quot;<br />  PrintFloat UpperSoilResistivity, &quot;Upper Soil Resistivity &#40;Ohm-m&#41;&quot;<br />  PrintFloat LowerSoilResistivity, &quot;Lower Soil Resistivity &#40;Ohm-m&#41;&quot;<br />  PrintFloat ZReal,           &quot;Summed Line Impedance  &#40;Ohm&#41;&quot;<br />  PrintFloat ZImag,           &quot;Summed Line Impedance j&#40;Ohm&#41;&quot;<br />  PrintTitle &quot;Calculations Rendered&quot;<br />  PrintFloat LT_Calc,         &quot;'LT' Calculated Value &#40;m&#41;&quot;<br />  PrintFloat RG_Calc,         &quot;'RG' Calculated Value &#40;Ohm&#41;&quot;<br />  PrintFloat ZL_Calc,         &quot;'ZL' Calculated Impedance &#40;Ohm&#41;&quot;<br />  PrintFloat ILG_Calc,        &quot;Line-Ground Calculated Current &#40;A&#41;&quot;<br />  PrintFloat GPR_Calc,        &quot;'GPR' Calculated Value &#40;V&#41;&quot;<br />  PrintFloat KM_Calc,         &quot;'KM' Calculated Value&quot;<br />  PrintFloat KI_Calc,         &quot;'KI' Calculated Value&quot;<br />  PrintFloat EM_Calc,         &quot;'E-Mesh' Calculated Value &#40;V&#41;&quot;<br />  PrintFloat KS_Calc,         &quot;'KS' Calculated Value&quot;<br />  PrintFloat LS_Calc,         &quot;'LS' Calculated Value&quot;<br />  PrintFloat ES_Calc,         &quot;'ES' Calculated Value &#40;V&#41;&quot;<br />  PrintFloat THE_N,           &quot;'N' Value In Calculations&quot;<br />  PrintTitle &quot;Assigned Constraints&quot;<br />  WndTxt2Float h9001, QTMP<br />  PrintFloat QTMP,            &quot;GPR Assigned Limit &#40;V&#41;&quot;<br />  WndTxt2Float h9002, QTMP<br />  PrintFloat QTMP,            &quot;E-Mesh Assigned Limit &#40;V&#41;&quot;<br />  WndTxt2Float h9003, QTMP<br />  PrintFloat QTMP,            &quot;E-Step Assigned Limit &#40;V&#41;&quot;<br />  PrintTitle &quot;Final Answer Calculations &#40;Repeated from above&#41;&quot;<br />  PrintFloat GPR_Calc,        &quot;'GPR' Calculated Value &#40;V&#41;&quot;<br />  PrintFloat EM_Calc,         &quot;'E-Mesh' Calculated Value &#40;V&#41;&quot;<br />  PrintFloat ES_Calc,         &quot;'ES' Calculated Value &#40;V&#41;&quot;<br />  <br />  ; Do the End of Page &#40;feed out the paper&#41;<br />  ; --===============================================<br />  invoke EndPage, PD.hDC<br />  invoke EndDoc, PD.hDC<br />  invoke DeleteDC, PD.hDC<br />  <br />  @ExitPrint&#58;<br />  ret<br />Do_Print ENDP</code></pre><br /><br />Thanx again...<br /><br />:alright: <br />NaN</div>
    <div class="meta">Posted on 2001-07-28 13:11:11 by NaN</div>
   </div>
   <div class="post" id="post-2278">
    <div class="subject"><a href="#post-2278">Printer Help...</a></div>
    <div class="body">Surprised now one caught this one.. the answer is EZ.. just didnt see it at first... I was hunitng for an API or a sturcture to say the X and Y extence of the printer im using...<br /><br />The answer is in basic GUI theory... I have a hDC to my printer... so i need to check it for ITS x and y extence... Two calls to GetDeviceCaps and its all fixed...<br /><br />Here is the proper code, that will suport on any printer...<br /><br /><pre><code><br />Do_Print PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD<br /><br /><br />PrintFloat MACRO Q1&#58;REQ, string&#58;REQ<br />  LOCAL szMessage<br /><br />  .data<br />  szMessage       BYTE string, &quot;&#58;&quot;,0<br />  .code<br />  invoke FloatToStr2, Q1, addr POUT<br />  invoke lstrlen, addr szMessage<br />  invoke TextOut, PD.hDC, COLUMN_1, yP, addr szMessage, eax<br /><br />  invoke lstrlen, addr POUT<br />  invoke TextOut, PD.hDC, COLUMN_2, yP, addr POUT, eax<br />  <br />  mov eax, LINE_WIDTH<br />  add yP, eax<br /><br />ENDM<br /><br />PrintMemText MACRO Mem&#58;REQ, string&#58;REQ<br />  LOCAL szMessage<br /><br />  .data<br />  szMessage       BYTE string, &quot;&#58;&quot;,0<br />  .code<br /><br />  invoke lstrlen, addr szMessage<br />  invoke TextOut, PD.hDC, COLUMN_1, yP, addr szMessage, eax<br /><br />  invoke lstrlen, addr Mem<br />  invoke TextOut, PD.hDC, COLUMN_2, yP, addr Mem, eax<br />  <br />  mov eax, LINE_WIDTH<br />  add yP, eax<br /><br /><br />ENDM<br /><br />PrintTitle MACRO string&#58;REQ<br />  LOCAL szMessage<br /><br />  .data<br />  szMessage       BYTE string, 0<br />  .code<br /><br />  mov eax, LINE_WIDTH<br />  add yP, eax<br /><br />  invoke lstrlen, addr szMessage<br />  invoke TextOut, PD.hDC, COLUMN_1, yP, addr szMessage, eax<br />  <br />  mov eax, LINE_WIDTH<br />  add yP, eax<br /><br /><br />ENDM<br /><br /><br />.data?<br />  PD  PRINTDLG  &lt;&gt;<br />  DOC DOCINFO   &lt;&gt;<br />  LF  LOGFONT   &lt;&gt;<br />  <br />  pFont         dd ?<br />  yP            dd ?<br />  POUT          db 50 dup &#40;?&#41;<br />  <br />  COLUMN_1      dd ?<br />  COLUMN_2      dd ?<br />  LINE_WIDTH    dd ?<br /><br /><br />.data<br />  DocTitle      db &quot;Ground Grid Calculations&quot;,0<br />  <br />  FontMS        db &quot;MS Sans Serif&quot;,0<br />  <br />.code<br />Do_Print PROC hWnd&#58;DWORD, wParam&#58;DWORD, lParam&#58;DWORD<br />  LOCAL QTMP &#58;QWORD<br />  LOCAL BUG&#91;12&#93; &#58;BYTE<br />  LOCAL TEMP &#58;DWORD<br /><br />  ; Initialize the Print Dialog<br />  ; --===============================================<br />  mov yP, 0 ; Start of page..<br /><br />  invoke SendMessage, h7001, CB_GETCURSEL, NULL, NULL<br />  mov TEMP, eax<br />  invoke SendMessage, h7001, CB_GETLBTEXT, TEMP, addr BUG<br />  <br />  ; Initialize the Print Dialog<br />  ; --===============================================<br />  mov PD.lStructSize, SIZEOF PD<br />  m2m PD.hwndOwner, hWnd<br />  m2m PD.hInstance, hInstance<br />  mov PD.Flags, PD_RETURNDC                  ; Return Users DC choices<br />  <br />  ; Show the Print Dialog Box!<br />  ; --===============================================<br />  invoke PrintDlg, offset PD<br />  cmp eax, FALSE<br />  je @ExitPrint<br />  <br />  ; IF you specify the PD_RETURNDC value in the Flags member of the PRINTDLG structure and the user <br />  ; selects Print To File from the Print dialog box, you can use the DC returned in the hDC member <br />  ; of the structure to generate output, but only after you prepare the file for output by specifying <br />  ; the name of the file in the lpszOutput member of the DOCINFO structure and calling the StartDoc function. <br /><br />  ; Check Get the Printed X+Y extence..<br />  ; --===============================================<br />  invoke GetDeviceCaps, PD.hDC, HORZRES<br />  DPrintValD eax, &quot;Max X&quot;<br />  shr eax, 1<br />  mov COLUMN_2, eax                                    ; 2 columns per page<br />  DPrintValD eax, &quot;Colum space&quot;<br />  invoke GetDeviceCaps, PD.hDC, VERTRES<br />  DPrintValD eax, &quot;Max Y&quot;<br />  shr eax, 6<br />  mov LINE_WIDTH, eax                                  ; 64 Lines / page<br />  DPrintValD eax, &quot;Line Width&quot;<br />  m2m COLUMN_1, LINE_WIDTH<br />  <br />  ; Create A Printer Font..<br />  ; --===============================================<br />  invoke lstrcpy, addr LF.lfFaceName, addr FontMS<br />  m2m LF.lfHeight, LINE_WIDTH<br />  mov LF.lfWeight, 600<br />  invoke CreateFontIndirect, ADDR LF<br />  mov pFont, eax<br />  <br />  ; Set up the Document Info Structure<br />  ; --===============================================<br />  mov DOC.cbSize, SIZEOF DOC<br />  mov DOC.lpszDocName, offset DocTitle<br />  mov DOC.lpszOutput, NULL<br />  mov DOC.fwType, NULL<br />  <br />  ; Start the Doc..<br />  ; Ensures proper print order of pages..<br />  ; --===============================================<br />  invoke StartDoc, PD.hDC, offset DOC<br />  <br />  ; Start the Page..<br />  ; Prepares the printer driver to accept data.<br />  ; --===============================================<br />  invoke StartPage, PD.hDC<br />  <br />  ; Load a Printer Font..<br />  ; --===============================================<br />  invoke SelectObject, PD.hDC, pFont<br />  <br />  <br />  ; Print The Needed Text...<br />  ; --===============================================<br />  PrintTitle &quot;Ground Grid Design Calculations&quot;<br />  PrintTitle &quot;Conductor Values&quot;<br />  PrintFloat OutsideDistance, &quot;Outside Ground Segment Length &#40;m&#41;&quot;<br />  PrintFloat InsideDistance,  &quot;Inside Ground Segment Length &#40;m&#41;&quot;<br />  PrintFloat CondDistance,    &quot;Inside Conductor Spacing &#40;m&#41;&quot;<br />  PrintFloat NumberOfRods,    &quot;Number Of Ground Rods&quot;<br />  PrintFloat RodLength,       &quot;Ground Rod Length &#40;m&#41;&quot;<br />  PrintFloat ConductorSize,   &quot;Conductor Size &#40;m&#41;&quot;<br />  PrintMemText BUG,           &quot;Conductor Type &#40;IEEE&#41;&quot;<br />  <br />  PrintTitle &quot;Geometry Values&quot;<br />  PrintFloat Depth,           &quot;Ground Grid Burried Depth &#40;m&#41;&quot;<br />  PrintFloat Perimeter,       &quot;Ground Grid Perimeter &#40;m&#41;&quot;<br />  PrintFloat TotalArea,       &quot;Ground Grid Total Area &#40;m*m&#41;&quot;<br />  PrintFloat TotalCondLength, &quot;Ground Grid Total Conductor Length &#40;m&#41;&quot;<br />  PrintFloat TotalGroundRodLength, &quot;Ground Grid Total Ground Rod Length &#40;m&#41;&quot;<br />  PrintTitle &quot;Electrical Values&quot;<br />  PrintFloat VABase,          &quot;VA Base &#40;unused in Calculations&#41;&quot;<br />  PrintFloat VoltBase,        &quot;3P Voltage Value &#40;V&#41;&quot; <br />  PrintFloat MaxFaultTime,    &quot;Max Fault Time &#40;unused in Calculations&#41;&quot;<br />  PrintFloat SurfaceResistivity, &quot;Surface Resistivity &#40;unused&#41; &#40;Ohm-m&#41;&quot;<br />  PrintFloat UpperSoilResistivity, &quot;Upper Soil Resistivity &#40;Ohm-m&#41;&quot;<br />  PrintFloat LowerSoilResistivity, &quot;Lower Soil Resistivity &#40;Ohm-m&#41;&quot;<br />  PrintFloat ZReal,           &quot;Summed Line Impedance  &#40;Ohm&#41;&quot;<br />  PrintFloat ZImag,           &quot;Summed Line Impedance j&#40;Ohm&#41;&quot;<br />  PrintTitle &quot;Calculations Rendered&quot;<br />  PrintFloat LT_Calc,         &quot;'LT' Calculated Value &#40;m&#41;&quot;<br />  PrintFloat RG_Calc,         &quot;'RG' Calculated Value &#40;Ohm&#41;&quot;<br />  PrintFloat ZL_Calc,         &quot;'ZL' Calculated Impedance &#40;Ohm&#41;&quot;<br />  PrintFloat ILG_Calc,        &quot;Line-Ground Calculated Current &#40;A&#41;&quot;<br />  PrintFloat GPR_Calc,        &quot;'GPR' Calculated Value &#40;V&#41;&quot;<br />  PrintFloat KM_Calc,         &quot;'KM' Calculated Value&quot;<br />  PrintFloat KI_Calc,         &quot;'KI' Calculated Value&quot;<br />  PrintFloat EM_Calc,         &quot;'E-Mesh' Calculated Value &#40;V&#41;&quot;<br />  PrintFloat KS_Calc,         &quot;'KS' Calculated Value&quot;<br />  PrintFloat LS_Calc,         &quot;'LS' Calculated Value&quot;<br />  PrintFloat ES_Calc,         &quot;'ES' Calculated Value &#40;V&#41;&quot;<br />  PrintFloat THE_N,           &quot;'N' Value In Calculations&quot;<br />  PrintTitle &quot;Assigned Constraints&quot;<br />  WndTxt2Float h9001, QTMP<br />  PrintFloat QTMP,            &quot;GPR Assigned Limit &#40;V&#41;&quot;<br />  WndTxt2Float h9002, QTMP<br />  PrintFloat QTMP,            &quot;E-Mesh Assigned Limit &#40;V&#41;&quot;<br />  WndTxt2Float h9003, QTMP<br />  PrintFloat QTMP,            &quot;E-Step Assigned Limit &#40;V&#41;&quot;<br />  PrintTitle &quot;Final Answer Calculations &#40;Repeated from above&#41;&quot;<br />  PrintFloat GPR_Calc,        &quot;'GPR' Calculated Value &#40;V&#41;&quot;<br />  PrintFloat EM_Calc,         &quot;'E-Mesh' Calculated Value &#40;V&#41;&quot;<br />  PrintFloat ES_Calc,         &quot;'ES' Calculated Value &#40;V&#41;&quot;<br />  <br />  ; Do the End of Page &#40;feed out the paper&#41;<br />  ; --===============================================<br />  invoke EndPage, PD.hDC<br />  invoke EndDoc, PD.hDC<br />  invoke DeleteDC, PD.hDC<br />  <br />  @ExitPrint&#58;<br />  ret<br />Do_Print ENDP</code></pre><br /><br />If you can use it.. Enjoy!<br /><br />:alright: <br />NaN</div>
    <div class="meta">Posted on 2001-07-28 16:25:39 by NaN</div>
   </div>
  </div>
 </body>
</html>