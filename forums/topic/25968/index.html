<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Yay another problem! - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25968" />
    <link rel="next" href="../?id=25968&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25968">Yay another problem!</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=25968&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=25968&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="25968" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=25968&amp;page=2">&gt;</a><a href="../?id=25968&amp;page=2">&raquo;</a></form>   <div class="post" id="post-189246">
    <div class="subject"><a href="#post-189246">Yay another problem!</a></div>
    <div class="body">So I am using Easy Coder IDE to help me along as I slowly relearn ASM.&nbsp; I try to compile and everything works fine.&nbsp; When I try to build the EXE however it gives the error &quot;DBGHELP.lib not found&quot; and lists all the places it wasn&#39;t found.&nbsp; I look in my code but don&#39;t see a reference to that lib file.&nbsp; Anyone use EasyCoder and can give advice?<br />Thanks!</div>
    <div class="meta">Posted on 2007-05-15 09:57:49 by Command_Prompt</div>
   </div>
   <div class="post" id="post-189247">
    <div class="subject"><a href="#post-189247">Re: Yay another problem!</a></div>
    <div class="body">I know nothing about Easy Coder.I suggest you to useRadasm!You can try.</div>
    <div class="meta">Posted on 2007-05-15 11:14:33 by ekin</div>
   </div>
   <div class="post" id="post-189248">
    <div class="subject"><a href="#post-189248">Re: Yay another problem!</a></div>
    <div class="body">Command_Prompt,<br /><br />I don&#39;t use EasyCode but I have friends who do, from what I remember Libraries can be added to the project from the IDE (not just in your code). I would check for extensions to the command line under Project-&gt;Properties (iirc) and also check under the &quot;Libraries&quot; list in your Project window. Either one of those could be a place where the IDE could be harboring an additional .lib file.<br /><br />ekin,<br /><br />IDE&#39;s are an acquired taste. Everyone has one that they like for whatever reason they do. EasyCode is popular because it&#39;s the most &quot;Visual&quot; of the IDE&#39;s (I&#39;ve heard it called the Visual Basic of Assembler IDE&#39;s). RadASM is popular as it supports the most assemblers while still having a decent amount of functionality. I personally still use Notepad or VI (depending on what system I&#39;m on).<br /><br />Regards,<br />Bryant Keller</div>
    <div class="meta">Posted on 2007-05-15 12:46:02 by Synfire</div>
   </div>
   <div class="post" id="post-189249">
    <div class="subject"><a href="#post-189249">Re: Yay another problem!</a></div>
    <div class="body">Thanks both of you for your replies.&nbsp; I downloaded RadAsm and tried to compile and build a sample project that was included and here is the error I got (below).<br />EasyCode also gave me a &quot;can&#39;t find lib&quot; error too for another project I tried.&nbsp; Do I need to set a path for these .lib files or do I need to D/L then separately?<br /><br /><br /><br /><br />C:\Masm32\Bin\ML.EXE /c /coff /Cp /nologo /I&quot;C:\Masm32\Include&quot; &quot;Window.asm&quot;<br /> Assembling: Window.asm<br />C:\Masm32\Bin\LINK.EXE /SUBSYSTEM:WINDOWS /RELEASE /VERSION:4.0 /LIBPATH:&quot;C:\Masm32\Lib&quot; /OUT:&quot;Window.exe&quot; &quot;Window.obj&quot; &quot;Window.res&quot;<br />Microsoft (R) Incremental Linker Version 5.12.8078<br />Copyright (C) Microsoft Corp 1992-1998. All rights reserved.<br /><br />LINK : fatal error LNK1104: cannot open file &quot;kernel32.lib&quot;<br /><br />Make error(s) occured.<br />Total compile time 741 ms<br /></div>
    <div class="meta">Posted on 2007-05-15 13:17:03 by Command_Prompt</div>
   </div>
   <div class="post" id="post-189250">
    <div class="subject"><a href="#post-189250">Re: Yay another problem!</a></div>
    <div class="body">Nevermind!&nbsp; MASM did not create the lib files for some reason.&nbsp; I reinstalled and it works fine now!&nbsp; And now to start cranking out code!!!&nbsp; :P</div>
    <div class="meta">Posted on 2007-05-15 14:10:42 by Command_Prompt</div>
   </div>
   <div class="post" id="post-189254">
    <div class="subject"><a href="#post-189254">Re: Yay another problem!</a></div>
    <div class="body">Thats what we like to hear :)<br /><br />For future reference: MASM32 (Hutch&#39;s repack of masm) creates some &#39;Environmental Variables&#39;, and since those are loaded by the OS during bootup, they do not become active until you reboot.<br />The same is true of OBJASM32 (Biterider&#39;s OOP framework for masm).<br /></div>
    <div class="meta">Posted on 2007-05-16 02:50:57 by Homer</div>
   </div>
   <div class="post" id="post-189255">
    <div class="subject"><a href="#post-189255">Re: Yay another problem!</a></div>
    <div class="body">OK so Masm works now and I put my procedure in the file to compile a dll.&nbsp; So encryption procedure is written (yay!) and I insert it into EasyCode&#39;s generic dll template (code below.&nbsp; Easycode includes the lib files and all in a separate step it seems, so no need to declare them here or anything).&nbsp; Now I am still new at this so I compile/build and no errors are reported.&nbsp; I try to call it from VB and it says no DLL entry point CryptyFile is found :shock:.&nbsp; I&#39;ve never written a dll before...any hints&nbsp; :D? (i&#39;m a n00b at this win32 asm thing so I&#39;m sure there will be dumb and obvious errors).<br />Thanks!<br /><br /><br />; Start of file<br />.Const<br /><br />.Data?<br /><br />.Data<br /><br />hInstEntry	HINSTANCE	NULL<br /><br />.Code<br /><br />DllEntryPoint Proc Private hInstance:HINSTANCE, dwReason:DWord, lpvReserved:LPVOID<br />	.If dwReason == DLL_PROCESS_ATTACH<br />		Mov Eax, hInstance<br />		Mov hInstEntry, Eax<br />	.ElseIf dwReason == DLL_PROCESS_DETACH<br /><br />	.ElseIf dwReason == DLL_THREAD_ATTACH<br /><br />	.ElseIf dwReason == DLL_THREAD_DETACH<br /><br />	.EndIf<br />	Return TRUE<br />DllEntryPoint EndP<br /><br /><br />CryptyFile Proc Public InFileName:DWord, KeyFileName:DWord, OutFileName:DWord, KeyOffset:DWord, hInst:HINSTANCE<br />;// InFileName: path of file to be encrypted<br />;// KeyFileName: path of key file<br />;// OutFileName: path of file to create and store encrypted text<br />;// KeyOffset: Position in the key file to start reading<br />Local hInFile:DWord<br />Local hKeyFile:DWord<br />Local hOutFile:DWord<br />Local InputLength:DWord<br />Local KeyLength:DWord<br />Local BytesRead:DWord<br />ShortKeyTitle DB &quot;Error with File Key&quot;, 0<br />ShortKeyMsg DB &quot;Key file&#39;s length is too short.&quot;, 0<br />;// Buffers //<br />InFileBuffer DB 256 Dup (0)		;Store data read from source file<br />KeyFileBuffer DB 256 Dup (0)		;Store data read from key file<br />OutFileBuffer DB 256 Dup (0)		;Stores XORed Data for write to output file<br /><br />Start:<br />	<br />;// Create the output file for write //<br />&nbsp; &nbsp; Invoke CreateFile, OutFileName, GENERIC_WRITE, NULL, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL	;Create Output file<br />&nbsp; &nbsp; Mov hOutFile, Eax	;Store Output file&#39;s handle<br /><br />;// Open Source file for read //<br />&nbsp; &nbsp; Invoke CreateFile, Addr InFileName, GENERIC_READ, 0, NULL, OPEN_EXISTING, NULL, NULL<br />&nbsp; &nbsp; Mov hInFile, Eax<br /><br />;// Open key file for read //<br />&nbsp; &nbsp; Invoke CreateFile, Addr KeyFileName, GENERIC_READ, 0, NULL, OPEN_EXISTING, NULL, NULL<br />&nbsp; &nbsp; Mov hKeyFile, Eax<br /><br />;// Get Input file&#39;s size and store<br />&nbsp; &nbsp; Invoke GetFileSize, hInFile, NULL<br />&nbsp; &nbsp; Mov InputLength, Eax<br /><br />;// Get Key file&#39;s size and store<br />&nbsp; &nbsp; Invoke GetFileSize, hKeyFile, NULL	; eax stores key file&#39;s length<br /><br />;// Compare to make sure sure Key file is long enough for source file<br />	Sub Eax, KeyOffset			;(after substracting keyOffset from key file&#39;s length to account for starting point)<br />	Cmp Eax, InputLength		;Compare<br />	Jb _Key_Too_Short			;if shorter then give messagebox and exit<br /><br />;// Start of reading and XORing loop<br />_ReadXOR:<br />;// Read 256 bytes from Source and Key files<br />&nbsp; &nbsp; Invoke ReadFile, hInFile, Addr InFileBuffer, 256, Addr BytesRead, NULL<br />&nbsp; &nbsp; Push BytesRead	;Push length of text read from source to stack<br />&nbsp; &nbsp; Push BytesRead	;Push length of text read from source to stack a second time<br />&nbsp; &nbsp; Invoke ReadFile, hInFile, Addr KeyFileBuffer, 256, Addr BytesRead, NULL<br />	Pop Ecx			;Pop length of text read (from source) from stack to CX<br />	Mov Si, 0<br />_XORLoop:<br />	Mov Al, InFileBuffer	;Get first byte from source file to al<br />	Mov Ah, KeyFileBuffer 	;Get first byte from key file to ah<br />	Xor Ah, Al					;xor and store result in ah<br />	Mov OutFileBuffer, Ah	;move XOR&#39;d value to output string<br />	Inc Si						;increase SI by 1<br />	Loop _XORLoop				;Loop for length of string read<br />;// Write string to file<br />	Pop Ecx<br />&nbsp; &nbsp; Invoke WriteFile, hOutFile, Addr OutFileBuffer, Ecx, Addr BytesRead, NULL<br />	Cmp Ecx, 256				;Does # of bytes written=256?<br />	Je _ReadXOR					;If not then EOF was reached, so jump to exit.&nbsp; if yes then do another iteration of read and XORing<br />&nbsp; &nbsp; Mov Eax, BytesRead&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; return written byte count<br />	Jmp _Done<br />_Key_Too_Short:<br />	Invoke MessageBox, hInst, Addr ShortKeyMsg, Addr ShortKeyTitle, MB_OK<br />_Done:<br />&nbsp; &nbsp; Invoke CloseHandle, hInFile<br />&nbsp; &nbsp; Invoke CloseHandle, hOutFile<br />&nbsp; &nbsp; Invoke CloseHandle, hKeyFile<br />	Ret<br /><br />CryptyFile EndP<br /><br />End DllEntryPoint<br />;End of file</div>
    <div class="meta">Posted on 2007-05-16 14:18:01 by Command_Prompt</div>
   </div>
   <div class="post" id="post-189256">
    <div class="subject"><a href="#post-189256">Re: Yay another problem!</a></div>
    <div class="body">Not only you have to make the CryptyFile function public, but you have to export it as well.</div>
    <div class="meta">Posted on 2007-05-16 17:43:38 by ti_mo_n</div>
   </div>
   <div class="post" id="post-189257">
    <div class="subject"><a href="#post-189257">Re: Yay another problem!</a></div>
    <div class="body">D&#39;oh!&nbsp; I suppose making it public is simple but how do I export it? :sad:<br />*added* Wait isn&#39;t it public already?&nbsp; I declared it as &quot;CryptyFile Proc <u>Public</u>&quot; or do I have to do something else, too?</div>
    <div class="meta">Posted on 2007-05-16 19:30:36 by Command_Prompt</div>
   </div>
   <div class="post" id="post-189264">
    <div class="subject"><a href="#post-189264">Re: Yay another problem!</a></div>
    <div class="body">Find out what .DEF files are.<br /></div>
    <div class="meta">Posted on 2007-05-17 01:44:09 by Homer</div>
   </div>
   <div class="post" id="post-189266">
    <div class="subject"><a href="#post-189266">Re: Yay another problem!</a></div>
    <div class="body">OK, I&#39;ve got my def file now and it has been included.&nbsp; Everything compiles and gives no errors.&nbsp; I load VB up and call my proc from it and...VB crashes&nbsp; :sad:.&nbsp; So to see what could be going wrong I comment out everything but a message box line in my .dll to see if it is a problem with the code I wrote.&nbsp; It compiles and crashes again when VB calls it.&nbsp; so now I effectively have only the following code in my dll: (Below)&nbsp; I&#39;m thinking there is something going wrong when VB loads the dll or tries to access it but what?&nbsp; Any guesses?&nbsp; Sorry about the noob questions, guys.&nbsp; I am still...well new...at win32 asm. <br /><br />.Const<br /><br />.Data?<br /><br />.Data<br />Msg DB &quot;Inside Crypty Proc now&quot;, 0<br />MsgTitle DB &quot;Test title&quot;, 0<br /><br />hInstEntry	HINSTANCE	NULL<br /><br />.Code<br /><br />DllEntryPoint Proc Private hInstance:HINSTANCE, dwReason:DWord, lpvReserved:LPVOID<br />	.If dwReason == DLL_PROCESS_ATTACH<br />		Mov Eax, hInstance<br />		Mov hInstEntry, Eax<br />	.ElseIf dwReason == DLL_PROCESS_DETACH<br /><br />	.ElseIf dwReason == DLL_THREAD_ATTACH<br /><br />	.ElseIf dwReason == DLL_THREAD_DETACH<br /><br />	.EndIf<br />	Return TRUE<br />DllEntryPoint EndP<br /><br /><br />CryptyFile Proc Public InFileName:DWord, KeyFileName:DWord, OutFileName:DWord, KeyOffset:DWord, hInst:HINSTANCE<br /><br />Start:	<br />	Invoke MessageBox, hInst, Addr Msg, Addr MsgTitle, MB_OK<br />	Ret<br /><br />CryptyFile EndP<br /><br />End DllEntryPoint</div>
    <div class="meta">Posted on 2007-05-17 07:44:06 by Command_Prompt</div>
   </div>
   <div class="post" id="post-189267">
    <div class="subject"><a href="#post-189267">Re: Yay another problem!</a></div>
    <div class="body">What calling convention does VB use?<br /><br />BTW: as you can see, high-level languages &#39;hide&#39; many things from coder&#39;s eyes. In asm you have to know much more than a HLL coder ;)</div>
    <div class="meta">Posted on 2007-05-17 08:50:25 by ti_mo_n</div>
   </div>
   <div class="post" id="post-189269">
    <div class="subject"><a href="#post-189269">Re: Yay another problem!</a></div>
    <div class="body">VB uses _stdcall as far as I know.&nbsp; The sad thing is that I have this procedure working in the dos-asm version and it works great.&nbsp; I just can&#39;t get it to work in windows dll version.&nbsp; I timed how long it took the VB version as well and it took ~35 seconds to run through a 10mb file while the dos asm version did the same thing in just over 2 seconds.&nbsp; Needless to say I&#39;m sold on the asm version...if only I can get it to work here...Gaaaaaaaaah!</div>
    <div class="meta">Posted on 2007-05-17 11:02:30 by Command_Prompt</div>
   </div>
   <div class="post" id="post-189271">
    <div class="subject"><a href="#post-189271">Re: Yay another problem!</a></div>
    <div class="body">If you could attach the VB code along with the ASM dll anyone who whishes to should be able to help you find the cause ^^</div>
    <div class="meta">Posted on 2007-05-17 16:29:42 by ti_mo_n</div>
   </div>
   <div class="post" id="post-189273">
    <div class="subject"><a href="#post-189273">Re: Yay another problem!</a></div>
    <div class="body">Try the following line.<br /><br /><pre><code>Invoke MessageBox, 0, Addr Msg, Addr MsgTitle, MB_OK</code></pre><br /><br />Maybe, just maybe, the MessageBox API could not digest the handle of an instance instead of the expected handle of a window (0 being allowed).<br /><br />Raymond<br /></div>
    <div class="meta">Posted on 2007-05-17 21:33:21 by Raymond</div>
   </div>
   <div class="post" id="post-189279">
    <div class="subject"><a href="#post-189279">Re: Yay another problem!</a></div>
    <div class="body">Good call and thanks, Raymond!&nbsp; The message box pops up now (woot!) but when I click the ok button after to close the message box VB still crashes&nbsp; :sad:<br /><br />the vb code as it is now (for dll testing) is simply as shown below with only a single window and one command button (to call the dll).<br /><br /><br /><br /><br />Option Explicit<br />Private Declare Sub CryptyFile Lib &quot;E:\Crypty DLL\Debug\Crypty.dll&quot; (ByRef Infile As String, ByRef Keyfile As String, ByRef Outfile As String, ByVal Offset As Long)<br /><br />Private Sub Command1_Click()<br />Call CryptyFile(&quot;c:\source.txt&quot;, &quot;C:\key.txt&quot;, &quot;C:\out.txt&quot;, 1)<br />End Sub<br /><br /></div>
    <div class="meta">Posted on 2007-05-18 09:23:16 by Command_Prompt</div>
   </div>
   <div class="post" id="post-189280">
    <div class="subject"><a href="#post-189280">Re: Yay another problem!</a></div>
    <div class="body">Sweet!&nbsp; I got the message boxes to work now and the file name arguments are processed correctly.&nbsp; VB Code is:<br /><br />Option Explicit<br />Private Declare Sub CryptyFile Lib &quot;E:\Crypty DLL\Debug\Crypty.dll&quot; (ByVal Infile As String, ByVal Keyfile As String, ByVal Outfile As String, Offset As Long)<br /><br />Private Sub Command1_Click()<br />Call CryptyFile(&quot;c:\source.txt&quot;, &quot;C:\key.txt&quot;, &quot;C:\out.txt&quot;, 1)<br />End Sub<br /><br />and the messagebox invokes are:<br />	Invoke MessageBox, 0, OutFileName, Addr Title, MB_OK<br /><br /><br />Thanks so far guys!&nbsp; I was doubting I whether I could get even this far.&nbsp; Hopefully the next steps will be a breeze now!</div>
    <div class="meta">Posted on 2007-05-18 09:37:00 by Command_Prompt</div>
   </div>
   <div class="post" id="post-189285">
    <div class="subject"><a href="#post-189285">Re: Yay another problem!</a></div>
    <div class="body">Retrospective wisdom:<br /><br />Whenever I stumble, whenever I feel trapped, whenever I am challenged by problems, whenever I am &#39;pressing my envelope&#39;, I have learned to view that as a positive experience, regardless of the actual outcome... it means I&#39;m about to learn something, I&#39;m about to grow.<br />If you&#39;re not challenged by what you do, then you are stagnating, decaying, dying. Keep pressing that envelope, expand your horizons !!<br /><br /></div>
    <div class="meta">Posted on 2007-05-18 23:13:15 by Homer</div>
   </div>
   <div class="post" id="post-189286">
    <div class="subject"><a href="#post-189286">Re: Yay another problem!</a></div>
    <div class="body">One last question (hopefully).&nbsp; So everything is working well.&nbsp; no crashes or anything, files encrypt and decrypt fine&nbsp; :D.&nbsp; I am however still trying to get to get one last thing working.&nbsp; One of the arguments is a DWord (Long) that tells where in the key file to start reading.&nbsp; I call this and then try to read and I get a readbyte length of 0.&nbsp; Here is my code (or at least the parts that matter):&nbsp; Opening and writing works fine unless I try to set file pointer.&nbsp; Then it reads a length of 0 and doesn&#39;t write.&nbsp; I get the feeling this will be something simple (read stupid) that I overlooked.&nbsp; Any ideas would be great as this should pretty much be the last problem before my first ever win32 asm library is set to go&nbsp; :D!<br /><br /><br /><br />.data<br />...<br />variables ect...<br />...<br /><br />.code<br /><br />OffsetTest Proc Public InFileName:DWord, OutFileName:DWord, <strong>KeyOffset:DWord</strong><br />;// Open Source file for read //<br />&nbsp; &nbsp; Invoke CreateFile, InFileName, GENERIC_READ, 0, NULL, OPEN_EXISTING, NULL, NULL<br />&nbsp; &nbsp; Mov hInFile, Eax<br /><br />;// Create the output file for write //<br />&nbsp; &nbsp; Invoke CreateFile, OutFileName, GENERIC_WRITE, NULL, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL	;Create Output file<br />&nbsp; &nbsp; Mov hOutFile, Eax	;Store Output file&#39;s handle<br /><br />; Set file pointer in source file<br />	Invoke 	SetFilePointer, hInFile, KeyOffset, NULL, FILE_BEGIN<br />	Cmp BytesRead, 0FFFFFFFFH<br />	Je Read_Done<br />_Read:<br />;// Read 256 bytes from Source and Key files<br />&nbsp; &nbsp; Invoke ReadFile, hInFile, Addr InFileBuffer, 256, Addr BytesRead, NULL<br />	Cmp BytesRead, FALSE			;make sure data was read<br />	Je Read_Done					;If not then exit<br /><br />;writing routine stuff...<br /><br /><strong>; Here the program always goes to Read_Done and the output file length is always 0</strong><br /><br />Read_Done:<br />... end of proc stuff<br /><br /></div>
    <div class="meta">Posted on 2007-05-18 23:26:37 by Command_Prompt</div>
   </div>
   <div class="post" id="post-189289">
    <div class="subject"><a href="#post-189289">Re: Yay another problem!</a></div>
    <div class="body">Do you close your files somewhere?<br /><br />Raymond<br /></div>
    <div class="meta">Posted on 2007-05-19 10:01:39 by Raymond</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=25968&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=25968&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="25968" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=25968&amp;page=2">&gt;</a><a href="../?id=25968&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>