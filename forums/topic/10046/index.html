<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>UNICODE macro - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10046" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=10046">UNICODE macro</a></p>
   <div class="post" id="post-75147">
    <div class="subject"><a href="#post-75147">UNICODE macro</a></div>
    <div class="body">I searched high and low but could not find Ernie Murphy's macro for unicode strings so I have written another that is working OK but does not do exactly what I need it to do.<br /><pre><code><br />      USTRING MACRO vname,text<br />        LOCAL label,x<br />        item CATSTR &lt;vname&gt;,&lt; dw &gt;<br />          FORC x, &lt;text&gt;<br />              item CATSTR item,&lt;&quot;&gt;,&lt;x&gt;,&lt;&quot;,&gt;<br />          ENDM<br />        item CATSTR item,&lt;0&gt;<br />        item<br />      ENDM<br /><br />    .data<br />      USTRING var1, &lt; This is a test &gt;<br /></code></pre><br />What I would like to be able to do is control the formatting of the string in the .DATA section with normal quotation marks so that it would be entered in this form.<br /><pre><code><br />    USTRING var1, &quot; This is a test &quot;<br /></code></pre><br />I set up a test piece and could get it to filter out the quotations by doing a comparison,<br /><pre><code><br />    IF x eq 34<br />      goto label<br />    ENDIF<br /></code></pre><br />The result is written correctly but MASM drops an error then for every character generated by the FORC loop.<br /><br />I would be interested to see if anyone has done a viable UNICODE macro that can handle the format that I am after or alternatively knows how to get around the problem I had with filtering characters.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-01-08 17:42:48 by hutch--</div>
   </div>
   <div class="post" id="post-75187">
    <div class="subject"><a href="#post-75187">UNICODE macro</a></div>
    <div class="body">The errors might result from using reserved words?<pre><code>USTRING MACRO vname, txt<br />	LOCAL x, item<br /><br />	item TEXTEQU &lt;&gt;<br /><br />	FORC x, &lt;txt&gt;<br />		IFDIF &lt;&quot;&gt;, &lt;&amp;x&gt;<br />			item CATSTR item,&lt;&quot;&gt;,&lt;x&gt;,&lt;&quot;,&gt;<br />		ENDIF<br />	ENDM<br /><br />	vname dw item 0<br />ENDM<br /><br /><br />      USTRING var1, &quot; This is a test &quot;</code></pre></div>
    <div class="meta">Posted on 2003-01-08 22:31:28 by bitRAKE</div>
   </div>
   <div class="post" id="post-75200">
    <div class="subject"><a href="#post-75200">UNICODE macro</a></div>
    <div class="body"><pre><code><br />TCHAR macro nam, txt<br />    ifdef _UNICODE_<br />        ; do wide char<br />    else<br />        name db txt, 0<br />    endif<br />endm<br /></code></pre></div>
    <div class="meta">Posted on 2003-01-09 01:41:09 by gfalen</div>
   </div>
   <div class="post" id="post-75230">
    <div class="subject"><a href="#post-75230">UNICODE macro</a></div>
    <div class="body">Steve, try my collection of strings macros.<br />I bet you'll like it.<br />You can simply define non/labeled non/aligned ansi/unicode text in data or rdata section.<br /><pre><code>invoke MessageBoxW, NULL, $CTW0&#40;&quot;Cool program\nCopyright ? Cool Coder, 2003&quot;&#41;, $CTW0&#40;&quot;About&quot;&#41;, MB_OK</code></pre><br />At the top of Strings.mac you will find many examples how to use it.</div>
    <div class="meta">Posted on 2003-01-09 05:14:41 by Four-F</div>
   </div>
   <div class="post" id="post-75234">
    <div class="subject"><a href="#post-75234">Re: UNICODE macro</a></div>
    <div class="body"><div class="quote"><br />I searched high and low but could not find Ernie Murphy's macro for unicode strings so I have written another that is working OK but does not do exactly what I need it to do.<br /></div><br /><br />The Ernie Murphy's macro for Unicode strings is &quot;colib11\masm32\COM\include\L.inc&quot; file. You can download the whole com package in <a target="_blank" href="http://com4me.net/win32asm/fichiers/colib11.zip.">http://com4me.net/win32asm/fichiers/colib11.zip.</a><br /><br />I also attach the code in L.inc here.<br /><pre><code><br />;-------------------------------------------------------------------------------<br />; L.inc    Macro to produce wide character strings<br />;<br />;  revised 2/26/01 complete re-write to simplify<br />;                   also add a back the backslash char<br />;<br />; copyright &#40;c&#41; July 30, 2000 Ernest Murphy<br />; For educational use only. Any commercial re-use only by written license<br />;<br />; Special codes&#58;<br />;<br />;       \0      trailing zero<br />;       \|      exclamation point '!'<br />;       \n      new line &#40;13,10&#41;<br />;       \\      single backslash    '\'<br />;<br />;-------------------------------------------------------------------------------<br /><br />wchar   typedef     word<br /><br />L MACRO sText&#58;REQ<br />    LOCAL str, chr, flag, cchr<br />        cchr TEXTEQU &lt;&gt;<br />        str  TEXTEQU &lt;&gt;<br />        flag TEXTEQU &lt;.&gt;<br />        FORC chr, &lt;&amp;sText&gt; <br />            IFIDN flag, &lt;\&gt;     ;; IF flag == '\'  we're in control char mode<br />                IFIDN &lt;&amp;chr&gt;, &lt;\&gt;           ;; '\\' makes a single backslash<br />                    cchr TEXTEQU &lt;&quot;\&quot;&gt;      ;; just as in C<br />                ENDIF<br />                IFIDN &lt;&amp;chr&gt;, &lt;|&gt;           ;; a pipe gives '!'<br />                    cchr TEXTEQU &lt;&quot;!!&quot;&gt;     ;; need 2 because of macro alias<br />                ENDIF<br />                IFIDN &lt;&amp;chr&gt;, &lt;n&gt;           ;;  &quot;n&quot; gives a new line<br />                    cchr TEXTEQU &lt;13,10&gt;<br />                ENDIF<br />                IFIDN &lt;&amp;chr&gt;, &lt;0&gt;           ;; an &quot;0&quot; &#40;terminating zero&#41;<br />                    cchr TEXTEQU &lt;0&gt;<br />                ENDIF<br />                flag TEXTEQU &lt;.&gt;<br />            ELSE                ;; ELSE, not in control mode<br />                IFIDN &lt;&amp;chr&gt;, &lt;\&gt;           ;; if chr =='\', go to control mode<br />                    flag TEXTEQU &lt;\&gt;<br />                    cchr TEXTEQU &lt;&gt;<br />                ELSE                        ;; else must be a regular char<br />                    cchr CATSTR &lt;&quot;&gt;, &lt;chr&gt;, &lt;&quot;&gt; <br />                ENDIF<br />            ENDIF<br />            IFDIF str, &lt;&gt;                   ;; need a comma before we add new<br />                IFDIF flag, &lt;\&gt;<br />                    str CATSTR str, &lt;,&gt;<br />                ENDIF<br />            ENDIF<br />            IFDIF cchr, &lt;&gt;                  ;; check we don't add a blank<br />                str CATSTR str, &amp;cchr<br />            ENDIF<br />        ENDM<br />        EXITM str<br />    ENDM<br /></code></pre></div>
    <div class="meta">Posted on 2003-01-09 05:47:18 by yoursguideline</div>
   </div>
   <div class="post" id="post-75256">
    <div class="subject"><a href="#post-75256">UNICODE macro</a></div>
    <div class="body">Rickey,<br /><br />Thanks for the example, the IFDIF was exactly what I needed and I have it working correctly.<br /><br />Also thanks to everyone else who posted suggestions, I will have a look at the different code as I get time.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-01-09 08:24:14 by hutch--</div>
   </div>
   <div class="post" id="post-75679">
    <div class="subject"><a href="#post-75679">UNICODE macro</a></div>
    <div class="body">Is UNICODE only LATIN chars?</div>
    <div class="meta">Posted on 2003-01-11 13:22:43 by Nexo</div>
   </div>
   <div class="post" id="post-75701">
    <div class="subject"><a href="#post-75701">UNICODE macro</a></div>
    <div class="body">Nexo,<br /><br />I think UNICODE with its 64k range can do a much wider range of character sets with the emphasis being on character sets like chinese, hebrew, arabic, cyrillic and others that do not fit well into the latin character set.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-01-11 16:37:22 by hutch--</div>
   </div>
   <div class="post" id="post-75769">
    <div class="subject"><a href="#post-75769">UNICODE macro</a></div>
    <div class="body">Ok, hutch--. These macros cant generate UNICODE string. It is generate WORDs ANSI (WIDE) characters string. I never see macro, which can generate UNICODE string. This feature must be supported by assembler, obviously.</div>
    <div class="meta">Posted on 2003-01-12 02:13:39 by Nexo</div>
   </div>
   <div class="post" id="post-80135">
    <div class="subject"><a href="#post-80135">UNICODE macro</a></div>
    <div class="body">Hutch, i guess you dont come by the COM section too often ;)<br /><br />I just dont like the L.inc so i wrote my own as well about a month earlier.  Its pretty ez to use, and can produce alot of raw unicode quickly! Just look at the example ;)<br /><br /><a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=9273">Unicode made E-Z</a><br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2003-02-05 21:59:03 by NaN</div>
   </div>
   <div class="post" id="post-82756">
    <div class="subject"><a href="#post-82756">UNICODE macro</a></div>
    <div class="body">Hi!<br />All those macros works properly only with english texts and never with national alphabets. So if you use greek, hungarian, bulgarian etc. u need this API<br /><br />invoke lstrlen, addr Buf<br />invoke MultiByteToWideChar, CP_ACP,	; code page<br />MB_PRECOMPOSED,			; standard conversion<br />addr Buf,				; input string<br />eax,				; and it's length<br />addr Buf1,			; output (Unicode)<br />1000	 			; max length<br /><br />Mike</div>
    <div class="meta">Posted on 2003-02-20 05:34:11 by Mike</div>
   </div>
   <div class="post" id="post-84256">
    <div class="subject"><a href="#post-84256">UNICODE macro</a></div>
    <div class="body">I agree with Nexo, these all macros are about Wide Char, not Unicode.<br />AFAIK simple use of Unicode with national char sets might be done<br />with resources.</div>
    <div class="meta">Posted on 2003-02-28 19:23:28 by The Svin</div>
   </div>
  </div>
 </body>
</html>