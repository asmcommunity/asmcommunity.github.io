<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>My few problems - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=24644" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=24644">My few problems</a></p>
   <div class="post" id="post-180066">
    <div class="subject"><a href="#post-180066">My few problems</a></div>
    <div class="body">hello geeks out there,<br /><br />I have few problems in my way of making a registry tweaker.<br /><br />1.)I am unable to colour button of dialog boxes.I have used the message wm_ctlcolorbtn but no use.I have searched the board but couldn&#39;t find a satisfactory answer.<br /><br />2.)Whenever I try to add some controls to my dialog box (i am using winasm) like animation control,progress bar,calendar my application don&#39;t work.I mean with certain controls the application refuses to launch<br /><br />3.)I have created a about dialog box as you can see below and i want to display the message in it.Now both TextOut and DrawText are not working in it.Then I tried to put the text in the caption of a static control but now i am unable to adjust it font.How could i do that? <br /><pre><code><br />.386<br />.model flat,stdcall<br />option casemap:none<br />DlgProcMain PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />DlgProcAbout PROTO :DWORD,:DWORD,:DWORD,:DWORD<br /><br />include /masm32/include/windows.inc<br />include /masm32/include/kernel32.inc<br />include /masm32/include/user32.inc<br />include /masm32/include/gdi32.inc<br />includelib /masm32/lib/user32.lib<br />includelib /masm32/lib/kernel32.lib<br />includelib /masm32/lib/gdi32.lib<br /><br /><br />RGB macro red,green,blue <br />&nbsp; &nbsp; &nbsp; &nbsp; xor eax,eax <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ah,blue <br />&nbsp; &nbsp; &nbsp; &nbsp; shl eax,8 <br />&nbsp; &nbsp; &nbsp; &nbsp; mov ah,green <br />&nbsp; &nbsp; &nbsp; &nbsp; mov al,red <br />endm <br /><br />.DATA<br />mystr db &quot;Mohit Garg Presents OPTIMA&quot;,0<br />DlgNameMain db &quot;IDD_DLG1010&quot;,0<br />DlgNameAbout db &quot;IDD_DLG1024&quot;,0<br />IDB_MAIN equ 10025<br />IDC_BUTTON1017 equ 1017<br />IDC_BUTTON1018 equ 1018<br />IDC_BUTTON1025 equ 1025<br />FontName db &quot;script&quot;,0 <br />.DATA?<br />hInstance HINSTANCE ? <br />CommandLine LPSTR ? <br />hbitmap dd ?<br />.CODE <br />start: <br />	invoke GetModuleHandle,NULL<br />	mov hInstance,eax<br />	invoke DialogBoxParam,hInstance,1010,NULL,addr DlgProcMain,NULL<br />	invoke ExitProcess,eax<br />	<br />DlgProcMain proc hwnd:HWND,uMsg:UINT,wParam:WPARAM,lParam:LPARAM<br />&nbsp; &nbsp; &nbsp; &nbsp;  LOCAL ps:PAINTSTRUCT<br />&nbsp; &nbsp; &nbsp; &nbsp;  LOCAL rc:RECT<br />&nbsp; &nbsp; &nbsp; &nbsp;  LOCAL hdc:HDC<br />&nbsp; &nbsp; &nbsp; &nbsp;  LOCAL hmem:HDC<br />&nbsp; &nbsp; &nbsp;  .IF uMsg==WM_PAINT<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke LoadBitmap,hInstance,10025<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov hbitmap,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke BeginPaint,hwnd,ADDR ps<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov hdc,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke CreateCompatibleDC,hdc<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov hmem,eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke SelectObject,hmem,hbitmap<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke GetClientRect,hwnd,ADDR rc<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke BitBlt,hdc,0,0,rc.right,rc.bottom,hmem,0,0,SRCCOPY<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke DeleteDC,hmem<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  invoke EndPaint,hwnd,addr ps <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax,TRUE&nbsp; &nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp;  .ELSEIF uMsg==WM_COMMAND<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov eax,wParam<br />&nbsp; &nbsp; &nbsp; &nbsp;  and eax,0ffffh<br />&nbsp; &nbsp; &nbsp; &nbsp;  .IF&nbsp; eax==1017<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke PostQuitMessage,NULL<br />&nbsp; &nbsp; &nbsp; &nbsp;  .ELSEIF eax==1018<br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke DialogBoxParam,hInstance,1024,hwnd,addr DlgProcAbout,NULL&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; .ENDIF<br />&nbsp; &nbsp; &nbsp; &nbsp;  mov eax,TRUE<br />&nbsp; &nbsp; &nbsp; &nbsp;  ret <br />&nbsp; &nbsp; &nbsp; &nbsp;  .ELSEIF uMsg==WM_CTLCOLORBTN<br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke SetBkMode,wParam,TRANSPARENT<br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke SetBkColor,wParam,Black<br />&nbsp; &nbsp; &nbsp; &nbsp;  invoke GetStockObject,BLACK_BRUSH<br />&nbsp; &nbsp; &nbsp; &nbsp;  ret<br />&nbsp; &nbsp; &nbsp; &nbsp;  .ELSEIF <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov eax,FALSE <br />	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Ret<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ENDIF<br />DlgProcMain EndP<br />DlgProcAbout proc&nbsp; hwnd:HWND,uMsg:UINT,wParam:WPARAM,lParam:LPARAM<br />LOCAL ps:PAINTSTRUCT<br />LOCAL hdc:HDC<br />LOCAL hbr:HBRUSH<br />LOCAL rc:RECT<br />LOCAL hfont:HFONT<br />RGB 255,115,60<br />invoke CreateSolidBrush,eax<br />mov hbr,eax<br />.IF uMsg==WM_CTLCOLORDLG<br />mov eax,hbr<br />ret<br />RGB 255,115,60<br />invoke CreateSolidBrush,eax<br />mov hbr,eax<br />.ELSEIF uMsg==WM_CTLCOLORSTATIC <br />invoke SetTextColor, wParam, hbr<br /> invoke SetBkMode, wParam, TRANSPARENT<br />invoke GetStockObject,NULL_BRUSH<br />ret<br />.ELSEIF uMsg==WM_COMMAND<br />mov eax,wParam<br />and eax,0ffffh<br />.IF eax==1025<br />invoke EndDialog,hwnd,NULL<br />.ENDIF<br />mov eax,TRUE<br />ret<br />.ELSEIF<br />mov eax,FALSE<br />ret<br />.ELSEIF uMsg==WM_PAINT<br />invoke BeginPaint,hwnd,ADDR ps<br />mov hdc,eax<br />invoke GetClientRect,hwnd,addr ps<br />invoke TextOut,hdc,0,0,ADDR mystr,SIZEOF mystr	<br />invoke EndPaint,hwnd, ADDR ps <br />mov eax,TRUE<br />ret<br />.ENDIF<br />DlgProcAbout EndP<br />end start<br /></code></pre><br /><br /><br /><pre><code><br />;This Resource Script was generated by WinAsm Studio.<br /><br />#define IDD_DLG1010 1010<br />#define IDC_COMBOBOX1012 1012<br />#define IDC_BUTTON1016 1016<br />#define IDC_BUTTON1017 1017<br />#define IDC_BUTTON1018 1018<br />#define IDB_MAIN 10025<br />#define IDD_DLG1024 1024<br />#define IDC_BUTTON1025 1025<br />#define IDC_STATIC1027 1027<br /><br />IDB_MAIN BITMAP DISCARDABLE &quot;c:\img.bmp&quot;<br /><br />IDD_DLG1010 DIALOGEX 0,0,410,223<br />FONT 8,&quot;MS Sans Serif&quot;<br />STYLE 0x90000800<br />EXSTYLE 0x00040309<br />BEGIN<br />	CONTROL &quot;IDC_COMBOBOX1012&quot;,IDC_COMBOBOX1012,&quot;ComboBox&quot;,0x50010003,10,18,394,68,0x00000000<br />	CONTROL &quot;Apply&quot;,IDC_BUTTON1016,&quot;Button&quot;,0x50010000,23,58,81,16,0x00000000<br />	CONTROL &quot;Exit&quot;,IDC_BUTTON1017,&quot;Button&quot;,0x50010000,143,58,81,16,0x00000000<br />	CONTROL &quot;About Me&quot;,IDC_BUTTON1018,&quot;Button&quot;,0x50010000,270,58,81,16,0x00000000<br />END<br /><br />IDD_DLG1024 DIALOGEX 0,0,269,146<br />FONT 8,&quot;MS Sans Serif&quot;<br />STYLE 0x90000800<br />EXSTYLE 0x00040309<br />BEGIN<br />	CONTROL &quot;Thanks&quot;,IDC_BUTTON1025,&quot;Button&quot;,0x50010000,160,123,60,19,0x00000000<br />	CONTROL &quot;Mohit Garg Presents&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OPTIMA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (The ultimate registry Tweaker)&quot;,IDC_STATIC1027,&quot;Static&quot;,0x50000000,8,5,188,87,0x00000000<br />END<br /><br /><br /></code></pre></div>
    <div class="meta">Posted on 2006-04-22 16:05:25 by lonelyboy</div>
   </div>
   <div class="post" id="post-180067">
    <div class="subject"><a href="#post-180067">Re: My few problems</a></div>
    <div class="body">1. wm_ctlcolorbtn does not actually work for push buttons , it is meant for static buttons like group boxes etc...<br /><br />2. For these classes you must call InitCommonControls before you call DialogBoxParam<br /><br />3. Too much code to read so I&#39;ll leave that to someone else ;)<br /><br /></div>
    <div class="meta">Posted on 2006-04-22 16:47:44 by donkey</div>
   </div>
   <div class="post" id="post-180068">
    <div class="subject"><a href="#post-180068">Re: My few problems</a></div>
    <div class="body"><div class="quote"><br />2. For these classes you must call InitCommonControls before you call DialogBoxParam<br /></div><br /><br />Many MAny thanks for this<br /> 8)<br /><br /><div class="quote">wm_ctlcolorbtn does not actually work for push buttons , it is meant for static buttons like group boxes etc...</div><br /><br />Really ? <br /><br /><div class="quote">Too much code to read so I&#39;ll leave that to someone else </div><br /><br />You have already done much my friend on your behalf.Thanks for let me steal your some precious moments<br /><br /></div>
    <div class="meta">Posted on 2006-04-22 17:02:12 by lonelyboy</div>
   </div>
   <div class="post" id="post-180070">
    <div class="subject"><a href="#post-180070">Re: My few problems</a></div>
    <div class="body">You&#39;ll need to look up &quot;owner drawn buttons&quot; - it&#39;s not as bad as it might sound initially :)<br /></div>
    <div class="meta">Posted on 2006-04-22 17:38:33 by f0dder</div>
   </div>
   <div class="post" id="post-180075">
    <div class="subject"><a href="#post-180075">Re: My few problems</a></div>
    <div class="body"><div class="quote">3.)I have created a about dialog box as you can see below and i want to display the message in it.Now both TextOut and DrawText are not working in it.Then I tried to put the text in the caption of a static control but now i am unable to adjust it font.How could i do that?</div><br /><br />If you are using RadASM you can use my font builder addin (on the Project menu) or fill in the following...<br /><br />Arial_10 LOGFONT &lt;-13,0,0,0,400,0,0,0,0,3,2,1,34,&quot;Arial&quot;&gt;<br /><br />The font size (10pt = -13) is calculated as follows<br /><br /><pre><code>invoke GetDC,hwnd<br />mov hDC,eax<br />invoke GetDeviceCaps,hDC,LOGPIXELSY<br />mul PtSize<br />mov ecx,72<br />div ecx<br />neg eax<br />mov LogSize, eax<br />invoke ReleaseDC, hwnd, hDC</code></pre><br /><br />To create the font using the structure above...<br /><pre><code>invoke CreateFontIndirect,offset Arial_10<br />mov ,eax</code></pre><br /><br />To apply the font to the static control, given that the ID of the static is in IDSTATIC<br /><br />invoke SendDlgItemMessage, hDlg, IDSTATIC, WM_SETFONT, hFont, TRUE<br /></div>
    <div class="meta">Posted on 2006-04-22 19:44:39 by donkey</div>
   </div>
  </div>
 </body>
</html>