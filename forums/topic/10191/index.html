<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Getting the relocation address of an EXE file as an image. - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10191" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=10191">Getting the relocation address of an EXE file as an image.</a></p>
   <div class="post" id="post-76404">
    <div class="subject"><a href="#post-76404">Getting the relocation address of an EXE file as an image.</a></div>
    <div class="body">If I worked at it hard enough, I think I could do something I need to do by wading back through the PE stuff I did some time ago as what I want is the relocation address of where the instance handle is stored in what is usually the .rdata section.<br /><br />I wondered if anyone has a reliable quick and dirty method of doing this on a disk image of a loaded PE file.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-01-15 02:47:00 by hutch--</div>
   </div>
   <div class="post" id="post-76491">
    <div class="subject"><a href="#post-76491">Getting the relocation address of an EXE file as an image.</a></div>
    <div class="body">I don't fully understand what you're after, do you want the loaded image address of a certain file offset? If you could explain a bit more I might be able to help you out.<br /><br />Thomas</div>
    <div class="meta">Posted on 2003-01-15 14:37:40 by Thomas</div>
   </div>
   <div class="post" id="post-76503">
    <div class="subject"><a href="#post-76503">Getting the relocation address of an EXE file as an image.</a></div>
    <div class="body">hrm, &quot;reliable&quot; and &quot;quick and dirty&quot; in the same sentence? :P</div>
    <div class="meta">Posted on 2003-01-15 16:02:21 by f0dder</div>
   </div>
   <div class="post" id="post-76512">
    <div class="subject"><a href="#post-76512">Getting the relocation address of an EXE file as an image.</a></div>
    <div class="body">Ah,<br /><br />let me explain, I already have the toys written to dump PE images and save them to disk which is no big deal. I want to test out storing this dumped image as a file or within another EXE file and loading it into allocated memory to run it from within the EXE that stores it. The address of the allocated memory will of course not be 400000h so the start address needs to be changed to reflect the address of the allocated memory.<br /><br />If I remember correctly, as long as the EXE file still has the relocation section, this can be changed so that it will reference the correct address. I guess I can set up the various PE structures to get the ofset of the relocation area and try and do it that way but what I asked was if someone had a quick and dirty way that worked OK.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-01-15 17:18:03 by hutch--</div>
   </div>
   <div class="post" id="post-76527">
    <div class="subject"><a href="#post-76527">Getting the relocation address of an EXE file as an image.</a></div>
    <div class="body">find pe header. find reloc information ofs/size in the pe directory table<br />(do NOT just search for a section called &quot;.reloc&quot;). the relocation information<br />is simple enough to parse. you will handle ABSOLUTE and HIGHLOW reloc<br />items, and ignore the rest. import table is also simple to parse. you may<br />want to convert the PE image to your own easier-to-load format rather<br />than having a fully fledge PE loader. all simple stuff, really.</div>
    <div class="meta">Posted on 2003-01-15 18:01:35 by f0dder</div>
   </div>
   <div class="post" id="post-76612">
    <div class="subject"><a href="#post-76612">Getting the relocation address of an EXE file as an image.</a></div>
    <div class="body">Vasily Pupkin's peloader handles relocs, you can get the source here: <a target="_blank" href="http://www.code.game-deception.com/downloads/peloader.zip">http://www.code.game-deception.com/downloads/peloader.zip</a><br /><br />-stormix</div>
    <div class="meta">Posted on 2003-01-16 05:59:29 by stormix</div>
   </div>
   <div class="post" id="post-76684">
    <div class="subject"><a href="#post-76684">Getting the relocation address of an EXE file as an image.</a></div>
    <div class="body">Didn't <strong>Qweerdy</strong> do <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=10102">something like that</a> to merge a process inside another? IIRC he had written a proc to relocate an image based on the relocation section.<br /><br />Thomas</div>
    <div class="meta">Posted on 2003-01-16 10:41:00 by Thomas</div>
   </div>
  </div>
 </body>
</html>