<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>hooking methods - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=28841" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=113">Low Level Concepts</a> &raquo; <a href="../?id=28841">hooking methods</a></p>
   <div class="post" id="post-203782">
    <div class="subject"><a href="#post-203782">hooking methods</a></div>
    <div class="body">While reading an article on writing rootkits on linux systems, I came across this line-<br /><br />&quot;The simplest way to introduce code into a running kernel is through a loadable kernel module (LKM).&quot;<br /><br />Are there any other (complex ?)ways to inject code into linux kernel ?<br /></div>
    <div class="meta">Posted on 2007-12-02 05:41:49 by shakuni</div>
   </div>
   <div class="post" id="post-203787">
    <div class="subject"><a href="#post-203787">Re: hooking methods</a></div>
    <div class="body">Yeah, like the typical buffer overflow exploits... but this is pretty much at the border of what we can discuss in these forums. There isn&#039;t really any legitimate reason for utilizing such techniques (especially since LKMs are available).<br /><br />If you want to know how to <strong>guard against</strong> such exploits, I suggest you read phrack and zines like that, perhaps hop over to some RCE forums as well...</div>
    <div class="meta">Posted on 2007-12-02 12:32:02 by f0dder</div>
   </div>
   <div class="post" id="post-204131">
    <div class="subject"><a href="#post-204131">Re: hooking methods</a></div>
    <div class="body"><div class="quote"><br />Yeah, like the typical buffer overflow exploits... but this is pretty much at the border of what we can discuss in these forums. There isn&#039;t really any legitimate reason for utilizing such techniques (especially since LKMs are available).<br /><br />If you want to know how to <strong>guard against</strong> such exploits, I suggest you read phrack and zines like that, perhaps hop over to some RCE forums as well...<br /></div><br /><br />Yada Yada, Fodder always hangs out on low level stuff to do nothing more than try discourage everyone. Fodder? Do you work for Microsoft? You know yourself that they are stuck having to give ring zero access to new devices. Other wize, Microsoft would have to make all peripherals. Once you hit ring zero, you can do what ever you want to. Just be sure to block the debug interrupts. DBG1 &amp; DBG3 or they will &quot;BSOD&quot; you in a second.</div>
    <div class="meta">Posted on 2007-12-27 18:05:29 by mrgone</div>
   </div>
   <div class="post" id="post-204133">
    <div class="subject"><a href="#post-204133">Re: hooking methods</a></div>
    <div class="body">No, I don&#039;t work for Microsoft, but I don&#039;t want to help people writing malware.<br /><br />Besides, the original poster asked for linux, not Microsoft, advice... there isn&#039;t any PatchGuard stuff in linux, and there&#039;s a proper &amp; established way to get kernel modules loaded that doesn&#039;t require digital signing of your modules by a central authority.<br /><br />Thus, no legitimate reason to use non-authorized ways to load kernel code. I think you should re-read the two posts in this thread and think about your next reply, <strong>mrgone</strong>.</div>
    <div class="meta">Posted on 2007-12-27 18:20:29 by f0dder</div>
   </div>
   <div class="post" id="post-204134">
    <div class="subject"><a href="#post-204134">Re: hooking methods</a></div>
    <div class="body"><div class="quote"><br />Yada Yada, Fodder always hangs out on low level stuff to do nothing more than try discourage everyone. Fodder? Do you work for Microsoft? You know yourself that they are stuck having to give ring zero access to new devices. Other wize, Microsoft would have to make all peripherals. Once you hit ring zero, you can do what ever you want to. Just be sure to block the debug interrupts. DBG1 &amp; DBG3 or they will &quot;BSOD&quot; you in a second.<br /></div><br /><br />First, what does Microsoft have anything to do with Linux Kernel Modules???<br /><br />Second, f0dder gave the answer that I would expect for something that clearly crosses the line of what we allow. Don&#039;t mistake loosening-up the rules with &quot;free game&quot; on this place.<br /><br />Anyone who knows anything about *nix kernel/driver development would have probably given the same answer.</div>
    <div class="meta">Posted on 2007-12-27 18:25:47 by SpooK</div>
   </div>
   <div class="post" id="post-204137">
    <div class="subject"><a href="#post-204137">Re: hooking methods</a></div>
    <div class="body">Linux? I didn&#039;t know he was talking Linux. I was talking Windows but I am sure it is the same.</div>
    <div class="meta">Posted on 2007-12-27 18:57:08 by mrgone</div>
   </div>
   <div class="post" id="post-204138">
    <div class="subject"><a href="#post-204138">Re: hooking methods</a></div>
    <div class="body"><strong>mrgone:</strong> read his post? I&#039;ll quote it here for you: :)<br /><div class="quote"><br />Are there any other (complex ?)ways to inject code into linux kernel ?<br /></div><br /><br />And yes, it&#039;s the same on Windows, there are <strong>legitimate ways to get to kernel-mode</strong> so you don&#039;t need to <strong><em>inject</em></strong> code into the kernel. Windows <strong>does</strong> have the problem, for 64bit editions, that PatchGuard severely limits what you can do (<a target="_blank" href="http://www.sandboxie.com/index.php?WindowsVista64">SandboxIE</a> being a good example), and Vista requires driver signing which costs money, and again limits what you can do (Microsoft won&#039;t sign just <em>anything</em>). Hobbyists can still run their own drivers, but it requires some boot-time flags, and the drivers won&#039;t run on end-user systems without signing.<br /><br />Before accusing me of &quot;bashing low-level topics&quot;, please realize <strong>what</strong> it is that I&#039;m bashing. And hey, no hard feelings, man :)</div>
    <div class="meta">Posted on 2007-12-27 19:02:39 by f0dder</div>
   </div>
   <div class="post" id="post-204139">
    <div class="subject"><a href="#post-204139">Re: hooking methods</a></div>
    <div class="body">&nbsp; They all must give ring0 access. Once in you are the operating system. All bets are off.</div>
    <div class="meta">Posted on 2007-12-27 19:07:29 by mrgone</div>
   </div>
   <div class="post" id="post-204140">
    <div class="subject"><a href="#post-204140">Re: hooking methods</a></div>
    <div class="body"><div class="quote"><br />They all must give ring0 access. Once in you are the operating system. All bets are off.<br /></div><br />Yes, but there&#039;s a difference in using a published &quot;entry point&quot; that can do credential checking to see if you should be allowed to enter kernel mode, vs. trying to &quot;inject&quot; your code through a bug in the kernel and thus forcing entry.<br /><br />And btw., wrt. &quot;All bets are off&quot;, do read up on patchguard, it&#039;s a nasty beast. And while it <strong>can</strong> be defeated, it&#039;s not something you want to do for real-world code for consumer use, as you&#039;ll be playing a cat-and-mouse game with Microsoft... play by the rules, or choose a different operating system.<br /></div>
    <div class="meta">Posted on 2007-12-27 19:11:59 by f0dder</div>
   </div>
   <div class="post" id="post-204141">
    <div class="subject"><a href="#post-204141">Re: hooking methods</a></div>
    <div class="body"><div class="quote"><br />Linux? I didn&#039;t know he was talking Linux. I was talking Windows but I am sure it is the same.<br /></div><br /><br />&quot;I am sure&quot; != &quot;I know for sure&quot;<br /><br />Ring-0 is Ring-0, but <strong><em>how</em></strong> you are allowed to get there is dependent on the flexibility and security of the OS.<br /><br />From what I have observed throughout the years, most misinformation is dispersed because we try to mold reality to our understanding... probably due to it being psychologically satisfying. The harder, but even more satisfying thing to do is learn, adapt and accept the reality of things.</div>
    <div class="meta">Posted on 2007-12-27 19:25:49 by SpooK</div>
   </div>
   <div class="post" id="post-204203">
    <div class="subject"><a href="#post-204203">Re: hooking methods</a></div>
    <div class="body"><div class="quote">There isn&#039;t really any legitimate reason for utilizing such techniques (especially since LKMs are available).<br /></div><br />There is. I wanted to learn how malwares work so that I can write software that work against them.<br /><br /><div class="quote">If you want to know how to guard against such exploits, I suggest you read phrack and zines like that, perhaps hop over to some RCE forums as well...</div><br /><br />Yes. Already did that,but thought that it is always good to post it here,may be I can get some good info.<br /><br /><div class="quote">and Vista requires driver signing which costs money, and again limits what you can do (Microsoft won&#039;t sign just anything)</div><br /><br />Does this mean that all the info related to getting ring0 using drivers WILL NOT WORK on Vista?<br /><br />Since many legitimate applications, like antivirus applications and system tweaking tools(like System Mechanic) etc,work on the same principles,How would they work?</div>
    <div class="meta">Posted on 2007-12-30 06:19:54 by shakuni</div>
   </div>
   <div class="post" id="post-204205">
    <div class="subject"><a href="#post-204205">Re: hooking methods</a></div>
    <div class="body"><div class="quote"><br /><div class="quote">There isn&#039;t really any legitimate reason for utilizing such techniques (especially since LKMs are available).<br /></div><br />There is. I wanted to learn how malwares work so that I can write software that work against them.<br /></div><br />We&#039;ve heard that one before, and it always tends to sound pretty hollow. I&#039;m sorry if your intentions <strong>are</strong> good, but it&#039;s the same standard reply used by the malware writers (those of them who aren&#039;t clever enough to research the things on their own), and it&#039;s hard to tell intentions across the internet.<br /><br /><div class="quote"><br /><div class="quote">and Vista requires driver signing which costs money, and again limits what you can do (Microsoft won&#039;t sign just anything)</div><br /><br />Does this mean that all the info related to getting ring0 using drivers WILL NOT WORK on Vista?<br /><br />Since many legitimate applications, like antivirus applications and system tweaking tools(like System Mechanic) etc,work on the same principles,How would they work?<br /></div><br />It means you need to boot your machine with a special boot.ini flag while doing development, and that you need to get your driver signed by Microsoft before regular users can use the drivers. Obviously Microsoft will not sign &quot;rootkit_stealth0r.sys&quot;, &quot;prevent_vista_antiDRM.sys&quot;, &quot;fake_OEM_machineid_ACPI.sys&quot; :)<br /><br />The problem with the steps taken in Vista (and XP64) is two-fold:<br /><br />1) getting your driver signed costs money, preventing hobby programmers from releasing drivers (and yes, there&#039;s actually legitimate hobby driver projects, like custom filesystems).<br /><br />2) even with a signed driver, PatchGuard limits what you can do. This includes hooking of system calls. And that hooking is necessary if you want to do <strong>effective</strong> security systems; I already linked to SandBoxIE in <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=28841.msg204138#msg204138">this previous post</a>.<br /></div>
    <div class="meta">Posted on 2007-12-30 06:37:55 by f0dder</div>
   </div>
   <div class="post" id="post-204221">
    <div class="subject"><a href="#post-204221">Re: hooking methods</a></div>
    <div class="body"><div class="quote"><br />There is. I wanted to learn how malwares work so that I can write software that work against them.<br /></div><br /><br />Linux Kernel security is usually in the hands of advanced to expert programmers.<br /><br />Take a look at SELinux, RSBAC and Grsecurity projects for ideas and methods.</div>
    <div class="meta">Posted on 2007-12-30 11:01:58 by SpooK</div>
   </div>
  </div>
 </body>
</html>