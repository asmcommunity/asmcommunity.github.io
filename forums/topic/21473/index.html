<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>dll disassembling (to learn more about the OpenGL implementation) - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=21473" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=21473">dll disassembling (to learn more about the OpenGL implementation)</a></p>
   <div class="post" id="post-162169">
    <div class="subject"><a href="#post-162169">dll disassembling (to learn more about the OpenGL implementation)</a></div>
    <div class="body">Sorry guys, I&#39;m VERY rusty on my Assembler, haven&#39;t been here for a long time!<br />Tried searching for my answers, but didn&#39;t find anything useful quickly and easily!<br /><br />I&#39;m working in OpenGL (and C/C++, Win32), for some performance reasons, I want to find a more direct approach to certain function calls.<br /><br />Background: OpenGL32.dll has loads of functions. Many functions accept a different data type, handled by a different function, but accomplish the same thing. eg. glTexCoord2<strong>f</strong> and glTexCoord2<strong>d</strong> are identical except the one accepts a float (function ends with f) and the other a double (function ends with d). But one function will likely call the other, or they might both jump and call some other function. I want to know where they go, what is the final function, so I can skip a few jumps etc. Also, I know these are implementation specific, so ATI drivers might map differently than nVidia. And Win32 might be different to linux. But Imight be able to find a trend and I just want to know!<br /><br />So, I disassembled OpenGL32.dll, but since I&#39;m rusty, I&#39;m kinda lost a bit.<br />Using dumppe I get to:<br /><br />5ED02BD8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; glTexCoord2d:<br />5ED02BD8 64A118000000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp;  eax,fs:[18h]<br />5ED02BDE FFA0C4080000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jmp&nbsp; &nbsp;  dword ptr <br />5ED02BF0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; glTexCoord2f:<br />5ED02BF0 64A118000000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mov&nbsp; &nbsp;  eax,fs:[18h]<br />5ED02BF6 FFA0CC080000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  jmp&nbsp; &nbsp;  dword ptr <br /><br />Obviously a lookup table! Where to now?<br /><br />Thanx!</div>
    <div class="meta">Posted on 2005-07-18 04:03:39 by SubEvil</div>
   </div>
   <div class="post" id="post-162172">
    <div class="subject"><a href="#post-162172">Re: dll disassembling (to learn more about the OpenGL implementation)</a></div>
    <div class="body">Dump the data at fs:[18h] and see where does eax+8CCh and eax+8C4h points to.</div>
    <div class="meta">Posted on 2005-07-18 05:47:18 by roticv</div>
   </div>
   <div class="post" id="post-162175">
    <div class="subject"><a href="#post-162175">Re: dll disassembling (to learn more about the OpenGL implementation)</a></div>
    <div class="body"><div class="quote"><br />Obviously a lookup table! Where to now?<br /></div><br />Accept that a lookup table is being used and that you can&#39;t do anything about it :)<br /><br />The implementations can change from driver to driver, from version to version. You&#39;re optimizing at a wrong level; premature optimization is the root of all evil.<br /></div>
    <div class="meta">Posted on 2005-07-18 08:00:48 by f0dder</div>
   </div>
   <div class="post" id="post-162376">
    <div class="subject"><a href="#post-162376">Re: dll disassembling (to learn more about the OpenGL implementation)</a></div>
    <div class="body">fs:[18] isnt it nt_tib ??<br />!strct nt_tib on windbg used to show its size as 28 as far as i can remember <br />where does this 8cc and 8ch pop up from ?? :(<br />as far asi remember mattpietreks show tib also shows around 28 <br /><br /></div>
    <div class="meta">Posted on 2005-07-22 05:43:33 by bluffer</div>
   </div>
   <div class="post" id="post-162377">
    <div class="subject"><a href="#post-162377">Re: dll disassembling (to learn more about the OpenGL implementation)</a></div>
    <div class="body">well obvioulsy some other problems :(<br />i googled downlaoded the 300 kb odd opengl32.dll and disassembled it to find it entirely different :(<br /><pre><code><br />7D11FED4 glTexCoord2dv&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EAX,DWORD PTR FS:[18]<br />7D11FEDA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EDX,EAX<br />7D11FEDC&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ADD EDX,DWORD PTR DS:[7D1A4D70]<br />7D11FEE2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EDX,DWORD PTR DS:<br />7D11FEE4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  JMP DWORD PTR DS:<br />7D11FEEA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EAX,EAX<br />7D11FEEC glTexCoord2f&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MOV EAX,DWORD PTR FS:[18]<br />7D11FEF2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EDX,EAX<br />7D11FEF4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ADD EDX,DWORD PTR DS:[7D1A4D70]<br />7D11FEFA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EDX,DWORD PTR DS:<br />7D11FEFC&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  JMP DWORD PTR DS:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;&nbsp; OPENGL32.7D11F388<br />7D11FF02&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EAX,EAX<br />7D11FF04 glTexCoord2fv&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EAX,DWORD PTR FS:[18]<br />7D11FF0A&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EDX,EAX<br />7D11FF0C&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ADD EDX,DWORD PTR DS:[7D1A4D70]<br />7D11FF12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EDX,DWORD PTR DS:<br />7D11FF14&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  JMP DWORD PTR DS:<br />7D11FF1A&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MOV EAX,EAX<br />7D11FF1C glTexCoord2i&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MOV EAX,DWORD PTR FS:[18]<br /></code></pre><br /><br /><pre><code><br />00460078&nbsp; <strong>88 F3 11 7D</strong> 80 F3 11 7D 83 F3 11 7D 8D F3 11 7D&nbsp; ??}??}??}??}<br />00460088&nbsp; 88 F3 11 7D 83 F3 11 7D 83 F3 11 7D 83 F3 11 7D&nbsp; ??}??}??}??}<br />00460098&nbsp; A1 F3 11 7D 8D F3 11 7D 83 F3 11 7D 9C F3 11 7D&nbsp; ??}??}??}??}<br />004600A8&nbsp; 83 F3 11 7D 8D F3 11 7D 83 F3 11 7D 8D F3 11 7D&nbsp; ??}??}??}??}<br />004600B8&nbsp; 83 F3 11 7D 8D F3 11 7D 83 F3 11 7D 8D F3 11 7D&nbsp; ??}??}??}??}<br />004600C8&nbsp; 83 F3 11 7D 8D F3 11 7D 83 F3 11 7D 8D F3 11 7D&nbsp; ??}??}??}??}<br />004600D8&nbsp; 83 F3 11 7D 92 F3 11 7D 83 F3 11 7D A6 F3 11 7D&nbsp; ??}??}??}??}<br /></code></pre><br /><pre><code><br />7D11F388&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  XOR EAX,EAX<br />7D11F38A&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  RETN 8<br /></code></pre><br />well that constant there for vftable gets filled here<br /><pre><code><br />7D1120D9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  LEA ECX,DWORD PTR DS: &lt;-----<br />7D1120E0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  PUSH 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; /Protect = PAGE_READWRITE<br />7D1120E2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----&gt;MOV DWORD PTR DS:[7D1A4D70],ECX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; |<br />7D1120E8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  PUSH 102000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; |AllocationType = MEM_RESERVE|MEM_TOP_DOWN<br />7D1120ED&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  PUSH 5FA00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; |Size = 5FA00 (391680.)<br />7D1120F2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  PUSH 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; |Address = NULL<br />7D1120F4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  CALL DWORD PTR DS:[&lt;&amp;KERNEL32.VirtualAll&gt;; \VirtualAlloc<br /></code></pre><br />so its pretty straight forward it seems <br /><br /><br /><br /><br /><br /><br /></div>
    <div class="meta">Posted on 2005-07-22 06:43:19 by bluffer</div>
   </div>
   <div class="post" id="post-162378">
    <div class="subject"><a href="#post-162378">Re: dll disassembling (to learn more about the OpenGL implementation)</a></div>
    <div class="body">its 8c not 8cc? or 8c4 :(<br /><br />thats available i was thinking how come some one can chage it so drastically <br />and i look at the <br /><br /><pre><code><br />7D1120D9? ? ? ? ? ? ? ? ? ? ? ? ?LEA ECX,DWORD PTR DS: &lt;-----<br /></code></pre><br /><br />i saw it is 1 in eax so its 8c <br /><br />so actually in teb there is pointers to gl <br /><br /><div class="quote"><br />from undocumented ntinternals teb struct <br />PVOID? ? ? ? ? ? ? ? ? ?GlDispatchTable[0x118];<br />? ULONG? ? ? ? ? ? ? ? ? ?GlReserved1[0x1A];<br />? PVOID? ? ? ? ? ? ? ? ? ?GlReserved2;<br />? PVOID? ? ? ? ? ? ? ? ? ?GlSectionInfo;<br />? PVOID? ? ? ? ? ? ? ? ? ?GlSection;<br />? PVOID? ? ? ? ? ? ? ? ? ?GlTable;<br />? PVOID? ? ? ? ? ? ? ? ? ?GlCurrentRC;<br />? PVOID? ? ? ? ? ? ? ? ? ?GlContext;<br /></div><br /><br /><br />and those reactos ppl have created some beautifull documentation which i havent seen yet <br />i mostly look at undocumented_ntinternals but during the googling i catched some <br />pretty good links from reactos documentation? <br /><br />http://reactos.geldorp.nl/de/dd0/struct__TEB.html<br /><br />from above articles deep link<br /><div class="quote"><br />typedef struct _TEB<br />00006 {<br />00007&nbsp; &nbsp; &nbsp; &nbsp;  char blah[0x7C4];<br />00008&nbsp; &nbsp; &nbsp; &nbsp;  PVOID glDispatchTable[0xA3];&nbsp; &nbsp; &nbsp; &nbsp; /* 7C4h */<br />00009&nbsp; &nbsp; &nbsp; &nbsp;  PVOID glReserved1[0xA3];&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* A50h */<br />00010&nbsp; &nbsp; &nbsp; &nbsp;  PVOID glReserved2;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* BDCh */<br />00011&nbsp; &nbsp; &nbsp; &nbsp;  PVOID glSectionInfo;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* BE0h */<br />00012&nbsp; &nbsp; &nbsp; &nbsp;  PVOID glSection;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* BE4h */<br />00013&nbsp; &nbsp; &nbsp; &nbsp;  PVOID glTable;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* BE8h */<br />00014&nbsp; &nbsp; &nbsp; &nbsp;  PVOID glCurrentRC;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* BECh */<br />00015&nbsp; &nbsp; &nbsp; &nbsp;  PVOID glContext;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* BF0h */<br />00016 } TEB, *PTEB;<br /></div><br /><br /></div>
    <div class="meta">Posted on 2005-07-22 07:06:04 by bluffer</div>
   </div>
  </div>
 </body>
</html>