<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ListViews - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=12019" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=12019">ListViews</a></p>
   <div class="post" id="post-92277">
    <div class="subject"><a href="#post-92277">ListViews</a></div>
    <div class="body">Is it possible to change the color of a GIVEN entry in a ListView?<br />Or only set the color of ALL text in that control?<br />Has anyone subclassed it for this?</div>
    <div class="meta">Posted on 2003-04-01 01:49:00 by Homer</div>
   </div>
   <div class="post" id="post-92281">
    <div class="subject"><a href="#post-92281">ListViews</a></div>
    <div class="body">You may possibly use the NMCUSTOMDRAW notifications for such things.</div>
    <div class="meta">Posted on 2003-04-01 02:16:59 by japheth</div>
   </div>
   <div class="post" id="post-92322">
    <div class="subject"><a href="#post-92322">ListViews</a></div>
    <div class="body">check out my article:<br /><a target="_blank" href="http://codeproject.com/useritems/ListView.asp">http://codeproject.com/useritems/ListView.asp</a></div>
    <div class="meta">Posted on 2003-04-01 06:42:27 by wizzra</div>
   </div>
   <div class="post" id="post-92335">
    <div class="subject"><a href="#post-92335">ListViews</a></div>
    <div class="body">guy posted this source code a while back. it will change the the color of one entry of a listview.<br /><br /><pre><code>.586<br />.model flat, stdcall<br /> option casemap &#58;none<br />      <br />      include       \masm32\include\windows.inc<br />      include       \masm32\include\kernel32.inc<br />      include       \masm32\include\user32.inc<br />      include       \masm32\include\comctl32.inc<br />      include       \masm32\include\gdi32.inc<br />      include        listVCdraw.inc<br />      includelib    \masm32\lib\kernel32.lib<br />      includelib    \masm32\lib\user32.lib<br />      includelib    \masm32\lib\comctl32.lib<br />      includelib    \masm32\lib\gdi32.lib <br /><br />      <br />      WinMain       PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />      WndProc       PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />      TopXY         PROTO &#58;DWORD,&#58;DWORD<br /><br />        return MACRO arg<br />          mov eax, arg<br />          ret<br />        ENDM<br /><br /><br />InsertColumn MACRO handle,txt,width<br />      LOCAL lbl<br />      LOCAL strng<br />      jmp lbl<br />      strng db txt,0<br />  lbl&#58;<br />      mov col.imask,LVCF_TEXT or LVCF_WIDTH<br />      mov col.fmt,0<br />      mov col.lx,width<br />      mov col.pszText,offset strng<br />      invoke lstrlen,offset strng<br />      mov col.cchTextMax,eax<br />      invoke SendMessage,handle,LVM_INSERTCOLUMN,0,addr col<br />ENDM<br />      <br />.data<br />      ClassName     db &quot;Starting Template&quot;,0<br />      CaptionText   db &quot;Adding an item and subitems to a listview&quot;,0<br />      LvClassName   db &quot;SysListView32&quot;,0<br />      text1         db &quot;item 1&quot;,0<br />      text2         db &quot;subitem 1&quot;,0<br />      text3         db &quot;subitem 2&quot;,0<br />      text4         db &quot;subtiem 3&quot;,0<br />      <br /><br />.const<br />      LVM_GETSUBITEMRECT equ LVM_FIRST + 56 <br />       <br />.data?<br />      hWnd          HANDLE   ?<br />      hInstance     HANDLE   ?<br />      hListView     HANDLE   ?<br />      col           LVCOLUMN &lt;&gt;<br />      item          LVITEM   &lt;&gt;<br />      hdc           HDC       ?<br />      ps            PAINTSTRUCT &lt;&gt;<br />      rect          RECT &lt;&gt;<br /><br />.code<br /> start&#58;<br />      invoke GetModuleHandle, NULL<br />      mov hInstance, eax<br />      invoke WinMain,hInstance,NULL,NULL,SW_SHOWDEFAULT<br />      invoke ExitProcess,eax<br />      invoke InitCommonControls<br /><br />; ######################################<br /><br />WinMain proc hInst     &#58;DWORD,<br />             hPrevInst &#58;DWORD,<br />             CmdLine   &#58;DWORD,<br />             CmdShow   &#58;DWORD<br /><br />      ;====================<br />      ; Put LOCALs on stack<br />      ;====================<br /><br />      LOCAL  wc   &#58;WNDCLASSEX<br />      LOCAL  msg  &#58;MSG<br />      LOCAL  Wwd  &#58;DWORD<br />      LOCAL  Wht  &#58;DWORD<br />      LOCAL  Wtx  &#58;DWORD<br />      LOCAL  Wty  &#58;DWORD<br /><br />      ;==================================================<br />      ; Fill WNDCLASSEX structure with required variables<br />      ;==================================================<br /><br />         mov    wc.cbSize,       SIZEOF WNDCLASSEX<br />	 mov    wc.style,        CS_HREDRAW + CS_VREDRAW<br />	 mov    wc.lpfnWndProc,  OFFSET WndProc<br />	 mov    wc.cbClsExtra,   NULL<br />	 mov    wc.cbWndExtra,   NULL<br />	 mov    eax,             hInstance<br />	 mov    wc.hInstance,    eax<br />         invoke LoadIcon,        NULL,IDI_APPLICATION<br />	 mov    wc.hIcon,        eax<br />	 mov    wc.hIconSm,      eax<br />	 invoke LoadCursor,      NULL,IDC_ARROW<br />	 mov    wc.hCursor,      eax<br />	 mov    wc.hbrBackground,COLOR_BTNFACE+1<br />	 mov    wc.lpszMenuName, NULL<br />	 mov    wc.lpszClassName,OFFSET ClassName<br /><br /><br />	 invoke RegisterClassEx, addr wc<br /><br />      ;================================<br />      ; Centre window at following size<br />      ;================================<br /><br />      mov    Wwd, 500<br />      mov    Wht, 350<br /><br />      invoke GetSystemMetrics,SM_CXSCREEN<br />      invoke TopXY,Wwd,eax<br />      mov    Wtx, eax<br /><br />      invoke GetSystemMetrics,SM_CYSCREEN<br />      invoke TopXY,Wht,eax<br />      mov    Wty, eax<br /><br />      invoke CreateWindowEx,NULL,<br />     			    ADDR ClassName,<br />     			    ADDR CaptionText,<br />     			    WS_OVERLAPPEDWINDOW,<br />     			    Wtx,Wty,Wwd,Wht,<br />     			    NULL,<br />     			    NULL,<br />     			    hInst,<br />     			    NULL<br />      mov    hWnd,eax<br /><br />      invoke ShowWindow,hWnd,SW_SHOWNORMAL<br />      invoke UpdateWindow,hWnd<br /><br />      ;===================================<br />      ; Loop until PostQuitMessage is sent<br />      ;===================================<br /><br />    StartLoop&#58;<br />      invoke GetMessage,ADDR msg,NULL,0,0<br />      cmp eax, 0<br />      je ExitLoop<br />      invoke TranslateMessage, ADDR msg<br />      invoke DispatchMessage,  ADDR msg<br />      jmp StartLoop<br />    ExitLoop&#58;<br /><br />	mov     eax,msg.wParam<br />	ret<br /><br />WinMain endp<br /><br />; ###################################<br /><br />WndProc proc hWin    &#58;HWND,<br />			     uMsg    &#58;UINT,<br />             wParam  &#58;WPARAM,<br />             lParam  &#58;LPARAM<br /><br /><br />.IF uMsg==WM_DESTROY<br />		invoke PostQuitMessage,NULL<br /><br />.ELSEIF uMsg==WM_CREATE<br /><br />      invoke CreateWindowEx,NULL,<br />     			     ADDR LvClassName,<br />     			     NULL,<br />     			     WS_CHILD + WS_VISIBLE + LVS_REPORT+LVS_SHOWSELALWAYS+LVS_SINGLESEL,<br />     			     0,0,491,250,<br />     			     hWin,<br />     			     NULL,<br />     			     hInstance,<br />     			     NULL<br />      mov    hListView,eax<br />      invoke SendMessage,hListView,LVM_SETTEXTCOLOR,0,0<br /><br /><br />      invoke SendMessage,hListView,LVM_SETEXTENDEDLISTVIEWSTYLE,0,LVS_EX_GRIDLINES<br /><br />      InsertColumn hListView, &quot;Column 4&quot; ,122<br />      InsertColumn hListView, &quot;Column 3&quot; ,122<br />      InsertColumn hListView, &quot;Column 2&quot; ,122<br />      InsertColumn hListView, &quot;Column 1&quot; ,122<br />      mov item.iItem,0<br />      mov item.iSubItem,0<br />      mov item.imask,LVIF_TEXT<br />      mov item.pszText,offset text1<br />      mov item.cchTextMax,sizeof text1<br />      invoke SendMessage,hListView,LVM_INSERTITEM,0,addr item<br />      <br />      mov item.imask,LVIF_TEXT<br />      mov item.iSubItem,1      <br />      mov item.pszText,offset text2<br />      mov item.cchTextMax,sizeof text2<br />      invoke SendMessage,hListView,LVM_SETITEM,0,addr item<br /><br />      mov item.imask,LVIF_TEXT<br />      mov item.iSubItem,2      <br />      mov item.pszText,offset text3<br />      mov item.cchTextMax,sizeof text3<br />      invoke SendMessage,hListView,LVM_SETITEM,0,addr item<br /><br />      mov item.imask,LVIF_TEXT<br />      mov item.iSubItem,3      <br />      mov item.pszText,offset text4<br />      mov item.cchTextMax,sizeof text4<br />      invoke SendMessage,hListView,LVM_SETITEM,0,addr item<br /><br /><br />            .elseif uMsg==WM_NOTIFY<br />	       mov edi,lParam<br />             assume edi&#58;ptr NMHDR<br />		 mov eax,&#91;edi&#93;.hwndFrom<br />		.if eax==hListView<br />		.if &#91;edi&#93;.code == LVN_ITEMCHANGED <br /><br />             assume edi&#58;ptr NMHDR<br /><br />            .elseif &#91;edi&#93;.code==NM_CUSTOMDRAW<br />             assume edi&#58;ptr NMLVCUSTOMDRAW<br />            .if CDDS_SUBITEM || CDDS_ITEMPREPAINT<br />            .if  &#91;edi&#93;.iSubItem == 2<br />             mov &#91;edi&#93;.clrTextBk,0080FFFFh ;Background text = yellow<br />             mov &#91;edi&#93;.clrText,000000FFh   ; text color = red<br />            .else<br />             mov &#91;edi&#93;.clrTextBk,0FFFFFFh  ;Background text = white<br />             mov &#91;edi&#93;.clrText,00h         ; text color = black<br />            .endif<br />            .endif<br />             return 32<br />            .endif<br />            .endif<br />             return 0<br /><br /><br /><br />.ELSE<br />      invoke DefWindowProc,hWin,uMsg,wParam,lParam<br />      ret<br /><br />.ENDIF<br />      xor eax,eax<br />      ret<br /><br />WndProc endp<br /><br /><br />; ################################<br /><br />TopXY proc wDim&#58;DWORD, sDim&#58;DWORD<br /><br />    shr sDim, 1<br />    shr wDim, 1<br />    mov eax, wDim<br />    sub sDim, eax<br />    mov eax,sDim<br />    ret<br /><br />TopXY endp<br /><br />; ################################<br /><br />end start</code></pre></div>
    <div class="meta">Posted on 2003-04-01 07:34:02 by smurf</div>
   </div>
   <div class="post" id="post-92452">
    <div class="subject"><a href="#post-92452">ListViews</a></div>
    <div class="body">Thanks guys :)</div>
    <div class="meta">Posted on 2003-04-01 19:17:54 by Homer</div>
   </div>
   <div class="post" id="post-92501">
    <div class="subject"><a href="#post-92501">ListViews</a></div>
    <div class="body">So far I have colored columns. <br />I had to source the following constructs (missing from masm includes),<br />which might be handy for someone else...<br /><br />NM_CUSTOMDRAW equ NM_FIRST-12<br />CDDS_PREPAINT equ 1<br />CDDS_ITEM equ 10000h<br />CDDS_ITEMPREPAINT equ (CDDS_ITEM or CDDS_PREPAINT)<br />CDDS_SUBITEM equ 20000h<br /><br />NMCUSTOMDRAW STRUCT<br />    hdr NMHDR &lt;&gt;<br />    dwDrawStage DWORD ?<br />    hdc HDC ?<br />    rc RECT &lt;&gt;<br />    dwItemSpec DWORD ?<br />    uItemState DWORD ?<br />    lItemlParam LPARAM ?<br />NMCUSTOMDRAW ENDS<br />LPNMCUSTOMDRAW typedef ptr NMCUSTOMDRAW <br /><br />NMLVCUSTOMDRAW STRUCT<br />    nmcd       NMCUSTOMDRAW &lt;&gt;<br />    clrText     COLORREF &lt;&gt;<br />    clrTextBk COLORREF &lt;&gt;<br />    iSubItem DWORD ?<br />    dwItemType DWORD ?<br />    clrFace       COLORREF &lt;&gt;<br />    iIconEffect  DWORD ?<br />    iIconPhase DWORD ?<br />    iPartId         DWORD ?<br />    iStateId       DWORD ?<br />    rcText          RECT &lt;&gt;<br />    uAlign          DWORD ?<br />NMLVCUSTOMDRAW ENDS<br />LPNMLVCUSTOMDRAW typedef ptr NMLVCUSTOMDRAW <br /><br />cya.</div>
    <div class="meta">Posted on 2003-04-02 01:30:09 by Homer</div>
   </div>
  </div>
 </body>
</html>