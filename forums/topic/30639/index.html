<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>typedef - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30639" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=30639">typedef</a></p>
   <div class="post" id="post-214885">
    <div class="subject"><a href="#post-214885">typedef</a></div>
    <div class="body">hi everyone<br /><br />somebody know hou to convert this small piece to masm syntax?<br />i thought it was some sort of struct<br /><br /><pre><code>typedef enum _PinDirection {<br />&nbsp; PINDIR_INPUT,<br />&nbsp; PINDIR_OUTPUT<br />} PIN_DIRECTION;<br /></code></pre><br /><br />Kind Regards <br />jpam</div>
    <div class="meta">Posted on 2011-08-18 15:01:01 by jpam</div>
   </div>
   <div class="post" id="post-214886">
    <div class="subject"><a href="#post-214886">Re: typedef</a></div>
    <div class="body"><pre><code>_PinDirection STRUCT<br />&nbsp;  PINDIR_INPUT DB ?<br />&nbsp;  PINDIR_OUTPUT DB ?<br />_PinDirection ENDS<br /><br />PIN_DIRECTION TYPEDEF _PinDirection</code></pre><br /><br />Then you can access the values using:<br /><br /><pre><code>mov eax, PIN_DIRECTION.PINDIR_INPUT<br />mov ebx, _PinDirection.PINDIR_OUTPUT</code></pre><br /><br />That&#039;s probably more of a hack though since _PinDirection and PIN_DIRECTION are supposed to be a DWORD type and this isn&#039;t going to be the case. The following code might be a bit more &quot;correct&quot;...<br /><br /><pre><code>PINDIR_INPUT = 0<br />PINDIR_OUTPUT = 1<br />_PinDirection TYPEDEF DWORD<br />PIN_DIRECTION TYPEDEF _PinDirection</code></pre><br /></div>
    <div class="meta">Posted on 2011-08-18 15:26:24 by Synfire</div>
   </div>
   <div class="post" id="post-214887">
    <div class="subject"><a href="#post-214887">Re: typedef</a></div>
    <div class="body">Nah, an enum is just a way to automatically define a series of constants. It starts at 0, and increases each next constant by 1 (and optionally you can force a constant to a value, and it will continue from there).<br />Basically it says something like this:<br />PINDIR_INPUT equ 0<br />PINDIR_OUTPUT equ 1</div>
    <div class="meta">Posted on 2011-08-18 15:27:48 by Scali</div>
   </div>
   <div class="post" id="post-214889">
    <div class="subject"><a href="#post-214889">Re: typedef</a></div>
    <div class="body">C-Style enumerations don&#039;t have to begin at zero, but they will if you don&#039;t assign any value to the first element in the enum. So they start at zero by default - however you might want to start at, say, 63. I&#039;m not sure why but I&#039;m sure there are situations where this is handy.<br /></div>
    <div class="meta">Posted on 2011-08-19 04:37:15 by Homer</div>
   </div>
   <div class="post" id="post-214890">
    <div class="subject"><a href="#post-214890">Re: typedef</a></div>
    <div class="body">mybe some more info is needed<br /><br />c++ code<br /><br /><pre><code>HRESULT GetUnconnectedPin(<br />&nbsp; &nbsp; IBaseFilter *pFilter,&nbsp;  // Pointer to the filter.<br />&nbsp; &nbsp; PIN_DIRECTION PinDir,&nbsp;  // Direction of the pin to find.<br />&nbsp; &nbsp; IPin **ppPin)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  // Receives a pointer to the pin.<br />{<br />&nbsp; &nbsp; *ppPin = 0;<br />&nbsp; &nbsp; IEnumPins *pEnum = 0;<br />&nbsp; &nbsp; IPin *pPin = 0;<br />&nbsp; &nbsp; HRESULT hr = pFilter-&gt;EnumPins(&amp;pEnum);<br />&nbsp; &nbsp; if (FAILED(hr))<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; return hr;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; while (pEnum-&gt;Next(1, &amp;pPin, NULL) == S_OK)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; PIN_DIRECTION ThisPinDir;<br />&nbsp; &nbsp; &nbsp; &nbsp; pPin-&gt;QueryDirection(&amp;ThisPinDir);<br />&nbsp; &nbsp; &nbsp; &nbsp; if (ThisPinDir == PinDir)<br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IPin *pTmp = 0;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hr = pPin-&gt;ConnectedTo(&amp;pTmp);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (SUCCEEDED(hr))&nbsp; // Already connected, not the pin we want.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pTmp-&gt;Release();<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else&nbsp; // Unconnected, this is the pin we want.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pEnum-&gt;Release();<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *ppPin = pPin;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return S_OK;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; pPin-&gt;Release();<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; pEnum-&gt;Release();<br />&nbsp; &nbsp; // Did not find a matching pin.<br />&nbsp; &nbsp; return E_FAIL;<br />}</code></pre><br /><br />this is a part of the code i have made:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <pre><code>_PinDirection STRUCT<br />&nbsp;  		PINDIR_INPUT equ 0<br />&nbsp;  		PINDIR_OUTPUT equ 1<br />	_PinDirection ENDS<br /><br />	PIN_DIRECTION TYPEDEF _PinDirection<br /><br />	mov eax,PIN_DIRECTION<br />	mov ThisPinDir,eax<br />	<br />	@@:<br />		coinvoke pEnum,IEnumMoniker,Next,1,addr pPin,ADDR pcFetched<br />		cmp eax,0<br />		jne @F<br /><br />		coinvoke pPin,IPin,QueryDirection,addr ThisPinDir<br />		PrintHex eax,&quot;QueryDirection&quot;<br />		PrintDec ThisPinDir ; show Direction<br />		<br />		cmp eax,1<br />		jne @B<br />		<br />		coinvoke pPin,IPin,ConnectedTo,addr ppPin ; CRASH!<br />		PrintHec eax 	; show result<br />		PrintDec ppPin 	; do i have a pointer ?<br />	<br />	@@:</code></pre><br /><br />PrintHex eax,&quot;QueryDirection&quot; gives error code (80004003) Invalid pointer</div>
    <div class="meta">Posted on 2011-08-19 05:25:09 by jpam</div>
   </div>
   <div class="post" id="post-214891">
    <div class="subject"><a href="#post-214891">Re: typedef</a></div>
    <div class="body">Yes I understand the problem.<br /><br /><div class="quote"><br />PIN_DIRECTION ThisPinDir;<br /></div><br /><br />This type is a MEMBER of the enumeration, and an enumeration (and its members) is NOT a struct.<br />In C languages, enumerated values are always (signed) Integers.<br />In other words, PIN_DIRECTION represents a SDWORD whose value is one of those listed in the enumeration - use equ in asm to define the enumerated values, and just &quot;know&quot; that C-style enums are in fact possible values to be assigned to an int.<br /><br />And just to make it absolutely clear,<br /><pre><code><br />PINDIR_INPUT equ 0<br />PINDIR_OUTPUT equ 1<br /><br />PIN_DIRECTION typedef SDWORD<br /><br />local ThisPinDir PIN_DIRECTION; <br /><br /></code></pre><br /><br />Hope that gets you on track :)<br /><br /><br /><br /></div>
    <div class="meta">Posted on 2011-08-19 06:07:26 by Homer</div>
   </div>
   <div class="post" id="post-214893">
    <div class="subject"><a href="#post-214893">Re: typedef</a></div>
    <div class="body">thanks people for looking at my problem !<br /><br />i have tried all the possible solutions<br />but the line; &quot;coinvoke pPin,IPin,QueryDirection,addr ThisPinDir&quot; still crashed<br />i was wondering if my IPin interface is 100% correct<br />i added it myself to the Directshow.inc, because it was not included in my version.<br /><br /><pre><code>sIID_IPin 				TEXTEQU &lt;{056a86891h,00ad4h,011ceh,{0b0h,03ah,000h,020h,0afh,00bh,0a7h,070h}}&gt;<br /><br />_vtIPin MACRO CastName:REQ<br />	; IUnknown methods <br />	_vtIUnknown CastName<br />	; IPin methods&nbsp; <br />	&amp;CastName&amp;_Connect					comethod3	?<br />	&amp;CastName&amp;_ReceiveConnection		comethod3	?<br />	&amp;CastName&amp;_Disconnect				comethod1	?<br />	&amp;CastName&amp;_ConnectedTo				comethod2	?<br />	&amp;CastName&amp;_ConnectionMediaType		comethod2	?<br />	&amp;CastName&amp;_QueryPinInfo				comethod2	?<br />	&amp;CastName&amp;_QueryDirection			comethod2	?	<br />	&amp;CastName&amp;_QueryId					comethod2	?<br />	&amp;CastName&amp;_QueryAccept				comethod2	?<br />	&amp;CastName&amp;_EnumMediaTypes			comethod2	?<br />	&amp;CastName&amp;_QueryInternalConnections	comethod3	?<br />	&amp;CastName&amp;_EndOfStream				comethod1	?<br />	&amp;CastName&amp;_BeginFlush				comethod1	?<br />	&amp;CastName&amp;_EndFlush					comethod1	?<br />	&amp;CastName&amp;_NewSegment				comethod4	?<br />ENDM<br /><br />IPin	STRUCT<br />	_vtIPin	IPin<br />IPin	ENDS</code></pre><br /><br />i hope someone wants to verified my IPin struct<br /></div>
    <div class="meta">Posted on 2011-08-20 13:51:27 by jpam</div>
   </div>
   <div class="post" id="post-214895">
    <div class="subject"><a href="#post-214895">Re: typedef</a></div>
    <div class="body">Hi jpam<br />There is a problem in the interface definition. Check this <a target="_blank" href="http://msdn.microsoft.com/en-us/library/aa925341.aspx">link</a>. It shows the correct order of the methods in the vtable. <br />I have not verified the arguments of the methods.<br /><br />Regards, Biterider</div>
    <div class="meta">Posted on 2011-08-20 23:42:22 by Biterider</div>
   </div>
   <div class="post" id="post-214896">
    <div class="subject"><a href="#post-214896">Re: typedef</a></div>
    <div class="body"><br />Thanks Homer<br />Thanks biterider<br /><br /><br />i corrected the IPin interface, QueryDirection should be the last member<br />i also made a custom comethod for the NewSegment member<br />to correct the bytelenght of the interface<br />it uses 2 qwords and 1 dword<br /><br /><pre><code>comethodCustomProto&nbsp; &nbsp; &nbsp; typedef proto :QWORD, :QWORD, :DWORD<br />comethodCustom	&nbsp; &nbsp; typedef ptr comethodCustomProto</code></pre><br /><br />now the code does not crash anymore :)<br />but the result in ThisPinDir gives me (looks like) a pointer<br />shouldn&#039;t it be 0 or 1 ?</div>
    <div class="meta">Posted on 2011-08-21 06:20:25 by jpam</div>
   </div>
   <div class="post" id="post-214899">
    <div class="subject"><a href="#post-214899">Re: typedef</a></div>
    <div class="body">Hi jpam<br />The result (eax) of the IPin::NewSegment method call is a <a target="_blank" href="http://msdn.microsoft.com/en-us/library/bb401631.aspx">HRESULT</a> value, which may be on of the values listed <a target="_blank" href="http://msdn.microsoft.com/en-us/library/aa919935.aspx">here</a> (S_OK .. E_Fail).<br /><br />Biterider</div>
    <div class="meta">Posted on 2011-08-21 12:10:20 by Biterider</div>
   </div>
   <div class="post" id="post-214901">
    <div class="subject"><a href="#post-214901">Re: typedef</a></div>
    <div class="body">hi biterider<br /><br />i don&#039;t use IPin::NewSegment :)<br />i only corrected the member typedef<br />the HRESULT from IPin::QueryDirection is S_OK<br /></div>
    <div class="meta">Posted on 2011-08-21 13:29:36 by jpam</div>
   </div>
   <div class="post" id="post-214903">
    <div class="subject"><a href="#post-214903">Re: typedef</a></div>
    <div class="body">Hi jpam<br />I think you have to supply a pointer to a PIN_DIRECTION variable, which will be filled on return of the IPin:QueryDirection with PINDIR_INPUT or PINDIR_OUTPUT. eax should contain S_OK indicating that the operation succeeded.<br /><br />Biterider<br /></div>
    <div class="meta">Posted on 2011-08-21 15:29:23 by Biterider</div>
   </div>
   <div class="post" id="post-214913">
    <div class="subject"><a href="#post-214913">Re: typedef</a></div>
    <div class="body">found other solution to grab all frames from video file<br />can&#039;t make that IPin interface working :(<br /><br />here&#039;s a working proc<br /><pre><code>GrabVideoBitmap proc<br />	<br />	LOCAL pBuffer,hBitmap,BitmapSize,hDC,tmpDC,hOLD:dword<br />	LOCAL MediaType:AM_MEDIA_TYPE<br />	LOCAL mt:AM_MEDIA_TYPE<br />	LOCAL bmi:BITMAPINFO<br />	<br />&nbsp; &nbsp; INVOKE CoCreateInstance,addr CLSID_FilterGraph,NULL,CLSCTX_INPROC,ADDR IID_IGraphBuilder,ADDR pGraphBuilder	<br />	INVOKE CoCreateInstance,addr CLSID_SampleGrabber,NULL,CLSCTX_INPROC,addr IID_IBaseFilter,addr pGrabberBaseFilter<br />	<br />	coinvoke pGrabberBaseFilter,ISampleGrabber,QueryInterface,addr IID_ISampleGrabber,addr pSampleGrabber<br />	coinvoke pGraphBuilder,IGraphBuilder,AddFilter,pGrabberBaseFilter,L(&quot;Sample Grabber&quot;)<br />	<br />	invoke RtlZeroMemory,addr mt,sizeof AM_MEDIA_TYPE<br />	invoke RtlMoveMemory,addr mt.majortype,addr MEDIATYPE_Video,sizeof MEDIATYPE_Video<br />	invoke RtlMoveMemory,addr mt.subtype,addr MEDIASUBTYPE_RGB24,sizeof MEDIASUBTYPE_RGB24<br />	invoke RtlMoveMemory,addr mt.formattype,addr FORMAT_VideoInfo,sizeof FORMAT_VideoInfo<br />	coinvoke pSampleGrabber,ISampleGrabber,SetMediaType,addr mt<br />	<br />	coinvoke pGraphBuilder,IGraphBuilder,RenderFile,L(&quot;C:\wg_gdo_1.mpeg&quot;),0<br />	coinvoke pSampleGrabber,ISampleGrabber,SetBufferSamples,TRUE<br />	<br />	coinvoke pGraphBuilder,IGraphBuilder,QueryInterface,addr IID_IVideoWindow,addr pVideoWindow<br />	coinvoke pVideoWindow,IVideoWindow,put_AutoShow,FALSE<br />	<br />	coinvoke pGraphBuilder,IGraphBuilder,QueryInterface,addr IID_IMediaControl,addr pControl<br />	coinvoke pGraphBuilder,IGraphBuilder,QueryInterface,addr IID_IMediaSeeking,addr pSeek<br />	coinvoke pSeek,IMediaSeeking,GetDuration,addr pDuration<br /><br />	coinvoke pControl,IMediaControl,Run<br />	<br />	invoke RtlZeroMemory,addr MediaType,sizeof AM_MEDIA_TYPE<br />	coinvoke pSampleGrabber,ISampleGrabber,GetConnectedMediaType,addr MediaType<br /><br />	invoke RtlZeroMemory,addr bmi,sizeof BITMAPINFO<br />	<br />	push esi<br />	push edi<br />	mov esi,MediaType.pbFormat<br />	lea edi,bmi<br />	mov eax,40		 ;DWORD biSize<br />	mov ,eax<br />	mov eax, ;LONG&nbsp; biWidth<br />	mov ,eax	<br />	mov eax, ;LONG&nbsp; biHeight<br />	mov ,eax<br />	mov ax,1<br />	mov ,ax	 ;WORD&nbsp; biPlanes<br />	mov ax,24		 ;WORD&nbsp; biBitCount<br />	mov ,ax<br />	mov eax,BI_RGB&nbsp;  ;DWORD biCompression<br />	mov ,eax<br />	mov eax, ;DWORD biSizeImage<br />	mov ,eax	<br />	pop edi<br />	pop esi<br />	<br />	@@:<br />	invoke GetDC,hWnd<br />	mov hDC,eax<br />	<br />	invoke CreateCompatibleDC,hDC<br />	mov tmpDC,eax<br />	<br />	invoke CreateDIBSection,hDC,addr bmi,DIB_PAL_COLORS,addr pBuffer,NULL,NULL<br />	mov hBitmap,eax<br />	<br />	invoke SelectObject,tmpDC,hBitmap<br />	mov hOLD,eax<br />	<br />	coinvoke pSampleGrabber,ISampleGrabber,GetCurrentBuffer,addr BitmapSize,NULL<br />	coinvoke pSampleGrabber,ISampleGrabber,GetCurrentBuffer,addr BitmapSize,pBuffer&nbsp;  <br /><br />	invoke BitBlt,hDC,0,0,bmi.bmiHeader.biWidth,bmi.bmiHeader.biHeight,tmpDC,0,0,SRCCOPY<br />	<br />	invoke SelectObject,tmpDC,hOLD<br />	invoke DeleteObject,hBitmap<br />	<br />	invoke ReleaseDC,hWnd,tmpDC<br />	invoke ReleaseDC,hWnd,hDC<br />	<br />	coinvoke pSeek,IMediaSeeking,GetCurrentPosition,addr pCurrent<br />	<br />	fld pCurrent<br />	fcomp pDuration<br />	fnstsw ax<br />	sahf<br />	jb @B<br /><br />	coinvoke pControl,IMediaControl,Stop<br />	call CleanUp<br />	<br />	<br />GrabVideoBitmap endp</code></pre></div>
    <div class="meta">Posted on 2011-08-24 13:37:20 by jpam</div>
   </div>
   <div class="post" id="post-214914">
    <div class="subject"><a href="#post-214914">Re: typedef</a></div>
    <div class="body">I use the SampleGrabber as well in my code (the automatic texture stuff is nice, but lacks control, and is D3D9-only).<br />But still you&#039;ll want to get good pin control if you want to build more advanced capture or decode graphs.</div>
    <div class="meta">Posted on 2011-08-24 16:40:39 by Scali</div>
   </div>
   <div class="post" id="post-214915">
    <div class="subject"><a href="#post-214915">Re: typedef</a></div>
    <div class="body">could you share some example code scali ?<br />i love to see it :)<br /><br />here&#039;s a updated proc<br />the last one had some memory leak issues...<br /><br /><pre><code>GrabVideoBitmap proc<br />	<br />	LOCAL pBuffer,hBitmap,BitmapSize,hDC,tmpDC,hOLD:dword<br />	<br />&nbsp; &nbsp; INVOKE CoCreateInstance,addr CLSID_FilterGraph,NULL,CLSCTX_INPROC,ADDR IID_IGraphBuilder,ADDR pGraphBuilder	<br />	INVOKE CoCreateInstance,addr CLSID_SampleGrabber,NULL,CLSCTX_INPROC,addr IID_IBaseFilter,addr pGrabberBaseFilter<br />	<br />	coinvoke pGrabberBaseFilter,ISampleGrabber,QueryInterface,addr IID_ISampleGrabber,addr pSampleGrabber<br />	coinvoke pGraphBuilder,IGraphBuilder,AddFilter,pGrabberBaseFilter,L(&quot;Sample Grabber&quot;)<br />	<br />	invoke RtlZeroMemory,addr mt,sizeof AM_MEDIA_TYPE<br />	invoke RtlMoveMemory,addr mt.majortype,addr MEDIATYPE_Video,sizeof MEDIATYPE_Video<br />	invoke RtlMoveMemory,addr mt.subtype,addr MEDIASUBTYPE_RGB24,sizeof MEDIASUBTYPE_RGB24<br />	invoke RtlMoveMemory,addr mt.formattype,addr FORMAT_VideoInfo,sizeof FORMAT_VideoInfo<br />	mov mt.cbFormat,0<br />	mov mt.pbFormat,NULL	<br />	coinvoke pSampleGrabber,ISampleGrabber,SetMediaType,addr mt<br />	<br />	coinvoke pGraphBuilder,IGraphBuilder,RenderFile,L(&quot;C:\wg_gdo_1.mpeg&quot;),0<br />	coinvoke pSampleGrabber,ISampleGrabber,SetBufferSamples,TRUE<br />	<br />	coinvoke pGraphBuilder,IGraphBuilder,QueryInterface,addr IID_IVideoWindow,addr pVideoWindow<br />	coinvoke pVideoWindow,IVideoWindow,put_AutoShow,FALSE<br />	<br />	coinvoke pGraphBuilder,IGraphBuilder,QueryInterface,addr IID_IMediaControl,addr pControl<br />	coinvoke pGraphBuilder,IGraphBuilder,QueryInterface,addr IID_IMediaSeeking,addr pSeek<br />	coinvoke pSeek,IMediaSeeking,GetDuration,addr pDuration<br /><br />	coinvoke pControl,IMediaControl,Run<br />	<br />	invoke RtlZeroMemory,addr mt,sizeof AM_MEDIA_TYPE<br />	coinvoke pSampleGrabber,ISampleGrabber,GetConnectedMediaType,addr mt<br /><br />	invoke RtlZeroMemory,addr bmi,sizeof BITMAPINFO<br />	<br />	push esi<br />	push edi<br />	mov esi,mt.pbFormat<br />	lea edi,bmi<br />	mov eax,40		 ;DWORD biSize<br />	mov ,eax<br />	mov eax, ;LONG&nbsp; biWidth<br />	mov ,eax	<br />	mov eax, ;LONG&nbsp; biHeight<br />	mov ,eax<br />	mov ax,1<br />	mov ,ax	 ;WORD&nbsp; biPlanes<br />	mov ax,24		 ;WORD&nbsp; biBitCount<br />	mov ,ax<br />	mov eax,BI_RGB&nbsp;  ;DWORD biCompression<br />	mov ,eax<br />	mov eax, ;DWORD biSizeImage<br />	mov ,eax	<br />	pop edi<br />	pop esi<br />	<br />	invoke GetDC,hwnd <br />	mov hDC,eax<br />	<br />	invoke CreateCompatibleDC,hDC<br />	mov tmpDC,eax<br />	<br />	@@:<br />	<br />	invoke CreateDIBSection,hDC,addr bmi,DIB_PAL_COLORS,addr pBuffer,NULL,NULL<br />	mov hBitmap,eax<br />	<br />	invoke SelectObject,tmpDC,hBitmap<br />	mov hOLD,eax<br />	<br />	coinvoke pSampleGrabber,ISampleGrabber,GetCurrentBuffer,addr BitmapSize,NULL<br />	coinvoke pSampleGrabber,ISampleGrabber,GetCurrentBuffer,addr BitmapSize,pBuffer&nbsp;  <br /><br />	invoke BitBlt,hDC,0,0,bmi.bmiHeader.biWidth,bmi.bmiHeader.biHeight,tmpDC,0,0,SRCCOPY<br />	<br />	invoke SelectObject,tmpDC,hOLD<br />	invoke DeleteObject,hBitmap<br />	<br />	coinvoke pSeek,IMediaSeeking,GetCurrentPosition,addr pCurrent<br />	<br />	fld pCurrent<br />	fcomp pDuration<br />	fnstsw ax<br />	sahf<br />	jb @B<br /><br />	coinvoke pControl,IMediaControl,Stop<br />	<br />	invoke CoTaskMemFree,mt.pbFormat<br />	<br />	invoke ReleaseDC,hwnd,tmpDC<br />	invoke ReleaseDC,hwnd,hDC<br />	<br />	SAFE_RELEASE pSeek<br />	SAFE_RELEASE pControl<br />	SAFE_RELEASE pVideoWindow<br />&nbsp; &nbsp; SAFE_RELEASE pGrabberBaseFilter<br />&nbsp; &nbsp; SAFE_RELEASE pSampleGrabber<br />&nbsp; &nbsp; SAFE_RELEASE pGraphBuilder<br />	<br />	ret<br />	<br />GrabVideoBitmap endp</code></pre></div>
    <div class="meta">Posted on 2011-08-24 17:15:48 by jpam</div>
   </div>
   <div class="post" id="post-214918">
    <div class="subject"><a href="#post-214918">Re: typedef</a></div>
    <div class="body">Yeah I did some stuff years ago under coinvoke i will scratch around in the vaults.. searching here yields nothing, guess those posts were lost during one of the rare disasters we&#039;ve had :( More reason to dig it up I guess.<br /></div>
    <div class="meta">Posted on 2011-08-25 04:16:23 by Homer</div>
   </div>
   <div class="post" id="post-214922">
    <div class="subject"><a href="#post-214922">Re: typedef</a></div>
    <div class="body">Well, I started out from an example I found with Ogre:<br />http://www.ogre3d.org/tikiwiki/DirectShow+video+in+ogre+texture&amp;structure=Cookbook<br />(look a bit below for the CVDShowUtil.cpp file... It&#039;s from the old DirectShow SDK, and shows some pin connecting stuff... Very important... I guess you should try and compile this, then disassemble it, so you can fix your assembly version).<br /><br />I just ripped out the Ogre code and replaced it with Direct3D stuff.<br />Then I refactored it all to make it fit nicely into the VJ software, but that all just overcomplicates things.<br />I have a separate DirectShow decoder which provides frames, and a DynamicTexture which consumes these frames... By keeping the same provider and consumer interfaces, I can easily use other frame providers, such as QuickTime. And I can also use different types of DynamicTexture... Apart from D3D9, 10, 11 I also support decoding to system memory for CPU processing... and I could also support decoding to a Cuda buffer for GPGPU processing etc.</div>
    <div class="meta">Posted on 2011-08-25 08:51:49 by Scali</div>
   </div>
  </div>
 </body>
</html>