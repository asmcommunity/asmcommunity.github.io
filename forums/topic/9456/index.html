<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>VC complier Vs Masm32 assembler - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=9456" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=9456">VC complier Vs Masm32 assembler</a></p>
   <div class="post" id="post-69966">
    <div class="subject"><a href="#post-69966">VC complier Vs Masm32 assembler</a></div>
    <div class="body">Hi all.....<br /><br />   This problem is regarding code mixing....<br /><br />        I have written a procedure in masm and successfully linked with a C file in VC.<br />However due some reason ( which I don't know ) the program crashes... when try to debug it through VC in-built dissembler...<br />                        I receive 1000volt charge because VC insert &quot;leave&quot; instruction before the &quot;ret&quot; in my procedure Which i have not used as result it causes a stack corruption.. <br /><br />How to remove this Leave instruction..............<br /><br />Any idea ??? why is it so??? <br />regards</div>
    <div class="meta">Posted on 2002-12-09 01:02:08 by processingspeed</div>
   </div>
   <div class="post" id="post-69979">
    <div class="subject"><a href="#post-69979">VC complier Vs Masm32 assembler</a></div>
    <div class="body">Are you sure that you declared correctly your function? Maybe,this is the problem.</div>
    <div class="meta">Posted on 2002-12-09 02:32:23 by Vortex</div>
   </div>
   <div class="post" id="post-69992">
    <div class="subject"><a href="#post-69992">VC complier Vs Masm32 assembler</a></div>
    <div class="body">If you assembled it in MASM, it is masm that put it there. If its inline stuff then it could be VC.<br /><br />leave is cleaning up the stack frame you created, so when you enter a proc there will usually be an entery which will push esp, mov ebp, esp (or similar). At the end of the proc this is undone by the leave (which masm helpfully does automatically for you every time you ret as they are intrinsicly linked).<br /><br />If this is screwing you up (which you'll be able to tell because esp &amp; ebp will not be the same after the ret as they were before the call), make sure you're popping the correct numbers of things off the stack inside the function call, and make sure that all C calling convention functions you call are correctly cleaning up after themselves.<br /><br />Mirno</div>
    <div class="meta">Posted on 2002-12-09 03:41:08 by Mirno</div>
   </div>
   <div class="post" id="post-69994">
    <div class="subject"><a href="#post-69994">VC complier Vs Masm32 assembler</a></div>
    <div class="body">Thanks alot guys but little bit of experimenting I get my job done...<br /><br />However, the morale of this mess is that...<br /><br /><br /> If you are using inline assembly or naked function in VC then you have to take care of the stack frame yourself .. i.e caller will clean up all the mess created for the callee function.<br />     However if you r .. using procedure i.e proc... masm will take care of the mess created for the calling the function .. <br />          Also, if you r using label for calling you function then no epilog and prolog will be generated by the masm for your function....<br /><br />Once again thanks alot guys....</div>
    <div class="meta">Posted on 2002-12-09 04:14:23 by processingspeed</div>
   </div>
   <div class="post" id="post-70007">
    <div class="subject"><a href="#post-70007">VC complier Vs Masm32 assembler</a></div>
    <div class="body">Or you can do this:<br /><pre><code><br />	OPTION PROLOGUE&#58;NONE<br />	OPTION EPILOGUE&#58;NONE<br /><br />.code<br />some proc here<br />end some porc<br /><br />	OPTION PROLOGUE&#58;PROLOGUEDEF<br />	OPTION EPILOGUE&#58;EPILOGUEDEF<br /></code></pre><br /><br />Even if you dont use the stack frame in proc, MASM will still put a leave(EPILOGUE)  in.</div>
    <div class="meta">Posted on 2002-12-09 05:21:22 by ThoughtCriminal</div>
   </div>
  </div>
 </body>
</html>