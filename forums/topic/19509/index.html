<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>MASM + GNU linker - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=19509" />
    <link rel="next" href="../?id=19509&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=19509">MASM + GNU linker</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=19509&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=19509&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="19509" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=19509&amp;page=2">&gt;</a><a href="../?id=19509&amp;page=2">&raquo;</a></form>   <div class="post" id="post-150277">
    <div class="subject"><a href="#post-150277">MASM + GNU linker</a></div>
    <div class="body">Hi friends, <br /><br />Is it possible to use ld.exe - the GNU linker from MinGW package with MASM? Anyone who tried?</div>
    <div class="meta">Posted on 2004-09-23 14:45:42 by Vortex</div>
   </div>
   <div class="post" id="post-150285">
    <div class="subject"><a href="#post-150285">MASM + GNU linker</a></div>
    <div class="body">masm uses ms-coff object format, while gnu typicall uses gnu-coff (I think mingw does that too). This means the format of some relocations is different, and you will thus have FUBAR exe files. Why do you want to use gnu ld anyway?</div>
    <div class="meta">Posted on 2004-09-23 15:55:17 by f0dder</div>
   </div>
   <div class="post" id="post-150286">
    <div class="subject"><a href="#post-150286">MASM + GNU linker</a></div>
    <div class="body">Hi f0dder,<br /><br />Yes, I knew that GNU uses a variant of COFF. I wished to do some simple experiments with my import library maker inc2lib, that's why I asked about GNU ld.</div>
    <div class="meta">Posted on 2004-09-23 16:01:24 by Vortex</div>
   </div>
   <div class="post" id="post-150301">
    <div class="subject"><a href="#post-150301">GNU link</a></div>
    <div class="body">Hi Vortex,<br /><br />Please ask to Greenant, he know about that because he is using make from MinGW package.<br />http://greenant.cjb.net/<br />regards<br />ipadilla</div>
    <div class="meta">Posted on 2004-09-23 23:38:06 by ipadilla</div>
   </div>
   <div class="post" id="post-150308">
    <div class="subject"><a href="#post-150308">MASM + GNU linker</a></div>
    <div class="body">I only use make and no other software from mingw. So I don't know nothing about different variant of coff.<br /><br />Does ml.exe output only ms-coff?</div>
    <div class="meta">Posted on 2004-09-24 02:46:21 by greenant</div>
   </div>
   <div class="post" id="post-150316">
    <div class="subject"><a href="#post-150316">MASM + GNU linker</a></div>
    <div class="body">Hi greenant,<br /><br />Ml.exe outputs also OMF code which cannot be processed by MinGW. These GNU tools accepts only COFF code.<br /><br />Thanks for your help.</div>
    <div class="meta">Posted on 2004-09-24 05:21:57 by Vortex</div>
   </div>
   <div class="post" id="post-150478">
    <div class="subject"><a href="#post-150478">MASM + GNU linker</a></div>
    <div class="body">I also would like - just for fun - to know how one may use ld with MASM<br />or, the other way, use a GCC object module with MS link.<br /><br />The first way I tried with DJGPP ld.exe (which surely isn't the &quot;standard&quot; ld.exe binary), but soon gave up. ld seems to ignore - or most likely not to understand - the linker commands placed by MASM in the &quot;.drectve&quot; section.</div>
    <div class="meta">Posted on 2004-09-25 16:28:11 by japheth</div>
   </div>
   <div class="post" id="post-150482">
    <div class="subject"><a href="#post-150482">MASM + GNU linker</a></div>
    <div class="body">To use ms/gnu coff files in &quot;non-native&quot; platform, you'd need a object-file-fixer that changes the relocations. Haven't seen one of those yet, and I'm not interested enough in GNU tools to write one. There's usually better solutions than making workaround for GNU stuff ;)<br /><br />Hm, does anything but microsoft software parse the .drectve section?</div>
    <div class="meta">Posted on 2004-09-25 16:45:00 by f0dder</div>
   </div>
   <div class="post" id="post-150484">
    <div class="subject"><a href="#post-150484">MASM + GNU linker</a></div>
    <div class="body">MASM puts the entry point in this section. So if the linker complains about not finding a program entry, it most likely doesn't understand it.<br /><br />ALINK.EXE complains.<br /><br />The other linkers I know (TLINK/ILINK, WLINK, QLINK, LINK from Digital Mars) are OMF linkers.</div>
    <div class="meta">Posted on 2004-09-25 17:01:36 by japheth</div>
   </div>
   <div class="post" id="post-150502">
    <div class="subject"><a href="#post-150502">MASM + GNU linker</a></div>
    <div class="body">COFF means Common Object File Format. Is it corret?<br />And what does OMF mean?</div>
    <div class="meta">Posted on 2004-09-26 02:42:50 by greenant</div>
   </div>
   <div class="post" id="post-150503">
    <div class="subject"><a href="#post-150503">MASM + GNU linker</a></div>
    <div class="body">I think OMF is for &quot;Object Module Format/File&quot;, but it's mostly a guess. Wotsit.org prolly knows.</div>
    <div class="meta">Posted on 2004-09-26 02:46:08 by f0dder</div>
   </div>
   <div class="post" id="post-150505">
    <div class="subject"><a href="#post-150505">MASM + GNU linker</a></div>
    <div class="body">OMF=Object module file format</div>
    <div class="meta">Posted on 2004-09-26 03:06:54 by Vortex</div>
   </div>
   <div class="post" id="post-150522">
    <div class="subject"><a href="#post-150522">MASM + GNU linker</a></div>
    <div class="body">Very interesting, today I tried to link a GCC object module (hello world) with MS link (using a simple, self-written C runtime lib). the linker doesn't report problems, but the executable crashes. As f0dder already mentioned, the relocations are different, and the &quot;printf&quot; call is wrongly resolved. But may be there exist an option (among approximately 2000 others) in GCC (or AS) to adjust this?</div>
    <div class="meta">Posted on 2004-09-26 12:28:38 by japheth</div>
   </div>
   <div class="post" id="post-150820">
    <div class="subject"><a href="#post-150820">MASM + GNU linker</a></div>
    <div class="body">Greetings all!<br /><br />It's a novelty to use ld with masm, but since it's not clear how to optimize output using ld (unless someone can give an example) it's actually preferable to use MSLINK or some other linker which supports optimization more transparently. ld's (I'm using the MinGW version) commandline syntax is similar to MSLINK's, say MAIN is your program's entry point and imports from user32 and kernel32 are required, then the syntax is: <br /><br /><br /><pre><code>ld -e_MAIN -subsystem console -Lc&#58;\MASM\LIB -o yourprog.exe yourprog.obj -luser32 -lkernel32  <br /></code></pre><br /><br />The chm file for ld is available from the MinGW website and describes the commandline syntax fully. Here's a NMAKE makefile example which demonstrates how to employ ld in this context:<br /><br /><br /><pre><code>NAME=myprog<br />BIN=\masm32\bin<br />BIN2=c&#58;\MinGW\bin<br /><br />SUBSYSTEM=console<br />LIBPATH=\masm32\lib<br />AFLAGS=/c /coff /Cp /Fl /Sn<br /><br />.asm.obj&#58;<br />    $&#40;BIN&#41;\ml $&#40;AFLAGS&#41; $&lt;<br />.rc.obj&#58;<br />    $&#40;BIN&#41;\rc /v RSRC.RC <br />    $&#40;BIN&#41;\cvtres /machine&#58;ix86 RSRC.RES<br />.obj.exe&#58;<br />    $&#40;BIN2&#41;\ld -e_MAIN -subsystem $&#40;SUBSYSTEM&#41; -L $&#40;LIBPATH&#41; -o $&#40;NAME&#41;.exe $&lt; RSRC.OBJ -lgetclargs -lmsvcrt -luser32 -lkernel32 -lversion -lshlwapi <br />    del $&lt;<br />    del RSRC.OBJ<br />    del RSRC.RES<br /><br />all&#58; $&#40;NAME&#41;.exe<br /><br />$&#40;NAME&#41;.exe&#58; $&#40;NAME&#41;.obj RSRC.obj<br />$&#40;NAME&#41;.obj&#58; $&#40;NAME&#41;.asm RSRC.RC<br /></code></pre></div>
    <div class="meta">Posted on 2004-10-02 13:34:36 by Poimander</div>
   </div>
   <div class="post" id="post-151139">
    <div class="subject"><a href="#post-151139">MASM + GNU linker</a></div>
    <div class="body">Poimander (or anyone who knows),<br /><br />do you know how to tell LD to include relocation info in the PE binary? All my binaries are &quot;fixed&quot; and I'm unable to find the command line switch to enable this feature.<br /><br />Regards<br /><br />Japheth</div>
    <div class="meta">Posted on 2004-10-09 11:17:21 by japheth</div>
   </div>
   <div class="post" id="post-151151">
    <div class="subject"><a href="#post-151151">MASM + GNU linker</a></div>
    <div class="body">The linker written by Pelle Orinius works fine with ML coff output and it generally produces a slightly smaller executable file as well.</div>
    <div class="meta">Posted on 2004-10-09 18:04:19 by hutch--</div>
   </div>
   <div class="post" id="post-151152">
    <div class="subject"><a href="#post-151152">MASM + GNU linker</a></div>
    <div class="body"><div class="quote"><br />do you know how to tell LD to include relocation info in the PE binary?</div><br /><br />You have to employ the <strong>-r (i.e. -relocatable)</strong> command line switch. I recommend you download the .chm file (<a target="_blank" href="http://htmlhelp.berlios.de/books/chm.php">http://htmlhelp.berlios.de/books/chm.php</a>).</div>
    <div class="meta">Posted on 2004-10-09 18:34:46 by Poimander</div>
   </div>
   <div class="post" id="post-151159">
    <div class="subject"><a href="#post-151159">MASM + GNU linker</a></div>
    <div class="body">Thanks Poimander,<br /><br />but I wouln't ask if I hadn't read the docs first. And I had tried the -r switch, but this switch seems to cause ld to produce another coff file (beginning with word 014Ch), which, as it is documented, can serve as input for ld (partiall linking). Very nice, but not the simple feature I was looking for.<br /><br />Regards<br /><br />Japheth<br /><br /><br /><br />Hutch, in case your post was refering to my post: I am currently checking some win32 development environments to be suitable for a certain task. For this they must be able produce relocatable PE binaries. And LD belongs to the MinGW package (C++), among others.</div>
    <div class="meta">Posted on 2004-10-10 01:05:00 by japheth</div>
   </div>
   <div class="post" id="post-151164">
    <div class="subject"><a href="#post-151164">MASM + GNU linker</a></div>
    <div class="body"><div class="quote">ld seems to ignore - or most likely not to understand - the linker commands placed by MASM in the &quot;.drectve&quot; section<br />---------------------------<br />Hm, does anything but microsoft software parse the .drectve section?<br />---------------------------<br />MASM puts the entry point in this section. So if the linker complains about not finding a program entry, it most likely doesn't understand it. <br />ALINK.EXE complains. <br />The other linkers I know (TLINK/ILINK, WLINK, QLINK, LINK from Digital Mars) are OMF linkers.</div><br />Just for the record, my <a target="_blank" href="http://www.GoDevTool.com">Golink</a> which is a COFF linker looks for the specified starting address and exported names in the .drectve section (as one way to find this information).</div>
    <div class="meta">Posted on 2004-10-10 08:19:47 by jorgon</div>
   </div>
   <div class="post" id="post-151181">
    <div class="subject"><a href="#post-151181">MASM + GNU linker</a></div>
    <div class="body"><div class="quote"><br />but I wouln't ask if I hadn't read the docs first. And I had tried the -r switch, but this switch seems to cause ld to produce another coff file ...<br /></div><br /><br />My apologies, I thought the situation was more complicated only <em>after</em><br />issuing my post.  :roll: However, I found a post on Google/Groups which <br />suggests using <strong>CygWin ld</strong> (the alternative <strong>-q</strong> option isn't implemented in the <strong>MinGW</strong> version). <br /><br /><a target="_blank" href="http://groups.google.com/groups?q=ld+relocations+linker+example+pe-coff&amp;hl=en&amp;lr=&amp;selm=3e358009_2%40mk-nntp-2.news.uk.tiscali.com&amp;rnum=2">Subject: Re: loading COFF</a></div>
    <div class="meta">Posted on 2004-10-10 16:20:39 by Poimander</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=19509&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=19509&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="19509" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=19509&amp;page=2">&gt;</a><a href="../?id=19509&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>