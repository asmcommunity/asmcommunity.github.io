<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>need help with FPU related stuff  - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=22373" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=22373">need help with FPU related stuff </a></p>
   <div class="post" id="post-167942">
    <div class="subject"><a href="#post-167942">need help with FPU related stuff </a></div>
    <div class="body">HI i am making a calculator in masm I already have the gui done and all the buttons and most functions work.&nbsp; BUt i am having trouble with calculating e^x .&nbsp; I have to do it using series so e^x = 1+x+x^2/2!+x^3/3!... to infinity here is my code for calculating it.&nbsp; The logic is correct i think but the FPU gets out of&nbsp; control or soemthing so can anyone help me please write any comments .&nbsp; I know i might be doing stuff that i dont need but i was trying anything and nothing worked.&nbsp; Here is part of the code to caluculate e^x&nbsp; when i compile it i dont get any errors it just doesnt do anything when the user press the e^x button<br /><br />	.if wParam == 520&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp; &nbsp;  computes e^x&nbsp;  <br />		mov number9,5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; number of decimals <br />		invoke GetWindowText,hDspl,ADDR buffer,512 ;gets the number from display <br />		finit&nbsp; ;initilizes FPU<br />		invoke FpuAtoFL,addr buffer,0,DEST_FPU	;puts the number from dispaly onto FPU<br />		fld1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;loads 1 to fpu<br />		fadd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 	;adds 1 and x so this takes care of the 1+x of the series<br />		fst trig&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; stores the number in trig<br />		mov eax,2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;one of the counters<br />		finit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;initilizes fpu<br />		invoke FpuAtoFL,addr buffer,0,DEST_FPU<br />		fstp numx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;stores the number x that the user entered<br /><br />		.while eax &lt; 100&nbsp;  <br />			mov loopcounter, eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; saves outer loopcounter<br />				finit<br />				fld numx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;loads x that the user eneterd<br />				.while (eax &gt; 1)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; calculates x^n power(numerator)<br />					fmul st,st	&nbsp; &nbsp; &nbsp; &nbsp;  ;squares the number	<br />					dec eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;eax-1<br />				.endw<br />				fstp num&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;stores the number from the loop into num<br />				mov eax,loopcounter&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;restores the outer loopcounter<br />				finit ;initlizes FPU<br />				fild loopcounter&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;loads loopcounter <br />				.while loopcounter &gt; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;calculates denom of the series(factorial part)<br />					dec loopcounter&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;dec loopcounter<br />					fild loopcounter&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;loads it to st<br />					fmul st,st(1)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; multiplies 2*1 first time trough the outer loop . second time trough the outer loop&nbsp; 3*2*1 etc.<br />				.endw<br />			fst denom&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;stores real number into denom<br />			finit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; initilizes FPU<br />			fld num&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;loads numerator <br />			fdiv denom&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;divides it by denom<br />			fadd trig&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;adds it to a running sum of trig<br />			fst trig&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; pops the number into trig <br />			inc eax&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; inc eax <br />		.endw<br />		invoke FpuFLtoA, 0,ADDR number9, ADDR result_0, SRC1_FPU or SRC2_DMEM <br />		invoke SetWindowText,hDspl,ADDR result_0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; for displaying<br />		mov check,0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; checks for other stuff not important<br />		mov check2,0<br />		mov numberofdec,0<br />		fld negative<br />		fabs<br />		fst decten<br />	.endif<br /><br /><br /><br /><br /><br />I think it has to do something with FPU because i am not preserving it and something with the while loop it somehow screws up the FPU.&nbsp; <br /><br />thank you guys for your help <br /><br /></div>
    <div class="meta">Posted on 2005-11-16 02:41:37 by slim515</div>
   </div>
   <div class="post" id="post-167953">
    <div class="subject"><a href="#post-167953">Re: need help with FPU related stuff </a></div>
    <div class="body">If you are using the FpuAtoFL function, you thus have the FPULIB. Computing the e^x would thus be a lot easier by using the FpuEexpX function in the same FPULIB, or adapting the code from the source file.<br /><br />If this is strictly an exercise in computing the e^x according to the power series, your code seems to be fully loaded with errors. The best way to correct them would be to run the code in a debugger with a known input and watch how the variables progress after each operation as compared to how they should if you were performing the computation with paper and pencil.<br /><br />Raymond<br /></div>
    <div class="meta">Posted on 2005-11-16 21:53:40 by Raymond</div>
   </div>
  </div>
 </body>
</html>