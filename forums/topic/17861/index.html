<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Update the Client area ? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17861" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=17861">Update the Client area ?</a></p>
   <div class="post" id="post-137875">
    <div class="subject"><a href="#post-137875">Update the Client area ?</a></div>
    <div class="body">Hi<br /><br /><br />What do I miss here to get this program work right :confused: <br /><br />I just want it to startup without the client area to be<br />updated, and then when you click the button, the<br />background/client area is updated.</div>
    <div class="meta">Posted on 2004-04-04 04:56:01 by The SharK</div>
   </div>
   <div class="post" id="post-137888">
    <div class="subject"><a href="#post-137888">Update the Client area ?</a></div>
    <div class="body">Shark,<br /><br />I had a quick look but I can't figure out  you really intend to do.<br /><br />I point out a couple errors and wait for more info.<br /><br /><pre><code><br />to get BN_CLICKED from WM_COMMAND do the following&#58;<br /><br />.ELSEIF uMsg==WM_COMMAND<br />    mov eax, wParam<br />    shr eax, 16<br />    .IF ax==BN_CLICKED<br />         ; do stuff<br />    .ENDIF<br /></code></pre><br /><br />Please also note that in your Thread procedure you have the following errors:<br /><br />[*] You declare rect as Local.. And you decide to use the rect without ever filling the structure. Consider making a call to GetClientRect first.<br />[*] In the thread procedure you also declare hwnd as local and you use it like erm.. an hwnd .. This can not work as this just declared hwnd is 0.</div>
    <div class="meta">Posted on 2004-04-04 07:30:13 by JimmyClif</div>
   </div>
   <div class="post" id="post-138078">
    <div class="subject"><a href="#post-138078">Update the Client area ?</a></div>
    <div class="body">Ok JimmyClif<br /><br /><br />I think I have corrected the errors, but what is wrong with<br />the ThreadProc now, since it won't assemble :confused:</div>
    <div class="meta">Posted on 2004-04-06 08:55:33 by The SharK</div>
   </div>
   <div class="post" id="post-138084">
    <div class="subject"><a href="#post-138084">Update the Client area ?</a></div>
    <div class="body">Remove that comma and I think it will work. oh yes dec sets zero flag, thus no need to have the cmp there.</div>
    <div class="meta">Posted on 2004-04-06 09:21:11 by roticv</div>
   </div>
   <div class="post" id="post-138090">
    <div class="subject"><a href="#post-138090">Update the Client area ?</a></div>
    <div class="body">Hi roticv<br /><br /><br />I don't quite follow what you mean...<br />What comma ?<br /><br />If I move a number into ecx, and I use dec, then that number<br />is just decremented by one, so my Idea was to make a delay,<br />I could have used sleep <br />:)</div>
    <div class="meta">Posted on 2004-04-06 09:56:47 by The SharK</div>
   </div>
   <div class="post" id="post-138091">
    <div class="subject"><a href="#post-138091">Update the Client area ?</a></div>
    <div class="body">Hi TS<br /><br />Try this ..........<br /><br /><pre><code><br /><br />;RECT STRUCT<br />;		    left   DD ?<br />;		    top    DD ?<br />;		    right  DD ?<br />;		    bottom DD ?<br />;RECT ENDS<br /><br />MyRect RECT &lt;?,?,?,?&gt;<br /><br />.<br />.<br />ThreadProc PROC uses ecx ;sParam&#58;DWORD<br />        mov ecx,600000000<br />Loop1&#58;  dec ecx<br />        jz  Get_out<br />        invoke GetClientRect, hwnd, ADDR MyRect<br />        invoke ValidateRect,hwnd, ADDR MyRect<br />        invoke UpdateWindow, hwnd<br />        jmp  Loop1<br />Get_out&#58;<br />        invoke SendMessage,hwnd,WM_FINISH,NULL,NULL<br />        ret<br />ThreadProc ENDP<br /><br /></code></pre><br /><br />Peace</div>
    <div class="meta">Posted on 2004-04-06 09:57:33 by mistronr1</div>
   </div>
   <div class="post" id="post-138098">
    <div class="subject"><a href="#post-138098">Update the Client area ?</a></div>
    <div class="body">Your code:<br /><pre><code><br />ThreadProc PROC uses ecx, Param&#58;DWORD<br /></code></pre><br /><br />Should be<br /><pre><code><br />ThreadProc PROC uses ecx Param&#58;DWORD<br /></code></pre><br /><br />mistronr1,<br /><br />The kernel calls the Threadproc with 1 parameter and you need to clear the stack.</div>
    <div class="meta">Posted on 2004-04-06 10:27:31 by roticv</div>
   </div>
   <div class="post" id="post-138107">
    <div class="subject"><a href="#post-138107">Update the Client area ?</a></div>
    <div class="body">Ok thanks<br /><br /><br />Now it assembles right, but I have to make some changes to the program.<br />My idea was to make the client area un-updated, so if you drag some other<br />window into the client area, the window would &quot;hang&quot; in the client area,<br />without any update to remove the window. Then if you pushed the button,<br />the client area would be updated, and the window you dragged into it,<br />would disappear.<br /><br />Not that it's a totally unique program, just for studying purposes only ;-)<br /><br />Btw.<br />I took the ThreadProc, from Iczelion's tut15 - where did the &quot;Param&quot; parameter<br />came from, I mean was the idea of it, just to clear the stack :confused:</div>
    <div class="meta">Posted on 2004-04-06 10:55:08 by The SharK</div>
   </div>
   <div class="post" id="post-138109">
    <div class="subject"><a href="#post-138109">Update the Client area ?</a></div>
    <div class="body">You can pass the dword or pointer that the threadproc functions needs via the lparam of CreateThread. A good example would be the following by QvasiModo<br /><br /><pre><code><br />.386<br />.model flat,stdcall<br />option casemap&#58;none<br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br /><br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />.data<br />MsgTitle db &quot;Hello&quot;,0<br />Msg1 db &quot;Message 1&quot;,0<br />Msg2 db &quot;Message 2&quot;,0<br />Msg3 db &quot;Message 3&quot;,0<br />.data?<br />ThreadID dd ?<br /><br />hThread1 dd ?<br />hThread2 dd ?<br />hThread3 dd ?<br /><br />.code<br /><br />MessageProc PROTO &#58;DWORD<br /><br />start&#58;<br />    <br />  invoke CreateThread, NULL, 0, addr MessageProc, addr Msg1, 0, addr ThreadID<br />  mov hThread1,eax<br />  push eax<br />  invoke CreateThread, NULL, 0, addr MessageProc, addr Msg2, 0, addr ThreadID<br />  mov hThread2,eax<br />  push eax<br />  invoke CreateThread, NULL, 0, addr MessageProc, addr Msg3, 0, addr ThreadID<br />  mov hThread3,eax<br />  push eax<br /><br />  invoke WaitForMultipleObjects,3,offset hThread1,TRUE,INFINITE<br /><br />  call CloseHandle<br />  call CloseHandle<br />  call CloseHandle<br />  invoke ExitProcess, 0    <br /><br />  MessageProc PROC msg&#58;DWORD<br />    invoke MessageBox, NULL, msg, addr MsgTitle, MB_OK<br />    ret<br />  MessageProc ENDP<br /> end start<br /></code></pre><br /><br /> I do not know why I added this post. Abit out of topic. hmm</div>
    <div class="meta">Posted on 2004-04-06 10:59:46 by roticv</div>
   </div>
   <div class="post" id="post-138185">
    <div class="subject"><a href="#post-138185">Update the Client area ?</a></div>
    <div class="body">Hi roticv !<br /><br />Nice program anyway, guess I learned a little about threads ;-)<br /><br />Where do I place InvalidateRect, to make the whole client area invalid :confused:<br /><br />and then when I push the button the client area is updated - any hint :confused: <br /><br /><br /><pre><code><br />.386<br />.model flat,stdcall<br />option casemap&#58;none<br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />WinMain proto &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br /><br />.data<br />ClassName       db &quot;SimpleWinClass&quot;,0<br />ButtonClass     db &quot;Button&quot;,0<br />AppName         db &quot;Our First Window&quot;,0<br />ButtonText_1    db &quot;Refresh Client Area&quot;,0<br /><br /><br /><br />.data?<br />hInstance       dd        ?<br />CommandLine     dd        ?<br />hwndButton_1    dd        ?<br />ThreadID        DWORD     ?<br />hwnd            HANDLE    ?<br />MyRect RECT &lt;?,?,?,?&gt;<br /><br /><br /><br />.const<br />ButtonID_1      equ 7<br />WM_FINISH       equ WM_USER+100h<br /><br />.code<br />start&#58;<br />	invoke GetModuleHandle, NULL<br />	mov    hInstance,eax<br />	invoke GetCommandLine<br />	mov    CommandLine,eax<br />	invoke WinMain, hInstance, NULL, CommandLine, SW_SHOWDEFAULT<br />	invoke ExitProcess, eax<br /><br /><br /><br /><br />WinMain proc hInst&#58;HINSTANCE, hPrevInst&#58;HINSTANCE, CmdLine&#58;LPSTR, CmdShow&#58;DWORD<br />    LOCAL  wc&#58;WNDCLASSEX<br />    LOCAL  msg&#58;MSG<br />    mov    wc.cbSize, SIZEOF WNDCLASSEX<br />    mov    wc.style, CS_HREDRAW or CS_VREDRAW<br />    mov    wc.lpfnWndProc, OFFSET WndProc<br />    mov    wc.cbClsExtra, NULL<br />    mov    wc.cbWndExtra, NULL<br />    push   hInstance<br />    pop    wc.hInstance<br />    mov    wc.hbrBackground,COLOR_WINDOW+2<br />    mov    wc.lpszMenuName, NULL<br />    mov    wc.lpszClassName, OFFSET ClassName<br />    invoke LoadIcon, NULL, IDI_APPLICATION<br />    mov    wc.hIcon, eax<br />    mov    wc.hIconSm, eax<br />    invoke LoadCursor, NULL, IDC_ARROW<br />    mov    wc.hCursor, eax<br />    invoke RegisterClassEx, addr wc<br /><br />  ; CreateWindowEx&#58;<br />  ; ######################<br />  ; HWND CreateWindowEx&#40;<br />  ; DWORD dwExStyle,<br />  ; LPCTSTR lpClassName,<br />  ; LPCTSTR lpWindowName,<br />  ; DWORD dwStyle,<br />  ; int x,<br />  ; int y,<br />  ; int nWidth,<br />  ; int nHeight,<br />  ; HWND hWndParent,<br />  ; HMENU hMenu,<br />  ; HINSTANCE hInstance,<br />  ; LPVOID lpParam<br />  ; &#41;;<br />  ; ######################<br />    invoke CreateWindowEx,NULL,ADDR ClassName,ADDR AppName,\<br />                            WS_OVERLAPPEDWINDOW,CW_USEDEFAULT,\<br />                            CW_USEDEFAULT,CW_USEDEFAULT,CW_USEDEFAULT,\<br />                            NULL,NULL,hInst,NULL<br />    mov    hwnd, eax<br />    invoke ShowWindow, hwnd, SW_SHOWNORMAL<br /><br />    invoke CreateWindowEx,NULL,addr ButtonClass,addr ButtonText_1,\<br />                          WS_CHILD or WS_VISIBLE or BS_DEFPUSHBUTTON,\<br />                          300,42,132,22,hwnd,ButtonID_1,hInstance,NULL<br />    mov hwndButton_1,eax<br />    invoke UpdateWindow, hwnd<br />	.WHILE TRUE<br />		invoke GetMessage, ADDR msg, NULL, 0, 0<br />		.BREAK .IF &#40;!eax&#41;<br />		invoke TranslateMessage, ADDR msg<br />		invoke DispatchMessage, ADDR msg<br />	.ENDW<br />    mov     eax,msg.wParam<br />    ret<br />WinMain endp<br /><br /><br /><br /><br />WndProc proc hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br /><br />	.if uMsg == WM_DESTROY<br />		invoke PostQuitMessage, NULL<br /><br />      .ELSEIF uMsg==WM_COMMAND<br /><br />  ; ######################################      <br />  ; BN_CLICKED&#58;<br />  ; wParam&#58;<br />  ; The low-order word contains the button's control identifier.<br />  ; The high-order word specifies the notification message.<br />  ; ######################################<br />        mov eax, wParam<br />        shr eax, 16<br />      .IF ax==BN_CLICKED<br />		mov  eax,OFFSET ThreadProc<br />		invoke CreateThread,NULL,NULL,eax,\<br />                                NULL,NORMAL_PRIORITY_CLASS,\<br />                                ADDR ThreadID<br />		invoke CloseHandle,eax<br />      .ENDIF<br /><br />      .else<br />		invoke DefWindowProc, hWnd, uMsg, wParam, lParam		<br />		ret<br />	.endif<br />	xor eax,eax<br />	ret<br />WndProc endp<br /><br /><br /><br /><br />ThreadProc PROC uses ecx Param&#58;DWORD<br />        mov ecx,10000000<br />Loop1&#58;  dec ecx<br />        cmp ecx,0<br />        jz  Get_out<br />        push ecx<br />        invoke GetClientRect, hwnd, ADDR MyRect<br />        invoke ValidateRect,hwnd, ADDR MyRect<br />        invoke UpdateWindow, hwnd<br />        pop ecx<br />        jmp  Loop1<br />Get_out&#58;<br />        invoke SendMessage,hwnd,WM_FINISH,NULL,NULL<br />        ret<br />ThreadProc ENDP<br /><br />end start<br /></code></pre></div>
    <div class="meta">Posted on 2004-04-07 02:40:16 by The SharK</div>
   </div>
  </div>
 </body>
</html>