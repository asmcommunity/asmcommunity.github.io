<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>blocking a key? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=17195" />
    <link rel="next" href="../?id=17195&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=17195">blocking a key?</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=17195&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=17195&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="17195" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=17195&amp;page=2">&gt;</a><a href="../?id=17195&amp;page=2">&raquo;</a></form>   <div class="post" id="post-133286">
    <div class="subject"><a href="#post-133286">blocking a key?</a></div>
    <div class="body">I'm trying to block the back space key until certain section of a relatively large file are brought into full edit capacity with EM_REPLACESEL. Her is my futile attempt at just blocking the key by replacing wParam but I guess I can't replace wParam:<br /><br />EditWndProc PROC hEdit:DWORD,uMsg:DWORD,wParam:DWORD,lParam:DWORD<br /><br />    .if uMsg==WM_KEYDOWN <br />        mov eax,wParam<br />        push eax<br />        invoke SetFocus,hwndEdit<br />        pop eax<br />        cmp eax,08h<br />        jnz others<br />        ;mov regXXX,eax<br />        ;call DisplayregXXX<br />        mov eax,41h<br />        mov wParam,eax<br /><br /><br />Thanks</div>
    <div class="meta">Posted on 2004-02-12 12:13:17 by mrgone</div>
   </div>
   <div class="post" id="post-133295">
    <div class="subject"><a href="#post-133295">blocking a key?</a></div>
    <div class="body">You might think about subclassing the edit control and waiting for the WM_CHAR:<br /><br /><pre><code>PwdProc FRAME hwnd,uMsg,wParam,lParam<br />	LOCAL junk	&#58;D<br />	<br />	cmp D&#91;uMsg&#93;,WM_CHAR<br />	jne &gt;.EXIT<br />		invoke GetWindowLong,&#91;hwnd&#93;,GWL_USERDATA<br />		or eax,eax<br />		jz &gt;.EXIT<br />		mov D&#91;junk&#93;,0<br />		invoke SetWindowText,&#91;hwnd&#93;,OFFSET junk<br />		invoke SetWindowLong,&#91;hwnd&#93;,GWL_USERDATA,FALSE<br />	.EXIT<br /><br />	invoke CallWindowProc, &#91;PWProc&#93;, &#91;hwnd&#93;, &#91;uMsg&#93;, &#91;wParam&#93;, &#91;lParam&#93;<br />	RET<br />ENDF</code></pre><br /><br />This subclass checks the GWL_USERDATA to see if it is TRUE and if it is it will erase the edit control on any key press. To block a key just ret without calling the old window proc. I use this one when the user types in the password edit box and it already contains an encrypted password but the concept is the same.</div>
    <div class="meta">Posted on 2004-02-12 12:45:18 by donkey</div>
   </div>
   <div class="post" id="post-133298">
    <div class="subject"><a href="#post-133298">Ok thanks Donkey</a></div>
    <div class="body">It's already subclassed and if I just &quot;ret&quot; I can't check other keys I need to process. Besides doesn't the character uMsg get passed back to OldWndProc anyway? I want to check a parameter for a true condx before I allow the backspace to work.</div>
    <div class="meta">Posted on 2004-02-12 12:56:09 by mrgone</div>
   </div>
   <div class="post" id="post-133300">
    <div class="subject"><a href="#post-133300">blocking a key?</a></div>
    <div class="body">Hi mrgone,<br /><br />The idea is to only just ret under certain circumstances. You can check the key to see if it is a backspace key and if it is then check the flag or whatever. If the flag is set then ret.<br /><br /><pre><code>PwdProc FRAME hwnd,uMsg,wParam,lParam<br />	LOCAL junk	&#58;D<br /><br />	cmp D&#91;uMsg&#93;,WM_CHAR<br />	jne &gt;.EXIT<br />		cmp D&#91;wParam&#93;,VK_DELETE<br />		jne &gt;.EXIT<br />		cmp D&#91;MyFlag&#93;,TRUE<br />		jne &gt;.EXIT<br />			xor eax,eax<br />			ret<br />	.EXIT<br /><br />	invoke CallWindowProc, &#91;PWProc&#93;, &#91;hwnd&#93;, &#91;uMsg&#93;, &#91;wParam&#93;, &#91;lParam&#93;<br />	RET<br />ENDF</code></pre></div>
    <div class="meta">Posted on 2004-02-12 13:20:21 by donkey</div>
   </div>
   <div class="post" id="post-133301">
    <div class="subject"><a href="#post-133301">Cool Cool</a></div>
    <div class="body">I'll give it a wirl. I didn't understand those VK_ codes. Iczelion used one too in Tut 20 but I can't decipher that HLA stuff. Thanks again Donkey:alright:</div>
    <div class="meta">Posted on 2004-02-12 13:31:34 by mrgone</div>
   </div>
   <div class="post" id="post-133444">
    <div class="subject"><a href="#post-133444">That still don't block</a></div>
    <div class="body">doesn't block backspace key.</div>
    <div class="meta">Posted on 2004-02-13 19:04:06 by mrgone</div>
   </div>
   <div class="post" id="post-133460">
    <div class="subject"><a href="#post-133460">blocking a key?</a></div>
    <div class="body">VK_BACK instead of VK_DELETE then, why not try experimenting?<br />and the VK_ stuff isnt HLA, they're simply equates, study the windows.inc<br /><br />VK_BACK = 08h for example</div>
    <div class="meta">Posted on 2004-02-13 23:48:47 by evlncrn8</div>
   </div>
   <div class="post" id="post-133468">
    <div class="subject"><a href="#post-133468">Yeah I know the equate</a></div>
    <div class="body">It looks like I can block characters ok just not the &quot;backspace&quot;. You see that one is crucial because if the file is larger than EM_SETLIMIT which is max 32K if you backspace the graphic window will remove the byte and shift the characters succeeding the back spaced charcter to the previous addresses in the file. What I am doing is moving a chunk of the file to the front of the file with EM_REPLACESEL and then I want to allow backspace but not before I do this.<br />  So I'm still at the very start. How do I block the backspace from performing this function. It appears that the back space is passes from the subclassed window to the OldProcess msg parameter which is the main window and it will associate the backspace key with this function. Apparently lparam and wParam are just copies of a parameter that Windows uses. I tried sending &quot;WM_UNDO&quot; but I think it waits for program to cycle around and back through control block which is too late because the damage has already been done.</div>
    <div class="meta">Posted on 2004-02-14 01:03:26 by mrgone</div>
   </div>
   <div class="post" id="post-133472">
    <div class="subject"><a href="#post-133472">blocking a key?</a></div>
    <div class="body">Hi mrgone,<br /><br />If you cannot get the key through WM_CHAR then it is not translated, just use WM_KEYDOWN instead.<br /><br /><pre><code>cmp D&#91;uMsg&#93;,WM_KEYDOWN<br />	cmp W&#91;wParam&#93;==VK_BACK<br />	jne &gt;.EXIT<br />	cmp D&#91;MyFlag&#93;,TRUE<br />	jne &gt;.EXIT<br />		xor eax,eax<br />		ret</code></pre></div>
    <div class="meta">Posted on 2004-02-14 01:21:28 by donkey</div>
   </div>
   <div class="post" id="post-133473">
    <div class="subject"><a href="#post-133473">Where is EXIT?</a></div>
    <div class="body">Are you saying just return? I tried that and it doen't work. It still shifts my characters back in the graphic. Let me package this thing up and post it and if you will Donkey see if you can figure this out.</div>
    <div class="meta">Posted on 2004-02-14 01:36:48 by mrgone</div>
   </div>
   <div class="post" id="post-133475">
    <div class="subject"><a href="#post-133475">OK here is file</a></div>
    <div class="body">You'll see the code right under dotted line toward end of file. I'm using MASM. If I can knock this out than I only have a fews days more work on the driver to make this into a full memory editor. Appreciate the help.</div>
    <div class="meta">Posted on 2004-02-14 01:48:57 by mrgone</div>
   </div>
   <div class="post" id="post-133476">
    <div class="subject"><a href="#post-133476">blocking a key?</a></div>
    <div class="body">Hi mrgone,<br /><br />The app just GPF's on my system, I am a bit busy and can't really take the time to figure out why right now. I somehow lost all the copies of the source for HTTPUpdate so I am rewritting it tonight, no big hassle but a pain in the A** anyway. At least I have all of the problems worked out and I should be able to make it even more stable than it was originally. Luckily Update Manager was backed up so that is intact, it's several thousand lines, HTTPUpdate was only about 700 lines of code.</div>
    <div class="meta">Posted on 2004-02-14 01:58:29 by donkey</div>
   </div>
   <div class="post" id="post-133477">
    <div class="subject"><a href="#post-133477">Oh yeah I saw that</a></div>
    <div class="body">I'll take a look at your program. By the way what is GPF dare I ask?<br /><br />Just looked at it. Wow! That's nice work man :alright:</div>
    <div class="meta">Posted on 2004-02-14 02:05:10 by mrgone</div>
   </div>
   <div class="post" id="post-133478">
    <div class="subject"><a href="#post-133478">blocking a key?</a></div>
    <div class="body">Thanks !<br /><br /><strong>General Protection fault</strong> Probably writing to or reading from memory you are not allowed to, some pointer set to 0 or something like that.</div>
    <div class="meta">Posted on 2004-02-14 02:13:35 by donkey</div>
   </div>
   <div class="post" id="post-133480">
    <div class="subject"><a href="#post-133480">It shouldn't GPF</a></div>
    <div class="body">Some times it will if you open really large files with it but that's not it's use anway. It's just the user interface to a driver that reads and will soon write memory in W2K and XP. I just used it to look in your file. Look familiar Edgar? <br /><br />0000AFA0  30 2E 20 56 65 72 73 69-6F 6E 00 31 2E 20 44 61   0. Version.1. Da<br />0000AFB0  74 65 00 32 2E 20 49 66-20 65 78 69 73 74 00 33   te.2. If exist.3<br />0000AFC0  2E 20 49 66 20 6E 6F 74-20 65 78 69 73 74 00 34   . If not exist.4<br />0000AFD0  2E 20 41 6C 77 61 79 73-00 35 2E 20 4D 65 72 67   . Always.5. Merg<br />0000AFE0  65 20 74 6F 20 72 65 67-00 00 53 65 6C 65 63 74   e to reg..Select<br />0000AFF0  00 53 61 76 65 00 4F 70-65 6E 00 42 75 69 6C 64   .Save.Open.Build<br />0000B000  00 41 62 6F 75 74 00 43-6C 65 61 72 00 4F 70 74   .About.Clear.Opt<br />0000B010  69 6F 6E 73 00 46 74 70-00 00 55 70 64 61 74 65   ions.Ftp..Update<br />0000B020  20 70 72 6F 6A 65 63 74-20 66 69 6C 65 73 20 28    project files (<br />0000B030  2A 2E 75 64 70 29 00 2A-2E 75 64 70 00 00 55 44   *.udp).*.udp..UD<br />0000B040  50 00 53 61 76 65 20 75-70 64 61 74 65 20 70 72   P.Save update pr<br />0000B050  6F 6A 65 63 74 20 66 69-6C 65 00 4C 6F 61 64 20   oject file.Load <br />0000B060  70 72 6F 6A 65 63 74 20-66 69 6C 65 00 75 70 64   project file.upd<br />0000B070  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00   ................<br />0000B080  2E 7A 6C 62 00 00 00 00-00 00 00 00 00 00 00 00   .zlb............<br />0000B090  00 00 00 00 55 70 64 61-74 65 20 73 63 72 69 70   ....Update scrip<br />0000B0A0  74 20 28 2A 2E 75 64 73-29 00 2A 2E 75 64 73 00   t (*.uds).*.uds.<br />0000B0B0  00 55 44 53 00 53 61 76-65 20 75 70 64 61 74 65   .UDS.Save update<br />0000B0C0  20 73 63 72 69 70 74 00-64 6F 6E 6B 65 79 40 76    script.donkey@v<br />0000B0D0  69 73 75 61 6C 61 73 73-65 6D 62 6C 65 72 2E 63   isualassembler.c<br />0000B0E0  6F 6D 00 68 74 74 70 3A-2F 2F 64 6F 6E 6B 65 79   om.<a target="_blank" href="http://donkey">http://donkey</a><br />0000B0F0  2E 76 69 73 75 61 6C 61-73 73 65 6D 62 6C 65 72   .visualassembler<br />0000B100  2E 63 6F 6D 00 54 68 65-72 65 20 69 73 20 75 6E   .com.There is un<br />0000B110  73 61 76 65 64 20 64 61-74 61 0D 0A 57 6F 75 6C   saved data..Woul<br />0000B120  64 20 79 6F 75 20 6C 69-6B 65 20 74 6F 20 73 61   d you like to sa<br />0000B130  76 65 20 69 74 20 3F 00-43 6F 70 79 72 69 67 68   ve it ?.Copyrigh<br />0000B140  74 20 A9 20 32 30 30 34-20 45 64 67 61 72 20 48   t . 2004 Edgar H<br />0000B150  61 6E 73 65 6E 20 28 44-6F 6E 6B 65 79 29 0D 0A   ansen (Donkey)..<br />0000B160  0D 0A 54 68 69 73 20 70-72 6F 67 72 61 6D 20 69   ..This program i<br />0000B170  73 20 66 72 65 65 20 66-6F 72 20 61 6E 79 20 75   s free for any u<br />0000B180  73 65 20 61 73 20 6C 6F-6E 67 20 61 73 20 74 68   se as long as th<br />0000B190  65 20 6F 72 69 67 69 6E-20 6F 66 20 74 68 65 20   e origin of the <br />0000B1A0  70 72 6F 67 72 61 6D 20-69 73 20 6E 6F 74 20 6D   program is not m<br />0000B1B0  69 73 72 65 70 72 65 73-65 6E 74 65 64 2E 20 49   isrepresented. I<br />0000B1C0  74 20 63 61 6E 20 62 65-20 64 69 73 74 72 69 62   t can be distrib<br />0000B1D0  75 74 65 64 20 77 69 74-68 20 61 6E 79 20 70 61   uted with any pa<br />0000B1E0  63 6B 61 67 65 20 69 6E-63 6C 75 64 69 6E 67 20   ckage including <br />0000B1F0  63 6F 6D 6D 65 72 63 69-61 6C 20 73 6F 66 74 77   commercial softw<br />0000B200  61 72 65 20 77 69 74 68-6F 75 74 20 72 65 71 75   are without requ<br />0000B210  69 72 69 6E 67 20 70 65-72 6D 69 73 73 69 6F 6E   iring permission<br />0000B220  20 0D 0A 0D 0A 54 68 69-73 20 70 72 6F 67 72 61    ....This progra<br />0000B230  6D 20 69 73 20 64 69 73-74 72 69 62 75 74 65 64   m is distributed<br />0000B240  20 61 73 20 66 72 65 65-77 61 72 65 20 61 6E 64    as freeware and<br />0000B250  20 20 57 49 54 48 4F 55-54 20 41 4E 59 20 57 41     WITHOUT ANY WA<br />0000B260  52 52 41 4E 54 59 20 69-6E 63 6C 75 64 69 6E 67   RRANTY including<br />0000B270  20 74 68 65 20 69 6D 70-6C 69 65 64 20 77 61 72    the implied war<br />0000B280  72 61 6E 74 79 20 6F 66-20 4D 45 52 43 48 41 4E   ranty of MERCHAN<br />0000B290  54 41 42 49 4C 49 54 59-20 6F 72 20 46 49 54 4E   TABILITY or FITN<br />0000B2A0  45 53 53 20 46 4F 52 20-41 20 50 41 52 54 49 43   ESS FOR A PARTIC<br />0000B2B0  55 4C 41 52 20 50 55 52-50 4F 53 45 0D 0A 0D 0A   ULAR PURPOSE....<br />0000B2C0  5A 4C 69 62 20 43 6F 6D-70 72 65 73 73 69 6F 6E   ZLib Compression<br />0000B2D0  20 4C 69 62 72 61 72 79-20 31 2E 31 2E 34 0D 0A    Library 1.1.4..<br />0000B2E0  43 6F 70 79 72 69 67 68-74 20 A9 20 31 39 39 35   Copyright . 1995<br />0000B2F0  2D 32 30 30 32 20 4A 65-61 6E 2D 6C 6F 75 70 20   -2002 Jean-loup <br />0000B300  47 61 69 6C 6C 79 20 61-6E 64 20 4D 61 72 6B 20   Gailly and Mark <br />0000B310  41 64 6C 65 72 0D 0A 50-65 72 6D 69 73 73 69 6F   Adler..Permissio<br />0000B320  6E 20 69 73 20 67 72 61-6E 74 65 64 20 74 6F 20   n is granted to <br />0000B330  61 6E 79 6F 6E 65 20 74-6F 20 75 73 65 20 74 68   anyone to use th<br />0000B340  69 73 20 73 6F 66 74 77-61 72 65 20 66 6F 72 20   is software for <br />0000B350  61 6E 79 20 70 75 72 70-6F 73 65 2C 20 69 6E 63   any purpose, inc<br />0000B360  6C 75 64 69 6E 67 20 63-6F 6D 6D 65 72 63 69 61   luding commercia<br />0000B370  6C 20 61 70 70 6C 69 63-61 74 69 6F 6E 73 2C 20   l applications, <br />0000B380  61 6E 64 20 74 6F 20 61-6C 74 65 72 20 69 74 20   and to alter it <br />0000B390  61 6E 64 20 72 65 64 69-73 74 72 69 62 75 74 65   and redistribute<br />0000B3A0  20 69 74 20 66 72 65 65-6C 79 2C 20 73 75 62 6A    it freely, subj<br />0000B3B0  65 63 74 20 74 6F 20 74-68 65 20 66 6F 6C 6C 6F   ect to the follo<br />0000B3C0  77 69 6E 67 20 72 65 73-74 72 69 63 74 69 6F 6E   wing restriction<br />0000B3D0  73 3A 0D 0A 0D 0A 31 2E-20 54 68 65 20 6F 72 69   s:....1. The ori<br />0000B3E0  67 69 6E 20 6F 66 20 74-68 69 73 20 73 6F 66 74   gin of this soft<br />0000B3F0  77 61 72 65 20 6D 75 73-74 20 6E 6F 74 20 62 65   ware must not be<br />0000B400  20 6D 69 73 72 65 70 72-65 73 65 6E 74 65 64 20    misrepresented <br />0000B410  79 6F 75 20 6D 75 73 74-20 6E 6F 74 20 63 6C 61   you must not cla<br />0000B420  69 6D 20 74 68 61 74 20-79 6F 75 20 77 72 6F 74   im that you wrot<br />0000B430  65 20 74 68 65 20 6F 72-69 67 69 6E 61 6C 20 73   e the original s<br />0000B440  6F 66 74 77 61 72 65 2E-20 49 66 20 79 6F 75 20   oftware. If you <br />0000B450  75 73 65 20 74 68 69 73-20 73 6F 66 74 77 61 72   use this softwar<br />0000B460  65 20 69 6E 20 61 20 70-72 6F 64 75 63 74 2C 20   e in a product, <br />0000B470  61 6E 20 61 63 6B 6E 6F-77 6C 65 64 67 6D 65 6E   an acknowledgmen<br />0000B480  74 20 69 6E 20 74 68 65-20 70 72 6F 64 75 63 74   t in the product<br />0000B490  20 64 6F 63 75 6D 65 6E-74 61 74 69 6F 6E 20 77    documentation w<br />0000B4A0  6F 75 6C 64 20 62 65 20-61 70 70 72 65 63 69 61   ould be apprecia<br />0000B4B0  74 65 64 20 62 75 74 20-69 73 20 6E 6F 74 20 72   ted but is not r<br />0000B4C0  65 71 75 69 72 65 64 2E-0D 0A 0D 0A 32 2E 20 41   equired.....2. A<br />0000B4D0  6C 74 65 72 65 64 20 73-6F 75 72 63 65 20 76 65   ltered source ve<br />0000B4E0  72 73 69 6F 6E 73 20 6D-75 73 74 20 62 65 20 70   rsions must be p<br />0000B4F0  6C 61 69 6E 6C 79 20 6D-61 72 6B 65 64 20 61 73   lainly marked as<br />0000B500  20 73 75 63 68 2C 20 61-6E 64 20 6D 75 73 74 20    such, and must <br />0000B510  6E 6F 74 20 62 65 20 6D-69 73 72 65 70 72 65 73   not be misrepres<br />0000B520  65 6E 74 65 64 20 61 73-20 62 65 69 6E 67 20 74   ented as being t<br />0000B530  68 65 20 6F 72 69 67 69-6E 61 6C 20 73 6F 66 74   he original soft<br />0000B540  77 61 72 65 2E 0D 0A 0D-0A 33 2E 20 54 68 69 73   ware.....3. This<br />0000B550  20 6E 6F 74 69 63 65 20-6D 61 79 20 6E 6F 74 20    notice may not <br />0000B560  62 65 20 72 65 6D 6F 76-65 64 20 6F 72 20 61 6C   be removed or al<br />0000B570  74 65 72 65 64 20 66 72-6F 6D 20 61 6E 79 20 73   tered from any s<br />0000B580  6F 75 72 63 65 20 64 69-73 74 72 69 62 75 74 69   ource distributi<br />0000B590  6F 6E 2E 0D 0A 0D 0A 54-72 65 65 56 69 65 77 44   on.....TreeViewD<br />0000B5A0  69 72 20 43 6F 70 79 72-69 67 68 74 20 A9 20 32   ir Copyright . 2<br />0000B5B0  30 30 33 20 4B 65 74 69-6C 20 4F 6C 73 65 6E 0D   003 Ketil Olsen.<br />0000B5C0  0A 52 65 6C 65 61 73 65-64 20 74 6F 20 74 68 65   .Released to the<br />0000B5D0  20 70 75 62 6C 69 63 20-64 6F 6D 61 69 6E 0D 0A    public domain..<br />0000B5E0  0D 0A 41 6C 73 6F 20 73-70 65 63 69 61 6C 20 74   ..Also special t<br />0000B5F0  68 61 6E 6B 73 20 74 6F-20 4D 69 63 68 61 65 6C   hanks to Michael<br />0000B600  57 20 61 6E 64 20 65 76-65 72 79 6F 6E 65 20 61   W and everyone a<br />0000B610  74 20 6D 61 73 6D 33 32-66 6F 72 75 6D 2E 63 6F   t masm32forum.co<br />0000B620  6D 00 53 65 6C 65 63 74-20 61 20 66 6F 6C 64 65   m.Select a folde<br />0000B630  72 00 41 6C 6C 20 70 61-74 68 73 20 77 69 6C 6C   r.All paths will<br />0000B640  20 62 65 20 72 65 6C 61-74 69 76 65 20 74 6F 20    be relative to <br />0000B650  74 68 65 20 74 6F 70 20-72 6F 6F 74 20 69 6E 20   the top root in <br />0000B660  74 68 65 20 74 72 65 65-76 69 65 77 00 46 69 6C   the treeview.Fil<br />0000B670  65 20 4E 61 6D 65 00 56-65 72 73 69 6F 6E 00 53   e Name.Version.S<br />0000B680  69 7A 65 00 4D 6F 64 69-66 69 65 64 00 55 70 64   ize.Modified.Upd<br />0000B690  61 74 65 20 4B 65 79 00-00 00 00 00 00 00 00 00   ate Key.........</div>
    <div class="meta">Posted on 2004-02-14 02:35:40 by mrgone</div>
   </div>
   <div class="post" id="post-133481">
    <div class="subject"><a href="#post-133481">blocking a key?</a></div>
    <div class="body">I had tried to open a 962 byte text file...<br /><br /><pre><code>0040169F   E8 10090000      CALL &lt;JMP.&amp;kernel32.MapViewOfFile&gt;<br />004016A4   A3 DC424000      MOV DWORD PTR DS&#58;&#91;4042DC&#93;,EAX<br />004016A9   E8 BE080000      CALL &lt;JMP.&amp;kernel32.GetCurrentProcessId&gt;<br />004016AE   A3 C3324000      MOV DWORD PTR DS&#58;&#91;4032C3&#93;,EAX<br />004016B3   8B35 DC424000    MOV ESI,DWORD PTR DS&#58;&#91;4042DC&#93;<br />004016B9   8986 F8810000    MOV DWORD PTR DS&#58;&#91;ESI+81F8&#93;,EAX &lt;&lt;&lt;&#91;b&#93;ERROR WAS HERE&#91;/b&#93;<br />004016BF   8B35 DC424000    MOV ESI,DWORD PTR DS&#58;&#91;4042DC&#93;<br />004016C5   8B06             MOV EAX,DWORD PTR DS&#58;&#91;ESI&#93;<br />004016C7   A3 EA314000      MOV DWORD PTR DS&#58;&#91;4031EA&#93;,EAX<br />004016CC   A1 57324000      MOV EAX,DWORD PTR DS&#58;&#91;403257&#93;<br />004016D1   A3 EA314000      MOV DWORD PTR DS&#58;&#91;4031EA&#93;,EAX<br />004016D6   A1 57324000      MOV EAX,DWORD PTR DS&#58;&#91;403257&#93;<br />004016DB   3D EB376033      CMP EAX,336037EB<br />004016E0   74 53            JE SHORT MEMVEIW2.00401735<br />004016E2   FF35 4B324000    PUSH DWORD PTR DS&#58;&#91;40324B&#93;<br />004016E8   6A 40            PUSH 40<br />004016EA   E8 95080000      CALL &lt;JMP.&amp;kernel32.GlobalAlloc&gt;<br />004016EF   A3 4F324000      MOV DWORD PTR DS&#58;&#91;40324F&#93;,EAX<br />004016F4   50               PUSH EAX<br />004016F5   E8 96080000      CALL &lt;JMP.&amp;kernel32.GlobalLock&gt;<br /><br />Access violation when writing to &#91;012781F8&#93;</code></pre></div>
    <div class="meta">Posted on 2004-02-14 03:38:01 by donkey</div>
   </div>
   <div class="post" id="post-133482">
    <div class="subject"><a href="#post-133482">blocking a key?</a></div>
    <div class="body">yes it crashes here too opening your memview.asm file<br /><br />it crashes on this line<br />mov dword ptr ,eax  wher esi is your pMemory <br /><br />its the return from map view of file<br />If the function succeeds, the return value is the starting address of the mapped view.<br /><br />004016B9   .  8986 F8810000 MOV DWORD PTR DS:,EAX<br /><br />so review what you are trying to do with this piece of code and upload non crashing source<br />    mov esi,pMemory<br />     mov dword ptr ,eax<br />     mov esi,pMemory<br />     mov eax,dword ptr <br />     mov regXXX,eax<br />     ;call DisplayregXXX<br />     mov eax,Signature <br />     mov regXXX,eax<br />     ;call DisplayregXXX<br /><br /><br />well since the map has 6ff0 i tried to put 6fe0 in place of 81f8 <br />this access violation goes of but<br />it access violates here now<br />0040170B   .  B9 00800000   MOV ECX,8000<br />00401710   .  06            PUSH ES<br />00401711   .  1E            PUSH DS<br />00401712   .  07            POP ES                                   ;  Modification of segment register<br />00401713   .  FC            CLD<br />00401714   .  F3:A4         REP MOVS BYTE PTR ES:,BYTE PTR DS:[&gt;<br /><br />from where you set those 8000 81f8 etc when you are playing with a handle returned from mapview of file</div>
    <div class="meta">Posted on 2004-02-14 04:17:44 by bluffer</div>
   </div>
   <div class="post" id="post-133493">
    <div class="subject"><a href="#post-133493">blocking a key?</a></div>
    <div class="body">My question if the variable at DS:[4042DC] holds the base address for the mapped file, why is he moving EAX into DS:[4042DC]+81F8.<br /><br />He does essentially this:<br /><br />mov esi,<br />mov ,eax<br /><br /><br />I am having trouble understanding why, obviously it will generate a write error on files under 81F8 (~33K)  in size and will corrupt those that are larger.<br /><br /><br />Yup I checked it, it is corrupting the files that it opens by overwritting parts of the file, you really gotta fix that one mrgone, you can verify this by looking at offset 81f8 in both the original and one you have opened with the software<br /></div>
    <div class="meta">Posted on 2004-02-14 08:51:06 by donkey</div>
   </div>
   <div class="post" id="post-133516">
    <div class="subject"><a href="#post-133516">blocking a key?</a></div>
    <div class="body">since this was crashing when i am opening a small file i thought ill open a big file and see if i could help but it still crashes <br /><br />only difference is the venue has changed<br /><br />it crashes here now when i open that file and press<br /><br /><strong>tts</strong><br /><br />00401DE8  .  F3:A4          REP     MOVS BYTE PTR ES:, BYTE PTR DS:<br /><br />your corresponding source<br />shiftup:<br />            invoke SendMessage,hwndEdit,WM_GETTEXT,MEMSIZE-1,lock2     <br />            call Update            <br />            push eax<br />            push edi<br />            push esi                                   <br />            mov eax,pMemory<br />            mov esi,eax<br />            add eax,08000h<br />            mov edi,eax<br />            mov ecx,1900h<br />            push es<br />            push ds<br />            pop es<br />            cld<br />            rep movsb            <br />            mov eax,pMemory<br />            mov edi,eax<br />            add eax,0a000h<br />            mov esi,eax<br />            mov ecx,1900h<br />            cld<br />            rep movsb<br /><br /><br /><br />it jumps here from <br /><br />mov esi,pMemory<br />            add esi,081D0h<br />            cmp byte ptr ,45h    ; from Editmem<br />            jnz shiftup<br /><br />there are lot of issues it seems</div>
    <div class="meta">Posted on 2004-02-14 12:31:00 by bluffer</div>
   </div>
   <div class="post" id="post-133524">
    <div class="subject"><a href="#post-133524">Hey I appreciate you guys...</a></div>
    <div class="body">I'm sorry it was sleepy time over here.<br /><br />   You see the file is designed to operate with the inclosed file &quot;Share&quot;. There is parameter passing going on is the upper section of that file between the driver and code in the user mode. So it has flags and not intended as a general purpose hex dumper. You'll see it back here soon when I complete the driver.<br /><br />    The question I have is there are a few key commands:<br /><br />Shift &quot;E&quot; brings the first &gt; 1000h bytes to the fronbt of file for edit operation then &quot;s&quot; puts it back.<br />The &quot;=&quot; brings above 8000h to front of file for editing and &quot;s&quot; to bring it back.<br /><br />Those are some of the commands. I reallize it's rather sloppy and nothing like Donkey's APPs. It's just something to support the driver.<br /><br />I don't want any editing in the file until these key commands are activated. For instance when you first open the file. The problem is I cannot block the backspace function and it can corrupt the file if file is not re-loaded emmediately after. I may have to use a message box to prompt the user to reload if they do this by accident. You can see where it is subclassed underneath dashed line near end of file and It is the very first instructions under dashed line where I try to defeat the backspace but nothing seems to work.</div>
    <div class="meta">Posted on 2004-02-14 14:03:38 by mrgone</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=17195&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=17195&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="17195" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=17195&amp;page=2">&gt;</a><a href="../?id=17195&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>