<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>memory trigger/event? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=12174" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=12174">memory trigger/event?</a></p>
   <div class="post" id="post-93520">
    <div class="subject"><a href="#post-93520">memory trigger/event?</a></div>
    <div class="body">hey there,<br /><br />i have a question about data being written to memory<br /><br />i'm making an autoroller for a game right, it reads data from memory like a game trainer the thing is i want to know is there a way to check if a certain block of memory has been filled? so then i can check the stats properly?<br /><br />ie,<br /><br />&gt; i click -reroll- button<br />&gt; block of memory has been properly updated<br />&gt; read data from memory <br /><br />i'm having a problem with the program im writing, it seems to be 1-roll too late<br /><br />anyhow, here is the program source:<br /><br />if you want to help me with this program, this small part, aim me at dfcslave :)<br />i will supply you with an account name/pw for the game (darkness falls: the crusade) from <a target="_blank" href="http://www.mythic-realms.com">http://www.mythic-realms.com</a> (people who made daoc)<br /><br /><pre><code><br />rsrc.rc<br /><br />666 ICON &quot;icon.ico&quot;<br />#include &quot;\masm32\include\resource.h&quot;<br />#define   IDM_OPTIONS                 20<br />#define   IDM_WINDOWS                 21<br />#define   IDM_HELP                    22<br />#define   IDM_START                    1<br />#define   IDM_STOP                     2	<br />#define   IDM_RESET_BEST               3<br />#define   IDM_RESET_TOTAL              4<br />#define   IDM_PROMPT_KEEP              5<br />#define   IDM_PROMPT_BEST              6<br />#define   IDM_PLAY_KEEP                7<br />#define   IDM_PLAY_BEST                8<br />#define   IDM_EXIT                     9<br /><br />#define   IDM_MIN_DFC                  10<br />#define   IDM_RESTORE_DFC              11<br />#define   IDM_TRAY                     12<br />#define   IDM_RESTORE                  13<br /><br />#define   IDM_DFCROLLER_HELP           14<br />#define   IDM_DFCROLLER_HOMEPAGE       15<br />#define   IDM_DARKCRUSADES_HOMEPAGE    16<br />#define   IDM_DARKCRUSADES_FORUM       17<br />#define   IDM_WRITE_COMMENT            18<br />#define   IDM_ABOUT                    19<br /><br />#define   IDC_STATIC                   -1<br />#define   IDD_DLG_ROLLER               2000<br />#define   IDC_STATIC_BEST              2001<br />#define   IDC_STATIC_CURRENT           2002<br />#define   IDC_STATIC_TOTAL             2003<br />#define   IDC_STATIC_RPS               2004<br />#define   IDC_EDIT_STR                 2005<br />#define   IDC_EDIT_CON                 2006<br />#define   IDC_EDIT_AGI                 2007<br />#define   IDC_EDIT_DEX                 2008<br />#define   IDC_EDIT_INT                 2009<br />#define   IDC_EDIT_WIS                 2010<br />#define   IDC_EDIT_TOTAL               2011<br />#define   IDC_CHK_STR                  2012<br />#define   IDC_CHK_CON                  2013<br />#define   IDC_CHK_AGI                  2014<br />#define   IDC_CHK_DEX                  2015<br />#define   IDC_CHK_INT                  2016<br />#define   IDC_CHK_WIS                  2017<br />#define   IDC_CHK_TOTAL                2018<br />#define   IDC_BUTT_START               2019<br />#define   IDC_BUTT_STOP                2020<br /><br />MyDialog DIALOG 0,0,130,222<br />STYLE 0x0004 | WS_CAPTION | WS_MINIMIZEBOX |<br />WS_SYSMENU | WS_VISIBLE | WS_OVERLAPPED | DS_MODALFRAME<br />CAPTION &quot;DFC RollerASM 1.0&quot;<br />CLASS &quot;DFCRollerClass&quot;<br />FONT    8, &quot;MS Sans Serif&quot;<br />BEGIN<br />    CONTROL &quot;Desired Stats&#58;&quot;,IDC_STATIC,&quot;static&quot;,0x50000100,5,5,50,10,0x00000000<br />    CONTROL &quot;Strength&#58;&quot;,IDC_STATIC,&quot;static&quot;,0x50000100,5,20,50,10,0x00000000<br />    CONTROL &quot;Constitution&#58;&quot;,IDC_STATIC,&quot;static&quot;,0x50000100,5,35,50,10,0x00000000<br />    CONTROL &quot;Agility&#58;&quot;,IDC_STATIC,&quot;static&quot;,0x50000100,5,50,50,10,0x00000000<br />    CONTROL &quot;Dexterity&#58;&quot;,IDC_STATIC,&quot;static&quot;,0x50000100,5,65,50,10,0x00000000<br />    CONTROL &quot;Intelligence&#58;&quot;,IDC_STATIC,&quot;static&quot;,0x50000100,5,80,50,10,0x00000000<br />    CONTROL &quot;Wisdom&#58;&quot;,IDC_STATIC,&quot;static&quot;,0x50000100,5,95,50,10,0x00000000<br />    CONTROL &quot;Total&#58;&quot;,IDC_STATIC,&quot;static&quot;,0x50000100,5,110,50,10,0x00000000<br />    CONTROL &quot;Best Stats&#58;&quot;,IDC_STATIC,&quot;static&quot;,0x50000100,5,130,50,10,0x00000000<br />    CONTROL &quot;0,0,0,0,0,0 &#91;0&#93;&quot;,IDC_STATIC_BEST,&quot;static&quot;,0x50000100,5,140,80,10,0x00000000<br />    CONTROL &quot;0,0,0,0,0,0 &#91;0&#93;&quot;,IDC_STATIC_CURRENT,&quot;static&quot;,0x50000100,5,150,80,10,0x00000000<br />    CONTROL &quot;Total Rolls&#58;&quot;,IDC_STATIC,&quot;static&quot;,0x50000100,5,165,50,10,0x00000000<br />    CONTROL &quot;0&quot;,IDC_STATIC_TOTAL,&quot;static&quot;,0x50000100,55,165,80,10,0x00000000<br />    CONTROL &quot;0 rolls per 0 secs&quot;,IDC_STATIC_RPS,&quot;static&quot;,0x50000100,5,175,100,10,0x00000000<br />    CONTROL &quot;20&quot;,IDC_EDIT_STR,&quot;edit&quot;,0x50012000,70,20,13,10,0x00000200<br />    CONTROL &quot;20&quot;,IDC_EDIT_CON,&quot;edit&quot;,0x50012000,70,35,13,10,0x00000200<br />    CONTROL &quot;20&quot;,IDC_EDIT_AGI,&quot;edit&quot;,0x50012000,70,50,13,10,0x00000200<br />    CONTROL &quot;20&quot;,IDC_EDIT_DEX,&quot;edit&quot;,0x50012000,70,65,13,10,0x00000200<br />    CONTROL &quot;20&quot;,IDC_EDIT_INT,&quot;edit&quot;,0x50012000,70,80,13,10,0x00000200<br />    CONTROL &quot;20&quot;,IDC_EDIT_WIS,&quot;edit&quot;,0x50012000,70,95,13,10,0x00000200<br />    CONTROL &quot;120&quot;,IDC_EDIT_TOTAL,&quot;edit&quot;,0x50012000,70,110,17,10,0x00000200<br />    CONTROL &quot;at least&quot;,IDC_CHK_STR,&quot;button&quot;,0x50010003,90,20,50,10,0x00000000<br />    CONTROL &quot;at least&quot;,IDC_CHK_CON,&quot;button&quot;,0x50010003,90,35,50,10,0x00000000<br />    CONTROL &quot;at least&quot;,IDC_CHK_AGI,&quot;button&quot;,0x50010003,90,50,50,10,0x00000000<br />    CONTROL &quot;at least&quot;,IDC_CHK_DEX,&quot;button&quot;,0x50010003,90,65,50,10,0x00000000<br />    CONTROL &quot;at least&quot;,IDC_CHK_INT,&quot;button&quot;,0x50010003,90,80,50,10,0x00000000<br />    CONTROL &quot;at least&quot;,IDC_CHK_WIS,&quot;button&quot;,0x50010003,90,95,50,10,0x00000000<br />    CONTROL &quot;at least&quot;,IDC_CHK_TOTAL,&quot;button&quot;,0x50010003,90,110,46,10,0x00000000<br />    CONTROL &quot;&amp;Start&quot;,IDC_BUTT_START,&quot;button&quot;,0x50010000,5,190,60,15,0x00000000<br />    CONTROL &quot;S&amp;top&quot;,IDC_BUTT_STOP,&quot;button&quot;,0x50010000 | WS_DISABLED,65,190,60,15,0x00000000<br />END<br /><br />MyMenu MENU<br />BEGIN<br />	POPUP &quot;&amp;Options&quot;<br />	BEGIN<br />         MENUITEM &quot;&amp;Start Rolling&quot;,IDM_START<br />         MENUITEM &quot;S&amp;top Rolling&quot;,IDM_STOP,GRAYED<br />         MENUITEM SEPARATOR<br />         MENUITEM &quot;&amp;Reset Best&quot;,IDM_RESET_BEST<br /><br />         MENUITEM &quot;Reset &amp;Total&quot;,IDM_RESET_TOTAL<br /><br />         MENUITEM SEPARATOR<br />         MENUITEM &quot;&amp;Prompt to Keep Stats&quot;,IDM_PROMPT_KEEP,CHECKED<br /><br />         MENUITEM &quot;Prompt to Keep &amp;Best&quot;,IDM_PROMPT_BEST,CHECKED<br /><br />         MENUITEM SEPARATOR<br />         MENUITEM &quot;&amp;Play Sound on Keep Stats&quot;,IDM_PLAY_KEEP,CHECKED<br /><br />         MENUITEM &quot;Play Sound on Keep &amp;Best&quot;,IDM_PLAY_BEST,CHECKED<br /><br />         MENUITEM SEPARATOR<br />         MENUITEM &quot;E&amp;xit&quot;,IDM_EXIT<br />	END<br />	POPUP &quot;&amp;Windows&quot;<br />	BEGIN<br />         MENUITEM &quot;Mi&amp;nimize DFC&quot;,IDM_MIN_DFC<br />         MENUITEM &quot;&amp;Restore DFC&quot;,IDM_RESTORE_DFC<br />         MENUITEM SEPARATOR<br />         MENUITEM &quot;&amp;Send to Tray&quot;,IDM_TRAY<br />         MENUITEM &quot;R&amp;estore&quot;,IDM_RESTORE,GRAYED<br />	END<br />	POPUP &quot;&amp;Help&quot;<br />	BEGIN<br />         MENUITEM &quot;DFC Roller &amp;Help&quot;,IDM_DFCROLLER_HELP<br />         MENUITEM &quot;DFC &amp;Roller Homepage&quot;,IDM_DFCROLLER_HOMEPAGE<br />         MENUITEM SEPARATOR<br />         MENUITEM &quot;Darkcrusades &amp;Homepage&quot;,IDM_DARKCRUSADES_HOMEPAGE<br />         MENUITEM &quot;Darkcrusades &amp;Forum&quot;,IDM_DARKCRUSADES_FORUM<br />         MENUITEM SEPARATOR<br />         MENUITEM &quot;&amp;Write Comment&quot;,IDM_WRITE_COMMENT<br />         MENUITEM &quot;&amp;About&quot;,IDM_ABOUT<br />	END<br />END<br /><br />dfcroller.asm<br /><br />.486<br />.model flat,stdcall<br />option casemap&#58;none<br />WinMain PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD<br />clearstr proto &#58;DWORD<br />getstrlen proto &#58;DWORD<br />addtostr proto &#58;DWORD,&#58;DWORD<br />replacestr proto &#58;DWORD,&#58;DWORD<br />CheckStats proto<br />SetStats proto<br />GetStats proto<br />CompareStats proto<br />AcceptStats proto<br />Pause proto &#58;DWORD<br />Stringlen proto&#58;DWORD<br />PtrStrCmp proto&#58;DWORD,&#58;DWORD<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\gdi32.inc<br />include \masm32\include\shell32.inc<br />include \masm32\include\winmm.inc<br />include \masm32\include\masm32.inc<br />include \masm32\macros\macros.asm<br /><br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\gdi32.lib<br />includelib \masm32\lib\shell32.lib<br />includelib \masm32\lib\winmm.lib<br />includelib \masm32\lib\masm32.lib<br /><br />.data<br />ClassName db &quot;DFCRollerClass&quot;,0<br />MenuName db &quot;MyMenu&quot;,0<br />DlgName db &quot;MyDialog&quot;,0<br />AppName db &quot;DFC RollerASM 1.0&quot;,0<br /><br />Class_DFC_Main db &quot;darknessfallscrusadeclient&quot;,0<br />Class_DFC_Namegen db &quot;namegen&quot;,0<br />Class_DFC_Imagebutton db &quot;imagebutton&quot;,0<br /><br />strStart db &quot;&amp;Start&quot;,0<br />strStop db &quot;S&amp;top&quot;,0<br />aboutText db &quot;Coded by Falaris in MASM32 8.0&quot;,13,10,\<br />	&quot;Dedicated to Killaree. She is that lazy. &#58;&#41;&quot;,0<br />strDFCRoller_Home_LINK db &quot;http&#58;//www.darkcrusades.com/roller.htm&quot;,0<br />strDarkCrusades_Home_LINK db &quot;http&#58;//www.darkcrusades.com&quot;,0<br />strDarkCrusades_Forum_LINK db &quot;http&#58;//www.darkcrusades.com/forum/default.asp&quot;,0<br />strWrite_Comment_LINK db &quot;mailto&#58;xkardisx@hotmail.com&quot;,0<br /><br />strDFC_Not_Found db &quot;DFC not found!&quot;,0<br />strProcess_Error db &quot;Unable to open DFC process for memory reading!&quot;,0<br /><br />strStatsError db &quot;&#91;Stats&#93; Please enter numbers between 0-20!&quot;,0<br />strTotalError db &quot;&#91;Total&#93; Please enter numbers between 0-120!&quot;,0<br /><br />strReset_Best db &quot;&amp;Reset Best&quot;,0<br />strReset_Total db &quot;Reset &amp;Total&quot;,0<br />strPrompt_Keep db &quot;&amp;Prompt to Keep Stats&quot;,0<br />strPrompt_Best db &quot;Prompt to Keep &amp;Best&quot;,0<br />strPlay_Keep db &quot;&amp;Play Sound on Keep Stats&quot;,0<br />strPlay_Best db &quot;Play Sound on Keep &amp;Best&quot;,0<br />strMin_DFC db &quot;Mi&amp;nimize DFC&quot;,0<br />strRestore_DFC db &quot;&amp;Restore DFC&quot;,0<br />strTray db &quot;&amp;Send to Tray&quot;,0<br />strRestore db &quot;R&amp;estore&quot;,0<br />strDFCRoller_Help db &quot;DFC Roller &amp;Help&quot;,0<br />strDFCRoller_Homepage db &quot;DFC &amp;Roller Homepage&quot;,0<br />strDarkcrusades_Homepage db &quot;Darkcrusades &amp;Homepage&quot;,0<br />strDarkcrusades_Forum db &quot;Darkcrusades &amp;Forum&quot;,0<br />strWrite_Comment db &quot;&amp;Write Comment&quot;,0<br />strAbout db &quot;&amp;About&quot;,0<br />strExit db &quot;E&amp;xit&quot;,0<br /><br />strBestRoll db &quot;0,0,0,0,0,0 &#91;0&#93;&quot;,0<br />strCurrentRoll db &quot;0,0,0,0,0,0 &#91;0&#93;&quot;,0<br />strRPS db &quot;0 rolls per 0 secs&quot;,0<br />strRealRPS db &quot;1.11&quot;,0<br />strTotalCount db &quot;0&quot;,0<br />dwTotalCount DWORD 0<br />dwCount DWORD 0<br /><br />bPassed BOOL TRUE<br />bStats BOOL FALSE<br />bChk BOOL 7 dup&#40;FALSE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE&#41;<br /><br />bPromptKeep BOOL TRUE<br />bPromptBest BOOL TRUE<br />bPlayKeep BOOL TRUE<br />bPlayBest BOOL TRUE<br /><br />strAcceptStats db &quot;Keep Stats?&quot;,13,10,0<br />strAcceptBest db &quot;Keep Best?&quot;,13,10,0<br /><br />strOptions db &quot;&amp;Options&quot;,0<br />strWindows db &quot;&amp;Windows&quot;,0<br />strHelp db &quot;&amp;Help&quot;,0<br /><br />strBlankBuffer db 0<br /><br />oldBuffer db &quot;TEST&quot;,0<br />.data?<br />hInstance HINSTANCE ?<br />hDlg HWND ?<br /><br />OldWndProc	dd ?<br />hThread DWORD ?<br />ThreadID DWORD ?<br />hEventStart HANDLE ?<br />EventStop BOOL ?<br /><br />note NOTIFYICONDATA &lt;&gt;<br /><br />hDFC HWND ?<br />hNameGen HWND ?<br />hImageButton HWND ?<br />hRollButton HWND ?<br />hYesButton HWND ?<br />pHandle HWND ?<br />pID DWORD ?<br /><br />hStartButton HWND ?<br />hStopButton HWND ?<br />hEditBox	dd 8 dup&#40;?&#41;<br />hChkBox		dd 8 dup&#40;?&#41;<br /><br />hLabelBest HWND ?<br />hLabelCurrent HWND ?<br />hLabelTotal HWND ?<br />hLabelRPS HWND ?<br /><br />statsBuffer db 256 dup&#40;?&#41;<br /><br />strDirPath db 256 dup&#40;?&#41;<br />strHelpPath db 256 dup&#40;?&#41;<br />strSoundKeepPath db 256 dup&#40;?&#41;<br />strSoundBestPath db 256 dup&#40;?&#41;<br /><br />dirBuffer db 256 dup&#40;?&#41;<br />strRollBuffer db 256 dup&#40;?&#41;<br /><br />statsStr DWORD ?<br />statsCon DWORD ?<br />statsAgi DWORD ?<br />statsDex DWORD ?<br />statsInt DWORD ?<br />statsWis DWORD ?<br />statsTotal DWORD ?<br />arrStr dd 8 dup&#40;?&#41;<br />dwTotal DWORD ?<br />dwBest DWORD ?<br />dwStats DWORD 8 dup&#40;?&#41;<br />dwSetStats DWORD 8 dup&#40;?&#41;<br />buffer BYTE 256 dup&#40;?&#41;<br />buffer2 BYTE 256 dup&#40;?&#41;<br />bufferValue BYTE 256 dup&#40;?&#41;<br /><br />dwRet1 DWORD ?<br /><br />.const <br />addrStats equ 4681024<br />WM_SHELLNOTIFY equ WM_USER+5<br /><br />IDM_OPTIONS equ 20<br />IDM_WINDOWS equ 21<br />IDM_HELP equ 22<br />IDI_TRAY equ 0<br />IDM_CURRENTLABEL equ 69<br />IDM_START equ 1<br />IDM_STOP equ 2<br />IDM_RESET_BEST equ 3<br />IDM_RESET_TOTAL equ 4<br />IDM_PROMPT_KEEP equ 5<br />IDM_PROMPT_BEST equ 6<br />IDM_PLAY_KEEP equ 7<br />IDM_PLAY_BEST equ 8<br />IDM_EXIT equ 9<br />IDM_MIN_DFC equ 10<br />IDM_RESTORE_DFC equ 11<br />IDM_TRAY equ 12<br />IDM_RESTORE equ 13<br />IDM_DFCROLLER_HELP equ 14<br />IDM_DFCROLLER_HOMEPAGE equ 15<br />IDM_DARKCRUSADES_HOMEPAGE equ 16<br />IDM_DARKCRUSADES_FORUM equ 17<br />IDM_WRITE_COMMENT equ 18<br />IDM_ABOUT equ 19<br />IDM_OPTIONS equ 20<br />IDM_WINDOWS equ 21<br />IDM_HELP equ 22<br /><br />IDD_DLG_ROLLER               equ 2000<br />IDC_STATIC_BEST              equ 2001<br />IDC_STATIC_CURRENT           equ 2002<br />IDC_STATIC_TOTAL             equ 2003<br />IDC_STATIC_RPS               equ 2004<br />IDC_EDIT_STR                 equ 2005<br />IDC_EDIT_CON                 equ 2006<br />IDC_EDIT_AGI                 equ 2007<br />IDC_EDIT_DEX                 equ 2008<br />IDC_EDIT_INT                 equ 2009<br />IDC_EDIT_WIS                 equ 2010<br />IDC_EDIT_TOTAL               equ 2011<br />IDC_CHK_STR                  equ 2012<br />IDC_CHK_CON                  equ 2013<br />IDC_CHK_AGI                  equ 2014<br />IDC_CHK_DEX                  equ 2015<br />IDC_CHK_INT                  equ 2016<br />IDC_CHK_WIS                  equ 2017<br />IDC_CHK_TOTAL                equ 2018<br />IDC_BUTT_START               equ 2019<br />IDC_BUTT_STOP                equ 2020<br /><br />.code<br />start&#58;<br />	invoke GetModuleHandle, NULL<br />	mov    hInstance,eax<br />	<br />	;; get current directory of application<br />	invoke GetCurrentDirectory,256,addr strDirPath<br />	<br />	;; set our help file path<br />	invoke szCatStr,addr strHelpPath,addr strDirPath<br />	invoke szCatStr,addr strHelpPath,SADD&#40;&quot;\dfcroller.hlp&quot;&#41;<br />	<br />	;; set sound paths<br />	invoke szCatStr,addr strSoundKeepPath,addr strDirPath<br />	invoke szCatStr,addr strSoundKeepPath,SADD&#40;&quot;\keep.wav&quot;&#41;<br />	<br />	invoke szCatStr,addr strSoundBestPath,addr strDirPath<br />	invoke szCatStr,addr strSoundBestPath,SADD&#40;&quot;\best.wav&quot;&#41;<br />	<br />	invoke WinMain, hInstance,NULL, SW_SHOWDEFAULT<br />	invoke ExitProcess,eax<br />WinMain proc hInst&#58;HINSTANCE,hPrevInst&#58;HINSTANCE,CmdShow&#58;DWORD<br />	LOCAL wc&#58;WNDCLASSEX<br />	LOCAL msg&#58;MSG<br />	mov   wc.cbSize,SIZEOF WNDCLASSEX<br />	mov   wc.style, CS_HREDRAW or CS_VREDRAW<br />	mov   wc.lpfnWndProc, OFFSET WndProc<br />	mov   wc.cbClsExtra,NULL<br />	mov   wc.cbWndExtra,DLGWINDOWEXTRA<br />	push  hInst<br />	pop   wc.hInstance<br />	mov   wc.hbrBackground,COLOR_BTNFACE+1<br />	mov   wc.lpszMenuName,OFFSET MenuName<br />	mov   wc.lpszClassName,OFFSET ClassName<br />	invoke LoadIcon,hInstance,666<br />	mov   wc.hIcon,eax<br />	mov   wc.hIconSm,eax<br />	invoke LoadCursor,NULL,IDC_ARROW<br />	mov   wc.hCursor,eax<br />	invoke RegisterClassEx, addr wc<br />	invoke CreateDialogParam,hInstance,ADDR DlgName,NULL,NULL,NULL<br />	mov  hDlg,eax<br />	<br />	;; get handles of controls<br />	invoke GetDlgItem,hDlg,IDC_CHK_STR<br />	mov &#91;hChkBox+4&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_CHK_CON<br />	mov &#91;hChkBox+8&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_CHK_AGI<br />	mov &#91;hChkBox+12&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_CHK_DEX<br />	mov &#91;hChkBox+16&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_CHK_INT<br />	mov &#91;hChkBox+20&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_CHK_WIS<br />	mov &#91;hChkBox+24&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_CHK_TOTAL<br />	mov &#91;hChkBox+28&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_EDIT_STR<br />	mov &#91;hEditBox+4&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_EDIT_CON<br />	mov &#91;hEditBox+8&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_EDIT_AGI<br />	mov &#91;hEditBox+12&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_EDIT_DEX<br />	mov &#91;hEditBox+16&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_EDIT_INT<br />	mov &#91;hEditBox+20&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_EDIT_WIS<br />	mov &#91;hEditBox+24&#93;,eax<br />	invoke GetDlgItem,hDlg,IDC_EDIT_TOTAL<br />	mov &#91;hEditBox+28&#93;,eax<br />	<br />	invoke GetDlgItem,hDlg,IDC_BUTT_START<br />	mov hStartButton,eax<br />	<br />	invoke GetDlgItem,hDlg,IDC_BUTT_STOP<br />	mov hStopButton,eax<br />	<br />	invoke GetDlgItem,hDlg,IDC_STATIC_BEST<br />	mov hLabelBest,eax<br />	invoke GetDlgItem,hDlg,IDC_STATIC_CURRENT<br />	mov hLabelCurrent,eax<br />	invoke GetDlgItem,hDlg,IDC_STATIC_TOTAL<br />	mov hLabelTotal,eax<br />	invoke GetDlgItem,hDlg,IDC_STATIC_RPS<br />	mov hLabelRPS,eax<br />	<br />	;; check our checkbox<br />	invoke SendMessage,&#91;hChkBox+4&#93;,BM_SETCHECK,1,0<br />	invoke SendMessage,&#91;hChkBox+8&#93;,BM_SETCHECK,1,0<br />	invoke SendMessage,&#91;hChkBox+12&#93;,BM_SETCHECK,1,0<br />	invoke SendMessage,&#91;hChkBox+16&#93;,BM_SETCHECK,1,0<br />	invoke SendMessage,&#91;hChkBox+20&#93;,BM_SETCHECK,1,0<br />	invoke SendMessage,&#91;hChkBox+24&#93;,BM_SETCHECK,1,0<br />	invoke SendMessage,&#91;hChkBox+28&#93;,BM_SETCHECK,1,0<br /><br />	INVOKE ShowWindow, hDlg,SW_SHOWNORMAL<br />	INVOKE UpdateWindow, hDlg<br />	.WHILE TRUE<br />                INVOKE GetMessage, ADDR msg,NULL,0,0<br />                .BREAK .IF &#40;!eax&#41;<br />                invoke IsDialogMessage, hDlg, ADDR msg<br />                .if eax==FALSE<br />                        INVOKE TranslateMessage, ADDR msg<br />                        INVOKE DispatchMessage, ADDR msg<br />                .endif<br />	.ENDW<br />	mov     eax,msg.wParam<br />	ret<br />WinMain endp<br />WndProc proc hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br />	LOCAL hMenu&#58;HWND<br />	LOCAL hSubMenu&#58;HWND<br />	LOCAL hPopupMenu&#58;HWND<br />	LOCAL pt&#58;POINT<br />	.if uMsg==WM_DESTROY<br />		invoke Shell_NotifyIcon,NIM_DELETE,addr note<br />		invoke PostQuitMessage,NULL<br />	.elseif uMsg==WM_SHELLNOTIFY<br />		.if wParam==IDI_TRAY<br />;--------------------------------------------------------------------------------<br />;		Show menus on right-click			<br />			.if lParam==WM_RBUTTONDOWN<br />				invoke GetCursorPos,addr pt<br />				invoke SetForegroundWindow,hDlg<br />				invoke GetMenu,hDlg<br />				mov hMenu,eax<br />				invoke TrackPopupMenu,hMenu,TPM_RIGHTALIGN,pt.x,pt.y,NULL,hDlg,NULL<br />;--------------------------------------------------------------------------------<br />;		Show main window on double left-click			<br />			.elseif lParam==WM_LBUTTONDBLCLK<br />				invoke SendMessage,hWnd,WM_COMMAND,IDM_RESTORE,0<br />			.endif<br />		.endif<br />	.elseif uMsg==WM_CREATE<br />;--------------------------------------------------------------------------------<br />;		create tray<br />		mov note.cbSize,sizeof NOTIFYICONDATA<br />		push hWnd<br />		pop note.hwnd<br />		mov note.uID,IDI_TRAY<br />		mov note.uFlags,NIF_ICON+NIF_MESSAGE+NIF_TIP<br />		mov note.uCallbackMessage,WM_SHELLNOTIFY<br />		invoke LoadIcon,hInstance,666<br />		mov note.hIcon,eax<br />		invoke lstrcpy,addr note.szTip,addr AppName<br />		invoke Shell_NotifyIcon,NIM_ADD,addr note<br />;--------------------------------------------------------------------------------<br />;			Create our new event and threads<br />		invoke CreateEvent,NULL,FALSE,FALSE,NULL<br />		mov  hEventStart,eax<br />		mov  eax,OFFSET RollingThreadProc<br />		invoke CreateThread,NULL,NULL,eax,\<br />                             NULL,NORMAL_PRIORITY_CLASS,\<br />                             addr ThreadID<br />		mov  hThread,eax<br />	.elseif uMsg==WM_COMMAND<br />		mov eax,wParam<br />		.if lParam==0<br />;--------------------------------------------------------------------------------<br />;			find dfc and its children's handles<br />;			open dfc process<br />;			start rolling if all check out<br />;			IDM_START&#58; start rolling<br />			.if ax==IDM_START<br />				invoke FindWindow,addr Class_DFC_Main,NULL<br />				.if eax==0<br />					invoke MessageBox,hDlg,addr strDFC_Not_Found,addr AppName,MB_ICONEXCLAMATION<br />				.else<br />					mov hDFC,eax<br />					invoke FindWindowEx,hDFC,NULL,addr Class_DFC_Namegen,NULL<br />					mov hNameGen,eax<br />					invoke FindWindowEx,hNameGen,NULL,addr Class_DFC_Imagebutton,NULL<br />					mov hImageButton,eax<br />					invoke FindWindowEx,hNameGen,hImageButton,addr Class_DFC_Imagebutton,NULL<br />					mov hImageButton,eax<br />					invoke FindWindowEx,hNameGen,hImageButton,addr Class_DFC_Imagebutton,NULL<br />					mov hRollButton,eax<br />					invoke GetWindowThreadProcessId,hDFC,ADDR pID<br />					invoke OpenProcess,PROCESS_VM_READ,NULL,pID<br />					mov pHandle,eax<br />					.if pHandle==0<br />						invoke MessageBox,hDlg,addr strProcess_Error,addr AppName,MB_ICONEXCLAMATION<br />					.else<br />                		invoke CheckStats			;; check our stats &#40;between 0-20&#41; and &#40;0-120&#41;<br />                		.if bPassed==TRUE<br />							invoke EnableWindow,hStartButton,FALSE<br />							invoke EnableWindow,hStopButton,TRUE<br />							invoke GetMenu,hWnd<br />							mov hMenu,eax<br />							invoke GetSubMenu,hMenu,0<br />							mov hSubMenu,eax<br />							invoke EnableMenuItem,hSubMenu,1,MF_DISABLED<br />							invoke EnableMenuItem,hSubMenu,1,MF_GRAYED<br />							invoke EnableMenuItem,hSubMenu,2,MF_BYCOMMAND<br />							invoke EnableMenuItem,hPopupMenu,1,MF_DISABLED<br />							invoke EnableMenuItem,hPopupMenu,1,MF_GRAYED<br />							invoke EnableMenuItem,hPopupMenu,2,MF_BYCOMMAND<br />							invoke SetStats				;; set our min stats<br />							invoke Pause,500<br />							mov EventStop,FALSE<br />							invoke SetEvent,hEventStart	;; start our thread<br />						.endif<br />					.endif<br />				.endif<br />;--------------------------------------------------------------------------------<br />;			IDM_STOP&#58; Stop thread and reset menu				<br />			.elseif ax==IDM_STOP<br />				mov  EventStop,TRUE<br />				invoke EnableWindow,hStopButton,FALSE<br />				invoke EnableWindow,hStartButton,TRUE<br />				invoke GetMenu,hWnd<br />				mov hMenu,eax<br />				invoke GetSubMenu,hMenu,0<br />				mov hSubMenu,eax<br />				invoke EnableMenuItem,hSubMenu,2,MF_DISABLED<br />				invoke EnableMenuItem,hSubMenu,2,MF_GRAYED<br />				invoke EnableMenuItem,hSubMenu,1,MF_BYCOMMAND<br />				invoke EnableMenuItem,hPopupMenu,2,MF_DISABLED<br />				invoke EnableMenuItem,hPopupMenu,2,MF_GRAYED<br />				invoke EnableMenuItem,hPopupMenu,1,MF_BYCOMMAND<br />;--------------------------------------------------------------------------------<br />;			IDM_EXIT&#58; Exit program<br />			.elseif ax==IDM_EXIT<br />				invoke SendMessage,hDlg,WM_DESTROY,0,0<br />;--------------------------------------------------------------------------------<br />;			IDM_RESET_BEST&#58; Reset best stat<br />			.elseif ax==IDM_RESET_BEST<br />				mov dwBest,0<br />				invoke SendMessage,hLabelBest,WM_SETTEXT,NULL,SADD&#40;&quot;0,0,0,0,0,0 &#91;0&#93;&quot;&#41;<br />;--------------------------------------------------------------------------------<br />;			IDM_RESET_TOTAL&#58; Reset total stats<br />			.elseif ax==IDM_RESET_TOTAL<br />				mov dwTotalCount,0<br />				push dwTotalCount<br />				pop ecx<br />				invoke dwtoa,ecx,ADDR strTotalCount<br />				invoke SendMessage,hLabelTotal,WM_SETTEXT,NULL,addr strTotalCount<br />;--------------------------------------------------------------------------------<br />;			IDM_PROMPT_KEEP&#58; Enable/disable prompt on stat<br />			.elseif ax==IDM_PROMPT_KEEP<br />				invoke GetMenu,hWnd<br />				mov hMenu,eax<br />				invoke GetSubMenu,hMenu,0<br />				mov hSubMenu,eax<br />				.if bPromptKeep==0<br />					mov bPromptKeep,1<br />					invoke CheckMenuItem,hSubMenu,5,MF_CHECKED<br />				.else<br />					mov bPromptKeep,0<br />					invoke CheckMenuItem,hSubMenu,5,MF_UNCHECKED<br />				.endif<br />;--------------------------------------------------------------------------------<br />;			IDM_PROMPT_BEST&#58; Enable/disable prompt on best stat<br />			.elseif ax==IDM_PROMPT_BEST<br />				invoke GetMenu,hWnd<br />				mov hMenu,eax<br />				invoke GetSubMenu,hMenu,0<br />				mov hSubMenu,eax<br />				.if bPromptBest==FALSE<br />					mov bPromptBest,TRUE<br />					invoke CheckMenuItem,hSubMenu,6,MF_CHECKED<br />				.else<br />					mov bPromptBest,FALSE<br />					invoke CheckMenuItem,hSubMenu,6,MF_UNCHECKED<br />				.endif<br />;--------------------------------------------------------------------------------<br />;			IDM_PLAY_KEEP&#58; Enable/disable sound on stat<br />			.elseif ax==IDM_PLAY_KEEP<br />				invoke GetMenu,hWnd<br />				mov hMenu,eax<br />				invoke GetSubMenu,hMenu,0<br />				mov hSubMenu,eax<br />				.if bPlayKeep==FALSE<br />					mov bPlayKeep,TRUE<br />					invoke CheckMenuItem,hSubMenu,7,MF_CHECKED<br />				.else<br />					mov bPlayKeep,FALSE<br />					invoke CheckMenuItem,hSubMenu,7,MF_UNCHECKED<br />				.endif<br />;--------------------------------------------------------------------------------<br />;			IDM_PLAY_BEST&#58; Enable/disble sound on best<br />			.elseif ax==IDM_PLAY_BEST<br />				invoke GetMenu,hWnd<br />				mov hMenu,eax<br />				invoke GetSubMenu,hMenu,0<br />				mov hSubMenu,eax<br />				.if bPlayBest==0<br />					mov bPlayBest,1<br />					invoke CheckMenuItem,hSubMenu,8,MF_CHECKED<br />				.else<br />					mov bPlayKeep,0<br />					invoke CheckMenuItem,hSubMenu,8,MF_UNCHECKED<br />				.endif<br />;--------------------------------------------------------------------------------<br />;			IDM_MIN_DFC&#58; Minimize the game<br />			.elseif ax==IDM_MIN_DFC<br />				invoke FindWindow,addr Class_DFC_Main,NULL<br />				.if eax==0<br />					invoke MessageBox,hDlg,addr strDFC_Not_Found,addr AppName,MB_ICONEXCLAMATION<br />				.else<br />					mov hDFC,eax<br />					invoke ShowWindow,hDFC,SW_MINIMIZE<br />				.endif<br />;--------------------------------------------------------------------------------<br />;			IDM_RESTOER_DFC&#58; Restore the game<br />			.elseif ax==IDM_RESTORE_DFC<br />				invoke FindWindow,addr Class_DFC_Main,NULL<br />				.if eax==0<br />					invoke MessageBox,hDlg,addr strDFC_Not_Found,addr AppName,MB_ICONEXCLAMATION<br />				.else<br />					mov hDFC,eax<br />					invoke ShowWindow,hDFC,SW_RESTORE<br />				.endif<br />;--------------------------------------------------------------------------------<br />;			IDM_TRAY&#58; Hide window -&gt; Send to tray<br />			.elseif ax==IDM_TRAY<br />				invoke ShowWindow,hWnd,SW_HIDE<br />				invoke GetMenu,hWnd<br />				mov hMenu,eax<br />				invoke GetSubMenu,hMenu,1<br />				mov hSubMenu,eax<br />				invoke EnableMenuItem,hSubMenu,3,MF_DISABLED<br />				invoke EnableMenuItem,hSubMenu,3,MF_GRAYED<br />				invoke EnableMenuItem,hSubMenu,4,MF_BYCOMMAND<br />				invoke EnableMenuItem,hPopupMenu,12,MF_DISABLED<br />				invoke EnableMenuItem,hPopupMenu,12,MF_GRAYED<br />				invoke EnableMenuItem,hPopupMenu,13,MF_BYCOMMAND<br />;--------------------------------------------------------------------------------<br />;			IDM_RESTORE&#58; Restore window<br />			.elseif ax==IDM_RESTORE<br />				invoke ShowWindow,hWnd,SW_RESTORE<br />				invoke GetMenu,hWnd<br />				mov hMenu,eax<br />				invoke GetSubMenu,hMenu,1<br />				mov hSubMenu,eax<br />				invoke EnableMenuItem,hSubMenu,4,MF_DISABLED<br />				invoke EnableMenuItem,hSubMenu,4,MF_GRAYED<br />				invoke EnableMenuItem,hSubMenu,3,MF_BYCOMMAND<br />				invoke EnableMenuItem,hPopupMenu,13,MF_DISABLED<br />				invoke EnableMenuItem,hPopupMenu,13,MF_GRAYED<br />				invoke EnableMenuItem,hPopupMenu,12,MF_BYCOMMAND<br />;--------------------------------------------------------------------------------<br />;			IDM_DFCROLLER_HELP&#58; load help file<br />			.elseif ax==IDM_DFCROLLER_HELP<br />				invoke WinHelp,hWnd,addr strHelpPath,HELP_CONTENTS,NULL<br />;--------------------------------------------------------------------------------<br />;			IDM_DFC_ROLLER_HOMEPAGE | IDM_DARKCRUSADES_HOMEPAGE<br />;			IDM_DARKCRUSADES_FORUM | IDM_WRITE_COMMENT<br />;			Assorted web-links and such.		<br />			.elseif ax==IDM_DFCROLLER_HOMEPAGE<br />				invoke ShellExecute,hWnd,NULL,addr strDFCRoller_Home_LINK,NULL,NULL,SW_SHOWNORMAL<br />			.elseif ax==IDM_DARKCRUSADES_HOMEPAGE<br />				invoke ShellExecute,hWnd,NULL,addr strDarkCrusades_Home_LINK,NULL,NULL,SW_SHOWNORMAL<br />			.elseif ax==IDM_DARKCRUSADES_FORUM<br />				invoke ShellExecute,hWnd,NULL,addr strDarkCrusades_Forum_LINK,NULL,NULL,SW_SHOWNORMAL<br />			.elseif ax==IDM_WRITE_COMMENT<br />				invoke ShellExecute,hWnd,NULL,addr strWrite_Comment_LINK,NULL,NULL,SW_SHOWNORMAL<br />;--------------------------------------------------------------------------------<br />;			IDM_ABOUT&#58; Load the about page<br />			.elseif ax==IDM_ABOUT<br />				invoke LoadIcon,hInstance,666<br />				invoke ShellAbout,hWnd,addr AppName,addr aboutText,eax<br />			.endif<br />		.else<br />;--------------------------------------------------------------------------------<br />;			Button/checkboxes<br />			mov edx,wParam<br />			shr edx,16<br />			.if dx==BN_CLICKED<br />				;; start rolling<br />				.if ax==IDC_BUTT_START<br />					invoke SendMessage,hDlg,WM_COMMAND,IDM_START,0<br />				;; stop rolling<br />				.elseif ax==IDC_BUTT_STOP<br />					invoke SendMessage,hDlg,WM_COMMAND,IDM_STOP,0<br />				;; enable editbox per checkbox<br />				.elseif ax==IDC_CHK_STR<br />					invoke IsWindowEnabled,&#91;hEditBox+4&#93;<br />					.if ax!=1<br />						invoke EnableWindow,&#91;hEditBox+4&#93;,1<br />						mov bChk&#91;4&#93;,1<br />					.else<br />						invoke EnableWindow,&#91;hEditBox+4&#93;,0<br />						mov bChk&#91;4&#93;,0<br />					.endif<br />				.elseif ax==IDC_CHK_CON<br />					invoke IsWindowEnabled,&#91;hEditBox+8&#93;<br />					.if ax!=1<br />						invoke EnableWindow,&#91;hEditBox+8&#93;,1<br />						mov bChk&#91;8&#93;,1<br />					.else<br />						invoke EnableWindow,&#91;hEditBox+8&#93;,0<br />						mov bChk&#91;8&#93;,0<br />					.endif<br />				.elseif ax==IDC_CHK_AGI<br />					invoke IsWindowEnabled,&#91;hEditBox+12&#93;<br />					.if ax!=1<br />						invoke EnableWindow,&#91;hEditBox+12&#93;,1<br />						mov bChk&#91;12&#93;,1<br />					.else<br />						invoke EnableWindow,&#91;hEditBox+12&#93;,0<br />						mov bChk&#91;12&#93;,0<br />					.endif<br />				.elseif ax==IDC_CHK_DEX<br />					invoke IsWindowEnabled,&#91;hEditBox+16&#93;<br />					.if ax!=1<br />						invoke EnableWindow,&#91;hEditBox+16&#93;,1<br />						mov bChk&#91;16&#93;,1<br />					.else<br />						invoke EnableWindow,&#91;hEditBox+16&#93;,0<br />						mov bChk&#91;16&#93;,0<br />					.endif<br />				.elseif ax==IDC_CHK_INT<br />					invoke IsWindowEnabled,&#91;hEditBox+20&#93;<br />					.if ax!=1<br />						invoke EnableWindow,&#91;hEditBox+20&#93;,1<br />						mov bChk&#91;20&#93;,1<br />					.else<br />						invoke EnableWindow,&#91;hEditBox+20&#93;,0<br />						mov bChk&#91;20&#93;,0<br />					.endif<br />				.elseif ax==IDC_CHK_WIS<br />					invoke IsWindowEnabled,&#91;hEditBox+24&#93;<br />					.if ax!=1<br />						invoke EnableWindow,&#91;hEditBox+24&#93;,1<br />						mov bChk&#91;24&#93;,1<br />					.else<br />						invoke EnableWindow,&#91;hEditBox+24&#93;,0<br />						mov bChk&#91;24&#93;,0<br />					.endif<br />				.elseif ax==IDC_CHK_TOTAL<br />					invoke IsWindowEnabled,&#91;hEditBox+28&#93;<br />					.if ax!=1<br />						invoke EnableWindow,&#91;hEditBox+28&#93;,1<br />						mov bChk&#91;28&#93;,1<br />					.else<br />						invoke EnableWindow,&#91;hEditBox+28&#93;,0<br />						mov bChk&#91;28&#93;,0<br />					.endif<br />			.endif<br />		.endif<br />	.endif<br />	.else<br />		invoke DefWindowProc,hWnd,uMsg,wParam,lParam<br />		ret<br />	.endif<br />	xor    eax,eax<br />	ret<br />WndProc endp<br />CheckStats proc<br />;--------------------------------------------------------------------------------<br />;		Check user-input<br />;		stats&#58; 0-20<br />;		total&#58; 0-120<br /><br />	invoke GetWindowText,&#91;hEditBox+4&#93;,addr statsStr,-1<br />	invoke GetWindowText,&#91;hEditBox+8&#93;,addr statsCon,-1<br />	invoke GetWindowText,&#91;hEditBox+12&#93;,addr statsAgi,-1<br />	invoke GetWindowText,&#91;hEditBox+16&#93;,addr statsDex,-1<br />	invoke GetWindowText,&#91;hEditBox+20&#93;,addr statsInt,-1<br />	invoke GetWindowText,&#91;hEditBox+24&#93;,addr statsWis,-1<br />	invoke GetWindowText,&#91;hEditBox+28&#93;,addr statsTotal,-1<br />				<br />	mov bPassed,1<br />	<br />	.if bPassed==1<br />		.if bChk&#91;4&#93;==1<br />		invoke atodw,addr statsStr<br />			.if eax&lt;0 || eax&gt;20<br />				invoke MessageBox,hDlg,addr strStatsError,addr AppName,MB_ICONEXCLAMATION<br />				mov bPassed,0<br />			.endif<br />		.endif<br />	.endif<br />	.if bPassed==1<br />		.if bChk&#91;8&#93;==1<br />			invoke atodw,addr statsCon<br />			.if eax&lt;0 || eax&gt;20<br />				invoke MessageBox,hDlg,addr strStatsError,addr AppName,MB_ICONEXCLAMATION<br />				mov bPassed,0<br />			.endif<br />		.endif<br />	.endif<br />	.if bPassed==1<br />		.if bChk&#91;12&#93;==1<br />			invoke atodw,addr statsAgi<br />			.if eax&lt;0 || eax&gt;20<br />				invoke MessageBox,hDlg,addr strStatsError,addr AppName,MB_ICONEXCLAMATION<br />				mov bPassed,0<br />			.endif<br />		.endif<br />	.endif<br />	.if bPassed==1<br />		.if bChk&#91;16&#93;==1<br />			invoke atodw,addr statsDex<br />			.if eax&lt;0 || eax&gt;20<br />				invoke MessageBox,hDlg,addr strStatsError,addr AppName,MB_ICONEXCLAMATION<br />				mov bPassed,0<br />			.endif<br />		.endif<br />	.endif<br />	.if bPassed==1<br />		.if bChk&#91;20&#93;==1<br />			invoke atodw,addr statsInt<br />			.if eax&lt;0 || eax&gt;20<br />				invoke MessageBox,hDlg,addr strStatsError,addr AppName,MB_ICONEXCLAMATION<br />				mov bPassed,0<br />			.endif<br />		.endif<br />	.endif<br />	.if bPassed==1<br />		.if bChk&#91;24&#93;==1<br />			invoke atodw,addr statsWis<br />			.if eax&lt;0 || eax&gt;20<br />				invoke MessageBox,hDlg,addr strStatsError,addr AppName,MB_ICONEXCLAMATION<br />				mov bPassed,0<br />			.endif<br />		.endif<br />	.endif<br />	.if bPassed==1<br />		.if bChk&#91;28&#93;==1<br />			invoke atodw,addr statsTotal<br />			.if eax&lt;0 || eax&gt;120<br />				invoke MessageBox,hDlg,addr strTotalError,addr AppName,MB_ICONEXCLAMATION<br />				mov bPassed,0<br />			.endif<br />		.endif<br />	.endif<br />					<br />	ret<br />CheckStats endp<br />SetStats proc<br /><br />;--------------------------------------------------------------------------------<br />;		Set the minimum stats &#40;user defined&#41;<br /><br />	.if bPassed==1				<br />		;; convert the string to DWORD<br />		invoke atodw,addr statsStr<br />		mov dwSetStats&#91;4&#93;,eax<br />		invoke atodw,addr statsCon<br />		mov dwSetStats&#91;8&#93;,eax<br />		invoke atodw,addr statsAgi<br />		mov dwSetStats&#91;12&#93;,eax<br />		invoke atodw,addr statsDex<br />		mov dwSetStats&#91;16&#93;,eax<br />		invoke atodw,addr statsInt<br />		mov dwSetStats&#91;20&#93;,eax<br />		invoke atodw,addr statsWis<br />		mov dwSetStats&#91;24&#93;,eax<br />		invoke atodw,addr statsTotal<br />		mov dwSetStats&#91;28&#93;,eax	<br />	.endif<br />	ret<br /><br />SetStats endp<br />RollingThreadProc proc USES ecx Param&#58;DWORD<br />	local dwFind&#58;DWORD<br />	local dwLen&#58;DWORD<br /><br />	invoke WaitForSingleObject,hEventStart,INFINITE<br />	invoke GetTickCount<br />	mov dwRet1,eax<br />	.REPEAT<br /><br />label_reroll&#58;<br />	.if EventStop==TRUE<br />		jmp RollingThreadProc<br />	.endif<br />	<br />	invoke SendMessage,hRollButton,WM_LBUTTONUP,NULL,NULL<br />	<br />	mov ecx,dwTotalCount<br />	inc ecx<br />	push ecx<br />	invoke dwtoa,ecx,ADDR strTotalCount<br />	invoke SendMessage,hLabelTotal,WM_SETTEXT,NULL,addr strTotalCount<br />	pop dwTotalCount<br />	mov ecx,dwTotal<br />	inc ecx<br />	push ecx<br />	pop dwTotal<br />	invoke GetTickCount<br />	sub eax,dwRet1<br />	.if eax&gt;=1000<br />		mov ecx,dwTotal<br />		invoke dwtoa,ecx,ADDR strRPS<br />		invoke szMultiCat,1,ADDR strRPS,SADD&#40;&quot; rolls per secs&quot;&#41;<br />		invoke SendMessage,hLabelRPS,WM_SETTEXT,NULL,addr strRPS<br />		mov dwTotal,0<br />		invoke GetTickCount<br />		mov dwRet1,eax<br />	.endif<br />	<br />label_reroll&#58;<br />	invoke Pause,10	;; 10 milisec delay<br />	invoke ReadProcessMemory,pHandle,addrStats,addr statsBuffer,22,NULL<br />	<br />	invoke lnstr,ADDR oldBuffer<br />	push eax<br />	invoke lnstr,ADDR statsBuffer<br />	pop ecx<br />	cmp eax,ecx<br />	inc ecx<br />	jne label_parse_string<br />label_cmpstr&#58;<br />	cmp ecx,0<br />	jz label_parse_string<br />	dec ecx<br />	lea esi,oldBuffer<br />	lea edi,statsBuffer<br />	mov al,&#91;esi+ecx&#93;<br />	cmp al,&#91;edi+ecx&#93;<br />	jne label_parse_string<br />	jmp label_cmpstr<br /><br />	;; string manipulation<br />	;; each stats are between |<br />	;; example&#58; eoisd|18|18|18|18|18|18|ds0<br />label_parse_string&#58;<br />	invoke replacestr,ADDR statsBuffer,ADDR oldBuffer<br />	invoke lnstr,addr statsBuffer<br />	mov dwLen,eax<br />	invoke InString,1,addr statsBuffer,SADD&#40;&quot;|&quot;&#41;<br />	.if eax!=0<br />		sub dwLen,eax<br />		;; /STR<br />		invoke szRight,addr statsBuffer,addr buffer,dwLen<br />		invoke InString,1,addr buffer,SADD&#40;&quot;|&quot;&#41;<br />		sub dwLen,eax<br />		mov dwFind,eax<br />		sub dwFind,1<br />		invoke szMid,addr buffer,addr bufferValue,0,dwFind<br />		invoke atodw,addr bufferValue<br />		mov dwStats&#91;4&#93;,eax<br />		cmp eax,20<br />		jg label_reroll<br />		<br />		;; CON<br />		invoke szRight,addr buffer,addr buffer2,dwLen<br />		invoke InString,1,addr buffer2,SADD&#40;&quot;|&quot;&#41;<br />		sub dwLen,eax<br />		mov dwFind,eax<br />		sub dwFind,1<br />		invoke szMid,addr buffer2,addr bufferValue,0,dwFind<br />		invoke atodw,addr bufferValue<br />		mov dwStats&#91;8&#93;,eax<br />		cmp eax,20<br />		jg label_reroll<br />		<br />		;; AGI<br />		invoke szRight,addr buffer2,addr buffer,dwLen<br />		invoke InString,1,addr buffer,SADD&#40;&quot;|&quot;&#41;<br />		sub dwLen,eax<br />		mov dwFind,eax<br />		sub dwFind,1<br />		invoke szMid,addr buffer,addr bufferValue,0,dwFind<br />		invoke atodw,addr bufferValue<br />		mov dwStats&#91;12&#93;,eax<br />		cmp eax,20<br />		jg label_reroll<br />		<br />		;; DEX<br />		invoke szRight,addr buffer,addr buffer2,dwLen<br />		invoke InString,1,addr buffer2,SADD&#40;&quot;|&quot;&#41;<br />		sub dwLen,eax<br />		mov dwFind,eax<br />		sub dwFind,1<br />		invoke szMid,addr buffer2,addr bufferValue,0,dwFind<br />		invoke atodw,addr bufferValue<br />		mov dwStats&#91;16&#93;,eax<br />		cmp eax,20<br />		jg label_reroll<br />		<br />		;; INT<br />		invoke szRight,addr buffer2,addr buffer,dwLen<br />		invoke InString,1,addr buffer,SADD&#40;&quot;|&quot;&#41;<br />		sub dwLen,eax<br />		mov dwFind,eax<br />		sub dwFind,1<br />		invoke szMid,addr buffer,addr bufferValue,0,dwFind<br />		invoke atodw,addr bufferValue<br />		mov dwStats&#91;20&#93;,eax<br />		cmp eax,20<br />		jg label_reroll<br />				<br />		;; WIS<br />		invoke szRight,addr buffer,addr buffer2,dwLen<br />		invoke InString,1,addr buffer2,SADD&#40;&quot;|&quot;&#41;<br />		sub dwLen,eax<br />		mov dwFind,eax<br />		sub dwFind,1<br />		invoke szMid,addr buffer2,addr bufferValue,0,dwFind<br />		invoke atodw,addr bufferValue<br />		mov dwStats&#91;24&#93;,eax<br />		cmp eax,20<br />		jg label_reroll<br />	.endif<br />	<br />				<br />	;; add our stats together<br />	xor eax,eax<br />	mov ecx,1<br />@@&#58;<br />	add eax,dwStats&#91;4*ecx&#93;<br />	inc ecx<br />	cmp ecx,7<br />	jne @B<br />	<br />	;; set stat total<br />	mov dwStats&#91;28&#93;,eax<br /><br />	push eax<br />	<br />	;; convert to string<br />	invoke dwtoa,dwStats&#91;4&#93;,addr statsStr<br />	invoke dwtoa,dwStats&#91;8&#93;,addr statsCon<br />	invoke dwtoa,dwStats&#91;12&#93;,addr statsAgi<br />	invoke dwtoa,dwStats&#91;16&#93;,addr statsDex<br />	invoke dwtoa,dwStats&#91;20&#93;,addr statsInt<br />	invoke dwtoa,dwStats&#91;24&#93;,addr statsWis<br />	invoke dwtoa,dwStats&#91;28&#93;,addr statsTotal<br />	<br />	;; clear string		<br />	invoke clearstr,addr strRollBuffer		<br />	invoke szMultiCat,14,addr strRollBuffer,\<br />		addr statsStr,SADD&#40;&quot;,&quot;&#41;,\<br />		addr statsCon,SADD&#40;&quot;,&quot;&#41;,\<br />		addr statsAgi,SADD&#40;&quot;,&quot;&#41;,\<br />		addr statsDex,SADD&#40;&quot;,&quot;&#41;,\<br />		addr statsInt,SADD&#40;&quot;,&quot;&#41;,\<br />		addr statsWis,SADD&#40;&quot; &#91;&quot;&#41;,\<br />		addr statsTotal,SADD&#40;&quot;&#93;&quot;&#41;<br /><br />	invoke SendMessage,hLabelCurrent,WM_SETTEXT,NULL,addr strRollBuffer	<br />	<br />	pop eax<br />	.if eax&gt;=dwBest<br />		mov dwBest,eax<br />		invoke SendMessage,hLabelBest,WM_SETTEXT,NULL,addr strRollBuffer	<br />		.if bPromptBest==TRUE<br />			;; Prompt to Acceept<br />			.if bPlayBest==TRUE<br />				invoke sndPlaySound,addr strSoundBestPath,1<br />			.endif<br />			invoke MessageBox,hDlg,addr strRollBuffer,addr AppName,MB_YESNO<br />			.if eax==6<br />				invoke AcceptStats<br />			.endif<br />		.endif<br />	.endif<br />	<br />	mov ecx,1<br />	@@&#58;<br />		mov eax,dwStats&#91;ecx*4&#93;<br />		.if bChk&#91;ecx*4&#93;==1				;; check if this_stat will be checked<br />			mov bStats,TRUE<br />			cmp eax,dwSetStats&#91;ecx*4&#93;	;; if so, compare current stats with set stats<br />			jl label_reroll				;; if less then, reroll again<br />		.endif<br />		inc ecx<br />	    cmp ecx,8<br />	    jne @B<br />	<br />	.if bStats==TRUE<br />		;; all has checked out, prompt use to accept or automatically accept<br />		.if bPromptKeep==TRUE<br />			;;Prompt to Accept<br />			.if bPlayKeep==TRUE<br />				invoke sndPlaySound,addr strSoundKeepPath,1<br />			.endif			<br />			invoke MessageBox,hDlg,addr strRollBuffer,addr AppName,MB_YESNO<br />			.if eax==6<br />				invoke AcceptStats<br />			.endif<br />		.else<br />			invoke AcceptStats<br />		.endif<br />	.endif<br />	.UNTIL EventStop==TRUE<br />	jmp   RollingThreadProc<br />    ret<br />RollingThreadProc ENDP<br />AcceptStats proc<br />	invoke SendMessage,hDlg,WM_COMMAND,IDM_STOP,NULL<br />	mov ecx,4<br />	@@&#58;<br />		<br />		invoke Pause,2000<br />		invoke FindWindowEx,hNameGen,NULL,addr Class_DFC_Imagebutton,NULL<br />		mov hImageButton,eax<br />		invoke FindWindowEx,hNameGen,hImageButton,addr Class_DFC_Imagebutton,NULL<br />		mov hYesButton,eax<br />		invoke SendMessage,hYesButton,WM_LBUTTONDOWN,NULL,NULL<br />		invoke SendMessage,hYesButton,WM_LBUTTONUP,NULL,NULL<br /><br />		dec ecx<br />		jnz @B<br />	ret<br /><br />AcceptStats endp<br />Pause proc interval&#58;DWORD<br />	local ret1&#58;DWORD<br />	<br />	invoke GetTickCount<br />	mov ret1,eax<br />	mov ecx,0<br />	.while ecx&lt;interval<br />		invoke GetTickCount<br />		mov ecx,eax<br />		sub ecx,ret1<br />	.endw<br />	ret<br />Pause endp<br />clearstr proc string_source&#58;DWORD<br />	mov esi,string_source<br />	xor al,al<br />	mov &#91;esi&#93;,al<br />	ret<br />clearstr endp<br />getstrlen proc string_source&#58;DWORD<br />	;; len return in ecx<br />	mov esi,&#91;string_source&#93;<br />	mov ecx,-1<br />	@@&#58;<br />		inc ecx<br />		mov al,&#91;esi+ecx&#93;<br />		test al,al<br />		jne @B<br />	ret<br />getstrlen endp<br />addtostr proc string_source&#58;DWORD,string_to_add&#58;DWORD<br />	invoke getstrlen,string_source<br />	mov esi,string_source<br />	mov edi,string_to_add<br />	add esi,ecx<br />	xor ecx,ecx<br />	@@&#58;<br />		mov al,&#91;edi+ecx&#93;<br />		mov &#91;esi+ecx&#93;,al<br />		inc ecx<br />		test al,al<br />		jne @B<br />	ret<br />addtostr endp<br />replacestr proc string_source&#58;DWORD, string_dest&#58;DWORD<br />	mov esi,string_source<br />	mov edi,string_dest<br />				<br />	@@&#58;<br />		mov al, &#91;esi&#93;		; copy byte at address in esi to al<br />		inc esi				; increment address in esi<br />		mov &#91;edi&#93;, al		; copy byte in al to address in edi<br /><br />		inc edi			; increment address in edi<br />		test al,al		; see if its an ascii zero<br />		jne @B		; jump back and read next byte if not<br />	ret<br />replacestr endp<br />end start<br /></code></pre></div>
    <div class="meta">Posted on 2003-04-05 16:01:03 by xkardisx</div>
   </div>
  </div>
 </body>
</html>