<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Implenting OOP by macro in MASM - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=12808" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=12808">Implenting OOP by macro in MASM</a></p>
   <div class="post" id="post-99238">
    <div class="subject"><a href="#post-99238">Implenting OOP by macro in MASM</a></div>
    <div class="body">Implenting OOP by macro in MASM<br />Thomas Bleeker and NaN have done a great work on this. I have written a small game using their OOP model. I found it useful in expressing idea and writting more clear code. However, some improvment was need:<br />1.there is a lot work to do if you want to use it. For example, the functions' proto, and the functions' long name. The obj creator do help you do this annoying things, but there's some problem in the creator, also. <br />2.Uncessary overhead was introduced, all method was virtual, so a method call have to be indirect via pointer. <br />3.Some function should be strengthen, for example, SUPER can only super one level in inheritance.<br />I have asked Thomas about this. As he said, the OOP model was kept relativly simple in the beginning, and the model's design imitates the Java's way. There's a long time since the last update of the model. I want to continue the two's work and NEED YOUR OPINION AND HELP.<br />I have serval idea and have tried a little. I have confidence to give a simple and powerful solution to this. Although the model may be more like a game to a significant work, I've decided to do this. I am a student in Beijing China, I am not a experienced programmer in asm, but more familiar to C++ and pascal. I have translated the win32asm tutorial written by Thomas Bleeker into chinese, and analysed the old OOP model in detail one month ago, and have known the C++ and Object Pascal's way, too. Recently, I tried the Masm's macro power and found it powerful enough to do some work that a complier can do.<br />------------------------------------------------------------<br />I have searched the net for a description about the old OOP model, but a little result was found. So, I do this myself, and learned a lot from the design. Thank you Thomas Bleeker, Thank you NaN, Your work is so good that help me grasp the essence behind OOP. I want to write a little about the old OOP model first:<br />A first step into macro OOP model<br />As well known, OOP has three key concept. That is encapsulate, inheritance, polymorphic. To achieve these targets, there are serval model, macro OOP model follows the one table model which is the simplest.<br />OOP is just a idea, ALL language can use it. You can use OOP manually in asm, put data in a struct and put function ptr in the struct too, or using name mangling to write non-virtual function. But it is hard and seems unnecessary comparing the work done and benefit gained. Macro is the tool we can use to change this, You can use Macro to do this for you. The power of macro is more and more knowned, C++'s template is also a macro actually. MASM's macro can  accept VARARG, can do string parsing, can be nested. Too powerful to be true.<br />A class is a struct, and a virtual function is a function which stores its pointer in the struct, a non-virtual function is a function whose name is manglinged to &quot;be&quot; a class's method, inheritance just contain the base's struct in the derive's struct, override just move new ptr to the struct, abstract base class just set the function ptr to a special function which raise a error when you try to call it. Essence is simple and straight forward, but you have to do some dirty work in the macro and do a lot work under the hood.<br />Thomas Bleeker and NaN used following macro to do this:<br />CLASS<br />CMETHOD<br />SET_CLASS<br />BEGIN_INIT<br />END_INIT<br />The five was the most important, others are relatively simple.<br />   CLASS Shape, Shap<br />      CMETHOD destructor<br />      CMETHOD getArea<br />      CMETHOD setColor<br />      Color     dd    ?<br />   Shape ENDS<br />define a struct and the init val was set in the .data, a label was used to label the beginning pos, a textequ was used to record the init size. all the init work was done by BEGIN_INIT, END_INIT. SET_CLASS was called in the ctor, and move the init val to the struct, and do inheritance if INHERITS presents, something confusing in this macro, due to there is only one dtor and the pos was the first entry in the struct. OVERRIDE have to be done manually which is inconvenient. CMETHOD assume the Shape_getAreaPto ... was defined prev.<br />-------------------------------------------------------------<br />A fully analysz will be written in the next post, stop here. I will demonstrate my opinion in sample code:<br />CLASS Shape<br />	METHOD Dtor<br />	METHOD getArea<br />	METHOD setColor<br />	VAR DWORD, Color, 0<br />CLASS END<br />METHOD Dtor<br />	ret<br />METHOD END<br />...<br />no begin_init or end_init or proto was required, it's possible by textequ. The work macro done is more like a complier, symbolic table was created.<br />CLASS Circle : Shape<br />	METHOD getArea<br />CLASS END<br />do the inheritance, the same name getArea cause override.<br />instance a object can be done only via new before, I want to <br />some_funct PROC<br />local i,j<br />VAR one_circle:Circle<br />....<br />some_funct ENDP<br />can be possbile via option prologue and option epilogue and textequs.<br />OPATTR was used to test if the function was a virtual or non-virtual, I have tested it and it works well.<br />A fully doable demonstration was in progress.<br />NOW, I NEED YOUR OPINION AND HELP</div>
    <div class="meta">Posted on 2003-04-24 22:16:05 by taowen2002</div>
   </div>
   <div class="post" id="post-99243">
    <div class="subject"><a href="#post-99243">Implenting OOP by macro in MASM</a></div>
    <div class="body">tao,<br /><br />It is better to post question of a general nature in the main forum as a lot more people will get to see it and be able to answer you if they understand the question.<br /><br />This forum is more for MASM32 specific questions and it does not get as many people looking at it so I am moving this thread to the main forum so it will be seen by more people.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2003-04-24 22:28:43 by hutch--</div>
   </div>
   <div class="post" id="post-99253">
    <div class="subject"><a href="#post-99253">Implenting OOP by macro in MASM</a></div>
    <div class="body">Oh, sorry, didn't notice.<br />I will take care next time</div>
    <div class="meta">Posted on 2003-04-25 00:01:28 by taowen2002</div>
   </div>
  </div>
 </body>
</html>