<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Opcode #1 - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=8963" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=8963">Opcode #1</a></p>
   <div class="post" id="post-65970">
    <div class="subject"><a href="#post-65970">Opcode #1</a></div>
    <div class="body">It is a try to write a book for those who are always<br />running for knowlege but never can reach it.<br />For people like me. Born dummies.<br /><br />Main style of this material - make theory from<br />examples, not examples from theory.<br />In other words: it's full of examples and exersizes,<br />and the only way to understand theory inside to<br />do all exersizes, and to try all examples.<br /><br />It written to absolute beginners for &quot;opcode&quot; issue,<br />though not beginners to assembler programming.<br /><br />What &quot;opcode&quot; is?<br />-----------------<br />It's a main question of all our lessons.<br />We answer it now in short:<br />Example:<br />	when you write in your source code:<br />	lodsb<br />in compiling stage your assembler (for example ml.exe)<br />when meets &quot;lodsb&quot;<br />will place inside your exe(or first in .obj) file byte of value ACh.<br />This ACh is &quot;opcode&quot;.<br />lodsb is &quot;mnemonic&quot;.<br />mnemonic &quot;lodsb&quot; is saying to assembler ml.exe:<br />&quot;I want you to place byte ACh here in this exe&quot;<br />Processor has no ideas what characters &quot;lodsb&quot; mean.<br />But when its register EIP(that points to command bytes<br />of your loaded exe file)<br />has address of this byte consisting value ACh.<br />it loads the byte inside processor decoder,<br />see that value of it = ACh,<br />and by this value it knows that the programm wants him to <br />load byte pointed by register esi into register al.<br /><br />That simple.<br />So may be we can say:<br />There are mnemonics and opcodes, <br />and each mnemonic is ALIAS for some opcode?<br />Hey, slow down here :)<br />Not just as easy. In this particular case with mnemonic<br />&quot;lodsb&quot;<br />we indeed can say:<br />Yes, opcode for mnemonic &quot;lodsb&quot; is ACh<br />and opcode ACh indentifies mnemonic &quot;lodsb&quot;.<br />Not always. We'll see examples of &quot;why not&quot; very soon.<br />For now I'll just say that primary (real) thing is<br />opcode and mnemonics are names for this thing(s).<br />And as in real life there are not always unic name<br />for unic object, in realation with opcodes and mnemonics<br />there are the same:<br />some real things (different opcodes) may has the same name(mnemonic),<br />and some one opcode value may have several names (mnemonics).<br />+ something that if your a begginer can scare you<br />though it's very simple stuff.<br />so I'll tell you later but soon.<br />Before we come to examples we need to set an easy  way to <br />lookup either:<br />1.what mnemonic is for some opcode value<br />2.what opcode value may be generated from some mnemonic.<br /><br />SETTINGS FOR REFERENCE,TEST AND EXERSIZES<br />------------------------------------------<br />There are many ways to lookup opcode\mnemonics.<br />I recommend the fastest and simplest - use debugger.<br />All examples I'll do in OllyDbg.exe.<br />If you don't have it - download it, it's free and worthy to have.<br />All it is about typing commands - don't run them!<br />Don't press F7,F8,F9!!! After finish with typing<br />exersizes - use ALT-X to exit debugger without running programm.<br /><br />Exersize1. Insert mnemonics and opcodes right in debugger.<br />Typing mnemonics:<br />1 Run OllyDbg.exe<br />2 Open in it ANY win32 prog (exe).<br />3 Start typing: lodsb<br />You'll immidiatly see dialog box with what you are typing.<br />4 After you typed &quot;lodsb&quot; - press enter<br />You will see in programm code window line above grey cursor<br />something like:<br />0040108C &gt;   AC             LODS <br />First column (0040108C) is address of command bytes in memory<br />(the command will be executed when this address will<br />be in EIP register)<br />second column (AC) is OPCODE of command<br />third column (LODS ) is MNEMONIC for the OPCODE.<br /><br />Come on - get used to it, type some other mnemonics and <br />watch their opcodes.<br /><br />Typing opcodes:<br />If you are not in OllyDbg.exe with some prog loaded in it.<br />Do step 1,2 of previous exersize.<br />3. Press ctrl-e<br />You'll see dialog box with bytes and those bytes are real opcode<br />of code <br />4. Type already known to you opcode:<br />AC<br />5. Press enter<br />You'll see in the place where cursor was  2,3 columns <br />will be identical to what we see when typed mnemonic lodsb:<br />AC             LODS <br /><br />Get used to typing hex opcodes in debugger.<br />If you not familiar with opcodes just look at opcodes in loaded<br />code and type them in different lines to see that OllyDbg recognize<br />them.<br />Don't run the mess you typed in :) Not now.<br />Exit OllyDlg using ALT-x without running debuggy.<br /><br />EXERSIZE 2. Are there always 1 mnemonic for 1 opcode?<br /><br />1. Type OPCODE(pressing ctrl-e):<br />90 <br />Press Enter.<br />Look: it is recognized as NOP mnemonic<br />0040108E     90             NOP<br />2. Type MNEMONIC (just type) NOP.<br />you see the same 90 NOP<br />3. Type MNEMONIC xchg eax,eax<br />What a heck!!!<br />OllyDbg doesn't insert our mnemonic!<br />It placed NOP mnemonic instead!!!<br />Yes, it's a question to author - he always show NOP if see<br />90 opcode, never xchg eax,eax.<br />But what is imporatnt to us is that 2 mnemonics:<br />&quot;xchg eax, eax&quot; (or xchg ax,ax in real 16 bit mode)<br />and &quot;nop&quot;<br />both suggest opcode 90h.<br />So we can see how one real thing (opcode), may have different names(mnemonics).<br />I repeat it again:<br />We should always remember the only real thing in computer life is<br />opcode. Mnemonics is just names for those things and this mnemonics<br />system is language, and it's not perfect 'cause there are no perfect languages.<br />The real life is always a little bit different then its description in<br />any language.<br />Before any conclusion let's do second part of exersize.<br />1. Type MNEMONIC add eax,1. Press Enter.<br />You'll see:<br />0040108E     83C0 01        ADD EAX,1<br />2. Press ctrl-e (to bring OPCODE window) <br />and type in it 5 bytes:<br />05 01 00 00 00<br />Surprize, surprize!<br />we can see<br />0040108E     05 01000000    ADD EAX,1<br /><br />The same mnemonic but different opcodes!<br />They are not only different in size.<br />They have different structures.<br />The First one (83C0 01) is 3 byte long, and &quot;three blocks&quot; opcode.<br />The Second one (05 01000000) is 5 bytes long, but is &quot;two blocks&quot; opcode.<br />Before we start learning what those blocks are, lets make some notions.<br /><br />1. As you probably guessed looking at two opcodes<br />83C0 01<br />05 01000000<br />01 in first opcode and 01000000 in the second are immediate value<br />added to eax.<br />Though OllyDbg groups values in a type of some operand, it doesn't change<br />bytes order of this value. Bytes shown from left to right in order of<br />increasing their addresses.<br />In other words Example(type it in):<br />in second opcode version mnemonic<br /> add eax,01020304h<br />will look like<br />05 04030201 (type 05 several times with different following 4 bytes<br />trying to spell different dwords in bytes order)<br />the dword grouped in opcodes (bytes of 01020304h don't separated by spaces)<br />the bytes of the dword placement in order to left to right is spelt<br />as in order of increasing their addresses. And it's right thing to do<br />it that way.<br /><br />Frankly, IMHO, one of greatest mistakes and confusions in all books<br />about assembly  are statements like &quot;bytes in dword are in reversed order&quot;<br />Reversed to what axis?<br />Memory doesn't have right and left coordinates.<br />It has only addresses - interger values.<br />And dword bytes are not placed from left to right of right to left :)<br />Treat 4 bytes in dword as four digits in radix 256 numeric system.<br />Then the higher is digit of the dword the higher address it has<br />for example dword ABCD1234h<br />you may reprisent as:<br />256^3*ABh+ 256^2*CDh + 256^1*12h + 256^0*34h<br />Let's now place those four members of sum that represents value ABCD1234h<br />in order of growing their power of 256 part.<br /><br />256^0*34h - first digit of dword. Byte index=0 power = 0  rva address=0<br />256^1*12h - second digit of dword. Byte index=powerof256=rvaaddress=1<br />256^2*CDh - third digit of dword.Byte index=powerof256=rvaaddress=2<br />256^3*ABh - fourth digit of dword.Byte index=powerof256=rvaaddress=3<br />rva address here is address of byte minus address of dword in memory<br />and you see that address of dword is address <br />of least singnificant value digit, and it is first byte.Or byte[0].<br />and address of any digit of dword minus address of the dword is both <br />index of byte and power of 256 and rva relative to address of dword.<br />No left or right stuff. Numbers, powers, their relation etc. only.<br />The other thing is how numbers SPELT.<br />We spell most singificant digits on left and least on right.<br />So spelling from left to right we spell digits in decreasing segnificance<br />order. If we would type them from right to left we would do it in increasing<br />order. But what direction of our writing or reading has to do with<br />addressing system in computers? Nothing.<br />If it is too complex to your, we'll discuss it in other tutorial<br />&quot;Position numeric system in depth for asm programmer&quot; :)<br />Where you can get it? You can't. It's not written yet.<br />But if you think you know it - think again.<br />First time discussion of positioning numeric system was discribed<br />by Leonardo from Pizza(Fibonachi) in his &quot;book of Abacus&quot; in 13th cent.<br />The whole book (456 pages) is all about positioning numeric system.<br />And yet Eroupe needed ~ 200 years to get to used to it after book was written.<br />Unfortunatly our ancesters were too stupid to count that arabs read and<br />spell from right to left.<br />So if you think you read couple pages of R.Hide book and you<br />know all about it - think again.<br />As well as think again before calling arabs or indians uncivilized or barbaric:<br />they invent it, and use and understand it many centures before us.<br />Now we used it in our siences to make our superweapons to bomb them, <br />calling them not civilized enough for us. Strange way to show gratitude :)<br /><br />OK, to opcode now :)<br /><br />So if there are optional ways to convert the same mnemonic to opcode,<br />what opcode will be actually inserted in exe instead of mnemonics?<br />And who decide on it?<br />The answer is: it does your assember program (ml for masm).<br />It decides it for you, and some low lever coder may not agry that<br />assemblers do it always most optimal way.<br />Assembler always has author, the author may have he's opinion what<br />is optimal and an other coders opinion may differ.<br />We are very lucky here to have real assembler authors (as Privalov,<br />bitov, and I recon that Maveric was saying of his compiler\optimizer)<br />So when you have questions regarding how some assembler treat mnemonics<br />you are lucky to have oportunety to ask it directly to assembler writers,<br />our freinds here.<br /><br />2. You know how to place opcode values directly in debugger,<br />what if you want to code in hex some part directly in source?<br />I think you know answer even if you never did it.<br />When you need to place some particular values in data section (for example<br />some bytes)<br />you probably write<br />somevar db 0Ah,0Dh<br />and you'll have bytes 0Ah,0Dh place inside your app.<br />do the same in code section, you don't need type name for those<br />bytes just declare their values:<br />     db ACh<br />you may code all in hex or just part of it,<br />for example instead of <br />    mov esi,offset somedata<br />    lodsb<br />you may write:<br />    mov esi,offset somedata<br />    db ACh<br /><br />OK It's time again I'm cutted off inet, so I must send what I wrote already<br />or I'll not be able to send anything.<br />Next time we start with structure of opcode.<br />Building blocks of wich opcode is created.<br />Introduction to it only, and few important general rules <br />that you'll find simple and usefull to know.</div>
    <div class="meta">Posted on 2002-11-15 23:31:42 by The Svin</div>
   </div>
   <div class="post" id="post-65978">
    <div class="subject"><a href="#post-65978">Opcode #1</a></div>
    <div class="body">Nice tutorial!<br />And ollydbg helps alot.<br /><br />&quot;So spelling from left to right we spell digits in decreasing segnificance<br />order. If we would type them from right to left we would do it in decreasing<br />order.&quot;<br /><br />Shouldn't it be &quot;If we would type them from right to left we would do it in increasing<br />order.&quot;<br /><br />for example: (twentyfive)<br />..<br />.5<br />25<br /><br />Either it's just a typo or I didn't understand it  :)<br />Maybe you just mean that either way we would start typing with the most significant digit.<br /><br />I just point this out because it could be confusing for beginners.</div>
    <div class="meta">Posted on 2002-11-16 01:59:39 by nyook</div>
   </div>
   <div class="post" id="post-65982">
    <div class="subject"><a href="#post-65982">Opcode #1</a></div>
    <div class="body">Right you are!<br />I fixed the typo. Thanx!</div>
    <div class="meta">Posted on 2002-11-16 03:11:44 by The Svin</div>
   </div>
   <div class="post" id="post-65983">
    <div class="subject"><a href="#post-65983">Opcode #1</a></div>
    <div class="body">In my humble opinion, this 'sample' of your's look's pretty good. Thats a book <br />I would defintly consider reading. Since it could quite possibly still some of <br />my everlasting hunger for knowledge. <br /><br /><strong>NOTE:</strong>  Maybe I would have worked a little bit on the <em>formatting</em> and typo's tho. :tongue:<br /><br /><strong>EDIT:</strong> The Svin: I took the liberty to rewrite some of your writing a little bit. No offence?<br />Just a little something something on how you could have written some of it. <br />Again, I dont mean to offend you in anyway(I am norwegian so english is not my mother tongue either).<br /><br />Here goes nothing:<br />__________________________________________________<br />\  <strong>The Svin's tutorial on Opcode's part #1</strong><br />/?????????????????????????????????????????????????<br />This is my legacy to others, to write a book for those who are always seeking <br />for more knowledge. But get's lost in all the mumbo jumbo. People like myself <br />who where born a crash-test-dummy.<br /><br />Main style of this material is to make theory from examples, not examples<br />from theory. In other words: It's full of examples and exersizes, and the<br />only way to understand the theory inside, is to do all exersizes, and to <br />try all examples.<br /><br />This was written for the absolute beginners concerning the &quot;<em>opcode</em>&quot; issue,<br />though not beginners to assembler programming.<br /><br />__________________________________________________<br />\ <strong>What &quot;<em>opcode</em>&quot; really is?</strong><br />/?????????????????????????????????????????????????<br />This will be the main question resolved over a number of lesson's. We will <br />answer it now in short terms. <br /><br />Example:<br />When you write this in your source code: &quot;<em>lodsb</em>&quot;<br />In the compiling stage of your assembler(f.e 'ml.exe'), as it read's &quot;<em>lodsb</em>&quot;, <br />it will place a file byte value of ACh, inside your exe(or first in .obj).<br /><br />The value 'ACh' is our &quot;<em>opcode</em>&quot;, and &quot;<em>lodsb</em>&quot; is our &quot;mnemonic&quot;.<br /><br />The mnemonic &quot;<em>lodsb</em>&quot; is telling the assembler 'ml.exe': &quot;I want you <br />to place byte 'ACh' here in this .exe&quot;. A Processor has no idea of what the <br />word &quot;<em>lodsb</em>&quot; mean. <br /><br />But when it's register EIP(that points to command bytes of your loaded .exe file) <br />has the address of this byte consisting of value ACh. It loads the byte inside the <br />processor's decoder, and understands that the value of it = ACh, and by this value,<br /> it knows that the program wants him to 'load byte pointed by register esi', <br />into register al. It's actually that simple.<br /><br />So maybe we can say: There are mnemonics and opcodes, and each mnemonic <br />is ALIAS for some opcode? Hey, slow down here! It's not quite that simple. In this <br />particular case with mnemonic &quot;<em>lodsb</em>&quot; we indeed can say: Yes, opcode for mnemonic <br />&quot;<em>lodsb</em>&quot; is ACh and opcode ACh identifies mnemonic &quot;<em>lodsb</em>&quot;. However that <br />is not always the case.<br /><br />We'll see examples of &quot;why not&quot; soon enough. For now I'll just say that the <br />primary subject(real-thing) is that opcode's and mnemonic's are names for these<br />thing's.<br /><br />And just as in real life there are not always unique name's for unique object's,<br />in relation to opcode's and mnemonic's, they are the same: some real things <br />(different opcodes) may have the same name(mnemonic), and some opcode <br />value may have several names (mnemonics).</div>
    <div class="meta">Posted on 2002-11-16 03:52:13 by natas</div>
   </div>
   <div class="post" id="post-66002">
    <div class="subject"><a href="#post-66002">Opcode #1</a></div>
    <div class="body">natas,<br />You are most wellcome for that kind of job you did the above.<br />It's really helpfull, and of course, no offense is taken.<br />In opposite, I'm very gratefull.<br />In past I asked Steve to correct my English :)</div>
    <div class="meta">Posted on 2002-11-16 07:05:45 by The Svin</div>
   </div>
   <div class="post" id="post-66006">
    <div class="subject"><a href="#post-66006">Opcode #1</a></div>
    <div class="body">The Svin,<br />Good to hear that you didnt get offended. I was a little bit worried there for a sec. :grin: <br />Anyway, maybe I should overlook the whole thing and also the other lessons?<br /><br />I dont mind rewriting parts of it to clearer syntax. Since what you have to tell me is <br />things I didnt know about. And when im rewriting this and that, I need to really understand<br />what your trying to say. Therefore, I learn even more from doing it then I normally would have<br />by just reading it. :)<br /><br />But just say the word and ill start analyzing and converting your words a little bit. :alright:</div>
    <div class="meta">Posted on 2002-11-16 07:17:58 by natas</div>
   </div>
   <div class="post" id="post-66016">
    <div class="subject"><a href="#post-66016">Opcode #1</a></div>
    <div class="body">Good read, Svin.  :alright:<br /><br />Natas, you did a good job proofreading.  Your English is very good. :)  Here are some suggestions for you.  I hope they can help you polish your English a bit:<br /><br /><br /><br /><strong>&quot;But get's lost in all the mumbo jumbo.&quot;</strong><br /><br />This is not a sentence.  You need an object, like 'they' (which refers to those 'who seek more knowledge' from the previous sentence.)  Also, there's no need for the apostrophe in 'gets'.   Suggestion:  &quot;...for more knowledge, but they get lost in all the mumbo jumbo.&quot;<br /><br /><br /><br /><strong>&quot;People like myself who where born a crash-test-dummy.&quot;</strong><br /><br />This isn't a sentence because of the 'who' word in there. 'where' should be 'were'.  You might also want to change &quot;crash-test-dummy.&quot;  This typically means somebody that gets beat up a lot.  I don't think Svin was trying to say that.  ;)  Suggestion: &quot;People like myself were born crash test dummies.&quot; or a way that makes more sense in the context of the paragraph:  &quot;This is for people such as myself that were born a dummy.&quot;<br /><br /><br /><br /><strong>&quot;It's full of examples and exersizes, and the only way to understand the theory inside, is to do...&quot;</strong><br /><br />'exersizes' should be 'exercises'.  No comma needed between 'inside' and 'is'.<br /><br /><br /><br />Be careful with your apostrophes.  Never use it to pluralize a word.  Apostrophes often connote possessiveness when they aren't used in conjunctions.  &quot;Bob's code&quot; means the code belongs to Bob.  &quot;Bob's code&quot; can also be a conjunction and means 'Bob is code'.  &quot;Bob's code's&quot; doesn't mean anything, it should be &quot;Bob's codes&quot;   You did this with &quot;lesson's&quot; &quot;thing's&quot;, &quot;opcode's&quot;(2 times) and &quot;mnemonic's.&quot;<br /><br />English isn't as easy as people think it is.  ;)</div>
    <div class="meta">Posted on 2002-11-16 09:29:45 by iblis</div>
   </div>
   <div class="post" id="post-66031">
    <div class="subject"><a href="#post-66031">Opcode #1</a></div>
    <div class="body">The Svin, Great work!!! :)<br />(I've read #1 and #2, and I'm going to spend the most of the night playing with OllyDbg...)</div>
    <div class="meta">Posted on 2002-11-16 11:33:06 by scientica</div>
   </div>
   <div class="post" id="post-66037">
    <div class="subject"><a href="#post-66037">Opcode #1</a></div>
    <div class="body">btw: thank you for the explanation of the reversed byte thing. I thought always that one has to be a dumb nut to write a number in reverse order :D</div>
    <div class="meta">Posted on 2002-11-16 12:43:33 by nyook</div>
   </div>
   <div class="post" id="post-66062">
    <div class="subject"><a href="#post-66062">Opcode #1</a></div>
    <div class="body">iblis, <br />What? you're correcting me? :tongue:  Thanks for correcting some of <br />my writing. I think you would have been a more qualified candidate<br />to do any proofreading.  ;) <br /><br />Apostrophes will always get abused.( they need there own support group :grin: )</div>
    <div class="meta">Posted on 2002-11-16 17:19:11 by natas</div>
   </div>
  </div>
 </body>
</html>