<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Playing a wave via DirectSound - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=2561" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=2561">Playing a wave via DirectSound</a></p>
   <div class="post" id="post-16201">
    <div class="subject"><a href="#post-16201">Playing a wave via DirectSound</a></div>
    <div class="body">Hello!<br /><br />Does anybody knows, how to init the DirectSoundDll an how to load and play a simple wavefile via DirectSound ?<br />Is there a little example everywhere?<br /><br />Thanks, Nordwind.</div>
    <div class="meta">Posted on 2001-12-26 08:30:43 by Nordwind64</div>
   </div>
   <div class="post" id="post-16208">
    <div class="subject"><a href="#post-16208">Initialization</a></div>
    <div class="body">After you init, you must load a wave file and place it in a secondarry buffer via: Lock-mem copy-Unlock . I recomend leting the primary sound buffer play forever and mixing diffrent secondary buffers into it.<br /><br />Init can be done like this:<br /><br /><pre><code><br />;************************************************<br />; DIRECT SOUND INIT<br />;*************************************************<br /><br /><br />extern	DirectSoundCreate&#58;PROC<br /><br />extern	DirectSoundEnumerateA&#58;PROC<br /><br /><br />.data<br />	sound_init_ok		dd	0<br /><br />	lp_dsound_object	dd	0<br /><br />	lp_dsound_buffer	dd	0<br /><br />	sz_data			db	&quot;data&quot;<br />.code<br /><br /><br /><br /><br />Direct_Sound_Init&#58;<br /><br />	call	Create_Direct_Sound_Object<br /><br />;================================<br />; test for success<br />; and dont do inits if no sound<br />;================================<br />	mov	eax,&#91;sound_init_ok&#93;<br />	cmp	eax,0<br />	jz	End_Direct_Sound_Init<br /><br />;=============================<br />; continue intitializations<br />;=============================<br />	call	Set_Direct_Sound_Cooperative_Level<br /><br />	call	Create_Primary_Sound_Buffer<br /><br />	call	Play_Primary_Sound_Buffer<br /><br />End_Direct_Sound_Init&#58;<br /><br />ret<br /><br /><br /><br /><br /><br /><br /><br />;================================<br />; Create a DirectSound Object.<br />;================================<br />.data<br />	szDirectSoundCreateFail	db	&quot;Cant Create Direct Sound Object!&quot;,0<br />.code<br /><br />Create_Direct_Sound_Object&#58;<br />;---------------------------<br />	mov	eax,0<br />	push	eax<br />	<br />	mov	eax,offset lp_dsound_object<br />	push	eax<br /><br />	mov	eax,0<br />	push	eax<br /><br />	call DirectSoundCreate<br /><br />;call DirectSoundCreate, NULL, offset lp_dsound_object,NULL<br /><br />	cmp	eax,DS_OK<br />	jnz	no_sound_init<br /><br />;===============================<br />; flag we have sound enabled<br />;===============================<br />	mov	eax,1<br />	mov	&#91;sound_init_ok&#93;,eax<br />	ret<br /><br />;====================================<br />; flag we have no sound<br />;====================================<br />no_sound_init&#58;<br />	mov	eax,0<br />	mov	&#91;sound_init_ok&#93;,eax<br />;     	call Fail, hwndmain, offset szDirectSoundCreateFail<br />ret<br /><br /><br />;============================<br />; Set Cooperative Level &#40;greedly!&#41;<br />;============================<br />.data<br />	szDirectSoundCooperativeFail	db	&quot;Cant Set Sound Cooperative Level&quot;,0<br />.code<br /><br />Set_Direct_Sound_Cooperative_Level&#58;<br />;-----------------------------------<br /><br />;	mov	eax,DSSCL_EXCLUSIVE<br />	mov	eax,DSSCL_NORMAL<br />;	mov	eax,DSSCL_WRITEPRIMARY<br /><br />	push	eax<br /><br />	mov	eax,&#91;hwndmain&#93;<br />	push	eax<br /><br />	mov 	eax, &#91;lp_dsound_object&#93;<br />	push 	eax<br />	mov 	eax, &#91;eax&#93;<br />	call	&#91;eax + DSO_SetCooperativeLevel&#93;	<br /><br />    ; take action if it fails<br />    .IF eax != DS_OK<br />    	call Fail, hwndmain, offset szDirectSoundCooperativeFail<br />    	jmp end_loop<br />    .ENDIF<br /><br />ret<br /><br />;===============================<br />; Create Primary Sound Buffer<br />;===============================<br />.data<br /><br />	ds_buffdesc_primary		DSBUFFERDESC4	&lt;0&gt;<br /><br />	szCreatePrimarySoundBufferFail	db	&quot;Create Primary Sound Buffer Failed!&quot;,0<br /><br />	lp_dsbuff_primary		dd	0<br />.code<br /><br />Create_Primary_Sound_Buffer&#58;<br /><br />; fill descriptor structure<br />;=======================================<br />	mov	eax,size DSBUFFERDESC4<br />	mov	ds_buffdesc_primary.dwSize,eax<br /><br />	mov	eax,DSBCAPS_PRIMARYBUFFER<br />	mov	ds_buffdesc_primary.dwFlags,eax	<br /><br />; parameters for create<br />;========================================<br />	mov	eax,0<br />	push	eax					;pkunker<br /><br />	mov	eax,offset lp_dsbuff_primary		;pointer<br />	push	eax<br /><br />	mov	eax,offset ds_buffdesc_primary		;descriptor<br />	push	eax<br /><br />	mov 	eax, &#91;lp_dsound_object&#93;<br />	push 	eax<br />	mov 	eax, &#91;eax&#93;<br />	call	&#91;eax + DSO_CreateSoundBuffer&#93;	<br /><br />; take action if it fails<br />;===========================<br />    .IF eax != DS_OK<br />    	call Fail, hwndmain, offset szCreatePrimarySoundBufferFail<br />    	jmp end_loop<br />    .ENDIF	<br /><br />ret<br /><br />;=============================<br />; Lock Primary Sound Buffer<br />;=============================<br /><br />.data<br />	lp_pointer01		dd	0<br />	lp_bytes01		dd	0<br /><br />	lp_pointer02		dd	0<br />	lp_bytes02		dd	0<br />.code<br /><br />Lock_Primary_Sound_Buffer&#58;<br />	mov	eax,0		;dwflags<br />	push	eax<br /><br />	mov	eax,offset lp_bytes02<br />	push	eax<br /><br />	mov	eax,offset lp_pointer02<br />	push	eax<br /><br />	mov	eax,offset lp_bytes01<br />	push	eax<br /><br />	mov	eax,offset lp_pointer01<br />	push	eax<br /><br />	mov	eax,4096	;bytes to lock<br />	push	eax<br /><br />	mov	eax,0		;position in buffer to lock<br />	push	eax<br /><br /><br />	mov 	eax, &#91;lp_dsbuff_primary&#93;<br />	push 	eax<br />	mov 	eax, &#91;eax&#93;<br />	call	&#91;eax + DSB_Lock&#93;	<br /><br />; take action if it fails<br />;===========================<br />    .IF eax != DS_OK<br />    	call Fail, hwndmain, offset szCreatePrimarySoundBufferFail<br />    	jmp end_loop<br />    .ENDIF	<br /><br />ret<br /><br /><br />;================================<br />; UNLock Primary Sound Buffer<br />;================================<br />UnLock_Primary_Sound_Buffer&#58;<br />	mov	eax,offset lp_bytes02<br />	push	eax<br /><br />	mov	eax,offset lp_pointer02<br />	push	eax<br /><br />	mov	eax,offset lp_bytes01<br />	push	eax<br /><br />	mov	eax,offset lp_pointer01<br />	push	eax<br /><br />	mov 	eax, &#91;lp_dsbuff_primary&#93;<br />	push 	eax<br />	mov 	eax, &#91;eax&#93;<br />	call	&#91;eax + DSB_UnLock&#93;	<br /><br />; take action if it fails<br />;===========================<br />    .IF eax != DS_OK<br />    	call Fail, hwndmain, offset szCreatePrimarySoundBufferFail<br />    	jmp end_loop<br />    .ENDIF	<br /><br />ret<br /><br /><br />;==========================<br />; Play Primary Sound Buffer<br />;==========================<br />.data<br />	szPlayPrimaryFail	db	&quot;Play Primary Fail&quot;,0<br />.code<br /><br />Play_Primary_Sound_Buffer&#58;<br /><br />	mov	eax,DSBPLAY_LOOPING 	;dwFlags	<br />	push	eax<br /><br />	mov	eax,0<br />	push	eax<br /><br />	mov	eax,0<br />	push	eax<br /><br />	mov 	eax, &#91;lp_dsbuff_primary&#93;<br />	push 	eax<br />	mov 	eax, &#91;eax&#93;<br />	call	&#91;eax + DSB_Play&#93;	<br /><br />; take action if it fails<br />;===========================<br />    .IF eax != DS_OK<br />    	call Fail, hwndmain, offset szPlayPrimaryFail<br />    	jmp end_loop<br />    .ENDIF	<br /><br />ret<br /><br /><br /><br /><br /><br /><br />;======================<br />; Release Direct Sound Object<br />;======================<br />Release_Direct_Sound_Objects&#58;<br />	cmp	&#91;sound_init_ok&#93;,1<br />	jnz	end_release_direct_sound_objects<br /><br />	mov 	eax, &#91;lp_dsound_object&#93;<br />	push 	eax<br />	mov 	eax, &#91;eax&#93;<br />	call	&#91;eax + DSO_Release&#93;		; IUnknown Release Method<br /><br />end_release_direct_sound_objects&#58;<br />ret<br /><br /><br /><br /><br /></code></pre></div>
    <div class="meta">Posted on 2001-12-26 09:50:56 by BogdanOntanu</div>
   </div>
   <div class="post" id="post-16211">
    <div class="subject"><a href="#post-16211">And Play</a></div>
    <div class="body">Here is how to play secondary sound buffer after init<br /><br />(this are source samples from HE :) )<br />Please note that you can find more detailed examples, including .WAV file load in Chriss Hobbs's SpaceTris Example<br />that was posted here on this forum (a link). If you can not find it, ask and i will post it again...<br /><br /><pre><code><br />;************************************************<br />;		DIRECT SOUND CORE<br />;************************************************<br /><br /><br />;========================================<br />; Create Secondary Sound Buffer 01<br />;========================================<br />.data<br /><br />	ds_buffdesc_secondary01			DSBUFFERDESC4	&lt;0&gt;<br /><br />	szCreateSecondarySoundBufferFail	db		&quot;Create Secondary Sound Buffer01 Failed!&quot;,0<br /><br />	lp_dsbuff_secondary01			dd		0<br /><br />	wfx_secondary01				WAVEFORMATEX	&lt;0&gt;<br /><br />	bytes_per_sample			equ		1<br /><br />.code<br /><br />Create_Secondary_Sound_Buffer01&#58;<br />;===============================<br /><br />; fill the wformatex structure<br />;====================================<br /><br />	mov	&#91;wfx_secondary01.dwSize&#93;,size 	WAVEFORMATEX<br />	mov	&#91;wfx_secondary01.wFormatTag&#93;, WAVE_FORMAT_PCM<br />	mov	&#91;wfx_secondary01.nChannels&#93;, 1<br />	mov	&#91;wfx_secondary01.nSamplesPerSec&#93;, 22050<br />	mov	&#91;wfx_secondary01.nBlockAlign&#93;,1<br />	mov	&#91;wfx_secondary01.nAvgBytesPerSec&#93;,1*22050<br />	mov	&#91;wfx_secondary01.wBitsPerSample&#93;,8<br /><br />	mov	&#91;ds_buffdesc_secondary01.lpwfxFormat&#93;,offset wfx_secondary01<br /><br />; fill the dsound buffer descriptor structure<br />;============================================<br />	mov	eax,size DSBUFFERDESC4<br />	mov	ds_buffdesc_secondary01.dwSize,eax<br /><br />;	mov	eax,DSBCAPS_GETCURRENTPOSITION2 or DSBCAPS_GLOBALFOCUS <br />;	mov	eax,DSBCAPS_STATIC<br />	mov	eax,DSBCAPS_CTRLDEFAULT <br /><br />	mov	ds_buffdesc_secondary01.dwFlags,eax<br /><br />	mov	eax,&#91;length_wave01&#93;<br />	add	eax,16<br />	mov	ds_buffdesc_secondary01.dwBufferBytes,eax	<br /><br />; parameters for CreateBuffer<br />;==========================================<br />	mov	eax,0<br />	push	eax					;pkunker=NULL<br /><br />	mov	eax,offset lp_dsbuff_secondary01	;pointer buffer<br />	push	eax<br /><br />	mov	eax,offset ds_buffdesc_secondary01	;pointer buffer descriptor<br />	push	eax<br /><br />	mov 	eax, &#91;lp_dsound_object&#93;<br />	push 	eax<br />	mov 	eax, &#91;eax&#93;<br />	call	&#91;eax + DSO_CreateSoundBuffer&#93;	<br /><br />; take action if it fails<br />;===========================<br />    .IF eax != DS_OK<br />    	call Fail, hwndmain, offset szCreateSecondarySoundBufferFail<br />    	jmp end_loop<br />    .ENDIF	<br /><br />ret<br /><br /><br /><br /><br /><br /><br /><br />;========================================<br />; Lock Secondary Sound Buffer<br />;========================================<br /><br />.data<br />	lp_pointer01b		dd	0<br />	lp_bytes01b		dd	0<br /><br />	lp_pointer02b		dd	0<br />	lp_bytes02b		dd	0<br />.code<br /><br />Lock_Secondary_Sound_Buffer&#58;<br />;===============================<br /><br />	mov	eax,0		;dwflags<br />	push	eax<br /><br />	mov	eax,offset lp_bytes02b<br />	push	eax<br /><br />	mov	eax,offset lp_pointer02b<br />	push	eax<br /><br />	mov	eax,offset lp_bytes01b<br />	push	eax<br /><br />	mov	eax,offset lp_pointer01b<br />	push	eax<br /><br />;	mov	eax,22050*3			;bytes to lock &#40;3s&#41;<br />	mov	eax,&#91;length_wave01&#93;		;bytes to lock &#40;3s&#41;<br />	push	eax<br /><br />	mov	eax,0				;position in buffer to lock<br />	push	eax<br /><br /><br />	mov 	eax, &#91;lp_dsbuff_secondary01&#93;<br />	push 	eax<br />	mov 	eax, &#91;eax&#93;<br />	call	&#91;eax + DSB_Lock&#93;	<br /><br />; take action if it fails<br />;===========================<br />    .IF eax != DS_OK<br />    	call Fail, hwndmain, offset szCreatePrimarySoundBufferFail<br />    	jmp end_loop<br />    .ENDIF	<br /><br />ret<br /><br /><br />;========================================<br />; UNLock Secondary Sound Buffer<br />;========================================<br />UnLock_Secondary_Sound_Buffer&#58;<br />;===============================<br /><br />	mov	eax,&#91;lp_bytes02b&#93;<br />	push	eax<br /><br />	mov	eax,&#91;lp_pointer02b&#93;<br />	push	eax<br /><br />	mov	eax,&#91;lp_bytes01b&#93;<br />	push	eax<br /><br />	mov	eax,&#91;lp_pointer01b&#93;<br />	push	eax<br /><br />	mov 	eax, &#91;lp_dsbuff_secondary01&#93;<br />	push 	eax<br />	mov 	eax, &#91;eax&#93;<br />	call	&#91;eax + DSB_UnLock&#93;	<br /><br />; take action if it fails<br />;===========================<br />    .IF eax != DS_OK<br />    	call Fail, hwndmain, offset szCreatePrimarySoundBufferFail<br />    	jmp end_loop<br />    .ENDIF	<br /><br />ret<br /><br /><br /><br /><br />;=========================================<br />; Play Secondary Sound Buffer<br />; in&#58; lp_dsbuff_secondary<br />;=========================================<br />.data<br />	szPlaySecondaryFail	db	&quot;Play Secondary Fail&quot;,0<br />	type_play		dd	0			;0 sau DSBPLAY_LOOPING<br />.code<br /><br />Play_Secondary_Sound_Buffer&#58;<br />;===============================<br /><br />	mov	eax,&#91;type_play&#93;		;dwFlags<br />	push	eax<br /><br />	mov	eax,0<br />	push	eax<br /><br />	mov	eax,0<br />	push	eax<br /><br />	mov 	eax, &#91;lp_dsbuff_secondary01&#93;<br />	push 	eax<br />	mov 	eax, &#91;eax&#93;<br />	call	&#91;eax + DSB_Play&#93;	<br /><br />; take action if it fails<br />;===========================<br />    .IF eax != DS_OK<br />    	call Fail, hwndmain, offset szPlaySecondaryFail<br />    	jmp end_loop<br />    .ENDIF	<br /><br />ret<br /><br /><br /><br />;========================================<br /><br /><br />Stop_Secondary_Sound_Buffer&#58;<br />;===============================<br />	mov 	eax, &#91;lp_dsbuff_secondary01&#93;<br />	push 	eax<br />	mov 	eax, &#91;eax&#93;<br />	call	&#91;eax + DSB_Stop&#93;<br /><br />; take action if it fails<br />;===========================<br />    .IF eax != DS_OK<br />    	call Fail, hwndmain, offset szPlaySecondaryFail<br />    	jmp end_loop<br />    .ENDIF	<br /><br />ret<br /><br />Goto_Start_Secondary_Sound_Buffer&#58;<br />;===============================<br />	mov	eax,0				;start position<br />	push	eax<br /><br />	mov 	eax, &#91;lp_dsbuff_secondary01&#93;<br />	push 	eax<br />	mov 	eax, &#91;eax&#93;<br />	call	&#91;eax + DSB_SetCurrentPosition&#93;<br /><br />; take action if it fails<br />;===========================<br />    .IF eax != DS_OK<br />    	call Fail, hwndmain, offset szPlaySecondaryFail<br />    	jmp end_loop<br />    .ENDIF	<br /><br />ret<br /><br /></code></pre></div>
    <div class="meta">Posted on 2001-12-26 09:55:31 by BogdanOntanu</div>
   </div>
   <div class="post" id="post-16244">
    <div class="subject"><a href="#post-16244">Playing a wave via DirectSound</a></div>
    <div class="body">Hallo!<br /><br />Thank you very much for your great help !!!<br />And yes, were can I find more infos?<br /><br />Greetings, Nordwind</div>
    <div class="meta">Posted on 2001-12-26 16:15:21 by Nordwind64</div>
   </div>
  </div>
 </body>
</html>