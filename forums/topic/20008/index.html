<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>PropertySheet as a DLL - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20008" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=20008">PropertySheet as a DLL</a></p>
   <div class="post" id="post-153437">
    <div class="subject"><a href="#post-153437">PropertySheet as a DLL</a></div>
    <div class="body">G'day All,<br /><br />I am trying to call a property-sheet/wizard as a DLL from my &quot;main&quot; application.<br /><br />I've build the property-sheet as a stand-alone EXE no problem, based on KetilO's WizDemo (http://radasm.visualassembler.com/projects/projects.html).<br /><br />I can build the property-sheet as a DLL/Lib OK, And I can load the property-sheet DLL in my &quot;main&quot; application, and call a test method in the property-sheet DLL, so I think I've got the DLL loading OK.<br /><br />The problem is that the actual property-sheet is not being displayed, even<br />though I can verify that the property-sheet function &quot;WizShow&quot; is being called.<br /><br />Does anyone know what I am doing wrong, and how to fix it.<br /><br />The property-sheet project and the main calling application are here:<br />http://phpmvc.net/asm/property-sheet-as-dll.zip ( 34,750 Bytes)<br /><br /><br />Here's a cut-down version of my property-sheet DLL/EXE application.<br /><br /><pre><code><br />; PropTest.Asm<br /><br />.386<br />.model flat, stdcall  ;32 bit memory model<br />option casemap &#58;none  ;case sensitive<br /><br />include PropTest.inc<br /><br />; Select the exe/dll here.<br />; Uncomment for dll version or comment out for exe version<br />DLL equ &lt;anytext&gt;<br /><br />.code<br /><br />IFDEF DLL<br />PropTestDllEntry proc hInst&#58;HINSTANCE, reason&#58;DWORD, reserved1&#58;DWORD<br />	.if reason==DLL_PROCESS_ATTACH<br />      invoke GetModuleHandle,NULL ; use the calling application's instance handle<br />      mov hInstance, eax<br />      ; ...<br />	.elseif reason==DLL_PROCESS_DETACH<br />		; ...<br />	.endif<br />    mov     eax, TRUE<br />    ret<br />PropTestDllEntry Endp<br />ELSE<br />start&#58;<br />	invoke GetModuleHandle,NULL<br />	mov		hInstance,eax<br />	invoke InitCommonControls<br />	invoke WizShow<br />	invoke ExitProcess,0<br />ENDIF<br /><br /><br />MessageBoxSTD proc STDCALL hParent&#58;DWORD,lpMsg&#58;DWORD,<br />              lpTitle&#58;DWORD,dlgStyle&#58;DWORD,iconID&#58;DWORD<br />	--- cut ---<br />    ret<br />MessageBoxSTD endp<br /><br /><br />WizShow proc<br />	LOCAL	PropSheet&#91;3&#93;&#58;PROPSHEETPAGE<br />	LOCAL	PropHdr&#58;PROPSHEETHEADER<br /><br />	; --------------------------------------------------------------- ;<br />	invoke MessageBoxSTD, 0, addr szMessageBoxTxt, addr szMessageBoxTxt, MB_OK, 1<br />	; --------------------------------------------------------------- ;<br /><br />	;Set up the 1st property sheet<br />	--- cut ---<br />	; As per KetilO's WizDemo<br />	--- cut ---<br />	; Display the property sheet control<br />	invoke PropertySheet,addr PropHdr<br />	ret<br /><br />WizShow endp<br /><br />WizDialog1 proc hWin&#58;HWND,uMsg&#58;DWORD,wParam&#58;WPARAM,lParam&#58;LPARAM<br />	;This dialog processes property page 1<br />	--- cut ---<br />	; As per KetilO's WizDemo<br />WizDialog1 endp<br /><br />WizDialog2 proc hWin&#58;HWND,uMsg&#58;DWORD,wParam&#58;WPARAM,lParam&#58;LPARAM<br />	; This dialog processes property page 2<br />	--- cut ---<br />	; As per KetilO's WizDemo<br />WizDialog2	endp<br /><br />WizDialog3	proc hWin&#58;DWORD,uMsg&#58;DWORD,wParam&#58;WPARAM,lParam&#58;LPARAM<br />	; This dialog processes property page 3<br />	--- cut ---<br />	; As per KetilO's WizDemo<br />WizDialog3	endp<br /><br /><br />;end start<br />IFDEF DLL<br />	include EndDLL.Asm<br />ELSE<br />	include EndStart.Asm<br />ENDIF<br /></code></pre><br /><br /><br />Thanks<br />Dorf<br /><br />And thanks to the Win32ASM Community Forum admins for reserecting the board. It was quite a shock to see the site all gorn !!!</div>
    <div class="meta">Posted on 2004-11-28 23:43:50 by dorf</div>
   </div>
   <div class="post" id="post-153765">
    <div class="subject"><a href="#post-153765">PropertySheet as a DLL</a></div>
    <div class="body">G'day All,<br /><br />This is how I have implemented using a property-sheet/wizard as a DLL<br />module.<br /><br />Perhaps this may be of use to someone, perhaps not :)<br /><br />The property-sheet project and the main calling application can be downloaded <br />here:<br />http://phpmvc.net/asm/property-sheet-as-dll.zip ( 48,814 Bytes)<br /><br /><br />The property-sheet module (DLL/lib) resources must be compiled and linked <br />into the main application. The property-sheet module resources are included <br />using the MainAppFrame.RcDLL file:<br />  #include &quot;..\PropTest\Res\Wiz1Dlg.rc&quot;<br />  #include &quot;..\PropTest\Res\Wiz2Dlg.rc&quot;<br />  #include &quot;..\PropTest\Res\Wiz3Dlg.rc&quot;<br />  #include &quot;..\PropTest\Res\PropTestRes.rc&quot;<br /><br /><br />My example uses two projects: the property-sheet module and the main<br />application that uses the property-sheet module.<br /><br />The property-sheet module:<br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br />This project creates a property sheet (wizard) application.<br />The project can be built to run stand-alone (as an EXE),<br />or built as a module (DLL/lib) to be used by another application.<br /><br />Build as an EXE:<br /> 1) Comment out the &quot;DLL equ &lt;anytext&gt;&quot; definition below<br /> 2) Assemble and build as a regular RadASM project<br /><br />Build as an DLL/lib module:<br /> 1) Un-comment the &quot;DLL equ &lt;anytext&gt;&quot; definition below<br /> 2) Assemble and build using the make-dll.bat file included<br /><br /><br />The main application<br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br />This project creates a main window frame that can load a property-<br />sheet module as a DLL.<br /><br />Build without the property-sheet module:<br /> 1) Comment out the &quot;DLL equ &lt;anytext&gt;&quot; definition below<br /> 2) Assemble and build as a regular RadASM project<br /><br />Build with the property-sheet module (DLL/lib):<br /> 1) Un-comment the &quot;DLL equ &lt;anytext&gt;&quot; definition below<br /> 2) Assemble and build using the make-wiz.bat file included<br /><br /><br />Regards<br />Dorf</div>
    <div class="meta">Posted on 2004-12-05 22:34:12 by dorf</div>
   </div>
  </div>
 </body>
</html>