<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>How can I initialize a structure in static data segment? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=8419" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=8419">How can I initialize a structure in static data segment?</a></p>
   <div class="post" id="post-61509">
    <div class="subject"><a href="#post-61509">How can I initialize a structure in static data segment?</a></div>
    <div class="body">Who can tell me how can I initialize a structure in static data segment like this in C?<br />struct<br />{<br />char *szLabel;<br />char *szDesc;<br />}<br />sysmetrics[]=<br />{<br />&quot;SM_CXSCREEN&quot;,&quot;Screen width in pixels&quot;,<br />&quot;SM_CYSCREEN&quot;,&quot;Screen Height in pixels&quot;<br />......<br />}</div>
    <div class="meta">Posted on 2002-10-13 05:13:34 by smartcurl</div>
   </div>
   <div class="post" id="post-61558">
    <div class="subject"><a href="#post-61558">How can I initialize a structure in static data segment?</a></div>
    <div class="body"><pre><code>Testing STRUCT<br />    hFile       DD ?<br />    szFileName  DB 20 DUP&#40;?&#41;<br />    DB          0            ;String terminate with 0<br />Testing ENDS<br /><br />.DATA<br /><br />    myfile  Testing &lt;1, &quot;Hello Cruel World&quot;&gt;, &lt;2, &quot;Hello World&quot;&gt;, &lt;3, &quot;I'm A MArtian&quot;&gt;<br />    tests   DB &quot;tests&quot;, 0<br /><br />.CODE<br /><br />start&#58;<br />    <br />    invoke  MessageBox, HWND_DESKTOP, OFFSET myfile.szFileName, NULL, MB_OK<br />    invoke  MessageBox, HWND_DESKTOP, OFFSET myfile&#91;SIZEOF Testing&#93;.szFileName, NULL, MB_OK<br />    invoke  MessageBox, HWND_DESKTOP, OFFSET myfile&#91;SIZEOF Testing*2&#93;.szFileName, NULL, MB_OK<br />    invoke  MessageBox, HWND_DESKTOP, OFFSET tests, NULL, MB_OK<br /><br />    invoke  ExitProcess, 0<br /><br />end start</code></pre></div>
    <div class="meta">Posted on 2002-10-13 16:55:53 by stryker</div>
   </div>
   <div class="post" id="post-61578">
    <div class="subject"><a href="#post-61578">How can I initialize a structure in static data segment?</a></div>
    <div class="body">Much better solution.<pre><code>.686<br />.MODEL FLAT, STDCALL<br />OPTION CASEMAP&#58;NONE<br /><br />INCLUDE \dev\masm32\include\windows.inc<br />INCLUDE \dev\masm32\include\kernel32.inc<br />INCLUDELIB \dev\masm32\lib\kernel32.lib<br />INCLUDE \dev\masm32\include\user32.inc<br />INCLUDELIB \dev\masm32\lib\user32.lib<br />INCLUDE \dev\masm32\include\shell32.inc<br />INCLUDELIB \dev\masm32\lib\shell32.lib<br /><br />LBL STRUCT<br />    szLabel     DD ?<br />    szDesc      DD ?<br />LBL ENDS<br /><br />.DATA<br /><br />    f1      DB &quot;Number One&quot;, 0<br />    f2      DB &quot;Number Two&quot;, 0<br />    f3      DB &quot;Number Three&quot;, 0<br />    <br />    lvl     LBL &lt;1, OFFSET f1&gt;, &lt;1, OFFSET f2&gt;, &lt;3, OFFSET f3&gt;<br /><br />.CODE<br /><br />start&#58;<br />    <br />    invoke  MessageBox, HWND_DESKTOP, lvl.szDesc, NULL, MB_OK<br />    invoke  MessageBox, HWND_DESKTOP, lvl&#91;SIZEOF LBL&#93;.szDesc, NULL, MB_OK<br />    invoke  MessageBox, HWND_DESKTOP, lvl&#91;SIZEOF LBL*2&#93;.szDesc, NULL, MB_OK<br /><br />    invoke  ExitProcess, 0<br /><br />end start</code></pre></div>
    <div class="meta">Posted on 2002-10-13 20:07:13 by stryker</div>
   </div>
   <div class="post" id="post-61580">
    <div class="subject"><a href="#post-61580">How can I initialize a structure in static data segment?</a></div>
    <div class="body">Cool! stryker<br />It's so helpful to me.thank you.but if &quot;.686&quot; means that code must cann't run on Pentium cpu?Maybe this question is too naive.:confused:</div>
    <div class="meta">Posted on 2002-10-13 20:22:19 by smartcurl</div>
   </div>
   <div class="post" id="post-61581">
    <div class="subject"><a href="#post-61581">How can I initialize a structure in static data segment?</a></div>
    <div class="body">the program still works, it's just that when I code I usually use all available instructions on my p3 when needed. Using .386 -&gt; .586 doesn't allow the use of the CMOVcc instructions... the code above doesn't use any of these instructions, it only uses <strong>push</strong> and <strong>call</strong> - generated by invoke.<br /><br />You can change that to .386, .486, 586 ... if you want to. :)</div>
    <div class="meta">Posted on 2002-10-13 20:47:39 by stryker</div>
   </div>
   <div class="post" id="post-61582">
    <div class="subject"><a href="#post-61582">How can I initialize a structure in static data segment?</a></div>
    <div class="body">I got it!<br />Thanks again.:)</div>
    <div class="meta">Posted on 2002-10-13 20:53:33 by smartcurl</div>
   </div>
   <div class="post" id="post-61616">
    <div class="subject"><a href="#post-61616">How can I initialize a structure in static data segment?</a></div>
    <div class="body">Much better solution.<br /><br />Macro stolen from gfalen. :)<pre><code>.686<br />.MODEL FLAT, STDCALL<br />OPTION CASEMAP&#58;NONE<br /><br />INCLUDE \dev\masm32\include\windows.inc<br />INCLUDE \dev\masm32\include\kernel32.inc<br />INCLUDELIB \dev\masm32\lib\kernel32.lib<br />INCLUDE \dev\masm32\include\user32.inc<br />INCLUDELIB \dev\masm32\lib\user32.lib<br />INCLUDE \dev\masm32\include\shell32.inc<br />INCLUDELIB \dev\masm32\lib\shell32.lib<br /><br />LBL STRUCT<br />    szLabel     DD ?<br />    szDesc      DD ?<br />LBL ENDS<br /><br />t MACRO _str&#58;VARARG<br />    LOCAL @@1<br />    IF @InStr&#40;1, &lt;_str&gt;, &lt;!&quot;&gt; &#41;<br />        .DATA<br />            @@1 DB _str, 0<br />        .DATA<br />        EXITM &lt;OFFSET @@1&gt;<br />    ELSE<br />        EXITM &lt;_str&gt;<br />    ENDIF<br />ENDM<br /><br />.DATA<br /><br />    lvl     LBL &lt;1, t&#40;&quot;Number One&quot;&#41;&gt;, &lt;1, t&#40;&quot;Number Two&quot;&#41;&gt;, &lt;3, t&#40;&quot;Number Three&quot;&#41;&gt;<br /><br />.CODE<br /><br />start&#58;<br /><br />    invoke  MessageBox, HWND_DESKTOP, lvl.szDesc, NULL, MB_OK<br />    invoke  MessageBox, HWND_DESKTOP, lvl&#91;SIZEOF LBL&#93;.szDesc, NULL, MB_OK<br />    invoke  MessageBox, HWND_DESKTOP, lvl&#91;SIZEOF LBL*2&#93;.szDesc, NULL, MB_OK<br /><br />    invoke  ExitProcess, 0<br /><br />end start</code></pre></div>
    <div class="meta">Posted on 2002-10-14 00:51:27 by stryker</div>
   </div>
  </div>
 </body>
</html>