<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Case Study: Projection Transformation - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30911" />
    <link rel="next" href="../?id=30911&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=30911">Case Study: Projection Transformation</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=30911&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=30911&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="30911" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=30911&amp;page=2">&gt;</a><a href="../?id=30911&amp;page=3">&raquo;</a></form>   <div class="post" id="post-216127">
    <div class="subject"><a href="#post-216127">Case Study: Projection Transformation</a></div>
    <div class="body">There&#039;s an eastern european guy who works for Rockstar Games who is claiming that he&#039;s written a game engine which requires no Matrices, even in the Shaders. In fact, he&#039;s been published now, in GPU Pro 3.<br />This got me interested, because I&#039;ve never seen actual evidence that a Projection transform can be imparted to the shader without using a matrix.<br /><br />I tried to get my hands on more information, but after 12 hours of scouring the internet, I failed to do it (although I was able to get my hands on the sourcecode for the exercises in the book, via its editors personal blog, and sure enough, there&#039;s no source for that chapter).<br />So began my analysis of the Projection Transform, and here is posted some notes that I made, which explain what the Matrix is doing, and why. Knowing this, we can see clearly that we DON&#039;T need a Matrix to do it.<br /><br /></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=3353" target="_blank">ProjectionDemystified.jpg</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2012-08-04 00:46:31 by Homer</div>
   </div>
   <div class="post" id="post-216128">
    <div class="subject"><a href="#post-216128">Re: Case Study: Projection Transformation</a></div>
    <div class="body">Matrices are just a convenient way to handle a lot of multiplications and additions.<br />My 286 code doesn&#039;t use matrices either, because the maths are simplified and many parts of the matrix would remain 0 if I used a matrix.<br />So instead I just perform the required multiplications and additions directly, and then do a perspective divide, et voila.<br />No matrices... but hardly a spectacular conclusion.</div>
    <div class="meta">Posted on 2012-08-04 04:09:04 by Scali</div>
   </div>
   <div class="post" id="post-216132">
    <div class="subject"><a href="#post-216132">Re: Case Study: Projection Transformation</a></div>
    <div class="body">I think matrices are only convenient WHEN they are imparting lots of linear operations - if we are just doing something simple, they are wasteful, in every sense. I am not a fan of blindly using any tool, this is a great example of cracking a walnut with a sledgehammer in most cases.</div>
    <div class="meta">Posted on 2012-08-07 05:31:22 by Homer</div>
   </div>
   <div class="post" id="post-216133">
    <div class="subject"><a href="#post-216133">Re: Case Study: Projection Transformation</a></div>
    <div class="body">Further, homogenous 4D stuff is not that hard to grasp, compared to matrices, its easy!<br />We should be teaching this from the start, not making it an adjunct, and making it seem hard when its trivial.</div>
    <div class="meta">Posted on 2012-08-07 05:33:53 by Homer</div>
   </div>
   <div class="post" id="post-216134">
    <div class="subject"><a href="#post-216134">Re: Case Study: Projection Transformation</a></div>
    <div class="body"><div class="quote"><br />Further, homogenous 4D stuff is not that hard to grasp, compared to matrices, its easy!<br />We should be teaching this from the start, not making it an adjunct, and making it seem hard when its trivial.<br /></div><br /><br />That&#039;s how I learnt it anyway. Matrices came later.</div>
    <div class="meta">Posted on 2012-08-07 07:33:49 by Scali</div>
   </div>
   <div class="post" id="post-216135">
    <div class="subject"><a href="#post-216135">Re: Case Study: Projection Transformation</a></div>
    <div class="body">Lucky you!&nbsp; Thats how it should be taught.<br />I learned 3D cartesian stuff, then matrices, then 4D vectors, and finally, tensors. Back and forth.<br />It makes sense to teach what it used most, first, and what it used least, last, but it made things a lot more confusing than they needed to be, I was left without a natural understanding of the forms which I had to figure out retrospectively, and without the benefit of understanding greek notation.</div>
    <div class="meta">Posted on 2012-08-07 08:28:55 by Homer</div>
   </div>
   <div class="post" id="post-216136">
    <div class="subject"><a href="#post-216136">Re: Case Study: Projection Transformation</a></div>
    <div class="body">I bet Hamilton is rolling in his grave! :P</div>
    <div class="meta">Posted on 2012-08-07 08:31:27 by Homer</div>
   </div>
   <div class="post" id="post-216137">
    <div class="subject"><a href="#post-216137">Re: Case Study: Projection Transformation</a></div>
    <div class="body">I think it depends on your definition of &#039;teaching&#039;.<br />You can&#039;t really &#039;teach&#039; matrices, they are just a notation for linear equations.<br />So regardless whether you teach how a perspective projection/homogenous coordinate system works via direct equations, or via matrix form... <br />If you understand matrices, you can write out the equations yourself, given a projection matrix. Or conversely, if you have some projection equations, you can construct a matrix.<br /><br />If you cannot perform those operations, I would say you have not been taught properly, because you cannot perform these basic rewriting steps.</div>
    <div class="meta">Posted on 2012-08-07 09:54:53 by Scali</div>
   </div>
   <div class="post" id="post-216138">
    <div class="subject"><a href="#post-216138">Re: Case Study: Projection Transformation</a></div>
    <div class="body">I&#039;ve finally found a real honest to goodness example of a matrix-free shader.<br />It&#039;s not a particularly useful shader in the form presented, however, the rest of the document is quite thorough and worth reading.<br />This information should be more than enough for anyone who wishes to eliminate projection matrices (and all the others) from their video pipeline.<br /><br />http://www.arcsynthesis.org/gltut/Positioning/Tut04%20Perspective%20Projection.html<br /><br />@Scali, I agree with you that it&#039;s just a container representing a bunch of linear operations, however there&#039;s a lot to learn besides that, things we take for granted if we &#039;know&#039; them, like, reciprocal inversion (relationship between matrices and their inverses with respect to order of multiplication), and lots of nifty tricks, like transposition of 3x3 matrices as a quick inverse, stuff we only learn by having it taught to us (even if that means we sought the information and &#039;taught ourselves&#039;).<br />A lot of that stuff simply isn&#039;t obvious, and especially to the novice (some people just seems to &#039;get it&#039;, I wasn&#039;t so lucky). It&#039;s also worth noting that matrices can be used for purposes other than relating linear operation sequences, they can represent numerical distributions, useful for predicting things like market trends, and also useful in physics, for representing things like mass distribution over orthogonal axes, solving general systems of simultaneous equations, and higher dimensional math that makes my brain hurt without a matrix to help me.</div>
    <div class="meta">Posted on 2012-08-08 03:08:28 by Homer</div>
   </div>
   <div class="post" id="post-216139">
    <div class="subject"><a href="#post-216139">Re: Case Study: Projection Transformation</a></div>
    <div class="body">Well, while it is a good thing to understand how things like projection, rotation, scaling, translation etc work without matrices, I&#039;m not sure why exactly one would want to get rid of them.<br />The hardware is designed for matrix/vector operations, and an entire 4x4 matrix*vector operation only takes 4 instructions. 4 instructions is not a lot of &#039;wiggle room&#039; if you get what I mean.<br /><br />The reason why 4x4 matrices are so popular is that a single matrix can encode any possible combination of transformations possible. So in the general case, only one matrix is required to take your vertices directly from object space to screen-space (the actual perspective-divide is &#039;free&#039; as it is still performed in a fixed-function unit when the output of the vertex shaders is fed to the rasterizer).<br />So, all you have to do is concatenate all your matrices once, on the CPU side, then send it to your vertex shader, et voila. A single matrix*vector operation does the trick, in only 4 instructions. The tutorial you linked to, will not generate code that is as efficient as this. And that is just a very basic example.</div>
    <div class="meta">Posted on 2012-08-08 04:43:53 by Scali</div>
   </div>
   <div class="post" id="post-216140">
    <div class="subject"><a href="#post-216140">Re: Case Study: Projection Transformation</a></div>
    <div class="body">Reason is because, as you said, hardware is designed for vec4 operations (matrix4 is an extension of that).<br />We can fit all the data for all the major transforms into less space than one matrix4 requires, and do a few linear operations, less operations than matrices require, using the same optimized hardware pathways.<br />More FPS, &#039;for free&#039;.<br /></div>
    <div class="meta">Posted on 2012-08-08 05:15:31 by Homer</div>
   </div>
   <div class="post" id="post-216141">
    <div class="subject"><a href="#post-216141">Re: Case Study: Projection Transformation</a></div>
    <div class="body">As I say, there&#039;s only a very select subset of problems where this is the case.<br />On my 286 it&#039;s different, I don&#039;t have any vec4 hardware at all, so any operation that I can optimize because the matrix will always contain 0, 1 or -1 for a particular cell, saves calculations.<br />But on a machine with SSE, or on a GPU, as I say, it only takes 4 instructions to perform a matrix*vector operation. So you can only do 4 operations max. Which is not a whole lot.<br />And the great disadvantage of that would be that it would only work for the select subset of problems. You&#039;d have to rewrite your code if you happen to want to use a slightly different transform (which may negate any savings you had in the first place). Matrices can encode any possible transform in homogenous 4d space, so the same code will work, no matter what kind of animation, camera, projection etc you want to apply.<br /><br />In other words: not a good place to try and save a few cycles. The phrase &quot;More trouble than it&#039;s worth&quot; comes to mind.<br />I think the easiest way to try and save some cycles/space is to use 3x4 matrices if you can. Most transforms will only use the 3x3 portion for rotation and scaling, and one row (or column, depending on your orientation) for a translation. Which means that you always have one column (or row) that is (0,0,0,1).<br />But again, you&#039;re limiting yourself in terms of transforms. The projection matrix is one of the exceptions where you would be using more than just the 3x4 portion of the matrix.</div>
    <div class="meta">Posted on 2012-08-08 05:30:55 by Scali</div>
   </div>
   <div class="post" id="post-216142">
    <div class="subject"><a href="#post-216142">Re: Case Study: Projection Transformation</a></div>
    <div class="body">As noted, turns out that the traditional projection transform can be simplified, without altering the mapping, that is a game changer. That&#039;s what I got interested, and with a single dual quaternion for mapping the other two major matrices, it becomes clear that we can indeed win, for a given projection, world and view.</div>
    <div class="meta">Posted on 2012-08-08 05:46:12 by Homer</div>
   </div>
   <div class="post" id="post-216143">
    <div class="subject"><a href="#post-216143">Re: Case Study: Projection Transformation</a></div>
    <div class="body">As long as we already baked scale out of the picture, we can win easily.<br />If we need to scale model space, its messier.</div>
    <div class="meta">Posted on 2012-08-08 05:47:22 by Homer</div>
   </div>
   <div class="post" id="post-216144">
    <div class="subject"><a href="#post-216144">Re: Case Study: Projection Transformation</a></div>
    <div class="body"><div class="quote"><br />As noted, turns out that the traditional projection transform can be simplified, without altering the mapping, that is a game changer.</div><br /><br />How exactly?<br />You have 4 instructions to work with.<br />You&#039;d need 3 instructions to perform rotation, scaling and translation. Which I&#039;d say would be the minimal for any regular transform from object space to screen space.<br />That gives you exactly one extra instruction to set up the projection.<br />So how is it better at all? Let alone a &#039;game changer&#039;?<br /><br /><div class="quote">That&#039;s what I got interested, and with a single dual quaternion for mapping the other two major matrices, it becomes clear that we can indeed win, for a given projection, world and view.<br /></div><br /><br />Okay, work out the math and post it here, then we&#039;ll see how many instructions it takes. I&#039;d be surprised if you can come up with a solution with less than 4 instructions.</div>
    <div class="meta">Posted on 2012-08-08 05:53:39 by Scali</div>
   </div>
   <div class="post" id="post-216145">
    <div class="subject"><a href="#post-216145">Re: Case Study: Projection Transformation</a></div>
    <div class="body">Seriously, u CANT just pass in a PVM matrix , u NEED to pass TWO at least, you know this, right?<br />I won&#039;t argue you know this means, at least, a 4x4 matrix mul in the shader, and thats NOT 4 operations. And we didn&#039;t even process a vertex yet.</div>
    <div class="meta">Posted on 2012-08-08 05:57:13 by Homer</div>
   </div>
   <div class="post" id="post-216146">
    <div class="subject"><a href="#post-216146">Re: Case Study: Projection Transformation</a></div>
    <div class="body">I mean, unless we are drawing one object, only, we need to calculate PVM somewhere, true?</div>
    <div class="meta">Posted on 2012-08-08 05:58:19 by Homer</div>
   </div>
   <div class="post" id="post-216147">
    <div class="subject"><a href="#post-216147">Re: Case Study: Projection Transformation</a></div>
    <div class="body"><div class="quote"><br />Seriously, u CANT just pass in a PVM matrix , u NEED to pass TWO at least, you know this, right?</div><br /><br />Uhhh, what? Why would you need two?</div>
    <div class="meta">Posted on 2012-08-08 06:02:32 by Scali</div>
   </div>
   <div class="post" id="post-216148">
    <div class="subject"><a href="#post-216148">Re: Case Study: Projection Transformation</a></div>
    <div class="body"><div class="quote"><br />I mean, unless we are drawing one object, only, we need to calculate PVM somewhere, true?<br /></div><br /><br />Not in the vertex shader (where you&#039;d be doing it per-vertex, rather than per-object).<br />So why would you need more than one matrix in the vertex shader?</div>
    <div class="meta">Posted on 2012-08-08 06:03:25 by Scali</div>
   </div>
   <div class="post" id="post-216149">
    <div class="subject"><a href="#post-216149">Re: Case Study: Projection Transformation</a></div>
    <div class="body">You cannot show more than one object with &#039;four instructions&#039;. So it wont work for anything other than a very simple demo drawing one model space. Don&#039;t try to talk s***. You need a unique modelspace transform for every instance of a geometry. You know that you can&#039;t just send one WorldViewProj for everything. Let alone we talk about things like lighting and shadowing, which you obviously think are all best done in viewspace. Seriously man, you can&#039;t just send one matrix and call it a day. Jeez.<br />And thats using ONE shader! If we have more than one shader, there&#039;s no guarantee that uniforms will be stateful, we need to re-transmit them when shaders switch!</div>
    <div class="meta">Posted on 2012-08-08 07:44:36 by Homer</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=30911&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=30911&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="30911" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=30911&amp;page=2">&gt;</a><a href="../?id=30911&amp;page=3">&raquo;</a></form>  </div>
 </body>
</html>