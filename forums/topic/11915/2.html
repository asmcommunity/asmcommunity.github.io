<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>why this bmp as a background is not working ?? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=11915" />
  <link rel="prev" href="../?id=11915&amp;page=1" />  <link rel="next" href="../?id=11915&amp;page=3" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=11915">why this bmp as a background is not working ??</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=11915&amp;page=1" style="">&laquo;</a><a href="../?id=11915&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="11915" /><input type="number" name="page" min="1" max="3" step="1" value="2" onchange="this.form.submit();" /><a href="../?id=11915&amp;page=3">&gt;</a><a href="../?id=11915&amp;page=3">&raquo;</a></form>   <div class="post" id="post-92233">
    <div class="subject"><a href="#post-92233">why this bmp as a background is not working ??</a></div>
    <div class="body">If you wanna do that sort of thing, quit loading the bmp as a pattern brush, and have a go at writing a WM_PAINT handler. Normally you'd probably use BitBlt or similar to paint the bitmap at a given location. Be aware that your program is already being sent WM_PAINT messages whenever it decides to repaint itself, and atm those are being simply handed on to the default os handler.</div>
    <div class="meta">Posted on 2003-03-31 20:49:43 by Homer</div>
   </div>
   <div class="post" id="post-92251">
    <div class="subject"><a href="#post-92251">why this bmp as a background is not working ??</a></div>
    <div class="body"><div class="quote"><em>Originally posted by donkey</em> <br />1. You can remove the border styles of the edit control and it will only show a white rectangle. </div> <br />It is not an EDIT CONTROL, it is a TEXT CONTROL:<br />CTEXT   &quot;Hello World DialogBox&quot;,-1,14,10,102,12<br /><br />:-Xyzero</div>
    <div class="meta">Posted on 2003-03-31 21:35:16 by xyzero</div>
   </div>
   <div class="post" id="post-92252">
    <div class="subject"><a href="#post-92252">why this bmp as a background is not working ??</a></div>
    <div class="body">Oh it's a STATIC control. Well you can control the color of a static control with the WM_CTLCOLORSTATIC message. It's the same routine as I gave you last time but it includes the static coloring message. It assumes that you have created a variable named <strong>hBrush</strong><pre><code>DialogProc proc uses ebx esi edi hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br />	LOCAL hdc			&#58;DWORD<br />	LOCAL hMemDC			&#58;DWORD<br />	LOCAL rect			&#58;RECT<br />	LOCAL ps			&#58;PAINTSTRUCT<br /><br />	.IF uMsg == WM_INITDIALOG<br />		mov eax,hWnd<br />		mov hDlg,eax<br />		invoke LoadBitmap,hInstance,BitMapResID<br />		mov hBitMap,eax<br />		&#91;COLOR=red&#93;invoke CreateSolidBrush,00FEFEFEh<br />		mov hBrush,eax&#91;/COLOR&#93;<br /><br />	.ELSEIF uMsg == WM_CLOSE<br />		invoke DeleteObject,hBitMap <br />		invoke EndDialog,hWnd,-1<br /><br />	.ELSEIF uMsg==WM_PAINT<br />		mov eax,hWnd<br />		.IF eax == hDlg<br />			invoke BeginPaint,hDlg,addr ps<br />			mov    hdc,eax<br />			invoke CreateCompatibleDC,hdc<br />			mov    hMemDC,eax<br />			invoke SelectObject,hMemDC,hBitMap<br />			invoke GetClientRect,hDlg,addr rect<br />			invoke BitBlt,hdc,0,0,rect.right,rect.bottom,hMemDC,0,0,SRCCOPY<br />			invoke DeleteDC,hMemDC<br />			invoke EndPaint,hDlg,addr ps<br />		.ENDIF<br /><br />	&#91;COLOR=red&#93;.ELSEIF uMsg == WM_CTLCOLORSTATIC<br />		mov eax,hBrush<br />		ret&#91;/COLOR&#93;<br /><br />	.ELSE<br />		mov eax,FALSE<br />		ret<br /><br />	.ENDIF<br /><br />	mov eax, TRUE<br />	ret<br />DialogProc endp</code></pre></div>
    <div class="meta">Posted on 2003-03-31 21:42:54 by donkey</div>
   </div>
   <div class="post" id="post-92255">
    <div class="subject"><a href="#post-92255">why this bmp as a background is not working ??</a></div>
    <div class="body">Hi donkey,<br /><br /><br />Didn't work... (or didn't I work!?!). I placed the value 00DFBAA2h<br />(to see better) and the results is shown in the figure.  <br />I would like to eliminate the blue area and the white area  <br />about of the text &quot; Hello World DialogBox &quot; so that appeared  <br />the background. <br /> <br />But thank you very much... I am learning a lot :-)</div>
    <div class="meta">Posted on 2003-03-31 22:34:35 by xyzero</div>
   </div>
   <div class="post" id="post-92256">
    <div class="subject"><a href="#post-92256">why this bmp as a background is not working ??</a></div>
    <div class="body">Mmmmm I seem to be writing most of the program for you. :) You can try to insert the text when you process the WM_PAINT Message. Set the rectangle for where you want to set the text and paint the text directly to the image. Haven't tried this out beforehand though so I'm not sure how it will look <pre><code>.ELSEIF uMsg==WM_PAINT<br />	mov eax,hWnd<br />	.IF eax == hDlg<br />		invoke BeginPaint,hDlg,addr ps<br />		mov    hdc,eax<br />		invoke CreateCompatibleDC,hdc<br />		mov    hMemDC,eax<br />		invoke SelectObject,hMemDC,hBitMap<br />		invoke GetClientRect,hDlg,addr rect<br />		invoke BitBlt,hdc,0,0,rect.right,rect.bottom,hMemDC,0,0,SRCCOPY<br />		invoke DeleteDC,hMemDC<br />		&#91;COLOR=red&#93;invoke DrawText, hdc, offset Text, -1, ADDR rect, DT_SINGLELINE&#91;/COLOR&#93;<br />		invoke EndPaint,hDlg,addr ps<br />	.ENDIF</code></pre><br /><br /><strong>Actually this won't work either, thinking about it it will just give you the white bkgnd again. I'll see what I can come up with</strong></div>
    <div class="meta">Posted on 2003-03-31 22:45:23 by donkey</div>
   </div>
   <div class="post" id="post-92258">
    <div class="subject"><a href="#post-92258">why this bmp as a background is not working ??</a></div>
    <div class="body">Hi xyzero,<br /><br />Nope, got me. I can see a way to do it but it's way too complicated. It involves making a mask for the text and painting it that way but that would be quite a bit of work. There is pobably a much easier way to do it but I don't know it. I'd be interested to know how though. Maybe blit it onto the MemDC with the SRCAND Flag set.</div>
    <div class="meta">Posted on 2003-03-31 23:14:28 by donkey</div>
   </div>
   <div class="post" id="post-92263">
    <div class="subject"><a href="#post-92263">why this bmp as a background is not working ??</a></div>
    <div class="body">Hi donkey,<br /><br />:alright: :-) I'm really learning a lot... thkx<br /><br /><br />xyzero</div>
    <div class="meta">Posted on 2003-03-31 23:29:18 by xyzero</div>
   </div>
   <div class="post" id="post-92266">
    <div class="subject"><a href="#post-92266">why this bmp as a background is not working ??</a></div>
    <div class="body">Try this, it creates a new device context and bitmap, paints the text into a rectangle that's size is calculated by the GetTextExtentPoint32 function then merges the two bitmaps. Change the red numbers to the x/y where you want to place the text. Might work...<pre><code>LOCAL hTbm				&#58;DWORD ; extra local to add<br /><br />.ELSEIF uMsg==WM_PAINT<br />	mov eax,hWnd<br />	.IF eax == hDlg<br />		invoke BeginPaint,hDlg,addr ps<br />		mov    hdc,eax<br />		invoke CreateCompatibleDC,hdc<br />		mov    hMemDC,eax<br />		invoke SelectObject,hMemDC,hBitMap<br />		invoke GetClientRect,hDlg,addr rect<br />		invoke BitBlt,hdc,0,0,rect.right,rect.bottom,hMemDC,0,0,SRCCOPY<br />		invoke DeleteDC,hMemDC<br /><br />		invoke CreateCompatibleDC,hdc<br />		mov    hMemDC,eax<br />		invoke SetTextColor,hMemDC,000000FFh<br />		invoke lstrlen,ADDR Text<br />		mov edx,eax<br />		invoke GetTextExtentPoint32,hMemDC,ADDR Text,edx,ADDR rect.right<br />		invoke CreateCompatibleBitmap,hdc,rect.right,rect.bottom<br />		mov hTbm,eax<br />		invoke SelectObject,hMemDC,hTbm<br />		mov rect.left,0<br />		mov rect.top,0<br />		invoke DrawText, hMemDC, offset Text, -1, ADDR rect, DT_SINGLELINE<br />		invoke BitBlt, hdc, &#91;COLOR=red&#93;100, 100,&#91;/COLOR&#93; rect.right, rect.bottom, hMemDC, \<br />				0, 0, MERGEPAINT<br />		invoke DeleteDC,hMemDC<br />		invoke DeleteObject,hTbm<br />		invoke EndPaint,hDlg,addr ps<br />	.ENDIF</code></pre></div>
    <div class="meta">Posted on 2003-03-31 23:43:02 by donkey</div>
   </div>
   <div class="post" id="post-92268">
    <div class="subject"><a href="#post-92268">why this bmp as a background is not working ??</a></div>
    <div class="body">:grin: :grin: :grin: <br /><br />PERFECT!!!!!!!!!!!!!!!<br /><br /><br /><br /><br />xyzer;)</div>
    <div class="meta">Posted on 2003-03-31 23:59:15 by xyzero</div>
   </div>
   <div class="post" id="post-92269">
    <div class="subject"><a href="#post-92269">why this bmp as a background is not working ??</a></div>
    <div class="body">Cool, lots of code for Hello World :grin: Probably an easier way</div>
    <div class="meta">Posted on 2003-04-01 00:01:34 by donkey</div>
   </div>
   <div class="post" id="post-119746">
    <div class="subject"><a href="#post-119746">why this bmp as a background is not working ??</a></div>
    <div class="body">Hi Donkey<br /><br />It's really great, but how to do the function work with an multiline text ?<br /><br />I mean....If we have something like..<br /><br /><div class="quote"><br />.data<br /><br />Text db &quot;Hello World DialogBox, working great with single lines, but<br />what about the multiines, the one that has carrets ?<br />Is that possible&quot;, 0<br /><br />(...)<br /><br />code:LOCAL hTbm				:DWORD ; extra local to add<br /><br />.ELSEIF uMsg==WM_PAINT<br />	mov eax,hWnd<br />	.IF eax == hDlg<br />		invoke BeginPaint,hDlg,addr ps<br />		mov    hdc,eax<br />(...)<br />invoke DrawText, hMemDC, offset Text, -1, ADDR rect, DT_SINGLELINE<br />(...)<br /></div><br /><br />I changed the equate of the DrawText fucntion with DT_WORDBREAK, but the app crashed.<br /><br />The function DrwaTexEx, seems not to work with multilines too.<br /><br />How can this be fixed ?<br /><br />Best Regards,<br /><br />Guga</div>
    <div class="meta">Posted on 2003-09-27 16:11:49 by Beyond2000!</div>
   </div>
   <div class="post" id="post-119748">
    <div class="subject"><a href="#post-119748">why this bmp as a background is not working ??</a></div>
    <div class="body">Does this simpler approach work?<br /><br />; Write the text<br />Invoke	SelectObject, hDC, EnterYourFontHere<br />mov         hOldFont, eax<br />Invoke	SetTextColor, hDC, EnterYourTextColourHere<br />mov	rgbPrevText, eax<br />Invoke	SetBkMode, hDC, TRANSPARENT<br />; Single Line<br />Invoke	ExtTextOut, hDC, x, y, 0, NULL, offset szText, dwTextLength, NULL<br /><br />; Multiline	 - rc is a RECT with the dimensions of the area to draw the text into<br />; Comment out the above and uncomment this to use<br />; Invoke  ExtTextOut, hDC, x, y, ETO_CLIPPED, <br />; addr rc, addr szText, dwTextLength,  NULL<br /><br />Invoke	SelectObject, hDC, hOldFont<br />Invoke	SetTextColor, hDC, rgbPrevText<br />Invoke	SetBkMode, hdc, OPAQUE</div>
    <div class="meta">Posted on 2003-09-27 16:53:43 by andrew_k</div>
   </div>
   <div class="post" id="post-119752">
    <div class="subject"><a href="#post-119752">why this bmp as a background is not working ??</a></div>
    <div class="body">Yes, that should work. Also you can se this approach for some fancy text effects (like text with a shadow). I've seen that somewhere else in this board (unfortunately I don't remember exactly wich thread, but it's worth a search).</div>
    <div class="meta">Posted on 2003-09-27 17:25:43 by QvasiModo</div>
   </div>
   <div class="post" id="post-119753">
    <div class="subject"><a href="#post-119753">why this bmp as a background is not working ??</a></div>
    <div class="body">Hi.<br /><br />No, it's not working...<br /><br />It only fills the 1st line, and a white  rectangle outside....(Just like the problem reported before Dopnkey fix that).....<br /><br />The text is inside a Static Control...<br /><br />I used the name of the font of Garamond or Courier New, and nothing happened.<br /><br /><br />Best Regards,<br />Guga</div>
    <div class="meta">Posted on 2003-09-27 17:32:08 by Beyond2000!</div>
   </div>
   <div class="post" id="post-119754">
    <div class="subject"><a href="#post-119754">why this bmp as a background is not working ??</a></div>
    <div class="body">Hi Beyond2000,<br />Don't use a static control, all you need is a text string in your .data section. Then simply use  the code in the WM_PAINT handler in the parent window to write the text. You will need to create a font too, not just enter the name of one.<br />eg.<br /><br />mov logfont.lfHeight, dwMyFontHeight<br />mov logfont.lfWidth, 0<br />mov logfont.lfEscapement, 0<br />mov logfont.lfOrientation, 0<br />mov logfont.lfWeight, FW_NORMAL<br />mov logfont.lfItalic, 0<br />mov logfont.lfUnderline, 0<br />mov logfont.lfStrikeOut, 0<br />mov logfont.lfCharSet, ANSI_CHARSET<br />mov logfont.lfOutPrecision, OUT_TT_PRECIS<br />mov logfont.lfClipPrecision, CLIP_DEFAULT_PRECIS<br />mov logfont.lfQuality, DEFAULT_QUALITY<br />mov logfont.lfPitchAndFamily, DEFAULT_PITCH or FF_DONTCARE<br />Invoke lstrcpy, addr logfont.lfFaceName, addr szMyFontName<br />Invoke CreateFontIndirect, addr logfont<br />mov hFont, eax<br /><br />Don't forget to delete the font when you're finished with it.<br />Invoke	DeleteObject, hFont<br />See if this works.</div>
    <div class="meta">Posted on 2003-09-27 17:43:25 by andrew_k</div>
   </div>
   <div class="post" id="post-119755">
    <div class="subject"><a href="#post-119755">why this bmp as a background is not working ??</a></div>
    <div class="body">Wasn't there a way to print text with a transparent background? I mean, no need to mask anything. :confused:</div>
    <div class="meta">Posted on 2003-09-27 17:57:42 by QvasiModo</div>
   </div>
   <div class="post" id="post-119756">
    <div class="subject"><a href="#post-119756">why this bmp as a background is not working ??</a></div>
    <div class="body">Hi QvasiModo,<br />Do you mean something other than using:<br />Invoke SetBkMode, hDC, TRANSPARENT<br />with ExtTextOut?</div>
    <div class="meta">Posted on 2003-09-27 18:15:14 by andrew_k</div>
   </div>
   <div class="post" id="post-119764">
    <div class="subject"><a href="#post-119764">why this bmp as a background is not working ??</a></div>
    <div class="body">Hi Guys,<br /><br />it's not working...<br /><br /><br />i tried all ways, including and excluding the static control, or the ways you propoesd but nothing....<br /><br />This is the original way Donkey did:<br /><br /><pre><code><br />DialogProc proc uses ebx esi edi hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br />	LOCAL hdc			&#58;DWORD<br />	LOCAL hMemDC			&#58;DWORD<br />	LOCAL rect			&#58;RECT<br />	LOCAL ps			&#58;PAINTSTRUCT<br /><br />	.IF uMsg == WM_INITDIALOG<br />		mov eax,hWnd<br />		mov hDlg,eax<br />		invoke LoadBitmap,hInstance,BitMapResID<br />		mov hBitMap,eax<br />		invoke CreateSolidBrush,00FEFEFEh<br />		mov hBrush,eax<br /><br />	.ELSEIF uMsg == WM_CLOSE<br />		invoke DeleteObject,hBitMap <br />		invoke EndDialog,hWnd,-1<br /><br />	.ELSEIF uMsg==WM_PAINT<br />	mov eax,hWnd<br />	.IF eax == hDlg<br />		invoke BeginPaint,hDlg,addr ps<br />		mov    hdc,eax<br />		invoke CreateCompatibleDC,hdc<br />		mov    hMemDC,eax<br />		invoke SelectObject,hMemDC,hBitMap<br />		invoke GetClientRect,hDlg,addr rect<br />		invoke BitBlt,hdc,0,0,rect.right,rect.bottom,hMemDC,0,0,SRCCOPY<br />		invoke DeleteDC,hMemDC<br /><br /><br />		invoke CreateCompatibleDC,hdc<br />		mov    hMemDC,eax<br />		invoke SetTextColor,hMemDC,000000FFh<br />		invoke lstrlen,ADDR Text<br />		mov edx,eax<br />		invoke GetTextExtentPoint32,hMemDC,ADDR Text,edx,ADDR rect.right<br />		invoke CreateCompatibleBitmap,hdc,rect.right,rect.bottom<br />		mov hTbm,eax<br />		invoke SelectObject,hMemDC,hTbm<br />		mov rect.left,0<br />		mov rect.top,0<br />		invoke DrawText, hMemDC, offset Text, -1, ADDR rect, DT_SINGLELINE<br />		invoke BitBlt, hdc, 100, 100, rect.right, rect.bottom, hMemDC, \<br />				0, 0, MERGEPAINT<br />		invoke DeleteDC,hMemDC<br />		invoke DeleteObject,hTbm<br />		invoke EndPaint,hDlg,addr ps<br />	.ENDIF<br /><br />	.ELSEIF uMsg == WM_CTLCOLORSTATIC<br />		mov eax,hBrush<br />		ret<br /><br />	.ELSE<br />		mov eax,FALSE<br />		ret<br /><br />	.ENDIF<br /><br />	mov eax, TRUE<br />	ret<br />DialogProc endp<br /></code></pre><br /><br /><br />And this is waht i'm trying to do:<br /><br /><pre><code><br />.data<br /><br />dwMyFontHeight db 8<br />szMyFontName db &quot;Courier New&quot;<br />szText db &quot;Hello World DialogBox, working great with single lines, but<br />what about the multiines, the one that has carrets ?<br />Is that possible&quot;, 0<br /><br />hDlg dd 0<br />dwTextLength dd ?<br /><br /><br /><br />DialogProc proc uses ebx esi edi hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br />	LOCAL hdc			&#58;DWORD<br />	LOCAL hMemDC			&#58;DWORD<br />	LOCAL rect			&#58;RECT<br />	LOCAL ps			&#58;PAINTSTRUCT<br /><br />	LOCAL hFont			&#58; DWORD ; Added as Local var<br />	LOCAL rgbPrevText		&#58; DWORD ; Added as Local var<br /><br /><br />	.IF uMsg == WM_INITDIALOG<br />		mov eax,hWnd<br />		mov hDlg,eax<br />		invoke LoadBitmap,hInstance,BitMapResID<br />		mov hBitMap,eax<br />		invoke CreateSolidBrush,00FEFEFEh<br />		mov hBrush,eax<br /><br />	.ELSEIF uMsg == WM_CLOSE<br />		invoke DeleteObject,hBitMap <br />		invoke EndDialog,hWnd,-1<br /><br />	.ELSEIF uMsg==WM_PAINT<br />	mov eax,hWnd<br />	.IF eax == hDlg<br /><br />; --------------------------------------------------------------------<br />; Here is to show the background image in the dialog<br />; --------------------------------------------------------------------<br />		invoke BeginPaint,hDlg,addr ps<br />		mov    hdc,eax<br />		invoke CreateCompatibleDC,hdc<br />		mov    hMemDC,eax<br />		invoke SelectObject,hMemDC,hBitMap<br />		invoke GetClientRect,hDlg,addr rect<br />		invoke BitBlt,hdc,0,0,rect.right,rect.bottom,hMemDC,0,0,SRCCOPY<br />		invoke DeleteDC,hMemDC<br /><br />; -------------------------------------------------------------------<br /><br /><br />		mov logfont.lfHeight, dwMyFontHeight<br />		mov logfont.lfWidth, 0<br />		mov logfont.lfEscapement, 0<br />		mov logfont.lfOrientation, 0<br />		mov logfont.lfWeight, FW_NORMAL<br />		mov logfont.lfItalic, 0<br />		mov logfont.lfUnderline, 0<br />		mov logfont.lfStrikeOut, 0<br />		mov logfont.lfCharSet, ANSI_CHARSET<br />		mov logfont.lfOutPrecision, OUT_TT_PRECIS<br />		mov logfont.lfClipPrecision, CLIP_DEFAULT_PRECIS<br />		mov logfont.lfQuality, DEFAULT_QUALITY<br />		mov logfont.lfPitchAndFamily, DEFAULT_PITCH or FF_DONTCARE<br />		Invoke lstrcpy, addr logfont.lfFaceName, addr szMyFontName<br />		Invoke CreateFontIndirect, addr logfont<br />		mov hFont, eax<br /><br /><br />; Write the text<br />		Invoke SelectObject, hDC, szMyFontName<br />		mov hFont, eax<br />		Invoke SetTextColor, hDC, 00FEFEFEh<br />		mov rgbPrevText, eax<br />		Invoke SetBkMode, hDC, TRANSPARENT<br />; Single Line<br />;		Invoke ExtTextOut, hDC, 10, 41, 0, NULL, offset szText, dwTextLength, NULL<br /><br />; Multiline - rc is a RECT with the dimensions of the area to draw the text into<br />; Comment out the above and uncomment this to use<br />		Invoke ExtTextOut, hDC, 10, 41, ETO_CLIPPED, addr rc, addr szText, dwTextLength, NULL<br /><br />		Invoke SelectObject, hDC, hFont<br />		Invoke SetTextColor, hDC, rgbPrevText<br />		Invoke SetBkMode, hdc, OPAQUE<br /><br />		Invoke DeleteObject, hFont<br /><br /><br />	.ENDIF<br /><br />;	.ELSEIF uMsg == WM_CTLCOLORSTATIC ; -? Need to be erased ?<br />;		mov eax,hBrush<br />;		ret<br /><br />	.ELSE<br />		mov eax,FALSE<br />		ret<br /><br />	.ENDIF<br /><br />	mov eax, TRUE<br />	ret<br />DialogProc endp<br /></code></pre><br /><br /><br />I don't know what am i doing wrong...can someone fix this partf of the code ?<br /><br />And also,...one more thing...The setbkmode function is using the TRANSPARENT equate...does it works on win95 too ? I mean, the code seems to work only on windows2000.<br /><br /><br />Best Regards,<br /><br />Guga</div>
    <div class="meta">Posted on 2003-09-27 21:08:30 by Beyond2000!</div>
   </div>
   <div class="post" id="post-119885">
    <div class="subject"><a href="#post-119885">why this bmp as a background is not working ??</a></div>
    <div class="body">Hi Guga,<br />There are a couple of things we need to tweak. Firstly, create your font in the WM_INITDIALOG handler, not in response to the WM_PAINT message where it creates and recreates the font in a block of code that may be called frequently and, hence, needs to be minimal in size.<br /><br />The following code:<br /><br />Invoke CreateFontIndirect, addr logfont<br />mov hFont, eax<br /><br />creates the actual font and stores the handle to it a global variable named hFont.  When we select objects into device contexts what we actually load into the dc are handles to GDI objects. Hence in your WM_PAINT code you need to replace:<br /><br />Invoke SelectObject, hDC, szMyFontName<br />mov hFont, eax<br /><br />with<br />Invoke SelectObject, hDC, hFont<br />mov hOldFont, eax ; hOldFont is a local variable<br /><br />Your original code seeks to load a text string into the device context. A device context is like an artists canvas and palette combined. It is a surface you draw on with the tools currently selected into it. To use a particular font you have to load a handle to that font into the device context. <br /><br />The line:<br /><br />mov hOldFont, eax<br /><br />saves the handle to the font object previously loaded into the device context. The first time you load a GDI object of a certain type you want to retain this returned value so you can load it back into the dc at the end of that block of code. If you don't  a resource leak results. However when you saved this returned value  to hFont you overwrote the handle returned by CreateFontIndirect, meaning your application was then unable to destroy the font. This would have been done in response to the WM_DESTROY message (or WM_NCDESTROY), and prevents another resource leak:<br /><br />.ELSEIF uMsg == WM_DESTROY <br />Invoke DestroyObject hFont<br /><br /><br />SetBkMode works on Windows 95/NT 3.1 or later.<br />See if this helps.</div>
    <div class="meta">Posted on 2003-09-28 15:14:09 by andrew_k</div>
   </div>
   <div class="post" id="post-119893">
    <div class="subject"><a href="#post-119893">why this bmp as a background is not working ??</a></div>
    <div class="body">Hi Guys...<br /><br />Yeah..it's close. :)<br /><br />I did it, and am trying to put the text in paragraphs, but nothing is working so far.<br /><br />I initialzed the font, on WM_INITDIALOG, and put the proper coding on the WM_PAINTG....but even if the text is fully showed now...it is on a single line.....(The carrets are not being used to build the paragraphs - See the attached image).<br /><br /><br />The code i did was:<br /><br /><pre><code><br />.data<br /><br /><br /><br />dwMyFontHeight db 8<br /><br />szMyFontName db &quot;Garamond&quot;<br /><br />szText db &quot;Hello World DialogBox, working great with single lines, but ; Paragraph here<br />what about the multiines, the one that has carrets ? ; Paragraph here<br /><br />Is that possible&quot;, 0<br /><br /><br /><br />hDlg dd 0<br /><br />dwTextLength dd ?<br />hInstance dd ?<br /><br /><br />DialogProc proc hWin&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM<br /><br />    LOCAL hdc            &#58;DWORD<br />    LOCAL hMemDC            &#58;DWORD<br />    LOCAL rect            &#58;RECT<br />    LOCAL ps            &#58;PAINTSTRUCT<br />    LOCAL hFont            &#58; DWORD ; Added as Local var<br />    LOCAL rgbPrevText        &#58; DWORD ; Added as Local var<br />    LOCAL hOldFont        &#58; DWORD ; Added as Local var<br />    LOCAL logfont            &#58;LOGFONT<br /><br />    .IF uMsg == WM_INITDIALOG<br /><br />        ; Background image<br />        <br />        mov eax, hWin<br />        mov hDlg, eax<br />        invoke LoadBitmap, hInstance, IDB_BGD<br />        mov hBitMap, eax<br />	&#40;?&#41;<br /><br />;       Create our font routine<br /><br />        mov logfont.lfHeight, 10<br />        mov logfont.lfWidth, 0<br />        mov logfont.lfEscapement, 0<br />        mov logfont.lfOrientation, 0<br />        mov logfont.lfWeight, FW_NORMAL<br />        mov logfont.lfItalic, 0<br />        mov logfont.lfUnderline, 0<br />        mov logfont.lfStrikeOut, 0<br />        mov logfont.lfCharSet, ANSI_CHARSET<br />        mov logfont.lfOutPrecision, OUT_TT_PRECIS<br />        mov logfont.lfClipPrecision, CLIP_DEFAULT_PRECIS<br />        mov logfont.lfQuality, DEFAULT_QUALITY<br />        mov logfont.lfPitchAndFamily, DEFAULT_PITCH or FF_DONTCARE<br />        invoke lstrcpy, logfont.lfFaceName, logfont, szMyFontName <br />        invoke CreateFontIndirect, logfont<br />        mov hFont, eax<br /><br />    .ELSEIF uMsg==WM_PAINT<br /><br />	mov eax hWin<br />            .If eax = hDlg<br />                invoke BeginPaint, hDlg, ps<br />                mov hdc, eax<br />                invoke CreateCompatibleDC, hdc<br />                mov hMemDC, eax<br />                invoke SelectObject, hMemDC, hBitMap<br />                invoke GetClientRect, hDlg, rect<br />                invoke BitBlt, hdc, 0, 0, rect.right, rect.bottom, hMemDC 0 0 SRCCOPY<br />                invoke DeleteDC, hMemDC<br />                <br />                ; Text Colors<br /><br />                <br />                invoke SelectObject, hdc, hFont;<br />                mov hOldFont, eax<br />                invoke SetTextColor, hdc, 0DFBAA2h<br />                mov rgbPrevText, eax<br />                invoke SetBkMode, hdc, TRANSPARENT<br />      ;         invoke ExtTextOut, hdc, 10, 41, 0, NULL, MsgSobre2, rect.bottom, NULL ; Single Line<br />                invoke ExtTextOut, hdc, 10, 41, ETO_CLIPPED, rect MsgSobre2, rect.bottom, NULL<br />                invoke SelectObject, hdc, hFont<br />                invoke SetTextColor, hdc, rgbPrevText<br />                invoke SetBkMode, hdc, OPAQUE<br />                invoke DeleteObject, hFont<br /><br />            .End_If<br /><br /><br />    .ELSEIF uMsg = WM_COMMAND<br />	&#40;?&#41; command buttons<br /><br />    .ELSEIF uMsg = WM_COMMAND<br /><br />    ..Else_If uMsg = WM_CLOSE<br />    <br />            invoke DeleteObject, hBitMap<br />            invoke EndDialog, hWin, NULL<br />    <br />    <br />    ..Else_If uMsg = WM_DESTROY    <br /> <br />     invoke DeleteObject, hFont<br />     invoke PostQuitMessage, NULL<br />     mov eax, FALSE<br />   <br />    ..EndIf<br />    <br />    invoke DefWindowProc, hWin, uMsg, wParam, lParam<br />    mov eax, FALSE<br />   <br />DialogProc endp<br /><br /></code></pre><br /><br />How to put the mesage uging the paragrahps ? The message shopuld be displayed as:<br /><br /><div class="quote"><br />Hello World DialogBox, working great with single lines, but<br />what about the multiines, the one that has carrets ?<br /><br />Is that possible.<br /></div><br /><br />And not like:<br /><br /><div class="quote"><br />Hello World DialogBox, working great with single lines, but   what about the multiines, the one that has carrets ?     Is that possible.<br /></div><br /><br />Btw: I removed the WM_CTLCOLORSTATIC, but the text should fit in the area of the other static control as showned.<br /><br />Best Regards,<br /><br />Guga</div>
    <div class="meta">Posted on 2003-09-28 17:44:37 by Beyond2000!</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=11915&amp;page=1" style="">&laquo;</a><a href="../?id=11915&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="11915" /><input type="number" name="page" min="1" max="3" step="1" value="2" onchange="this.form.submit();" /><a href="../?id=11915&amp;page=3">&gt;</a><a href="../?id=11915&amp;page=3">&raquo;</a></form>  </div>
 </body>
</html>