<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>What's wrong with my NASM/NASMX/OpenGL code? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30916" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=116">Windows</a> &raquo; <a href="../?id=30916">What's wrong with my NASM/NASMX/OpenGL code?</a></p>
   <div class="post" id="post-216209">
    <div class="subject"><a href="#post-216209">What's wrong with my NASM/NASMX/OpenGL code?</a></div>
    <div class="body">Hi,<br /><br />I&#039;m trying to convert a simple C program to assembly using NASM and NASMX. See the code below. The assembly version does not really work. The C version results in a fullscreen window showing a white pixel at point 100, 100. The assembly version creates a fullscreen window but there is no pixel visible. Also it seems that ChangeDisplaySettings does not change the display settings in the assembly version. My monitor shows a little symbol when the screen resolution changes. With the C version this symbol is shown. Not so with the assembly version.<br /><br />I&#039;m new to assembly programming so I guess there is something wrong with how I handle the parameters. I can&#039;t find documentation on NASMX so I&#039;m not sure whether I initialize the structs correctly. What&#039;s wrong with the assembly program?<br /><br />Would be great to get some tipps, pointers and links to resource I can use to fix the assembly program.<br /><br />NASMX is great but I would rather not use it. My aim is to great the smallest possible windows executable creating a fullscreen window with an OpenGL context. I think with full control there are more switches I can use to shrink the code. How to setup these big structs for ChangeDisplaySettings and ChoosePixelFormat without NASMX?<br /><br />Peace<br />Jan<br /><br />The code of the C version:<br /><pre><code><br />#include &lt;windows.h&gt;<br />#include &lt;GL/gl.h&gt;<br /><br />#ifdef __cplusplus<br />extern &quot;C&quot; <br />{<br />#endif<br />int&nbsp; _fltused = 0;<br />#ifdef __cplusplus<br />}<br />#endif<br /><br />#define XRES 1024<br />#define YRES 768<br /><br />static PIXELFORMATDESCRIPTOR pfd = {<br />&nbsp; &nbsp; 0, // Size Of This Pixel Format Descriptor... BAD coding, nothing new, saves 6 bytes<br />&nbsp; &nbsp; 1, PFD_SUPPORT_OPENGL | PFD_DOUBLEBUFFER, 32, 0, 0, 0, 0, 0, 0,&nbsp; 0, 0, 0, 0, 0, 0, 0, 32, 0, 0, 0, 0, 0, 0, 0 <br />};<br /><br />static DEVMODE dmScreenSettings = {<br />&nbsp; &nbsp; &quot;&quot;, 0, 0, sizeof(dmScreenSettings), 0, DM_PELSWIDTH|DM_PELSHEIGHT, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, &quot;&quot;, 0, 0, XRES, YRES, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0<br />};<br /><br />void WINAPI WinMainCRTStartup() {<br /><br />&nbsp; &nbsp; ChangeDisplaySettings(&amp;dmScreenSettings, CDS_FULLSCREEN);<br />&nbsp; &nbsp; HDC hDC = GetDC(CreateWindow(&quot;edit&quot;, 0, WS_POPUP|WS_VISIBLE|WS_MAXIMIZE, 0, 0, 0, 0, 0, 0, 0, 0));<br />&nbsp; &nbsp; SetPixelFormat(hDC, ChoosePixelFormat(hDC, &amp;pfd), &amp;pfd);<br />&nbsp; &nbsp; wglMakeCurrent(hDC, wglCreateContext(hDC));<br />&nbsp; &nbsp; ShowCursor(FALSE);<br />&nbsp; &nbsp; glViewport(0, 0, XRES, YRES);<br />&nbsp; &nbsp; glMatrixMode(0x1701);<br />&nbsp; &nbsp; glLoadIdentity();<br />&nbsp; &nbsp; glOrtho(0, XRES, 0, YRES, -1, 1);<br />&nbsp; &nbsp; glMatrixMode(0x1700);<br />&nbsp; &nbsp; glLoadIdentity();<br />&nbsp; &nbsp; do {<br />&nbsp; &nbsp; &nbsp; &nbsp; glColor3ub(255, 255, 255);<br />&nbsp; &nbsp; &nbsp; &nbsp; glBegin(0x0000);<br />&nbsp; &nbsp; &nbsp; &nbsp; glVertex2i(100, 100);<br />&nbsp; &nbsp; &nbsp; &nbsp; glEnd();<br />&nbsp; &nbsp; &nbsp; &nbsp; SwapBuffers(hDC);<br />&nbsp; &nbsp; &nbsp; &nbsp; PeekMessageA(0, 0, 0, 0, PM_REMOVE);<br />&nbsp; &nbsp; } while (!GetAsyncKeyState(VK_ESCAPE));<br />&nbsp; &nbsp; ExitProcess(0);<br />}<br /></code></pre><br /><br />And the assembly code:<br /><pre><code><br />%include &#039;nasmx-1.0\inc\nasmx.inc&#039;<br />%include &#039;nasmx-1.0\inc\win32\windows.inc&#039;<br />%include &#039;nasmx-1.0\inc\win32\kernel32.inc&#039;<br />%include &#039;nasmx-1.0\inc\win32\user32.inc&#039;<br />%include &#039;nasmx-1.0\inc\win32\gdi32.inc&#039;<br />%include &#039;nasmx-1.0\inc\win32\opengl32.inc&#039;<br /><br />entry entrypoint<br /><br />XRES&nbsp; &nbsp; equ&nbsp; &nbsp;  1024<br />YRES&nbsp; &nbsp; equ&nbsp; &nbsp;  786<br /><br /><br />proc&nbsp; &nbsp; entrypoint, ptrdiff_t argcount, ptrdiff_t cmdline<br />locals none<br />&nbsp; &nbsp; invoke&nbsp; ChangeDisplaySettingsA, ptrdiff_t , 0x00000004<br />&nbsp; &nbsp; invoke&nbsp; CreateWindowExA, 0, szEdit, 0, WS_POPUP + WS_VISIBLE, 0, 0, XRES, YRES, 0, 0, 0, 0<br />&nbsp; &nbsp; invoke&nbsp; GetDC, eax<br />&nbsp; &nbsp; mov&nbsp; &nbsp;  ptrdiff_t , eax<br />&nbsp; &nbsp; invoke&nbsp; ChoosePixelFormat, ptrdiff_t , pfd<br />&nbsp; &nbsp; invoke&nbsp; SetPixelFormat, ptrdiff_t , eax, pfd<br />&nbsp; &nbsp; invoke&nbsp; wglCreateContext, ptrdiff_t <br />&nbsp; &nbsp; invoke&nbsp; wglMakeCurrent, ptrdiff_t , eax<br />&nbsp; &nbsp; invoke&nbsp; ShowCursor, FALSE<br />&nbsp; &nbsp; invoke&nbsp; glViewport, 0, 0, XRES, YRES<br />&nbsp; &nbsp; invoke&nbsp; glMatrixMode, 0x1701<br />&nbsp; &nbsp; invoke&nbsp; glLoadIdentity<br />&nbsp; &nbsp; invoke&nbsp; glOrtho, 0, XRES, 0, YRES, -1, 1<br />&nbsp; &nbsp; invoke&nbsp; glMatrixMode, 0x1700<br />&nbsp; &nbsp; invoke&nbsp; glLoadIdentity<br />.intro_loop:<br />&nbsp; &nbsp; invoke&nbsp; glColor3ub, 255, 255, 255<br />&nbsp; &nbsp; invoke&nbsp; glBegin, 0x0000<br />&nbsp; &nbsp; invoke&nbsp; glVertex2i, 100, 100<br />&nbsp; &nbsp; invoke&nbsp; glEnd<br />&nbsp; &nbsp; invoke&nbsp; SwapBuffers, ptrdiff_t <br />&nbsp; &nbsp; invoke&nbsp; PeekMessageA, 0, 0, 0, 0, PM_REMOVE<br />&nbsp; &nbsp; invoke&nbsp; GetAsyncKeyState, VK_ESCAPE<br />&nbsp; &nbsp; cmp&nbsp; &nbsp;  eax, dword 0<br />&nbsp; &nbsp; je&nbsp; &nbsp; &nbsp; .intro_loop<br />&nbsp; &nbsp; invoke&nbsp; ExitProcess, 0<br />endproc<br /><br /><br />&nbsp; &nbsp; hDc:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reserve(ptrdiff_t) 1<br /><br /><br />&nbsp; &nbsp; szEdit:&nbsp; &nbsp; &nbsp; &nbsp;  declare(NASMX_TCHAR) NASMX_TEXT(&quot;edit&quot;), 0x0<br />&nbsp; &nbsp; NASMX_ISTRUC pfd, PIXELFORMATDESCRIPTOR<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT nSize, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT nVersion, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dwFlags, 33<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT iPixelType, 32<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cColorBits, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cRedBits, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cRedShift, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cGreenBits, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cGreenShift, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cBlueBits, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cBlueShift, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cAlphaBits, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cAlphaShift, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cAccumBits, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cAccumRedBits, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cAccumGreenBits, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cAccumBlueBits, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cAccumAlphaBits, 32<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cDepthBits, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cStencilBits, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT cAuxBuffers, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT iLayerType, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT bReserved, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dwLayerMask, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dwVisibleMask, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dwDamageMask, 0<br />&nbsp; &nbsp; NASMX_IENDSTRUC<br />&nbsp; &nbsp; NASMX_ISTRUC dmScreenSettings, DEVMODE<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmDeviceName, &quot;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmSpecVersion, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmDriverVersion, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmSize, 156<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmDriverExtra, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmFields, 1572864<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmOrientation, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmPaperSize, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmPaperiLength, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmPaperWidth, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmScale, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmCopies, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmDefaultSource, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmPrintQuality, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmColor, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmDuplex, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmYResolution, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmTTOption, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmCollate, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmFormName, &quot;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmUnusedPadding, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmBitsPerPel, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmPelsWidth, XRES<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmPelsHeight, YRES<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmDisplayFlags, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmDisplayFrequency, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmICMMethod, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmICMIntent, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmMediaType, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmDitherType, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmReserved1, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmReserved2, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmPanningWidth, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; NASMX_AT dmPanningHeight, 0<br />&nbsp; &nbsp; NASMX_IENDSTRUC<br /></code></pre></div>
    <div class="meta">Posted on 2012-09-03 13:25:00 by parasight</div>
   </div>
   <div class="post" id="post-216210">
    <div class="subject"><a href="#post-216210">Re: What's wrong with my NASM/NASMX/OpenGL code?</a></div>
    <div class="body">I can&#039;t test the code at the moment, however the ampersand in the call to the ChangeDisplaySettings function in the C example means that you want the address of the structure. This means the assembly code should look something like this instead:<br /><br /><pre><code>invoke&nbsp; ChangeDisplaySettingsA, ptrdiff_t dmScreenSettings, 0x00000004</code></pre><br /><br /><div class="quote">NASMX is great but I would rather not use it. My aim is to great the smallest possible windows executable creating a fullscreen window with an OpenGL context. I think with full control there are more switches I can use to shrink the code.</div><br /><br />NASMX doesn&#039;t really add much overhead (if any) to your code. Most of the stuff that NASMX does is to provide preprocessor features that the assembler itself doesn&#039;t support (like nested structures and single-line invocations) out of box.<br /><br />One important note, NASMX was never designed to be a learning tool or something for novice programmers. It was a method to provide rapid application development facilities with the Netwide Assembler. So if you are just learning, then it&#039;s not a bad idea to wade through all that calling convention stuff and get used to the native NASM syntax. Then when you become competent, use NASMX to allow you to develop ideas in less time.<br /><br />Regards,<br />Bryant Keller</div>
    <div class="meta">Posted on 2012-09-03 14:15:10 by Synfire</div>
   </div>
   <div class="post" id="post-216212">
    <div class="subject"><a href="#post-216212">Re: What's wrong with my NASM/NASMX/OpenGL code?</a></div>
    <div class="body">Bryant,<br /><br />thanks much for your input!<br /><br /><div class="quote"><br />I can&#039;t test the code at the moment, however the ampersand in the call to the ChangeDisplaySettings function in the C example means that you want the address of the structure. This means the assembly code should look something like this instead:<br /><br /><pre><code>invoke&nbsp; ChangeDisplaySettingsA, ptrdiff_t dmScreenSettings, 0x00000004</code></pre><br /></div><br />I&#039;ve tried that variant as well. It does not work either. I guess there is something wrong with how I fill the screen settings struct. Later I&#039;ll disassemble the binary of my C version to see how the compiler does it.<br /><br /><div class="quote">NASMX doesn&#039;t really add much overhead (if any) to your code. Most of the stuff that NASMX does is to provide preprocessor features that the assembler itself doesn&#039;t support (like nested structures and single-line invocations) out of box.</div><br />Ok, that&#039;s good to know. What I want is no overhead at all. I don&#039;t want to &#039;waste&#039; a single byte :) With the help of <a target="_blank" href="http://&quot;http://www.crinkler.net/&quot;">crinkler</a> and certain compiler options the binary of the C version is 609 bytes. I think there could be room to save more bytes by doing it all &#039;by hand&#039;.<br /><br /><div class="quote">One important note, NASMX was never designed to be a learning tool or something for novice programmers. It was a method to provide rapid application development facilities with the Netwide Assembler. So if you are just learning, then it&#039;s not a bad idea to wade through all that calling convention stuff and get used to the native NASM syntax. Then when you become competent, use NASMX to allow you to develop ideas in less time.</div><br />I never thought it was designed for novice programmers. That&#039;s ok for me and that&#039;s also why I want to avoid using it. I want to know how it works before I use tools or libraries to do the work for me. I found a basic program in NASM syntax using the Win32 API without NASMX. I&#039;ll try using it as a basis for my program.</div>
    <div class="meta">Posted on 2012-09-04 01:43:25 by parasight</div>
   </div>
   <div class="post" id="post-216217">
    <div class="subject"><a href="#post-216217">Re: What's wrong with my NASM/NASMX/OpenGL code?</a></div>
    <div class="body">NASMX can and is used by both beginner and advanced users alike.&nbsp; Beginning programmers are shielded from calling convention complexities and can thus concentrate more on the original problem they are trying to solve ( or learn from! ).&nbsp; Advanced users use NASMX to automate repetitive coding tasks and not worry about introducing subtle bugs when doing some quick coding.&nbsp; It is, after all, the Netwide Assembler Set of Macros eXtended. ;)<br /><br />The beautiful thing about NASMX is that if you structure your code properly you can easily port between Windows and Linux by maintaining a small set of core files that handle OS specific functionality and make use of those routines from your main app.&nbsp; It&#039;s probably the closest thing an assembly programmer can get to write-once run everywhere ( as long as everywhere means 32/64-bit AMD/Intel CPU chips, that is ;-).<br /></div>
    <div class="meta">Posted on 2012-09-04 11:15:33 by p1ranha</div>
   </div>
   <div class="post" id="post-216218">
    <div class="subject"><a href="#post-216218">Re: What's wrong with my NASM/NASMX/OpenGL code?</a></div>
    <div class="body">I got it working without NASMX and saved a few bytes. It&#039;s still bigger than the C version (compiled with the Microsoft compiler) though. Does anyone see room to save bytes without changing the functionality? Should I try MASM to see if it creates a smaller binary?<br /><br />This is the code:<br /><br /><pre><code>global&nbsp; main<br /><br />extern _glOrtho@48<br />extern _ChangeDisplaySettingsA@8<br />extern _CreateWindowExA@48<br />extern _GetDC@4<br />extern _ChoosePixelFormat@8<br />extern _SetPixelFormat@12<br />extern _wglCreateContext@4<br />extern _wglMakeCurrent@8<br />extern _ShowCursor@4<br />extern _glViewport@16<br />extern _glMatrixMode@4<br />extern _glLoadIdentity@0<br />extern _glColor3ub@12<br />extern _glBegin@4<br />extern _glVertex2i@8<br />extern _glEnd@0<br />extern _SwapBuffers@4<br />extern _PeekMessageA@20<br />extern _GetAsyncKeyState@4<br />extern _ExitProcess@4<br /><br />XRES&nbsp; &nbsp; equ&nbsp; &nbsp;  800<br />YRES&nbsp; &nbsp; equ&nbsp; &nbsp;  600<br /> <br /><br />main:<br />&nbsp; &nbsp; push&nbsp; &nbsp; 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; CDS_FULLSCREEN<br />&nbsp; &nbsp; push&nbsp; &nbsp; dword dms<br />&nbsp; &nbsp; call&nbsp; &nbsp; _ChangeDisplaySettingsA@8<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 91000000h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; WS_POPUP + WS_VISIBLE + WS_MAXIMIZE<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; szEdit<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; call&nbsp; &nbsp; _CreateWindowExA@48<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; call&nbsp; &nbsp; _GetDC@4<br />&nbsp; &nbsp; mov&nbsp; &nbsp;  dword , eax<br /><br />&nbsp; &nbsp; push&nbsp; &nbsp; dword pfd<br />&nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; call&nbsp; &nbsp; _ChoosePixelFormat@8<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; dword pfd<br />&nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; push&nbsp; &nbsp; dword <br />&nbsp; &nbsp; call&nbsp; &nbsp; _SetPixelFormat@12<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; dword <br />&nbsp; &nbsp; call&nbsp; &nbsp; _wglCreateContext@4<br /><br />&nbsp; &nbsp; push&nbsp; &nbsp; eax<br />&nbsp; &nbsp; push&nbsp; &nbsp; dword <br />&nbsp; &nbsp; call&nbsp; &nbsp; _wglMakeCurrent@8<br /><br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; call&nbsp; &nbsp; _ShowCursor@4<br /><br />&nbsp; &nbsp; push&nbsp; &nbsp; YRES<br />&nbsp; &nbsp; push&nbsp; &nbsp; XRES<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; call&nbsp; &nbsp; _glViewport@16<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; 0x1701<br />&nbsp; &nbsp; call&nbsp; &nbsp; _glMatrixMode@4<br /><br />&nbsp; &nbsp; call&nbsp; &nbsp; _glLoadIdentity@0<br /><br />&nbsp; &nbsp; sub&nbsp; &nbsp;  esp, 8<br />&nbsp; &nbsp; fld1<br />&nbsp; &nbsp; fstp&nbsp; &nbsp; qword <br />&nbsp; &nbsp; sub&nbsp; &nbsp;  esp, 8<br />&nbsp; &nbsp; fldz<br />&nbsp; &nbsp; fstp&nbsp; &nbsp; qword <br />&nbsp; &nbsp; sub&nbsp; &nbsp;  esp, 8<br />&nbsp; &nbsp; fld&nbsp; &nbsp;  qword <br />&nbsp; &nbsp; fstp&nbsp; &nbsp; qword <br />&nbsp; &nbsp; sub&nbsp; &nbsp;  esp, 8<br />&nbsp; &nbsp; fldz<br />&nbsp; &nbsp; fstp&nbsp; &nbsp; qword <br />&nbsp; &nbsp; sub&nbsp; &nbsp;  esp, 8<br />&nbsp; &nbsp; fld&nbsp; &nbsp;  qword <br />&nbsp; &nbsp; fstp&nbsp; &nbsp; qword <br />&nbsp; &nbsp; sub&nbsp; &nbsp;  esp, 8<br />&nbsp; &nbsp; fldz<br />&nbsp; &nbsp; fstp&nbsp; &nbsp; qword <br />&nbsp; &nbsp; call&nbsp; &nbsp; _glOrtho@48<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; 0x1700<br />&nbsp; &nbsp; call&nbsp; &nbsp; _glMatrixMode@4<br /><br />&nbsp; &nbsp; call&nbsp; &nbsp; _glLoadIdentity@0<br /><br />.intro_loop:<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 255<br />&nbsp; &nbsp; call&nbsp; &nbsp; _glColor3ub@12<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; GL_POINTS<br />&nbsp; &nbsp; call&nbsp; &nbsp; _glBegin@4<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; 300<br />&nbsp; &nbsp; push&nbsp; &nbsp; 400<br />&nbsp; &nbsp; call&nbsp; &nbsp; _glVertex2i@8<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; call&nbsp; &nbsp; _glEnd@0<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; dword <br />&nbsp; &nbsp; call&nbsp; &nbsp; _SwapBuffers@4<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; PM_REMOVE<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; call&nbsp; &nbsp; _PeekMessageA@20<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; 1Bh&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; VK_ESCAPE<br />&nbsp; &nbsp; call&nbsp; &nbsp; _GetAsyncKeyState@4<br />&nbsp; &nbsp; cmp&nbsp; &nbsp;  eax, dword 0<br />&nbsp; &nbsp; je&nbsp; &nbsp; &nbsp; .intro_loop<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; push&nbsp; &nbsp; 0<br />&nbsp; &nbsp; call&nbsp; &nbsp; _ExitProcess@4<br />&nbsp; &nbsp; ret<br />&nbsp; &nbsp; <br /><br />&nbsp; &nbsp; hDc:&nbsp; &nbsp; resd 1<br /><br /><br />&nbsp; &nbsp; dms:&nbsp; &nbsp; dd 0, 0, 0, 0, 0, 0, 0, 0, 0, 156, 1572864, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 800, 600, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0<br />&nbsp; &nbsp; pfd:&nbsp; &nbsp; dd 65536, 33, 32, 0, 0, 2097152, 0, 0, 0<br />&nbsp; &nbsp; r:&nbsp; &nbsp; &nbsp; dq 800.0<br />&nbsp; &nbsp; t:&nbsp; &nbsp; &nbsp; dq 600.0<br />&nbsp; &nbsp; szEdit: db &#039;e&#039;, &#039;d&#039;, &#039;i&#039;, &#039;t&#039;, 0<br /></code></pre></div>
    <div class="meta">Posted on 2012-09-04 16:38:36 by parasight</div>
   </div>
   <div class="post" id="post-216219">
    <div class="subject"><a href="#post-216219">Re: What's wrong with my NASM/NASMX/OpenGL code?</a></div>
    <div class="body"><div class="quote"><br />It&#039;s still bigger than the C version (compiled with the Microsoft compiler) though. <br /></div><br /><br />This right here tells me it&#039;s probably your code or linker options and not the assembler output.&nbsp; Why don&#039;t you compare the disassembly of the compiler output to your source to find where you can make improvements?&nbsp; Also, you may want to research Portable Executable ( PE ) header reduction if you really want to shrink your program by even more bytes.</div>
    <div class="meta">Posted on 2012-09-04 18:08:46 by p1ranha</div>
   </div>
   <div class="post" id="post-216220">
    <div class="subject"><a href="#post-216220">Re: What's wrong with my NASM/NASMX/OpenGL code?</a></div>
    <div class="body">You push all those zeros.&nbsp; You can get a smaller push encoding by zeroing out a register and pushing the &quot;zeroed&quot; register instead of a 0<br /><br /><pre><code>cmp&nbsp; &nbsp;  eax, dword 0</code></pre><br />can be changed to <br /><pre><code>test eax, eax<br />jz&nbsp; &nbsp; &nbsp; .intro_loop</code></pre><br /><br />Your using hDc a few times, use a register instead.</div>
    <div class="meta">Posted on 2012-09-04 19:20:23 by Gunner</div>
   </div>
  </div>
 </body>
</html>