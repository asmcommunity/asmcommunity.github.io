<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Default Button closes app - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=7456" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=7456">Default Button closes app</a></p>
   <div class="post" id="post-54281">
    <div class="subject"><a href="#post-54281">Default Button closes app</a></div>
    <div class="body">I have been reading Iczelion's tuts and I have come to number 10.<br /><br />It compiles fine, runs fine, except that when I hit enter...the application closes.<br /><br />Simple Question....how do I keep it from closing????<br /><br />I have tried to catch a WM_KEYDOWN and WM_CHAR but this doesn't work either.<br /><br />I can't figure it out...I've searched this forum for DEFPUSHBUTTON but I haven't found anything.<br /><br />If this has already been answer please let me know <span style="font-size:9px>... bazik</span><br /><br />I have attached the files I'm working with, as well has a make file<br /><br />Thanks for any help,<br />gorshing</div>
    <div class="meta">Posted on 2002-08-20 15:00:13 by gorshing</div>
   </div>
   <div class="post" id="post-54282">
    <div class="subject"><a href="#post-54282">Default Button closes app</a></div>
    <div class="body">Hi,<br /><br />after looking at your code I noticed the following:<br /><br /><pre><code><br />    .ELSEIF uMsg==WM_COMMAND <br />        mov eax,wParam <br />        .IF lParam==0 <br />            .IF ax==IDM_GETTEXT <br />                invoke GetDlgItemText,hWnd,IDC_EDIT,ADDR buffer,512 <br />                invoke MessageBox,NULL,ADDR buffer,ADDR AppName,MB_OK <br />            .ELSEIF ax==IDM_CLEAR <br />                invoke SetDlgItemText,hWnd,IDC_EDIT,NULL <br />            .ELSE                                      &lt;-------------------<br />                invoke DestroyWindow,hWnd               &lt;-------------------<br />            .ENDIF <br /><br /></code></pre> <br /><br /><br />Why is this in there? Comment it out, try again, and you'll see, that your app will stay there :)<br /><br />HTH<br /><br />Greets YaWNS</div>
    <div class="meta">Posted on 2002-08-20 15:09:50 by YaWNS</div>
   </div>
   <div class="post" id="post-54356">
    <div class="subject"><a href="#post-54356">Default Button closes app</a></div>
    <div class="body">Ok, cool ... my app stays up( that was pretty stupid on my part ), but the default button still doesn't work.<br /><br />But what message am I letting get through?<br /><br />I thought that the 'enter' key would eventually be turned into a BN_CLICKED message with the source being IDC_BUTTON.<br /><br />But it is acting as though it was a Menu command ( since lParam == 0 ) not the control.<br /><br />Sorry but I'm still a little confused.  But thanks for that help though.<br /><br />gorshing</div>
    <div class="meta">Posted on 2002-08-21 09:14:12 by gorshing</div>
   </div>
   <div class="post" id="post-54362">
    <div class="subject"><a href="#post-54362">Default Button closes app</a></div>
    <div class="body">Hi,<br /><br />I have another suggestion for your code.<br /><br /><pre><code><br />        .ELSE <br />            mov edx,wParam <br />            shr edx,16 <br />            .IF dx==BN_CLICKED <br />&lt;-------------------------------------------------&gt;<br />            push eax<br />            invoke MessageBox, hWnd, NULL, NULL, MB_OK<br />            pop eax<br />&lt;-------------------------------------------------&gt;<br />                .IF ax==IDC_BUTTON <br />                    invoke SetDlgItemText,hWnd,IDC_EDIT,ADDR TestString <br />                .ELSEIF ax==IDC_EXIT <br />                    invoke SendMessage,hWnd,WM_COMMAND,IDM_EXIT,0 <br />                .ENDIF <br />            .ENDIF <br />        .ENDIF <br /><br /></code></pre> <br /><br />If you add <strong>push eax</strong> and <strong>pop eax</strong>, then you can keep your messagebox popping up, before entering the text into the edit box. If you don't preserve EAX, then the MessageBox Function will mess up EAX and your code never recognizes, which button has been pushed.<br /><br />Greets YaWNS</div>
    <div class="meta">Posted on 2002-08-21 10:50:08 by YaWNS</div>
   </div>
   <div class="post" id="post-54376">
    <div class="subject"><a href="#post-54376">Default Button closes app</a></div>
    <div class="body">ok this is what I have now<br /><br /><pre><code><br />.386 <br />.model flat,stdcall <br />option casemap&#58;none <br />WinMain proto &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD <br />include \masm32\include\windows.inc <br />include \masm32\include\user32.inc <br />include \masm32\include\kernel32.inc <br />includelib \masm32\lib\user32.lib <br />includelib \masm32\lib\kernel32.lib <br />.data <br />ClassName db &quot;DLGCLASS&quot;,0 <br />MenuName db &quot;MyMenu&quot;,0 <br />DlgName db &quot;MyDialog&quot;,0 <br />AppName db &quot;Our First Dialog Box&quot;,0 <br />TestString db &quot;Wow! I'm in an edit box now&quot;,0 <br /><br />.data? <br />hInstance HINSTANCE ? <br />CommandLine LPSTR ? <br />buffer db 512 dup&#40;?&#41; <br /><br />.const <br />IDC_EDIT        equ 3000 <br />IDC_BUTTON      equ 3001 <br />IDC_EXIT        equ 3002 <br />IDM_GETTEXT     equ 32000 <br />IDM_CLEAR       equ 32001 <br />IDM_EXIT        equ 32002 <br /><br />.code <br />start&#58; <br />    invoke GetModuleHandle, NULL <br />    mov    hInstance,eax <br />    invoke GetCommandLine<br />    mov CommandLine,eax <br />    invoke WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT <br />    invoke ExitProcess,eax <br /><br />WinMain proc hInst&#58;HINSTANCE,hPrevInst&#58;HINSTANCE,CmdLine&#58;LPSTR,CmdShow&#58;DWORD <br />    LOCAL wc&#58;WNDCLASSEX <br />    LOCAL msg&#58;MSG <br />    LOCAL hDlg&#58;HWND <br />    mov   wc.cbSize,SIZEOF WNDCLASSEX <br />    mov   wc.style, CS_HREDRAW or CS_VREDRAW <br />    mov   wc.lpfnWndProc, OFFSET WndProc <br />    mov   wc.cbClsExtra,NULL <br />    mov   wc.cbWndExtra,DLGWINDOWEXTRA <br />    push  hInst <br />    pop   wc.hInstance <br />    mov   wc.hbrBackground,COLOR_BTNFACE+1 <br />    mov   wc.lpszMenuName,OFFSET MenuName <br />    mov   wc.lpszClassName,OFFSET ClassName <br />    invoke LoadIcon,NULL,IDI_APPLICATION <br />    mov   wc.hIcon,eax <br />    mov   wc.hIconSm,eax <br />    invoke LoadCursor,NULL,IDC_ARROW <br />    mov   wc.hCursor,eax <br />    invoke RegisterClassEx, addr wc <br />    invoke CreateDialogParam,hInstance,ADDR DlgName,NULL,NULL,NULL <br />    mov   hDlg,eax <br />    invoke ShowWindow, hDlg,SW_SHOWNORMAL <br />    invoke UpdateWindow, hDlg <br />    invoke GetDlgItem,hDlg,IDC_EDIT <br />    invoke SetFocus,eax <br />    .WHILE TRUE <br />        invoke GetMessage, ADDR msg,NULL,0,0 <br />        .BREAK .IF &#40;!eax&#41; <br />       invoke IsDialogMessage, hDlg, ADDR msg <br />        .IF eax ==FALSE <br />            invoke TranslateMessage, ADDR msg <br />            invoke DispatchMessage, ADDR msg <br />        .ENDIF <br />    .ENDW <br />    mov     eax,msg.wParam <br />    ret <br />WinMain endp <br /><br />WndProc proc hWnd&#58;HWND, uMsg&#58;UINT, wParam&#58;WPARAM, lParam&#58;LPARAM <br />    .IF uMsg==WM_DESTROY <br />        invoke PostQuitMessage,NULL <br />    .ELSEIF uMsg==WM_COMMAND <br />        mov eax,wParam <br />        .IF lParam==0 <br />            .IF ax==IDM_GETTEXT <br />                invoke GetDlgItemText,hWnd,IDC_EDIT,ADDR buffer,512 <br />                invoke MessageBox,NULL,ADDR buffer,ADDR AppName,MB_OK <br />            .ELSEIF ax==IDM_CLEAR <br />                invoke SetDlgItemText,hWnd,IDC_EDIT,NULL<br />            .ELSEIF ax==IDM_EXIT<br />                invoke PostQuitMessage, NULL<br />            .ENDIF <br />        .ELSE <br />            mov edx,wParam <br />            shr edx,16 <br />            .IF dx==BN_CLICKED <br />                .IF ax==IDC_BUTTON <br />                    invoke SetDlgItemText,hWnd,IDC_EDIT,ADDR TestString <br />                .ELSEIF ax==IDC_EXIT <br />                    invoke SendMessage,hWnd,WM_COMMAND,IDM_EXIT,0 <br />                .ENDIF <br />            .ENDIF <br />        .ENDIF <br />    .ELSE <br />        invoke DefWindowProc,hWnd,uMsg,wParam,lParam <br />        ret <br />    .ENDIF <br />    xor    eax,eax <br />    ret <br />WndProc endp<br />end start<br /></code></pre><br /><br />I have taken out all those MessageBoxes that were causing confusion.  But the default button still doesn't work.  I do get a WM_COMMAND but i hit enter, and ax contains 1.  This doesn't make sense to me.  Anybody else know what I am missing?<br /><br />Thanks again Yawns,<br />gorshing</div>
    <div class="meta">Posted on 2002-08-21 13:07:26 by gorshing</div>
   </div>
   <div class="post" id="post-54651">
    <div class="subject"><a href="#post-54651">Default Button closes app</a></div>
    <div class="body">I have found my answer!  I don't know if anybody knows this, but since no one has replied .....<br /><br /><div class="quote"><br />From Petzold's book<br /><br />If no push button in the dialog box is the default push button, Windows sends the dialog box procedure a WM_COMMAND message with the LOWORD of wParam equal to IDOK.<br /><br />Page 508<br /></div><br /><br />IDOK is equal to 1.<br /><br />But now I have another question, I do have a DEFPUSHBUTTON, so why is this happening?<br /><br />Later, in search of truth</div>
    <div class="meta">Posted on 2002-08-23 14:25:42 by gorshing</div>
   </div>
   <div class="post" id="post-54898">
    <div class="subject"><a href="#post-54898">Default Button closes app</a></div>
    <div class="body">I believe it's the invoking of IsDialogMessage. This function is supposed to implement the standard dialog keyboard functions, such as tabbing to marked fields and converting ENTERs to IDOK commands.</div>
    <div class="meta">Posted on 2002-08-26 04:31:17 by tenkey</div>
   </div>
  </div>
 </body>
</html>