<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>how to define the union stucture in NASM? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=1337" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=1337">how to define the union stucture in NASM?</a></p>
   <div class="post" id="post-8576">
    <div class="subject"><a href="#post-8576">how to define the union stucture in NASM?</a></div>
    <div class="body">anyone know how to define the union structure in NASM?</div>
    <div class="meta">Posted on 2001-10-03 10:38:27 by doby</div>
   </div>
   <div class="post" id="post-8579">
    <div class="subject"><a href="#post-8579">how to define the union stucture in NASM?</a></div>
    <div class="body">from masm32.hlp:<br /><pre><code><br />  Syntax&#58;   name UNION &#91;alignment&#93; &#91;, NONUNIQUE&#93;<br />              fielddeclarations<br />            &#91;name&#93; ENDS<br /> <br />  Description&#58;<br /> <br />     Declares a union as a new data type. Allows the same memory<br />     locations to be overlapped with different types. Identical to<br />     STRUCT except that each member has a 0 offset. The size of the<br />     union is the size of the largest member of the union.<br /> <br />     Unions can be used to store one type of data in some circumstances<br /><br />     and another type in a different situation. Unions also allow you<br />     to store data as one data type and then read it as another. Unions<br />     are initialized by using the union name as a data declaration<br />     directive. You only need to initialize a union for one data type.<br /> <br />     You must refer to union members by their member names. The LABEL<br />     directive allows you to refer to the entire union as a unit.<br /> <br />     The first-level definition of a union must include the &lt;name&gt;<br /><br />     label preceding the ENDS. In nested unions, terminate the block<br />     with a ENDS statement without the &lt;name&gt; label.<br /> <br />     The &lt;alignment&gt; field determines the byte alignment of any<br />     structures. This field can be 1, 2, or 4. The default is 1, unless<br />     overridden by the /Zp command-line option or the<br />     ALIGN or EVEN directives.<br /> <br />     The NONUNIQUE parameter allows elements of the union to be<br />     accessed only by their fully specified names.<br /> <br />     Some directives are allowed in the &lt;fielddeclarations&gt; field;<br /><br />     see the BNF Appendix in the MASM Programmer's Guide.<br /> <br />  Example&#58;<br /> <br />     EXTENDCHAR  UNION<br />                 ascii       BYTE    ?      ;Define a union of byte and<br />                 kanji       WORD    ?      ; word<br />     EXTENDCHAR  ENDS<br />     initial     EXTENDCHAR  &lt;J&gt;            ;Create a union variable<br />     mov         al, initial.ascii          ;Move byte-length data<br />     mov         bx, initial.kanji          ;Move word-length data<br />                                    -o-<br /></code></pre><br /><br />Thomas</div>
    <div class="meta">Posted on 2001-10-03 10:47:08 by Thomas</div>
   </div>
   <div class="post" id="post-8589">
    <div class="subject"><a href="#post-8589">how to define the union stucture in NASM?</a></div>
    <div class="body">well is this what you want?<br /><br />i just take it from a forum:<br /><br />*******************************<br />        struc button_event<br />.type   resb    1<br />.which  resb    1<br />.button resb    1<br />.state  resb    1<br />        endstruc<br /><br />        struc   key_event<br />.type   resb    1<br />.which  resb    1<br />.key    resb    1<br />.state  resb    1<br />        endstruc<br /><br />.data<br />button  istruc  button_event<br />        iend<br />key     istruc  key_event<br />        iend<br />type:   db      0<br /><br />...but since nasm uses macros to create instances of structs, it was doing<br />something equivalent to this:<br /><br />.data<br />button.type     db      0<br />button.which    db      0<br />button.button   db      0<br />button.state    db      0<br />key.type        db      0<br />key.which       db      0<br />key.key         db      0<br />key.state       db      0<br />type            db      0<br /><br />... which is like declaring a struct of SDL_event (not a union).<br /><br />But, there is hope.  nasm defines the members of the struct to be constant<br />offsets from the beginning of the struct.  So, you can use<br />button_event.type, key_event.key, etc to access offsets into the same data<br />declaration.<br /><br />So, if you did something like this:<br /><br />.data<br />event:<br />type:   times 4 db 0<br /><br />... then code like this:<br /><br />.code<br /><br />        mov     byte    , al<br />        mov     byte    , al<br />        mov     byte    al, <br />        ...<br /><br />... would all access the same data, and you could refer to the same data<br />as different events.<br /><br />Two problems are:<br />- you have to know what the size of the largest struct is, so you can be<br />  sure to reserve enough space in .data<br />- you have to know (i.e. comment) that you are using that space for a<br />  union (it's non-obvious)<br /><br />You could even make a fako struct of type event to make it a little more<br />obvious about what you were doing:<br /><br />        struc   event<br />key:<br />button:<br />type:   resb    4<br />        endstruc<br /><br />... and declare it like this:<br /><br />.data<br />myevent:        istruc event<br />                iend<br /><br />... and access it like this:<br /><br />.code<br />        mov     byte    , al<br />        mov     byte    , al<br />        mov     byte    al, <br /><br />The first problem still exists, but it makes a tad bit more obivous that<br />you are trying to use it as a union.<br /><br />Does this help?</div>
    <div class="meta">Posted on 2001-10-03 13:18:54 by Nguga</div>
   </div>
   <div class="post" id="post-8605">
    <div class="subject"><a href="#post-8605">here another :) i found on the web</a></div>
    <div class="body">here is another that i just found on the net:<br /><br /><br /><br /><br />                           Code:<br /><br />                           union {<br />                                   long    value;          /* 4 bytes */<br />                                   struct {<br />                                           int     first;  /* 2 bytes */<br />                                           INT     second; /* 2 bytes */<br />                                   } half;<br />                           } number;<br /><br /><br /><br /><br /><br />                      can be transalted into <br /><br />                           Code:<br /><br />                           number.value            equ     0<br />                           number.half.first       equ     0<br />                           number.half.second      equ     2<br />                           number_size             equ     4<br /><br /><br /><br /><br /><br />                      You can declare the union in the data segment as <br />                           Code:<br /><br />                           num1    TIMES number_size DB 0<br /><br /><br /><br /><br />                      or in uninitialised segement as <br />                           Code:<br /><br />                           num1    RESB    number_size<br /><br /><br /><br /><br /><br />                      Now accessing the members of the union. <br /><br />                      If you want to access the 'value' part of 'number' union, <br />                      you will code like this <br />                           Code:<br /><br />                                   Mov     eax,  ; Get 'value'<br />                                   Mov     , eax ; Set 'value'<br /><br /><br /><br /><br />                      and to access the 'first' and 'second', you do as <br />                           Code:<br /><br />                                   Mov     bx, <br />                                   Mov     cx, <br /><br /><br /><br /><br /><br />                      This is a simple example. Complex union can also converted <br />                      like this. <br /><br /><br />                      _________________<br />                      Jones.<br /><br /><br /><br /><br />GET NaGoA RAD IDE for NASM WIN32ASM !<br /><br />http:\\Visual-Assembler.pt.vu</div>
    <div class="meta">Posted on 2001-10-03 17:26:26 by Nguga</div>
   </div>
   <div class="post" id="post-8649">
    <div class="subject"><a href="#post-8649">how to define the union stucture in NASM?</a></div>
    <div class="body">i got it... <br />nguga: your example of EQU is the good way to define the complex union stuct :) thank you verymuch.<br /><br />thomas: i just want NASM's code not MASM, but anyway thank you :)</div>
    <div class="meta">Posted on 2001-10-04 06:10:51 by doby</div>
   </div>
   <div class="post" id="post-8664">
    <div class="subject"><a href="#post-8664">how to define the union stucture in NASM?</a></div>
    <div class="body">doby: Sorry I misread that for MASM :rolleyes: <br /><br />Thomas</div>
    <div class="meta">Posted on 2001-10-04 11:12:16 by Thomas</div>
   </div>
  </div>
 </body>
</html>