<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>levenshtein distance - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=9758" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=9758">levenshtein distance</a></p>
   <div class="post" id="post-72493">
    <div class="subject"><a href="#post-72493">levenshtein distance</a></div>
    <div class="body">Here's a small christmas present, it's a fast procedure to calculate the levenshtein distance of two strings. I'm sure it can be optimized further, I optimized it for Athlon processors.<br /><br /><strong>What's the levenshtein distance?</strong><br /><br />The levenshtein distance (sometimes called edit distance) of two strings is the minimum number of character deletions, insertions or substitutions required to transform the first string into the second.<br />For example, the distance of 'asm' 'masm' is 1, since inserting 'm' is enough to make masm from asm. lev('mov', 'xor') is 2, since the middle character is already the same so only 2 characters need to be substituded.<br /><br /><a target="_blank" href="http://www.merriampark.com/ld.htm">more info..</a><br /><br /><strong>How do you calculate it?</strong><br />The algorithm is not hard but requires quite some computation (O(n*m)). Taken from the above link:<br /><br /><em>Step 1</em><br />Set n to be the length of s.<br />Set m to be the length of t.<br />If n = 0, return m and exit.<br />If m = 0, return n and exit.<br />Construct a matrix containing 0..m rows and 0..n columns.  <br /><br /><em>Step 2</em><br />Initialize the first row to 0..n.<br />Initialize the first column to 0..m.<br /><br /><em>Step 3</em><br />Examine each character of s (i from 1 to n). <br /><br /><em>Step 4</em><br />Examine each character of t (j from 1 to m). <br /><br /><em>Step 5</em><br />If s<em> equals t, the cost is 0.<br />If s<em> doesn't equal t, the cost is 1. <br /><br /><em>Step 6</em><br />Set cell d<em> of the matrix equal to the minimum of:<br />a. The cell immediately above plus 1: d<em> + 1.<br />b. The cell immediately to the left plus 1: d<em> + 1.<br />c. The cell diagonally above and to the left plus the cost: d<em> + cost.<br /> <br /><em>Step 7</em><br />After the iteration steps (3, 4, 5, 6) are complete, the distance is found in cell d.<br /><br /><strong>The test suite</strong><br />In the attachment you will find a C++ program containing 4 C++ implementations of the algorithm (written by me), and the assembly implementation I created. The program tests each procedure 10,000 times and shows the number of msecs it took. It does tests with various strings and string sizes.<br /><br /><strong>The 5 versions</strong><br /><em>STL safe &amp; simple</em><br />Uses a two dimensional (nested) std::vector from the Standard Template Library to store the matrix values. The memory use is (m+1)*(n+1) integers for the matrix. This version is the 'cleanest C++ way' to implement the algorithm. It's also the slowest :) This is probably mostly because of the memory allocation that is done by vector.<br /><br /><em>STL optimized version</em><br />Although the description of the algorithm says you should have a matrix, this isn't really necessary. Each iteration for one row is only dependent on the previous row. So instead of a matrix, a 'previous' and 'current' row can be used. This only uses (m+1) * 2 integers of memroy, which is far less than (m+1)*(n+1). This version is still relatively clean, it uses a vector but only two rows and offsets to the current &amp; previous part (which are swapped before the next row)<br /><br /><em>2 dimensional array</em><br />The same as 'STL safe &amp; simple', but using a local array on the stack. This saves the memory allocation but uses quite some stack space ((m+1)*(n+1) integers)).<br /><br /><em>2 row array</em><br />The same as 'STL optimized version', but again with a local array and pointers to the previous and current row. The stack usage is now okay, it's also the fastest C implementation most of the time.<br /><br /><em>Asm version</em><br />The assembly version is almost the same as '2 row array', but of course hand optimized and with it's inner loop unrolled once. It's probably a bit hard to read, I'll explain it in a later post. I optimized it for my own Atlhon processor.<br /><br /><strong>Note</strong><br />The string length is limited to a maximum of 255 characters for both strings, so a fixed stack array could be used. Longer strings would take too much time anyway.<br /><br /><strong>The test</strong><br />Here are the test results for an Athlon XP 2100+. Each function is executed 10,000 times.<br /><pre><code>&#91;size=9&#93;&#91;COLOR=darkblue&#93;<br />-----------------------------------------------------<br />String1&#58;  100 characters<br />String2&#58;  100 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 2714 msecs<br />STL optimized verison . . . . . 1683 msecs<br />2 dimensional array . . . . . . 1852 msecs<br />2 row array . . . . . . . . . . 1773 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 651 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  6 characters<br />Distance&#58; 1<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 60 msecs<br />STL optimized verison . . . . . 10 msecs<br />2 dimensional array . . . . . . 20 msecs<br />2 row array . . . . . . . . . . 10 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 0 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  7 characters<br />Distance&#58; 7<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 70 msecs<br />STL optimized verison . . . . . 10 msecs<br />2 dimensional array . . . . . . 20 msecs<br />2 row array . . . . . . . . . . 0 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 10 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  52 characters<br />String2&#58;  82 characters<br />Distance&#58; 56<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 1312 msecs<br />STL optimized verison . . . . . 721 msecs<br />2 dimensional array . . . . . . 761 msecs<br />2 row array . . . . . . . . . . 721 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 281 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 220<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 27129 msecs<br />STL optimized verison . . . . . 9443 msecs<br />2 dimensional array . . . . . . 9934 msecs<br />2 row array . . . . . . . . . . 9774 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 4146 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  1 characters<br />Distance&#58; 254<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 2224 msecs<br />STL optimized verison . . . . . 60 msecs<br />2 dimensional array . . . . . . 130 msecs<br />2 row array . . . . . . . . . . 70 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 30 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 26448 msecs<br />STL optimized verison . . . . . 10035 msecs<br />2 dimensional array . . . . . . 12047 msecs<br />2 row array . . . . . . . . . . 10986 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 4096 msecs<br />-----------------------------------------------------<br />&#91;/COLOR&#93; &#91;/SIZE&#93;</code></pre><br />Thomas</div>
    <div class="meta">Posted on 2002-12-24 08:09:40 by Thomas</div>
   </div>
   <div class="post" id="post-72496">
    <div class="subject"><a href="#post-72496">Short explanation of the code</a></div>
    <div class="body"><pre><code>&#91;size=12&#93;<br />&#91;COLOR=seagreen&#93;All the parameters and local vars are accessed directly <br />using esp as index register &#40;floating stack pointer&#41;, this frees ebp so it can<br /> be used as a general purpose register.&#91;/COLOR&#93; <br /><br />&#91;COLOR=seagreen&#93;'d' is the array that can hold the current and previous row of the matrix.<br />It's size is 2*256 integers &#40;2*&#40;max_m+1&#41;&#41;. 64 bytes &#40;64/4 dwords&#41; are added as padding so the array can<br />be aligned to a 64 byte boundary later.<br />&#91;b&#93;note&#58;&#91;/b&#93; Each row is stored in reversed order. That is, curRow&#91;i&#93; is stored in curRow&#91;m - i&#93;.<br />This allowed some optimizations in the code but can be quite confusing as well&#91;/COLOR&#93; <br />d           textequ &lt;esp+stk_c+0000h&gt;       ; int d&#91;2*256+64/4&#93; = 840h bytes<br /><br />&#91;COLOR=seagreen&#93;curRow is a pointer to the 'current row' part in d.&#91;/COLOR&#93; <br />curRow      textequ &lt;esp+stk_c+0840h&gt;       ; int *curRow = 4 bytes<br />tmp_ecx     textequ &lt;esp+stk_c+0844h&gt;       <br />tmp_esi     textequ &lt;esp+stk_c+0848h&gt;<br /><br />STACK_LOCAL_SIZE = 84Ch     ; local vars size<br /><br />param_s     textequ &lt;esp+stk_c+STACK_LOCAL_SIZE+04&gt; &#91;COLOR=seagreen&#93;; string 1&#91;/COLOR&#93; <br />param_t     textequ &lt;esp+stk_c+STACK_LOCAL_SIZE+08&gt;&#91;COLOR=seagreen&#93;; string 2&#91;/COLOR&#93; <br />param_n     textequ &lt;esp+stk_c+STACK_LOCAL_SIZE+12&gt;&#91;COLOR=seagreen&#93;; length string 1&#91;/COLOR&#93; <br />param_m     textequ &lt;esp+stk_c+STACK_LOCAL_SIZE+16&gt;&#91;COLOR=seagreen&#93;; length string 2&#91;/COLOR&#93; <br /><br />stk_c = 0                   ; stack correction<br /><br />levAsm proc C<br />    ;sub        esp, STACK_LOCAL_SIZE<br />    ;sub        esp, 4 * 4<br />    <br />    ;push ebx, ebp, esi, edi<br />    sub     esp, STACK_LOCAL_SIZE + 4 * 4<br />    mov     &#91;esp&#93;&#91;00&#93;, edi<br />    mov     &#91;esp&#93;&#91;04&#93;, esi<br />    mov     &#91;esp&#93;&#91;08&#93;, ebp<br />    mov     &#91;esp&#93;&#91;12&#93;, ebx<br />    stk_c = stk_c + 4 * 4<br />    <br />    mov     esi, &#91;param_s&#93;      ; esi = s<br />    mov     edi, &#91;param_t&#93;      ; edi = t<br /><br />    ; align data array on 64 byte boundary<br />    lea     eax, &#91;d&#93;<br />    add     eax, 62<br />    and     eax, NOT 63<br />    <br />&#91;COLOR=seagreen&#93;Instead of a local var, ebx is used as 'prevRow' pointer, <br />pointing to the 'previous row' part in d&#91;/COLOR&#93; <br />    mov     ebx, eax    ; ebx = prevRow<br />    add     eax, 256 * 4<br />    mov     &#91;curRow&#93;, eax<br /><br />&#91;COLOR=seagreen&#93;Check size boundaries&#91;/COLOR&#93; <br />    ; check n==0<br />    mov     eax, &#91;param_n&#93;<br />    test    eax, eax<br />    jz      _retM<br />    cmp     eax, 255<br />    ja      _invalid<br />    <br />    ; check m==0<br />    mov     eax, &#91;param_m&#93;<br />    test    eax, eax<br />    jz      _retN<br />    cmp     eax, 255<br />    ja      _invalid<br /><br />&#91;COLOR=seagreen&#93;Initialize the previous row with 0 ... m&#91;/COLOR&#93; <br />;   for &#40;j=0;j&lt;=m;j++&#41;<br />;     prevRow&#91;j&#93; = j;<br />    mov     eax, ebx<br />    mov     ecx, &#91;param_m&#93;<br />_fillPrev&#58;<br />    mov     &#91;eax&#93;, ecx<br />    add     eax, 4<br />    dec     ecx<br />    jns     _fillPrev<br /><br />&#91;COLOR=seagreen&#93;This outer loop iterates through all the rows in the matrix. <br />ecx serves as 'i'.&#91;/COLOR&#93; <br />;   for &#40;i=1;i&lt;=n;i++&#41;<br />    mov     ecx, 1<br />    align 16<br />_for_i&#58;<br />&#91;COLOR=seagreen&#93;ebp is used to hold the previous result of the inner loop,<br />which is then used to calucalate the 'left' value of the next iteration.<br />&#91;/COLOR&#93; <br />        mov     eax, &#91;curRow&#93;<br />        mov     edx, &#91;param_m&#93;<br />        mov     ebp, ecx ; ebp = initial left - 1<br />        mov     &#91;tmp_ecx&#93;, ecx<br />&#91;COLOR=seagreen&#93;Since not all rows are available at the same time, their first columns<br />cannot be initialized with 0...n. This is now done before the current row is used <br />&#40;curRow&#91;0&#93; = i, i is the current row number&#41;.&#91;/COLOR&#93; <br />        mov     &#91;eax + 4 * edx&#93;, ecx    ; curRow&#91;0&#93; = i<br />        mov     edi, &#91;param_t&#93;  ; edi = t<br /><br />&#91;COLOR=seagreen&#93;The inner loop uses edx as j and is unrolled once.&#91;/COLOR&#93; <br />;       for&#40;j=1;j&lt;=m;j++&#41;<br />;       &#123;<br />        movzx   eax, byte ptr &#91;esi&#93;<br />        mov     &#91;tmp_esi&#93;, esi<br />        <br />&#91;COLOR=seagreen&#93;If less than 2 iterations, the unrolled loop has no use&#91;/COLOR&#93; <br />        cmp     edx, 2<br />        jb      _last_byte<br />        align 16<br />    _for_j&#58;<br />            xor     ecx, ecx<br />            inc     ebp         ; add 1 to previous result to get left.<br />            cmp     al, &#91;edi&#93;   ; s&#91;i-1&#93;==t&#91;j-1&#93; ?<br />            mov     esi, &#91;ebx&#93;&#91;4 * edx - 4&#93; ; esi = prevRow&#91;j&#93;<br />            cmovne  ecx, num1   ; cost&#40;ecx&#41; = 0 or 1<br />            <br />            inc     esi         ; esi = prevRow&#91;j&#93; + 1 = above<br />&#91;COLOR=seagreen&#93;esi = above value here&#91;/COLOR&#93; <br />            add     ecx, &#91;ebx&#93;&#91;4 * edx&#93; ; diagonal&#40;ecx&#41; = prevRow&#91;j-1&#93; + cost&#40;ecx&#41;<br />&#91;COLOR=seagreen&#93;ecx = diagonal value here&#91;/COLOR&#93;             <br /><br />            cmp     ecx, esi    ; diagonal &gt; above<br />            cmova   ecx, esi    ; ? min = above<br /><br />&#91;COLOR=seagreen&#93;ecx = min&#40;diagonal, above&#41;&#91;/COLOR&#93; <br /><br />            cmp     ecx, ebp        ; min &gt; left<br />            mov     esi, &#91;curRow&#93;   <br />            cmova   ecx, ebp        ; ? min = left<br />&#91;COLOR=seagreen&#93;ebp holds the 'left' value. ecx = min&#40;ecx, left&#41;&#91;/COLOR&#93; <br /><br />&#91;COLOR=seagreen&#93;Store result&#58;&#91;/COLOR&#93; <br />;           curRow&#91;j&#93; = min;<br />            mov     &#91;esi&#93;&#91;4 * edx - 4&#93;, ecx<br /><br />&#91;COLOR=seagreen&#93;In the second part of the unrolled loop,<br />the roles of ecx and ebp are switched &#40;ebp holds the minimum, ecx<br />holds the result of the previous iteration&#41;. The rest of the loop is the same, <br />except for different memory offsets.&#91;/COLOR&#93; <br />            ; --- second part of unrolled loop ---<br />            xor     ebp, ebp<br />            inc     ecx         ; add 1 to previous result to get left.<br />            cmp     al, &#91;edi+1&#93; ; s&#91;i-1&#93;==t&#91;j-1&#93; ?<br />            mov     esi, &#91;ebx&#93;&#91;4 * edx - 8&#93; ; esi = prevRow&#91;j&#93;<br />            cmovne  ebp, num1   ; cost&#40;ebp&#41; = 0 or 1<br />            <br />            inc     esi         ; esi = prevRow&#91;j&#93; + 1 = above<br />            add     ebp, &#91;ebx&#93;&#91;4 * edx - 4&#93; ; diagonal&#40;ebp&#41; = prevRow&#91;j-1&#93; + cost&#40;ebp&#41;<br />            <br />            cmp     ebp, esi    ; diagonal &gt; above<br />            cmova   ebp, esi    ; ? min = above<br />            <br />            cmp     ebp, ecx        ; min &gt; left<br />            mov     esi, &#91;curRow&#93;   <br />            cmova   ebp, ecx        ; ? min = left<br /><br />;           curRow&#91;j&#93; = min;<br />            mov     &#91;esi&#93;&#91;4 * edx - 8&#93;, ebp<br />;       &#125;<br />            sub     edx, 2<br />            add     edi, 2<br />&#91;COLOR=seagreen&#93;Store the result as the next left value - 1&#91;/COLOR&#93; <br />        ;   mov     ebp, ecx    ; next left is current result<br />&#91;COLOR=seagreen&#93;edx &gt; 2?&#91;/COLOR&#93; <br />        test    edx, NOT 1<br />        jnz     _for_j<br />        align 16<br /><br />&#91;COLOR=seagreen&#93;If m is not even, one iteration has yet to be done at the end of<br />the unrolled loop. Most of the array offsets can be hardcoded in this last iteration.&#91;/COLOR&#93; <br />    _last_byte&#58;<br />        test    edx, edx<br />        jz      _even_m<br />        ;---- last element ---<br />            xor     ecx, ecx<br />            inc     ebp         ; add 1 to previous result to get left.<br />            cmp     al, &#91;edi&#93;   ; s&#91;i-1&#93;==t&#91;j-1&#93; ?<br />            mov     esi, &#91;ebx&#93;  ; esi = prevRow&#91;j&#93;<br />            cmovne  ecx, num1   ; cost&#40;ecx&#41; = 0 or 1<br />            <br />            inc     esi         ; esi = prevRow&#91;j&#93; + 1 = above<br />;           int diagonal = prevRow&#91;j-1&#93; + cost<br />            add     ecx, &#91;ebx&#93;&#91;4&#93; ; diagonal&#40;ecx&#41; = prevRow&#91;j-1&#93; + cost&#40;ecx&#41;<br />            <br />            cmp     ecx, esi    ; diagonal &gt; above<br />            cmova   ecx, esi    ; ? min = above<br />            <br />;           int left = curRow&#91;j-1&#93; + 1;<br />            cmp     ecx, ebp        ; min &gt; left<br />            mov     esi, &#91;curRow&#93;   <br />            cmova   ecx, ebp        ; ? min = left<br /><br />;           curRow&#91;j&#93; = min;<br />            mov     &#91;esi&#93;, ecx<br /><br />        ;--- end last element<br />        _even_m&#58;<br />&#91;COLOR=seagreen&#93;Swap the current and previous rows..&#91;/COLOR&#93; <br />        mov     eax, &#91;curRow&#93;<br />        mov     esi, &#91;tmp_esi&#93;<br />        mov     &#91;curRow&#93;, ebx<br />        mov     ecx, &#91;tmp_ecx&#93;<br />        mov     ebx, eax<br />;   &#125;<br />    inc     esi<br />    inc     ecx<br />    cmp     ecx, &#91;param_n&#93;<br />    jbe     _for_i<br /><br />&#91;COLOR=seagreen&#93;The final result is in arr&#91;n&#93;&#91;m&#93;, <br />which is prevRow&#91;m&#93; in our case, = ebx&#91;m-m&#93; = ebx&#91;0&#93;. &#91;/COLOR&#93; <br />    mov     eax, &#91;ebx&#93; ; return prevRow&#91;param_m&#93;<br />    jmp     _return<br />    <br />_retN&#58;<br />    mov     eax, &#91;param_n&#93;<br />    jmp     _return<br />_retM&#58;<br />    mov     eax, &#91;param_m&#93;<br />    jmp     _return<br />_invalid&#58;<br />    mov     eax, -1<br />    jmp     _return<br />_return&#58;<br />    ; pop edi, esi, ebp, ebx<br />    mov     edi, &#91;esp&#93;&#91;00&#93;<br />    mov     esi, &#91;esp&#93;&#91;04&#93;<br />    mov     ebp, &#91;esp&#93;&#91;08&#93;<br />    mov     ebx, &#91;esp&#93;&#91;12&#93;<br />    ;add        esp, 4 * 4<br />    ;add        esp, STACK_LOCAL_SIZE<br />    add     esp, STACK_LOCAL_SIZE + 4 * 4<br />    ret<br />levAsm endp&#91;/size&#93;</code></pre><br />Thomas</div>
    <div class="meta">Posted on 2002-12-24 08:37:57 by Thomas</div>
   </div>
   <div class="post" id="post-72510">
    <div class="subject"><a href="#post-72510">levenshtein distance</a></div>
    <div class="body">hehheh...  perhaps you should post the timings into the &quot;crusades&quot; :grin:   that doesn't even factor in file sizes :tongue: <br /><br />now if only i could figure out WHY you'd need to use this function...  but it still seems cool :alright:<br /><br />edit:  oops...  i just read &quot;more info&quot;<br />:stupid:</div>
    <div class="meta">Posted on 2002-12-24 09:45:30 by jademtech</div>
   </div>
   <div class="post" id="post-72529">
    <div class="subject"><a href="#post-72529">levenshtein distance</a></div>
    <div class="body">Quick test result (with lots of other apps running in teh BG):<br />The &quot;Asm version (Thomas)&quot; rules... :)<br /><br />(I'll run it alone and add the result for my celeron 700 MHz in a minute...)<br /><br />conclusion: assembly is the language for speed and size. :)<br /><br />The results:<br /><pre><code>&#91;size=9&#93;-----------------------------------------------------<br />String1&#58;  100 characters<br />String2&#58;  100 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 5673 msecs<br />STL optimized verison . . . . . 2840 msecs<br />2 dimensional array . . . . . . 3260 msecs<br />2 row array . . . . . . . . . . 2970 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 1600 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  6 characters<br />Distance&#58; 1<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 110 msecs<br />STL optimized verison . . . . . 20 msecs<br />2 dimensional array . . . . . . 85 msecs<br />2 row array . . . . . . . . . . 21 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 4 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  7 characters<br />Distance&#58; 7<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 105 msecs<br />STL optimized verison . . . . . 20 msecs<br />2 dimensional array . . . . . . 80 msecs<br />2 row array . . . . . . . . . . 11 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 9 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  52 characters<br />String2&#58;  82 characters<br />Distance&#58; 56<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 2405 msecs<br />STL optimized verison . . . . . 1381 msecs<br />2 dimensional array . . . . . . 1319 msecs<br />2 row array . . . . . . . . . . 1410 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 690 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 220<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 70545 msecs<br />STL optimized verison . . . . . 18000 msecs<br />2 dimensional array . . . . . . 24005 msecs<br />2 row array . . . . . . . . . . 18870 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 10120 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  1 characters<br />Distance&#58; 254<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 2775 msecs<br />STL optimized verison . . . . . 131 msecs<br />2 dimensional array . . . . . . 974 msecs<br />2 row array . . . . . . . . . . 125 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 80 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 67979 msecs<br />STL optimized verison . . . . . 16500 msecs<br />2 dimensional array . . . . . . 20930 msecs<br />2 row array . . . . . . . . . . 17629 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 10120 msecs<br />-----------------------------------------------------<br />&#91;/size&#93;</code></pre></div>
    <div class="meta">Posted on 2002-12-24 11:15:07 by scientica</div>
   </div>
   <div class="post" id="post-72530">
    <div class="subject"><a href="#post-72530">levenshtein distance</a></div>
    <div class="body">Wonderful <strong>Thomas</strong> - another routine for the string library...<br />Merry Christmas, and thank you.</div>
    <div class="meta">Posted on 2002-12-24 11:26:51 by bitRAKE</div>
   </div>
   <div class="post" id="post-72542">
    <div class="subject"><a href="#post-72542">levenshtein distance</a></div>
    <div class="body">Very nice Thomas,<br />Results on my 2.0GHz Pentium 4<br /><pre><code><br />-----------------------------------------------------<br />String1&#58;  100 characters<br />String2&#58;  100 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 2053 msecs<br />STL optimized verison . . . . . 961 msecs<br />2 dimensional array . . . . . . 1002 msecs<br />2 row array . . . . . . . . . . 1061 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 601 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  6 characters<br />Distance&#58; 1<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 70 msecs<br />STL optimized verison . . . . . 10 msecs<br />2 dimensional array . . . . . . 10 msecs<br />2 row array . . . . . . . . . . 10 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 0 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  7 characters<br />Distance&#58; 7<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 70 msecs<br />STL optimized verison . . . . . 10 msecs<br />2 dimensional array . . . . . . 10 msecs<br />2 row array . . . . . . . . . . 10 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 0 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  52 characters<br />String2&#58;  82 characters<br />Distance&#58; 56<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 1022 msecs<br />STL optimized verison . . . . . 471 msecs<br />2 dimensional array . . . . . . 500 msecs<br />2 row array . . . . . . . . . . 531 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 250 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 220<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 17526 msecs<br />STL optimized verison . . . . . 6108 msecs<br />2 dimensional array . . . . . . 6289 msecs<br />2 row array . . . . . . . . . . 6730 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 3846 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  1 characters<br />Distance&#58; 254<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 2543 msecs<br />STL optimized verison . . . . . 40 msecs<br />2 dimensional array . . . . . . 70 msecs<br />2 row array . . . . . . . . . . 40 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 41 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 16954 msecs<br />STL optimized verison . . . . . 5448 msecs<br />2 dimensional array . . . . . . 5598 msecs<br />2 row array . . . . . . . . . . 6259 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 3845 msecs<br />-----------------------------------------------------<br /></code></pre></div>
    <div class="meta">Posted on 2002-12-24 13:32:12 by anon</div>
   </div>
   <div class="post" id="post-72566">
    <div class="subject"><a href="#post-72566">levenshtein distance</a></div>
    <div class="body">Intel Compiler version 7.0 results (on 1.333Ghz Athlon TB):<pre><code>-----------------------------------------------------<br />String1&#58;  100 characters<br />String2&#58;  100 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 3215 msecs<br />STL optimized verison . . . . . 1772 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 1012 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 600 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  6 characters<br />Distance&#58; 1<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 61 msecs<br />STL optimized verison . . . . . 10 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 10 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 0 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  7 characters<br />Distance&#58; 7<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 50 msecs<br />STL optimized verison . . . . . 20 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 0 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 0 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  52 characters<br />String2&#58;  82 characters<br />Distance&#58; 56<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 1512 msecs<br />STL optimized verison . . . . . 831 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 501 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 260 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 220<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 31395 msecs<br />STL optimized verison . . . . . 11947 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 7191 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 3865 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  1 characters<br />Distance&#58; 254<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 1733 msecs<br />STL optimized verison . . . . . 70 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 40 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 30 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 30053 msecs<br />STL optimized verison . . . . . 10986 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 6059 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 3885 msecs<br />-----------------------------------------------------</code></pre>I'm looking at the &quot;2 dimensional array&quot; generated code - the timing doesn't look right...<br /><br />Attached EXE optimized for P2/P3 MMX:</div>
    <div class="meta">Posted on 2002-12-24 16:40:30 by bitRAKE</div>
   </div>
   <div class="post" id="post-72916">
    <div class="subject"><a href="#post-72916">levenshtein distance</a></div>
    <div class="body">This algorithm can be done with a single row array and the inner loop should have no branches and everything in registers.  The Intel generated code is good, but no where near optimal.  I'll post my version after some testing...</div>
    <div class="meta">Posted on 2002-12-27 15:18:03 by bitRAKE</div>
   </div>
   <div class="post" id="post-72932">
    <div class="subject"><a href="#post-72932">levenshtein distance</a></div>
    <div class="body"><strong>bitRAKE</strong>: that would be great, I'm looking forward to see your code.<br />I'll figure out why the 2 dim. array C version always runs in 0 msecs in your test, seems to be way too fast :).<br /><br /><strong>all:</strong> Thanks for testing!<br /><br />Thomas</div>
    <div class="meta">Posted on 2002-12-27 17:56:54 by Thomas</div>
   </div>
   <div class="post" id="post-74060">
    <div class="subject"><a href="#post-74060">levenshtein distance</a></div>
    <div class="body">Sorry it is taking so long - I haven't forgotten...:tongue:</div>
    <div class="meta">Posted on 2003-01-02 16:51:36 by bitRAKE</div>
   </div>
   <div class="post" id="post-74112">
    <div class="subject"><a href="#post-74112">levenshtein distance</a></div>
    <div class="body">It hangs up in thomas method in my pentium 200.<br />i guess those cmova.<br /><br />so, i prefer 2 row array, its slower but more compatible.</div>
    <div class="meta">Posted on 2003-01-03 01:06:45 by r00t</div>
   </div>
   <div class="post" id="post-113252">
    <div class="subject"><a href="#post-113252">levenshtein distance</a></div>
    <div class="body"><div class="quote"><br />Sorry it is taking so long - I haven't forgotten...:tongue: </div><br /><br />It appears you have ;)<br /><br /><em>..rocking the boat as usual..</em> :alright:<br /><br />NaN</div>
    <div class="meta">Posted on 2003-08-06 16:13:27 by NaN</div>
   </div>
   <div class="post" id="post-113383">
    <div class="subject"><a href="#post-113383">levenshtein distance</a></div>
    <div class="body">I was going to wait until the one year aniversary. :grin:<br /><br />It really can be done as I've said above - I've worked it out on paper - just haven't gotten around to converting it to code.</div>
    <div class="meta">Posted on 2003-08-07 16:41:45 by bitRAKE</div>
   </div>
   <div class="post" id="post-113387">
    <div class="subject"><a href="#post-113387">levenshtein distance</a></div>
    <div class="body">The paper to look at is <a target="_blank" href="http://www.cs.arizona.edu/people/gene/PAPERS/linear.ps">optimal alignments in linear space</a>. Particularly figure 1B. If you don't want to recreate the path then that's all you need. If you do I'd recommend <strong>NOT</strong> using the linear space version &amp; using an NxM backtrace matrix unless the sequences are huge because the matrix version is about twice as fast.<br /><br /><br />The figure lays out in pseudo-code a 1 x N array method. Getting the north, northeast, east cells all dancing right is a pain but worth the effort if speed is the issue.<br /></div>
    <div class="meta">Posted on 2003-08-07 17:24:08 by twisteddweeb</div>
   </div>
   <div class="post" id="post-113391">
    <div class="subject"><a href="#post-113391">levenshtein distance</a></div>
    <div class="body">Figure I'd post my results:<br /><br /><pre><code><br />G&#58;\Release&gt;levenshtein<br />-- ---------------------------------------------------<br />String1&#58;  100 characters<br />String2&#58;  100 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 1657 msecs<br />STL optimized verison . . . . . 765 msecs<br />2 dimensional array . . . . . . 813 msecs<br />2 row array . . . . . . . . . . 782 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 500 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  6 characters<br />Distance&#58; 1<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 62 msecs<br />STL optimized verison . . . . . 16 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 15 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 0 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  7 characters<br />Distance&#58; 7<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 63 msecs<br />STL optimized verison . . . . . 0 msecs<br />2 dimensional array . . . . . . 16 msecs<br />2 row array . . . . . . . . . . 0 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 0 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  52 characters<br />String2&#58;  82 characters<br />Distance&#58; 56<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 828 msecs<br />STL optimized verison . . . . . 391 msecs<br />2 dimensional array . . . . . . 406 msecs<br />2 row array . . . . . . . . . . 391 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 203 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 220<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 13656 msecs<br />STL optimized verison . . . . . 4906 msecs<br />2 dimensional array . . . . . . 5031 msecs<br />2 row array . . . . . . . . . . 5250 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 3172 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  1 characters<br />Distance&#58; 254<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 1875 msecs<br />STL optimized verison . . . . . 31 msecs<br />2 dimensional array . . . . . . 63 msecs<br />2 row array . . . . . . . . . . 31 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 31 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 13188 msecs<br />STL optimized verison . . . . . 4391 msecs<br />2 dimensional array . . . . . . 4500 msecs<br />2 row array . . . . . . . . . . 4531 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 3172 msecs<br />-----------------------------------------------------<br /></code></pre><br /><br />just noticed bitrakes optimized version:<br /><pre><code><br />-----------------------------------------------------<br />String1&#58;  100 characters<br />String2&#58;  100 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 1657 msecs<br />STL optimized verison . . . . . 765 msecs<br />2 dimensional array . . . . . . 813 msecs<br />2 row array . . . . . . . . . . 782 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 500 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  6 characters<br />Distance&#58; 1<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 62 msecs<br />STL optimized verison . . . . . 16 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 15 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 0 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  7 characters<br />Distance&#58; 7<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 63 msecs<br />STL optimized verison . . . . . 0 msecs<br />2 dimensional array . . . . . . 16 msecs<br />2 row array . . . . . . . . . . 0 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 0 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  52 characters<br />String2&#58;  82 characters<br />Distance&#58; 56<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 828 msecs<br />STL optimized verison . . . . . 391 msecs<br />2 dimensional array . . . . . . 406 msecs<br />2 row array . . . . . . . . . . 391 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 203 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 220<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 13656 msecs<br />STL optimized verison . . . . . 4906 msecs<br />2 dimensional array . . . . . . 5031 msecs<br />2 row array . . . . . . . . . . 5250 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 3172 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  1 characters<br />Distance&#58; 254<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 1875 msecs<br />STL optimized verison . . . . . 31 msecs<br />2 dimensional array . . . . . . 63 msecs<br />2 row array . . . . . . . . . . 31 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 31 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 13188 msecs<br />STL optimized verison . . . . . 4391 msecs<br />2 dimensional array . . . . . . 4500 msecs<br />2 row array . . . . . . . . . . 4531 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 3172 msecs<br />-----------------------------------------------------<br /><br /><br />G&#58;\Release&gt;levenshtein<br />-----------------------------------------------------<br />String1&#58;  100 characters<br />String2&#58;  100 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 1844 msecs<br />STL optimized verison . . . . . 844 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 609 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 735 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  6 characters<br />Distance&#58; 1<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 47 msecs<br />STL optimized verison . . . . . 0 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 15 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 0 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  6 characters<br />String2&#58;  7 characters<br />Distance&#58; 7<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 47 msecs<br />STL optimized verison . . . . . 16 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 0 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 0 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  52 characters<br />String2&#58;  82 characters<br />Distance&#58; 56<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 922 msecs<br />STL optimized verison . . . . . 437 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 328 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 313 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 220<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 15172 msecs<br />STL optimized verison . . . . . 5859 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 4531 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 3656 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  1 characters<br />Distance&#58; 254<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 1484 msecs<br />STL optimized verison . . . . . 31 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 16 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 31 msecs<br />-----------------------------------------------------<br /><br />-----------------------------------------------------<br />String1&#58;  255 characters<br />String2&#58;  255 characters<br />Distance&#58; 0<br />-----------------------------------------------------<br />STL safe &amp; simple . . . . . . . 14469 msecs<br />STL optimized verison . . . . . 4859 msecs<br />2 dimensional array . . . . . . 0 msecs<br />2 row array . . . . . . . . . . 3407 msecs<br />Asm version &#40;Thomas&#41;. . . . . . 3671 msecs<br />-----------------------------------------------------<br /></code></pre></div>
    <div class="meta">Posted on 2003-08-07 18:50:18 by Gunner</div>
   </div>
  </div>
 </body>
</html>