<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Another Static to Hyperlink: - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13575" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=13575">Another Static to Hyperlink:</a></p>
   <div class="post" id="post-105183">
    <div class="subject"><a href="#post-105183">Another Static to Hyperlink:</a></div>
    <div class="body">This code is hard to read, requires some macros, and shouldn't be used by anyone:<pre><code>	OPTION PROLOGUE&#58;NONE<br />	OPTION EPILOGUE&#58;NONE<br /><br />; loosely based on&#58;  &#91;url&#93;http&#58;//www.codeguru.com/staticctrl/st2ahl.html&#91;/url&#93;<br /><br />	PROP_ORIGINAL_FONT	EQU &lt;_T&#40;&quot;_Hyperlink_Original_Font_&quot;&#41;&gt;<br />	PROP_ORIGINAL_PROC	EQU &lt;_T&#40;&quot;_Hyperlink_Original_Proc_&quot;&#41;&gt;<br />	PROP_UNDERLINE_FONT	EQU &lt;_T&#40;&quot;_Hyperlink_Underline_Font_&quot;&#41;&gt;<br /><br /><br />_HyperlinkParentProc PROC hWnd&#58;DWORD, uMsg&#58;DWORD, wParam&#58;DWORD, lParam&#58;DWORD<br />	thisPROC_hWnd	TEXTEQU &lt;&#91;esp+4*1&#93;&gt;<br />	thisPROC_uMsg	TEXTEQU &lt;&#91;esp+4*2&#93;&gt;<br />	thisPROC_wParam	TEXTEQU &lt;&#91;esp+4*3&#93;&gt;<br />	thisPROC_lParam	TEXTEQU &lt;&#91;esp+4*4&#93;&gt;<br /><br />	invoke	GetProp, thisPROC_hWnd&#91;4&#93;, PROP_ORIGINAL_PROC<br />	mov	ecx, thisPROC_uMsg<br />	pop	edx<br />	push	eax<br />	cmp	ecx, WM_CTLCOLORSTATIC<br />	push	edx	; return address<br />	je	__WM_CTLCOLORSTATIC<br />	cmp	ecx, WM_DESTROY<br />	je	__WM_DESTROY<br />	jmp	CallWindowProc<br /><br />	; another dword on the stack<br />	thisPROC_old	TEXTEQU &lt;&#91;4&#93;&#91;esp+4*0&#93;&gt;<br />	thisPROC_hWnd	TEXTEQU &lt;&#91;4&#93;&#91;esp+4*1&#93;&gt;<br />	thisPROC_uMsg	TEXTEQU &lt;&#91;4&#93;&#91;esp+4*2&#93;&gt;<br />	thisPROC_wParam	TEXTEQU &lt;&#91;4&#93;&#91;esp+4*3&#93;&gt;<br />	thisPROC_lParam	TEXTEQU &lt;&#91;4&#93;&#91;esp+4*4&#93;&gt;<br /><br />__WM_DESTROY&#58;<br />	invoke	SetWindowLong, thisPROC_hWnd&#91;8&#93;, GWL_WNDPROC, eax<br />	invoke	RemoveProp, thisPROC_hWnd&#91;4&#93;, PROP_ORIGINAL_PROC<br />  _x&#58;	jmp	CallWindowProc<br /><br /><br />__WM_CTLCOLORSTATIC&#58;<br />	; why would another control have this property?<br />	invoke	GetProp, thisPROC_lParam&#91;4&#93;, PROP_ORIGINAL_PROC<br />	test	eax, eax<br />	je	_x<br />	invoke	CallWindowProc, thisPROC_old&#91;16&#93;, thisPROC_hWnd&#91;12&#93;, thisPROC_uMsg&#91;8&#93;, thisPROC_wParam&#91;4&#93;, thisPROC_lParam<br />	mov	&#91;esp+4&#93;, eax<br />	invoke	SetTextColor, thisPROC_wParam&#91;4&#93;, CONST_RGB&#40;0,0,192&#41;<br />	mov	eax, &#91;esp+4&#93;<br />	retn 20<br /><br />_HyperlinkParentProc ENDP<br /><br /><br /><br />_HyperlinkProc PROC hWnd&#58;DWORD, uMsg&#58;DWORD, wParam&#58;DWORD, lParam&#58;DWORD<br />	thisPROC_hWnd	TEXTEQU &lt;&#91;esp+4*1&#93;&gt;<br />	thisPROC_uMsg	TEXTEQU &lt;&#91;esp+4*2&#93;&gt;<br />	thisPROC_wParam	TEXTEQU &lt;&#91;esp+4*3&#93;&gt;<br />	thisPROC_lParam	TEXTEQU &lt;&#91;esp+4*4&#93;&gt;<br /><br />	invoke	GetProp, thisPROC_hWnd&#91;4&#93;, PROP_ORIGINAL_PROC<br />	mov	ecx, thisPROC_uMsg<br />	pop	edx<br />	push	eax<br />	cmp	ecx, WM_MOUSEMOVE<br />	push	edx	; return address<br />	je	__WM_MOUSEMOVE<br />	cmp	ecx, WM_SETCURSOR<br />	je	__WM_SETCURSOR<br />	cmp	ecx, WM_DESTROY<br />	je	__WM_DESTROY<br />	jmp	CallWindowProc<br /><br />	; another dword on the stack<br />	thisPROC_old	TEXTEQU &lt;&#91;4&#93;&#91;esp+4*0&#93;&gt;<br />	thisPROC_hWnd	TEXTEQU &lt;&#91;4&#93;&#91;esp+4*1&#93;&gt;<br />	thisPROC_uMsg	TEXTEQU &lt;&#91;4&#93;&#91;esp+4*2&#93;&gt;<br />	thisPROC_wParam	TEXTEQU &lt;&#91;4&#93;&#91;esp+4*3&#93;&gt;<br />	thisPROC_lParam	TEXTEQU &lt;&#91;4&#93;&#91;esp+4*4&#93;&gt;<br /><br />__WM_DESTROY&#58;<br />	invoke	SetWindowLong, thisPROC_hWnd&#91;8&#93;, GWL_WNDPROC, eax<br />	invoke	RemoveProp, thisPROC_hWnd&#91;4&#93;, PROP_ORIGINAL_PROC<br /><br />	invoke	GetProp, thisPROC_hWnd&#91;4&#93;, PROP_ORIGINAL_FONT<br />	invoke	SendMessage, thisPROC_hWnd&#91;12&#93;, WM_SETFONT, eax, 0<br />	invoke	RemoveProp, thisPROC_hWnd&#91;4&#93;, PROP_ORIGINAL_FONT<br /><br />	invoke	GetProp, thisPROC_hWnd&#91;4&#93;, PROP_UNDERLINE_FONT<br />	invoke	DeleteObject, eax<br />	invoke	RemoveProp, thisPROC_hWnd&#91;4&#93;, PROP_UNDERLINE_FONT<br />	jmp	CallWindowProc<br /><br /><br />__WM_MOUSEMOVE&#58;<br />	invoke	GetCapture<br />	cmp	eax, thisPROC_hWnd<br />	jne	_start_capture<br /><br />  	sub	esp, SIZEOF RECT<br />	invoke	GetWindowRect, thisPROC_hWnd&#91;4 + SIZEOF RECT&#93;, esp<br />	movsx	eax, WORD PTR thisPROC_lParam&#91;2 + SIZEOF RECT&#93;<br />	movsx	edx, WORD PTR thisPROC_lParam&#91;0 + SIZEOF RECT&#93;<br />	push	eax	; y<br />	push	edx	; x<br />	invoke	ClientToScreen, thisPROC_hWnd&#91;4 + SIZEOF RECT + SIZEOF POINT&#93;, esp<br />	; &#40;x, y&#41; already on stack<br />	push	esp<br />	add	DWORD PTR &#91;esp&#93;, SIZEOF POINT<br />	call	PtInRect<br /><br />	test	eax, eax<br />	lea	esp, &#91;esp + SIZEOF RECT&#93;<br />	jne	_x<br />	invoke	GetProp, thisPROC_hWnd&#91;4&#93;, PROP_ORIGINAL_FONT<br />	invoke	SendMessage, thisPROC_hWnd&#91;12&#93;, WM_SETFONT, eax, FALSE<br />	invoke	InvalidateRect, thisPROC_hWnd&#91;8&#93;, NULL, FALSE<br />	invoke	ReleaseCapture<br />  _x&#58;	jmp	CallWindowProc<br /><br />  _start_capture&#58;<br />	invoke	GetProp, thisPROC_hWnd&#91;4&#93;, PROP_UNDERLINE_FONT<br />	invoke	SendMessage, thisPROC_hWnd&#91;12&#93;, WM_SETFONT, eax, FALSE<br />	invoke	InvalidateRect, thisPROC_hWnd&#91;8&#93;, NULL, FALSE<br />	invoke	SetCapture, thisPROC_hWnd<br />	jmp	CallWindowProc<br /><br /><br />__WM_SETCURSOR&#58;<br />	; Since IDC_HAND is not available on all operating systems,<br />	; we will load the arrow cursor if IDC_HAND is not present.<br />	mov	edx, IDC_HAND<br />  @@&#58;	invoke	LoadCursor, NULL, edx<br />	test	eax, eax<br />	mov	edx, IDC_ARROW<br />	je	@B<br />	invoke	SetCursor, eax<br />	mov	eax, TRUE<br />	ret	5*4<br /><br />_HyperlinkProc ENDP<br /><br /><br /><br />	OPTION PROLOGUE&#58;PROLOGUEDEF<br />	OPTION EPILOGUE&#58;EPILOGUEDEF<br /><br /><br />ConvertStaticToHyperlink PROC hwndParent&#58;DWORD, uiCtlId&#58;DWORD<br /><br />	invoke GetDlgItem, hwndParent, uiCtlId<br />	mov	uiCtlId, eax ; need handle, not Id<br /><br />	; Subclass the parent so we can color the controls as we desire<br />	cmp	hwndParent, NULL<br />	je	@F<br />	invoke	GetWindowLong, hwndParent, GWL_WNDPROC<br />	cmp	eax, OFFSET _HyperlinkParentProc<br />	je	@F<br />	invoke	SetProp, hwndParent, PROP_ORIGINAL_PROC, eax<br />	invoke	SetWindowLong, hwndParent, GWL_WNDPROC, OFFSET _HyperlinkParentProc<br />@@&#58;<br />	; Make sure the control will send notifications<br /><br />	invoke	GetWindowLong, uiCtlId, GWL_STYLE<br />	or	eax, SS_NOTIFY<br />	invoke	SetWindowLong, uiCtlId, GWL_STYLE, eax<br /><br />	; Subclass the existing control<br /><br />	invoke	GetWindowLong, uiCtlId, GWL_WNDPROC<br />	invoke	SetProp, uiCtlId, PROP_ORIGINAL_PROC, eax<br />	invoke	SetWindowLong, uiCtlId, GWL_WNDPROC, OFFSET _HyperlinkProc<br /><br />	; Create an updated font by adding an underline<br /><br />	invoke	SendMessage, uiCtlId, WM_GETFONT, 0, 0<br />	push	eax<br />	invoke	SetProp, uiCtlId, PROP_ORIGINAL_FONT, eax<br />	pop	edx<br />	sub	esp, SIZEOF LOGFONT<br />	invoke	GetObject, edx, SIZEOF LOGFONT, esp<br />	mov	&#91;esp&#93;.LOGFONT.lfUnderline, TRUE<br /><br />	invoke	CreateFontIndirect, esp<br />	invoke	SetProp, uiCtlId, PROP_UNDERLINE_FONT, eax<br />	add	esp, SIZEOF LOGFONT<br /><br />	mov	eax, TRUE<br />	ret<br />ConvertStaticToHyperlink ENDP</code></pre>...but if you change your mind, try this:<pre><code>__WM_INITDIALOG&#58;<br />	invoke	ConvertStaticToHyperlink, DlgPROC_hWnd&#91;4&#93;, IDC_STC_web</code></pre>Yeah, it worked for me once. :)<br /><br /><span style="font-size:9px>(2003may29) Edit: small update...</span></div>
    <div class="meta">Posted on 2003-05-28 23:40:25 by bitRAKE</div>
   </div>
   <div class="post" id="post-105222">
    <div class="subject"><a href="#post-105222">Another Static to Hyperlink:</a></div>
    <div class="body"><div class="quote">This code is hard to read, requires some macros, and shouldn't be used by anyone:</div> <br />Seriously I found it quite easy to read and understand. <br /><br />Anyway why not replace &quot;jmp	_x&quot; with &quot;jmp CallWindowProc&quot;?</div>
    <div class="meta">Posted on 2003-05-29 01:56:55 by roticv</div>
   </div>
   <div class="post" id="post-105251">
    <div class="subject"><a href="#post-105251">Another Static to Hyperlink:</a></div>
    <div class="body">Code is hard and impossible to read. Should not be used by programmer.</div>
    <div class="meta">Posted on 2003-05-29 06:49:01 by comrade</div>
   </div>
   <div class="post" id="post-106030">
    <div class="subject"><a href="#post-106030">Another Static to Hyperlink:</a></div>
    <div class="body">The other part needed to implement this is:<pre><code><br />BN_CLICKED_IDC_STC_web&#58;<br />	invoke SendDlgItemMessage, DlgPROC_hWnd&#91;16&#93;,<br />		IDC_STC_web, WM_GETTEXT, LENGTHOF tempBuffer, OFFSET _tempBuffer<br />	invoke ShellExecute, DlgPROC_hWnd&#91;20&#93;,<br />		_T&#40;&quot;open&quot;&#41;, OFFSET tempBuffer, NULL, NULL, SW_SHOWNORMAL<br />	ret</code></pre></div>
    <div class="meta">Posted on 2003-06-04 22:31:55 by bitRAKE</div>
   </div>
   <div class="post" id="post-183679">
    <div class="subject"><a href="#post-183679">Re: Another Static to Hyperlink:</a></div>
    <div class="body">I created a sample from biRAKE&#39;s code to see if it works ;) <br /><br /><br />... and it does</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=1880" target="_blank">StaticToHyperlink.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2006-07-18 03:23:02 by JimmyClif</div>
   </div>
  </div>
 </body>
</html>