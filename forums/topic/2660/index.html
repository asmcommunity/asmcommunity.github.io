<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>How to: remove extension &amp; path from string - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=2660" />
    <link rel="next" href="../?id=2660&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=2660">How to: remove extension &amp; path from string</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=2660&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=2660&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="2660" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=2660&amp;page=2">&gt;</a><a href="../?id=2660&amp;page=2">&raquo;</a></form>   <div class="post" id="post-16870">
    <div class="subject"><a href="#post-16870">How to: remove extension &amp; path from string</a></div>
    <div class="body">Works also with m.a.n.y d.o.t f.i.l.e.s ;)<br /><br /><pre><code><br />        invoke lstrlen, addr szPath<br />        mov ecx, szPath<br />        add ecx, eax<br />     @@&#58;<br />        dec ecx<br />        cmp byte ptr &#91;ecx&#93;, &quot;.&quot;<br />        jne @B<br />        mov byte ptr &#91;ecx&#93;, 0<br />    @@&#58;<br />        dec ecx<br />        cmp byte ptr &#91;ecx&#93;, &quot;\&quot;<br />        jne @B<br />        inc ecx<br /><br />        ; invoke MessageBox, 0, ecx, ecx, 0, 0<br /></code></pre></div>
    <div class="meta">Posted on 2001-12-30 21:23:59 by bazik</div>
   </div>
   <div class="post" id="post-16880">
    <div class="subject"><a href="#post-16880">How to: remove extension &amp; path from string</a></div>
    <div class="body">you might want to load string offset into another register, and do<br />(eg) , and in check if ecx becomes zero... not all files have<br />extension, not all files have path....</div>
    <div class="meta">Posted on 2001-12-30 22:16:12 by f0dder</div>
   </div>
   <div class="post" id="post-16906">
    <div class="subject"><a href="#post-16906">How to: remove extension &amp; path from string</a></div>
    <div class="body">Slow code...</div>
    <div class="meta">Posted on 2001-12-31 00:07:36 by buliaNaza</div>
   </div>
   <div class="post" id="post-16928">
    <div class="subject"><a href="#post-16928">How to: remove extension &amp; path from string</a></div>
    <div class="body">i dont realy understand the code <br /><br />what does it do ? for example you have a string <br />c:\windows\system32\cmd.exe<br /><br />what will you get from this just the &quot;cmd&quot;?<br />but what if the file is &quot;c:\windows\a&quot;<br />like f0dder said your algo doesnt check if the string is over <br />moreover if you have a string like my example the first loop will continue and continue and youw will skip on the '\' (hope you understood what i tring to say here) <br /><br /><br /><br />bye<br />eko<br /><br />p.s you dont need to check the last  and the first bytes for '.'</div>
    <div class="meta">Posted on 2001-12-31 04:35:13 by eko</div>
   </div>
   <div class="post" id="post-16970">
    <div class="subject"><a href="#post-16970">How to: remove extension &amp; path from string</a></div>
    <div class="body"><div class="quote"><br />what does it do ? for example you have a string <br />c:\windows\system32\cmd.exe<br /><br />what will you get from this just the &quot;cmd&quot;?<br /> </div><br /><br />Yes :)<br />I wrote it for my Media Player... if you open an mp3 file, it will read out the ID3 tag and adds &quot;Artist - Title&quot; to the listbox. If you open an wav, wma, mpeg, avi, mpg etc. it will show the filename without extension and path.<br />example:<br /><pre><code><br />F&#58;\DivX\Tomb Raider.avi<br /></code></pre><br />becomes<br /><pre><code><br />Tomb Raider<br /></code></pre><br /><br />In the case, I use this code, the files ALWAYS have a extension, and because I get the names from a GetOpenFileName box, they always have a path, too.<br /><br /><div class="quote"><em>Originally posted by buliaNaza</em><br /><strong>Slow code... <br /> </div><br /><br />Hehe, I waited for such a reply ;)<br />It's fast enough for me, but it would be great, if you could post a optimized version. But if you do so, please comment it well, so I can learn from it :) Thanx in advance!<br /><br />bAZiK</div>
    <div class="meta">Posted on 2001-12-31 07:28:29 by bazik</div>
   </div>
   <div class="post" id="post-17089">
    <div class="subject"><a href="#post-17089">How to: remove extension &amp; path from string</a></div>
    <div class="body">How often is the filename splitting routine called? Would you really<br />need to optimize it? Focus your attention on the 10% that runs 90%<br />of the time instead of wasting your energy on this...</div>
    <div class="meta">Posted on 2002-01-01 10:25:05 by f0dder</div>
   </div>
   <div class="post" id="post-17090">
    <div class="subject"><a href="#post-17090">How to: remove extension &amp; path from string</a></div>
    <div class="body"><div class="quote"><br />How often is the filename splitting routine called? Would you really<br />need to optimize it? </div><br /><br /><strong>I</strong> don't need to optimize it. It's called for every file, wich is added to the listbox... and it's fast enough for my needs.<br />But some guys in this forum think, they must optimize <em>every</em> thing.... <br />:tongue:</div>
    <div class="meta">Posted on 2002-01-01 10:42:29 by bazik</div>
   </div>
   <div class="post" id="post-17093">
    <div class="subject"><a href="#post-17093">How to: remove extension &amp; path from string</a></div>
    <div class="body">Here is <em>my</em> version. It works well too :grin:.<br /><pre><code><br />#include &quot;shlwapi.h&quot;<br /><br />TCHAR lpszPath&#91;&#93; = TEXT&#40;&quot;c&#58;\\path\\file.ext&quot;&#41;;<br />LPTSTR lpszFileName;<br /><br />PathRemoveExtension&#40;&#40;LPCTSTR&#41;lpszPath&#41;;<br />lpszFileName = PathFindFileName&#40;&#40;LPCTSTR&#41;lpszPath&#41;;<br /></code></pre></div>
    <div class="meta">Posted on 2002-01-01 11:04:44 by LuHa</div>
   </div>
   <div class="post" id="post-17097">
    <div class="subject"><a href="#post-17097">How to: remove extension &amp; path from string</a></div>
    <div class="body">WOW, only 2 lines of code, and NO loop :grin: :grin: :grin:</div>
    <div class="meta">Posted on 2002-01-01 11:24:17 by bazik</div>
   </div>
   <div class="post" id="post-17143">
    <div class="subject"><a href="#post-17143">How to: remove extension &amp; path from string</a></div>
    <div class="body">luha version : only two line maybe shorter but no one say FASTER . those api can be even slower and be sure they have loop inside them</div>
    <div class="meta">Posted on 2002-01-01 15:25:54 by eko</div>
   </div>
   <div class="post" id="post-17155">
    <div class="subject"><a href="#post-17155">How to: remove extension &amp; path from string</a></div>
    <div class="body"><div class="quote"><br />luha version : only two line maybe shorter but no one say FASTER . those api can be even slower and be sure they have loop inside them </div><br /><br />I know :) just kidding =)</div>
    <div class="meta">Posted on 2002-01-01 16:57:32 by bazik</div>
   </div>
   <div class="post" id="post-17165">
    <div class="subject"><a href="#post-17165">How to: remove extension &amp; path from string</a></div>
    <div class="body">So what if they're a bit slower... filename processing is not exactly<br />what will be run 90% of the time... unless you have some *very*<br />specific needs ;). And if speed isn't critical, why not go for smaller size...?</div>
    <div class="meta">Posted on 2002-01-01 17:47:16 by f0dder</div>
   </div>
   <div class="post" id="post-17226">
    <div class="subject"><a href="#post-17226">How to: remove extension &amp; path from string</a></div>
    <div class="body">f0dder<br />:<br />smaller code. . not much <br />still you have push call push call again and mov .<br />am.... yeah it still smaller so i guess  you are right :rolleyes: .<br /><br /><br />bye<br /><br />eko</div>
    <div class="meta">Posted on 2002-01-02 07:35:31 by eko</div>
   </div>
   <div class="post" id="post-17354">
    <div class="subject"><a href="#post-17354">How to: remove extension &amp; path from string</a></div>
    <div class="body"><div class="quote"><br />f0dder<br />:<br />smaller code. . not much <br />still you have push call push call again and mov .<br />am.... yeah it still smaller so i guess  you are right :rolleyes: .<br /><br /><br />bye<br /><br />eko </div><br /><br />He is wrong.</div>
    <div class="meta">Posted on 2002-01-03 02:44:59 by The Svin</div>
   </div>
   <div class="post" id="post-17403">
    <div class="subject"><a href="#post-17403">How to: remove extension &amp; path from string</a></div>
    <div class="body">and programs using the functions from shlwapi need a dll (shlwapi.dll) that comes with IE 4.0 and higher...<br />shlwapi has lots of useful string manipulation functions though.<br /><br />I would also be glad to view optimizations to BaZiK's version...</div>
    <div class="meta">Posted on 2002-01-03 10:08:05 by JCP</div>
   </div>
   <div class="post" id="post-17417">
    <div class="subject"><a href="#post-17417">How to: remove extension &amp; path from string</a></div>
    <div class="body">It was not my intention to start such a discussion when I posted my reply, I was only joking. I'm not a fan of blind optimization (I don't even use asm, I don't need it for my little apps and I don't know it :rolleyes: ). I think bAZiK's solution is better if you plan to run your app on win95+, but if your app already need win98+ (shlwapi.dll comes with the OS), well, just use two api calls and be happy, don't warry if it will add an overhead of 20ms (of course if you have a file list of 100000 entries to parse, bless bAZiK and reuse his code :grin: )</div>
    <div class="meta">Posted on 2002-01-03 12:22:37 by LuHa</div>
   </div>
   <div class="post" id="post-17550">
    <div class="subject"><a href="#post-17550">How to: remove extension &amp; path from string</a></div>
    <div class="body">Yes LuHa, i did understand it was a joke but it can start a discussion too... ;)<br />In my opinion it is important to enumerate all possible ways to do something and to discuss about their advantages and inconvenients... <br /><br />shlwapi is a very useful dll indeed but personaly, i try to write assembly or C equivalents to its functions when I have to use it because of this runtime dependency.<br /><br />Kind regards,</div>
    <div class="meta">Posted on 2002-01-04 07:42:50 by JCP</div>
   </div>
   <div class="post" id="post-17621">
    <div class="subject"><a href="#post-17621">How to: remove extension &amp; path from string</a></div>
    <div class="body"><pre><code>		mov eax,offset szPath<br />	@@&#58;	cmp byte ptr &#91;eax&#93;,&quot;\&quot;<br />		je @_s<br />		cmp byte ptr &#91;eax&#93;,&quot;.&quot;<br />		je @_p<br />		cmp byte ptr &#91;eax&#93;,0<br />		je @_z<br />		inc eax<br />		jmp @B<br />ALIGN<br />	@_s&#58;	mov edx,eax<br />		inc eax<br />		jmp @B<br />ALIGN<br />	@_p&#58;	mov ecx,eax<br />		inc eax<br />		jmp @B<br />ALIGN<br />; you could do error checking here...<br />	@_z&#58;	mov &#91;edx&#93;,0<br />		mov &#91;ecx&#93;,0<br />		inc edx<br />; EDX is string start...</code></pre>This is slower, maybe?</div>
    <div class="meta">Posted on 2002-01-04 22:12:21 by bitRAKE</div>
   </div>
   <div class="post" id="post-17648">
    <div class="subject"><a href="#post-17648">How to: remove extension &amp; path from string</a></div>
    <div class="body">Thanks bitRAKE for replay...<br />I have similar idea but now I'm a little bit busy to finish....<br /><pre><code><br />; eax-&gt;lpString ; must be ALIGNED			<br />;.....................................................................;	<br />        mov	esi, eax		;save lpString in esi<br />        xor	edi, edi		;	<br />Search_1&#58;                       	; look for &quot;\&quot;<br />        mov	ecx, &#91;eax&#93;		; ecx=4 bytes<br />        add	eax, 4			; ready to get  next four bytes<br />        mov	edx, ecx		; save 4 bytes in edx<br />        sub	ecx, 4D4D4D4Dh		; 4Dh=4Ch+1h  -&gt;4Ch=&quot;\&quot;	;v sub  from each byte in ebp<br />        and	ecx, 80808080h		; look for &quot;\&quot;-&gt;  test  sign  <br />        jnz	Search_14		; if not loop again<br />        mov	ecx, edx		; save 4 bytes in edx<br />        sub	edx, 2F2F2F2Fh		; 2Fh=2Eh+1h  -&gt;2Eh=&quot;.&quot;	;v sub  from each byte in ebp<br />        and	edx, 80808080h		; look for &quot;.&quot;-&gt;  test  sign  <br />        jnz	Search_15		; if not loop again<br />        mov	edx, ecx		; save 4 bytes in edx<br />        sub	ecx, 1010101h		; 01h=0+1  -&gt;0 ;v sub  from each byte in ecx<br />        and	ecx, 80808080h		; look for 0-&gt;  test  sign  <br />        jz	Search_1		; if not loop again<br />        test	edi, edi		; if edi=0  no &quot;.&quot;<br />        jz	S_Ret			;<br />        mov	dword ptr &#91;edi&#93;, 0	; edi-&gt; lp of last  &quot;.&quot;<br />S_Ret&#58; 				        ;<br />        mov	eax, esi		; eax-&gt;return address of file name<br />ret					; exit<br /><br />Search_14&#58;<br /><br />	....<br />        ....  <br /><br />	jmp	Search_1<br />Search_15&#58;<br />        ....<br />        ....<br />	jmp	Search_1  </code></pre></div>
    <div class="meta">Posted on 2002-01-05 01:14:32 by buliaNaza</div>
   </div>
   <div class="post" id="post-17651">
    <div class="subject"><a href="#post-17651">How to: remove extension &amp; path from string</a></div>
    <div class="body"><strong>buliaNaza</strong>, I was hoping you'd reply as well.  ;)<br /><br />Similarly, I don't have the time to finish this right now. ;)<pre><code>	mm_5C dq 5C5C5C5C5C5C5C5Ch ; lots of &quot;\&quot;<br />	mm_2E dq 2E2E2E2E2E2E2E2Eh ; lots of &quot;.&quot;<br /><br />ReturnFileName&#58;<br />	mov ebx,&#91;esp+4&#93;<br />	mov esi,ebx ; there is atleast one &quot;\&quot; so first byte is not<br />	mov edi,ebx ; important - possible zero it later<br />	movq mm7,mm_5C<br />	movq mm6,mm_2E<br />	pxor mm5,mm5<br />MAIN&#58;	movq mm0,&#91;ebx&#93;<br />	movq mm2,mm0<br />	movq mm4,mm0<br />	pcmpeqb mm0,mm7 ; &quot;\&quot;<br />	pcmpeqb mm2,mm6 ; &quot;.&quot;<br />	pcmpeqb mm4,mm5 ;null char<br />; Word FFFF = FF byte = 11 111111<br />; Word FF00 = 80 byte = 10 000000<br />; Word 00FF = 7F byte = 01 111111<br />; Word 0000 = 00 byte = 00 000000<br />	packsswb mm0, mm0<br />	packsswb mm2, mm2<br />	packsswb mm4, mm4<br />	movd eax, mm0<br />	movd edx, mm2<br />	movd ecx, mm4<br />	add ebx,8<br />	test eax, eax<br />	jne _5C<br />_2E_&#58;	test edx, edx<br />	jne _2E<br />_00_&#58;	test ecx, ecx<br />	je MAIN<br />_00&#58;	mov byte ptr &#91;edi&#93;,0 ; additional error checking here?<br />	lea eax,&#91;esi+1&#93;<br />	ret<br />_5C&#58;	bsf eax,eax<br />	shr eax,2<br />	lea esi,&#91;ebx+eax-8&#93;<br />	jmp _2E_<br />_2E&#58;	bsf edx,edx<br />	shr edx,2<br />	lea edi,&#91;ebx+edx-8&#93;<br />	jmp _00_</code></pre>There are plenty of MMX registers to double over the algorithm to process 32 bytes each loop and keep the constants in registers.  This algo could be adapted easily to unicode and allows the full range of the bytes.  It might actually be worth it to code and algo like this to proccess URLs?<br /><br /><strong>Edit</strong>: Okay, the above <u>appears</u> to be a working version?<br /><em>It is not.</em> :tongue:</div>
    <div class="meta">Posted on 2002-01-05 02:07:54 by bitRAKE</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=2660&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=2660&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="2660" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=2660&amp;page=2">&gt;</a><a href="../?id=2660&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>