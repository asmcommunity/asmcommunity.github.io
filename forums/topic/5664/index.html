<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>self-modifying code - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=5664" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=5664">self-modifying code</a></p>
   <div class="post" id="post-40399">
    <div class="subject"><a href="#post-40399">self-modifying code</a></div>
    <div class="body">I am quite new to win32asm programming and would like to know where I can find more information (examples would be nice) on self-modifying code. Like, creating a program that will run one way, but if something is detected or something is checked, the program will 'self-modify'. I hope you understand what I am talking about.  Just some examples or links to tutorials/documents on that (perhaps masm-specific? :) )<br /><br />thanks..<br /><br /><br />-<br />frihz</div>
    <div class="meta">Posted on 2002-05-29 00:06:28 by frihz</div>
   </div>
   <div class="post" id="post-40427">
    <div class="subject"><a href="#post-40427">self-modifying code</a></div>
    <div class="body">have you tried google already? i bet you'll find thousands<br />of links and examples. in masm all you have to do is set<br />a few more linker options (Link.exe ... /SECTION:.text,RW ...)<br />thats because under normal circumstances you can't write <br />to your code section. after setting this up you can modify<br />what you what. however, google keywords would be<br />reverse-engineering, anti debugging and v*rus of course.</div>
    <div class="meta">Posted on 2002-05-29 03:49:11 by mob</div>
   </div>
   <div class="post" id="post-40450">
    <div class="subject"><a href="#post-40450">self-modifying code</a></div>
    <div class="body">Maybe you could try a tool named &quot;pewrite&quot; or something like that, ( I don't remember exactly), it helps you to make the code section of your exes writable.</div>
    <div class="meta">Posted on 2002-05-29 06:37:28 by Axial</div>
   </div>
   <div class="post" id="post-40451">
    <div class="subject"><a href="#post-40451">self-modifying code</a></div>
    <div class="body">Here I found a tool ! But I must warn you it's also a tool used for making viruses, so....<br /><br /><br /><br />PS : I hope I won't get banned for this :)<br /><br /><strong>EDIT by Readiosys : Attachment removed : please read the rules...</strong></div>
    <div class="meta">Posted on 2002-05-29 06:42:05 by Axial</div>
   </div>
   <div class="post" id="post-40457">
    <div class="subject"><a href="#post-40457">self-modifying code</a></div>
    <div class="body">did you post pwrsec.exe (the name was something like this)? <br />if yes then this tool is definatly NOT used to produce v*ruses.<br />it's used to set new section flags nothing more nothing less.</div>
    <div class="meta">Posted on 2002-05-29 07:12:37 by mob</div>
   </div>
   <div class="post" id="post-40459">
    <div class="subject"><a href="#post-40459">self-modifying code</a></div>
    <div class="body">If you're using hutch--'s Masm32 package, you'll find a directory \Masm32\Example2\smc\ which deals with self-modifying code... the important part of this is in build.bat.<br /><br />Take good care of self-modifying code, smc is potentially dangerous, but if you are careful it can be VERY much faster.<br /><br />Typically self-modifying code is used when you have several versions of a routine (e.g. optimized for various processors), you can determine which routine you need at init-time and then link in the proper version, then throw away the unneeded versions.</div>
    <div class="meta">Posted on 2002-05-29 07:21:41 by AmkG</div>
   </div>
   <div class="post" id="post-40461">
    <div class="subject"><a href="#post-40461">self-modifying code</a></div>
    <div class="body">I would suggest you to use VirtualProtect to temporarily make the<br />code section writable, instead of setting the PE flags. PE flags is<br />easy etc, but will leave your code permanently writable, which can<br />give some rather annoying to find bugs in case of pointer errors etc.<br />Of course if you do a lot of code modification all time, the linker way<br />of doing it is better - but doing lots of code modifications all the time<br />is very bad performance-wise.</div>
    <div class="meta">Posted on 2002-05-29 07:25:45 by f0dder</div>
   </div>
   <div class="post" id="post-40465">
    <div class="subject"><a href="#post-40465">self-modifying code</a></div>
    <div class="body">I agree with f0dder, code modification should as much as possible be confined at init-time, at most at the init of a routine that needs speed.  Also, more than likely an optimization guru can get you the needed speed without doing self-modifying code...<br /><br />A thing peculiar to modern uproc's is that there is a code cache separate from the data cache, so that doing a lot of self-modifying code tends to flush the code cache too often.  So confine your code mods at init-time.</div>
    <div class="meta">Posted on 2002-05-29 07:42:35 by AmkG</div>
   </div>
   <div class="post" id="post-40562">
    <div class="subject"><a href="#post-40562">thanks..</a></div>
    <div class="body">okay, thanks for the info. I did try google before, but i found more complex samples and in other languages, and I really couldn't do much with it.<br /><br />I am using hutch's masm, and i hadn't noticed that example, thanks :) Although it is quite small heh. But, yes, this is sort of what i was looking for.<br /><br />Axial: your attached file was removed before I could check it out, though it sounds somewhat interesting - could you pm me the name of the file?<br /><br />thnks :)<br /><br />-<br />frihz</div>
    <div class="meta">Posted on 2002-05-29 17:45:14 by frihz</div>
   </div>
   <div class="post" id="post-40608">
    <div class="subject"><a href="#post-40608">self-modifying code</a></div>
    <div class="body">i didn't needed such a tool for now but i was bored so <br />i wrote one, it renders the code section flags as readable/<br />writable. under normal circumstances i don't like to use<br />VirtualProtect and i don't see why my prog is now harder<br />to debug without this func.</div>
    <div class="meta">Posted on 2002-05-30 03:31:47 by mob</div>
   </div>
   <div class="post" id="post-40612">
    <div class="subject"><a href="#post-40612">self-modifying code</a></div>
    <div class="body">i had a couple of upload problems...</div>
    <div class="meta">Posted on 2002-05-30 03:49:53 by mob</div>
   </div>
  </div>
 </body>
</html>