<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Could you, please, run it? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=11235" />
    <link rel="next" href="../?id=11235&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=12">The Heap</a> &raquo; <a href="../?id=11235">Could you, please, run it?</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=11235&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=11235&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="11235" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=11235&amp;page=2">&gt;</a><a href="../?id=11235&amp;page=3">&raquo;</a></form>   <div class="post" id="post-84662">
    <div class="subject"><a href="#post-84662">Could you, please, run it?</a></div>
    <div class="body">Could you, please, run it on your machine<br />and report what you can see on MessageBox.<br />Also, please, tell what processor do you have and what OS.</div>
    <div class="meta">Posted on 2003-03-03 07:18:35 by The Svin</div>
   </div>
   <div class="post" id="post-84663">
    <div class="subject"><a href="#post-84663">Could you, please, run it?</a></div>
    <div class="body">---------------------------<br />Error<br />---------------------------<br />SMSW eax: 0F01E0 eax = 8001003B<br />SMSW ax: 660F01E0 eax = 0000003B<br />---------------------------<br />OK   <br />---------------------------<br /><br /><br />I hope this is what you're aiming for.<br /><br />dual p3 800, windows 2000 pro SP3</div>
    <div class="meta">Posted on 2003-03-03 07:27:09 by Hiroshimator</div>
   </div>
   <div class="post" id="post-84664">
    <div class="subject"><a href="#post-84664">Could you, please, run it?</a></div>
    <div class="body">Yes, that what I need.<br />Thank you.<br />Could others submit the info, please?</div>
    <div class="meta">Posted on 2003-03-03 07:29:49 by The Svin</div>
   </div>
   <div class="post" id="post-84667">
    <div class="subject"><a href="#post-84667">Could you, please, run it?</a></div>
    <div class="body">error caption<br />SMSW eax: 0F01E0 eax = 80000019<br />SMSW ax: 660F01E0 eax = 00000019<br />OK button<br /><br />P4  1.4 GHz     windows Me</div>
    <div class="meta">Posted on 2003-03-03 07:40:47 by argus</div>
   </div>
   <div class="post" id="post-84668">
    <div class="subject"><a href="#post-84668">Could you, please, run it?</a></div>
    <div class="body">---------------------------<br />Error<br />---------------------------<br />SMSW eax: 0F01E0 eax = 8001003B<br />SMSW ax: 660F01E0 eax = 0000003B<br />---------------------------<br />OK   <br />---------------------------<br /><br />AMD 1.33 gHz, Win XP Pro SP1</div>
    <div class="meta">Posted on 2003-03-03 07:52:44 by Qweerdy</div>
   </div>
   <div class="post" id="post-84670">
    <div class="subject"><a href="#post-84670">Could you, please, run it?</a></div>
    <div class="body">Thanx, for others: <br />caption, button texts are not needed <br />I'm interested in reurn value for the two opcodes.<br />The thing is about SMSW instruction that loads from<br />cr0 low 16 bits.<br />I got some confusing actuall data:<br />1. Intel refference are clear about using 32 bit operands<br />with SMSW, but says that only 16 bits of 32 bit operand<br />will be used, others ...&quot;undefined&quot; :)<br />Undefined does not mean &quot;unchanged&quot; as you can see it.<br />2. MASM doesn't allow 32 bit operand - it rejects it as an error BUT!<br />Funny thing - when you enter for example<br />smsw ax it encode actually 0F01E0 - opcode for<br />smws eax.<br />So there is 2 strange things about it <br /> -1: Why it treats 32bit operand as error while Intel allow it.<br /> -2: Why it actually encode it as 32 bit operand instead of 16 bit (with 66 prefix)<br />3. Since I (and you also that others too) get something<br />in upper 16 bit of eax, the question is - what are those bits and a guess that they might somehow relate to cr0<br />too. <br />The answer of course, can be done only with driver written or some debugger that shows cr0.<br />I don't know one.</div>
    <div class="meta">Posted on 2003-03-03 08:03:32 by The Svin</div>
   </div>
   <div class="post" id="post-84671">
    <div class="subject"><a href="#post-84671">Could you, please, run it?</a></div>
    <div class="body">---------------------------<br />Errore<br />---------------------------<br />SMSW eax: 0F01E0 eax = 80010031<br />SMSW ax: 660F01E0 eax = 00000031<br />---------------------------<br />OK   <br />---------------------------<br /><br />AMD Athlon XP 1600+ currently overclocked to 1502 MHz.<br />I ran it on Windows 2000, SP3.<br /><br />Hope it helps.</div>
    <div class="meta">Posted on 2003-03-03 08:03:33 by Maverick</div>
   </div>
   <div class="post" id="post-84672">
    <div class="subject"><a href="#post-84672">Could you, please, run it?</a></div>
    <div class="body">Maverick, <br />on what OS have you run it, please?<div class="quote">Hope it helps</div> <br />Of course, it is!<br />It's magic ability here on the board to have freinds around the world. <br />I couldn't do such a test otherwize :)</div>
    <div class="meta">Posted on 2003-03-03 08:05:13 by The Svin</div>
   </div>
   <div class="post" id="post-84679">
    <div class="subject"><a href="#post-84679">Could you, please, run it?</a></div>
    <div class="body">Looks like without prefix 66 smsw on new processors<br />reads 32 bits of cr0 to operand not only msw.<br />If I'm right then 8001 in upper bits means PG and WP<br />bit's on CR0 set to 1 and 8000  - PG=1,WP=0 that looks<br />very much like truth.</div>
    <div class="meta">Posted on 2003-03-03 08:42:07 by The Svin</div>
   </div>
   <div class="post" id="post-84688">
    <div class="subject"><a href="#post-84688">Could you, please, run it?</a></div>
    <div class="body"><div class="quote"><br />Maverick, <br />on what OS have you run it, please?</div>Windows 2000, SP3.<br />We posted at the same time (3:03 PM here), I immediately after noticed I forgot to put the OS and edited my post. You had already read the post then. :)<br /><br />PS: about your SMSW test, also BSWAP behaves differently between CPU and CPU (at least Intel vs AMD) when prefixed with $66. On my ex Pentium I found this form useful (it ran two 16bit swap in parallel), while on my Athlon the high word gets zeroed instead.</div>
    <div class="meta">Posted on 2003-03-03 09:15:46 by Maverick</div>
   </div>
   <div class="post" id="post-84691">
    <div class="subject"><a href="#post-84691">Could you, please, run it?</a></div>
    <div class="body">Yes, the same here about bswap on PIII</div>
    <div class="meta">Posted on 2003-03-03 09:19:35 by The Svin</div>
   </div>
   <div class="post" id="post-84707">
    <div class="subject"><a href="#post-84707">Ahah...</a></div>
    <div class="body">Thanks SVIN you solve my problem once again.<br /><br /><pre><code><br />SMSW AX   ; Store Machine Status Word<br />xor al,1      ; Set the PMode switch, no need 0x66 Code or prefix<br />SETE AX     ; Get Set<br /></code></pre><br /><br />:alright:  <br /><br />Mine is Win98 400 Mhz<br /><br />80000019 ----&gt;eax<br />00000019 ----&gt;ax<br /><br />Thank you very Much...., Muachh...,muach...,<br />So I dont need 66 prefix instruction anymore do I ?</div>
    <div class="meta">Posted on 2003-03-03 09:58:48 by realvampire</div>
   </div>
   <div class="post" id="post-84708">
    <div class="subject"><a href="#post-84708">Could you, please, run it?</a></div>
    <div class="body">Well, you can do it either way...<br />I personally use <br /><br />mov eax,cr0<br />or eax,1<br />mov cr0,eax<br /><br />It gives access to the whole register.<br /><br />-Stealth</div>
    <div class="meta">Posted on 2003-03-03 10:06:17 by Stealth</div>
   </div>
   <div class="post" id="post-84718">
    <div class="subject"><a href="#post-84718">Could you, please, run it?</a></div>
    <div class="body">It seems I was right :)<br />I wrote kmd (in fact I just udapted skeleton kmd from excelent Four-F package)<br />that reads mov eax,cr0 and smsw eax.<br />And at my machine they are the same!!!<br />So indeed smsw eax might be used as unpreveleged mov eax,cr0!<br />Might be ... :)<br />I again kindly ask those who has NT family (NT,2000,XP) run the following<br />app that comes now with kmd sys file and report results.<br />For those who has 9x(95,98,Me) some hero volanteer is needed to<br />write VXD that reads cr0. Unfortunatly I can not write VXD on my machine now.</div>
    <div class="meta">Posted on 2003-03-03 11:15:29 by The Svin</div>
   </div>
   <div class="post" id="post-84720">
    <div class="subject"><a href="#post-84720">Could you, please, run it?</a></div>
    <div class="body"><div class="quote"><br />Well, you can do it either way...<br />I personally use <br /><br />mov eax,cr0<br />or eax,1<br />mov cr0,eax<br /><br />It gives access to the whole register.<br /><br />-Stealth </div><br />But you can not do it from level 3 ring can you ?</div>
    <div class="meta">Posted on 2003-03-03 11:17:49 by The Svin</div>
   </div>
   <div class="post" id="post-84774">
    <div class="subject"><a href="#post-84774">Could you, please, run it?</a></div>
    <div class="body"><div class="quote"><br />It seems I was right :)<br />I wrote kmd (in fact I just udapted skeleton kmd from excelent Four-F package)<br />that reads mov eax,cr0 and smsw eax.<br />And at my machine they are the same!!!<br />So indeed smsw eax might be used as unpreveleged mov eax,cr0!<br />Might be ... :)<br />I again kindly ask those who has NT family (NT,2000,XP) run the following<br />app that comes now with kmd sys file and report results.<br />For those who has 9x(95,98,Me) some hero volanteer is needed to<br />write VXD that reads cr0. Unfortunatly I can not write VXD on my machine now. </div><br />AMD Athlon XP 1600+ currently overclocked to 1502 MHz.<br />Windows 2000, SP3.<br /><br />---------------------------<br />mov eax,CR0 and smsw, eax<br />---------------------------<br />mov eax,cr0=8001003B; smsw eax = 8001003B<br />---------------------------<br />OK   <br />---------------------------</div>
    <div class="meta">Posted on 2003-03-03 16:05:13 by Maverick</div>
   </div>
   <div class="post" id="post-84823">
    <div class="subject"><a href="#post-84823">Could you, please, run it?</a></div>
    <div class="body">on that &quot;skeleton&quot; file on windows XP SP1 with a pentium 4:<br /><br />mov eax,cr0=8001003B;<br /><br />smsw eax = 8001003B</div>
    <div class="meta">Posted on 2003-03-03 17:29:46 by kairon</div>
   </div>
   <div class="post" id="post-84835">
    <div class="subject"><a href="#post-84835">Could you, please, run it?</a></div>
    <div class="body">AMD K7 500mhz<br /><br />windows XP sp1<br /><br />mov eax,cr0=8001003B;smsw eax = 8001003B</div>
    <div class="meta">Posted on 2003-03-03 18:20:48 by va3gdr</div>
   </div>
   <div class="post" id="post-84837">
    <div class="subject"><a href="#post-84837">Could you, please, run it?</a></div>
    <div class="body">same as Hiro's on my new P4.  Still haven't loaded all my programs on to this computer yet :(</div>
    <div class="meta">Posted on 2003-03-03 18:46:56 by jademtech</div>
   </div>
   <div class="post" id="post-84840">
    <div class="subject"><a href="#post-84840">Could you, please, run it?</a></div>
    <div class="body">Same as Hiro on P4 XP Home</div>
    <div class="meta">Posted on 2003-03-03 18:54:30 by drhowarddrfine</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=11235&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=11235&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="11235" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=11235&amp;page=2">&gt;</a><a href="../?id=11235&amp;page=3">&raquo;</a></form>  </div>
 </body>
</html>