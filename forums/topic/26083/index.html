<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>NAT Traversal (Port Forwarding) via UPnP - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=26083" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=26083">NAT Traversal (Port Forwarding) via UPnP</a></p>
   <div class="post" id="post-189962">
    <div class="subject"><a href="#post-189962">NAT Traversal (Port Forwarding) via UPnP</a></div>
    <div class="body">The Problem:<br />It&#39;s a vexing issue for many users whose machines have Private (LAN) IP addresses (ie are behind some kind of NAT device such as a Router, or use &#39;ICS&#39; to feed a Hub).<br />You can&#39;t accept incoming connections without configuring your NAT device (or Gateway machine).<br />That means you can&#39;t run Servers, and your p2p-based apps are forced to use only outgoing connections, which often equates to limited service.<br />Of course, the average user is simply not tech-savvy enough to set up port forwarding, and even if they are, they may be working in an environment where the local Administrator(s) are less than helpful.<br /><br />The Solution:<br />There is a standard solution to all these problems, assuming that the Universal Plug and Play ports (udp 1900 and tcp 5000) are not firewalled within the LAN... and if they are, asking the Admin to allow UPnP ports inside the LAN doesn&#39;t sound as bad or dangerous as asking for specific ports to be forwarded so you can run a Server (say, in a public library).<br />It is possible to programatically set up Port Forwarding from any LAN machine.<br />This kind of support can be added to all Server applications such that they may automatically perform remote configuring of Port Forwarding apon the Gateway Machine, or alternatively, a separate application can be written to remotely view/edit/add forwarded ports, allowing any LAN machine to host Server apps :)<br /><br />Homer, WHY are you telling us what we (may) already know?<br />This is just a Heads Up to announce that I&#39;ve translated the NATUPNP header to OA32 format and will be writing a primitive engine as a reusable OA32 Object Module for public use.<br />I am essentially doing this to add this feature to my IOCP Server/Client Engine (which currently is used by my VOIP demo, and some other projects), but it is such a useful entity that I will keep it separate from that framework. I may end up enshrining it as a LIB or DLL to allow programmers everywhere to use it, but the initial goal will be OBJ.<br />Although this is COM/RPC stuff, I am designing this module in such a way as to hide all the ugly COM stuff so that the average OA32 user doesn&#39;t need to worry about any of that.<br /><br />Have a nice day - Prug and Pray :)<br /></div>
    <div class="meta">Posted on 2007-07-28 12:18:52 by Homer</div>
   </div>
   <div class="post" id="post-189970">
    <div class="subject"><a href="#post-189970">Re: NAT Traversal (Port Forwarding) via UPnP</a></div>
    <div class="body">You still can&#39;t accept incoming connections .<br /> ;)</div>
    <div class="meta">Posted on 2007-07-28 19:13:36 by gavin</div>
   </div>
   <div class="post" id="post-189971">
    <div class="subject"><a href="#post-189971">Re: NAT Traversal (Port Forwarding) via UPnP</a></div>
    <div class="body">Are you certain?<br />Try searching for &quot;lan server port forward&quot;.<br />You&#39;ll find a lot of people run servers from behind NATs and across firewalls that would otherwise restrict them.</div>
    <div class="meta">Posted on 2007-07-28 19:56:37 by Homer</div>
   </div>
   <div class="post" id="post-189972">
    <div class="subject"><a href="#post-189972">Re: NAT Traversal (Port Forwarding) via UPnP</a></div>
    <div class="body">I&#39;m not trying to ruin your post or anything but have you any links that show this without touching the router?</div>
    <div class="meta">Posted on 2007-07-28 20:01:50 by gavin</div>
   </div>
   <div class="post" id="post-189973">
    <div class="subject"><a href="#post-189973">Re: NAT Traversal (Port Forwarding) via UPnP</a></div>
    <div class="body">For UDP protocol exists http://en.wikipedia.org/wiki/UDP_hole_punching<br /><br />However this is not useful to expose a server over the internet but still interesting :)<br /><br /> I forgot to tell, you can accept incomming conections with UPnP, at least on my network uTorrent maps the port on the ICS of my router PC and if I check the list of port forwardings I can see the automatically maped port there.</div>
    <div class="meta">Posted on 2007-07-28 20:28:32 by LocoDelAssembly</div>
   </div>
   <div class="post" id="post-189974">
    <div class="subject"><a href="#post-189974">Re: NAT Traversal (Port Forwarding) via UPnP</a></div>
    <div class="body">Doing that with udp sounds like nat . :D Very interesting.<br /></div>
    <div class="meta">Posted on 2007-07-28 20:38:55 by gavin</div>
   </div>
   <div class="post" id="post-189975">
    <div class="subject"><a href="#post-189975">Re: NAT Traversal (Port Forwarding) via UPnP</a></div>
    <div class="body">http://www.codeproject.com/internet/PortForward.asp<br /><br />This demo (with C source) supports all the features I intend, but is rather ugly codewise.<br />Anyway, the binary demo provided allows for testing a built-in webserver.<br /></div>
    <div class="meta">Posted on 2007-07-29 01:23:01 by Homer</div>
   </div>
   <div class="post" id="post-189978">
    <div class="subject"><a href="#post-189978">Re: NAT Traversal (Port Forwarding) via UPnP</a></div>
    <div class="body">Hey homer.<br /><br />I was talking about without having upnp enabled on the router because most routers have it turned off by default anyway.<br /></div>
    <div class="meta">Posted on 2007-07-29 08:21:02 by gavin</div>
   </div>
   <div class="post" id="post-189985">
    <div class="subject"><a href="#post-189985">Re: NAT Traversal (Port Forwarding) via UPnP</a></div>
    <div class="body">UDP hole-punching is completely different from UPnP, but a useful technique in itself... and UPnP indeed does let you accept incoming connections. It&#39;s either b0rked in my router or the more recent ÂµTorrent versions though :/<br /></div>
    <div class="meta">Posted on 2007-07-29 12:38:33 by f0dder</div>
   </div>
   <div class="post" id="post-190001">
    <div class="subject"><a href="#post-190001">Re: Tiresome hand translation of COM Headers</a></div>
    <div class="body">Yesterday I translated natupnp.h and today I translated UPnP.h<br />If you want them NOW, just ask - otherwise wait for my first UPnP Demo, which will include them... or wait even longer for the UPnP Engine which will pretty much just wrap the COM stuff so you dont have to worry about mundane stuff like BSTR and VARIANT conversions and other such nonsense... or wait yet longer for my VOIP Demo which will include an update of my IOCP Server/Client Engine that will in turn utilize the UPnP Engine as a core component&nbsp; 8)<br /><br />I shall list all the interfaces in each of these files here, in case anyone ever searches the board for them.<br /><br />FileName: UPnP.inc<br />Interfaces: IUPnPDeviceFinder, IUPnPDeviceFinderCallback, IUPnPServices, IUPnPService, IUPnPServiceCallback, IUPnPDevices, IUPnPDevice, IUPnPDeviceDocumentAccess, IUPnPDescriptionDocument, IUPnPDescriptionDocumentCallback<br /><br />FileName: natupnp.inc<br />Interfaces: IUPnPNAT, INATEventManager, INATExternalIPAddressCallback, INATNumberOfEntriesCallback, IDynamicPortMappingCollection, IDynamicPortMapping, IStaticPortMappingCollection, IStaticPortMapping<br /><br />What can I say - Prug and Pray !!&nbsp; :lol:</div>
    <div class="meta">Posted on 2007-07-30 09:02:44 by Homer</div>
   </div>
   <div class="post" id="post-190002">
    <div class="subject"><a href="#post-190002">Re: NAT Traversal (Port Forwarding) via UPnP</a></div>
    <div class="body">Homer, are you doing this to be able to do VoIP in a P2P fashion? Note that if you have a server in which clients connect to, then perhaps you should also give a try to the UDP hole-punching since it enables you to do P2P connections even if your NAT device doesn&#39;t supports UPnP nor manual port forwardings.</div>
    <div class="meta">Posted on 2007-07-30 10:46:30 by LocoDelAssembly</div>
   </div>
   <div class="post" id="post-190004">
    <div class="subject"><a href="#post-190004">Re: NAT Traversal (Port Forwarding) via UPnP</a></div>
    <div class="body"><div class="quote">Homer, are you doing this to be able to do VoIP in a P2P fashion?</div><br />YES.. decentralized voice is the game, for fun, not profit.<br /><br />My IOCP Server/Client Engine is a general purpose networking component that can assign protocol-handler objects to each &#39;Session&#39; (and can do funky stuff like switching protocols mid-session).<br /><br />Right now as of this moment, the IOCP engine does not support UDP at all.<br />The VOIP demo uses TCP only.<br /><br />However..<br />IOCP , even under TCP (which ensures that packets arrive, and arrive in the order sent), does not guarantee that packets are PROCESSED in the order received, without the User imparting a formal packet ordering scheme within the carrier protocol.. this kinda makes UDP viable.. if we&#39;re going to start marking packets with a &quot;packet number&quot; outside of the IP header, then I can&#39;t see much advantage to TCP except for the delivery guarantee.<br /><br />I will think about implementing UDP in the IOCP framework as I go along with the UPnP stuff.</div>
    <div class="meta">Posted on 2007-07-31 02:17:26 by Homer</div>
   </div>
  </div>
 </body>
</html>