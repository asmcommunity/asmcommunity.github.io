<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ComboBox problem - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=21372" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=21372">ComboBox problem</a></p>
   <div class="post" id="post-161559">
    <div class="subject"><a href="#post-161559">ComboBox problem</a></div>
    <div class="body">Using a very simple dialog box for a main window, and I&#39;m unable to insert items into a combobox. After the SendMessage call, the combobox is still blank :( The res file includes:<br /><strong><br />0 DIALOG 0, 0, 249, 109<br />STYLE WS_POPUP |WS_VISIBLE |WS_SYSMENU |WS_THICKFRAME |WS_MAXIMIZEBOX |WS_MINIMIZEBOX |WS_CAPTION <br />CLASS &quot;DWTDlgClass&quot;<br />CAPTION &quot;Additional DHS Workstation Tasks&quot;<br />LANGUAGE LANG_NEUTRAL, 0<br />BEGIN<br />&nbsp; CONTROL &quot;&quot;,0,&quot;STATIC&quot;,SS_BLACKFRAME |WS_CHILD |WS_VISIBLE ,10,5,65,34<br />&nbsp; CONTROL &quot;&quot;,1,&quot;COMBOBOX&quot;,CBS_HASSTRINGS |CBS_DROPDOWNLIST |WS_CHILD |WS_TABSTOP |WS_VISIBLE ,8,58,237,50<br />&nbsp; CONTROL &quot;Choose Task:&quot;,2,&quot;STATIC&quot;,SS_LEFT |WS_CHILD |WS_GROUP |WS_VISIBLE ,58,46,47,8<br />&nbsp; CONTROL &quot;&amp;Quit&quot;,3,&quot;BUTTON&quot;,BS_DEFPUSHBUTTON |BS_VCENTER |BS_CENTER |WS_CHILD |WS_TABSTOP |WS_VISIBLE ,10,90,50,14<br />&nbsp; CONTROL &quot;&amp;Next &gt;&gt;&quot;,4,&quot;BUTTON&quot;,BS_DEFPUSHBUTTON |BS_VCENTER |BS_CENTER |WS_CHILD |WS_TABSTOP |WS_VISIBLE |WS_DISABLED ,190,90,50,14<br /></strong><br /><br />The code is (scroll to highlighted):<br /><br /><strong><br />.386<br />.model flat,stdcall<br />option casemap:none<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br /><br />include \masm32\macros\Strings.mac<br /><br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />.data <br /><br />.data? <br />hInstance HINSTANCE ? <br />CommandLine LPSTR ? <br />buffer db 1024 dup(?)<br /><br />.const <br />IDC_COMBOBOX	equ 1<br />IDC_QUIT	equ 3<br />IDC_NEXT	equ 4 <br /><br />.code<br />WinMain PROTO :DWORD,:DWORD,:DWORD,:DWORD<br />WndProc PROTO :DWORD,:DWORD,:DWORD,:DWORD<br /><br />start: <br />&nbsp; &nbsp; invoke GetModuleHandle, NULL <br />&nbsp; &nbsp; mov&nbsp; &nbsp; hInstance,eax <br />&nbsp; &nbsp; invoke GetCommandLine <br />&nbsp; &nbsp; invoke WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT <br />&nbsp; &nbsp; invoke ExitProcess,eax <br /><br />WinMain proc hInst:HINSTANCE,hPrevInst:HINSTANCE,CmdLine:LPSTR,CmdShow:DWORD <br />&nbsp; &nbsp; LOCAL wc:WNDCLASSEX <br />&nbsp; &nbsp; LOCAL msg:MSG <br />&nbsp; &nbsp; LOCAL hDlg:HWND <br />&nbsp; &nbsp; mov&nbsp;  wc.cbSize,SIZEOF WNDCLASSEX <br />&nbsp; &nbsp; mov&nbsp;  wc.style, CS_HREDRAW or CS_VREDRAW <br />&nbsp; &nbsp; mov&nbsp;  wc.lpfnWndProc, OFFSET WndProc <br />&nbsp; &nbsp; mov&nbsp;  wc.cbClsExtra,NULL <br />&nbsp; &nbsp; mov&nbsp;  wc.cbWndExtra,DLGWINDOWEXTRA <br />&nbsp; &nbsp; push&nbsp; hInstance <br />&nbsp; &nbsp; pop&nbsp;  wc.hInstance <br />&nbsp; &nbsp; mov&nbsp;  wc.hbrBackground,COLOR_BTNFACE+1 <br />&nbsp; &nbsp; mov&nbsp;  wc.lpszMenuName,NULL<br />&nbsp; &nbsp; mov&nbsp;  wc.lpszClassName,$CTA0(&quot;DWTDlgClass&quot;)<br />&nbsp; &nbsp; invoke LoadIcon,NULL,IDI_APPLICATION <br />&nbsp; &nbsp; mov&nbsp;  wc.hIcon,eax <br />&nbsp; &nbsp; mov&nbsp;  wc.hIconSm,eax<br />&nbsp; &nbsp; invoke LoadCursor,NULL,IDC_ARROW <br />&nbsp; &nbsp; mov&nbsp;  wc.hCursor,eax <br />&nbsp; &nbsp; invoke RegisterClassEx, addr wc <br />&nbsp; &nbsp; invoke CreateDialogParam,hInstance,0,NULL,NULL,NULL <br />&nbsp; &nbsp; mov&nbsp;  hDlg,eax <br />&nbsp; &nbsp; invoke ShowWindow, hDlg,SW_SHOWNORMAL <br />&nbsp; &nbsp; invoke UpdateWindow, hDlg <br />&nbsp;  .WHILE TRUE <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke GetMessage, ADDR msg,NULL,0,0 <br />&nbsp; &nbsp; &nbsp; &nbsp; .BREAK .IF (!eax) <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke IsDialogMessage, hDlg, ADDR msg <br />&nbsp; &nbsp; &nbsp; &nbsp; .IF eax ==FALSE <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke TranslateMessage, ADDR msg <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke DispatchMessage, ADDR msg <br />&nbsp; &nbsp; &nbsp; &nbsp; .ENDIF <br />&nbsp; &nbsp; .ENDW <br />&nbsp; &nbsp; mov&nbsp; &nbsp;  eax,msg.wParam <br />&nbsp; &nbsp; ret <br />WinMain endp <br />WndProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM <br />LOCAL hCOMBOBOX:HANDLE<br />&nbsp; &nbsp; mov&nbsp;  eax,uMsg <br />&nbsp; &nbsp; .IF eax==WM_DESTROY <br />	invoke CloseHandle, hCOMBOBOX<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke PostQuitMessage, NULL <br />&nbsp; &nbsp; .ELSEIF eax==WM_CREATE<br />	invoke GetDlgItem, hWnd, IDC_COMBOBOX<br />	mov hCOMBOBOX, eax<br />	invoke SendMessage, hCOMBOBOX, CB_ADDSTRING, NULL, $CTA0(&quot;1st&quot;)<br /><br />&nbsp; &nbsp; .ELSEIF eax==WM_COMMAND <br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,wParam <br />&nbsp; &nbsp; &nbsp; &nbsp; .IF lParam==0 <br />&nbsp; &nbsp; &nbsp; &nbsp; .ELSE <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .IF ax==IDC_NEXT<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shr eax,16 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .IF ax==BN_CLICKED <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; do next thing<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ENDIF <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ELSEIF ax==IDC_QUIT<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shr eax,16 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .IF ax==BN_CLICKED <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke DestroyWindow, hWnd<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ENDIF <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .ENDIF <br />&nbsp; &nbsp; &nbsp; &nbsp; .ENDIF <br />&nbsp; &nbsp; .ELSE <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke DefWindowProc,hWnd,uMsg,wParam,lParam <br />&nbsp; &nbsp; &nbsp; &nbsp; ret <br /> .ENDIF <br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp; eax,eax <br /> ret <br />WndProc endp <br />end start <br /></strong><br /><br />It been a few hours, and I can&#39;t see what I&#39;m missing! Any gurus see what&#39;s causing this to fail?</div>
    <div class="meta">Posted on 2005-06-28 17:33:43 by jackal651</div>
   </div>
   <div class="post" id="post-161560">
    <div class="subject"><a href="#post-161560">Re: ComboBox problem</a></div>
    <div class="body">at a guess, its because you&#39;ve made it local within the wndproc, the wndproc doesnt quite work like that, its called each time a message is passed to it, so the local stuff wont work as the stack will most likely get trashed, try doing storing the combobox window handle in a dword in the data segment, it will probably work then</div>
    <div class="meta">Posted on 2005-06-28 19:38:22 by evlncrn8</div>
   </div>
   <div class="post" id="post-161564">
    <div class="subject"><a href="#post-161564">Re: ComboBox problem</a></div>
    <div class="body">;============================<br />#include &lt;/masm32/include/resource.h&gt;<br />2005 DIALOG 0, 0, 249, 109<br />STYLE DS_MODALFRAME | WS_POPUP | WS_VISIBLE | WS_CAPTION | WS_SYSMENU | WS_THICKFRAME<br />CAPTION &quot;Additional DHS Workstation Tasks&quot;<br />FONT 12, &quot;Arial&quot;<br />{<br />? CONTROL &quot;&quot;,0,&quot;STATIC&quot;,SS_BLACKFRAME |WS_CHILD |WS_VISIBLE ,10,5,65,34<br />? CONTROL &quot;&quot;,1,&quot;COMBOBOX&quot;,CBS_DROPDOWNLIST | WS_TABSTOP,8,58,237,50<br />? CONTROL &quot;Choose Task:&quot;,1002,&quot;STATIC&quot;,SS_LEFT |WS_CHILD |WS_GROUP |WS_VISIBLE ,58,46,47,8<br />? CONTROL &quot;&amp;Quit&quot;,3,&quot;BUTTON&quot;,BS_DEFPUSHBUTTON |BS_VCENTER |BS_CENTER |WS_CHILD |WS_TABSTOP |WS_VISIBLE ,10,90,50,14<br />? CONTROL &quot;&amp;Next &gt;&gt;&quot;,4,&quot;BUTTON&quot;,BS_DEFPUSHBUTTON |BS_VCENTER |BS_CENTER |WS_CHILD |WS_TABSTOP |WS_VISIBLE |WS_DISABLED ,190,90,50,14<br />}<br />;==========================================================<br />start: <br />	invoke GetModuleHandle, NULL <br />	mov? ? hInstance,eax <br />	invoke DialogBoxParam,hInstance,2005,NULL,addr WndProc,NULL<br />	invoke ExitProcess,eax <br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />WndProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM <br />	Local hCOMBOBOX:HANDLE<br />	mov? ?eax,uMsg <br /><br />	.if	eax == WM_CLOSE<br />		invoke	EndDialog,hWnd,NULL<br />	.elseif	eax == WM_INITDIALOG<br />		invoke GetDlgItem, hWnd, IDC_COMBOBOX<br />		mov hCOMBOBOX, eax<br />		invoke SendMessage, hCOMBOBOX, CB_ADDSTRING, NULL, $CTA0(&quot;1st&quot;)<br />		invoke SendMessage, hCOMBOBOX, CB_ADDSTRING, NULL, $CTA0(&quot;2st&quot;)<br />		invoke SendMessage, hCOMBOBOX, CB_ADDSTRING, NULL, $CTA0(&quot;3st&quot;)<br />		invoke SendMessage, hCOMBOBOX, CB_SETCURSEL,0,0<br />		;invoke SendDlgItemMessage,hWnd,IDC_COMBOBOX, CB_ADDSTRING, NULL,$CTA0(&quot;1st&quot;)<br />		;invoke	SendDlgItemMessage,hWnd,IDC_COMBOBOX, CB_SETCURSEL,0,0<br />	.ELSEIF eax==WM_COMMAND <br />		mov eax,wParam <br />		.IF lParam==0 <br />		.ELSE <br />			.IF ax==IDC_NEXT<br />				shr eax,16 <br />				.IF ax==BN_CLICKED <br />					; do next thing<br />				.ENDIF <br />			.ELSEIF ax==IDC_QUIT<br />				shr eax,16 <br />				.IF ax==BN_CLICKED <br />					invoke DestroyWindow, hWnd<br />				.ENDIF <br />			.ENDIF <br />		.ENDIF <br />	.ELSE <br />		mov	eax,FALSE<br />		ret<br />	.ENDIF <br />		mov	eax,TRUE<br />		ret<br />WndProc endp <br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br /><br />end start<br /></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=725" target="_blank">cr_2.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2005-06-28 22:05:00 by dcskm4200</div>
   </div>
   <div class="post" id="post-161573">
    <div class="subject"><a href="#post-161573">Re: ComboBox problem</a></div>
    <div class="body">Thanks for the suggestions. I tried the code above, and moving the control handle globally, but neither worked. The comment on the stack got me thinking to look outside of that block though.<br /><br />Now I don&#39;t know why, but it turned out that hWnd wasn&#39;t being passed the correct value when CreateDialogParam was called. If I moved the SendMessage outside of the WndProc to after the CreateDialogParam call, then called SendMessage with the dialog handle returned by CreateDialogParam, then the items would insert!<br /><br />I would think that when CreateDialogParam is called, it passes the right handle to the WndProc. Apparently not!<br /><br />Thanks for your help and suggestions!</div>
    <div class="meta">Posted on 2005-06-29 09:03:08 by jackal651</div>
   </div>
  </div>
 </body>
</html>