<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>How can I change the C++ code to  masm32 - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29871" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=116">Windows</a> &raquo; <a href="../?id=29871">How can I change the C++ code to  masm32</a></p>
   <div class="post" id="post-211035">
    <div class="subject"><a href="#post-211035">How can I change the C++ code to  masm32</a></div>
    <div class="body"><pre><code><br />class CSampleGrabberCB : public ISampleGrabberCB <br />{<br />public:<br />	long lWidth;<br />	long lHeight;<br /><br />	STDMETHODIMP QueryInterface(REFIID riid, void ** ppv)<br />	{<br />		if( riid == IID_ISampleGrabberCB || riid == IID_IUnknown )<br />		{<br />			*ppv = (void *) static_cast&lt;ISampleGrabberCB*&gt; ( this );<br />			return NOERROR;<br />		} <br />		return E_NOINTERFACE;<br />	}<br />	STDMETHODIMP_(ULONG) AddRef() { return 2; }<br />	STDMETHODIMP_(ULONG) Release() { return 1; }<br />	STDMETHODIMP SampleCB( double SampleTime, IMediaSample * pSample )<br />	{<br />		return 0;<br />	}<br />	STDMETHODIMP BufferCB( double dblSampleTime, BYTE * pBuffer, long lBufferSize )<br />	{<br />		return 0;<br />	}<br /><br />};<br />CSampleGrabberCB mCB;<br /></code></pre><br /><br /><span style="font-size:8pt><em>Edit by SpooK: added code tags.</em></span></div>
    <div class="meta">Posted on 2010-03-17 03:12:51 by pmason_rose</div>
   </div>
   <div class="post" id="post-211036">
    <div class="subject"><a href="#post-211036">Re: How can I change the C++ code to  masm32</a></div>
    <div class="body">I writen the code have been priew the camer,but I cant capture the picture! &nbsp;please help !<br /><pre><code><br />;ds.asm<br />DEBUG		equ		0<br />.386<br />.model		flat, stdcall &nbsp;;32 bit memory model<br />option		casemap :none &nbsp;;case sensitive<br />include		windows.inc<br />include		kernel32.inc<br />include		user32.inc<br />include		Comctl32.inc<br />include		shell32.inc<br />include		ole32.inc<br />includelib	kernel32.lib<br />includelib	user32.lib<br />includelib	Comctl32.lib<br />includelib	shell32.lib<br />includelib	OLE32.LIB<br /><br />include		oaidl.inc<br />include		macros.asm<br />include		DirectShow.inc<br />.const<br />IDD_DS_DIALOG					equ		102<br />ICO_MAIN						equ		128<br />IDC_COMBO1						equ		1000<br />IDC_PHOTO						equ		1001<br />IDC_HAVEALOOK					equ		1002<br />IDC_STATIC_SCREEN				equ		1003<br />IDC_LIST1						equ		1006<br /><br />IID_FilterGraph					GUID &nbsp; &nbsp;sIID_FilterGraph<br />CLSID_FilterGraph				GUID &nbsp; &nbsp;sCLSID_FilterGraph<br />IID_IGraphBuilder				GUID &nbsp; &nbsp;sIID_IGraphBuilder<br />IID_IMediaControl				GUID &nbsp; &nbsp;sIID_IMediaControl<br />IID_IMediaEvent					GUID &nbsp; &nbsp;sIID_IMediaEvent<br />CLSID_CaptureGraphBuilder2		GUID	sCLSID_CaptureGraphBuilder2<br />IID_ICaptureGraphBuilder2		GUID	sIID_ICaptureGraphBuilder2<br />IID_IVideoWindow				GUID &nbsp; &nbsp;sIID_IVideoWindow<br />IID_IMediaEventEx				GUID &nbsp; &nbsp;sIID_IMediaEventEx<br />MEDIATYPE_Video					GUID &nbsp; &nbsp;sMEDIATYPE_Video<br />PIN_CATEGORY_PREVIEW			GUID &nbsp; &nbsp;sPIN_CATEGORY_PREVIEW<br />PIN_CATEGORY_CAPTURE			GUID &nbsp; &nbsp;sPIN_CATEGORY_CAPTURE<br />CLSID_SystemDeviceEnum			GUID	sCLSID_SystemDeviceEnum<br />IID_ICreateDevEnum				GUID	sIID_ICreateDevEnum<br />CLSID_VideoInputDeviceCategory	GUID	sCLSID_VideoInputDeviceCategory<br />IID_IBaseFilter					GUID	sIID_IBaseFilter<br />CLSID_SampleGrabber				GUID	sCLSID_SampleGrabber<br />IID_ISampleGrabber				GUID	sIID_ISampleGrabber<br />MEDIASUBTYPE_RGB24				GUID	sMEDIASUBTYPE_RGB24<br />IID_ISampleGrabberCB			GUID	sIID_ISampleGrabberCB<br />.data?<br />hInstance						dd		?<br />hWinMain						dd		?<br />pCreateDevEnum					dd		?<br />pEm								dd		?<br />pM								dd		?<br />cFetched						dd		?<br />pBag							dd		?<br />m_pGB							dd		?<br />m_pCapture						dd		?<br />m_pMC							dd		?<br />m_pVW							dd		?<br />m_pGrabber						dd		?<br />pGrabBase						dd		?<br />pFilter							dd		?<br /><br />hFile							dd		?<br />bOneShot						BOOL	?<br />bmfHdr							BITMAPFILEHEADER&lt;&gt;<br />bi								BITMAPINFO &lt;&gt;<br />pMemory							dd	?<br />dwMemSize						dd	?<br /><br />ImageHeight						dd		?<br />ImageWidth						dd		?<br />.DATA<br />var								VARIANT			&lt;&gt;<br />mt								AM_MEDIA_TYPE	&lt;&gt;<br /><br />.code<br />if		DEBUG<br />pushad<br />		include		\masm32\debug\Debug.asm<br />popad<br />endif<br />CSampleGrabberCB	proc uses ebx edi esi<br />	pushad<br />	popad<br />	mov		eax,TRUE<br />	ret<br />CSampleGrabberCB	endp<br />DlgProc proc uses ebx edi esi hWnd:HWND,uMsg:UINT,wParam:WPARAM,lParam:LPARAM<br />	mov		eax,uMsg<br />	.if eax==WM_INITDIALOG<br />		push	hWnd<br />		pop		hWinMain<br />		INVOKE	CoInitialize,NULL<br />		invoke	LoadIcon,hInstance,ICO_MAIN<br />		invoke	SendMessage,hWinMain,WM_SETICON,ICON_BIG,eax<br />		mov		bOneShot,FALSE<br />	.elseif eax==WM_COMMAND<br />		mov	eax,wParam<br />		.if		ax ==	IDOK<br />				invoke	CoCreateInstance,addr CLSID_FilterGraph,NULL,CLSCTX_INPROC_SERVER,addr IID_IGraphBuilder,addr m_pGB<br />				invoke	CoCreateInstance,addr CLSID_CaptureGraphBuilder2 , NULL, CLSCTX_INPROC,addr IID_ICaptureGraphBuilder2,addr m_pCapture<br />				.if		eax!=S_OK<br />						invoke		MessageBox,NULL,CTXT(&quot;Failed to build CaptureGraphBuilder2 interface!&quot;),NULL,MB_OK<br />				.endif<br />				coinvoke	m_pCapture,ICaptureGraphBuilder2,SetFiltergraph,m_pGB<br />				coinvoke	m_pGB,IGraphBuilder,QueryInterface,ADDR IID_IMediaControl,ADDR m_pMC<br />				.if			eax!=S_OK<br />							invoke		MessageBox,NULL,CTXT(&quot;Failed to Query the Interface of IMediaControl!&quot;),NULL,MB_OK<br />				.endif<br />				coinvoke	m_pGB,IGraphBuilder,QueryInterface,ADDR IID_IVideoWindow,ADDR m_pVW<br />				.if			eax!=S_OK<br />							invoke		MessageBox,NULL,CTXT(&quot;Failed to get video interfaces!&quot;),NULL,MB_OK<br />				.endif<br />				invoke		CoCreateInstance,addr CLSID_SystemDeviceEnum,NULL,CLSCTX_INPROC_SERVER,addr IID_ICreateDevEnum,addr pCreateDevEnum				<br />				.if			eax!=NOERROR<br />							invoke		MessageBox,NULL,CTXT(&quot;Failed to Create Instance of SystemDeviceEnum!&quot;),NULL,MB_OK<br />				.endif<br />				coinvoke	pCreateDevEnum,ICreateDevEnum,CreateClassEnumerator,addr CLSID_VideoInputDeviceCategory,addr pEm, 0	<br />				.if			eax!=NOERROR<br />							invoke		MessageBox,NULL,CTXT(&quot;Failed to Create ClassEnumerator!&quot;),NULL,MB_OK<br />				.endif<br />				coinvoke	pEm,IEnumMoniker,Reset<br />				coinvoke	pEm,IEnumMoniker,Next,1,addr pM,addr cFetched<br />				coinvoke	pM,IMoniker,BindToObject,0,0,addr IID_IBaseFilter,addr pFilter<br />				coinvoke	pM,IMoniker,Release<br />				coinvoke	m_pGB,IGraphBuilder,AddFilter,pFilter,unicode(&quot;Capture Filter&quot;)<br />				invoke 		CoCreateInstance,addr CLSID_SampleGrabber,NULL,CLSCTX_INPROC_SERVER,addr IID_IBaseFilter,addr m_pGrabber <br />				.if			!m_pGrabber<br />							invoke		MessageBox,NULL,CTXT(&quot;Fail to create SampleGrabber, maybe qedit.dll is not registered?&quot;),NULL,MB_OK<br />				.endif<br />				invoke		RtlZeroMemory,addr mt,sizeof AM_MEDIA_TYPE<br />				invoke		RtlMoveMemory,addr mt.majortype,addr MEDIATYPE_Video,sizeof MEDIATYPE_Video<br />				invoke		RtlMoveMemory,addr mt.subtype,addr MEDIASUBTYPE_RGB24,sizeof MEDIASUBTYPE_RGB24<br />				coinvoke	m_pGrabber,ISampleGrabber,SetMediaType,addr mt<br />				.if			eax<br />							invoke		MessageBox,NULL,CTXT(&quot;Fail to set media type!&quot;),NULL,MB_OK<br />				.endif<br />				coinvoke	m_pGB,IFilterGraph,AddFilter,pGrabBase,unicode(&quot;Grabber&quot;)<br />				.if			!eax<br />							invoke		MessageBox,NULL,CTXT(&quot;Fail to put sample grabber in graph&quot;),NULL,MB_OK<br />				.endif<br />				coinvoke	m_pCapture,ICaptureGraphBuilder2,RenderStream,addr PIN_CATEGORY_PREVIEW,addr MEDIATYPE_Video,pFilter,pGrabBase,NULL<br />				.if			eax<br />							coinvoke	m_pCapture,ICaptureGraphBuilder2,RenderStream,addr PIN_CATEGORY_CAPTURE,addr MEDIATYPE_Video,pFilter,pGrabBase,NULL<br />				.endif<br />				.if			eax<br />							invoke		MessageBox,NULL,CTXT(&quot;Can’t build the graph&quot;),NULL,MB_OK<br />				.endif<br />				coinvoke	m_pGrabber,ISampleGrabber,GetConnectedMediaType,addr mt<br />				.if			eax<br />							invoke		MessageBox,NULL,CTXT(&quot;Failt to read the connected media type&quot;),NULL,MB_OK<br />				.endif<br />				mov			ImageWidth,320<br />				mov			ImageHeight,240<br />				.if			mt.cbFormat<br />							mov			mt.cbFormat,NULL<br />							mov			mt.pbFormat,NULL<br />				.endif<br />				.if			mt.pUnk<br />							;coinvoke	mt.pUnk,Release<br />							mov			mt.pUnk,NULL<br />				.endif<br />				coinvoke	m_pGrabber,ISampleGrabber,SetBufferSamples,FALSE<br />				coinvoke	m_pGrabber,ISampleGrabber,SetOneShot,FALSE<br />				;coinvoke	m_pGrabber,ISampleGrabber,SetCallback,addr CSampleGrabberCB,1<br />				coinvoke	m_pMC,IMediaControl,Run<br />				.if			!eax<br />							invoke		MessageBox,NULL,CTXT(&quot;Couldn’t run the graph!&quot;),NULL,MB_OK<br />				.endif<br />				<br />		.elseif	eax==IDC_PHOTO<br />				mov		bOneShot,TRUE<br />		.endif<br />	.elseif eax==WM_CLOSE<br />				coinvoke	m_pMC,IMediaControl,StopWhenReady<br />				coinvoke	m_pMC,IMediaControl,Release<br />				coinvoke	m_pGB,IFilterGraph,Release<br />				coinvoke	m_pGB,IGraphBuilder,Release<br />				coinvoke	m_pCapture,ICaptureGraphBuilder2,Release<br />		INVOKE	CoUninitialize<br />		invoke	EndDialog,hWinMain,0<br />	.else<br />		mov		eax,FALSE<br />		ret<br />	.endif<br />	mov		eax,TRUE<br />	ret<br />DlgProc endp<br />start:<br />	invoke	GetModuleHandle,NULL<br />	mov		hInstance,eax<br />	invoke	DialogBoxParam,hInstance,IDD_DS_DIALOG,NULL,addr DlgProc,NULL<br />	invoke	ExitProcess,0<br />end start<br /></code></pre><br /><br /><span style="font-size:8pt><em>Edit by SpooK: added code tags.</em></span></div>
    <div class="meta">Posted on 2010-03-17 03:16:54 by pmason_rose</div>
   </div>
   <div class="post" id="post-211037">
    <div class="subject"><a href="#post-211037">the  ds.rc</a></div>
    <div class="body"><pre><code><br />#include	&quot;\MASM32\include\resource.h&quot;<br /><br />#define IDD_DS_DIALOG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 102<br />#define ICO_MAIN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 		128<br />#define IDC_PHOTO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1001<br />ICO_MAIN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ICON &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;MAIN.ico&quot;<br />IDD_DS_DIALOG DIALOGEX 100, 100, 80, 20<br />STYLE WS_POPUP | WS_VISIBLE | WS_CAPTION | WS_SYSMENU<br />CAPTION &quot;DS&quot;<br />FONT 9, &quot;MS Shell Dlg&quot;, 0, 0<br />BEGIN<br /> &nbsp; &nbsp;DEFPUSHBUTTON &nbsp; &quot;preview&quot;,IDOK,2,4,32,12<br /> &nbsp; &nbsp;PUSHBUTTON &nbsp; &nbsp; &nbsp;&quot;capture&quot;,IDC_PHOTO,40,4,32,12<br />END<br /></code></pre><br /><br /><span style="font-size:8pt><em>Edit by SpooK: added code tags.</em></span></div>
    <div class="meta">Posted on 2010-03-17 03:17:43 by pmason_rose</div>
   </div>
   <div class="post" id="post-211038">
    <div class="subject"><a href="#post-211038">The  DirectShow.inc</a></div>
    <div class="body"><pre><code><br />OATRUE			equ		-1<br />OAFALSE			equ		0<br /><br />Stopped			equ		0<br />Paused			equ		Stopped	+1<br />Running			equ		Paused+1<br /><br /><br />sTIME_FORMAT_MEDIA_TIME		TEXTEQU			&lt;{07b785574H, 08c82H, 011cfH, {0bcH, 00cH, 000H, 0aaH, 000H, 0acH, 074H, 0f6H}}&gt;<br />;	Name:DirectShow.inc			<br />;	Author:HuangLilong	(EMail:landyu@163.com)<br />;	modify	by pmason_rose	2008-03-02<br />;	Date:2004-10-17<br />;	Version:V1.0<br />;--------------------------------------------------------------------------------------------------------<br /><br />; Structures and Equates<br />;-------------------------------------------------------------------------------------------------------<br /><br />OATRUE			equ		-1<br />OAFALSE			equ		0<br /><br />Stopped			equ		0<br />Paused			equ		Stopped	+1<br />Running			equ		Paused+1<br /><br /><br />sTIME_FORMAT_MEDIA_TIME		TEXTEQU			&lt;{07b785574H, 08c82H, 011cfH, {0bcH, 00cH, 000H, 0aaH, 000H, 0acH, 074H, 0f6H}}&gt;<br />sIID_IDispatch				TEXTEQU			&lt;{000020400H, 00000H, 00000H, {0C0H, 000H, 000H, 000H, 000H, 000H, 000H, 046H}}&gt;<br />sCLSID_IDispatch			TEXTEQU			&lt;{000020400H, 00000H, 00000H, {0C0H, 000H, 000H, 000H, 000H, 000H, 000H, 046H}}&gt;<br />_vtIDispatch MACRO CastName:REQ<br />	;IUnknown methods <br /> &nbsp; &nbsp;_vtIUnknown CastName<br /> &nbsp; &nbsp;; IDispatch methods<br />	&amp;CastName&amp;_GetTypeInfoCount			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetTypeInfo				comethod4 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetIDsOfNames			comethod6 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_Invoke					comethod9 ?<br />ENDM<br />IDispatch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRUCT<br /> &nbsp; &nbsp;_vtIDispatch &nbsp;IDispatch<br />IDispatch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENDS<br />sIID_FilterGraph			TEXTEQU			&lt;{0e436ebb3H, 0524fH, 011ceH, {09fH, 053H, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />sCLSID_FilterGraph			TEXTEQU			&lt;{0e436ebb3H, 0524fH, 011ceH, {09fH, 053H, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />_vtIFilterGraph MACRO CastName:REQ<br /> &nbsp; &nbsp;; IUnknown methods <br /> &nbsp; &nbsp;_vtIUnknown CastName<br /> &nbsp; &nbsp;; IFilterGraph methods<br />; &nbsp; &nbsp;&amp;CastName&amp;_GetPath &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;comethod5 ?		;comment by pmason_rose<br /> &nbsp; &nbsp;&amp;CastName&amp;_AddFilter				comethod3 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_RemoveFilter				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_EnumFilters				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_FindFilterByName			comethod3 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_ConnectDirect			comethod4 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_Reconnect				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_Disconnect				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_SetDefaultSyncSource		comethod1 ?<br />ENDM<br />IFilterGraph &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRUCT<br /> &nbsp; &nbsp;_vtIFilterGraph IFilterGraph<br />IFilterGraph &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENDS<br />sIID_IGraphBuilder			TEXTEQU			&lt;{056a868a9H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />sCLSID_IGraphBuilder		TEXTEQU			&lt;{056a868a9H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />_vtIGraphBuilder MACRO CastName:REQ		;by pmason_rose<br /> &nbsp; &nbsp;; IFilterGraph methods <br /> &nbsp; &nbsp;_vtIFilterGraph CastName<br /> &nbsp; &nbsp;; IGraphBuilder methods<br /> &nbsp; &nbsp;&amp;CastName&amp;_Connect					comethod3 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_Render					comethod2 ?<br />	&amp;CastName&amp;_RenderFile				comethod3 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_AddSourceFilter			comethod4 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_SetLogFile				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_Abort					comethod1 ?<br />	&amp;CastName&amp;_ShouldOperationContinue	comethod1 ?<br />ENDM<br />IGraphBuilder &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRUCT<br /> &nbsp; &nbsp;_vtIGraphBuilder IGraphBuilder<br />IGraphBuilder &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENDS<br />sIID_IMediaControl			TEXTEQU				&lt;{056a868b1H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />sCLSID_IMediaControl		TEXTEQU				&lt;{056a868b1H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />_vtIMediaControl MACRO CastName:REQ		;by pmason_rose<br /> &nbsp; &nbsp;; IDispatch methods <br /> &nbsp; &nbsp;_vtIDispatch CastName<br /> &nbsp; &nbsp;; IMediaControl methods<br />	&amp;CastName&amp;_Run						comethod1 ?<br />	&amp;CastName&amp;_Pause					comethod1 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_Stop						comethod1 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetState					comethod3 ? <br /> &nbsp; &nbsp;&amp;CastName&amp;_RenderFile				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_AddSourceFilter			comethod3 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_FilterCollection		comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_RegFilterCollection	comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_StopWhenReady			comethod1 ?<br />ENDM<br />IMediaControl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRUCT<br /> &nbsp; &nbsp;_vtIMediaControl IMediaControl<br />IMediaControl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENDS<br />sIID_IMediaEvent			TEXTEQU				&lt;{056a868b6H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />sCLSID_IMediaEvent			TEXTEQU				&lt;{056a868b6H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />_vtIMediaEvent MACRO CastName:REQ		;by pmason_rose<br /> &nbsp; &nbsp;; IDispatch methods <br /> &nbsp; &nbsp;_vtIDispatch CastName<br /> &nbsp; &nbsp;; IMediaEvent methods<br />	&amp;CastName&amp;_GetEventHandle			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetEvent					comethod5 ?<br />	&amp;CastName&amp;_WaitForCompletion		comethod3 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_CancelDefaultHandling	comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_RestoreDefaultHandling	comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_FreeEventParams			comethod4 ?<br />ENDM<br />IMediaEvent &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRUCT<br /> &nbsp; &nbsp;_vtIMediaEvent IMediaEvent<br />IMediaEvent &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENDS<br />sIID_IMediaEventEx			TEXTEQU				&lt;{056a868c0H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />sCLSID_IMediaEventEx		TEXTEQU				&lt;{056a868c0H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />_vtIMediaEventEx MACRO CastName:REQ<br /> &nbsp; &nbsp;; IMediaEvent methods <br /> &nbsp; &nbsp;_vtIMediaEvent CastName<br /> &nbsp; &nbsp;; IMediaEventEx methods<br />	&amp;CastName&amp;_SetNotifyWindow			comethod4 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_SetNotifyFlags			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetNotifyFlags			comethod2 ?<br />ENDM<br />IMediaEventEx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRUCT<br /> &nbsp; &nbsp;_vtIMediaEventEx IMediaEventEx<br />IMediaEventEx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENDS<br />sIID_IBasicVideo			TEXTEQU				&lt;{056a868b5H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />sCLSID_IBasicVideo			TEXTEQU				&lt;{056a868b5H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />_vtIBasicVideo MACRO CastName:REQ<br /> &nbsp; &nbsp;; IDispatch methods <br /> &nbsp; &nbsp;_vtIDispatch CastName<br /> &nbsp; &nbsp;; IBasicVideo methods<br />	&amp;CastName&amp;_get_AvgTimePerFrame				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_BitRate						comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_BitErrorRate					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_VideoWidth					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_VideoHeight					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_SourceLeft					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_SourceLeft					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_SourceWidth					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_SourceWidth					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_SourceTop					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_SourceTop					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_SourceHeight					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_SourceHeight					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_DestinationLeft				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_DestinationLeft				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_DestinationWidth				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_DestinationWidth				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_DestinationTop				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_DestinationTop				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_DestinationHeight			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_DestinationHeight			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_SetSourcePosition				comethod5 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetSourcePosition				comethod5 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_SetDefaultSourcePosition			comethod5 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_SetDestinationPosition			comethod5 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetDestinationPosition			comethod5 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_SetDefaultDestinationPosition	comethod1 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetVideoSize						comethod3 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetVideoPaletteEntries			comethod5 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetCurrentImage					comethod3 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_IsUsingDefaultSource				comethod1 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_IsUsingDefaultDestination		comethod1 ?<br />ENDM<br />IBasicVideo &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRUCT<br /> &nbsp; &nbsp;_vtIBasicVideo IBasicVideo<br />IBasicVideo &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENDS<br />sIID_IBasicAudio			TEXTEQU				&lt;{056a868b3H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br /><br />sCLSID_IBasicAudio			TEXTEQU				&lt;{056a868b3H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />_vtIBasicAudio MACRO CastName:REQ<br /> &nbsp; &nbsp;; IDispatch methods <br /> &nbsp; &nbsp;_vtIDispatch CastName<br /> &nbsp; &nbsp;; IBasicAudio methods<br />	&amp;CastName&amp;_put_Volume				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_Volume				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_Balance				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_Balance				comethod2 ?<br />ENDM<br />IBasicAudio &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRUCT<br /> &nbsp; &nbsp;_vtIBasicAudio IBasicAudio<br />IBasicAudio &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENDS<br />sIID_IVideoWindow			TEXTEQU				&lt;{056a868b4H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />sCLSID_IVideoWindow			TEXTEQU				&lt;{056a868b4H, 00ad4H, 011ceH, {0b0H, 03aH, 000H, 020H, 0afH, 00bH, 0a7H, 070H}}&gt;<br />_vtIVideoWindow MACRO CastName:REQ<br /> &nbsp; &nbsp;; IDispatch methods <br /> &nbsp; &nbsp;_vtIDispatch CastName<br /> &nbsp; &nbsp;; IVideoWindow methods<br />	&amp;CastName&amp;_put_Caption					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_Caption					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_WindowStyle				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_WindowStyle				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_WindowStyleEx			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_WindowStyleEx			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_AutoShow					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_AutoShow					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_WindowState				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_WindowState				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_BackgroundPalette		comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_BackgroundPalette		comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_Visible					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_Visible					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_Left						comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_Left						comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_Width					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_Width					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_Top						comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_Top						comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_Height					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_Height					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_Owner					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_Owner					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_MessageDrain				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_MessageDrain				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_BorderColor				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_BorderColor				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_get_FullScreenMode			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_put_FullScreenMode			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_SetWindowForeground			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_NotifyOwnerMessage			comethod5 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_SetWindowPosition			comethod5 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetWindowPosition			comethod5 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetMinIdealImageSize			comethod3 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetMaxIdealImageSize			comethod3 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetRestorePosition			comethod5 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_HideCursor					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_IsCursorHidden				comethod2 ?<br />ENDM<br />IVideoWindow &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRUCT<br /> &nbsp; &nbsp;_vtIVideoWindow IVideoWindow<br />IVideoWindow &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENDS<br />sIID_IMediaSeeking			TEXTEQU				&lt;{036b73880H, 0c2c8H, 011cfH, {08bH, 046H, 000H, 080H, 05fH, 06cH, 0efH, 060H}}&gt;<br />sCLSID_IMediaSeeking		TEXTEQU				&lt;{036b73880H, 0c2c8H, 011cfH, {08bH, 046H, 000H, 080H, 05fH, 06cH, 0efH, 060H}}&gt;<br />_vtIMediaSeeking MACRO CastName:REQ<br /> &nbsp; &nbsp;; IUnknown methods <br /> &nbsp; &nbsp;_vtIUnknown CastName<br /> &nbsp; &nbsp;; IMediaSeeking methods<br />	&amp;CastName&amp;_GetCapabilities				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_CheckCapabilities			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_IsFormatSupported			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_QueryPreferredFormat			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetTimeFormat				comethod2 ?<br />	&amp;CastName&amp;_IsUsingTimeFormat			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_SetTimeFormat				comethod2 ?<br />	&amp;CastName&amp;_GetDuration					comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetStopPosition				comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetCurrentPosition			comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_ConvertTimeFormat			comethod5 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_SetPositions					comethod5 ?<br />	&amp;CastName&amp;_GetPositions					comethod3 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetAvailable					comethod3 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_SetRate						comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetRate						comethod2 ?<br /> &nbsp; &nbsp;&amp;CastName&amp;_GetPreroll					comethod2 ?<br />ENDM<br />IMediaSeeking &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRUCT<br /> &nbsp; &nbsp;_vtIMediaSeeking IMediaSeeking<br />IMediaSeeking &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENDS<br />;by pmason_rose<br />sIID_ICaptureGraphBuilder2	TEXTEQU	&lt;{093E5A4E0H, 02D50H, 011d2H, {0ABH, 0FAH, 000H, 0A0H, 0C9H, 0C6H, 0E3H, 08DH}}&gt;<br />sCLSID_CaptureGraphBuilder2	TEXTEQU	&lt;{0BF87B6E1H, 08C27H, 011d0H, {0B3H, 0F0H, 000H, 0AAH, 000H, 037H, 061H, 0C5H}}&gt;<br />_vtICaptureGraphBuilder2 MACRO CastName:REQ	;by pmason_rose<br /> &nbsp; &nbsp;; IUnknown methods <br /> &nbsp; &nbsp;_vtIUnknown CastName<br /> &nbsp; &nbsp;;ICaptureGraphBuilder2 &nbsp;methods<br />	&amp;CastName&amp;_SetFiltergraph		comethod2 ?<br />	&amp;CastName&amp;_GetFiltergraph		comethod2 ?<br />	&amp;CastName&amp;_SetOutputFileName	comethod5 ?<br />	&amp;CastName&amp;_FindInterface		comethod6 ?<br />	&amp;CastName&amp;_RenderStream			comethod6 ?<br />	&amp;CastName&amp;_ControlStream		comethod8 ?<br />	&amp;CastName&amp;_AllocCapFile			comethod3 ?<br />	&amp;CastName&amp;_CopyCaptureFile		comethod5 ?<br />	&amp;CastName&amp;_FindPin				comethod8 ?<br />ENDM<br /><br />ICaptureGraphBuilder2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRUCT<br /> &nbsp; &nbsp;_vtICaptureGraphBuilder2 ICaptureGraphBuilder2<br />ICaptureGraphBuilder2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENDS<br />sMEDIATYPE_Video	TEXTEQU	&lt;{073646976h,00000h,00010h,{080h,000h,000h,0AAh,000h,038h,09Bh,071h}}&gt;<br />sPIN_CATEGORY_PREVIEW	TEXTEQU	&lt;{0fb6c4282h,00353h,011d1h,{090h,05fh,000h,000h,0c0h,0cch,016h,0bah}}&gt;<br />sPIN_CATEGORY_CAPTURE	TEXTEQU	&lt;{0fb6c4281h,00353h,011d1h,{090h,05fh,000h,000h,0c0h,0cch,016h,0bah}}&gt;<br />sCLSID_SystemDeviceEnum	TEXTEQU	&lt;{062BE5D10h,060EBh,011d0h,{0BDh,03Bh,000h,0A0h,0C9h,011h,0CEh,086h}}&gt;<br />sIID_ICreateDevEnum		TEXTEQU	&lt;{029840822h,05B84h,011D0h,{0BDh,03Bh,000h,0A0h,0C9h,011h,0CEh,086h}}&gt;<br />sCLSID_VideoInputDeviceCategory	TEXTEQU	&lt;{0860BB310h,05D01h,011d0h,{0BDh,03Bh,000h,0A0h,0C9h,011h,0CEh,086h}}&gt;<br />_vtICreateDevEnum	MACRO CastName:REQ	;by pmason_rose<br /> &nbsp; &nbsp;; IUnknown methods <br /> &nbsp; &nbsp;_vtIUnknown CastName<br />	&amp;CastName&amp;_CreateClassEnumerator		comethod4 ?<br />ENDM<br />ICreateDevEnum	STRUCT	;by pmason_rose<br />	_vtICreateDevEnum	ICreateDevEnum<br />ICreateDevEnum	ENDS<br /><br />sIID_IBaseFilter		TEXTEQU	&lt;{056a86895h,00ad4h,011ceh,{0b0h,03ah,000h,020h,0afh,00bh,0a7h,070h}}&gt;<br /><br />_vtIBaseFilter	MACRO CastName:REQ	;by pmason_rose<br /> &nbsp; &nbsp;; IUnknown methods <br /> &nbsp; &nbsp;_vtIUnknown CastName<br />	&amp;CastName&amp;_EnumPins		comethod2 ?<br />	&amp;CastName&amp;_FindPin		comethod3	?<br />	&amp;CastName&amp;_QueryFilterInfo		comethod2	?<br />	&amp;CastName&amp;_JoinFilterGraph		comethod3	?<br />	&amp;CastName&amp;_QueryVendorInfo		comethod2	?<br />ENDM<br />IBaseFilter	STRUCT<br />	_vtIBaseFilter	IBaseFilter<br />IBaseFilter	ENDS<br /><br />_vtIEnumMoniker	MACRO CastName:REQ	;by pmason_rose<br /> &nbsp; &nbsp;; IUnknown methods <br /> &nbsp; &nbsp;_vtIUnknown CastName<br />	&amp;CastName&amp;_Next			comethod4 ?<br />	&amp;CastName&amp;_Skip			comethod2	?<br />	&amp;CastName&amp;_Reset		comethod1	?<br />	&amp;CastName&amp;_Clone		comethod2	?<br />ENDM<br />IEnumMoniker	STRUCT<br />	_vtIEnumMoniker	IEnumMoniker<br />IEnumMoniker	ENDS<br />_vtIMoniker	MACRO CastName:REQ	;by pmason_rose<br /> &nbsp; &nbsp;; IUnknown methods <br /> &nbsp; &nbsp;_vtIUnknown CastName<br />	&amp;CastName&amp;_GetClassID		comethod3	?<br />	&amp;CastName&amp;_IsDirty		comethod2	?<br />	&amp;CastName&amp;_Load		comethod3	?<br />	&amp;CastName&amp;_Save		comethod4	?<br />	&amp;CastName&amp;_GetSizeMax		comethod3	?<br /><br />	&amp;CastName&amp;_BindToObject	comethod5 ?<br />	&amp;CastName&amp;_BindToStorage	comethod5	?<br />	&amp;CastName&amp;_Reduce		comethod5	?<br />	&amp;CastName&amp;_ComposeWith		comethod4	?<br />	&amp;CastName&amp;_Enum		comethod3	?<br />	&amp;CastName&amp;_IsEqual		comethod2	?<br />	&amp;CastName&amp;_Hash		comethod2	?<br />	&amp;CastName&amp;_IsRunning		comethod4	?<br />	&amp;CastName&amp;_GetTimeOfLastChange		comethod4	?<br />	&amp;CastName&amp;_Inverse		comethod2	?<br />	&amp;CastName&amp;_CommonPrefixWith		comethod3	?<br />	&amp;CastName&amp;_RelativePathTo	comethod3	?<br />	&amp;CastName&amp;_GetDisplayName	comethod4	?<br />	&amp;CastName&amp;_ParseDisplayName	comethod6	?<br />	&amp;CastName&amp;_IsSystemMoniker	comethod2	?<br />ENDM<br />IMoniker	STRUCT<br />	_vtIMoniker	IMoniker<br />IMoniker	ENDS<br />sIID_IPropertyBag		TEXTEQU	&lt;{055272A00h,042CBh,011CEh,{081h,035h,000h,0AAh,000h,04Bh,0B8h,051h}}&gt;<br />_vtIPropertyBag	MACRO CastName:REQ	;by pmason_rose<br /> &nbsp; &nbsp;; IUnknown methods <br /> &nbsp; &nbsp;_vtIUnknown CastName<br />	&amp;CastName&amp;_Read		comethod4	?<br />	&amp;CastName&amp;_Write	comethod3	?<br />ENDM<br />IPropertyBag	STRUCT<br />	_vtIPropertyBag		IPropertyBag<br />IPropertyBag	ENDS<br />sCLSID_SampleGrabber	TEXTEQU	&lt;{0C1F400A0h,03F08h,011D3h,{09Fh,00Bh,000h,060h,008h,003h,09Eh,037h}}&gt;<br />sIID_ISampleGrabber		TEXTEQU	&lt;{06B652FFFh,011FEh,04fceh,{092h,0ADh,002h,066h,0B5h,0D7h,0C7h,08Fh}}&gt;<br />_vtISampleGrabber	MACRO CastName:REQ	;by pmason_rose<br /> &nbsp; &nbsp;; IUnknown methods <br /> &nbsp; &nbsp;_vtIUnknown CastName<br />	&amp;CastName&amp;_SetOneShot				comethod2	?<br />	&amp;CastName&amp;_SetMediaType				comethod2	?<br />	&amp;CastName&amp;_GetConnectedMediaType	comethod2	?<br />	&amp;CastName&amp;_SetBufferSamples			comethod2	?<br />	&amp;CastName&amp;_GetCurrentBuffer			comethod3	?<br />	&amp;CastName&amp;_GetCurrentSample			comethod2	?<br />	&amp;CastName&amp;_SetCallback				comethod3	?<br />ENDM<br />ISampleGrabber	STRUCT<br />	_vtISampleGrabber	ISampleGrabber<br />ISampleGrabber	ENDS<br /><br />sMEDIASUBTYPE_RGB24		TEXTEQU	&lt;{0e436eb7dh,0524fh,011ceh,{09fh,053h,000h,020h,0afh,00bh,0a7h,070h}}&gt;<br /><br />sIID_ISampleGrabberCB	TEXTEQU	&lt;{00579154Ah,02B53h,04994h,{0B0h,0D0h,0E7h,073h,014h,08Eh,0FFh,085h}}&gt;<br />_vtISampleGrabberCB		MACRO	CastName:REQ	;by pmason_rose<br /> &nbsp; &nbsp;; IUnknown methods <br /> &nbsp; &nbsp;_vtIUnknown CastName<br />	&amp;CastName&amp;_SampleCB					comethod3	?<br />	&amp;CastName&amp;_BufferCB					comethod4	?<br />ENDM<br />ISampleGrabberCB		STRUCT<br />	_vtISampleGrabberCB	ISampleGrabberCB<br />ISampleGrabberCB		ENDS<br />AM_MEDIA_TYPE	STRUCT					;by pmason_rose<br /> &nbsp; &nbsp;majortype				GUID		&lt;&gt;<br />	subtype					GUID		&lt;&gt;<br />	bFixedSizeSamples		DWORD		?<br />	bTemporalCompression	DWORD		?<br />	lSampleSize				DWORD		?<br />	formattype				GUID		&lt;&gt;<br />	pUnk					DWORD		?<br />	cbFormat				DWORD		?<br />	pbFormat				DWORD		?<br />AM_MEDIA_TYPE	ENDS<br /></code></pre><br /><br /><span style="font-size:8pt><em>Edit by SpooK: added code tags.</em></span></div>
    <div class="meta">Posted on 2010-03-17 03:22:49 by pmason_rose</div>
   </div>
   <div class="post" id="post-211039">
    <div class="subject"><a href="#post-211039">the C++ code</a></div>
    <div class="body"><pre><code><br />//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />// Include ???<br />//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />#include &lt;atlbase.h&gt;<br />#include &lt;windows.h&gt;<br />#include &lt;DShow.h&gt;<br />#include &lt;qedit.h&gt;<br /><br />#define ICO_MAIN &nbsp; &nbsp; &nbsp; &nbsp;1000<br />#define DLG_MAIN &nbsp; &nbsp; &nbsp; &nbsp;1000<br />#define IDC_COUNTER &nbsp; &nbsp; 1001<br />#define IDC_PAUSE &nbsp; &nbsp; &nbsp; 1002<br /><br />//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />// ????:<br />//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />HWND	hWinMain;<br />BOOL	bOneShot=FALSE;//????<br />int		m_pVW = NULL;<br />int		m_pMC = NULL;<br />int		m_pGB = NULL;<br />int		m_pCapture = NULL; <br /><br />class CSampleGrabberCB : public ISampleGrabberCB <br />{<br />public:<br />	long lWidth;<br />	long lHeight;<br /><br />	STDMETHODIMP QueryInterface(REFIID riid, void ** ppv)<br />	{<br />		if( riid == IID_ISampleGrabberCB || riid == IID_IUnknown )<br />		{<br />			*ppv = (void *) static_cast&lt;ISampleGrabberCB*&gt; ( this );<br />			return NOERROR;<br />		} <br />		return E_NOINTERFACE;<br />	}<br />	STDMETHODIMP_(ULONG) AddRef() { return 2; }<br />	STDMETHODIMP_(ULONG) Release() { return 1; }<br />	STDMETHODIMP SampleCB( double SampleTime, IMediaSample * pSample )<br />	{<br />		return 0;<br />	}<br />	STDMETHODIMP BufferCB( double dblSampleTime, BYTE * pBuffer, long lBufferSize )<br />	{<br />		return 0;<br />	}<br /><br />};<br />CSampleGrabberCB mCB;<br /><br />HRESULT CCaptureVideo::Init(int iDeviceID, HWND hWnd)<br />{<br />	HRESULT hr;<br />	hr=CoCreateInstance(CLSID_FilterGraph, NULL, CLSCTX_INPROC_SERVER, IID_IGraphBuilder, (void **)&amp;m_pGB);<br />	hr = CoCreateInstance (CLSID_CaptureGraphBuilder2 , NULL, CLSCTX_INPROC,<br />		IID_ICaptureGraphBuilder2, (void **) &amp;m_pCapture);<br />	if (FAILED(hr))return hr;<br />	m_pCapture-&gt;SetFiltergraph(m_pGB<br />	hr = m_pGB-&gt;QueryInterface(IID_IMediaControl, (void **)&amp;m_pMC);<br />	if (FAILED(hr))return hr;<br />	hr = m_pGB-&gt;QueryInterface(IID_IVideoWindow, (LPVOID *) &amp;m_pVW);<br /><br />	if (FAILED(hr))<br />	{<br />		AfxMessageBox(&quot;Failed to get video interfaces!&quot;);<br />		return hr;<br />	}<br />	// Bind Device Filter. We know the device because the id was passed in<br />//		if(!BindFilter(iDeviceID, &amp;m_pBF))return S_FALSE;<br />	CComPtr&lt;ICreateDevEnum&gt; pCreateDevEnum;<br />	hr = CoCreateInstance(CLSID_SystemDeviceEnum, NULL, CLSCTX_INPROC_SERVER,<br />		IID_ICreateDevEnum, (void**)&amp;pCreateDevEnum);<br />	if (hr != NOERROR)<br />	{<br />		return false;<br />	}<br />	CComPtr&lt;IEnumMoniker&gt; pEm;<br />	hr = pCreateDevEnum-&gt;CreateClassEnumerator(CLSID_VideoInputDeviceCategory,&amp;pEm, 0);<br />	if (hr != NOERROR) <br />	{<br />		return false;<br />	}<br />	pEm-&gt;Reset();<br />	ULONG cFetched;<br />	IMoniker *pM;<br />	hr = pEm-&gt;Next(1, &amp;pM, &amp;cFetched);<br /><br />	IBaseFilter **pFilter;<br />	pFilter	=	&amp;m_pBF	;<br />	pM-&gt;BindToObject(0, 0, IID_IBaseFilter, (void**)pFilter);<br />	pM-&gt;Release();<br />	hr = m_pGB-&gt;AddFilter(m_pBF, L&quot;Capture Filter&quot;);<br />	<br />	// create a sample grabber<br />	hr = m_pGrabber.CoCreateInstance( CLSID_SampleGrabber );<br />	if( !m_pGrabber )<br />	{<br />		AfxMessageBox(&quot;Fail to create SampleGrabber, maybe qedit.dll is not registered?&quot;);<br />		return hr;<br />	}<br />	CComQIPtr&lt; IBaseFilter, &amp;IID_IBaseFilter &gt; pGrabBase( m_pGrabber );<br /><br />	AM_MEDIA_TYPE mt; <br />	ZeroMemory(&amp;mt, sizeof(AM_MEDIA_TYPE));<br />	mt.majortype = MEDIATYPE_Video;<br />	mt.subtype = MEDIASUBTYPE_RGB24;<br />	hr = m_pGrabber-&gt;SetMediaType(&amp;mt);<br /><br />	if( FAILED( hr ) )<br />	{<br />		AfxMessageBox(&quot;Fail to set media type!&quot;);<br />		return hr;<br />	}<br />	<br />	hr = m_pGB-&gt;AddFilter( pGrabBase, L&quot;Grabber&quot; );<br />	if( FAILED( hr ) )<br />	{<br />		AfxMessageBox(&quot;Fail to put sample grabber in graph&quot;);<br />		return hr;<br />	}<br /><br />	// try to render preview/capture pin<br />	hr = m_pCapture-&gt;RenderStream(&amp;PIN_CATEGORY_PREVIEW, &amp;MEDIATYPE_Video,m_pBF,pGrabBase,NULL);<br />	if( FAILED( hr ) )<br />		hr = m_pCapture-&gt;RenderStream(&amp;PIN_CATEGORY_CAPTURE, &amp;MEDIATYPE_Video,m_pBF,pGrabBase,NULL);<br /> 	if( FAILED( hr ) )<br />	{<br />		AfxMessageBox(&quot;Can’t build the graph&quot;);<br />		return hr;<br />	}<br /><br />	hr = m_pGrabber-&gt;GetConnectedMediaType( &amp;mt );//retrieves the media type for the connection <br />	 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//on the input pin of the Sample Grabber<br />	if ( FAILED( hr) )<br />	{<br />		AfxMessageBox(&quot;Failt to read the connected media type&quot;);<br />		return hr;<br />	}<br /><br />	VIDEOINFOHEADER * vih = (VIDEOINFOHEADER*) mt.pbFormat;<br />	mCB.lWidth = vih-&gt;bmiHeader.biWidth;<br />	mCB.lHeight = vih-&gt;bmiHeader.biHeight;<br />	<br />	hr = m_pGrabber-&gt;SetBufferSamples( FALSE );//<br />	hr = m_pGrabber-&gt;SetOneShot( FALSE );//<br />	hr = m_pGrabber-&gt;SetCallback( &amp;mCB, 1 );//<br /><br />	<br />	hr = m_pMC-&gt;Run();//??????<br />	if(FAILED(hr)){AfxMessageBox(&quot;Couldn’t run the graph!&quot;);return hr;}<br />	return S_OK;<br />}<br /></code></pre><br /><br /><span style="font-size:8pt><em>Edit by SpooK: added code tags.</em></span></div>
    <div class="meta">Posted on 2010-03-17 03:23:35 by pmason_rose</div>
   </div>
   <div class="post" id="post-211052">
    <div class="subject"><a href="#post-211052">Re: How can I change the C++ code to  masm32</a></div>
    <div class="body">Have you EVER heard about attachments, &#039;code&#039; tags, or at least paste bin sites? o_O</div>
    <div class="meta">Posted on 2010-03-17 12:38:09 by ti_mo_n</div>
   </div>
   <div class="post" id="post-211053">
    <div class="subject"><a href="#post-211053">Re: How can I change the C++ code to  masm32</a></div>
    <div class="body"><div class="quote"><br />Have you EVER heard about attachments, &#039;code&#039; tags, or at least paste bin sites? o_O<br /></div><br /><br />Evidentally not.<br /><br /><strong>pmason_rose</strong>, first, the surest way to get people to ignore you is to plaster page after page of code.<br /><br />Second, look into <a target="_blank" href="http://objasm32.tripod.com/">ObjAsm32</a>.</div>
    <div class="meta">Posted on 2010-03-17 12:45:31 by SpooK</div>
   </div>
   <div class="post" id="post-211055">
    <div class="subject"><a href="#post-211055">Thank for your replay, here is the bin files,please have a look!</a></div>
    <div class="body">Thank for your replay, here is the bin files,please have a look!</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=3086" target="_blank">ds.c.rar</a></li>
      <li><a href="../../attachments/?id=3087" target="_blank">ds.asm.rar</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2010-03-17 21:36:09 by pmason_rose</div>
   </div>
  </div>
 </body>
</html>