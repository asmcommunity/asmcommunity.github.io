<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>More Problems with CRC32 - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=7218" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=7218">More Problems with CRC32</a></p>
   <div class="post" id="post-52270">
    <div class="subject"><a href="#post-52270">More Problems with CRC32</a></div>
    <div class="body">Okay here is the code but even when I enter the right key it still displays the wrong message and closes everything. I want it to open another window and close itself once the right password has been entered. Here is the data sections/.const section:<br /><br /><pre><code><br />include windows.inc<br />include user32.inc<br />include kernel32.inc<br />include gdi32.inc<br />include shell32.inc<br />include Comctl32.inc<br />include comdlg32.inc<br />include advapi32.inc<br />include masm32.INC<br /><br />includelib user32.lib<br />includelib kernel32.lib<br />includelib gdi32.lib<br />includelib shell32.lib<br />includelib Comctl32.lib<br />includelib comdlg32.lib<br />includelib advapi32.lib<br />INCLUDELIB crc32.lib<br />includelib C&#58;\masm32\LIB\masm32.lib<br /><br />WinMain				PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />WndProc				PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />PDlgProc            PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />crc32               PROTO STDCALL &#58;DWORD, &#58;DWORD<br /><br /><br /><br />.const<br /><br />IDD_DLG1            equ 1000<br /><br />IDC_BTN1            equ 1001<br />IDC_BTN2            equ 1002<br />IDC_BTN3            equ 1003<br />IDC_BTN4            equ 1006<br />IDC_BTN5            equ 1007<br />IDC_BTN6            equ 1008<br />IDC_BTN7            equ 1009<br />IDC_BTN8            equ 1010<br />IDC_BTN9            equ 1011<br />IDC_BTN10           equ 1012<br />IDC_BTN11           equ 1013<br />IDC_BTN12           equ 1014<br />IDC_BTN13           equ 1015<br /><br />IDC_STATUS          equ 1018<br /><br />IDC_EDT1            equ 1019<br />IDC_EDT5            equ 1021<br />IDC_EDT4            equ 1020<br /><br />.data<br />goodtxt             db &quot;Registration Successful!&quot;,0<br />goodcap             db &quot;Congrats!&quot;,0<br />badtxt              db &quot;Sorry Wrong Reg Key/Name&quot;,0<br />badcap              db &quot;Failure!&quot;,0<br /><br />.data?<br />hInstance			dd ?<br />CommandLine			dd ?<br />hWnd				dd ?  <br />phandle             dd ?<br />dwprocessid         dd ?<br />hwndStatus          dd ? <br />hPlg				dd ?<br />g_lpTranslated      DD ?<br />g_dbBuffer          Dd ?<br /></code></pre><br /> <br />and here is the actual code:<br /><br /><pre><code><br /><br />.686<br />.model flat,stdcall<br />option casemap&#58;none<br /><br />include winter.inc<br /><br />.code<br />INCLUDE crc32.ash<br />start&#58;<br /><br />  invoke CreateDialogParam,hInstance,IDD_DLG1,0,addr PDlgProc,FALSE<br /><br />call PDlgProc<br /><br /><br />@@hmm&#58;<br />    invoke CreateDialogParam,hInstance,addr DlgName,NULL,addr WndProc,NULL<br />     Invoke FindWindowEx,NULL,NULL,NULL,addr nameofwindow<br /><br />     invoke GetWindowThreadProcessId,eax,offset dwprocessid<br />     invoke OpenProcess,PROCESS_ALL_ACCESS,NULL,dwprocessid<br />     mov thecess,eax<br />      .if eax==FALSE<br />       	Invoke MessageBox,hInstance,offset StartErrorMessage,offset StartErrorCaption,MB_OK<br />       	ret<br />              	.endif<br /><br />	invoke GetModuleHandle,NULL<br />	mov    hInstance,eax<br />	invoke GetCommandLine<br />	invoke InitCommonControls<br />	invoke WinMain,hInstance,NULL,CommandLine,SW_SHOWDEFAULT<br />	invoke ExitProcess,eax<br /><br />WinMain proc hInst&#58;HINSTANCE,hPrevInst&#58;HINSTANCE,CmdLine&#58;LPSTR,CmdShow&#58;DWORD<br />	LOCAL	wc&#58;WNDCLASSEX<br />	LOCAL	msg&#58;MSG<br /><br />	mov		wc.cbSize,SIZEOF WNDCLASSEX<br />	mov		wc.style,CS_HREDRAW or CS_VREDRAW<br />	mov		wc.lpfnWndProc,OFFSET WndProc<br />	mov		wc.cbClsExtra,NULL<br />	mov		wc.cbWndExtra,DLGWINDOWEXTRA<br />	push	hInst<br />	pop		wc.hInstance<br />	mov		wc.hbrBackground,COLOR_BTNFACE+1<br />	mov		wc.lpszMenuName,NULL<br />	mov		wc.lpszClassName,OFFSET ClassName<br />	invoke LoadIcon,NULL,IDI_APPLICATION<br />	mov		wc.hIcon,eax<br />	mov		wc.hIconSm,eax<br />	invoke LoadCursor,NULL,IDC_ARROW<br />	mov		wc.hCursor,eax<br />	invoke RegisterClassEx,addr wc<br /><br />  	invoke ShowWindow,hWnd,SW_SHOWNORMAL<br />	invoke UpdateWindow,hWnd<br />	.while TRUE<br />		invoke GetMessage,addr msg,NULL,0,0<br />	  .BREAK .if !eax<br />		invoke TranslateMessage,addr msg<br />		invoke DispatchMessage,addr msg<br />	.endw<br />	mov		eax,msg.wParam<br />	ret<br /><br />WinMain endp<br />PDlgProc proc hWin&#58;HWND,uMsg&#58;UINT,wParam&#58;WPARAM,lParam&#58;LPARAM<br /><br />	mov		eax,uMsg<br />	.if eax==WM_INITDIALOG<br />		mov eax,hWin<br />		mov hPlg,eax<br />	.elseif eax==WM_COMMAND<br />		mov		eax,wParam<br />		and		eax,0FFFFh<br />		.endif<br />		.IF wParam==1015<br />            invoke  GetDlgItemText,hPlg, IDC_EDT4, offset g_dbBuffer, sizeof g_dbBuffer<br />            invoke  GetDlgItemInt,hPlg,IDC_EDT5,offset g_lpTranslated,FALSE<br />            invoke  lstrlen, OFFSET g_dbBuffer<br />            invoke  crc32, OFFSET g_dbBuffer,eax<br />            <br />                add eax,956874599<br />                sub eax,8<br />                add eax,20<br />                add eax,956874599<br />                add eax,956874599           <br />            <br />             .if eax==g_lpTranslated<br />            	invoke  MessageBox,0,addr goodtxt,addr goodcap,MB_OK<br />                jmp @@hmm<br />              .else<br />              	invoke  MessageBox,0,addr badtxt,addr badcap,MB_OK<br />              	jmp @@duh<br />              	<br />            .endif<br /><br /><br />                	<br />                  		<br />            .endif<br />      <br /> <br /><br />        <br />       <br />		<br />;	.elseif eax==WM_SIZE<br />	.if eax==WM_CLOSE<br />			mov		hPlg,0<br />		invoke EndDialog,hWin,NULL<br />	.else<br />		mov eax,FALSE<br />		ret<br />	.endif<br />	mov  eax,TRUE<br />	ret<br />	<br />	@@duh&#58;<br />invoke  DestroyWindow,hPlg<br />invoke  PostQuitMessage,NULL<br />		ret<br /><br />PDlgProc endp<br /><br /><br />WndProc proc hWin&#58;HWND,uMsg&#58;UINT,wParam&#58;WPARAM,lParam&#58;LPARAM<br /><br />	mov		eax,uMsg<br />	.if eax==WM_INITDIALOG<br />blah blah blah<br /></code></pre><br /><br />See what I do is if the reg code is right I jump to @@hmm and if its wrong i jump to @@duh.. Whats wrong here?? I think it may be something to do with CRC reading the wrong dialog controls but i may be wrong..</div>
    <div class="meta">Posted on 2002-08-08 21:49:28 by resistance_is_futile</div>
   </div>
   <div class="post" id="post-52277">
    <div class="subject"><a href="#post-52277">More Problems with CRC32</a></div>
    <div class="body"><pre><code>invoke  GetDlgItemInt,hPlg,IDC_EDT5,offset g_lpTranslated,FALSE<br />            invoke  lstrlen, OFFSET g_dbBuffer<br />            invoke  crc32, OFFSET g_dbBuffer,eax<br />           <br />                add eax,956874599<br />                sub eax,8<br />                add eax,20<br />                add eax,956874599<br />                add eax,956874599          <br />           <br />             .if eax==g_lpTranslated<br />            invoke  MessageBox,0,addr goodtxt,addr goodcap,MB_OK<br />                jmp @@hmm<br />              .else<br />              invoke  MessageBox,0,addr badtxt,addr badcap,MB_OK<br />              jmp @@duh<br />             <br />            .endif</code></pre>lpTranslated from psdk<div class="quote">lpTranslated <br /> Pointer to a variable that receives a success or failure value (TRUE indicates success, FALSE indicates failure). <br />If this parameter is NULL, the function returns no information about success or failure.</div>If you read further on the return values remarks<div class="quote">If the function succeeds, the variable pointed to by lpTranslated is set to TRUE, and the return value is the translated value of the control text. <br /><br />If the function fails, the variable pointed to by lpTranslated is set to FALSE, and the return value is zero. Note that, since zero is a possible translated value, a return value of zero does not by itself indicate failure.<br /><br />If lpTranslated is NULL, the function returns no information about success or failure.<br /><br />If the bSigned parameter is TRUE, specifying that the value to be retrieved is a signed integer value, cast the return value to an int type. To get extended error information, call GetLastError.<br /></div>In short lpTranslated holds either TRUE or FALSE that will determine if the function was a success or not. If it was, the return value will be in eax not on lpTranslated.</div>
    <div class="meta">Posted on 2002-08-08 23:01:13 by stryker</div>
   </div>
   <div class="post" id="post-52280">
    <div class="subject"><a href="#post-52280">More Problems with CRC32</a></div>
    <div class="body">&quot;g_lpTranslated&quot;<br /><br />Thats why the g is in front of that right? This worked fine when it was by itself because i programmed the registry program seperate from the main program which I shouldnt have but i did lol. Now im trying to combine them and ever since i tried it doesnt work :mad:</div>
    <div class="meta">Posted on 2002-08-08 23:24:50 by resistance_is_futile</div>
   </div>
   <div class="post" id="post-52282">
    <div class="subject"><a href="#post-52282">More Problems with CRC32</a></div>
    <div class="body">g_XXXXX means global variable its a hungarian notation used to determine what type/kind of variable being declared.<br /><br />lp == long pointer</div>
    <div class="meta">Posted on 2002-08-08 23:31:33 by stryker</div>
   </div>
   <div class="post" id="post-52291">
    <div class="subject"><a href="#post-52291">More Problems with CRC32</a></div>
    <div class="body">ahh I see.. lol it was working so well as i left it a single file..Now I have to add another buffer at least i think :rolleyes:</div>
    <div class="meta">Posted on 2002-08-09 00:44:21 by resistance_is_futile</div>
   </div>
  </div>
 </body>
</html>