<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Global Hooks prevention - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25927" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=113">Low Level Concepts</a> &raquo; <a href="../?id=25927">Global Hooks prevention</a></p>
   <div class="post" id="post-189023">
    <div class="subject"><a href="#post-189023">Global Hooks prevention</a></div>
    <div class="body">Hi there. Is there any way to prevent the global hooks (created, for example, by some malicious codes) from attaching to my process? Or at least some way to de-attach them?</div>
    <div class="meta">Posted on 2007-05-02 15:28:20 by ti_mo_n</div>
   </div>
   <div class="post" id="post-189025">
    <div class="subject"><a href="#post-189025">Re: Global Hooks prevention</a></div>
    <div class="body">Humm... dunno if there&#39;s any clean way (run your app with SYSTEM credentials, or as a different user and force all other users to be non-admins?) - or perhaps hooking either a lot of APIs, or at a lower (Nt* Zw*) level. But I don&#39;t know if there&#39;s a clean-and-easy way.<br /><br />For what purpose do you need this?<br /></div>
    <div class="meta">Posted on 2007-05-02 18:11:00 by f0dder</div>
   </div>
   <div class="post" id="post-189028">
    <div class="subject"><a href="#post-189028">Re: Global Hooks prevention</a></div>
    <div class="body">Mainly educational purposes. I wanted to write such an application (resistant to global hooks) just to prove that I can.<br /><br />Oh well, looks like I&#39;ll have to drop the idea, since there is no clean way to do that, as you say, and I don&#39;t like writing HaXX0roUz code ^^</div>
    <div class="meta">Posted on 2007-05-02 23:05:14 by ti_mo_n</div>
   </div>
   <div class="post" id="post-189042">
    <div class="subject"><a href="#post-189042">Re: Global Hooks prevention</a></div>
    <div class="body">other possible method - most hooks will be on kernel32 or user32...<br />you could load user32 / kernel32 into memory as a data file, perform<br />fixups on the data (reloc shit).. and then &#39;refill&#39; the api&#39;s within your<br />code.. therby getting the &#39;clean&#39; kernel32 / user32 in your code, bypassing<br />the hooks...<br /><br />ultimately, this all depends on the level that the hooks were applied<br />and whether the kernel32 / user32 / whatever module was actually patched<br />on disk or not...<br /><br />its doable though... just depends on your method</div>
    <div class="meta">Posted on 2007-05-03 06:21:42 by evlncrn8</div>
   </div>
   <div class="post" id="post-189049">
    <div class="subject"><a href="#post-189049">Re: Global Hooks prevention</a></div>
    <div class="body">if you want to skip userland hooks you just have to call kernel directly with &quot;sysenter&quot; (or &quot;int 2E&quot; for &lt;XP).<br />hence if you dont use any call to dll &quot;kernel32,ntdll&quot; you wont be hooked.<br /></div>
    <div class="meta">Posted on 2007-05-03 11:25:47 by drizz</div>
   </div>
   <div class="post" id="post-189074">
    <div class="subject"><a href="#post-189074">Re: Global Hooks prevention</a></div>
    <div class="body">problem with that is that the sysenter stuff might change with os&#39;es and/or updates</div>
    <div class="meta">Posted on 2007-05-04 05:00:21 by evlncrn8</div>
   </div>
  </div>
 </body>
</html>