<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>nasm + opengl - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=21346" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=10">Graphics &amp; Game Development</a> &raquo; <a href="../?id=21346">nasm + opengl</a></p>
   <div class="post" id="post-161399">
    <div class="subject"><a href="#post-161399">nasm + opengl</a></div>
    <div class="body">Does anyone know how to compile and link a program that uses opengl and glut under nasm? I&#39;ve tried normal &quot;extern function/import function dll&quot; but it doesn&#39;t work. Neither does linking with gl libraries (opengl32.lib glut32.lib glaux.lib glu32.lib apart from glut32.lib which was downloaded from Nate Robins site all were taken from masm package). I use alink. Thanks<br /><br />ps. Compiling a program without glut also does&#39;t work. The includes I have for opengl (nasmgl.inc, nasmglu.inc) require a file called &quot;nwinx.inc&quot;, which is currently unreachable (tried google and some nasm related sites). the only example of nasm opengl source comes from a site that&#39;s currently closed (http://bizarrecreations.webjump.com). if it helps my code is here: http://deuterol.w.interia.pl/my_gl.asm (haven&#39;t had time to fix all the bugs, besides it doesn&#39;t even compile..) ,the example: http://deuterol.w.interia.pl/opengl/ntorus.asm and the makefile: http://deuterol.w.interia.pl/opengl/_nasm.bat<br /><br />I&#39;d appreciate any help becouse it&#39;s very important :-)</div>
    <div class="meta">Posted on 2005-06-22 08:04:11 by deuter</div>
   </div>
   <div class="post" id="post-161406">
    <div class="subject"><a href="#post-161406">Re: nasm + opengl</a></div>
    <div class="body">I will refer you to furter help tothe yahoo groups, the includes that you say, about winx... are not available... (I havent finded), tought they are not needed, perhpas&nbsp; definitions for &quot;data types&quot; or some like that.<br /><br />By the way, you also can use golink, that dont need library files (.lib), but the path the originall dll...<br /><br />You only need<br /><br />I will post some bat files and includes that I use for assemble with alink, golink and perhaps others...<br /><br />The include files w.inc (a striped version of macros of the normal windows include), general.mac include the macros for do the diferent entry points used by diferent linkers<br /><br /><pre><code><br />%include &quot;..\..\include\general.mac&quot;<br /><br /><br />segment .text class = code use32<br />%define LINKERUSED GOLINK<br /><br />extern MessageBoxA<br />extern __imp_MessageBoxA<br /><br />MakeEntry<br /><br />push dword 0 ; OK button<br />push dword title1<br />push dword string1<br />push dword 0<br />call MessageBoxA<br /><br />push dword 0 ; OK button<br />push dword title1<br />push dword string2<br />push dword 0<br />call [__imp_MessageBoxA]<br /><br />	invke MessageBoxA, 0, string3, string3, 0<br />	invkiat MessageBoxA, 0, string4, string4, 0<br /><br />	extern _ExitProcess@4<br />	call _ExitProcess@4<br /><br />segment .data class=DATA use32<br /><br />string1: db &#39;hello world, through redirection&#39;,13,10,0<br />;exported data<br />title1: db &#39;Hello&#39;,0<br />string2: db &#39;hello world, called through import table&#39;,13,10,0<br /><br />string3: db &quot;Hello world, called trough invke (invoke xtern)&quot;, 13, 10, 0<br />string4: db &quot;Hello you, called trought invkiat (invoke iat)&quot;, 13, 10, 0<br /></code></pre><br /><br />And also is included some macros for &quot;delete&quot; the work for include them like I do in this example (get from another resource.. is an old example); invk, invkiat do the same job, look at them carefully...<br /><br />Also there is invk taht is used for call functions in the file (because they will not be marked with extern, or inserted __imp_ ...<br /><br /><br />By the way, the only dismiss aht I have about golink is taht dosent have a command line option for mark segments like shared, that is suported by the assembler... not the linker.<br /><br />A yes.. I have forgot, for use golink, you should open golinkl.bat and add the dll about OpenGL that are not included.<br /><br />Hope this help you a little.</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=710" target="_blank">things.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2005-06-22 10:25:30 by rea</div>
   </div>
   <div class="post" id="post-161434">
    <div class="subject"><a href="#post-161434">Re: nasm + opengl</a></div>
    <div class="body">ok I&#39;ve finally managed to compile the program :-) (just needed to convert opengl32.dll to .lib with a little help from alib and get rid of the include files. they are good for a reference only..) but now I have a new problem becouse my program doesn&#39;t display anything but a black screen. I really don&#39;t know what can be wrong. it&#39;s almost a copy (well in a sense of functionality not the look ;-) of sourcecode from nehe&#39;s tutorial#2. if someone has the time to take a look here it is:<br /><pre><code><br />global _main<br /><br />;====================================================================<br />;? ?KERNEL FUNCTIONS<br />;====================================================================<br /><br /><br />;====================================================================<br />;? ?USER FUNCTIONS<br />;====================================================================<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />;====================================================================<br />;? ?GDI FUNCTIONS<br />;====================================================================<br /><br /><br /><br />;====================================================================<br />;? ?OPENGL FUNCTIONS<br />;====================================================================<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />;====================================================================<br />;? ?GLU FUNCTIONS<br />;====================================================================<br /><br /><br />section text use32<br />_main:<br />;? ?db 0cch<br />? ? xor eax, eax<br />? ? push eax<br />? ? call GetModuleHandleA<br />? ? mov dword , eax<br />? ? push dword IDI_APPLICATION? <br />? ? push dword 0<br />? ? call LoadIconA<br />? ? mov , eax<br />? ? push dword IDC_ARROW<br />? ? push dword 0<br />? ? call LoadCursorA<br />? ? mov , eax<br />? ? push dword wc<br />? ? call RegisterClassA<br />? ? xor eax, eax<br />? ? push dword eax<br />? ? push dword <br />? ? push dword eax<br />? ? push dword eax<br />? ? push dword 480<br />? ? push dword 640<br />? ? push dword CW_USEDEFAULT<br />? ? push dword CW_USEDEFAULT<br />? ? push dword WS_OVERLAPPEDWINDOW | WS_BORDER<br />? ? push dword WndName<br />? ? push dword ClassName<br />? ? push dword 0 ;WS_EX_CLIENTEDGE<br />? ? call CreateWindowExA<br />? ? mov dword , eax<br />? ? push dword SW_SHOW;SW_SHOWMAXIMIZED <br />? ? push dword <br />? ? call ShowWindow<br />? ? push dword <br />? ? call UpdateWindow<br />? ? call InitOpenGL? ? ? ? ? ? ? ? ? ? ? ? ? ? ?;&lt;=== GL STUFF<br />get_msg_loop:<br />? ? xor eax, eax<br />? ? push eax<br />? ? push eax<br />? ? push dword <br />? ? call InvalidateRect<br />? ? xor eax, eax<br />? ? push eax<br />? ? push eax<br />? ? push eax<br />? ? push dword msg<br />? ? call GetMessageA<br />? ? or eax, eax<br />? ? jz @WM_QUIT<br />? ? push dword msg<br />? ? call TranslateMessage<br />? ? push dword msg<br />? ? call DispatchMessageA<br />? ? jmp get_msg_loop<br />@WM_QUIT:<br />? ? push eax<br />? ? call ExitProcess<br /><br />%define _hwnd ebp+8<br />%define _umsg ebp+12<br />%define _wparam ebp+16<br />%define _lparam ebp+20<br />WndProc:<br />? ? push ebp<br />? ? mov ebp, esp<br />? ? ? ? <br />? ? cmp dword [_umsg], WM_DESTROY<br />? ? jz @WM_DESTROY<br />? ? cmp dword [_umsg], WM_PAINT<br />? ? jz @WM_PAINT<br />? ? cmp dword [_umsg], WM_KEYDOWN<br />? ? jz @WM_KEYDOWN<br /><br />? ? push dword [_lparam]<br />? ? push dword [_wparam]<br />? ? push dword [_umsg]<br />? ? push dword [_hwnd]<br />? ? call DefWindowProcA<br />? ? pop ebp<br />? ? ret 16<br /><br />@WM_DESTROY:<br />? ? call KillGL<br />? ? push dword 0<br />? ? call PostQuitMessage<br />? ? pop ebp<br />? ? ret 16<br /><br />@WM_PAINT:<br />? ? push dword rect<br />? ? push dword <br />? ? call GetClientRect<br />? ? push dword <br />? ? pop dword <br />? ? push dword ps<br />? ? push dword <br />? ? call BeginPaint<br />? ? call GLScene? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ;&lt;=== GL STUFF<br />? ? push dword ps<br />? ? push dword <br />? ? call EndPaint<br />? ? pop ebp<br />? ? ret 16<br /><br />@WM_KEYDOWN:<br />? ? cmp dword [_wparam], VK_ESCAPE<br />? ? jz @WM_DESTROY<br />? ? pop ebp<br />? ? ret 16<br /><br />InitOpenGL:<br />;====================================================================<br />;? ?GET DC<br />;====================================================================<br />? ? push dword <br />? ? call GetDC<br />? ? mov dword , eax<br />;====================================================================<br />;? ?MATCH DEVICE CONTEXT PIXEL FORMAT TO A GIVEN FORMAT SPECIFICATION<br />;====================================================================<br />? ? push dword pfd<br />? ? push eax<br />? ? call ChoosePixelFormat<br />? ? mov dword , eax<br />;====================================================================<br />;? ?SET THE GIVEN PIXEL FORMAT<br />;====================================================================<br />? ? push dword pfd<br />? ? push eax<br />? ? push dword <br />? ? call SetPixelFormat<br />;====================================================================<br />;? ?CREATE RENDERING CONTEXT<br />;====================================================================<br />? ? push dword <br />? ? call wglCreateContext<br />? ? mov dword , eax<br />;====================================================================<br />;? ?MAKE IT CURRENT CONTEXT<br />;====================================================================<br />? ? push eax<br />? ? push dword <br />? ? call wglMakeCurrent<br />;====================================================================<br />;? ?GET CLIENT AREA COORDINATES (0, 0, RIGHT, BOTTOM)<br />;====================================================================<br />? ? push dword rect<br />? ? push dword [_hwnd]<br />? ? call GetClientRect<br />;====================================================================<br />;? ?BEGIN THE GL STUFF<br />;====================================================================<br />? ? push dword 000000b71h ; GL_DEPTH_TEST<br />? ? call glEnable<br />? ? push dword 000000b44h ; GL_CULL_FACE<br />? ? call glEnable<br />? ? push dword 000001d01h ; GL_SMOOTH<br />? ? call glShadeModel<br />? ? xor eax, eax<br />? ? push eax<br />? ? push eax<br />? ? push eax<br />? ? push eax<br />? ? call glClearColor<br />? ? push dword 480<br />? ? push dword 640<br />? ? push dword 0<br />? ? push dword 0<br />? ? call glViewport<br />? ? <br />? ? push dword 1701h? ? ? ? ;GL_PROJECTION<br />? ? call glMatrixMode<br />? ? call glLoadIdentity<br /><br />? ? <br /><br />? ? push dword 1700h? ? ? ? ;GL_MODELVIEW<br />? ? call glMatrixMode<br />? ? call glLoadIdentity<br /><br />? ? ret<br /><br />KillGL:<br />? ? xor eax, eax<br />? ? push eax<br />? ? push eax<br />? ? call wglMakeCurrent<br />? ? push dword <br />? ? call wglDeleteContext<br />? ? push dword <br />? ? push dword <br />? ? call ReleaseDC<br />? ? ret<br /><br />GLScene:<br />? ? push dword 000004000h | 000000100h ; GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT<br />? ? call glClear<br />? ? call glLoadIdentity<br />? ? push dword 0C0C00000h<br />? ? push dword 0<br />? ? push dword 0<br />? ? call glTranslatef<br />? ? push dword 9? ? ; GL_POLYGON<br />? ? call glBegin<br />? ? ? ? push dword 0<br />? ? ? ? push dword 3F800000h<br />? ? ? ? push dword 0BF800000h<br />? ? ? ? call glVertex3f<br />? ? ? ? push dword 0<br />? ? ? ? push dword 3F800000h<br />? ? ? ? push dword 3F800000h<br />? ? ? ? call glVertex3f<br />? ? ? ? push dword 0<br />? ? ? ? push dword 0BF800000h<br />? ? ? ? push dword 3F800000h<br />? ? ? ? call glVertex3f<br />? ? ? ? push dword 0<br />? ? ? ? push dword 0BF800000h<br />? ? ? ? push dword 0BF800000h<br />? ? ? ? call glVertex3f<br />? ? call glEnd<br />? ? call glFlush<br />? ? push dword <br />? ? call SwapBuffers<br />? ? ret<br />? ? <br />section .data<br /><br />%include &quot;win32n.inc&quot;<br /><br />ClassName: db &quot;OpenGL&quot;, 0<br />WndName: db &quot;Opengl &quot;, 0<br />hwnd: dd 0<br />hdc: dd 0<br />hrc: dd 0<br />pixform: dd 0<br /><br />qword1: dq -1.0<br />qword2: dq 0.0<br />qword3: dq 1.0<br /><br />pfd:<br />istruc PIXELFORMATDESCRIPTOR<br />at PIXELFORMATDESCRIPTOR.nSize, dw PIXELFORMATDESCRIPTOR_size<br />at PIXELFORMATDESCRIPTOR.nVersion, dw 1<br />at PIXELFORMATDESCRIPTOR.dwFlags, dd 20h | 4 | 1 <br />; PFD_SUPPORT_OPENGL | PFD_DRAW_TO_WINDOW | PFD_DOUBLEBUFFER<br />at PIXELFORMATDESCRIPTOR.iPixelType, db 0 ; PFD_TYPE_RGBA<br />at PIXELFORMATDESCRIPTOR.cColorBits, db 24<br />at PIXELFORMATDESCRIPTOR.cRedBits, db 0<br />at PIXELFORMATDESCRIPTOR.cRedShift, db 0<br />at PIXELFORMATDESCRIPTOR.cGreenBits, db 0<br />at PIXELFORMATDESCRIPTOR.cGreenShift, db 0<br />at PIXELFORMATDESCRIPTOR.cBlueBits, db 0<br />at PIXELFORMATDESCRIPTOR.cBlueShift, db 0<br />at PIXELFORMATDESCRIPTOR.cAlphaBits, db 0<br />at PIXELFORMATDESCRIPTOR.cAlphaShift, db 0<br />at PIXELFORMATDESCRIPTOR.cAccumBits, db 0<br />at PIXELFORMATDESCRIPTOR.cAccumRedBits, db 0<br />at PIXELFORMATDESCRIPTOR.cAccumGreenBits, db 0<br />at PIXELFORMATDESCRIPTOR.cAccumBlueBits, db 0<br />at PIXELFORMATDESCRIPTOR.cAccumAlphaBits, db 0<br />at PIXELFORMATDESCRIPTOR.cDepthBits, db 16<br />at PIXELFORMATDESCRIPTOR.cStencilBits, db 8<br />at PIXELFORMATDESCRIPTOR.cAuxBuffers , db 0<br />at PIXELFORMATDESCRIPTOR.iLayerType, db 0 ; PFD_MAIN_PLANE<br />at PIXELFORMATDESCRIPTOR.bReserved, db 0<br />at PIXELFORMATDESCRIPTOR.dwLayerMask, dd 0 <br />at PIXELFORMATDESCRIPTOR.dwVisibleMask, dd 0<br />at PIXELFORMATDESCRIPTOR.dwDamageMask, dd 0<br />iend<br /><br />rect:<br />istruc RECT<br />iend<br /><br />ps:<br />istruc PAINTSTRUCT<br />iend<br /><br />wc:<br />istruc WNDCLASS<br />at WNDCLASS.style, dd 0<br />at WNDCLASS.lpfnWndProc, dd WndProc<br />at WNDCLASS.cbClsExtra, dd 0<br />at WNDCLASS.cbWndExtra, dd 0<br />at WNDCLASS.hInstance, dd 0<br />at WNDCLASS.hIcon, dd 0<br />at WNDCLASS.hCursor, dd 0<br />at WNDCLASS.hbrBackground, dd COLOR_BTNFACE+1<br />at WNDCLASS.lpszMenuName, dd 0<br />at WNDCLASS.lpszClassName, dd ClassName<br />iend<br /><br />msg:<br />istruc MSG<br />at MSG.hwnd, dd 0<br />at MSG.message, dd 0<br />at MSG.wParam, dd 0<br />at MSG.lParam, dd 0<br />at MSG.time, dd 0<br />at MSG.pt, dd pt<br />iend<br /><br />pt:<br />istruc POINT<br />at POINT.x, dd 0<br />at POINT.y, dd 0<br />iend<br /></code></pre><br /><br />And the makefile:<br /><pre><code><br />@echo off<br />echo nasmw -fobj %1.asm<br />nasmw -fobj %1.asm<br />echo alink -c -oPE -entry _main %1.obj opengl32.lib win32.lib<br />alink -c -oPE -entry _main %1.obj opengl32.lib win32.lib<br /></code></pre><br /><br />ps. rea: this was absolutely not what i was looking for, thanks anyway :-)</div>
    <div class="meta">Posted on 2005-06-23 15:30:06 by deuter</div>
   </div>
   <div class="post" id="post-161436">
    <div class="subject"><a href="#post-161436">Re: nasm + opengl</a></div>
    <div class="body">Hi, I don&#39;t mean to be rude, but does NASM not support some HLL features like invoke or writing floating point properly (as opposed to in hex). If not then I really suggest you try an Assembler like FASM cause you&#39;re unlikly to get ar with OGL if you&#39;ve to write every float in hex.</div>
    <div class="meta">Posted on 2005-06-23 15:52:43 by Eóin</div>
   </div>
   <div class="post" id="post-161448">
    <div class="subject"><a href="#post-161448">Re: nasm + opengl</a></div>
    <div class="body">Yep, nasm does support invoke but it&#39;s hard to write in macros<br />I am familiar with nasm and use it every day, i&#39;ve created an extra program &quot;compiller&quot; that runs nasm, gorc and linker by one keypress. So you can compile to gui, con, obj, dll or append the latest obj file to static library (using ms link.exe)<br />As ide i use Cromson Editor (screen, tool-menu and syntax-coloring included)<br /><br />So, i&#39;ve preselected some includes and samples with macros to use invoke, cdecl, COM calls and for creating COM classes<br />Not all is docummented<br /><br />also:<br /><pre><code>invoke MessageBoxA, 0, &quot;body&quot;, &quot;caption&quot;, 0 // it&#39;s external call to __imp_*<br />or simply: MessageBox 0, &quot;body&quot;, &quot;caption&quot;, 0<br /><br />call mysub, param1, param2 ... // direct call<br />cdecl param1, param2 ... // direct call to external fn<br />__cdecl param1, param2 ... // direct call to external __imp_*<br />com_call pointer, method, param1, param2 ... // see in GetDxVersion.asm<br /><br />tools: push esi,edi,ebx //alloved<br /><br />//writing classes (com subs)<br /><br />CLASS cTest<br />? STDMETHOD Message , fnMessage // method_name, local_sub<br />? ...<br />ENDCLASS <br /><br />main:<br /> CALL_COM ITest, ITest_Message, &quot;MmmEeeeSsssSssAaaaGggEeee&quot;<br />? ...<br /><br />COMSUB fnMessage, lpString<br />? ?MessageBox 0, lpString, &quot;&quot;, 0<br />? ?%undef lpString // required if lpString used in other subs<br />ENDCOM<br /><br /><br />// standard functions<br /><br />SUB mysub, param1, param2 ....<br />? ?UINT var1, var2? // sub esp,8<br />? ?UINT var3, var4? // again sub esp,8 !<br />...<br />? %undef param1, param2, var1 .... // don&#39;t forget<br />ENDSUB<br /><br /><br />PROC myproc, 16, param1, param2 .... // 16-stack frame<br />? ?UINT var1, var2? // sub esp,8 not inserted<br />? ?UINT var3, var4? // -||-<br />...<br />? ?%undef ...<br />ENDSUB</code></pre><br /><br /><br />so if you have more questions... ask :D<br />http://rapidshare.de/files/2698438/nasm_inc.zip.html 2.7MB<br /><br />the file is large because i&#39;ve included too many interface declarations :)<br />________<br />does anybody know how to prevent nasm to do not merge all constanst names (equ, %define and %assign)? to .obj? </div>
    <div class="meta">Posted on 2005-06-24 06:56:47 by sapero</div>
   </div>
  </div>
 </body>
</html>