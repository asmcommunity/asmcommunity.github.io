<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>segmentation fault and ddd tool - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30672" />
  <link rel="prev" href="../?id=30672&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=30672">segmentation fault and ddd tool</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=30672&amp;page=1" style="">&laquo;</a><a href="../?id=30672&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="30672" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-215194">
    <div class="subject"><a href="#post-215194">Re: segmentation fault and ddd tool</a></div>
    <div class="body">Hello, again!<br /><br />Thank you. I think I have two issues that I have to solve now in my code.<br />1. getchar - INBUFFERT.<br />I do not understand&nbsp; how to get the position in the buffer. Look at the code:<pre><code><br />getinpos:						<br />		movl	START_INPOS, %ecx		<br />		movl	%ecx, %ebx<br />		<br />getchar:	<br />		movl	$INBUFFERT, %ebx<br />		xorl	%eax, %eax<br />		/*cmpb	$45, (%ebx)		<br />		je	increase_charN	*/	<br />		<br />getchar_loop:<br />		cmpb	$32, (%ebx)		<br />		je	increase_char		<br />		movsx	(%ebx), %eax		<br />		pushl	%eax			<br />		incl	%ecx<br />		incl	%ebx<br />		jmp	getchar_loop<br /><br />increase_char:	<br />		incl	%ecx<br />		movl	%ecx, END_INPOS<br />		decl	%ecx<br /></code></pre><br /><br />Reading in the first number works fine.<br />Ex; 314SPC555CR<br />So, the program takes 314 and converts it and so on....<br />Everything works fine til the next time I come to getchar. So, coming to 555 in INBUFFERT, i e position = 4(START_INPOS,&nbsp; i e %eax = 4, %ebx =4). Now I want to move the number 5 into %eax. But I get 3, i e the position in the buffer is 0. ? How do I get to move number 5 in position 4? <br />Or, in other words, coming back to catch number 5 in position 4, why isn&#039;t this working?<br /><br />The clearing of the buffer UTBUFFERT, I don&#039;t know if this is&nbsp;  the correct code?<br /><pre><code><br />outimage:	<br />		pushl	$UTBUFFERT<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call 	puts<br />		addl	$4, %esp <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; movl $BUFFSIZ, %ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; movl $UTBUFFERT, %edx<br />clearloop:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; movb $0, (%edx)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; incl %edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loop clearloop<br />		ret<br /></code></pre><br />I can&#039;t get this to work. Isn&#039;t this an endless loop?<br /><br />Anders</div>
    <div class="meta">Posted on 2011-10-11 09:10:10 by anders11</div>
   </div>
   <div class="post" id="post-215197">
    <div class="subject"><a href="#post-215197">Re: segmentation fault and ddd tool</a></div>
    <div class="body">Let&#039;s deal with the last question first, since it&#039;s a little simpler(?)...<br /><br /><pre><code><br />outimage:	<br />		pushl	$UTBUFFERT<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call 	puts<br />		addl	$4, %esp <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; movl $BUFFSIZ, %ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; movl $UTBUFFERT, %edx<br />clearloop:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; movb $0, (%edx)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; incl %edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loop clearloop<br />		ret<br /></code></pre><br />That should work, I think. To make clear what the &quot;loop&quot; instruction does, here&#039;s an alternative which does the same thing...<br /><pre><code><br />outimage:	<br />		pushl	$UTBUFFERT<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call 	puts<br />		addl	$4, %esp <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; movl $BUFFSIZ, %ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; movl $UTBUFFERT, %edx<br />clearloop:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; movb $0, (%edx)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; incl %edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; decl %ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jnz clearloop<br />		ret<br /></code></pre><br />There&#039;s a possible &quot;gotcha&quot; here - one of the many mistakes I made in &quot;my version&quot; - C library functions are allowed to alter %ecx. I did something like...<br /><pre><code><br />...<br />movl $5, %ecx<br />top:<br />push %eax<br />call putchar<br />addl $4, %esp<br />loop top<br />...<br /></code></pre><br />That was an &quot;infinite loop&quot;, &#039;cause the call to putchar altered %ecx! I had to:<br /><pre><code><br />...<br />movl $5, %ecx<br />top:<br />pushl %ecx<br />push %eax<br />call putchar<br />addl $4, %esp<br />popl %ecx<br />loop top<br />...<br /></code></pre><br />The &quot;loop&quot; instruction works with %ecx. If I&#039;d used some other register as a loop counter, I could have done:<br /><pre><code><br />...<br />movl $5, %ebx<br />top:<br />push %eax<br />call putchar<br />addl $4, %esp<br />decl %ebx<br />jnz top<br />loop top<br />...<br /></code></pre><br />But you don&#039;t do that in your code, so it &quot;should&quot; have worked either with &quot;loop&quot; or the explicit &quot;decl/ jnz&quot;. Note that &quot;decl&quot; sets (or clears) the zero flag, so we don&#039;t need to compare the register to zero (doesn&#039;t hurt, but it&#039;s &quot;useless code&quot;, which we&#039;d like to avoid).<br /><br />I said that was a &quot;simpler&quot; question, but I don&#039;t know the answer - &quot;should&quot; work.<br /><br />That brings us to the more complicated question...<br /><pre><code><br />getinpos:						<br />		movl	START_INPOS, %ecx	<br /># whatever was in START_INPOS is in %ecx	<br />		movl	%ecx, %ebx<br /># make a copy of it	<br />getchar:	<br />		movl	$INBUFFERT, %ebx<br /># now %ebx is overwritten with the address of INBUFFERT.<br /># perhaps you wanted to do &quot;addl&quot; here?<br />		xorl	%eax, %eax<br /># ?<br />		/*cmpb	$45, (%ebx)		<br />		je	increase_charN	*/	<br /># you were going to check for &#039;-&#039; here<br /># and jump off into the &quot;bowl of spaghetti&quot;...<br /># perhaps<br /><br /># cmpb $&#039;-&#039;, (%ebx)<br /># jne getchar_loop<br /># incl %ebx<br /># maybe set a &quot;minus indicator&quot; of some sort?<br />getchar_loop:<br />		cmpb	$32, (%ebx)		<br />		je	increase_char<br /># maybe, instead:<br /># jne notspace<br /># incl %ebx<br /># movl %ebx, NEXT_POS ?<br /># save the current position (address)<br /># we have a complete number,<br /># do something with it<br /># jmp convert_loop?<br /># %ebx is neither a &#039;-&#039; nor a &#039; &#039;...<br /># must be a number (character)!<br /># notspace:<br />		movsx	(%ebx), %eax<br /># get a character(?)<br /># you might want movb (%ebx), %al	 ? 	<br />		pushl	%eax			<br /># push it to be popped off in &quot;conv_loop&quot;?<br />		incl	%ecx<br /># bump &quot;small integer&quot; POS<br />		incl	%ebx<br /># bump the address<br />		jmp	getchar_loop<br /><br />increase_char:	<br />		incl	%ecx<br />		movl	%ecx, END_INPOS<br />		decl	%ecx<br /># where do we go from here?<br /></code></pre><br />I guess what you&#039;re doing is keeping a &quot;small integer&quot; in &quot;?POS&quot;. Okay, but you&#039;ll want to add it to the address of the start of the buffer before you can do much with it. It might be easier to make these &quot;?POS&quot; variables the actual &quot;current address in buffer&quot; instead?<br /><br />Another nice day here - I thought yesterday was the last one. That&#039;s all I can think of now, but &quot;I&#039;ll be back!&quot;. :)<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2011-10-11 15:48:42 by fbkotler</div>
   </div>
   <div class="post" id="post-215340">
    <div class="subject"><a href="#post-215340">Re: segmentation fault and ddd tool</a></div>
    <div class="body">I&#039;ve managed to solve most of my code now. Thank you for helping me out. <br /><br />Anders</div>
    <div class="meta">Posted on 2011-11-10 04:29:07 by anders11</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=30672&amp;page=1" style="">&laquo;</a><a href="../?id=30672&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="30672" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>