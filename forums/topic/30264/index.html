<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Call WMI (COM Interface) Simple example - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30264" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=30264">Call WMI (COM Interface) Simple example</a></p>
   <div class="post" id="post-213275">
    <div class="subject"><a href="#post-213275">Call WMI (COM Interface) Simple example</a></div>
    <div class="body">WMI Structure a lot, but they are similar. So I just finished part of the work .<br /><br />How to obtain data from WMI using a C Application??<br />Refer to &nbsp;http://stackoverflow.com/questions/1431103/how-to-obtain-data-from-wmi-using-a-c-application<br /><br /><pre><code><br />;Save as &nbsp;Struct.inc<br />; *******************************************<br />; &nbsp;Basic Data Types<br />VARIANT_BOOL &nbsp; &nbsp;TYPEDEF &nbsp; &nbsp; WORD<br />PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TYPEDEF &nbsp; &nbsp; DWORD <br />;VARTYPE &nbsp; &nbsp; &nbsp; &nbsp; TYPEDEF &nbsp; &nbsp; WORD<br />SCODE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TYPEDEF &nbsp; &nbsp; DWORD<br />BSTR &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TYPEDEF &nbsp; &nbsp; DWORD &nbsp;<br /><br />; -------------------------------------------------------------------------------<br />VARIANT STRUCT <br /> &nbsp; &nbsp;vt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VT_EMPTY<br /> &nbsp; &nbsp;wReserved1 &nbsp; &nbsp; &nbsp;WORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0<br /> &nbsp; &nbsp;wReserved2 &nbsp; &nbsp; &nbsp;WORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0<br /> &nbsp; &nbsp;wReserved3 &nbsp; &nbsp; &nbsp;WORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0<br /> &nbsp; &nbsp;Union &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;&lt;==Only some would be sufficient.<br /> &nbsp; &nbsp; &nbsp; &nbsp;lVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SDWORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;? &nbsp; ; VT_I4<br /> &nbsp; &nbsp; &nbsp; &nbsp;bVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;? &nbsp; ; VT_UI1<br /> &nbsp; &nbsp; &nbsp; &nbsp;iVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SWORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_I2<br /> &nbsp; &nbsp; &nbsp; &nbsp;fltVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;REAL4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_R4<br /> &nbsp; &nbsp; &nbsp; &nbsp;dblVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;REAL8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_R8<br /> &nbsp; &nbsp; &nbsp; &nbsp;boolVal &nbsp; &nbsp; &nbsp; &nbsp; VARIANT_BOOL &nbsp; &nbsp;? &nbsp; ; VT_BOOL<br /> &nbsp; &nbsp; &nbsp; &nbsp;scode &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SCODE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_ERROR<br /> &nbsp; &nbsp; &nbsp; &nbsp;cyVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QWORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_CY<br /> &nbsp; &nbsp; &nbsp; &nbsp;date &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QWORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_DATE<br /> &nbsp; &nbsp; &nbsp; &nbsp;bstrVal &nbsp; &nbsp; &nbsp; &nbsp; BSTR &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;? &nbsp; ; VT_BSTR<br /> &nbsp; &nbsp; &nbsp; &nbsp;punkVal &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_UNKNOWN<br /> &nbsp; &nbsp; &nbsp; &nbsp;pdispVal &nbsp; &nbsp; &nbsp; &nbsp;PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_DISPATCH<br /> &nbsp; &nbsp; &nbsp; &nbsp;parray &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_ARRAY<br /> &nbsp; &nbsp; &nbsp; &nbsp;pbVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_UI1<br /> &nbsp; &nbsp; &nbsp; &nbsp;piVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_I2<br /> &nbsp; &nbsp; &nbsp; &nbsp;plVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_I4<br /> &nbsp; &nbsp; &nbsp; &nbsp;pfltVal &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_R4<br /> &nbsp; &nbsp; &nbsp; &nbsp;pdblVal &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_R8<br /> &nbsp; &nbsp; &nbsp; &nbsp;pboolVal &nbsp; &nbsp; &nbsp; &nbsp;PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_BOOL<br /> &nbsp; &nbsp; &nbsp; &nbsp;pscode &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_ERROR<br /> &nbsp; &nbsp; &nbsp; &nbsp;pcyVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_CY<br /> &nbsp; &nbsp; &nbsp; &nbsp;pdate &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_DATE<br /> &nbsp; &nbsp; &nbsp; &nbsp;pbstrVal &nbsp; &nbsp; &nbsp; &nbsp;PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_BSTR<br /> &nbsp; &nbsp; &nbsp; &nbsp;ppunkVal &nbsp; &nbsp; &nbsp; &nbsp;PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_UNKNOWN<br /> &nbsp; &nbsp; &nbsp; &nbsp;ppdispVal &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_DISPATCH<br /> &nbsp; &nbsp; &nbsp; &nbsp;pparray &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_ARRAY<br /> &nbsp; &nbsp; &nbsp; &nbsp;pvarVal &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_VARIANT<br /> &nbsp; &nbsp; &nbsp; &nbsp;byref &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; Generic ByRef<br /> &nbsp; &nbsp; &nbsp; &nbsp;cVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SBYTE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_I1<br /> &nbsp; &nbsp; &nbsp; &nbsp;uiVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;? &nbsp; ; VT_UI2<br /> &nbsp; &nbsp; &nbsp; &nbsp;ulVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_UI4<br /> &nbsp; &nbsp; &nbsp; &nbsp;intVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SWORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_int<br /> &nbsp; &nbsp; &nbsp; &nbsp;uintVal &nbsp; &nbsp; &nbsp; &nbsp; WORD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;? &nbsp; ; VT_uint<br /> &nbsp; &nbsp; &nbsp; &nbsp;pdecVal &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_DECIMAL<br /> &nbsp; &nbsp; &nbsp; &nbsp;pcVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_I1<br /> &nbsp; &nbsp; &nbsp; &nbsp;puiVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_UI2<br /> &nbsp; &nbsp; &nbsp; &nbsp;pulVal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_UI4<br /> &nbsp; &nbsp; &nbsp; &nbsp;pintVal &nbsp; &nbsp; &nbsp; &nbsp; PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_int<br /> &nbsp; &nbsp; &nbsp; &nbsp;puintVal &nbsp; &nbsp; &nbsp; &nbsp;PVOID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &nbsp; ; VT_BYREF|VT_uint<br /> &nbsp; &nbsp;ENDS<br />VARIANT ENDS<br />;************************************************<br /></code></pre><br /><br /><span style="font-size:7pt><em>use code blocks...</em></span></div>
    <div class="meta">Posted on 2010-10-04 07:40:03 by G-Spider</div>
   </div>
   <div class="post" id="post-213276">
    <div class="subject"><a href="#post-213276">Re: Call WMI (COM Interface) Simple example</a></div>
    <div class="body">The following file &nbsp;Save as WMI_COM.inc<br /><br /><pre><code><br />;********************************************<br />;COM API for WMI Struct. Just Part! <br />;By G-Spider 2010.10.4<br />;Refer to &nbsp;WbemCli.h &nbsp;and &nbsp;http://msdn.microsoft.com/en-us/library/aa389276(v=VS.85).aspx <br />;********************************************<br /><br />CLSID_WbemLocator GUID &lt;04590f811h, 01d3ah, 011d0h, &lt;089h, 01fh, 000h, 0aah, 000h, 04bh, 02eh, 024h&gt;&gt;<br />;/// 4590f811-1d3a-11d0-891f-00aa004b2e24<br />IID_IWbemLocator &nbsp;GUID &lt;0dc12a687h, 0737fh, 011cfh, &lt;088h, 04dh, 000h, 0aah, 000h, 04bh, 02eh, 024h&gt;&gt; &nbsp; <br />;/// dc12a687-737f-11cf-884d-00aa004b2e24<br />;<br />;IWbemLocator=&gt;IWbemServices=&gt;IEnumWbemClassObject=&gt;IWbemClassObject<br />;<br />;--------------------------------------<br />IUnknown &nbsp; &nbsp; &nbsp; &nbsp;struct<br /> &nbsp; &nbsp; &nbsp; &nbsp;QueryInterface	DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;AddRef		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;Release		DWORD &nbsp; ?<br />IUnknown &nbsp; &nbsp; &nbsp; &nbsp;ends<br />;--------------------------------------<br />IWbemLocatorVtbl &nbsp; &nbsp;struct<br /> &nbsp; &nbsp; &nbsp; &nbsp;; IUnknown methods<br /> &nbsp; &nbsp; &nbsp; &nbsp;Unknown &nbsp; &nbsp; &nbsp; IUnknown &nbsp;&lt;&gt; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;; WbemLocator methods<br /> &nbsp; &nbsp; &nbsp; &nbsp;ConnectServer DWORD &nbsp; ?<br />IWbemLocatorVtbl &nbsp; &nbsp;ends<br /><br />IWbemLocator &nbsp; &nbsp; &nbsp; &nbsp;struct<br /> &nbsp; &nbsp; &nbsp; &nbsp;lpVtbl 	 &nbsp; &nbsp;DWORD &nbsp; ? &nbsp;;-&gt;IWbemLocatorVtbl <br />IWbemLocator &nbsp; &nbsp; &nbsp; &nbsp;ends<br />;--------------------------------------<br />IWbemServicesVtbl &nbsp; struct<br /> &nbsp; &nbsp; &nbsp; &nbsp;; IUnknown methods<br /> &nbsp; &nbsp; &nbsp; &nbsp;Unknown &nbsp; &nbsp; &nbsp; IUnknown &nbsp;&lt;&gt; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;;IWbemServices methods<br /> &nbsp; &nbsp; &nbsp; &nbsp;OpenNamespace		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;CancelAsyncCall		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;QueryObjectSink		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;GetObject		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;GetObjectAsync		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;PutClass		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;PutClassAsync		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;DeleteClass		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;DeleteClassAsync	 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;CreateClassEnum		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;CreateClassEnumAsync		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;PutInstance		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;PutInstanceAsync		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;DeleteInstance		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;DeleteInstanceAsync		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;CreateInstanceEnum		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;CreateInstanceEnumAsync		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;ExecQuery		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;ExecQueryAsync		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;ExecNotificationQuery		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;ExecNotificationQueryAsync	DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;ExecMethod		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;ExecMethodAsync		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br />IWbemServicesVtbl &nbsp; &nbsp; ends <br /><br />IWbemServices &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; struct <br /> &nbsp; &nbsp; &nbsp; &nbsp;lpVtbl 	 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ? &nbsp;;-&gt;IWbemServicesVtbl<br />IWbemServices &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ends &nbsp; &nbsp; &nbsp; <br /><br />;--------------------------------------<br />IEnumWbemClassObjectVtbl &nbsp; &nbsp;struct<br /> &nbsp; &nbsp; &nbsp; &nbsp;; IUnknown methods<br /> &nbsp; &nbsp; &nbsp; &nbsp;Unknown &nbsp; &nbsp; &nbsp; IUnknown &nbsp;&lt;&gt; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;;IEnumWbemClassObject methods<br /> &nbsp; &nbsp; &nbsp; &nbsp;Reset 	 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;Next 	 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;NextAsync 	DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;Clone 	 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;Skip &nbsp;	 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br />IEnumWbemClassObjectVtbl &nbsp; &nbsp;ends<br /><br />IEnumWbemClassObject &nbsp; &nbsp;struct <br /> &nbsp; &nbsp; &nbsp; &nbsp;lpVtbl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?;-&gt;IEnumWbemClassObjectVtbl<br />IEnumWbemClassObject &nbsp; &nbsp;ends &nbsp; &nbsp; &nbsp; <br /><br />;--------------------------------------<br />IWbemClassObjectVtbl &nbsp; &nbsp; &nbsp; &nbsp;struct<br /> &nbsp; &nbsp; &nbsp; &nbsp;; IUnknown methods<br /> &nbsp; &nbsp; &nbsp; &nbsp;Unknown &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IUnknown &nbsp;&lt;&gt;<br /> &nbsp; &nbsp; &nbsp; &nbsp;;IWbemClassObject methods<br /> &nbsp; &nbsp; &nbsp; &nbsp;GetQualifierSet		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;Get		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;Put		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;Delete		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;GetNames		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;BeginEnumeration	DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;Next		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;EndEnumeration		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;GetPropertyQualifierSet	DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;Clone		 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;GetObjectText		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;SpawnDerivedClass	DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;SpawnInstance		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;CompareTo		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;GetPropertyOrigin	DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;InheritsFrom		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;GetMethod		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;PutMethod		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;DeleteMethod		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;BeginMethodEnumeration	DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;NextMethod		DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;EndMethodEnumeration	DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;GetMethodQualifierSet	DWORD &nbsp; ?<br /> &nbsp; &nbsp; &nbsp; &nbsp;GetMethodOrigin		DWORD &nbsp; ?<br />IWbemClassObjectVtbl	 &nbsp; &nbsp; &nbsp; &nbsp;ends<br /><br />IWbemClassObject &nbsp; &nbsp; &nbsp; &nbsp;struct<br /> &nbsp; &nbsp; &nbsp; &nbsp;lpVtbl	 &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp; ? &nbsp; ;-&gt;IWbemClassObjectVtbl <br />IWbemClassObject &nbsp; &nbsp; &nbsp; &nbsp;ends<br />;------------------------------------<br />;IWbemClassObject::Get method &nbsp;<br />;Refer to http://msdn.microsoft.com/en-us/library/aa391442(v=VS.85).aspx<br />;HRESULT Get(<br />; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LPCWSTR wszName, //&lt;===Name of the desired property.<br />; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LONG lFlags,<br />; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VARIANT *pVal, &nbsp;//&lt;===assigned the correct type and value for VARIANT<br />; &nbsp; &nbsp;CIMTYPE *pvtType, <br />; &nbsp; &nbsp;LONG *plFlavor<br />; &nbsp; ) &nbsp;;<br />;for example &nbsp;Refer to http://msdn.microsoft.com/en-us/library/aa394373(VS.85).aspx<br />;class Win32_Processor : CIM_Processor<br />;{<br />; &nbsp;uint16 &nbsp; AddressWidth;<br />; &nbsp;uint16 &nbsp; Architecture;<br />; &nbsp;uint16 &nbsp; Availability;<br />; &nbsp;string &nbsp; Caption;<br />; &nbsp;uint32 &nbsp; ConfigManagerErrorCode;<br />; &nbsp;boolean &nbsp;ConfigManagerUserConfig;<br />; &nbsp;uint16 &nbsp; CpuStatus;<br />; &nbsp;string &nbsp; CreationClassName;<br />; &nbsp;uint32 &nbsp; CurrentClockSpeed;<br />; &nbsp;uint16 &nbsp; CurrentVoltage;<br />; &nbsp;uint16 &nbsp; DataWidth;<br />; &nbsp;string &nbsp; Description;<br />; &nbsp;string &nbsp; DeviceID;<br />; &nbsp;boolean &nbsp;ErrorCleared;<br />; &nbsp;string &nbsp; ErrorDescription;<br />; &nbsp;uint32 &nbsp; ExtClock;<br />; &nbsp;uint16 &nbsp; Family;<br />; &nbsp;datetime InstallDate;<br />; &nbsp;uint32 &nbsp; L2CacheSize;<br />; &nbsp;uint32 &nbsp; L2CacheSpeed;<br />; &nbsp;uint32 &nbsp; L3CacheSize;<br />; &nbsp;uint32 &nbsp; L3CacheSpeed;<br />; &nbsp;uint32 &nbsp; LastErrorCode;<br />; &nbsp;uint16 &nbsp; Level;<br />; &nbsp;uint16 &nbsp; LoadPercentage;<br />; &nbsp;string &nbsp; Manufacturer;<br />; &nbsp;uint32 &nbsp; MaxClockSpeed; //&lt;=====wszName=L&quot;MaxClockSpeed&quot; &nbsp;;***.vt=VT_UI4<br />; &nbsp;string &nbsp; Name; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&lt;=====wszName=L&quot;Name&quot; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;***.vt=VT_BSTR<br />; &nbsp;uint32 &nbsp; NumberOfCores;<br />; &nbsp;uint32 &nbsp; NumberOfLogicalProcessors;<br />; &nbsp;string &nbsp; OtherFamilyDescription;<br />; &nbsp;string &nbsp; PNPDeviceID;<br />; &nbsp;uint16 &nbsp; PowerManagementCapabilities&#91;];<br />; &nbsp;boolean &nbsp;PowerManagementSupported;<br />; &nbsp;string &nbsp; ProcessorId; &nbsp; //&lt;=====wszName=L&quot;ProcessorId&quot; &nbsp; &nbsp;;***.vt=VT_BSTR<br />; &nbsp;uint16 &nbsp; ProcessorType;<br />; &nbsp;uint16 &nbsp; Revision;<br />; &nbsp;string &nbsp; Role;<br />; &nbsp;string &nbsp; SocketDesignation;<br />; &nbsp;string &nbsp; Status;<br />; &nbsp;uint16 &nbsp; StatusInfo;<br />; &nbsp;string &nbsp; Stepping;<br />; &nbsp;string &nbsp; SystemCreationClassName;<br />; &nbsp;string &nbsp; SystemName;<br />; &nbsp;string &nbsp; UniqueId;<br />; &nbsp;uint16 &nbsp; UpgradeMethod;<br />; &nbsp;string &nbsp; Version;<br />; &nbsp;uint32 &nbsp; VoltageCaps;<br />;};<br />;***************************************************************<br /></code></pre><br /><br /><span style="font-size:9pt><em>use code blocks...</em></span><br /></div>
    <div class="meta">Posted on 2010-10-04 07:45:18 by G-Spider</div>
   </div>
   <div class="post" id="post-213277">
    <div class="subject"><a href="#post-213277">Re: Call WMI (COM Interface) Simple example</a></div>
    <div class="body"> :D<br /><br /><pre><code><br />;********************************************<br />;Call WMI (COM Interface) Simple example &nbsp;<br />;By G-Spider 2010.10.4<br />;ml &nbsp;/c /coff Speeker.asm &nbsp;<br />;link /subsystem:console Speeker.obj <br />;********************************************<br /><br />.586<br />.model flat,stdcall<br />option casemap:none<br /><br /> &nbsp; include windows.inc<br /> &nbsp; include kernel32.inc<br /> &nbsp; include user32.inc<br /> &nbsp; include masm32.inc<br /> &nbsp; include ole32.inc<br /> &nbsp; include Oleaut32.inc<br /> &nbsp; <br /> &nbsp; include Struct.inc &nbsp; ;&lt;========Struct.inc &nbsp;Up file<br /> &nbsp; <br /> &nbsp; includelib kernel32.lib<br /> &nbsp; includelib user32.lib<br /> &nbsp; includelib masm32.lib<br /> &nbsp; includelib ole32.lib<br /> &nbsp; includelib Oleaut32.lib<br /> &nbsp; <br /> &nbsp; <br /><br /> &nbsp; &nbsp; &nbsp; &nbsp;.data<br />;-------------------------<br />;buf db &#039;good&#039;,0 &nbsp; &nbsp; &nbsp; &nbsp;;Just use to Test<br />fmt &nbsp; &nbsp; db &nbsp; &nbsp; &nbsp;&#039;%d&#039;,0 &nbsp;;also use output MaxClockSpeed<br />;---------------------------<br />include WMI_COM.inc &nbsp; &nbsp; ;&lt;========WMI_COM.inc &nbsp; &nbsp;Up file<br /><br />stresource	word	&#039;R&#039;,&#039;O&#039;,&#039;O&#039;,&#039;T&#039;,&#039;\&#039;,&#039;C&#039;,&#039;I&#039;,&#039;M&#039;,&#039;V&#039;,&#039;2&#039;,0<br />;//L&quot;ROOT\\CIMV2&quot;<br />stlanguage	word	&#039;W&#039;,&#039;Q&#039;,&#039;L&#039;,0<br />;//L&quot;WQL&quot;<br />stquery		word	&#039;S&#039;,&#039;E&#039;,&#039;L&#039;,&#039;E&#039;,&#039;C&#039;,&#039;T&#039;,&#039; &#039;,&#039;*&#039;,&#039; &#039;,&#039;F&#039;,&#039;R&#039;,&#039;O&#039;,&#039;M&#039;,&#039; &#039;,&#039;W&#039;,&#039;i&#039;,&#039;n&#039;,&#039;3&#039;,&#039;2&#039;,&#039;_&#039;,&#039;P&#039;,&#039;r&#039;,&#039;o&#039;,&#039;c&#039;,&#039;e&#039;,&#039;s&#039;,&#039;s&#039;,&#039;o&#039;,&#039;r&#039;,0<br />;//L&quot;SELECT * FROM Win32_Processor&quot; <br />; &lt;===Note! we just use Win32_Processor,and the same to other Win32 Classes.<br />;Refer to http://msdn.microsoft.com/en-us/library/aa394084(v=VS.85).aspx<br />stName		word	&#039;N&#039;,&#039;a&#039;,&#039;m&#039;,&#039;e&#039;,0<br />;//L&quot;Name&quot; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;==from Win32_Processor<br />stProcessorId &nbsp; word &nbsp; &nbsp;&#039;P&#039;,&#039;r&#039;,&#039;o&#039;,&#039;c&#039;,&#039;e&#039;,&#039;s&#039;,&#039;s&#039;,&#039;o&#039;,&#039;r&#039;,&#039;I&#039;,&#039;d&#039;,0<br />;//L&quot;ProcessorId&quot; &nbsp; &nbsp; &nbsp; &nbsp;&lt;==from Win32_Processor<br />stMaxClockSpeed word &nbsp; &nbsp;&#039;M&#039;,&#039;a&#039;,&#039;x&#039;,&#039;C&#039;,&#039;l&#039;,&#039;o&#039;,&#039;c&#039;,&#039;k&#039;,&#039;S&#039;,&#039;p&#039;,&#039;e&#039;,&#039;e&#039;,&#039;d&#039;,0<br />;//L&quot;MaxClockSpeed&quot; &nbsp; &nbsp; &nbsp;&lt;==from Win32_Processor<br /><br />reLine &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;db &nbsp; &nbsp; &nbsp;0dh,0ah,0<br />reLineId &nbsp; &nbsp; &nbsp; &nbsp;db &nbsp; &nbsp; &nbsp;0dh,0ah,&#039;ProcessorId &nbsp;:&#039;,0<br />szClockSpeed &nbsp; &nbsp;db &nbsp; &nbsp; &nbsp;0dh,0ah,&#039;MaxClockSpeed:&#039;,0<br /><br /> &nbsp; &nbsp; &nbsp; &nbsp;.data?<br />locator &nbsp; &nbsp;	dd 	? &nbsp; &nbsp; &nbsp; ;-&gt;IWbemLocator<br />services	dd	? &nbsp; &nbsp; &nbsp; ;-&gt;IWbemServices<br />results		dd	? &nbsp; &nbsp; &nbsp; ;-&gt;IEnumWbemClassObject<br />;--------------------------<br />;lpBSTR &nbsp;<br />resource &nbsp; &nbsp; &nbsp; &nbsp;dd &nbsp; &nbsp; &nbsp;?<br />_language &nbsp; &nbsp; &nbsp; dd &nbsp; &nbsp; &nbsp;?<br />query &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd &nbsp; &nbsp; &nbsp;?<br />;--------------------------<br />result		dd	?<br />returnedCount	dd	?<br />_name		dd	?<br />speed &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd &nbsp; &nbsp; &nbsp;?<br />ProcessorId	dd	?<br />;--------------------------<br />buf1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;db &nbsp; &nbsp; &nbsp;16 &nbsp; &nbsp; &nbsp;dup(?) ;MaxClockSpeed into ASCII_String<br /><br />stOutName &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; db &nbsp;100 &nbsp; &nbsp; dup(?)<br />stNmSize &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;equ $-stOutName<br /><br />stOutProcessorId &nbsp; &nbsp; &nbsp; &nbsp;db &nbsp;80 &nbsp; &nbsp; &nbsp;dup(?) &nbsp; &nbsp; &nbsp; <br />stIdSize &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;equ $-stOutProcessorId<br /><br /> &nbsp; &nbsp; &nbsp; &nbsp;.code<br />; ---------------------------------------------------------------------------<br /><br />start:<br /> &nbsp; &nbsp; &nbsp; &nbsp;invoke &nbsp;SysAllocString,offset stresource<br /> &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp;resource,eax &nbsp; &nbsp; ;Into BSTR<br /> &nbsp; &nbsp; &nbsp; &nbsp;invoke &nbsp;SysAllocString,offset stlanguage<br /> &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp;_language,eax &nbsp; &nbsp;;Into BSTR<br /> &nbsp; &nbsp; &nbsp; &nbsp;invoke &nbsp;SysAllocString,offset stquery<br /> &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp;query,eax &nbsp; &nbsp; &nbsp; &nbsp;;Into BSTR<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;;/// &nbsp;initialize COM <br /> &nbsp; &nbsp;	invoke CoInitialize,0<br /> &nbsp; &nbsp; &nbsp; &nbsp;invoke CoInitializeSecurity,NULL, -1, NULL, NULL, 0, 3, NULL, 0, NULL<br /><br /> &nbsp; &nbsp; &nbsp; &nbsp;;//// connect to WMI <br /> &nbsp; &nbsp; &nbsp; &nbsp;invoke CoCreateInstance,offset CLSID_WbemLocator, 0, CLSCTX_INPROC_SERVER, offset IID_IWbemLocator,offset locator<br /><br /> &nbsp; &nbsp; &nbsp; &nbsp;;/// hr = locator-&gt;lpVtbl-&gt;ConnectServer(locator, resource, NULL, NULL, NULL, 0, NULL, NULL, &amp;services);<br />	push	offset services<br />	push	0<br />	push	0<br />	push	0<br />	push	0<br />	push	0<br />	push	0<br />	mov	ecx, resource<br />	push	ecx<br />	mov	eax, locator<br />	push	eax<br />;-------------------------------------------------<br />	mov	eax, .IWbemLocator.lpVtbl &nbsp; &nbsp; &nbsp; &nbsp;;call eax,<br /> &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;.IWbemLocatorVtbl.ConnectServer &nbsp;;call DWORD PTR <br /> &nbsp;<br /><br />;/// hr = services-&gt;lpVtbl-&gt;ExecQuery(services, language, query, WBEM_FLAG_BIDIRECTIONAL, NULL, &amp;results);<br />	push	offset results<br />	push	0<br />	push	0<br />	mov	ecx, &nbsp;query<br />	push	ecx<br />	mov	edx, &nbsp;_language<br />	push	edx<br />	mov	eax, &nbsp;services<br />	push	eax<br />;--------------------------------------------------<br />	mov	eax, .IWbemServices.lpVtbl<br />	call &nbsp; &nbsp;.IWbemServicesVtbl.ExecQuery ;call &nbsp; &nbsp;DWORD PTR <br /><br /> .if	results!=0<br />	mov	result,0<br />	mov	returnedCount,0<br />;/// &nbsp; &nbsp;while((hr = results-&gt;lpVtbl-&gt;Next(results, WBEM_INFINITE, 1, &amp;result, &amp;returnedCount)) == S_OK) <br />;/// &nbsp; &nbsp;You should use Loop.	<br />	push	offset returnedCount<br />	push	offset result<br />	push	1<br />	push	-1<br />	mov	eax, results<br />	push	eax<br />;--------------------------------------------------<br />	mov	eax, .IEnumWbemClassObject.lpVtbl ;call eax,<br />	call &nbsp; &nbsp;.IEnumWbemClassObjectVtbl.Next &nbsp; &nbsp;;call DWORD PTR <br /> &nbsp; &nbsp; &nbsp; &nbsp;;**************************************************************************************<br /> &nbsp; &nbsp; &nbsp; &nbsp;.if eax==0<br /> &nbsp; &nbsp; &nbsp; &nbsp;;/// &nbsp; &nbsp;hr = result-&gt;lpVtbl-&gt;Get(result, L&quot;Name&quot;, 0, &amp;name, 0, 0);<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	0 &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	offset _name<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	offset stName<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov	eax, result<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	eax<br /> &nbsp; &nbsp; &nbsp; &nbsp;;----------------------------------------------------<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov	eax, .IWbemClassObject.lpVtbl<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;.IWbemClassObjectVtbl.Get ;call &nbsp; &nbsp;DWORD PTR <br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov esi,offset _name &nbsp; ;&lt;==Note the _name! <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;xor eax,eax<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;MOV ax,.VARIANT.vt <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;invoke	wsprintf,offset buf1,offset fmt,eax &nbsp;;///Test ,return VT_BSTR=8 &nbsp;,right!!<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;invoke MessageBox,NULL,offset buf1,offset buf,0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov eax,.VARIANT.bstrVal &nbsp; &nbsp;;/////Key!!VARIANT<br /> <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;invoke WideCharToMultiByte,CP_ACP,WC_COMPOSITECHECK,eax,-1,offset stOutName,stNmSize,0,0 <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;invoke StdOut,offset stOutName &nbsp; ;OutPut<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;invoke StdOut,offset szClockSpeed ;Reline<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;/// &nbsp; hr = result-&gt;lpVtbl-&gt;Get(result, L&quot;MaxClockSpeed&quot;, 0, &amp;speed, 0, 0);<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	0 &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	offset speed<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	offset stMaxClockSpeed<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov	eax, result<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	eax<br /> &nbsp; &nbsp; &nbsp; &nbsp;;----------------------------------------------------<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov	eax, .IWbemClassObject.lpVtbl<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;.IWbemClassObjectVtbl.Get ;call &nbsp; &nbsp;DWORD PTR <br /><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; esi,offset speed &nbsp; &nbsp; &nbsp; &nbsp; ;&lt;==Note the speed!<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov &nbsp; &nbsp; eax,.VARIANT.ulVal &nbsp;;/////Key!!VARIANT ,eax=MaxClockSpeed<br /><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;invoke	wsprintf,offset buf1,offset fmt,eax<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;invoke StdOut,offset buf1 &nbsp; ;OutPut<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;invoke StdOut,offset reLineId &nbsp; &nbsp; &nbsp;;///Reline<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;/// &nbsp; hr = result-&gt;lpVtbl-&gt;Get(result, L&quot;ProcessorId&quot;, 0, &amp;ProcessorId, 0, 0);<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	0 &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	offset ProcessorId<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	offset stProcessorId<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov	eax, result<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	eax<br /> &nbsp; &nbsp; &nbsp; &nbsp;;----------------------------------------------------<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov	eax, .IWbemClassObject.lpVtbl<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;.IWbemClassObjectVtbl.Get ;call &nbsp; &nbsp;DWORD PTR <br /><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov esi,offset ProcessorId &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov eax,.VARIANT.bstrVal &nbsp; <br /> <br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;invoke WideCharToMultiByte,CP_ACP,WC_COMPOSITECHECK,eax,-1,offset stOutProcessorId,stIdSize,0,0<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;invoke StdOut,offset stOutProcessorId &nbsp; ;OutPut<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;invoke StdOut,offset reLine<br /><br /> &nbsp; &nbsp; &nbsp; &nbsp;;/// &nbsp; &nbsp;result-&gt;lpVtbl-&gt;Release(result);<br /><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov	eax, DWORD PTR result<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;push	eax<br /> &nbsp; &nbsp; &nbsp; &nbsp;;----------------------------------------------------<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mov	eax, .IWbemClassObject.lpVtbl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;call &nbsp; &nbsp;eax,<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;.IWbemClassObjectVtbl.Unknown.Release &nbsp; ;call &nbsp; &nbsp;DWORD PTR <br /> &nbsp; &nbsp; &nbsp; &nbsp;.endif<br /> &nbsp; &nbsp; &nbsp; &nbsp;;****************************************************************************************<br />.endif<br /><br /><br />;/// &nbsp; &nbsp;// release WMI COM interfaces <br />;/// &nbsp; &nbsp;results-&gt;lpVtbl-&gt;Release(results);<br />;/// &nbsp; &nbsp;services-&gt;lpVtbl-&gt;Release(services);<br />;/// &nbsp; &nbsp;locator-&gt;lpVtbl-&gt;Release(locator); <br />	mov	eax, DWORD PTR results<br />	push	eax<br /> &nbsp; &nbsp; &nbsp; &nbsp;;---------------------------<br />	mov	eax, .IEnumWbemClassObject.lpVtbl<br /> &nbsp; &nbsp; &nbsp; &nbsp;call &nbsp; &nbsp;.IEnumWbemClassObjectVtbl.Unknown.Release<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br />	mov	eax, DWORD PTR services<br />	push	eax<br /> &nbsp; &nbsp; &nbsp; &nbsp;;--------------------------<br />	mov	eax, .IWbemServices.lpVtbl<br />	call &nbsp; &nbsp;.IWbemServicesVtbl.Unknown.Release<br /><br />	mov	eax, DWORD PTR locator<br />	push	eax<br /> &nbsp; &nbsp; &nbsp; &nbsp;;--------------------------<br />	mov	eax, .IWbemLocator.lpVtbl<br />	call &nbsp; &nbsp;.IWbemLocatorVtbl.Unknown.Release<br /><br />; &nbsp; &nbsp;// unwind everything else we&#039;ve allocated <br />;/// &nbsp; &nbsp;CoUninitialize(); <br />	invoke	CoUninitialize<br /><br />;/// &nbsp; &nbsp;SysFreeString(query);<br />;/// &nbsp; &nbsp;SysFreeString(language);<br />;/// &nbsp; &nbsp;SysFreeString(resource);<br />	invoke	SysFreeString, query<br />	invoke	SysFreeString, _language<br />	invoke	SysFreeString, resource<br /><br /><br /> &nbsp; &nbsp; &nbsp; &nbsp;invoke ExitProcess,eax<br /><br />end start<br /></code></pre><br /><br /><span style="font-size:10pt><em>USE CODE BLOCKS!!!</em></span></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=3257" target="_blank">wmi.jpg</a></li>
      <li><a href="../../attachments/?id=3259" target="_blank">WMI_Good.zip</a></li>
      <li><a href="../../attachments/?id=3260" target="_blank">WMI_Src_Asm.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2010-10-04 08:01:55 by G-Spider</div>
   </div>
  </div>
 </body>
</html>