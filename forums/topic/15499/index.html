<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>cmd line emailer - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=15499" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=8">Networking</a> &raquo; <a href="../?id=15499">cmd line emailer</a></p>
   <div class="post" id="post-120419">
    <div class="subject"><a href="#post-120419">cmd line emailer</a></div>
    <div class="body">trying to make a commandline emailer program (lazy mans telnet)<br />any suggesions on how to get the body of the email from the commandline if the text is spaced getcommandline wont work.. maybe write the text with blah~blah~blah then parse the ~'s or something... also wondering on how to recieve the smtps responses<br /><br /><pre><code><br />                      the exe         recievers email       your email       subject      <br />                          |                    |                 |                |        <br />          USES&#58;   c&#58;\ExSendMail.exe&#91;imgmail&#93;http&#58;//www.asmcommunity.net/board/cryptmail.php?tauntspiders=in.your.face@nomail.for.you&amp;id=b04856d46a34d91b8d18872c2820c198&#91;/imgmail&#93;&#91;imgmail&#93;http&#58;//www.asmcommunity.net/board/cryptmail.php?tauntspiders=in.your.face@nomail.for.you&amp;id=4d3ce805877308e7d86289005e89406d&#91;/imgmail&#93; Reminder <br />.386<br />.model flat,stdcall<br />option casemap&#58;none<br />include \masm32\include\windows.inc<br />include \masm32\include\wsock32.inc<br />includelib \masm32\lib\wsock32.lib<br />include \masm32\include\user32.inc <br />includelib \masm32\lib\user32.lib            <br />include \masm32\include\kernel32.inc <br />includelib \masm32\lib\kernel32.lib<br />include \masm32\include\masm32.inc<br />includelib \masm32\lib\masm32.lib<br /><br />.const<br />WM_SOCKET equ WM_USER+100<br /><br />.data<br />from     db &quot;mail from&#58; %s&quot;,13,10,0         ;tell it your address<br />send_to  db &quot;rcpt to&#58; %s&quot;,13,10,0           ; whom you wanna send to<br />data1    db &quot;data&quot;,13,10,0                  ;rfc email command to say your sending data<br />subject  db &quot;subject&#58; %s&quot;,13,10,13,10,0     ; the subject &quot;free pr0n!!&quot;<br />data     db &quot;i luv you&quot;,13,10,&quot;.&quot;,13,10,0   ;the body of the email<br />quit     db &quot;quit&quot;,13,10,0                  ;obvious &#58;D<br />hostname db &quot;smtp.hair.net&quot;,0               ;the address of the smtp<br />hello    db &quot;helo illwill-mail&quot;,0dh,0ah     ; say hi<br />szDone   db &quot;Your mail was sent.&quot;,0<br />Port     dd 25                           ; smtp port = always 25<br />wsadata  WSADATA &lt;&gt;<br />sin      sockaddr_in &lt;&gt;<br />commandL dd 0<br /><br />.data?<br />frombuffer    db 256 dup&#40;?&#41;<br />sendtobuffer  db 256 dup&#40;?&#41;<br />subjectbuffer db 256 dup&#40;?&#41;<br />databuffer    db 256 dup&#40;?&#41;<br />fromsend      db 256 dup&#40;?&#41;<br />send_tosend   db 256 dup&#40;?&#41;<br />subjectsend   db 256 dup&#40;?&#41;<br />datasend      db 256 dup&#40;?&#41;<br />gymsock       dd ?<br /><br /><br />.code<br />start&#58;<br />invoke GetCommandLine<br />mov commandL, eax<br /><br />invoke GetCL, 1, addr frombuffer  ; get your own email address<br />  invoke wsprintf,addr fromsend,addr from,addr frombuffer<br />invoke StdOut, addr fromsend<br /><br />invoke GetCL, 2, addr sendtobuffer ; get the bad guys email addy<br />  invoke wsprintf,addr send_tosend,addr send_to,addr sendtobuffer<br />invoke StdOut, addr send_tosend<br /><br />invoke GetCL, 3, addr subjectbuffer ; get the subject you wanna send<br />  invoke wsprintf,addr subjectsend,addr subject,addr subjectbuffer<br />invoke StdOut, addr subjectsend<br />;----------- skip this for now----------------------------------------------------------------------------<br />;invoke GetCL, 4, addr databuffer ; get the body you wanna send<br />;  invoke lstrcat,addr data,addr databuffer<br />;invoke StdOut, addr databuffer<br />;--------------------------------------------------------------------------------------------------------------<br />;gotta start up some socks, i bet you used to wear striped socks up to your knee caps<br />sockz&#58;<br />   invoke WSAStartup,101h,addr wsadata<br />        cmp eax, INVALID_SOCKET<br />        je sockzerror           ;error initializing winsock<br />   invoke socket,AF_INET,SOCK_STREAM,0<br />      mov gymsock,eax       <br />   invoke WSAAsyncSelect,gymsock,0,WM_SOCKET,FD_CLOSE+FD_READ      <br />                  mov sin.sin_family,AF_INET<br />            invoke htons,Port<br />            mov sin.sin_port,ax<br />            invoke gethostbyname,addr hostname       ; this part here<br />              cmp eax,0                              ; it resolves smtp and <br />              jz sockzerror                          ; If not reachable, try again.<br />            mov eax,&#91;eax+12&#93;<br />            mov eax,&#91;eax&#93;<br />            mov eax,&#91;eax&#93;<br />            mov sin.sin_addr,eax<br />            invoke connect,gymsock,addr sin,sizeof sin          <br />;================== send that shit , took out the error checking &#58;D ===========================================<br />  invoke send,gymsock,addr hello,sizeof hello,0<br />  invoke send,gymsock,addr fromsend,sizeof fromsend,0<br />  invoke send,gymsock,addr send_tosend,sizeof send_tosend,0<br />  invoke send,gymsock,addr data1,sizeof data1,0<br />  invoke send,gymsock,addr subjectsend,sizeof subjectsend,0<br />  invoke send,gymsock,addr data,sizeof data,0<br />  invoke send,gymsock,addr quit,sizeof quit,0<br />; peace out cub scout<br />invoke StdOut, addr szDone<br />invoke ExitProcess,0<br /><br />;a little bit of sock error checking<br />sockzerror&#58;<br />	invoke WSACleanup<br />	invoke Sleep, 3000<br />	jmp sockz<br />end start<br /></code></pre></div>
    <div class="meta">Posted on 2003-10-03 17:46:51 by illwill</div>
   </div>
   <div class="post" id="post-120431">
    <div class="subject"><a href="#post-120431">cmd line emailer</a></div>
    <div class="body">Can't you just enclose the body text in quotes?</div>
    <div class="meta">Posted on 2003-10-03 20:37:30 by Will</div>
   </div>
   <div class="post" id="post-120453">
    <div class="subject"><a href="#post-120453">cmd line emailer</a></div>
    <div class="body">hi illwill<br /> <br />one way to do it is to save every line from the body in text file and then, when reading the file you make the &quot;\n&quot; to &quot;\r\n&quot; and you send it</div>
    <div class="meta">Posted on 2003-10-04 02:13:52 by matix</div>
   </div>
   <div class="post" id="post-120502">
    <div class="subject"><a href="#post-120502">cmd line emailer</a></div>
    <div class="body">You can take the body parameter as file path pointing to a file where you have already saved the body.<br /><br />As for recieving, you use the &quot;recv&quot; socket API, which takes the same parameters that &quot;send&quot; takes. You will note taht the SMTP server will respond at once you &quot;connect&quot; to it. For most cases, you willl only need to parse the first 3 characters of the response, which will represent the code that indicate wheather everything is fine.<br /><br />Whenever you get a reply beginning with 2xx, it means the operationhas been done successfully. Replies beginning with 4xx and 5xx, indicate there is something wrong. And usually, replies beginning with 3xx represent a waiting state, as for the case when you issue a DATA command.<br /><br />If this does not help, and you need more info, I suggest that you read RFC 821 and/or 2821.</div>
    <div class="meta">Posted on 2003-10-04 12:52:58 by hosam_shahin</div>
   </div>
   <div class="post" id="post-120522">
    <div class="subject"><a href="#post-120522">cmd line emailer</a></div>
    <div class="body">we meet again  , :tongue:<br /><br />If you are seriously considering to make this into a actual console application (not just purely commandline), you have to create a handle for console i/o, and then use the console APIs supplied to read/write from it. Since you are doing it in masm:<br /><br /><br /><pre><code><br />BUFFER_SIZE equ 256<br /><br />.data<br />buffer BYTE BUFFER_SIZE dup&#40;?&#41;,0,0  ;2 nulls<br />nBytesRead DWORD ?<br /><br />...<br /><br />.code<br /><br />start&#58;<br />;GetStdHandle prototype&#58;<br />;<br />;GetStdHandle PROTO nStdHandle&#58;DWORD<br />;<br />invoke GetStdHandle, STD_INPUT_HANDLE ; standard input handle<br />mov hInStdHandle, eax<br /><br /><br /><br />;ReadConsole prototype&#58;<br />;<br />;ReadConsole PROTO handle&#58;DWORD, pBuffer&#58;PTR BYTE, maxBytes&#58;DWORD, pBytesRead&#58;PTR DWORD, Reserved&#58;DWORD<br />;<br />;<br /><br />invoke ReadConsole, hInStdHandle, addr buffer, BUFFER_SIZE-2, addr nBytesRead, 0<br /><br />;buffer now holds input<br /><br />invoke ExitProcess, 0<br />end start<br /><br /></code></pre><br /><br /><br /><br />If you want to output something, you can use WriteConsole(), which also requires a seperate handle (output), basically the same thing:<br /><br /><pre><code><br /><br />.data<br /><br />message BYTE &quot;drocon is teh s3x&quot;,0dh,0ah<br />message_size equ &#40;$-message&#41;<br /><br />hOutStdHandle DWORD ?<br />nBytesWritten DWORD ?<br /><br /><br />.code<br /><br />start&#58;<br /><br />invoke GetStdHandle, STD_OUTPUT_HANDLE<br />mov hOutStdHandle, eax<br /><br />invoke WriteConsole, hOutStdHandle, addr message, message_size, addr nBytesWritten, 0<br /><br />invoke ExitProcess,0<br /><br />end start<br /><br /></code></pre><br /><br />But as for the SMTP replies, you better take a look at the RFCs, or just directly pipe the output.<br /><br /><br />damn i'm forgetting my masm syntax :P i almost typed 'buffer times 256 db 0'.<br /><br />&lt;3 nasm :grin:</div>
    <div class="meta">Posted on 2003-10-04 22:17:54 by Drocon</div>
   </div>
   <div class="post" id="post-120623">
    <div class="subject"><a href="#post-120623">cmd line emailer</a></div>
    <div class="body">I wrote a command line e-mailer as an error notifier for an VB application I wrote.  I needed a low level error control that did not have to depend on much of the OS to work in order to function.  <br /><br />I simply translated commas into CR,LF pairs in the body portion of the commandline until there was no more commandline to process.<br /><br />First part of parsing the commandline were for known fields for the e-mail, then the body was added at the end with commas for lines.<br /><br />It was programmed as a regular window for to process messages, but did not call ShowWindow, so nothing was shown to the user.<br /><br />Regards,  P1 :cool:</div>
    <div class="meta">Posted on 2003-10-06 10:47:31 by Pone</div>
   </div>
  </div>
 </body>
</html>