<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>PE file format: what does this flag do? IMAGE_SCN_MEM_NOT_PA - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=2998" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=2998">PE file format: what does this flag do? IMAGE_SCN_MEM_NOT_PA</a></p>
   <div class="post" id="post-19558">
    <div class="subject"><a href="#post-19558">PE file format: what does this flag do? IMAGE_SCN_MEM_NOT_PA</a></div>
    <div class="body">Hi All,<br />What does IMAGE_SCN_MEM_NOT_PAGED do?<br /><br />Is there any way to force the OS EXE loader to allocate physical<br />(locked, not swappable) memory for my program, just as if it was<br />a VxD?<br /><br />Thanks,<br />Maverick</div>
    <div class="meta">Posted on 2002-01-16 17:16:47 by Maverick</div>
   </div>
   <div class="post" id="post-19565">
    <div class="subject"><a href="#post-19565">PE file format: what does this flag do? IMAGE_SCN_MEM_NOT_PA</a></div>
    <div class="body">There aren't any way to do it that I know of. If you really *need*<br />to lock the memory, you should probably use a VXD/KMD. If you<br />don't *need* to lock the memory... don't :). If your program is small<br />enough it will not be swapped out. It it's large enough to be swapped<br />out, it's rude to use locked memory.<br /><br />Just my thoughts.<br /><br />Why do you need locked memory?</div>
    <div class="meta">Posted on 2002-01-16 17:47:00 by f0dder</div>
   </div>
   <div class="post" id="post-19570">
    <div class="subject"><a href="#post-19570">PE file format: what does this flag do? IMAGE_SCN_MEM_NOT_PA</a></div>
    <div class="body">flag 00040000 also states &quot;LOCKED&quot;.. dunno if it's supported for real anyway.<br /><br />Anyway, why do I need locked memory? Because I think that virtual memory sucks, that's why. I hope you will forgive me about having such a strong opinion on the subject (relative to the use I do with a computer, of course, I do NOT say that virtual memory ALWAYS AND FOR ALL APPLICATIONS sucks).<br /><br />I write *realtime* games/demos: ok, Windows is not a realtime OS but that's what we were all enforced to use and to code for, expecially at the commercial level. To die of hunger is not an option for me, so I don't think that it would be fair to tell me &quot;you're free to code for UnknownNoMarketOS if you think Windows is not perfect&quot;.<br />So I have to make it as much realtime as possible.. this means using high priority to get as much CPU as possible (or even more advanced solutions), this also means to get physical memory instead of virtual memory, when I have almost all the CPU for me anyway. Why? Because I hate to get the action in my frantic/realtime game interrupted by those silly and often useless vmem swaps.<br /><br />That's my view on the subject, you may have a radically different view, so don't insult me if I replied to your question.<br /><br />Take care,<br />Maverick</div>
    <div class="meta">Posted on 2002-01-16 18:06:29 by Maverick</div>
   </div>
   <div class="post" id="post-19573">
    <div class="subject"><a href="#post-19573">PE file format: what does this flag do? IMAGE_SCN_MEM_NOT_PA</a></div>
    <div class="body">Well... if you lock your game memory, windows will see it's available<br />pool of memory decrease, and might choose to do swapping it might<br />not have done otherwise. Also... *why* lock, really? I've seen countless<br />games that don't lock, and they have all run fine. No swapping done in<br />critical parts. And no, this is not on some superleet machine with tons<br />of ram (well, of course it hasn't swapped with my machine with tons of<br />ram either), but machines that have met the recommended game requirements.<br /><br />Windows doesn't swap for no reason. It swaps if it's low on memory. It will<br />go for least recently used pages first. Thus, critical parts of your executable<br />shouldn't be swapped out, nor should data you use much. With &quot;proper&quot; use of<br />memory (ie, not allocating a big 128meg block or more, like some games do<br />today :-( ), you shouldn't really need locked memory.<br /><br />Be careful when messing with thread priorities. Especially realtime ;).<br />Realtime thread priority isn't needed in games. It might be justifiable<br />to set it to &quot;above normal&quot; or &quot;high&quot; though. Hell, if games run fluidly on<br />my old 200mhz machine without any of these tricks... why would you need them<br />at all? I can understand why you might desire these things, coming from an<br />amiga background where you could write much lower level code, since you didn't<br />have to think about multitasking, and didn't have to support a very broad<br />range of hardware.<br /><br />Come to think of it, I have never experienced paging in any well-designed<br />game unless some background task has kicked in - and locked memory would<br />hardly help on that ;).<br />.</div>
    <div class="meta">Posted on 2002-01-16 18:24:24 by f0dder</div>
   </div>
   <div class="post" id="post-19592">
    <div class="subject"><a href="#post-19592">PE file format: what does this flag do? IMAGE_SCN_MEM_NOT_PA</a></div>
    <div class="body">Hi again f0dder,<br /><br /><div class="quote"><strong>Well... if you lock your game memory, windows will see it's available <br />pool of memory decrease, and might choose to do swapping it might <br />not have done otherwise. </div></strong><br /><br />Not if I disable &quot;multitasking&quot;  :grin: <br /><br /><br /><div class="quote"><strong>Also... *why* lock, really? I've seen countless <br />games that don't lock, and they have all run fine. No swapping done in <br />critical parts. And no, this is not on some superleet machine with tons <br />of ram (well, of course it hasn't swapped with my machine with tons of <br />ram either), but machines that have met the recommended game requirements. </div></strong><br /><br />Hmm.. permit me to disagree. In my experience those swaps happen, and more than I'd allow. Anyway, since I had 256MB (now 512MB) I've always disabled virtual memory (Win95/98/ME), and am happy so. I'm not a fan of virtual memory (as we know it from Windows), can't help it.<br />In my &quot;Game OS&quot; (let's call it this way for simplicity, ok?) I have implemented the heap functions in a way that will limit fragmentation and physical usage as much as possible.. but still my OS doesn't take too much decisional power from my application. Of course all of this is useless if the host OS supports only virtual memory. Not that I don't know how to allocate physical memory (or lock virtual) without even using a VxD in 9x.. it's just that I'd prefer a more general method, that doesn't use semi-undocumented functions, and that runs on NT/2000/XP as well. All of this is optional, of course, but I know how I keep that option set when I run my apps..<br /><br /><div class="quote"><strong>Windows doesn't swap for no reason. </div></strong><br /><br />Last time I really tested this (I admit, it was Windows95 OSR2.1 times) this was *absolutely* untrue (I tested it throughfully, don't doubt). I hope things have evolved with the newer Windows versions.<br /><br />Also, please don't assume that Windows is perfect. There was a thread time ago on Usenet (which then became a big flamewar) because I was a bit pissed that a function (don't really recall anymore if it was related to high resolution timers or to DX's VBL support) the OS returned &quot;this function IS implemented&quot;, while it was NOT.. with all the consequences you may imagine. Really, such things may piss me off a lot, while to others it's just &quot;a bug&quot;, or even a reason to blame me as an anti-Microsoft troll, as if I was happy to waste my development time hunting down Windows bugs instead of my own bugs. Too many times it happened this way.. there was a nasty, strange bug.. I looked for it for days and days, until I found it.. and it wasn't in my code. I would have preferred it was.<br /><br /><div class="quote"><strong>Hell, if games run fluidly on <br />my old 200mhz machine without any of these tricks</div></strong><br /><br />May I ask you something? All of DX 8.1's samples contained in the SDK, on my Athlon-XP 1800+ with a 3DFX Voodoo5 V5500 run with &quot;marvellous&quot;, hundreds of fps framerate for 0.9 sec, then stop for 0.1 sec, and so on.. cyclically. Do you call this &quot;fluid&quot;?<br /><br />Have you ever seen an Amiga mouse pointer (mouse and video are perfectly frame rate synched)? How does it compare to the one of any PC? That's what I call &quot;fluid&quot;, personally. Another reason why I don't like triple-buffering (it makes you claim a higher framerate, but it makes the fps unconstant. With double-buffering you have a bigger possibility to make it constant).<br />I have a certain experience with video oriented machines, I'm quite sensitive to what is fluid and what seems to be.<br /><br /><div class="quote"><strong>I can understand why you might desire these things, coming from an <br />amiga background where you could write much lower level code, since you didn't <br />have to think about multitasking</div></strong><br /><br />Let's exclude memory protection, the Amiga has a much better multitasking than Windows. The Amiga is not a console, it's designed more like a workstation.<br /><br />The lack of memory protection didn't make the Amiga crash more than Windows9x anyway, and by far.<br /><br />In 12 years that I've had an HD in my Amiga, I've NEVER reinstalled the OS. I really don't have a clue how installing AmigaOS is.. I never did it. I bought my A1200 with the OS already installed on the HD. Now tell me how many times the average user reinstalls Windows9x?<br /><br />Ok, although I don't think it's fair, you'll tell me that if 9x sucks, NT is a good product instead. Well, at what price? A task switch for every OS function call, as a norm? Ain't that ridicolous? I can't crash a machine neither if I code in Java or even better in Logo.. for me it's the same thing.<br /><br />NT doesn't crash?<br /><br />Was just studying this (quite famous) document on the PE file format, when I found: (document is hellowmb.txt)<br /><br /><strong><em><br />3. This article was based on a 'trial and error' method. Some solutions exist  <br />only because they work. So don't ask why... (Actually the trial and error <br />resulted in two BSODs, thus proving that a program can crash windows NT without <br />even running it's own code)</strong></em><br /><br /><br />Yes, you can call me an anti-Microsoft person (don't call me a troll though :tongue: ). But I didn't born and say &quot;Microsoft sucks&quot;, actually I learnt it during the years..<br /><br /><strong>IF</strong> I'm biased, I became biased anyway.. I wasn't born this way (nor anybody tryed to convince me to have these anti-MS opinions.. rather the opposite in some cases).<br /><br />For honesty of thought, I've to add I'm not a fan of Linux too (although I certainly prefer it to Windows under many aspects.. starting from the OpenSource philosophy and the &quot;community&quot; way of doing things).<br /><br />Anyway, I wish you g'nite.. I better go to sleep (a couple of hours per day is better than nothing ;) )<br /><br />Maverick</div>
    <div class="meta">Posted on 2002-01-16 19:54:49 by Maverick</div>
   </div>
   <div class="post" id="post-19638">
    <div class="subject"><a href="#post-19638">PE file format: what does this flag do? IMAGE_SCN_MEM_NOT_PA</a></div>
    <div class="body">I don't call you anti-microsoft. And I'm not a blind devotee myself.<br />There's a lot of microsoft stuff that sucks. Win9x. I'm not too fond<br />of .net. The happyfluffy UI of WinXP sucks. Office sucks. And win2k<br />isn't perfect - it's just the best solution there is at the moment.<br />(The kernel is quite fine and dandy, the problems lie with the other<br />parts of the OS, that have been left to less competent programmers.)<br /><br /><div class="quote"><br />Not if I disable &quot;multitasking&quot;<br /></div><br />What you want is to code for the X-Box then :-). If you just mean<br />&quot;task switching&quot; as in alt+tab... then don't disable that either.<br />What if I have to adjust my volume settings because I've changed<br />from headphones to speakers and forgot to adjust? Or what if I<br />need to shut down my ICQ client, or perhaps quickly respond to a<br />message? Terminating the game and starting it again is annoying,<br />especially with large games that take a long time to load.<br /><br /><div class="quote"><br />I'm not a fan of virtual memory (as we know it from Windows), can't help it.<br /></div><br />I am. I couldn't run stuff like 3d studio max without it. Ok,<br />sometimes the strategies might feel a bit weird... but it's all<br />quite tweakable really. Btw, you don't want to run games on the<br />server editions of win2k, as they feel the filesystem cache is<br />more important than keeping all applications in memory... which<br />makes sense for a server, I guess.<br /><br /><div class="quote"><br />Not that I don't know how to allocate physical memory (or lock virtual)<br />without even using a VxD in 9x.. <br /></div><br />Kernel32 ordinal 0? Oh well, if you make physical locking optional<br />I guess it's okay. Just don't stuff it down anybodys throath :-).<br /><br /><div class="quote"><br />hundreds of fps framerate for 0.9 sec, then stop for 0.1 sec, and so<br />on.. cyclically. Do you call this &quot;fluid&quot;?<br /></div><br />No, I call it weird. I've never had problems like that on my puny<br />little GeForce2, nor on my kid brothers' even punier voodoo3.<br />My friend who recently bought a GeForce3 (top model, Ti-500 deluxe)<br />had similar problems though. And lots of crashes. And stalls. So now<br />he's ditching his 1ghz athlon and getting a pentium4... you see,<br />VIA (the guys who make the chipsets for athlons) didn't feel like<br />licensing the AGP specs, so the reverse engineered them. That's really<br />oh so great for system stability. I have an athlon myself, but it's<br />one of the lower frequencies (700mhz)... if I turn on fast writes or<br />set AGP rate to &gt; 2x... I get crashes 5 minutes after I enter windows.<br />But at least with these options off... it's perfectly stable and everything<br />is fluid.<br /><br /><div class="quote"><br />Have you ever seen an Amiga mouse pointer (mouse and video are perfectly<br />frame rate synched)?<br /></div><br />Yes, I owned an amiga600, and had several friends with amiga500's.<br /><br /><div class="quote"><br />How does it compare to the one of any PC?<br /></div><br />I don't really know what you're getting at here... with hardware mouse<br />cursors, the cursor should be perfectly synced with the video rate on<br />a PC... thing is, if you use serial mice or untweaked PS/2 mice, the<br />update rate of the mouse is quite sucky. With a tweaked PS/2 mouse, or<br />my wonderful optical mouse, all the mouse business feels a lot more<br />smooth than it ever did back in the amiga days.<br /><br /><div class="quote"><br />The lack of memory protection didn't make the Amiga crash more than<br />Windows9x anyway, and by far.<br /></div><br />I've had my share of guru meditations ;). BUt face it, when you run a<br />game on an amiga, this is almost always done from a floppy with a custom<br />bootloader, which means there's hardly anything going on in the background.<br />There's just much less chance of a crash happening. And if it happens?<br />Not too much of a deal, it's only the game that goes down.<br /><br />As for operating system reinstalls... the only reason I've really had to<br />do this has been because of third-party software clogging up the system.<br />Or faulty drivers. Which is hardly microsoft's fault, really. It's just<br />the average joe windows-programmer that's a stupid twat, likes to dump<br />various files in various places, modify registry keys without restoring<br />them on uninstall (et cetera). After a few months of testing various<br />shareware applications on a 9x box... time to reinstall.<br /><br /><div class="quote"><br />NT is a good product instead. Well, at what price? A task switch for<br />every OS function call, as a norm? Ain't that ridicolous?<br /></div><br />Task switch? Don't think so. Ring3-&gt;Ring0? Probably, yes. When we talk<br />core OS functions. A call to kernel32 or user32 doesn't necessarily end<br />in ring0 land. I don't think this is too bad, considering the protection<br />the NT kernel offers. In 9x, you end up taking ring3-&gt;ring0 transitions,<br />*as well* as 32-&gt;16bit transitions... now tell me what is worst ;).<br />Also, remember that NT was built with stability in mind, not necessarily<br />multimedia performance. It still has better performance (for me) than<br />9x had. Don't tell me we all have to go code in sandboxed languages<br />because the core OS could be a few percentages faster that way.<br /><br />NT *can* crash. If you're seriously messing around, or perhaps even trying<br />deliberately to make it crash, you might just get lucky :-). Interesting<br />that some PE stuff should be able to crash NT. Perhaps this is old 3.x or 4.x<br />kernels? I have thrown some *quite* messy PE's at the loader, and I've never<br />had anything but a GPF. I've never had any of my ring3 code BSOD nt. And<br />trust me, I have done some pretty dirty stuff ;). Under 9x I would have a<br />development cycle of build, run, crash, (hard)reboot, goto 10. Win2k? I just<br />press the &quot;OK&quot; button in the GPF dialog, and goto 10 :).</div>
    <div class="meta">Posted on 2002-01-17 06:17:25 by f0dder</div>
   </div>
  </div>
 </body>
</html>