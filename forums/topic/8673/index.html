<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>get percent help!! - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=8673" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=8673">get percent help!!</a></p>
   <div class="post" id="post-63784">
    <div class="subject"><a href="#post-63784">get percent help!!</a></div>
    <div class="body">;        hi evryone!!<br />;        get percent help!!            <br /><br /><br />        <br />                fild dword ptr <br />	fild dword ptr <br />	fdiv <br />	fild dword ptr <br />                fmul  <br />	fist dword ptr <br /><br />       <br />; some loop then,  var1  ==  80000000h<br />; why??!!<br /><br />;sorry, i cant write english<br />:confused:</div>
    <div class="meta">Posted on 2002-10-28 08:24:54 by playh</div>
   </div>
   <div class="post" id="post-63786">
    <div class="subject"><a href="#post-63786">get percent help!!</a></div>
    <div class="body">I'm not so good at FPU coding, but it looks like you forgot to pop the values off the stack.<br /><br />Try:<br /><br /><br />fild dword ptr <br />fild dword ptr <br />fdiv <br />fild dword ptr <br />fmul <br />fistp dword ptr  ; Notice the &quot;fistp&quot; instead of &quot;fist&quot;<br />fistp dword ptr <br /><br />If anyone knows of a way to pop a value off the FPU stack without storing it, please post :)</div>
    <div class="meta">Posted on 2002-10-28 09:08:55 by Qweerdy</div>
   </div>
   <div class="post" id="post-63790">
    <div class="subject"><a href="#post-63790">get percent help!!</a></div>
    <div class="body">thx!!<br />got it!!<br />:alright:</div>
    <div class="meta">Posted on 2002-10-28 09:22:07 by playh</div>
   </div>
   <div class="post" id="post-63791">
    <div class="subject"><a href="#post-63791">get percent help!!</a></div>
    <div class="body">As I said, I'm not that good at FPU coding. I just read that fdiv and fmul without operands each pop one value off the stack, so at the end there's only one value on the stack.<br /><br />In short: try removing the last line (the fistp ), it should work.</div>
    <div class="meta">Posted on 2002-10-28 09:30:36 by Qweerdy</div>
   </div>
   <div class="post" id="post-63792">
    <div class="subject"><a href="#post-63792">get percent help!!</a></div>
    <div class="body">Why use the slooooow floating point instructions to perform integer mathematics?<br /><br /><pre><code><br />; Computes a as A percentage of B<br />mov eax, A<br />mov ecx, B<br /><br />lea edx, &#91;eax*2 + eax&#93;<br />lea eax, &#91;edx*8 + eax&#93;<br />shl eax, 2<br /><br />xor edx, edx<br />idiv ecx<br /></code></pre><br /><br />Note: should work for any value of A up to 42,949,672<br /><br />Mirno</div>
    <div class="meta">Posted on 2002-10-28 10:01:27 by Mirno</div>
   </div>
  </div>
 </body>
</html>