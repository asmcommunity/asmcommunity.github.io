<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Got eax working, but... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=13106" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=13106">Got eax working, but...</a></p>
   <div class="post" id="post-101822">
    <div class="subject"><a href="#post-101822">Got eax working, but...</a></div>
    <div class="body">...eax has decided to go into the stratosphere again.<br /><br />In the code below:<br /><br /><br />mov(26,eax);<br />mov(3,lo); // put clerk in shop r#3<br />mov(27,eax);<br />mov(6,lo); // put villager at well r#6<br />mov(28,eax);<br />mov(14,lo); // put wolf at intersection r#14<br />mov(29,eax);<br />mov(30,lo); // put warrior at winding road r#30<br />mov(30,eax);<br />mov(20,lo); // put ghost in Redwood forest r#20<br />mov(31,eax);<br />mov(22,lo); // put goblin in Path r#22<br />mov(32,eax);<br />mov(27,lo); // put elf in Rolling Hills r#27<br />mov(33,eax);<br />mov(18,lo); // put hobbit in Grassroof hut r#18<br />mov(34,eax);<br />mov(10,lo); // put paladin in Village guild r#10<br />mov(35,eax);<br />mov(85,lo); // put skeleton in Caverns r#85<br />mov(36,eax);<br />mov(92,lo); // put vampire in Caverns r#92<br />mov(37,eax);<br />mov(94,lo); // put sorcerer in Caverns r#94<br />mov(38,eax);<br />mov(39,lo); // put dragon at Cave entrance r#39<br /><br /><br />I am assigning monsters in the game to various locations in the game. The locations of the monsters are being &quot;Mov&quot;ed into lo, a subscripted array variable. <br /><br />They are then printed out to the screen like so:<br /><br /><br />// place noun#7<br />mov(7,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;lantern&quot;,nl);<br />endif;<br /><br />// place noun#8<br />mov(8,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;oil&quot;,nl);<br />endif;<br /><br />// place noun#9<br />mov(9,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;rope&quot;,nl);<br />endif;<br /><br />// place noun#10<br />mov(10,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;key&quot;,nl);<br />endif;<br /><br />// place noun#11<br />mov(11,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;bottle&quot;,nl);<br />endif;<br /><br />// place noun#12<br />mov(12,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;dagger&quot;,nl);<br />endif;<br /><br />// place noun#13<br />mov(13,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;sword&quot;,nl);<br />endif;<br /><br />// place noun#14<br />mov(14,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;axe&quot;,nl);<br />endif;<br /><br />// place noun#15<br />mov(15,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;scimitar&quot;,nl);<br />endif;<br /><br />// place noun#16<br />mov(16,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;longsword&quot;,nl);<br />endif;<br /><br />// place noun#17<br />mov(17,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;broadsword&quot;,nl);<br />endif;<br /><br />// place noun#18<br />mov(18,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;battleaxe&quot;,nl);<br />endif;<br /><br />// place noun#19<br />mov(19,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;cleaver&quot;,nl);<br />endif;<br /><br />// place noun#20<br />mov(20,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;armor&quot;,nl);<br />endif;<br /><br />// place noun#21<br />mov(21,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;shield&quot;,nl);<br />endif;<br /><br />// place noun#22<br />mov(22,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;helmet&quot;,nl);<br />endif;<br /><br />// place noun#23<br />mov(23,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;gauntlets&quot;,nl);<br />endif;<br /><br />// place noun#24<br />mov(24,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;cloak&quot;,nl);<br />endif;<br /><br />// place noun#25<br />mov(25,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;ring&quot;,nl);<br />endif;<br /><br />// place noun#26<br />mov(26,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;clerk&quot;,nl);<br />endif;<br /><br />// place noun#27<br />mov(27,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;villager&quot;,nl);<br />endif;<br /><br />// place noun#28<br />mov(28,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;wolf&quot;,nl);<br />endif;<br /><br />// place noun#29<br />mov(29,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;warrior&quot;,nl);<br />endif;<br /><br />// place noun#30<br />mov(30,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;ghost&quot;,nl);<br />endif;<br /><br />// place noun#31<br />mov(31,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;goblin&quot;,nl);<br />endif;<br /><br />// place noun#32<br />mov(32,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;elf&quot;,nl);<br />endif;<br /><br />// place noun#33<br />mov(33,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;hobbit&quot;,nl);<br />endif;<br /><br />// place noun#34<br />mov(34,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;paladin&quot;,nl);<br />endif;<br /><br />// place noun#35<br />mov(35,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;skeleton&quot;,nl);<br />endif;<br /><br />// place noun#36<br />mov(36,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;vampire&quot;,nl);<br />endif;<br /><br />// place noun#37<br />mov(37,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;sorcerer&quot;,nl);<br />endif;<br /><br />// place noun#38<br />mov(38,ebx);<br />mov(lo,eax);<br />if(eax=r) then<br />console.setOutputAttr( win.fgnd_LightRed | win.bgnd_Black );<br />stdout.put(&quot;dragon&quot;,nl);<br />endif;<br /><br /><br />However, upon doing a stdout.put(lo[26],nl);<br />it prints out an out of range number for lo[26]:<br /><br />43654543<br /><br />or something like that. lo[26] should be 3, not 43654543:<br /><br /><br />mov(26,eax);<br />mov(3,lo); // put clerk in shop r#3<br /><br /><br />Any ideas as to what I'm doing wrong? :)<br /><br />Sincerely,<br /><br />Paul Panks<br /><a href="mailto:dunric@yahoo.com">dunric@yahoo.com</a></div>
    <div class="meta">Posted on 2003-05-07 14:14:14 by Paul Panks</div>
   </div>
   <div class="post" id="post-101879">
    <div class="subject"><a href="#post-101879">You're not indexing into the array properly!</a></div>
    <div class="body">It's the same problem that has plagued you're earlier code.<br />You're confusing 80x86 addressing modes with array indexes<br />in a high level language.<br /><br />lo does *not* mean access the ebx-th element of array<br />&quot;lo&quot;;  it means to access the ebx-th byte beyond the base<br />address of the &quot;lo&quot; array.  Because each element is four bytes,<br />you're storing data into locations that overlap the elements<br />of your array.<br /><br />I strongly recommend that you take a look at the following two<br />subjects:<br /><br /><a target="_blank" href="http://webster.cs.ucr.edu/Page_AoAWin/HTML/MemoryAccessandOrg.html#999656">http://webster.cs.ucr.edu/Page_AoAWin/HTML/MemoryAccessandOrg.html#999656</a><br /><br />and<br /><br /><a target="_blank" href="http://webster.cs.ucr.edu/Page_AoAWin/HTML/Arrays.html#1003722">http://webster.cs.ucr.edu/Page_AoAWin/HTML/Arrays.html#1003722</a><br /><br />You have a very fundamental misunderstanding of how arrays work<br />in assembly language programming.  Several posters have given you<br />the code you need to correct your problems, but you don't seem to understand<br />the points they're making.  Before you attempt another line of code on this<br />project, you need to stop and learn about how you define arrays in assembly<br />and how you access elements of those arrays.<br />Cheers,<br />Randy Hyde</div>
    <div class="meta">Posted on 2003-05-07 20:52:59 by rhyde</div>
   </div>
   <div class="post" id="post-101895">
    <div class="subject"><a href="#post-101895">Got eax working, but...</a></div>
    <div class="body">Randy,<br /><br />In a previous post you mentioned that I needed to multiply edx * 4 for dword int32 arrays. Does this hold true for my current situation as well? e.g. lo. From reading the material you suggested this would seem to also be the case.<br /><br />Paul</div>
    <div class="meta">Posted on 2003-05-07 22:26:52 by Paul Panks</div>
   </div>
   <div class="post" id="post-102030">
    <div class="subject"><a href="#post-102030">Got eax working, but...</a></div>
    <div class="body"><div class="quote"><br />Randy,<br /><br />In a previous post you mentioned that I needed to multiply edx * 4 for dword int32 arrays. Does this hold true for my current situation as well? e.g. lo. From reading the material you suggested this would seem to also be the case.<br /><br />Paul </div><br /><br />Whenever you access *any* array element, you need to multiply the index by the size of the array element.  The only time you multiply by one (that is, you leave the index alone) is when you access elements of a byte (char) array.  In all other cases you must multiply by the size of the array element.<br />The 80x86 provides &quot;scaled indexed addressing modes&quot; that automatically multiply by four common sizes:<br />*1, *2, *4, and *8, e.g., m.  For any other size you'll have to manually do the multiplication yourself (technically, this is not completely true.  There are a couple of sizes you can do a multiplication by &quot;cheating&quot;, specifically *3, *5, and *9 by using addressing modes like , , and ;  however, *1, *2, *4, and *8 are, by far, the most common scaled index values).<br /><br />BTW, this applies to constant indicies as well (if I haven't mentioned this already).<br />e.g.,<br /><br />mov( 1, m[1]); <br /><br />is *not* correct if m is a dword array.<br />This tells the CPU to access the memory location *one byte* beyond the address of the start of m.<br />If m is a dword array, then the second element (at index one) is four bytes beyond the start of m.<br /><br />Generally when working with constants, you use the following type of code:<br /><br />mov( 1, m[1*4] ); // This multiplication is all constants, so it can be done at compile time!<br />mov( 3, m[3*4] );<br />mov( 5, m[7*4] );<br />etc.<br /><br />You could also type &quot;mov( 1, m[4] );&quot; and &quot;mov( 3, [12] );&quot; (etc.), but the explicit multiplication makes it clear that you are accessing elements of a dword array rather than elements of a byte array.<br /><br />Cheers,<br />Randy Hyde</div>
    <div class="meta">Posted on 2003-05-08 16:42:12 by rhyde</div>
   </div>
   <div class="post" id="post-102037">
    <div class="subject"><a href="#post-102037">Got eax working, but...</a></div>
    <div class="body">Hello Randy,<br /><br />So to do the following:<br /><br />mov(26,eax);<br />mov(3,lo); // put clerk in shop r#3<br /><br />I need to go:<br /><br />mov(26,edx)<br />mov(3,lo);<br /><br />??<br /><br />I just want to make element lo[26] store a value of 3 (placing noun #26, i.e. lo[26] in room #3 (3) )<br /><br />In GW-BASIC or QBASIC this would mean:<br /><br />lo(26)=3<br /><br />when I would type:<br /><br />PRINT lo(26)<br /><br />the output should be:<br /><br />3<br /><br />And in HLA:<br /><br />stdout.put(lo[26],nl);<br /><br />the output needs to be:<br /><br />3<br /><br />(or &quot;lo[26]:=3&quot;; if I could do that instead);<br /><br />Sorry if this is redundant. :)<br /><br />Sincerely,<br /><br />Paul Panks<br /><a href="mailto:dunric@yahoo.com">dunric@yahoo.com</a></div>
    <div class="meta">Posted on 2003-05-08 17:26:25 by Paul Panks</div>
   </div>
  </div>
 </body>
</html>