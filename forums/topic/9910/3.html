<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>How to achieve &quot;function level linking&quot; with MASM? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=9910" />
  <link rel="prev" href="../?id=9910&amp;page=2" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=9910">How to achieve &quot;function level linking&quot; with MASM?</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=9910&amp;page=1" style="">&laquo;</a><a href="../?id=9910&amp;page=2" style="">&lt;</a><input type="hidden" name="id" value="9910" /><input type="number" name="page" min="1" max="3" step="1" value="3" onchange="this.form.submit();" /></form>   <div class="post" id="post-74530">
    <div class="subject"><a href="#post-74530">How to achieve &quot;function level linking&quot; with MASM?</a></div>
    <div class="body">Sorry for the late reply... i was falling into a deep sleep :)<br /><br /><div class="quote"><br />herman, why is it you call command.com or cmd.exe to spawn external processes? It ought to be superfluous (unless you're doing it to use shell commands like &quot;copy&quot;, in which case you really ought to write your own routines :)). </div><br /><br />Well.. I had program (hll) that i need to maintain for some client. It has the capability to do a backup from inside the program. The backup procedure use pkzip and pkunzip. So it runs command.com by default. <br /><br />It open a a dos window and leave it open after finish and it waits for users to close that window before return to the program. I can solved it use a pif file and checked &quot;close on exit&quot;.<br />But this was the problem is. First, I want my own windows in that program as a message for user (no dos window), also i don't want to create pif file for every computer (also for future sake) on my client side. So I need a tool for this. And then i becoming more involved for this particular tools... just a story :grin: <br /><br /><strong>NaN</strong><br />I am now on ME system and tried your latest program (2.1). The test program is the same with the last one i had posted, but i remove the #COFF and leave the #HEADER only. I had one message telling me that linker cannot build the lib.<br /><pre><code><br />LINK &#58; fatal error LNK1104&#58; cannot open file &quot;&quot;<br />trans2.inc<br />        1 File&#40;s&#41; copied<br /></code></pre><br />Haven't try it on 2K, but any idea for this ?<br /><br />Btw, I think soon this tools will become very handy and i am going to put this as one of my favorite tools :alright: <br /><br />Regards</div>
    <div class="meta">Posted on 2003-01-05 21:03:04 by HermanT</div>
   </div>
   <div class="post" id="post-74533">
    <div class="subject"><a href="#post-74533">How to achieve &quot;function level linking&quot; with MASM?</a></div>
    <div class="body">herman, it's a bit late and I'm not sure I understand you correctly,<br />bear over with me. But CreateProcess will allow you to force creation<br />of a new console, reuse existing console (and yes, GUI mode apps<br />*can* create consoles), or run without a console at all. So if console<br />management is why you use cmd.exe/command.com, then you might<br />not have to.<br /><br />NaN, using &quot;nop procs&quot; to test stuff like that might not be a good<br />idea, since NOP is used for padding. use rdtsc or something :)</div>
    <div class="meta">Posted on 2003-01-05 21:25:30 by f0dder</div>
   </div>
   <div class="post" id="post-74537">
    <div class="subject"><a href="#post-74537">How to achieve &quot;function level linking&quot; with MASM?</a></div>
    <div class="body"><div class="quote"><br />NaN,<br /><br />An obvious suggestion if you want synchronous operation with command line tools is to write a batch file that does the work you want. It does not work with GUI apps with a message loop but a linear console app works fine.<br /><br />Regards,</div><br /><br />You would think this to be true, but at least on my Win98SE it isnt true.  This is how i ran into all the problems that be.  I origionally did this, but the LIB.EXE wouldn't work cause the ASM's (on file) were not closed yet (an assumption) from the previous ML.EXE command in the batch file.  I dont know why it didnt work..  but the same batch file works if ran manually :confused: . However, from trial and error this is what i found happening. :me_dont_get_it_either:<br /><br />I acutally modelled the 'custom' batch file after your MAKE.BAT from the M32LIB dir ( :) you've been an excellent resource ;) )<br /><br />HermanT, <br /><br /> I have no clue what your error is.  I dont know how or why the LINKER got into this picture.  There is absolutely no calls to the linker!!  This error must be on you account... I cant offer help with out more idea what your trying to do.. /me: shrugs<br /><br />f0dder, <br /><br />Once again sage advice, thanx.  Its the little things you seem to pick up on most ;) .  I will do some trials to see if all holds true.. I appreciate your help.<br /><br />Everyone,<br /><br />Please try it out, and give me feedback.  Also let me know if your ok with the 'private' proceedure business.  I am, but that may not mean everyone else is ;) .  Its a mild overhead for people wanting to include private proc's...</div>
    <div class="meta">Posted on 2003-01-05 22:24:43 by NaN</div>
   </div>
   <div class="post" id="post-74538">
    <div class="subject"><a href="#post-74538">How to achieve &quot;function level linking&quot; with MASM?</a></div>
    <div class="body">From more tiral and error, i discovered f0dder's concerns to be NULL &amp; Void ;)<br /><br />Everything works as it should...<br /><br />As well, i also discovered that the private directive is of no *real* concern.  Even though there is no include generated, if you knew of it, you could make a PROTO manually and still call upon the function from the lib.  This is really no surprise, cause its been an age-old problem with masm, well as far as i remember anyways.<br /><br />However, adding multiple funtions/per scope is not a problem with the TEXTEQU solution.<br /><br />So are people happy with this version? Or should i add more 'fixes'??<br /><br /><br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2003-01-05 22:35:52 by NaN</div>
   </div>
   <div class="post" id="post-74561">
    <div class="subject"><a href="#post-74561">How to achieve &quot;function level linking&quot; with MASM?</a></div>
    <div class="body"><div class="quote"><br />herman, it's a bit late and I'm not sure I understand you correctly,<br />bear over with me. But CreateProcess will allow you to force creation<br />of a new console, reuse existing console (and yes, GUI mode apps<br />*can* create consoles), or run without a console at all. So if console<br />management is why you use cmd.exe/command.com, then you might<br />not have to.</strong><br /></div><br /><br />Yes i know it's a bit late.. sorry :) <br />No, it's not cmd.exe/command.com. What i'm after is the additional options switch <strong>/C</strong>. And i cannot pass this switch into createprocess cause it is being recognize as a file. It simply gives me an error &quot;file not found&quot;. So i have to pass cmd.exe/command.com itself into the createprocess. For the whole story will  bored you to death :grin:<br /><br /><strong>NaN</strong><br /><div class="quote">I have no clue what your error is. I dont know how or why the LINKER got into this picture. There is absolutely no calls to the linker!! This error must be on you account... I cant offer help with out more idea what your trying to do.. /me: shrugs<br /></div><br /><br />I find the problem now, i have a path to &quot;e:\masm32\bin&quot; in my system :grin:<br />Now it's ok. But i only find the inc file so you're not making the lib anymore, is this true ? And why it has problem if i have that path ?<br />I'll try this more, and let you know the result<br />:alright:</div>
    <div class="meta">Posted on 2003-01-05 23:55:33 by HermanT</div>
   </div>
   <div class="post" id="post-74565">
    <div class="subject"><a href="#post-74565">How to achieve &quot;function level linking&quot; with MASM?</a></div>
    <div class="body">Herman, as i warned above, you shouldnt use \masm\include because it deletes the directory before you use it!!<br /><br />I hope your not deleting your \bin directory ??? <br /><br />perhpas i should make a warnign MSG box in the next version, if it warrents it..<br /><br /><br />Your system path should include &quot;x:\masm32\bin\&quot; which the LIBM.exe should reside.  From here in any directory calling &quot;LIBM .\dir\file.asm .\newout&quot;  will genreate an output and copy it  back to the calling directory..<br /><br />Remember you dont need to use the optional output directory!! Without it uses TEMP as a swap area, ensuring a safety ;)<br /><br />If you do use the optional output directroy, be wise, and specify a directory that is not of imporatnce, or make a new title for a directory to be created...<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2003-01-06 00:07:26 by NaN</div>
   </div>
   <div class="post" id="post-74573">
    <div class="subject"><a href="#post-74573">How to achieve &quot;function level linking&quot; with MASM?</a></div>
    <div class="body">NaN, i think you misundertood what i meant.<br /><br />My system already has a path to masm32\bin. And that's what causing the error. If i took away masm32\bin from the system path, it works.<br /><br />OK I tried again base on your suggestion.<br />From dos-prompt window.<br />The masm32\bin is in the system path. I put LIBM into that directory. Then from my test program directory i call libm with<br /><br />LIBM trans.asm<br /><br />It happen again, error! W2K also gives me the same error.<br />I noticed from the console that you build the library, but the I don't get the .LIB file in my directory, only .INC<br />:confused:</div>
    <div class="meta">Posted on 2003-01-06 00:56:35 by HermanT</div>
   </div>
   <div class="post" id="post-74594">
    <div class="subject"><a href="#post-74594">How to achieve &quot;function level linking&quot; with MASM?</a></div>
    <div class="body">NaN,<br /><br /><div class="quote"><br />This makes no sense to me. If you want to ignore stuff inside coff blocks, then simply dont add the 'stuff'...?<br /></div><br /><br />You misunderstood me. I meant your tool should write stuff inside those blocks as a whole, regardless how many procs are inside.<br /><br /><br />Thomas,<br /><br />thanks for pointing to bitRAKE's post (and my apologies to bitRAKE haven't given his reply the attention it diserved). The tool mentioned there seems to do what it is supposed to do.<br /><br />Japheth</div>
    <div class="meta">Posted on 2003-01-06 04:33:46 by japheth</div>
   </div>
   <div class="post" id="post-74685">
    <div class="subject"><a href="#post-74685">How to achieve &quot;function level linking&quot; with MASM?</a></div>
    <div class="body">It seems i was miss-understanding alot of stuff yesterday..<br /><br />HermanT, I dont know what your doing, or what this 'error' is.  You need to give me more to work with.<br /><br />Show me your 'sample.asm' file.  Show me the command line your using, and from what directory. Is the LIBM tool in the PATH= scope or not? (Im surprised you had to remover \masm32\bin, cause i recomend you add it ~ this tells me there is probably another LIBM on your system or something).<br /><br />Is the 'ERROR' a crash, or is it and output from the tool? Or is it just your interpretation of how it responded?<br /><br />With the following example:<pre><code>;#HEADER START<br />.386<br />.model flat,stdcall<br />option casemap&#58;none<br /><br />include D&#58;\MASM32\INCLUDE\kernel32.inc<br /><br />;#HEADER END<br />.code<br /><br />One proc uses ecx edi edx esi String&#58;DWORD<br />Two PROTO &#58;DWORD<br />NEST_NEXT TEXTEQU &lt;endp&gt;  ; This could be placed in the header as well<br />   nop<br />   nop<br />   invoke Two,1 <br />   ret<br /><br />One NEST_NEXT<br /><br />Two proc private String&#58;DWORD<br />   nop<br />   nop<br />   nop<br />   nop<br />   ret<br />Two endp<br /><br />end</code></pre><br />And LIBM in the \masm32\bin directory.<br />And PATH has this directory in it.<br />And the above example saved in my D:\test directory as test.asm<br />I run a commandline from a DOS window:  LIBM test.asm<br /><br />I get: TEST.LIB and TEST.INC in the current directory i called LIBM from.<br /><br />Can anyone else confirm it is faulty on NT machines?? (LIBM v2.1)<br /><br /><strong>Japheth</strong>,<br /><br />  You never mentioned if the solution above is ok for your needs? Is it?<br />  <a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?s=&amp;postid=74509.msg74509">The specific reply is found here...</a><br /><br />NaN<br /><br /><span style="font-size:9px><strong>bitRAKE</strong>: fixed link to work with all page settings.</span></div>
    <div class="meta">Posted on 2003-01-06 17:04:37 by NaN</div>
   </div>
   <div class="post" id="post-74747">
    <div class="subject"><a href="#post-74747">How to achieve &quot;function level linking&quot; with MASM?</a></div>
    <div class="body">NaN, <br />Take your time as much as you need, no need to rush right ?:) <br />My sample program is exactly the same as the last test program i had posted, but here it is<br /><pre><code><br />;#HEADER START<br />   .386<br />   .model flat, stdcall  ; 32 bit memory model<br />   option casemap &#58;none  ; case sensitive<br /><br />.Data<br />   cMsg  db 'Test',0<br />;#HEADER END<br /><br /><br />.Code<br />Clear PROC hWnd&#58;DWORD<br />   mov eax, 0<br />   ret<br />Clear ENDP<br /><br />Two PROC<br />   nop<br />   nop<br />   ret<br />Two ENDP<br /><br />End<br /></code></pre><br /><br />I try again this time with your &quot;test.asm&quot;<br />1. save test.asm in D:\Temp (The only file in this directory)<br />2. change  the code &quot;include&quot; in test.asm to point to my include directory<br />- include D:\MASM32\INCLUDE\kernel32.inc<br />   replace with<br />- include E:\MASM32\INCLUDE\kernel32.inc<br />3. make sure the &quot;E:\Masm32\Bin&quot; is in my system path<br />4. put LIBM in &quot;E:\Masm32\Bin&quot;<br />5. from DOS window:<br />- D:\Temp&gt;LIBM test.asm<br /><br />Still error (both system - ME &amp; w2k). It doesn't crash only error. Here is the screen shot.</div>
    <div class="meta">Posted on 2003-01-06 23:04:43 by HermanT</div>
   </div>
   <div class="post" id="post-74748">
    <div class="subject"><a href="#post-74748">How to achieve &quot;function level linking&quot; with MASM?</a></div>
    <div class="body">Your LIB is not the LIB i got in my MASM32 package:<br /><br />Your LIB.EXE is version : 5.12.8078<br /><br />My LIB.EXE is version 5.00.7022 :rolleyes:<br /><br />I have no clue where you got that version, or what makes it different???<br /><br />Needless to say, this is the source of your problems.  Figure out how your lib wants the param string, change my source, and compile yourself a LIBM for LIB 5.12.8078 version...  As far as i can tell, this version of LIB is calling the linker to do its dirty work.  Cause my version doesnt do any *noticable* linker calls.  This is what had me so confused when you kept reporting this error... :confused:<br /><br />Sorry i cant be of any more help than this...<br />(as well you have the 8.15 assembler which i dont, but i doubt this is any problem)<br /><br />:stupid:<br />:NaN:</div>
    <div class="meta">Posted on 2003-01-06 23:13:32 by NaN</div>
   </div>
   <div class="post" id="post-74786">
    <div class="subject"><a href="#post-74786">How to achieve &quot;function level linking&quot; with MASM?</a></div>
    <div class="body">NaN,<br /><br />to answer your question: &quot;not perfectly&quot;.<br /><br />The reasons are:<br /><br />- my first need was to compile a generated file with 6500 stub functions. For that your tool would be great. But &quot;unfortunately&quot; due to &quot;progresses in mind&quot; I no longer need to generate this file :) .<br /><br />- the more general purpose of such a function - eliminating unused functions from code - I cannot achieve with your tool :( . Thats because of my &quot;oop model&quot; (if I am allowed to call so my &quot;quick and dirty solutions&quot; without insulting yours and Thomas') doesnt implement name mangeling. So I put each class in its own source file, and naming private methods for example: &quot;OnCommand&quot;. This aproach requires using &quot;option proc:private&quot;, so that the linker doesnt complain about duplicate symbols. But as you see, this is incompatible with your tool.<br /><br />The better approach for that is the &quot;coff editing&quot; tool from bitRAKE's link. But it requires at least one (macro) line between the procs. Thats not too bad and it works, but Im still hopeing for a solution without any source code changes.<br /><br />But hey, writing such a tool is fun, so you are lucky :) .<br /><br />Japheth</div>
    <div class="meta">Posted on 2003-01-07 03:57:09 by japheth</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=9910&amp;page=1" style="">&laquo;</a><a href="../?id=9910&amp;page=2" style="">&lt;</a><input type="hidden" name="id" value="9910" /><input type="number" name="page" min="1" max="3" step="1" value="3" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>