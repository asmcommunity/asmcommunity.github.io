<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Load and call FASM as overlay... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=8345" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=47">Assemblers</a> &raquo; <a href="../?id=8345">Load and call FASM as overlay...</a></p>
   <div class="post" id="post-60939">
    <div class="subject"><a href="#post-60939">Load and call FASM as overlay...</a></div>
    <div class="body">Hi all.<br /><br />Is it possible to load and execute FASM for DOS as overlay?</div>
    <div class="meta">Posted on 2002-10-08 08:11:23 by JohnFound</div>
   </div>
   <div class="post" id="post-60961">
    <div class="subject"><a href="#post-60961">Load and call FASM as overlay...</a></div>
    <div class="body">Hi John,<br />what do you mean  an overlay?</div>
    <div class="meta">Posted on 2002-10-08 12:58:25 by slop</div>
   </div>
   <div class="post" id="post-60969">
    <div class="subject"><a href="#post-60969">Load and call FASM as overlay...</a></div>
    <div class="body">Overlay is method of loading and executing programs (in format exe or com) in dos. (see INT 21h Fn 4b03h) The difference from execute (Fn 4b00h) is that overlay is called using normal far CALL, and return from overlay is via RET instruction not via &quot;INT 21h Fn 4ch&quot; of the DOS.<br /><br />So, I suppose that if I change &quot;INT 21h AX=4c00h&quot; at the end of FASM with RET, maybe it will works. But FASM uses some strange memory modes of the processor and I don't know what will happen if it simply exits with RET.</div>
    <div class="meta">Posted on 2002-10-08 14:10:18 by JohnFound</div>
   </div>
   <div class="post" id="post-60971">
    <div class="subject"><a href="#post-60971">Load and call FASM as overlay...</a></div>
    <div class="body">The FRM should not be a problem, but you can't simply exit with RET, because stack is not always correctly cleaned before executing exit_program in 'system.inc'. So you should store the stack pointer somewhere in memory at the beginning of program (just after the start label) and restore it before doing ret in the exit_program routine.</div>
    <div class="meta">Posted on 2002-10-08 14:48:05 by Tomasz Grysztar</div>
   </div>
   <div class="post" id="post-60972">
    <div class="subject"><a href="#post-60972">Load and call FASM as overlay...</a></div>
    <div class="body">Thanks. Now all is clear.</div>
    <div class="meta">Posted on 2002-10-08 14:58:57 by JohnFound</div>
   </div>
   <div class="post" id="post-60978">
    <div class="subject"><a href="#post-60978">Load and call FASM as overlay...</a></div>
    <div class="body">I'm not sure I understood. If you mean to spawn() it, I did it and I can testimony it works great.</div>
    <div class="meta">Posted on 2002-10-08 16:56:49 by Maverick</div>
   </div>
   <div class="post" id="post-61041">
    <div class="subject"><a href="#post-61041">Load and call FASM as overlay...</a></div>
    <div class="body">Yes, but what the hell is spawn()? :confused: :stupid:</div>
    <div class="meta">Posted on 2002-10-09 06:46:02 by JohnFound</div>
   </div>
   <div class="post" id="post-61063">
    <div class="subject"><a href="#post-61063">Load and call FASM as overlay...</a></div>
    <div class="body">spawn() is a C function for calling a program.</div>
    <div class="meta">Posted on 2002-10-09 10:32:10 by dxantos</div>
   </div>
  </div>
 </body>
</html>