<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>CPU speed - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4424" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=4424">CPU speed</a></p>
   <div class="post" id="post-30743">
    <div class="subject"><a href="#post-30743">CPU speed</a></div>
    <div class="body">one of first projects ever ... (refer to readme file) ...</div>
    <div class="meta">Posted on 2002-03-25 07:47:54 by Donnerwolf</div>
   </div>
   <div class="post" id="post-30825">
    <div class="subject"><a href="#post-30825">CPU speed</a></div>
    <div class="body">Win NT 4.0 WS SP4<br /><br />GPF - Memory access violation.</div>
    <div class="meta">Posted on 2002-03-25 15:06:19 by The Svin</div>
   </div>
   <div class="post" id="post-30835">
    <div class="subject"><a href="#post-30835">CPU speed</a></div>
    <div class="body">win 2K SP2<br />AMD K6II 450<br /><br />correctly reports it as 451, no crashing.</div>
    <div class="meta">Posted on 2002-03-25 15:36:23 by Hiroshimator</div>
   </div>
   <div class="post" id="post-31036">
    <div class="subject"><a href="#post-31036">CPU speed</a></div>
    <div class="body">@Svin: runs fine for me on win98 and win2k pro :confused:  don't know why it doesn't work for you</div>
    <div class="meta">Posted on 2002-03-26 13:56:21 by Donnerwolf</div>
   </div>
   <div class="post" id="post-31038">
    <div class="subject"><a href="#post-31038">CPU speed</a></div>
    <div class="body">Svin, it would probably be helpful if you could give the EIP of the GPF :)</div>
    <div class="meta">Posted on 2002-03-26 14:02:02 by f0dder</div>
   </div>
   <div class="post" id="post-31044">
    <div class="subject"><a href="#post-31044">CPU speed</a></div>
    <div class="body"><div class="quote">why it doesn't work for you</div> <br />It doesn't work for NT WS 4.0 , not for me.</div>
    <div class="meta">Posted on 2002-03-26 14:31:24 by The Svin</div>
   </div>
   <div class="post" id="post-31049">
    <div class="subject"><a href="#post-31049">CPU speed</a></div>
    <div class="body">800mhz AMD Athlon, WinXP Pro (again :( )</div>
    <div class="meta">Posted on 2002-03-26 14:40:52 by bazik</div>
   </div>
   <div class="post" id="post-31053">
    <div class="subject"><a href="#post-31053">CPU speed</a></div>
    <div class="body"><div class="quote"><br />Svin, it would probably be helpful if you could give the EIP of the GPF :) </div><br /><br />No problem, Sir.<br /><pre><code><br />Exeption in process&#58;<br />        Process.&#58;  &#40;pid=39&#41;<br />        Time&#58; 3/27/2002 @ 2&#58;23&#58;58.400<br />        Number&#58; c0000005 &#40;access violation&#41;<br /><br /><br />*----&gt; Tasks &lt;----*<br />Pid  Name<br />   0 Idle.exe<br />   2 System.exe<br />  20 smss.exe<br />  30 CSRSS.exe<br />  34 WINLOGON.exe<br />  40 SERVICES.exe<br />  43 LSASS.exe<br />  72 SPOOLSS.exe<br />  79 RPCSS.exe<br />  82 NDDEAGNT.exe<br />  93 tcpsvcs.exe<br />  97 TAPISRV.exe<br /> 105 RASMAN.exe<br /> 111 PSTORES.exe<br /> 114 EXPLORER.exe<br /> 121 esserver.exe<br /> 127 sens.exe<br /> 149 systray.exe<br /> 153 LOADWC.exe<br /> 155 internat.exe<br />  89 MSOFFICE.exe<br /> 151 EXPLORER.exe<br /> 170 Far.exe<br />  39 cpuspeed.exe<br />  57 DRWTSN32.exe<br />   0 _Total.exe<br /><br />&#40;00400000 - 00400000&#41; <br />&#40;77f60000 - 77fbd000&#41; dll\ntdll.dbg<br />&#40;77f00000 - 77f5f000&#41; dll\kernel32.dbg<br />&#40;77e70000 - 77ec4000&#41; dll\user32.dbg<br />&#40;77ed0000 - 77efc000&#41; dll\gdi32.dbg<br />&#40;77dc0000 - 77dff000&#41; dll\advapi32.dbg<br />&#40;77e10000 - 77e67000&#41; dll\rpcrt4.dbg<br />&#40;766d0000 - 766d6000&#41; dll\indicdll.dbg<br /><br />Memory dump for thread 0xae<br /><br />eax=002c01ed ebx=002c01ed ecx=00000113 edx=00002c01 esi=00007fe8 edi=00000113<br />eip=0012ffac esp=0012ff44 ebp=00000000 iopl=0         nv up ei pl nz na pe nc<br />cs=001b  ss=0023  ds=0023  es=0023  fs=0038  gs=0000             efl=00000202<br /><br /><br />function&#58; &lt;nosymbols&gt;<br />        0012ff97 0008             add     &#91;eax&#93;,cl                     ds&#58;002c01ed=d1<br />        0012ff99 0001             add     &#91;ecx&#93;,al                     ds&#58;00000113=??<br />        0012ff9b 0010             add     &#91;eax&#93;,dl                     ds&#58;002c01ed=d1<br />        0012ff9d 0000             add     &#91;eax&#93;,al                     ds&#58;002c01ed=d1<br />        0012ff9f 0000             add     &#91;eax&#93;,al                     ds&#58;002c01ed=d1<br />        0012ffa1 0000             add     &#91;eax&#93;,al                     ds&#58;002c01ed=d1<br />        0012ffa3 0000             add     &#91;eax&#93;,al                     ds&#58;002c01ed=d1<br />        0012ffa5 304000           xor     &#91;eax&#93;,al                     ds&#58;0131ebf3=??<br />        0012ffa8 0100             add     &#91;eax&#93;,eax              ds&#58;002c01ed=410202d1<br />        0012ffaa 0100             add     &#91;eax&#93;,eax              ds&#58;002c01ed=410202d1<br />error-&gt; 0012ffac 0000             add     &#91;eax&#93;,al                     ds&#58;002c01ed=d1<br />        0012ffae ed               in      eax,dx<br />        0012ffaf 771d             ja      0012ffce<br />        0012ffb1 104000           adc     &#91;eax&#93;,al                     ds&#58;0131ebf3=??<br />        0012ffb4 0000             add     &#91;eax&#93;,al                     ds&#58;002c01ed=d1<br />        0012ffb6 40               inc     eax<br />        0012ffb7 0000             add     &#91;eax&#93;,al                     ds&#58;002c01ed=d1<br />        0012ffb9 0000             add     &#91;eax&#93;,al                     ds&#58;002c01ed=d1<br />        0012ffbb 0000             add     &#91;eax&#93;,al                     ds&#58;002c01ed=d1<br />        0012ffbd 0000             add     &#91;eax&#93;,al                     ds&#58;002c01ed=d1<br />        0012ffbf 0001             add     &#91;ecx&#93;,al                     ds&#58;00000113=??<br />        0012ffc1 0000             add     &#91;eax&#93;,al                     ds&#58;002c01ed=d1<br /><br />*----&gt; Stack back trace &lt;----*<br /><br />FramePtr ReturnAd Param#1  Param#2  Param#3  Param#4  Function Name<br />00000000 00000000 00000000 00000000 00000000 00000000 &lt;nosymbols&gt; <br /><br />*----&gt; Stack copy &lt;----*<br />0012ff44  28 51 40 00 3a 20 e7 77 - 60 ff 12 00 01 00 00 00  &#40;Q@.&#58; .w`.......<br />0012ff54  f9 12 40 00 60 ff 12 00 - 94 01 46 00 00 00 00 00  ..@.`.....F.....<br />0012ff64  13 01 00 00 e8 7f 00 00 - 41 11 40 00 ed 01 2c 00  ........A.@...,.<br />0012ff74  d5 00 00 00 dc 00 00 00 - 30 00 00 00 03 00 00 00  ........0.......<br />0012ff84  02 13 40 00 00 00 00 00 - 00 00 00 00 00 00 40 00  ..@...........@.<br />0012ff94  01 00 01 00 08 00 01 00 - 10 00 00 00 00 00 00 00  ................<br />0012ffa4  00 30 40 00 01 00 01 00 - 00 00 ed 77 1d 10 40 00  .0@........w..@.<br />0012ffb4  00 00 40 00 00 00 00 00 - 00 00 00 00 01 00 00 00  ..@.............<br />0012ffc4  3c ba f1 77 bc e4 29 01 - 73 40 c4 77 00 f0 fd 7f  &lt;..w..&#41;.s@.w....<br />0012ffd4  05 00 00 c0 c8 ff 12 00 - 8c fd 12 00 ff ff ff ff  ................<br />0012ffe4  74 b8 f3 77 48 d2 f3 77 - 00 00 00 00 00 00 00 00  t..wH..w........<br />0012fff4  00 00 00 00 00 50 40 00 - 00 00 00 00 00 00 00 00  .....P@.........<br />00130004  b0 5a fa 77 e8 55 fa 77 - 98 5a fa 77 00 00 00 00  .Z.w.U.w.Z.w....<br />00130014  00 00 00 00 00 00 00 00 - 00 00 00 00 40 00 13 00  ............@...<br />00130024  00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00  ................<br />00130034  00 00 00 00 00 00 00 00 - 00 00 00 00 60 00 13 00  ............`...<br />00130044  00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00  ................<br />00130054  00 00 00 00 00 00 00 00 - 00 00 00 00 80 00 13 00  ................<br />00130064  00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00  ................<br />00130074  00 00 00 00 00 00 00 00 - 00 00 00 00 a0 00 13 00  ................<br /></code></pre></div>
    <div class="meta">Posted on 2002-03-26 15:38:41 by The Svin</div>
   </div>
   <div class="post" id="post-31069">
    <div class="subject"><a href="#post-31069">CPU speed</a></div>
    <div class="body">Hm, might be a register preservation problem? Anyway, try this<br />version, I removed all the fancy window stuff and moved code<br />around a bit...</div>
    <div class="meta">Posted on 2002-03-26 16:58:59 by f0dder</div>
   </div>
   <div class="post" id="post-31072">
    <div class="subject"><a href="#post-31072">CPU speed</a></div>
    <div class="body"><div class="quote">Hm, might be a register preservation problem? </div> <br /><br />Of course, it is. And it's only matter for Win callback procs.<br />He uses ebx in timing routing but doesn't preserve it in WndProc<br />(wich is callback)<br />But after 100 times talking about I gave myself a word don't explain it anymore (tyred), just report bugs.</div>
    <div class="meta">Posted on 2002-03-26 17:12:18 by The Svin</div>
   </div>
   <div class="post" id="post-31073">
    <div class="subject"><a href="#post-31073">CPU speed</a></div>
    <div class="body">Interesting it doesn't cause a problem on win2k though, it usually<br />bitches when registers aren't preserved :).<br /><br />I guess I need to do this:<br /><span style="font-size:18px>REMEMBER TO DO REGISTER PRESERVATION</span><br /><br />:)</div>
    <div class="meta">Posted on 2002-03-26 17:26:17 by f0dder</div>
   </div>
   <div class="post" id="post-31078">
    <div class="subject"><a href="#post-31078">CPU speed</a></div>
    <div class="body"><div class="quote"><br />Interesting it doesn't cause a problem on win2k though<br /></div><br />It has simple explonation.<br />ebx esi edi register preservation is matter only for Win callback procs,<br />for the rest case it's optional (upto programmer).<br />And again it's almost only about NT and partionally about W2K.<br />The key is just understand Why it is issue. I explained it more then<br />100 times already.<br />1. First people need to understand that when window created it is handled <br />by system not by program that create it, system just allows to &quot;take a part&quot;<br />in handling process by specifying WndProc offset.<br />System do all job and from time to time calls WndProc after WndProc rets it <br />rets to system code. For system WndProc is kinda as API for our proc, it's called and<br />returns always to system.<br />2. Dave Cutler team wich write kernel (almost unchanged upto present time)<br />for NT and Win32 API for NT (many of wich still remains unchanged) tried to make<br />the core more optimal wrote code wich rely on ebx esi edi unchanged.<br />They always preserved\restore esi ebx edi in their kernel and API callback return and<br />assumed that all code written for Win32 would do the same thing.<br /><br />Now let say code wich call WndProc has some value in ebx and<br />use it for addressing jump and assumes that it will remain the value after WndProc returns control to calling code, now WndProc changed it and after return calling code jusmping to wrong place<br />(for example to some data section instead of some label in code)<br />or using ebx (wich it assumes is the same but actually was changed) it tries to read some data from wrong place (for example not data at all but bytes from code section) it is where GPF comes<br />in 99% asm progs represented in this board.<br />In new SP for NT and in W2K some API were updated and changed, so<br />the author of cpuspeed and people used it in W2K were just lucky that<br />the prog didn't get to API code wich rely on ebx, they just being lucky<br />for a moment. Add some more API calls in the prog and chance that it<br />could crash on W2K will grow.</div>
    <div class="meta">Posted on 2002-03-26 18:01:53 by The Svin</div>
   </div>
   <div class="post" id="post-31094">
    <div class="subject"><a href="#post-31094">CPU speed</a></div>
    <div class="body">nice work.. very accurate. tested on win2k sp2.</div>
    <div class="meta">Posted on 2002-03-26 20:43:23 by smurf</div>
   </div>
   <div class="post" id="post-31096">
    <div class="subject"><a href="#post-31096">CPU speed</a></div>
    <div class="body">Tested OK on WindowsXP, Windows2k Datacenter Server<br />and WindowsME!</div>
    <div class="meta">Posted on 2002-03-26 21:01:03 by buliaNaza</div>
   </div>
   <div class="post" id="post-31217">
    <div class="subject"><a href="#post-31217">CPU speed</a></div>
    <div class="body">Dead on here with Win98SE, Win2K, and XP.<br /><br />Outstanding Donnerwolf.</div>
    <div class="meta">Posted on 2002-03-27 15:48:33 by alpha</div>
   </div>
   <div class="post" id="post-31328">
    <div class="subject"><a href="#post-31328">CPU speed</a></div>
    <div class="body"><div class="quote"><br /><br />ebx esi edi register preservation is matter only for Win callback procs,<br />for the rest case it's optional (upto programmer).<br /></div><br /><br />True if you are calling a routine from assembly.<br /><br />But if the routine is to be called from C++ or another language, then register preservation is a must.</div>
    <div class="meta">Posted on 2002-03-28 10:05:54 by dxantos</div>
   </div>
  </div>
 </body>
</html>