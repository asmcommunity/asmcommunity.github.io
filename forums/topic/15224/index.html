<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>is there a fast bilinear algorithm for image scale? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=15224" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=15224">is there a fast bilinear algorithm for image scale?</a></p>
   <div class="post" id="post-118283">
    <div class="subject"><a href="#post-118283">is there a fast bilinear algorithm for image scale?</a></div>
    <div class="body">I want a fast image scale(zoom) function in my real-time image processing project.<br /><br />I know there is a algorithm called Bilinear Interpolation Algorithm, can anyone provide a implementation that runs fast<br /><br />thanks!</div>
    <div class="meta">Posted on 2003-09-15 21:33:29 by lovelypp</div>
   </div>
   <div class="post" id="post-120613">
    <div class="subject"><a href="#post-120613">is there a fast bilinear algorithm for image scale?</a></div>
    <div class="body">Here's one that a friend of mine did.. It uses C++ and inline asm with mmx and I have no idea how fast it actually is, but he usually produces quite fast code. You could probably optimize it a lot if you put in some prefetching stuff...<br /><pre><code>void MTImage&#58;&#58;ResizeTo&#40; MTImage *pDestImg &#41;<br />&#123;<br />  int dx = &#40;m_nWidth &lt;&lt; 16&#41; / pDestImg-&gt;m_nWidth;<br />  int dy = &#40;m_nHeight &lt;&lt; 16&#41; / pDestImg-&gt;m_nHeight;<br />  int pixels = &#40;m_nWidth*m_nHeight&#41; - 1;<br /><br />  int startx = 0;<br />  int starty = 0;<br /><br />  int ccy = starty;<br />  DWORD *target = pDestImg-&gt;GetPtr&#40;&#41;;<br />  DWORD *text = m_pData;<br /><br />  for&#40; int yy=0; yy&lt;pDestImg-&gt;m_nHeight; yy++ &#41;<br />  &#123;<br />    int ty = &#40;ccy &gt;&gt; 16&#41; * m_nWidth;<br />    int ccx = startx;<br />    DWORD *tar = target;<br /><br />    __int64 ddv = &#40;&#40;ccy&#41; &gt;&gt; 8&#41; &amp; 255;<br />    ddv += &#40;ddv &lt;&lt; 32&#41; + &#40;ddv &lt;&lt; 16&#41;;<br /><br />    for&#40; int xx=0; xx&lt;pDestImg-&gt;m_nWidth; xx++ &#41;<br />    &#123;<br />      int ad1 = ty + &#40;ccx &gt;&gt; 16&#41;;<br />      int ad2 = ad1 + 1;<br />      int ad3 = ad1 + m_nWidth;<br />      int ad4 = ad2 + m_nWidth;<br /><br />      __asm<br />      &#123;<br />        // for packing/unpacking<br />        pxor    mm7, mm7<br />        mov     eax, &#91;ccx&#93;<br />        shr     eax, 8<br />        and     eax, 255<br />        movd    mm4, eax<br />        movq    mm5, mm4<br />        psllq   mm5, 16<br />        paddd   mm4, mm5<br />        psllq   mm5, 16<br />        // convert ddu to 64 bit<br />        paddd   mm4, mm5<br /><br />        mov     edx, &#91;pixels&#93;<br />        mov     eax, &#91;ad1&#93;<br />        cmp     eax, edx<br />        jl      noclipad1<br />        mov     eax, edx<br /><br />      noclipad1&#58;<br />        mov     ebx, &#91;ad2&#93;<br />        cmp     ebx, edx<br />        jl      noclipad2<br />        mov     ebx, edx<br /><br />      noclipad2&#58;<br />        mov     ecx, &#91;ad3&#93;<br />        cmp     ecx, edx<br />        jl      noclipad3<br />        mov     ecx, edx<br /><br />      noclipad3&#58;<br />        mov     edx, &#91;ad4&#93;<br />        cmp     edx, &#91;pixels&#93;<br />        jl      noclipad4<br />        mov     edx, &#91;pixels&#93;<br /><br />      noclipad4&#58;<br />        mov     esi, &#91;text&#93;<br /><br />  ///////////////////////////////////////////////////////<br /><br />        // mm5 = color1 + &#40;ddu * &#40;color2 - color1&#41;&#41;;<br />        movd    mm5, &#91;esi + eax * 4&#93; // color1<br />        movd    mm1, &#91;esi + ebx * 4&#93; // color2<br /><br />        punpcklbw mm5, mm7           // convert to 64 bit<br />        punpcklbw mm1, mm7           // convert to 64 bit<br /><br />        movq    mm3, mm5             // save color1 for later<br /><br />        pmullw  mm1, mm4             // mul color2 with ddu&#40;mm4&#41;<br />        psrlw   mm1, 8               // div by 256<br />        paddb   mm5, mm1             // add to color1<br /><br />        pmullw  mm3, mm4             // mul color1 with ddu&#40;mm4&#41;<br />        psrlw   mm3, 8               // div by 256<br />        psubb   mm5, mm3             // sub from color1...<br /><br />  ///////////////////////////////////////////////////////<br /><br />        // mm6 = color3 + &#40;ddu * &#40;color4 - color3&#41;&#41;;<br />        movd    mm6, &#91;esi + ecx * 4&#93; // color3<br />        movd    mm1, &#91;esi + edx * 4&#93; // color4<br /><br />        punpcklbw mm6, mm7           // convert to 64 bit<br />        punpcklbw mm1, mm7           // convert to 64 bit<br /><br />        movq    mm3, mm6             // save color3 for later<br /><br />        pmullw  mm1, mm4             // mul color4 with ddu<br />        psrlw   mm1, 8               // div by 256<br />        paddb   mm6, mm1             // add to color3<br /><br />        pmullw  mm3, mm4             // mul color3 with ddu&#40;mm4&#41;<br />        psrlw   mm3, 8               // div by 256<br />        psubb   mm6, mm3             // sub from color3...<br /><br />  //////////////////////////////////////////////////////<br /><br />        movq    mm4, &#91;ddv&#93;<br /><br />        movq    mm3, mm5<br /><br />        pmullw  mm6, mm4<br />        psrlw   mm6, 8<br />        paddb   mm5, mm6<br /><br />        pmullw  mm3, mm4<br />        psrlw   mm3, 8<br />        psubb   mm5, mm3<br /><br />        packuswb mm5, mm7<br /><br />        mov     esi, &#91;tar&#93;<br />        movd    &#91;esi&#93;, mm5           // done!<br /><br />        add     tar, 4<br />      &#125;<br />      ccx += dx;<br />    &#125;<br />    ccy += dy;<br />    target += pDestImg-&gt;m_nWidth;<br />  &#125;<br />  __asm emms;<br />&#125;</code></pre><br /><strong>edit:</strong> I just saw that some comments don't make sense. I directly translated his comments into english so don't blame the messenger ;)</div>
    <div class="meta">Posted on 2003-10-06 07:52:44 by snq</div>
   </div>
   <div class="post" id="post-121164">
    <div class="subject"><a href="#post-121164">thx! but...</a></div>
    <div class="body">it is used for a 32bit data buf, but in my project, i usually us 8bit grayscale image or 24bit rgb colorful image.<br /><br />how to change it so it can be apply to a 24bit or 8bit image?<br /><br />I'am a newie, help please.</div>
    <div class="meta">Posted on 2003-10-12 23:28:54 by lovelypp</div>
   </div>
  </div>
 </body>
</html>