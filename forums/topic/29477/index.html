<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Copying locked files - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29477" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29477">Copying locked files</a></p>
   <div class="post" id="post-208142">
    <div class="subject"><a href="#post-208142">Copying locked files</a></div>
    <div class="body">Hi<br /><br />Is there a way that I can copy locked file. For example ntuser.dat file that is locked by the OS, can that be copied to another location?<br /><br />Thanks,<br /><br />C K</div>
    <div class="meta">Posted on 2009-07-13 02:02:43 by karthikeyanck</div>
   </div>
   <div class="post" id="post-208144">
    <div class="subject"><a href="#post-208144">Re: Copying locked files</a></div>
    <div class="body">Yes you can do that. You have to use ShadowCopy though.<br /><br />http://en.wikipedia.org/wiki/Shadow_Copy<br /><br />There</div>
    <div class="meta">Posted on 2009-07-13 07:00:08 by XCHG</div>
   </div>
   <div class="post" id="post-208145">
    <div class="subject"><a href="#post-208145">Re: Copying locked files</a></div>
    <div class="body"><div class="quote"><br />Yes you can do that. You have to use ShadowCopy though.<br /><br />http://en.wikipedia.org/wiki/Shadow_Copy<br /><br />There<br /></div><br /><br />Are there any easy methods to achieve this through assembly? One of the methods that can be used is the MovefileEx with the MOVEFILE_DELAY_UNTIL_REBOOT flag set. But that requires a reboot<br /><br />Edit: Added movefileex method.</div>
    <div class="meta">Posted on 2009-07-13 08:05:35 by karthikeyanck</div>
   </div>
   <div class="post" id="post-208148">
    <div class="subject"><a href="#post-208148">Re: Copying locked files</a></div>
    <div class="body">There is a free command line Shadow Copy application. If I were you, I would inject that into the bundle of my application and at run-time, export it to disk, run it with CreateProcess as a command line utility and don&#039;t let the user know what&#039;s happening on the background.</div>
    <div class="meta">Posted on 2009-07-13 08:41:06 by XCHG</div>
   </div>
   <div class="post" id="post-208149">
    <div class="subject"><a href="#post-208149">Re: Copying locked files</a></div>
    <div class="body"><div class="quote"><br />There is a free command line Shadow Copy application. If I were you, I would inject that into the bundle of my application and at run-time, export it to disk, run it with CreateProcess as a command line utility and don&#039;t let the user know what&#039;s happening on the background.<br /></div><br /><br />Sounds doable. Thanks XCHG</div>
    <div class="meta">Posted on 2009-07-13 08:49:04 by karthikeyanck</div>
   </div>
   <div class="post" id="post-208160">
    <div class="subject"><a href="#post-208160">Re: Copying locked files</a></div>
    <div class="body">Am still stuck with this, NTBACKUP (on Windows XP) doesn&#039;t seem to backup a single file through commandline. Am not sure if am missing out on something. All am doing is giving the EXE path <u>&quot;C:\Windows\System32\ntbackup.exe&quot;</u> and parameter <u>&quot;backup C:\Documents and Settings\Administrator\NTUSER.DAT /j &quot;Command Line Backup 1&quot; /f &quot;C:\att.bfk&quot;&quot; </u>. <br /><br />But the same parameters work when I input a folder.</div>
    <div class="meta">Posted on 2009-07-14 05:53:31 by karthikeyanck</div>
   </div>
   <div class="post" id="post-208162">
    <div class="subject"><a href="#post-208162">Re: Copying locked files</a></div>
    <div class="body">The problem is the spaces in the filepath.<br />And the solution is self-evident.<br /></div>
    <div class="meta">Posted on 2009-07-14 08:20:34 by Homer</div>
   </div>
   <div class="post" id="post-208165">
    <div class="subject"><a href="#post-208165">Re: Copying locked files</a></div>
    <div class="body">Thanks Homer, but I don&#039;t see that to be a problem. Windows will be able to handle that right?</div>
    <div class="meta">Posted on 2009-07-14 09:54:52 by karthikeyanck</div>
   </div>
   <div class="post" id="post-208166">
    <div class="subject"><a href="#post-208166">Re: Copying locked files</a></div>
    <div class="body"><div class="quote"><br />Thanks Homer, but I don&#039;t see that to be a problem. Windows will be able to handle that right?<br /></div>Yes, if you quote the file paths - funnily you&#039;re quoting the short filepath but not the one with spaces? :)</div>
    <div class="meta">Posted on 2009-07-14 10:16:05 by f0dder</div>
   </div>
   <div class="post" id="post-208167">
    <div class="subject"><a href="#post-208167">Re: Copying locked files</a></div>
    <div class="body">Yeah. Try to always enclose your paths in quotation marks and try to avoid using backslash instead of forward slash.<br /><br />In other words, use this:<br /><br />&quot;C:/Program Files/Adobe/&quot;<br /><br />Instead of:<br /><br />C:\Program Files\Adobe\</div>
    <div class="meta">Posted on 2009-07-14 10:52:00 by XCHG</div>
   </div>
   <div class="post" id="post-208168">
    <div class="subject"><a href="#post-208168">Re: Copying locked files</a></div>
    <div class="body">Eh, why use forward slash instead of backward slash?<br /><br />The only time it matters is when dealing with C-style escaped strings... where you just use a double-backslash. While the Windows APIs handle forward-slash properly, not all third-party software might, so it&#039;s best to use backslashes.</div>
    <div class="meta">Posted on 2009-07-14 11:15:41 by f0dder</div>
   </div>
   <div class="post" id="post-208170">
    <div class="subject"><a href="#post-208170">Re: Copying locked files</a></div>
    <div class="body"><div class="quote"><br />Eh, why use forward slash instead of backward slash?<br /><br />The only time it matters is when dealing with C-style escaped strings... where you just use a double-backslash. While the Windows APIs handle forward-slash properly, not all third-party software might, so it&#039;s best to use backslashes.<br /></div><br /><br />Yeah, *NIX style expects <em>C:/Program\ Files/Adobe/</em>, where-as Windows would expect <em>&quot;C:\Program Files\Adobe\&quot;</em>.<br /><br />Forward slashes are still acceptable as path separators in Windows, but backslashes are expected in UNC forms on Windows, e.g. <em>&quot;\\myserver\files\&quot;</em>.<br /><br />Since UNC is not as flexible, it&#039;s advisable to stay consistent and just use backslashes.</div>
    <div class="meta">Posted on 2009-07-14 12:57:24 by SpooK</div>
   </div>
   <div class="post" id="post-208177">
    <div class="subject"><a href="#post-208177">Re: Copying locked files</a></div>
    <div class="body"><div class="quote"><br /><div class="quote"><br />Thanks Homer, but I don&#039;t see that to be a problem. Windows will be able to handle that right?<br /></div>Yes, if you quote the file paths - funnily you&#039;re quoting the short filepath but not the one with spaces? :)<br /></div><br /><br />Ah, I&#039;ve just forgot to include the closing quotes there!<br /><br />This is what I understand;<br /><br />Windows can recognize both backslash and forward slash when you use them in the path as C:\Windows and C:/Windows. Both are accepted format. <br /><br />Then how about the switches/parameters? They are best identified when a forward slash is used against them. Ex when you use &quot;dir /s&quot; they work, try &quot;dir \s&quot;... <br /><br />Thanks,<br /><br />C K.</div>
    <div class="meta">Posted on 2009-07-15 05:38:22 by karthikeyanck</div>
   </div>
   <div class="post" id="post-208179">
    <div class="subject"><a href="#post-208179">Re: Copying locked files</a></div>
    <div class="body"><div class="quote"><br />Windows can recognize both backslash and forward slash when you use them in the path as C:\Windows and C:/Windows. Both are accepted format. <br /><br />Then how about the switches/parameters? They are best identified when a forward slash is used against them. Ex when you use &quot;dir /s&quot; they work, try &quot;dir \s&quot;... <br /></div>That&#039;s yet a reason not to use forward slashes for file paths - again, the APIs support them, but all kinds of 3rd party applications might break in all kinds of different ways.</div>
    <div class="meta">Posted on 2009-07-15 09:02:57 by f0dder</div>
   </div>
   <div class="post" id="post-208183">
    <div class="subject"><a href="#post-208183">Re: Copying locked files</a></div>
    <div class="body"><div class="quote"><br /></div>That&#039;s yet a reason not to use forward slashes for file paths - again, the APIs support them, but all kinds of 3rd party applications might break in all kinds of different ways.<br /></div><br /><br />When in <span class="strike">Rome</span> Redmond...</div>
    <div class="meta">Posted on 2009-07-15 18:49:04 by SpooK</div>
   </div>
   <div class="post" id="post-208187">
    <div class="subject"><a href="#post-208187">Re: Copying locked files</a></div>
    <div class="body"><div class="quote"><br /><div class="quote"><br /></div>That&#039;s yet a reason not to use forward slashes for file paths - again, the APIs support them, but all kinds of 3rd party applications might break in all kinds of different ways.<br /></div><br /><br />When in <span class="strike">Rome</span> Redmond...<br /></div><br /><br />hmmm, has anyone tried to take a backup of a single locked file using ntbackup (commandline)? The same syntax works when I take a backup of a folder, fails when I backup a file&nbsp; :sad:<br /><br />ntbackup backup C:\ /j &quot;Commad Line Backup 1&quot; /f C:\backup.bkf&nbsp; --------&gt; this works<br /><br />ntbackup backup C:\test.txt /j &quot;Command Line Backup 1&quot; /f C:\backup.bkf ------&gt; creates a empty 10K backup.bkf file</div>
    <div class="meta">Posted on 2009-07-16 08:08:15 by karthikeyanck</div>
   </div>
   <div class="post" id="post-208214">
    <div class="subject"><a href="#post-208214">Re: Copying locked files</a></div>
    <div class="body">Oh you are still on this?<br /><br />Download Hobocopy, search for it in Google.<br /><br />Then go here:<br /><br />http://www.howtogeek.com/howto/windows-vista/backupcopy-files-that-are-in-use-or-locked-in-windows/<br /><br />Follow the instructions. It tells you how to backup a single locked file.<br /><br />Let me know if it works or not. Enable those 2 services which are described at the beginning of the article because I don&#039;t know if Hobocopy already enables them for you upon execution or not.</div>
    <div class="meta">Posted on 2009-07-19 07:24:08 by XCHG</div>
   </div>
   <div class="post" id="post-208230">
    <div class="subject"><a href="#post-208230">Re: Copying locked files</a></div>
    <div class="body">Are there no other workarounds to achieve this with the default M$ programs? I understand that hobocopy can be used to achieve this, but why not something that comes with default installation of M$ Windows?</div>
    <div class="meta">Posted on 2009-07-21 08:11:49 by karthikeyanck</div>
   </div>
   <div class="post" id="post-208231">
    <div class="subject"><a href="#post-208231">Re: Copying locked files</a></div>
    <div class="body">You could try to duplicate file handle from the target to your process, then just seek to the beginning and copy block by block. I have added this successfully as a plugin for ProcessExplorer, so I&#039;m able to copy for example locked .flv (renamed to .tmp) files from youtube (hosted in IE).</div>
    <div class="meta">Posted on 2009-07-21 08:53:51 by sapero</div>
   </div>
   <div class="post" id="post-208241">
    <div class="subject"><a href="#post-208241">Re: Copying locked files</a></div>
    <div class="body">Ok if I understand this right, you mean to say to have a Duplicate handle created for this file....<br /><br />The file which am trying to copy is the &#039;ntuser.dat&#039; file that is locked by the &#039;system&#039; process. Am unsure how do I get access to the handle of the &#039;ntuser.dat&#039; file that&#039;s somewhere lying in the memory of the process - &#039;system&#039;.....<br /><br />Is my understanding right? or am way too far from the mission to be accomplished?<br /><br />Thanks again for the inputs</div>
    <div class="meta">Posted on 2009-07-22 04:20:02 by karthikeyanck</div>
   </div>
  </div>
 </body>
</html>