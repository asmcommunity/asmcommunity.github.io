<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Copying locked files - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29477" />
  <link rel="prev" href="../?id=29477&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29477">Copying locked files</a></p>
   <div class="post" id="post-208243">
    <div class="subject"><a href="#post-208243">Re: Copying locked files</a></div>
    <div class="body">Copying hives in use is a bad idea, it may copy without pending &#039;flush&#039; operations, that is, if you call RegSetValue, the change is stored in memory and later flushed to file. The queued flush is dismissed if the process was terminated by another process, at least on XP.<br />Better would be to call RegSaveKey with previously enabled SeBackupName privilege.<br /><br />You can open the system process by passing pid=4 and access=MAXIMUM_ALLOWED (universal value). I was able to duplicate hive handle and seek to the beginning, but ReadFile returned ERROR_INVALID_PARAMETER. The duplicated handle had access FILE_READ_DATA|FILE_WRITE_DATA, and ReadFile requires GENERIC_READ</div>
    <div class="meta">Posted on 2009-07-22 09:31:21 by sapero</div>
   </div>
  </div>
 </body>
</html>