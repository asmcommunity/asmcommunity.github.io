<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Linked List C++ or C/ASM - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=9402" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=9402">Linked List C++ or C/ASM</a></p>
   <div class="post" id="post-69589">
    <div class="subject"><a href="#post-69589">Linked List C++ or C/ASM</a></div>
    <div class="body">I have a problem, I have to use C++ and ASM to make a program, here is the description:<br />I have to make a program in C++ that creates a Linked List of doubles and then in ASM using the list just add every number on it and return the result. That's all.<br /><br />I have the C++ part, I just don't know how to advance through the linked list, that's my problem, I know how to use the FPU that's np . It could be C also so no prblem with that. I use NASM syntax, cause I use NASM.<br /><br />The ASM prototype should be: addDoubles(List l, int listSize);<br /><br />and here is the C++ part, just the important:<br /><br /><pre><code>class node &#123;<br />    void* info; //info could be int, double, char, etc.<br />    node* next;<br /><br />public&#58;<br />    node &#40;void* v&#41; &#123;<br />        info =v;<br />        next=0;<br />    &#125;<br />    void poner_next &#40;node*n&#41;&#123;<br />        next = n;<br />    &#125;<br />    node* read_next&#40;&#41;&#123;<br />        return next;<br />    &#125;<br />    void* read_info&#40;&#41;&#123;<br />        return info;<br />    &#125;<br />&#125;;<br /><br />class list&#123;<br />    node* header;<br />    int node_num;<br />    <br />public&#58;<br />    list&#40;&#41;&#123;<br />        node_num = 0;<br />        header = 0;<br />    &#125;<br />    void remove&#40;int&#41;;<br />    void insert &#40;void*, int&#41;;<br />    void put &#40;void* v&#41;&#123;<br />        insertar &#40;v, node_num+1&#41;;<br />    &#125;<br />    void* find&#40;int&#41;;<br />    void print&#40;&#41;;<br />&#125;;</code></pre><br /><br />Thanks</div>
    <div class="meta">Posted on 2002-12-06 17:30:00 by KarmaPolice</div>
   </div>
   <div class="post" id="post-69598">
    <div class="subject"><a href="#post-69598">Linked List C++ or C/ASM</a></div>
    <div class="body">sample code:<pre><code>&#91;size=9&#93;#include &lt;iostream&gt;<br /><br />using std&#58;&#58;cout;<br />using std&#58;&#58;endl;<br /><br />class list<br />&#123;<br />    private&#58;<br />    protected&#58;<br />    public&#58;<br />        double num;<br />        list* next;<br />&#125;;<br /><br />class doublell<br />&#123;<br />    private&#58;<br />        list *rootnode;<br />        list *prevnode;<br />        void init&#40;void&#41;<br />        &#123;<br />            rootnode = NULL;<br />            prevnode = NULL;<br />        &#125;<br />        void addnode&#40;double value&#41;<br />        &#123;<br />            if&#40;!rootnode&#41;<br />            &#123;<br />                rootnode = new list;<br />                rootnode-&gt;next = NULL;<br />                rootnode-&gt;num = value;<br />                prevnode = rootnode;<br />            &#125;<br />            else<br />            &#123;<br />                prevnode-&gt;next = new list;<br />                prevnode-&gt;next-&gt;next = NULL;<br />                prevnode-&gt;next-&gt;num = value;<br />                prevnode = prevnode-&gt;next;<br />            &#125;<br />        &#125;<br />        void printnodes&#40;list *node&#41;<br />        &#123;<br />            while&#40;node&#41;<br />            &#123;<br />                cout&lt;&lt;node-&gt;num&lt;&lt;endl;<br />                node = node-&gt;next;<br />            &#125;<br />        &#125;<br />        void destroylist&#40;list *node&#41;<br />        &#123;<br />            list *deallocatethisnode;<br />            while&#40;node&#41;<br />            &#123;<br />                deallocatethisnode = node;<br />                node = node-&gt;next;<br />                delete deallocatethisnode;<br />            &#125;<br />        &#125;<br />        &#91;color=blue&#93;void asmtraverse&#40;list *node&#41;<br />        &#123;<br />            double value;<br /><br />            cout&lt;&lt;endl&lt;&lt;endl;<br /><br />            //Get the value of the first node<br /><br />            __asm<br />            &#123;<br />                mov     edx, node<br />                mov     eax, DWORD PTR &#91;edx&#93;<br />                mov     DWORD PTR &#91;value&#93;, eax<br />                mov     eax, DWORD PTR &#91;edx+4&#93;<br />                mov     DWORD PTR &#91;value+4&#93;, eax<br />            &#125;<br /><br />            cout&lt;&lt;&quot;First Node Has A Value Of &quot;&lt;&lt;value&lt;&lt;endl;<br /><br />            //Traverse to the next node<br /><br />            __asm<br />            &#123;<br />                mov     edx, node<br />                mov     eax, DWORD PTR &#91;edx+8&#93;<br />                mov     node, eax<br />            &#125;<br /><br />            //Get the value of the second node<br /><br />            __asm<br />            &#123;<br />                mov     edx, node<br />                mov     eax, DWORD PTR &#91;edx&#93;<br />                mov     DWORD PTR &#91;value&#93;, eax<br />                mov     eax, DWORD PTR &#91;edx+4&#93;<br />                mov     DWORD PTR &#91;value+4&#93;, eax<br />            &#125;<br /><br />            cout&lt;&lt;&quot;Second Node Has A Value Of &quot;&lt;&lt;value&lt;&lt;endl;<br /><br />            //Traverse to the next node<br /><br />            __asm<br />            &#123;<br />                mov     edx, node<br />                mov     eax, DWORD PTR &#91;edx+8&#93;<br />                mov     node, eax<br />            &#125;<br /><br />            //Get the value of the third node<br /><br />            __asm<br />            &#123;<br />                mov     edx, node<br />                mov     eax, DWORD PTR &#91;edx&#93;<br />                mov     DWORD PTR &#91;value&#93;, eax<br />                mov     eax, DWORD PTR &#91;edx+4&#93;<br />                mov     DWORD PTR &#91;value+4&#93;, eax<br />            &#125;<br /><br />            cout&lt;&lt;&quot;Third Node Has A Value Of &quot;&lt;&lt;value&lt;&lt;endl&lt;&lt;endl;;<br />        &#125;&#91;/color&#93;<br />    protected&#58;<br />    public&#58;<br />        doublell&#40;void&#41;<br />        &#123;<br />            init&#40;&#41;;<br />            addnode&#40;1&#41;;<br />            addnode&#40;5&#41;;<br />            addnode&#40;4&#41;;<br />            printnodes&#40;rootnode&#41;;<br />            asmtraverse&#40;rootnode&#41;;<br />        &#125;<br />        ~doublell&#40;void&#41;<br />        &#123;<br />            destroylist&#40;rootnode&#41;;<br />        &#125;;<br />&#125;;<br /><br />int main&#40;void&#41;<br />&#123;<br />    doublell start;<br />    return 0;<br />&#125;&#91;/size&#93;</code></pre>First thing to remember here are the sizes of your classes and variables.<br /><br />A pointer here holds a 32 bit value or DWORD size.<br /><br />Our class (list) holds a double and a dword size variable, so this class is 12 bytes total.<br /><br />I don't know how to use NASM but I'm sure you'll get the idea on how to traverse the LL.<br /><br />This code is the heart of how we will traverse the LL.<pre><code>__asm<br />&#123;<br />    mov     edx, node<br />    mov     eax, DWORD PTR &#91;edx+8&#93;<br />    mov     node, eax<br />&#125;</code></pre>First you get a pointer to a node. This is the basis of your starting point.<br /><br />Remember the order of you variables on your class matters. Since we have a double variable before our next node pointer and since a double is 8 bytes, we advance 8 bytes further into the class. Then we retrieve the pointer.<br /><br />That's it, that's the key on traversing a LL in ASM.<br /><br />This code was tested using MS-VC 6.<br /><br />:)</div>
    <div class="meta">Posted on 2002-12-06 19:09:58 by stryker</div>
   </div>
   <div class="post" id="post-69601">
    <div class="subject"><a href="#post-69601">Linked List C++ or C/ASM</a></div>
    <div class="body">There are no error checkings in the code. And the function asmtraverse is static, so I'll just leave it to you to make it &quot;dynamic&quot; <em>(hint: a loop)</em> including optimizations... ;)</div>
    <div class="meta">Posted on 2002-12-06 19:28:35 by stryker</div>
   </div>
   <div class="post" id="post-69658">
    <div class="subject"><a href="#post-69658">Linked List C++ or C/ASM</a></div>
    <div class="body"><strong>edit: Should have read the post better, I just saw you were using NASM, my post only appies to inline asm in VC (like stryker's example). <br />:stupid:.</strong><br /><br />AFAIK it's possible to use the member names even in asm blocks, which is of course much more robust than using hardcoded offsets.<br />This article...<br /><a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vclang/html/_core_accessing_c_or_c.2b2b_.data_in___asm_blocks.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vclang/html/_core_accessing_c_or_c.2b2b_.data_in___asm_blocks.asp</a><br />... shows you how to use a struct's members in an __asm block. I haven't tested it but I assume it will work for classes as well, since they are more or less the same as structs (just with private instead of public as default access restriction).<br /><br />Thomas</div>
    <div class="meta">Posted on 2002-12-07 04:04:29 by Thomas</div>
   </div>
  </div>
 </body>
</html>