<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Binary Exercises #2 - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=29764" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=29764">Binary Exercises #2</a></p>
   <div class="post" id="post-210241">
    <div class="subject"><a href="#post-210241">Binary Exercises #2</a></div>
    <div class="body">Here&#039;s another little binary workout :)<br /><br />The UTF-8 text format encodes both &quot;American ASCII&quot; (7 bit characters), AND unicode characters.<br />That means its character encoding is variable in length.<br />Can you detect a legal series of characters, and return the length?<br /><br />Notes about UNICODE (ENCODED IN UTF-8) from unix:<br />Non-UNICODE bytes have bit 7 clear.<br />The first byte in an encoded UNICODE character has a series of high bits set, followed by one bit cleared.<br />The number of set bits indicates the number of bytes in this encoded character.<br />All &#039;subsequent&#039; bytes have bit 7 set, and bit 6 clear.<br />The remaining bytes contain the binary-encoded &#039;U-Code&#039;.<br /><br />;U-00000000 – U-0000007F: 	0xxxxxxx &nbsp; &nbsp; ;single byte, american ascii character<br />;U-00000080 – U-000007FF: 	110xxxxx 10xxxxxx<br />;U-00000800 – U-0000FFFF: 	1110xxxx 10xxxxxx 10xxxxxx<br />;U-00010000 – U-001FFFFF: 	11110xxx 10xxxxxx 10xxxxxx 10xxxxxx<br />;U-00200000 – U-03FFFFFF: 	111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx<br />;U-04000000 – U-7FFFFFFF: 	1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx<br /><br />Given a series of Bytes in EDX:EAX (AL contains the low order byte), write a function to quickly determine whether the byte sequence is a UTF-8 encoded UNICODE character according to the above masks, or whether the byte series is illegal.<br />It should return the number of bytes in the character, or null.<br /><br />If you feel like it, try to decode the U-Code for unicode characters as well :)<br /><br /></div>
    <div class="meta">Posted on 2010-01-18 04:45:22 by Homer</div>
   </div>
   <div class="post" id="post-210245">
    <div class="subject"><a href="#post-210245">Re: Binary Exercises #2</a></div>
    <div class="body">This looks like a job for a finite state machine.<br /><br />***EDIT*** I&#039;m at work, but this is my last week (moving on to a better job) so I&#039;m just playing desktop paperweight today :D Thank you for keeping me busy Homer<br /><br />Just the function...<br /><pre><code><br />align 8<br />ValidateUnicodeState:<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 128 ;;7 0xxx F xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeSuccess<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;B 10xx F xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 32 ;;D 110x F xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext1<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 16 ;;E 1110 F xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext2<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 8 ;;F 1111 7 0xxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext3<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 4 ;;F 1111 B 10xx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext4<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 2 ;;F 1111 D 110x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext5<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 2 ;;F 1111 F 111x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />ValidateUnicodeNext1:<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 128 ;;0xxx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;10xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeSuccess<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;11xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />ValidateUnicodeNext2:<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 128 ;;0xxx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;10xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext1<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;11xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />ValidateUnicodeNext3:<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 128 ;;0xxx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;10xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext2<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;11xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />ValidateUnicodeNext4:<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 128 ;;0xxx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;10xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext3<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;11xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />ValidateUnicodeNext5:<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 128 ;;0xxx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;10xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext4<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;11xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br /><br />;; IN: EDX:EAX unicode char<br />;; OUT: Length or NULL (illegal character)<br />align 16<br />ValidateUnicode:<br />&nbsp; &nbsp; &nbsp; &nbsp; PUSH&nbsp; &nbsp; ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; PUSH&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; XOR&nbsp; &nbsp;  ebx, ebx ;; =0<br />&nbsp; &nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  esi, ValidateUnicodeState ;; start state<br />.Again:<br />&nbsp; &nbsp; &nbsp; &nbsp; MOVZX&nbsp;  ecx, al ;; load byte<br />&nbsp; &nbsp; &nbsp; &nbsp; ADD&nbsp; &nbsp;  ebx, 1 ;; increment length<br />&nbsp; &nbsp; &nbsp; &nbsp; SHRD&nbsp; &nbsp; eax, edx, 8 ;; prepare next byte<br />&nbsp; &nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  esi,  ;; load next state<br />&nbsp; &nbsp; &nbsp; &nbsp; SHR&nbsp; &nbsp;  edx, 8<br />&nbsp; &nbsp; &nbsp; &nbsp; CMP&nbsp; &nbsp;  esi, ValidateUnicodeFail ;;next state?<br />&nbsp; &nbsp; &nbsp; &nbsp; JB&nbsp; &nbsp; &nbsp; .Again<br />&nbsp; &nbsp; &nbsp; &nbsp; JMP&nbsp; &nbsp;  esi ;; fail or success<br />ValidateUnicodeFail:<br />&nbsp; &nbsp; &nbsp; &nbsp; XOR&nbsp; &nbsp;  ebx, ebx<br />ValidateUnicodeSuccess:<br />&nbsp; &nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  eax, ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; POP&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; POP&nbsp; &nbsp;  ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; RET 0<br /><br /></code></pre><br /><br />FASM compilable source<br /><pre><code><br />format PE console<br />include &#039;win32a.inc&#039;<br />entry start<br /><br />section &quot;.data&quot; data readable writeable<br />szFormat&nbsp;  db &#039;eax is %X&#039;,13,10,0<br />_pause&nbsp; &nbsp;  db &#039;pause&#039;,0<br /><br />section &quot;.code&quot; code readable executable<br />start:<br />;;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; ValidateUnicode<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; szFormat<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;; 1<br />;;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 80h<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; ValidateUnicode<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; szFormat<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;; 0<br />;;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 80C0h<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; ValidateUnicode<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; szFormat<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;; 2<br />;;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 0C0h<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; ValidateUnicode<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; szFormat<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;; 0<br />;;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 808080FDh<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, 8080h<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; ValidateUnicode<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; szFormat<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;; 6<br />;;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 808080FDh<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, 7080h<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; ValidateUnicode<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; szFormat<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;; 0<br />;;<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _pause<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; call&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /><br />align 8<br />ValidateUnicodeState:<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 128 ;;7 0xxx F xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeSuccess<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;B 10xx F xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 32 ;;D 110x F xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext1<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 16 ;;E 1110 F xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext2<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 8 ;;F 1111 7 0xxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext3<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 4 ;;F 1111 B 10xx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext4<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 2 ;;F 1111 D 110x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext5<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 2 ;;F 1111 F 111x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />ValidateUnicodeNext1:<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 128 ;;0xxx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;10xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeSuccess<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;11xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />ValidateUnicodeNext2:<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 128 ;;0xxx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;10xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext1<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;11xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />ValidateUnicodeNext3:<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 128 ;;0xxx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;10xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext2<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;11xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />ValidateUnicodeNext4:<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 128 ;;0xxx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;10xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext3<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;11xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />ValidateUnicodeNext5:<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 128 ;;0xxx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;10xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeNext4<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br />&nbsp; &nbsp; &nbsp; &nbsp; REPEAT 64 ;;11xx xxxx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  dd ValidateUnicodeFail<br />&nbsp; &nbsp; &nbsp; &nbsp; END REPEAT<br /><br />;; IN: EDX:EAX unicode char<br />;; OUT: Length or NULL (illegal character)<br />align 16<br />ValidateUnicode:<br />&nbsp; &nbsp; &nbsp; &nbsp; PUSH&nbsp; &nbsp; ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; PUSH&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; XOR&nbsp; &nbsp;  ebx, ebx ;; =0<br />&nbsp; &nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  esi, ValidateUnicodeState ;; start state<br />.Again:<br />&nbsp; &nbsp; &nbsp; &nbsp; MOVZX&nbsp;  ecx, al ;; load byte<br />&nbsp; &nbsp; &nbsp; &nbsp; ADD&nbsp; &nbsp;  ebx, 1 ;; increment length<br />&nbsp; &nbsp; &nbsp; &nbsp; SHRD&nbsp; &nbsp; eax, edx, 8 ;; prepare next byte<br />&nbsp; &nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  esi,  ;; load next state<br />&nbsp; &nbsp; &nbsp; &nbsp; SHR&nbsp; &nbsp;  edx, 8<br />&nbsp; &nbsp; &nbsp; &nbsp; CMP&nbsp; &nbsp;  esi, ValidateUnicodeFail ;;next state?<br />&nbsp; &nbsp; &nbsp; &nbsp; JB&nbsp; &nbsp; &nbsp; .Again<br />&nbsp; &nbsp; &nbsp; &nbsp; JMP&nbsp; &nbsp;  esi ;; fail or success<br />ValidateUnicodeFail:<br />&nbsp; &nbsp; &nbsp; &nbsp; XOR&nbsp; &nbsp;  ebx, ebx<br />ValidateUnicodeSuccess:<br />&nbsp; &nbsp; &nbsp; &nbsp; MOV&nbsp; &nbsp;  eax, ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; POP&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; POP&nbsp; &nbsp;  ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; RET 0<br /><br /> section &#039;.idata&#039; import data readable writeable<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; library kernel,&#039;KERNEL32.DLL&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; msvcrt,&#039;msvcrt.dll&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; user,&#039;USER32.DLL&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  import kernel,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  GetCurrentProcess, &#039;GetCurrentProcess&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  SetPriorityClass, &#039;SetPriorityClass&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  GetCurrentThread, &#039;GetCurrentThread&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  SetThreadPriority, &#039;SetThreadPriority&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  GetTickCount,&#039;GetTickCount&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ExitProcess,&#039;ExitProcess&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  import msvcrt,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  printf,&#039;printf&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  system,&#039;system&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  import user,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  wsprintf,&#039;wsprintfA&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MessageBox,&#039;MessageBoxA&#039;<br /></code></pre></div>
    <div class="meta">Posted on 2010-01-18 07:53:43 by r22</div>
   </div>
   <div class="post" id="post-210253">
    <div class="subject"><a href="#post-210253">Re: Binary Exercises #2</a></div>
    <div class="body"><strong>Homer</strong>,<br /><br />Good exercise.<br />Not exactly UTF-8 encoding form (as Unicode standard defines it), but nevertheless (FASM too)<br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; format&nbsp; PE console<br />&nbsp; &nbsp; &nbsp; &nbsp; include &quot;Win32A.Inc&quot;<br /><br />; char * __cdecl decode_utf_8(char *utf_8, int *utf_32);<br />_decode_utf_8:<br />&nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, <br />&nbsp; &nbsp; &nbsp; &nbsp; movzx&nbsp;  eax, byte<br />&nbsp; &nbsp; &nbsp; &nbsp; inc&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, 7<br />clear:&nbsp; btr&nbsp; &nbsp;  eax, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; dec&nbsp; &nbsp;  ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; js&nbsp; &nbsp; &nbsp; error&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; all bits are non-zero<br />&nbsp; &nbsp; &nbsp; &nbsp; jc&nbsp; &nbsp; &nbsp; clear<br />; ecx==6, 5, 4, 3, 2, 1, 0 -- one less than zero bit index<br />&nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  ecx, 5<br />&nbsp; &nbsp; &nbsp; &nbsp; jg&nbsp; &nbsp; &nbsp; done&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; 0xxxxxxx, done<br />&nbsp; &nbsp; &nbsp; &nbsp; je&nbsp; &nbsp; &nbsp; error&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; 10xxxxxx, error<br />; ecx==-1, -2, -3, -4, -5 -- looks like good loop counter<br />&nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  esi, ecx&nbsp; &nbsp; &nbsp; &nbsp; ; adjust pointer<br />next:&nbsp;  movzx&nbsp;  edx, byte<br />&nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; dl, 0C0h<br />&nbsp; &nbsp; &nbsp; &nbsp; jns&nbsp; &nbsp;  error&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; 0xxxxxxx, error<br />&nbsp; &nbsp; &nbsp; &nbsp; jpe&nbsp; &nbsp;  error&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; 11xxxxxx, error<br />&nbsp; &nbsp; &nbsp; &nbsp; and&nbsp; &nbsp;  edx, 3Fh<br />&nbsp; &nbsp; &nbsp; &nbsp; shl&nbsp; &nbsp;  eax, 6<br />&nbsp; &nbsp; &nbsp; &nbsp; or&nbsp; &nbsp; &nbsp; eax, edx<br />&nbsp; &nbsp; &nbsp; &nbsp; inc&nbsp; &nbsp;  ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; jnz&nbsp; &nbsp;  next<br />done:&nbsp;  mov&nbsp; &nbsp;  ecx, <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, esi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />error:&nbsp; or&nbsp; &nbsp; &nbsp; eax, -1<br />&nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  done<br /><br />prompt&nbsp; db&nbsp; &nbsp;  &quot;Enter UTF-8 code units (hex, finish with any non-hex)&quot;, 10, 0<br />input_fmt db&nbsp;  &quot;%2x&quot;, 0<br />banner&nbsp; db&nbsp; &nbsp;  &quot;Decoded as:&quot;, 10, 0<br />output_fmt db&nbsp; &quot;%#x&quot;, 10, 0<br /><br />entry $<br />&nbsp; &nbsp; &nbsp; &nbsp; cinvoke _printf, prompt<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edi, utf_8<br />read:&nbsp;  cinvoke _scanf, input_fmt, edi<br />&nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  edi, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edi, utf_8_end<br />&nbsp; &nbsp; &nbsp; &nbsp; jae&nbsp; &nbsp;  decode<br />&nbsp; &nbsp; &nbsp; &nbsp; test&nbsp; &nbsp; eax, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; jnz&nbsp; &nbsp;  read<br /><br />decode: mov&nbsp; &nbsp;  esi, utf_8<br />&nbsp; &nbsp; &nbsp; &nbsp; cinvoke _printf, banner<br />more:&nbsp;  ccall&nbsp;  _decode_utf_8, esi, utf_32<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; cinvoke _printf, output_fmt, <br />&nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  esi, edi<br />&nbsp; &nbsp; &nbsp; &nbsp; jb&nbsp; &nbsp; &nbsp; more<br />&nbsp; &nbsp; &nbsp; &nbsp; cinvoke _getch<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; data import<br />&nbsp; &nbsp; &nbsp; &nbsp; library MSVCRT, &quot;MSVCRT&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; import&nbsp; MSVCRT,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _printf, &quot;printf&quot;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _scanf, &quot;scanf&quot;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _getch, &quot;_getch&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; end data<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; align&nbsp;  4<br />utf_32&nbsp; rd&nbsp; &nbsp; &nbsp; 1<br />utf_8&nbsp;  rb&nbsp; &nbsp; &nbsp; 100<br />utf_8_end = $<br /></code></pre><br /><br />Unicode defines only 0…10FFFF code points range, thus (well-formed) UTF-8 code unit sequence is no longer than four bytes. Detecting ill-formed byte sequence is another story.</div>
    <div class="meta">Posted on 2010-01-18 16:40:55 by baldr</div>
   </div>
   <div class="post" id="post-210262">
    <div class="subject"><a href="#post-210262">Re: Binary Exercises #2</a></div>
    <div class="body">What&#039;s the goal in this exercise? Fastest, smallest, most elegant...?</div>
    <div class="meta">Posted on 2010-01-19 01:54:12 by Scali</div>
   </div>
   <div class="post" id="post-210263">
    <div class="subject"><a href="#post-210263">Re: Binary Exercises #2</a></div>
    <div class="body">The goal is speed, unless otherwise mentioned.<br />Most of the time, if we&#039;re writing asm code, we&#039;re interested in making something faster.<br />People generally care little about size these days (the old size matters arguments are becoming meaningless anecdotes).<br />They don&#039;t care if the app is 5MB or 50 MB, but they&#039;d like to run the faster one, because the size of some code is usually invisible to the user, but the speed of a slow application is painfully obvious to the user.<br />As an example, RadASM comes to a snail pace with files above 50k lines, even on a fast machine.<br /><br /><br /></div>
    <div class="meta">Posted on 2010-01-19 02:44:29 by Homer</div>
   </div>
   <div class="post" id="post-210269">
    <div class="subject"><a href="#post-210269">Re: Binary Exercises #2</a></div>
    <div class="body">I think state machine will come out as a top performer. I was thinking of a more hard coded solution, but then a lot of branching becomes unavoidable, state machine has 6 CMP&#039;s worst case. Although the SHRD instruction is fairly slow I think a mitigated any partial stalls.</div>
    <div class="meta">Posted on 2010-01-19 08:11:18 by r22</div>
   </div>
   <div class="post" id="post-210752">
    <div class="subject"><a href="#post-210752">Re: Binary Exercises #2</a></div>
    <div class="body">Well, it took me a while to get around to it (At first I didn&#039;t realize this was a follow up post to &quot;Small Challenge&quot;) and I haven&#039;t really done any programming lately.<br /><br />Anyway, here&#039;s my version - it&#039;s more or less a variation of r22&#039;s but I reduced the table size and tried to minimize jumps.<br />Thanks for the base code to get me going - it made it a lot easier to figure out what I was supposed to be doing - hopefully I&#039;ve got it right ;-).<br /><br />I still haven&#039;t worked on any timing code yet, so I don&#039;t really know how well it performs in comparison.&nbsp; I also haven&#039;t&nbsp; checked too much invalid data, but I don&#039;t forsee any problems.<br /><br /><pre><code>format PE console<br />include &#039;win32a.inc&#039;<br />entry start<br /><br />section &quot;.code&quot; code readable executable<br />start:<br />&nbsp; &nbsp; mov eax,0<br />&nbsp; &nbsp; call ValidateUnicode<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; push szFormat<br />&nbsp; &nbsp; call  ;; 1<br /><br />&nbsp; &nbsp; mov eax,80C0h<br />&nbsp; &nbsp; call ValidateUnicode<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; push szFormat<br />&nbsp; &nbsp; call  ;; 2<br /><br />&nbsp; &nbsp; mov eax,8080E0h<br />&nbsp; &nbsp; call ValidateUnicode<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; push szFormat<br />&nbsp; &nbsp; call  ;; 3<br /><br />&nbsp; &nbsp; mov eax,808080F0h<br />&nbsp; &nbsp; call ValidateUnicode<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; push szFormat<br />&nbsp; &nbsp; call  ;; 4<br /><br />&nbsp; &nbsp; mov eax,808080F8h<br />&nbsp; &nbsp; mov edx,80h<br />&nbsp; &nbsp; call ValidateUnicode<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; push szFormat<br />&nbsp; &nbsp; call  ;; 5<br /><br />&nbsp; &nbsp; mov eax,808080FCh<br />&nbsp; &nbsp; mov edx,8080h<br />&nbsp; &nbsp; call ValidateUnicode<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; push szFormat<br />&nbsp; &nbsp; call  ;; 6<br /><br />&nbsp; &nbsp; mov eax,0FFh<br />&nbsp; &nbsp; mov edx,8080h<br />&nbsp; &nbsp; call ValidateUnicode<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; push szFormat<br />&nbsp; &nbsp; call  ;; 0<br /><br />&nbsp; &nbsp; mov eax,80h<br />&nbsp; &nbsp; call ValidateUnicode<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; push szFormat<br />&nbsp; &nbsp; call  ;; 0<br /><br />&nbsp; &nbsp; mov eax,0C0h<br />&nbsp; &nbsp; call ValidateUnicode<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; push szFormat<br />&nbsp; &nbsp; call  ;; 0<br /><br />&nbsp; &nbsp; mov eax,808080FDh<br />&nbsp; &nbsp; mov edx,7080h<br />&nbsp; &nbsp; call ValidateUnicode<br />&nbsp; &nbsp; push eax<br />&nbsp; &nbsp; push szFormat<br />&nbsp; &nbsp; call  ;; 0<br /><br />&nbsp; &nbsp; push 0<br />&nbsp; &nbsp; call <br />align 8<br /><br />;; IN: EDX:EAX unicode char<br />;; OUT: Length or NULL (illegal character)<br />align 16<br />ValidateUnicode:<br />&nbsp; &nbsp; movzx ecx,al<br />&nbsp; &nbsp; xor ecx,11111111b<br />&nbsp; &nbsp; or&nbsp; ecx,1<br />&nbsp; &nbsp; bsr ecx,ecx<br />&nbsp; &nbsp; and eax,<br />&nbsp; &nbsp; xor eax,<br />&nbsp; &nbsp; jnz .long<br />&nbsp; &nbsp; mov eax,<br />&nbsp; &nbsp; retn<br />&nbsp; .long:<br />&nbsp; &nbsp; and edx,<br />&nbsp; &nbsp; xor edx,eax<br />&nbsp; &nbsp; jnz .error<br />&nbsp; &nbsp; mov eax,<br />&nbsp; &nbsp; retn<br />&nbsp; .error:<br />&nbsp; &nbsp; xor eax,eax<br />&nbsp; &nbsp; retn<br />align 8<br /> .andtable&nbsp; dd 0,0,0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 11000000110000001100000011111000b<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 00000000110000001100000011110000b<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 00000000000000001100000011100000b<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 00000000000000000000000010000000b<br /> .xortable&nbsp; dd -1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 00000000000000001000000010000000b<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 00000000000000000000000010000000b<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 10000000100000001000000011110000b<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 00000000100000001000000011100000b<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 00000000000000001000000011000000b<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd -1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 00000000000000000000000000000000b<br /> .andtable2 dd 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 00000000000000001100000011000000b<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 00000000000000000000000011000000b<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd 0,0,0,0<br /> .lentable&nbsp; dd 0,6,5,4,3,2,0,1<br /><br />section &quot;.data&quot; data readable writeable<br />szFormat&nbsp;  db &#039;eax is %X&#039;,13,10,0<br /><br />section &#039;.idata&#039; import data readable writeable<br />library kernel,&#039;KERNEL32.DLL&#039;,\<br />&nbsp; &nbsp; &nbsp; &nbsp; msvcrt,&#039;msvcrt.dll&#039;<br />import kernel,\<br />&nbsp; &nbsp; &nbsp; &nbsp; ExitProcess,&#039;ExitProcess&#039;<br />import msvcrt,\<br />&nbsp; &nbsp; &nbsp; &nbsp; printf,&#039;printf&#039;<br /></code></pre></div>
    <div class="meta">Posted on 2010-02-11 23:20:11 by sysfce2</div>
   </div>
  </div>
 </body>
</html>