<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>macro for jump absolute - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=5505" />
  <link rel="prev" href="../?id=5505&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=5505">macro for jump absolute</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=5505&amp;page=1" style="">&laquo;</a><a href="../?id=5505&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="5505" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-39262">
    <div class="subject"><a href="#post-39262">macro for jump absolute</a></div>
    <div class="body"><pre><code><br />absjmp MACRO address<br />LOCAL opend<br />db 0E9h<br />dd address - opend<br />opend = $+401000h-sectaddr<br />endm<br /></code></pre><br /><br /><pre><code><br />.code<br />sectaddr equ $ ;at first occurence of .code statement set the constant<br />start&#58;<br />	absjmp 810000h<br />	xor eax,eax<br />	absjmp 401000h<br />	mov eax,eax<br />	absjmp 400000h<br />	<br /></code></pre><br /><br />I tested it.<br />It generates right opcode jmp near imm <br />Unfortunatly you must <br />1. Change values if you not use default base and alignment<br />2. Manualy set sectaddr value at first .code statement.<br />offset @code might be used instead of it but you need shl it 4 and masm can not do it.</div>
    <div class="meta">Posted on 2002-05-21 15:09:45 by The Svin</div>
   </div>
   <div class="post" id="post-39302">
    <div class="subject"><a href="#post-39302">macro for jump absolute</a></div>
    <div class="body">Grin,<br /><br />=====================================<br />I'm sorry hutch, but you are wrong. &quot;jmp 401000h&quot; ought to jump to address 401000h (which can't be assembled directly when doing coff output, but would work with eg binary output), while &quot;jmp [401000h]&quot; (or &quot;jmp dword ptr [401000h]&quot;) should jump to the address pointed to by the dword at address 401000h. Brackets mean indirection. You don't think that &quot;jmp eax&quot; and &quot;jmp &quot; ought to produce the same instructions, do you now?<br />=====================================<br /><br />This is f0dder_asm, how does this theory of indirection only handle the standard MASM syntax like,<br /><pre><code><br />    mov ax, MyVar&#91;2&#93;<br /></code></pre><br />Is this too indirect for your theory ? :) Should MASM rewrite the use of indexing or added displacements on the basis of this theory ?<br /><pre><code><br />    mov ax, &#91;ebp-whatever+2&#93;<br /></code></pre><br />I have no real objection to assemblers that are a bit toothless in the parsing department and it seems there are people who want to play with them but when you are finished playing games, you write 32 bit windows assembler in MASM if you want to get something written in your lifetime. :)<br /><br />Imagine a toilet that has a sheet of really rough sandpaper nailed to the wall with a caption, &quot;You can tell the men from the boys by the paper they use&quot;.<br /><br />Most ordinary mortals will still use the normal stuff but there will be that bunch of others who will at least try and use the sandpaper.<br /><br />Doing things the hard way for no reason may be asthetically pleasing to some but most want to get the job done without the irritations and this goes for writing assembler. With MASM you have the parsing grunt to offer simplified syntax that is not so notation burdened as others that are less powerful in their parsing.<br /><br />Still, if you want to add more garbage, try prefixing the registers with % like GAS does, perhaps thats the proper way for people who cannot recognise the expressions typed in.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2002-05-21 22:55:31 by hutch--</div>
   </div>
   <div class="post" id="post-39310">
    <div class="subject"><a href="#post-39310">macro for jump absolute</a></div>
    <div class="body"><div class="quote"><br />This is f0dder_asm<br /></div><br />Whatever.<br /> mean indirection in most x86 assemblers,<br />and &quot;most places&quot; in masm. Masm seems quite ambiguous<br />about this though. That you have to add a DS &quot;override&quot;<br />to make it understand you want A100104000 and not<br />B8010400 from &quot;mov eax, [401000h]&quot; is plain silly.<br /><br />I can live with the fact that masm doesn't enforce<br />brackets on indirection and that it has some additionaly<br />quirky ways of doing indirection, like variable,<br />even if these are syntactically flawed &amp; ugly to me.<br />But that it f_ucks around with standard stuff like<br />the above... bleh.</div>
    <div class="meta">Posted on 2002-05-22 00:00:58 by f0dder</div>
   </div>
   <div class="post" id="post-39395">
    <div class="subject"><a href="#post-39395">macro for jump absolute</a></div>
    <div class="body"><div class="quote"><br />Probably just me who don't understand masm's macro argument expansion then. I would have assumed... </div>This doesn't have to do with the macro argument expansion, but with MASM's qualified type resolution.  Assumptions like this continue to make things harder than they should be for you.  Maybe a good read of the manual is in order - I am sorry that it is not in your native language - for I'm sure these matters would be trivial for you to grasp.</div>
    <div class="meta">Posted on 2002-05-22 14:11:02 by bitRAKE</div>
   </div>
   <div class="post" id="post-41392">
    <div class="subject"><a href="#post-41392">Note about opcode short jmp translation in Hiew,OllyDbg and</a></div>
    <div class="body">Some additional info for those who not familiar with <br />((short) jmp address) opcode.<br />While first byte of those opcode is easy to use - it's 0E9h (sign of short jmp)<br />next dword of opcode is address, but it's relative address not absolute.<br />It = address you need to jmp minus of next opcode<br />for example 0E9 00000000h - means to jmp to the next instruction.<br />Keeping in mind that I knew base address and section alignment I worked out macro<br />that way<br />1. In the first occurence of .code statement(wich is address of code section) <br />I put <br />sectaddr equ $<br />2. And the macro was:<br />absjmp MACRO address<br />LOCAL opend<br />db 0E9h<br />dd address - opend<br />opend = $+401000h-sectaddr<br />endm<br />401000h here is base + section alignment and actually it's equal to sectaddr.<br />But I couldn't write just opend = $ 'cause it would rise error about relocation :)<br /><br />I test it with different values - macro worked all right generating right opcode each time.<br />Then I wandered if different debuggers and disassemblers could show it right way.<br />Here is the end of introduction, now the notes this post is about.<br />Here is code tested:<br /><br />.code<br />sectaddr equ $ ;at first occurence of .code set the constant<br />start:<br />	absjmp 810000h<br />	xor eax,eax<br />	absjmp 401000h<br />	mov eax,eax<br />	absjmp 400000h<br />@@:	<br />	cmp al,1<br />	adc al,al<br />	and al,3<br />	jmp @B<br /><br /><br />OllyDbg behavior was most strange:<br />'Cause it &quot;understood&quot; jmps very well but failed to disassm<br /> very simple following jmps code:<br /><pre><code><br />00401000 &lt;Mo&gt; $-E9 FBEF4000          JMP 00810000<br />00401005      . 33C0                 XOR EAX,EAX<br />00401007      .^E9 F4FFFFFF          JMP testinst.&lt;ModuleEntryPoint&gt;<br />0040100C      . 8BC0                 MOV EAX,EAX<br />0040100E      .-E9 EDEFFFFF          JMP testinst.00400000<br />;here OllyDbg failed&#58;<br />00401013        3C                   DB 3C<br />00401014        01                   DB 01<br />00401015        12                   DB 12<br />00401016        C0                   DB C0<br />00401017        24                   DB 24<br />00401018      . 03EB                 ADD EBP,EBX<br />0040101A      . F8                   CLC<br /></code></pre><br /><br />Olly should have treated <br />db 3c, 01 as cmp al,1<br />db 12, c0 as adc al,al<br />db 24, 03 as and al,03<br />db eb, 08 as jmp to 40101B-8 (to 401013)<br /><br />But your can see how it took the opcode <br />Without preceding short jmps OllyDbg disassm the opcode well.<br />Why did it not do it after the jmps - is a mystery to me :)<br /><br />Next try was with Hiew.<br />It understood everything ok exept for jmp lower that base address:<br /><br /><pre><code><br />.00401000&#58; E9FBEF4000                   jmp       00040F400<br />.00401005&#58; 33C0                         xor       eax,eax<br />.00401007&#58; E9F4FFFFFF                   jmp      .000401000<br />.0040100C&#58; 8BC0                         mov       eax,eax<br />;here&#58;<br />.0040100E&#58; E9EDEFFFFF                   jmp       0FFFFF400<br />.00401013&#58; 3C01                         cmp       al,001 ;&quot;&quot;<br />.00401015&#58; 12C0                         adc       al,al<br />.00401017&#58; 2403                         and       al,003 ;&quot;&quot;<br />.00401019&#58; EBF8                         jmps     .000401013<br /></code></pre><br /><br />Now Soft Ice.<br />That was the only one who got everything right :)<br /><pre><code><br />00401000&#58; E9FBEF4000                   jmp       00040F400<br />00401005&#58; 33C0                         xor       eax,eax<br />00401007&#58; E9F4FFFFFF                   jmp      .000401000<br />0040100C&#58; 8BC0                         mov       eax,eax<br />0040100E&#58; E9EDEFFFFF                   jmp      .000400000<br />00401013&#58; 3C01                         cmp       al,001 <br />00401015&#58; 12C0                         adc       al,al<br />00401017&#58; 2403                         and       al,003 <br />00401019&#58; EBF8                         jmps     .000401013<br /></code></pre><br /><br />That's it.</div>
    <div class="meta">Posted on 2002-06-04 10:36:01 by The Svin</div>
   </div>
   <div class="post" id="post-41508">
    <div class="subject"><a href="#post-41508">OllyDbg</a></div>
    <div class="body"><strong>Svin:</strong>  why did you choose 810000h as jump ?<br /><br />if i change 810000h (wich points nowhere on my system)<br />to 77F01000h (KERNEL32.ModuleEntryPoint) OllyDbg<br />decodes fine.<br /><br />i use OllyDbg 1.07 (step 1)</div>
    <div class="meta">Posted on 2002-06-05 02:42:51 by TBD</div>
   </div>
   <div class="post" id="post-42285">
    <div class="subject"><a href="#post-42285">Olly's response</a></div>
    <div class="body">&quot;Yeah, it happens sometimes. OllyDbg is highly <br />heuristical (and a bit fuzzy). <br /><br />Without full context, it's hard to get exact reason.<br />Most possibly, some other commands references <br />address 00401018 as data or jump destination, <br />or the  real commands looked too improbable to <br />be a real sequence.&quot;<br /><br />this is Olly's response on Svin's post.<br /><br />also Olly added &quot;new switch analysis is ready, <br />and stack walk also looks promising. Maybe in a <br />week or two I'll post 1.07a on my homepage&quot; :alright: <br /><br />nice :tongue:</div>
    <div class="meta">Posted on 2002-06-10 02:07:30 by TBD</div>
   </div>
   <div class="post" id="post-44222">
    <div class="subject"><a href="#post-44222">macro for jump absolute</a></div>
    <div class="body"><div class="quote">why did you choose 810000h as jump</div> <br />I chose different mem locations.<br />As for 8?????h addresses in 9x a lot of usefull system data here.<br />Most strange things was that it decoded the jmp right way, but failed to decode very simple opcode followed it.<br /><br />My regards to Oleh, he is doing very well with his tool.</div>
    <div class="meta">Posted on 2002-06-19 19:54:35 by The Svin</div>
   </div>
   <div class="post" id="post-48844">
    <div class="subject"><a href="#post-48844">macro for jump absolute</a></div>
    <div class="body">Thats in esence, the reason why I dont like MASM.<br /><br />;P Bye bye</div>
    <div class="meta">Posted on 2002-07-19 12:16:54 by sheroc</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=5505&amp;page=1" style="">&laquo;</a><a href="../?id=5505&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="5505" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>