<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>1) Bitmap Size and 2) Window Title Bar - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=2387" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=2387">1) Bitmap Size and 2) Window Title Bar</a></p>
   <div class="post" id="post-15136">
    <div class="subject"><a href="#post-15136">1) Bitmap Size and 2) Window Title Bar</a></div>
    <div class="body">Hi @all...<br />I'm developing a simple SplashScreen Library that I'll release here (hoping that someone will be interested in it :)), but I ha ve a few problems:<br />1) I use GetBitmapDimensionEx to get Height and Width of the bitmap used for the SplashScreen, but even though the function returns a nonzero value (correct), the size is always (0,0). The bitmap used is really (400,300). The function requires a SIZE structure not defined in WINDOWS.INC and I use a POINT structure (it has the same fields: 2 DWORDs). May it be this the problem? If so, how can I fix it?<br />2) The SplashScreen windows has the Titlebar: which style should I use not to have it? I tried no style at all, but I still get the Titlebar.<br /><br />I'm attaching the lib code, hoping that someone can give me a little help. Thanx to anyone in advance.<br /><br />Sincerely,<br />   Daniel<br /><br /><div class="quote"><br />.386<br />.model flat, stdcall  ;32 bit memory model<br />option casemap :none  ;case sensitive<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\gdi32.inc<br />includelib \masm32\lib\gdi32.lib<br />include \masm32\include\user32.inc<br />includelib \masm32\lib\user32.lib<br /><br />SplashScreenProc PROTO :HWND, :UINT, :WPARAM, :LPARAM<br /><br />.data?<br />SShBmp		HBITMAP ?<br />SSTime		dd ?<br />SShWnd		HWND ?<br /><br />.data<br />SSClassName	db 'SplashScreen',0<br /><br />.code<br />SplashScreen PROC hInst: HINSTANCE, hParWnd: HWND, resBitmap: DWORD, Time: DWORD<br /><br />	LOCAL	wc: WNDCLASSEX<br />	LOCAL	rect: RECT<br />	LOCAL	x: DWORD, y: DWORD<br />	LOCAL	dim: POINT<br /><br />	push	Time<br />	pop	SSTime<br /><br />	; Register the SplashScreen window class<br />	mov	wc.cbSize, SIZEOF WNDCLASSEX<br />	mov	wc.style, CS_HREDRAW or CS_VREDRAW<br />	mov	wc.lpfnWndProc, OFFSET SplashScreenProc<br />	mov	wc.cbClsExtra, NULL<br />	mov	wc.cbWndExtra, NULL<br />	push	hInst<br />	pop	wc.hInstance<br />	invoke	LoadIcon, NULL, IDI_APPLICATION<br />	mov	wc.hIcon, eax<br />	mov	wc.hIconSm, eax<br />	invoke	LoadCursor, NULL, IDC_ARROW<br />	mov	wc.hCursor, eax<br />	mov	wc.hbrBackground, COLOR_BTNFACE + 1<br />	mov	wc.lpszMenuName, NULL<br />	mov	wc.lpszClassName, OFFSET SSClassName<br />	invoke	RegisterClassEx, ADDR wc<br /><br />	; Get Bitmap dimensions -&gt; Splash Window dimensions<br />	invoke	LoadBitmap, hInst, resBitmap<br />	mov	SShBmp, eax<br />	invoke	GetBitmapDimensionEx, SShBmp, ADDR dim<br /><br />	; Computes SplashScreen position<br />	invoke	GetWindowRect, hParWnd, ADDR rect<br />	mov	eax, rect.right<br />	sub	eax, rect.left<br />	sub	eax, dim.x<br />	shr	eax, 1<br />	add	eax, rect.left<br />	mov	x, eax<br />	mov	eax, rect.bottom<br />	sub	eax, rect.top<br />	sub	eax, dim.y<br />	shr	eax, 1<br />	add	eax, rect.top<br />	mov	y, eax<br /><br />	; Create the SplashScreen<br />;	invoke	CreateWindowEx, WS_EX_CLIENTEDGE + WS_EX_DLGMODALFRAME + WS_EX_TOPMOST + WS_EX_WINDOWEDGE, ADDR SSClassName, ADDR SSClassName,WS_VISIBLE, x, y, dim.x, dim.y, hParWnd, NULL, hInst, NULL<br />	invoke	CreateWindowEx, NULL, ADDR SSClassName, ADDR SSClassName, NULL, x, y, dim.x, dim.y, hParWnd, NULL, hInst, NULL<br />	mov	SShWnd, eax<br />	invoke	ShowWindow, SShWnd, SW_SHOWNORMAL<br />	invoke	UpdateWindow, SShWnd<br />	ret<br />SplashScreen endp<br /><br />SplashScreenProc proc hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br /><br />	LOCAL	hDcWnd: HDC, hDcMem: HDC, dim: POINT<br /><br />	.if uMsg==WM_CREATE<br />		invoke	SetTimer, hWin, 1, SSTime, NULL<br />	.elseif uMsg == WM_PAINT<br />		invoke	GetDC, hWin<br />		mov	hDcWnd, eax<br />		invoke	CreateCompatibleDC, eax<br />		mov	hDcMem, eax<br />		invoke	SelectObject, hDcMem, SShBmp<br />		invoke	GetMapMode, hDcWnd<br />		invoke	SetMapMode, hDcMem, eax<br />		invoke	GetBitmapDimensionEx, SShBmp, ADDR dim<br />		invoke	BitBlt, hDcWnd, dim.x, dim.y, 400, 300, hDcMem, 0, 0, SRCCOPY<br />		invoke	DeleteDC, hDcMem<br />	.elseif uMsg == WM_TIMER<br />		invoke	KillTimer, hWin, 1<br />		invoke	DeleteObject, SShBmp<br />		invoke	PostQuitMessage, TRUE<br />	.else<br />		invoke DefWindowProc, hWin, uMsg, wParam, lParam<br />		ret<br />	.endif<br />	xor    eax,eax<br />	ret<br />SplashScreenProc endp<br /></div></div>
    <div class="meta">Posted on 2001-12-16 12:50:49 by dguzz</div>
   </div>
   <div class="post" id="post-15138">
    <div class="subject"><a href="#post-15138">easy....</a></div>
    <div class="body">i think that this isn't difficult. use GetObject to get the bitmap dimensions. use WS_POPUP style for your window....<br /><br />hope that helps<br />nop</div>
    <div class="meta">Posted on 2001-12-16 13:18:52 by NOP-erator</div>
   </div>
   <div class="post" id="post-15140">
    <div class="subject"><a href="#post-15140">1) Bitmap Size and 2) Window Title Bar</a></div>
    <div class="body"><div class="quote">The SplashScreen windows has the Titlebar: which style should I use not to have it?</div><br />WS_POPUP should do the trick.</div>
    <div class="meta">Posted on 2001-12-16 13:20:55 by Tola</div>
   </div>
   <div class="post" id="post-15206">
    <div class="subject"><a href="#post-15206">1) Bitmap Size and 2) Window Title Bar</a></div>
    <div class="body">Hi @ all again...<br />thanx for the help you gave me, but I'm very sorry in telling you that you wasted your time: I already fixed my problems a few hours ago, but I cannot warn you about this because I couldn't connect to Internet in the past few hours. Please excuse me.<br />Now I have another problem.<br />My target for this LIB is to make it work this way: in the WM_CREATE code section of the MAIN application I would call the SplashScreen proc and then forget it. Infact I'm passing any parameter needed, even the number of milliseconds the SplashScreen should stay visible. Alas, even if the SetTimer in the WM_CREATE of the SplashScreenProc returns a value &lt;&gt; 0, the WM_TIMER message is never dispatched. And because in the WM_TIMER code section I would kill the timer and close the SplashScreen, really the SplashScreen is actually not closed at all!!!<br />Have anyone an idea (and perhaps a fix) why the WM_TIMER is not sent to the SplashScreenProc, even though the SetTimer is correctly invoked? I also tried passing a TimerProc instead of NULL, deleting the WM_TIMER from the SplashScreenProc and using the TimerProc, but even this way it is never called. The Number of milliseconds used is 3000 (so 3 seconds), but... alas... it doesn't work.<br /><br />This time I think I cannot fix the code by myself and I would greatly appreciate any sort of help.<br /><br />Thanx in advance!<br /><br />Sincerely,<br />   Daniel<br /><br /><div class="quote"><br />.386<br />.model flat, stdcall  ;32 bit memory model<br />option casemap :none  ;case sensitive<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\gdi32.inc<br />includelib \masm32\lib\gdi32.lib<br />include \masm32\include\user32.inc<br />includelib \masm32\lib\user32.lib<br /><br />SplashScreenProc PROTO :HWND, :UINT, :WPARAM, :LPARAM<br /><br />.data?<br />SShBmp		HBITMAP ?<br />SSTime		dd ?<br />SShWnd		HWND ?<br /><br />.data<br />SSClassName	db 'SplashScreen',0<br /><br />.code<br />SplashScreen PROC hInst: HINSTANCE, hParWnd: HWND, resBitmap: DWORD, Time: DWORD<br /><br />	LOCAL	wc: WNDCLASSEX<br />	LOCAL	rect: RECT<br />	LOCAL	x: DWORD, y: DWORD<br />	LOCAL	hdBmp: BITMAP<br />	LOCAL	msg:MSG<br />	<br />	push	Time<br />	pop	SSTime<br /><br />	; Register the SplashScreen window class<br />	mov	wc.cbSize, SIZEOF WNDCLASSEX<br />	mov	wc.style, CS_HREDRAW or CS_VREDRAW<br />	mov	wc.lpfnWndProc, OFFSET SplashScreenProc<br />	mov	wc.cbClsExtra, NULL<br />	mov	wc.cbWndExtra, NULL<br />	push	hInst<br />	pop	wc.hInstance<br />	invoke	LoadIcon, NULL, IDI_APPLICATION<br />	mov	wc.hIcon, eax<br />	mov	wc.hIconSm, eax<br />	invoke	LoadCursor, NULL, IDC_ARROW<br />	mov	wc.hCursor, eax<br />	mov	wc.hbrBackground, COLOR_BTNFACE + 1<br />	mov	wc.lpszMenuName, NULL<br />	mov	wc.lpszClassName, OFFSET SSClassName<br />	invoke	RegisterClassEx, ADDR wc<br /><br />	; Get Bitmap dimensions -&gt; Splash Window dimensions<br />		...<br />		CORRECT CODE HERE<br />		...<br />	; Computes SplashScreen position<br />		...<br />		CORRECT CODE HERE<br />		...<br />	; Create the SplashScreen<br />	invoke	CreateWindowEx, WS_EX_TRANSPARENT, ADDR SSClassName, ADDR SSClassName, WS_CHILD, x, y, eax, ebx, hParWnd, NULL, hInst, NULL<br />	mov	SShWnd, eax<br />	invoke	ShowWindow, SShWnd, SW_SHOWNORMAL<br />	invoke	UpdateWindow, SShWnd<br />	ret<br />SplashScreen endp<br /><br />SplashScreenProc proc hWin:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br /><br />	LOCAL	hDcWnd: HDC, hDcMem: HDC, hdBmp: BITMAP, rect: RECT<br /><br />	.if uMsg == WM_CREATE<br />		invoke	SetTimer, hWin, 1, SSTime, NULL<br />	.elseif uMsg == WM_PAINT<br />		...<br />		CORRECT CODE HERE<br />		...<br />	.elseif uMsg == WM_TIMER<br />		invoke	KillTimer, hWin, 1<br />		invoke	DeleteObject, SShBmp<br />		invoke	PostQuitMessage, TRUE<br />	.else<br />		invoke	DefWindowProc, hWin, uMsg, wParam, lParam<br />		ret<br />	.endif<br />	xor    eax,eax<br />	ret<br />SplashScreenProc endp<br /><br />end<br /></div><br /><br />The attached image is an example of the SplashScreen working but not closing!</div>
    <div class="meta">Posted on 2001-12-17 11:40:00 by dguzz</div>
   </div>
   <div class="post" id="post-15225">
    <div class="subject"><a href="#post-15225">1) Bitmap Size and 2) Window Title Bar</a></div>
    <div class="body">You don't show a message loop.<br /><br />WM_TIMER requires a message loop.</div>
    <div class="meta">Posted on 2001-12-17 16:33:07 by tank</div>
   </div>
   <div class="post" id="post-15306">
    <div class="subject"><a href="#post-15306">1) Bitmap Size and 2) Window Title Bar</a></div>
    <div class="body">OK... thanx...<br />I'll try to make the SplashCreation in a new thread so that the MAIN app can continue initializing and loading while the SplashProc receives the WM_TIMER<br /><br />Thanx again (I hope it'll work :))<br /><br />Sincerely,<br />   Daniel</div>
    <div class="meta">Posted on 2001-12-18 11:48:38 by dguzz</div>
   </div>
  </div>
 </body>
</html>