<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>ListView problems... - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=21748" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=21748">ListView problems...</a></p>
   <div class="post" id="post-164093">
    <div class="subject"><a href="#post-164093">ListView problems...</a></div>
    <div class="body"><div class="quote">DlgProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />&nbsp; &nbsp; LOCAL hListView:HWND<br />&nbsp; &nbsp; LOCAL hListInst:HINSTANCE<br />&nbsp; &nbsp; LOCAL lvc:LVCOLUMN<br />&nbsp; &nbsp; invoke RtlZeroMemory, addr lvc, sizeof lvc<br />&nbsp; &nbsp;  <br />&nbsp; &nbsp; .IF uMsg==WM_INITDIALOG&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke CreateWindowEx,NULL,ADDR ListViewClass,NULL,WS_CHILD+WS_VISIBLE,22,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 65,350,285,hWnd,LIST1,hListInst,NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov hListView, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage,hListView,LVM_SETEXTENDEDLISTVIEWSTYLE,0,LVS_EX_FULLROWSELECT or LVS_EX_HEADERDRAGDROP<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.mask, LVCF_TEXT or LVCF_SUBITEM or LVCF_WIDTH or LVCF_FMT<br />&nbsp; &nbsp; &nbsp; &nbsp; <strong>mov lvc.fmt, LVCFMT_LEFT</strong><br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.iSubItem, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.cx, 105<br />&nbsp; &nbsp; &nbsp; &nbsp; <strong>mov lvc.pszText, addr Column1</strong><br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_INSERTCOLUMN, 0, addr lvc<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; .ELSEIF uMsg==WM_CLOSE<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke EndDialog,hWnd,NULL<br />&nbsp; &nbsp; .ELSE<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,FALSE<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />&nbsp; &nbsp; .ENDIF<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; mov eax,TRUE<br />&nbsp; &nbsp; ret<br />DlgProc endp</div><br /><br />Im getting these errors:<br /><br /><div class="quote">error A2081: missing operand after unary operator</div><br /><br /><div class="quote">syntax error : addr<br />error A2166: structure field expected</div><br /><br />On the red lines respectively...</div>
    <div class="meta">Posted on 2005-09-02 18:56:31 by Lenin</div>
   </div>
   <div class="post" id="post-164096">
    <div class="subject"><a href="#post-164096">Re: ListView problems...</a></div>
    <div class="body">Sounds pretty weird that you&#39;re getting an error on the first line...<br /><br />as for addr, isn&#39;t it usable only in invoke statements?</div>
    <div class="meta">Posted on 2005-09-02 19:36:10 by f0dder</div>
   </div>
   <div class="post" id="post-164097">
    <div class="subject"><a href="#post-164097">Re: ListView problems...</a></div>
    <div class="body">I believe<br /><br />mov lvc.cx, 105<br /><br />should be<br /><br />mov lvc.lx, 105<br /><br />Not sure on the problems you mentioned<br /><br />Regards,<br /><br />Darrel</div>
    <div class="meta">Posted on 2005-09-02 19:47:30 by Darrel</div>
   </div>
   <div class="post" id="post-164099">
    <div class="subject"><a href="#post-164099">Re: ListView problems...</a></div>
    <div class="body">Oh I didnt know about that addr thing... Changed it to offset, but the other 2 errors are still there.</div>
    <div class="meta">Posted on 2005-09-02 20:13:48 by Lenin</div>
   </div>
   <div class="post" id="post-164100">
    <div class="subject"><a href="#post-164100">Re: ListView problems...</a></div>
    <div class="body"><div class="quote">LV_COLUMN STRUCT<br />&nbsp; imask&nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp; &nbsp; &nbsp; ?<br />&nbsp; fmt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  DWORD&nbsp; &nbsp; &nbsp; ?<br />&nbsp; lx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD&nbsp; &nbsp; &nbsp; ?<br />&nbsp; pszText&nbsp; &nbsp; &nbsp;  DWORD&nbsp; &nbsp; &nbsp; ?<br />&nbsp; cchTextMax&nbsp; &nbsp; DWORD&nbsp; &nbsp; &nbsp; ?<br />&nbsp; iSubItem&nbsp; &nbsp; &nbsp; DWORD&nbsp; &nbsp; &nbsp; ?<br />&nbsp; iImage&nbsp; &nbsp; &nbsp; &nbsp; DWORD ?<br />&nbsp; iOrder&nbsp; &nbsp; &nbsp; &nbsp; DWORD ?<br />LV_COLUMN ENDS<br /><br />LVCOLUMN&nbsp; equ&nbsp; &lt;LV_COLUMN&gt;<br /></div><br /><br />mov <strong>lvc.mask</strong>, LVCF_TEXT or LVCF_SUBITEM or LVCF_WIDTH or LVCF_FMT<br />===&gt;<br />mov lvc.<strong>i</strong>mask, LVCF_TEXT or LVCF_SUBITEM or LVCF_WIDTH or LVCF_FMT<br /><br /></div>
    <div class="meta">Posted on 2005-09-02 22:32:51 by dcskm4200</div>
   </div>
   <div class="post" id="post-164102">
    <div class="subject"><a href="#post-164102">Re: ListView problems...</a></div>
    <div class="body">Darrel is correct.&nbsp; ;)</div>
    <div class="meta">Posted on 2005-09-02 23:19:06 by roticv</div>
   </div>
   <div class="post" id="post-164105">
    <div class="subject"><a href="#post-164105">Re: ListView problems...</a></div>
    <div class="body">comrade, stop it mmkay?</div>
    <div class="meta">Posted on 2005-09-02 23:37:44 by f0dder</div>
   </div>
   <div class="post" id="post-164122">
    <div class="subject"><a href="#post-164122">Re: ListView problems...</a></div>
    <div class="body">Hum... This is pretty weird... I&#39;m actually converting some C code to assembly and all those struct names were right in C...<br /><br />It compiles now, but no column is added to the list... I&#39;m posting my full code now:<br /><br /><pre><code>.386<br />.model flat,stdcall<br />option casemap:none<br /><br />DlgProc proto :DWORD,:DWORD,:DWORD,:DWORD<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\comctl32.inc <br /><br />includelib \masm32\lib\comctl32.lib <br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />.data<br />DlgName db &quot;IDD_MAIN&quot;,0<br />ListViewClass db &quot;SysListView32&quot;,0<br />Column1 db &quot;Process Name&quot;,0<br /><br />.data?<br />hInstance HINSTANCE ?<br />icc INITCOMMONCONTROLSEX &lt;&gt;<br /><br />.const<br />LIST1 equ 1<br /><br />.code<br />start:<br />&nbsp; &nbsp; invoke GetModuleHandle, NULL<br />&nbsp; &nbsp; mov&nbsp; &nbsp; hInstance,eax<br /><br />	invoke RtlZeroMemory, addr icc, sizeof icc<br />	mov&nbsp; &nbsp; icc.dwSize, sizeof icc<br />	mov&nbsp; &nbsp; icc.dwICC, ICC_LISTVIEW_CLASSES<br />	invoke InitCommonControlsEx, addr icc<br /><br />&nbsp; &nbsp; invoke DialogBoxParam, hInstance, ADDR DlgName,NULL, addr DlgProc, NULL<br />&nbsp; &nbsp; invoke ExitProcess,eax<br /><br />DlgProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />&nbsp; &nbsp; LOCAL hListView:HWND<br />&nbsp; &nbsp; LOCAL hListInst:HINSTANCE<br />&nbsp; &nbsp; LOCAL lvc:LVCOLUMN<br />&nbsp; &nbsp; invoke RtlZeroMemory, addr lvc, sizeof lvc<br />&nbsp; &nbsp;  <br />&nbsp; &nbsp; .IF uMsg==WM_INITDIALOG&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke CreateWindowEx,NULL,ADDR ListViewClass,NULL,WS_CHILD+WS_VISIBLE,22,\<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 65,350,285,hWnd,LIST1,hListInst,NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov hListView, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage,hListView,LVM_SETEXTENDEDLISTVIEWSTYLE,0,LVS_EX_FULLROWSELECT or LVS_EX_HEADERDRAGDROP<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.imask, LVCF_TEXT or LVCF_SUBITEM or LVCF_WIDTH or LVCF_FMT<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.fmt, LVCFMT_LEFT<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.iSubItem, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.lx, 105<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.pszText, offset Column1<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_INSERTCOLUMN, 0, addr lvc<br />&nbsp; &nbsp; .ELSEIF uMsg==WM_CLOSE<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke EndDialog,hWnd,NULL<br />&nbsp; &nbsp; .ELSE<br />&nbsp; &nbsp; &nbsp; &nbsp; mov eax,FALSE<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />&nbsp; &nbsp; .ENDIF<br />&nbsp; &nbsp; mov eax,TRUE<br />&nbsp; &nbsp; ret<br />DlgProc endp<br />end start</code></pre></div>
    <div class="meta">Posted on 2005-09-03 12:25:01 by Lenin</div>
   </div>
   <div class="post" id="post-164123">
    <div class="subject"><a href="#post-164123">Re: ListView problems...</a></div>
    <div class="body"><div class="quote"><br />Hum... This is pretty weird... I&#39;m actually converting some C code to assembly and all those struct names were right in C...<br /></div><br />MASM doesn&#39;t allow reserved words to be used as structure field names, so things like &quot;cx&quot; had to be changed...<br /></div>
    <div class="meta">Posted on 2005-09-03 12:38:03 by f0dder</div>
   </div>
   <div class="post" id="post-164160">
    <div class="subject"><a href="#post-164160">Re: ListView problems...</a></div>
    <div class="body">asm<br /><div class="quote"><br />.386<br />.model flat,stdcall<br />option casemap:none<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />DlgProc proto :DWORD,:DWORD,:DWORD,:DWORD<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\comctl32.inc <br /><br />includelib \masm32\lib\comctl32.lib <br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.data<br />	DlgName		db &quot;IDD_MAIN&quot;,0<br />	ListViewClass	db &quot;SysListView32&quot;,0<br />	Column1		db &quot;Process Name&quot;,0<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.data?<br />	hInstance	HINSTANCE ?<br />	icc		INITCOMMONCONTROLSEX &lt;&gt;<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.const<br />	D_MAIN	equ 1000<br />	LIST1	equ 1<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.code<br />start:<br />	invoke GetModuleHandle, NULL<br />	mov    hInstance,eax<br /><br />	invoke RtlZeroMemory, addr icc, sizeof icc<br />	mov    icc.dwSize, sizeof icc<br />	mov    icc.dwICC, ICC_LISTVIEW_CLASSES<br />	invoke InitCommonControlsEx, addr icc<br /><br />	invoke DialogBoxParam, hInstance, D_MAIN,NULL, offset DlgProc, NULL<br />	invoke ExitProcess,eax<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />DlgProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />	LOCAL hListView:HWND<br />	LOCAL hListInst:HINSTANCE<br />	LOCAL lvc:LV_COLUMN<br /><br />	invoke RtlZeroMemory, addr lvc, sizeof lvc<br />     <br />	.IF uMsg==WM_INITDIALOG        <br />		;invoke CreateWindowEx,NULL,ADDR ListViewClass,NULL,WS_CHILD+WS_VISIBLE,15,\<br />		;			15,200,100,hWnd,LIST1,hInstance,NULL<br />		invoke GetDlgItem, hWnd, LIST1<br />		mov hListView, eax<br />		invoke SendMessage,hListView,LVM_SETEXTENDEDLISTVIEWSTYLE,0,LVS_EX_FULLROWSELECT or LVS_EX_HEADERDRAGDROP<br /><br />		mov lvc.imask, LVCF_TEXT or LVCF_SUBITEM or LVCF_WIDTH or LVCF_FMT<br />		mov lvc.fmt, LVCFMT_LEFT<br /><br />		mov lvc.iSubItem, 0<br />		mov lvc.lx, 105<br />		mov lvc.pszText, offset Column1<br /><br />		invoke SendMessage, hListView, LVM_INSERTCOLUMN, 0, addr lvc<br /><br />	.ELSEIF uMsg==WM_CLOSE<br />		invoke EndDialog,hWnd,NULL<br />	.ELSE<br />		mov eax,FALSE<br />		ret<br />	.ENDIF<br />	mov eax,TRUE<br />	ret<br />DlgProc endp<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br /><br />end start<br /><br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</div><br /><br />rc<br /><div class="quote"><br />#include &quot;\masm32\include\resource.h&quot;<br /><br />#define D_MAIN 1000<br /><br />D_MAIN DIALOGEX 0,0,155,80<br />CAPTION &quot;listView&quot;<br />FONT 8,&quot;MS Sans Serif&quot;<br />STYLE 0x10c80800<br />EXSTYLE 0x00000000<br />BEGIN<br />  CONTROL &quot;List1&quot;,1,&quot;SysListView32&quot;,LVS_REPORT | WS_BORDER | WS_TABSTOP,8,8,140,65<br />END<br /></div></div>
    <div class="meta">Posted on 2005-09-04 00:59:34 by dcskm4200</div>
   </div>
   <div class="post" id="post-164190">
    <div class="subject"><a href="#post-164190">Re: ListView problems...</a></div>
    <div class="body">Oh thanks a lot :) Worked fine.</div>
    <div class="meta">Posted on 2005-09-04 12:13:47 by Lenin</div>
   </div>
   <div class="post" id="post-164196">
    <div class="subject"><a href="#post-164196">Re: ListView problems...</a></div>
    <div class="body">More problems... First let me tell you what Im trying to do... Im recreating my taskmanager, made in C, to assembly. Everything was fine until I had to recreate a while loop that inserted all the lists fields... See it for yourself:<br /><br />C version:<br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HANDLE hProcessSnap;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PROCESSENTRY32 pe32;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HWND hListView = GetDlgItem(hwnd, 500);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LVITEM lv = { 0 };<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hProcessSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (hProcessSnap == INVALID_HANDLE_VALUE)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; KillTimer(hwnd, TIMER1);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MessageBox(hwnd, TEXT(&quot;Dam CreateToolhelp32Snapshot!&quot;), TEXT(&quot;Error&quot;), <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MB_OK | MB_ICONEXCLAMATION);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pe32.dwSize = sizeof(PROCESSENTRY32);<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!Process32First(hProcessSnap, &amp;pe32))<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; KillTimer(hwnd, TIMER1);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CloseHandle(hProcessSnap);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MessageBox(hwnd, TEXT(&quot;Dam Process32First!&quot;), TEXT(&quot;Error&quot;), <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MB_OK | MB_ICONEXCLAMATION);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int mark = ListView_GetSelectionMark(hListView);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ListView_DeleteAllItems(hListView);<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unsigned int i = 0;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TCHAR pid[100];<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while(Process32Next(hProcessSnap, &amp;pe32))<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wsprintf(pid, TEXT(&quot;%lu&quot;), pe32.th32ProcessID);<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lv.iItem = i;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ListView_InsertItem(hListView, &amp;lv);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ListView_SetItemText(hListView, i, 0, pe32.szExeFile);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ListView_SetItemText(hListView, i, 1, TEXT(&quot;Test&quot;));<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ListView_SetItemText(hListView, i, 2, pid);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ListView_SetItemText(hListView, i, 3, TEXT(&quot;Test&quot;));<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i++;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CloseHandle(hProcessSnap);</code></pre><br /><br />ASM version:<br /><pre><code>&nbsp; &nbsp; &nbsp; &nbsp; invoke GetDlgItem, hWnd, LIST1&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov hListView, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke CreateToolhelp32Snapshot, TH32CS_SNAPPROCESS, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; mov hProcessSnap, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; cmp hProcessSnap, INVALID_HANDLE_VALUE<br />&nbsp; &nbsp; &nbsp; &nbsp; jz HandleError<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov pe32.dwSize, sizeof PROCESSENTRY32<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke Process32First, hProcessSnap, addr pe32<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; cmp eax, FALSE<br />&nbsp; &nbsp; &nbsp; &nbsp; jz Process32FirstError<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke RtlZeroMemory, addr lv, sizeof lv<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_DELETEALLITEMS, 0, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; xor ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; StartOfLoop:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke Process32Next, hProcessSnap, addr pe32<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax, FALSE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jz outofloop<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iItem, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_INSERTITEM, 0, addr lv<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_SETITEMTEXT, ecx, addr pe32.szExeFile<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_SETITEMTEXT, ecx, NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, 2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_SETITEMTEXT, ecx, NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, 3<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_SETITEMTEXT, ecx, NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp StartOfLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; outofloop:<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke CloseHandle, hProcessSnap<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; jmp finish<br />&nbsp; &nbsp; &nbsp; &nbsp; Process32FirstError:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke MessageBox, hWnd, addr err2, 0, MB_OK or MB_ICONEXCLAMATION<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke CloseHandle, hProcessSnap<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp finish<br />&nbsp; &nbsp; &nbsp; &nbsp; HandleError:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke MessageBox, hWnd, addr err1, 0, MB_OK or MB_ICONEXCLAMATION<br />&nbsp; &nbsp; &nbsp; &nbsp; finish:</code></pre><br /><br />Im really sorry for not being able to be more helpfull, but I really dont know where the error is...</div>
    <div class="meta">Posted on 2005-09-04 14:23:36 by Lenin</div>
   </div>
   <div class="post" id="post-164207">
    <div class="subject"><a href="#post-164207">Re: ListView problems...</a></div>
    <div class="body">Use edi/ebx/esi and preserve their values before using them.<br /><br />Your code is not working well because the values in ecx is probably destroyed when you call SendMessage.</div>
    <div class="meta">Posted on 2005-09-04 20:21:09 by roticv</div>
   </div>
   <div class="post" id="post-164213">
    <div class="subject"><a href="#post-164213">Re: ListView problems...</a></div>
    <div class="body">Tried this:<br /><br /><pre><code>&nbsp; &nbsp; &nbsp; &nbsp; push edi<br />&nbsp; &nbsp; &nbsp; &nbsp; xor edi, edi<br />&nbsp; &nbsp; &nbsp; &nbsp; StartOfLoop:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke Process32Next, hProcessSnap, addr pe32<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax, FALSE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jz outofloop<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iItem, edi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_INSERTITEM, 0, addr lv<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_SETITEMTEXT, edi, addr pe32.szExeFile<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_SETITEMTEXT, edi, NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, 2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_SETITEMTEXT, edi, NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, 3<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_SETITEMTEXT, edi, NULL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc edi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp StartOfLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; outofloop:<br />&nbsp; &nbsp; &nbsp; &nbsp; pop edi</code></pre><br /><br />But still no results...</div>
    <div class="meta">Posted on 2005-09-04 22:24:18 by Lenin</div>
   </div>
   <div class="post" id="post-164249">
    <div class="subject"><a href="#post-164249">Re: ListView problems...</a></div>
    <div class="body">Try this:<br /><br /><pre><code>        push edi<br />        xor edi, edi<br />        mov lv.iSubItem, edi<br />        mov lv.iItem, edi<br />        StartOfLoop:<br />            invoke Process32Next, hProcessSnap, addr pe32<br />            <br />            cmp eax, FALSE<br />            jz outofloop<br />            <br />            invoke SendMessage, hListView, LVM_INSERTITEM, 0, addr lv<br />            mov lv.iItem, edi<br />            <br />            mov lv.iSubItem, 0<br />            invoke SendMessage, hListView, LVM_SETITEMTEXT, edi, addr pe32.szExeFile<br />            <br />            mov lv.iSubItem, 1<br />            invoke SendMessage, hListView, LVM_SETITEMTEXT, edi, NULL<br />            <br />            mov lv.iSubItem, 2<br />            invoke SendMessage, hListView, LVM_SETITEMTEXT, edi, NULL<br />            <br />            mov lv.iSubItem, 3<br />            invoke SendMessage, hListView, LVM_SETITEMTEXT, edi, NULL<br />            <br />            inc edi<br />            jmp StartOfLoop<br />        outofloop:<br />        pop edi</code></pre><br /></div>
    <div class="meta">Posted on 2005-09-05 18:27:12 by QvasiModo</div>
   </div>
   <div class="post" id="post-164349">
    <div class="subject"><a href="#post-164349">Re: ListView problems...</a></div>
    <div class="body">Its still not working.... Really *ucking weird... I made a few changes to make my code look more like Iczelion&#39;s but still no results.<br /><br /><pre><code>.386<br />.model flat,stdcall<br />option casemap:none<br /><br />DlgProc proto :DWORD,:DWORD,:DWORD,:DWORD<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\user32.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\comctl32.inc <br /><br />includelib \masm32\lib\comctl32.lib <br />includelib \masm32\lib\user32.lib<br />includelib \masm32\lib\kernel32.lib<br /><br />.data<br />Column1 db &quot;Process Name&quot;,0<br />Column2 db &quot;User name&quot;,0<br />Column3 db &quot;PID&quot;,0<br />Column4 db &quot;Memory use&quot;,0<br />err1&nbsp; &nbsp; db &quot;Dam CreateToolhelp32Snapshot!&quot;,0<br />err2&nbsp; &nbsp; db &quot;Dam Process32First!&quot;,0<br /><br />.data?<br />hInstance HINSTANCE ?<br />icc INITCOMMONCONTROLSEX &lt;&gt;<br />hListView dd ?<br /><br />.const<br />D_MAIN&nbsp; &nbsp; equ 1000<br />LIST1&nbsp; &nbsp;  equ 1<br />WM_UPDATE equ WM_USER+100h<br /><br />.code<br />start:<br />&nbsp; &nbsp; invoke GetModuleHandle, NULL<br />&nbsp; &nbsp; mov&nbsp; &nbsp; hInstance,eax<br /><br />&nbsp; &nbsp; invoke RtlZeroMemory, addr icc, sizeof icc<br />&nbsp; &nbsp; mov&nbsp; &nbsp; icc.dwSize, sizeof icc<br />&nbsp; &nbsp; mov&nbsp; &nbsp; icc.dwICC, ICC_LISTVIEW_CLASSES<br />&nbsp; &nbsp; invoke InitCommonControlsEx, addr icc<br /><br />&nbsp; &nbsp; invoke DialogBoxParam, hInstance, D_MAIN, NULL, offset DlgProc, NULL<br />&nbsp; &nbsp; invoke ExitProcess,eax<br /><br />DlgProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />&nbsp; &nbsp; LOCAL lvc:LVCOLUMN<br />&nbsp; &nbsp; LOCAL hProcessSnap:HANDLE<br />&nbsp; &nbsp; LOCAL pe32:PROCESSENTRY32<br />&nbsp; &nbsp; LOCAL lv:LVITEM<br /><br />&nbsp; &nbsp; .IF uMsg==WM_INITDIALOG<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke GetDlgItem, hWnd, LIST1&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov hListView, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage,hListView,LVM_SETEXTENDEDLISTVIEWSTYLE,0,LVS_EX_FULLROWSELECT or LVS_EX_HEADERDRAGDROP<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke RtlZeroMemory, addr lvc, sizeof lvc<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.imask, LVCF_TEXT or LVCF_SUBITEM or LVCF_WIDTH or LVCF_FMT<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.fmt, LVCFMT_LEFT<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.iSubItem, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.lx, 105<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.pszText, offset Column1<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_INSERTCOLUMN, 0, addr lvc<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.iSubItem, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.lx, 90<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.pszText, offset Column2<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_INSERTCOLUMN, 1, addr lvc<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.iSubItem, 2<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.lx, 65<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.pszText, offset Column3<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_INSERTCOLUMN, 2, addr lvc<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.iSubItem, 3<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.lx, 87<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lvc.pszText, offset Column4<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_INSERTCOLUMN, 3, addr lvc<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hWnd, WM_UPDATE, 0, 0<br />&nbsp; &nbsp; .ELSEIF uMsg==WM_UPDATE<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke CreateToolhelp32Snapshot, TH32CS_SNAPPROCESS, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; mov hProcessSnap, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; cmp hProcessSnap, INVALID_HANDLE_VALUE<br />&nbsp; &nbsp; &nbsp; &nbsp; jz HandleError<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov pe32.dwSize, sizeof PROCESSENTRY32<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke Process32First, hProcessSnap, addr pe32<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; cmp eax, FALSE<br />&nbsp; &nbsp; &nbsp; &nbsp; jz Process32FirstError<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke RtlZeroMemory, addr lv, sizeof lv<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_DELETEALLITEMS, 0, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; push edi<br />&nbsp; &nbsp; &nbsp; &nbsp; xor edi, edi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, edi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov lv.iItem, edi<br />&nbsp; &nbsp; &nbsp; &nbsp; StartOfLoop:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke Process32Next, hProcessSnap, addr pe32<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp eax, FALSE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jz outofloop<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_INSERTITEM, 0, addr lv<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iItem, edi<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_SETITEMTEXT, edi, addr pe32.szExeFile<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_SETITEMTEXT, edi, NULL<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, 2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_SETITEMTEXT, edi, NULL<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov lv.iSubItem, 3<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke SendMessage, hListView, LVM_SETITEMTEXT, edi, NULL<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc edi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp StartOfLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; outofloop:<br />&nbsp; &nbsp; &nbsp; &nbsp; pop edi<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; invoke CloseHandle, hProcessSnap<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; jmp finish<br />&nbsp; &nbsp; &nbsp; &nbsp; Process32FirstError:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke MessageBox, hWnd, addr err2, 0, MB_OK or MB_ICONEXCLAMATION<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke CloseHandle, hProcessSnap<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp finish<br />&nbsp; &nbsp; &nbsp; &nbsp; HandleError:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; invoke MessageBox, hWnd, addr err1, 0, MB_OK or MB_ICONEXCLAMATION<br />&nbsp; &nbsp; &nbsp; &nbsp; finish:<br />&nbsp; &nbsp; .ELSEIF uMsg==WM_CLOSE<br />&nbsp; &nbsp; &nbsp; &nbsp; invoke EndDialog,hWnd,NULL<br />&nbsp; &nbsp; .ELSE<br />&nbsp; &nbsp; &nbsp; &nbsp; xor eax, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; ret<br />&nbsp; &nbsp; .ENDIF<br />&nbsp; &nbsp; mov eax,TRUE<br />&nbsp; &nbsp; ret<br />DlgProc endp<br />end start</code></pre></div>
    <div class="meta">Posted on 2005-09-07 14:17:57 by Lenin</div>
   </div>
  </div>
 </body>
</html>