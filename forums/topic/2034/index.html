<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>delete used files by windows - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=2034" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=2034">delete used files by windows</a></p>
   <div class="post" id="post-12973">
    <div class="subject"><a href="#post-12973">delete used files by windows</a></div>
    <div class="body">Hi,<br /><br />it's me again. when i want to delete a file (for example an exe that is running), windows tells me, that the file is in use and that it is not possible to delete it. but: is it possible by programming? would SHFileOperation do the job?<br /><br />cya,<br />nop</div>
    <div class="meta">Posted on 2001-11-25 07:01:08 by NOP-erator</div>
   </div>
   <div class="post" id="post-12980">
    <div class="subject"><a href="#post-12980">delete used files by windows</a></div>
    <div class="body">You could use &quot;wininit.ini&quot; or MovieFileEx with MOVEFILE_DELAY_UNTIL_REBOOT Flag. For some sample code, do a quick search at google.com :grin:</div>
    <div class="meta">Posted on 2001-11-25 09:50:44 by bazik</div>
   </div>
   <div class="post" id="post-12982">
    <div class="subject"><a href="#post-12982">no reboot</a></div>
    <div class="body">hi,<br /><br />thanks for the answer, but i don't want to reboot, just delete the file. i always thought, that if you start an exe file, it is completely loaded to memory, isn't it?<br /><br />bye,<br />nop</div>
    <div class="meta">Posted on 2001-11-25 11:16:58 by NOP-erator</div>
   </div>
   <div class="post" id="post-12988">
    <div class="subject"><a href="#post-12988">delete used files by windows</a></div>
    <div class="body">hiiiiiiiiii<br /><br />maybe this will help <br /><br /><br />goto <a target="_blank" href="http://www.anticracking.sk/EliCZ/export.htm">http://www.anticracking.sk/EliCZ/export.htm</a><br />check the file &quot;DeleteModule&quot;<br /><br /><br />bye<br /><br />eko</div>
    <div class="meta">Posted on 2001-11-25 12:18:50 by eko</div>
   </div>
   <div class="post" id="post-12996">
    <div class="subject"><a href="#post-12996">delete used files by windows</a></div>
    <div class="body">i think DeleteModule can delete only process that has run IT but U can tray to put that dll to other process memory and maybe you'll succsed:alright: <br /><br />cya</div>
    <div class="meta">Posted on 2001-11-25 14:47:24 by NEMO</div>
   </div>
   <div class="post" id="post-13005">
    <div class="subject"><a href="#post-13005">delete used files by windows</a></div>
    <div class="body">Forget deleting a running executable, even if it's your own. There<br />are various hacks, but none of them work on all win32 versions,<br />and it can end up pretty messily. No, an exe isn't necessarily loaded<br />100% to memory. And because of the way paging works, the file<br />is locked (that's also why you can't write to an in-mem exe).</div>
    <div class="meta">Posted on 2001-11-25 15:48:39 by f0dder</div>
   </div>
   <div class="post" id="post-13006">
    <div class="subject"><a href="#post-13006">delete used files by windows</a></div>
    <div class="body">NOP-erator,<br /><br />As far as I know, the only files that can delete themselves are batch files. To delete a file that is running means killing it first then deleting it.<br /><br />Regards,<br /><br /><a href="mailto:hutch@movsd.com">hutch@movsd.com</a></div>
    <div class="meta">Posted on 2001-11-25 15:48:52 by hutch--</div>
   </div>
   <div class="post" id="post-13008">
    <div class="subject"><a href="#post-13008">delete used files by windows</a></div>
    <div class="body">Well, there are various tricks. One of them involves pushing various<br />parameters + offsets of API calls to the stack, then doing a ret...<br />basically, it's for closing handles, unmapping file, etc. But it only<br />works under some versions of windows. Another one involves<br />creating a &quot;clone&quot; with FILE_FLAG_DELETE_ON_WRITE, spawn the<br />clone, terminate original process, delete original exe, and the clone<br />is *supposed* to be auto-deleted when it ends... never got that<br />working though. There are other even more messy methods. The<br />safest is to go for the batch file, or leave a tiny exe in the user temporary<br />file directory that performs original-file-deletion.</div>
    <div class="meta">Posted on 2001-11-25 15:55:26 by f0dder</div>
   </div>
   <div class="post" id="post-13023">
    <div class="subject"><a href="#post-13023">delete used files by windows</a></div>
    <div class="body">Yeah.. one of the various hacks are in MSDN.. Jeremy Richter or something like that wrote it.<br /><br />It injects a DLL into the processes memory to delete it or something. Works pretty good on my Win98 system.. never tried it anywhere else.<br /><br />Maybe someone can find it and post it</div>
    <div class="meta">Posted on 2001-11-25 19:35:52 by Torch</div>
   </div>
   <div class="post" id="post-13024">
    <div class="subject"><a href="#post-13024">delete used files by windows</a></div>
    <div class="body">Richters approach is not what I was talking about :). I'll see if I can<br />find the code snippet... it's pretty wacked.</div>
    <div class="meta">Posted on 2001-11-25 19:54:29 by f0dder</div>
   </div>
   <div class="post" id="post-13036">
    <div class="subject"><a href="#post-13036">delete used files by windows</a></div>
    <div class="body">ritcher's methods:<br /><br /><a target="_blank" href="http://www.microsoft.com/msj/archive/sf9ca.htm#fig2">injection method</a><br /><a target="_blank" href="http://www.microsoft.com/msj/0198/win32textfigs.htm#fig1">FILE_FLAG_DELETE_ON_CLOSE method</a></div>
    <div class="meta">Posted on 2001-11-26 01:33:53 by cynix</div>
   </div>
   <div class="post" id="post-13039">
    <div class="subject"><a href="#post-13039">delete used files by windows</a></div>
    <div class="body">I've ported the FILE_FLAG_DELETE_ON_CLOSE method to asm, but on my win2k system the temporary file is not deleted..<br />Please test it on your own system and see if it works.<br /><br />Thomas</div>
    <div class="meta">Posted on 2001-11-26 02:59:02 by Thomas</div>
   </div>
   <div class="post" id="post-13061">
    <div class="subject"><a href="#post-13061">delete used files by windows</a></div>
    <div class="body">Thomas, I've messed around with it too, and it did not work (didn't<br />try your method, but I'm pretty sure it's the same). I played around<br />with a few variations of it... some of them leaves the original file<br />on the disk, some of them leave the clone file. Argh :/. So, I say<br />again, all these methods work on some windows versions, but I have<br />yet to see something that works on all versions... and isn't an extremely<br />ugly hack.</div>
    <div class="meta">Posted on 2001-11-26 06:17:20 by f0dder</div>
   </div>
   <div class="post" id="post-13109">
    <div class="subject"><a href="#post-13109">thanks</a></div>
    <div class="body">Hi,<br /><br />thank you for all the good answers, but: i never wanted to delete MY exe, i would like to delete ANOTHER exe that is running, or other files that are open.... Can't i just &quot;kill&quot; them somehow?<br /><br />bye,<br /><br />nop</div>
    <div class="meta">Posted on 2001-11-26 11:52:25 by NOP-erator</div>
   </div>
   <div class="post" id="post-13114">
    <div class="subject"><a href="#post-13114">delete used files by windows</a></div>
    <div class="body">Well, &quot;another exe&quot; has the same fundamental problem... it's running,<br />so the file is mapped. If you use TerminateProcess, you should be<br />able to delete the file, but then you're faced with the trouble of<br />hunting down all processes using the .exe. Toolhelp32 will perhaps<br />help you there.</div>
    <div class="meta">Posted on 2001-11-26 12:10:34 by f0dder</div>
   </div>
  </div>
 </body>
</html>