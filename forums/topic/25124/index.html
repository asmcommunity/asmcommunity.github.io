<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Urgent: expression evaluator needed! - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=25124" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=25124">Urgent: expression evaluator needed!</a></p>
   <div class="post" id="post-183976">
    <div class="subject"><a href="#post-183976">Urgent: expression evaluator needed!</a></div>
    <div class="body">Hello.&nbsp;  I urgently need a program in assembler, for a x86, in Linux.<br />The program has to do the following:<br />- Read from the keyboard a function of x.&nbsp; Example: &quot;x+2-x^3*9&quot;<br />&nbsp; *) The function has to be in the form of dododod (d=digit [0-9], 0=operator [+,-,*,/,^]),<br />&nbsp; *) Therefore, it does not admit 2 operators or 2 digits together (like &quot;12^-x&quot;),<br />&nbsp; *) No error handling needed, it is assumed that the entered values are correct<br />- Read from the keyboard the value of x. Example: &quot;1&quot;<br />- Show the result of the function with that value of x (in the example it would be &quot;-6&quot;)<br /><br />I&#39;m really newby to assembler programming so I would really preciate if someone could give me a hand &quot;for the love of the game&quot;.<br /><br />Best regards!</div>
    <div class="meta">Posted on 2006-07-24 16:40:56 by Anixandro</div>
   </div>
   <div class="post" id="post-183978">
    <div class="subject"><a href="#post-183978">Re: Urgent: expression evaluator needed!</a></div>
    <div class="body">Please read the community <a target="_blank" href="http://www.asmcommunity.net/board/index.php?topic=20825.0">rules</a>. This is not _we_do_your_homework_ forum. </div>
    <div class="meta">Posted on 2006-07-24 16:49:04 by arafel</div>
   </div>
   <div class="post" id="post-183983">
    <div class="subject"><a href="#post-183983">Re: Urgent: expression evaluator needed!</a></div>
    <div class="body"><div class="quote"><br />I&#39;m really newby to assembler programming so I would really preciate if someone could give me a hand &quot;for the love of the game&quot;.<br /></div><br /><br />You have to ask a question before we can attempt to help you. Also, you have to be a little more specific than just laying out your requirements.<br /><br />Now, I have a few questions for you.<br /><br />1) How much of the source is &quot;complete&quot;???<br />2) Which part&#39;s&#39; are you having trouble with???<br />3) Why the urgency if you are &quot;new to assembly language&quot;???</div>
    <div class="meta">Posted on 2006-07-24 19:57:48 by SpooK</div>
   </div>
   <div class="post" id="post-183984">
    <div class="subject"><a href="#post-183984">Re: Urgent: expression evaluator needed!</a></div>
    <div class="body">Sorry about that, I was not familiarized with the rules since I&#39;m new to the forum.<br /><br />Let me reformulate the question then:<br />Does anyone have an example or a piece of code that can help me or lead me to the solution?<br /><br />Any help will be appreciated.</div>
    <div class="meta">Posted on 2006-07-24 20:14:14 by Anixandro</div>
   </div>
   <div class="post" id="post-183986">
    <div class="subject"><a href="#post-183986">Re: Urgent: expression evaluator needed!</a></div>
    <div class="body">1) How much of the source is &quot;complete&quot;???<br />What i have is what follows:<br /><br /><pre><code><br />.data<br />&nbsp; &nbsp; function: .string &quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &quot;<br />&nbsp; &nbsp; valx: .int 0<br />&nbsp; &nbsp; t_int: .string &quot;%d&quot;<br />&nbsp; &nbsp; t_str: .string &quot;%s&quot;<br />&nbsp; &nbsp; title1: .string &quot;Enter the function: &quot;<br />&nbsp; &nbsp; title2: .string &quot;Enter the value of x: &quot;<br />&nbsp; &nbsp; linefeed: .string &quot;\n&quot;<br />.text<br />&nbsp; &nbsp; .global main<br />main:<br />&nbsp; &nbsp; pushl $title1&nbsp;  #push in the stack the first title<br />&nbsp; &nbsp; pushl $t_str&nbsp; &nbsp; #push in the stack the type of value<br />&nbsp; &nbsp; call printf&nbsp; &nbsp; &nbsp;  #print the output<br />&nbsp; &nbsp; addl $8,%esp&nbsp; #clear the stack<br /><br />&nbsp; &nbsp; movl $3,%eax<br />&nbsp; &nbsp; int $0x80&nbsp; &nbsp; &nbsp; &nbsp;  #call the interupt for printing<br /><br />&nbsp; &nbsp; pushl $function #push in the stack the function variable<br />&nbsp; &nbsp; pushl $t_str&nbsp; &nbsp; &nbsp; #push in the stack the type of value<br />&nbsp; &nbsp; call scanf&nbsp; &nbsp; &nbsp; &nbsp;  #read the input<br />&nbsp; &nbsp; addl $8,%esp&nbsp; &nbsp; #clear the stack<br /><br />&nbsp; &nbsp; pushl $title2&nbsp; &nbsp;  #push in the stack the second title<br />&nbsp; &nbsp; pushl $t_str&nbsp; &nbsp;  #push in the stack the type of value<br />&nbsp; &nbsp; call printf&nbsp; &nbsp; &nbsp; &nbsp; #print the output<br />&nbsp; &nbsp; addl $8,%esp&nbsp;  #clear the stack<br /><br />&nbsp; &nbsp; movl $3,%eax<br />&nbsp; &nbsp; int $0x80&nbsp; &nbsp; &nbsp; &nbsp;  #call the interrupt for printing<br /><br />&nbsp; &nbsp; pushl $valx&nbsp; &nbsp; &nbsp;  #push in the stack the receiving variable<br />&nbsp; &nbsp; pushl $t_int&nbsp; &nbsp; &nbsp; #push in the stack the data type<br />&nbsp; &nbsp; call scanf&nbsp; &nbsp; &nbsp; &nbsp;  #read the input<br />&nbsp; &nbsp; addl $8,%esp&nbsp; &nbsp; #clear the stack<br /><br />&nbsp; &nbsp; pushl $linefeed&nbsp; #push in the stack the string of linefeed<br />&nbsp; &nbsp; pushl $t_str&nbsp; &nbsp; &nbsp; #push in the stack the data type<br />&nbsp; &nbsp; call printf&nbsp; &nbsp; &nbsp; &nbsp;  #print the linefeed<br />&nbsp; &nbsp; addl $8,%esp&nbsp;  #clear the stack<br /><br />&nbsp; &nbsp; movl $3,%eax<br />&nbsp; &nbsp; int $0x80&nbsp; &nbsp; &nbsp; &nbsp;  #call the interruption for printing<br /><br />&nbsp; &nbsp; ret<br />&nbsp; &nbsp; #this is the section where I want to parse char by char the input stored in the &quot;function&quot; variable, but I don&#39;t <br />&nbsp; &nbsp; #know how.&nbsp; Then I would have to calculate the result of the function and show the output.&nbsp; <br /></code></pre><br /><br />2) Which part&#39;s&#39; are you having trouble with???<br />I&#39;m having trouble parsing the string of the formula input.&nbsp; I can&#39;t find the way to read character by character the string, to put the operands and the operators in a stack for the calculations.&nbsp; As you can see, I&#39;m using AT&amp;T notation and what I&#39;m doing to compile the code is the following, in Red Hat:<br />&nbsp;  *) Open a terminal<br />&nbsp;  *) Go to the folder which contains the code<br />&nbsp;  *) Execute the next command &quot;gcc -o  &quot;<br /><br />3) Why the urgency if you are &quot;new to assembly language&quot;???<br />The urgency is that my teacher is kinda crazy.&nbsp; He believes in the investigative capabilities of his students to solve any problem he can think of, while he does not have a clue of the assembly language.&nbsp; I&#39;m in summer so the period of classes is really short and he gave us a week to get the project done.<br /><br />Thanks in advance.</div>
    <div class="meta">Posted on 2006-07-24 20:36:48 by Anixandro</div>
   </div>
   <div class="post" id="post-183989">
    <div class="subject"><a href="#post-183989">Re: Urgent: expression evaluator needed!</a></div>
    <div class="body">Well.., there are plenty of algorithms for making an expression evaluator. Here is one of the simplest approaches:<br />(assuming the conditions you have stated are preserved)<br /><br />1) Get the expression (for example x+2-x^3*9).<br />2) Get the value of &#39;x&#39;.<br />3) Construct new expression by converting any ASCII representation of a digit to it&#39;s binary form. Replace any occurrence of &#39;x&#39; with appropriate value.<br /><br />So from x+2-x^3*9 you will get something like this (hexadecimal representation):<br />00000001 + 00000002 - 00000001 ^ 00000003 * 00000009<br /><br />4) Search for operator with a higher mathematical precedence.<br />5) Apply the operation on the nearby digits.<br />6) Reconstruct the expression.<br />7) Repeat last three steps<br /><br />E.g.:<br />00000001 + 00000002 - 00000001 ^ 00000003 * 00000009<br />00000001 + 00000002 - 00000001 * 00000009<br />00000001 + 00000002 - 00000009<br />00000003 - 00000009<br />FFFFFFFA<br /><br /><br /><div class="quote"><br />The urgency is that my teacher is kinda crazy.Â¦nbsp;<br /></div><br /><br />He surely is. Teaching AT&amp;T syntax.... eeeewww! </div>
    <div class="meta">Posted on 2006-07-24 21:37:55 by arafel</div>
   </div>
   <div class="post" id="post-183990">
    <div class="subject"><a href="#post-183990">Re: Urgent: expression evaluator needed!</a></div>
    <div class="body">I do know the step by step algorithm, the codification is what I&#39;m struglin with.&nbsp; Haven&#39;t advanced much... how do I get the first digit from the function?</div>
    <div class="meta">Posted on 2006-07-24 22:24:56 by Anixandro</div>
   </div>
   <div class="post" id="post-183991">
    <div class="subject"><a href="#post-183991">Re: Urgent: expression evaluator needed!</a></div>
    <div class="body">By the way, Intel notation would be great too.</div>
    <div class="meta">Posted on 2006-07-24 23:00:51 by Anixandro</div>
   </div>
   <div class="post" id="post-183996">
    <div class="subject"><a href="#post-183996">Re: Urgent: expression evaluator needed!</a></div>
    <div class="body">There is nothing really to &quot;codify&quot;, as the resultant string returned from <em>scanf</em> should be in ASCII format.<br /><br />arafel touched upon the fact that you have to convert &quot;any ASCII representation of a digit to it&#39;s binary form&quot;, so this would be your next step.<br /><br />Personally, for a simple project like this that requires no error-checking, I would go for a counter mechanism...<br /><br /><pre><code><br />;!!!!!NASM syntax!!!!!<br /><br />;Parse the function input<br />&nbsp; &nbsp; mov ebx,DWORD function ;ASSUMED TO BE ALIGNED TO AN &quot;EVEN&quot; ADDRESS<br />&nbsp; &nbsp; mov al,BYTE<br />&nbsp; &nbsp; cmp al,0<br />&nbsp; &nbsp; jnz continue_parsing<br />&nbsp; &nbsp; ret ;reached the string &quot;null terminator&quot; (\0)... so return/exit<br /><br />;Test if EBX is odd (operation) or even (digit)<br />continue_parsing:<br />&nbsp; &nbsp; test bl,1&nbsp; ;Test if EBX is odd or even<br />&nbsp; &nbsp; jnz process_operation ;Even = Process a &quot;Digit&quot;, Odd = process an &quot;Operation&quot;<br /><br />process_digit:<br />;todo: check for ASCII byte value between 30h-39h<br />;&nbsp;  Yes-&gt; Subtract 30h from the byte value, and use for later<br />;&nbsp;  No-&gt; Fail/Exit (no error handling)<br /><br />process_operation:<br />;todo: check for ASCII values of &quot;+-*/^...&quot; in order (like a switch statement)<br />;&nbsp;  Found-&gt; Process that operation into an &quot;order of operation&quot; list<br />;&nbsp;  Not Found -&gt; Fail/Exit (no error handling)<br /><br />inc ebx<br />jmp parse<br /></code></pre><br /><br />Note that EBX *should* be BYTE aligned and hence on an &quot;even address&quot;. So each &quot;Digit&quot; should be on an even BYTE address (<strong>d</strong>o<strong>d</strong>o<strong>d</strong>o)... and each &quot;Operation&quot; should be on an odd BYTE address (d<strong>o</strong>d<strong>o</strong>d<strong>o</strong>).<br /><br />Just fill in the blanks with your own ideas on how to process ASCII code and the &quot;order of operations&quot; list.<br /><br />Another thing I noticed with your code, is the unnecessary use of &quot;pushl $t_str&quot; in your <em>printf</em> routines. The strings are already in &quot;%s&quot; format (ASCII text with a null-terminator), so there is no need to add this extra step. You *do* need it for <em>scanf</em> though, as that is how the function defines the input.</div>
    <div class="meta">Posted on 2006-07-25 01:21:37 by SpooK</div>
   </div>
   <div class="post" id="post-184005">
    <div class="subject"><a href="#post-184005">Re: Urgent: expression evaluator needed!</a></div>
    <div class="body">Hello, guess what? I decided to move to Intel syntaxis.<br />I have the following code:<br /><br /><pre><code><br /><br />&nbsp; &nbsp; title1:&nbsp; &nbsp; db &#39;Enter the function: &#39;,10<br />&nbsp; &nbsp; title1Len equ $-title1<br /><br /><br />&nbsp; &nbsp; global main<br /><br />main:<br />&nbsp; &nbsp; mov eax, 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #system output<br />&nbsp; &nbsp; mov ebx, 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #standard output<br />&nbsp; &nbsp; mov ecx, title1&nbsp; &nbsp;  #variable to print<br />&nbsp; &nbsp; mov edx, title1Len #length to print<br />&nbsp; &nbsp; int 80h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #system interrupt<br /><br />&nbsp; &nbsp; mov eax, 3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #system input<br />&nbsp; &nbsp; mov ebx, 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #standard input<br />&nbsp; &nbsp; mov ecx, function #variable to receive the input<br />&nbsp; &nbsp; mov edx, 25&nbsp; &nbsp; &nbsp; &nbsp; #max length to receive<br />&nbsp; &nbsp; int 80h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #system interrupt<br /><br />&nbsp; &nbsp; mov eax, &nbsp; &nbsp; #store in eax the first digit<br />&nbsp; &nbsp; mov ebx,  #store in ebx the second digit<br />&nbsp; &nbsp; add eax, ebx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #add the two digits<br /><br />&nbsp; &nbsp; mov , eax&nbsp; &nbsp; #store the result in &#39;digit&#39; variable<br /><br />&nbsp; &nbsp; mov eax, 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #system output<br />&nbsp; &nbsp; mov ebx, 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #standard output<br />&nbsp; &nbsp; mov ecx, digit&nbsp; &nbsp; &nbsp; #variable to print<br />&nbsp; &nbsp; mov edx, 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #length to print<br />&nbsp; &nbsp; int 80h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #system interrupt<br /><br />&nbsp; &nbsp; mov eax, 1&nbsp; #finalitation of the program<br />&nbsp; &nbsp; mov ebx, 0&nbsp; #finalitation of the program<br />&nbsp; &nbsp; int 80h&nbsp; &nbsp; &nbsp;  #finalitation of the program<br /><br />&nbsp; &nbsp; ret<br /><br /><br />&nbsp; &nbsp; function resb 25<br />&nbsp; &nbsp; function resb 1<br /></code></pre><br /><br />As you can see, I want to display the result of adding the first two digits entered in the function (just for testing purposes, in the main problem you aren&#39;t supposed to enter a digit followed by another).&nbsp; The problem is that when I enter in the function &quot;12&quot;, it is displaying a &quot;c&quot; as te result of the sum (1+2=third letter from the alphabet -&gt; c); when I enter &quot;23&quot;, it is displaying an &quot;e&quot; as the result of the sum; etc etc.&nbsp; What am I doing wrong? What do I have to change to display the correct value?</div>
    <div class="meta">Posted on 2006-07-25 17:01:22 by Anixandro</div>
   </div>
   <div class="post" id="post-184006">
    <div class="subject"><a href="#post-184006">Re: Urgent: expression evaluator needed!</a></div>
    <div class="body">Please study an <a target="_blank" href="http://jimprice.com/jim-asc.htm"><u>ASCII Chart</u></a> to understand what you are working with. You are confusing a string representation of a digit (ASCII) with a binary representation that a computer uses for mathematical operations.<br /><br />If you notice the chart from the link above, &#39;1&#39;(31h) + &#39;2&#39;(32h) = &#39;c&#39;(63h). As well as &#39;2&#39;(32h) + &#39;3&#39;(33h) = &#39;e&#39;(65h).<br /><br />This means you are not converting the ASCII Characters to Binary before performing mathematical operations, which was mentioned multiple times.<br /><br />If you checked for a value between 30h and 39h (valid ASCII representation of numbers 0 through 9), and then subtracted 30h from that value... it would give you the converted binary number you need (i.e. &#39;1&#39;(31h) - &quot;ASCII Digit Base&quot;(30h) = 1(01h) ). In order to <em>printf</em> that number, you would simply add <em>%i</em> to the string (and the accompanying variable), and <em>printf</em> will automatically convert that Binary Digit 3(03h)/5(05h) back to an ASCII representation &#39;3&#39;(33h)/&#39;5&#39;(35h).<br /><br />In short, you <strong>*really*</strong> need to study the differences between ASCII and Binary... or you will not make your deadline.<br /><br />In order to help you on your way, I will post a generic &quot;quick fix&quot; (no error checking or optimization) of your code, study it until it &quot;clicks&quot;...<br /><br /><pre><code><br /><br />&nbsp; &nbsp; mov al, BYTE&nbsp; &nbsp; &nbsp; #store in al the first digit (ASCII = 1 Byte)<br />&nbsp; &nbsp; mov ah, BYTE&nbsp; &nbsp; #store in ah the second digit (ASCII = 1 Byte)<br />&nbsp; &nbsp; sub al, 30h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #convert the first ASCII digit to Binary form<br />&nbsp; &nbsp; sub ah, 30h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #convert the second ASCII digit to Binary form<br />&nbsp; &nbsp; add al,ah&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #add the two digits<br /><br />&nbsp; &nbsp; mov BYTE,al&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #store the result in &#39;digit&#39; variable<br /><br /></code></pre></div>
    <div class="meta">Posted on 2006-07-25 18:20:19 by SpooK</div>
   </div>
  </div>
 </body>
</html>