<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>How is my line parse algo? - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=8793" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=8793">How is my line parse algo?</a></p>
   <div class="post" id="post-64629">
    <div class="subject"><a href="#post-64629">How is my line parse algo?</a></div>
    <div class="body">I am having soooo much fun with assembly!  How is this code?  I modified some code from here to read a file line by line and extract my fields (kinda like a CSV).  Anyway to tweak it?  Had problems at first cause everything in my struct was dwords (showed me garbage till I chaneged most to bytes) got excited I finally gotten it to work, gonna go get a few Coronas....<br /><br />Each line in the file has 9 fileds:<br />Any Image?FMJ-Software\Any Image?0???LastDirs.?0??????<br />Architag XRay XML Editor?VB and VBA Program Settings\Architag XRay XML Editor\RecentFiles?0???file?0??????<br />ASFRecorder?ASFRecorder\RecentURLList?2???URL?0??????<br /><br /><pre><code><br />Structure&#58;<br />MRUSTUFF        STRUCT<br />	DisplayName    BYTE    100 dup &#40;?&#41;<br />	MRUPath          BYTE    MAX_PATH dup &#40;?&#41;<br />	ParseType        DWORD   ?<br />	SectionName    BYTE    100 dup &#40;?&#41;<br />	ValueName       BYTE    100 dup &#40;?&#41;<br />	ValueBase        DWORD   ?<br />	Count               BYTE    100 dup &#40;?&#41;<br />	DataType         BYTE    2 dup &#40;?&#41;<br />	ExeName          BYTE    MAX_PATH dup &#40;?&#41;<br />MRUSTUFF ends<br /><br />.data?<br />MRUInfo             MRUSTUFF &lt;&gt;<br /><br /><br />        ; Parse file line by line and extract between commas    <br />        push esi<br />        push edi<br />        mov     esi, hTempBuf ;buffer returned from HeapAlloc<br /><br />        DisplayName&#58;<br />            lea     edi, offset MRUInfo.DisplayName<br />        @@&#58;<br />            mov     al, byte ptr &#91;esi&#93;<br />            inc     esi<br />            cmp     al, '?'<br />            je      MRUPath     <br />            mov     byte ptr &#91;edi&#93;, al<br />            inc     edi<br />            jmp     @B<br />            <br />        MRUPath&#58;<br />            mov     byte ptr &#91;edi&#93;, NULL<br />            lea     edi, offset MRUInfo.MRUPath            <br />        @@&#58;            <br />            mov     al, byte ptr &#91;esi&#93;<br />            inc     esi<br />            cmp     al, '?'<br />            je      ParseType<br />            mov     byte ptr &#91;edi&#93;, al<br />            inc     edi<br />            jmp     @B<br />        <br />        ParseType&#58;<br />            mov     byte ptr &#91;edi&#93;, NULL<br />            lea     edi, offset MRUInfo.ParseType<br />        @@&#58;<br />            mov     al, byte ptr &#91;esi&#93;<br />            inc     esi<br />            cmp     al, '?'<br />            je      SectionName<br />            mov     byte ptr &#91;edi&#93;, al<br />            inc     edi<br />            jmp     @B<br />            <br />        SectionName&#58;<br />            lea     edi, offset MRUInfo.SectionName<br />        @@&#58;<br />            mov     al, byte ptr &#91;esi&#93;<br />            inc     esi<br />            cmp     al, '?'<br />            je      ValueName<br />            mov     byte ptr &#91;edi&#93;, al<br />            inc     edi<br />            jmp     @B<br /><br />        ValueName&#58;<br />            mov     byte ptr &#91;edi&#93;, NULL           <br />            lea     edi, offset MRUInfo.ValueName<br />        @@&#58;<br />            mov     al, byte ptr &#91;esi&#93;<br />            inc     esi<br />            cmp     al, '?'<br />            je      ValueBase<br />            mov     byte ptr &#91;edi&#93;, al<br />            inc     edi<br />            jmp     @B<br /><br />        ValueBase&#58;<br />            mov     byte ptr &#91;edi&#93;, NULL            <br />            lea     edi, offset MRUInfo.ValueBase<br />        @@&#58;<br />            mov     al, byte ptr &#91;esi&#93;<br />            inc     esi<br />            cmp     al, '?'<br />            je      Count<br />            mov     byte ptr &#91;edi&#93;, al<br />            inc     edi<br />            jmp     @B<br /><br />        Count&#58;<br />            lea     edi,offset  MRUInfo.Count<br />        @@&#58;<br />            mov     al, byte ptr &#91;esi&#93;<br />            inc     esi<br />            cmp     al, '?'<br />            je      DataType<br />            mov     byte ptr &#91;edi&#93;, al<br />            inc     edi<br />            jmp     @B<br /><br />        DataType&#58;<br />            mov     byte ptr &#91;edi&#93;, NULL            <br />            lea     edi, offset MRUInfo.DataType<br />        @@&#58;<br />            mov     al, byte ptr &#91;esi&#93;<br />            inc     esi<br />            cmp     al, '?'<br />            je      ExeName<br />            mov     byte ptr &#91;edi&#93;, al<br />            inc     edi<br />            jmp     @B<br /><br />        ExeName&#58;<br />            mov     byte ptr &#91;edi&#93;, NULL            <br />            lea     edi, offset MRUInfo.ExeName<br />        @@&#58;<br />            mov     al, byte ptr &#91;esi&#93;<br />            inc     esi<br />            cmp     al, 0DH ; CR<br />            je      NewLine<br />            cmp     al, NULL<br />            je      Done<br />            mov     byte ptr &#91;edi&#93;, al<br />            inc     edi<br />            jmp     @B<br />            <br />        NewLine&#58;<br />            ; add items to listview here<br />            add     esi, 1<br />            PrintStringByAddr  offset MRUInfo.DisplayName<br />            PrintStringByAddr  offset MRUInfo.MRUPath<br />            PrintStringByAddr  offset MRUInfo.ParseType<br />            PrintStringByAddr  offset MRUInfo.SectionName<br />            PrintStringByAddr  offset MRUInfo.ValueName<br />            PrintStringByAddr  offset MRUInfo.ValueBase<br />            PrintStringByAddr  offset MRUInfo.Count<br />            PrintStringByAddr  offset MRUInfo.DataType<br />            PrintStringByAddr  offset MRUInfo.ExeName<br />            PrintLine<br />            jmp     DisplayName<br />            <br />        Done&#58;      <br />            ; add last line to listview here<br />            PrintStringByAddr  offset MRUInfo.DisplayName<br />            PrintStringByAddr  offset MRUInfo.MRUPath<br />            PrintStringByAddr  offset MRUInfo.ParseType<br />            PrintStringByAddr  offset MRUInfo.SectionName<br />            PrintStringByAddr  offset MRUInfo.ValueName<br />            PrintStringByAddr  offset MRUInfo.ValueBase<br />            PrintStringByAddr  offset MRUInfo.Count<br />            PrintStringByAddr  offset MRUInfo.DataType<br />            PrintStringByAddr  offset MRUInfo.ExeName            <br />            pop edi<br />            pop esi<br /><br />        ; Free memory for temporary buffer<br />        invoke  HeapFree, hHeap, NULL, addr hTempBuf<br /></code></pre><br /><br />So, what I have here is basically the same as a do/while loop in VB?  <br />I will get this damn VB proggie converted sooner or later:-)<br /><br />Thanks</div>
    <div class="meta">Posted on 2002-11-04 19:33:42 by Gunner</div>
   </div>
   <div class="post" id="post-64634">
    <div class="subject"><a href="#post-64634">How is my line parse algo?</a></div>
    <div class="body">You might want to go here, peel and see a Basic parser done in asm  :grin: :<br /><br /><a target="_blank" href="http://hitchhikr.multimania.com">http://hitchhikr.multimania.com</a><br /><br /><br />cheers,<br /><br />h.</div>
    <div class="meta">Posted on 2002-11-04 20:11:56 by hitchhikr</div>
   </div>
  </div>
 </body>
</html>