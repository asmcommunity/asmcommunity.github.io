<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>complex number library - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=14214" />
    <link rel="next" href="../?id=14214&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=14214">complex number library</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=14214&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=14214&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="14214" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=14214&amp;page=2">&gt;</a><a href="../?id=14214&amp;page=3">&raquo;</a></form>   <div class="post" id="post-109969">
    <div class="subject"><a href="#post-109969">complex number library</a></div>
    <div class="body">Hi, i'm writing (in fact wrote) a complex number library with masm.<br />It uses five global temporary variables: zt1, zt2, .. zt5:complex<br />The type complex is defined as <br /><pre><code>complex STRUCT<br />	r REAL10 ?<br />	i REAL10 ?<br />complex ends</code></pre><br /><br />And macros:<br /><pre><code>fldt MACRO value<br />	fld tbyte ptr &#91;value&#93;<br />ENDM<br /><br />fstpt MACRO value<br />	fstp tbyte ptr &#91;value&#93;<br />endm</code></pre><br /><br />CMul &amp; CDiv follows<br /><br /><pre><code><br />CMul proc z1&#58;complex,z2&#58;complex,zret&#58;complex<br />	fldt z1.r<br />	fldt z2.r<br />	fmulp st&#40;1&#41;,st<br />	fldt z1.i<br />	fldt z2.i<br />	fmulp st&#40;1&#41;,st<br />	fsubp st&#40;1&#41;,st<br />	fstpt zret.r<br />	<br />	fldt z1.r<br />	fldt z2.i<br />	fmulp st&#40;1&#41;,st<br />	fldt z1.i<br />	fldt z2.r<br />	fmulp st&#40;1&#41;,st<br />	faddp st&#40;1&#41;,st<br />	fstpt zret.i	<br /><br />	ret<br />CMul endp<br /><br />CDiv proc z1&#58;complex, z2&#58;complex, zret&#58;complex<br />	fldt z2.i<br />	fchs<br />	fstpt z2.i<br />---&gt;	invoke CMul,z1,z2,zt1<br />	fldt z2.i<br />	fchs<br />	fstpt z2.i<br />	fldt z2.i<br />	fmul st,st<br />	fldt z2.r<br />	fmul st,st<br />	faddp st&#40;1&#41;,st<br /><br />---&gt;	fldt zt1.r<br />	fdiv st,st&#40;1&#41;<br />	fstpt zret.r<br />---&gt;	fldt zt1.i<br />	fdiv st,st&#40;1&#41;<br />	fstpt zt1.i<br />	ret<br />CDiv endp<br /></code></pre><br /><br />Now here is my question:<br />CMul works ok<br />in CDiv invoke CMul returns true<br />But in fldt zt1.x it loades every time zero.<br /><br />To test i used:<br /><pre><code>&#40;pseudocode&#41;<br />z1.r=3<br />z1.i=0<br />z2.r=4<br />z2.i=0<br />z3 is empty<br />invoke CDiv,z1,z2,z3<br /></code></pre><br />again, CMul's result is 12.0 but when accessing from CDiv(fldt zt1.r) it's 0.0 :mad: <br />Algo's should be true, i converted them from VB which i coded a complex number lib. before.<br />And i'm very new to masm, is there a hot spot to make this work? or sthg different?</div>
    <div class="meta">Posted on 2003-07-10 10:09:49 by inFinie</div>
   </div>
   <div class="post" id="post-109992">
    <div class="subject"><a href="#post-109992">complex number library</a></div>
    <div class="body">Your mistake is simple:  confusing &quot;call by reference&quot; and &quot;call by value&quot;.  When you call CMul, zt1 is passed by value, i.e. CMul receives a copy of zt1 on stack. When you thought you returned the computed result in zt1, you actually saved the result on the stack without modifying zt1.<br /><br />One solution is:  Revise your CMul (and CDiv) to use &quot;call by reference&quot; for the return value struct.</div>
    <div class="meta">Posted on 2003-07-10 14:00:12 by Starless</div>
   </div>
   <div class="post" id="post-110002">
    <div class="subject"><a href="#post-110002">complex number library</a></div>
    <div class="body">like what?<br />an example please?</div>
    <div class="meta">Posted on 2003-07-10 15:15:00 by inFinie</div>
   </div>
   <div class="post" id="post-110110">
    <div class="subject"><a href="#post-110110">complex number library</a></div>
    <div class="body">In Visual BASIC, when you pass a variable to a function, the function works directly on that variable. Instead, in ASM, you pass a COPY of that variable, located in the stack. So if you want you function to change the variable itself, you must pass a pointer to it...<br /><br /><pre><code><br />Sample proc lpvar&#58;DWORD<br />  mov eax,lpvar<br />  mov &#91;eax&#93;,value<br />  ret<br />Sample endp<br /></code></pre><br /><br />And called like this:<br /><br />invoke Sample,addr myvar<br /><br />So &quot;Sample&quot; takes the address in memory of &quot;myvar&quot; variable from &quot;lpvar&quot; in the stack, and uses it as a pointer. &quot;myvar&quot; can be located elsewhere, not necessarily on the stack.</div>
    <div class="meta">Posted on 2003-07-11 10:59:33 by QvasiModo</div>
   </div>
   <div class="post" id="post-110746">
    <div class="subject"><a href="#post-110746">complex number library</a></div>
    <div class="body">I tried and tried and know frustrated :mad: <br />Source is attached, it is semi-working with OllyDbg i can see that right operations are done, but it does not return by value. I couldn't make it work. Any help is appreciated.<br />By the way, i use RadASM:</div>
    <div class="meta">Posted on 2003-07-16 11:08:05 by inFinie</div>
   </div>
   <div class="post" id="post-110823">
    <div class="subject"><a href="#post-110823">complex number library</a></div>
    <div class="body">I dont have your FPU.INC / LIB ?? So i couldnt compile it. <br /><br />But anyways, i looked at your source and make my changes to it.  In short your getting into trouble using the Mul proc.  Way to messy using temp complex storage areas just to call a short proc.  Instead i suggest just &quot;code on through&quot; ;)<br /><br />This is what i have done.  I didnt test it, but it should work.  I made efforst to comment it as well.  Basically im calculating the factor 1/(A^2 + B^2) of the divisor. Stacking it twice, and then running through a &quot;backwards&quot; multiplication (as defined by your Mul proc).  Since you need to change the sign, i just changed the add to subtract and vice versa on the latter parts.  This way you dont need any temp workings..  and is not much longer than what you had to start ;)<br /><br /><pre><code>CDiv proc z1&#58;complex, z2&#58;complex, zret&#58;complex<br />   <br />   ;z1 = &#40;A + jB&#41;  z2 = &#40;C + jD&#41; zret = &#40;E + jF&#41;<br /><br />   ; Makes 1/&#40; A^2 + B^2&#41; on stack 0, and 1 positions &#40;Stacked Factor&#41;<br />   fld1<br />   fldt z2.i<br />   fld st&#40;0&#41;            ; st&#40;0&#41; = st&#40;1&#41; = z2.i ; st&#40;2&#41; = 1.0<br />   fmulp st&#40;1&#41;, st      ; st&#40;0&#41; = Imag^2 ; st&#40;1&#41; = 1.0<br />   fldt z2.r<br />   fld st&#40;0&#41;<br />   fmulp st&#40;1&#41;, st      ; st&#40;0&#41; = Real^2 ; st&#40;1&#41; = imag^2 ; st&#40;2&#41; = 1.0<br />   fadd                 ; st&#40;0&#41; = Real^2 + Imag^2 ; st&#40;1&#41; = 1.0<br />   fdiv                 ; st&#40;0&#41; = 1/R2 + I2<br />   fld st&#40;0&#41;            ; st&#40;1&#41; = st&#40;0&#41; = 1/&#40;r2.r^2 + r2.i^2&#41;<br /><br />   ; Makes &#40;A*C + B*D&#41;*stack'd factor = E<br />   fldt z1.r            ; <br />   fldt z2.r<br />   fmulp st&#40;1&#41;,st<br />   fldt z1.i<br />   fldt z2.i<br />   fmulp st&#40;1&#41;,st<br />   faddp st&#40;1&#41;,st<br />   fmul                 ; Uses the first stacked factor<br />   fstpt zret.r<br />   <br />   ; Makes &#40;C*B - D*A&#41;*Stacked factor = F<br />   fldt z1.i<br />   fldt z2.r<br />   fmulp st&#40;1&#41;,st<br />   fldt z1.r<br />   fldt z2.i<br />   fmulp st&#40;1&#41;,st<br />   fsubp st&#40;1&#41;,st<br />   fmul                 ; Uses the second stacke factor<br />   fstpt zret.i<br />   <br />   ret<br />CDiv endp</code></pre><br /><br />Hope you like...<br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2003-07-16 18:40:04 by NaN</div>
   </div>
   <div class="post" id="post-110825">
    <div class="subject"><a href="#post-110825">complex number library</a></div>
    <div class="body">By the way, i suggest you expand your structure definition to include weather or not the data in the structure is in rectangular or polar forms.  <pre><code>complex STRUCT<br />	r REAL10 ?<br />	i REAL10 ?<br />	Polar dd ?<br />complex ends</code></pre><br /><br />This way a programmer can test the data, and see if its rectangular or not (complex.Polar = FALSE/TRUE )<br /><br />:NaN:</div>
    <div class="meta">Posted on 2003-07-16 18:46:43 by NaN</div>
   </div>
   <div class="post" id="post-110868">
    <div class="subject"><a href="#post-110868">complex number library</a></div>
    <div class="body">FPULIB is the masm32 fpulib, it is attached and should be in your masm dir.<br /><br />Your code works correctly, but it has the same problem. Doesn't save the answer in z3:mad: <br />If this problem won't be eliminated then non of the Trig funcs and derivatives won't work and that's too bad. <br />NaN:Thanks for your help.<br />And you commented the FPU code it's really hard work.<br /><br />Instead of expanding the struct, i may use another struct pcomplex as polar just to avoid checking if Polar is equal to ...<br /><br />And two procs, polar to rect, rect to polar seems to me more handy</div>
    <div class="meta">Posted on 2003-07-17 04:39:41 by inFinie</div>
   </div>
   <div class="post" id="post-110903">
    <div class="subject"><a href="#post-110903">complex number library</a></div>
    <div class="body">I had a cursory look at your source code. You have done a tremendous amount of work up to now. However, you will have to concentrate on understanding the purpose and meaning of passed parameters to procedures before your code can work properly. For example:<br /><pre><code>CMov proc z1&#58;complex, z2&#58;complex<br />	<br />	fldt z2.r<br />	fstpt z1.r<br />	fldt z2.i<br />	fstpt z1.i<br />	ret<br /><br />CMov endp</code></pre><br />That procedure reserves space on the stack for two complex STRUC. It then loads whatever value it finds on the stack at the z2.r location (as a REAL10 according to your fldt macro) and stores it on the stack at the z1.r location (as a REAL10 according to your fstpt macro). Same with the .i values.<br /><br />You then destroy the stack frame when you exit that procedure, effectively &quot;destroying&quot; the stored values. Nothing has been stored in the data section.<br /><br />That procedure for example would probably work correctly as a MACRO instead of a procedure if you must insist using STRUC syntax. It can work as a procedure if you pass the addresses of the structures but you would not be able to use the struc syntax in references to struc items.<br /><pre><code>CMov proc lpz1&#58;DWORD,lpz2&#58;DWORD<br />   mov eax,lpz2<br />   mov edx,lpz1<br />   fldt eax     ;the R item from z2<br />   fstpt edx    ;the R item to z1<br />   fldt eax+10  ;the I item from z2<br />   fstpt edx+10 ;the I item to z1<br />   ret<br />CMov endp</code></pre><br />Similarly, all your procedures reserve space on the stack where you store the results of your computations, and then destroy those results as you return from the procedures.<br /><br />Your project is interesting. Additional help is definitly available.<br /><br />BTW the second parameter for the FpuFLtoA function should be the number of decimal places required in the result. the 80 which you used would be replaced by the default maximum of 15 for the scientific notation.<br />Then, in your CtoStr procedure, the address passed to the FpuFLtoA function would be the address of the space reserved on the stack for a complex struc which may only contain garbage at that point. Probably the same with your use of other Fpulib functions.<br /><br />Raymond</div>
    <div class="meta">Posted on 2003-07-17 12:10:25 by Raymond</div>
   </div>
   <div class="post" id="post-110912">
    <div class="subject"><a href="#post-110912">complex number library</a></div>
    <div class="body"><div class="quote"><br />That procedure for example would probably work correctly as a MACRO instead of a procedure if you must insist using STRUC syntax. It can work as a procedure if you pass the addresses of the structures but you would not be able to use the struc syntax in references to struc items.</div><br />I don't understand... wouldn't this work?<br /><pre><code><br />CMov proc lpz1&#58;DWORD,lpz2&#58;DWORD<br />   mov eax,lpz2<br />   mov edx,lpz1<br />   assume eax&#58;ptr complex<br />   assume edx&#58;ptr complex<br />   fldt eax.R<br />   fstpt edx.R<br />   fldt eax.I<br />   fstpt edx.I<br />   assume eax&#58;nothing<br />   assume edx&#58;nothing<br />   ret<br />CMov endp<br /></code></pre></div>
    <div class="meta">Posted on 2003-07-17 13:28:36 by QvasiModo</div>
   </div>
   <div class="post" id="post-110927">
    <div class="subject"><a href="#post-110927">complex number library</a></div>
    <div class="body">I strongly believe in the KISS principle. <br /><br />Why complicate simple things? The STRUC in this particular case simply contains two REAL10 variables. (Using a STRUC in this case could be assimilated to the use of a macro to declare a variable with two REAL10 components).<br /><br />Whether you refer to those components as var and var+10 instead of var.r and var.i would perform exactly the same function (without any significant difference in the total amount of typing). Therefore no need for &quot;ASSUMEs&quot; and &quot;UNASSUMEs&quot; throughout the source code with always the possibility of forgetting one. (Plus all that useless extra typing for no constructive purpose.)<br /><br />Raymond</div>
    <div class="meta">Posted on 2003-07-17 15:16:45 by Raymond</div>
   </div>
   <div class="post" id="post-110931">
    <div class="subject"><a href="#post-110931">complex number library</a></div>
    <div class="body">I disagree. There *is* a good reason to use pointers to structs: if you try to access them calculating offsets, and later you decide to change the struct members, you'll have to change several parts of your source code... with always the possibility of forgetting one :grin:<br /><br />Besides, there is a way to use pointers to structures without assumes:<br /><br />(SOME_STRUCT ptr ).structMember<br /><br />You have to type a lot more, but I think it's a good programming practice.</div>
    <div class="meta">Posted on 2003-07-17 16:07:03 by QvasiModo</div>
   </div>
   <div class="post" id="post-110943">
    <div class="subject"><a href="#post-110943">complex number library</a></div>
    <div class="body">QvasiModo is right here.  You can even go &quot;Mov eax, Complex.i&quot; and EAX will hold 4!<br /><br />However, Raymond obviously spotted what i overlooked.  (Feel dumb for missing that).  the params should clearly be pointers if he expects a return.<br /><br />InFnie, your arguments are &quot;in only&quot; arguments.  Meaning you can pass in data to a function, but you can not pass data back.  This is because for the following function<pre><code><br />CMov PROC r1&#58;COMPLEX, r2&#58;COMPLEX<br /> &#91;... stuff here .. &#93;<br /> ret<br />CMov ENDP</code></pre><br />And a program calles it like so:<pre><code>.data<br />  r1  COMPLEX &lt;&gt;<br />  r2  COMPLEX &lt;&gt;<br />  <br />.code<br />   mov r1.r, 4<br />   mov r1.i, 3<br />   mov r2.r, 40<br />   mov r2.i, 30<br />   invoke CMov, r1, r2<br /></code></pre><br />The compiled program would end up as:<pre><code><br />   mov r1.r, 4<br />   mov r1.i, 3<br />   mov r2.r, 40<br />   mov r2.i, 30<br />   push r2.i<br />   push r2.r<br />   push r1.i<br />   push r2.r<br />   call CMove<br />   add esp, 16</code></pre>The fact that the stack is cleaned up by adding 16 to it (4 * 4byte pushes) means the 'returned' data your trying to pass back gets thrown in the garbage the moment it returns from the call.  THIS is considered &quot;passing by value&quot; or &quot;in only&quot; function calling.<br /><br />To get around this, you can pass &quot;in only&quot; a pointer.  And modify your function to use the pointer to get more data in, or write data out.  This style of argument is considered &quot;passing by reference&quot;, since the pointer is a reference in memory as to where you can find and write back information to.<br /><br />In your case something like this will work:<pre><code>CMov proc z1&#58;DWORD, z2&#58;DWORD  ; Note all pointers are 32 bits long<br /><br />   ; Get data pointed to in memory<br />   mov edx, z1<br />   mov eax, &#91;edx&#93;.Complex.r<br />   <br />   ; Set data pointed to in memory<br />   mov edx, z3<br />   mov &#91;edx&#93;.Complex.r, eax<br />   <br />   ret<br />CMov endp</code></pre><br /><br />And your program would set up for the function like so:<pre><code>.data<br />  r1  COMPLEX &lt;&gt;<br />  r2  COMPLEX &lt;&gt;<br />  <br />.code<br />   mov r1.r, 4<br />   mov r1.i, 3<br />   mov r2.r, 40<br />   mov r2.i, 30<br />   invoke CMov, addr r1, addr r2</code></pre><br /><br />To help understand, when compiled your source would turn into the following before calling CMov:<pre><code>   mov r1.r, 4<br />   mov r1.i, 3<br />   mov r2.r, 40<br />   mov r2.i, 30<br />   lea eax, r2<br />   push eax<br />   lea eax, r1<br />   push eax<br />   call CMove<br />   add esp, 8</code></pre><br /><br />We dont care if the pointer gets trashed afterwards, because the function has already gone directly to the memory at &quot;r1&quot; and &quot;r2&quot; and did its business!  This is the essence of pass by reference.  Pass by value is good too, since you dont need to fuss with pointers, but you can only expect data back in a register (eax, ebx, etc).  Pass by reference allows for both in this case ;)<br /><br />Lastly, there is nothing stopping you from mixing the two.  Ie, one argument takes a pointer for returning information, and the next takes a value for &quot;in only&quot; processing.  Most API's are this way, like GetWindowText.  It takes &quot;in only&quot; the window handle, and then asks for a memory pointer, so it can &quot;write out&quot; the text found in the window to you buffer (which you pointed to).<br /><br />I hope i have expanded upon this enough for you to understand.<br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2003-07-17 18:02:12 by NaN</div>
   </div>
   <div class="post" id="post-110958">
    <div class="subject"><a href="#post-110958">complex number library</a></div>
    <div class="body">QvasiModo,<br />Please don't take me wrong. I do agree there is a place for strucs. <br />However, for this specific example, there is a set of variables containing only two members each which are not bound to change - ever. It could easily be programmed without the use of strucs and potentially avoid a lot of confusion.<br /><br />inFinie,<br />I had tried to run your program and was getting only the ERROR string as a result. That may be why I assumed (wrongly) that you were feeding garbage to the FpuFLtoA function.<br /><br />I fiddled a bit with your code and got the CAdd, CSub and CMul procs to work properly and realized that your use of the FpuFLtoA function is correct (except for the specified number of decimal places). <br /><br />As a side note, you must initialize your buffer with a 0 byte before you concatinate strings into it. Secondly, you should not automaticly insert a &quot;+&quot; sign if the imaginary portion is negative. Finally, the size of the edit control for the result in the dialog box is insufficient for 15 decimal places. <br /><br />I tried to fiddle with the code for the CDiv proc but something seems wrong. You don't seem to store the imaginary result as in the other procs.<br /><br />Here's the fiddling I did with the test proc and the CAdd, CSub and CMul procs.<br /><pre><code>CTest proc<br />LOCAL z1&#58;complex,z2&#58;complex,z3&#58;complex<br />	invoke GetDlgItemText,hWnd,1001,ADDR buf,256<br />	invoke FpuAtoFL, ADDR buf, ADDR z1.r, DEST_MEM<br />	invoke GetDlgItemText,hWnd,1002,addr buf,256<br />	invoke FpuAtoFL, ADDR buf, ADDR z1.i, DEST_MEM<br />	invoke GetDlgItemText,hWnd,1003,addr buf,256<br />	invoke FpuAtoFL, ADDR buf, ADDR z2.r, DEST_MEM<br />	invoke GetDlgItemText,hWnd,1004,addr buf,256<br />	invoke FpuAtoFL, ADDR buf, ADDR z2.i, DEST_MEM<br />invoke CAdd, z1, z2, addr z3<br />invoke CtoStr,z3, addr buf<br />invoke SetDlgItemText,hWnd,1005,addr buf<br />	ret<br />CTest endp<br /><br />CAdd proc z1&#58;complex,z2&#58;complex,zret&#58;DWORD<br />        mov  eax,zret<br />	fldt z1.r<br />	fldt z2.r<br />	faddp st&#40;1&#41;,st<br />	fstpt eax<br />	<br />	fldt z1.i<br />	fldt z2.i<br />	faddp st&#40;1&#41;,st<br />	fstpt eax+10<br />	ret<br />CAdd endp<br /><br />CSub proc z1&#58;complex, z2&#58;complex,zret&#58;DWORD<br />        mov   eax,zret<br />	fldt z1.r<br />	fldt z2.r<br />	fsubp st&#40;1&#41;,st<br />	fstpt eax<br />	<br />	fldt z1.i<br />	fldt z2.i<br />	fsubp st&#40;1&#41;,st<br />	fstpt eax+10<br />	ret<br />CSub endp<br /><br />CMul proc z1&#58;complex,z2&#58;complex,zret&#58;DWORD<br />        mov   eax,zret<br />	fldt z1.r<br />	fldt z2.r<br />	fmulp st&#40;1&#41;,st<br />	fldt z1.i<br />	fldt z2.i<br />	fmulp st&#40;1&#41;,st<br />	fsubp st&#40;1&#41;,st<br />	fstpt eax<br />	<br />	fldt z1.r<br />	fldt z2.i<br />	fmulp st&#40;1&#41;,st<br />	fldt z1.i<br />	fldt z2.r<br />	fmulp st&#40;1&#41;,st<br />	faddp st&#40;1&#41;,st<br />	fstpt eax+10<br />	ret<br />CMul endp</code></pre><br />Raymond</div>
    <div class="meta">Posted on 2003-07-17 21:02:29 by Raymond</div>
   </div>
   <div class="post" id="post-110984">
    <div class="subject"><a href="#post-110984">complex number library</a></div>
    <div class="body">Thank you for your help. It works now! I'll make the other proc's work soon.<br />The 80 char in FPU funcs.: I used it to see what is there after 15~16 chars<br />CtoStr: It is programmed not to put '+' before '-' but it didn't worked, (early stages). I thought it is wrongly programmed, but it is from 'referencing'<br /><br /><br />Is 15 decimal places is what can i get for high precision?(in FPU not mmx,sse... i don't know them, yet)</div>
    <div class="meta">Posted on 2003-07-18 02:19:56 by inFinie</div>
   </div>
   <div class="post" id="post-110988">
    <div class="subject"><a href="#post-110988">complex number library</a></div>
    <div class="body">OK, i have finished doing it (zret to eax and add mov eax,zret)<br />It's attached<br />But CRecip is not working i.e. not returning i see when i debug it does computations truly. It seems like the same problem. Again thanks to all.<br />Note that CLog is very lousy.<br /><br />Edit: oops, i forgot to attach:grin: Hey can't i attach to this post? It seems not.</div>
    <div class="meta">Posted on 2003-07-18 02:52:16 by inFinie</div>
   </div>
   <div class="post" id="post-110990">
    <div class="subject"><a href="#post-110990">complex number library</a></div>
    <div class="body">Complexis:eek:</div>
    <div class="meta">Posted on 2003-07-18 02:59:18 by inFinie</div>
   </div>
   <div class="post" id="post-111026">
    <div class="subject"><a href="#post-111026">complex number library</a></div>
    <div class="body">The 80-bit extended precision (REAL10) format of the FPU data registers has a 64-bit mantissa which is equivalent to 18-19 significant decimal digits. That is the maximum precision available from normal use of the FPU.<br /><br />The packed Binary Coded Decimal (BCD) format used by the FPU to help convert to/from decimal/binary has a maximum of 18 decimal digits, the least significant one not always rounded. The FpuFLtoA function was limited to 16 decimal digits for simplicity (1 integer digit + 15 decimal places maximum for the scientific notation).<br /><br />Raymond</div>
    <div class="meta">Posted on 2003-07-18 08:12:50 by Raymond</div>
   </div>
   <div class="post" id="post-111028">
    <div class="subject"><a href="#post-111028">complex number library</a></div>
    <div class="body"><div class="quote"><br />However, Raymond obviously spotted what i overlooked.  (Feel dumb for missing that).  the params should clearly be pointers if he expects a return.</div><br /><br />Great, I've posted before to tell the same thing to inFinie, and then I forget it myself. Embarrasing. :o <br />I'll just crawl back under my rock now, never mind me....<br />:stupid:</div>
    <div class="meta">Posted on 2003-07-18 09:19:57 by QvasiModo</div>
   </div>
   <div class="post" id="post-111067">
    <div class="subject"><a href="#post-111067">complex number library</a></div>
    <div class="body">inFinie, re your latest Complexis,<br /><br />Whenever you pass parameters, you must always ask yourself if it is the address of the data which is needed or the actual value of that data. This may get confusing when that data IS an address such as in your CRecip proc calling the CDiv proc. In that case, you don't want to pass the address of that address (although it could be handled correctly with the proper code).<br /><br />It may have been less confusing if your original approach had been to pass only addresses to the various procedures instead of copying the actual data over and over and over again on the stack.<br /><br />As for the display of the result, you don't have to rezero the entire buffer. All you have to do is rezero the first byte before the concatination as follows:<br /><pre><code>      mov   eax,s1<br />      mov   byte ptr &#91;eax&#93;,0</code></pre><br />You will also have to adjust the jumps (and add one) correctly to display the proper sign. You should also allow the display of a +0i in the complex answer.<br /><br />Raymond<br /><br />BTW, is one of the ultimate purposes of this library related to fractals?</div>
    <div class="meta">Posted on 2003-07-18 14:34:47 by Raymond</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=14214&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=14214&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="14214" /><input type="number" name="page" min="1" max="3" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=14214&amp;page=2">&gt;</a><a href="../?id=14214&amp;page=3">&raquo;</a></form>  </div>
 </body>
</html>