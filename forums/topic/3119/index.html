<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>listview color question - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=3119" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=3119">listview color question</a></p>
   <div class="post" id="post-20488">
    <div class="subject"><a href="#post-20488">listview color question</a></div>
    <div class="body">my goal is to change the the background color of only one listview subitems. i also still need to be able to see the text in the listview too.  here is what i got but i dont know what to do next or what im doing wrong.<br /><br /><pre><code>.586<br />.model flat, stdcall<br /> option casemap &#58;none<br />      <br />      include       \masm32\include\windows.inc<br />      include       \masm32\include\kernel32.inc<br />      include       \masm32\include\user32.inc<br />      include       \masm32\include\comctl32.inc<br />      include       \masm32\include\gdi32.inc<br /><br />      includelib    \masm32\lib\kernel32.lib<br />      includelib    \masm32\lib\user32.lib<br />      includelib    \masm32\lib\comctl32.lib<br />      includelib    \masm32\lib\gdi32.lib <br /><br />      <br />      WinMain       PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />      WndProc       PROTO &#58;DWORD,&#58;DWORD,&#58;DWORD,&#58;DWORD<br />      TopXY         PROTO &#58;DWORD,&#58;DWORD<br /><br />InsertColumn MACRO handle,txt,width<br />      LOCAL lbl<br />      LOCAL strng<br />      jmp lbl<br />      strng db txt,0<br />  lbl&#58;<br />      mov col.imask,LVCF_TEXT or LVCF_WIDTH<br />      mov col.fmt,0<br />      mov col.lx,width<br />      mov col.pszText,offset strng<br />      invoke lstrlen,offset strng<br />      mov col.cchTextMax,eax<br />      invoke SendMessage,handle,LVM_INSERTCOLUMN,0,addr col<br />ENDM<br />      <br />.data<br />      ClassName     db &quot;Starting Template&quot;,0<br />      CaptionText   db &quot;Adding an item and subitems to a listview&quot;,0<br />      LvClassName   db &quot;SysListView32&quot;,0<br />      text1         db &quot;item 1&quot;,0<br />      text2         db &quot;subitem 1&quot;,0<br />      text3         db &quot;subitem 2&quot;,0<br />      text4         db &quot;subtiem 3&quot;,0<br />      <br />.const<br />      LVM_GETSUBITEMRECT equ LVM_FIRST + 56 <br />       <br />.data?<br />      hWnd          HANDLE   ?<br />      hInstance     HANDLE   ?<br />      hListView     HANDLE   ?<br />      col           LVCOLUMN &lt;&gt;<br />      item          LVITEM   &lt;&gt;<br />      hdc           HDC       ?<br />      ps            PAINTSTRUCT &lt;&gt;<br />      rect          RECT &lt;&gt;<br /><br />.code<br /> start&#58;<br />      invoke GetModuleHandle, NULL<br />      mov hInstance, eax<br />      invoke WinMain,hInstance,NULL,NULL,SW_SHOWDEFAULT<br />      invoke ExitProcess,eax<br />      invoke InitCommonControls<br /><br />; ########################################################################<br /><br />WinMain proc hInst     &#58;DWORD,<br />             hPrevInst &#58;DWORD,<br />             CmdLine   &#58;DWORD,<br />             CmdShow   &#58;DWORD<br /><br />      ;====================<br />      ; Put LOCALs on stack<br />      ;====================<br /><br />      LOCAL  wc   &#58;WNDCLASSEX<br />      LOCAL  msg  &#58;MSG<br />      LOCAL  Wwd  &#58;DWORD<br />      LOCAL  Wht  &#58;DWORD<br />      LOCAL  Wtx  &#58;DWORD<br />      LOCAL  Wty  &#58;DWORD<br /><br />      ;==================================================<br />      ; Fill WNDCLASSEX structure with required variables<br />      ;==================================================<br /><br />         mov    wc.cbSize,       SIZEOF WNDCLASSEX<br />	 mov    wc.style,        CS_HREDRAW + CS_VREDRAW<br />	 mov    wc.lpfnWndProc,  OFFSET WndProc<br />	 mov    wc.cbClsExtra,   NULL<br />	 mov    wc.cbWndExtra,   NULL<br />	 mov    eax,             hInstance<br />	 mov    wc.hInstance,    eax<br />         invoke LoadIcon,        NULL,IDI_APPLICATION<br />	 mov    wc.hIcon,        eax<br />	 mov    wc.hIconSm,      eax<br />	 invoke LoadCursor,      NULL,IDC_ARROW<br />	 mov    wc.hCursor,      eax<br />	 mov    wc.hbrBackground,COLOR_BTNFACE+1<br />	 mov    wc.lpszMenuName, NULL<br />	 mov    wc.lpszClassName,OFFSET ClassName<br /><br /><br />	 invoke RegisterClassEx, addr wc<br /><br />      ;================================<br />      ; Centre window at following size<br />      ;================================<br /><br />      mov    Wwd, 500<br />      mov    Wht, 350<br /><br />      invoke GetSystemMetrics,SM_CXSCREEN<br />      invoke TopXY,Wwd,eax<br />      mov    Wtx, eax<br /><br />      invoke GetSystemMetrics,SM_CYSCREEN<br />      invoke TopXY,Wht,eax<br />      mov    Wty, eax<br /><br />      invoke CreateWindowEx,NULL,<br />     			    ADDR ClassName,<br />     			    ADDR CaptionText,<br />     			    WS_OVERLAPPEDWINDOW,<br />     			    Wtx,Wty,Wwd,Wht,<br />     			    NULL,<br />     			    NULL,<br />     			    hInst,<br />     			    NULL<br />      mov    hWnd,eax<br /><br />      invoke ShowWindow,hWnd,SW_SHOWNORMAL<br />      invoke UpdateWindow,hWnd<br /><br />      ;===================================<br />      ; Loop until PostQuitMessage is sent<br />      ;===================================<br /><br />    StartLoop&#58;<br />      invoke GetMessage,ADDR msg,NULL,0,0<br />      cmp eax, 0<br />      je ExitLoop<br />      invoke TranslateMessage, ADDR msg<br />      invoke DispatchMessage,  ADDR msg<br />      jmp StartLoop<br />    ExitLoop&#58;<br /><br />	mov     eax,msg.wParam<br />	ret<br /><br />WinMain endp<br /><br />; ########################################################################<br /><br />WndProc proc hWin    &#58;HWND,<br />			     uMsg    &#58;UINT,<br />             wParam  &#58;WPARAM,<br />             lParam  &#58;LPARAM<br /><br />.IF uMsg==WM_DESTROY<br />		invoke PostQuitMessage,NULL<br /><br />.ELSEIF uMsg==WM_CREATE<br /><br />      invoke CreateWindowEx,NULL,<br />     			     ADDR LvClassName,<br />     			     NULL,<br />     			     WS_CHILD + WS_VISIBLE + LVS_REPORT,<br />     			     0,0,491,250,<br />     			     hWin,<br />     			     NULL,<br />     			     hInstance,<br />     			     NULL<br />      mov    hListView,eax<br /><br />      invoke SendMessage,hListView,LVM_SETEXTENDEDLISTVIEWSTYLE,0,LVS_EX_GRIDLINES<br /><br />      InsertColumn hListView, &quot;Column 4&quot; ,122<br />      InsertColumn hListView, &quot;Column 3&quot; ,122<br />      InsertColumn hListView, &quot;Column 2&quot; ,122<br />      InsertColumn hListView, &quot;Column 1&quot; ,122<br />      <br />      mov item.imask,LVIF_TEXT<br />      mov item.pszText,offset text1<br />      mov item.cchTextMax,sizeof text1<br />      invoke SendMessage,hListView,LVM_INSERTITEM,0,addr item<br />      <br />      mov item.imask,LVIF_TEXT<br />      mov item.iSubItem,1      <br />      mov item.pszText,offset text2<br />      mov item.cchTextMax,sizeof text2<br />      invoke SendMessage,hListView,LVM_SETITEM,0,addr item<br />      <br />      mov item.imask,LVIF_TEXT<br />      mov item.iSubItem,2      <br />      mov item.pszText,offset text3<br />      mov item.cchTextMax,sizeof text3<br />      invoke SendMessage,hListView,LVM_SETITEM,0,addr item<br />      <br />      mov item.imask,LVIF_TEXT<br />      mov item.iSubItem,3      <br />      mov item.pszText,offset text4<br />      mov item.cchTextMax,sizeof text4<br />      invoke SendMessage,hListView,LVM_SETITEM,0,addr item<br />      <br /><br />      <br />.ELSEIF uMsg == WM_PAINT<br /><br />      ;invoke BeginPaint,hWin,addr ps<br />      invoke GetDC,hWin<br />      mov hdc,eax<br />      mov rect.left,LVIR_BOUNDS<br />      mov rect.top,1 <br />      invoke SendMessage,hListView,LVM_GETSUBITEMRECT,0,addr rect<br />      invoke CreateSolidBrush,220<br />      invoke FillRect,hdc,addr rect,eax<br />      invoke ReleaseDC,hWin,hdc<br />      ;invoke EndPaint,hdc,addr ps<br /><br />.ELSE<br />      invoke DefWindowProc,hWin,uMsg,wParam,lParam<br />      ret<br /><br />.ENDIF<br />      xor eax,eax<br />      ret<br /><br />WndProc endp<br /><br /><br />; ########################################################################<br /><br />TopXY proc wDim&#58;DWORD, sDim&#58;DWORD<br /><br />    shr sDim, 1<br />    shr wDim, 1<br />    mov eax, wDim<br />    sub sDim, eax<br />    mov eax,sDim<br />    ret<br /><br />TopXY endp<br /><br />; #########################################################################<br /><br />end start</code></pre></div>
    <div class="meta">Posted on 2002-01-22 17:22:29 by smurf</div>
   </div>
   <div class="post" id="post-20698">
    <div class="subject"><a href="#post-20698">listview color question</a></div>
    <div class="body">smurf,<br /><br />Maybe, that's what you are looking for.<br /><br /><br />Guy</div>
    <div class="meta">Posted on 2002-01-23 14:03:55 by Guy</div>
   </div>
   <div class="post" id="post-20703">
    <div class="subject"><a href="#post-20703">listview color question</a></div>
    <div class="body">wow nice work. thats exactly what i was looking for. :alright:</div>
    <div class="meta">Posted on 2002-01-23 14:27:51 by smurf</div>
   </div>
   <div class="post" id="post-20761">
    <div class="subject"><a href="#post-20761">listview color question</a></div>
    <div class="body">after making some changes to the code you supplied i came apon a few lines i didnt understand what they are doing:<br /><pre><code>.elseif uMsg==WM_NOTIFY<br />   mov edi,lParam                                    ;move info into edi<br />   assume edi&#58;ptr NMHDR                              ;make edi point to the NMHDR structure<br />   mov eax,&#91;edi&#93;.hwndFrom                            ;move the identifier of the common control into eax<br />      .if eax==hListView                             ;if its the listview continue<br />         .if &#91;edi&#93;.code == NM_CUSTOMDRAW             ;check to see if the code is NM_CUSTOMDRAW<br />            assume edi&#58;ptr NMLVCUSTOMDRAW            ;make edi point to the NMLVCUSTOMDRAW structure<br />            <br />               .if  &#91;edi&#93;.iSubItem == 0              ;at item 0 set the colors below<br />                  RGB 95,158,160<br />                  mov &#91;edi&#93;.clrTextBk,eax<br />                  RGB 255,255,255<br />                  mov &#91;edi&#93;.clrText,eax<br />                  <br />               .elseif &#91;edi&#93;.iSubItem == 2           ;at subitem 2 set the colors below          <br />                  RGB 255,174,0 <br />                  mov &#91;edi&#93;.clrTextBk,eax<br />                  RGB 255,255,255<br />                  mov &#91;edi&#93;.clrText,eax<br />                  <br />               .else                                 ;set everything else to the colors below<br />                  RGB 255,255,255<br />                  mov &#91;edi&#93;.clrTextBk,eax<br />                  RGB 0,0,0<br />                  mov &#91;edi&#93;.clrText,eax<br />               .endif<br />             return 32    ;&lt;--- what is this line doing exactly<br />         .endif<br />      .endif<br />   return 0     ;&lt;--- also this line</code></pre></div>
    <div class="meta">Posted on 2002-01-23 18:53:16 by smurf</div>
   </div>
   <div class="post" id="post-20768">
    <div class="subject"><a href="#post-20768">listview color question</a></div>
    <div class="body">return 32 is for CDRF_NOTIFYITEMDRAW OR CDRF_NOTIFYSUBITEMDRAW return value. If you look at the .inc file that I included, you'll see these names equ 20h. Custom Draw need a return 0 at the end or your program will crash. You might want to search for NMCUSTOMDRAW on Yahoo and click the first link to Micorsoft MSDN, at the botton of the NM there are two listviews examples.<br /><br />Guy</div>
    <div class="meta">Posted on 2002-01-23 19:23:54 by Guy</div>
   </div>
  </div>
 </body>
</html>