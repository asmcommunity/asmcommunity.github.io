<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>64 bit conversion to ascii - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=5197" />
    <link rel="next" href="../?id=5197&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=5197">64 bit conversion to ascii</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=5197&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=5197&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="5197" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=5197&amp;page=2">&gt;</a><a href="../?id=5197&amp;page=2">&raquo;</a></form>   <div class="post" id="post-36678">
    <div class="subject"><a href="#post-36678">64 bit conversion to ascii</a></div>
    <div class="body">Hi, all<br /><br />I was looking for a conversion routine for a 64 bit integer. Having searched the board for useful pieces of code I finally put together the following routine which seems to work.<br /><br />Two questions remain for me: <br />- Is the fpu control word 067Fh the correct one?<br />- According to several manuals the fprem instruction is outdated and should be replaced by fprem1. But when I do that, I get a wrong result. Is there a solution for that?<br /><br />wolf<br /><br /><br /><pre><code><br />.486<br />.model flat,stdcall<br />option casemap&#58;none<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\user32.inc<br /><br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\user32.lib<br /><br />i64toa proto &#58;DWORD,&#58;DWORD<br /><br />.data?<br />   testbuff	db 128 <br />.data<br />onebillion	dq 1000000000<br />testint      dq 7FFFFFFFFFFFFFFFh<br />caption     db &quot;64 bit integer conversion&quot;,0<br />.code<br /><br />start&#58;<br />invoke i64toa,ADDR testint,ADDR testbuff<br />invoke MessageBox,0,ADDR testbuff,ADDR caption,0<br />invoke ExitProcess,0<br /><br /><br />i64toa proc uses ebx ecx edx edi esi lpLarge&#58;DWORD,lpBuffer&#58;DWORD<br />   LOCAL dqLarge&#58;QWORD<br />   LOCAL dqRemainder&#58;QWORD<br />   LOCAL fpucontrol&#58;WORD<br />   LOCAL myfpucontrol&#58;WORD<br /><br />   mov edi,&#91;lpLarge&#93;  ; copy integer into dqLarge and eax&#58;edx<br />   lea esi,&#91;dqLarge&#93;<br />   mov ebx,&#91;lpBuffer&#93;<br />   mov eax,&#91;edi&#93;<br />   mov edx,&#91;edi+4&#93;<br />   bt edx,31<br />   jnc positive<br /><br />   mov byte ptr &#91;ebx&#93;,'-'   ; integer is negative<br />   inc ebx<br />   not eax<br />   not edx<br />   add edx,1<br />   adc edx,0<br /><br />positive&#58;<br />   push ebx<br />   mov &#91;esi&#93;,eax<br />   mov &#91;esi+4&#93;,edx<br />   cmp edx,0<br />   jne bignum   ; it is a 64 bit integer<br />   cmp eax,0<br />   jne convert  ; it is a 32 bit integer<br /><br />   pop ebx     ; it is zero<br />   mov word ptr &#91;ebx&#93;,0030h<br />   jmp exit			<br /><br />bignum&#58;<br />   lea edi,&#91;onebillion&#93;	<br />   lea ecx,&#91;dqRemainder&#93;<br /><br />split64&#58;  divide the number by 1 billion until the result is a 32 bit value<br />   finit<br />   fstcw &#91;fpucontrol&#93;<br />   mov &#91;myfpucontrol&#93;,067Fh ; initialize our control word with 067Fh  or 0C7Fh or 0A7h?<br />   fldcw &#91;myfpucontrol&#93;	<br /><br />   fild qword ptr &#91;edi&#93;    ; load divisor<br />   fild qword ptr &#91;esi&#93;    ; load dividend<br />   fst st&#40;2&#41;   ; copy dividend into fp register st2<br />   fdiv st&#40;0&#41;,st&#40;1&#41;<br />   fistp qword ptr &#91;esi&#93;<br />   fxch st&#40;1&#41;	<br />   fprem<br />   fistp qword ptr &#91;ecx&#93;<br />   fstp st&#40;0&#41;	<br /><br />   mov eax,&#91;ecx&#93;   ; get the 32 bit remainder and convert it<br />   push ecx	<br />   push edi	<br />   mov ecx,10	<br />   mov edi,9	<br />	<br />remainderloop&#58;<br />   cmp eax,0	<br />   je numberfinished<br />   xor edx,edx<br />   div ecx<br />   add dl,'0'		<br />   mov &#91;ebx&#93;,dl	<br />   inc ebx		<br />   dec edi<br />   jmp remainderloop<br />numberfinished&#58;<br />   dec edi	<br />   js digitsfinished<br />   mov byte ptr &#91;ebx&#93;,&quot;0&quot;<br />   inc ebx<br />   jmp numberfinished<br /><br />digitsfinished&#58;<br />   pop edi     ; restore the pointers<br />   pop ecx<br /><br />   mov eax,&#91;esi&#93;<br />   mov edx,&#91;esi+4&#93;<br />   cmp edx,0<br />   jne split64   ; it is still a 64 bit number<br />   fldcw &#91;fpucontrol&#93;<br /> <br />   convert&#58;<br />   mov ecx,10	<br />   conversionloop&#58;<br />   cmp eax,0<br />   je conversionfinished<br />   xor edx,edx<br />   div ecx	<br />   add dl,'0'	<br />   mov &#91;ebx&#93;,dl		<br />   inc ebx	<br />   jmp conversionloop<br /><br />conversionfinished&#58;<br />   mov byte ptr &#91;ebx&#93;,0		<br />   pop esi	<br />rotate&#58;	<br />   cmp esi,ebx<br />   jge exit	<br />   dec ebx	<br />   mov al,&#91;esi&#93;<br />   mov ah,&#91;ebx&#93;<br />   mov &#91;ebx&#93;,al<br />   mov &#91;esi&#93;,ah<br />   inc esi<br />   jmp rotate<br /><br />exit&#58;<br />   ret<br />i64toa endp<br /><br />end start<br /></code></pre></div>
    <div class="meta">Posted on 2002-05-05 14:12:52 by wolf</div>
   </div>
   <div class="post" id="post-36681">
    <div class="subject"><a href="#post-36681">64 bit conversion to ascii</a></div>
    <div class="body"><div class="quote">The FPREM instruction does not compute the remainder specified in IEEE Std 754. The IEEE specified remainder can be computed with the FPREM1 instruction. The FPREM instruction is<br />provided for compatibility with the Intel 8087 and Intel287 math coprocessors.</div></div>
    <div class="meta">Posted on 2002-05-05 14:31:01 by bitRAKE</div>
   </div>
   <div class="post" id="post-36828">
    <div class="subject"><a href="#post-36828">64 bit conversion to ascii</a></div>
    <div class="body">WOLF<br /><br />I didn't try to follow all your code.<br />I think you got too complicated using the FPU instructions.<br />Do you NEED to use FPU for this?<br /><br />I modified your code using the normal integer instructions and then displaying 2 message boxes with a big positive and negative number.<br />If  you had checked the code in my post &quot;64 bit primes&quot;  in this same algo section, you would have found that i am using exactly the same code to convert the 64 bit number to ascii.</div>
    <div class="meta">Posted on 2002-05-06 11:54:00 by towers</div>
   </div>
   <div class="post" id="post-36856">
    <div class="subject"><a href="#post-36856">64 bit conversion to ascii</a></div>
    <div class="body">I'd recommend test speed of both.<br />Logic choosen in both methods leads to very slow performence.<br />I submitted 3 difference routines to convert qword to ascii.<br />You can look for them here in the board or in Thomas snippet lybrary.<br /><br />To All:<br />People, why all contests and testing stopped here?<br />The section is close to dead again.<br />I was sure that there were a lot of coders to make algo creaters<br />eat a humble pie.<br /><br />Is your fighting spirit dead already?</div>
    <div class="meta">Posted on 2002-05-06 15:52:49 by The Svin</div>
   </div>
   <div class="post" id="post-36870">
    <div class="subject"><a href="#post-36870">64 bit conversion to ascii</a></div>
    <div class="body"><div class="quote"><br />To All:<br />People, why all contests and testing stopped here?<br />The section is close to dead again.<br />I was sure that there were a lot of coders to make algo creaters<br />eat a humble pie.<br /><br />Is your fighting spirit dead already?</div>Haven't you seen RSA threads?  We're going to make big discovery! ;)</div>
    <div class="meta">Posted on 2002-05-06 17:11:12 by bitRAKE</div>
   </div>
   <div class="post" id="post-36894">
    <div class="subject"><a href="#post-36894">64 bit conversion to ascii</a></div>
    <div class="body"><div class="quote"><br />Haven't you seen RSA threads?  We're going to make big discovery! ;) </div><br /><br />I feel excited already... <br /><br />On a side note: <br />I've just proved that god really does exist and figured it out with the use of a pencil, paper and a stick of chewing gum... Should I publish?<br /><br />:) :) :)<br /><br />All in good fun,<br />Sliver<br /><br />ps. j/k I didn't use a pencil :)</div>
    <div class="meta">Posted on 2002-05-06 18:54:18 by Sliver</div>
   </div>
   <div class="post" id="post-36895">
    <div class="subject"><a href="#post-36895">64 bit conversion to ascii</a></div>
    <div class="body"><div class="quote">Haven't you seen RSA threads? We're going to make big discovery</div> <br />Don't make me laugh.<br />I wouldn't surpise that the guy is from FBI making<br />another stupid provokation.<br />Rickey, frankly it's absolutly immpossible to carry <br />discussion on cryptography here.<br />At least until you make decision in the States what is <br />good and what is bad in it.<br />Government wants a kind of cryptography that SEEMS<br />secure for ordinary people, but easy to crack for <br />government intellegence. And act from this logic.<br />It's stupidity that leads only for unsecurity for both<br />ordinary Americans and government itself.<br />It would work (let say it in math logic way)<br />IF and ONLY IF<br />1. The USA has the best education over the world.<br />2. All most talanted Americans are willing to work for the Government.<br /><br />Both conditions are FALSE.<br />About education:<br />Read about Manhettan project (S.M.Ulam Adventure of a Mathematician)<br />to were the best heads are coming from to the States.<br /><br />From recent evens 200 000 russian math and theory physics men left to USA<br />(50% in math and 30% in physics are Russians in the States now)<br />they were requsted from the States to work there in their fields.<br /><br />About working for Government you know better than me.<br /><br />Now couple facts from my experience.<br />1. Our Russian M$ department proved to chif M$ department that currenlty used in M$<br />products DSA algorithm was weak.<br />Under request they offered new DSA.<br />It was refused.<br />And know why?<br />FBI found it hard to crack, so that was afraid that some illigal people can<br />do their job unvisible to FBI.<br /><br />2. Our programmer for long time worked under security issues of Acrobat.<br />FBI was among his CLIENTS!<br />But when he openly showed that cripting is too weak, to say people for<br />free that it is unsecure to rely on Acrobat protection, he was put in prison<br />in the States.<br />We all were in shock. Guy tried to help the Americans for free and got prison<br />for it. Well you are strange people indeed.<br /><br />Now you are got absolutly insecure with the policy.<br />Best hackers and crackers are not those bully guys as media try to say.<br />They are talanted Mathematicians and they never reveal themself.<br />They don't need popularity, and working in dark, and they are not<br />worse at all of those who work for Government.<br />They hacked air net communication system in the tradigy day in America.<br />And you'll  never know their names.<br /><br />So from the above following very simple thing:<br />FBI paying by insecurity for ability to crack any crypting.<br />But did they seceed?<br />NO!<br />For those who want to be secure  in their illigal activity <br />and have money for it - don't use DSA of M$.<br />So all FBI got was just insecurity for them and ordinary<br />people they have to protect.<br />Along with it persecuting those honest altruists who<br />try to bring protection.<br />Making low against using other protection than they<br />can crack.<br />It's all bring so complexity in discussing protection, so<br />that even most honest men trying to protect people<br />can be blame in illigal activities if their level better in crypting<br />than those that have people working for Intellegence.<br /><br />In open key cryptography only those who don't want<br />that protection algo protect anything from them would<br />hide results of protection weakness  from people.<br /><br />There are 2 group of such people<br />1. Pro Hackers and Crackers<br />2. Security services of Government.<br /><br />Other people are suffering in those two's buttles</div>
    <div class="meta">Posted on 2002-05-06 19:00:12 by The Svin</div>
   </div>
   <div class="post" id="post-36903">
    <div class="subject"><a href="#post-36903">64 bit conversion to ascii</a></div>
    <div class="body"><div class="quote">Is your fighting spirit dead already?</div>I'm busy playing Arcanum, FFX and Yugioh: Dungeondice Monsters 5(even though I don't understand japanese, I still manage to kick some butts on my opponents). When I'm bored playing I'll join in the algo fun ;)<br /><br />Currently, I'm bored programming any type of code...I even had nightmares that the <strong>mov</strong> instruction resurrected from the grave and nearly killed me. :grin:</div>
    <div class="meta">Posted on 2002-05-06 19:49:57 by stryker</div>
   </div>
   <div class="post" id="post-36906">
    <div class="subject"><a href="#post-36906">64 bit conversion to ascii</a></div>
    <div class="body">Svin,<br /><br />This is also quite humorous :)<br /><br />1. The USA has the best education over the world. <br />2. All most talanted Americans are willing to work for the Government. <br /><br />1. not in Math, here, they don't even teach Classical Math anymore.....they only teach modern logic and such (training for employment)....I'll bet there's less than 5% Math Dept. Heads that can prove Eulers Equation!!!!<br /><br />2. &quot;willing to work&quot;??? no-one here in the Gov does any work!!!!<br /><br />:grin:<br />B</div>
    <div class="meta">Posted on 2002-05-06 19:56:26 by Brad</div>
   </div>
   <div class="post" id="post-36911">
    <div class="subject"><a href="#post-36911">64 bit conversion to ascii</a></div>
    <div class="body"><div class="quote"><br />2. &quot;willing to work&quot;? no-one here in the Gov does any work!</div>Don't give away my secret - it is the only job I could find where I could continue other work and still get paid for something totally unrelated to that work.  As an added bonus, I don't feel so bad about all the federal taxes I'm paying. ;)</div>
    <div class="meta">Posted on 2002-05-06 20:51:06 by bitRAKE</div>
   </div>
   <div class="post" id="post-36915">
    <div class="subject"><a href="#post-36915">64 bit conversion to ascii</a></div>
    <div class="body">Someday, I'm going to actually LEARN Assembly, and then be able to post something with a little more substance, (In an Algorithmn Thread), than just a opinionated comment!!! :)<br />sorry, B</div>
    <div class="meta">Posted on 2002-05-06 21:18:31 by Brad</div>
   </div>
   <div class="post" id="post-36931">
    <div class="subject"><a href="#post-36931">64 bit conversion to ascii</a></div>
    <div class="body">Thanks very much - especially towers for the 64a.asm!!<br />It looks so easy. My problem was that I didn't know how to handle the two divisions (hi/low) one after the other and so I involved the fpu instead. Seems I delivered an excellent example for making a really slow routine with a lot of superfluous code.<br />But I learned a bit at least.<br /><br />wolf</div>
    <div class="meta">Posted on 2002-05-07 00:20:43 by wolf</div>
   </div>
   <div class="post" id="post-36933">
    <div class="subject"><a href="#post-36933">64 bit conversion to ascii</a></div>
    <div class="body">towers logic is slow too.<br />If lazy to search for already submitted code, I did it for you.<br />test this(I have also cople MMX versions):<br /><pre><code><br />uqw2a   proc uses ebx esi edi lBuffer,lQword<br /><br />LOCAL	num18&#58;QWORD<br />	mov esi,lQword<br />	mov edi,lBuffer<br />	mov edx,&#91;esi&#93;<br />	mov eax,&#91;esi+4&#93;<br /><br />N19H equ 0DE0B6B3h<br />N19L equ 0A7640000h<br />N20H equ 8AC72304h<br />N20L equ 89E80000h<br />	cmp eax,N19H<br />	jc  C18<br />	jne C20<br />	cmp edx,N19L<br />	jc  C18 <br />C20&#58;	cmp eax,N20H<br />	jc  DO19<br />	jne DO20<br />	cmp edx,N20L<br />	jc  DO19<br />DO20&#58;	mov byte ptr &#91;edi&#93;,'1'<br />	sub edx,N20L<br />	lea edi,&#91;edi+1&#93;<br />	sbb eax,N20H<br />DO19&#58;	mov byte ptr &#91;edi&#93;,'0'-1<br />@@&#58;	inc byte ptr &#91;edi&#93;<br />	sub edx,N19L<br />	sbb eax,N19H<br />	jnc @B<br />	add edx,N19L<br />	adc eax,N19H<br />	inc edi<br />C18&#58;	mov dword ptr num18,edx<br />	mov dword ptr num18+4,eax<br /><br />	sub esp,10<br />	fild num18<br />	fbstp &#91;esp&#93;<br />	xor esi,esi<br />@@&#58;<br />	pop eax<br />	bswap eax<br />	mov ebx,eax	  	<br /><br />	mov ecx,eax	<br />	mov bl,bh<br /><br />	shr ecx,16	<br />	mov ah,al<br /><br />	shr bl,4		<br />	shr al,4<br /><br />	and bh,0fh	<br />	and ah,0fh<br /><br />	shl ebx,16	<br />	and eax,0FFFFh<br /><br />	mov edx,ecx	<br />	mov cl,ch<br /><br />	mov dh,dl	<br />	shr cl,4	<br /><br />	shr dl,4		<br />	and ch,0fh<br /><br />	and dh,0fh	<br />	shl ecx,16<br /><br />	lea eax,&#91;eax&#93;&#91;ebx&#93;+30303030h	<br />	lea edx,&#91;edx&#93;&#91;ecx&#93;+30303030h<br /><br />	mov &#91;edi+10&#93;,eax<br />	mov &#91;edi+14&#93;,edx<br />	xor esi,1<br />	lea edi,&#91;edi-8&#93;<br />	jne @B<br /><br />	mov ah,byte ptr &#91;esp&#93;<br />	add edi,16<br />	mov al,ah<br />	add esp,2<br />	shr  al,4<br />	mov esi,lBuffer<br />	and eax,0f0fh<br />	or eax,3030h<br />	mov word ptr &#91;edi&#93;,ax<br />	cmp edi,esi<br />	mov byte ptr &#91;edi+18&#93;,0<br />	jne @P<br />	mov ecx,-20<br />	add edi,19<br />@@&#58;<br />	inc ecx<br />	cmp byte ptr &#91;edi&#93;&#91;ecx&#93;,30h<br />	je @B<br />	mov eax,ecx<br />	js @Zero<br />	neg eax<br />	add esi,eax<br />@@&#58;	mov al,byte ptr &#91;edi&#93;&#91;ecx&#93;<br />	mov byte ptr &#91;esi&#93;&#91;ecx&#93;,al<br />	inc ecx<br />	jne @B<br /><br />@P&#58;	ret<br />@Zero&#58;  <br />	mov byte ptr &#91;esi+1&#93;,0<br />	jmp @P<br />uqw2a endp<br /></code></pre></div>
    <div class="meta">Posted on 2002-05-07 00:36:55 by The Svin</div>
   </div>
   <div class="post" id="post-36935">
    <div class="subject"><a href="#post-36935">wow</a></div>
    <div class="body">Hi Svin,<br /><br />your code is about five times faster - unbelievable.<br />It will take me some time to have a closer look at it and try to understand it.<br /><br />wolf</div>
    <div class="meta">Posted on 2002-05-07 01:42:31 by wolf</div>
   </div>
   <div class="post" id="post-36936">
    <div class="subject"><a href="#post-36936">64 bit conversion to ascii</a></div>
    <div class="body"><div class="quote">a really slow routine with a lot of superfluous code. </div> <br />It is sign of corrage that you submit the code.<br />When you don't have already examples of how to deal some algo,<br />it's 99 % chance that you do code that slower then somewere existing. Most of so to called gurus didn't create any ideas - they just pick them from others.<br />So coward in the case would pretend that he knows something but don't have time to show it. Or at least simply ask for code.<br />Brave man just try what he can and show :)</div>
    <div class="meta">Posted on 2002-05-07 02:00:22 by The Svin</div>
   </div>
   <div class="post" id="post-36937">
    <div class="subject"><a href="#post-36937">64 bit conversion to ascii</a></div>
    <div class="body">Talking of criptography, I've just finish wathing wanderfool american movie (documentary) &quot;CodeBreakers&quot;<br />About British and American men who work as military codebeakers<br />in the 2nd World War.<br />Authors stated that it was almost impossible to win the war without the codebreakers work.<br />It was nice to here one more time that brain is more powerfool weapon then bombs.<br /><br />I'm glad to congradulate our alies with the Victory Day.</div>
    <div class="meta">Posted on 2002-05-07 02:41:59 by The Svin</div>
   </div>
   <div class="post" id="post-37018">
    <div class="subject"><a href="#post-37018">64 bit conversion to ascii</a></div>
    <div class="body">I saw some MMX solution in FIDONet earlier<br /><pre><code><br />= TALKS.ASM &#40;2&#58;5056/##.###&#41; ==========================<br /> Msg  &#58; 3460 of 3692                        Snt Loc Scn<br /> From &#58; Stepan Polovnikov                   2&#58;5056/16.47    14 Sep 01  17&#58;38&#58;44<br /> To   &#58; Sashka Yackubtchick<br /> Subj &#58; ??????????????? 64? ???. ?????????????? ??????<br />==================================================<br />Hello, Sashka!<br /><br />SY&gt; ?? ?????? ???? ?? ?????????? ??????? - ??? ????? ????????? ?? ???? ???<br />SY&gt; ??????? ??? ???????? ?? ?????? ?? ?? ???? ???? ;&#41;<br />    ????? ?????? ?????? ???? ??????, ????????, ??? ?????????? ????? ???? ? <br />?????. ??????? ? ??? - ?????? ???????????????. ??????? - ???? ;&#41;<br />    ??? ?????? 32 ?????? ????? ??????????? ???????????? ???????? &#40;~4??&#41;, ??? <br />????????? ????????? ?????????????? ?? 20 ?? 60 ??????.<br /><br />Const<br />mmxb0F dq 0F0F0F0F0F0F0F0Fh<br />mmxb30 dq '00000000'<br /><br />CodeSeg<br />...<br />; edx&#58;eax-number<br />; edi-string buffer<br />N19H equ 00DE0B6B3h<br />N19L equ 0A7640000h<br />N20H equ 08AC72304h<br />N20L equ 089E80000h<br />    sub esp,12<br />    xor ecx,ecx<br />    cmp edx,N19H<br />    jb  @@nm18<br />    jne @@cp20<br />    cmp eax,N19L<br />    jb  @@nm18<br />@@cp20&#58; cmp edx,N20H<br />    jb  @@do19<br />    jne @@do20<br />    cmp eax,N20L<br />    jb  @@do19<br />@@do20&#58; mov cl,10h-1<br />    sub eax,N20L<br />    sbb edx,N20H<br />@@lp19&#58; inc ecx<br />@@do19&#58; sub eax,N19L<br />    sbb edx,N19H<br />    jae @@lp19<br />    add eax,N19L<br />    adc edx,N19H<br />@@nm18&#58; push edx eax<br />    fild &#91;qword esp&#93;<br />    fbstp &#91;esp&#93;<br />    mov &#91;esp+9&#93;,ecx<br />; ?????????? ????? BCD-??????<br />    mov edx,2<br />    cmp &#91;dword esp+4*2&#93;,0<br />    jne @@dg16<br />    cmp &#91;dword esp+4*1&#93;,1<br />    sbb edx,1<br />@@dg16&#58; bsr ecx,&#91;esp+4*edx&#93;<br />    je @@zero<br />    shr ecx,3<br />    lea eax,&#91;ecx+4*edx&#93;<br />    lea edx,&#91;eax+eax&#93;<br />    cmp &#91;byte esp+eax&#93;,10h<br />    sbb edx,-1<br />; ?????????????? ?? BCD ? ASCII<br />    movq mm7,&#91;mmxb0F&#93;<br />    movq mm6,&#91;mmxb30&#93;<br />    movq mm0,&#91;esp+0&#93;<br />    movd mm4,&#91;esp+8&#93;<br />    movq mm1,mm0<br />    psrlq mm1,4<br />    pand mm0,mm7<br />    por mm0,mm6<br />    pand mm1,mm7<br />    por mm1,mm6<br />    movq mm2,mm0<br />    punpcklbw mm0,mm1<br />    movq &#91;esp+0&#93;,mm0<br />    punpckhbw mm2,mm1<br />    movq &#91;esp+8&#93;,mm2<br />    movq mm5,mm4<br />    psrlq mm5,4<br />    pand mm4,mm7<br />    por mm4,mm6<br />    pand mm5,mm7<br />    por mm5,mm6<br />    punpcklbw mm4,mm5<br />    movd &#91;esp+16&#93;,mm4<br />    emms<br />; ??????????? ?????? ? ???????? ???????<br />@@lpS&#58; mov eax,&#91;esp+edx-3&#93;<br />    bswap eax<br />    mov &#91;edi&#93;,eax<br />    add edi,4<br />    sub edx,4<br />    jns @@lpS<br />    mov &#91;byte edi+edx+1&#93;,0<br />    add esp,20<br />    ret<br />@@zero&#58; mov &#91;dword edi&#93;,'0'<br />    add esp,20<br />    ret<br /><br />Bye!<br />Stepan<br />--- GoldED+/W32 1.1.5-20010807<br /> * Origin&#58; NETMAIL &#40;2&#58;5056/##.###&#41;<br /></code></pre><br /><br />BTW, Stepan leave FIDO Net :(</div>
    <div class="meta">Posted on 2002-05-07 13:50:41 by Nexo</div>
   </div>
   <div class="post" id="post-37054">
    <div class="subject"><a href="#post-37054">64 bit conversion to ascii</a></div>
    <div class="body"><div class="quote">BTW, Stepan leave FIDO Net </div> <br />It's too sad.<br />I'm leaving inet in near future too.<br />But I think you always can find me in FIDO net.<br />As I previously said numerous time, Stepan and I worked very closely on many algos, exchanging ideas through echoes and fidomail. Some time I start algo and he follows sometime he.<br />In the case of hex to ascii MMX he started and then we both add some ideas, In the case of 64 bit to dec string I started and then we both add some ideas.<br />You SRC 32 algo, we discussed also a half a year ago.<br /><br /><br />Nexo, I'm sure you can add some ideas. Let's concentrate on it.</div>
    <div class="meta">Posted on 2002-05-07 18:59:22 by The Svin</div>
   </div>
   <div class="post" id="post-37055">
    <div class="subject"><a href="#post-37055">64 bit conversion to ascii</a></div>
    <div class="body">Here is link on Google - read the whole thread :)<br /><a target="_blank" href="http://groups.google.com/groups?hl=en&amp;threadm=1000474762%40p47.f16.n5056.z2.FIDOnet.ftn&amp;rnum=1&amp;prev=/groups%3Fq%3Dedi-string%2Bbuffer%2Bgroup:fido7.talks.asm%26hl%3Den%26selm%3D1000474762%2540p47.f16.n5056.z2.FIDOnet.ftn%26rnum%3D1">http://groups.google.com/groups?hl=en&amp;threadm=1000474762%40p47.f16.n5056.z2.FIDOnet.ftn&amp;rnum=1&amp;prev=/groups%3Fq%3Dedi-string%2Bbuffer%2Bgroup:fido7.talks.asm%26hl%3Den%26selm%3D1000474762%2540p47.f16.n5056.z2.FIDOnet.ftn%26rnum%3D1</a><br /><span style="font-size:9px>( Wish I knew Russian )</span></div>
    <div class="meta">Posted on 2002-05-07 19:03:05 by bitRAKE</div>
   </div>
   <div class="post" id="post-38236">
    <div class="subject"><a href="#post-38236">ASCII conversion</a></div>
    <div class="body">This is my first post here, and I'm wondering why you use MMX and other weird instructions to write these routines.<br />They are basic routines which don't need tremendous optimisation.<br />Personally, if I had to put the code into a real program, I'll put tower's code to avoid crash on weird systems. Of course, I'll replace the horrible bt ecx, 31 by or ecx, ecx !<br />Also, there is a subtle bug in his routine, when ecx reached 0 but not ebx.<br /><br />My modified routine (untested):<br /><br />                  mov edi,lpBuffer<br />                  or ecx, ecx<br />                  jns positive<br />                  mov byte ptr ,'-'   ; integer is negative<br />                  inc edi<br />                  not ebx<br />                  not ecx<br />                  add ebx,1<br />                  adc ecx,0<br />positive:<br />                  xor eax, eax<br />                  push eax<br />	  mov esi,10         ; decoding the 64 bit binary to ASCII<br />@@:<br />	  sub edx,edx<br />	  mov eax,ecx<br />	  div esi              ; divide numhi by 10...<br />	  mov ecx,eax<br />	  mov eax,ebx<br />	  div esi              ; .... then numlo by 10, using<br />	  mov ebx,eax          ; first remainder in edx<br />	  add dl,30h           ; new remainder plus 30h is the digit<br />                  push edx<br />	  or eax,ecx<br />	  jne @B               ; keep looping until no digits left <br />move: <br />                  pop eax<br />	  mov ,al        ; move......<br />	  inc edi<br />                  or eax, eax<br />	  jnz move<br />	  ret<br /><br />2 other indications:<br />1) I vaguely remember a trick based on neg to invert 64 bits.<br />It was something like:<br />   not ecx<br />   neg ebx<br />   adc ecx,0<br />(not sure if it works)<br /><br />2) there is another way to avoid ALL floating point operations AND divisions.<br />The trick is based on the Microsoft Basic conversion routine.<br />First, we substract 10^19, until we reach a negative result (the iteration counter gives us the first digit !)<br />Then, we add 10^18, until we reach a positive result (the iteration counter gives us the second digit !)<br />Then we sub 10^17, etc...<br />This makes 18 loops, with only add/sub !<br /><br />To conclude, I have to admit that Svin's code is beautiful, but I really hate floating point operations (what is this fbstp instruction ?)<br /><br />JCM</div>
    <div class="meta">Posted on 2002-05-14 18:20:35 by MCoder</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=5197&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=5197&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="5197" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=5197&amp;page=2">&gt;</a><a href="../?id=5197&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>