<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>A little simple magic spell - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=4855" />
  <link rel="prev" href="../?id=4855&amp;page=1" />   </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=5">Algorithms &amp; Source Code</a> &raquo; <a href="../?id=4855">A little simple magic spell</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=4855&amp;page=1" style="">&laquo;</a><a href="../?id=4855&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="4855" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>   <div class="post" id="post-34245">
    <div class="subject"><a href="#post-34245">A little simple magic spell</a></div>
    <div class="body"><pre><code><br />lea ecx,&#91;eax-1&#93;<br />test eax,ecx<br />je power2<br /></code></pre><br />That is good one.<br />Thanks for the idea.</div>
    <div class="meta">Posted on 2002-04-21 07:05:47 by The Svin</div>
   </div>
   <div class="post" id="post-34256">
    <div class="subject"><a href="#post-34256">A little simple magic spell</a></div>
    <div class="body">The Svin, you may remove MMX ops:<br /><pre><code><br />	bsr ecx,eax<br />	lea edx,&#91;eax-1&#93;<br />	test eax,edx<br />	je @powerof2 ; ecx - shift<br />	mov &#91;shift&#93;,ecx<br />	mov edx,1<br />	shl edx,cl<br />	mov &#91;d,r+0&#93;,0<br />	mov &#91;r+4&#93;,edx<br />	fild &#91;r&#93;<br /></code></pre></div>
    <div class="meta">Posted on 2002-04-21 07:55:19 by Nexo</div>
   </div>
   <div class="post" id="post-34272">
    <div class="subject"><a href="#post-34272">A little simple magic spell</a></div>
    <div class="body">Nexo, it's good idea so that the app can be used on<br />older procs wich don't have MMX.<br />I just change a lit bit implementation to make it shorter in bytes:<br /><pre><code><br />.data<br />r dq ?<br />ldivider dq ?<br /><br />.code<br /><br />	bsr ecx,eax	<br />	lea edx,&#91;eax-1&#93;<br />	mov edi,offset r<br />	test eax,edx<br />	je @powerof2 <br />	xor edx,edx<br />	mov &#91;shift&#93;,ecx<br />	mov  &#91;edi&#93;,edx<br />	mov  &#91;edi+12&#93;,edx<br />	inc edx<br />	mov &#91;edi+8&#93;,eax<br />	shl edx,cl<br />	mov &#91;edi +4&#93;,edx<br /><br />	fild qword ptr &#91;edi&#93;	<br />	fild qword ptr &#91;edi+8&#93;<br /></code></pre></div>
    <div class="meta">Posted on 2002-04-21 10:22:51 by The Svin</div>
   </div>
   <div class="post" id="post-34300">
    <div class="subject"><a href="#post-34300">New version on Magic</a></div>
    <div class="body">It's nothing special about this version.<br />I just coded it a little bit more carefull. Speed and size improved.<br />Though I don't think that size and speed is matter for the app in previous<br />version too, even if it run on i486 :)<br />But it is normal expect that if code is submitted to the section it must be<br />done approprate way no matter whatever.<br />So I improved several lines. Code included so you can compare the difference yourselve.<br />In addition I accepted Nexo's suggestion to remove MMX from the code<br />so that the app can be run on any processor from i486 DX.<br />Size is now 3,5 kb.</div>
    <div class="meta">Posted on 2002-04-21 13:48:49 by The Svin</div>
   </div>
   <div class="post" id="post-34312">
    <div class="subject"><a href="#post-34312">A little simple magic spell</a></div>
    <div class="body">Then divider = 67.<br /><br />mov edx,0F4898D60h<br />mul edx<br />SHR edx, 6<br /><br />But code<br /><br />mov edx,07A44C6Bh<br />mul edx<br />shr edx,1<br /><br />is shorter on 1 byte.<br />May be adjust paremeters needs.</div>
    <div class="meta">Posted on 2002-04-21 14:36:00 by Nexo</div>
   </div>
   <div class="post" id="post-154118">
    <div class="subject"><a href="#post-154118">A little simple magic spell</a></div>
    <div class="body"><div class="quote"><strong>Svin</strong>, this is an interesting discussion started by your tool.  Is there an easy way to get the remainder without DIV?  I understand we can use two MUL, but there are many dependancies.</div><br /><br />Where can I download this tool please, and has anyone found an easy way to get the remainder yet, please? Actually, I would be happy just to be able to detect IF there is a remainder...</div>
    <div class="meta">Posted on 2004-12-13 23:15:46 by V Coder</div>
   </div>
   <div class="post" id="post-154173">
    <div class="subject"><a href="#post-154173">A little simple magic spell</a></div>
    <div class="body">http://www.wasm.ru/tools/22/magicnumber.zip</div>
    <div class="meta">Posted on 2004-12-14 19:13:37 by The Svin</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=4855&amp;page=1" style="">&laquo;</a><a href="../?id=4855&amp;page=1" style="">&lt;</a><input type="hidden" name="id" value="4855" /><input type="number" name="page" min="1" max="2" step="1" value="2" onchange="this.form.submit();" /></form>  </div>
 </body>
</html>