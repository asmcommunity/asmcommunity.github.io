<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Segmentation fault issue - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=30708" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=117">Unix</a> &raquo; <a href="../?id=30708">Segmentation fault issue</a></p>
   <div class="post" id="post-215246">
    <div class="subject"><a href="#post-215246">Segmentation fault issue</a></div>
    <div class="body">Hello guys, I decided to write a brain**** compiler to help me understand how compilers work, I&#039;ve done <strong>very</strong> little ring3 programming, so I am rather new to this. So anyway here is my bf compiler code...<br /><br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; use32<br />;=============================================================================;<br />section .data<br />;=============================================================================;<br />&nbsp; &nbsp; &nbsp; &nbsp; welcom&nbsp; db&nbsp; &quot;Coty&#039;s crazed&nbsp; Brain**** compiler (C) 2011&quot;,10<br />&nbsp; &nbsp; &nbsp; &nbsp; wellen&nbsp; equ $-welcom<br /><br />numofargs&nbsp; &nbsp; &nbsp;  dd 0&nbsp; &nbsp; &nbsp; ; How many arguments were passed (including this prog)<br />progname&nbsp; &nbsp; &nbsp; &nbsp; dd 0&nbsp; &nbsp; &nbsp; ; The progname this app was launched with<br />argument1&nbsp; &nbsp; &nbsp;  dd 0&nbsp; &nbsp; &nbsp; ; File to compile input<br />argument2&nbsp; &nbsp; &nbsp;  dd 0&nbsp; &nbsp; &nbsp; ; file to compile outpu<br />argument3&nbsp; &nbsp; &nbsp;  dd 0&nbsp; &nbsp; &nbsp; ; unused<br />argument4&nbsp; &nbsp; &nbsp;  dd 0&nbsp; &nbsp; &nbsp; ; unused<br /><br />codeinsize&nbsp; &nbsp; &nbsp; equ&nbsp; &nbsp;  32768<br />codeoutsize&nbsp; &nbsp;  equ&nbsp; &nbsp;  8192<br />;=============================================================================;<br />section .text<br />	global _start<br />;=============================================================================;<br />_start:<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; First lets grab our arguments...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  edx<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  edi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ,&nbsp; ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , edx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , edi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , esi<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Print our so cool message...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  esi, esi<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  edi, edi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 4&nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx, 1&nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, welcom&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, wellen<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Read our code from disk.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx, <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax,&nbsp; 5<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx,&nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax,&nbsp; 3 <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx,&nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx,&nbsp; codeinbuf <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx,&nbsp; codeinsize <br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Compile the code...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, codeinbuf<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edi, codeoutbuf<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  edx, edx<br />&nbsp; &nbsp; &nbsp; &nbsp; compile_loop:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lodsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;+&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, inc_eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, inc_eaxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp;  movsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  .over<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sub&nbsp; &nbsp;  byte, inc_eaxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, inc_eaxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .over:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, inc_eaxsize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next0:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;-&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, dec_eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, dec_eaxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp;  movsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  .over<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sub&nbsp; &nbsp;  byte, dec_eaxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, dec_eaxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .over:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, dec_eaxsize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next1:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;&gt;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, inc_ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, inc_ecxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp;  movsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  .over<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sub&nbsp; &nbsp;  byte, inc_ecxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, inc_ecxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .over:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, inc_ecxsize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next2:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;&lt;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next3<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, dec_ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, dec_ecxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp;  movsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  .over<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sub&nbsp; &nbsp;  byte, dec_ecxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, dec_ecxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .over:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, dec_ecxsize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next3:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;.&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next4<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, period<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, period_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp;  movsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  .over<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sub&nbsp; &nbsp;  byte, period_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, period_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .over:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx&nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, period_size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next4:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;,&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next5<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, comma<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, comma_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp;  movsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  .over<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sub&nbsp; &nbsp;  byte, comma_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, comma_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .over:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, comma_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next5:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;[&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next6<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next6:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;]&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ax, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stosw<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  edx, edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, 2<br />&nbsp; &nbsp; &nbsp; &nbsp; next7:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  ecx, codeoutsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  compile_loop<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Write our binary to a file!&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx, &nbsp; &nbsp; &nbsp;  ; File descriptor <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 8<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, 00644Q&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; CHMOD permisions<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; write system call<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, codeoutbuf<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, codeoutsize<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80&nbsp;  <br />	mov	eax,6	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; sys_close()<br />	int	80h<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Exit proc.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br />;=============================================================================;<br />; Opcode list, you can change these to output ARM, PPC, 6502, ect.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;<br />;=============================================================================;<br />inc_eax:<br />&nbsp; &nbsp; &nbsp; &nbsp; inc&nbsp; &nbsp;  eax<br />inc_eaxsize equ $-inc_eax<br /><br />dec_eax:<br />&nbsp; &nbsp; &nbsp; &nbsp; dec&nbsp; &nbsp;  eax<br />dec_eaxsize equ $-dec_eax<br /><br />inc_ecx:<br />&nbsp; &nbsp; &nbsp; &nbsp; inc&nbsp; &nbsp;  ecx<br />inc_ecxsize equ $-inc_ecx<br /><br />dec_ecx:<br />&nbsp; &nbsp; &nbsp; &nbsp; dec&nbsp; &nbsp;  ecx<br />dec_ecxsize equ $-dec_ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Loop stuff...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />loop_sys:<br />&nbsp; &nbsp; &nbsp; &nbsp; db 0xE2&nbsp;  ; Short jump!<br />loop_var:<br />&nbsp; &nbsp; &nbsp; &nbsp; db 0xFE&nbsp;  ; jmp $<br />loop_length equ 1<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Here is our library to handle &quot;.&quot; and &quot;,&quot;... think if it like the&nbsp;  ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; iostream.h of brain**** or something...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />period:<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  [8191], al<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, 8191<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 4<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br />period_size equ $-period<br />comma:<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 3<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  ebx, ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br />&nbsp; &nbsp; &nbsp; &nbsp; ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp;  EAX nao holds our keypress!<br />&nbsp; &nbsp; &nbsp; &nbsp; ;<br />comma_size equ $-comma<br />;=============================================================================;<br />section .bss<br />;=============================================================================;<br />&nbsp; &nbsp; &nbsp; &nbsp; codeinbuf&nbsp; resb 32768&nbsp; &nbsp; &nbsp; &nbsp; ; This is we the source code gets loaded.<br />&nbsp; &nbsp; &nbsp; &nbsp; codeoutbuf resb 8192&nbsp; &nbsp; &nbsp; &nbsp;  ; This is were the finished binary goes.<br /><br /></code></pre><br /><br />I compile with:<br /><pre><code><br />~$ nasm -f elf i.asm<br />~$ ld -s -o i i.o<br /></code></pre><br />Here is some sample code to compile:<br /><pre><code>[&gt;&lt;+-,.]</code></pre><br />I compile the BF code acordingly:<br /><pre><code>./i test.bf test.bin</code></pre><br />The compiler starts, displays my message, &quot;Coty&#039;s crazed&nbsp; Brain**** compiler (C) 2011&quot;, then I read a segmentation fault and my BF code is not compiled... Any hints to what might be causing this? I tried making my buffers smaller to see if that was the issue, and maybe I was attempting to write outside of my little box in memory, but I still got the error...<br /><br />Any help will be appreciated, thanks in advance!<br /><br />Cheers! - Coty Miller</div>
    <div class="meta">Posted on 2011-10-17 09:04:05 by Coty</div>
   </div>
   <div class="post" id="post-215253">
    <div class="subject"><a href="#post-215253">Re: Segmentation fault issue</a></div>
    <div class="body">Hi Coty,<br /><br />First thing that causes the segfault is attempting to write to your .text section, which is readonly. We can tell Nasm to make .text writeable, and it will... in the .o file. However, ld, in its infinite wisdom, &quot;knows&quot; that .text is readonly, and changes it back for us! :( Workaround is to use a different name, &quot;.kode&quot; or so.<br /><br />Then, I think you&#039;re running off the end of your valid memory. Not clear to me how compile_loop is intended to exit.<br /><br />At the end of the &quot;open&quot;, you mov 3 into eax before moving eax into ebx for the &quot;read&quot; - a simple braincramp.<br /><br />I&#039;ve made a few simple changes - added a &quot;getc&quot; for debugging purposes after the &quot;lodsb&quot; in &quot;compile_loop&quot;, etc. I&#039;m not sure this actually &quot;works&quot; - it only writes a one-byte .bin file - I&#039;m not very familiar with BF. It at least completes without a segfault.<br /><br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; use32<br />;=============================================================================;<br />section .data<br />;=============================================================================;<br />&nbsp; &nbsp; &nbsp; &nbsp; welcom&nbsp; db&nbsp; &quot;Coty&#039;s crazed&nbsp; Brain**** compiler (C) 2011&quot;,10<br />&nbsp; &nbsp; &nbsp; &nbsp; wellen&nbsp; equ $-welcom<br /><br />numofargs&nbsp; &nbsp; &nbsp;  dd 0&nbsp; &nbsp; &nbsp; ; How many arguments were passed (including this prog)<br />progname&nbsp; &nbsp; &nbsp; &nbsp; dd 0&nbsp; &nbsp; &nbsp; ; The progname this app was launched with<br />argument1&nbsp; &nbsp; &nbsp;  dd 0&nbsp; &nbsp; &nbsp; ; File to compile input<br />argument2&nbsp; &nbsp; &nbsp;  dd 0&nbsp; &nbsp; &nbsp; ; file to compile outpu<br />argument3&nbsp; &nbsp; &nbsp;  dd 0&nbsp; &nbsp; &nbsp; ; unused<br />argument4&nbsp; &nbsp; &nbsp;  dd 0&nbsp; &nbsp; &nbsp; ; unused<br /><br /><br />codeinsize&nbsp; &nbsp; &nbsp; equ&nbsp; &nbsp;  32768<br />codeoutsize&nbsp; &nbsp;  equ&nbsp; &nbsp;  8192<br />;=============================================================================;<br />;section .text<br />section .kode write exec<br />	global _start<br />;=============================================================================;<br />_start:<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; First lets grab our arguments...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  eax<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  edx<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  edi<br />&nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ,&nbsp; ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , edx<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , edi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , esi<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Print our so cool message...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  esi, esi<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  edi, edi<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 4&nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx, 1&nbsp; &nbsp;  <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, welcom&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, wellen<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Read our code from disk.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx, <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax,&nbsp; 5<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx,&nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx,&nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax,&nbsp; 3 <br />;&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx,&nbsp; eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx,&nbsp; codeinbuf <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx,&nbsp; codeinsize <br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br />; save eax somewhere?<br />mov , eax<br /><br />mov ebx, eax ; ebx unused here?<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Compile the code...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, codeinbuf<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edi, codeoutbuf<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  ecx, ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  edx, edx<br />&nbsp; &nbsp; &nbsp; &nbsp; compile_loop:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lodsb<br />	dec ebx<br />	jz indone<br />		call putc<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;+&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, inc_eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, inc_eaxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp;  movsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  .over<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sub&nbsp; &nbsp;  byte, inc_eaxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, inc_eaxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .over:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, inc_eaxsize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next0:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;-&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, dec_eax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, dec_eaxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp;  movsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  .over<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sub&nbsp; &nbsp;  byte, dec_eaxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, dec_eaxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .over:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, dec_eaxsize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next1:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;&gt;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, inc_ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, inc_ecxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp;  movsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  .over<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sub&nbsp; &nbsp;  byte, inc_ecxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, inc_ecxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .over:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, inc_ecxsize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next2:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;&lt;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next3<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, dec_ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, dec_ecxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp;  movsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  .over<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sub&nbsp; &nbsp;  byte, dec_ecxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, dec_ecxsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .over:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, dec_ecxsize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next3:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;.&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next4<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, period<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, period_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp;  movsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  .over<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sub&nbsp; &nbsp;  byte, period_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, period_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .over:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx&nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, period_size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next4:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;,&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next5<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; push&nbsp; &nbsp; ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  esi, comma<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, comma_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rep&nbsp; &nbsp;  movsb<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  .over<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sub&nbsp; &nbsp;  byte, comma_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  al, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub&nbsp; &nbsp;  al, comma_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  , al<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .over:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pop&nbsp; &nbsp;  esi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, comma_size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next5:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;[&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next6<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jmp&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; next6:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  al, &quot;]&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  next7<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ax, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stosw<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  edx, edx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add&nbsp; &nbsp;  ecx, 2<br />&nbsp; &nbsp; &nbsp; &nbsp; next7:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp&nbsp; &nbsp;  ecx, codeoutsize<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jne&nbsp; &nbsp;  compile_loop<br /><br />indone:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Write our binary to a file!&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx, &nbsp; &nbsp; &nbsp;  ; File descriptor <br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 8<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, 00644Q&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; CHMOD permisions<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx, eax<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; write system call<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, codeoutbuf<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, codeoutsize<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80&nbsp;  <br />	mov	eax,6	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ; sys_close()<br />	int	80h<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Exit proc.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx, 0<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br />;=============================================================================;<br />; Opcode list, you can change these to output ARM, PPC, 6502, ect.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;<br />;=============================================================================;<br />inc_eax:<br />&nbsp; &nbsp; &nbsp; &nbsp; inc&nbsp; &nbsp;  eax<br />inc_eaxsize equ $-inc_eax<br /><br />dec_eax:<br />&nbsp; &nbsp; &nbsp; &nbsp; dec&nbsp; &nbsp;  eax<br />dec_eaxsize equ $-dec_eax<br /><br />inc_ecx:<br />&nbsp; &nbsp; &nbsp; &nbsp; inc&nbsp; &nbsp;  ecx<br />inc_ecxsize equ $-inc_ecx<br /><br />dec_ecx:<br />&nbsp; &nbsp; &nbsp; &nbsp; dec&nbsp; &nbsp;  ecx<br />dec_ecxsize equ $-dec_ecx<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Loop stuff...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />loop_sys:<br />&nbsp; &nbsp; &nbsp; &nbsp; db 0xE2&nbsp;  ; Short jump!<br />loop_var:<br />&nbsp; &nbsp; &nbsp; &nbsp; db 0xFE&nbsp;  ; jmp $<br />loop_length equ 1<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; Here is our library to handle &quot;.&quot; and &quot;,&quot;... think if it like the&nbsp;  ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ; iostream.h of brainf*** or something...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;---------------------------------------------------------------------;<br />period:<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  [8191], al<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ecx, 8191<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  edx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 4<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  ebx, 1<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br />period_size equ $-period<br />comma:<br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  eax, 3<br />&nbsp; &nbsp; &nbsp; &nbsp; xor&nbsp; &nbsp;  ebx, ebx<br />&nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp;  0x80<br />&nbsp; &nbsp; &nbsp; &nbsp; ;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp;  EAX nao holds our keypress!<br />&nbsp; &nbsp; &nbsp; &nbsp; ;<br />comma_size equ $-comma<br /><br />putc:<br />push edx<br />push ecx<br />push ebx<br />push eax ; &quot;buffer&quot;<br /><br />mov ecx, esp<br />mov edx, 1<br />mov ebx, 1<br />mov eax, 4<br />int 80h<br /><br />pop eax<br />pop ebx<br />pop ecx<br />pop edx<br />ret<br /><br />;=============================================================================;<br />section .bss<br />;=============================================================================;<br />&nbsp; &nbsp; &nbsp; &nbsp; codeinbuf&nbsp; resb 32768&nbsp; &nbsp; &nbsp; &nbsp; ; This is we the source code gets loaded.<br />&nbsp; &nbsp; &nbsp; &nbsp; codeoutbuf resb 8192&nbsp; &nbsp; &nbsp; &nbsp;  ; This is were the finished binary goes.<br />insize resd 1<br /></code></pre><br /><br />This isn&#039;t going to work in Linux:<br /><pre><code><br />&nbsp; &nbsp; &nbsp; &nbsp; mov&nbsp; &nbsp;  [8191], al<br /></code></pre><br />but perhaps it isn&#039;t intended to?<br /><br />Anyway, see if those minor changes helped any...<br /><br />Edit: removed a &quot;bad word&quot; from a comment in the code.<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2011-10-18 16:14:19 by fbkotler</div>
   </div>
   <div class="post" id="post-215254">
    <div class="subject"><a href="#post-215254">Re: Segmentation fault issue</a></div>
    <div class="body">My mistake. It IS writing the output file with &quot;correct&quot;(?) code in it.<br /><br />On looking at this further, we don&#039;t need to resort to the writeable text section trick. What you&#039;re writing to is &quot;code&quot;, but it doesn&#039;t get executed here, merely copied to a buffer, and written to a file to be executed at some future date. That stuff could be in your &quot;.data&quot; section.<br /><br />The resulting binary is, in fact, 8192 bytes long - the full &quot;codeoutsize&quot;. You probably want to calculate the actual size of the code copied to the buffer and write just that size to the .bin file.<br /><br />Do you propose to eventually put an ELF header on the resulting executable? Is it up to the author of the BF program to provide a clean exit, or should that be written to the executable by default? I&#039;m not familiar with the workings and conventions of BF.<br /><br />We have a &quot;problem&quot; with the name of this language. This is a &quot;family&quot; Forum. The real problem is that here in the &quot;Land of the Free and the Home of the Brave&quot; (and probably other places) schools and libraries and stuff are required to be provided with &quot;filters&quot; to protect the kiddies from... whatever they&#039;re at risk from... the abbreviation for &quot;firetruck&quot;... We don&#039;t want to trigger any filters and get blocked! I just went back and edited a comment in the code (iostream library for...). You might want to do the same, just to keep it &quot;squeaky-clean&quot; around here...<br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2011-10-19 04:44:04 by fbkotler</div>
   </div>
   <div class="post" id="post-215256">
    <div class="subject"><a href="#post-215256">Re: Segmentation fault issue</a></div>
    <div class="body">First off I am sorry! I thought I had removed all the &quot;****&quot; from my code, I guess I missed a spot, so I fixed it!<br /><br />Second, I plan to make it run on Linux when I am done as-well as exiting properly. Right now some of the code generated is just a place holder so I can&nbsp; run ndisasm and check the compiled output&nbsp; :)<br /><br />And I guess I didn&#039;t take into consideration that I was writing to a read only section... Thank you very much! Thanks for pointing everything out, the error is gone now and generated code looks correct :D<br /><br />Also on a side I really like that putc fuction you put in the code above, I have never thought of pushing letter to print onto the stack then pointing ESP as the string... Very nice, that solves the placeholder &quot;mov&nbsp; &nbsp;  [8191], al&quot;&nbsp; :D<br /><br />How &quot;compile_loop&quot; loop exits is it compares ECX with maximum code buffer size, if it&#039;s equile it exits, the problem with this is it was implemented before &quot;,&quot;, &quot;.&quot;, &quot;[&quot; and &quot;]&quot; was added so it could easily over flow the buffer... Since those are multibyte instructions...<br /><br />Thanks for all your help fbkotler!<br /><br /></div>
    <div class="meta">Posted on 2011-10-19 07:44:53 by Coty</div>
   </div>
   <div class="post" id="post-216048">
    <div class="subject"><a href="#post-216048">Re: Segmentation fault issue</a></div>
    <div class="body">is these asembly code in intel-formated or at&amp;t-formated?<br /><br /> mov&nbsp; &nbsp;  , eax&nbsp;  //in at&amp;t formated<br /><br />but&nbsp;  <br /><br />&nbsp; mov&nbsp; &nbsp;  eax,&nbsp; 5&nbsp; &nbsp; &nbsp; &nbsp; //in intel formated</div>
    <div class="meta">Posted on 2012-06-20 00:26:35 by puttyios</div>
   </div>
   <div class="post" id="post-216051">
    <div class="subject"><a href="#post-216051">Re: Segmentation fault issue</a></div>
    <div class="body">Those appear to be Intel syntax... except the comment character &quot;//&quot; is wrong.<br /><br />Nasm syntax:<br /><pre><code><br />; nasm -f elf32 hw.asm<br />; ld -o hw hw.o<br />global _start<br /><br />section .data<br />msg db &#039;Hello, world&#039;,0Ah<br />msg_len equ $-msg<br /><br />section .text<br />_start:<br /><br />mov eax,4<br />mov ebx,1<br />mov ecx, msg<br />mov edx,msg_len<br />int 80h<br /><br />mov eax,1<br />int 80h<br /></code></pre><br /><br />AT&amp;T (Gas) syntax:<br /><pre><code><br />.global _start<br /><br />.text<br />_start:<br />&nbsp; &nbsp; movl $4, %eax<br />&nbsp; &nbsp; movl $1, %ebx<br />&nbsp; &nbsp; movl $msg, %ecx<br />&nbsp; &nbsp; movl $msg_len, %edx<br />&nbsp; &nbsp; int&nbsp; $0x80<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; movl %eax, %ebx<br />&nbsp; &nbsp; movl $1, %eax<br />&nbsp; &nbsp; int&nbsp; $0x80<br /><br />.data<br />&nbsp; &nbsp; msg: .ascii &quot;Hello World!\n&quot;<br />&nbsp; &nbsp; msg_len = . - msg<br /></code></pre>&nbsp; &nbsp; <br /><br />And just to really confuse the issue, (G)as with the &quot;.intel_syntax&quot; directive:<br /><pre><code><br />.global _start<br />.intel_syntax noprefix<br /><br />.section data<br />&nbsp; &nbsp; msg .string &quot;hello, from gas&quot;<br />&nbsp; &nbsp; msg_len = . - msg<br /><br />.section text<br />_start:<br /><br />&nbsp; &nbsp; mov eax, 4<br />&nbsp; &nbsp; mov ebx, 1<br />&nbsp; &nbsp; mov ecx, msg<br />&nbsp; &nbsp; mov edx, msg_len<br />&nbsp; &nbsp; int 0x80<br /><br />&nbsp; &nbsp; xor eax,eax<br />&nbsp; &nbsp; inc eax<br />&nbsp; &nbsp; int 0x80<br /></code></pre><br /><br />Best,<br />Frank<br /><br /></div>
    <div class="meta">Posted on 2012-06-20 10:40:07 by fbkotler</div>
   </div>
  </div>
 </body>
</html>