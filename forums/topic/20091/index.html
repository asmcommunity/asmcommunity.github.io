<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>browser click monitoring - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=20091" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=20091">browser click monitoring</a></p>
   <div class="post" id="post-153954">
    <div class="subject"><a href="#post-153954">browser click monitoring</a></div>
    <div class="body">hello, <br /><br />I am trying to implement browser (IE) file-click monitoring feature for my application (i.e. like in misc. download managers), but truly speaking I don't know where to start. My guess is so far is to intercept some procedure that responsible for this. But which one? Or is there any other way to do this?</div>
    <div class="meta">Posted on 2004-12-09 10:33:00 by arafel</div>
   </div>
   <div class="post" id="post-153967">
    <div class="subject"><a href="#post-153967">browser click monitoring</a></div>
    <div class="body">ahh nevermind. found a couple of solutions :-D <br />assembler or c code snippets of APP implementations are highly welcome though :)</div>
    <div class="meta">Posted on 2004-12-09 14:32:40 by arafel</div>
   </div>
   <div class="post" id="post-153984">
    <div class="subject"><a href="#post-153984">browser click monitoring</a></div>
    <div class="body">Test_1BrowseFolder.asm<br /><pre><code>;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />externdef                    IID_IUnknown&#58;IID<br />LPUNKNOWN                    typedef DWORD<br />LPPUNKNOWN                   typedef ptr LPUNKNOWN<br /><br />IUnknown_QueryInterfaceProto typedef proto &#58;DWORD, &#58;DWORD, &#58;DWORD<br />IUnknown_AddRefProto         typedef proto &#58;DWORD<br />IUnknown_ReleaseProto        typedef proto &#58;DWORD<br />IUnknown_QueryInterface      typedef ptr IUnknown_QueryInterfaceProto<br />IUnknown_AddRef              typedef ptr IUnknown_AddRefProto<br />IUnknown_Release             typedef ptr IUnknown_ReleaseProto<br /><br />IUnknown struct DWORD<br />      QueryInterface    IUnknown_QueryInterface  ?<br />      AddRef            IUnknown_AddRef          ?<br />      Release           IUnknown_Release         ?<br />IUnknown ends<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />externdef                    IID_IMalloc&#58;IID<br />LPMALLOC                     typedef DWORD<br />LPPMALLOC                    typedef ptr LPMALLOC<br /><br />IMalloc_AllocProto           typedef proto &#58;DWORD, &#58;DWORD<br />IMalloc_ReallocProto         typedef proto &#58;DWORD, &#58;DWORD, &#58;DWORD<br />IMalloc_FreeProto            typedef proto &#58;DWORD, &#58;DWORD<br />IMalloc_GetSizeProto         typedef proto &#58;DWORD, &#58;DWORD<br />IMalloc_DidAllocProto        typedef proto &#58;DWORD, &#58;DWORD<br />IMalloc_HeapMinimizeProto    typedef proto &#58;DWORD<br /><br />IMalloc_Alloc                typedef ptr IMalloc_AllocProto<br />IMalloc_Realloc              typedef ptr IMalloc_ReallocProto<br />IMalloc_Free                 typedef ptr IMalloc_FreeProto<br />IMalloc_GetSize              typedef ptr IMalloc_GetSizeProto<br />IMalloc_DidAlloc             typedef ptr IMalloc_DidAllocProto<br />IMalloc_HeapMinimize         typedef ptr IMalloc_HeapMinimizeProto<br /><br />IMalloc struct DWORD<br />      QueryInterface    IUnknown_QueryInterface  ?<br />      AddRef            IUnknown_AddRef          ?<br />      Release           IUnknown_Release         ?<br />      Alloc             IMalloc_Alloc            ?<br />      Realloc           IMalloc_Realloc          ?<br />      Free              IMalloc_Free             ?<br />      GetSize           IMalloc_GetSize          ?<br />      DidAlloc          IMalloc_DidAlloc         ?<br />      HeapMinimize      IMalloc_HeapMinimize     ?<br />IMalloc ends<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.data?<br />_BrowseFolderTmp dd	?<br /><br />.const<br />_szDirInfo	db	'Please select the Path?',0<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.code<br />_BrowseFolderCallBack	proc	hWnd,uMsg,lParam,lpData<br />			local	@szBuffer&#91;260&#93;&#58;byte<br /><br />		mov	eax,uMsg<br />		.if	eax ==	BFFM_INITIALIZED<br />			invoke	SendMessage,hWnd,BFFM_SETSELECTION,TRUE,_BrowseFolderTmp<br />		.elseif	eax ==	BFFM_SELCHANGED<br />			invoke	SHGetPathFromIDList,lParam,addr @szBuffer<br />			invoke	SendMessage,hWnd,BFFM_SETSTATUSTEXT,0,addr @szBuffer<br />		.endif<br />		xor	eax,eax<br />		ret<br /><br />_BrowseFolderCallBack	endp<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />_BrowseFolder	proc	_hWnd,_lpszBuffer<br />		local	@stBrowseInfo&#58;BROWSEINFO<br />		local	@stMalloc<br />		local	@pidlParent,@dwReturn<br /><br />		pushad<br /><br />		invoke	CoInitialize,NULL<br />		invoke	SHGetMalloc,addr @stMalloc<br />		.if	eax == E_FAIL<br />			mov	@dwReturn,FALSE<br />			jmp	@F<br />		.endif<br /><br />		invoke	RtlZeroMemory,addr @stBrowseInfo,sizeof @stBrowseInfo<br />;-------------------------------------------------------------------------<br /><br />		push	_hWnd<br />		pop	@stBrowseInfo.hwndOwner<br />		push	_lpszBuffer<br />		pop	_BrowseFolderTmp<br />		mov	@stBrowseInfo.lpfn,offset _BrowseFolderCallBack<br />		mov	@stBrowseInfo.lpszTitle,offset _szDirInfo<br />		mov	@stBrowseInfo.ulFlags,BIF_RETURNONLYFSDIRS or BIF_STATUSTEXT<br />		invoke	SHBrowseForFolder,addr @stBrowseInfo<br />		mov	@pidlParent,eax<br />		.if	eax !=	NULL<br />			invoke	SHGetPathFromIDList,eax,_lpszBuffer<br />			mov	eax,TRUE<br />		.else<br />			mov	eax,FALSE<br />		.endif<br />		mov	@dwReturn,eax<br />		mov	eax,@stMalloc<br />		mov	eax,&#91;eax&#93;<br />		invoke	&#40;IMalloc PTR &#91;eax&#93;&#41;.Free,@stMalloc,@pidlParent<br />		mov	eax,@stMalloc<br />		mov	eax,&#91;eax&#93;<br />		invoke	&#40;IMalloc PTR &#91;eax&#93;&#41;.Release,@stMalloc<br /><br />		@@&#58;<br />		invoke	CoUninitialize<br />		popad<br />		mov	eax,@dwReturn<br />		ret<br /><br />_BrowseFolder	endp<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code></pre><br />;@echo off<br />;goto make<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />		.386<br />		.model flat,stdcall<br />		option casemap:none<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />include		\masm32\include\windows.inc<br />include		\masm32\include\user32.inc<br />includelib	\masm32\lib\user32.lib<br />include		\masm32\include\kernel32.inc<br />includelib	\masm32\lib\kernel32.lib<br />include		\masm32\include\shell32.inc<br />includelib	\masm32\lib\shell32.lib<br />include		\masm32\include\ole32.inc<br />includelib	\masm32\lib\ole32.lib<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.data?<br />szPath		db	MAX_PATH dup (?)<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.data<br />szSelect	db	'Path that you selected',0<br />szNoSelect	db	'You push the CANCEL button',0<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />.code<br /><br />include		Test_1BrowseFolder.asm<br /><br />start:<br />		invoke	GetCurrentDirectory,sizeof szPath,addr szPath<br />		invoke	_BrowseFolder,NULL,addr szPath<br />		.if	eax<br />			invoke	MessageBox,NULL,offset szPath,offset szSelect,MB_OK<br />		.else<br />			invoke	MessageBox,NULL,offset szNoSelect,NULL,MB_OK<br />		.endif<br />		invoke	ExitProcess,NULL<br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br /><br />end	start<br /><br />;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br />:make<br />set name=Test_BrowseFolder<br /><br />    \masm32\bin\ml /c /coff %name%.bat<br />    \masm32\bin\Link /subsystem:windows %name%.obj<br />    if exist %name%.bak del *.bak<br />    if exist %name%.obj del *.obj<br />    echo.</div>
    <div class="meta">Posted on 2004-12-10 02:55:16 by dcskm4200</div>
   </div>
  </div>
 </body>
</html>