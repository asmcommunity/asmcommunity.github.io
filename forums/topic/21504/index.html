<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>CreateDC implimentation issues - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=21504" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=21504">CreateDC implimentation issues</a></p>
   <div class="post" id="post-162413">
    <div class="subject"><a href="#post-162413">CreateDC implimentation issues</a></div>
    <div class="body">First post, not quite as epic as I&#39;d hoped for, and first off sorry to whoever the guy/girl who registered &quot;clone&quot;, &#39;tis a shame it was already taken, for my login has always been clone elsewhere, nevermind that, onto my problem.<br /><br />I&#39;m using MASM32 as my assembler here, and I quickly written out this function to make usable device contexts of a specific size  Here is my code:<br /><pre><code><br />MakeDC proc eX:DWORD,eY:DWORD,bmpH:DWORD<br />;Function to make a HDC, returns a handle to it.<br />;Input is X and Y widths in PX<br />;bmpH is used so I have a handle to the bmp... needed for me to delete it on cleanup.<br />	LOCAL DCTMP:DWORD<br />	invoke CreateCompatibleDC,0<br />	mov DCTMP,eax	;store our DC <br />	invoke CreateCompatibleBitmap,DCTMP,eX,eY	;makes a BMP&nbsp; of given width, on our given DC object.<br />	mov bmpH,eax<br />	invoke SelectObject,DCTMP,bmpH	;applies BMP to DC. &#39;tis now ready for drawing etc.<br />	mov eax,DCTMP ;copy handle to register.<br />	.if eax == 0<br />		invoke MessageBox,0,SADD(&quot;Could not make DC&quot;),SADD(&quot;Dbg&quot;),MB_OK ;display error if NULL, for debugging<br />	.endif<br />	ret&nbsp; ;we are done.<br />MakeDC endp<br /></code></pre><br /><br />Alright, but I&#39;m having some problems using this in my code, everything seems to work okay, apart from the fact the resulting DC only supports monochrome. I have no idea why this is, that code is basically a re-make of a function I used to use in Visual Basic for the purpose of making DCs, and I never had a monochrome one before <br /><br />So then, I swapped the line<br /><pre><code>	invoke CreateCompatibleDC,0</code></pre><br /><br />with<br /><pre><code>invoke CreateDC,SADD(&quot;DISPLAY&quot;),0,0,0</code></pre><br />this produced a coloured DC! Of course, the problem is with that... a copy of it is also displayed at the top left of the screen, but at least I know where the problem is now.<br />Do any of you know what I should do about all this? Do you know of some way I can fix CreateCompatibleDC? Or is there a way of using CreateDC without it getting flicked over to the screen?<br /><br />It&#39;s not so important  but in-case you&#39;re wondering what I&#39;m using this for -- I am making a very basic game [300 lines and counting] and I&#39;m using this code to create me a back buffer of the same size of my dialogue window.<br /><br />I have some more lesser issues that I&#39;d also appreciate any advice on, my game works by setting a timer function when the window is initiated, this timer basically works at 30 calls per seconds -- give or take a few -- I&#39;m noticing that my blitted  backbuffer flickers once or twice every 10 seconds , this is not such a big issue as this is my first project to get a feel for the language, but I&#39;d like to get rid of this, am I right in thinking my gripe is with WM_PAINT or whatever it is? But I guess I can leave this minor issue &#39;till later, I think sorting out the backbuffer should be my priority.<br />My second minor issue is I need to remove the little X in the top right of my small dialogue, although my backbuffer blits directly over the caption and the X, I guess it&#39;d be an issue if the user accidentally clicks his/her mouse there, heh. I&#39;m guessing I&#39;ll be able to find more on this one by reading the MASM32 realtime dialogue help.<br /><br />Thanks for any advice you can provide on this one, I&#39;m grateful.<br /><br />//out</div>
    <div class="meta">Posted on 2005-07-23 19:44:28 by //clone</div>
   </div>
   <div class="post" id="post-162414">
    <div class="subject"><a href="#post-162414">Re: CreateDC implimentation issues</a></div>
    <div class="body">Those two functions are old and error proofed ;)<br /><br /><pre><code><br />;==============================================<br />;? GetCompatibleBitmap<br />;==============================================<br />;? This is used to create DC&#39;s for BackBuffers, ImageDC etc...<br />;? invoke GetCompatibleBitmap, ADDR ImageDC, ADDR hImageDC, hwnd, 500, 300<br />;==============================================<br />GetCompatibleBitmap proc AnotherDC:DWORD, HandleOfDC:DWORD, hwnd:DWORD, xPos:DWORD, yPos:DWORD<br />invoke CreateCompatibleDC,NULL<br />mov edx,AnotherDC<br />push eax<br />mov ,eax<br />invoke GetDC,hwnd<br />push eax<br />invoke CreateCompatibleBitmap,eax,xPos,yPos<br />mov edx,HandleOfDC<br />mov ecx,;pop ecx<br />mov ,eax;push eax<br />mov ,eax<br />invoke ReleaseDC,hwnd,ecx<br />pop eax;HandleOfDC<br />pop ecx;AnotherDC<br />invoke SelectObject,ecx,eax<br />ret<br />GetCompatibleBitmap endp<br /><br />;==============================================<br />;? ?GetBitmapDC<br />;==============================================<br />;? This is used to create DC&#39;s for Bitmaps<br />;? invoke GetBitmapDC, ADDR BitmapDC, ADDR NameOfBitmap, ADDR hBitmap, hwnd<br />;==============================================<br />GetBitmapDC proc AnotherDC:DWORD, BitmapADDR:DWORD,HandleOfBitmap:DWORD, hwnd:DWORD<br />invoke GetDC,hwnd<br />push eax														;1 push DC for release later<br />invoke CreateCompatibleDC,eax<br />mov edx,AnotherDC<br />push eax														;2 push DC for SelectObject<br />mov ,eax<br />invoke LoadBitmap,hInstance,BitmapADDR<br />mov edx,HandleOfBitmap<br />pop ecx														;2 pop Created DC<br />mov ,eax<br />invoke SelectObject,ecx,eax<br />pop eax														;1 pop DC to release<br />invoke ReleaseDC,hwnd,eax<br />ret<br />GetBitmapDC endp</code></pre><br /><br />To eliminate the flicker do ALL your painting on the backbufferDC, and only in the last line of Wm_Paint blit the backbufferDC to the DisplayDC.<br />If you need to redraw use InvalidateRect,0,<strong>FALSE</strong> to make it redraw. <br /><br />For the Dialog blitting over the  why not make a Dialog without a Caption? Use WS_POPUPWINDOW as style.<br /><br />A good tut for any kind of game (Tile based) is available on www.madwizard.org and it&#39;s called Mosaic Game. This tut explains in great detail a lot of things you will be needing along the way.</div>
    <div class="meta">Posted on 2005-07-23 20:01:17 by JimmyClif</div>
   </div>
   <div class="post" id="post-162416">
    <div class="subject"><a href="#post-162416">Re: CreateDC implimentation issues</a></div>
    <div class="body">I really was not expecting such a detailed repply so soon! Thanks for taking the time and helping me out.... I guess you can tell I&#39;m new to all this -- I&#39;ll definitely check out that website for more info.<br /><br />cheers.</div>
    <div class="meta">Posted on 2005-07-23 20:20:45 by //clone</div>
   </div>
  </div>
 </body>
</html>