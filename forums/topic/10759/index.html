<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Need help with strings. - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=10759" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=10759">Need help with strings.</a></p>
   <div class="post" id="post-80947">
    <div class="subject"><a href="#post-80947">Need help with strings.</a></div>
    <div class="body">Im new to asm. Most of this code is from one of Iczelion's tutorials. <br /><br /><br /><br /><br /><br /><br />.data<br />ClassName db &quot;SimpleWinClass&quot;,0<br />AppName  db &quot;Galahad Search&quot;,0<br />MenuName db &quot;FirstMenu&quot;,0<br />ButtonClassName db &quot;button&quot;,0<br />ButtonText db &quot;SEARCH&quot;,0<br />EditClassName db &quot;edit&quot;,0<br />hIconImage  dd 0<br />hIcon       dd 0<br />szOpen     db &quot;open&quot;,0<br />szUrl      db &quot;http://www.google.com/search?num=100&amp;hl=en&amp;as_q=&quot;,0<br /><br /><br />.data?<br />hInstance HINSTANCE ?<br />CommandLine LPSTR ?<br />hwndButton HWND ?<br />hwndEdit HWND ?<br />buffer db 512,0 dup(?)<br /><br /><br /><br /><br />.const<br />ButtonID equ 1<br />EditID equ 2<br />IDM_EXIT equ 1<br /><br />.code<br /><br /><br />start:<br />	invoke GetModuleHandle, NULL<br />	mov    hInstance,eax<br />	invoke GetCommandLine<br />	invoke WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT<br />	invoke ExitProcess,eax<br />WinMain proc hInst:HINSTANCE,hPrevInst:HINSTANCE,CmdLine:LPSTR,CmdShow:DWORD<br />	LOCAL wc:WNDCLASSEX<br />	LOCAL msg:MSG<br />	LOCAL hwnd:HWND<br />	mov   wc.cbSize,SIZEOF WNDCLASSEX<br />	mov   wc.style, CS_HREDRAW or CS_VREDRAW<br />	mov   wc.lpfnWndProc, OFFSET WndProc<br />	mov   wc.cbClsExtra,NULL<br />	mov   wc.cbWndExtra,NULL<br />	push  hInst<br />	pop   wc.hInstance<br />	mov   wc.hbrBackground,COLOR_BTNFACE+1<br />	mov   wc.lpszMenuName,OFFSET MenuName<br />	mov   wc.lpszClassName,OFFSET ClassName<br />	invoke LoadIcon,NULL,IDI_APPLICATION<br />	mov   wc.hIcon,eax<br />	mov   wc.hIconSm,eax<br />	invoke LoadCursor,NULL,IDC_ARROW<br />	mov   wc.hCursor,eax<br />	invoke RegisterClassEx, addr wc<br />	INVOKE CreateWindowEx,WS_EX_APPWINDOW,ADDR ClassName,ADDR AppName,\<br />           WS_OVERLAPPEDWINDOW,CW_USEDEFAULT,\<br />           CW_USEDEFAULT,300,200,NULL,NULL,\<br />           hInst,NULL<br />	mov   hwnd,eax<br />	INVOKE ShowWindow, hwnd,SW_SHOWNORMAL<br />	INVOKE UpdateWindow, hwnd<br />	.WHILE TRUE<br />                INVOKE GetMessage, ADDR msg,NULL,0,0<br />                .BREAK .IF (!eax)<br />                INVOKE TranslateMessage, ADDR msg<br />                INVOKE DispatchMessage, ADDR msg<br /><br /><br />    <br /><br />	.ENDW<br /><br /><br />	ret<br />WinMain endp<br /><br /><br /><br />WndProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br /><br /><br /><br /><br /><br />	.IF uMsg==WM_DESTROY<br />		invoke PostQuitMessage,NULL<br />	.ELSEIF uMsg==WM_CREATE<br />		invoke CreateWindowEx,WS_EX_PALETTEWINDOW, ADDR EditClassName,NULL,\<br />                        WS_CHILD or WS_VISIBLE or WS_BORDER or ES_LEFT or\<br />                        ES_AUTOHSCROLL,\<br />                        50,35,200,25,hWnd,EditID,hInstance,NULL<br />		mov  hwndEdit,eax<br />		invoke SetFocus, hwndEdit<br />		invoke CreateWindowEx,NULL, ADDR ButtonClassName,ADDR ButtonText,\<br />                        WS_CHILD or WS_VISIBLE or BS_DEFPUSHBUTTON,\<br />                        75,70,140,25,hWnd,ButtonID,hInstance,NULL<br />		mov  hwndButton,eax<br /><br /><br />	.ELSEIF uMsg==WM_COMMAND<br />		mov eax,wParam<br />		.IF lParam==0<br />			.IF ax==IDM_EXIT<br />			<br />	        <br />				invoke DestroyWindow,hWnd<br />			.ENDIF<br />		.ELSE<br />			.IF ax==ButtonID<br />				shr eax,16<br />				.IF ax==BN_CLICKED<br />			        invoke GetWindowText,hwndEdit,ADDR buffer,512<br />                                invoke szCatStr, addr szUrl, addr buffer<br />                                invoke ShellExecute, NULL, addr szOpen,addr szUrl,0, NULL, SW_SHOWMAXIMIZED<br />                              <br /><br /><br /><br />			        .ENDIF<br />			.ENDIF<br />		.ENDIF<br />	.ELSE<br />		invoke DefWindowProc,hWnd,uMsg,wParam,lParam<br />		ret<br />	.ENDIF<br />	xor    eax,eax<br />	ret<br /><br />WndProc endp<br /><br /><br /><br /><br /><br /><br /><br />My problem is after a search i dont know how to reset szUrl to its original value.<br />Any help is appreciated.</div>
    <div class="meta">Posted on 2003-02-10 19:00:37 by sample</div>
   </div>
   <div class="post" id="post-80966">
    <div class="subject"><a href="#post-80966">Need help with strings.</a></div>
    <div class="body"><pre><code>invoke szCatStr, addr szUrl, addr buffer</code></pre><br />That line is appending whatever string is in 'buffer' to 'szUrl' and it is impossible to &quot;reset&quot; the string to its original state, unless you record the length of the string before hand... but thats a little unorthodox, it is better to just create another string...<br /><pre><code>szNewUrl db 512 dup&#40;?&#41;</code></pre><br />add that to your data section<br /><pre><code>invoke szCpyStr, addr szNewUrl, addr szUrl                                       &#91;color=green&#93;; Make a duplicate of szUrl&#91;/color&#93;<br />invoke szCatStr, addr szNewUrl, addr buffer                                      &#91;color=green&#93;; append 'buffer' to the duplicate&#91;/color&#93;<br />invoke ShellExecute, NULL, addr szOpen,addr szNewUrl,0, NULL, SW_SHOWMAXIMIZED   &#91;color=green&#93;; use szNewUrl instead of szUrl&#91;/color&#93;</code></pre></div>
    <div class="meta">Posted on 2003-02-10 20:14:01 by BubbaFate</div>
   </div>
   <div class="post" id="post-80968">
    <div class="subject"><a href="#post-80968">Need help with strings.</a></div>
    <div class="body">If you want to reset szUrl to it's original value then you must store the value before changing it.<br /><br />or you can do somehing like this:<br /><pre><code><br />.data<br />szUrl db &quot;http&#58;//www.google.com/search?num=100&amp;hl=en&amp;as_q=&quot; ;_NOTe No NULL terminator!<br />buffer  db 512 dup &#40;0&#41;<br /><br />.code<br /><br />;fill in code here<br />invoke GetWindowText,hwndEdit,ADDR buffer,512<br />invoke ShellExecute, NULL, addr szOpen,addr szUrl,0, NULL, SW_SHOWMAXIMIZED<br />;fill in more code here</code></pre><br /><br />your exe will be 512 bytes larger because buffer is now in the initialised section.<br /><br />With the above code you won't have to make a call to szCatStr. szUrl does not have NULL terminator so by declaring buffer directly after it, GetWindowText effectively appends the window text to the end of szUrl.<br /><br />so if the edit control had in <em>pr0rn</em> then after the call to GetWindowText <br />szUrl would be <em>http://www.google.com/search?num=100&amp;hl=en&amp;as_q=pr0rn</em><br />the original szUrl is always preserved.</div>
    <div class="meta">Posted on 2003-02-10 20:18:24 by MArtial_Code</div>
   </div>
   <div class="post" id="post-80983">
    <div class="subject"><a href="#post-80983">Need help with strings.</a></div>
    <div class="body">thanks guys, that got it</div>
    <div class="meta">Posted on 2003-02-10 21:34:06 by sample</div>
   </div>
  </div>
 </body>
</html>