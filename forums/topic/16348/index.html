<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>masm proc - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=16348" />
    <link rel="next" href="../?id=16348&amp;page=2" /> </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=16348">masm proc</a></p>
<form class="pagination" action="../" method="get"><a href="../?id=16348&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=16348&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="16348" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=16348&amp;page=2">&gt;</a><a href="../?id=16348&amp;page=2">&raquo;</a></form>   <div class="post" id="post-126945">
    <div class="subject"><a href="#post-126945">masm proc</a></div>
    <div class="body">hi all !   <br /><br />i was using MASM and testing this in side a proc .  and this does not work :<br /><br /><br />TestProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />	<br />  LOCAL opf:OPENFILENAMEA<br /> <br />  mov opf.lStructSize, SIZEOF OPENFILENAME <br />  invoke GetOpenFileNameA,addr opf<br /><br />xor eax,eax<br />ret<br />TestProc endp<br /><br /><br /><br />then i tried this , and works fine :<br /><br /><br />.data<br />opf	OPENFILENAME &lt;?&gt;<br /><br /><br />TestProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />	<br /><br />  mov opf.lStructSize, SIZEOF OPENFILENAME <br />  invoke GetOpenFileNameA,addr opf<br /><br />xor eax,eax<br />ret<br />TestProc endp<br /><br /><br /><br /><br />why the local does not work ??  and when in data works ?</div>
    <div class="meta">Posted on 2003-12-07 16:40:58 by Nguga</div>
   </div>
   <div class="post" id="post-126953">
    <div class="subject"><a href="#post-126953">masm proc</a></div>
    <div class="body">.text:00401118 sub_401118      proc near               ; DATA XREF: sub_401031+14o<br />.text:00401118 <br />.text:00401118 var_4C          = tagOFNA ptr -4Ch<br />.text:00401118 hWnd            = dword ptr  8<br />.text:00401118 Msg             = dword ptr  0Ch<br />.text:00401118 wParam          = dword ptr  10h<br />.text:00401118 lParam          = dword ptr  14h<br />.text:00401118 <br />.text:00401118                 push    ebp<br />.text:00401119                 mov     ebp, esp<br />.text:0040111B                 add     esp, 0FFFFFFB4h<br />.text:0040111E                 mov     , 4Ch<br />.text:00401125                 lea     eax, <br />.text:00401128                 push    eax             ; LPOPENFILENAMEA<br />.text:00401129                 call    GetOpenFileNameA<br /><br /><br />this is the assembly that MASM outputs <br /><br /><br />just to help</div>
    <div class="meta">Posted on 2003-12-07 17:22:36 by Nguga</div>
   </div>
   <div class="post" id="post-126954">
    <div class="subject"><a href="#post-126954">make me like NASM</a></div>
    <div class="body">by the way the assembly output looks NASM code :)</div>
    <div class="meta">Posted on 2003-12-07 17:23:52 by Nguga</div>
   </div>
   <div class="post" id="post-126960">
    <div class="subject"><a href="#post-126960">masm proc</a></div>
    <div class="body"><strong>Nguga</strong><br />need clean <em>opf</em>, eg<pre><code>invoke RtlZeroMemory, addr opf, sizeof opf<br />mov opf.lStructSize, sizeof opf</code></pre></div>
    <div class="meta">Posted on 2003-12-07 19:45:38 by P2M</div>
   </div>
   <div class="post" id="post-126962">
    <div class="subject"><a href="#post-126962">sapciva</a></div>
    <div class="body">Spaciva VAM !</div>
    <div class="meta">Posted on 2003-12-07 19:58:17 by Nguga</div>
   </div>
   <div class="post" id="post-126965">
    <div class="subject"><a href="#post-126965">mmmm...</a></div>
    <div class="body">i come to this conclusion , that   LOCALS  make the code much more bigger then not using locals.<br /><br />TestProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br />LOCAL opf:OPENFILENAMEA<br /><br />invoke RtlZeroMemory, addr opf, sizeof opf<br />mov opf.lStructSize,sizeof opf <br />invoke GetOpenFileNameA,addr opf<br /><br />xor eax,eax<br />ret<br />TestProc endp<br /><br /><br /><br /><br /><br />lets see the real ASSEMBLY  output that MASM makes of a PROC using LOCALS:<br />=======================================================<br /><br />MASM PROC OUTPUT :<br />.text:00401118 sub_401118      proc near               ; DATA XREF: sub_401031+14o<br />.text:00401118 <br />.text:00401118 var_4C          = tagOFNA ptr -4Ch<br />.text:00401118 hWnd            = dword ptr  8<br />.text:00401118 Msg             = dword ptr  0Ch<br />.text:00401118 wParam          = dword ptr  10h<br />.text:00401118 lParam          = dword ptr  14h<br />.text:00401118 <br />.text:00401118                 push    ebp<br />.text:00401119                 mov     ebp, esp<br />.text:0040111B                 add     esp, 0FFFFFFB4h<br />.text:0040111E                 push    4Ch<br />.text:00401120                 lea     eax, <br />.text:00401123                 push    eax<br />.text:00401124                 call    RtlZeroMemory<br />.text:00401129                 mov     , 4Ch<br />.text:00401130                 lea     eax, <br />.text:00401133                 push    eax             ; LPOPENFILENAMEA<br />.text:00401134                 call    GetOpenFileNameA<br /><br /><br /><br /><br />very big mmmmmmmm....<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />============================================<br /><br />============================================<br /><br /><br /><br />if we declare that in DATA like this<br />===========================<br /><br />.data<br />opf OPENFILENAME &lt;?&gt;<br /><br /><br />TestProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM<br /><br />mov opf.lStructSize, sizeof opf<br />invoke GetOpenFileNameA,addr opf<br /><br />xor eax,eax<br />ret<br />TestProc endp<br /><br /><br /><br /><br />The Real assembly ouput of MASM is litle !:<br />==============================<br /><br />.text:00401118 sub_401118      proc near               ; DATA XREF: sub_401031+14o<br />.text:00401118 <br />.text:00401118 hWnd            = dword ptr  8<br />.text:00401118 Msg             = dword ptr  0Ch<br />.text:00401118 wParam          = dword ptr  10h<br />.text:00401118 lParam          = dword ptr  14h<br />.text:00401118 <br />.text:00401118                 push    ebp<br />.text:00401119                 mov     ebp, esp<br />.text:0040111B                 mov     dword_403019, 4Ch<br />.text:00401125                 push    offset dword_403019 ; LPOPENFILENAMEA<br />.text:0040112A                 call    GetOpenFileNameA<br /><br /><br /><br />well i supose it is much more litle and it was only one LOCAL .....<br /><br /><br /><br />============================================<br /><br />============================================<br /><br /><br />after this i ask YOU all why use LOCALS ???<br /><br />well i can code enterely without LOCALS  , and is much more easy to do it<br />becouse i can use that everywere and can make new ones if i always need ...<br />so i do not see the point of using them :)</div>
    <div class="meta">Posted on 2003-12-07 21:34:18 by Nguga</div>
   </div>
   <div class="post" id="post-126966">
    <div class="subject"><a href="#post-126966">masm proc</a></div>
    <div class="body"><strong>Nguga</strong><br /><em>RtlZeroMemory</em> and initialize some members necessary in both case.<br />i prefer local variable.</div>
    <div class="meta">Posted on 2003-12-07 21:51:55 by P2M</div>
   </div>
   <div class="post" id="post-126967">
    <div class="subject"><a href="#post-126967">masm proc</a></div>
    <div class="body">MASM is pretty bad with local variables, the best assembler I have found for locals is GoAsm:<br /><br />With local<br /><br /><pre><code>00401095  /. 55             PUSH EBP<br />00401096  |. 89E5           MOV EBP,ESP<br />00401098  |. 83EC 4C        SUB ESP,4C<br />0040109B  |. 6A 4C          PUSH 4C                                  ; /Length = 4C &#40;76.&#41;<br />0040109D  |. 55             PUSH EBP                                 ; |Destination<br />0040109E  |. 830424 B4      ADD DWORD PTR SS&#58;&#91;ESP&#93;,-4C               ; |<br />004010A2  |. E8 6B4F0000    CALL &lt;JMP.&amp;KERNEL32.RtlZeroMemory&gt;       ; \RtlZeroMemory<br />004010A7  |. C745 B4 4C0000&gt;MOV &#91;LOCAL.19&#93;,4C<br />004010AE  |. 55             PUSH EBP                                 ; /pOpenFileName<br />004010AF  |. 830424 B4      ADD DWORD PTR SS&#58;&#91;ESP&#93;,-4C               ; |<br />004010B3  |. E8 724F0000    CALL &lt;JMP.&amp;comdlg32.GetOpenFileNameA&gt;    ; \GetOpenFileNameA<br />004010B8  |. 31C0           XOR EAX,EAX<br />004010BA  |. 89EC           MOV ESP,EBP<br />004010BC  |. 5D             POP EBP<br />004010BD  \. C2 1000        RETN 10</code></pre><br /><br />With global<br /><br /><pre><code>00401095  /. 55             PUSH EBP<br />00401096  |. 89E5           MOV EBP,ESP<br />00401098  |. 6A 4C          PUSH 4C                                  ; /Length = 4C &#40;76.&#41;<br />0040109A  |. 68 04204000    PUSH DialogBo.00402004                   ; |Destination = DialogBo.00402004<br />0040109F  |. E8 6E4F0000    CALL &lt;JMP.&amp;KERNEL32.RtlZeroMemory&gt;       ; \RtlZeroMemory<br />004010A4  |. C705 04204000 &gt;MOV DWORD PTR DS&#58;&#91;402004&#93;,4C<br />004010AE  |. 68 04204000    PUSH DialogBo.00402004                   ; /pOpenFileName = DialogBo.00402004<br />004010B3  |. E8 724F0000    CALL &lt;JMP.&amp;comdlg32.GetOpenFileNameA&gt;    ; \GetOpenFileNameA<br />004010B8  |. 31C0           XOR EAX,EAX<br />004010BA  |. 5D             POP EBP<br />004010BB  \. C2 1000        RETN 10</code></pre><br /><br />A few extra bytes, for longer procs you actually save space as the overhead is already paid.erw</div>
    <div class="meta">Posted on 2003-12-07 21:57:05 by donkey</div>
   </div>
   <div class="post" id="post-126970">
    <div class="subject"><a href="#post-126970">masm proc</a></div>
    <div class="body">donkey  you sad this :   its not ok.... :)<br /><br />[ With global<br /><br /><br /><br />code:<br /><br />00401095  /. 55             PUSH EBP<br />00401096  |. 89E5           MOV EBP,ESP<br />00401098  |. 6A 4C          PUSH 4C                                  ; /Length = 4C (76.)<br />0040109A  |. 68 04204000    PUSH DialogBo.00402004                   ; |Destination = DialogBo.00402004<br />0040109F  |. E8 6E4F0000    CALL &lt;JMP.&amp;KERNEL32.RtlZeroMemory&gt;       ; \RtlZeroMemory<br />004010A4  |. C705 04204000 &gt;MOV DWORD PTR DS:[402004],4C<br />004010AE  |. 68 04204000    PUSH DialogBo.00402004                   ; /pOpenFileName = DialogBo.00402004<br />004010B3  |. E8 724F0000    CALL &lt;JMP.&amp;comdlg32.GetOpenFileNameA&gt;    ; \GetOpenFileNameA<br />004010B8  |. 31C0           XOR EAX,EAX<br />004010BA  |. 5D             POP EBP<br />004010BB  \. C2 1000        RETN 10 ]<br /><br /><br /><br /><br /><br /><br /><br />we do not need this line in globals :)<br /><br />00401098  |. 6A 4C          PUSH 4C                                  ; /Length = 4C (76.)<br />0040109A  |. 68 04204000    PUSH DialogBo.00402004                   ; |Destination = DialogBo.00402004<br />0040109F  |. E8 6E4F0000    CALL &lt;JMP.&amp;KERNEL32.RtlZeroMemory&gt;       ;<br /><br /><br />less code :)<br /><br /><br /><br /><br />NASM using NAGOA.INC PROC  is like this<br />=============================<br /><br />proc TestProcNAGOA       <br />stack opf,OPENFILENAME_size<br /><br />lea eax,<br />call RtlZeroMemory,eax,OPENFILENAME_size  ; this is needeed :)<br />mov dword ,OPENFILENAME_size<br />lea eax,<br />call GetSaveFileName,eax<br /><br />endproc<br /><br /><br /><br /><br /><br />The NASM  NAGOA output in assembly is:<br />============================<br /><br />code:00402E20 sub_402E20      proc near               ; CODE XREF: start+AF3p<br />code:00402E20 <br />code:00402E20 var_4C          = tagOFNA ptr -4Ch<br />code:00402E20 <br />code:00402E20                 push    ebp<br />code:00402E21                 mov     ebp, esp<br />code:00402E23                 sub     esp, 4Ch<br />code:00402E29                 lea     eax, <br />code:00402E2C                 push    4Ch<br />code:00402E31                 push    eax<br />code:00402E32                 call    ds:RtlZeroMemory<br />code:00402E38                 mov     , 4Ch<br />code:00402E3F                 lea     eax, <br />code:00402E42                 push    eax             ; LPOPENFILENAMEA<br />code:00402E43                 call    ds:GetSaveFileNameA ; Create a Save common dialog box<br />code:00402E49                 leave<br />code:00402E4A                 retn    0<br />code:00402E4A  sub_402E20      endp<br /><br /><br /><br /><br />prety good is not it ? :)</div>
    <div class="meta">Posted on 2003-12-07 22:15:49 by Nguga</div>
   </div>
   <div class="post" id="post-126971">
    <div class="subject"><a href="#post-126971">masm proc</a></div>
    <div class="body">For the RtlZeroMemory, you only don't need it if you have not used the structure before, if you wish to reuse the proc (ie normal usage) it must be done so in reality it has to be included to make a real example.<br /><br />BTW GoAsm with locals is 2 bytes smaller than your NASM example if you look at it, and it doesn't trash eax like MASM and NASM, that is my objection to MASM, sad to see that NASM does the same.</div>
    <div class="meta">Posted on 2003-12-07 22:21:49 by donkey</div>
   </div>
   <div class="post" id="post-127018">
    <div class="subject"><a href="#post-127018">i will change right now NASM NAGOA.INC</a></div>
    <div class="body">THANKS :)<br /><br /><br />i will change the PROC in NASM , , to make it RIGHT !!<br /><br /><br />EBP                                 <br />ADD DWORD PTR SS:,-4C    ; /pOpenFileName   ebp-4C  = OPENFILENAME :)<br /><br />thats wise !!!<br /><br /><br />NASM NAGOA.INC  it will be like this too RIGHT WAY!</div>
    <div class="meta">Posted on 2003-12-08 06:09:40 by Nguga</div>
   </div>
   <div class="post" id="post-127020">
    <div class="subject"><a href="#post-127020">masm proc</a></div>
    <div class="body"><div class="quote">thats wise !!!</div><br />It's Jeremy Gordon who is wise, he wrote what is perhaps the best assembler I have seen to date.</div>
    <div class="meta">Posted on 2003-12-08 06:16:39 by donkey</div>
   </div>
   <div class="post" id="post-127044">
    <div class="subject"><a href="#post-127044">masm proc</a></div>
    <div class="body"><div class="quote">sad to see that NASM does the same</div> No, is the programer, in this case the one that write the macro, now refering to the past...<br /><br />in <a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?s=&amp;postid=86399.msg86399">thx</a>  and <a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?s=&amp;postid=86676.msg86676">hi</a>  in the past, when I was coding I see this posibility, but nobody say me if is more eficient instead of lea, i see now, that I can do de modifications to pass the arguments, doing the suficient manipulation with the ebp or esp register.<br /><br />in fact, can be easy done some like this, if I not remember wrong the names like ..nameOfVar hold the 'displacement' from the ebp register, then using this...<br /><br /><br /><pre><code><br />The important is how it pass the argument in this case locals, to the function to be called<br />code&#58;00402E29 lea eax, &#91;ebp+var_4C&#93;<br />code&#58;00402E2C push 4Ch<br />code&#58;00402E31 push eax<br />code&#58;00402E32 call ds&#58;RtlZeroMemory<br /><br /><br />code&#58;00402E3F lea eax, &#91;ebp+var_4C&#93;<br />code&#58;00402E42 push eax ; LPOPENFILENAMEA<br />code&#58;00402E43 call ds&#58;GetSaveFileNameA ; Create a Save common dialog box<br /><br /><br />--------------------------------------------------------<br /><br />push 4c<br />0040109D  |. 55             PUSH EBP                                 ; |Destination<br />0040109E  |. 830424 B4      ADD DWORD PTR SS&#58;&#91;ESP&#93;,-4C               ; |<br />004010A2  |. E8 6B4F0000    CALL &lt;JMP.&amp;KERNEL32.RtlZeroMemory&gt;       ; \RtlZeroMemory<br /><br /><br />push 4c<br />004010AE  |. 55             PUSH EBP                                 ; /pOpenFileName<br />004010AF  |. 830424 B4      ADD DWORD PTR SS&#58;&#91;ESP&#93;,-4C               ; |<br />004010B3  |. E8 724F0000    CALL &lt;JMP.&amp;comdlg32.GetOpenFileNameA&gt;    ; \GetOpenFileNameA<br /></code></pre><br /><br />Is interesting that he uses this way to pass data, in the past <a target="_blank" href="http://www.asmcommunity.net/board/showthread.php?s=&amp;postid=106097.msg106097">push/pop vs invoke</a> , i remember that when I was coding the macro, i question what will be more fast: lea eax,  or some like mov eax, ebp and sub eax, some<br /><br />now i see that the correct combination is...<br /><br />push ebp<br />sub dword, some_value<br /><br /><br />If i dont remember badly, the 'displacement' from the ebp to the required local is in the name of the local prefixe by two points, for example: <br /><br />local hwnd, HWND<br />local wnd, WNDCLASSEX, msg, MSG<br /><br />the displacement respect the ebp of<br />.hwnd is ..hwnd<br />.wnd is ..wnd<br />.msg is ..msg<br /><br />that in respect is:<br />..hwnd = 0<br />..wnd = 4<br />..msg =  ..hwnd+WNDCLASSEX_size<br /><br /><em><strong>nguga, remember that I use the prefixed point, adn you work for delete it ;), a local of the macro funct is: &quot;.name&quot; and hold some like &quot;ebp-some&quot;, the 'some' is holded in &quot;..name&quot;<br /></strong></em><br /><br />then istead of the combination in nasm of:<br />lea eax,  <em>; or without this expansion: lea eax, [.opf]</em><br />push dword 0x4Ch<br />push eax<br />call ds:RtlZeroMemory<br /><br />it will be:<br />push dword 0x4c<br />push ebp<br />add dword, ..opf<br /><br /><br />and tada!!!, without modifications to the macro proc or funct you have the same thing working, the thing here with nasm is that <em>nasm do what you say to do</em>...<br /><br /><em>If we dont know this strategies, then you can not siply use it or them</em>, remember that whit a macro that i wrote, and some that i refer in the links that i provide here, is suported directly the proc or funct without tack frames and only manipulated via esp.<br /><br />nguga, check out the values of ..vaiableName<br /><br />I think should work some like:<br />%error ..variableName<br /><br />or:<br />%assign xval ..variableName<br />%error xval<br /><br />some one of this two should work, and report the displacement of each local.<br /><br /><br />But nice to see other strategy here, also i think I can code a macro that move directly the arguments instead of push/pop thing, and only one balance, other thing that I question in the past and now i know is posible ;).<br /><br /><br />Nice ay or night.</div>
    <div class="meta">Posted on 2003-12-08 10:38:57 by rea</div>
   </div>
   <div class="post" id="post-127053">
    <div class="subject"><a href="#post-127053">masm proc</a></div>
    <div class="body">I only point some, because of the know that the two prefixed point is some important to nasm,  here I quote what is inside of the f_4_n.inc<br /><div class="quote"><br />; v0.3 17/05/2003 10:47a.m.<br />; (*)I delete the simbols .. this simbols are special things of nasm<br />; then i replace this simbols like: ..&lt;name&gt; with: .isTempValue.&lt;name&gt;<br />; i think now ..lParam is .isTempValue.lParam, but you still accesing the local var<br />; in your function/proc with .&lt;name&gt;<br /></div><br /><br />If you have a new version that this macro, then you should acces .isTempValue.nameOfLocal instead of the anteriors that they will be ..nameOfLocal, for example:<br /><br />funct WinMain, hInst, hPrevInst, CmdLine, CmdShow<br />	local wc, WNDCLASSEX<br />	local msg, MSG<br />	local hwnd, HWND<br />	sizef 80<br />%error .isTempValue.wc<br />%error .isTempValue.msg<br />%error .isTempValue.hwnd<br />endfunct<br /><br />will report:<br />p11_3.asm:43: warning: 48<br />p11_3.asm:44: warning: 76<br />p11_3.asm:45: warning: 80<br /><br />then I think if we will use this strategy, is necesary change .isTempValue. to some more short and fast to write and to have more significate to us, for the moment i think in some like:<br /><br />.l.name or .dis.name or ...name dunno any sugestions??? for reference them????<br /><br /><br />Nice day or night.</div>
    <div class="meta">Posted on 2003-12-08 11:08:38 by rea</div>
   </div>
   <div class="post" id="post-127076">
    <div class="subject"><a href="#post-127076">Nguga</a></div>
    <div class="body">hi ! HGB  :)<br /><br /><br />NAGOA is working with <br /><br />;;=====pedrogc macros ==undef resolved !=======<br />;; 33 parameters 33 locals <br /><br /><br />wich are not your hgb macros its another aproach without that<br /><br />. thing ....<br /><br /><br />;------------------------------------------------<br />; proc Funcion,arg1,..,argN<br />;<br />;  stack var1,4,msg,MSG_size,hWnd,4  ; locals using stack !<br />;<br />;  mov ,eax<br />;<br />;  CONST ola , &quot;ola meu!&quot;,0      ; data declared in code !<br />;<br />;  return           ; jump to endrotin <br />;<br />;  lea eax,<br />;<br />;  return 1        ; jump to endrotin and eax=1<br />;<br />;  mov eax,<br />; <br />; endproc<br />;-------------------------------------------------<br /><br /><br /><br /><br /><br /><br />its this one :<br /><br /><br />;======================<br />; tipo par de argumentos sem fim<br />; stack var1,4,var2,4,msg,28<br />;======================<br />%macro stack 1-*<br />%ifctx rotin<br />%assign somasizelocal 0<br />%assign %%pare_Argts ((%0) / 2) <br />%rep %%pare_Argts<br />%assign somasizelocal somasizelocal+%2<br />;======<br />defenir_os_arg_locais %2,%1  ; chamar defenir local arg<br />;======<br />%assign n_arg_l n_arg_l+1  ; INCREMENTAR PARA O PROXIMO LOCAL !<br />%assign c_local_  n_arg_l<br />%rotate 2<br />%endrep<br />sub esp,somasizelocal<br />%endif<br />%endmacro<br />;=====================<br /><br /><br />;; ======================<br />%macro defenir_os_arg_locais 2<br /><br />%if n_arg_l=1<br />%define %2 pupu_<br />%define pupu_  ebp - %1<br />;%error mnmnm pupu_<br />%endif</div>
    <div class="meta">Posted on 2003-12-08 17:36:28 by Nguga</div>
   </div>
   <div class="post" id="post-127077">
    <div class="subject"><a href="#post-127077">masm proc</a></div>
    <div class="body">using no eax register in NASM NAGOA.INC  <br /><br /><br />sub ebp,70<br />call RtlZeroMemory,ebp,OPENFILENAME_size    <br />add ebp,70<br />mov dword ,OPENFILENAME_size<br />mov dword ,buffer1<br />mov dword ,1020<br />mov dword ,filter_bmp<br />sub ebp,70<br />call GetSaveFileName,ebp<br />add ebp,70<br /><br /><br /><br /><br />ebp-70 = opf<br /><br />70 = OPENFILENAME_size<br /><br /><br />so its like GoASM</div>
    <div class="meta">Posted on 2003-12-08 17:51:45 by Nguga</div>
   </div>
   <div class="post" id="post-127078">
    <div class="subject"><a href="#post-127078">but all this to say !!!</a></div>
    <div class="body">why ?  use locals when it makes the code more bigger ???<br /><br />i pass without locals very well !  and makes the code litle .</div>
    <div class="meta">Posted on 2003-12-08 17:55:28 by Nguga</div>
   </div>
   <div class="post" id="post-127090">
    <div class="subject"><a href="#post-127090">masm proc</a></div>
    <div class="body">Relative to the ebp, if the offset is less than -128, the instruction would be encoded as mod 01 which has a 1byte displacement. However if more than that it would be encoded as mod 10 which has 4byte displacement. So in short, what does matters is the size of local variable. Hope you understand.</div>
    <div class="meta">Posted on 2003-12-08 20:59:29 by roticv</div>
   </div>
   <div class="post" id="post-127096">
    <div class="subject"><a href="#post-127096">Re: but all this to say !!!</a></div>
    <div class="body"><div class="quote"><br />why ?  use locals when it makes the code more bigger ???<br /><br />i pass without locals very well !  and makes the code litle . </div><br /><br />There is little need of procs besides to use local variables. If you pass a parameter to the proc it is on the stack and is accessed by the same means as a local so if you wish to really save a couple of bytes you can just banish stack frames completely. Anything that you can do with a stack frame can be done with call/ret and no stack frame so why bother with them. The fact is that they are tools to facilitate programming, locals allow you to discard a variable once you don't need it anymore. You should add the 4C bytes of the structure to your calculation of the size of your non-local proc, they are integral to the procedure and permanent so they are in reality a part of it even though they reside outside the address range of the actual proc. In that case the global method is substantially larger than the local one which discards those 4C bytes and therefore does not have them counted in it's size. To prove that those bytes must be included as part of the calculation, try to run the proc without them, if you can't then they are part of the proc and must be counted.</div>
    <div class="meta">Posted on 2003-12-08 23:27:32 by donkey</div>
   </div>
   <div class="post" id="post-127145">
    <div class="subject"><a href="#post-127145">masm proc</a></div>
    <div class="body">just found what HUTCH  thinks about LOCALS and i agree with im very much !<br /><br /><br />&quot;The choice between GLOBAL and LOCAL variables is the scope in which you need them. In assembler, the difference between a value placed in the DATA or DATA? sections which has GLOBAL scope in the module or a LOCAL value that is created on the stack at the beginning of the procedure and destroyed at the exit of the procedure.<br /><br />If a value is only needed during a procedure, it makes sense to make it LOCAL as you can reuse the name in another procedure with no problems and it means you can isolate a procedure by using LOCAL values. Stack locals are generally faster as they are recently created and should be in the DATA cache. This is what Intel recommend for values that only need scope within a procedure.<br /><br />I personally make a habit of making handles GLOBAL so I can use them across many different procs without a messy parameter list for procedure calls but where I don't need GLOBAL scope, I regularly use LOCAL values.<br /><br />Regards,<br />http://www.asmcommunity.net/board/cryptmail.php?tauntspiders=in.your.face@nomail.for.you&amp;id=2f46ed9f24413347f14439b64bdc03fd     &quot;</div>
    <div class="meta">Posted on 2003-12-09 11:56:27 by Nguga</div>
   </div>
<form class="pagination" action="../" method="get"><a href="../?id=16348&amp;page=1" style="visibility:hidden;">&laquo;</a><a href="../?id=16348&amp;page=0" style="visibility:hidden;">&lt;</a><input type="hidden" name="id" value="16348" /><input type="number" name="page" min="1" max="2" step="1" value="1" onchange="this.form.submit();" /><a href="../?id=16348&amp;page=2">&gt;</a><a href="../?id=16348&amp;page=2">&raquo;</a></form>  </div>
 </body>
</html>