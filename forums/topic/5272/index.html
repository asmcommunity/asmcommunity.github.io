<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>need some string parsing help - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=5272" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=5272">need some string parsing help</a></p>
   <div class="post" id="post-37287">
    <div class="subject"><a href="#post-37287">need some string parsing help</a></div>
    <div class="body">i have a multiline string i need parsed. here is a sample of what it looks like.<br /><pre><code>data db &quot;dr-xr-xr-x   1 owner    group       0 May 21  2001 deskapps&quot;,13,10,<br />        &quot;dr-xr-xr-x   1 owner    group       0 Apr 20  2001 developr&quot;,0</code></pre><br />whats making this kinda tough is that i need different parts of the string at differnt times when processing it. for example on line one i need to have deskapps first and add it to my listview then get some other parts of the string and add it to my listview. adding it to my listview isnt a problem. ihere is my attempt and it works ok but i was wondering if someone can demonstrate a better way. in the example i have stored the parts temporarly into variables dat1-data5.<br /><pre><code>         xor ecx,ecx<br />         xor edi,edi<br />         mov esi, data<br /> Restart&#58;<br />         lea edi, data1        <br />      @@&#58;<br />         cmp al,0<br />         je @E <br />         mov al,&#91;esi&#93;<br />         inc esi<br />         mov &#91;edi&#93;,al<br />         inc edi         <br />         cmp al,20h<br />         jne @B<br />         mov byte ptr &#91;edi&#93;, 0<br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         cmp al,20h<br />         je @B<br />         dec esi<br />         dec edi<br />         mov byte ptr &#91;edi&#93;, 0<br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi         <br />         cmp al,20h<br />         jne @B         <br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         cmp al,20h<br />         je @B<br />         dec esi<br />         dec edi<br />         lea edi, data2<br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         mov &#91;edi&#93;,al<br />         inc edi         <br />         cmp al,20h<br />         jne @B<br />         mov byte ptr &#91;edi&#93;, 0<br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         cmp al,20h<br />         je @B<br />         dec esi<br />         dec edi<br />         lea edi, data3<br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         mov &#91;edi&#93;,al<br />         inc edi         <br />         cmp al,20h<br />         jne @B<br />         mov byte ptr &#91;edi&#93;, 0<br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         cmp al,20h<br />         je @B<br />         dec esi<br />         dec edi<br />         lea edi, data4<br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         mov &#91;edi&#93;,al<br />         inc edi         <br />         cmp al,20h<br />         jne @B<br />         mov byte ptr &#91;edi&#93;, 0<br />         ;///problem<br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         cmp al,20h<br />         je @B<br />         dec esi<br />         dec edi<br />         lea edi, data5<br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         mov &#91;edi&#93;,al<br />         inc edi         <br />         cmp al,20h<br />         jne @B<br /><br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         mov &#91;edi&#93;,al<br />         inc edi         <br />         cmp al,20h<br />         je @B<br /><br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         mov &#91;edi&#93;,al<br />         inc edi         <br />         cmp al,20h<br />         jne @B<br /><br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         mov &#91;edi&#93;,al<br />         inc edi         <br />         cmp al,20h<br />         je @B<br /><br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         mov &#91;edi&#93;,al<br />         inc edi         <br />         cmp al,20h<br />         jne @B<br />         mov byte ptr &#91;edi&#93;, 0<br />         <br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         cmp al,20h<br />         je @B<br />         dec esi<br />         dec edi<br />         lea edi, data6<br />      @@&#58;<br />         mov al,&#91;esi&#93;<br />         inc esi<br />         mov &#91;edi&#93;,al<br />         inc edi<br />         cmp al,0<br />         je @Z        <br />         cmp al,13<br />         jne @B<br />         mov byte ptr &#91;edi-1&#93;, 0<br />      @Z&#58;               <br />         invoke AddDir,addr data6<br />         invoke AddSubItem,addr data1,3<br />         invoke AddSubItem,addr data2,4<br />         invoke AddSubItem,addr data3,5<br />         invoke AddSubItem,addr data4,1<br />         invoke AddSubItem,addr data5,2<br />         inc esi<br />         inc edi<br />         jmp Restart<br />      @E&#58;</code></pre><br />just a small picture to show you what sections i need parsed.</div>
    <div class="meta">Posted on 2002-05-08 19:28:46 by smurf</div>
   </div>
   <div class="post" id="post-37325">
    <div class="subject"><a href="#post-37325">need some string parsing help</a></div>
    <div class="body">Here is my version of your problem.  Im assuming that the &quot;data&quot; will be formated much like how you have it indicated.  Where everything is 'columnized' and only the last DIR name will vary in length.<br /><pre><code>.386<br />.model flat,stdcall<br />option casemap&#58;none<br /><br />ParseString PROTO &#58;DWORD<br /><br />include \masm32\include\windows.inc<br />include \masm32\include\kernel32.inc<br />include \masm32\include\user32.inc<br /><br />includelib \masm32\lib\kernel32.lib<br />includelib \masm32\lib\user32.lib<br /><br />PData STRUC<br />   data1  db 15 dup&#40;?&#41;   ;dr-xr-xr-x...1.<br />   data2  db 9  dup&#40;?&#41;   ;owner....<br />   data3  db 12 dup&#40;?&#41;   ;group.......<br />   data4  db 2  dup&#40;?&#41;   ;0.<br />   data5  db 13 dup&#40;?&#41;   ;May.21..2001.<br />   data6  db 1  dup&#40;?&#41;   ;deskapps.   &#40;null always fixed at last char&#41;<br />PData ENDS<br /><br />        ; NOTE&#58; '.' == NULL's<br />        ;       '|' == Data field start<br />        ;       '-' == Data<br />        ;<br />.data   ; 13 bytes       9 bytes  12 bytes    13 bytes       What ever amount<br />        ;|---------...-.|----....|----.......|-------------.|-------&gt;. ?<br />Data db &quot;dr-xr-xr-x   1 owner    group       0 May 21  2001 deskapps&quot;,13,10,<br />        &quot;dr-xr-xr-x   1 owner    group       0 Apr 20  2001 developr&quot;,0<br /><br />.code<br />start&#58;<br /><br />     invoke ParseString, addr Data     <br />     invoke ExitProcess, NULL<br /><br />; -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=<br />  ParseString PROC USES ESI EDI EBX lpStringIn&#58;DWORD<br />; -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=<br />     LOCAL buffer&#91;256&#93;   &#58;BYTE          ; Buffer to hold up to NULL or 13<br />     LOCAL Flag13        &#58;DWORD         ; Addr Flag to indicate &quot;more&quot;<br /><br />     mov esi, lpStringIn                ; ESI == Get the source address<br />StartAgain&#58;<br />     lea edi, buffer                    ; EDI == BUFFER<br />     xor eax, eax                       ; EAX == 0<br />     mov Flag13, eax                    ; Initialize Flag<br />   @Back&#58;<br />     mov al, &#91;esi&#93;                      ; EAX == 000000XX h<br />     mov &#91;edi&#93;, al                      ; Copy it to buffer<br />     cmp eax, NULL                      ; ? EAX == 0<br />     je  @Done                          ; yes, next stage<br />     cmp eax, 13                        ; ? EAX == 13<br />     je  @Done13                        ; Yes, to 13 stuff<br />     cmp eax, 20h                       ; ? EAX == SPACE?<br />     jne @F                             ; No, skip this<br />     mov BYTE PTR &#91;edi&#93;, NULL           ; Yes, then really write NULL<br />   @@&#58; <br />     inc esi                            ; Next char<br />     inc edi                            ; Next Dest<br />     jmp @Back<br />   @Done13&#58;<br />     add esi, 2                         ; Skip 13,10 &#40;2 bytes&#41;<br />     mov Flag13, esi                    ; mov Flag13 addr Next start<br />   @Done&#58;  <br />     lea ebx, buffer                    ; ESI == BUFFER<br />     mov BYTE PTR &#91;edi&#93;,NULL            ; Write byte over NULL/13<br />     lea esi, &#91;ebx&#93;.PData.data5         ; Get the addr to the &quot;problem&quot;<br />     xor edi, edi                       ; EDI == NULL<br />     .while&#40; edi &lt; 12 &#41;                 ; Upto but not including the NULL<br />       mov al, &#91;esi&#93;                    ; Get char in al<br />       cmp eax, NULL                    ; see if NULL<br />       jne @F                           ; No, next<br />       mov BYTE PTR &#91;esi&#93;, 20h          ; Yes, fix it with space<br />       @@&#58;<br />       inc esi                          ; next char<br />       inc edi                          ; count++<br />     .endw<br /><br />;     invoke AddDir,addr &#91;ebx&#93;.PData.data6<br />;     invoke AddSubItem,addr &#91;ebx&#93;.PData.data1,3<br />;     invoke AddSubItem,addr &#91;ebx&#93;.PData.data2,4<br />;     invoke AddSubItem,addr &#91;ebx&#93;.PData.data3,5<br />;     invoke AddSubItem,addr &#91;ebx&#93;.PData.data4,1<br />;     invoke AddSubItem,addr &#91;ebx&#93;.PData.data5,2<br /><br />     invoke MessageBox, NULL, addr &#91;ebx&#93;.PData.data1, NULL, MB_OK<br />     invoke MessageBox, NULL, addr &#91;ebx&#93;.PData.data2, NULL, MB_OK<br />     invoke MessageBox, NULL, addr &#91;ebx&#93;.PData.data3, NULL, MB_OK<br />     invoke MessageBox, NULL, addr &#91;ebx&#93;.PData.data4, NULL, MB_OK<br />     invoke MessageBox, NULL, addr &#91;ebx&#93;.PData.data5, NULL, MB_OK<br />     invoke MessageBox, NULL, addr &#91;ebx&#93;.PData.data6, NULL, MB_OK<br />     <br />     cmp Flag13, NULL                   ; See if Address was noted<br />     je @F                              ; No, leave<br />     mov esi, Flag13                    ; yes, move it into esi<br />     jmp StartAgain                     ; Do it all again!<br />   @@&#58;<br />   ret<br />ParseString ENDP<br />; -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=<br />end start<br />end     </code></pre><br /><br />The comments should be pretty clrear whats going on.  But in short, Copy the string to buffer (to keep source unchanged), run through and replace *ALL* spaces with NULL.  Then look up the &quot;date problem&quot; and fix back all NULL's to spaces ~ except the last char in the field. Lastly, apply a structure over the buffer as a mask to look up starting addresses for the data.<br /><br />Enjoy, I Hope you like,<br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-05-09 03:07:14 by NaN</div>
   </div>
   <div class="post" id="post-37496">
    <div class="subject"><a href="#post-37496">need some string parsing help</a></div>
    <div class="body">unfortunatly i should have been more specific about what i needed. the spaces, and text lengths are of different sizes when i use them. this was just an example of what it looks like for the most part. thank you for the time you spent though. i hope you dont think you wasted too much time i did learn a few things from your code.</div>
    <div class="meta">Posted on 2002-05-10 01:40:39 by smurf</div>
   </div>
   <div class="post" id="post-37507">
    <div class="subject"><a href="#post-37507">need some string parsing help</a></div>
    <div class="body"><div class="quote">i did learn a few things from your code.</div><br />Glad to hear it ;)<br /><br />There is other ways too, but its late, i will see what i can do tomorrow.<br /><br />:alright:<br />NaN</div>
    <div class="meta">Posted on 2002-05-10 02:53:42 by NaN</div>
   </div>
  </div>
 </body>
</html>