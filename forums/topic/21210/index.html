<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Executing embedded applications - Forums - ASM Community</title>
  <link rel="stylesheet" type="text/css" href="../../../style.css" />
  <link rel="canonical" href="../?id=21210" />
     </head>
 <body>
  <div id="header">
   <h1><a href="../../../">ASM Community</a></h1>
  </div>
  <div id="content">
   <p class="breadcrumbs"><a href="../../../">Home</a> &raquo; <a href="../../">Forums</a> &raquo; <a href="../../board/?id=3">MAIN</a> &raquo; <a href="../?id=21210">Executing embedded applications</a></p>
   <div class="post" id="post-160530">
    <div class="subject"><a href="#post-160530">Executing embedded applications</a></div>
    <div class="body">A while ago, Chetnik coded a demo launching PEs loaded to memory. It loads a test file, fixes the import table and executes the PE file. Modifying Chetnik&#39;s original demo, I created a main module &quot;extracting&quot; an embedded PE file to the memory. The main executable ( PEmem.exe ) launches the PE file &quot;dumped&quot; to the memory.<br /><br />Many thanks to Hutch for his fda tool.<br /><br />PS : You can get Chetnik&#39;s pe-mem demo from :<br /><br /><a target="_blank" href="http://www.masmforum.com/simple/index.php?action=dlattach;topic=576.0;id=846">http://www.masmforum.com/simple/index.php?action=dlattach;topic=576.0;id=846</a></div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=642" target="_blank">Extractor2.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2005-05-28 04:58:30 by Vortex</div>
   </div>
   <div class="post" id="post-160533">
    <div class="subject"><a href="#post-160533">Re: Executing embedded applications</a></div>
    <div class="body">Here is another version where the embedded application is decompressed to memory.<br /><br />Before binding the test file to the main executable, it is compressed to reduce the size with Jeremy Collake&#39;s JCALG1 compression library.<br /><br />Thanks to Jeremy Collake for JCALG1</div>
    <div class="attachments">Attachments:
     <ul>
      <li><a href="../../attachments/?id=643" target="_blank">PEmem2.zip</a></li>
     </ul>
    </div>
    <div class="meta">Posted on 2005-05-28 09:22:33 by Vortex</div>
   </div>
   <div class="post" id="post-160579">
    <div class="subject"><a href="#post-160579">Re: Executing embedded applications</a></div>
    <div class="body">Pretty interesting that resources work in the embedded file... have you tested this on 9x?</div>
    <div class="meta">Posted on 2005-05-29 20:05:44 by f0dder</div>
   </div>
   <div class="post" id="post-160589">
    <div class="subject"><a href="#post-160589">Re: Executing embedded applications</a></div>
    <div class="body">The original test file dialog.exe which comes with my res2bin tool was developed on a win95b system. Memory dialog templates are also available on win 9x systems, for more information have a look at win32.hlp reference.</div>
    <div class="meta">Posted on 2005-05-30 04:46:00 by Vortex</div>
   </div>
   <div class="post" id="post-160591">
    <div class="subject"><a href="#post-160591">Re: Executing embedded applications</a></div>
    <div class="body">Ah, didn&#39;t look closely at the source - I wonder if this would work for &quot;normal&quot; resource usage...</div>
    <div class="meta">Posted on 2005-05-30 05:37:35 by f0dder</div>
   </div>
   <div class="post" id="post-160605">
    <div class="subject"><a href="#post-160605">Re: Executing embedded applications</a></div>
    <div class="body">As the result of my tests, I can say that embedded PEs with &quot;normal&quot; resources doesn&#39;t work with Chetnik&#39;s methode. This is why I used binary resource data in my example.</div>
    <div class="meta">Posted on 2005-05-30 12:22:14 by Vortex</div>
   </div>
   <div class="post" id="post-160606">
    <div class="subject"><a href="#post-160606">Re: Executing embedded applications</a></div>
    <div class="body">Mmh, resource data is pretty &quot;special&quot;... especially on 9x :)</div>
    <div class="meta">Posted on 2005-05-30 13:36:09 by f0dder</div>
   </div>
   <div class="post" id="post-160613">
    <div class="subject"><a href="#post-160613">Re: Executing embedded applications</a></div>
    <div class="body">Hi f0dder,<br /><br />If you have the opportunity, could you try my binary resource example ( which comes with PEmem2.zip ) on a 9x system?</div>
    <div class="meta">Posted on 2005-05-30 14:19:33 by Vortex</div>
   </div>
   <div class="post" id="post-160619">
    <div class="subject"><a href="#post-160619">Re: Executing embedded applications</a></div>
    <div class="body">I will try to do so soon, Vortex - please remind me. I have an exam period right now, so I have to do a bit of studying and such... but I have assembled my test box soon, a pii-350 with exchangable drives (2k, 98, ...), so I should be able to test :)</div>
    <div class="meta">Posted on 2005-05-30 16:58:46 by f0dder</div>
   </div>
   <div class="post" id="post-160626">
    <div class="subject"><a href="#post-160626">Re: Executing embedded applications</a></div>
    <div class="body">Hi f0dder,<br /><br />Thanks for your interest.<br /><br />Good luck at your exams, I am sure you will be successfull.</div>
    <div class="meta">Posted on 2005-05-31 00:31:23 by Vortex</div>
   </div>
   <div class="post" id="post-161055">
    <div class="subject"><a href="#post-161055">Re: Executing embedded applications</a></div>
    <div class="body">Finally got around to testing on win98se, and it works... I still don&#39;t think it will work if you use &quot;normal&quot; resource functions, but those can of course be emulated and the loaded app IAT could be patched to use those emulated functions.<br /></div>
    <div class="meta">Posted on 2005-06-12 12:06:24 by f0dder</div>
   </div>
   <div class="post" id="post-161065">
    <div class="subject"><a href="#post-161065">Re: Executing embedded applications</a></div>
    <div class="body">Hi f0dder,<br /><br />Thanks for testing the executable. About &quot;normal&quot; resources, I said exactly the same as you, they don&#39;t function with Chetnik&#39;s technique. Naturally, emulation can be a solution but that is another work to do.</div>
    <div class="meta">Posted on 2005-06-12 15:13:08 by Vortex</div>
   </div>
   <div class="post" id="post-161068">
    <div class="subject"><a href="#post-161068">Re: Executing embedded applications</a></div>
    <div class="body">Very interesting and useful, I have for various reasons disabled PAE mode on my PC and DEP in XPSP2 because of some program execution issues with it. Has anyone tried it with DEP/PAE enabled ?<br /><br />Can&#39;t see why it shouldn&#39;t work but my machine won&#39;t boot with PAE enabled because of software incompatibilities so I can&#39;t test to make sure.</div>
    <div class="meta">Posted on 2005-06-12 16:02:36 by donkey</div>
   </div>
   <div class="post" id="post-161069">
    <div class="subject"><a href="#post-161069">Re: Executing embedded applications</a></div>
    <div class="body">donkey, as long as you unpack/load/whatever the image to VirtualAlloc&#39;ed memory that has the EXECUTE permission, it should work just fine... but no heapalloc, global/localalloc, stack memory, etc...</div>
    <div class="meta">Posted on 2005-06-12 16:08:19 by f0dder</div>
   </div>
  </div>
 </body>
</html>