<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
   <meta name="GENERATOR" content="Mozilla/4.7 [en] (Win98; I) [Netscape]">
   <title>Iczelionùv Win32 ASM tutorial 3: Jednoduché okno</title>
</head>
<body text="#C0C0C0" bgcolor="#000000" link="#00FFFF" vlink="#FF34D0" alink="#98FF98">

<center>
<h1>
<font face="Arial"><font color="#999900">Tutorial 3: Jednoduché okno</font></font></h1></center>
<font size=-1>V tomto tutoriálu postavíme Windows program, které zobrazí plnì funkèní okno na ploše.
</font>
<br><font size=-1>Stáhnìte si kód z: <a href="files/tut03.zip">here</a></font>
<h3>
<font color="#FF9800"><font size=+0>Theory:</font></font></h3>
<font size=-1>Programy ve Windows se hutnì spoléhají na API funkce pro jejich GUI (grafické rozhraní).
To má vıhody jak pro uivatele, tak pro programátory. Pro uivatele tu vıhodu,
e se nemusí uèit zacházet s GUI kadého programu zvláš, GUI
programù pod Windows je podobné pro kadı program. Pro programátory tu, e GUI kódy 
jsou ji hotové, otestované a pøipravené k pouívání. Nevıhodou pro programátory
jsou však zvıšené nároky na komplexnost jejich znalostí.
Abychom mohli vytvoøit nebo manipulovat s jakımkoliv GUI objektem,
jako jsou okna, menu nebo ikony, musíme dodrovat urèitı striktní postup.
Ale toto mùe bıt pøekonáno modulárním programováním nebo paradigmatem OOP (objektovì orientované programování).</font>
<br><font size=-1>Nyní naèrtnu kroky potøebné k vytvoøení okna na ploše:
</font>
<ol>
<li>
<font size=-1>Získat handle instance našeho programu. (vyadováno)</font></li>

<li>
<font size=-1>Získat obsah pøíkazové øádky (není vyadováno, pokud nepotøebujeme zpracovávat pøíkazovou øádku)
</font></li>

<li>
<font size=-1>Registrovat tøídu okna (vyadováno, pokud neuíváte pøeddefinované typy okna,
jako napø.. MessageBox nebo dialog box)</font></li>

<li>
<font size=-1>Vytvoøit okno (vyadováno)</font></li>

<li>
<font size=-1>Ukázat okno na ploše (vyadováno, ledae nechcete, aby se okno hned objevilo)
</font></li>

<li>
<font size=-1>Obnovit klientskou oblast okna</font></li>

<li>
<font size=-1>Vstoupit do nekoneèné smyèky, kontrolujíc zprávy od Windows.</font></li>

<li>
<font size=-1>Jestlie zprávy dorazí, jsou zpracovány specializovanou funkcí
, která je zodpovìdná za okno.</font></li>

<li>
<font size=-1>Ukonèit program jestlie uivatel zavøe okno</font></li>
</ol>
<font size=-1>Jak jste si jistì všimli, struktura programu ve Windows je dosti
komplexní ve srovnání s programem v DOSu. Ale svìt Windows je podstatnì odlišnı
od svìta DOSu. Programy pod Windows musejí bıt schopny v míru spoluexistovat.
Musí proto dodrovat pøísnìjší pravidla. Vy, jakoto programátor musíte také
bıt pøísnìjší na svùj programovací styl a návyky.</font>
<h3>
<font color="#CC0000"><font size=+0>Obsah:</font></font></h3>
<font size=-1>Pod námi je kód našeho jednoduchého okna. Pøedtím, ne se však vrhneme
na detaily Win32 ASM programování, doporuèím nìkteré body, které vám programování ulehèí.
</font>
<ul>
<li>
<font size=-1>Mìli by jste všechny konstanty, struktury a funkèní
prototypy vloit do hlavièkového souboru a zahrnout ho na zaèátek .asm
souboru. Ušetøí vám to mnoho snahy a psaní. Momentálnì nejúplnìjším hlavièkovım souborem
pro MASM je hutchùv windows.inc, kterı si mùete stáhnout z jeho nebo mojich stránek.
Mùete si také definovat vlastní konstanty a struktury
, ale mìli by jste je oddìlit do jiného hlavièkového souboru.</font></li>

<li>
<font size=-1>Pouívejte<font color="#FFFF68"> includelib</font> direktivu
urèující pouívané importní knihovny. Kdy napø. váš program volá MessageBox,
mìli by jste vloit øádek:</font></li>

<ul><font color="#FF9800"><font size=-1>includelib user32.lib</font></font></ul>
<font size=-1>na zaèátek vašeho .asm souboru. Ten øíká
MASM, e váš program vyuije funkci z té knihovny.
Jestlie voláte funkce z více ne jedné knihovny, prostì pøidejte další includelib
pro další knihovnu. Uíváním includelib direktivy se ji nemusíte starat
o importní knihovny v prùbìhu linkování. Mùete pouít /LIBPATH linker pøepínaè,
aby jste sdìlili linkeru, kde knihovny jsou.</font>
<li>
<font size=-1>Kdy deklarujete prototypy, struktury nebo konstanty
ve svém hlavièkové souboru, snate se dret pùvodních jmen uívanıch v hlavièkovıch souborech Windows,
vèetnì velkıch a malıch písmen. Ušetøí vám to spoustu bolestí hlavy pøi hledání nìjaké poloky 
ve Win32 API referencích.</font></li>

<li>
<font size=-1>Pouívejte makefile k automatizaci v procesu kompilace. To vám ušetøí mnoho
psaní.</font></li>
</ul>
<b><font size=-1>.386</font></b>
<br><b><font size=-1>.model flat,stdcall</font></b>
<br><b><font size=-1>option casemap:none</font></b>
<br><b><font size=-1>include \masm32\include\windows.inc</font></b>
<br><b><font size=-1>include \masm32\include\user32.inc</font></b>
<br><b><font size=-1>includelib \masm32\lib\user32.lib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

<font color="#009900">; volání k funkcím v user32.lib a kernel32.lib</font></font></b>
<br><b><font size=-1>include \masm32\include\kernel32.inc</font></b>
<br><b><font size=-1>includelib \masm32\lib\kernel32.lib</font></b>
<p><b><font size=-1>WinMain proto :DWORD,:DWORD,:DWORD,:DWORD</font></b>
<p><b><font size=-1>.DATA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#009900">&nbsp;&nbsp;
; inicializovaná data</font></font></b>
<br><b><font size=-1>ClassName db "SimpleWinClass",0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#009900">&nbsp;
; jméno naší tøídy okna(window class)</font></font></b>
<br><b><font size=-1>AppName db "Naše první okno",0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#009900">
; jméno našeho okna</font></font></b>
<p><b><font size=-1>.DATA?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#009900">&nbsp;
; neinicializovaná data</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">hInstance HINSTANCE ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</font><font color="#009900">; handle instance našeho programu</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>CommandLine LPSTR ?</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">.CODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">&nbsp;&nbsp;&nbsp;
; tady zaèíná náš kód</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>start:</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">invoke GetModuleHandle, NULL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">&nbsp;&nbsp;
; získej handle instance našeho programu.</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</font><font color="#009900">; pod Win32, hmodule==hinstance mov hInstance,eax</font></font></b>
<br><b><font color="#FFFFFF"><font size=-1>mov hInstance,eax</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">invoke GetCommandLine&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">&nbsp;&nbsp;
; Získej obsah pøíkazové øádky. Nemusíte tuto funkci volat, jestlie</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</font><font color="#009900">; pøíkazovou øádku zpracovávat nechcete.
</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>mov CommandLine,eax</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">invoke WinMain, hInstance,NULL,CommandLine,
SW_SHOWDEFAULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">&nbsp;
; volej hlavní funkci</font></font></b>
<br>
  <b><font size=-1><font color="#CCCCCC">invoke ExitProcess, eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">&nbsp;&nbsp;&nbsp; 
  ; ukonèi program. Exit kód je vrácen v eax od WinMain.</font></font></b> 
<p><b><font color="#CCCCCC"><font size=-1>WinMain proc hInst:HINSTANCE,hPrevInst:HINSTANCE,CmdLine:LPSTR,CmdShow:DWORD</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">&nbsp;&nbsp;&nbsp; LOCAL wc:WNDCLASSEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">
; vytvoøíme lokální promìnné v zásobníku</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; LOCAL msg:MSG</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; LOCAL hwnd:HWND</font></font></b>
<p><b><font size=-1><font color="#CCCCCC">&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.cbSize,SIZEOF WNDCLASSEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">
; naplníme hodnoty èlenù struktury wc</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.style, CS_HREDRAW or CS_VREDRAW</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.lpfnWndProc, OFFSET WndProc</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.cbClsExtra,NULL</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.cbWndExtra,NULL</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; push&nbsp;
hInstance</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; pop&nbsp;&nbsp;
wc.hInstance</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.hbrBackground,COLOR_WINDOW+1</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.lpszMenuName,NULL</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.lpszClassName,OFFSET ClassName</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; invoke LoadIcon,NULL,IDI_APPLICATION</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.hIcon,eax</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.hIconSm,eax</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; invoke LoadCursor,NULL,IDC_ARROW</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.hCursor,eax</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">&nbsp;&nbsp;&nbsp; invoke RegisterClassEx,
addr wc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">
; registrujeme naší tøídu okna</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; invoke CreateWindowEx,NULL,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ADDR ClassName,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ADDR AppName,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
WS_OVERLAPPEDWINDOW,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CW_USEDEFAULT,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CW_USEDEFAULT,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CW_USEDEFAULT,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CW_USEDEFAULT,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
NULL,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
NULL,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
hInst,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
NULL</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
hwnd,eax</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">&nbsp;&nbsp;&nbsp; invoke ShowWindow,
hwnd,CmdShow&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">&nbsp;&nbsp;&nbsp;
; zobrazí naše okno na ploše</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">&nbsp;&nbsp;&nbsp; invoke UpdateWindow,
hwnd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">
; obnoví klientskou oblast</font></font></b>
<p><b><font size=-1><font color="#CCCCCC">&nbsp;&nbsp;&nbsp; .WHILE TRUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">
; vstoupíme do smyèky zpráv</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke GetMessage, ADDR msg,NULL,0,0</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
.BREAK .IF (!eax)</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke TranslateMessage, ADDR msg</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke DispatchMessage, ADDR msg</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp; .ENDW</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;
eax,msg.wParam&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">&nbsp;&nbsp;&nbsp;
; vrátí exitovı kód v eax</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; ret</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>WinMain endp</font></font></b>
<p><b><font color="#CCCCCC"><font size=-1>WndProc proc hWnd:HWND, uMsg:UINT,
wParam:WPARAM, lParam:LPARAM</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">&nbsp;&nbsp;&nbsp; .IF uMsg==WM_DESTROY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

</font><font color="#009900">; jestli uivatel zavøe naše okno</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke PostQuitMessage,NULL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#009900">&nbsp;
; ukonèím aplikaci</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; .ELSE</font></font></b>
<br><b><font size=-1><font color="#CCCCCC">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke DefWindowProc,hWnd,uMsg,wParam,lParam&nbsp;&nbsp;&nbsp;</font><font color="#009900">&nbsp;
; standardní(Default) zpracování zpráv</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ret</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; .ENDIF</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; xor eax,eax</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; ret</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>WndProc endp</font></font></b>
<p><b><font color="#CCCCCC"><font size=-1>end start</font></font></b>
<h3>
Analıza:</h3>
<font color="#C0C0C0"><font size=-1>Moná jste docela pøekvapeni, e jednoduché okno
vyaduje tolik kódování. Ale vìtšina toho kódu jsou vlastnì jen šablony,
které mùete kopírovat z jednoho zdrojového kódu do druhého.
Nebo pokud chcete, mùete èást kódu zkompilovat do knihovny a vyuívat ji na zaèátku a konci svıch programù
jako prolog a epilog.
Kód mùete psát pouze ve WinMain funkci.
Ve skuteènosti tohle dìlají C compilátory. Nechají vás psát kód WinMain funkce
ani by jste se museli starat o další detaily.
Jedinı háèek je v tom, e musíte mít funkci pojmenovanou WinMain, jinak C kompilátory
nebudou schopny kombinovat váš kód s se svım úvodním(prologue) a koneènım(prologue) kódem.
V assembleru takové omezení nemáte. Mùete pouít libovolné jméno namísto WinMain nebo nakonec
nemusíte pouít ádnou hlavní funkci.
</font></font>
<br><font color="#C0C0C0"><font size=-1>Pøipravte se. Tohle bude dlouhı, pøedlouhı tutorial.
Rozeberme program k smrti :)!</font></font>
<ul><b><font color="#999900"><font size=-1>.386</font></font></b>
<br><b><font color="#999900"><font size=-1>.model flat,stdcall</font></font></b>
<br><b><font color="#999900"><font size=-1>option casemap:none</font></font></b>
<p><b><font color="#999900"><font size=-1>WinMain proto :DWORD,:DWORD,:DWORD,:DWORD</font></font></b>
<p><b><font color="#999900"><font size=-1>include \masm32\include\windows.inc</font></font></b>
<br><b><font color="#999900"><font size=-1>include \masm32\include\user32.inc</font></font></b>
<br><b><font color="#999900"><font size=-1>include \masm32\include\kernel32.inc</font></font></b>
<br><b><font color="#999900"><font size=-1>includelib \masm32\lib\user32.lib</font></font></b>
<br><b><font color="#999900"><font size=-1>includelib \masm32\lib\kernel32.lib</font></font></b></ul>
<font color="#CCCCCC"><font size=-1>První tøi øádky jsou "nutnosti".
.386 øíká MASM, e máme v úmyslu uívat 80386 instrukèní sadu v našem programu.
.model flat,stdcall øíká MASM, e uíváme flat pamìovı model.
Takté pouijeme stdcall konvenci jako základní v našem programu.
</font></font>
<br><font color="#CCCCCC"><font size=-1>Následuje prototyp funkce WinMain.
Ponìvad budeme volat WinMain pozdìji, musíme její prototyp definovat døíve
ne pouijeme invoke.
</font></font>
<br><font color="#CCCCCC"><font size=-1>Musím zahrnout windows.inc 
na zaèátku kódu. Obsahuje dùleité struktury a konstanty.
 Hlavièkovı soubor windows.inc je pouhı textovı soubor.
Otevøete ho libovolnım textovım editorem. Prosím uvìdomte si,
e windows.inc neobsahuje ještì všechny strukutry a konstanty.
Spolu s Hutchem na tom pracujeme. Sami si mùete pøidat další poloky,
jeslie tam nejsou.</font></font>
<br><font color="#CCCCCC"><font size=-1>Náš program volá API funkce,
které pøebıvají v user32.dll (CreateWindowEx, RegisterWindowClassEx, napø.)
a kernel32.dll (ExitProcess), take musíme spojit náš program s tìmito knihovnami.
Další otázka: Jak mám poznat, která knihovna by mìla bıt slinkována s mım programem ?
Odpovìï: Musíte vìdìt, kde volané API funkce pøebıvají.
Kdy napø. zavoláte API funkci v gdi32.dll, musíte linkovat s gdi32.lib.</font></font>
<br><font color="#CCCCCC"><font size=-1>To je pøístup MASM. Pøístup TASM
je mnohem jednodušší: nalinkujte jen jeden jedinı soubor: import32.lib.</font></font>
<ul><b><font color="#999900"><font size=-1>.DATA</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; ClassName
db "SimpleWinClass",0</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; AppName&nbsp;
db "Naše první okno",0</font></font></b>
<p><b><font color="#999900"><font size=-1>.DATA?</font></font></b>
<br><b><font color="#999900"><font size=-1>hInstance HINSTANCE ?</font></font></b>
<br><b><font color="#999900"><font size=-1>CommandLine LPSTR ?</font></font></b></ul>
<font color="#CCCCCC"><font size=-1>Další jsou datové sekce.</font></font>
<br><font color="#CCCCCC"><font size=-1>V .DATA deklarujeme dva nulou ukonèené øetìzce,
(ASCIIZ øetìzce): ClassName, co je jméno tøídy našeho okna a AppName, co je jméno našeho okna.
Všimnìte si, e tyto promìnné jsou inicializovány.</font></font>
<br><font color="#CCCCCC"><font size=-1>V .DATA?, deklarujeme dvì promìnné:
hInstance (handle instance našeho programu) a CommandLine (pøíkazová øádka našeho programu).
Neznámé data typy, HINSTANCE a LPSTR jsou ve skuteènosti jen jiná jména pro DWORD.
Mùete si je vyhledat ve windows.inc. Všimnìte si také, e promìnné v .DATA? sekci nejsou inicializována,
co znamená, e neobsahují ádnou konkrétní hodnotu pøi startu, ale chceme pro nì zatím rezervovat místo pro další pouití.
</font></font>
<ul><b><font color="#999900"><font size=-1>.CODE</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;start:</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp; invoke
GetModuleHandle, NULL</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;
hInstance,eax</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp; invoke
GetCommandLine</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;
CommandLine,eax</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp; invoke
WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp; invoke
ExitProcess,eax</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp; .....</font></font></b>
<br><b><font color="#999900"><font size=-1>end start</font></font></b></ul>
<font color="#CCCCCC"><font size=-1>.CODE obsahuje všechny naše instrukce.
Kód musí bıt mezi &lt;starting label>: a end &lt;starting
label>. Název labelu není dùleitı. Mùete si ho pojmenovat jak chcete, jen musí bıt jedineènı
a neporušovat konvenci pojmenování MASM.</font></font>
<br><font color="#CCCCCC"><font size=-1>Naší první instrukcí je volání funkce
GetModuleHandle pro získání handelu instance našeho programu. Pod
Win32, handle instance a handle modulu jsou jedno a to samé. 
Mùete brát handle instance jako ID našeho programu. Je uíván jako parametr
nìkolika API funkcemi, které musíme volat, take je obecnì dobrım nápadem získat ho na zaèátku programu.
</font></font>
<br><b><font color="#009900"><font size=-1>Poznámka: Ve skuteènosti je pod Win32
handle instance lineární adresou našeho programu v pamìti.</font></font></b>
<br><font color="#CCCCCC"><font size=-1>Pøi návratu z Win32 funkce,
je návratová hodnota, pokud je tedy nìjaká, uloena v registru eax.
Všechny pøípadné ostatní hodnoty jsou vráceny pøes promìnné pøedané v seznamu parametrù, kterı definujete pro volání.
</font></font>
<br><font color="#CCCCCC"><font size=-1>Win32 funkce si témìø vdy uchovají segmentové registry,
a ebx, edi, esi a ebp registry. Naproti tomu jsou ecx a edx pomocné registry 
a jsou vdy nedefinovány pøi návratu z Win32 funkce.</font></font>
<br><b><font color="#009900"><font size=-1>Poznámka: Neoèekávejte, e registry
eax, ecx, edx budou obsahovat stejné hodnoty po návratu z API funkcí.</font></font></b>
<br><font color="#CCCCCC"><font size=-1>Závìr je tento: Kdy voláte
API funkci, èekejte návratovou hodnotu v eax. Jestlie jakákoliv vaše funkce bude volána Windows,
musíte také hrát podle pravidel. Uchovejte a poté pøed návratem obnovte hodnoty segmentovıch registrù,
ebx, edi, esi and ebp, jinak váš program rychle spadne, to vše platí i pro vaši proceduru okna a callback funkce.
</font></font>
<br><font color="#CCCCCC"><font size=-1>Volání GetCommandLine funkce není nutné,
jestlie váš program nebude pracovat s pøíkazovou øádkou. V tomto pøípadì jsem to jen ukázal pro pøípad,
e by jste to nìkdy potøebovali.
</font></font>
<br><font color="#CCCCCC"><font size=-1>Další je volání WinMain. Zde pøijímá
ètyøi parametry. Handle instance programu, handle instance pøedchozí instance našeho programu,
pøíkazovou øádku a stav okna pøi prvním spuštìní.
Pod  Win32 neexistuje ádná pøedchozí instance. Kadı program je ve svém adresovém prostoru,
take hodnota hPrevInst je vdy 0. To je ještì pozùstatek z dob Win16, kdy všechny instance programu
bìely ve stejném adresovém prostoru a instance chtìli znát, jestli jsou první instancí.
Pod win16, jeslie hPrevInst byla NULL, pak byla tato instance první.
</font></font>
<br><font color="#CCCCCC"><font size=-1>Poznámka: Nemusíte deklarovat
jméno hlavní funkce jako WinMain. Ve skuteènosti máte uplnou svobodu v tomto smyslu.
Nemusíte dokonce ani pouít podobnou funkci jako WinMain a mùete zkopírovat kód uvnitø WinMain za 
GetCommandLine a program i tak pobìí korektnì.</font></font>
<br><font color="#CCCCCC"><font size=-1>Pøi návratu z WinMain je eax naplnìn únikovım(exitovım) kódem,
kterı pøedáme jako parametr funkci ExitProcess, která ukonèí aplikaci.
</font></font>
<p><b><font color="#999900"><font size=-1>WinMain proc Inst:HINSTANCE,hPrevInst:HINSTANCE,CmdLine:LPSTR,CmdShow:DWORD</font></font></b>
<p><font color="#CCCCCC"><font size=-1>Øádek vıše je deklarace funkce WinMain.
Všimnìte si párù parametr:typ, které následují po PROC direktivì. To jsou parametry, které WinMain obdrí od volajícího.
Mùete se odkazovat na tyto parametry jménem na místo manipulace se zásobníkem. K tomu ještì MASM vygeneruje
prologue a epilogue kód, take se nemusíme zabıvat balancováním zásobníku pøi vstupu a ukonèení funkce.
</font></font>
<p><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; LOCAL wc:WNDCLASSEX</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; LOCAL msg:MSG</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; LOCAL hwnd:HWND</font></font></b>
<p><font color="#CCCCCC"><font size=-1>LOCAL direktiva alokuje pamìt ze zásobníku pro lokální promìnné
pouité ve funkci. Svazek LOCAL direktiv musí bıt hned pod PROC direktivou.
Za LOCAL direktivou hned následuje &lt;jméno lokální promìnné>:&lt;typ promììné
>. Take LOCAL wc:WNDCLASSEX øíká MASM, aby alokoval pamìt ze zásobníku o velikosti WNDCLASSEX struktury
pro promìnnou jménem wc. Mùeme se na tuto promìnnou odkazovat bez jakıchkoliv obtíí s manipulací se zásobníkem.
To je vskutku Boí dar, øekl bych. Nevıhodu je, e lokální promìnné nemùeme pouít vnì funkce, protoe
jsou tvoøeny a budou znièeny automaticky, kdy se funkce vrací k volajícímu. Další nevıhodou je, e
nemùete inicializovat lokální promìnné automaticky, protoe jsou vlastnì jen dynamicky alokovanou èástí pamìti zásobníku
pøi vstupu do funkce.
Musíte jim ruènì pøiøadit poadované hodnoty a po LOCAL direktivách.</font></font>
<p><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.cbSize,SIZEOF WNDCLASSEX</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.style, CS_HREDRAW or CS_VREDRAW</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.lpfnWndProc, OFFSET WndProc</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.cbClsExtra,NULL</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.cbWndExtra,NULL</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; push&nbsp;
hInstance</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; pop&nbsp;&nbsp;
wc.hInstance</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.hbrBackground,COLOR_WINDOW+1</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.lpszMenuName,NULL</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.lpszClassName,OFFSET ClassName</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; invoke LoadIcon,NULL,IDI_APPLICATION</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.hIcon,eax</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.hIconSm,eax</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; invoke LoadCursor,NULL,IDC_ARROW</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;
wc.hCursor,eax</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; invoke RegisterClassEx,
addr wc</font></font></b>
<p><font color="#CCCCCC"><font size=-1>Ony øádky nad námi jsou koncepènì jednoduché.
Konceptem tìchto øádkù je &nbsp; <i>tøída okno (window class)</i>.
Window class není nic jiného víc ne plánem nebo specifikací okna.
Definuje nìkolik dùleitıch charakteristik okna jako jsou jeho ikona,
kursor, funkci odpovìdnou za okno, jeho barvu apod. Vytvoøíte okno z tøídy Okno (window class).
To je objektovì orientovanı koncept. Jestlie chcete vytvoøit další okno se stejnımi vlastnostmi,
je rozumné uloit všechny tyto vlastnosti na jedno místo a v pøípadì potøeby ho vyuít.
Tímto lze ušetøit dost pamìti a vyhnout se tím zbyteènım zdvojováním informací.
Uvìdomte si, e Windows bylo designováno v minulosti, kde pamìové èipy byly cenovì nepøístupné
a vìtšina poèítaèù mìla 1 MB pamìti.
Windows musejí bıt velice efektivní v pouítí pamìovıch zdrojù.
Pointa je tato: Jestlie si definujete vlastní okno, musíte vyplnit poadované vlastnosti
vašeho okna ve WNDCLASS nebo WNDCLASSEX struktuøe a zavolat funkci RegisterClass nebo RegisterClassEx
pøedtím, ne budete moci vaše okno vytvoøit. Musíte registrovat tøídu Okno jednou pro kadı typ okna,
ze kterého chcete tvoøit okno.</font></font>
<br><font color="#CCCCCC"><font size=-1>Windows má nìkolik pøeddefinovanıch
tøíd Okno, jako jsou buttony a editboxy. Pro tyto okna (nebo jinı název controls),
nemusíte registrovat další tøídu Okno, pouze zavoláte CreateWindowEx s pøeddefinovanım názvem tøídy.
</font></font>
<br><font color="#CCCCCC"><font size=-1>Jednoduše nejdùleitìjším èlenem 
WNDCLASSEX struktury je lpfnWndProc. lpfn znaèí long pointer to function (dalekı ukazatel na funkci).
Pod Win32 ji nejsou ádné "near" - blízké nebo "far" - daleké ukazatele, jednoduše kvùli
FLAT pamìovému modelu. Ale znovu to je pouze pozùstak z dob Win16.
Kadá tøída Okno musí bıt asociována s funkcí, která se nazıvá window procedure (procedura okna).
Tato procedura je zodpovìdná za práci se zprávami všech oken vytvoøenıch z asociované tøídy Okno.
Windows posílá zprávy proceduøe okna, aby ji upozornil na dùleité události, které se tıkají oken,
za které je procedura odpovìdná, jako je uivatelùv vstup z klávesnice nebo myši.
Je jen na proceduøe okna, aby inteligentnì reagovala na kadou událost, kterou obdrí ke kadému oknu.
Vìtšinu svého èasu budete trávit psaním kódu na obsluhování událostí v proceduøe okna. </font></font>
<br><font color="#CCCCCC"><font size=-1>Popíšu kadı èlen WNDCLASSEX:
</font></font>
<p><b><font color="#CCCCCC"><font size=-1>WNDCLASSEX STRUCT DWORD</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp; cbSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ?</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp; style&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ?</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp; lpfnWndProc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ?</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp; cbClsExtra&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ?</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp; cbWndExtra&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ?</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp; hInstance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ?</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp; hIcon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ?</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp; hCursor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ?</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp; hbrBackground&nbsp;&nbsp;&nbsp;&nbsp;
DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ?</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp; lpszMenuName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ?</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp; lpszClassName&nbsp;&nbsp;&nbsp;&nbsp;
DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ?</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp; hIconSm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ?</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>WNDCLASSEX ENDS</font></font></b>
<p><font size=-1><b><font color="#FFFF00">cbSize: </font></b><font color="#CCCCCC">Velikost
WNDCLASSEX struktury v bytech. Mùeme pouít operátor SIZEOF pro její získání.
</font></font>
<br><font size=-1><b><font color="#FFFF00">style: </font></b><font color="#CCCCCC">Styl
oken vytvoøenıch z tého tøídy. Mùete kombinovat nìkolik stylù pomocí "or" operátoru.</font></font>
<br><font size=-1><b><font color="#FFFF00">lpfnWndProc:</font></b><font color="#CCCCCC">
Adresa procedury okna, která je zodpovìdná za okna vytvoøené z této tøídy.</font></font>
<br><font size=-1><b><font color="#FFFF00">cbClsExtra:</font></b><font color="#CCCCCC">
Specifikuje poèet extra bytù k alokaci pro další window-class strukturu.
Operaèní systém inicializuje tyto byty nulou. Zde mùete uloit data specifická pro tøídu Okno.
</font></font>
<br><font size=-1><b><font color="#FFFF00">cbWndExtra: </font></b><font color="#CCCCCC">Specifikuje
poèet extra bytù k alokaci další instance okna. Operaèní systém inicializuje tyto byty nulou.
Jestlie aplikace pouívá WNDCLASS strukturu k registraci dialog boxu vytvoøeného pomocí CLASS
direktivy v resource souboru, musí nastavit tento èlen na DLGWINDOWEXTRA.</font></font>
<br><font size=-1><b><font color="#FFFF00">hInstance:</font></b><font color="#CCCCCC">
Handle instance modulu.</font></font>
<br><font size=-1><b><font color="#FFFF00">hIcon:</font></b><font color="#CCCCCC">
Handle k ikonì. Dostaneme ho funkcí LoadIcon.</font></font>
<br><font size=-1><b><font color="#FFFF00">hCursor:</font></b><font color="#CCCCCC">
Handle ke kurzoru. Dostaneme ho funkcí LoadCursor.</font></font>
<br><font size=-1><b><font color="#FFFF00">hbrBackground:</font></b><font color="#CCCCCC">
Barva pozadí oken vytvoøenıch z tøídy.</font></font>
<br><font size=-1><b><font color="#FFFF00">lpszMenuName:</font></b><font color="#CCCCCC">
Nastavenı handle k menu pro okna vytvoøená z tøídy.</font></font>
<br><font size=-1><b><font color="#FFFF00">lpszClassName:</font></b><font color="#CCCCCC">
Jméno této tøídy.</font></font>
<br><font size=-1><b><font color="#FFFF00">hIconSm:</font></b><font color="#CCCCCC">
Handle k malé ikonce, která je spojena s tøídou. Jestlie je tento èlen NULL,
systém prohledá zdroje ikony specifikované èlenem hIcon pro ikonu odpovídající velikosti.
</font></font>
<p><b><font size=-1><font color="#006600">&nbsp;&nbsp;&nbsp;</font><font color="#999900">
invoke CreateWindowEx, NULL,\</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ADDR ClassName,\</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ADDR AppName,\</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
WS_OVERLAPPEDWINDOW,\</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CW_USEDEFAULT,\</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CW_USEDEFAULT,\</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CW_USEDEFAULT,\</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CW_USEDEFAULT,\</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
NULL,\</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
NULL,\</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
hInst,\</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
NULL</font></font></b>
<p><font color="#CCCCCC"><font size=-1>Po registraci tøídy Okno, mùeme volat CreateWindowEx pro vytvoøení
našeho okna zaloené na naší tøídì. Všimnìte si, e tahle funkce má 12 parametrù.</font></font>
<p><b><font color="#CCCCCC"><font size=-1>CreateWindowExA proto dwExStyle:DWORD,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp; lpClassName:DWORD,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp; lpWindowName:DWORD,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp; dwStyle:DWORD,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp; X:DWORD,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp; Y:DWORD,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp; nWidth:DWORD,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp; nHeight:DWORD,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp; hWndParent:DWORD
,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp; hMenu:DWORD,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp; hInstance:DWORD,\</font></font></b>
<br><b><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp; lpParam:DWORD</font></font></b>
<p><font color="#CCCCCC"><font size=-1>Pojïme si prohlédnout detaily kadého parametru:
</font></font>
<br><font size=-1><b><font color="#999900">dwExStyle:</font></b><font color="#CCCCCC">
Extra styl okna. Tohle je novı parametr, kterı byl pøidán ke starému CreateWindow.
Zde mùete vloit nové styly pro Windows 95 &amp; NT. 
Bìné styly mùete specifikovat v dwStyle, ale jestli chcete nìjaké speciální efekty, musíte je specifikovat zde.
V pøípadì, e extra styl nechcete, pouijte NULL.
</font></font>
<br><font size=-1><b><font color="#999900">lpClassName: </font></b><font color="#CCCCCC">(Vyadováno).
Adresa ASCIIZ øetìzce obsahujícího jméno tøídy okna, které chcete pouít jako šablonu pro toto okno.
Tøída mùe bıt vaše vlastní registrovaná nebo pøeddefinovaná.
Jak øeèeno vıše, kadé okno, které vytvoøíte musí bıt zaloeno na tøídì Okno.</font></font>
<br><font size=-1><b><font color="#999900">lpWindowName: </font></b><font color="#CCCCCC">Adresa
ASCIIZ øetìzce obsahujícího jméno okna. Bude zobrazeno v titulku okna.
Jestlie je tento parametr NULL, pak bude titulek prázdnı.
</font></font>
<br><font size=-1><b><font color="#999900">dwStyle:&nbsp;</font></b><font color="#CCCCCC">
Styly okna. Zde mùete urèit vzhled okna. Pøedáním
NULL&nbsp; je v poøádku, ale okno nebude mít system menu box, ádné tlaèítka pro minimalizaci a maximalitaci,
a ádné tlaèítko pro zavøení. Okno pak vlastnì nebude k pouítí :). Potøebovali by jste Alt+F4 na zavøení.
Nejbìnìjší styl okna je WS_OVERLAPPEDWINDOW. Styl okna je vlastnì pouze stav jednoho bitu. Proto mùete jednotlivé
styly kombinovat logickım operátorem "or" pro poadovanı vzhled. WS_OVERLAPPEDWINDOW styl
je ve skuteènosti kombinací nejbìnìjších stylù.</font></font>
<br><font size=-1><b><font color="#999900">X,Y:</font></b><font color="#CCCCCC">
Souøadnice horního levého rohu okna. Normálnì by tyto hodnoty mìly bıt CW_USEDEFAULT,
tj. Windows si rozhodnou, kam okno umístí na plochu.</font></font>
<br><font size=-1><b><font color="#999900">nWidth, nHeight: </font></b><font color="#CCCCCC">
Šíøka a vıška okna v pixelech. Mùete také pouít CW_USEDEFAULT a nechat tím Windows vybrat vhodnou šíøku
a vıšku za vás.</font></font>
<br><font size=-1><b><font color="#999900">hWndParent: </font></b><font color="#CCCCCC">
Handle k (parent) rodièovskému oknu našeho okna (pokud existuje). Tento parametr øíká
Windows, zda-li je toto okno potomkem-child (podøízené) nìjaké jiného okna
a paklie ano, které okno je rodièovské. Toto ale není vztah rodiè-potomek
v MDI (multiple document interface). Podøízená okna nejsou
vázána ke klientské oblasti okna rodièovského. Tento vztah je èistì pro interní potøeby
Windows. Jestlie je rodièovské okno zavøeno, všechna podøízená okna budou také zavøena.
Opravdu je to tak snadné. Protoe je ale v našem pøíkladu jen jedno okno, pouijeme NULL.
</font></font>
<br><font size=-1><b><font color="#999900">hMenu:</font></b><font color="#CCCCCC">
Handle k menu okna. NULL pokud pouijeme základní menu tøídy.
Podívejte se zpìt na èlena WNDCLASSEX struktury, lpszMenuName. lpszMenuName
specifikuje *standardní* menu pro tøídu okna. Kadé okno vytvoøené z této tøídy
bude mít standardnì stejné menu. Pokud menu "nepøepíšete" pro konkrétní okno
díky jeho hMenu parametru. hMenu je ve skuteènosti parametr pro dva úèely.
V pøípadì, e okno, které chcete vytvoøit je pøeddefinovaného typu (tzv. control), nemùe vlastnit menu.
hMenu je pak pouito jako ID controlu. Windows mùe rozhodnout, zda-li je
hMenu skuteènì handle k menu nebo právì jen ID tím, e se podívá na lpClassName
parametr. Jestlie je jím jméno pøeddefinované tøídy okna, pak je hMenu pouze ID.
Pokud ne, pak je to handle k menu okna.</font></font>
<br><font size=-1><b><font color="#999900">hInstance:</font></b><font color="#CCCCCC">
Handle instance programu vytváøejícího okno.</font></font>
<br><font size=-1><b><font color="#999900">lpParam: </font></b><font color="#CCCCCC">
Volitelnı ukazatel na datovou strukturu pøedávanı oknu. Ten uívá MDI okno
pro pøedání CLIENTCREATESTRUCT dat. Za normálních okolností je NULL,
co znamená, e pøes CreateWindow() nepøedáváme ádná data. Okno mùe získat
hodnotu tohoto parametru voláním funkce GetWindowLong.</font></font>
<p><b><font size=-1><font color="#006600">&nbsp;</font><font color="#999900">&nbsp;&nbsp;
mov&nbsp;&nbsp; hwnd,eax</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; invoke ShowWindow,
hwnd,CmdShow</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; invoke UpdateWindow,
hwnd</font></font></b>
<p><font color="#CCCCCC"><font size=-1>Pøi úspìšném návratu z CreateWindowEx
je handle k oknu vrácen v registru eax. Tuto hodnotu si musíme uchovat pro pozdìjší pouití.
Okno, které jsme právì vytvoøili není automaticky zobrazeno. K tomu musíme
zavolat ShowWindow s handelem okna a poadovanım stavem zobrazení.
Potom zavoláme UpdateWindow, abychom pøebarvili klientskou oblast okna. Tato funkce
je uiteèná, kdy chcete aktualizovat obsah klientské oblasti. Mùete ale tuto funkci vynechat.
<p><b><font size=-1><font color="#006600">&nbsp;</font><font color="#999900">&nbsp;&nbsp;
.WHILE TRUE</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke GetMessage, ADDR msg,NULL,0,0</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
.BREAK .IF (!eax)</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke TranslateMessage, ADDR msg</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke DispatchMessage, ADDR msg</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp; .ENDW</font></font></b>
<p><font color="#CCCCCC"><font size=-1>Naše okno je ji vidìt na obrazovce.
Ale nemùe ještì registrovat vstupy uivatele ze svìta. Take musíme nìjak zaøídit,
aby naše okno mohlo zpracovávat události, které se ho tıkají. To uèiníme pomocí tzv. smyèky zpráv
(message loop). Pro kadı modul je pouze jedna smyèka zpráv. Tato smyèka opakovanì
kontroluje zprávy od Windows pomocí GetMessage. GetMessage pøedává ukazatel 
na MSG structure Windowsùm. Tato MSG struktura bude naplnìna informacemi
o zprávì, kterou chce Windows poslat oknu v modulu.
GetMessage funkce se nevrátí, dokud ještì existují zprávy pro okno.
Bìhem této doby mùe Windows pøedat kontrolu jinım programùm.
Tohle je právì to co vytváøí spolupracující víceúlohové schéma platformy Win16.
GetMessage vrací FALSE kdy obdrí zprávu WM_QUIT, která ve smyèce zpráv preruší smyèku
a tím se program ukonèí.</font></font>
<br><font color="#CCCCCC"><font size=-1>TranslateMessage je funkce,
která bere èistı vstup z klávesnice a generuje novou zprávu (WM_CHAR), která je vloena
do fronty zpráv. Zpráva WM_CHAR obsahuje ASCII hodnotu zmáèknuté klávesy,
s èím se pracuje snadnìji ne s èistımi scan kody kláves.
Mùete tuto funkci vynechat, pokud nechcete zpracovávat stisky kláves.</font></font>
<br><font color="#CCCCCC"><font size=-1>DispatchMessage posílá data zprávy proceduøe okna,
která je zodpovìdná za zprávy urèitého okna.
is for.</font></font>
<p><b><font size=-1><font color="#006600">&nbsp;&nbsp;&nbsp;</font><font color="#999900">
mov&nbsp;&nbsp;&nbsp;&nbsp; eax,msg.wParam</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; ret</font></font></b>
<br><b><font color="#999900"><font size=-1>WinMain endp</font></font></b>
<p><font color="#CCCCCC"><font size=-1>Jestlie se smyèka zpráv pøeruší,
exitovı kód je uloen ve wParam èlenu MSG struktury. Mùete tento kód uloit do eax a vrátit ho Windows.
V souèasnosti ho sice Windwos ji nevyuívá, ale pro jistotu je lepší hrát podle pravidel.
</font></font>
<p><b><font color="#999900"><font size=-1>WndProc proc hWnd:HWND, uMsg:UINT,
wParam:WPARAM, lParam:LPARAM</font></font></b>
<p><font color="#CCCCCC"><font size=-1>Tohle je naše procedure okna.
Nemusíte jí pojmenovat WndProc. První parametr hWnd je handle okna, pro které je zpráva urèena.
uMsg je zpráva.
Všimnìte si, e uMsg není MSG struktura. Je to opravdu jen èlen. Windows
definují stovky zpráv, jejich vìtšinu vaše programy nebudou zajímat.
Windows pošlou vhodnout zprávu oknu v pøípadì, e stane nìco, co má s oknem spojitost.
Procedura okna pak zprávu pøijme a inteligentnì na ni reaguje.
wParam a lParam jsou parametry navíc, které uívají nìkteré zprávy.
Nìkteré zprávy ještì posílají urèitá související data. Tyto data jsou pøedávány proceduøe okna právì pomocí
lParam and wParam.</font></font>
<p><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; .IF uMsg==WM_DESTROY</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke PostQuitMessage,NULL</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; .ELSE</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke DefWindowProc,hWnd,uMsg,wParam,lParam</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ret</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; .ENDIF</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; xor eax,eax</font></font></b>
<br><b><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp; ret</font></font></b>
<br><b><font color="#999900"><font size=-1>WndProc endp</font></font></b>
<p><font color="#CCCCCC"><font size=-1>Teï pøichází klíèová èást. Zde je místo,
kde pøebıvá vìtšina inteligence vašeho programu.
Kód, kterı reaguje na kadou zprávu Windows je v proceduøe okna.
Musíte ovìøit, jestli zpráva od Windows je ta, která vás zajímá.
Jestlie ano, dìlejte cokoliv jako reakci na tu zprávu a pak se vrate s nulou v eax.
Paklie vás zpráva nezajímá, MUSÍTE zavolat&nbsp; DefWindowProc a pøedat všechny parametry,
které jste obdrely standardnímu(default) zpracování. DefWindowProc
je právì API funkce, která zpracovává zprávy, které vás nezajímají</font></font>
<br><font color="#CCCCCC"><font size=-1>Jediná zpráva, na kterou MUSÍTE odpovìdìt,
je WM_DESTROY. Tuto zprávu obdrí procedura okna, kdy bylo okno zavøeno.
V dobì, kdy procedura okna tuto zprávu obdrí ji bylo vaše okno odstranìno z obrazovky.
Je to jen upozornìní, e vaše okno bylo zavøeno a e by jste se mìli pøipravit na návrat do Windows.
Jako odpovìï mùete provést úklid pøed návratem do Windows.
Nemáte jinou monost, ne konèit kdy dojde na tuto zprávu.
Jestlie chcete mít pøíleitost zastavit uivatele od zavøení okna,
mìli by jste zpracovat WM_CLOSE zprávu. Nyní zpìt k WM_DESTROY,
po vykonání úklidovıch prací musíte volat PostQuitMessage, která pošle
WM_QUIT zprávu zpìt vašemu modulu. WM_QUIT donutí GetMessage k návratu s nulou v eax,
co má následek pøerušení smyèky zpráv a návrat do Windows.
Zprávu WM_DESTROY mùete poslat vaší vlastní proceduøe okna voláním DestroyWindow funkce.</font></font>
<p>
<hr WIDTH="100%">
<center><b><font color="#009900"><font size=-1>[<a href="http://win32asm.cjb.net">Iczelion's
Win32 Assembly HomePage</a>]</font></font></b>
<font size="2"> <br><i> Pøeklad Shaldan 2006, fx.s@seznam.cz - pøi èetbì a vyuívání novıch poznatkù z èetby opravdu za nic neruèím :)) </i></font>
</center>

</body>
</html>
