<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
   <meta name="Author" content="Iczelion">
   <meta name="GENERATOR" content="Mozilla/4.51 [en] (Win95; I) [Netscape]">
   <title>Iczelion's Win32 Assembly Tutorial 4: Kreslení Textu</title>
</head>
<body text="#FFFFFF" bgcolor="#000000" link="#FFFF00" vlink="#C0C0C0" alink="#C0FFC0">

<center>
<h1>
<font face="Arial,Helvetica"><font color="#999900">Tutorial 4: Kreslení textu
</font></font></h1></center>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>V tomto tutorialu
se nauèíme, jak "kreslit" text do klientské oblasti okna a také se dozvíme o kontextu zaøízení(device context).
</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Mùete si stáhnout zdroj:
<a href="files/tut04.zip">zde</a>.</font></font></font>
<h3>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=+0>Teorie:</font></font></font></h3>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Text ve Windows
je typem GUI objektu.&nbsp; Kadı znak je tvoøen mnoha pixely, které dohramady dávají urèitı vzor.
Proto mluvíme o "kreslení" namísto "psaní". Vìtšinou kreslíte text do vlastní klientské oblasti,
(ve skuteènosti mùete kreslit i mimo, ale to u je jiné povídání).&nbsp;
Dostat text na obrazovku ve Windows je podstatnì rozdílné od DOSu.
V DOSu jste mohli brát obrazovku jako oblast o rozmìrech 80x25.
Ale ve Windows je obrazovka sdílena nìkolika programy. Proto musí bıt prosazena urèitá pravidla,
aby se zabránilo, aby si programy navzájem pøekreslovaly obrazovku.
Windows to zajišuje tak, e omezuje plochu kreslení pro kadé okno na oblast své vlastní klientské oblasti.
Velikost klientské oblasti okna není konstanta. Uivatel mùe velikost oblasti zmìnit kdykoliv,
take ji musíte urèovat dynamicky.</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Pøedtím ne budete moci
kreslit cokoliv do své klientské oblasti, musíte poádat o povolení od Windows.
Správnì, ji nejste absolutním vládcem obrazovky jako jste bıvali v DOSu.&nbsp;
Musíte poádat Windows, aby jste mohli kreslit po své oblasti.
Windows urèí velikost klientské oblasti, font, barvy a další GDI attributy a pošle vám handle
ke kontextu zaøízení, kterı pak mùete pouít jako jakısi pas pro kreslení po své oblasti.
</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Co je kontext zaøízení ?
Je to pouze datová struktura, kterou internì spravuje samotné Windows.
Device kontext je pak asociován s jednotlivımi zaøízeními, jako je tiskárna nebo grafickı adapter.
Pro grafickı adapter je kontext zaøízení obvykle asociován s jednotlivım oknem na obrazovce.
</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Nìkteré z hodnot
kontextu zaøízení jsou grafické atributy jako je barva, font apod.
To jsou standardní hodnoty, které mùete mìnit. Existují jenom pro úsporu, abychom je nemuseli specifikovat
pøi kadém volání funkcí GDI.</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Mùete také
vidìt kontext zaøízení jako standardní prostøedí, které pro vás Windows pøipravilo.
Mùete pøepsat nìkterá nastavení pozdìji, jestli budete chtít.</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Kdy potøebuje program kreslit,
musí získat handle ke kontextovému zaøízení. Je nìkolik zpùsobù, jak to udìlat:
</font></font></font>
<ul><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>Zavolat
BeginPaint jako odpovìï na WM_PAINT zprávu.</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>Zavolat
GetDC jako odpovìï na jiné zprávy.</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>Zavolat
CreateDC pro vytvoøení svého vlastního kontextu zaøízení.</font></font></font></b></ul>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Jednu vìc si ale musíte pamatovat,
jakmile vyuijete handel ke kontextu zaøízení pro své úèely, musíte ho uvolnit v rámci zpracování jedné zprávy.
Nesnate se získávat handle jako reakci na jednu zprávu a potom ho uvolnit pøi reakci na jinou zprávu.</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Windows
posílá WM_PAINT zprávy oknu, aby ho upozornilo, e je èas pøekreslit svou klientskou oblast. 
Windows neukládá obsah klientské oblasti okna.
&nbsp; Místo toho, kdy nastane situace, která hlásí potøebu pøekreslit klientskou oblast,
(kdy bylo okno pøekryto jinım a nyní je odkrıváno napø.), Windows vloí WM_PAINT zprávu do fronty zpráv tomu oknu.
Je zodpovìdností toho okna, aby si pøekreslilo svoji oblast.
Musíte získat všechny informace o tom jak pøekreslit oblast ve WM_PAINT sekci vaší procedury okna, aby mohla
procedura okna pøekreslit oblast správnì, kdy WM_PAINT zpráva dorazí.</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Dalším konceptem,
kterı musíte pochopit je invalid rectangle (neplatnı obdélník). Windows definuje
tento neplatnı obdélník jako nejmenší obdélníkovou plochu v klientské oblasti, která potøebuje bıt pøekreslena.
Kdy Windows detekuje tuto plochu v klientské oblasti okna, pošle oknu WM_PAINT zprávu.
Jako reakci na WM_PAINT zprávu mùe okno získat paintstruct strukturu, která mimo jiné obsahuje
souøadnice této plochy neplatného obdélníku.
Vy pak voláte BeginPaint jako reakci na WM_PAINT zprávu, aby jste uèinili neplatnı obdélník platnım.
Pokud nezpracujete WM_PAINT zprávu, pøinejmenším musíte zavolat DefWindowProc nebo ValidateRect,
aby jste uèinili neplatnou oblast platnou, jinak vám windows budou opakovanì posílat WM_PAINT zprávu.</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Zde jsou 
kroky, které by jste mìli uèinit jako odpovìï na WM_PAINT zprávu:</font></font></font>
<ul><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>Získat handel
ke kontextu zaøízení pomocí BeginPaint.</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>Kreslit do klientské oblasti
</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>Uvolnit
handel ke kontextu zaøízení pomocí EndPaint</font></font></font></b></ul>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Všimnìte si,
e explicitnì nemusíte uèinit neplatnou oblast platnou. To automaticky udìlá
BeginPaint funkce. Mezi BeginPaint-Endpaint mùete volat jakoukoliv
GDI funkci pro kreslení do klientské oblasti. Témìø všechny vyadují handel ke kontextu zaøízení.
</font></font></font>
<h3>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Obsah:</font></font></font></h3>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Napíšeme program, kterı 
zobrazí øetìzec "Win32 assembly is great and
easy!" ve støedu klientské oblasti.</font></font></font>
<br>&nbsp;
<blockquote><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>.386</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>.model
flat,stdcall</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>option
casemap:none</font></font></font></b><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1></font></font></font></b>
<p><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>WinMain
proto :DWORD,:DWORD,:DWORD,:DWORD</font></font></font></b><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1></font></font></font></b>
<p><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>include
\masm32\include\windows.inc</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>include
\masm32\include\user32.inc</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>includelib
\masm32\lib\user32.lib</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>include
\masm32\include\kernel32.inc</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>includelib
\masm32\lib\kernel32.lib</font></font></font></b>
<p><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>.DATA</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>ClassName
db "SimpleWinClass",0</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>AppName&nbsp;
db "Our First Window",0</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>OurText&nbsp;
db "Win32 assembly is great and easy!",0</font></font></font></b>
<p><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>.DATA?</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>hInstance
HINSTANCE ?</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>CommandLine
LPSTR ?</font></font></font></b>
  <p><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>.CODE</font></font></font></b> 
    <br>
    <b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>start:</font></font></font></b> 
    <br>
    <b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; 
    invoke GetModuleHandle, NULL</font></font></font></b> <br>
    <b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; 
    mov&nbsp;&nbsp;&nbsp; hInstance,eax</font></font></font></b> <br>
    <b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; 
    invoke GetCommandLine<br>
    &nbsp;&nbsp;&nbsp;&nbsp;mov CommandLine,eax</font></font></font></b><br>
    <b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; 
    invoke WinMain, hInstance,NULL,CommandLine, SW_SHOWDEFAULT</font></font></font></b> 
    <br>
    <b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp; 
    invoke ExitProcess,eax</font></font></font></b> 
  <p><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>WinMain
proc hInst:HINSTANCE, hPrevInst:HINSTANCE, CmdLine:LPSTR, CmdShow:DWORD</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
LOCAL wc:WNDCLASSEX</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
LOCAL msg:MSG</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
LOCAL hwnd:HWND</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp; wc.cbSize,SIZEOF WNDCLASSEX</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp; wc.style, CS_HREDRAW or CS_VREDRAW</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp; wc.lpfnWndProc, OFFSET WndProc</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp; wc.cbClsExtra,NULL</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp; wc.cbWndExtra,NULL</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
push&nbsp; hInst</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
pop&nbsp;&nbsp; wc.hInstance</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp; wc.hbrBackground,COLOR_WINDOW+1</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp; wc.lpszMenuName,NULL</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp; wc.lpszClassName,OFFSET ClassName</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
invoke LoadIcon,NULL,IDI_APPLICATION</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp; wc.hIcon,eax</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp; wc.hIconSm,eax</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
invoke LoadCursor,NULL,IDC_ARROW</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp; wc.hCursor,eax</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
invoke RegisterClassEx, addr wc</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
invoke CreateWindowEx,NULL,ADDR ClassName,ADDR AppName,\</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
WS_OVERLAPPEDWINDOW,CW_USEDEFAULT,\</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CW_USEDEFAULT,CW_USEDEFAULT,CW_USEDEFAULT,NULL,NULL,\</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
hInst,NULL</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp; hwnd,eax</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
invoke ShowWindow, hwnd,SW_SHOWNORMAL</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
invoke UpdateWindow, hwnd</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
.WHILE TRUE</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke GetMessage, ADDR msg,NULL,0,0</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
.BREAK .IF (!eax)</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke TranslateMessage, ADDR msg</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke DispatchMessage, ADDR msg</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
.ENDW</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp;&nbsp;&nbsp; eax,msg.wParam</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ret</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>WinMain
endp</font></font></font></b>
<p><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>WndProc
proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
LOCAL hdc:HDC</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
LOCAL ps:PAINTSTRUCT</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
LOCAL rect:RECT</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
.IF uMsg==WM_DESTROY</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke PostQuitMessage,NULL</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
.ELSEIF uMsg==WM_PAINT</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke BeginPaint,hWnd, ADDR ps</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp;&nbsp; hdc,eax</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke GetClientRect,hWnd, ADDR rect</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke DrawText, hdc,ADDR OurText,-1, ADDR rect, \</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DT_SINGLELINE or DT_CENTER or DT_VCENTER</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke EndPaint,hWnd, ADDR ps</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
.ELSE</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke DefWindowProc,hWnd,uMsg,wParam,lParam</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ret</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
.ENDIF</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
xor&nbsp;&nbsp; eax, eax</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
ret</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>WndProc
endp</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>end
start</font></font></font></b></blockquote>

<h3>
Analysis:</h3>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Vìtšina kódu je stejná
jako je v Tutorialu 3. Vysvìtlím pouze dùleité zmìny.
</font></font></font>
<p><b><font face="Arial,Helvetica"><font size=-1><font color="#CCCCCC">&nbsp;</font><font color="#999900">&nbsp;&nbsp;
LOCAL hdc:HDC</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;
LOCAL ps:PAINTSTRUCT</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;
LOCAL rect:RECT</font></font></font></b>
<p><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Toto jsou
lokální promìnné, které pouívají GDI funkce v naší WM_PAINT èásti.
hdc ukládá handel ke kontextu zaøízení obdrenı od funkce BeginPaint,
ps je PAINTSTRUCT struktura. Vìtšinou nepouíváte hodnoty uloené v ps.
Je pøedána BeginPaint funkci a Windows ji naplní vhodnımi hodnotami.
Vy poté pøedáte ps EndPaint funkci, kdy skonèíte s kreslením do klientské oblasti.
rect je RECT struktura definována takto:</font></font></font>
<br>&nbsp;
<blockquote><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>RECT
Struct</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
left&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LONG ?</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
top&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LONG ?</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
right&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LONG ?</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>&nbsp;&nbsp;&nbsp;
bottom&nbsp;&nbsp;&nbsp; LONG ?</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>RECT
ends</font></font></font></b></blockquote>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Left a
top jsou souøadnice horního levého rohu, Right a
bottom jsou souøadnice pravého dolního rohu obdélníku. Jedna vìc je dùleitá:
Poèátek os x-y leí v horním levém rohu klientské oblasti,
take napø. bod y=10 je POD bodem y=0.</font></font></font>
<p><b><font face="Arial,Helvetica"><font size=-1><font color="#CCCCCC">&nbsp;</font><font color="#999900">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke BeginPaint,hWnd, ADDR ps</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
mov&nbsp;&nbsp;&nbsp; hdc,eax</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke GetClientRect,hWnd, ADDR rect</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke DrawText, hdc,ADDR OurText,-1, ADDR rect, \</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
DT_SINGLELINE or DT_CENTER or DT_VCENTER</font></font></font></b>
<br><b><font face="Arial,Helvetica"><font color="#999900"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
invoke EndPaint,hWnd, ADDR ps</font></font></font></b>
<p><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Jako reakci na
WM_PAINT zprávu voláte BeginPaint s handelem k oknu, do kterého chcete kreslit
a neinicializovanou PAINTSTRUCT strukturu jako parametry.
Po úspìšném zavolání obsahuje eax handle ke kontextu zaøízení. Dále
voláme GetClientRect, abychom získali rozmìry klientské oblasti.
Rozmìry jsou vráceny v promìnné rect, kterou pøedáváme funkci DrawText jako jeden z jejich parametrù.
DrawText syntaxe je:</font></font></font>
<p><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>DrawText
proto hdc:HDC, lpString:DWORD, nCount:DWORD, lpRect:DWORD, uFormat:DWORD</font></font></font></b>
<p><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>DrawText
je vyšší API funkce pro vıstup textu. Stará se o nìkteré detaily jako je zarovnání slov,
centrování apod., aby jste se mohli zamìøit na øetìzec, kterı chcete nakreslit.
Její niší (low-level) bratøíèek, TextOut, bude objektem našeho zkoumání pøíštì :).
DrawText zformátuje øetìzec tak, aby se vešel do obdélníku.
Pouije souèasnì zvolenı font, barvu a pozadí (v kontextu zaøízení)
a nakreslí text. Vrací vıšku textu v jednotkách zaøízení, v našem pøípadì v pixelech.
Pojïme si prohlédnout její parametry:</font></font></font>
<ul><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1><b><u>hdc</u></b>&nbsp;
Handle ke kontextu zaøízení</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1><b><u>lpString</u></b>&nbsp;
Ukazatel na øetìzec, kterı chcete nakreslit. Øetìzec musí bıt ukonèen nulou,
jinak by jste museli udat jeho délku v dalším parametru, nCount.</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1><b><u>nCount</u></b>&nbsp;
Poèet znakù øetìzce pro vıstup. Jestlie je øetìzec ukonèen nulou, nCount
musí bıt  -1. Jinak musí nCount obsahovat poèet znakù øetìzce, kterı chcete kreslit.
</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1><b><u>lpRect</u></b>&nbsp;
Ukazatel na obdélník (struktura typu RECT) do které chcete øetìzec nakreslit.
Tento obdélník je také oøezávacím (clipping) obdélníkem co znamená, e nemùete kreslit mimo nìj.
</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1><b><u>uFormat</u></b>
Hodnota, která udává jak bude øetìzec zobrazen v obdélníku.
Pouíváme tøí hodnot kombinované pomocí "or" operátoru:</font></font></font>
<ul>
<li>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1><b>DT_SINGLELINE</b>&nbsp;
Urèuje jeden øádek textu.</font></font></font></li>

<li>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1><b>DT_CENTER</b>&nbsp;
Centruje text horizontálnì</font></font></font></li>

<li>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1><b>DT_VCENTER</b>
Centruje vertikálnì. Musí bıt pouít s DT_SINGLELINE.</font></font></font></li>
</ul>
</ul>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Po skonèení
kreslení musíte zavolat EndPaint funkci k uvolnìní handelu ke kontextu zaøízení.
</font></font></font>
<br><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>A je to.
Shròme si znovu dùleité body:</font></font></font>
<ul>
<li>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Voláme
BeginPaint-EndPaint pár jako reakci na WM_PAINT zprávu.</font></font></font></li>

<li>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Udìláme
cokoliv se nám líbí s klientskou oblastí mezi BeginPaint a EndPaint.</font></font></font></li>

<li>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Pokud chcete
pøekreslit oblast vašeho okna jako reakci na jiné zprávy, máte dvì monosti:
</font></font></font></li>

<ul>
<li>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Pouijte GetDC-ReleaseDC
pár a své kreslení udìlejte mezi tìmito funkcemi.</font></font></font></li>

<li>
<font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>Zavolejte InvalidateRect
nebo UpdateWindow&nbsp; aby jste uèinili svou klientskou oblast neplatnou, èím donutíte
Windows aby vloilo do fronty zpráv WM_PAINT zprávu, na kterou bude reagovat vaše
WM_PAINT èást kódu.</font></font></font></li>
</ul>
</ul>

<hr WIDTH="100%">
<center><b><font face="Arial,Helvetica"><font color="#CCCCCC"><font size=-1>[<a href="http://win32asm.cjb.net">Iczelion's
Win32 Assembly HomePage</a>]</font></font></font></b>
<font size="2"> <br><i> Pøeklad Shaldan 2006, fx.s@seznam.cz - pøi èetbì a vyuívání novıch poznatkù z èetby opravdu za nic neruèím :)) </i></font>


</body>
</html>
