<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
   <meta name="GENERATOR" content="Mozilla/4.51 [en] (Win95; I) [Netscape]">
   <title>Iczelionùv Win32 ASM tutorial 2: MessageBox</title>
</head>
<body text="#CCCCCC" bgcolor="#000000" link="#FFFF33" vlink="#800080" alink="#0000FF">

<center>
<h1>
<font face="Arial"><font color="#999900">Tutorial 2: MessageBox</font></font></h1></center>
<font face="Arial"><font color="#CCCCCC"><font size=-1>V tomto tutorialu
vytvoøíme plnì funkèní Windows program, kterı zobrazí MessageBox,
kterı nám oznámí skvìlou zprávu: "Win32 assembly is great!" :).
</font></font></font>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>Stáhnìte si kód
zde:  <a href="files/tut02.zip">tady</a>.</font></font></font>
<h3>
<font face="Arial"><font color="#66FFFF">Teorie:</font></font></h3>
<font face="Arial"><font color="#CCCCCC"><font size=-1>Windows nabízí
mnoství programovıch zdrojù pro své programy. Jejich støedem je
API (Application Programming Interface). Windows API je sbírka mnoha
velice uiteènıch funkcí, které sídlí v samotném Windows, pøipravena k pouití
v jakémkoliv 	Windows programu. Tyto funkce jsou uloeny v nìkolika dynamicky-linkovanıch
knihovnách (DLLs) jako je kernel32.dll, user32.dll a gdi32.dll. Kernel32.dll
obsahuje API funkce, které se starají o pamì a správu procesù. User32.dll
kontroluje aspekty uivatelského rozhraní vašeho programu
a gdi32.dll je zodpovìdná za operace s grafikou.
Kromì tìchto tøech hlavních existují další DLL knihovny, které mùe váš program vyuívat
za pøedpokladu, e víte jak a které API funkce chcete pouít.
</font></font></font>
<br><font face="Arial"><font color="#CCCCCC"><font size=-1>Windows programy
se dynamicky (za bìhu programu) odkazují k tìmto DLL knihovnám, tj. samotnı kód API funkcí není pøítomen v exe souboru.
Aby program vìdìl, kde najít potøebné API funkce za bìhu, musíte mu tu informaci vloit pøímo do exe souboru.
Tyto informace jsou uloeny v importních knihovnách (*.lib).
Vaše programy tedy musíte slinkovat se správnımi importními knihovnami nebo nebudete schopni pouít API funkce.
</font></font></font>
<br><font face="Arial"><font color="#CCCCCC"><font size=-1>Kdy je program
nahrán do pamìti, Windows pøeète informace uloené v programu.
Ty obsahují jména funkcí, které program vyuívá a jména DLL knihoven,
ve kterıch jsou tyto funkce uloeny. Kdy Windows nalezne takové informace,
nahraje DLL knihovny a provede takové operace v programu, aby jednotlivá volání v programu volala správné funkce.
</font></font></font>
<br><font face="Arial"><font color="#CCCCCC"><font size=-1>Existují dvì kategorie API funkcí:
Jedna je pro ANSI a ta druhá pro Unicode.
Ke jménu API funkce pro ANSI je pøidáno "A", napø. MessageBoxA.
Ke jménu funkce pro Unicode je pøidáno "W" (zkratka Wide Char, myslím). Windows
95 pøirozenì podporuje ANSI a Windows NT Unicode.</font></font></font>
<br><font face="Arial"><font color="#CCCCCC"><font size=-1>My jsme obvykle zvyklí
na ANSI øetìzce, co jsou pole znakù ukonèené NULL.
ANSI znak(character) je 1 byte velikı. Zatímco ANSI je dostateèné 
pro Evropské jazyky, nemùe zvládnout nìkolik orientálních jazykù, které mají nìkolik tisíc jedineènıch znakù.
Proto existuje UNICODE. UNICODE znak je 2 byty velikı, co umoòuje mít a 65536
jedineènıch znakù v øetìzcích.</font></font></font>
<br><font face="Arial"><font color="#CCCCCC"><font size=-1>Ale vìtšinu èasu
budete pouívat hlavièkové soubory, které sami urèí a vyberou vhodné varianty funkcí pro vaši platformu.
Prostì pouívejte API funkce bez pøidávaného "A" nebo "W".
</font></font></font>
<h3>
<font face="Arial"><font color="#00CCCC">Pøíklad:</font></font></h3>
<font face="Arial"><font color="#CCCCCC"><font size=-1>Zde je základní kostra programu:
Probereme ji pozdìji.</font></font></font> 
<p><b><font face="Arial"><font color="#FFFF99"><font size=-1>.386<br>
  .model flat, stdcall</font></font></font></b> <br>
  <b><font face="Arial"><font color="#FFFF99"><font size=-1>.data</font></font></font></b> 
  <br>
  <b><font face="Arial"><font color="#FFFF99"><font size=-1>.code</font></font></font></b> 
  <br>
  <b><font face="Arial"><font color="#FFFF99"><font size=-1>start:</font></font></font></b> 
  <br>
  <b><font face="Arial"><font color="#FFFF99"><font size=-1>end start</font></font></font></b> 
<p><font face="Arial"><font size=-1><font color="#CCCCCC">Provádìní programu
zaèíná od první instrukce pod labelem se jménem, které je uvedeno po
</font><font color="#FFFF99">end</font><font color="#CCCCCC"> direktivì.
V pøedchozí kostøe programu, provádìní zaèíná první instrukcí pod
labelem </font><font color="#FFFF99">start</font><font color="#CCCCCC">.
 Provádìní bude pokraèovat instrukci po instrukci dokud nenarazí na instrukce zmìny smìru provádìní programu
jako jsou</font><font color="#FFFF99"> jmp</font><font color="#CCCCCC">,
</font><font color="#FFFF99">jne</font><font color="#CCCCCC">, </font><font color="#FFFF99">je</font><font color="#CCCCCC">,
</font><font color="#FFFF99">ret</font><font color="#CCCCCC"> apod.
Tyto instrukce zmìní smìr provádìní na nìjaké další instrukce.
Kdy se program potøebuje vrátit do Windows, mìl by zavolat API funkci,
ExitProcess.</font></font></font>
<p><b><font face="Arial"><font color="#99FF99"><font size=-1>ExitProcess
proto uExitCode:DWORD</font></font></font></b>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>Øádek vıše
je nazıván funkèním prototypem. Funkèní prototyp urèuje parametry funkce
pro assembler/linker, kterı pak mùe za vás zkontrolovat, jestli funkci uíváte se správnımi parametry.
Formát funkèního prototypu vypadá takto:</font></font></font>
<p><b><font face="Arial"><font size=-1><font color="#CCCCCC">JmenoFunkce
PROTO </font><font color="#CCCC99">[JmenoParametru]</font><font color="#CCCCCC">:TypParametru,</font><font color="#CCCC99">[JmenoParametru]</font><font color="#CCCCCC">:TypParametru,...</font></font></font></b>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>Krátce øeèeno,
jméno funkce, za kterım následuje klíèové slovo PROTO a potom seznam 
datovıch typù parametrù funkce, oddìlenı èárkou. V pøípadì funkce ExitProcess
definuje ExitProcess jako funkci, která má pouze jedinı parametr typu DWORD.
Funkèní prototypy jsou velice uiteèné, kdy pouíváte syntaxi volání z vysšších programovacích jazykù,
 invoke. Mùeme brát invoke jako jednoduché volání s kontrolou typù.
Kdy napø. pouijete:</font></font></font>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>call ExitProcess</font></font></font>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>ani by jste PUSHli DWORD do zásobníku,
assembler/linker nebude schopen pro vás zachytit chybu. e jste chybu udìlali si všimnete
a ve chvíli, kdy program spadne. Ale kdy pouijete:
</font></font></font>
<p><font face="Arial"><font color="#FFFF99"><font size=-1>invoke ExitProcess</font></font></font>
<p><font face="Arial"><font size=-1><font color="#CCCCCC">, tak vás bude linker informovat,
e jste zapomnìli PUSHnout DWORD do zásobníku a chybu jednoduše odstraníte.
Doporuèuji uívat</font><font color="#FFFF99"> invoke</font><font color="#CCCCCC">
namísto prostého call. Syntaxe invoke je:</font></font></font>
<p><b><font face="Arial"><font color="#CC0000"><font size=-1>INVOKE&nbsp;
vıraz [,argumenty]</font></font></font></b>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>Vırazem mùe bıt
jméno funkce nebo ukazatel na funkci. Parametry funkce jsou oddìleny èárkami.
</font></font></font>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>Vìtšina funkèních prototypù
pro API funkce je uloena v hlavièkovıch souborech. Pokud pouijete Hutchovo
MASM32, budou v MASM32/include adresáøi s koncovkou .inc .
Funkèní prototypy pro funkce v DLL jsou uloeny v .inc souboru se stejnım jménem jako DLL.
Napø. ExitProcess je exportován knihovnou kernel32.lib, take funkèní prototyp je
v kernel32.inc.</font></font></font>
<br><font face="Arial"><font color="#CCCCCC"><font size=-1>Mùete také vytváøet
své vlastní funkèní prototypy svıch funkcí.</font></font></font>
<br><font face="Arial"><font color="#CCCCCC"><font size=-1>V mıch tutoriálech
 budu pouívat Hutchùv windows.inc, kterı si mùete stáhnout z http://win32asm.cjb.net</font></font></font>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>Zpìt k ExitProcess,
uExitCode parametr je hodnota, kterou chcete aby váš program vrátil Windows poté co skonèí.
Mùete zavolat ExitProcess takto:</font></font></font>
<p><b><font face="Arial"><font color="#FFCC66"><font size=-1>invoke ExitProcess,
0</font></font></font></b>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>Dejte tento øádek
hned po label start a budete mít win32 program, kterı dìlá jen to, e se vrátí do Windows,
poté co se spustí. Nic extra, ale pøesto to je korektní program.
</font></font></font>
<p><b><font face="Arial"><font color="#FFFF99"><font size=-1>.386</font></font></font></b> 
  <br>
  <b><font face="Arial"><font color="#FFFF99"><font size=-1>.model flat, stdcall</font></font></font></b> 
  <br>
  <b><font face="Arial"><font color="#FFFF99"><font size=-1>option casemap:none</font></font></font></b> 
  <br>
  <b><font face="Arial"><font color="#FF9999"><font size=-1>include \masm32\include\windows.inc</font></font></font></b> 
  <br>
  <b><font face="Arial"><font color="#FF9999"><font size=-1>include \masm32\include\kernel32.inc</font></font></font></b> 
  <br>
  <b><font face="Arial"><font color="#FF9999"><font size=-1>includelib \masm32\lib\kernel32.lib</font></font></font></b> 
  <br>
  <b><font face="Arial"><font color="#FFFF99"><font size=-1>.data</font></font></font></b> 
  <br>
  <b><font face="Arial"><font color="#FFFF99"><font size=-1>.code</font></font></font></b> 
  <br>
  <b><font face="Arial"><font color="#FFFF99"><font size=-1>start:</font></font></font></b> 
  <br>
  <b><font face="Arial"><font color="#FF9999"><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invoke 
  ExitProcess,0</font></font></font></b> <br>
  <b><font face="Arial"><font color="#FFFF99"><font size=-1></font></font></font></b><b><font face="Arial"><font color="#FFFF99"><font size=-1>end 
  start</font></font></font></b> 
<p>option casemap:none øíká MASM, aby rozlišoval malá a velká písmena v labelech, take ExitProcess
  a exitprocess jsou rozdílné. <font face="Arial"><font size=-1><font color="#CCCCCC">Všimìte si
  nové direktivy,</font><font color="#FFFF99"> include</font><font color="#CCCCCC">. 
  Po ní následuje jméno souboru, kterı chcete vloit na místo, kde jste direktivu napsali. 
  V pøíkladu vıše, kdy MASM dojde na øádek </font><font color="#FFFF99">include 
  \masm32\include\windows.inc</font><font color="#CCCCCC">, otevøe windows.inc, 
  kterı je v \MASM32\include adresáøi a zaène zpracovávat obsah windows.inc jako kdyby jste jeho obsah
  pøímo pøepsali do našeho kódu. Hutchùv windows.inc obsahuje
  definice konstant a struktur, které potøebujete v programování pod win32.
  Neobsahuje funkèní prototypy. Windows.inc není v ádném pøípadì kompletní. Hutch 
  a já jsme se snaili vloit do nìj co nejvíce konstant a struktur, ale ještì mnoho chybí. 
  Bude prùbìnì vylepšován. Sledujte Hutchovi a moje stránky kvùli updatùm.
  </font></font></font> <br>
  <font face="Arial"><font color="#CCCCCC"><font size=-1>Z windows.inc
  váš program obdrí konstanty a definice struktur. Pro funkèní prototypy musíte
  <font face="Arial, Helvetica, sans-serif">zahrnout(include) další hlavièkové soubory.
  Všechny jsou v \masm32\include adresáøi. </font></font></font></font>
<p><font face="Arial, Helvetica, sans-serif" size="-1">V <font color="#CCCCCC">našem
  pøíkladu, voláme funkci, která je v kernel32.dll, take potøebujeme zahrnout
  funkèí pro</font></font><font face="Arial"><font size=-1><font color="#CCCCCC">totypy 
  z kernel32.dll. Ty jsou v kernel32.inc. Jestlie si ho otevøete v textovém editoru,
  uvidíte, e je plnı funkèních prototypù pro kernel32.dll. Paklie
  nezahrnete kernel32.inc, mùete i pøesto ExitProcess zavolat, ale pouze pomocí CALL.
  Nebudete moci uít </font><font color="#FFFF99">invoke</font><font color="#CCCCCC">. 
  Pointa je jasná: aby jste mohli pouít invoke, musíte vloit prototyp nìkam do kódu.
  V našem pøípadì vıše, jestlie nezahrnete kernel32.inc, mùete definovat prototyp pro
  ExitProcess kdekoliv v kódu a invoke bude také pracovat.
  Hlavièkové soubory existují proto, aby vám ušetøili práci s psaním vlastních prototypù, 
  take je uívejte kdykoliv mùete.</font></font></font> <br>
  <font face="Arial"><font size=-1><font color="#CCCCCC">Nyní pøišel èas na další
  direktivu, </font><font color="#FFFF99">includelib</font><font color="#CCCCCC">. 
  Includelib nepracuje jako </font><font color="#FFFF99">include</font><font color="#CCCCCC">. 
  Je to pouze zpùsob jak øíci assembleru, jakou importní knihovnu program pouívá.
  Kdy assembler uvidí includelib direktivu, vloí linkovací pøíkaz do object souboru (*.obj)
  , take linker pak pozná s jakımi knihovnami má slinkovat váš program.
  Nejste nuceni tuto direktivu pouívat. Máte monost urèit jména knihoven v pøíkazové øádce linkeru,
  ale vìøte mi, je to zdlouhavé a navíc pøíkazová øádka pobere pouze 128 znakù.
  </font></font></font> 
<p><font face="Arial"><font size=-1><font color="#CCCCCC">Teï ulote 
pøíklad pod jménem </font><font color="#FFFF99">msgbox.asm</font><font color="#CCCCCC">.</font><font color="#CCCCFF">
</font><font color="#CCCCCC">Za pøedpokladu, e ml.exe je ve vaší cestì, spuste
msgbox.asm s:</font></font></font>
<ul><font face="Arial"><font color="#66FF66"><font size=-1>ml&nbsp; /c&nbsp;
/coff&nbsp; /Cp msgbox.asm</font></font></font>
<li>
<font face="Arial"><font size=-1><font color="#CC0000">/c</font><font color="#CCCCCC">
øekne MASM, aby kód pouze sestavil. Nepoušejte link.exe. Vìtšinou
nebudete chtít spouštìt link.exe automaticky, ponìvad budete muset udìlat jiné úlohy ještì pøed
tím, ne spustíte link.exe
</font></font></font></li>

<br><font face="Arial"><font size=-1><font color="#CC0000">/coff </font><font color="#CCCCCC">øekne
MASM, aby vytvoøil soubor .obj v </font><font color="#FFFF99">COFF</font><font color="#CCCCCC">
formátu. MASM pouívá variantu </font><font color="#FFFF99">COFF</font><font color="#CCCCCC">
(Common Object File Format), která se pouívá pod Unixem jako jeho vlastní formát.
</font></font></font>
<br><font face="Arial"><font size=-1><font color="#CC0000">/Cp</font><font color="#CCCCCC">
øekne MASM, aby rozlišoval malá a velká písmena. Pokus uíváte Hutchovo </font><font color="#FFFF99">MASM32</font><font color="#CCCCCC">,
 mùete vloit "</font><font color="#FFFF99">option casemap:none</font><font color="#CCCCCC">"
v hlavièce vašeho kódu, pod </font><font color="#FFFF99">.model</font><font color="#CCCCCC">
direktivu a dosáhnete stejného efektu.</font></font></font></ul>
<font face="Arial"><font color="#CCCCCC"><font size=-1>Po úspìšném sestavení(assembling)
msgbox.asm, dostanete msgbox.obj. Msgbox.obj je objektovı soubor,
co je ji jen jeden krùèek k spustitelnému exe souboru. Obsahuje
instrukce/data v binární formì. Chybí mu pouze nìkteré úpravy adres, co dìlá linker.
</font></font></font>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>Tedy napište:
</font></font></font>
<ul><font face="Arial"><font color="#66FF33"><font size=-1>link /SUBSYSTEM:WINDOWS&nbsp;
/LIBPATH:c:\masm32\lib&nbsp; msgbox.obj</font></font></font></ul>

<blockquote><font face="Arial"><font size=-1><font color="#CC0000">/SUBSYSTEM:WINDOWS</font><font color="#CCCCCC">&nbsp;
informuje linker, jakı druh spustitelného souboru je váš program</font></font></font>
<br><font face="Arial"><font size=-1><font color="#CC0000">/LIBPATH:&lt;cesta
k importní knihovnì></font><font color="#CCCCCC"> øíká linkeru kde jsou importní knihovny.
Jestlie poíváte MASM32, budou v MASM32\lib adresáøi.</font></font></font></blockquote>
<font face="Arial"><font color="#CCCCCC"><font size=-1>Linker ète .obj soubor
a upravuje ho adresami z importních knihoven. Kdy skonèí dostanete 
msgbox.exe.</font></font></font>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>
Teï ho spuste. Zjistíte, e nic nedìlá :). Nu co, nedali jsem do nìj ještì nic zajímavého.
Ale pøesto je to program pod Windows. A podívejte se na tu velikost!
Na mém PC to je 1,536 bytù.</font></font></font>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>Teï zapojíme Message Box.
Jeho funkèní prototyp je: </font></font></font>
<p><b><font face="Arial"><font color="#FFCC00"><font size=-1>MessageBox
PROTO hwnd:DWORD, lpText:DWORD, lpCaption:DWORD, uType:DWORD</font></font></font></b>
<blockquote><font face="Arial"><font size=-1><font color="#FFFF99">hwnd</font><font color="#CCCCCC">
je handle(rukoje) k rodièovskému oknu</font><font color="#CCCCFF">.</font><font color="#CCCCCC">
O handelu mùete pøemıšlet jako o èíslu, které reprezentuje okno na které poukazujete.
Jeho hodnota není pro vás dùleitá. Pouze si pamatujte, e pøedstavuje okno.
Kdy budete chtít dìlat cokoliv s oknem, budete na nìj v programu poukazovat právì pomocí handelu.
</font></font></font>
<br><font face="Arial"><font size=-1><font color="#FFFF99">lpText</font><font color="#CCCCCC">
je ukazatel na text, kterı chcete zobrazit v klientské oblasti messageboxu.
Ukazatel(pointer) je jen adresa nìèeho. Ukazatel na textovı øetìzec=adresa toho øetìzce.
</font></font></font>
<br><font face="Arial"><font size=-1><font color="#FFFF99">lpCaption</font><font color="#CCCCCC">
je ukazatel na nadpis messageboxu.</font></font></font>
<br><font face="Arial"><font size=-1><font color="#FFFF99">uType</font><font color="#CCCCCC">
urèuje ikonu a èíslo a typ tlaèítek(button) v messageboxu.</font></font></font></blockquote>
<font face="Arial"><font color="#CCCCCC"><font size=-1>Pojïme tedy zmìnit msgbox.asm,
aby obsahoval messagebox.</font></font></font>
<br>&nbsp;
<p><font face="Arial"><font color="#FFFF99"><font size=-1>.386</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>.model flat,stdcall</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>option casemap:none</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>include \masm32\include\windows.inc</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>include \masm32\include\kernel32.inc</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>includelib \masm32\lib\kernel32.lib</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>include \masm32\include\user32.inc</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>includelib \masm32\lib\user32.lib</font></font></font>
<p><font face="Arial"><font color="#FFFF99"><font size=-1>.data</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>MsgBoxCaption&nbsp;
db "Iczelionùv Tutorial 2",0</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>MsgBoxText&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
db "Win32 Assembly is Great!",0</font></font></font>
<p><font face="Arial"><font color="#FFFF99"><font size=-1>.code</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>start:</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>invoke MessageBox,
NULL, addr MsgBoxText, addr MsgBoxCaption, MB_OK</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>invoke ExitProcess,
NULL</font></font></font>
<br><font face="Arial"><font color="#FFFF99"><font size=-1>end start</font></font></font>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>Zkompilujte a spuste.
Uvidíte messagebox zobrazující text "Win32 Assembly
is Great!".</font></font></font>
<p><font face="Arial"><font color="#CCCCCC"><font size=-1>Pojïme prozkoumat kód.
</font></font></font>
<br><font face="Arial"><font color="#CCCCCC"><font size=-1>Definujeme
nulou ukonèené øetìzce (zero-terminated strings) v .data sekci. Pamatujte, kadı ANSI øetìzec
ve Windows musí bıt ukonèen pomocí NULL (0 hexadecimalnì).</font></font></font>
<br><font face="Arial"><font color="#CCCCCC"><font size=-1>Pouijeme dvì konstanty,
NULL a MB_OK. Jsou ve windows.inc a mùete je uít na místo hodnot, co zlepšuje èitelnost kódu.
</font></font></font>
<br><font face="Arial"><font size=-1><font color="#CCCCCC"></font><font color="#FFFF99">Addr</font><font color="#CCCCCC">
operátor je uit k pøedání adresy labelu funkci.</font><font color="#CCCCFF">
</font><font color="#CCCCCC">Je platnı pouze v rámci invoke direktivy.
Nemùete ho napøíklad pouít k pøedání adresy labelu registeru/promìnné.
K tomu pouijte </font><font color="#FFFF99">offset</font><font color="#CCCCCC">
namísto addr v našem pøíkladu. Jsou však mezi nimi rozdíly:
</font></font></font>
<ol>
<li>
<font face="Arial"><font size=-1><font color="#FFFF99">addr</font><font color="#CCCCFF">
</font><font color="#CCCCCC">nemùe zvládnout zpracovat forward(následnì) deklarovanı napø. label, zatímco</font><font color="#CCCCFF">
</font><font color="#FFFF99">offset</font><font color="#CCCCFF"> </font><font color="#CCCCCC">mùe.
Napø. jestlie je label definován v kódu nìkde dále ne na øádku s invoke, addr nebude fungovat.</font><font color="#CCCCFF"></font></font></font></li>

<blockquote><font face="Arial"><font color="#CCCCCC"><font size=-1>invoke
MessageBox,NULL, addr MsgBoxText,addr MsgBoxCaption,MB_OK</font></font></font>
<br><font face="Arial"><font color="#CCCCFF"><font size=-1>......</font></font></font>
<br><font face="Arial"><font color="#CCCCCC"><font size=-1>MsgBoxCaption&nbsp;
db "Iczelion Tutorial No.2",0</font></font></font>
<br><font face="Arial"><font color="#CCCCCC"><font size=-1>MsgBoxText&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
db "Win32 Assembly is Great!",0</font></font></font></blockquote>
<font face="Arial"><font size=-1><font color="#CCCCCC">MASM ohlásí chybu.
Pokud pouijete </font><font color="#CCCCFF"> </font><font color="#FFFF99">offset</font><font color="#CCCCCC">
místo </font><font color="#CCCCFF"> </font><font color="#FFFF99">addr</font><font color="#CCCCFF">
</font><font color="#CCCCCC"> v pøedchozí èásti kódu, MASM si stìovat ji nebude. <br><br>
</font></font></font>
<li>
<font face="Arial"><font size=-1><font color="#FFFF99">addr</font><font color="#CCCCFF">
</font><font color="#CCCCCC">zvládá lokální promìnné, zatímco</font><font color="#FFFF99">
offset</font><font color="#CCCCFF"> </font><font color="#CCCCCC">ne.</font><font color="#CCCCFF">
</font><font color="#CCCCCC">Lokální promìnná je pouze rezervovanı prostor v zásobníku.
Bìhem bìhu programu budete znát pouze její adresu. </font><font color="#FFFF99">Offset</font><font color="#CCCCCC">
je ale interpretován bìhem sestavování pøímo assemblerem. Take pøirozenì
</font><font color="#FFFF99">offset</font><font color="#CCCCCC"> nebude s lokálními 
promìnnımi pracovat. </font><font color="#FFFF99">Addr</font><font color="#CCCCCC">
je schopen pracovat s lokálními promìnnımi díky skuteènosti, e assembler
nejprve kontroluje, jestlie promìnná se kterou pracujete </font><font color="#FFFF99">addr</font><font color="#CCCCCC">
je globální nebo lokální. Jestlie globální, vloí pøímo její adresu do .obj souboru.
V tomto pøípadì pracuje jako </font><font color="#FFFF99">offset</font><font color="#CCCCCC">.
Paklie je ale promìnná lokální, vygeneruje sekvenci instrukcí jako je tato
pøedtím ne zavolá funkci:</font><font color="#CCCCFF"></font></font></font></li>

<blockquote><font face="Arial"><font color="#999900"><font size=-1>lea
eax, LocalVar</font></font></font>
<br><font face="Arial"><font color="#999900"><font size=-1>push eax</font></font></font></blockquote>

<p><br><font face="Arial"><font color="#CCCCCC"><font size=-1>Ponìvad lea
mùe urèit adresu labelu za bìhu, bude to fungovat.</font></font></font></ol>

<hr WIDTH="100%">
<center><b><font face="Arial"><font color="#006600"><font size=-1>[<a href="http://win32asm.cjb.net">Iczelion's
Win32 Assembly HomePage</a>]</font></font></font></b>
<font size="2"> <br><i> Pøeklad Shaldan 2006, fx.s@seznam.cz - pøi èetbì a vyuívání novıch poznatkù z èetby opravdu za nic neruèím :)) </i></font>
</center>

</body>
</html>
